import{A as Sk,a as Hx,b as Qf,c as cd,d as Wx,e as Gx,f as Kf,l as xk,m as Jf,n as K0,s as wk,t as J0,v as Ck}from"./chunk-XUK47PH6.js";import{i as kk,j as ms,k as Tk}from"./chunk-VR2CY5TD.js";import{A as vk,B as eb,D as tb,E as jt,F as ib,G as nb,H as qx,b as Zi,c as dk,d as Z0,e as hk,f as X0,g as uk,h as ld,i as So,j as mk,k as Qr,l as yr,m as Mo,n as pk,o as Ws,p as ko,q as Q0,r as Go,s as Fa,t as fk,u as gk,v as _k,w as bk,x as xm,y as qo,z as yk}from"./chunk-3QS4TQBE.js";import{$a as _n,$b as rk,A as pa,Ab as xi,Ac as $0,B as Dx,Bb as hs,Bc as Y0,C as $M,Cb as X,Cc as Hs,Da as rd,Db as Rt,E as Ax,Ea as Zr,Eb as Qi,Ec as ck,F as YM,Fa as KM,Fb as Us,G as Oa,Ga as ir,Gb as sd,Hb as oo,I as Px,Ib as ao,Ja as pe,Jb as so,Ka as ye,Kb as us,La as ym,Lb as Nn,Ma as Rh,Mb as G0,N as Ox,Na as U0,Nb as li,Oa as Zf,Ob as Nx,P as Rx,Pa as H0,Pb as ik,Q as N0,Qa as JM,Qb as q0,R as ls,Ra as zx,Rb as Vx,S as cs,Sa as Ri,Sb as nk,T as Lx,U as Oh,Ua as vm,Va as Po,W as ZM,Wa as xo,Y as V0,Z as Ht,_ as hi,_a as Bt,a as ss,aa as pn,ab as Le,bb as La,bc as ok,c as yo,ca as lt,cb as ji,da as vn,db as ds,dc as jx,ea as j0,eb as Xn,ec as lo,f as In,fa as XM,fb as ro,g as F0,gb as Xf,h as jM,ha as Yi,hb as gr,hc as Xr,i as UM,ia as gt,ib as _r,ic as Ux,j as HM,ja as ui,jb as V,k as Pl,ka as Zn,kb as j,l as Ol,la as QM,lb as Me,mb as od,n as Yr,nb as ad,nc as un,ob as Bx,pa as vo,pb as si,qa as Ct,qb as Rl,r as gm,ra as St,rb as ek,s as WM,sa as nd,sb as Fe,sc as Li,t as GM,ta as Fx,tb as tk,ua as _m,ub as ut,uc as Co,v as z0,va as bm,vb as Wo,vc as br,w as B0,wa as Ra,wb as wo,wc as lr,xb as W0,xc as ak,y as qM,ya as sn,yb as Ci,yc as sk,z as Ph,za as on,zb as vi,zc as lk}from"./chunk-3T5ZPZRG.js";import{a as Mk,b as wm}from"./chunk-5WWDFZLP.js";import{a as $i,b as Pa,c as NM,d as e3,f as VM,g as bo}from"./chunk-MON7YFGF.js";var W1=e3((U1,H1)=>{"use strict";(function(d,s){typeof U1=="object"&&typeof H1<"u"?H1.exports=s():typeof define=="function"&&define.amd?define(s):(d=typeof globalThis<"u"?globalThis:d||self,d.mapboxgl=s())})(U1,function(){"use strict";var d,s,u;function o(i,_){if(!d)d=_;else if(!s)s=_;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+d+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",I={};d(I),u=_(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}o(["exports"],function(i){var _="3.5.1";let C,I={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{C=t}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!I.API_URL)return null;try{let t=new URL(I.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function O(t){return I.API_URL_REGEX.test(t)}function N(t){return t.indexOf("mapbox:")===0}function q(t){return I.API_CDN_URL_REGEX.test(t)}function ie(t){return I.API_SPRITE_REGEX.test(t)}function de(t){return I.API_STYLE_REGEX.test(t)&&!ie(t)}let xe={create:"create",load:"load",fullLoad:"fullLoad"},ke={mark(t){performance.mark(t)},measure(t,e,n){performance.measure(t,e,n)}};function Ae(t){let e=t.name.split("?")[0];return q(e)&&e.includes("mapbox-gl.js")?"javascript":q(e)&&e.includes("mapbox-gl.css")?"css":function(n){return I.API_FONTS_REGEX.test(n)}(e)?"fontRange":ie(e)?"sprite":de(e)?"style":function(n){return I.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function Xe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var qe={},ht={};Object.defineProperty(ht,"__esModule",{value:!0}),ht.setMatrixArrayType=function(t){ht.ARRAY_TYPE=vt=t},ht.toRadian=function(t){return t*Ut},ht.equals=function(t,e){return Math.abs(t-e)<=Tt*Math.max(1,Math.abs(t),Math.abs(e))},ht.RANDOM=ht.ARRAY_TYPE=ht.EPSILON=void 0;var Tt=1e-6;ht.EPSILON=Tt;var vt=typeof Float32Array<"u"?Float32Array:Array;ht.ARRAY_TYPE=vt;var Et=Math.random;ht.RANDOM=Et;var Ut=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var xt={};function Yt(t){return Yt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yt(t)}Object.defineProperty(xt,"__esModule",{value:!0}),xt.create=function(){var t=new zt.ARRAY_TYPE(4);return zt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},xt.clone=function(t){var e=new zt.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},xt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},xt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},xt.fromValues=function(t,e,n,a){var c=new zt.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=a,c},xt.set=function(t,e,n,a,c){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t},xt.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},xt.invert=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n*m-c*a;return p?(t[0]=m*(p=1/p),t[1]=-a*p,t[2]=-c*p,t[3]=n*p,t):null},xt.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},xt.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},xt.multiply=Ui,xt.rotate=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return t[0]=a*y+m*b,t[1]=c*y+p*b,t[2]=a*-b+m*y,t[3]=c*-b+p*y,t},xt.scale=function(t,e,n){var a=e[1],c=e[2],m=e[3],p=n[0],b=n[1];return t[0]=e[0]*p,t[1]=a*p,t[2]=c*b,t[3]=m*b,t},xt.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t},xt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},xt.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},xt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},xt.LDU=function(t,e,n,a){return t[2]=a[2]/a[0],n[0]=a[0],n[1]=a[1],n[3]=a[3]-t[2]*n[1],[t,e,n]},xt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},xt.subtract=rr,xt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},xt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=t[3],p=e[0],b=e[1],y=e[2],w=e[3];return Math.abs(n-p)<=zt.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-b)<=zt.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(c-y)<=zt.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(m-w)<=zt.EPSILON*Math.max(1,Math.abs(m),Math.abs(w))},xt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},xt.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},xt.sub=xt.mul=void 0;var zt=function(t,e){if(t&&t.__esModule)return t;if(t===null||Yt(t)!=="object"&&typeof t!="function")return{default:t};var n=Si(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ht);function Si(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Si=function(a){return a?n:e})(t)}function Ui(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=n[0],y=n[1],w=n[2],M=n[3];return t[0]=a*b+m*y,t[1]=c*b+p*y,t[2]=a*w+m*M,t[3]=c*w+p*M,t}function rr(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}xt.mul=Ui,xt.sub=rr;var bi={};function cn(t){return cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cn(t)}Object.defineProperty(bi,"__esModule",{value:!0}),bi.create=function(){var t=new en.ARRAY_TYPE(6);return en.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},bi.clone=function(t){var e=new en.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},bi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},bi.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},bi.fromValues=function(t,e,n,a,c,m){var p=new en.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=n,p[3]=a,p[4]=c,p[5]=m,p},bi.set=function(t,e,n,a,c,m,p){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=m,t[5]=p,t},bi.invert=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=n*m-a*c;return y?(t[0]=m*(y=1/y),t[1]=-a*y,t[2]=-c*y,t[3]=n*y,t[4]=(c*b-m*p)*y,t[5]=(a*p-n*b)*y,t):null},bi.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},bi.multiply=Lr,bi.rotate=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=Math.sin(n),M=Math.cos(n);return t[0]=a*M+m*w,t[1]=c*M+p*w,t[2]=a*-w+m*M,t[3]=c*-w+p*M,t[4]=b,t[5]=y,t},bi.scale=function(t,e,n){var a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=n[0],w=n[1];return t[0]=e[0]*y,t[1]=a*y,t[2]=c*w,t[3]=m*w,t[4]=p,t[5]=b,t},bi.translate=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=n[0],M=n[1];return t[0]=a,t[1]=c,t[2]=m,t[3]=p,t[4]=a*w+m*M+b,t[5]=c*w+p*M+y,t},bi.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t[4]=0,t[5]=0,t},bi.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},bi.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},bi.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},bi.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},bi.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},bi.subtract=Hn,bi.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},bi.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t},bi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},bi.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=t[3],p=t[4],b=t[5],y=e[0],w=e[1],M=e[2],T=e[3],E=e[4],P=e[5];return Math.abs(n-y)<=en.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(a-w)<=en.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(c-M)<=en.EPSILON*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(m-T)<=en.EPSILON*Math.max(1,Math.abs(m),Math.abs(T))&&Math.abs(p-E)<=en.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(b-P)<=en.EPSILON*Math.max(1,Math.abs(b),Math.abs(P))},bi.sub=bi.mul=void 0;var en=function(t,e){if(t&&t.__esModule)return t;if(t===null||cn(t)!=="object"&&typeof t!="function")return{default:t};var n=zn(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ht);function zn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(zn=function(a){return a?n:e})(t)}function Lr(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=n[0],M=n[1],T=n[2],E=n[3],P=n[4],R=n[5];return t[0]=a*w+m*M,t[1]=c*w+p*M,t[2]=a*T+m*E,t[3]=c*T+p*E,t[4]=a*P+m*R+b,t[5]=c*P+p*R+y,t}function Hn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}bi.mul=Lr,bi.sub=Hn;var Mi={};function ta(t){return ta=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ta(t)}Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.create=function(){var t=new Wn.ARRAY_TYPE(9);return Wn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Mi.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Mi.clone=function(t){var e=new Wn.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Mi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Mi.fromValues=function(t,e,n,a,c,m,p,b,y){var w=new Wn.ARRAY_TYPE(9);return w[0]=t,w[1]=e,w[2]=n,w[3]=a,w[4]=c,w[5]=m,w[6]=p,w[7]=b,w[8]=y,w},Mi.set=function(t,e,n,a,c,m,p,b,y,w){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=m,t[5]=p,t[6]=b,t[7]=y,t[8]=w,t},Mi.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Mi.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=a,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Mi.invert=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=M*p-b*w,E=-M*m+b*y,P=w*m-p*y,R=n*T+a*E+c*P;return R?(t[0]=T*(R=1/R),t[1]=(-M*a+c*w)*R,t[2]=(b*a-c*p)*R,t[3]=E*R,t[4]=(M*n-c*y)*R,t[5]=(-b*n+c*m)*R,t[6]=P*R,t[7]=(-w*n+a*y)*R,t[8]=(p*n-a*m)*R,t):null},Mi.adjoint=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8];return t[0]=p*M-b*w,t[1]=c*w-a*M,t[2]=a*b-c*p,t[3]=b*y-m*M,t[4]=n*M-c*y,t[5]=c*m-n*b,t[6]=m*w-p*y,t[7]=a*y-n*w,t[8]=n*p-a*m,t},Mi.determinant=function(t){var e=t[3],n=t[4],a=t[5],c=t[6],m=t[7],p=t[8];return t[0]*(p*n-a*m)+t[1]*(-p*e+a*c)+t[2]*(m*e-n*c)},Mi.multiply=Oo,Mi.translate=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=n[0],P=n[1];return t[0]=a,t[1]=c,t[2]=m,t[3]=p,t[4]=b,t[5]=y,t[6]=E*a+P*p+w,t[7]=E*c+P*b+M,t[8]=E*m+P*y+T,t},Mi.rotate=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=Math.sin(n),P=Math.cos(n);return t[0]=P*a+E*p,t[1]=P*c+E*b,t[2]=P*m+E*y,t[3]=P*p-E*a,t[4]=P*b-E*c,t[5]=P*y-E*m,t[6]=w,t[7]=M,t[8]=T,t},Mi.scale=function(t,e,n){var a=n[0],c=n[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=c*e[3],t[4]=c*e[4],t[5]=c*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Mi.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Mi.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=-n,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Mi.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Mi.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Mi.fromQuat=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n+n,b=a+a,y=c+c,w=n*p,M=a*p,T=a*b,E=c*p,P=c*b,R=c*y,F=m*p,B=m*b,W=m*y;return t[0]=1-T-R,t[3]=M-W,t[6]=E+B,t[1]=M+W,t[4]=1-w-R,t[7]=P-F,t[2]=E-B,t[5]=P+F,t[8]=1-w-T,t},Mi.normalFromMat4=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=e[9],E=e[10],P=e[11],R=e[12],F=e[13],B=e[14],W=e[15],J=n*b-a*p,ee=n*y-c*p,te=n*w-m*p,me=a*y-c*b,he=a*w-m*b,ve=c*w-m*y,Ce=M*F-T*R,De=M*B-E*R,Ue=M*W-P*R,ze=T*B-E*F,$e=T*W-P*F,rt=E*W-P*B,We=J*rt-ee*$e+te*ze+me*Ue-he*De+ve*Ce;return We?(t[0]=(b*rt-y*$e+w*ze)*(We=1/We),t[1]=(y*Ue-p*rt-w*De)*We,t[2]=(p*$e-b*Ue+w*Ce)*We,t[3]=(c*$e-a*rt-m*ze)*We,t[4]=(n*rt-c*Ue+m*De)*We,t[5]=(a*Ue-n*$e-m*Ce)*We,t[6]=(F*ve-B*he+W*me)*We,t[7]=(B*te-R*ve-W*ee)*We,t[8]=(R*he-F*te+W*J)*We,t):null},Mi.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Mi.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Mi.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Mi.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},Mi.subtract=_a,Mi.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},Mi.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t},Mi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Mi.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=t[3],p=t[4],b=t[5],y=t[6],w=t[7],M=t[8],T=e[0],E=e[1],P=e[2],R=e[3],F=e[4],B=e[5],W=e[6],J=e[7],ee=e[8];return Math.abs(n-T)<=Wn.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(a-E)<=Wn.EPSILON*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(c-P)<=Wn.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(m-R)<=Wn.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(p-F)<=Wn.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(b-B)<=Wn.EPSILON*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(y-W)<=Wn.EPSILON*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(w-J)<=Wn.EPSILON*Math.max(1,Math.abs(w),Math.abs(J))&&Math.abs(M-ee)<=Wn.EPSILON*Math.max(1,Math.abs(M),Math.abs(ee))},Mi.sub=Mi.mul=void 0;var Wn=function(t,e){if(t&&t.__esModule)return t;if(t===null||ta(t)!=="object"&&typeof t!="function")return{default:t};var n=ga(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ht);function ga(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ga=function(a){return a?n:e})(t)}function Oo(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=n[0],P=n[1],R=n[2],F=n[3],B=n[4],W=n[5],J=n[6],ee=n[7],te=n[8];return t[0]=E*a+P*p+R*w,t[1]=E*c+P*b+R*M,t[2]=E*m+P*y+R*T,t[3]=F*a+B*p+W*w,t[4]=F*c+B*b+W*M,t[5]=F*m+B*y+W*T,t[6]=J*a+ee*p+te*w,t[7]=J*c+ee*b+te*M,t[8]=J*m+ee*y+te*T,t}function _a(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}Mi.mul=Oo,Mi.sub=_a;var Gt={};function Yl(t){return Yl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yl(t)}Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=function(){var t=new wn.ARRAY_TYPE(16);return wn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Gt.clone=function(t){var e=new wn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Gt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Gt.fromValues=function(t,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F){var B=new wn.ARRAY_TYPE(16);return B[0]=t,B[1]=e,B[2]=n,B[3]=a,B[4]=c,B[5]=m,B[6]=p,B[7]=b,B[8]=y,B[9]=w,B[10]=M,B[11]=T,B[12]=E,B[13]=P,B[14]=R,B[15]=F,B},Gt.set=function(t,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=m,t[5]=p,t[6]=b,t[7]=y,t[8]=w,t[9]=M,t[10]=T,t[11]=E,t[12]=P,t[13]=R,t[14]=F,t[15]=B,t},Gt.identity=Kh,Gt.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],c=e[3],m=e[6],p=e[7],b=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=m,t[11]=e[14],t[12]=c,t[13]=p,t[14]=b}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Gt.invert=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=e[9],E=e[10],P=e[11],R=e[12],F=e[13],B=e[14],W=e[15],J=n*b-a*p,ee=n*y-c*p,te=n*w-m*p,me=a*y-c*b,he=a*w-m*b,ve=c*w-m*y,Ce=M*F-T*R,De=M*B-E*R,Ue=M*W-P*R,ze=T*B-E*F,$e=T*W-P*F,rt=E*W-P*B,We=J*rt-ee*$e+te*ze+me*Ue-he*De+ve*Ce;return We?(t[0]=(b*rt-y*$e+w*ze)*(We=1/We),t[1]=(c*$e-a*rt-m*ze)*We,t[2]=(F*ve-B*he+W*me)*We,t[3]=(E*he-T*ve-P*me)*We,t[4]=(y*Ue-p*rt-w*De)*We,t[5]=(n*rt-c*Ue+m*De)*We,t[6]=(B*te-R*ve-W*ee)*We,t[7]=(M*ve-E*te+P*ee)*We,t[8]=(p*$e-b*Ue+w*Ce)*We,t[9]=(a*Ue-n*$e-m*Ce)*We,t[10]=(R*he-F*te+W*J)*We,t[11]=(T*te-M*he-P*J)*We,t[12]=(b*De-p*ze-y*Ce)*We,t[13]=(n*ze-a*De+c*Ce)*We,t[14]=(F*ee-R*me-B*J)*We,t[15]=(M*me-T*ee+E*J)*We,t):null},Gt.adjoint=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=e[9],E=e[10],P=e[11],R=e[12],F=e[13],B=e[14],W=e[15];return t[0]=b*(E*W-P*B)-T*(y*W-w*B)+F*(y*P-w*E),t[1]=-(a*(E*W-P*B)-T*(c*W-m*B)+F*(c*P-m*E)),t[2]=a*(y*W-w*B)-b*(c*W-m*B)+F*(c*w-m*y),t[3]=-(a*(y*P-w*E)-b*(c*P-m*E)+T*(c*w-m*y)),t[4]=-(p*(E*W-P*B)-M*(y*W-w*B)+R*(y*P-w*E)),t[5]=n*(E*W-P*B)-M*(c*W-m*B)+R*(c*P-m*E),t[6]=-(n*(y*W-w*B)-p*(c*W-m*B)+R*(c*w-m*y)),t[7]=n*(y*P-w*E)-p*(c*P-m*E)+M*(c*w-m*y),t[8]=p*(T*W-P*F)-M*(b*W-w*F)+R*(b*P-w*T),t[9]=-(n*(T*W-P*F)-M*(a*W-m*F)+R*(a*P-m*T)),t[10]=n*(b*W-w*F)-p*(a*W-m*F)+R*(a*w-m*b),t[11]=-(n*(b*P-w*T)-p*(a*P-m*T)+M*(a*w-m*b)),t[12]=-(p*(T*B-E*F)-M*(b*B-y*F)+R*(b*E-y*T)),t[13]=n*(T*B-E*F)-M*(a*B-c*F)+R*(a*E-c*T),t[14]=-(n*(b*B-y*F)-p*(a*B-c*F)+R*(a*y-c*b)),t[15]=n*(b*E-y*T)-p*(a*E-c*T)+M*(a*y-c*b),t},Gt.determinant=function(t){var e=t[0],n=t[1],a=t[2],c=t[3],m=t[4],p=t[5],b=t[6],y=t[7],w=t[8],M=t[9],T=t[10],E=t[11],P=t[12],R=t[13],F=t[14],B=t[15];return(e*p-n*m)*(T*B-E*F)-(e*b-a*m)*(M*B-E*R)+(e*y-c*m)*(M*F-T*R)+(n*b-a*p)*(w*B-E*P)-(n*y-c*p)*(w*F-T*P)+(a*y-c*b)*(w*R-M*P)},Gt.multiply=Jh,Gt.translate=function(t,e,n){var a,c,m,p,b,y,w,M,T,E,P,R,F=n[0],B=n[1],W=n[2];return e===t?(t[12]=e[0]*F+e[4]*B+e[8]*W+e[12],t[13]=e[1]*F+e[5]*B+e[9]*W+e[13],t[14]=e[2]*F+e[6]*B+e[10]*W+e[14],t[15]=e[3]*F+e[7]*B+e[11]*W+e[15]):(c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=e[9],P=e[10],R=e[11],t[0]=a=e[0],t[1]=c,t[2]=m,t[3]=p,t[4]=b,t[5]=y,t[6]=w,t[7]=M,t[8]=T,t[9]=E,t[10]=P,t[11]=R,t[12]=a*F+b*B+T*W+e[12],t[13]=c*F+y*B+E*W+e[13],t[14]=m*F+w*B+P*W+e[14],t[15]=p*F+M*B+R*W+e[15]),t},Gt.scale=function(t,e,n){var a=n[0],c=n[1],m=n[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*m,t[9]=e[9]*m,t[10]=e[10]*m,t[11]=e[11]*m,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Gt.rotate=function(t,e,n,a){var c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,me,he,ve,Ce,De,Ue,ze,$e=a[0],rt=a[1],We=a[2],et=Math.hypot($e,rt,We);return et<wn.EPSILON?null:($e*=et=1/et,rt*=et,We*=et,c=Math.sin(n),m=Math.cos(n),y=e[1],w=e[2],M=e[3],E=e[5],P=e[6],R=e[7],B=e[9],W=e[10],J=e[11],ee=$e*$e*(p=1-m)+m,he=$e*rt*p-We*c,ve=rt*rt*p+m,Ce=We*rt*p+$e*c,De=$e*We*p+rt*c,Ue=rt*We*p-$e*c,ze=We*We*p+m,t[0]=(b=e[0])*ee+(T=e[4])*(te=rt*$e*p+We*c)+(F=e[8])*(me=We*$e*p-rt*c),t[1]=y*ee+E*te+B*me,t[2]=w*ee+P*te+W*me,t[3]=M*ee+R*te+J*me,t[4]=b*he+T*ve+F*Ce,t[5]=y*he+E*ve+B*Ce,t[6]=w*he+P*ve+W*Ce,t[7]=M*he+R*ve+J*Ce,t[8]=b*De+T*Ue+F*ze,t[9]=y*De+E*Ue+B*ze,t[10]=w*De+P*Ue+W*ze,t[11]=M*De+R*Ue+J*ze,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Gt.rotateX=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),m=e[4],p=e[5],b=e[6],y=e[7],w=e[8],M=e[9],T=e[10],E=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=m*c+w*a,t[5]=p*c+M*a,t[6]=b*c+T*a,t[7]=y*c+E*a,t[8]=w*c-m*a,t[9]=M*c-p*a,t[10]=T*c-b*a,t[11]=E*c-y*a,t},Gt.rotateY=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),m=e[0],p=e[1],b=e[2],y=e[3],w=e[8],M=e[9],T=e[10],E=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=m*c-w*a,t[1]=p*c-M*a,t[2]=b*c-T*a,t[3]=y*c-E*a,t[8]=m*a+w*c,t[9]=p*a+M*c,t[10]=b*a+T*c,t[11]=y*a+E*c,t},Gt.rotateZ=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),m=e[0],p=e[1],b=e[2],y=e[3],w=e[4],M=e[5],T=e[6],E=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=m*c+w*a,t[1]=p*c+M*a,t[2]=b*c+T*a,t[3]=y*c+E*a,t[4]=w*c-m*a,t[5]=M*c-p*a,t[6]=T*c-b*a,t[7]=E*c-y*a,t},Gt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Gt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.fromRotation=function(t,e,n){var a,c,m,p=n[0],b=n[1],y=n[2],w=Math.hypot(p,b,y);return w<wn.EPSILON?null:(p*=w=1/w,b*=w,y*=w,a=Math.sin(e),c=Math.cos(e),t[0]=p*p*(m=1-c)+c,t[1]=b*p*m+y*a,t[2]=y*p*m-b*a,t[3]=0,t[4]=p*b*m-y*a,t[5]=b*b*m+c,t[6]=y*b*m+p*a,t[7]=0,t[8]=p*y*m+b*a,t[9]=b*y*m-p*a,t[10]=y*y*m+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Gt.fromXRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.fromYRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.fromZRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.fromRotationTranslation=Md,Gt.fromQuat2=function(t,e){var n=new wn.ARRAY_TYPE(3),a=-e[0],c=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=a*a+c*c+m*m+p*p;return T>0?(n[0]=2*(b*p+M*a+y*m-w*c)/T,n[1]=2*(y*p+M*c+w*a-b*m)/T,n[2]=2*(w*p+M*m+b*c-y*a)/T):(n[0]=2*(b*p+M*a+y*m-w*c),n[1]=2*(y*p+M*c+w*a-b*m),n[2]=2*(w*p+M*m+b*c-y*a)),Md(t,e,n),t},Gt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Gt.getScaling=Zl,Gt.getRotation=function(t,e){var n=new wn.ARRAY_TYPE(3);Zl(n,e);var a=1/n[0],c=1/n[1],m=1/n[2],p=e[0]*a,b=e[1]*c,y=e[2]*m,w=e[4]*a,M=e[5]*c,T=e[6]*m,E=e[8]*a,P=e[9]*c,R=e[10]*m,F=p+M+R,B=0;return F>0?(B=2*Math.sqrt(F+1),t[3]=.25*B,t[0]=(T-P)/B,t[1]=(E-y)/B,t[2]=(b-w)/B):p>M&&p>R?(B=2*Math.sqrt(1+p-M-R),t[3]=(T-P)/B,t[0]=.25*B,t[1]=(b+w)/B,t[2]=(E+y)/B):M>R?(B=2*Math.sqrt(1+M-p-R),t[3]=(E-y)/B,t[0]=(b+w)/B,t[1]=.25*B,t[2]=(T+P)/B):(B=2*Math.sqrt(1+R-p-M),t[3]=(b-w)/B,t[0]=(E+y)/B,t[1]=(T+P)/B,t[2]=.25*B),t},Gt.fromRotationTranslationScale=function(t,e,n,a){var c=e[0],m=e[1],p=e[2],b=e[3],y=c+c,w=m+m,M=p+p,T=c*y,E=c*w,P=c*M,R=m*w,F=m*M,B=p*M,W=b*y,J=b*w,ee=b*M,te=a[0],me=a[1],he=a[2];return t[0]=(1-(R+B))*te,t[1]=(E+ee)*te,t[2]=(P-J)*te,t[3]=0,t[4]=(E-ee)*me,t[5]=(1-(T+B))*me,t[6]=(F+W)*me,t[7]=0,t[8]=(P+J)*he,t[9]=(F-W)*he,t[10]=(1-(T+R))*he,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Gt.fromRotationTranslationScaleOrigin=function(t,e,n,a,c){var m=e[0],p=e[1],b=e[2],y=e[3],w=m+m,M=p+p,T=b+b,E=m*w,P=m*M,R=m*T,F=p*M,B=p*T,W=b*T,J=y*w,ee=y*M,te=y*T,me=a[0],he=a[1],ve=a[2],Ce=c[0],De=c[1],Ue=c[2],ze=(1-(F+W))*me,$e=(P+te)*me,rt=(R-ee)*me,We=(P-te)*he,et=(1-(E+W))*he,He=(B+J)*he,tt=(R+ee)*ve,st=(B-J)*ve,nt=(1-(E+F))*ve;return t[0]=ze,t[1]=$e,t[2]=rt,t[3]=0,t[4]=We,t[5]=et,t[6]=He,t[7]=0,t[8]=tt,t[9]=st,t[10]=nt,t[11]=0,t[12]=n[0]+Ce-(ze*Ce+We*De+tt*Ue),t[13]=n[1]+De-($e*Ce+et*De+st*Ue),t[14]=n[2]+Ue-(rt*Ce+He*De+nt*Ue),t[15]=1,t},Gt.fromQuat=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n+n,b=a+a,y=c+c,w=n*p,M=a*p,T=a*b,E=c*p,P=c*b,R=c*y,F=m*p,B=m*b,W=m*y;return t[0]=1-T-R,t[1]=M+W,t[2]=E-B,t[3]=0,t[4]=M-W,t[5]=1-w-R,t[6]=P+F,t[7]=0,t[8]=E+B,t[9]=P-F,t[10]=1-w-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.frustum=function(t,e,n,a,c,m,p){var b=1/(n-e),y=1/(c-a),w=1/(m-p);return t[0]=2*m*b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*m*y,t[6]=0,t[7]=0,t[8]=(n+e)*b,t[9]=(c+a)*y,t[10]=(p+m)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*m*2*w,t[15]=0,t},Gt.perspectiveNO=ia,Gt.perspectiveZO=function(t,e,n,a,c){var m,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=c*(m=1/(a-c)),t[14]=c*a*m):(t[10]=-1,t[14]=-a),t},Gt.perspectiveFromFieldOfView=function(t,e,n,a){var c=Math.tan(e.upDegrees*Math.PI/180),m=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),b=Math.tan(e.rightDegrees*Math.PI/180),y=2/(p+b),w=2/(c+m);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=w,t[6]=0,t[7]=0,t[8]=-(p-b)*y*.5,t[9]=(c-m)*w*.5,t[10]=a/(n-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n/(n-a),t[15]=0,t},Gt.orthoNO=na,Gt.orthoZO=function(t,e,n,a,c,m,p){var b=1/(e-n),y=1/(a-c),w=1/(m-p);return t[0]=-2*b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=w,t[11]=0,t[12]=(e+n)*b,t[13]=(c+a)*y,t[14]=m*w,t[15]=1,t},Gt.lookAt=function(t,e,n,a){var c,m,p,b,y,w,M,T,E,P,R=e[0],F=e[1],B=e[2],W=a[0],J=a[1],ee=a[2],te=n[0],me=n[1],he=n[2];return Math.abs(R-te)<wn.EPSILON&&Math.abs(F-me)<wn.EPSILON&&Math.abs(B-he)<wn.EPSILON?Kh(t):(M=R-te,T=F-me,E=B-he,c=J*(E*=P=1/Math.hypot(M,T,E))-ee*(T*=P),m=ee*(M*=P)-W*E,p=W*T-J*M,(P=Math.hypot(c,m,p))?(c*=P=1/P,m*=P,p*=P):(c=0,m=0,p=0),b=T*p-E*m,y=E*c-M*p,w=M*m-T*c,(P=Math.hypot(b,y,w))?(b*=P=1/P,y*=P,w*=P):(b=0,y=0,w=0),t[0]=c,t[1]=b,t[2]=M,t[3]=0,t[4]=m,t[5]=y,t[6]=T,t[7]=0,t[8]=p,t[9]=w,t[10]=E,t[11]=0,t[12]=-(c*R+m*F+p*B),t[13]=-(b*R+y*F+w*B),t[14]=-(M*R+T*F+E*B),t[15]=1,t)},Gt.targetTo=function(t,e,n,a){var c=e[0],m=e[1],p=e[2],b=a[0],y=a[1],w=a[2],M=c-n[0],T=m-n[1],E=p-n[2],P=M*M+T*T+E*E;P>0&&(M*=P=1/Math.sqrt(P),T*=P,E*=P);var R=y*E-w*T,F=w*M-b*E,B=b*T-y*M;return(P=R*R+F*F+B*B)>0&&(R*=P=1/Math.sqrt(P),F*=P,B*=P),t[0]=R,t[1]=F,t[2]=B,t[3]=0,t[4]=T*B-E*F,t[5]=E*R-M*B,t[6]=M*F-T*R,t[7]=0,t[8]=M,t[9]=T,t[10]=E,t[11]=0,t[12]=c,t[13]=m,t[14]=p,t[15]=1,t},Gt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Gt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Gt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Gt.subtract=kd,Gt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Gt.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t[9]=e[9]+n[9]*a,t[10]=e[10]+n[10]*a,t[11]=e[11]+n[11]*a,t[12]=e[12]+n[12]*a,t[13]=e[13]+n[13]*a,t[14]=e[14]+n[14]*a,t[15]=e[15]+n[15]*a,t},Gt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Gt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=t[3],p=t[4],b=t[5],y=t[6],w=t[7],M=t[8],T=t[9],E=t[10],P=t[11],R=t[12],F=t[13],B=t[14],W=t[15],J=e[0],ee=e[1],te=e[2],me=e[3],he=e[4],ve=e[5],Ce=e[6],De=e[7],Ue=e[8],ze=e[9],$e=e[10],rt=e[11],We=e[12],et=e[13],He=e[14],tt=e[15];return Math.abs(n-J)<=wn.EPSILON*Math.max(1,Math.abs(n),Math.abs(J))&&Math.abs(a-ee)<=wn.EPSILON*Math.max(1,Math.abs(a),Math.abs(ee))&&Math.abs(c-te)<=wn.EPSILON*Math.max(1,Math.abs(c),Math.abs(te))&&Math.abs(m-me)<=wn.EPSILON*Math.max(1,Math.abs(m),Math.abs(me))&&Math.abs(p-he)<=wn.EPSILON*Math.max(1,Math.abs(p),Math.abs(he))&&Math.abs(b-ve)<=wn.EPSILON*Math.max(1,Math.abs(b),Math.abs(ve))&&Math.abs(y-Ce)<=wn.EPSILON*Math.max(1,Math.abs(y),Math.abs(Ce))&&Math.abs(w-De)<=wn.EPSILON*Math.max(1,Math.abs(w),Math.abs(De))&&Math.abs(M-Ue)<=wn.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ue))&&Math.abs(T-ze)<=wn.EPSILON*Math.max(1,Math.abs(T),Math.abs(ze))&&Math.abs(E-$e)<=wn.EPSILON*Math.max(1,Math.abs(E),Math.abs($e))&&Math.abs(P-rt)<=wn.EPSILON*Math.max(1,Math.abs(P),Math.abs(rt))&&Math.abs(R-We)<=wn.EPSILON*Math.max(1,Math.abs(R),Math.abs(We))&&Math.abs(F-et)<=wn.EPSILON*Math.max(1,Math.abs(F),Math.abs(et))&&Math.abs(B-He)<=wn.EPSILON*Math.max(1,Math.abs(B),Math.abs(He))&&Math.abs(W-tt)<=wn.EPSILON*Math.max(1,Math.abs(W),Math.abs(tt))},Gt.sub=Gt.mul=Gt.ortho=Gt.perspective=void 0;var wn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Yl(t)!=="object"&&typeof t!="function")return{default:t};var n=Qh(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ht);function Qh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Qh=function(a){return a?n:e})(t)}function Kh(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Jh(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=e[9],P=e[10],R=e[11],F=e[12],B=e[13],W=e[14],J=e[15],ee=n[0],te=n[1],me=n[2],he=n[3];return t[0]=ee*a+te*b+me*T+he*F,t[1]=ee*c+te*y+me*E+he*B,t[2]=ee*m+te*w+me*P+he*W,t[3]=ee*p+te*M+me*R+he*J,t[4]=(ee=n[4])*a+(te=n[5])*b+(me=n[6])*T+(he=n[7])*F,t[5]=ee*c+te*y+me*E+he*B,t[6]=ee*m+te*w+me*P+he*W,t[7]=ee*p+te*M+me*R+he*J,t[8]=(ee=n[8])*a+(te=n[9])*b+(me=n[10])*T+(he=n[11])*F,t[9]=ee*c+te*y+me*E+he*B,t[10]=ee*m+te*w+me*P+he*W,t[11]=ee*p+te*M+me*R+he*J,t[12]=(ee=n[12])*a+(te=n[13])*b+(me=n[14])*T+(he=n[15])*F,t[13]=ee*c+te*y+me*E+he*B,t[14]=ee*m+te*w+me*P+he*W,t[15]=ee*p+te*M+me*R+he*J,t}function Md(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=a+a,y=c+c,w=m+m,M=a*b,T=a*y,E=a*w,P=c*y,R=c*w,F=m*w,B=p*b,W=p*y,J=p*w;return t[0]=1-(P+F),t[1]=T+J,t[2]=E-W,t[3]=0,t[4]=T-J,t[5]=1-(M+F),t[6]=R+B,t[7]=0,t[8]=E+W,t[9]=R-B,t[10]=1-(M+P),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Zl(t,e){var n=e[4],a=e[5],c=e[6],m=e[8],p=e[9],b=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,a,c),t[2]=Math.hypot(m,p,b),t}function ia(t,e,n,a,c){var m,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+a)*(m=1/(a-c)),t[14]=2*c*a*m):(t[10]=-1,t[14]=-2*a),t}function na(t,e,n,a,c,m,p){var b=1/(e-n),y=1/(a-c),w=1/(m-p);return t[0]=-2*b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*b,t[13]=(c+a)*y,t[14]=(p+m)*w,t[15]=1,t}function kd(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Gt.perspective=ia,Gt.ortho=na,Gt.mul=Jh,Gt.sub=kd;var Xt={},Kt={};function Xl(t){return Xl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xl(t)}Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.create=Ql,Kt.clone=function(t){var e=new uo.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Kt.length=Kl,Kt.fromValues=function(t,e,n){var a=new uo.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=n,a},Kt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Kt.set=function(t,e,n,a){return t[0]=e,t[1]=n,t[2]=a,t},Kt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Kt.subtract=Td,Kt.multiply=vs,Kt.divide=tl,Kt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Kt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Kt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Kt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Kt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Kt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Kt.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t},Kt.distance=Jl,Kt.squaredDistance=Id,Kt.squaredLength=ec,Kt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Kt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Kt.normalize=function(t,e){var n=e[0],a=e[1],c=e[2],m=n*n+a*a+c*c;return m>0&&(m=1/Math.sqrt(m)),t[0]=e[0]*m,t[1]=e[1]*m,t[2]=e[2]*m,t},Kt.dot=tc,Kt.cross=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=n[0],b=n[1],y=n[2];return t[0]=c*y-m*b,t[1]=m*p-a*y,t[2]=a*b-c*p,t},Kt.lerp=function(t,e,n,a){var c=e[0],m=e[1],p=e[2];return t[0]=c+a*(n[0]-c),t[1]=m+a*(n[1]-m),t[2]=p+a*(n[2]-p),t},Kt.hermite=function(t,e,n,a,c,m){var p=m*m,b=p*(2*m-3)+1,y=p*(m-2)+m,w=p*(m-1),M=p*(3-2*m);return t[0]=e[0]*b+n[0]*y+a[0]*w+c[0]*M,t[1]=e[1]*b+n[1]*y+a[1]*w+c[1]*M,t[2]=e[2]*b+n[2]*y+a[2]*w+c[2]*M,t},Kt.bezier=function(t,e,n,a,c,m){var p=1-m,b=p*p,y=m*m,w=b*p,M=3*m*b,T=3*y*p,E=y*m;return t[0]=e[0]*w+n[0]*M+a[0]*T+c[0]*E,t[1]=e[1]*w+n[1]*M+a[1]*T+c[1]*E,t[2]=e[2]*w+n[2]*M+a[2]*T+c[2]*E,t},Kt.random=function(t,e){e=e||1;var n=2*uo.RANDOM()*Math.PI,a=2*uo.RANDOM()-1,c=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(n)*c,t[1]=Math.sin(n)*c,t[2]=a*e,t},Kt.transformMat4=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=n[3]*a+n[7]*c+n[11]*m+n[15];return t[0]=(n[0]*a+n[4]*c+n[8]*m+n[12])/(p=p||1),t[1]=(n[1]*a+n[5]*c+n[9]*m+n[13])/p,t[2]=(n[2]*a+n[6]*c+n[10]*m+n[14])/p,t},Kt.transformMat3=function(t,e,n){var a=e[0],c=e[1],m=e[2];return t[0]=a*n[0]+c*n[3]+m*n[6],t[1]=a*n[1]+c*n[4]+m*n[7],t[2]=a*n[2]+c*n[5]+m*n[8],t},Kt.transformQuat=function(t,e,n){var a=n[0],c=n[1],m=n[2],p=e[0],b=e[1],y=e[2],w=c*y-m*b,M=m*p-a*y,T=a*b-c*p,E=c*T-m*M,P=m*w-a*T,R=a*M-c*w,F=2*n[3];return M*=F,T*=F,P*=2,R*=2,t[0]=p+(w*=F)+(E*=2),t[1]=b+M+P,t[2]=y+T+R,t},Kt.rotateX=function(t,e,n,a){var c=[],m=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],m[0]=c[0],m[1]=c[1]*Math.cos(a)-c[2]*Math.sin(a),m[2]=c[1]*Math.sin(a)+c[2]*Math.cos(a),t[0]=m[0]+n[0],t[1]=m[1]+n[1],t[2]=m[2]+n[2],t},Kt.rotateY=function(t,e,n,a){var c=[],m=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],m[0]=c[2]*Math.sin(a)+c[0]*Math.cos(a),m[1]=c[1],m[2]=c[2]*Math.cos(a)-c[0]*Math.sin(a),t[0]=m[0]+n[0],t[1]=m[1]+n[1],t[2]=m[2]+n[2],t},Kt.rotateZ=function(t,e,n,a){var c=[],m=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],m[0]=c[0]*Math.cos(a)-c[1]*Math.sin(a),m[1]=c[0]*Math.sin(a)+c[1]*Math.cos(a),m[2]=c[2],t[0]=m[0]+n[0],t[1]=m[1]+n[1],t[2]=m[2]+n[2],t},Kt.angle=function(t,e){var n=t[0],a=t[1],c=t[2],m=e[0],p=e[1],b=e[2],y=Math.sqrt(n*n+a*a+c*c)*Math.sqrt(m*m+p*p+b*b),w=y&&tc(t,e)/y;return Math.acos(Math.min(Math.max(w,-1),1))},Kt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Kt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Kt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Kt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=e[0],p=e[1],b=e[2];return Math.abs(n-m)<=uo.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-p)<=uo.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(c-b)<=uo.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))},Kt.forEach=Kt.sqrLen=Kt.len=Kt.sqrDist=Kt.dist=Kt.div=Kt.mul=Kt.sub=void 0;var uo=function(t,e){if(t&&t.__esModule)return t;if(t===null||Xl(t)!=="object"&&typeof t!="function")return{default:t};var n=el(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ht);function el(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(el=function(a){return a?n:e})(t)}function Ql(){var t=new uo.ARRAY_TYPE(3);return uo.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Kl(t){return Math.hypot(t[0],t[1],t[2])}function Td(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function vs(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function tl(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Jl(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Id(t,e){var n=e[0]-t[0],a=e[1]-t[1],c=e[2]-t[2];return n*n+a*a+c*c}function ec(t){var e=t[0],n=t[1],a=t[2];return e*e+n*n+a*a}function tc(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Kt.sub=Td,Kt.mul=vs,Kt.div=tl,Kt.dist=Jl,Kt.sqrDist=Id,Kt.len=Kl,Kt.sqrLen=ec;var Ro,eu=(Ro=Ql(),function(t,e,n,a,c,m){var p,b;for(e||(e=3),n||(n=0),b=a?Math.min(a*e+n,t.length):t.length,p=n;p<b;p+=e)Ro[0]=t[p],Ro[1]=t[p+1],Ro[2]=t[p+2],c(Ro,Ro,m),t[p]=Ro[0],t[p+1]=Ro[1],t[p+2]=Ro[2];return t});Kt.forEach=eu;var Jt={};function Ed(t){return Ed=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ed(t)}Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.create=il,Jt.clone=function(t){var e=new Bn.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Jt.fromValues=function(t,e,n,a){var c=new Bn.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=a,c},Jt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Jt.set=function(t,e,n,a,c){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t},Jt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Jt.subtract=ba,Jt.multiply=ya,Jt.divide=Dd,Jt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Jt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Jt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Jt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Jt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Jt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Jt.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},Jt.distance=xs,Jt.squaredDistance=ws,Jt.length=nc,Jt.squaredLength=rc,Jt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Jt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Jt.normalize=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n*n+a*a+c*c+m*m;return p>0&&(p=1/Math.sqrt(p)),t[0]=n*p,t[1]=a*p,t[2]=c*p,t[3]=m*p,t},Jt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Jt.cross=function(t,e,n,a){var c=n[0]*a[1]-n[1]*a[0],m=n[0]*a[2]-n[2]*a[0],p=n[0]*a[3]-n[3]*a[0],b=n[1]*a[2]-n[2]*a[1],y=n[1]*a[3]-n[3]*a[1],w=n[2]*a[3]-n[3]*a[2],M=e[0],T=e[1],E=e[2],P=e[3];return t[0]=T*w-E*y+P*b,t[1]=-M*w+E*p-P*m,t[2]=M*y-T*p+P*c,t[3]=-M*b+T*m-E*c,t},Jt.lerp=function(t,e,n,a){var c=e[0],m=e[1],p=e[2],b=e[3];return t[0]=c+a*(n[0]-c),t[1]=m+a*(n[1]-m),t[2]=p+a*(n[2]-p),t[3]=b+a*(n[3]-b),t},Jt.random=function(t,e){var n,a,c,m,p,b;e=e||1;do p=(n=2*Bn.RANDOM()-1)*n+(a=2*Bn.RANDOM()-1)*a;while(p>=1);do b=(c=2*Bn.RANDOM()-1)*c+(m=2*Bn.RANDOM()-1)*m;while(b>=1);var y=Math.sqrt((1-p)/b);return t[0]=e*n,t[1]=e*a,t[2]=e*c*y,t[3]=e*m*y,t},Jt.transformMat4=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3];return t[0]=n[0]*a+n[4]*c+n[8]*m+n[12]*p,t[1]=n[1]*a+n[5]*c+n[9]*m+n[13]*p,t[2]=n[2]*a+n[6]*c+n[10]*m+n[14]*p,t[3]=n[3]*a+n[7]*c+n[11]*m+n[15]*p,t},Jt.transformQuat=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=n[0],b=n[1],y=n[2],w=n[3],M=w*a+b*m-y*c,T=w*c+y*a-p*m,E=w*m+p*c-b*a,P=-p*a-b*c-y*m;return t[0]=M*w+P*-p+T*-y-E*-b,t[1]=T*w+P*-b+E*-p-M*-y,t[2]=E*w+P*-y+M*-b-T*-p,t[3]=e[3],t},Jt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Jt.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Jt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Jt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=t[3],p=e[0],b=e[1],y=e[2],w=e[3];return Math.abs(n-p)<=Bn.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-b)<=Bn.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(c-y)<=Bn.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(m-w)<=Bn.EPSILON*Math.max(1,Math.abs(m),Math.abs(w))},Jt.forEach=Jt.sqrLen=Jt.len=Jt.sqrDist=Jt.dist=Jt.div=Jt.mul=Jt.sub=void 0;var Bn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ed(t)!=="object"&&typeof t!="function")return{default:t};var n=ic(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ht);function ic(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ic=function(a){return a?n:e})(t)}function il(){var t=new Bn.ARRAY_TYPE(4);return Bn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function ba(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function ya(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Dd(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function xs(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function ws(t,e){var n=e[0]-t[0],a=e[1]-t[1],c=e[2]-t[2],m=e[3]-t[3];return n*n+a*a+c*c+m*m}function nc(t){return Math.hypot(t[0],t[1],t[2],t[3])}function rc(t){var e=t[0],n=t[1],a=t[2],c=t[3];return e*e+n*n+a*a+c*c}Jt.sub=ba,Jt.mul=ya,Jt.div=Dd,Jt.dist=xs,Jt.sqrDist=ws,Jt.len=nc,Jt.sqrLen=rc;var tu=function(){var t=il();return function(e,n,a,c,m,p){var b,y;for(n||(n=4),a||(a=0),y=c?Math.min(c*n+a,e.length):e.length,b=a;b<y;b+=n)t[0]=e[b],t[1]=e[b+1],t[2]=e[b+2],t[3]=e[b+3],m(t,t,p),e[b]=t[0],e[b+1]=t[1],e[b+2]=t[2],e[b+3]=t[3];return e}}();function oc(t){return oc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oc(t)}Jt.forEach=tu,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.create=ac,Xt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Xt.setAxisAngle=Ad,Xt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),a=Math.sin(n/2);return a>Lo.EPSILON?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),n},Xt.getAngle=function(t,e){var n=be(t,e);return Math.acos(2*n*n-1)},Xt.multiply=sc,Xt.rotateX=function(t,e,n){n*=.5;var a=e[0],c=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return t[0]=a*y+p*b,t[1]=c*y+m*b,t[2]=m*y-c*b,t[3]=p*y-a*b,t},Xt.rotateY=function(t,e,n){n*=.5;var a=e[0],c=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return t[0]=a*y-m*b,t[1]=c*y+p*b,t[2]=m*y+a*b,t[3]=p*y-c*b,t},Xt.rotateZ=function(t,e,n){n*=.5;var a=e[0],c=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return t[0]=a*y+c*b,t[1]=c*y-a*b,t[2]=m*y+p*b,t[3]=p*y-m*b,t},Xt.calculateW=function(t,e){var n=e[0],a=e[1],c=e[2];return t[0]=n,t[1]=a,t[2]=c,t[3]=Math.sqrt(Math.abs(1-n*n-a*a-c*c)),t},Xt.exp=Se,Xt.ln=G,Xt.pow=function(t,e,n){return G(t,e),_e(t,t,n),Se(t,t),t},Xt.slerp=K,Xt.random=function(t){var e=Lo.RANDOM(),n=Lo.RANDOM(),a=Lo.RANDOM(),c=Math.sqrt(1-e),m=Math.sqrt(e);return t[0]=c*Math.sin(2*Math.PI*n),t[1]=c*Math.cos(2*Math.PI*n),t[2]=m*Math.sin(2*Math.PI*a),t[3]=m*Math.cos(2*Math.PI*a),t},Xt.invert=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n*n+a*a+c*c+m*m,b=p?1/p:0;return t[0]=-n*b,t[1]=-a*b,t[2]=-c*b,t[3]=m*b,t},Xt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Xt.fromMat3=ce,Xt.fromEuler=function(t,e,n,a){var c=.5*Math.PI/180;e*=c,n*=c,a*=c;var m=Math.sin(e),p=Math.cos(e),b=Math.sin(n),y=Math.cos(n),w=Math.sin(a),M=Math.cos(a);return t[0]=m*y*M-p*b*w,t[1]=p*b*M+m*y*w,t[2]=p*y*w-m*b*M,t[3]=p*y*M+m*b*w,t},Xt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Xt.setAxes=Xt.sqlerp=Xt.rotationTo=Xt.equals=Xt.exactEquals=Xt.normalize=Xt.sqrLen=Xt.squaredLength=Xt.len=Xt.length=Xt.lerp=Xt.dot=Xt.scale=Xt.mul=Xt.add=Xt.set=Xt.copy=Xt.fromValues=Xt.clone=void 0;var Lo=nl(ht),Cs=nl(Mi),Fo=nl(Kt),Sr=nl(Jt);function iu(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(iu=function(a){return a?n:e})(t)}function nl(t,e){if(t&&t.__esModule)return t;if(t===null||oc(t)!=="object"&&typeof t!="function")return{default:t};var n=iu(e);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}function ac(){var t=new Lo.ARRAY_TYPE(4);return Lo.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ad(t,e,n){n*=.5;var a=Math.sin(n);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(n),t}function sc(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=n[0],y=n[1],w=n[2],M=n[3];return t[0]=a*M+p*b+c*w-m*y,t[1]=c*M+p*y+m*b-a*w,t[2]=m*M+p*w+a*y-c*b,t[3]=p*M-a*b-c*y-m*w,t}function Se(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=Math.sqrt(n*n+a*a+c*c),b=Math.exp(m),y=p>0?b*Math.sin(p)/p:0;return t[0]=n*y,t[1]=a*y,t[2]=c*y,t[3]=b*Math.cos(p),t}function G(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=Math.sqrt(n*n+a*a+c*c),b=p>0?Math.atan2(p,m)/p:0;return t[0]=n*b,t[1]=a*b,t[2]=c*b,t[3]=.5*Math.log(n*n+a*a+c*c+m*m),t}function K(t,e,n,a){var c,m,p,b,y,w=e[0],M=e[1],T=e[2],E=e[3],P=n[0],R=n[1],F=n[2],B=n[3];return(m=w*P+M*R+T*F+E*B)<0&&(m=-m,P=-P,R=-R,F=-F,B=-B),1-m>Lo.EPSILON?(c=Math.acos(m),p=Math.sin(c),b=Math.sin((1-a)*c)/p,y=Math.sin(a*c)/p):(b=1-a,y=a),t[0]=b*w+y*P,t[1]=b*M+y*R,t[2]=b*T+y*F,t[3]=b*E+y*B,t}function ce(t,e){var n,a=e[0]+e[4]+e[8];if(a>0)n=Math.sqrt(a+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var c=0;e[4]>e[0]&&(c=1),e[8]>e[3*c+c]&&(c=2);var m=(c+1)%3,p=(c+2)%3;n=Math.sqrt(e[3*c+c]-e[3*m+m]-e[3*p+p]+1),t[c]=.5*n,t[3]=(e[3*m+p]-e[3*p+m])*(n=.5/n),t[m]=(e[3*m+c]+e[3*c+m])*n,t[p]=(e[3*p+c]+e[3*c+p])*n}return t}Xt.clone=Sr.clone,Xt.fromValues=Sr.fromValues,Xt.copy=Sr.copy,Xt.set=Sr.set,Xt.add=Sr.add,Xt.mul=sc;var _e=Sr.scale;Xt.scale=_e;var be=Sr.dot;Xt.dot=be,Xt.lerp=Sr.lerp;var Ee=Sr.length;Xt.length=Ee,Xt.len=Ee;var Ne=Sr.squaredLength;Xt.squaredLength=Ne,Xt.sqrLen=Ne;var Te=Sr.normalize;Xt.normalize=Te,Xt.exactEquals=Sr.exactEquals,Xt.equals=Sr.equals;var je,mt,at,Ot=(je=Fo.create(),mt=Fo.fromValues(1,0,0),at=Fo.fromValues(0,1,0),function(t,e,n){var a=Fo.dot(e,n);return a<-.999999?(Fo.cross(je,mt,e),Fo.len(je)<1e-6&&Fo.cross(je,at,e),Fo.normalize(je,je),Ad(t,je,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Fo.cross(je,e,n),t[0]=je[0],t[1]=je[1],t[2]=je[2],t[3]=1+a,Te(t,t))});Xt.rotationTo=Ot;var $t,mi,fi=($t=ac(),mi=ac(),function(t,e,n,a,c,m){return K($t,e,c,m),K(mi,n,a,m),K(t,$t,mi,2*m*(1-m)),t});Xt.sqlerp=fi;var ii,ki=(ii=Cs.create(),function(t,e,n,a){return ii[0]=n[0],ii[3]=n[1],ii[6]=n[2],ii[1]=a[0],ii[4]=a[1],ii[7]=a[2],ii[2]=-e[0],ii[5]=-e[1],ii[8]=-e[2],Te(t,ce(t,ii))});Xt.setAxes=ki;var At={};function Cn(t){return Cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cn(t)}Object.defineProperty(At,"__esModule",{value:!0}),At.create=function(){var t=new Ki.ARRAY_TYPE(8);return Ki.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},At.clone=function(t){var e=new Ki.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},At.fromValues=function(t,e,n,a,c,m,p,b){var y=new Ki.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=n,y[3]=a,y[4]=c,y[5]=m,y[6]=p,y[7]=b,y},At.fromRotationTranslationValues=function(t,e,n,a,c,m,p){var b=new Ki.ARRAY_TYPE(8);b[0]=t,b[1]=e,b[2]=n,b[3]=a;var y=.5*c,w=.5*m,M=.5*p;return b[4]=y*a+w*n-M*e,b[5]=w*a+M*t-y*n,b[6]=M*a+y*e-w*t,b[7]=-y*t-w*e-M*n,b},At.fromRotationTranslation=Fr,At.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},At.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},At.fromMat4=function(t,e){var n=Di.create();Gn.getRotation(n,e);var a=new Ki.ARRAY_TYPE(3);return Gn.getTranslation(a,e),Fr(t,n,a),t},At.copy=zr,At.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},At.set=function(t,e,n,a,c,m,p,b,y){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=m,t[5]=p,t[6]=b,t[7]=y,t},At.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},At.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},At.getTranslation=function(t,e){var n=e[4],a=e[5],c=e[6],m=e[7],p=-e[0],b=-e[1],y=-e[2],w=e[3];return t[0]=2*(n*w+m*p+a*y-c*b),t[1]=2*(a*w+m*b+c*p-n*y),t[2]=2*(c*w+m*y+n*b-a*p),t},At.translate=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=.5*n[0],y=.5*n[1],w=.5*n[2],M=e[4],T=e[5],E=e[6],P=e[7];return t[0]=a,t[1]=c,t[2]=m,t[3]=p,t[4]=p*b+c*w-m*y+M,t[5]=p*y+m*b-a*w+T,t[6]=p*w+a*y-c*b+E,t[7]=-a*b-c*y-m*w+P,t},At.rotateX=function(t,e,n){var a=-e[0],c=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=b*p+M*a+y*m-w*c,E=y*p+M*c+w*a-b*m,P=w*p+M*m+b*c-y*a,R=M*p-b*a-y*c-w*m;return Di.rotateX(t,e,n),t[4]=T*(p=t[3])+R*(a=t[0])+E*(m=t[2])-P*(c=t[1]),t[5]=E*p+R*c+P*a-T*m,t[6]=P*p+R*m+T*c-E*a,t[7]=R*p-T*a-E*c-P*m,t},At.rotateY=function(t,e,n){var a=-e[0],c=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=b*p+M*a+y*m-w*c,E=y*p+M*c+w*a-b*m,P=w*p+M*m+b*c-y*a,R=M*p-b*a-y*c-w*m;return Di.rotateY(t,e,n),t[4]=T*(p=t[3])+R*(a=t[0])+E*(m=t[2])-P*(c=t[1]),t[5]=E*p+R*c+P*a-T*m,t[6]=P*p+R*m+T*c-E*a,t[7]=R*p-T*a-E*c-P*m,t},At.rotateZ=function(t,e,n){var a=-e[0],c=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=b*p+M*a+y*m-w*c,E=y*p+M*c+w*a-b*m,P=w*p+M*m+b*c-y*a,R=M*p-b*a-y*c-w*m;return Di.rotateZ(t,e,n),t[4]=T*(p=t[3])+R*(a=t[0])+E*(m=t[2])-P*(c=t[1]),t[5]=E*p+R*c+P*a-T*m,t[6]=P*p+R*m+T*c-E*a,t[7]=R*p-T*a-E*c-P*m,t},At.rotateByQuatAppend=function(t,e,n){var a=n[0],c=n[1],m=n[2],p=n[3],b=e[0],y=e[1],w=e[2],M=e[3];return t[0]=b*p+M*a+y*m-w*c,t[1]=y*p+M*c+w*a-b*m,t[2]=w*p+M*m+b*c-y*a,t[3]=M*p-b*a-y*c-w*m,t[4]=(b=e[4])*p+(M=e[7])*a+(y=e[5])*m-(w=e[6])*c,t[5]=y*p+M*c+w*a-b*m,t[6]=w*p+M*m+b*c-y*a,t[7]=M*p-b*a-y*c-w*m,t},At.rotateByQuatPrepend=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=n[0],y=n[1],w=n[2],M=n[3];return t[0]=a*M+p*b+c*w-m*y,t[1]=c*M+p*y+m*b-a*w,t[2]=m*M+p*w+a*y-c*b,t[3]=p*M-a*b-c*y-m*w,t[4]=a*(M=n[7])+p*(b=n[4])+c*(w=n[6])-m*(y=n[5]),t[5]=c*M+p*y+m*b-a*w,t[6]=m*M+p*w+a*y-c*b,t[7]=p*M-a*b-c*y-m*w,t},At.rotateAroundAxis=function(t,e,n,a){if(Math.abs(a)<Ki.EPSILON)return zr(t,e);var c=Math.hypot(n[0],n[1],n[2]);a*=.5;var m=Math.sin(a),p=m*n[0]/c,b=m*n[1]/c,y=m*n[2]/c,w=Math.cos(a),M=e[0],T=e[1],E=e[2],P=e[3];t[0]=M*w+P*p+T*y-E*b,t[1]=T*w+P*b+E*p-M*y,t[2]=E*w+P*y+M*b-T*p,t[3]=P*w-M*p-T*b-E*y;var R=e[4],F=e[5],B=e[6],W=e[7];return t[4]=R*w+W*p+F*y-B*b,t[5]=F*w+W*b+B*p-R*y,t[6]=B*w+W*y+R*b-F*p,t[7]=W*w-R*p-F*b-B*y,t},At.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},At.multiply=rl,At.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},At.lerp=function(t,e,n,a){var c=1-a;return tp(e,n)<0&&(a=-a),t[0]=e[0]*c+n[0]*a,t[1]=e[1]*c+n[1]*a,t[2]=e[2]*c+n[2]*a,t[3]=e[3]*c+n[3]*a,t[4]=e[4]*c+n[4]*a,t[5]=e[5]*c+n[5]*a,t[6]=e[6]*c+n[6]*a,t[7]=e[7]*c+n[7]*a,t},At.invert=function(t,e){var n=Pd(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},At.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},At.normalize=function(t,e){var n=Pd(e);if(n>0){n=Math.sqrt(n);var a=e[0]/n,c=e[1]/n,m=e[2]/n,p=e[3]/n,b=e[4],y=e[5],w=e[6],M=e[7],T=a*b+c*y+m*w+p*M;t[0]=a,t[1]=c,t[2]=m,t[3]=p,t[4]=(b-a*T)/n,t[5]=(y-c*T)/n,t[6]=(w-m*T)/n,t[7]=(M-p*T)/n}return t},At.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},At.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},At.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=t[3],p=t[4],b=t[5],y=t[6],w=t[7],M=e[0],T=e[1],E=e[2],P=e[3],R=e[4],F=e[5],B=e[6],W=e[7];return Math.abs(n-M)<=Ki.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(a-T)<=Ki.EPSILON*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(c-E)<=Ki.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(m-P)<=Ki.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(p-R)<=Ki.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(b-F)<=Ki.EPSILON*Math.max(1,Math.abs(b),Math.abs(F))&&Math.abs(y-B)<=Ki.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(w-W)<=Ki.EPSILON*Math.max(1,Math.abs(w),Math.abs(W))},At.sqrLen=At.squaredLength=At.len=At.length=At.dot=At.mul=At.setReal=At.getReal=void 0;var Ki=or(ht),Di=or(Xt),Gn=or(Gt);function Sn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Sn=function(a){return a?n:e})(t)}function or(t,e){if(t&&t.__esModule)return t;if(t===null||Cn(t)!=="object"&&typeof t!="function")return{default:t};var n=Sn(e);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}function Fr(t,e,n){var a=.5*n[0],c=.5*n[1],m=.5*n[2],p=e[0],b=e[1],y=e[2],w=e[3];return t[0]=p,t[1]=b,t[2]=y,t[3]=w,t[4]=a*w+c*y-m*b,t[5]=c*w+m*p-a*y,t[6]=m*w+a*b-c*p,t[7]=-a*p-c*b-m*y,t}function zr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function rl(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=n[4],y=n[5],w=n[6],M=n[7],T=e[4],E=e[5],P=e[6],R=e[7],F=n[0],B=n[1],W=n[2],J=n[3];return t[0]=a*J+p*F+c*W-m*B,t[1]=c*J+p*B+m*F-a*W,t[2]=m*J+p*W+a*B-c*F,t[3]=p*J-a*F-c*B-m*W,t[4]=a*M+p*b+c*w-m*y+T*J+R*F+E*W-P*B,t[5]=c*M+p*y+m*b-a*w+E*J+R*B+P*F-T*W,t[6]=m*M+p*w+a*y-c*b+P*J+R*W+T*B-E*F,t[7]=p*M-a*b-c*y-m*w+R*J-T*F-E*B-P*W,t}At.getReal=Di.copy,At.setReal=Di.copy,At.mul=rl;var tp=Di.dot;At.dot=tp;var Rg=Di.length;At.length=Rg,At.len=Rg;var Pd=Di.squaredLength;At.squaredLength=Pd,At.sqrLen=Pd;var ci={};function ip(t){return ip=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ip(t)}Object.defineProperty(ci,"__esModule",{value:!0}),ci.create=rp,ci.clone=function(t){var e=new Ss.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},ci.fromValues=function(t,e){var n=new Ss.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},ci.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},ci.set=function(t,e,n){return t[0]=e,t[1]=n,t},ci.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},ci.subtract=op,ci.multiply=ap,ci.divide=sp,ci.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},ci.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},ci.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},ci.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},ci.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},ci.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},ci.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t},ci.distance=lp,ci.squaredDistance=cp,ci.length=dp,ci.squaredLength=hp,ci.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},ci.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},ci.normalize=function(t,e){var n=e[0],a=e[1],c=n*n+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t},ci.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},ci.cross=function(t,e,n){var a=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=a,t},ci.lerp=function(t,e,n,a){var c=e[0],m=e[1];return t[0]=c+a*(n[0]-c),t[1]=m+a*(n[1]-m),t},ci.random=function(t,e){e=e||1;var n=2*Ss.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},ci.transformMat2=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[2]*c,t[1]=n[1]*a+n[3]*c,t},ci.transformMat2d=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[2]*c+n[4],t[1]=n[1]*a+n[3]*c+n[5],t},ci.transformMat3=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[3]*c+n[6],t[1]=n[1]*a+n[4]*c+n[7],t},ci.transformMat4=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[4]*c+n[12],t[1]=n[1]*a+n[5]*c+n[13],t},ci.rotate=function(t,e,n,a){var c=e[0]-n[0],m=e[1]-n[1],p=Math.sin(a),b=Math.cos(a);return t[0]=c*b-m*p+n[0],t[1]=c*p+m*b+n[1],t},ci.angle=function(t,e){var n=t[0],a=t[1],c=e[0],m=e[1],p=Math.sqrt(n*n+a*a)*Math.sqrt(c*c+m*m);return Math.acos(Math.min(Math.max(p&&(n*c+a*m)/p,-1),1))},ci.zero=function(t){return t[0]=0,t[1]=0,t},ci.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},ci.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},ci.equals=function(t,e){var n=t[0],a=t[1],c=e[0],m=e[1];return Math.abs(n-c)<=Ss.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-m)<=Ss.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))},ci.forEach=ci.sqrLen=ci.sqrDist=ci.dist=ci.div=ci.mul=ci.sub=ci.len=void 0;var Ss=function(t,e){if(t&&t.__esModule)return t;if(t===null||ip(t)!=="object"&&typeof t!="function")return{default:t};var n=np(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ht);function np(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(np=function(a){return a?n:e})(t)}function rp(){var t=new Ss.ARRAY_TYPE(2);return Ss.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function op(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function ap(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function sp(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function lp(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function cp(t,e){var n=e[0]-t[0],a=e[1]-t[1];return n*n+a*a}function dp(t){return Math.hypot(t[0],t[1])}function hp(t){var e=t[0],n=t[1];return e*e+n*n}ci.len=dp,ci.sub=op,ci.mul=ap,ci.div=sp,ci.dist=lp,ci.sqrDist=cp,ci.sqrLen=hp;var Lg=function(){var t=rp();return function(e,n,a,c,m,p){var b,y;for(n||(n=2),a||(a=0),y=c?Math.min(c*n+a,e.length):e.length,b=a;b<y;b+=n)t[0]=e[b],t[1]=e[b+1],m(t,t,p),e[b]=t[0],e[b+1]=t[1];return e}}();function lc(t){return lc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lc(t)}ci.forEach=Lg,Object.defineProperty(qe,"__esModule",{value:!0}),i.aA=qe.vec4=i._=qe.vec3=qe.vec2=qe.quat2=i.av=qe.quat=i.ad=qe.mat4=i.bC=qe.mat3=qe.mat2d=i.aC=qe.mat2=qe.glMatrix=void 0;var nu=va(ht);qe.glMatrix=nu;var ru=va(xt);i.aC=qe.mat2=ru;var Fg=va(bi);qe.mat2d=Fg;var zg=va(Mi);i.bC=qe.mat3=zg;var Bg=va(Gt);i.ad=qe.mat4=Bg;var cc=va(Xt);i.av=qe.quat=cc;var wi=va(At);qe.quat2=wi;var yy=va(ci);qe.vec2=yy;var vy=va(Kt);i._=qe.vec3=vy;var xy=va(Jt);function up(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(up=function(a){return a?n:e})(t)}function va(t,e){if(t&&t.__esModule)return t;if(t===null||lc(t)!=="object"&&typeof t!="function")return{default:t};var n=up(e);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}i.aA=qe.vec4=xy;var mp=Od;function Od(t,e,n,a){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=a}Od.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,a=0;a<8;a++){var c=this.sampleCurveX(n)-t;if(Math.abs(c)<e)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var p=0,b=1;for(n=t,a=0;a<20&&(c=this.sampleCurveX(n),!(Math.abs(c-t)<e));a++)t>c?p=n:b=n,n=.5*(b-p)+p;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Rd=Xe(mp),ou=ol;function ol(t,e){this.x=t,this.y=e}ol.prototype={clone:function(){return new ol(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround:function(t,e){var n=Math.cos(t),a=Math.sin(t),c=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ol.convert=function(t){return t instanceof ol?t:Array.isArray(t)?new ol(t[0],t[1]):t};var yt=Xe(ou);let Ng=Math.PI/180,Ld=180/Math.PI;function Ti(t){return t*Ng}function Br(t){return t*Ld}let Vg=[[0,0],[1,0],[1,1],[0,1]];function pp(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Fd(t,e,n,a){let c=new Rd(t,e,n,a);return function(m){return c.solve(m)}}let dc=Fd(.25,.1,.25,1);function pi(t,e,n){return Math.min(n,Math.max(e,t))}function al(t,e,n){return(n=pi((n-t)/(e-t),0,1))*n*(3-2*n)}function sl(t,e,n){let a=n-e,c=((t-e)%a+a)%a+e;return c===e?n:c}function hc(t,e,n){if(!t.length)return n(null,[]);let a=t.length,c=new Array(t.length),m=null;t.forEach((p,b)=>{e(p,(y,w)=>{y&&(m=y),c[b]=w,--a==0&&n(m,c)})})}function zo(t){let e=[];for(let n in t)e.push(t[n]);return e}function Nr(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}let wy=1;function au(){return wy++}function su(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function fp(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function gp(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function lu(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function zd(t,e){return t.indexOf(e,t.length-e.length)!==-1}function uc(t,e,n){let a={};for(let c in t)a[c]=e.call(this,t[c],c,t);return a}function ll(t,e,n){let a={};for(let c in t)e.call(this,t[c],c,t)&&(a[c]=t[c]);return a}function xa(t){return Array.isArray(t)?t.map(xa):typeof t=="object"&&t?uc(t,xa):t}let _p={};function qn(t){_p[t]||(typeof console<"u"&&console.warn(t),_p[t]=!0)}function wa(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Hr(t){let e=0;for(let n,a,c=0,m=t.length,p=m-1;c<m;p=c++)n=t[c],a=t[p],e+=(a.x-n.x)*(n.y+a.y);return e}function Ha([t,e,n]){let a=Ti(e+90),c=Ti(n);return{x:t*Math.cos(a)*Math.sin(c),y:t*Math.sin(a)*Math.sin(c),z:t*Math.cos(c),azimuthal:e,polar:n}}function Mr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function bp(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,c,m)=>{let p=c||m;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let yp,cu,mc,Bd,Wa,Nd,du=null;function cl(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Vd(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function vp(t,e,n,a){for(;e<n;){let c=e+n>>1;t[c]<a?e=c+1:n=c}return e}function jg(t,e,n,a){for(;e<n;){let c=e+n>>1;t[c]<=a?e=c+1:n=c}return e}function hu(t){return t>0?1/(1.001-t):1+t}function uu(t){return t>0?1-1/(1.001-t):-t}function pc(){return yp==null&&(yp=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),yp}let kr={now:()=>Bd!==void 0?Bd:performance.now(),setNow(t){Bd=t},restoreNow(){Bd=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:a}=t;Wa||(Wa=document.createElement("canvas"));let c=Wa.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(n>Wa.width||a>Wa.height)&&(Wa.width=n,Wa.height=a),c.clearRect(-e,-e,n+2*e,a+2*e),c.drawImage(t,0,0,n,a),c.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:t=>(cu||(cu=document.createElement("a")),cu.href=t,cu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(mc==null&&(mc=window.matchMedia("(prefers-reduced-motion: reduce)")),mc.matches)},hasCanvasFingerprintNoise(){if(Nd!==void 0)return Nd;if(!pc())return Nd=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let c=0;c<t.width;++c)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(c,0,1,1);let a=e.getImageData(0,0,t.width,t.height);n=0;for(let c=0;c<a.data.length;++c)if(c%4!=3&&n++!==a.data[c])return Nd=!0,!0;return Nd=!1,!1}};function mu(t,e){let n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;let a=new URLSearchParams(t.slice(n));for(let c in e)a.set(c,e[c]);return`${t.slice(0,n)}?${a.toString()}`}function xp(t,e={persistentParams:[]}){let n=t.indexOf("?");if(n<0)return t;let a=new URLSearchParams,c=new URLSearchParams(t.slice(n));for(let p of e.persistentParams){let b=c.get(p);b&&a.set(p,b)}let m=a.toString();return`${t.slice(0,n)}${m.length>0?`?${m}`:""}`}let Ug="mapbox-tiles",wp=500,Cp=50,Ga,pu;function Hg(){try{return caches}catch{}}function jd(){let t=Hg();t&&!Ga&&(Ga=t.open(Ug))}let fu=1/0,gu={supported:!1,testSupport:function(t){!Sp&&gc&&(Mp?Wg(t):fc=t)}},fc,gc,Sp=!1,Mp=!1,kp=typeof self<"u"?self:{};function Wg(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,gc),t.isContextLost())return;gu.supported=!0}catch{}t.deleteTexture(e),Sp=!0}kp.document&&(gc=kp.document.createElement("img"),gc.onload=function(){fc&&Wg(fc),fc=null,Mp=!0},gc.onerror=function(){Sp=!0,fc=null},gc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let _u={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(_u);class Tp extends Error{constructor(e,n,a){n===401&&O(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let bu=Mr()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ud=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(bu())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,c){let m=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:bu(),referrerPolicy:a.referrerPolicy,signal:m.signal}),b=!1,y=!1,w=(M=p.url).indexOf("sku=")>0&&O(M);var M;a.type==="json"&&p.headers.set("Accept","application/json");let T=(P,R,F)=>{if(y)return;if(P&&P.message!=="SecurityError"&&qn(P.toString()),R&&F)return E(R);let B=Date.now();fetch(p).then(W=>{if(W.ok){let J=w?W.clone():null;return E(W,J,B)}return c(new Tp(W.statusText,W.status,a.url))}).catch(W=>{W.name!=="AbortError"&&c(new Error(`${W.message} ${a.url}`))})},E=(P,R,F)=>{(a.type==="arrayBuffer"?P.arrayBuffer():a.type==="json"?P.json():P.text()).then(B=>{y||(R&&F&&function(W,J,ee){if(jd(),!Ga)return;let te=bp(J.headers.get("Cache-Control")||"");if(te["no-store"])return;let me={status:J.status,statusText:J.statusText,headers:new Headers};J.headers.forEach((Ce,De)=>me.headers.set(De,Ce)),te["max-age"]&&me.headers.set("Expires",new Date(ee+1e3*te["max-age"]).toUTCString());let he=me.headers.get("Expires");if(!he||new Date(he).getTime()-ee<42e4)return;let ve=xp(W.url,{persistentParams:["language","worldview"]});if(J.status===206){let Ce=W.headers.get("Range");if(!Ce)return;me.status=200,ve=mu(ve,{range:Ce})}(function(Ce,De){if(pu===void 0)try{new Response(new ReadableStream),pu=!0}catch{pu=!1}pu?De(Ce.body):Ce.blob().then(De)})(J,Ce=>{let De=new Response((Ue=J.status)!==200&&Ue!==404&&[101,103,204,205,304].includes(Ue)?null:Ce,me);var Ue;jd(),Ga&&Ga.then(ze=>ze.put(ve,De)).catch(ze=>qn(ze.message))})}(p,R,F),b=!0,c(null,B,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(B=>{y||c(new Error(B.message))})};return w?function(P,R){if(jd(),!Ga)return R(null);Ga.then(F=>{let B=xp(P.url,{persistentParams:["language","worldview"]}),W=P.headers.get("Range");W&&(B=mu(B,{range:W})),F.match(B).then(J=>{let ee=function(te){if(!te)return!1;let me=new Date(te.headers.get("Expires")||0),he=bp(te.headers.get("Cache-Control")||"");return me>Date.now()&&!he["no-cache"]}(J);F.delete(B),ee&&F.put(B,J.clone()),R(null,J,ee)}).catch(R)}).catch(R)}(p,T):T(null,null),{cancel:()=>{y=!0,b||m.abort()}}}(t,e);if(Mr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(a,c){let m=new XMLHttpRequest;m.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(let p in a.headers)m.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=a.credentials==="include",m.onerror=()=>{c(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let p=m.response;if(a.type==="json")try{p=JSON.parse(m.response)}catch(b){return c(b)}c(null,p,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else c(new Tp(m.statusText,m.status,a.url))},m.send(a.body),{cancel:()=>m.abort()}}(t,e)},dl=function(t,e){return Ud(Nr(t,{type:"arrayBuffer"}),e)};function Gg(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let Ip="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Hd,Wd;Hd=[],Wd=0;let Ms=function(t,e){if(gu.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Wd>=I.MAX_PARALLEL_IMAGE_REQUESTS){let m={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Hd.push(m),m}Wd++;let n=!1,a=()=>{if(!n)for(n=!0,Wd--;Hd.length&&Wd<I.MAX_PARALLEL_IMAGE_REQUESTS;){let m=Hd.shift(),{requestParameters:p,callback:b,cancelled:y}=m;y||(m.cancel=Ms(p,b).cancel)}},c=dl(t,(m,p,b,y)=>{a(),m?e(m):p&&(self.createImageBitmap?function(w,M){let T=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(T).then(E=>{M(null,E)}).catch(E=>{M(new Error(`Could not load image because of ${E.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(w,M)=>e(w,M,b,y)):function(w,M){let T=new Image;T.onload=()=>{M(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=Ip})},T.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let E=new Blob([new Uint8Array(w)],{type:"image/png"});T.src=w.byteLength?URL.createObjectURL(E):Ip}(p,(w,M)=>e(w,M,b,y)))});return{cancel:()=>{c.cancel(),a()}}},Ep="01",Dp="NO_ACCESS_TOKEN",Cy=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ra(t){let e=t.match(Cy);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function _c(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let yu="mapbox.eventData";function qg(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Gd{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=qg(I.ACCESS_TOKEN),a="";return a=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,m)=>String.fromCharCode(+("0x"+m)))):I.ACCESS_TOKEN||"",e?`${yu}.${e}:${a}`:`${yu}:${a}`}fetchEventData(){let e=cl("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{let c=localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));let m=localStorage.getItem(a);m&&(this.anonId=m)}catch{qn("Unable to read from LocalStorage")}}saveEventData(){let e=cl("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid"),c=this.anonId;if(e&&c)try{localStorage.setItem(a,c),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{qn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,a,c){if(!I.EVENTS_URL)return;let m=ra(I.EVENTS_URL);m.params.push(`access_token=${c||I.ACCESS_TOKEN||""}`);let p={event:this.type,created:new Date(e).toISOString()},b=n?Nr(p,n):p,y={url:_c(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=function(w,M){return Ud(Nr(w,{method:"POST"}),M)}(y,w=>{this.pendingRequest=null,a(w),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let $g=new class extends Gd{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){I.EVENTS_URL&&I.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>N(n)||O(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=qg(I.ACCESS_TOKEN),n=e?e.u:I.ACCESS_TOKEN,a=n!==this.eventData.tokenU;gp(this.anonId)||(this.anonId=su(),a=!0);let c=this.queue.shift();if(this.eventData.lastSuccess){let m=new Date(this.eventData.lastSuccess),p=new Date(c),b=(c-this.eventData.lastSuccess)/864e5;a=a||b>=1||b<-1||m.getDate()!==p.getDate()}else a=!0;a?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:Ep,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},t):this.processRequests()}},Ap=$g.postTurnstileEvent.bind($g),qd=new class extends Gd{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,a){this.skuToken=e,this.errorCb=a,I.EVENTS_URL&&(n||I.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Dp)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),gp(this.anonId)||(this.anonId=su()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:Ep,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Yg=qd.postMapLoadEvent.bind(qd),Zg=new class extends Gd{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=su(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:n,style:a,importedStyles:c}=e;if(!I.EVENTS_URL||!t&&!I.ACCESS_TOKEN)return;let m=this.getMapInstanceId(n),p={mapInstanceId:m,eventId:this.getEventId(m),style:a};c.length&&(p.importedStyles=c),this.queueRequest({timestamp:Date.now(),payload:p},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},Sy=Zg.postStyleLoadEvent.bind(Zg),vu=new class extends Gd{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){I.EVENTS_URL&&(t||I.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),a=function(c){let m=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),b=function(P){let R={};if(P){for(let F in P)if(F!=="other")for(let B of P[F]){let W=`${F}ResolveRangeMin`,J=`${F}ResolveRangeMax`,ee=`${F}RequestCount`,te=`${F}RequestCachedCount`;R[W]=Math.min(R[W]||1/0,B.startTime),R[J]=Math.max(R[J]||-1/0,B.responseEnd);let me=he=>{R[he]===void 0&&(R[he]=0),++R[he]};B.transferSize!==void 0&&B.transferSize===0&&me(te),me(ee)}}return R}(function(P,R){let F={};if(P)for(let B of P){let W=R(B);F[W]===void 0&&(F[W]=[]),F[W].push(B)}return F}(m,Ae)),y=window.devicePixelRatio,w=navigator.connection||navigator.mozConnection||navigator.webkitConnection,M=w?w.effectiveType:void 0,T={counters:[],metadata:[],attributes:[]},E=(P,R,F)=>{F!=null&&P.push({name:R,value:F.toString()})};for(let P in b)E(T.counters,P,b[P]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(E(T.counters,"interactionRangeMin",c.interactionRange[0]),E(T.counters,"interactionRangeMax",c.interactionRange[1])),p)for(let P of Object.keys(xe)){let R=xe[P],F=p.find(B=>B.name===R);F&&E(T.counters,R,F.startTime)}return E(T.counters,"visibilityHidden",c.visibilityHidden),E(T.attributes,"style",function(P){if(P)for(let R of P){let F=R.name.split("?")[0];if(de(F)){let B=F.split("/").slice(-2);if(B.length===2)return`mapbox://styles/${B[0]}/${B[1]}`}}}(m)),E(T.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),E(T.attributes,"fogEnabled",c.fogEnabled?"true":"false"),E(T.attributes,"projection",c.projection),E(T.attributes,"zoom",c.zoom),E(T.metadata,"devicePixelRatio",y),E(T.metadata,"connectionEffectiveType",M),E(T.metadata,"navigatorUserAgent",navigator.userAgent),E(T.metadata,"screenWidth",window.screen.width),E(T.metadata,"screenHeight",window.screen.height),E(T.metadata,"windowWidth",window.innerWidth),E(T.metadata,"windowHeight",window.innerHeight),E(T.metadata,"mapWidth",c.width/y),E(T.metadata,"mapHeight",c.height/y),E(T.metadata,"webglRenderer",c.renderer),E(T.metadata,"webglVendor",c.vendor),E(T.metadata,"sdkVersion",_),E(T.metadata,"sdkIdentifier","mapbox-gl-js"),T}(n);for(let c of a.metadata);for(let c of a.counters);for(let c of a.attributes);this.postEvent(e,a,()=>{},t)}},My=vu.postPerformanceEvent.bind(vu),bc=new class extends Gd{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,a){if(!I.API_URL||!I.SESSION_PATH)return;let c=ra(I.API_URL+I.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${a||I.ACCESS_TOKEN||""}`);let m={url:_c(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,b){return Ud(Nr(p,{method:"GET"}),b)}(m,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(a)})}getSessionAPI(t,e,n,a){this.skuToken=e,this.errorCb=a,I.SESSION_PATH&&I.API_URL&&(n||I.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Dp)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},xu=bc.getSessionAPI.bind(bc),$d=new Set;var hl={exports:{}},Xg={exports:function(t,e){var n,a,c,m,p,b,y,w;for(a=t.length-(n=3&t.length),c=e,p=3432918353,b=461845907,w=0;w<a;)y=255&t.charCodeAt(w)|(255&t.charCodeAt(++w))<<8|(255&t.charCodeAt(++w))<<16|(255&t.charCodeAt(++w))<<24,++w,c=27492+(65535&(m=5*(65535&(c=(c^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*b+(((y>>>16)*b&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&t.charCodeAt(w+2))<<16;case 2:y^=(255&t.charCodeAt(w+1))<<8;case 1:c^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(w)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*b+(((y>>>16)*b&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}},ky={exports:function(t,e){for(var n,a=t.length,c=e^a,m=0;a>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(m)|(255&t.charCodeAt(++m))<<8|(255&t.charCodeAt(++m))<<16|(255&t.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++m;switch(a){case 3:c^=(255&t.charCodeAt(m+2))<<16;case 2:c^=(255&t.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0}},Qg=Xg.exports,Pp=ky.exports;hl.exports=Qg,hl.exports.murmur3=Qg,hl.exports.murmur2=Pp;var yc=Xe(hl.exports);function Op(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function vc(t,e,n){if(n&&n[t]){let a=n[t].indexOf(e);a!==-1&&n[t].splice(a,1)}}class Jr{constructor(e,n={}){Nr(this,n),this.type=e}}class wu extends Jr{constructor(e,n={}){super("error",Nr({error:e},n))}}class ul{on(e,n){return this._listeners=this._listeners||{},Op(e,n,this._listeners),this}off(e,n){return vc(e,n,this._listeners),vc(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Op(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){typeof e=="string"&&(e=new Jr(e,n||{}));let a=e.type;if(this.listens(a)){e.target=this;let c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let b of c)b.call(this,e);let m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let b of m)vc(a,b,this._oneTimeListeners),b.call(this,e);let p=this._eventedParent;p&&(Nr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof wu&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}i.F=void 0;var Kg={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Cu(t){return(t=Math.round(t))<0?0:t>255?255:t}function Rp(t){return Cu(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Yd(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Zd(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{i.F={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Kg)return Kg[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=n.indexOf("("),c=n.indexOf(")");if(a!==-1&&c+1===n.length){var m=n.substr(0,a),p=n.substr(a+1,c-(a+1)).split(","),b=1;switch(m){case"rgba":if(p.length!==4)return null;b=Yd(p.pop());case"rgb":return p.length!==3?null:[Rp(p[0]),Rp(p[1]),Rp(p[2]),b];case"hsla":if(p.length!==4)return null;b=Yd(p.pop());case"hsl":if(p.length!==3)return null;var y=(parseFloat(p[0])%360+360)%360/360,w=Yd(p[1]),M=Yd(p[2]),T=M<=.5?M*(w+1):M+w-M*w,E=2*M-T;return[Cu(255*Zd(E,T,y+1/3)),Cu(255*Zd(E,T,y)),Cu(255*Zd(E,T,y-1/3)),b];default:return null}}return null}}catch{}class Fi{constructor(e,n,a,c=1){this.r=e,this.g=n,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof Fi)return e;if(typeof e!="string")return;let n=i.F(e);return n?new Fi(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,a,c]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(a)},${c})`}toRenderColor(e){let{r:n,g:a,b:c,a:m}=this;return new Ty(e,n,a,c,m)}}class Ty{constructor(e,n,a,c,m){if(e){let p=e.image.height,b=p*p;n=m===0?0:n/m*(p-1),a=m===0?0:a/m*(p-1),c=m===0?0:c/m*(p-1);let y=Math.floor(n),w=Math.floor(a),M=Math.floor(c),T=Math.ceil(n),E=Math.ceil(a),P=Math.ceil(c),R=n-y,F=a-w,B=c-M,W=e.image.data,J=4*(y+w*b+M*p),ee=4*(y+w*b+P*p),te=4*(y+E*b+M*p),me=4*(y+E*b+P*p),he=4*(T+w*b+M*p),ve=4*(T+w*b+P*p),Ce=4*(T+E*b+M*p),De=4*(T+E*b+P*p);if(J<0||De>=W.length)throw new Error("out of range");this.r=Wt(Wt(Wt(W[J],W[ee],B),Wt(W[te],W[me],B),F),Wt(Wt(W[he],W[ve],B),Wt(W[Ce],W[De],B),F),R)/255*m,this.g=Wt(Wt(Wt(W[J+1],W[ee+1],B),Wt(W[te+1],W[me+1],B),F),Wt(Wt(W[he+1],W[ve+1],B),Wt(W[Ce+1],W[De+1],B),F),R)/255*m,this.b=Wt(Wt(Wt(W[J+2],W[ee+2],B),Wt(W[te+2],W[me+2],B),F),Wt(Wt(W[he+2],W[ve+2],B),Wt(W[Ce+2],W[De+2],B),F),R)/255*m,this.a=m}else this.r=n,this.g=a,this.b=c,this.a=m}toArray(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*a/c,c]}toArray01(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[e/c,n/c,a/c,c]}toArray01Scaled(e){let{r:n,g:a,b:c,a:m}=this;return m===0?[0,0,0]:[n/m*e,a/m*e,c/m*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:a,a:c}=this;return[e,n,a,c]}toArray01Linear(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(n/c,2.2),Math.pow(a/c,2.2),c]}}function Wt(t,e,n){return t*(1-n)+e*n}function Jg(t,e,n){return t.map((a,c)=>Wt(a,e[c],n))}Fi.black=new Fi(0,0,0,1),Fi.white=new Fi(1,1,1,1),Fi.transparent=new Fi(0,0,0,0),Fi.red=new Fi(1,0,0,1),Fi.blue=new Fi(0,0,1,1);var Su=Object.freeze({__proto__:null,array:Jg,color:function(t,e,n){return new Fi(Wt(t.r,e.r,n),Wt(t.g,e.g,n),Wt(t.b,e.b,n),Wt(t.a,e.a,n))},number:Wt});function Lp(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}class Ca extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Fp{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[a,c]of n)this.bindings[a]=c}concat(e){return new Fp(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let xc={kind:"null"},It={kind:"number"},zi={kind:"string"},Bi={kind:"boolean"},eo={kind:"color"},wc={kind:"object"},Pi={kind:"value"},oa={kind:"collator"},Cc={kind:"formatted"},Sa={kind:"resolvedImage"};function mo(t,e){return{kind:"array",itemType:t,N:e}}function $n(t){if(t.kind==="array"){let e=$n(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let Iy=[xc,It,zi,Bi,eo,Cc,wc,mo(Pi),Sa];function Xd(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Xd(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of Iy)if(!Xd(n,e))return null}}return`Expected ${$n(t)} but found ${$n(e)} instead.`}function zp(t,e){return e.some(n=>n.kind===t.kind)}function Sc(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class Qd{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ml{constructor(e,n,a,c,m){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=c,this.textColor=m}}class Vr{constructor(e){this.sections=e}static fromString(e){return new Vr([new ml(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Vr?e:Vr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class to{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new to({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function e_(t,e,n,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[t,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[t,e,n,a]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function io(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Fi||t instanceof Qd||t instanceof Vr||t instanceof to)return!0;if(Array.isArray(t)){for(let e of t)if(!io(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!io(t[e]))return!1;return!0}return!1}function ar(t){if(t===null)return xc;if(typeof t=="string")return zi;if(typeof t=="boolean")return Bi;if(typeof t=="number")return It;if(t instanceof Fi)return eo;if(t instanceof Qd)return oa;if(t instanceof Vr)return Cc;if(t instanceof to)return Sa;if(Array.isArray(t)){let e=t.length,n;for(let a of t){let c=ar(a);if(n){if(n===c)continue;n=Pi;break}n=c}return mo(n||Pi,e)}return wc}function Bo(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Fi||t instanceof Vr||t instanceof to?t.toString():JSON.stringify(t)}class qa{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!io(e[1]))return n.error("invalid value");let a=e[1],c=ar(a),m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new qa(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Fi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Vr?this.value.serialize():this.value}}class pr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let Bp={string:zi,number:It,boolean:Bi,object:wc};class aa{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,c=1,m=e[0];if(m==="array"){let b,y;if(e.length>2){let w=e[1];if(typeof w!="string"||!(w in Bp)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=Bp[w],c++}else b=Pi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],c++}a=mo(b,y)}else a=Bp[m];let p=[];for(;c<e.length;c++){let b=n.parse(e[c],c,Pi);if(!b)return null;p.push(b)}return new aa(a,p)}evaluate(e){for(let n=0;n<this.args.length;n++){let a=this.args[n].evaluate(e);if(!Xd(this.type,ar(a)))return a;if(n===this.args.length-1)throw new pr(`Expected value to be of type ${$n(this.type)}, but found ${$n(ar(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);let c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(a=>a.serialize()))}}class Kd{constructor(e){this.type=Cc,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");let c=[],m=!1;for(let p=1;p<=e.length-1;++p){let b=e[p];if(m&&typeof b=="object"&&!Array.isArray(b)){m=!1;let y=null;if(b["font-scale"]&&(y=n.parse(b["font-scale"],1,It),!y))return null;let w=null;if(b["text-font"]&&(w=n.parse(b["text-font"],1,mo(zi)),!w))return null;let M=null;if(b["text-color"]&&(M=n.parse(b["text-color"],1,eo),!M))return null;let T=c[c.length-1];T.scale=y,T.font=w,T.textColor=M}else{let y=n.parse(e[p],1,Pi);if(!y)return null;let w=y.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:y,scale:null,font:null,textColor:null})}}return new Kd(c)}evaluate(e){return new Vr(this.sections.map(n=>{let a=n.content.evaluate(e);return ar(a)===Sa?new ml("",a,null,null,null):new ml(Bo(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class Jd{constructor(e,n){this.type=Sa,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let a=n.parse(e[1],1,zi);if(!a)return n.error("No image name provided.");if(e.length===2)return new Jd(a);let c=n.parse(e[2],1,zi);return c?new Jd(a,c):n.error("Secondary image variant is not a string.")}evaluate(e){let n=to.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function pl(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let Ey={"to-boolean":Bi,"to-color":eo,"to-number":It,"to-string":zi};class sa{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[0],c=[],m=xc;if(a==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);m=mo(n.expectedType.itemType,p)}else{if(!(p>0&&io(e[1][0])))return null;m=mo(ar(e[1][0]),p)}for(let b=0;b<p;b++){let y=e[1][b],w;if(pl(y)==="array")w=n.parse(y,void 0,m.itemType);else{let M=pl(y);if(M!==m.itemType.kind)return n.error(`Expected ${m.itemType.kind} but found ${M}.`);w=n.registry.literal.parse(["literal",y===void 0?null:y],n)}if(!w)return null;c.push(w)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");m=Ey[a];for(let p=1;p<e.length;p++){let b=n.parse(e[p],p,Pi);if(!b)return null;c.push(b)}}return new sa(m,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(let c of this.args){if(n=c.evaluate(e),a=null,n instanceof Fi)return n;if(typeof n=="string"){let m=e.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:e_(n[0],n[1],n[2],n[3]),!a))return new Fi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new pr(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let a of this.args){if(n=a.evaluate(e),n===null)return 0;let c=Number(n);if(!isNaN(c))return c}throw new pr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Vr.fromString(Bo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?to.fromString(Bo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Bo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Kd([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Jd(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let t_=["Unknown","Point","LineString","Polygon"];class i_{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?t_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:a,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*n-e[0])+this.featureDistanceData.bearing[1]*(c*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Fi.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Wr{constructor(e,n,a,c,m){this.name=e,this.type=n,this._evaluate=a,this.args=c,this._overloadIndex=m}evaluate(e){if(!this._evaluate){let n=Wr.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let a=e[0],c=Wr.definitions[a];if(!c)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let m=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,b=[],y=null,w=-1;for(let[M,T]of p){if(Array.isArray(M)&&M.length!==e.length-1)continue;b.push(M),w++,y=new m_(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let E=[],P=!1;for(let R=1;R<e.length;R++){let F=e[R],B=Array.isArray(M)?M[R-1]:M.type,W=y.parse(F,1+E.length,B);if(!W){P=!0;break}E.push(W)}if(!P)if(Array.isArray(M)&&M.length!==E.length)y.error(`Expected ${M.length} arguments, but found ${E.length} instead.`);else{for(let R=0;R<E.length;R++){let F=Array.isArray(M)?M[R]:M.type,B=E[R];y.concat(R+1).checkSubtype(F,B.type)}if(y.errors.length===0)return new Wr(a,m,T,E,w)}}if(b.length===1)n.errors.push(...y.errors);else{let M=(b.length?b:p.map(([E])=>E)).map(Np).join(" | "),T=[];for(let E=1;E<e.length;E++){let P=n.parse(e[E],1+T.length);if(!P)return null;T.push($n(P.type))}n.error(`Expected arguments of type ${M}, but found (${T.join(", ")}) instead.`)}return null}static register(e,n){Wr.definitions=n;for(let a in n)e[a]=Wr}}function Np(t){return Array.isArray(t)?`(${t.map($n).join(", ")})`:`(${$n(t.type)}...)`}class ks{constructor(e,n,a){this.type=oa,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");let c=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Bi);if(!c)return null;let m=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Bi);if(!m)return null;let p=null;return a.locale&&(p=n.parse(a.locale,1,zi),!p)?null:new ks(c,m,p)}evaluate(e){return new Qd(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Vp={exports:{}};Vp.exports=function(){function t(a,c,m,p,b){for(;p>m;){if(p-m>600){var y=p-m+1,w=c-m+1,M=Math.log(y),T=.5*Math.exp(2*M/3),E=.5*Math.sqrt(M*T*(y-T)/y)*(w-y/2<0?-1:1);t(a,c,Math.max(m,Math.floor(c-w*T/y+E)),Math.min(p,Math.floor(c+(y-w)*T/y+E)),b)}var P=a[c],R=m,F=p;for(e(a,m,c),b(a[p],P)>0&&e(a,m,p);R<F;){for(e(a,R,F),R++,F--;b(a[R],P)<0;)R++;for(;b(a[F],P)>0;)F--}b(a[m],P)===0?e(a,m,F):e(a,++F,p),F<=c&&(m=F+1),c<=F&&(p=F-1)}}function e(a,c,m){var p=a[c];a[c]=a[m],a[m]=p}function n(a,c){return a<c?-1:a>c?1:0}return function(a,c,m,p,b){t(a,c,m||0,p||a.length-1,b||n)}}();var Dy=Xe(Vp.exports);function Ay(t){let e=0;for(let n,a,c=0,m=t.length,p=m-1;c<m;p=c++)n=t[c],a=t[p],e+=(a.x-n.x)*(n.y+a.y);return e}function eh(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Mc(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Py(t,e,n){let a=t[0]-e[0],c=t[1]-e[1],m=t[0]-n[0],p=t[1]-n[1];return a*p-m*c==0&&a*m<=0&&c*p<=0}function kc(t,e,n=!1){let a=!1;for(let b=0,y=e.length;b<y;b++){let w=e[b];for(let M=0,T=w.length,E=T-1;M<T;E=M++){let P=w[E],R=w[M];if(Py(t,P,R))return n;(m=P)[1]>(c=t)[1]!=(p=R)[1]>c[1]&&c[0]<(p[0]-m[0])*(c[1]-m[1])/(p[1]-m[1])+m[0]&&(a=!a)}}var c,m,p;return a}function jp(t,e,n,a){let c=a[0]-n[0],m=a[1]-n[1],p=(t[0]-n[0])*m-c*(t[1]-n[1]),b=(e[0]-n[0])*m-c*(e[1]-n[1]);return p>0&&b<0||p<0&&b>0}function Ai(t,e,n,a){return(c=[a[0]-n[0],a[1]-n[1]])[0]*(m=[e[0]-t[0],e[1]-t[1]])[1]-c[1]*m[0]!=0&&!(!jp(t,e,n,a)||!jp(n,a,t,e));var c,m}let $a=8192;function n_(t,e){let n=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*$a),Math.round(a*c*$a)]}function Oy(t,e){for(let n=0;n<e.length;n++)if(kc(t,e[n]))return!0;return!1}function Ry(t,e,n){for(let a of n)for(let c=0,m=a.length,p=m-1;c<m;p=c++)if(Ai(t,e,a[p],a[c]))return!0;return!1}function th(t,e){for(let n=0;n<t.length;++n)if(!kc(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Ry(t[n],t[n+1],e))return!1;return!0}function Mu(t,e){for(let n=0;n<e.length;n++)if(th(t,e[n]))return!0;return!1}function Tc(t,e,n){let a=[];for(let c=0;c<t.length;c++){let m=[];for(let p=0;p<t[c].length;p++){let b=n_(t[c][p],n);eh(e,b),m.push(b)}a.push(m)}return a}function r_(t,e,n){let a=[];for(let c=0;c<t.length;c++){let m=Tc(t[c],e,n);a.push(m)}return a}function Up(t,e,n,a){if(t[0]<n[0]||t[0]>n[2]){let c=.5*a,m=t[0]-n[0]>c?-a:n[0]-t[0]>c?a:0;m===0&&(m=t[0]-n[2]>c?-a:n[2]-t[0]>c?a:0),t[0]+=m}eh(e,t)}function la(t,e,n,a){let c=Math.pow(2,a.z)*$a,m=[a.x*$a,a.y*$a],p=[];if(!t)return p;for(let b of t)for(let y of b){let w=[y.x+m[0],y.y+m[1]];Up(w,e,n,c),p.push(w)}return p}function o_(t,e,n,a){let c=Math.pow(2,a.z)*$a,m=[a.x*$a,a.y*$a],p=[];if(!t)return p;for(let y of t){let w=[];for(let M of y){let T=[M.x+m[0],M.y+m[1]];eh(e,T),w.push(T)}p.push(w)}if(e[2]-e[0]<=c/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(let y of p)for(let w of y)Up(w,e,n,c)}var b;return p}class Ts{constructor(e,n){this.type=Bi,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(io(e[1])){let a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){let m=a.features[c].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Ts(a,a.features[c].geometry)}else if(a.type==="Feature"){let c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Ts(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ts(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){let c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let b=Tc(a.coordinates,m,p),y=la(n.geometry(),c,m,p);if(!Mc(c,m))return!1;for(let w of y)if(!kc(w,b))return!1}if(a.type==="MultiPolygon"){let b=r_(a.coordinates,m,p),y=la(n.geometry(),c,m,p);if(!Mc(c,m))return!1;for(let w of y)if(!Oy(w,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){let c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let b=Tc(a.coordinates,m,p),y=o_(n.geometry(),c,m,p);if(!Mc(c,m))return!1;for(let w of y)if(!th(w,b))return!1}if(a.type==="MultiPolygon"){let b=r_(a.coordinates,m,p),y=o_(n.geometry(),c,m,p);if(!Mc(c,m))return!1;for(let w of y)if(!Mu(w,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let Is={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ku=1/298.257223563,a_=ku*(2-ku),ih=Math.PI/180;class nh{static fromTile(e,n,a){let c=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),m=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/ih;return new nh(m,a)}static get units(){return Is}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Is[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Is).join(", ")}`);let a=6378.137*ih*(n?Is[n]:1),c=Math.cos(e*ih),m=1/(1-a_*(1-c*c)),p=Math.sqrt(m);this.kx=a*p*c,this.ky=a*p*m*(1-a_)}distance(e,n){let a=No(e[0]-n[0])*this.kx,c=(e[1]-n[1])*this.ky;return Math.sqrt(a*a+c*c)}bearing(e,n){let a=No(n[0]-e[0])*this.kx;return Math.atan2(a,(n[1]-e[1])*this.ky)/ih}destination(e,n,a){let c=a*ih;return this.offset(e,Math.sin(c)*n,Math.cos(c)*n)}offset(e,n,a){return[e[0]+n/this.kx,e[1]+a/this.ky]}lineDistance(e){let n=0;for(let a=0;a<e.length-1;a++)n+=this.distance(e[a],e[a+1]);return n}area(e){let n=0;for(let a=0;a<e.length;a++){let c=e[a];for(let m=0,p=c.length,b=p-1;m<p;b=m++)n+=No(c[m][0]-c[b][0])*(c[m][1]+c[b][1])*(a?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let a=0;if(n<=0)return e[0];for(let c=0;c<e.length-1;c++){let m=e[c],p=e[c+1],b=this.distance(m,p);if(a+=b,a>n)return rh(m,p,(n-(a-b))/b)}return e[e.length-1]}pointToSegmentDistance(e,n,a){let[c,m]=n,p=No(a[0]-c)*this.kx,b=(a[1]-m)*this.ky;if(p!==0||b!==0){let y=(No(e[0]-c)*this.kx*p+(e[1]-m)*this.ky*b)/(p*p+b*b);y>1?(c=a[0],m=a[1]):y>0&&(c+=p/this.kx*y,m+=b/this.ky*y)}return p=No(e[0]-c)*this.kx,b=(e[1]-m)*this.ky,Math.sqrt(p*p+b*b)}pointOnLine(e,n){let a=1/0,c=e[0][0],m=e[0][1],p=0,b=0;for(let y=0;y<e.length-1;y++){let w=e[y][0],M=e[y][1],T=No(e[y+1][0]-w)*this.kx,E=(e[y+1][1]-M)*this.ky,P=0;T===0&&E===0||(P=(No(n[0]-w)*this.kx*T+(n[1]-M)*this.ky*E)/(T*T+E*E),P>1?(w=e[y+1][0],M=e[y+1][1]):P>0&&(w+=T/this.kx*P,M+=E/this.ky*P)),T=No(n[0]-w)*this.kx,E=(n[1]-M)*this.ky;let R=T*T+E*E;R<a&&(a=R,c=w,m=M,p=y,b=P)}return{point:[c,m],index:p,t:Math.max(0,Math.min(1,b))}}lineSlice(e,n,a){let c=this.pointOnLine(a,e),m=this.pointOnLine(a,n);if(c.index>m.index||c.index===m.index&&c.t>m.t){let w=c;c=m,m=w}let p=[c.point],b=c.index+1,y=m.index;!Hp(a[b],p[0])&&b<=y&&p.push(a[b]);for(let w=b+1;w<=y;w++)p.push(a[w]);return Hp(a[y],m.point)||p.push(m.point),p}lineSliceAlong(e,n,a){let c=0,m=[];for(let p=0;p<a.length-1;p++){let b=a[p],y=a[p+1],w=this.distance(b,y);if(c+=w,c>e&&m.length===0&&m.push(rh(b,y,(e-(c-w))/w)),c>=n)return m.push(rh(b,y,(n-(c-w))/w)),m;c>e&&m.push(y)}return m}bufferPoint(e,n){let a=n/this.ky,c=n/this.kx;return[e[0]-c,e[1]-a,e[0]+c,e[1]+a]}bufferBBox(e,n){let a=n/this.ky,c=n/this.kx;return[e[0]-c,e[1]-a,e[2]+c,e[3]+a]}insideBBox(e,n){return No(e[0]-n[0])>=0&&No(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Hp(t,e){return t[0]===e[0]&&t[1]===e[1]}function rh(t,e,n){let a=No(e[0]-t[0]);return[t[0]+a*n,t[1]+(e[1]-t[1])*n]}function No(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}var oh={exports:{}};(function(t,e){t.exports=function(){var n=function(c,m){if(c===void 0&&(c=[]),m===void 0&&(m=a),this.data=c,this.length=this.data.length,this.compare=m,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function a(c,m){return c<m?-1:c>m?1:0}return n.prototype.push=function(c){this.data.push(c),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var c=this.data[0],m=this.data.pop();return this.length--,this.length>0&&(this.data[0]=m,this._down(0)),c}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(c){for(var m=this.data,p=this.compare,b=m[c];c>0;){var y=c-1>>1,w=m[y];if(p(b,w)>=0)break;m[c]=w,c=y}m[c]=b},n.prototype._down=function(c){for(var m=this.data,p=this.compare,b=this.length>>1,y=m[c];c<b;){var w=1+(c<<1),M=m[w],T=w+1;if(T<this.length&&p(m[T],M)<0&&(w=T,M=m[T]),p(M,y)>=0)break;m[c]=M,c=w}m[c]=y},n}()})(oh);var Wp=Xe(oh.exports),pt=8192;function s_(t,e){return e.dist-t.dist}let Gp=100,qp=50;function l_(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Tu(t){return t[1]-t[0]+1}function Ma(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Es(t,e){if(t[0]>t[1])return[null,null];let n=Tu(t);if(e){if(n===2)return[t,null];let a=Math.floor(n/2);return[[t[0],t[0]+a],[t[0]+a,t[1]]]}{if(n===1)return[t,null];let a=Math.floor(n/2)-1;return[[t[0],t[0]+a],[t[0]+a+1,t[1]]]}}function fl(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!Ma(e,t.length))return n;for(let a=e[0];a<=e[1];++a)eh(n,t[a]);return n}function Iu(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let a=0;a<t[n].length;++a)eh(e,t[n][a]);return e}function Ds(t,e,n){if(l_(t)||l_(e))return NaN;let a=0,c=0;return t[2]<e[0]&&(a=e[0]-t[2]),t[0]>e[2]&&(a=t[0]-e[2]),t[1]>e[3]&&(c=t[1]-e[3]),t[3]<e[1]&&(c=e[1]-t[3]),n.distance([0,0],[a,c])}function Ly(t){return 360*t-180}function Fy(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function $p(t,e){let n=Math.pow(2,e.z),a=(t.y/pt+e.y)/n;return[Ly((t.x/pt+e.x)/n),Fy(a)]}function zy(t,e){let n=[];for(let a=0;a<t.length;++a)n.push($p(t[a],e));return n}function c_(t,e,n){let a=n.pointOnLine(e,t).point;return n.distance(t,a)}function As(t,e,n,a,c){let m=n.slice(a[0],a[1]+1),p=1/0;for(let b=e[0];b<=e[1];++b)if((p=Math.min(p,c_(t[b],m,c)))===0)return 0;return p}function Yp(t,e,n,a,c){let m=Math.min(c.pointToSegmentDistance(t,n,a),c.pointToSegmentDistance(e,n,a)),p=Math.min(c.pointToSegmentDistance(n,t,e),c.pointToSegmentDistance(a,t,e));return Math.min(m,p)}function By(t,e,n,a,c){if(!Ma(e,t.length)||!Ma(a,n.length))return NaN;let m=1/0;for(let p=e[0];p<e[1];++p)for(let b=a[0];b<a[1];++b){if(Ai(t[p],t[p+1],n[b],n[b+1]))return 0;m=Math.min(m,Yp(t[p],t[p+1],n[b],n[b+1],c))}return m}function d_(t,e,n,a,c){if(!Ma(e,t.length)||!Ma(a,n.length))return NaN;let m=1/0;for(let p=e[0];p<=e[1];++p)for(let b=a[0];b<=a[1];++b)if((m=Math.min(m,c.distance(t[p],n[b])))===0)return m;return m}function h_(t,e,n){if(kc(t,e,!0))return 0;let a=1/0;for(let c of e){let m=c.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[m-1]&&(a=Math.min(a,n.pointToSegmentDistance(t,c[m-1],c[0])))===0||(a=Math.min(a,c_(t,c,n)))===0)return a}return a}function ca(t,e,n,a){if(!Ma(e,t.length))return NaN;for(let m=e[0];m<=e[1];++m)if(kc(t[m],n,!0))return 0;let c=1/0;for(let m=e[0];m<e[1];++m)for(let p of n)for(let b=0,y=p.length,w=y-1;b<y;w=b++){if(Ai(t[m],t[m+1],p[w],p[b]))return 0;c=Math.min(c,Yp(t[m],t[m+1],p[w],p[b],a))}return c}function Zp(t,e){for(let n of t)for(let a=0;a<=n.length-1;++a)if(kc(n[a],e,!0))return!0;return!1}function Ny(t,e,n,a=1/0){let c=Iu(t),m=Iu(e);if(a!==1/0&&Ds(c,m,n)>=a)return a;if(Mc(c,m)){if(Zp(t,e))return 0}else if(Zp(e,t))return 0;let p=a;for(let b of t)for(let y=0,w=b.length,M=w-1;y<w;M=y++)for(let T of e)for(let E=0,P=T.length,R=P-1;E<P;R=E++){if(Ai(b[M],b[y],T[R],T[E]))return 0;p=Math.min(p,Yp(b[M],b[y],T[R],T[E],n))}return p}function ah(t,e,n,a,c,m,p){if(m===null||p===null)return;let b=Ds(fl(a,m),fl(c,p),n);b<e&&t.push({dist:b,range1:m,range2:p})}function Eu(t,e,n,a,c=1/0){let m=Math.min(a.distance(t[0],n[0][0]),c);if(m===0)return m;let p=new Wp([{dist:0,range1:[0,t.length-1],range2:[0,0]}],s_),b=e?qp:Gp,y=Iu(n);for(;p.length;){let w=p.pop();if(w.dist>=m)continue;let M=w.range1;if(Tu(M)<=b){if(!Ma(M,t.length))return NaN;if(e){let T=ca(t,M,n,a);if((m=Math.min(m,T))===0)return m}else for(let T=M[0];T<=M[1];++T){let E=h_(t[T],n,a);if((m=Math.min(m,E))===0)return m}}else{let T=Es(M,e);if(T[0]!==null){let E=Ds(fl(t,T[0]),y,a);E<m&&p.push({dist:E,range1:T[0],range2:[0,0]})}if(T[1]!==null){let E=Ds(fl(t,T[1]),y,a);E<m&&p.push({dist:E,range1:T[1],range2:[0,0]})}}}return m}function u_(t,e,n,a,c,m=1/0){let p=Math.min(m,c.distance(t[0],n[0]));if(p===0)return p;let b=new Wp([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],s_),y=e?qp:Gp,w=a?qp:Gp;for(;b.length;){let M=b.pop();if(M.dist>=p)continue;let T=M.range1,E=M.range2;if(Tu(T)<=y&&Tu(E)<=w){if(!Ma(T,t.length)||!Ma(E,n.length))return NaN;if(e&&a?p=Math.min(p,By(t,T,n,E,c)):e||a?e&&!a?p=Math.min(p,As(n,E,t,T,c)):!e&&a&&(p=Math.min(p,As(t,T,n,E,c))):p=Math.min(p,d_(t,T,n,E,c)),p===0)return p}else{let P=Es(T,e),R=Es(E,a);ah(b,p,c,t,n,P[0],R[0]),ah(b,p,c,t,n,P[0],R[1]),ah(b,p,c,t,n,P[1],R[0]),ah(b,p,c,t,n,P[1],R[1])}}return p}function Xp(t,e,n,a,c=1/0){let m=c,p=fl(t,[0,t.length-1]);for(let b of n)if(!(m!==1/0&&Ds(p,fl(b,[0,b.length-1]),a)>=m)&&(m=Math.min(m,u_(t,e,b,!0,a,m)),m===0))return m;return m}function Du(t,e,n,a,c=1/0){let m=c,p=fl(t,[0,t.length-1]);for(let b of n){if(m!==1/0&&Ds(p,Iu(b),a)>=m)continue;let y=Eu(t,e,b,a,m);if(isNaN(y))return y;if((m=Math.min(m,y))===0)return m}return m}function Qp(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class gl{constructor(e,n){this.type=It,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(io(e[1])){let a=e[1];if(a.type==="FeatureCollection"){for(let c=0;c<a.features.length;++c)if(Qp(a.features[c].geometry.type))return new gl(a,a.features[c].geometry)}else if(a.type==="Feature"){if(Qp(a.geometry.type))return new gl(a,a.geometry)}else if(Qp(a.type))return new gl(a,a)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),a=e.canonicalID();if(n!=null&&a!=null){if(e.geometryType()==="Point")return function(c,m,p){let b=[];for(let w of c)for(let M of w)b.push($p(M,m));let y=new nh(b[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?u_(b,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y):p.type==="MultiLineString"?Xp(b,!1,p.coordinates,y):p.type==="Polygon"||p.type==="MultiPolygon"?Du(b,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,y):null}(n,a,this.geometries);if(e.geometryType()==="LineString")return function(c,m,p){let b=[];for(let w of c){let M=[];for(let T of w)M.push($p(T,m));b.push(M)}let y=new nh(b[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Xp(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b,y);if(p.type==="MultiLineString"){let w=1/0;for(let M=0;M<p.coordinates.length;M++){let T=Xp(p.coordinates[M],!0,b,y,w);if(isNaN(T))return T;if((w=Math.min(w,T))===0)return w}return w}if(p.type==="Polygon"||p.type==="MultiPolygon"){let w=1/0;for(let M=0;M<b.length;M++){let T=Du(b[M],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,y,w);if(isNaN(T))return T;if((w=Math.min(w,T))===0)return w}return w}return null}(n,a,this.geometries);if(e.geometryType()==="Polygon")return function(c,m,p){let b=[];for(let w of function(M,T){let E=M.length;if(E<=1)return[M];let P=[],R,F;for(let B=0;B<E;B++){let W=Ay(M[B]);W!==0&&(M[B].area=Math.abs(W),F===void 0&&(F=W<0),F===W<0?(R&&P.push(R),R=[M[B]]):R.push(M[B]))}return R&&P.push(R),P}(c)){let M=[];for(let T=0;T<w.length;++T)M.push(zy(w[T],m));b.push(M)}let y=new nh(b[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Du(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b,y);if(p.type==="MultiLineString"){let w=1/0;for(let M=0;M<p.coordinates.length;M++){let T=Du(p.coordinates[M],!0,b,y,w);if(isNaN(T))return T;if((w=Math.min(w,T))===0)return w}return w}return p.type==="Polygon"||p.type==="MultiPolygon"?function(w,M,T){let E=1/0;for(let P of w)for(let R of M){let F=Ny(P,R,T,E);if(isNaN(F))return F;if((E=Math.min(E,F))===0)return E}return E}(p.type==="Polygon"?[p.coordinates]:p.coordinates,b,y):null}(n,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ic(t,e){switch(t){case"string":return Bo(e);case"number":return+e;case"boolean":return!!e;case"color":return Fi.parse(e);case"formatted":return Vr.fromString(Bo(e));case"resolvedImage":return to.fromString(Bo(e))}return e}function sh(t,e,n,a){return a!==void 0&&(t=a*Math.round(t/a)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class Tr{constructor(e,n,a){this.type=e,this.key=n,this.scope=a}static parse(e,n){let a=n.expectedType;if(a==null&&(a=Pi),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let c=n.parse(e[1],1);if(!(c instanceof qa))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let m=n.parse(e[2],2);return m instanceof qa?new Tr(a,Bo(c.value),Bo(m.value)):n.error("Scope of 'config' expression must be a string literal.")}return new Tr(a,Bo(c.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(n);if(!a)return null;let{type:c,value:m,values:p,minValue:b,maxValue:y,stepValue:w}=a,M=a.default.evaluate(e),T=M;if(m){let E=e.scope;e.scope=(E||"").split("").slice(1).join(""),T=m.evaluate(e),e.scope=E}return c&&(T=Ic(c,T)),T===void 0||b===void 0&&y===void 0&&w===void 0||(typeof T=="number"?T=sh(T,b,y,w):Array.isArray(T)&&(T=T.map(E=>typeof E=="number"?sh(E,b,y,w):E))),m!==void 0&&T!==void 0&&p&&!p.includes(T)&&(T=M,c&&(T=Ic(c,T))),(c&&c!==this.type||T!==void 0&&ar(T)!==this.type)&&(T=Ic(this.type.kind,T)),T}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Ps(t){if(t instanceof Wr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Ts||t instanceof gl)return!1;let e=!0;return t.eachChild(n=>{e&&!Ps(n)&&(e=!1)}),e}function Au(t){if(t instanceof Wr&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Au(n)&&(e=!1)}),e}function Kp(t){if(t instanceof Tr)return!1;let e=!0;return t.eachChild(n=>{e&&!Kp(n)&&(e=!1)}),e}function lh(t,e){if(t instanceof Wr&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(a=>{n&&!lh(a,e)&&(n=!1)}),n}class Pu{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let a=e[1];return n.scope.has(a)?new Pu(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ch{constructor(e,n=[],a,c=new Fp,m=[],p,b){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=c,this.errors=m,this.expectedType=a,this._scope=p,this.options=b}parse(e,n,a,c,m={}){return n||a?this.concat(n,a,c)._parse(e,m):this._parse(e,m)}_parse(e,n){function a(c,m,p){return p==="assert"?new aa(m,[c]):p==="coerce"?new sa(m,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let m=c.parse(e,this);if(!m)return null;if(this.expectedType){let p=this.expectedType,b=m.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||b.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(p,b))return null}else m=a(m,p,n.typeAnnotation||"coerce");else m=a(m,p,n.typeAnnotation||"assert")}if(!(m instanceof qa)&&m.type.kind!=="resolvedImage"&&dh(m)){let p=new i_(this._scope,this.options);try{m=new qa(m.type,m.evaluate(p))}catch(b){return this.error(b.message),null}}return m}return sa.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a){let c=typeof e=="number"?this.path.concat(e):this.path,m=a?this.scope.concat(a):this.scope;return new ch(this.registry,c,n||null,m,this.errors,this._scope,this.options)}error(e,...n){let a=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Ca(a,e))}checkSubtype(e,n){let a=Xd(e,n);return a&&this.error(a),a}}var m_=ch;function dh(t){if(t instanceof Pu)return dh(t.boundExpression);if(t instanceof Wr&&t.name==="error"||t instanceof ks||t instanceof Ts||t instanceof gl||t instanceof Tr)return!1;let e=t instanceof sa||t instanceof aa,n=!0;return t.eachChild(a=>{n=e?n&&dh(a):n&&a instanceof qa}),!!n&&Ps(t)&&lh(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ou(t,e){let n=t.length-1,a,c,m=0,p=n,b=0;for(;m<=p;)if(b=Math.floor((m+p)/2),a=t[b],c=t[b+1],a<=e){if(b===n||e<c)return b;m=b+1}else{if(!(a>e))throw new pr("Input is not a number.");p=b-1}return 0}class hh{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[c,m]of a)this.labels.push(c),this.outputs.push(m)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let a=n.parse(e[1],1,It);if(!a)return null;let c=[],m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let p=1;p<e.length;p+=2){let b=p===1?-1/0:e[p],y=e[p+1],w=p,M=p+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);let T=n.parse(y,M,m);if(!T)return null;m=m||T.type,c.push([b,T])}return new hh(m,a,c)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);let m=n.length;return c>=n[m-1]?a[m-1].evaluate(e):a[Ou(n,c)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let Ru=.95047,p_=1.08883,Jp=4/29,_l=6/29,f_=3*_l*_l,ef=_l*_l*_l,Lu=Math.PI/180,g_=180/Math.PI;function tf(t){return t>ef?Math.pow(t,1/3):t/f_+Jp}function Fu(t){return t>_l?t*t*t:f_*(t-Jp)}function nf(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function uh(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function __(t){let e=uh(t.r),n=uh(t.g),a=uh(t.b),c=tf((.4124564*e+.3575761*n+.1804375*a)/Ru),m=tf((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*m-16,a:500*(c-m),b:200*(m-tf((.0193339*e+.119192*n+.9503041*a)/p_)),alpha:t.a}}function b_(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*Fu(e),n=Ru*Fu(n),a=p_*Fu(a),new Fi(nf(3.2404542*n-1.5371385*e-.4985314*a),nf(-.969266*n+1.8760108*e+.041556*a),nf(.0556434*n-.2040259*e+1.0572252*a),t.alpha)}function Vy(t,e,n){let a=e-t;return t+n*(a>180||a<-180?a-360*Math.round(a/360):a)}let mh={forward:__,reverse:b_,interpolate:function(t,e,n){return{l:Wt(t.l,e.l,n),a:Wt(t.a,e.a,n),b:Wt(t.b,e.b,n),alpha:Wt(t.alpha,e.alpha,n)}}},Ec={forward:function(t){let{l:e,a:n,b:a}=__(t),c=Math.atan2(a,n)*g_;return{h:c<0?c+360:c,c:Math.sqrt(n*n+a*a),l:e,alpha:t.a}},reverse:function(t){let e=t.h*Lu,n=t.c;return b_({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Vy(t.h,e.h,n),c:Wt(t.c,e.c,n),l:Wt(t.l,e.l,n),alpha:Wt(t.alpha,e.alpha,n)}}};var y_=Object.freeze({__proto__:null,hcl:Ec,lab:mh});class Io{constructor(e,n,a,c,m){this.type=e,this.operator=n,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(let[p,b]of m)this.labels.push(p),this.outputs.push(b)}static interpolationFactor(e,n,a,c){let m=0;if(e.name==="exponential")m=rf(n,e.base,a,c);else if(e.name==="linear")m=rf(n,1,a,c);else if(e.name==="cubic-bezier"){let p=e.controlPoints;m=new Rd(p[0],p[1],p[2],p[3]).solve(rf(n,1,a,c))}return m}static parse(e,n){let[a,c,m,...p]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){let w=c[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{let w=c.slice(1);if(w.length!==4||w.some(M=>typeof M!="number"||M<0||M>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,It),!m)return null;let b=[],y=null;a==="interpolate-hcl"||a==="interpolate-lab"?y=eo:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let w=0;w<p.length;w+=2){let M=p[w],T=p[w+1],E=w+3,P=w+4;if(typeof M!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(b.length&&b[b.length-1][0]>=M)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',E);let R=n.parse(T,P,y);if(!R)return null;y=y||R.type,b.push([M,R])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Io(y,a,c,m,b):n.error(`Type ${$n(y)} is not interpolatable.`)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);let m=n.length;if(c>=n[m-1])return a[m-1].evaluate(e);let p=Ou(n,c),b=Io.interpolationFactor(this.interpolation,c,n[p],n[p+1]),y=a[p].evaluate(e),w=a[p+1].evaluate(e);return this.operator==="interpolate"?Su[this.type.kind.toLowerCase()](y,w,b):this.operator==="interpolate-hcl"?Ec.reverse(Ec.interpolate(Ec.forward(y),Ec.forward(w),b)):mh.reverse(mh.interpolate(mh.forward(y),mh.forward(w),b))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function rf(t,e,n,a){let c=a-n,m=t-n;return c===0?0:e===1?m/c:(Math.pow(e,m)-1)/(Math.pow(e,c)-1)}class zu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null,c=n.expectedType;c&&c.kind!=="value"&&(a=c);let m=[];for(let b of e.slice(1)){let y=n.parse(b,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!y)return null;a=a||y.type,m.push(y)}let p=c&&m.some(b=>Xd(c,b.type));return new zu(p?Pi:a,m)}evaluate(e){let n,a=null,c=0;for(let m of this.args){if(c++,a=m.evaluate(e),a&&a instanceof to&&!a.available&&(n||(n=a),a=null,c===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Bu{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let a=[];for(let m=1;m<e.length-1;m+=2){let p=e[m];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,m);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);let b=n.parse(e[m+1],m+1);if(!b)return null;a.push([p,b])}let c=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return c?new Bu(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}class of{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,It),c=n.parse(e[2],2,mo(n.expectedType||Pi));return a&&c?new of(c.type.itemType,a,c):null}evaluate(e){let n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new pr(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new pr(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new pr(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class af{constructor(e,n){this.type=Bi,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Pi),c=n.parse(e[2],2,Pi);return a&&c?zp(a.type,[Bi,zi,It,xc,Pi])?new af(a,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${$n(a.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Sc(n,["boolean","string","number","null"]))throw new pr(`Expected first argument to be of type boolean, string, number or null, but found ${$n(ar(n))} instead.`);if(!Sc(a,["string","array"]))throw new pr(`Expected second argument to be of type array or string, but found ${$n(ar(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Nu{constructor(e,n,a){this.type=It,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Pi),c=n.parse(e[2],2,Pi);if(!a||!c)return null;if(!zp(a.type,[Bi,zi,It,xc,Pi]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${$n(a.type)} instead`);if(e.length===4){let m=n.parse(e[3],3,It);return m?new Nu(a,c,m):null}return new Nu(a,c)}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Sc(n,["boolean","string","number","null"]))throw new pr(`Expected first argument to be of type boolean, string, number or null, but found ${$n(ar(n))} instead.`);if(!Sc(a,["string","array"]))throw new pr(`Expected second argument to be of type array or string, but found ${$n(ar(a))} instead.`);if(this.fromIndex){let c=this.fromIndex.evaluate(e);return a.indexOf(n,c)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Dc{constructor(e,n,a,c,m,p){this.inputType=e,this.type=n,this.input=a,this.cases=c,this.outputs=m,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);let m={},p=[];for(let w=2;w<e.length-1;w+=2){let M=e[w],T=e[w+1];Array.isArray(M)||(M=[M]);let E=n.concat(w);if(M.length===0)return E.error("Expected at least one branch label.");for(let R of M){if(typeof R!="number"&&typeof R!="string")return E.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return E.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return E.error("Numeric branch labels must be integer values.");if(a){if(E.checkSubtype(a,ar(R)))return null}else a=ar(R);if(m[String(R)]!==void 0)return E.error("Branch labels must be unique.");m[String(R)]=p.length}let P=n.parse(T,w,c);if(!P)return null;c=c||P.type,p.push(P)}let b=n.parse(e[1],1,Pi);if(!b)return null;let y=n.parse(e[e.length-1],e.length-1,c);return y?b.type.kind!=="value"&&n.concat(1).checkSubtype(a,b.type)?null:new Dc(a,c,b,m,p,y):null}evaluate(e){let n=this.input.evaluate(e);return(ar(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],c={};for(let p of n){let b=c[this.cases[p]];b===void 0?(c[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[b][1].push(p)}let m=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,b]of a)e.push(b.length===1?m(b[0]):b.map(m)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class sf{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);let c=[];for(let p=1;p<e.length-1;p+=2){let b=n.parse(e[p],p,Bi);if(!b)return null;let y=n.parse(e[p+1],p+1,a);if(!y)return null;c.push([b,y]),a=a||y.type}let m=n.parse(e[e.length-1],e.length-1,a);return m?new sf(a,c,m):null}evaluate(e){for(let[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Vu{constructor(e,n,a,c){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Pi),c=n.parse(e[2],2,It);if(!a||!c)return null;if(!zp(a.type,[mo(Pi),zi,Pi]))return n.error(`Expected first argument to be of type array or string, but found ${$n(a.type)} instead`);if(e.length===4){let m=n.parse(e[3],3,It);return m?new Vu(a.type,a,c,m):null}return new Vu(a.type,a,c)}evaluate(e){let n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Sc(n,["string","array"]))throw new pr(`Expected first argument to be of type array or string, but found ${$n(ar(n))} instead.`);if(this.endIndex){let c=this.endIndex.evaluate(e);return n.slice(a,c)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ph(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function v_(t,e,n,a){return a.compare(e,n)===0}function bl(t,e,n){let a=t!=="=="&&t!=="!=";return class oI{constructor(m,p,b){this.type=Bi,this.lhs=m,this.rhs=p,this.collator=b,this.hasUntypedArgument=m.type.kind==="value"||p.type.kind==="value"}static parse(m,p){if(m.length!==3&&m.length!==4)return p.error("Expected two or three arguments.");let b=m[0],y=p.parse(m[1],1,Pi);if(!y)return null;if(!ph(b,y.type))return p.concat(1).error(`"${b}" comparisons are not supported for type '${$n(y.type)}'.`);let w=p.parse(m[2],2,Pi);if(!w)return null;if(!ph(b,w.type))return p.concat(2).error(`"${b}" comparisons are not supported for type '${$n(w.type)}'.`);if(y.type.kind!==w.type.kind&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${$n(y.type)}' and '${$n(w.type)}'.`);a&&(y.type.kind==="value"&&w.type.kind!=="value"?y=new aa(w.type,[y]):y.type.kind!=="value"&&w.type.kind==="value"&&(w=new aa(y.type,[w])));let M=null;if(m.length===4){if(y.type.kind!=="string"&&w.type.kind!=="string"&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(M=p.parse(m[3],3,oa),!M)return null}return new oI(y,w,M)}evaluate(m){let p=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){let y=ar(p),w=ar(b);if(y.kind!==w.kind||y.kind!=="string"&&y.kind!=="number")throw new pr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${w.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let y=ar(p),w=ar(b);if(y.kind!=="string"||w.kind!=="string")return e(m,p,b)}return this.collator?n(m,p,b,this.collator.evaluate(m)):e(m,p,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){let m=[t];return this.eachChild(p=>{m.push(p.serialize())}),m}}}let jy=bl("==",function(t,e,n){return e===n},v_),x_=bl("!=",function(t,e,n){return e!==n},function(t,e,n,a){return!v_(0,e,n,a)}),w_=bl("<",function(t,e,n){return e<n},function(t,e,n,a){return a.compare(e,n)<0}),C_=bl(">",function(t,e,n){return e>n},function(t,e,n,a){return a.compare(e,n)>0}),S_=bl("<=",function(t,e,n){return e<=n},function(t,e,n,a){return a.compare(e,n)<=0}),lf=bl(">=",function(t,e,n){return e>=n},function(t,e,n,a){return a.compare(e,n)>=0});class fh{constructor(e,n,a,c,m,p){this.type=zi,this.number=e,this.locale=n,this.currency=a,this.unit=c,this.minFractionDigits=m,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let a=n.parse(e[1],1,It);if(!a)return null;let c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,zi),!m))return null;let p=null;if(c.currency&&(p=n.parse(c.currency,1,zi),!p))return null;let b=null;if(c.unit&&(b=n.parse(c.unit,1,zi),!b))return null;let y=null;if(c["min-fraction-digits"]&&(y=n.parse(c["min-fraction-digits"],1,It),!y))return null;let w=null;return c["max-fraction-digits"]&&(w=n.parse(c["max-fraction-digits"],1,It),!w)?null:new fh(a,m,p,b,y,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class cf{constructor(e){this.type=It,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${$n(a.type)} instead.`):new cf(a):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new pr(`Expected value to be of type string or array, but found ${$n(ar(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function M_(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let yl={"==":jy,"!=":x_,">":C_,"<":w_,">=":lf,"<=":S_,array:aa,at:of,boolean:aa,case:sf,coalesce:zu,collator:ks,format:Kd,image:Jd,in:af,"index-of":Nu,interpolate:Io,"interpolate-hcl":Io,"interpolate-lab":Io,length:cf,let:Bu,literal:qa,match:Dc,number:aa,"number-format":fh,object:aa,slice:Vu,step:hh,string:aa,"to-boolean":sa,"to-color":sa,"to-number":sa,"to-string":sa,var:Pu,within:Ts,distance:gl,config:Tr};function k_(t,[e,n,a,c]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let m=c?c.evaluate(t):1,p=e_(e,n,a,m);if(p)throw new pr(p);return new Fi(e/255*m,n/255*m,a/255*m,m)}function T_(t,[e,n,a,c]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let m=c?c.evaluate(t):1,p=function(w,M,T,E){return typeof w=="number"&&w>=0&&w<=360?typeof M=="number"&&M>=0&&M<=100&&typeof T=="number"&&T>=0&&T<=100?E===void 0||typeof E=="number"&&E>=0&&E<=1?null:`Invalid hsla value [${[w,M,T,E].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof E=="number"?[w,M,T,E]:[w,M,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof E=="number"?[w,M,T,E]:[w,M,T]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,a,m);if(p)throw new pr(p);let b=`hsla(${e}, ${n}%, ${a}%, ${m})`,y=Fi.parse(b);if(!y)throw new pr(`Failed to parse HSLA color: ${b}`);return y}function I_(t,e){return t in e}function df(t,e){let n=e[t];return n===void 0?null:n}function vl(t){return{type:t}}function E_(t){return{result:"success",value:t}}function xl(t){return{result:"error",value:t}}function D_(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function ju(t){return t["property-type"]==="data-driven"}function Uy(t){return D_(t.expression,"measure-light")}function f(t){return D_(t.expression,"zoom")}function r(t){return!!t.expression&&t.expression.interpolated}function h(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function g(t){return t}function v(t,e){let n=e.type==="color",a=t.stops&&typeof t.stops[0][0]=="object",c=a||!(a||t.property!==void 0),m=t.type||(r(e)?"exponential":"interval");if(n&&((t=Lp({},t)).stops&&(t.stops=t.stops.map(w=>[w[0],Fi.parse(w[1])])),t.default=Fi.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!y_[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,b,y;if(m==="exponential")p=D;else if(m==="interval")p=k;else if(m==="categorical"){p=S,b=Object.create(null);for(let w of t.stops)b[w[0]]=w[1];y=typeof t.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);p=A}if(a){let w={},M=[];for(let P=0;P<t.stops.length;P++){let R=t.stops[P],F=R[0].zoom;w[F]===void 0&&(w[F]={zoom:F,type:t.type,property:t.property,default:t.default,stops:[]},M.push(F)),w[F].stops.push([R[0].value,R[1]])}let T=[];for(let P of M)T.push([w[P].zoom,v(w[P],e)]);let E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:Io.interpolationFactor.bind(void 0,E),zoomStops:T.map(P=>P[0]),evaluate:({zoom:P},R)=>D({stops:T,base:t.base},e,P).evaluate(P,R)}}if(c){let w=m==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Io.interpolationFactor.bind(void 0,w),zoomStops:t.stops.map(M=>M[0]),evaluate:({zoom:M})=>p(t,e,M,b,y)}}return{kind:"source",evaluate(w,M){let T=M&&M.properties?M.properties[t.property]:void 0;return T===void 0?x(t.default,e.default):p(t,e,T,b,y)}}}function x(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function S(t,e,n,a,c){return x(typeof n===c?a[n]:void 0,t.default,e.default)}function k(t,e,n){if(pl(n)!=="number")return x(t.default,e.default);let a=t.stops.length;if(a===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[a-1][0])return t.stops[a-1][1];let c=Ou(t.stops.map(m=>m[0]),n);return t.stops[c][1]}function D(t,e,n){let a=t.base!==void 0?t.base:1;if(pl(n)!=="number")return x(t.default,e.default);let c=t.stops.length;if(c===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[c-1][0])return t.stops[c-1][1];let m=Ou(t.stops.map(M=>M[0]),n),p=function(M,T,E,P){let R=P-E,F=M-E;return R===0?0:T===1?F/R:(Math.pow(T,F)-1)/(Math.pow(T,R)-1)}(n,a,t.stops[m][0],t.stops[m+1][0]),b=t.stops[m][1],y=t.stops[m+1][1],w=Su[e.type]||g;if(t.colorSpace&&t.colorSpace!=="rgb"){let M=y_[t.colorSpace];w=(T,E)=>M.reverse(M.interpolate(M.forward(T),M.forward(E),p))}return typeof b.evaluate=="function"?{evaluate(...M){let T=b.evaluate.apply(void 0,M),E=y.evaluate.apply(void 0,M);if(T!==void 0&&E!==void 0)return w(T,E,p)}}:w(b,y,p)}function A(t,e,n){return e.type==="color"?n=Fi.parse(n):e.type==="formatted"?n=Vr.fromString(n.toString()):e.type==="resolvedImage"?n=to.fromString(n.toString()):pl(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),x(n,t.default,e.default)}Wr.register(yl,{error:[{kind:"error"},[zi],(t,[e])=>{throw new pr(e.evaluate(t))}],typeof:[zi,[Pi],(t,[e])=>$n(ar(e.evaluate(t)))],"to-rgba":[mo(It,4),[eo],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[eo,[It,It,It],k_],rgba:[eo,[It,It,It,It],k_],hsl:[eo,[It,It,It],T_],hsla:[eo,[It,It,It,It],T_],has:{type:Bi,overloads:[[[zi],(t,[e])=>I_(e.evaluate(t),t.properties())],[[zi,wc],(t,[e,n])=>I_(e.evaluate(t),n.evaluate(t))]]},get:{type:Pi,overloads:[[[zi],(t,[e])=>df(e.evaluate(t),t.properties())],[[zi,wc],(t,[e,n])=>df(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Pi,[zi],(t,[e])=>df(e.evaluate(t),t.featureState||{})],properties:[wc,[],t=>t.properties()],"geometry-type":[zi,[],t=>t.geometryType()],id:[Pi,[],t=>t.id()],zoom:[It,[],t=>t.globals.zoom],pitch:[It,[],t=>t.globals.pitch||0],"distance-from-center":[It,[],t=>t.distanceFromCenter()],"measure-light":[It,[zi],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[It,[],t=>t.globals.heatmapDensity||0],"line-progress":[It,[],t=>t.globals.lineProgress||0],"raster-value":[It,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[It,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[It,[],t=>t.globals.skyRadialProgress||0],accumulated:[Pi,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[It,vl(It),(t,e)=>{let n=0;for(let a of e)n+=a.evaluate(t);return n}],"*":[It,vl(It),(t,e)=>{let n=1;for(let a of e)n*=a.evaluate(t);return n}],"-":{type:It,overloads:[[[It,It],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[It],(t,[e])=>-e.evaluate(t)]]},"/":[It,[It,It],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[It,[It,It],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[It,[],()=>Math.LN2],pi:[It,[],()=>Math.PI],e:[It,[],()=>Math.E],"^":[It,[It,It],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[It,[It],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[It,[It],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[It,[It],(t,[e])=>Math.log(e.evaluate(t))],log2:[It,[It],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[It,[It],(t,[e])=>Math.sin(e.evaluate(t))],cos:[It,[It],(t,[e])=>Math.cos(e.evaluate(t))],tan:[It,[It],(t,[e])=>Math.tan(e.evaluate(t))],asin:[It,[It],(t,[e])=>Math.asin(e.evaluate(t))],acos:[It,[It],(t,[e])=>Math.acos(e.evaluate(t))],atan:[It,[It],(t,[e])=>Math.atan(e.evaluate(t))],min:[It,vl(It),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[It,vl(It),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[It,[It],(t,[e])=>Math.abs(e.evaluate(t))],round:[It,[It],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[It,[It],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[It,[It],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Bi,[zi,Pi],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Bi,[Pi],(t,[e])=>t.id()===e.value],"filter-type-==":[Bi,[zi],(t,[e])=>t.geometryType()===e.value],"filter-<":[Bi,[zi,Pi],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Bi,[Pi],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[Bi,[zi,Pi],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a>c}],"filter-id->":[Bi,[Pi],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[Bi,[zi,Pi],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Bi,[Pi],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[Bi,[zi,Pi],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Bi,[Pi],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[Bi,[Pi],(t,[e])=>e.value in t.properties()],"filter-has-id":[Bi,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Bi,[mo(zi)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Bi,[mo(Pi)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Bi,[zi,mo(Pi)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Bi,[zi,mo(Pi)],(t,[e,n])=>function(a,c,m,p){for(;m<=p;){let b=m+p>>1;if(c[b]===a)return!0;c[b]>a?p=b-1:m=b+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Bi,overloads:[[[Bi,Bi],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[vl(Bi),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Bi,overloads:[[[Bi,Bi],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[vl(Bi),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Bi,[Bi],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Bi,[zi],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[zi,[zi],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[zi,[zi],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[zi,vl(Pi),(t,e)=>e.map(n=>Bo(n.evaluate(t))).join("")],"resolved-locale":[zi,[oa],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[It,[It,It,Pi],(t,e)=>{let[n,a,c]=e.map(p=>p.evaluate(t));if(n>a||n===a)return n;let m;if(typeof c=="string")m=function(p){let b=0;if(p.length===0)return b;for(let y=0;y<p.length;y++)b=(b<<5)-b+p.charCodeAt(y),b|=0;return b}(c);else{if(typeof c!="number")throw new pr(`Invalid seed input: ${c}`);m=c}return n+M_(m)()*(a-n)}]});class L{constructor(e,n,a,c){this.expression=e,this._warningHistory={},this._evaluator=new i_(a,c),this._defaultValue=n?function(m){return m.type==="color"&&(h(m.default)||Array.isArray(m.default))?new Fi(0,0,0,0):m.type==="color"?Fi.parse(m.default)||null:m.default===void 0?null:m.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,a,c,m,p,b,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,c,m,p,b,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=y||null;try{let w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new pr(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function z(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in yl}function U(t,e,n,a){let c=new m_(yl,[],e?function(p){let b={color:eo,string:zi,number:It,enum:zi,boolean:Bi,formatted:Cc,resolvedImage:Sa};return p.type==="array"?mo(b[p.value]||Pi,p.length):b[p.type]}(e):void 0,void 0,void 0,n,a),m=c.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?E_(new L(m,e,n,a)):xl(c.errors)}class H{constructor(e,n,a){this.kind=e,this._styleExpression=n,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!Au(n.expression),this.isConfigDependent=!Kp(n.expression)}evaluateWithoutErrorHandling(e,n,a,c,m,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,m,p)}evaluate(e,n,a,c,m,p){return this._styleExpression.evaluate(e,n,a,c,m,p)}}class ${constructor(e,n,a,c,m){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Au(n.expression),this.isLightConstant=m,this.isConfigDependent=!Kp(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,a,c,m,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,m,p)}evaluate(e,n,a,c,m,p){return this._styleExpression.evaluate(e,n,a,c,m,p)}interpolationFactor(e,n,a){return this.interpolationType?Io.interpolationFactor(this.interpolationType,e,n,a):0}}function Y(t,e,n,a){if((t=U(t,e,n,a)).result==="error")return t;let c=t.value.expression,m=Ps(c);if(!m&&!ju(e))return xl([new Ca("","data expressions not supported")]);let p=lh(c,["zoom","pitch","distance-from-center"]);if(!p&&!f(e))return xl([new Ca("","zoom expressions not supported")]);let b=lh(c,["measure-light"]);if(!b&&!Uy(e))return xl([new Ca("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,w=Q(c);return w||p||y?w instanceof Ca?xl([w]):w instanceof Io&&!r(e)?xl([new Ca("",'"interpolate" expressions cannot be used with this property')]):E_(w?new $(m?"camera":"composite",t.value,w.labels,w instanceof Io?w.interpolation:void 0,b):new H(m?"constant":"source",t.value,b)):xl([new Ca("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Z{constructor(e,n){this._parameters=e,this._specification=n,Lp(this,v(this._parameters,this._specification))}static deserialize(e){return new Z(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Q(t){let e=null;if(t instanceof Bu)e=Q(t.result);else if(t instanceof zu){for(let n of t.args)if(e=Q(n),e)break}else(t instanceof hh||t instanceof Io)&&t.input instanceof Wr&&t.input.name==="zoom"&&(e=t);return e instanceof Ca||t.eachChild(n=>{let a=Q(n);a instanceof Ca?e=a:e&&a&&e!==a&&(e=new Ca("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var re=ae,oe=3;function ae(t,e,n){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var m=0;m<this.d*this.d;m++){var p=c[oe+m],b=c[oe+m+1];a.push(p===b?null:c.subarray(p,b))}var y=c[oe+a.length+1];this.keys=c.subarray(c[oe+a.length],y),this.bboxes=c.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var w=0;w<this.d*this.d;w++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var M=n/e*t;this.min=-M,this.max=t+M}ae.prototype.insert=function(t,e,n,a,c){this._forEachCell(e,n,a,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(c)},ae.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ae.prototype._insertCell=function(t,e,n,a,c,m){this.cells[c].push(m)},ae.prototype.query=function(t,e,n,a,c){var m=this.min,p=this.max;if(t<=m&&e<=m&&p<=n&&p<=a&&!c)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(t,e,n,a,this._queryCell,b,{},c),b},ae.prototype._queryCell=function(t,e,n,a,c,m,p,b){var y=this.cells[c];if(y!==null)for(var w=this.keys,M=this.bboxes,T=0;T<y.length;T++){var E=y[T];if(p[E]===void 0){var P=4*E;(b?b(M[P+0],M[P+1],M[P+2],M[P+3]):t<=M[P+2]&&e<=M[P+3]&&n>=M[P+0]&&a>=M[P+1])?(p[E]=!0,m.push(w[E])):p[E]=!1}}},ae.prototype._forEachCell=function(t,e,n,a,c,m,p,b){for(var y=this._convertToCellCoord(t),w=this._convertToCellCoord(e),M=this._convertToCellCoord(n),T=this._convertToCellCoord(a),E=y;E<=M;E++)for(var P=w;P<=T;P++){var R=this.d*P+E;if((!b||b(this._convertFromCellCoord(E),this._convertFromCellCoord(P),this._convertFromCellCoord(E+1),this._convertFromCellCoord(P+1)))&&c.call(this,t,e,n,a,R,m,p,b))return}},ae.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ae.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ae.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=oe+this.cells.length+1+1,n=0,a=0;a<this.cells.length;a++)n+=this.cells[a].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var m=e,p=0;p<t.length;p++){var b=t[p];c[oe+p]=m,c.set(b,m),m+=b.length}return c[oe+t.length]=m,c.set(this.keys,m),c[oe+t.length+1]=m+=this.keys.length,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer};var ge=Xe(re);let fe={};function ne(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),fe[e]={klass:t,omit:n.omit||[]}}ne(Object,"Object"),ge.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},ge.deserialize=function(t){return new ge(t.buffer)},Object.defineProperty(ge,"name",{value:"Grid"}),ne(ge,"Grid"),ne(Fi,"Color"),ne(Error,"Error"),ne(Vr,"Formatted"),ne(ml,"FormattedSection"),ne(Tp,"AJAXError"),ne(to,"ResolvedImage"),ne(Z,"StylePropertyFunction"),ne(L,"StyleExpression",{omit:["_evaluator"]}),ne($,"ZoomDependentExpression"),ne(H,"ZoomConstantExpression"),ne(Wr,"CompoundExpression",{omit:["_evaluate"]});for(let t in yl)fe[yl[t]._classRegistryKey]||ne(yl[t],`Expression${t}`);function se(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function le(t){return self.ImageBitmap&&t instanceof ImageBitmap}function we(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(se(t)||le(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let a of t)n.push(we(a,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[a,c]of t.entries())n[a]=we(c);return n}if(typeof t=="object"){let n=t.constructor,a=n._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);let c=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let m in t)t.hasOwnProperty(m)&&(fe[a].omit.indexOf(m)>=0||(c[m]=we(t[m],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof t)}function Oe(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||se(t)||le(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Oe);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let c=new Map;for(let m of Object.keys(t))m!=="$name"&&c.set(m,Oe(t[m]));return c}let{klass:n}=fe[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let a=Object.create(n.prototype);for(let c of Object.keys(t))c!=="$name"&&(a[c]=Oe(t[c]));return a}throw new Error("can't deserialize object of type "+typeof t)}let ue={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Re(t){for(let e of t)if(Je(e.charCodeAt(0)))return!0;return!1}function Be(t){for(let e of t)if(!Qe(e.charCodeAt(0)))return!1;return!0}function Qe(t){return!(ue.Arabic(t)||ue["Arabic Supplement"](t)||ue["Arabic Extended-A"](t)||ue["Arabic Presentation Forms-A"](t)||ue["Arabic Presentation Forms-B"](t))}function Je(t){return!(t!==746&&t!==747&&(t<4352||!(ue["Bopomofo Extended"](t)||ue.Bopomofo(t)||ue["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ue["CJK Compatibility Ideographs"](t)||ue["CJK Compatibility"](t)||ue["CJK Radicals Supplement"](t)||ue["CJK Strokes"](t)||!(!ue["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||ue["CJK Unified Ideographs Extension A"](t)||ue["CJK Unified Ideographs"](t)||ue["Enclosed CJK Letters and Months"](t)||ue["Hangul Compatibility Jamo"](t)||ue["Hangul Jamo Extended-A"](t)||ue["Hangul Jamo Extended-B"](t)||ue["Hangul Jamo"](t)||ue["Hangul Syllables"](t)||ue.Hiragana(t)||ue["Ideographic Description Characters"](t)||ue.Kanbun(t)||ue["Kangxi Radicals"](t)||ue["Katakana Phonetic Extensions"](t)||ue.Katakana(t)&&t!==12540||!(!ue["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!ue["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ue["Unified Canadian Aboriginal Syllabics"](t)||ue["Unified Canadian Aboriginal Syllabics Extended"](t)||ue["Vertical Forms"](t)||ue["Yijing Hexagram Symbols"](t)||ue["Yi Syllables"](t)||ue["Yi Radicals"](t))))}function Ze(t){return!(Je(t)||function(e){return!!(ue["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ue["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ue["Letterlike Symbols"](e)||ue["Number Forms"](e)||ue["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ue["Control Pictures"](e)&&e!==9251||ue["Optical Character Recognition"](e)||ue["Enclosed Alphanumerics"](e)||ue["Geometric Shapes"](e)||ue["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ue["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ue["CJK Symbols and Punctuation"](e)||ue.Katakana(e)||ue["Private Use Area"](e)||ue["CJK Compatibility Forms"](e)||ue["Small Form Variants"](e)||ue["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Ie(t){return t>=1424&&t<=2303||ue["Arabic Presentation Forms-A"](t)||ue["Arabic Presentation Forms-B"](t)}function Ve(t,e){return!(!e&&Ie(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ue.Khmer(t))}function Ye(t){for(let e of t)if(Ie(e.charCodeAt(0)))return!0;return!1}let ft="deferred",_t="loading",kt="loaded",bt=null,it="unavailable",Ge=null,Dt=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(it="error"),bt&&bt(t)};function ri(){ei.fire(new Jr("pluginStateChange",{pluginStatus:it,pluginURL:Ge}))}let ei=new ul,gi=function(){return it},Ii=function(){if(it!==ft||!Ge)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");it=_t,ri(),Ge&&dl({url:Ge},t=>{t?Dt(t):(it=kt,ri())})},Ji={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>it===kt||Ji.applyArabicShaping!=null,isLoading:()=>it===_t,setState(t){it=t.pluginStatus,Ge=t.pluginURL},isParsed:()=>Ji.applyArabicShaping!=null&&Ji.processBidirectionalText!=null&&Ji.processStyledBidirectionalText!=null,getPluginURL:()=>Ge};class Qt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,a){for(let c of n)if(!Ve(c.charCodeAt(0),a))return!1;return!0}(e,Ji.isLoaded())}}class Hi{constructor(e,n,a,c){this.property=e,this.value=n,this.expression=function(m,p,b,y){if(h(m))return new Z(m,p);if(z(m)||Array.isArray(m)&&m.length>0){let w=Y(m,p,b,y);if(w.result==="error")throw new Error(w.value.map(M=>`${M.key}: ${M.message}`).join(", "));return w.value}{let w=m;return typeof m=="string"&&p.type==="color"&&(w=Fi.parse(m)),{kind:"constant",isConfigDependent:!1,evaluate:()=>w}}}(n===void 0?e.specification.default:n,e.specification,a,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class dn{constructor(e,n,a){this.property=e,this.value=new Hi(e,void 0,n,a)}transitioned(e,n){return new yi(this.property,this.value,n,Nr({},e.transition,this.transition),e.now)}untransitioned(){return new yi(this.property,this.value,null,{},0)}}class Xi{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return xa(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new dn(this._values[e].property,this._scope,this._options)),this._values[e].value=new Hi(this._values[e].property,n===null?void 0:xa(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let a=this._properties.properties;if(e)for(let c in e){let m=e[c];if(zd(c,"-transition")){let p=c.slice(0,-11);a[p]&&this.setTransition(p,m)}else a.hasOwnProperty(c)&&this.setValue(c,m)}}getTransition(e){return xa(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new dn(this._values[e].property)),this._values[e].transition=xa(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a);let c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){let a=new ti(this._properties);for(let c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,n._values[c]);return a}untransitioned(){let e=new ti(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class yi{constructor(e,n,a,c,m){let p=c.delay||0,b=c.duration||0;m=m||0,this.property=e,this.value=n,this.begin=m+p,this.end=this.begin+b,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){let c=e.now||0,m=this.value.possiblyEvaluate(e,n,a),p=this.prior;if(p){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return p.possiblyEvaluate(e,n,a);{let b=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,a),m,pp(b))}}return m}}class ti{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){let c=new tn(this._properties);for(let m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,n,a);return c}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fn{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return xa(this._values[e].value)}setValue(e,n){this._values[e]=new Hi(this._values[e].property,n===null?void 0:xa(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){let c=new tn(this._properties);for(let m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,n,a);return c}}class yn{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,c){return this.property.evaluate(this.value,this.parameters,e,n,a,c)}}class tn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ke{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){let c=Su[this.specification.type];return c?c(e,n,a):e}}class wt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,c){return new yn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,c)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new yn(this,{kind:"constant",value:void 0},e.parameters);let c=Su[this.specification.type];return c?new yn(this,{kind:"constant",value:c(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,c,m,p){return e.kind==="constant"?e.value:e.evaluate(n,a,c,m,p)}}class Dn{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,c){return!!e.expression.evaluate(n,null,{},a,c)}interpolate(){return!1}}class Wi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new Qt(0,{});for(let a in e){let c=e[a];c.specification.overridable&&this.overridableProperties.push(a);let m=this.defaultPropertyValues[a]=new Hi(c,void 0),p=this.defaultTransitionablePropertyValues[a]=new dn(c);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=m.possiblyEvaluate(n)}}}ne(wt,"DataDrivenProperty"),ne(Ke,"DataConstantProperty"),ne(Dn,"ColorRampProperty");var Pe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Eo(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ir(t){if(Array.isArray(t))return t.map(Ir);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=Ir(t[n]);return e}return Eo(t)}function Gr(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Gr(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function fr(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gr(t)||(t=ka(t));let n=t,a=!0;try{a=function(w){if(!Do(w))return w;let M=Ir(w);return da(M),M=no(M),M}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let c=Pe[`filter_${e}`],m=U(a,c),p=null;if(m.result==="error")throw new Error(m.value.map(w=>`${w.key}: ${w.message}`).join(", "));p=(w,M,T)=>m.value.evaluate(w,M,{},T);let b=null,y=null;if(a!==n){let w=U(n,c);if(w.result==="error")throw new Error(w.value.map(M=>`${M.key}: ${M.message}`).join(", "));b=(M,T,E,P,R)=>w.value.evaluate(M,T,{},E,void 0,void 0,P,R),y=!Ps(w.value.expression)}return{filter:p,dynamicFilter:b||void 0,needGeometry:Ya(a),needFeature:!!y}}function no(t){if(!Array.isArray(t))return t;let e=function(n){if(Os.has(n[0])){for(let a=1;a<n.length;a++)if(Do(n[a]))return!0}return n}(t);return e===!0?e:e.map(n=>no(n))}function da(t){let e=!1,n=[];if(t[0]==="case"){for(let a=1;a<t.length-1;a+=2)e=e||Do(t[a]),n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||Do(t[1]);for(let a=2;a<t.length-1;a+=2)n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||Do(t[1]);for(let a=1;a<t.length-1;a+=2)n.push(t[a+1])}e&&(t.length=0,t.push("any",...n));for(let a=1;a<t.length;a++)da(t[a])}function Do(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(Do(t[n]))return!0;return!1}let Os=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Rs(t,e){return t<e?-1:t>e?1:0}function Ya(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Ya(t[e]))return!0;return!1}function ka(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?Za(t[1],t[2],"=="):e==="!="?wl(Za(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Za(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(ka))):e==="all"?["all"].concat(t.slice(1).map(ka)):e==="none"?["all"].concat(t.slice(1).map(ka).map(wl)):e==="in"?Ac(t[1],t.slice(2)):e==="!in"?wl(Ac(t[1],t.slice(2))):e==="has"?Pc(t[1]):e!=="!has"||wl(Pc(t[1]));var n}function Za(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Ac(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Rs)]]:["filter-in-small",t,["literal",e]]}}function Pc(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function wl(t){return["!",t]}let Oc="";function Uu(t,e){return e?`${t}${Oc}${e}`:t}let Hu="-transition",hf=new Set(["fill","line","background","hillshade","raster"]);class cr extends ul{constructor(e,n,a,c,m){if(super(),this.id=e.id,this.fqid=Uu(this.id,a),this.type=e.type,this.scope=a,this.lut=c,this.options=m,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new fn(n.layout,this.scope,m),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new Xi(n.paint,this.scope,m);for(let p in e.paint)this.setPaintProperty(p,e.paint[p]);for(let p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new tn(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return hf.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return zd(e,Hu)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let a=this._transitionablePaint,c=a._properties.properties;if(zd(e,Hu)){let T=e.slice(0,-11);return c[T]&&a.setTransition(T,n||void 0),!1}if(!c[e])return!1;let m=a._values[e],p=m.value.isDataDriven(),b=m.value;a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=a._values[e].value,w=y.isDataDriven(),M=zd(e,"pattern")||e==="line-dasharray";return w||p||M||this._handleOverridablePaintPropertyUpdate(e,b,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,a){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return ll({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof yn&&ju(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=fr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,a,c,m,p,b,y,w){}queryIntersectsMatchingFeature(e,n,a,c){}}let uf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rc{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Mn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Gi(t,e=1){let n=0,a=0;return{members:t.map(c=>{let m=uf[c.type].BYTES_PER_ELEMENT,p=n=cC(n,Math.max(e,m)),b=c.components||1;return a=Math.max(a,m),n+=m*b,{name:c.name,type:c.type,components:b,offset:p}}),size:cC(n,Math.max(a,e)),alignment:e}}function cC(t,e){return Math.ceil(t/e)*e}class Xa extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.int16[c+0]=n,this.int16[c+1]=a,e}}Xa.prototype.bytesPerElement=4,ne(Xa,"StructArrayLayout2i4");class A_ extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let m=3*e;return this.int16[m+0]=n,this.int16[m+1]=a,this.int16[m+2]=c,e}}A_.prototype.bytesPerElement=6,ne(A_,"StructArrayLayout3i6");class Lc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=4*e;return this.int16[p+0]=n,this.int16[p+1]=a,this.int16[p+2]=c,this.int16[p+3]=m,e}}Lc.prototype.bytesPerElement=8,ne(Lc,"StructArrayLayout4i8");class Hy extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,m)}emplace(e,n,a,c,m,p){let b=5*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=c,this.int16[b+3]=m,this.int16[b+4]=p,e}}Hy.prototype.bytesPerElement=10,ne(Hy,"StructArrayLayout5i10");class Wy extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,m,p,b)}emplace(e,n,a,c,m,p,b,y){let w=6*e,M=12*e,T=3*e;return this.int16[w+0]=n,this.int16[w+1]=a,this.uint8[M+4]=c,this.uint8[M+5]=m,this.uint8[M+6]=p,this.uint8[M+7]=b,this.float32[T+2]=y,e}}Wy.prototype.bytesPerElement=12,ne(Wy,"StructArrayLayout2i4ub1f12");class Fc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=4*e;return this.float32[p+0]=n,this.float32[p+1]=a,this.float32[p+2]=c,this.float32[p+3]=m,e}}Fc.prototype.bytesPerElement=16,ne(Fc,"StructArrayLayout4f16");class zc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let m=3*e;return this.float32[m+0]=n,this.float32[m+1]=a,this.float32[m+2]=c,e}}zc.prototype.bytesPerElement=12,ne(zc,"StructArrayLayout3f12");class Bc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,m)}emplace(e,n,a,c,m,p){let b=6*e,y=3*e;return this.uint16[b+0]=n,this.uint16[b+1]=a,this.uint16[b+2]=c,this.uint16[b+3]=m,this.float32[y+2]=p,e}}Bc.prototype.bytesPerElement=12,ne(Bc,"StructArrayLayout4ui1f12");class P_ extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=a,this.uint16[p+2]=c,this.uint16[p+3]=m,e}}P_.prototype.bytesPerElement=8,ne(P_,"StructArrayLayout4ui8");class O_ extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,c,m,p)}emplace(e,n,a,c,m,p,b){let y=6*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=c,this.int16[y+3]=m,this.int16[y+4]=p,this.int16[y+5]=b,e}}O_.prototype.bytesPerElement=12,ne(O_,"StructArrayLayout6i12");class Gy extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E){let P=this.length;return this.resize(P+1),this.emplace(P,e,n,a,c,m,p,b,y,w,M,T,E)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P){let R=12*e;return this.int16[R+0]=n,this.int16[R+1]=a,this.int16[R+2]=c,this.int16[R+3]=m,this.uint16[R+4]=p,this.uint16[R+5]=b,this.uint16[R+6]=y,this.uint16[R+7]=w,this.int16[R+8]=M,this.int16[R+9]=T,this.int16[R+10]=E,this.int16[R+11]=P,e}}Gy.prototype.bytesPerElement=24,ne(Gy,"StructArrayLayout4i4ui4i24");class qy extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,c,m,p)}emplace(e,n,a,c,m,p,b){let y=10*e,w=5*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=c,this.float32[w+2]=m,this.float32[w+3]=p,this.float32[w+4]=b,e}}qy.prototype.bytesPerElement=20,ne(qy,"StructArrayLayout3i3f20");class $y extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}$y.prototype.bytesPerElement=4,ne($y,"StructArrayLayout1ul4");class gh extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}gh.prototype.bytesPerElement=4,ne(gh,"StructArrayLayout1f4");class Nc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=a,e}}Nc.prototype.bytesPerElement=4,ne(Nc,"StructArrayLayout2ui4");class Yy extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E,P){let R=this.length;return this.resize(R+1),this.emplace(R,e,n,a,c,m,p,b,y,w,M,T,E,P)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P,R){let F=20*e,B=10*e;return this.int16[F+0]=n,this.int16[F+1]=a,this.int16[F+2]=c,this.int16[F+3]=m,this.int16[F+4]=p,this.float32[B+3]=b,this.float32[B+4]=y,this.float32[B+5]=w,this.float32[B+6]=M,this.int16[F+14]=T,this.uint32[B+8]=E,this.uint16[F+18]=P,this.uint16[F+19]=R,e}}Yy.prototype.bytesPerElement=40,ne(Yy,"StructArrayLayout5i4f1i1ul2ui40");class R_ extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,m,p,b)}emplace(e,n,a,c,m,p,b,y){let w=8*e;return this.int16[w+0]=n,this.int16[w+1]=a,this.int16[w+2]=c,this.int16[w+4]=m,this.int16[w+5]=p,this.int16[w+6]=b,this.int16[w+7]=y,e}}R_.prototype.bytesPerElement=16,ne(R_,"StructArrayLayout3i2i2i16");class Zy extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,m)}emplace(e,n,a,c,m,p){let b=4*e,y=8*e;return this.float32[b+0]=n,this.float32[b+1]=a,this.float32[b+2]=c,this.int16[y+6]=m,this.int16[y+7]=p,e}}Zy.prototype.bytesPerElement=16,ne(Zy,"StructArrayLayout2f1f2i16");class Xy extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=12*e,b=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=a,this.float32[b+1]=c,this.float32[b+2]=m,e}}Xy.prototype.bytesPerElement=12,ne(Xy,"StructArrayLayout2ub2f12");class wr extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let m=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=a,this.uint16[m+2]=c,e}}wr.prototype.bytesPerElement=6,ne(wr,"StructArrayLayout3ui6");class Qy extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,me){let he=this.length;return this.resize(he+1),this.emplace(he,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,me)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,me,he){let ve=30*e,Ce=15*e,De=60*e;return this.int16[ve+0]=n,this.int16[ve+1]=a,this.int16[ve+2]=c,this.float32[Ce+2]=m,this.float32[Ce+3]=p,this.uint16[ve+8]=b,this.uint16[ve+9]=y,this.uint32[Ce+5]=w,this.uint32[Ce+6]=M,this.uint32[Ce+7]=T,this.uint16[ve+16]=E,this.uint16[ve+17]=P,this.uint16[ve+18]=R,this.float32[Ce+10]=F,this.float32[Ce+11]=B,this.uint8[De+48]=W,this.uint8[De+49]=J,this.uint8[De+50]=ee,this.uint32[Ce+13]=te,this.int16[ve+28]=me,this.uint8[De+58]=he,e}}Qy.prototype.bytesPerElement=60,ne(Qy,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ky extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,me,he,ve,Ce,De,Ue,ze,$e,rt,We,et,He,tt,st){let nt=this.length;return this.resize(nt+1),this.emplace(nt,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,me,he,ve,Ce,De,Ue,ze,$e,rt,We,et,He,tt,st)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,me,he,ve,Ce,De,Ue,ze,$e,rt,We,et,He,tt,st,nt){let Mt=22*e,ot=44*e,dt=88*e;return this.float32[Mt+0]=n,this.float32[Mt+1]=a,this.int16[ot+4]=c,this.int16[ot+5]=m,this.int16[ot+6]=p,this.int16[ot+7]=b,this.int16[ot+8]=y,this.int16[ot+9]=w,this.int16[ot+10]=M,this.int16[ot+11]=T,this.int16[ot+12]=E,this.uint16[ot+13]=P,this.uint16[ot+14]=R,this.uint16[ot+15]=F,this.uint16[ot+16]=B,this.uint16[ot+17]=W,this.uint16[ot+18]=J,this.uint16[ot+19]=ee,this.uint16[ot+20]=te,this.uint16[ot+21]=me,this.uint16[ot+22]=he,this.uint16[ot+23]=ve,this.uint16[ot+24]=Ce,this.uint16[ot+25]=De,this.uint16[ot+26]=Ue,this.uint16[ot+27]=ze,this.uint32[Mt+14]=$e,this.float32[Mt+15]=rt,this.float32[Mt+16]=We,this.float32[Mt+17]=et,this.float32[Mt+18]=He,this.float32[Mt+19]=tt,this.float32[Mt+20]=st,this.uint8[dt+84]=nt,e}}Ky.prototype.bytesPerElement=88,ne(Ky,"StructArrayLayout2f9i15ui1ul6f1ub88");class _h extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,m)}emplace(e,n,a,c,m,p){let b=5*e;return this.float32[b+0]=n,this.float32[b+1]=a,this.float32[b+2]=c,this.float32[b+3]=m,this.float32[b+4]=p,e}}_h.prototype.bytesPerElement=20,ne(_h,"StructArrayLayout5f20");class Jy extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,m,p,b)}emplace(e,n,a,c,m,p,b,y){let w=7*e;return this.float32[w+0]=n,this.float32[w+1]=a,this.float32[w+2]=c,this.float32[w+3]=m,this.float32[w+4]=p,this.float32[w+5]=b,this.float32[w+6]=y,e}}Jy.prototype.bytesPerElement=28,ne(Jy,"StructArrayLayout7f28");class Wu extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.float32[c+0]=n,this.float32[c+1]=a,e}}Wu.prototype.bytesPerElement=8,ne(Wu,"StructArrayLayout2f8");class ev extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=a,this.uint16[p+3]=c,this.uint16[p+4]=m,e}}ev.prototype.bytesPerElement=12,ne(ev,"StructArrayLayout1ul3ui12");class mf extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}mf.prototype.bytesPerElement=2,ne(mf,"StructArrayLayout1ui2");class tv extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B){let W=this.length;return this.resize(W+1),this.emplace(W,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W){let J=16*e;return this.float32[J+0]=n,this.float32[J+1]=a,this.float32[J+2]=c,this.float32[J+3]=m,this.float32[J+4]=p,this.float32[J+5]=b,this.float32[J+6]=y,this.float32[J+7]=w,this.float32[J+8]=M,this.float32[J+9]=T,this.float32[J+10]=E,this.float32[J+11]=P,this.float32[J+12]=R,this.float32[J+13]=F,this.float32[J+14]=B,this.float32[J+15]=W,e}}tv.prototype.bytesPerElement=64,ne(tv,"StructArrayLayout16f64");class L_ extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,m,p,b)}emplace(e,n,a,c,m,p,b,y){let w=10*e,M=5*e;return this.uint16[w+0]=n,this.uint16[w+1]=a,this.uint16[w+2]=c,this.uint16[w+3]=m,this.float32[M+2]=p,this.float32[M+3]=b,this.float32[M+4]=y,e}}L_.prototype.bytesPerElement=20,ne(L_,"StructArrayLayout4ui3f20");class iv extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}iv.prototype.bytesPerElement=2,ne(iv,"StructArrayLayout1i2");class nv extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}nv.prototype.bytesPerElement=1,ne(nv,"StructArrayLayout1ub1");class dC extends Rc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}dC.prototype.size=40;class rv extends Yy{get(e){return new dC(this,e)}}ne(rv,"CollisionBoxArray");class hC extends Rc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}hC.prototype.size=60;class uC extends Qy{get(e){return new hC(this,e)}}ne(uC,"PlacedSymbolArray");class mC extends Rc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}mC.prototype.size=88;class pC extends Ky{get(e){return new mC(this,e)}}ne(pC,"SymbolInstanceArray");class fC extends gh{getoffsetX(e){return this.float32[1*e+0]}}ne(fC,"GlyphOffsetArray");class gC extends Xa{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ne(gC,"SymbolLineVertexArray");class _C extends Rc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}_C.prototype.size=12;class bC extends ev{get(e){return new _C(this,e)}}ne(bC,"FeatureIndexArray");class yC extends Nc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ne(yC,"FillExtrusionCentroidArray");let fA=Gi([{name:"a_pos",components:2,type:"Int16"}],4),gA=Gi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class An{constructor(e=[]){this.segments=e}_prepareSegment(e,n,a,c){let m=this.segments[this.segments.length-1];return e>An.MAX_VERTEX_ARRAY_LENGTH&&qn(`Max vertices per segment is ${An.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>An.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n,primitiveOffset:a,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}prepareSegment(e,n,a,c){return this._prepareSegment(e,n.length,a.length,c)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,c){return new An([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function vC(t,e){return 256*(t=pi(Math.floor(t),0,255))+pi(Math.floor(e),0,255)}An.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ne(An,"SegmentVector");let _A=Gi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),bA=Gi([{name:"a_dash",components:4,type:"Uint16"}]);class pf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,a,c){this.ids.push(xC(e)),this.positions.push(n,a,c)}eachPosition(e,n){let a=xC(e),c=0,m=this.ids.length-1;for(;c<m;){let p=c+m>>1;this.ids[p]>=a?m=p:c=p+1}for(;this.ids[c]===a;)n(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,n){let a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return ov(a,c,0,a.length-1),n&&(n.add(a.buffer),n.add(c.buffer)),{ids:a,positions:c}}static deserialize(e){let n=new pf,a;n.ids=e.ids,n.positions=e.positions;for(let c of n.ids)c!==a&&n.uniqueIds.push(c),a=c;return n.indexed=!0,n}}function xC(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:yc(String(t))}function ov(t,e,n,a){for(;n<a;){let c=t[n+a>>1],m=n-1,p=a+1;for(;;){do m++;while(t[m]<c);do p--;while(t[p]>c);if(m>=p)break;F_(t,m,p),F_(e,3*m,3*p),F_(e,3*m+1,3*p+1),F_(e,3*m+2,3*p+2)}p-n<a-p?(ov(t,e,n,p),n=p+1):(ov(t,e,p+1,a),a=p)}}function F_(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}ne(pf,"FeaturePositionMap");class Cl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class z_ extends Cl{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class po extends Cl{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Sl extends Cl{constructor(e){super(e),this.current=[0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class av extends Cl{constructor(e){super(e),this.current=[0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class sv extends Cl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class wC extends Cl{constructor(e){super(e),this.current=Fi.transparent.toRenderColor(null)}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}let yA=new Float32Array(16);class ff extends Cl{constructor(e){super(e),this.current=yA}set(e,n,a){if(this.fetchUniformLocation(e,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}let vA=new Float32Array(9),xA=new Float32Array(4);class lv extends Cl{constructor(e){super(e),this.current=xA}set(e,n,a){if(this.fetchUniformLocation(e,n)){for(let c=0;c<4;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function cv(t){return[vC(255*t.r,255*t.g),vC(255*t.b,255*t.a)]}class gf{constructor(e,n,a,c){this.value=e,this.uniformNames=n.map(m=>`u_${m}`),this.type=a,this.context=c}setUniform(e,n,a,c,m){let p=c.constantOr(this.value);n.set(e,m,p instanceof Fi?p.toRenderColor(this.context.lut):p)}getBinding(e,n){return this.type==="color"?new wC(e):new po(e)}}class Gu{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,a,c,m){let p=m==="u_pattern"||m==="u_dash"?this.pattern:m==="u_pixel_ratio"?this.pixelRatio:null;p&&n.set(e,m,p)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new sv(e):new po(e)}}class Ml{constructor(e,n,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,a,c,m,p,b){let y=this.paintVertexArray.length,w=this.expression.evaluate(new Qt(0,{brightness:p}),n,{},m,c,b);this.paintVertexArray.resize(e),this._setPaintValue(y,e,w,this.context)}updatePaintArray(e,n,a,c,m,p,b){let y=this.expression.evaluate({zoom:0,brightness:b},a,c,void 0,m);this._setPaintValue(e,n,y,this.context)}_setPaintValue(e,n,a,c){if(this.type==="color"){let m=cv(a.toRenderColor(c.lut));for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,m[0],m[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qa{constructor(e,n,a,c,m,p){this.expression=e,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=a,this.useIntegerZoom=c,this.context=m,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,a,c,m,p,b){let y=this.expression.evaluate(new Qt(this.context.zoom,{brightness:p}),n,{},m,c,b),w=this.expression.evaluate(new Qt(this.context.zoom+1,{brightness:p}),n,{},m,c,b),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,y,w,this.context)}updatePaintArray(e,n,a,c,m,p,b){let y=this.expression.evaluate({zoom:this.context.zoom,brightness:b},a,c,void 0,m),w=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b},a,c,void 0,m);this._setPaintValue(e,n,y,w,this.context)}_setPaintValue(e,n,a,c,m){if(this.type==="color"){let p=cv(a.toRenderColor(m.lut)),b=cv(a.toRenderColor(m.lut));for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,p[0],p[1],b[0],b[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,c,m){let p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,b=pi(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);n.set(e,m,b)}getBinding(e,n){return new po(e)}}class Vc{constructor(e,n,a,c,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(a==="array"?bA:_A).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new c}populatePaintArray(e,n,a,c){let m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,c,m,p,b){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,n,a,c){if(!c||!a)return;let m=c[a];if(!m)return;let{tl:p,br:b,pixelRatio:y}=m;for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,p[0],p[1],b[0],b[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bh{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[],this.context=n;let c=[];for(let m in e.paint._values){let p=e.paint.get(m);if(!a(m)||!(p instanceof yn&&ju(p.property.specification)))continue;let b=CA(m,e.type),y=p.value,w=p.property.specification.type,M=!!p.property.useIntegerZoom,T=m==="line-dasharray"||m.endsWith("pattern"),E=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||E)if(y.kind==="source"||E||T){let P=CC(m,w,"source");this.binders[m]=T?new Vc(y,b,w,P,e.id):new Ml(y,b,w,P),c.push(`/a_${m}`)}else{let P=CC(m,w,"composite");this.binders[m]=new Qa(y,b,w,M,n,P),c.push(`/z_${m}`)}else this.binders[m]=T?new Gu(y.value,b):new gf(y.value,b,w,n),c.push(`/u_${m}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof Ml||n instanceof Qa?n.maxValue:0}populatePaintArrays(e,n,a,c,m,p,b){for(let y in this.binders){let w=this.binders[y];w.context=this.context,(w instanceof Ml||w instanceof Qa||w instanceof Vc)&&w.populatePaintArray(e,n,a,c,m,p,b)}}setConstantPatternPositions(e){for(let n in this.binders){let a=this.binders[n];a instanceof Gu&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,n,a,c,m,p,b,y){let w=!1,M=Object.keys(e),T=M.length!==0,E=T?M:n.uniqueIds;this.context.lut=m.lut;for(let P in this.binders){let R=this.binders[P];if(R.context=this.context,(R instanceof Ml||R instanceof Qa||R instanceof Vc)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){let F=m.paint.get(P);R.expression=F.value;for(let B of E){let W=e[B.toString()];n.eachPosition(B,(J,ee,te)=>{let me=c.feature(J);R.updatePaintArray(ee,te,me,W,p,b,y)})}if(!T)for(let B of a.uniqueIds){let W=e[B.toString()];a.eachPosition(B,(J,ee,te)=>{let me=c.feature(J);R.updatePaintArray(ee,te,me,W,p,b,y)})}w=!0}}return w}defines(){let e=[];for(let n in this.binders){let a=this.binders[n];(a instanceof gf||a instanceof Gu)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof Ml||a instanceof Qa||a instanceof Vc)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof gf||a instanceof Gu||a instanceof Qa)for(let c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let a in this.binders){let c=this.binders[a];if(c instanceof gf||c instanceof Gu||c instanceof Qa)for(let m of c.uniformNames)n.push({name:m,property:a,binding:c.getBinding(e,m)})}return n}setUniforms(e,n,a,c,m){for(let{name:p,property:b,binding:y}of a)this.binders[b].setUniform(e,y,m,c.get(b),p)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof Ml||n instanceof Qa||n instanceof Vc)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let a=this.binders[n];(a instanceof Ml||a instanceof Qa||a instanceof Vc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof Ml||n instanceof Qa||n instanceof Vc)&&n.destroy()}}}class jc{constructor(e,n,a=()=>!0){this.programConfigurations={};for(let c of e)this.programConfigurations[c.id]=new bh(c,n,a);this.needsUpload=!1,this._featureMap=new pf,this._featureMapWithoutIds=new pf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,a,c,m,p,b,y){for(let w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,n,c,m,p,b,y);n.id!==void 0?this._featureMap.add(n.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,c,m,p){for(let b of a)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,b,c,m,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let wA={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function CA(t,e){return wA[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let SA={"line-pattern":{source:Bc,composite:Bc},"fill-pattern":{source:Bc,composite:Bc},"fill-extrusion-pattern":{source:Bc,composite:Bc},"line-dasharray":{source:P_,composite:P_}},MA={color:{source:Wu,composite:Fc},number:{source:gh,composite:Wu}};function CC(t,e,n){let a=SA[t];return a&&a[n]||MA[e][n]}ne(gf,"ConstantBinder"),ne(Gu,"PatternConstantBinder"),ne(Ml,"SourceExpressionBinder"),ne(Vc,"PatternCompositeBinder"),ne(Qa,"CompositeExpressionBinder"),ne(bh,"ProgramConfiguration",{omit:["_buffers"]}),ne(jc,"ProgramConfigurationSet");let fo=pt/Math.PI/2,dv=5,SC=6,kA=16383,qu=64,hv=[qu,32,16],Ta=-fo,Ia=fo;function $u(t,e,n,a=fo){return n=Ti(n),[t*Math.sin(n)*a,-e*a,t*Math.cos(n)*a]}function yh(t,e,n){return $u(Math.cos(Ti(t)),Math.sin(Ti(t)),e,n)}let Yu=63710088e-1,uv=2*Math.PI*Yu;class Oi{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Oi(sl(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,a=this.lat*n,c=e.lat*n,m=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Yu*Math.acos(Math.min(m,1))}toBounds(e=0){let n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new Uc({lng:this.lng-a,lat:this.lat-n},{lng:this.lng+a,lat:this.lat+n})}toEcef(e){return yh(this.lat,this.lng,fo+e*fo/Yu)}static convert(e){if(e instanceof Oi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Oi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Oi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Uc{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{let a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof Oi?new Oi(e.lng,e.lat):Oi.convert(e),this}setSouthWest(e){return this._sw=e instanceof Oi?new Oi(e.lng,e.lat):Oi.convert(e),this}extend(e){let n=this._sw,a=this._ne,c,m;if(e instanceof Oi)c=e,m=e;else{if(!(e instanceof Uc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Uc.convert(e)):this.extend(Oi.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Oi.convert(e)):this;if(c=e._sw,m=e._ne,!c||!m)return this}return n||a?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),a.lng=Math.max(m.lng,a.lng),a.lat=Math.max(m.lat,a.lat)):(this._sw=new Oi(c.lng,c.lat),this._ne=new Oi(m.lng,m.lat)),this}getCenter(){return new Oi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Oi(this.getWest(),this.getNorth())}getSouthEast(){return new Oi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:a}=Oi.convert(e),c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){return!e||e instanceof Uc?e:new Uc(e)}}var MC={};(function(t,e){(function(n){function a(m,p,b){var y=c(256*m,256*(p=Math.pow(2,b)-p-1),b),w=c(256*(m+1),256*(p+1),b);return y[0]+","+y[1]+","+w[0]+","+w[1]}function c(m,p,b){var y=2*Math.PI*6378137/256/Math.pow(2,b);return[m*y-2*Math.PI*6378137/2,p*y-2*Math.PI*6378137/2]}n.getURL=function(m,p,b,y,w,M){return M=M||{},m+"?"+["bbox="+a(b,y,w),"format="+(M.format||"image/png"),"service="+(M.service||"WMS"),"version="+(M.version||"1.1.1"),"request="+(M.request||"GetMap"),"srs="+(M.srs||"EPSG:3857"),"width="+(M.width||256),"height="+(M.height||256),"layers="+p].join("&")},n.getTileBBox=a,n.getMercCoords=c,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,MC);var TA=MC;class vh{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=_f(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let a=TA.getTileBBox(this.x,this.y,this.z),c=function(m,p,b){let y,w="";for(let M=m;M>0;M--)y=1<<M-1,w+=(p&y?1:0)+(b&y?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kC{constructor(e,n){this.wrap=e,this.canonical=n,this.key=_f(e,n.z,n.z,n.x,n.y)}}class dr{constructor(e,n,a,c,m){this.overscaledZ=e,this.wrap=n,this.canonical=new vh(a,+c,+m),this.key=n===0&&e===a?this.canonical.key:_f(n,e,a,c,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new dr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new dr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return _f(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let a=this.canonical.z-e;return _f(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new dr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new dr(n,this.wrap,n,a,c),new dr(n,this.wrap,n,a+1,c),new dr(n,this.wrap,n,a,c+1),new dr(n,this.wrap,n,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new dr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new dr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kC(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _f(t,e,n,a,c){let m=1<<Math.min(n,22),p=m*(c%m)+a%m;return t&&n<22&&(p+=m*m*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}let IA=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new dr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new dr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new dr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new dr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];ne(vh,"CanonicalTileID"),ne(dr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let EA=0,DA=25.5;function mv(t){return uv*Math.cos(t*Math.PI/180)}function Ls(t){return(180+t)/360}function Fs(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function go(t,e){return t/mv(e)}function Ao(t){return 360*t-180}function Er(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function TC(t,e){return t*mv(Er(e))}let Yn=85.051129;function IC(t){return Math.cos(Ti(pi(t,-Yn,Yn)))}function xh(t,e){let n=pi(e,EA,DA),a=Math.pow(2,n);return IC(t)*uv/(512*a)}function EC(t){return 1/Math.cos(t*Math.PI/180)}function B_(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/pt)/(1<<t.z)*2));return 80150034*n/(n*n+1)/pt/(1<<t.z)}class qr{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){let a=Oi.convert(e);return new qr(Ls(a.lng),Fs(a.lat),go(n,a.lat))}toLngLat(){return new Oi(Ao(this.x),Er(this.y))}toAltitude(){return TC(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/uv*EC(Er(this.y))}}function pv(t,e,n,a,c,m,p,b,y){let w=(e+a)/2,M=(n+c)/2,T=new yt(w,M);b(T),function(E,P,R,F,B,W){let J=R-B,ee=F-W;return Math.abs((F-P)*J-(R-E)*ee)/Math.hypot(J,ee)}(T.x,T.y,m.x,m.y,p.x,p.y)>=y?(pv(t,e,n,w,M,m,T,b,y),pv(t,w,M,a,c,T,p,b,y)):t.push(p)}function DC(t,e,n){let a=t[0],c=a.x,m=a.y;e(a);let p=[a];for(let b=1;b<t.length;b++){let y=t[b],{x:w,y:M}=y;e(y),pv(p,c,m,w,M,a,y,e,n),c=w,m=M,a=y}return p}function fv(t,e,n,a){if(a(e,n)){let c=e.add(n)._mult(.5);fv(t,e,c,a),fv(t,c,n,a)}else t.push(n)}function AA(t,e){let n=t[0],a=[n];for(let c=1;c<t.length;c++){let m=t[c];fv(a,n,m,e),n=m}return a}let gv=Math.pow(2,14)-1,AC=-gv-1;function PA(t,e){let n=Math.round(t.x*e),a=Math.round(t.y*e);return t.x=pi(n,AC,gv),t.y=pi(a,AC,gv),(n<t.x||n>t.x+1||a<t.y||a>t.y+1)&&qn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Ka(t,e,n){let a=t.loadGeometry(),c=t.extent,m=pt/c;if(e&&n&&n.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:b,x:y,y:w,projection:M}=n,T=E=>{let P=Ao((e.x+E.x/c)/p),R=Er((e.y+E.y/c)/p),F=M.project(P,R);E.x=(F.x*b-y)*c,E.y=(F.y*b-w)*c};for(let E=0;E<a.length;E++)if(t.type!==1)a[E]=DC(a[E],T,1);else{let P=[];for(let R of a[E])R.x<0||R.x>=c||R.y<0||R.y>=c||(T(R),P.push(R));a[E]=P}}for(let p of a)for(let b of p)PA(b,m);return a}function kl(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ka(t):[]}}function N_(t,e,n,a,c){t.emplaceBack(2*e+(a+1)/2,2*n+(c+1)/2)}function V_(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class _v{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Xa,this.indexArray=new wr,this.segments=new An,this.programConfigurations=new jc(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,a,c){let m=this.layers[0],p=[],b=null;m.type==="circle"&&(b=m.layout.get("circle-sort-key"));for(let{feature:w,id:M,index:T,sourceLayerIndex:E}of e){let P=this.layers[0]._featureFilter.needGeometry,R=kl(w,P);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),R,a))continue;let F=b?b.evaluate(R,{},a):void 0,B={id:M,properties:w.properties,type:w.type,sourceLayerIndex:E,index:T,geometry:P?R.geometry:Ka(w,a,c),patterns:{},sortKey:F};p.push(B)}b&&p.sort((w,M)=>w.sortKey-M.sortKey);let y=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new O_,y=c.projection);for(let w of p){let{geometry:M,index:T,sourceLayerIndex:E}=w,P=e[T].feature;this.addFeature(w,M,T,n.availableImages,a,y,n.brightness),n.featureIndex.insert(P,M,T,E,this.index)}}update(e,n,a,c,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,c,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,gA.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,a,c,m,p,b){for(let y of n)for(let w of y){let M=w.x,T=w.y;if(M<0||M>=pt||T<0||T>=pt)continue;if(p){let R=p.projectTilePoint(M,T,m),F=p.upVector(m,M,T),B=this.globeExtVertexArray;V_(B,R,F),V_(B,R,F),V_(B,R,F),V_(B,R,F)}let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=E.vertexLength;N_(this.layoutVertexArray,M,T,-1,-1),N_(this.layoutVertexArray,M,T,1,-1),N_(this.layoutVertexArray,M,T,1,1),N_(this.layoutVertexArray,M,T,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,m,b)}}function bv(t,e){for(let n=0;n<t.length;n++)if(Hc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Hc(t,e[n]))return!0;return!!yv(t,e)}function OA(t,e,n){return!!Hc(t,e)||!!vv(e,t,n)}function PC(t,e){if(t.length===1)return RC(e,t[0]);for(let n=0;n<e.length;n++){let a=e[n];for(let c=0;c<a.length;c++)if(Hc(t,a[c]))return!0}for(let n=0;n<t.length;n++)if(RC(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(yv(t,e[n]))return!0;return!1}function RA(t,e,n){if(t.length>1){if(yv(t,e))return!0;for(let a=0;a<e.length;a++)if(vv(e[a],t,n))return!0}for(let a=0;a<t.length;a++)if(vv(t[a],e,n))return!0;return!1}function yv(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let a=t[n],c=t[n+1];for(let m=0;m<e.length-1;m++)if(LA(a,c,e[m],e[m+1]))return!0}return!1}function LA(t,e,n,a){return wa(t,n,a)!==wa(e,n,a)&&wa(t,e,n)!==wa(t,e,a)}function vv(t,e,n){let a=n*n;if(e.length===1)return t.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(OC(t,e[c-1],e[c])<a)return!0;return!1}function OC(t,e,n){let a=e.distSqr(n);if(a===0)return t.distSqr(e);let c=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/a;return t.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function RC(t,e){let n,a,c,m=!1;for(let p=0;p<t.length;p++){n=t[p];for(let b=0,y=n.length-1;b<n.length;y=b++)a=n[b],c=n[y],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(m=!m)}return m}function Hc(t,e){let n=!1;for(let a=0,c=t.length-1;a<t.length;c=a++){let m=t[a],p=t[c];m.y>e.y!=p.y>e.y&&e.x<(p.x-m.x)*(e.y-m.y)/(p.y-m.y)+m.x&&(n=!n)}return n}function LC(t,e,n,a,c){for(let p of t)if(e<=p.x&&n<=p.y&&a>=p.x&&c>=p.y)return!0;let m=[new yt(e,n),new yt(e,c),new yt(a,c),new yt(a,n)];if(t.length>2){for(let p of m)if(Hc(t,p))return!0}for(let p=0;p<t.length-1;p++)if(FA(t[p],t[p+1],m))return!0;return!1}function FA(t,e,n){let a=n[0],c=n[2];if(t.x<a.x&&e.x<a.x||t.x>c.x&&e.x>c.x||t.y<a.y&&e.y<a.y||t.y>c.y&&e.y>c.y)return!1;let m=wa(t,e,n[0]);return m!==wa(t,e,n[1])||m!==wa(t,e,n[2])||m!==wa(t,e,n[3])}function Zu(t,e,n,a,c,m){let p=e.y-t.y,b=t.x-e.x;if(m=m||0){let y=p*p+b*b;if(y===0)return!0;let w=Math.sqrt(y);p/=w,b/=w}return!((n.x-t.x)*p+(n.y-t.y)*b-m<0||(a.x-t.x)*p+(a.y-t.y)*b-m<0||(c.x-t.x)*p+(c.y-t.y)*b-m<0)}function xv(t,e,n,a,c,m,p){return!(Zu(t,e,a,c,m,p)||Zu(e,n,a,c,m,p)||Zu(n,t,a,c,m,p)||Zu(a,c,t,e,n,p)||Zu(c,m,t,e,n,p)||Zu(m,a,t,e,n,p))}function Xu(t,e,n){let a=e.paint.get(t).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(t)}function j_(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function FC(t,e,n,a,c){if(!e[0]&&!e[1])return t;let m=yt.convert(e)._mult(c);n==="viewport"&&m._rotate(-a);let p=[];for(let b=0;b<t.length;b++)p.push(t[b].sub(m));return p}function zC(t,e,n,a){let c=yt.convert(t)._mult(a);return e==="viewport"&&c._rotate(-n),c}ne(_v,"CircleBucket",{omit:["layers"]});let zA=new Wi({"circle-sort-key":new wt(Pe.layout_circle["circle-sort-key"]),visibility:new Ke(Pe.layout_circle.visibility)});var BA={paint:new Wi({"circle-radius":new wt(Pe.paint_circle["circle-radius"]),"circle-color":new wt(Pe.paint_circle["circle-color"]),"circle-blur":new wt(Pe.paint_circle["circle-blur"]),"circle-opacity":new wt(Pe.paint_circle["circle-opacity"]),"circle-translate":new Ke(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ke(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ke(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ke(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wt(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wt(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wt(Pe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ke(Pe.paint_circle["circle-emissive-strength"])}),layout:zA};class wv{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){let c=i._.dot(n,this.dir);if(Math.abs(c)<1e-6)return!1;let m=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return a[0]=this.pos[0]+this.dir[0]*m,a[1]=this.pos[1]+this.dir[1]*m,a[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,n,a){if(i._.equals(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;let[c,m,p]=this.dir,b=this.pos[0]-e[0],y=this.pos[1]-e[1],w=this.pos[2]-e[2],M=c*c+m*m+p*p,T=2*(b*c+y*m+w*p),E=T*T-4*M*(b*b+y*y+w*w-n*n);if(E<0){let P=Math.max(-T/2,0),R=b+c*P,F=y+m*P,B=w+p*P,W=Math.hypot(R,F,B);return a[0]=R*n/W,a[1]=F*n/W,a[2]=B*n/W,!1}{let P=(-T-Math.sqrt(E))/(2*M);if(P<0){let R=Math.hypot(b,y,w);return a[0]=b*n/R,a[1]=y*n/R,a[2]=w*n/R,!1}return a[0]=b+c*P,a[1]=y+m*P,a[2]=w+p*P,!0}}}class Cv{constructor(e,n,a,c,m){this.TL=e,this.TR=n,this.BR=a,this.BL=c,this.horizon=m}static fromInvProjectionMatrix(e,n,a){let c=[-1,1,1],m=[1,1,1],p=[1,-1,1],b=[-1,-1,1],y=i._.transformMat4(c,c,e),w=i._.transformMat4(m,m,e),M=i._.transformMat4(p,p,e),T=i._.transformMat4(b,b,e);return new Cv(y,w,M,T,n/a)}}function bf(t,e,n){let a=1/0,c=-1/0,m=[];for(let p of t){i._.sub(m,p,e);let b=i._.dot(m,n);a=Math.min(a,b),c=Math.max(c,b)}return[a,c]}function BC(t,e){let n=!0;for(let a=0;a<t.planes.length;a++){let c=t.planes[a],m=0;for(let p=0;p<e.length;p++)m+=i._.dot(c,e[p])+c[3]>=0;if(m===0)return 0;m!==e.length&&(n=!1)}return n?2:1}function NC(t,e){for(let n of t.projections){let a=bf(e,t.points[0],n.axis);if(n.projection[1]<a[0]||n.projection[0]>a[1])return 0}return 1}function VC(t,e){let n=0,a=[0,0,0,0];for(let c=0;c<t.length;c++)a[0]=t[c][0],a[1]=t[c][1],a[2]=t[c][2],a[3]=1,i.aA.dot(a,e)>=0&&n++;return n}class Sv{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Pn.fromPoints(this.points),this.projections=[],this.frustumEdges=[i._.sub([],this.points[2],this.points[3]),i._.sub([],this.points[0],this.points[3]),i._.sub([],this.points[4],this.points[0]),i._.sub([],this.points[5],this.points[1]),i._.sub([],this.points[6],this.points[2]),i._.sub([],this.points[7],this.points[3])];for(let a of this.frustumEdges){let c=[0,-a[2],a[1]],m=[a[2],0,-a[0]];this.projections.push({axis:c,projection:bf(this.points,this.points[0],c)}),this.projections.push({axis:m,projection:bf(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,n,a,c){let m=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{let M=i.aA.transformMat4([],w,e),T=1/M[3]/n*m;return i.aA.mul(M,M,[T,T,c?1/M[3]:T,T])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{let M=i._.sub([],p[w[0]],p[w[1]]),T=i._.sub([],p[w[2]],p[w[1]]),E=i._.normalize([],i._.cross([],M,T)),P=-i._.dot(E,p[w[1]]);return E.concat(P)}),y=[];for(let w=0;w<p.length;w++)y.push([p[w][0],p[w][1],p[w][2]]);return new Sv(y,b)}intersectsPrecise(e,n,a){for(let c=0;c<n.length;c++)if(!VC(e,n[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!VC(e,this.planes[c]))return 0;for(let c of a)for(let m of this.frustumEdges){let p=i._.cross([],c,m),b=i._.length(p);if(b===0)continue;i._.scale(p,p,1/b);let y=bf(this.points,this.points[0],p),w=bf(e,this.points[0],p);if(y[0]>w[1]||w[0]>y[1])return 0}return 1}}class Pn{static fromPoints(e){let n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(let c of e)i._.min(n,n,c),i._.max(a,a,c);return new Pn(n,a)}static fromTileIdAndHeight(e,n,a){let c=1<<e.canonical.z,m=e.canonical.x,p=e.canonical.y;return new Pn([m/c,p/c,n],[(m+1)/c,(p+1)/c,a])}static applyTransform(e,n){let a=e.getCorners();for(let c=0;c<a.length;++c)i._.transformMat4(a[c],a[c],n);return Pn.fromPoints(a)}static projectAabbCorners(e,n){let a=e.getCorners();for(let c=0;c<a.length;++c)i._.transformMat4(a[c],a[c],n);return a}constructor(e,n){this.min=e,this.max=n,this.center=i._.scale([],i._.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],a=i._.clone(this.min),c=i._.clone(this.max);for(let m=0;m<n.length;m++)a[m]=n[m]?this.min[m]:this.center[m],c[m]=n[m]?this.center[m]:this.max[m];return c[2]=this.max[2],new Pn(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?BC(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?BC(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?NC(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?NC(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ne(Pn,"Aabb");let NA=Gi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:U_}=NA,jC=Gi([{name:"a_pos_3",components:3,type:"Int16"}]);var yf=Gi([{name:"a_pos",type:"Int16",components:2}]);function H_(t){return t*fo/Yu}let VA=[new Pn([Ta,Ta,Ta],[Ia,Ia,Ia]),new Pn([Ta,Ta,Ta],[0,0,Ia]),new Pn([0,Ta,Ta],[Ia,0,Ia]),new Pn([Ta,0,Ta],[0,Ia,Ia]),new Pn([0,0,Ta],[Ia,Ia,Ia])];function UC(t,e,n,a=!0){let c=i._.scale([],t._camera.position,t.worldSize),m=[e,n,1,1];i.aA.transformMat4(m,m,t.pixelMatrixInverse),i.aA.scale(m,m,1/m[3]);let p=i._.sub([],m,c),b=i._.normalize([],p),y=t.globeMatrix,w=[y[12],y[13],y[14]],M=i._.sub([],w,c),T=i._.length(M),E=i._.normalize([],M),P=t.worldSize/(2*Math.PI),R=i._.dot(E,b),F=Math.asin(P/T);if(F<Math.acos(R)){if(!a)return null;let ze=[],$e=[];i._.scale(ze,b,T/R),i._.normalize($e,i._.sub($e,ze,M)),i._.normalize(b,i._.add(b,M,i._.scale(b,$e,Math.tan(F)*T)))}let B=[];new wv(c,b).closestPointOnSphere(w,P,B);let W=i._.normalize([],Vd(y,0)),J=i._.normalize([],Vd(y,1)),ee=i._.normalize([],Vd(y,2)),te=i._.dot(W,B),me=i._.dot(J,B),he=i._.dot(ee,B),ve=Br(Math.asin(-me/P)),Ce=Br(Math.atan2(te,he));Ce=t.center.lng+function(ze,$e){let rt=($e-ze+180)%360-180;return rt<-180?rt+360:rt}(t.center.lng,Ce);let De=Ls(Ce),Ue=pi(Fs(ve),0,1);return new qr(De,Ue)}class jA{constructor(e,n,a){this.a=i._.sub([],e,a),this.b=i._.sub([],n,a),this.center=a;let c=i._.normalize([],this.a),m=i._.normalize([],this.b);this.angle=Math.acos(i._.dot(c,m))}}function Mv(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(a,c,m,p){let b=Math.sin(m);return a*(Math.sin((1-p)*m)/b)+c*(Math.sin(p*m)/b)}(t.a[e],t.b[e],t.angle,pi(n,0,1))+t.center[e]}function zs(t){if(t.z<=1)return VA[t.z+2*t.y+t.x];let e=kv(W_(t));return Pn.fromPoints(e)}function Tl(t,e,n){return i._.scale(t,t,1-n),i._.scaleAndAdd(t,t,e,n)}function HC(t,e){let n=Il(e.zoom);if(n===0)return zs(t);let a=W_(t),c=kv(a),m=Ls(a.getWest())*e.worldSize,p=Ls(a.getEast())*e.worldSize,b=Fs(a.getNorth())*e.worldSize,y=Fs(a.getSouth())*e.worldSize,w=[m,b,0],M=[p,b,0],T=[m,y,0],E=[p,y,0],P=i.ad.invert([],e.globeMatrix);return i._.transformMat4(w,w,P),i._.transformMat4(M,M,P),i._.transformMat4(T,T,P),i._.transformMat4(E,E,P),c[0]=Tl(c[0],T,n),c[1]=Tl(c[1],E,n),c[2]=Tl(c[2],M,n),c[3]=Tl(c[3],w,n),Pn.fromPoints(c)}function WC(t,e,n){for(let a of t)i._.transformMat4(a,a,e),i._.scale(a,a,n)}function GC(t,e,n,a){let c=e/t.worldSize,m=t.globeMatrix;if(n.z<=1){let De=zs(n).getCorners();return WC(De,m,c),Pn.fromPoints(De)}let p=W_(n,a),b=kv(p,fo+H_(t._tileCoverLift));WC(b,m,c);let y=Number.MAX_VALUE,w=[-y,-y,-y],M=[y,y,y];if(p.contains(t.center)){for(let ze of b)i._.min(M,M,ze),i._.max(w,w,ze);w[2]=0;let De=t.point,Ue=[De.x*c,De.y*c,0];return i._.min(M,M,Ue),i._.max(w,w,Ue),new Pn(M,w)}if(t._tileCoverLift>0){for(let De of b)i._.min(M,M,De),i._.max(w,w,De);return new Pn(M,w)}let T=[m[12]*c,m[13]*c,m[14]*c],E=p.getCenter(),P=pi(t.center.lat,-Yn,Yn),R=pi(E.lat,-Yn,Yn),F=Ls(t.center.lng),B=Fs(P),W=F-Ls(E.lng),J=B-Fs(R);W>.5?W-=1:W<-.5&&(W+=1);let ee=0;if(Math.abs(W)>Math.abs(J))ee=W>=0?1:3;else{ee=J>=0?0:2;let De=[m[4]*c,m[5]*c,m[6]*c],Ue=-Math.sin(Ti(J>=0?p.getSouth():p.getNorth()))*fo;i._.scaleAndAdd(T,T,De,Ue)}let te=b[ee],me=b[(ee+1)%4],he=new jA(te,me,T),ve=[Mv(he,0)||te[0],Mv(he,1)||te[1],Mv(he,2)||te[2]],Ce=Il(t.zoom);if(Ce>0){let De=function({x:ze,y:$e,z:rt},We,et,He,tt){let st=1/(1<<rt),nt=ze*st,Mt=nt+st,ot=$e*st,dt=ot+st,Nt=0,Ft=(nt+Mt)/2-He;return Ft>.5?Nt=-1:Ft<-.5&&(Nt=1),nt=((nt+Nt)*We-(He*=We))*et+He,Mt=((Mt+Nt)*We-He)*et+He,ot=(ot*We-(tt*=We))*et+tt,dt=(dt*We-tt)*et+tt,[[nt,dt,0],[Mt,dt,0],[Mt,ot,0],[nt,ot,0]]}(n,e,t._pixelsPerMercatorPixel,F,B);for(let ze=0;ze<b.length;ze++)Tl(b[ze],De[ze],Ce);let Ue=i._.add([],De[ee],De[(ee+1)%4]);i._.scale(Ue,Ue,.5),Tl(ve,Ue,Ce)}for(let De of b)i._.min(M,M,De),i._.max(w,w,De);return M[2]=Math.min(te[2],me[2]),i._.min(M,M,ve),i._.max(w,w,ve),new Pn(M,w)}function W_({x:t,y:e,z:n},a=!1){let c=1/(1<<n),m=new Oi(Ao(t*c),e===(1<<n)-1&&a?-90:Er((e+1)*c)),p=new Oi(Ao((t+1)*c),e===0&&a?90:Er(e*c));return new Uc(m,p)}function kv(t,e=fo){let n=Ti(t.getNorth()),a=Ti(t.getSouth()),c=Math.cos(n),m=Math.cos(a),p=Math.sin(n),b=Math.sin(a),y=t.getWest(),w=t.getEast();return[$u(m,b,y,e),$u(m,b,w,e),$u(c,p,w,e),$u(c,p,y,e)]}function vf(t,e,n,a){let c=1<<n.z,m=(t/pt+n.x)/c;return yh(Er((e/pt+n.y)/c),Ao(m),a)}function G_({min:t,max:e}){return kA/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let qC=new Float64Array(16);function xf(t){let e=G_(t),n=i.ad.fromScaling(qC,[e,e,e]);return i.ad.translate(n,n,i._.negate([],t.min))}function Tv(t){let e=i.ad.fromTranslation(qC,t.min),n=1/G_(t);return i.ad.scale(e,e,[n,n,n])}function Iv(t){let e=pt/(2*Math.PI);return t/(2*Math.PI)/e}function $C(t,e){return pt/(512*Math.pow(2,t))*G_(zs(e))}function YC(t,e,n,a,c){let m=Iv(n),p=[t,e,-n/(2*Math.PI)],b=i.ad.identity(new Float64Array(16));return i.ad.translate(b,b,p),i.ad.scale(b,b,[m,m,m]),i.ad.rotateX(b,b,Ti(-c)),i.ad.rotateY(b,b,Ti(-a)),b}function Il(t){return al(dv,SC,t)}function ZC(t,e){let n=yh(e.lat,e.lng),a=function(m){let p=yh(m._center.lat,m._center.lng),b=i._.fromValues(0,1,0),y=i._.cross([],b,p),w=i.ad.fromRotation([],-m.angle,p);y=i._.transformMat4(y,y,w),i.ad.fromRotation(w,-m._pitch,y);let M=i._.normalize([],p);return i._.scale(M,M,H_(m.cameraToCenterDistance/m.pixelsPerMeter)),i._.transformMat4(M,M,w),i._.add([],p,M)}(t),c=i._.subtract([],a,n);return i._.angle(c,n)}function Ev(t,e){return ZC(t,e)>Math.PI/2*1.01}let XC=Ti(85),UA=Math.cos(XC),HA=Math.sin(XC),WA=i.ad.create(),QC=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function KC(t,e,n,a,c,m,p,b,y){if(m&&t.queryGeometry.isAboveHorizon)return!1;m&&(y*=t.pixelToTileUnitsFactor);let w=t.tileID.canonical,M=n.projection.upVectorScale(w,n.center.lat,n.worldSize).metersToTile;for(let T of e)for(let E of T){let P=E.add(b),R=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(P.x,P.y,!0):0,F=n.projection.projectTilePoint(P.x,P.y,w);if(R>0){let ee=n.projection.upVector(w,P.x,P.y);F.x+=ee[0]*M*R,F.y+=ee[1]*M*R,F.z+=ee[2]*M*R}let B=m?P:GA(F.x,F.y,F.z,a),W=m?t.tilespaceRays.map(ee=>$A(ee,R)):t.queryGeometry.screenGeometry,J=i.aA.transformMat4([],[F.x,F.y,F.z,1],a);if(!p&&m?y*=J[3]/n.cameraToCenterDistance:p&&!m&&(y*=n.cameraToCenterDistance/J[3]),m){let ee=Er((E.y/pt+w.y)/(1<<w.z));y/=n.projection.pixelsPerMeter(ee,1)/go(1,ee)}if(OA(W,B,y))return!0}return!1}function GA(t,e,n,a){let c=i.aA.transformMat4([],[t,e,n,1],a);return new yt(c[0]/c[3],c[1]/c[3])}let JC=i._.fromValues(0,0,0),qA=i._.fromValues(0,0,1);function $A(t,e){let n=i._.create();return JC[2]=e,t.intersectsPlane(JC,qA,n),new yt(n[0],n[1])}class e2 extends _v{}function t2(t,{width:e,height:n},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*a);return t.width=e,t.height=n,t.data=c,t}function i2(t,e,n){let{width:a,height:c}=e;a===t.width&&c===t.height||(Dv(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,c)},n,null),t.width=a,t.height=c,t.data=e.data)}function Dv(t,e,n,a,c,m,p,b){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||n.x>t.width-c.width||n.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");let y=t.data,w=e.data,M=m===4&&b;for(let T=0;T<c.height;T++){let E=((n.y+T)*t.width+n.x)*m,P=((a.y+T)*e.width+a.x)*m;if(M)for(let R=0;R<c.width;R++){let F=E+R*m+3,B=P+R*m;w[B+0]=255,w[B+1]=255,w[B+2]=255,w[B+3]=y[F]}else if(p)for(let R=0;R<c.width;R++){let F=E+R*m,B=P+R*m,W=y[F+3],J=new Fi(y[F+0]/255*W,y[F+1]/255*W,y[F+2]/255*W,W).toRenderColor(p).toArray();w[B+0]=J[0],w[B+1]=J[1],w[B+2]=J[2],w[B+3]=J[3]}else for(let R=0;R<c.width*m;R++)w[P+R]=y[E+R]}return e}ne(e2,"HeatmapBucket",{omit:["layers"]});class Wc{constructor(e,n){t2(this,e,1,n)}resize(e){i2(this,new Wc(e),1)}clone(){return new Wc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,m){Dv(e,n,a,c,m,1,null)}}class ha{constructor(e,n){t2(this,e,4,n)}resize(e){i2(this,new ha(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ha({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,m,p,b){Dv(e,n,a,c,m,4,p,b)}}class n2{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}ne(Wc,"AlphaImage"),ne(ha,"RGBAImage");let YA=new Wi({visibility:new Ke(Pe.layout_heatmap.visibility)});var ZA={paint:new Wi({"heatmap-radius":new wt(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wt(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ke(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Dn(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ke(Pe.paint_heatmap["heatmap-opacity"])}),layout:YA};function wf(t){let e={},n=t.resolution||256,a=t.clips?t.clips.length:1,c=t.image||new ha({width:n,height:a}),m=(p,b,y)=>{e[t.evaluationKey]=y;let w=t.expression.evaluate(e);w&&(c.data[p+b+0]=Math.floor(255*w.r/w.a),c.data[p+b+1]=Math.floor(255*w.g/w.a),c.data[p+b+2]=Math.floor(255*w.b/w.a),c.data[p+b+3]=Math.floor(255*w.a))};if(t.clips)for(let p=0,b=0;p<a;++p,b+=4*n)for(let y=0,w=0;y<n;y++,w+=4){let M=y/(n-1),{start:T,end:E}=t.clips[p];m(b,w,T*(1-M)+E*M)}else for(let p=0,b=0;p<n;p++,b+=4)m(0,b,p/(n-1));return c}let XA=new Wi({visibility:new Ke(Pe.layout_hillshade.visibility)});var QA={paint:new Wi({"hillshade-illumination-direction":new Ke(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ke(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ke(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ke(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ke(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ke(Pe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ke(Pe.paint_hillshade["hillshade-emissive-strength"])}),layout:XA};let KA=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:JA}=KA;function Cf(t,e,n=2){let a=e&&e.length,c=a?e[0]*n:t.length,m=r2(t,0,c,n,!0),p=[];if(!m||m.next===m.prev)return p;let b,y,w;if(a&&(m=function(M,T,E,P){let R=[];for(let F=0,B=T.length;F<B;F++){let W=r2(M,T[F]*P,F<B-1?T[F+1]*P:M.length,P,!1);W===W.next&&(W.steiner=!0),R.push(sP(W))}R.sort(rP);for(let F=0;F<R.length;F++)E=oP(R[F],E);return E}(t,e,m,n)),t.length>80*n){b=1/0,y=1/0;let M=-1/0,T=-1/0;for(let E=n;E<c;E+=n){let P=t[E],R=t[E+1];P<b&&(b=P),R<y&&(y=R),P>M&&(M=P),R>T&&(T=R)}w=Math.max(M-b,T-y),w=w!==0?32767/w:0}return Sf(m,p,n,b,y,w,0),p}function r2(t,e,n,a,c){let m;if(c===function(p,b,y,w){let M=0;for(let T=b,E=y-w;T<y;T+=w)M+=(p[E]-p[T])*(p[T+1]+p[E+1]),E=T;return M}(t,e,n,a)>0)for(let p=e;p<n;p+=a)m=s2(p/a|0,t[p],t[p+1],m);else for(let p=n-a;p>=e;p-=a)m=s2(p/a|0,t[p],t[p+1],m);return m&&q_(m,m.next)&&(kf(m),m=m.next),m}function wh(t,e){if(!t)return t;e||(e=t);let n,a=t;do if(n=!1,a.steiner||!q_(a,a.next)&&hr(a.prev,a,a.next)!==0)a=a.next;else{if(kf(a),a=e=a.prev,a===a.next)break;n=!0}while(n||a!==e);return e}function Sf(t,e,n,a,c,m,p){if(!t)return;!p&&m&&function(y,w,M,T){let E=y;do E.z===0&&(E.z=Av(E.x,E.y,w,M,T)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next;while(E!==y);E.prevZ.nextZ=null,E.prevZ=null,function(P){let R,F=1;do{let B,W=P;P=null;let J=null;for(R=0;W;){R++;let ee=W,te=0;for(let he=0;he<F&&(te++,ee=ee.nextZ,ee);he++);let me=F;for(;te>0||me>0&&ee;)te!==0&&(me===0||!ee||W.z<=ee.z)?(B=W,W=W.nextZ,te--):(B=ee,ee=ee.nextZ,me--),J?J.nextZ=B:P=B,B.prevZ=J,J=B;W=ee}J.nextZ=null,F*=2}while(R>1)}(E)}(t,a,c,m);let b=t;for(;t.prev!==t.next;){let y=t.prev,w=t.next;if(m?tP(t,a,c,m):eP(t))e.push(y.i,t.i,w.i),kf(t),t=w.next,b=w.next;else if((t=w)===b){p?p===1?Sf(t=iP(wh(t),e),e,n,a,c,m,2):p===2&&nP(t,e,n,a,c,m):Sf(wh(t),e,n,a,c,m,1);break}}}function eP(t){let e=t.prev,n=t,a=t.next;if(hr(e,n,a)>=0)return!1;let c=e.x,m=n.x,p=a.x,b=e.y,y=n.y,w=a.y,M=c<m?c<p?c:p:m<p?m:p,T=b<y?b<w?b:w:y<w?y:w,E=c>m?c>p?c:p:m>p?m:p,P=b>y?b>w?b:w:y>w?y:w,R=a.next;for(;R!==e;){if(R.x>=M&&R.x<=E&&R.y>=T&&R.y<=P&&Qu(c,b,m,y,p,w,R.x,R.y)&&hr(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function tP(t,e,n,a){let c=t.prev,m=t,p=t.next;if(hr(c,m,p)>=0)return!1;let b=c.x,y=m.x,w=p.x,M=c.y,T=m.y,E=p.y,P=b<y?b<w?b:w:y<w?y:w,R=M<T?M<E?M:E:T<E?T:E,F=b>y?b>w?b:w:y>w?y:w,B=M>T?M>E?M:E:T>E?T:E,W=Av(P,R,e,n,a),J=Av(F,B,e,n,a),ee=t.prevZ,te=t.nextZ;for(;ee&&ee.z>=W&&te&&te.z<=J;){if(ee.x>=P&&ee.x<=F&&ee.y>=R&&ee.y<=B&&ee!==c&&ee!==p&&Qu(b,M,y,T,w,E,ee.x,ee.y)&&hr(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,te.x>=P&&te.x<=F&&te.y>=R&&te.y<=B&&te!==c&&te!==p&&Qu(b,M,y,T,w,E,te.x,te.y)&&hr(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;ee&&ee.z>=W;){if(ee.x>=P&&ee.x<=F&&ee.y>=R&&ee.y<=B&&ee!==c&&ee!==p&&Qu(b,M,y,T,w,E,ee.x,ee.y)&&hr(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;te&&te.z<=J;){if(te.x>=P&&te.x<=F&&te.y>=R&&te.y<=B&&te!==c&&te!==p&&Qu(b,M,y,T,w,E,te.x,te.y)&&hr(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function iP(t,e){let n=t;do{let a=n.prev,c=n.next.next;!q_(a,c)&&o2(a,n,n.next,c)&&Mf(a,c)&&Mf(c,a)&&(e.push(a.i,n.i,c.i),kf(n),kf(n.next),n=t=c),n=n.next}while(n!==t);return wh(n)}function nP(t,e,n,a,c,m){let p=t;do{let b=p.next.next;for(;b!==p.prev;){if(p.i!==b.i&&lP(p,b)){let y=a2(p,b);return p=wh(p,p.next),y=wh(y,y.next),Sf(p,e,n,a,c,m,0),void Sf(y,e,n,a,c,m,0)}b=b.next}p=p.next}while(p!==t)}function rP(t,e){return t.x-e.x}function oP(t,e){let n=function(c,m){let p=m,b=c.x,y=c.y,w,M=-1/0;do{if(y<=p.y&&y>=p.next.y&&p.next.y!==p.y){let F=p.x+(y-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(F<=b&&F>M&&(M=F,w=p.x<p.next.x?p:p.next,F===b))return w}p=p.next}while(p!==m);if(!w)return null;let T=w,E=w.x,P=w.y,R=1/0;p=w;do{if(b>=p.x&&p.x>=E&&b!==p.x&&Qu(y<P?b:M,y,E,P,y<P?M:b,y,p.x,p.y)){let F=Math.abs(y-p.y)/(b-p.x);Mf(p,c)&&(F<R||F===R&&(p.x>w.x||p.x===w.x&&aP(w,p)))&&(w=p,R=F)}p=p.next}while(p!==T);return w}(t,e);if(!n)return e;let a=a2(n,t);return wh(a,a.next),wh(n,n.next)}function aP(t,e){return hr(t.prev,t,e.prev)<0&&hr(e.next,t,t.next)<0}function Av(t,e,n,a,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function sP(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Qu(t,e,n,a,c,m,p,b){return(c-p)*(e-b)>=(t-p)*(m-b)&&(t-p)*(a-b)>=(n-p)*(e-b)&&(n-p)*(m-b)>=(c-p)*(a-b)}function lP(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,a){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==a.i&&c.next.i!==a.i&&o2(c,c.next,n,a))return!0;c=c.next}while(c!==n);return!1}(t,e)&&(Mf(t,e)&&Mf(e,t)&&function(n,a){let c=n,m=!1,p=(n.x+a.x)/2,b=(n.y+a.y)/2;do c.y>b!=c.next.y>b&&c.next.y!==c.y&&p<(c.next.x-c.x)*(b-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m}(t,e)&&(hr(t.prev,t,e.prev)||hr(t,e.prev,e))||q_(t,e)&&hr(t.prev,t,t.next)>0&&hr(e.prev,e,e.next)>0)}function hr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function q_(t,e){return t.x===e.x&&t.y===e.y}function o2(t,e,n,a){let c=Y_(hr(t,e,n)),m=Y_(hr(t,e,a)),p=Y_(hr(n,a,t)),b=Y_(hr(n,a,e));return c!==m&&p!==b||!(c!==0||!$_(t,n,e))||!(m!==0||!$_(t,a,e))||!(p!==0||!$_(n,t,a))||!(b!==0||!$_(n,e,a))}function $_(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Y_(t){return t>0?1:t<0?-1:0}function Mf(t,e){return hr(t.prev,t,t.next)<0?hr(t,e,t.next)>=0&&hr(t,t.prev,e)>=0:hr(t,e,t.prev)<0||hr(t,t.next,e)<0}function a2(t,e){let n=Pv(t.i,t.x,t.y),a=Pv(e.i,e.x,e.y),c=t.next,m=e.prev;return t.next=e,e.prev=t,n.next=c,c.prev=n,a.next=n,n.prev=a,m.next=a,a.prev=m,a}function s2(t,e,n,a){let c=Pv(t,e,n);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function kf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Pv(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Z_(t,e){let n=t.length;if(n<=1)return[t];let a=[],c,m;for(let p=0;p<n;p++){let b=Hr(t[p]);b!==0&&(t[p].area=Math.abs(b),m===void 0&&(m=b<0),m===b<0?(c&&a.push(c),c=[t[p]]):c.push(t[p]))}if(c&&a.push(c),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(Dy(a[p],e,1,a[p].length-1,cP),a[p]=a[p].slice(0,e));return a}function cP(t,e){return e.area-t.area}function Ov(t,e,n){let a=n.patternDependencies,c=!1;for(let m of e){let p=m.paint.get(`${t}-pattern`);p.isConstant()||(c=!0);let b=p.constantOr(null);b&&(c=!0,a[b]=!0)}return c}function Rv(t,e,n,a,c){let m=c.patternDependencies;for(let p of e){let b=p.paint.get(`${t}-pattern`).value;if(b.kind!=="constant"){let y=b.evaluate({zoom:a},n,{},c.availableImages);y=y&&y.name?y.name:y,m[y]=!0,n.patterns[p.id]=y}}return n}class X_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xa,this.indexArray=new wr,this.indexArray2=new Nc,this.programConfigurations=new jc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new An,this.segments2=new An,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,a,c){this.hasPattern=Ov("fill",this.layers,n);let m=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:b,id:y,index:w,sourceLayerIndex:M}of e){let T=this.layers[0]._featureFilter.needGeometry,E=kl(b,T);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),E,a))continue;let P=m?m.evaluate(E,{},a,n.availableImages):void 0,R={id:y,properties:b.properties,type:b.type,sourceLayerIndex:M,index:w,geometry:T?E.geometry:Ka(b,a,c),patterns:{},sortKey:P};p.push(R)}m&&p.sort((b,y)=>b.sortKey-y.sortKey);for(let b of p){let{geometry:y,index:w,sourceLayerIndex:M}=b;if(this.hasPattern){let T=Rv("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(T)}else this.addFeature(b,y,w,a,{},n.availableImages,n.brightness);n.featureIndex.insert(e[w].feature,y,w,M,this.index)}}update(e,n,a,c,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,c,m)}addFeatures(e,n,a,c,m,p){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,n,a,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,JA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,c,m,p=[],b){for(let y of Z_(n,500)){let w=0;for(let F of y)w+=F.length;let M=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),T=M.vertexLength,E=[],P=[];for(let F of y){if(F.length===0)continue;F!==y[0]&&P.push(E.length/2);let B=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),W=B.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(W+F.length-1,W),E.push(F[0].x),E.push(F[0].y);for(let J=1;J<F.length;J++)this.layoutVertexArray.emplaceBack(F[J].x,F[J].y),this.indexArray2.emplaceBack(W+J-1,W+J),E.push(F[J].x),E.push(F[J].y);B.vertexLength+=F.length,B.primitiveLength+=F.length}let R=Cf(E,P);for(let F=0;F<R.length;F+=3)this.indexArray.emplaceBack(T+R[F],T+R[F+1],T+R[F+2]);M.vertexLength+=w,M.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,p,c,b)}}ne(X_,"FillBucket",{omit:["layers","patternFeatures"]});let dP=new Wi({"fill-sort-key":new wt(Pe.layout_fill["fill-sort-key"]),visibility:new Ke(Pe.layout_fill.visibility)});var hP={paint:new Wi({"fill-antialias":new Ke(Pe.paint_fill["fill-antialias"]),"fill-opacity":new wt(Pe.paint_fill["fill-opacity"]),"fill-color":new wt(Pe.paint_fill["fill-color"]),"fill-outline-color":new wt(Pe.paint_fill["fill-outline-color"]),"fill-translate":new Ke(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ke(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new wt(Pe.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ke(Pe.paint_fill["fill-emissive-strength"])}),layout:dP};class Lv{constructor(e,n,a,c){if(this.triangleCount=n.length/3,this.min=new yt(0,0),this.max=new yt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[m,p]=[e[0].clone(),e[0].clone()];for(let T=1;T<e.length;++T){let E=e[T];m.x=Math.min(m.x,E.x),m.y=Math.min(m.y,E.y),p.x=Math.max(p.x,E.x),p.y=Math.max(p.y,E.y)}if(c){let T=Math.ceil(Math.max(p.x-m.x,p.y-m.y)/c);a=Math.max(a,T)}if(a===0)return;this.min=m,this.max=p;let b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);let y=Math.max(b.x,b.y)/a;this.cellsX=Math.max(1,Math.ceil(b.x/y)),this.cellsY=Math.max(1,Math.ceil(b.y/y)),this.xScale=1/y,this.yScale=1/y;let w=[];for(let T=0;T<this.triangleCount;T++){let E=e[n[3*T+0]].sub(this.min),P=e[n[3*T+1]].sub(this.min),R=e[n[3*T+2]].sub(this.min),F=Bs(Math.floor(Math.min(E.x,P.x,R.x)),this.xScale,this.cellsX),B=Bs(Math.floor(Math.max(E.x,P.x,R.x)),this.xScale,this.cellsX),W=Bs(Math.floor(Math.min(E.y,P.y,R.y)),this.yScale,this.cellsY),J=Bs(Math.floor(Math.max(E.y,P.y,R.y)),this.yScale,this.cellsY),ee=new yt(0,0),te=new yt(0,0),me=new yt(0,0),he=new yt(0,0);for(let ve=W;ve<=J;++ve){ee.y=te.y=ve*y,me.y=he.y=(ve+1)*y;for(let Ce=F;Ce<=B;++Ce)ee.x=me.x=Ce*y,te.x=he.x=(Ce+1)*y,(xv(E,P,R,ee,te,he)||xv(E,P,R,ee,he,me))&&w.push({cellIdx:ve*this.cellsX+Ce,triIdx:T})}}if(w.length===0)return;w.sort((T,E)=>T.cellIdx-E.cellIdx||T.triIdx-E.triIdx);let M=0;for(;M<w.length;){let T=w[M].cellIdx,E={start:this.payload.length,len:0};for(;M<w.length&&w[M].cellIdx===T;)++E.len,this.payload.push(w[M++].triIdx);this.cells[T]=E}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let a=Bs(e.x-this.min.x,this.xScale,this.cellsX),c=Bs(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[c*this.cellsX+a];if(m){this._lazyInitLookup();for(let p=0;p<m.len;p++){let b=this.payload[m.start+p],y=Math.floor(b/8),w=1<<b%8;if(!(this.lookup[y]&w)&&(this.lookup[y]|=w,n.push(b),n.length===this.triangleCount))return}}}query(e,n,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();let c=Bs(e.x-this.min.x,this.xScale,this.cellsX),m=Bs(n.x-this.min.x,this.xScale,this.cellsX),p=Bs(e.y-this.min.y,this.yScale,this.cellsY),b=Bs(n.y-this.min.y,this.yScale,this.cellsY);for(let y=p;y<=b;y++)for(let w=c;w<=m;w++){let M=this.cells[y*this.cellsX+w];if(M)for(let T=0;T<M.len;T++){let E=this.payload[M.start+T],P=Math.floor(E/8),R=1<<E%8;if(!(this.lookup[P]&R)&&(this.lookup[P]|=R,a.push(E),a.length===this.triangleCount))return}}}}function Bs(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}ne(Lv,"TriangleGridIndex");class l2{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(let a of this.footprints)n.push({footprint:a,id:e})}populate(e,n,a,c){let m=[];for(let{feature:p,id:b,index:y,sourceLayerIndex:w}of e){let M=this.layers[0]._featureFilter.needGeometry,T=kl(p,M);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),T,a))continue;let E={id:b,properties:p.properties,type:p.type,sourceLayerIndex:w,index:y,geometry:M?T.geometry:Ka(p,a,c),patterns:{}};m.push(E)}for(let p of m){let{geometry:b,index:y,sourceLayerIndex:w}=p;this.addFeature(p,b,y,a,{},n.availableImages,n.brightness),n.featureIndex.insert(e[y].feature,b,y,w,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,a,c,m){}destroy(){}addFeature(e,n,a,c,m,p=[],b){for(let y of Z_(n,2)){let w=[],M=[],T=[],E=new yt(1/0,1/0),P=new yt(-1/0,-1/0);for(let B of y)if(B.length!==0){B!==y[0]&&T.push(M.length/2);for(let W=0;W<B.length;W++)M.push(B[W].x),M.push(B[W].y),w.push(B[W]),E.x=Math.min(E.x,B[W].x),E.y=Math.min(E.y,B[W].y),P.x=Math.max(P.x,B[W].x),P.y=Math.max(P.y,B[W].y)}let R=Cf(M,T),F=new Lv(w,R,8,256);this.footprints.push({vertices:w,indices:R,grid:F,min:E,max:P})}}}ne(l2,"ClipBucket",{omit:["layers"]});let uP=new Wi({"clip-layer-types":new Ke(Pe.layout_clip["clip-layer-types"])});var mP={paint:new Wi({}),layout:uP};let pP=Gi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),fP=Gi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),gP=Gi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),_P=Gi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),bP=Gi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:yP}=pP;var Q_={},vP=ou,c2=Ku;function Ku(t,e,n,a,c){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=c,t.readFields(xP,this,e)}function xP(t,e,n){t==1?e.id=n.readVarint():t==2?function(a,c){for(var m=a.readVarint()+a.pos;a.pos<m;){var p=c._keys[a.readVarint()],b=c._values[a.readVarint()];c.properties[p]=b}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function wP(t){for(var e,n,a=0,c=0,m=t.length,p=m-1;c<m;p=c++)a+=((n=t[p]).x-(e=t[c]).x)*(e.y+n.y);return a}Ku.types=["Unknown","Point","LineString","Polygon"],Ku.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,a=1,c=0,m=0,p=0,b=[];t.pos<n;){if(c<=0){var y=t.readVarint();a=7&y,c=y>>3}if(c--,a===1||a===2)m+=t.readSVarint(),p+=t.readSVarint(),a===1&&(e&&b.push(e),e=[]),e.push(new vP(m,p));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&b.push(e),b},Ku.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,a=0,c=0,m=0,p=1/0,b=-1/0,y=1/0,w=-1/0;t.pos<e;){if(a<=0){var M=t.readVarint();n=7&M,a=M>>3}if(a--,n===1||n===2)(c+=t.readSVarint())<p&&(p=c),c>b&&(b=c),(m+=t.readSVarint())<y&&(y=m),m>w&&(w=m);else if(n!==7)throw new Error("unknown command "+n)}return[p,y,b,w]},Ku.prototype.toGeoJSON=function(t,e,n){var a,c,m=this.extent*Math.pow(2,n),p=this.extent*t,b=this.extent*e,y=this.loadGeometry(),w=Ku.types[this.type];function M(P){for(var R=0;R<P.length;R++){var F=P[R];P[R]=[360*(F.x+p)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(a=0;a<y.length;a++)T[a]=y[a][0];M(y=T);break;case 2:for(a=0;a<y.length;a++)M(y[a]);break;case 3:for(y=function(P){var R=P.length;if(R<=1)return[P];for(var F,B,W=[],J=0;J<R;J++){var ee=wP(P[J]);ee!==0&&(B===void 0&&(B=ee<0),B===ee<0?(F&&W.push(F),F=[P[J]]):F.push(P[J]))}return F&&W.push(F),W}(y),a=0;a<y.length;a++)for(c=0;c<y[a].length;c++)M(y[a][c])}y.length===1?y=y[0]:w="Multi"+w;var E={type:"Feature",geometry:{type:w,coordinates:y},properties:this.properties};return"id"in this&&(E.id=this.id),E};var CP=c2,d2=h2;function h2(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(SP,this,e),this.length=this._features.length}function SP(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(a){for(var c=null,m=a.readVarint()+a.pos;a.pos<m;){var p=a.readVarint()>>3;c=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return c}(n))}h2.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new CP(this._pbf,e,this.extent,this._keys,this._values)};var MP=d2;function kP(t,e,n){if(t===3){var a=new MP(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}var Fv=Q_.VectorTile=function(t,e){this.layers=t.readFields(kP,{},e)},K_=Q_.VectorTileFeature=c2;Q_.VectorTileLayer=d2;class Ch extends yt{constructor(e,n,a){super(e,n),this.z=a}}class u2 extends Ch{constructor(e,n,a,c){super(e,n,a),this.w=c}}function J_(t,e,n,a){let c=[],m=a===0?(p,b,y,w,M,T)=>{p.push(new yt(T,y+(T-b)/(w-b)*(M-y)))}:(p,b,y,w,M,T)=>{p.push(new yt(b+(T-y)/(M-y)*(w-b),T))};for(let p of t){let b=[];for(let y of p){if(y.length<=2)continue;let w=[];for(let E=0;E<y.length-1;E++){let P=y[E].x,R=y[E].y,F=y[E+1].x,B=y[E+1].y,W=a===0?P:R,J=a===0?F:B;W<e?J>e&&m(w,P,R,F,B,e):W>n?J<n&&m(w,P,R,F,B,n):w.push(y[E]),J<e&&W>=e&&m(w,P,R,F,B,e),J>n&&W<=n&&m(w,P,R,F,B,n)}let M=y[y.length-1],T=a===0?M.x:M.y;T>=e&&T<=n&&w.push(M),w.length&&(M=w[w.length-1],w[0].x===M.x&&w[0].y===M.y||w.push(w[0]),b.push(w))}b.length&&c.push(b)}return c}function m2(t,e,n,a){let c=n==="x"?"y":"x",m=(a-t[n])/(e[n]-t[n]);t[c]=t[c]+(e[c]-t[c])*m,t[n]=a,t.hasOwnProperty("z")&&(t.z=Wt(t.z,e.z,m)),t.hasOwnProperty("w")&&(t.w=Wt(t.w,e.w,m))}function p2(t,e,n,a){let c=n,m=a;for(let p of["x","y"]){let b=t,y=e;b[p]>=y[p]&&(b=e,y=t),b[p]<c&&y[p]>c&&m2(b,y,p,c),b[p]<m&&y[p]>m&&m2(y,b,p,m)}}function e0(t,e){return t.x-e.x||t.y-e.y}function f2(t,e){return e0(t.min,e.min)===0&&e0(t.max,e.max)===0}function zv(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Bv(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n].sourceId!==e[n].sourceId||!f2(t[n],e[n])||t[n].order!==e[n].order||t[n].clipMask!==e[n].clipMask)return!1;return!0}function g2(t,e,n){let a=1/pt,c=1/(1<<n.canonical.z),m=(e.x*a+n.canonical.x)*c+n.wrap,p=(e.y*a+n.canonical.y)*c;return{min:new yt((t.x*a+n.canonical.x)*c+n.wrap,(t.y*a+n.canonical.y)*c),max:new yt(m,p)}}function TP(t,e,n){let a=1<<n.canonical.z,c=((e.x-n.wrap)*a-n.canonical.x)*pt,m=(e.y*a-n.canonical.y)*pt;return{min:new yt(((t.x-n.wrap)*a-n.canonical.x)*pt,(t.y*a-n.canonical.y)*pt),max:new yt(c,m)}}function _2(t,e,n,a,c,m,p){let b=t.indices,y=t.vertices,w=[];for(let M=a;M<a+c;M+=3){let T=e[n[M+0]+m],E=e[n[M+1]+m],P=e[n[M+2]+m],R=Math.min(T.x,E.x,P.x),F=Math.max(T.x,E.x,P.x),B=Math.min(T.y,E.y,P.y),W=Math.max(T.y,E.y,P.y);w.length=0,t.grid.query(new yt(R,B),new yt(F,W),w);for(let J=0;J<w.length;J++){let ee=w[J];if(xv(y[b[3*ee+0]],y[b[3*ee+1]],y[b[3*ee+2]],T,E,P,p))return!0}}return!1}function b2(t,e,n,a){if(!t||!n)return!1;let c=t.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(n.vertices.length<t.vertices.length)return b2(n,a,t,e);let m=e.canonical,p=a.canonical,b=Math.pow(2,p.z-m.z);c=t.vertices.map(y=>new yt((y.x+m.x*pt)*b-p.x*pt,(y.y+m.y*pt)*b-p.y*pt))}return _2(n,c,t.indices,0,t.indices.length,0,0)}function y2(t,e,n,a){let c=Math.pow(2,a.z-n.z);return new yt((t+n.x*pt)*c-a.x*pt,(e+n.y*pt)*c-a.y*pt)}function v2(t,e){let n=[];e.footprint.grid.queryPoint(t,n);let a=e.footprint.indices,c=e.footprint.vertices;for(let m=0;m<n.length;m++){let p=n[m];if(Hc([c[a[3*p+0]],c[a[3*p+1]],c[a[3*p+2]]],t))return!0}return!1}class x2{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function w2(t,e,n,a){let c=0,m=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(n[p]<t[p]||n[p]>e[p])return null}else{let b=1/a[p],y=(t[p]-n[p])*b,w=(e[p]-n[p])*b;if(y>w){let M=y;y=w,w=M}if(y>c&&(c=y),w<m&&(m=w),c>m)return null}return c}function C2(t,e,n,a,c,m,p,b,y,w,M){let T=a-t,E=c-e,P=m-n,R=p-t,F=b-e,B=y-n,W=M[1]*B-M[2]*F,J=M[2]*R-M[0]*B,ee=M[0]*F-M[1]*R,te=T*W+E*J+P*ee;if(Math.abs(te)<1e-15)return null;let me=1/te,he=w[0]-t,ve=w[1]-e,Ce=w[2]-n,De=(he*W+ve*J+Ce*ee)*me;if(De<0||De>1)return null;let Ue=ve*P-Ce*E,ze=Ce*T-he*P,$e=he*E-ve*T,rt=(M[0]*Ue+M[1]*ze+M[2]*$e)*me;return rt<0||De+rt>1?null:(R*Ue+F*ze+B*$e)*me}function S2(t,e,n){return(t-e)/(n-e)}function M2(t,e,n,a,c,m,p,b,y){let w=1<<n,M=m-a,T=p-c,E=(t+1)/w*M+a,P=(e+0)/w*T+c,R=(e+1)/w*T+c;b[0]=(t+0)/w*M+a,b[1]=P,y[0]=E,y[1]=R}class k2{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(m){let p=Math.ceil(Math.log2(m.dim/8)),b=[],y=Math.ceil(Math.pow(2,p)),w=1/y,M=(P,R,F,B,W)=>{let J=B?1:0,ee=(P+1)*F-J,te=R*F,me=(R+1)*F-J;W[0]=P*F,W[1]=te,W[2]=ee,W[3]=me},T=new x2(y),E=[];for(let P=0;P<y*y;P++){M(P%y,Math.floor(P/y),w,!1,E);let R=Gc(E[0],E[1],m),F=Gc(E[2],E[1],m),B=Gc(E[2],E[3],m),W=Gc(E[0],E[3],m);T.minimums.push(Math.min(R,F,B,W)),T.maximums.push(Math.max(R,F,B,W)),T.leaves.push(1)}for(b.push(T),y/=2;y>=1;y/=2){let P=b[b.length-1];T=new x2(y);for(let R=0;R<y*y;R++){M(R%y,Math.floor(R/y),2,!0,E);let F=P.getElevation(E[0],E[1]),B=P.getElevation(E[2],E[1]),W=P.getElevation(E[2],E[3]),J=P.getElevation(E[0],E[3]),ee=P.isLeaf(E[0],E[1]),te=P.isLeaf(E[2],E[1]),me=P.isLeaf(E[2],E[3]),he=P.isLeaf(E[0],E[3]),ve=Math.min(F.min,B.min,W.min,J.min),Ce=Math.max(F.max,B.max,W.max,J.max),De=ee&&te&&me&&he;T.maximums.push(Ce),T.minimums.push(ve),T.leaves.push(Ce-ve<=5&&De?1:0)}b.push(T)}return b}(this.dem),a=n.length-1,c=n[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,c,m,p,b=1){return w2([e,n,-100],[a,c,this.maximums[0]*b],m,p)}raycast(e,n,a,c,m,p,b=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,n,a,c,m,p,b);if(y==null)return null;let w=[],M=[],T=[],E=[],P=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;P.length>0;){let{idx:R,t:F,nodex:B,nodey:W,depth:J}=P.pop();if(this.leaves[R]){M2(B,W,J,e,n,a,c,T,E);let te=1<<J,me=(B+0)/te,he=(B+1)/te,ve=(W+0)/te,Ce=(W+1)/te,De=Gc(me,ve,this.dem)*b,Ue=Gc(he,ve,this.dem)*b,ze=Gc(he,Ce,this.dem)*b,$e=Gc(me,Ce,this.dem)*b,rt=C2(T[0],T[1],De,E[0],T[1],Ue,E[0],E[1],ze,m,p),We=C2(E[0],E[1],ze,T[0],E[1],$e,T[0],T[1],De,m,p),et=Math.min(rt!==null?rt:Number.MAX_VALUE,We!==null?We:Number.MAX_VALUE);if(et!==Number.MAX_VALUE)return et;{let He=i._.scaleAndAdd([],m,p,F);if(T2(De,Ue,$e,ze,S2(He[0],T[0],E[0]),S2(He[1],T[1],E[1]))>=He[2])return F}continue}let ee=0;for(let te=0;te<this._siblingOffset.length;te++){M2((B<<1)+this._siblingOffset[te][0],(W<<1)+this._siblingOffset[te][1],J+1,e,n,a,c,T,E),T[2]=-100,E[2]=this.maximums[this.childOffsets[R]+te]*b;let me=w2(T,E,m,p);if(me!=null){let he=me;w[te]=he;let ve=!1;for(let Ce=0;Ce<ee&&!ve;Ce++)he>=w[M[Ce]]&&(M.splice(Ce,0,te),ve=!0);ve||(M[ee]=te),ee++}}for(let te=0;te<ee;te++){let me=M[te];P.push({idx:this.childOffsets[R]+me,t:w[me],nodex:(B<<1)+this._siblingOffset[me][0],nodey:(W<<1)+this._siblingOffset[me][1],depth:J+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,c,m){if(e[c].isLeaf(n,a)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);let p=c-1,b=e[p],y=0,w=0;for(let M=0;M<this._siblingOffset.length;M++){let T=2*n+this._siblingOffset[M][0],E=2*a+this._siblingOffset[M][1],P=b.getElevation(T,E),R=b.isLeaf(T,E),F=this._addNode(P.min,P.max,R);R&&(y|=1<<M),w||(w=F)}for(let M=0;M<this._siblingOffset.length;M++)y&1<<M||this._construct(e,2*n+this._siblingOffset[M][0],2*a+this._siblingOffset[M][1],p,w+M)}}function T2(t,e,n,a,c,m){return Wt(Wt(t,n,m),Wt(e,a,m),c)}function Gc(t,e,n){let a=n.dim,c=pi(t*a-.5,0,a-1),m=pi(e*a-.5,0,a-1),p=Math.floor(c),b=Math.floor(m),y=Math.min(p+1,a-1),w=Math.min(b+1,a-1);return T2(n.get(p,b),n.get(y,b),n.get(p,w),n.get(y,w),c-p,m-b)}let IP={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function EP(t,e,n){return(256*t*256+256*e+n)/10-1e4}function DP(t,e,n){return 256*t+e+n/256-32768}class t0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,c=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return qn(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let m=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let y=0;y<m;y++)p[this._idx(-1,y)]=p[this._idx(0,y)],p[this._idx(m,y)]=p[this._idx(m-1,y)],p[this._idx(y,-1)]=p[this._idx(y,0)],p[this._idx(y,m)]=p[this._idx(y,m-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(m,-1)]=p[this._idx(m-1,0)],p[this._idx(-1,m)]=p[this._idx(0,m-1)],p[this._idx(m,m)]=p[this._idx(m-1,m-1)]}let b=a==="terrarium"?DP:EP;for(let y=0;y<p.length;++y){let w=4*y;this.floatView[y]=b(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=kr.now()}_buildQuadTree(){this._tree=new k2(this)}get(e,n,a=!1){a&&(e=pi(e,-1,this.dim),n=pi(n,-1,this.dim));let c=this._idx(e,n);return this.floatView[c]}set(e,n,a){let c=this._idx(e,n),m=this.floatView[c];return this.floatView[c]=a,a-m}static getUnpackVector(e){return IP[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let a=[0,0,0,0],c=t0.getUnpackVector(n),m=Math.floor((e+c[3])/c[2]);return a[2]=m%256,m=Math.floor(m/256),a[1]=m%256,m=Math.floor(m/256),a[0]=m,a}getPixels(){return new n2({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,p=a*this.dim,b=a*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(a){case-1:p=b-1;break;case 1:b=p+1}let y=-n*this.dim,w=-a*this.dim;for(let M=p;M<b;M++)for(let T=c;T<m;T++){let E=4*this._idx(T,M),P=4*this._idx(T+y,M+w);this.pixels[E+0]=e.pixels[P+0],this.pixels[E+1]=e.pixels[P+1],this.pixels[E+2]=e.pixels[P+2],this.pixels[E+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ne(t0,"DEMData"),ne(k2,"DemMinMaxQuadTree",{omit:["dem"]});class Ju{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){let c=a||e.findDEMTileFor(n);if(!c||!c.dem)return;let m=c.dem,p=c.tileID,b=1<<n.canonical.z-p.canonical.z;return new Ju(c,m.dim/pt/b,[(n.canonical.x/b-p.canonical.x)*m.dim,(n.canonical.y/b-p.canonical.y)*m.dim])}tileCoordToPixel(e,n){let a=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),m=Math.floor(a);return new yt(c,m)}getElevationAt(e,n,a,c){let m=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],b=Math.floor(m),y=Math.floor(p),w=this._dem;return c=!!c,a?Wt(Wt(w.get(b,y,c),w.get(b,y+1,c),p-y),Wt(w.get(b+1,y,c),w.get(b+1,y+1,c),p-y),m-b):w.get(b,y,c)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*go(1,e)*this._dem.stride}}let I2={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},AP=K_.types,PP=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],OP=["fill-extrusion-flood-light-ground-radius"],RP=Math.pow(2,13),LP=Math.pow(2,15)-1,E2=new yt(0,1),qc=2147483648;function Tf(t,e,n,a,c,m,p,b){t.emplaceBack((e<<1)+p,(n<<1)+m,(Math.floor(a*RP)<<1)+c,Math.round(b))}function i0(t,e,n,a,c,m){t.emplaceBack(e.x,e.y,(n.x<<1)+a,(n.y<<1)+c,m)}function If(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class D2{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class A2{constructor(){this.centroidXY=new yt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new yt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new yt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new yt(this.max.x-this.min.x,this.max.y-this.min.y)}}class P2{constructor(){this.acc=new yt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,a){this.accCount++,this.acc._add(n);let c=!!this.borders;n.x<e.min.x?(e.min.x=n.x,c=!0):n.x>e.max.x&&(e.max.x=n.x,c=!0),n.y<e.min.y?(e.min.y=n.y,c=!0):n.y>e.max.y&&(e.max.y=n.y,c=!0),((n.x===0||n.x===pt)&&n.x===a.x)!=((n.y===0||n.y===pt)&&n.y===a.y)&&this.processBorderOverlap(n,a),c&&this.checkBorderIntersection(n,a)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Wt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>pt!=e.x>pt&&this.addBorderIntersection(1,Wt(n.y,e.y,(pt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Wt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>pt!=e.y>pt&&this.addBorderIntersection(3,Wt(n.x,e.x,(pt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{let a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new yt(0,0):new yt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function O2(t,e){let n=t.add(e)._unit(),a=pi(t.x*n.x+t.y*n.y,-1,1);var c,m,p;return c=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(c)))/4*LP*((m=t).x*(p=e).y-m.y*p.x<0?-1:1)}let FP=[t=>t.x<0,t=>t.x>pt,t=>t.y<0,t=>t.y>pt];function zP(t,e,n,a){let c=[4];if(a===0)return c;n._mult(a);let m=t.sub(n),p=e.sub(n),b=[t,e,m,p];for(let y=0;y<4;y++)for(let w of b)if(FP[y](w)){c.push(y);break}return c}class R2{constructor(e){this.vertexArray=new Hy,this.indexArray=new wr,this.programConfigurations=new jc(e.layers,{zoom:e.zoom,lut:e.lut},n=>OP.includes(n)),this._segments=new An,this.hiddenByLandmarkVertexArray=new nv,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new An}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,a,c=!1){let m=e.length;if(m>2){let p=Math.max(0,this._segments.get().length-1),b=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),y;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let w=e[0],M=e[1];y=O2(w.sub(e[m-1])._perp()._unit(),M.sub(w)._perp()._unit())}for(let w=0;w<m;w++){let M=w===m-1?0:w+1,T=e[w],E=e[M],P=e[M===m-1?0:M+1],R=E.sub(T)._perp()._unit(),F=O2(R,P.sub(E)._perp()._unit()),B=y,W=F;if(Nv(T,E,n)||c&&z2(T,n)&&z2(E,n)){y=F;continue}let J=b.vertexLength;i0(this.vertexArray,T,E,1,1,B),i0(this.vertexArray,T,E,1,0,B),i0(this.vertexArray,T,E,0,1,W),i0(this.vertexArray,T,E,0,0,W),b.vertexLength+=4;let ee=zP(T,E,R,a);for(let te of ee)this._segmentToGroundQuads[p].push({id:J,region:te}),this._segmentToRegionTriCounts[p][te]+=2,b.primitiveLength+=2;y=F}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let a=0;a<n;a++)this._segmentToGroundQuads[a].sort((c,m)=>c.region-m.region);for(let a=0;a<n;a++){let c=this._segmentToGroundQuads[a],m=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((y,w)=>y+w,0);let b=0;for(let y=0;y<=4;y++){let w=p[y];if(w!==0){let M=this.regionSegments[y];M||(M=this.regionSegments[y]=new An);let T={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+b,vertexLength:m.vertexLength,primitiveLength:w};M.get().push(T)}b+=w}for(let y=0;y<c.length;y++){let w=c[y].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,a,c,m,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,a,c,m,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,fP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,a,c,m,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,a,c,m,p)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let a=e.flags&qc?1:0;for(let c=e.groundVertexArrayOffset;c<n;++c)this.hiddenByLandmarkVertexArray.emplace(c,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,_P.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class n0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new wr,this.footprintVertices=new Xa,this.footprintSegments=[],this.layoutVertexArray=new Lc,this.centroidVertexArray=new yC,this.indexArray=new wr,this.programConfigurations=new jc(e.layers,{zoom:e.zoom,lut:e.lut},n=>PP.includes(n)),this.segments=new An,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new R2(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,a,c){this.features=[],this.hasPattern=Ov("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=B_(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:m,id:p,index:b,sourceLayerIndex:y}of e){let w=this.layers[0]._featureFilter.needGeometry,M=kl(m,w);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),M,a))continue;let T={id:p,sourceLayerIndex:y,index:b,geometry:w?M.geometry:Ka(m,a,c),properties:m.properties,type:m.type,patterns:{}},E=this.layoutVertexArray.length;this.hasPattern?this.features.push(Rv("fill-extrusion",this.layers,T,this.zoom,n)):this.addFeature(T,T.geometry,b,a,{},n.availableImages,c,n.brightness),n.featureIndex.insert(m,T.geometry,b,y,this.index,E)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,a,c,m,p){for(let b of this.features){let{geometry:y}=b;this.addFeature(b,y,b.index,n,a,c,m,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,a,c,m){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let b=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,b,a,c,m),this.groundEffect.update(e,n,b,a,c,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,bP.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,gP.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,c,m,p,b,y){let w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,M=[new yt(0,0),new yt(pt,pt)],T=b.projection,E=T.name==="globe",P=AP[e.type]==="Polygon",R=new P2;R.centroidDataIndex=this.centroidData.length;let F=new A2,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,W=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);F.height=W,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new O_);let J=Z_(n,500);for(let Ce=J.length-1;Ce>=0;Ce--){let De=J[Ce];(De.length===0||(ee=De[0]).every(Ue=>Ue.x<=0)||ee.every(Ue=>Ue.x>=pt)||ee.every(Ue=>Ue.y<=0)||ee.every(Ue=>Ue.y>=pt))&&J.splice(Ce,1)}var ee;let te;if(E)te=j2(J,M,c);else{te=[];for(let Ce of J)te.push({polygon:Ce,bounds:M})}let me=P?this.edgeRadius:0,he=me>0&&this.zoom<17,ve=(Ce,De)=>{if(Ce.length===0)return!1;let Ue=Ce[Ce.length-1];return De.x===Ue.x&&De.y===Ue.y};for(let{polygon:Ce,bounds:De}of te){let Ue=0,ze=0;for(let et of Ce)P&&!et[0].equals(et[et.length-1])&&et.push(et[0]),ze+=P?et.length-1:et.length;let $e=this.segments.prepareSegment((P?5:4)*ze,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);let rt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},We=new D2;if(We.vertexOffset=this.footprintVertices.length,We.indexOffset=3*this.footprintIndices.length,We.ringIndices=[],P){let et=[],He=[];Ue=$e.vertexLength;for(let st=0;st<Ce.length;st++){let nt=Ce[st];nt.length&&st!==0&&He.push(et.length/2);let Mt=[],ot,dt;ot=nt[1].sub(nt[0])._perp()._unit(),We.ringIndices.push(nt.length-1);for(let Nt=1;Nt<nt.length;Nt++){let Ft=nt[Nt],Pt=nt[Nt===nt.length-1?1:Nt+1],ct=Ft.clone();if(me){dt=Pt.sub(Ft)._perp()._unit();let Vt=ot.add(dt)._unit(),oi=me*Math.min(4,1/(ot.x*Vt.x+ot.y*Vt.y));ct.x+=oi*Vt.x,ct.y+=oi*Vt.y,ct.x=Math.round(ct.x),ct.y=Math.round(ct.y),ot=dt}!B||me!==0&&!he||ve(Mt,ct)||Mt.push(ct),Tf(this.layoutVertexArray,ct.x,ct.y,0,0,1,1,0),$e.vertexLength++,this.footprintVertices.emplaceBack(Ft.x,Ft.y),et.push(Ft.x,Ft.y),E&&If(this.layoutVertexExtArray,T.projectTilePoint(ct.x,ct.y,c),T.upVector(c,ct.x,ct.y))}B&&(me===0||he)&&(Mt.length!==0&&ve(Mt,Mt[0])&&Mt.pop(),this.groundEffect.addData(Mt,De,w))}let tt=Cf(et,He);for(let st=0;st<tt.length;st+=3)this.footprintIndices.emplaceBack(We.vertexOffset+tt[st+0],We.vertexOffset+tt[st+1],We.vertexOffset+tt[st+2]),this.indexArray.emplaceBack(Ue+tt[st],Ue+tt[st+2],Ue+tt[st+1]),$e.primitiveLength++;We.indexCount+=tt.length,We.vertexCount+=this.footprintVertices.length-We.vertexOffset}for(let et=0;et<Ce.length;et++){let He=Ce[et];R.startRing(F,He[0]);let tt=He.length>4&&B2(He[He.length-2],He[0],He[1]),st=me?BP(He[He.length-2],He[0],He[1],me):0,nt=[],Mt,ot,dt;ot=He[1].sub(He[0])._perp()._unit();let Nt=!0;for(let Ft=1,Pt=0;Ft<He.length;Ft++){let ct=He[Ft-1],Vt=He[Ft],oi=He[Ft===He.length-1?1:Ft+1];if(R.appendEdge(F,Vt,ct),Nv(Vt,ct,De)){me&&(ot=oi.sub(Vt)._perp()._unit(),Nt=!Nt);continue}let Zt=Vt.sub(ct)._perp(),di=Zt.x/(Math.abs(Zt.x)+Math.abs(Zt.y)),ai=Zt.y>0?1:0,_i=ct.dist(Vt);if(Pt+_i>32768&&(Pt=0),me){dt=oi.sub(Vt)._perp()._unit();let Ni=F2(ct,Vt,oi,L2(ot,dt),me);isNaN(Ni)&&(Ni=0);let Ei=Vt.sub(ct)._unit();ct=ct.add(Ei.mult(st))._round(),Vt=Vt.add(Ei.mult(-Ni))._round(),st=Ni,ot=dt,B&&this.zoom>=17&&(ve(nt,ct)||nt.push(ct),ve(nt,Vt)||nt.push(Vt))}let qt=$e.vertexLength,rn=He.length>4&&B2(ct,Vt,oi),nn=N2(Pt,tt,Nt);if(Tf(this.layoutVertexArray,ct.x,ct.y,di,ai,0,0,nn),Tf(this.layoutVertexArray,ct.x,ct.y,di,ai,0,1,nn),Pt+=_i,nn=N2(Pt,rn,!Nt),tt=rn,Tf(this.layoutVertexArray,Vt.x,Vt.y,di,ai,0,0,nn),Tf(this.layoutVertexArray,Vt.x,Vt.y,di,ai,0,1,nn),$e.vertexLength+=4,this.indexArray.emplaceBack(qt+0,qt+1,qt+2),this.indexArray.emplaceBack(qt+1,qt+3,qt+2),$e.primitiveLength+=2,me){let Ni=Ue+(Ft===1?He.length-2:Ft-2),Ei=Ft===1?Ue:Ni+1;if(this.indexArray.emplaceBack(qt+1,Ni,qt+3),this.indexArray.emplaceBack(Ni,Ei,qt+3),$e.primitiveLength+=2,Mt===void 0&&(Mt=qt),!Nv(oi,He[Ft],De)){let Vi=Ft===He.length-1?Mt:$e.vertexLength;this.indexArray.emplaceBack(qt+2,qt+3,Vi),this.indexArray.emplaceBack(qt+3,Vi+1,Vi),this.indexArray.emplaceBack(qt+3,Ei,Vi+1),$e.primitiveLength+=3}Nt=!Nt}if(E){let Ni=this.layoutVertexExtArray,Ei=T.projectTilePoint(ct.x,ct.y,c),Vi=T.projectTilePoint(Vt.x,Vt.y,c),gn=T.upVector(c,ct.x,ct.y),hn=T.upVector(c,Vt.x,Vt.y);If(Ni,Ei,gn),If(Ni,Ei,gn),If(Ni,Vi,hn),If(Ni,Vi,hn)}}P&&(Ue+=He.length-1),B&&me&&this.zoom>=17&&(nt.length!==0&&ve(nt,nt[0])&&nt.pop(),this.groundEffect.addData(nt,De,w,me>0))}this.footprintSegments.push(We),rt.triangleCount=this.indexArray.length-rt.triangleArrayOffset,this.polygonSegments.push(rt),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=R.borders?E2:this.encodeCentroid(R,F),this.centroidData.push(F),R.borders){this.featuresOnBorder.push(R);let Ce=this.featuresOnBorder.length-1;for(let De=0;De<R.borders.length;De++)R.borders[De][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[De].push(Ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,p,c,y),this.groundEffect.addPaintPropertiesData(e,a,m,p,c,y),this.maxHeight=Math.max(this.maxHeight,W)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){let e=[];for(let b=0;b<this.centroidData.length;b++){let y=this.centroidData[b],w=+(y.min.y+y.max.y>pt),M=2*w+(+(y.min.x+y.max.x>pt)^w);for(let T=0;T<y.polygonSegLen;T++){let E=y.polygonSegIdx+T;e.push({centroidIdx:b,subtile:M,polygonSegmentIdx:E,triangleSegmentIdx:this.polygonSegments[E].triangleSegIdx})}}let n=new wr;e.sort((b,y)=>b.triangleSegmentIdx===y.triangleSegmentIdx?b.subtile-y.subtile:b.triangleSegmentIdx-y.triangleSegmentIdx);let a=0,c=0,m=0;for(let b of e){if(b.triangleSegmentIdx!==a)break;m++}let p=e.length;for(;c!==e.length;){a=e[c].triangleSegmentIdx;let b=0,y=c,w=c;for(let M=y;M<m&&e[M].subtile===b;M++)w++;for(;y!==m;){let M=e[y];b=M.subtile;let T=this.centroidData[M.centroidIdx].min.clone(),E=this.centroidData[M.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=y;R<w;R++){let F=e[R],B=this.polygonSegments[F.polygonSegmentIdx],W=this.centroidData[F.centroidIdx].min,J=this.centroidData[F.centroidIdx].max,ee=this.indexArray.uint16;for(let te=B.triangleArrayOffset;te<B.triangleArrayOffset+B.triangleCount;te++)n.emplaceBack(ee[3*te],ee[3*te+1],ee[3*te+2]);P.primitiveLength+=B.triangleCount,T.x=Math.min(T.x,W.x),T.y=Math.min(T.y,W.y),E.x=Math.max(E.x,J.x),E.y=Math.max(E.y,J.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:T,max:E}),y=w;for(let R=y;R<m&&e[R].subtile===e[y].subtile;R++)w++}c=m;for(let M=c;M<p&&e[M].triangleSegmentIdx===e[c].triangleSegmentIdx;M++)m++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,a){let c=0,m=0,p=1<<e.canonical.z;if(n){let F=n.getMinMaxForTile(e);F&&(c=F.min,m=F.max)}m+=this.maxHeight;let b=e.toUnwrapped(),y,w=[b.canonical.x/p+b.wrap,b.canonical.y/p],M=[(b.canonical.x+1)/p+b.wrap,(b.canonical.y+1)/p],T=new An,E=(F,B,W)=>[F[0]*(1-W[0])+B[0]*W[0],F[1]*(1-W[1])+B[1]*W[1]],P=[],R=[];for(let F of this.triangleSubSegments){P[0]=F.min.x/pt,P[1]=F.min.y/pt,R[0]=F.max.x/pt,R[1]=F.max.y/pt;let B=E(w,M,P),W=E(w,M,R);if(new Pn([B[0],B[1],c],[W[0],W[1],m]).intersectsPrecise(a)===0){y&&(T.segments.push(y),y=void 0);continue}let J=F.segment;y&&y.vertexOffset!==J.vertexOffset&&(T.segments.push(y),y=void 0),y?(y.vertexLength+=J.vertexLength,y.primitiveLength+=J.primitiveLength):y={vertexOffset:J.vertexOffset,primitiveLength:J.primitiveLength,vertexLength:J.vertexLength,primitiveOffset:J.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&T.segments.push(y),T}encodeCentroid(e,n){let a=e.centroid(),c=n.span(),m=Math.min(7,Math.round(c.x*this.tileToMeter/10)),p=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new yt(pi(a.x,1,pt-1)<<3|m,pi(a.y,1,pt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new yt(0,0);let n=e.borders,a=Number.MAX_VALUE;if(n[0][0]!==a||n[1][0]!==a){let c=n[0][0]!==a?0:1;return new yt(6|(n[0][0]!==a?0:65528),(n[c][0]+n[c][1])/2<<3|6)}{let c=n[2][0]!==a?2:3;return new yt((n[c][0]+n[c][1])/2<<3|6,6|(n[2][0]!==a?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=qc,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,c=e.flags&qc?E2:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==c.y||m!==c.x){for(let p=n;p<a;++p)this.centroidVertexArray.emplace(p,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let c=n.getReplacementRegionsForTile(e.toUnwrapped());if(Bv(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let p of this.centroidData)p.flags&=2147483647;let m=[];for(let p of this.activeReplacements){if(p.order<a)continue;let b=Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&qc||p.min.x>y.max.x||y.min.x>p.max.x||p.min.y>y.max.y||y.min.y>p.max.y))for(let w=0;w<y.footprintSegLen;w++){let M=this.footprintSegments[y.footprintSegIdx+w];if(m.length=0,NP(this.footprintVertices,M.vertexOffset,M.vertexCount,p.footprintTileId.canonical,e.canonical,m),_2(p.footprint,m,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-b)){y.flags|=qc;break}}}for(let p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,a){let c=!1;for(let m=0;m<a.footprintSegLen;m++){let p=this.footprintSegments[a.footprintSegIdx+m],b=0;for(let y of p.ringIndices){for(let w=b,M=y+b-1;w<y+b;M=w++){let T=this.footprintVertices.int16[2*(w+p.vertexOffset)+0],E=this.footprintVertices.int16[2*(w+p.vertexOffset)+1],P=this.footprintVertices.int16[2*(M+p.vertexOffset)+1];E>n!=P>n&&e<(this.footprintVertices.int16[2*(M+p.vertexOffset)+0]-T)*(n-E)/(P-E)+T&&(c=!c)}b=y}}return c}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,c=!0,m=4*(e+pt)*pt+(n+pt);if(this.partLookup.hasOwnProperty(m)){let p=this.partLookup[m];return p?{height:p.height,hidden:!!(p.flags&qc)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||this.footprintContainsPoint(e,n,p)&&p&&p.height>a&&(a=p.height,this.partLookup[m]=p,c=!!(p.flags&qc));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.partLookup[m]=void 0}}function L2(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function BP(t,e,n,a){let c=e.sub(t)._perp()._unit(),m=n.sub(e)._perp()._unit();return F2(t,e,n,L2(c,m),a)}function F2(t,e,n,a,c){let m=Math.sqrt(1-a*a);return Math.min(t.dist(e)/3,e.dist(n)/3,c*m/a)}function Nv(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function z2(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function B2(t,e,n){if(t.x<0||t.x>=pt||e.x<0||e.x>=pt||n.x<0||n.x>=pt)return!1;let a=n.sub(e),c=a.perp(),m=t.sub(e);return(a.x*m.x+a.y*m.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(m.x*m.x+m.y*m.y))>-.866&&c.x*m.x+c.y*m.y<0}function N2(t,e,n){let a=e?2|t:-3&t;return n?1|a:-2&a}function V2(){let t=Math.PI/32,e=Math.tan(t),n=Yu;return n*Math.sqrt(1+2*e*e)-n}function j2(t,e,n){let a=1<<n.z,c=Ao(n.x/a),m=Ao((n.x+1)/a),p=Er(n.y/a),b=Er((n.y+1)/a);return function(y,w,M,T,E=0,P){let R=[];if(!y.length||!M||!T)return R;let F=(he,ve)=>{for(let Ce of he)R.push({polygon:Ce,bounds:ve})},B=Math.ceil(Math.log2(M)),W=Math.ceil(Math.log2(T)),J=B-W,ee=[];for(let he=0;he<Math.abs(J);he++)ee.push(J>0?0:1);for(let he=0;he<Math.min(B,W);he++)ee.push(0),ee.push(1);let te=y;if(te=J_(te,w[0].y-E,w[1].y+E,1),te=J_(te,w[0].x-E,w[1].x+E,0),!te.length)return R;let me=[];for(ee.length?me.push({polygons:te,bounds:w,depth:0}):F(te,w);me.length;){let he=me.pop(),ve=he.depth,Ce=ee[ve],De=he.bounds[0],Ue=he.bounds[1],ze=Ce===0?De.x:De.y,$e=Ce===0?Ue.x:Ue.y,rt=P?P(Ce,ze,$e):.5*(ze+$e),We=J_(he.polygons,ze-E,rt+E,Ce),et=J_(he.polygons,rt-E,$e+E,Ce);if(We.length){let He=[De,new yt(Ce===0?rt:Ue.x,Ce===1?rt:Ue.y)];ee.length>ve+1?me.push({polygons:We,bounds:He,depth:ve+1}):F(We,He)}if(et.length){let He=[new yt(Ce===0?rt:De.x,Ce===1?rt:De.y),Ue];ee.length>ve+1?me.push({polygons:et,bounds:He,depth:ve+1}):F(et,He)}}return R}(t,e,Math.ceil((m-c)/11.25),Math.ceil((p-b)/11.25),1,(y,w,M)=>{if(y===0)return .5*(w+M);{let T=Er((n.y+w/pt)/a);return(Fs(.5*(Er((n.y+M/pt)/a)+T))*a-n.y)*pt}})}function NP(t,e,n,a,c,m){let p=Math.pow(2,a.z-c.z);for(let b=0;b<n;b++){let y=t.int16[2*(b+e)+0],w=t.int16[2*(b+e)+1];y=(y+c.x*pt)*p-a.x*pt,w=(w+c.y*pt)*p-a.y*pt,m.push(new yt(y,w))}}ne(n0,"FillExtrusionBucket",{omit:["layers","features"]}),ne(A2,"PartData"),ne(D2,"FootprintSegment"),ne(P2,"BorderCentroidData"),ne(R2,"GroundEffect");let VP=new Wi({visibility:new Ke(Pe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ke(Pe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var jP={paint:new Wi({"fill-extrusion-opacity":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:VP};function Ef(t,e){return t.x*e.x+t.y*e.y}function U2(t,e){if(t.length===1){let n=0,a=e[n++],c;for(;!c||a.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){let m=e[n],p=t[0],b=c.sub(a),y=m.sub(a),w=p.sub(a),M=Ef(b,b),T=Ef(b,y),E=Ef(y,y),P=Ef(w,b),R=Ef(w,y),F=M*E-T*T,B=(E*P-T*R)/F,W=(M*R-T*P)/F,J=a.z*(1-B-W)+c.z*B+m.z*W;if(isFinite(J))return J}return 1/0}{let n=1/0;for(let a of e)n=Math.min(n,a.z);return n}}function H2(t,e,n,a,c,m,p,b){let y=p*c.getElevationAt(t,e,!0,!0),w=m[0]!==0,M=w?m[1]===0?p*(m[0]/7-450):p*function(T,E,P){let R=Math.floor(E[0]/8),F=Math.floor(E[1]/8),B=10*(E[0]-8*R),W=10*(E[1]-8*F),J=T.getElevationAt(R,F,!0,!0),ee=T.getMeterToDEM(P),te=Math.floor(.5*(B*ee-1)),me=Math.floor(.5*(W*ee-1)),he=T.tileCoordToPixel(R,F),ve=2*te+1,Ce=2*me+1,De=function(et,He,tt,st,nt){return[et.getElevationAtPixel(He,tt,!0),et.getElevationAtPixel(He+nt,tt,!0),et.getElevationAtPixel(He,tt+nt,!0),et.getElevationAtPixel(He+st,tt+nt,!0)]}(T,he.x-te,he.y-me,ve,Ce),Ue=Math.abs(De[0]-De[1]),ze=Math.abs(De[2]-De[3]),$e=Math.abs(De[0]-De[2])+Math.abs(De[1]-De[3]),rt=Math.min(.25,.5*ee*(Ue+ze)/ve),We=Math.min(.25,.5*ee*$e/Ce);return J+Math.max(rt*B,We*W)}(c,m,b):y;return{base:y+(n===0)?-1:n,top:w?Math.max(M+a,y+n+2):y+a}}let UP=Gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:HP}=UP,WP=Gi([{name:"a_packed",components:4,type:"Float32"}]),{members:GP}=WP,qP=Gi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:$P}=qP,YP=Gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ZP=Gi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),XP=Gi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Vv=Gi([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),W2=Gi([{name:"a_z_offset",components:1,type:"Float32"}],4),QP=Gi([{name:"a_texb",components:2,type:"Uint16"}]),KP=Gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),JP=Gi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Gi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let G2=Gi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),eO=Gi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Gi([{name:"triangle",components:3,type:"Uint16"}]),Gi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Gi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),Gi([{type:"Float32",name:"offsetX"}]),Gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class q2{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Wc({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let a=this.getKey(e,n);return this.positions[a]}trim(){let e=this.width,n=this.height=fp(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){let c=[],m=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,b=!0;c.push({left:m,right:p,isDash:b,zeroLength:e[0]===0});let y=e[0];for(let w=1;w<e.length;w++){b=!b;let M=e[w];m=y*a,y+=M,p=y*a,c.push({left:m,right:p,isDash:b,zeroLength:M===0})}return c}addRoundDash(e,n,a){let c=n/2;for(let m=-a;m<=a;m++){let p=this.width*(this.nextRow+a+m),b=0,y=e[b];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++b]);let M=Math.abs(w-y.left),T=Math.abs(w-y.right),E=Math.min(M,T),P,R=m/a*(c+1);if(y.isDash){let F=c-Math.abs(R);P=Math.sqrt(E*E+F*F)}else P=c-Math.sqrt(E*E+R*R);this.image.data[p+w]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){let w=e[y],M=e[y+1];w.zeroLength?e.splice(y,1):M&&M.isDash===w.isDash&&(M.left=w.left,e.splice(y,1))}let a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);let m=this.width*this.nextRow,p=0,b=e[p];for(let y=0;y<this.width;y++){y/b.right>1&&(b=e[++p]);let w=Math.abs(y-b.left),M=Math.abs(y-b.right),T=Math.min(w,M);this.image.data[m+y]=Math.max(0,Math.min(255,(b.isDash?T:-T)+n+128))}}addDash(e,n){let a=this.getKey(e,n);if(this.positions[a])return this.positions[a];let c=n==="round",m=c?7:0,p=2*m+1;if(this.nextRow+p>this.height)return qn("LineAtlas out of space"),null;e.length===0&&e.push(1);let b=0;for(let M=0;M<e.length;M++)e[M]<0&&(qn("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),b+=e[M];if(b!==0){let M=this.width/b,T=this.getDashRanges(e,this.width,M);c?this.addRoundDash(T,M,m):this.addRegularDash(T,n==="square"?.5*M:0)}let y=this.nextRow+m;this.nextRow+=p;let w={tl:[y,m],br:[b,0]};return this.positions[a]=w,w}}ne(q2,"LineAtlas");let tO=K_.types,iO=Math.cos(Math.PI/180*37.5),nO=Math.cos(Math.PI/180*5);class r0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Wy,this.layoutVertexArray2=new Fc,this.patternVertexArray=new zc,this.indexArray=new wr,this.programConfigurations=new jc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new An,this.maxLineLength=0,this.zOffsetVertexArray=new gh,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:pt/64}updateFootprints(e,n){}populate(e,n,a,c){this.hasPattern=Ov("line",this.layers,n);let m=this.layers[0].layout.get("line-sort-key"),p=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!p.isConstant()||!!p.constantOr(0);let b=[];for(let{feature:T,id:E,index:P,sourceLayerIndex:R}of e){let F=this.layers[0]._featureFilter.needGeometry,B=kl(T,F);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),B,a))continue;let W=m?m.evaluate(B,{},a):void 0,J={id:E,properties:T.properties,type:T.type,sourceLayerIndex:R,index:P,geometry:F?B.geometry:Ka(T,a,c),patterns:{},sortKey:W};b.push(J)}m&&b.sort((T,E)=>T.sortKey-E.sortKey);let{lineAtlas:y,featureIndex:w}=n,M=this.addConstantDashes(y);for(let T of b){let{geometry:E,index:P,sourceLayerIndex:R}=T;if(M&&this.addFeatureDashes(T,y),this.hasPattern){let F=Rv("line",this.layers,T,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(T,E,P,a,y.positions,n.availableImages,n.brightness);w.insert(e[P].feature,E,P,R,this.index)}}addConstantDashes(e){let n=!1;for(let a of this.layers){let c=a.paint.get("line-dasharray").value,m=a.layout.get("line-cap").value;if(c.kind!=="constant"||m.kind!=="constant")n=!0;else{let p=m.value,b=c.value;if(!b)continue;e.addDash(b,p)}}return n}addFeatureDashes(e,n){let a=this.zoom;for(let c of this.layers){let m=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(m.kind==="constant"&&p.kind==="constant")continue;let b,y;if(m.kind==="constant"){if(b=m.value,!b)continue}else b=m.evaluate({zoom:a},e);y=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),n.addDash(b,y),e.patterns[c.id]=n.getKey(b,y)}}update(e,n,a,c,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,c,m)}addFeatures(e,n,a,c,m,p){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,n,a,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,GP)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,$P)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,W2.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,HP),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,c,m,p,b){let y=this.layers[0].layout,w=y.get("line-join").evaluate(e,{}),M=y.get("line-cap").evaluate(e,{}),T=y.get("line-miter-limit"),E=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let P of n)this.addLine(P,e,c,w,M,T,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,p,c,b)}addLine(e,n,a,c,m,p,b){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let y={zoom:this.zoom,lineProgress:void 0},w=this.layers[0].layout,M=c==="none";if(this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<e.length-1;he++)this.totalDistance+=e[he].dist(e[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let T=tO[n.type]==="Polygon",E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let P=0;for(;P<E-1&&e[P].equals(e[P+1]);)P++;if(E<(T?3:2))return;c==="bevel"&&(p=1.05);let R=this.overscaling<=16?15*pt/(512*this.overscaling):0,F=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray),B,W,J,ee,te,me;this.e1=this.e2=-1,T&&(B=e[E-2],te=e[P].sub(B)._unit()._perp());for(let he=P;he<E;he++){if(J=he===E-1?T?e[P+1]:void 0:e[he+1],J&&e[he].equals(J))continue;if(te&&(ee=te),B&&(W=B),B=e[he],this.hasZOffset){let He=w.get("line-z-offset").value;if(He.kind==="constant")me=He.value;else{if(this.lineClips){let tt=this.totalDistance/(this.lineClips.end-this.lineClips.start);y.lineProgress=(tt*this.lineClips.start+this.distance+(W?W.dist(B):0))/tt}else qn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),y.lineProgress=0;me=He.evaluate(y,n)}me=me||0}te=J?J.sub(B)._unit()._perp():ee,ee=ee||te;let ve=W&&J,Ce=ve?c:T||M?"butt":m,De=ee.x*te.x+ee.y*te.y;if(M){let He=function(tt){if(tt.patternJoinNone){let st=tt.segmentPoints.length/2,nt=tt.lineSoFar-tt.segmentStart;for(let Mt=0;Mt<st;++Mt){let ot=tt.segmentPoints[2*Mt+1],dt=Math.round(tt.segmentPoints[2*Mt])+.5+.25*ot;tt.patternVertexArray.emplaceBack(dt,nt,tt.segmentStart),tt.patternVertexArray.emplaceBack(dt,nt,tt.segmentStart)}tt.segmentPoints.length=0}tt.e1=tt.e2=-1};if(ve&&De<nO){this.updateDistance(W,B),this.addCurrentVertex(B,ee,1,1,F,me),He(this),this.addCurrentVertex(B,te,-1,-1,F,me);continue}if(W){if(!J){this.updateDistance(W,B),this.addCurrentVertex(B,ee,1,1,F,me),He(this);continue}Ce="miter"}}let Ue=ee.add(te);Ue.x===0&&Ue.y===0||Ue._unit();let ze=Ue.x*te.x+Ue.y*te.y,$e=ze!==0?1/ze:1/0,rt=2*Math.sqrt(2-2*ze),We=ze<iO&&W&&J,et=ee.x*te.y-ee.y*te.x>0;if(We&&he>P){let He=B.dist(W);if(He>2*R){let tt=B.sub(B.sub(W)._mult(R/He)._round());this.updateDistance(W,tt),this.addCurrentVertex(tt,ee,0,0,F,me),W=tt}}if(ve&&Ce==="round"&&($e<b?Ce="miter":$e<=2&&(Ce="fakeround")),Ce==="miter"&&$e>p&&(Ce="bevel"),Ce==="bevel"&&($e>2&&(Ce="flipbevel"),$e<p&&(Ce="miter")),W&&this.updateDistance(W,B),Ce==="miter")Ue._mult($e),this.addCurrentVertex(B,Ue,0,0,F,me);else if(Ce==="flipbevel"){if($e>100)Ue=te.mult(-1);else{let He=$e*ee.add(te).mag()/ee.sub(te).mag();Ue._perp()._mult(He*(et?-1:1))}this.addCurrentVertex(B,Ue,0,0,F,me),this.addCurrentVertex(B,Ue.mult(-1),0,0,F,me)}else if(Ce==="bevel"||Ce==="fakeround"){let He=-Math.sqrt($e*$e-1),tt=et?He:0,st=et?0:He;if(W&&this.addCurrentVertex(B,ee,tt,st,F,me),Ce==="fakeround"){let nt=Math.round(180*rt/Math.PI/20);for(let Mt=1;Mt<nt;Mt++){let ot=Mt/nt;if(ot!==.5){let Nt=ot-.5;ot+=ot*Nt*(ot-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*Nt*Nt+(.848013+De*(.215638*De-1.06021)))}let dt=te.sub(ee)._mult(ot)._add(ee)._unit()._mult(et?-1:1);this.addHalfVertex(B,dt.x,dt.y,!1,et,0,F,me)}}J&&this.addCurrentVertex(B,te,-tt,-st,F,me)}else Ce==="butt"?this.addCurrentVertex(B,Ue,0,0,F,me):Ce==="square"?(W||this.addCurrentVertex(B,Ue,-1,-1,F,me),this.addCurrentVertex(B,Ue,0,0,F,me),W&&this.addCurrentVertex(B,Ue,1,1,F,me)):Ce==="round"&&(W&&(this.addCurrentVertex(B,ee,0,0,F,me),this.addCurrentVertex(B,ee,1,1,F,me,!0)),J&&(this.addCurrentVertex(B,te,-1,-1,F,me,!0),this.addCurrentVertex(B,te,0,0,F,me)));if(We&&he<E-1){let He=B.dist(J);if(He>2*R){let tt=B.add(J.sub(B)._mult(R/He)._round());this.updateDistance(B,tt),this.addCurrentVertex(tt,te,0,0,F,me),B=tt}}}}addVerticesTo(e,n,a,c,m,p,b,y,w,M){let T=(n.w-e.w)/this.tessellationStep|0;if(T>1){this.lineSoFar=e.w;let E=(n.x-e.x)/T,P=(n.y-e.y)/T,R=(n.z-e.z)/T,F=(n.w-e.w)/T;for(let B=1;B<T;++B)e.x+=E,e.y+=P,e.z+=R,this.lineSoFar+=F,this.addHalfVertex(e,a,c,M,!1,b,w,e.z),this.addHalfVertex(e,m,p,M,!0,-y,w,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,a,c,M,!1,b,w,n.z),this.addHalfVertex(n,m,p,M,!0,-y,w,n.z)}addCurrentVertex(e,n,a,c,m,p,b=!1){let y=n.x+n.y*a,w=n.y-n.x*a,M=n.y*c-n.x,T=-n.y-n.x*c;if(p!=null){let P=pt+10,R=p,F=new u2(e.x,e.y,R,this.lineSoFar),B=$2(e,-10,P),W=this.lineSoFar;if(this.currentVertex)if(B){let J=this.currentVertexIsOutside,ee=this.currentVertex,te=new u2(e.x,e.y,R,this.lineSoFar);p2(ee,te,-10,P),$2(te,-10,P)||(J&&(this.e1=this.e2=-1,this.lineSoFar=ee.w,this.addHalfVertex(ee,y,w,b,!1,a,m,ee.z),this.addHalfVertex(ee,M,T,b,!0,-c,m,ee.z)),this.addVerticesTo(ee,te,y,w,M,T,a,c,m,b))}else{let J=this.currentVertex;this.currentVertexIsOutside&&(p2(J,F,-10,P),this.e1=this.e2=-1,this.lineSoFar=J.w,this.addHalfVertex(J,y,w,b,!1,a,m,J.z),this.addHalfVertex(J,M,T,b,!0,-c,m,J.z)),this.addVerticesTo(J,F,y,w,M,T,a,c,m,b)}else B||(this.addHalfVertex(e,y,w,b,!1,a,m,p),this.addHalfVertex(e,M,T,b,!0,-c,m,p));this.currentVertex=F,this.currentVertexIsOutside=B,this.lineSoFar=W}else this.addHalfVertex(e,y,w,b,!1,a,m,p),this.addHalfVertex(e,M,T,b,!0,-c,m,p)}addHalfVertex({x:e,y:n},a,c,m,p,b,y,w){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(n<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let M=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),y.primitiveLength++),p?this.e2=M:this.e1=M,w!=null&&this.zOffsetVertexArray.emplaceBack(w)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function $2(t,e,n){return t.x<e||t.x>n||t.y<e||t.y>n}ne(r0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let rO=new Wi({"line-cap":new wt(Pe.layout_line["line-cap"]),"line-join":new wt(Pe.layout_line["line-join"]),"line-miter-limit":new Ke(Pe.layout_line["line-miter-limit"]),"line-round-limit":new Ke(Pe.layout_line["line-round-limit"]),"line-sort-key":new wt(Pe.layout_line["line-sort-key"]),"line-z-offset":new wt(Pe.layout_line["line-z-offset"]),visibility:new Ke(Pe.layout_line.visibility)});var o0={paint:new Wi({"line-opacity":new wt(Pe.paint_line["line-opacity"]),"line-color":new wt(Pe.paint_line["line-color"]),"line-translate":new Ke(Pe.paint_line["line-translate"]),"line-translate-anchor":new Ke(Pe.paint_line["line-translate-anchor"]),"line-width":new wt(Pe.paint_line["line-width"]),"line-gap-width":new wt(Pe.paint_line["line-gap-width"]),"line-offset":new wt(Pe.paint_line["line-offset"]),"line-blur":new wt(Pe.paint_line["line-blur"]),"line-dasharray":new wt(Pe.paint_line["line-dasharray"]),"line-pattern":new wt(Pe.paint_line["line-pattern"]),"line-gradient":new Dn(Pe.paint_line["line-gradient"]),"line-trim-offset":new Ke(Pe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ke(Pe.paint_line["line-trim-fade-range"]),"line-trim-color":new Ke(Pe.paint_line["line-trim-color"]),"line-emissive-strength":new Ke(Pe.paint_line["line-emissive-strength"]),"line-border-width":new wt(Pe.paint_line["line-border-width"]),"line-border-color":new wt(Pe.paint_line["line-border-color"]),"line-occlusion-opacity":new Ke(Pe.paint_line["line-occlusion-opacity"])}),layout:rO};function Y2(t,e,n){return e*(pt/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function Z2(t,e){return 1/Y2(t,1,e.tileZoom)}function X2(t,e,n,a){return t.translatePosMatrix(a||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let Q2=t=>{let e=[];K2(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let a=t.layout.get("line-join").constantOr("miter")==="none",c=!!t.paint.get("line-pattern").constantOr(1);return a&&c&&e.push("LINE_JOIN_NONE"),e};function K2(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class J2{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var oO={read:function(t,e,n,a,c){var m,p,b=8*c-a-1,y=(1<<b)-1,w=y>>1,M=-7,T=n?c-1:0,E=n?-1:1,P=t[e+T];for(T+=E,m=P&(1<<-M)-1,P>>=-M,M+=b;M>0;m=256*m+t[e+T],T+=E,M-=8);for(p=m&(1<<-M)-1,m>>=-M,M+=a;M>0;p=256*p+t[e+T],T+=E,M-=8);if(m===0)m=1-w;else{if(m===y)return p?NaN:1/0*(P?-1:1);p+=Math.pow(2,a),m-=w}return(P?-1:1)*p*Math.pow(2,m-a)},write:function(t,e,n,a,c,m){var p,b,y,w=8*m-c-1,M=(1<<w)-1,T=M>>1,E=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=a?0:m-1,R=a?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,p=M):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+T>=1?E/y:E*Math.pow(2,1-T))*y>=2&&(p++,y/=2),p+T>=M?(b=0,p=M):p+T>=1?(b=(e*y-1)*Math.pow(2,c),p+=T):(b=e*Math.pow(2,T-1)*Math.pow(2,c),p=0));c>=8;t[n+P]=255&b,P+=R,b/=256,c-=8);for(p=p<<c|b,w+=c;w>0;t[n+P]=255&p,P+=R,p/=256,w-=8);t[n+P-R]|=128*F}},eS=kn,a0=oO;function kn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}kn.Varint=0,kn.Fixed64=1,kn.Bytes=2,kn.Fixed32=5;var jv=4294967296,tS=1/jv,iS=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function El(t){return t.type===kn.Bytes?t.readVarint()+t.pos:t.pos+1}function em(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function nS(t,e,n){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(var c=n.pos-1;c>=t;c--)n.buf[c+a]=n.buf[c]}function aO(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function sO(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function lO(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function cO(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function dO(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function hO(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function uO(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function mO(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function pO(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function s0(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function tm(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function rS(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}kn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),c=a>>3,m=this.pos;this.type=7&a,t(c,e,this),this.pos===m&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=s0(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=rS(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=s0(this.buf,this.pos)+s0(this.buf,this.pos+4)*jv;return this.pos+=8,t},readSFixed64:function(){var t=s0(this.buf,this.pos)+rS(this.buf,this.pos+4)*jv;return this.pos+=8,t},readFloat:function(){var t=a0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=a0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,a=this.buf;return e=127&(n=a[this.pos++]),n<128?e:(e|=(127&(n=a[this.pos++]))<<7,n<128?e:(e|=(127&(n=a[this.pos++]))<<14,n<128?e:(e|=(127&(n=a[this.pos++]))<<21,n<128?e:function(c,m,p){var b,y,w=p.buf;if(b=(112&(y=w[p.pos++]))>>4,y<128||(b|=(127&(y=w[p.pos++]))<<3,y<128)||(b|=(127&(y=w[p.pos++]))<<10,y<128)||(b|=(127&(y=w[p.pos++]))<<17,y<128)||(b|=(127&(y=w[p.pos++]))<<24,y<128)||(b|=(1&(y=w[p.pos++]))<<31,y<128))return em(c,b,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&iS?function(n,a,c){return iS.decode(n.subarray(a,c))}(this.buf,e,t):function(n,a,c){for(var m="",p=a;p<c;){var b,y,w,M=n[p],T=null,E=M>239?4:M>223?3:M>191?2:1;if(p+E>c)break;E===1?M<128&&(T=M):E===2?(192&(b=n[p+1]))==128&&(T=(31&M)<<6|63&b)<=127&&(T=null):E===3?(y=n[p+2],(192&(b=n[p+1]))==128&&(192&y)==128&&((T=(15&M)<<12|(63&b)<<6|63&y)<=2047||T>=55296&&T<=57343)&&(T=null)):E===4&&(y=n[p+2],w=n[p+3],(192&(b=n[p+1]))==128&&(192&y)==128&&(192&w)==128&&((T=(15&M)<<18|(63&b)<<12|(63&y)<<6|63&w)<=65535||T>=1114112)&&(T=null)),T===null?(T=65533,E=1):T>65535&&(T-=65536,m+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),m+=String.fromCharCode(T),p+=E}return m}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==kn.Bytes)return t.push(this.readVarint(e));var n=El(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==kn.Bytes)return t.push(this.readSVarint());var e=El(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==kn.Bytes)return t.push(this.readBoolean());var e=El(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==kn.Bytes)return t.push(this.readFloat());var e=El(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==kn.Bytes)return t.push(this.readDouble());var e=El(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==kn.Bytes)return t.push(this.readFixed32());var e=El(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==kn.Bytes)return t.push(this.readSFixed32());var e=El(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==kn.Bytes)return t.push(this.readFixed64());var e=El(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==kn.Bytes)return t.push(this.readSFixed64());var e=El(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===kn.Varint)for(;this.buf[this.pos++]>127;);else if(e===kn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===kn.Fixed32)this.pos+=4;else{if(e!==kn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),tm(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),tm(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),tm(this.buf,-1&t,this.pos),tm(this.buf,Math.floor(t*tS),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),tm(this.buf,-1&t,this.pos),tm(this.buf,Math.floor(t*tS),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var a,c;if(e>=0?(a=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,p,b){b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7)}(a,0,n),function(m,p){var b=(7&m)<<4;p.buf[p.pos++]|=b|((m>>>=3)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m)))))}(c,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,c,m){for(var p,b,y=0;y<c.length;y++){if((p=c.charCodeAt(y))>55295&&p<57344){if(!b){p>56319||y+1===c.length?(a[m++]=239,a[m++]=191,a[m++]=189):b=p;continue}if(p<56320){a[m++]=239,a[m++]=191,a[m++]=189,b=p;continue}p=b-55296<<10|p-56320|65536,b=null}else b&&(a[m++]=239,a[m++]=191,a[m++]=189,b=null);p<128?a[m++]=p:(p<2048?a[m++]=p>>6|192:(p<65536?a[m++]=p>>12|224:(a[m++]=p>>18|240,a[m++]=p>>12&63|128),a[m++]=p>>6&63|128),a[m++]=63&p|128)}return m}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&nS(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),a0.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),a0.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var a=this.pos-n;a>=128&&nS(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,n){this.writeTag(t,kn.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,aO,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,sO,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,dO,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,lO,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,cO,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,hO,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,uO,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,mO,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,pO,e)},writeBytesField:function(t,e){this.writeTag(t,kn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,kn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,kn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,kn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,kn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,kn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,kn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,kn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,kn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,kn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var im=Xe(eS);let fO=["id","tile","layer","source","sourceLayer","state"];class oS{constructor(e,n,a,c,m){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=c,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let n of fO)this[n]!==void 0&&(e[n]=this[n]);return e}}class gO{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){let c=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},Nr(this.stateChanges[e][c],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(let m in this.state[e])m!==c&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(let m in this.state[e][c])a[m]||(this.deletedStates[e][c][m]=null)}else for(let m in a)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][m]===null&&delete this.deletedStates[e][c][m]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;let c=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(a in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][a]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,n){let a=String(n),c=Nr({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let m=this.deletedStates[e][n];if(m===null)return{};for(let p in m)delete c[p]}return c}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let a={};for(let c in this.stateChanges){this.state[c]=this.state[c]||{};let m={};for(let p in this.stateChanges[c])this.state[c][p]||(this.state[c][p]={}),Nr(this.state[c][p],this.stateChanges[c][p]),m[p]=this.state[c][p];a[c]=m}for(let c in this.deletedStates){this.state[c]=this.state[c]||{};let m={};if(this.deletedStates[c]===null)for(let p in this.state[c])m[p]={},this.state[c][p]={};else for(let p in this.deletedStates[c]){if(this.deletedStates[c][p]===null)this.state[c][p]={};else if(this.state[c][p])for(let b of Object.keys(this.deletedStates[c][p]))delete this.state[c][p][b];m[p]=this.state[c][p]}a[c]=a[c]||{},Nr(a[c],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(let c in e)e[c].setFeatureState(a,n)}}class aS{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ge(pt,16,0),this.featureIndexArray=new bC,this.promoteId=n,this.is3DTile=!1}insert(e,n,a,c,m,p=0,b=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,m,p);let w=this.grid;for(let M=0;M<n.length;M++){let T=n[M],E=[1/0,1/0,-1/0,-1/0];for(let P=0;P<T.length;P++){let R=T[P];E[0]=Math.min(E[0],R.x),E[1]=Math.min(E[1],R.y),E[2]=Math.max(E[2],R.x),E[3]=Math.max(E[3],R.y)}b!==0&&(E[0]-=b,E[1]-=b,E[2]+=b,E[3]+=b),E[0]<pt&&E[1]<pt&&E[2]>=0&&E[3]>=0&&w.insert(y,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Fv(new im(this.rawTileData)).layers,this.sourceLayerCoder=new J2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,a,c){this.loadVTLayers();let m=e.params||{},p=fr(m.filter),b=e.tileResult,y=e.transform,w=b.bufferedTilespaceBounds,M=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(R,F,B,W)=>LC(b.bufferedTilespaceGeometry,R,F,B,W));M.sort(_O);let T=null;y.elevation&&M.length>0&&(T=Ju.create(y.elevation,this.tileID));let E={},P;for(let R=0;R<M.length;R++){let F=M[R];if(F===P)continue;P=F;let B=this.featureIndexArray.get(F),W=null;if(this.is3DTile){let J=this.bucketLayerIDs[0][0],ee=n[J];if(ee.type!=="model")continue;let{queryFeature:te,intersectionZ:me}=ee.queryIntersectsMatchingFeature(b,B.featureIndex,p,y);te&&this.appendToResult(E,J,B.featureIndex,te,me)}else this.loadMatchingFeature(E,B,p,m.layers,m.availableImages,n,a,c,(J,ee,te,me=0)=>(W||(W=Ka(J,this.tileID.canonical,e.tileTransform)),ee.queryIntersectsFeature(b,J,te,W,this.z,e.transform,e.pixelPosMatrix,T,me)))}return E}loadMatchingFeature(e,n,a,c,m,p,b,y,w){let{featureIndex:M,bucketIndex:T,sourceLayerIndex:E,layoutVertexArrayOffset:P}=n,R=this.bucketLayerIDs[T];if(c&&!function(J,ee){for(let te=0;te<J.length;te++)if(ee.indexOf(J[te])>=0)return!0;return!1}(c,R))return;let F=this.sourceLayerCoder.decode(E),B=this.vtLayers[F].feature(M);if(a.needGeometry){let J=kl(B,!0);if(!a.filter(new Qt(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!a.filter(new Qt(this.tileID.overscaledZ),B))return;let W=this.getId(B,F);for(let J=0;J<R.length;J++){let ee=R[J];if(c&&c.indexOf(ee)<0)continue;let te=p[ee];if(!te)continue;let me={};W!==void 0&&y&&(me=y.getState(te.sourceLayer||"_geojsonTileLayer",W));let he=!w||w(B,te,me,P);if(!he)continue;let ve=new oS(B,this.z,this.x,this.y,W),Ce=Nr({},b[ee]);Ce.paint=sS(Ce.paint,te.paint,B,me,m),Ce.layout=sS(Ce.layout,te.layout,B,me,m),ve.layer=Ce,this.appendToResult(e,ee,M,ve,he)}}appendToResult(e,n,a,c,m){let p=e[n];p===void 0&&(p=e[n]=[]),p.push({featureIndex:a,feature:c,intersectionZ:m})}lookupSymbolFeatures(e,n,a,c,m,p,b,y){let w={};this.loadVTLayers();let M=fr(m);for(let T of e)this.loadMatchingFeature(w,{bucketIndex:a,sourceLayerIndex:c,featureIndex:T,layoutVertexArrayOffset:0},M,p,b,y,n);return w}loadFeature(e){let{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();let c=this.sourceLayerCoder.decode(a),m=this.vtFeatures[c];if(m[n])return m[n];let p=this.vtLayers[c].feature(n);return m[n]=p,p}hasLayer(e){for(let n of this.bucketLayerIDs)for(let a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){let c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];c!=null&&(a=e.properties[c]),typeof a=="boolean"&&(a=Number(a))}return a}}function sS(t,e,n,a,c){return uc(t,(m,p)=>{let b=e instanceof tn?e.get(p):null;return b&&b.evaluate?b.evaluate(n,a,c):b})}function _O(t,e){return e-t}ne(aS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var jr=24;let Ja=128;function Uv(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Qt(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:c}=n,m=0;for(;m<a.length&&a[m]<=t;)m++;m=Math.max(0,m-1);let p=m;for(;p<a.length&&a[p]<t+1;)p++;p=Math.min(a.length-1,p);let b=a[m],y=a[p];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:y,interpolationType:c}:{kind:"camera",minZoom:b,maxZoom:y,minSize:n.evaluate(new Qt(b)),maxSize:n.evaluate(new Qt(y)),interpolationType:c}}}function l0(t,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:c}){return t.kind==="source"?a/Ja:t.kind==="composite"?Wt(a/Ja,c/Ja,n):e}function nm(t,e){let n=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:c,minZoom:m,maxZoom:p}=t,b=c?pi(Io.interpolationFactor(c,e,m,p),0,1):0;t.kind==="camera"?a=Wt(t.minSize,t.maxSize,b):n=b}return{uSizeT:n,uSize:a}}var bO=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ja,evaluateSizeForFeature:l0,evaluateSizeForZoom:nm,getSizeData:Uv});function yO(t,e,n){return t.sections.forEach(a=>{a.text=function(c,m,p){let b=m.layout.get("text-transform").evaluate(p,{});return b==="uppercase"?c=c.toLocaleUpperCase():b==="lowercase"&&(c=c.toLocaleLowerCase()),Ji.applyArabicShaping&&(c=Ji.applyArabicShaping(c)),c}(a.text,e,n)}),t}let Df={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function vO(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function xO(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let Hv=3;function wO(t,e,n){e.glyphs=[],t===1&&n.readMessage(CO,e)}function CO(t,e,n){if(t===3){let{id:a,bitmap:c,width:m,height:p,left:b,top:y,advance:w}=n.readMessage(SO,{});e.glyphs.push({id:a,bitmap:new Wc({width:m+2*Hv,height:p+2*Hv},c),metrics:{width:m,height:p,left:b,top:y,advance:w}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function SO(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let lS=Hv,ua={horizontal:1,vertical:2,horizontalOnly:3};class Af{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let a=new Af;return a.scale=e||1,a.fontStack=n,a}static forImage(e){let n=new Af;return n.imageName=e,n}}class rm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let a=new rm;for(let c=0;c<e.sections.length;c++){let m=e.sections[c];m.image?a.addImageSection(m):a.addTextSection(m,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,a){let c="";for(let m=0;m<n.length;m++){let p=n.charCodeAt(m+1)||null,b=n.charCodeAt(m-1)||null;c+=!a&&(p&&Ze(p)&&!Df[n[m+1]]||b&&Ze(b)&&!Df[n[m-1]])||!Df[n[m]]?n[m]:Df[n[m]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&c0[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&c0[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let a=new rm;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Af.forText(e.scale,e.fontStack||n));let a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void qn("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Af.forImage(n)),this.sectionIndex.push(this.sections.length-1)):qn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wv(t,e,n,a,c,m,p,b,y,w,M,T,E,P,R){let F=rm.fromFeature(t,c);T===ua.vertical&&F.verticalizePunctuation(E);let B=[],W=function(he,ve,Ce,De,Ue,ze){if(!he)return[];let $e=[],rt=function(tt,st,nt,Mt,ot,dt){let Nt=0;for(let Ft=0;Ft<tt.length();Ft++){let Pt=tt.getSection(Ft);Nt+=cS(tt.getCodePoint(Ft),Pt,Mt,ot,st,dt)}return Nt/Math.max(1,Math.ceil(Nt/nt))}(he,ve,Ce,De,Ue,ze),We=he.text.indexOf("\u200B")>=0,et=0;for(let tt=0;tt<he.length();tt++){let st=he.getSection(tt),nt=he.getCodePoint(tt);if(c0[nt]||(et+=cS(nt,st,De,Ue,ve,ze)),tt<he.length()-1){let Mt=!((He=nt)<11904||!(ue["Bopomofo Extended"](He)||ue.Bopomofo(He)||ue["CJK Compatibility Forms"](He)||ue["CJK Compatibility Ideographs"](He)||ue["CJK Compatibility"](He)||ue["CJK Radicals Supplement"](He)||ue["CJK Strokes"](He)||ue["CJK Symbols and Punctuation"](He)||ue["CJK Unified Ideographs Extension A"](He)||ue["CJK Unified Ideographs"](He)||ue["Enclosed CJK Letters and Months"](He)||ue["Halfwidth and Fullwidth Forms"](He)||ue.Hiragana(He)||ue["Ideographic Description Characters"](He)||ue["Kangxi Radicals"](He)||ue["Katakana Phonetic Extensions"](He)||ue.Katakana(He)||ue["Vertical Forms"](He)||ue["Yi Radicals"](He)||ue["Yi Syllables"](He)));(MO[nt]||Mt||st.imageName)&&$e.push(hS(tt+1,et,rt,$e,kO(nt,he.getCodePoint(tt+1),Mt&&We),!1))}}var He;return uS(hS(he.length(),et,rt,$e,0,!0))}(F,w,m,e,a,P),{processBidirectionalText:J,processStyledBidirectionalText:ee}=Ji;if(J&&F.sections.length===1){let he=J(F.toString(),W);for(let ve of he){let Ce=new rm;Ce.text=ve,Ce.sections=F.sections;for(let De=0;De<ve.length;De++)Ce.sectionIndex.push(0);B.push(Ce)}}else if(ee){let he=ee(F.text,F.sectionIndex,W);for(let ve of he){let Ce=new rm;Ce.text=ve[0],Ce.sectionIndex=ve[1],Ce.sections=F.sections,B.push(Ce)}}else B=function(he,ve){let Ce=[],De=he.text,Ue=0;for(let ze of ve)Ce.push(he.substring(Ue,ze)),Ue=ze;return Ue<De.length&&Ce.push(he.substring(Ue,De.length)),Ce}(F,W);let te=[],me={positionedLines:te,text:F.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,ve,Ce,De,Ue,ze,$e,rt,We,et,He,tt){let st=0,nt=0,Mt=0,ot=rt==="right"?1:rt==="left"?0:.5,dt=!1;for(let oi of Ue){let Zt=oi.getSections();for(let di of Zt){if(di.imageName)continue;let ai=ve[di.fontStack];if(ai&&(dt=ai.ascender!==void 0&&ai.descender!==void 0,!dt))break}if(!dt)break}let Nt=0;for(let oi of Ue){oi.trim();let Zt=oi.getMaxScale(),di=(Zt-1)*jr,ai={positionedGlyphs:[],lineOffset:0};he.positionedLines[Nt]=ai;let _i=ai.positionedGlyphs,qt=0;if(!oi.length()){nt+=ze,++Nt;continue}let rn=0,nn=0;for(let Ei=0;Ei<oi.length();Ei++){let Vi=oi.getSection(Ei),gn=oi.getSectionIndex(Ei),hn=oi.getCodePoint(Ei),Ln=Vi.scale,On=null,$r=null,Vn=null,Tn=jr,sr=0,Dr=!(We===ua.horizontal||!He&&!Je(hn)||He&&(c0[hn]||(Ft=hn,ue.Arabic(Ft)||ue["Arabic Supplement"](Ft)||ue["Arabic Extended-A"](Ft)||ue["Arabic Presentation Forms-A"](Ft)||ue["Arabic Presentation Forms-B"](Ft))));if(Vi.imageName){let Ar=De[Vi.imageName];if(!Ar)continue;Vn=Vi.imageName,he.iconsInText=he.iconsInText||!0,$r=Ar.paddedRect;let mn=Ar.displaySize;Ln=Ln*jr/tt,On={width:mn[0],height:mn[1],left:0,top:-lS,advance:Dr?mn[1]:mn[0],localGlyph:!1},sr=dt?-On.height*Ln:Zt*jr-17-mn[1]*Ln,Tn=On.advance;let _o=(Dr?mn[0]:mn[1])*Ln-jr*Zt;_o>0&&_o>qt&&(qt=_o)}else{let Ar=Ce[Vi.fontStack];if(!Ar)continue;Ar[hn]&&($r=Ar[hn]);let mn=ve[Vi.fontStack];if(!mn)continue;let _o=mn.glyphs[hn];if(!_o)continue;if(On=_o.metrics,Tn=hn!==8203?jr:0,dt){let Al=mn.ascender!==void 0?Math.abs(mn.ascender):0,Aa=mn.descender!==void 0?Math.abs(mn.descender):0,as=(Al+Aa)*Ln;rn<as&&(rn=as,nn=(Al-Aa)/2*Ln),sr=-Al*Ln}else sr=(Zt-Ln)*jr-17}Dr?(he.verticalizable=!0,_i.push({glyph:hn,imageName:Vn,x:st,y:nt+sr,vertical:Dr,scale:Ln,localGlyph:On.localGlyph,fontStack:Vi.fontStack,sectionIndex:gn,metrics:On,rect:$r}),st+=Tn*Ln+et):(_i.push({glyph:hn,imageName:Vn,x:st,y:nt+sr,vertical:Dr,scale:Ln,localGlyph:On.localGlyph,fontStack:Vi.fontStack,sectionIndex:gn,metrics:On,rect:$r}),st+=On.advance*Ln+et)}_i.length!==0&&(Mt=Math.max(st-et,Mt),dt?mS(_i,ot,qt,nn,ze*Zt/2):mS(_i,ot,qt,0,ze/2)),st=0;let Ni=ze*Zt+qt;ai.lineOffset=Math.max(qt,di),nt+=Ni,++Nt}var Ft;let Pt=nt,{horizontalAlign:ct,verticalAlign:Vt}=Gv($e);(function(oi,Zt,di,ai,_i,qt){let rn=(Zt-di)*_i,nn=-qt*ai;for(let Ni of oi)for(let Ei of Ni.positionedGlyphs)Ei.x+=rn,Ei.y+=nn})(he.positionedLines,ot,ct,Vt,Mt,Pt),he.top+=-Vt*Pt,he.bottom=he.top+Pt,he.left+=-ct*Mt,he.right=he.left+Mt,he.hasBaseline=dt}(me,e,n,a,B,p,b,y,T,w,E,R),!function(he){for(let ve of he)if(ve.positionedGlyphs.length!==0)return!1;return!0}(te)&&me}let c0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},MO={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function cS(t,e,n,a,c,m){if(e.imageName){let p=a[e.imageName];return p?p.displaySize[0]*e.scale*jr/m+c:0}{let p=n[e.fontStack],b=p&&p.glyphs[t];return b?b.metrics.advance*e.scale+c:0}}function dS(t,e,n,a){let c=Math.pow(t-e,2);return a?t<e?c/2:2*c:c+Math.abs(n)*n}function kO(t,e,n){let a=0;return t===10&&(a-=1e4),n&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function hS(t,e,n,a,c,m){let p=null,b=dS(e,n,c,m);for(let y of a){let w=dS(e-y.x,n,c,m)+y.badness;w<=b&&(p=y,b=w)}return{index:t,x:e,priorBreak:p,badness:b}}function uS(t){return t?uS(t.priorBreak).concat(t.index):[]}function Gv(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function mS(t,e,n,a,c){if(!(e||n||a||c))return;let m=t.length-1,p=t[m],b=(p.x+p.metrics.advance*p.scale)*e;for(let y=0;y<=m;y++)t[y].x-=b,t[y].y+=n+a+c}function TO(t,e,n,a){let{horizontalAlign:c,verticalAlign:m}=Gv(a),p=n[0]-t.displaySize[0]*c,b=n[1]-t.displaySize[1]*m;return{imagePrimary:t,imageSecondary:e,top:b,bottom:b+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function pS(t,e,n,a,c,m){let p=t.imagePrimary,b;if(p.content){let B=p.content,W=p.pixelRatio||1;b=[B[0]/W,B[1]/W,p.displaySize[0]-B[2]/W,p.displaySize[1]-B[3]/W]}let y=e.left*m,w=e.right*m,M,T,E,P;n==="width"||n==="both"?(P=c[0]+y-a[3],T=c[0]+w+a[1]):(P=c[0]+(y+w-p.displaySize[0])/2,T=P+p.displaySize[0]);let R=e.top*m,F=e.bottom*m;return n==="height"||n==="both"?(M=c[1]+R-a[0],E=c[1]+F+a[2]):(M=c[1]+(R+F-p.displaySize[1])/2,E=M+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:M,right:T,bottom:E,left:P,collisionPadding:b}}class Dl extends yt{constructor(e,n,a,c,m){super(e,n),this.angle=c,this.z=a,m!==void 0&&(this.segment=m)}clone(){return new Dl(this.x,this.y,this.z,this.angle,this.segment)}}function fS(t,e,n,a,c){if(e.segment===void 0)return!0;let m=e,p=e.segment+1,b=0;for(;b>-n/2;){if(p--,p<0)return!1;b-=t[p].dist(m),m=t[p]}b+=t[p].dist(t[p+1]),p++;let y=[],w=0;for(;b<n/2;){let M=t[p],T=t[p+1];if(!T)return!1;let E=t[p-1].angleTo(M)-M.angleTo(T);for(E=Math.abs((E+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:b,angleDelta:E}),w+=E;b-y[0].distance>a;)w-=y.shift().angleDelta;if(w>c)return!1;p++,b+=M.dist(T)}return!0}function gS(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function _S(t,e,n){return t?.6*e*n:0}function bS(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function IO(t,e,n,a,c,m){let p=_S(n,c,m),b=bS(n,a)*m,y=0,w=gS(t)/2;for(let M=0;M<t.length-1;M++){let T=t[M],E=t[M+1],P=T.dist(E);if(y+P>w){let R=(w-y)/P,F=Wt(T.x,E.x,R),B=Wt(T.y,E.y,R),W=new Dl(F,B,0,E.angleTo(T),M);return!p||fS(t,W,b,p,e)?W:void 0}y+=P}}function EO(t,e,n,a,c,m,p,b,y){let w=_S(a,m,p),M=bS(a,c),T=M*p,E=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-T<e/4&&(e=T+e/4),yS(t,E?e/2*b%e:(M/2+2*m)*p*b%e,e,w,n,T,E,!1,y)}function yS(t,e,n,a,c,m,p,b,y){let w=m/2,M=gS(t),T=0,E=e-n,P=[];for(let R=0;R<t.length-1;R++){let F=t[R],B=t[R+1],W=F.dist(B),J=B.angleTo(F);for(;E+n<T+W;){E+=n;let ee=(E-T)/W,te=Wt(F.x,B.x,ee),me=Wt(F.y,B.y,ee);if(te>=0&&te<y&&me>=0&&me<y&&E-w>=0&&E+w<=M){let he=new Dl(te,me,0,J,R);a&&!fS(t,he,m,a,c)||P.push(he)}}T+=W}return b||P.length||p||(P=yS(t,T/2,n,a,c,m,p,!0,y)),P}function vS(t,e,n,a,c){let m=[];for(let p=0;p<t.length;p++){let b=t[p],y;for(let w=0;w<b.length-1;w++){let M=b[w],T=b[w+1];M.x<e&&T.x<e||(M.x<e?M=new yt(e,M.y+(e-M.x)/(T.x-M.x)*(T.y-M.y))._round():T.x<e&&(T=new yt(e,M.y+(e-M.x)/(T.x-M.x)*(T.y-M.y))._round()),M.y<n&&T.y<n||(M.y<n?M=new yt(M.x+(n-M.y)/(T.y-M.y)*(T.x-M.x),n)._round():T.y<n&&(T=new yt(M.x+(n-M.y)/(T.y-M.y)*(T.x-M.x),n)._round()),M.x>=a&&T.x>=a||(M.x>=a?M=new yt(a,M.y+(a-M.x)/(T.x-M.x)*(T.y-M.y))._round():T.x>=a&&(T=new yt(a,M.y+(a-M.x)/(T.x-M.x)*(T.y-M.y))._round()),M.y>=c&&T.y>=c||(M.y>=c?M=new yt(M.x+(c-M.y)/(T.y-M.y)*(T.x-M.x),c)._round():T.y>=c&&(T=new yt(M.x+(c-M.y)/(T.y-M.y)*(T.x-M.x),c)._round()),y&&M.equals(y[y.length-1])||(y=[M],m.push(y)),y.push(T)))))}}return m}function xS(t){let e=0,n=0;for(let p of t)e+=p.w*p.h,n=Math.max(n,p.w);t.sort((p,b)=>b.h-p.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],c=0,m=0;for(let p of t)for(let b=a.length-1;b>=0;b--){let y=a[b];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,m=Math.max(m,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===y.w&&p.h===y.h){let w=a.pop();b<a.length&&(a[b]=w)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(a.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:c,h:m,fill:e/(c*m)||0}}ne(Dl,"Anchor");let Vo=1;class qv{constructor(e,{pixelRatio:n,version:a,stretchX:c,stretchY:m,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+Vo,this.paddedRect.y+Vo]}get br(){return[this.paddedRect.x+this.paddedRect.w-Vo,this.paddedRect.y+this.paddedRect.h-Vo]}get displaySize(){return[(this.paddedRect.w-2*Vo)/this.pixelRatio,(this.paddedRect.h-2*Vo)/this.pixelRatio]}}class wS{constructor(e,n,a){let c={},m={};this.haveRenderCallbacks=[];let p=[];this.addImages(e,c,p),this.addImages(n,m,p);let{w:b,h:y}=xS(p),w=new ha({width:b||1,height:y||1});for(let M in e){let T=e[M],E=c[M].paddedRect;ha.copy(T.data,w,{x:0,y:0},{x:E.x+Vo,y:E.y+Vo},T.data,a,T.sdf)}for(let M in n){let T=n[M],E=m[M].paddedRect,P=E.x+Vo,R=E.y+Vo,F=T.data.width,B=T.data.height;ha.copy(T.data,w,{x:0,y:0},{x:P,y:R},T.data,a),ha.copy(T.data,w,{x:0,y:B-1},{x:P,y:R-1},{width:F,height:1},a),ha.copy(T.data,w,{x:0,y:0},{x:P,y:R+B},{width:F,height:1},a),ha.copy(T.data,w,{x:F-1,y:0},{x:P-1,y:R},{width:1,height:B},a),ha.copy(T.data,w,{x:0,y:0},{x:P+F,y:R},{width:1,height:B},a)}this.image=w,this.iconPositions=c,this.patternPositions=m}addImages(e,n,a){for(let c in e){let m=e[c],p={x:0,y:0,w:m.data.width+2*Vo,h:m.data.height+2*Vo};a.push(p),n[c]=new qv(p,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(let c in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[c],e.getImage(c,a),n),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c,a),n)}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;let[c,m]=e.tl,p=!!Object.keys(this.patternPositions).length;a.update(n.data,{useMipmap:p},{x:c,y:m})}}ne(qv,"ImagePosition"),ne(wS,"ImageAtlas");let Pf=1e20;function CS(t,e,n,a,c,m,p,b,y){for(let w=e;w<e+a;w++)SS(t,n*m+w,m,c,p,b,y);for(let w=n;w<n+c;w++)SS(t,w*m+e,1,a,p,b,y)}function SS(t,e,n,a,c,m,p){m[0]=0,p[0]=-Pf,p[1]=Pf,c[0]=t[e];for(let b=1,y=0,w=0;b<a;b++){c[b]=t[e+b*n];let M=b*b;do{let T=m[y];w=(c[b]-c[T]+M-T*T)/(b-T)/2}while(w<=p[y]&&--y>-1);y++,m[y]=b,p[y]=w,p[y+1]=Pf}for(let b=0,y=0;b<a;b++){for(;p[y+1]<b;)y++;let w=m[y],M=b-w;t[e+b*n]=c[w]+M*M}}let es=2,$v={none:0,ideographs:1,all:2};class om{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,a){let c=[],m=this.urls[n]||I.GLYPHS_URL;for(let p in e)for(let b of e[p])c.push({stack:p,id:b});hc(c,({stack:p,id:b},y)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=w.glyphs[b];if(M!==void 0)return void y(null,{stack:p,id:b,glyph:M});if(M=this._tinySDF(w,p,b),M)return w.glyphs[b]=M,void y(null,{stack:p,id:b,glyph:M});let T=Math.floor(b/256);if(256*T>65535)return void y(new Error("glyphs > 65535 not supported"));if(w.ranges[T])return void y(null,{stack:p,id:b,glyph:M});let E=w.requests[T];E||(E=w.requests[T]=[],om.loadGlyphRange(p,T,m,this.requestManager,(P,R)=>{if(R){w.ascender=R.ascender,w.descender=R.descender;for(let F in R.glyphs)this._doesCharSupportLocalGlyph(+F)||(w.glyphs[+F]=R.glyphs[+F]);w.ranges[T]=!0}for(let F of E)F(P,R);delete w.requests[T]})),E.push((P,R)=>{P?y(P):R&&y(null,{stack:p,id:b,glyph:R.glyphs[b]||null})})},(p,b)=>{if(p)a(p);else if(b){let y={};for(let{stack:w,id:M,glyph:T}of b)y[w]===void 0&&(y[w]={}),y[w].glyphs===void 0&&(y[w].glyphs={}),y[w].glyphs[M]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},y[w].ascender=this.entries[w].ascender,y[w].descender=this.entries[w].descender;a(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==$v.none&&(this.localGlyphMode===$v.all?!!this.localFontFamily:!!this.localFontFamily&&(ue["CJK Unified Ideographs"](e)||ue["Hangul Syllables"](e)||ue.Hiragana(e)||ue.Katakana(e)||ue["CJK Symbols and Punctuation"](e)||ue["CJK Unified Ideographs Extension A"](e)||ue["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,a){let c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let m=e.tinySDF;if(!m){let F="400";/bold/i.test(n)?F="900":/medium/i.test(n)?F="500":/light/i.test(n)&&(F="200"),m=e.tinySDF=new om.TinySDF({fontFamily:c,fontWeight:F,fontSize:24*es,buffer:3*es,radius:8*es}),m.fontWeight=F}if(this.localGlyphs[m.fontWeight][a])return this.localGlyphs[m.fontWeight][a];let p=String.fromCodePoint(a),{data:b,width:y,height:w,glyphWidth:M,glyphHeight:T,glyphLeft:E,glyphTop:P,glyphAdvance:R}=m.draw(p);return this.localGlyphs[m.fontWeight][a]={id:a,bitmap:new Wc({width:y,height:w},b),metrics:{width:M/es,height:T/es,left:E/es,top:P/es-27,advance:R/es,localGlyph:!0}}}}om.loadGlyphRange=function(t,e,n,a,c){let m=256*e,p=m+255,b=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${m}-${p}`),_u.Glyphs);dl(b,(y,w)=>{if(y)c(y);else if(w){let M={},T=function(E){return new im(E).readFields(wO,{})}(w);for(let E of T.glyphs)M[E.id]=E;c(null,{glyphs:M,ascender:T.ascender,descender:T.descender})}})},om.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:m="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;let b=this.size=t+4*e,y=this._createCanvas(b),w=this.ctx=y.getContext("2d",{willReadFrequently:!0});w.font=`${p} ${m} ${t}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:m}=this.ctx.measureText(t),p=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-c))),y=Math.min(this.size-this.buffer,p+Math.ceil(a)),w=b+2*this.buffer,M=y+2*this.buffer,T=Math.max(w*M,0),E=new Uint8ClampedArray(T),P={data:E,width:w,height:M,glyphWidth:b,glyphHeight:y,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(b===0||y===0)return P;let{ctx:R,buffer:F,gridInner:B,gridOuter:W}=this;R.clearRect(F,F,b,y),R.fillText(t,F,F+p);let J=R.getImageData(F,F,b,y);W.fill(Pf,0,T),B.fill(0,0,T);for(let ee=0;ee<y;ee++)for(let te=0;te<b;te++){let me=J.data[4*(ee*b+te)+3]/255;if(me===0)continue;let he=(ee+F)*w+te+F;if(me===1)W[he]=0,B[he]=Pf;else{let ve=.5-me;W[he]=ve>0?ve*ve:0,B[he]=ve<0?ve*ve:0}}CS(W,0,0,w,M,w,this.f,this.v,this.z),CS(B,F,F,b,y,w,this.f,this.v,this.z);for(let ee=0;ee<T;ee++){let te=Math.sqrt(W[ee])-Math.sqrt(B[ee]);E[ee]=Math.round(255-255*(te/this.radius+this.cutoff))}return P}};let $c=Vo;function MS(t,e,n,a){let c=[],m=t.imagePrimary,p=m.pixelRatio,b=m.paddedRect.w-2*$c,y=m.paddedRect.h-2*$c,w=t.right-t.left,M=t.bottom-t.top,T=m.stretchX||[[0,b]],E=m.stretchY||[[0,y]],P=(ze,$e)=>ze+$e[1]-$e[0],R=T.reduce(P,0),F=E.reduce(P,0),B=b-R,W=y-F,J=0,ee=R,te=0,me=F,he=0,ve=B,Ce=0,De=W;if(m.content&&a){let ze=m.content;J=d0(T,0,ze[0]),te=d0(E,0,ze[1]),ee=d0(T,ze[0],ze[2]),me=d0(E,ze[1],ze[3]),he=ze[0]-J,Ce=ze[1]-te,ve=ze[2]-ze[0]-ee,De=ze[3]-ze[1]-me}let Ue=(ze,$e,rt,We)=>{let et=h0(ze.stretch-J,ee,w,t.left),He=u0(ze.fixed-he,ve,ze.stretch,R),tt=h0($e.stretch-te,me,M,t.top),st=u0($e.fixed-Ce,De,$e.stretch,F),nt=h0(rt.stretch-J,ee,w,t.left),Mt=u0(rt.fixed-he,ve,rt.stretch,R),ot=h0(We.stretch-te,me,M,t.top),dt=u0(We.fixed-Ce,De,We.stretch,F),Nt=new yt(et,tt),Ft=new yt(nt,tt),Pt=new yt(nt,ot),ct=new yt(et,ot),Vt=new yt(He/p,st/p),oi=new yt(Mt/p,dt/p),Zt=e*Math.PI/180;if(Zt){let nn=Math.sin(Zt),Ni=Math.cos(Zt),Ei=[Ni,-nn,nn,Ni];Nt._matMult(Ei),Ft._matMult(Ei),ct._matMult(Ei),Pt._matMult(Ei)}let di=ze.stretch+ze.fixed,ai=rt.stretch+rt.fixed,_i=$e.stretch+$e.fixed,qt=We.stretch+We.fixed,rn=t.imageSecondary;return{tl:Nt,tr:Ft,bl:ct,br:Pt,texPrimary:{x:m.paddedRect.x+$c+di,y:m.paddedRect.y+$c+_i,w:ai-di,h:qt-_i},texSecondary:rn?{x:rn.paddedRect.x+$c+di,y:rn.paddedRect.y+$c+_i,w:ai-di,h:qt-_i}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vt,pixelOffsetBR:oi,minFontScaleX:ve/p/w,minFontScaleY:De/p/M,isSDF:n}};if(a&&(m.stretchX||m.stretchY)){let ze=kS(T,B,R),$e=kS(E,W,F);for(let rt=0;rt<ze.length-1;rt++){let We=ze[rt],et=ze[rt+1];for(let He=0;He<$e.length-1;He++)c.push(Ue(We,$e[He],et,$e[He+1]))}}else c.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:y+1}));return c}function d0(t,e,n){let a=0;for(let c of t)a+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return a}function kS(t,e,n){let a=[{fixed:-$c,stretch:0}];for(let[c,m]of t){let p=a[a.length-1];a.push({fixed:c-p.stretch,stretch:p.stretch}),a.push({fixed:c-p.stretch,stretch:p.stretch+(m-c)})}return a.push({fixed:e+$c,stretch:n}),a}function h0(t,e,n,a){return t/e*n+a}function u0(t,e,n,a){return t-e*n/a}function DO(t,e,n,a){let c=e+t.positionedLines[a].lineOffset;return a===0?n+c/2:n+(c+(e+t.positionedLines[a-1].lineOffset))/2}function AO(t,e=1,n=!1){let a=1/0,c=1/0,m=-1/0,p=-1/0,b=t[0];for(let P=0;P<b.length;P++){let R=b[P];(!P||R.x<a)&&(a=R.x),(!P||R.y<c)&&(c=R.y),(!P||R.x>m)&&(m=R.x),(!P||R.y>p)&&(p=R.y)}let y=Math.min(m-a,p-c),w=y/2,M=new Wp([],PO);if(y===0)return new yt(a,c);for(let P=a;P<m;P+=y)for(let R=c;R<p;R+=y)M.push(new am(P+w,R+w,w,t));let T=function(P){let R=0,F=0,B=0,W=P[0];for(let J=0,ee=W.length,te=ee-1;J<ee;te=J++){let me=W[J],he=W[te],ve=me.x*he.y-he.x*me.y;F+=(me.x+he.x)*ve,B+=(me.y+he.y)*ve,R+=3*ve}return new am(F/R,B/R,0,P)}(t),E=M.length;for(;M.length;){let P=M.pop();(P.d>T.d||!T.d)&&(T=P,n&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,E)),P.max-T.d<=e||(w=P.h/2,M.push(new am(P.p.x-w,P.p.y-w,w,t)),M.push(new am(P.p.x+w,P.p.y-w,w,t)),M.push(new am(P.p.x-w,P.p.y+w,w,t)),M.push(new am(P.p.x+w,P.p.y+w,w,t)),E+=4)}return n&&(console.log(`num probes: ${E}`),console.log(`best distance: ${T.d}`)),T.p}function PO(t,e){return e.max-t.max}class am{constructor(e,n,a,c){this.p=new yt(e,n),this.h=a,this.d=function(m,p){let b=!1,y=1/0;for(let w=0;w<p.length;w++){let M=p[w];for(let T=0,E=M.length,P=E-1;T<E;P=T++){let R=M[T],F=M[P];R.y>m.y!=F.y>m.y&&m.x<(F.x-R.x)*(m.y-R.y)/(F.y-R.y)+R.x&&(b=!b),y=Math.min(y,OC(m,R,F))}}return(b?1:-1)*Math.sqrt(y)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}let Yv=Number.POSITIVE_INFINITY,OO=Math.sqrt(2);function TS(t,[e,n]){let a=0,c=0;if(n===Yv){e<0&&(e=0);let m=e/OO;switch(t){case"top-right":case"top-left":c=m-7;break;case"bottom-right":case"bottom-left":c=7-m;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(t){case"top-right":case"bottom-right":a=-m;break;case"top-left":case"bottom-left":a=m;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":c=n-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-n}switch(t){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function Zv(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function RO(t,e,n,a,c,m,p,b,y,w,M,T,E,P,R){let F=m.textMaxSize.evaluate(e,{},T);F===void 0&&(F=p);let B=t.layers[0].layout,W=B.get("icon-offset").evaluate(e,{},T),J=ES(n.horizontal)||n.vertical,ee=E.name==="globe",te=jr,me=p/te,he=t.tilePixelRatio*F/te,ve=(et=t.overscaling,t.zoom>18&&et>2&&(et>>=1),Math.max(pt/(512*et),1)*B.get("symbol-spacing")),Ce=B.get("text-padding")*t.tilePixelRatio,De=B.get("icon-padding")*t.tilePixelRatio,Ue=Ti(B.get("text-max-angle")),ze=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",$e=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",rt=B.get("symbol-placement"),We=ve/2;var et;let He=B.get("icon-text-fit").evaluate(e,{},T),tt=B.get("icon-text-fit-padding").evaluate(e,{},T),st=He!=="none",nt;t.hasAnyIconTextFit===!1&&st&&(t.hasAnyIconTextFit=!0),a&&st&&(t.allowVerticalPlacement&&n.vertical&&(nt=pS(a,n.vertical,He,tt,W,me)),J&&(a=pS(a,J,He,tt,W,me)));let Mt=(ot,dt,Nt)=>{if(dt.x<0||dt.x>=pt||dt.y<0||dt.y>=pt)return;let Ft=null;if(ee){let{x:Pt,y:ct,z:Vt}=E.projectTilePoint(dt.x,dt.y,Nt);Ft={anchor:new Dl(Pt,ct,Vt,0,void 0),up:E.upVector(Nt,dt.x,dt.y)}}(function(Pt,ct,Vt,oi,Zt,di,ai,_i,qt,rn,nn,Ni,Ei,Vi,gn,hn,Ln,On,$r,Vn,Tn,sr,Dr,Ar,mn,_o,Al){let Aa=Pt.addToLineVertexArray(ct,oi),as,ed,td,Eh,DM,AM,PM,OM=0,RM=0,LM=0,FM=0,Sx=-1,Mx=-1,js={},zM=yc(""),Dh=Vt?Vt.anchor:ct,kx=qt.layout.get("icon-text-fit").evaluate(Tn,{},mn)!=="none",Tx=0,Ix=0;if(qt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Tx,Ix]=qt.layout.get("text-offset").evaluate(Tn,{},mn).map(Uo=>Uo*jr):(Tx=qt.layout.get("text-radial-offset").evaluate(Tn,{},mn)*jr,Ix=Yv),Pt.allowVerticalPlacement&&Zt.vertical){let Uo=Zt.vertical;if(gn)AM=Xv(Uo),_i&&(PM=Xv(_i));else{let Ho=qt.layout.get("text-rotate").evaluate(Tn,{},mn)+90;td=m0(rn,Dh,ct,nn,Ni,Ei,Uo,Vi,Ho,hn),_i&&(Eh=m0(rn,Dh,ct,nn,Ni,Ei,_i,On,Ho))}}if(di){let Uo=qt.layout.get("icon-rotate").evaluate(Tn,{},mn),Ho=MS(di,Uo,Dr,kx),fm=_i?MS(_i,Uo,Dr,kx):void 0;ed=m0(rn,Dh,ct,nn,Ni,Ei,di,On,Uo),OM=4*Ho.length;let BM=Pt.iconSizeData,Ah=null;BM.kind==="source"?(Ah=[Ja*qt.layout.get("icon-size").evaluate(Tn,{},mn)],Ah[0]>Yc&&qn(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${Of}. Reduce your "icon-size".`)):BM.kind==="composite"&&(Ah=[Ja*sr.compositeIconSizes[0].evaluate(Tn,{},mn),Ja*sr.compositeIconSizes[1].evaluate(Tn,{},mn)],(Ah[0]>Yc||Ah[1]>Yc)&&qn(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${Of}. Reduce your "icon-size".`)),Pt.addSymbols(Pt.icon,Ho,Ah,Vn,$r,Tn,!1,Vt,ct,Aa.lineStartIndex,Aa.lineLength,-1,Ar,mn,_o,Al),Sx=Pt.icon.placedSymbolArray.length-1,fm&&(RM=4*fm.length,Pt.addSymbols(Pt.icon,fm,Ah,Vn,$r,Tn,ua.vertical,Vt,ct,Aa.lineStartIndex,Aa.lineLength,-1,Ar,mn,_o,Al),Mx=Pt.icon.placedSymbolArray.length-1)}for(let Uo in Zt.horizontal){let Ho=Zt.horizontal[Uo];as||(zM=yc(Ho.text),gn?DM=Xv(Ho):as=m0(rn,Dh,ct,nn,Ni,Ei,Ho,Vi,qt.layout.get("text-rotate").evaluate(Tn,{},mn),hn));let fm=Ho.positionedLines.length===1;if(LM+=IS(Pt,Vt,ct,Ho,ai,qt,gn,Tn,hn,Aa,Zt.vertical?ua.horizontal:ua.horizontalOnly,fm?Object.keys(Zt.horizontal):[Uo],js,Sx,sr,Ar,mn,_o),fm)break}Zt.vertical&&(FM+=IS(Pt,Vt,ct,Zt.vertical,ai,qt,gn,Tn,hn,Aa,ua.vertical,["vertical"],js,Mx,sr,Ar,mn,_o));let id=-1,Ex=(Uo,Ho)=>Uo?Math.max(Uo,Ho):Ho;id=Ex(DM,id),id=Ex(AM,id),id=Ex(PM,id);let JR=id>-1?1:0;Pt.glyphOffsetArray.length>=65535&&qn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Tn.sortKey!==void 0&&Pt.addToSortKeyRanges(Pt.symbolInstances.length,Tn.sortKey),Pt.symbolInstances.emplaceBack(ct.x,ct.y,Dh.x,Dh.y,Dh.z,js.right>=0?js.right:-1,js.center>=0?js.center:-1,js.left>=0?js.left:-1,js.vertical>=0?js.vertical:-1,Sx,Mx,zM,as!==void 0?as:Pt.collisionBoxArray.length,as!==void 0?as+1:Pt.collisionBoxArray.length,td!==void 0?td:Pt.collisionBoxArray.length,td!==void 0?td+1:Pt.collisionBoxArray.length,ed!==void 0?ed:Pt.collisionBoxArray.length,ed!==void 0?ed+1:Pt.collisionBoxArray.length,Eh||Pt.collisionBoxArray.length,Eh?Eh+1:Pt.collisionBoxArray.length,nn,LM,FM,OM,RM,JR,0,Tx,Ix,id,0,1,1,kx?1:0)})(t,dt,Ft,ot,n,a,c,nt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Ce,ze,y,0,De,$e,W,e,m,w,M,T,P,R)};if(rt==="line")for(let ot of vS(e.geometry,0,0,pt,pt)){let dt=EO(ot,ve,Ue,n.vertical||J,a,te,he,t.overscaling,pt);for(let Nt of dt)J&&LO(t,J.text,We,Nt)||Mt(ot,Nt,T)}else if(rt==="line-center"){for(let ot of e.geometry)if(ot.length>1){let dt=IO(ot,Ue,n.vertical||J,a,te,he);dt&&Mt(ot,dt,T)}}else if(e.type==="Polygon")for(let ot of Z_(e.geometry,0)){let dt=AO(ot,16);Mt(ot[0],new Dl(dt.x,dt.y,0,0,void 0),T)}else if(e.type==="LineString")for(let ot of e.geometry)Mt(ot,new Dl(ot[0].x,ot[0].y,0,0,void 0),T);else if(e.type==="Point")for(let ot of e.geometry)for(let dt of ot)Mt([dt],new Dl(dt.x,dt.y,0,0,void 0),T)}let Of=255,Yc=Of*Ja;function IS(t,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W){let J=function(me,he,ve,Ce,De,Ue,ze,$e){let rt=[];if(he.positionedLines.length===0)return rt;let We=Ce.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,et=function(Mt){let ot=Mt[0],dt=Mt[1],Nt=ot*dt;return Nt>0?[ot,-dt]:Nt<0?[-ot,dt]:ot===0?[dt,ot]:[dt,-ot]}(ve),He=Math.abs(he.top-he.bottom);for(let Mt of he.positionedLines)He-=Mt.lineOffset;let tt=he.positionedLines.length,st=He/tt,nt=he.top-ve[1];for(let Mt=0;Mt<tt;++Mt){let ot=he.positionedLines[Mt];nt=DO(he,st,nt,Mt);for(let dt of ot.positionedGlyphs){if(!dt.rect)continue;let Nt=dt.rect||{},Ft=lS+1,Pt=!0,ct=1,Vt=0;if(dt.imageName){let Vn=ze[dt.imageName];if(!Vn)continue;if(Vn.sdf){qn("SDF images are not supported in formatted text and will be ignored.");continue}Pt=!1,ct=Vn.pixelRatio,Ft=Vo/ct}let oi=(De||$e)&&dt.vertical,Zt=dt.metrics.advance*dt.scale/2,di=dt.metrics,ai=dt.rect;if(ai===null)continue;$e&&he.verticalizable&&(Vt=dt.imageName?Zt-dt.metrics.width*dt.scale/2:0);let _i=De?[dt.x+Zt,dt.y]:[0,0],qt=[0,0],rn=[0,0],nn=!1;De||(oi?(rn=[dt.x+Zt+et[0],dt.y+et[1]-Vt],nn=!0):qt=[dt.x+Zt+ve[0],dt.y+ve[1]-Vt]);let Ni=ai.w*dt.scale/(ct*(dt.localGlyph?es:1)),Ei=ai.h*dt.scale/(ct*(dt.localGlyph?es:1)),Vi,gn,hn,Ln;if(oi){let Vn=dt.y-nt,Tn=new yt(-Zt,Zt-Vn),sr=-Math.PI/2,Dr=new yt(...rn);Vi=new yt(-Zt+qt[0],qt[1]),Vi._rotateAround(sr,Tn)._add(Dr),Vi.x+=-Vn+Zt,Vi.y-=(di.left-Ft)*dt.scale;let Ar=dt.imageName?di.advance*dt.scale:jr*dt.scale,mn=String.fromCodePoint(dt.glyph);vO(mn)?Vi.x+=(1-Ft)*dt.scale:xO(mn)?Vi.x+=Ar-di.height*dt.scale+(-Ft-1)*dt.scale:Vi.x+=dt.imageName||di.width+2*Ft===ai.w&&di.height+2*Ft===ai.h?(Ar-Ei)/2:(Ar-(di.height+2*Ft)*dt.scale)/2,gn=new yt(Vi.x,Vi.y-Ni),hn=new yt(Vi.x+Ei,Vi.y),Ln=new yt(Vi.x+Ei,Vi.y-Ni)}else{let Vn=(di.left-Ft)*dt.scale-Zt+qt[0],Tn=(-di.top-Ft)*dt.scale+qt[1],sr=Vn+Ni,Dr=Tn+Ei;Vi=new yt(Vn,Tn),gn=new yt(sr,Tn),hn=new yt(Vn,Dr),Ln=new yt(sr,Dr)}if(We){let Vn;Vn=De?new yt(0,0):nn?new yt(et[0],et[1]):new yt(ve[0],ve[1]),Vi._rotateAround(We,Vn),gn._rotateAround(We,Vn),hn._rotateAround(We,Vn),Ln._rotateAround(We,Vn)}let On=new yt(0,0),$r=new yt(0,0);rt.push({tl:Vi,tr:gn,bl:hn,br:Ln,texPrimary:Nt,texSecondary:void 0,writingMode:he.writingMode,glyphOffset:_i,sectionIndex:dt.sectionIndex,isSDF:Pt,pixelOffsetTL:On,pixelOffsetBR:$r,minFontScaleX:0,minFontScaleY:0})}}return rt}(0,a,y,m,p,b,c,t.allowVerticalPlacement),ee=t.textSizeData,te=null;ee.kind==="source"?(te=[Ja*m.layout.get("text-size").evaluate(b,{},B)],te[0]>Yc&&qn(`${t.layerIds[0]}: Value for "text-size" is >= ${Of}. Reduce your "text-size".`)):ee.kind==="composite"&&(te=[Ja*R.compositeTextSizes[0].evaluate(b,{},B),Ja*R.compositeTextSizes[1].evaluate(b,{},B)],(te[0]>Yc||te[1]>Yc)&&qn(`${t.layerIds[0]}: Value for "text-size" is >= ${Of}. Reduce your "text-size".`)),t.addSymbols(t.text,J,te,y,p,b,M,e,n,w.lineStartIndex,w.lineLength,P,F,B,W,!1);for(let me of T)E[me]=t.text.placedSymbolArray.length-1;return 4*J.length}function ES(t){for(let e in t)return t[e];return null}function m0(t,e,n,a,c,m,p,b,y,w){let M=p.top,T=p.bottom,E=p.left,P=p.right,R=p.collisionPadding;if(R&&(E-=R[0],M-=R[1],P+=R[2],T+=R[3]),y){let F=new yt(E,M),B=new yt(P,M),W=new yt(E,T),J=new yt(P,T),ee=Ti(y),te=new yt(0,0);w&&(te=new yt(w[0],w[1])),F._rotateAround(ee,te),B._rotateAround(ee,te),W._rotateAround(ee,te),J._rotateAround(ee,te),E=Math.min(F.x,B.x,W.x,J.x),P=Math.max(F.x,B.x,W.x,J.x),M=Math.min(F.y,B.y,W.y,J.y),T=Math.max(F.y,B.y,W.y,J.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,E,M,P,T,b,a,c,m),t.length-1}function Xv(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function LO(t,e,n,a){let c=t.compareText;if(e in c){let m=c[e];for(let p=m.length-1;p>=0;p--)if(a.dist(m[p])<n)return!0}else c[e]=[];return c[e].push(a),!1}function DS(t,e){let n=t.fovAboveCenter,a=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-a)/Math.cos(t._pitch),m=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),p=Math.sin(t._pitch)*m+c;return Math.min(1.01*p,c*(1/t._horizonShift))}function Sh(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),a=t.x*n,c=(t.x+1)*n,m=t.y*n,p=(t.y+1)*n,b=Ao(a),y=Ao(c),w=Er(m),M=Er(p),T=e.project(b,w),E=e.project(y,w),P=e.project(y,M),R=e.project(b,M),F=Math.min(T.x,E.x,P.x,R.x),B=Math.min(T.y,E.y,P.y,R.y),W=Math.max(T.x,E.x,P.x,R.x),J=Math.max(T.y,E.y,P.y,R.y),ee=n/16;function te(he,ve,Ce,De,Ue,ze){let $e=(Ce+Ue)/2,rt=(De+ze)/2,We=e.project(Ao($e),Er(rt)),et=Math.max(0,F-We.x,B-We.y,We.x-W,We.y-J);F=Math.min(F,We.x),W=Math.max(W,We.x),B=Math.min(B,We.y),J=Math.max(J,We.y),et>ee&&(te(he,We,Ce,De,$e,rt),te(We,ve,$e,rt,Ue,ze))}te(T,E,a,m,c,m),te(E,P,c,m,c,p),te(P,R,c,p,a,p),te(R,T,a,p,a,m),F-=ee,B-=ee,W+=ee,J+=ee;let me=1/Math.max(W-F,J-B);return{scale:me,x:F*me,y:B*me,x2:W*me,y2:J*me,projection:e}}function AS(t,{x:e,y:n},a=0){return new yt(((e-a)*t.scale-t.x)*pt,(n*t.scale-t.y)*pt)}let FO=i.ad.identity(new Float32Array(16));class Zc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Oi(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a=!0){return e._coordinatePoint(e.locationCoordinate(n),a)}pixelsPerMeter(e,n){return go(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return DS(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,c){let m=e.horizonLineFromTop(!1),p=new yt(n,Math.max(m,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,c))}pointCoordinate3D(e,n,a){let c=new yt(n,a);if(e.elevation)return e.elevation.pointCoordinate(c);{let m=this.pointCoordinate(e,c.x,c.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);let a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return FO}createTileMatrix(e,n,a){let c,m,p,b=a.canonical,y=i.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let w=Sh(b,this);c=1,m=w.x+a.wrap*w.scale,p=w.y,i.ad.scale(y,y,[c/w.scale,c/w.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(b.z),m=(b.x+Math.pow(2,b.z)*a.wrap)*c,p=b.y*c;return i.ad.translate(y,y,[m,p,0]),i.ad.scale(y,y,[c/pt,c/pt,1]),y}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class zO extends Zc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Ti(n));this.n=(c+Math.sin(Ti(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:a,c,r0:m}=this,p=Ti(e-this.center[0]),b=Ti(n),y=Math.sqrt(c-2*a*Math.sin(b))/a;return{x:y*Math.sin(p*a),y:y*Math.cos(p*a)-m,z:0}}unproject(e,n){let{n:a,c,r0:m}=this,p=m+n,b=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(b-=Math.PI*Math.sign(e)*Math.sign(p));let y=Ti(this.center[0])*a;b=sl(b,-Math.PI-y,Math.PI-y);let w=pi(Br(b/a)+this.center[0],-180,180),M=Math.asin(pi((c-(e*e+p*p)*a*a)/(2*a),-1,1)),T=pi(Br(M),-Yn,Yn);return new Oi(w,T)}}let Rf=1.340264,Lf=-.081106,Ff=893e-6,zf=.003796,p0=Math.sqrt(3)/2;class BO extends Zc{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let a=Math.asin(p0*Math.sin(n)),c=a*a,m=c*c*c;return{x:.5*(e*Math.cos(a)/(p0*(Rf+3*Lf*c+m*(7*Ff+9*zf*c)))/Math.PI+.5),y:1-.5*(a*(Rf+Lf*c+m*(Ff+zf*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=a*a,m=c*c*c;for(let M,T,E,P=0;P<12&&(T=a*(Rf+Lf*c+m*(Ff+zf*c))-n,E=Rf+3*Lf*c+m*(7*Ff+9*zf*c),M=T/E,a=pi(a-M,-Math.PI/3,Math.PI/3),c=a*a,m=c*c*c,!(Math.abs(M)<1e-12));++P);let p=p0*e*(Rf+3*Lf*c+m*(7*Ff+9*zf*c))/Math.cos(a),b=Math.asin(Math.sin(a)/p0),y=pi(180*p/Math.PI,-180,180),w=pi(180*b/Math.PI,-Yn,Yn);return new Oi(y,w)}}class NO extends Zc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let a=360*(e-.5),c=pi(360*(.5-n),-Yn,Yn);return new Oi(a,c)}}let sm=Math.PI/2;function f0(t){return Math.tan((sm+t)/2)}class VO extends Zc{constructor(e){super(e),this.center=e.center||[0,30];let[n,a]=this.parallels=e.parallels||[30,30],c=Ti(n),m=Ti(a);this.southernCenter=c+m<0,this.southernCenter&&(c=-c,m=-m);let p=Math.cos(c),b=f0(c);this.n=c===m?Math.sin(c):Math.log(p/Math.cos(m))/Math.log(f0(m)/b),this.f=p*Math.pow(f0(c),this.n)/this.n}project(e,n){n=Ti(n),this.southernCenter&&(n=-n),e=Ti(e-this.center[0]);let a=1e-6,{n:c,f:m}=this;m>0?n<-sm+a&&(n=-sm+a):n>sm-a&&(n=sm-a);let p=m/Math.pow(f0(n),c),b=p*Math.sin(c*e),y=m-p*Math.cos(c*e);return b=.5*(b/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:b,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:a,f:c}=this,m=c-n,p=Math.sign(m),b=Math.sign(a)*Math.sqrt(e*e+m*m),y=Math.atan2(e,Math.abs(m))*p;m*a<0&&(y-=Math.PI*Math.sign(e)*p);let w=pi(Br(y/a)+this.center[0],-180,180),M=pi(Br(2*Math.atan(Math.pow(c/b,1/a))-sm),-Yn,Yn);return new Oi(w,this.southernCenter?-M:M)}}class PS extends Zc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Ls(e),y:Fs(n),z:0}}unproject(e,n){let a=Ao(e),c=Er(n);return new Oi(a,c)}}let OS=Ti(Yn);class jO extends Zc{project(e,n){let a=(n=Ti(n))*n,c=a*a;return{x:.5*((e=Ti(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=25,m=0,p=a*a;do{p=a*a;let w=p*p;m=(a*(1.007226+p*(.015085+w*(.028874*p-.044475-.005916*w)))-n)/(1.007226+p*(.045255+w*(.259866*p-.311325-.005916*11*w))),a=pi(a-m,-OS,OS)}while(Math.abs(m)>1e-6&&--c>0);p=a*a;let b=pi(Br(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),y=Br(a);return new Oi(b,y)}}let RS=Ti(Yn);class UO extends Zc{project(e,n){n=Ti(n),e=Ti(e);let a=Math.cos(n),c=2/Math.PI,m=Math.acos(a*Math.cos(e/2)),p=Math.sin(m)/m,b=.5*(e*c+2*a*Math.sin(e/2)/p)||0,y=.5*(n+Math.sin(n)/p)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,m=25,p=1e-6,b=0,y=0;do{let w=Math.cos(c),M=Math.sin(c),T=2*M*w,E=M*M,P=w*w,R=Math.cos(a/2),F=Math.sin(a/2),B=2*R*F,W=F*F,J=1-P*R*R,ee=J?1/J:0,te=J?Math.acos(w*R)*Math.sqrt(1/J):0,me=.5*(2*te*w*F+2*a/Math.PI)-e,he=.5*(te*M+c)-n,ve=.5*ee*(P*W+te*w*R*E)+1/Math.PI,Ce=ee*(B*T/4-te*M*F),De=.125*ee*(T*F-te*M*P*B),Ue=.5*ee*(E*R+te*W*w)+.5,ze=Ce*De-Ue*ve;b=(he*Ce-me*Ue)/ze,y=(me*De-he*ve)/ze,a=pi(a-b,-Math.PI,Math.PI),c=pi(c-y,-RS,RS)}while((Math.abs(b)>p||Math.abs(y)>p)&&--m>0);return new Oi(Br(a),Br(c))}}class LS extends Zc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ti(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:a,cosPhi:c}=this;return{x:Ti(e)*c*a+.5,y:-Math.sin(Ti(n))/c*a+.5,z:0}}unproject(e,n){let{scale:a,cosPhi:c}=this,m=-(n-.5)/a,p=pi(Br((e-.5)/a)/c,-180,180),b=Math.asin(pi(m*c,-1,1)),y=pi(Br(b),-Yn,Yn);return new Oi(p,y)}}class HO extends PS{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){let c=vf(e,n,a),m=xf(zs(a));return i._.transformMat4(c,c,m),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,n){let a=yh(n.lat,n.lng),c=i._.normalize([],a),m=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,p=go(1,0)*pt*m;i._.scaleAndAdd(a,a,c,p);let b=i.ad.identity(new Float64Array(16));return i.ad.multiply(b,e.pixelMatrix,e.globeMatrix),i._.transformMat4(a,a,b),new yt(a[0],a[1])}pixelsPerMeter(e,n){return go(1,0)*n}pixelSpaceConversion(e,n,a){let c=go(1,e)*n,m=Wt(go(1,45)*n,c,a);return this.pixelsPerMeter(e,n)/m}createTileMatrix(e,n,a){let c=Tv(zs(a.canonical));return i.ad.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){let{center:a}=e,c=xf(zs(n));return i.ad.rotateY(c,c,Ti(a.lng)),i.ad.rotateX(c,c,Ti(a.lat)),i.ad.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,n,a,c){return UC(e,n,a,!0)||new qr(0,0)}pointCoordinate3D(e,n,a){let c=this.pointCoordinate(e,n,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!UC(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(c,m){let p=c.cameraToCenterDistance,b=c._centerAltitude*m,y=c._camera,w=c._camera.forward(),M=i._.add([],i._.scale([],w,-p),[0,0,b]),T=c.worldSize/(2*Math.PI),E=[0,0,-T],P=c.width/c.height,R=Math.tan(c.fovAboveCenter),F=i._.scale([],y.up(),R),B=i._.scale([],y.right(),R*P),W=i._.normalize([],i._.add([],i._.add([],w,F),B)),J=[],ee;if(new wv(M,W).closestPointOnSphere(E,T,J)){let te=i._.add([],J,E),me=i._.sub([],te,M);ee=Math.cos(c.fovAboveCenter)*i._.length(me)}else{let te=i._.sub([],M,E),me=i._.sub([],E,M);i._.normalize(me,me);let he=i._.length(te)-T;ee=Math.sqrt(he*(he+2*T));let ve=Math.acos(ee/(T+he))-Math.acos(i._.dot(w,me));ee*=Math.cos(ve)}return 1.01*ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Il(e.zoom);if(a>0){let c=DS(e,go(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Wt(n,c+m*(1-Math.cos(p)),Math.pow(a,10))}return n}upVector(e,n,a){return vf(n,a,e,1)}upVectorScale(e){return{metersToTile:H_(G_(zs(e)))}}}function FS(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new PS(t);case"equirectangular":return new NO(t);case"naturalEarth":return new jO(t);case"equalEarth":return new BO(t);case"winkelTripel":return new UO(t);case"albers":return n?new LS(t):new zO(t);case"lambertConformalConic":return n?new LS(t):new VO(t);case"globe":return new HO(t)}throw new Error(`Invalid projection name: ${t.name}`)}let WO=(()=>{class t{constructor(n,a,c,m){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;let p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||m||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();class lm{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}lm.ReadOnly=!1,lm.ReadWrite=!0,lm.disabled=new lm(519,lm.ReadOnly,[0,1]);let Qv=7680;class Kv{constructor(e,n,a,c,m,p){this.test=e,this.ref=n,this.mask=a,this.fail=c,this.depthFail=m,this.pass=p}}Kv.disabled=new Kv({func:519,mask:0},0,0,Qv,Qv,Qv);let Bf=771;class jo{constructor(e,n,a,c){this.blendFunction=e,this.blendColor=n,this.mask=a,this.blendEquation=c}}jo.Replace=[1,0,1,0],jo.disabled=new jo(jo.Replace,Fi.transparent,[!1,!1,!1,!1]),jo.unblended=new jo(jo.Replace,Fi.transparent,[!0,!0,!0,!0]),jo.alphaBlended=new jo([1,Bf,1,Bf],Fi.transparent,[!0,!0,!0,!0]),jo.alphaBlendedNonPremultiplied=new jo([770,Bf,770,Bf],Fi.transparent,[!0,!0,!0,!0]),jo.multiply=new jo([774,0,774,0],Fi.transparent,[!0,!0,!0,!0]);let Jv=1029,ex=2305;class ts{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}ts.disabled=new ts(!1,Jv,ex),ts.backCCW=new ts(!0,Jv,ex),ts.backCW=new ts(!0,Jv,2304),ts.frontCW=new ts(!0,1028,2304),ts.frontCCW=new ts(!0,1028,ex);let GO=K_.types,qO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function g0(t,e,n,a,c,m,p,b,y,w,M,T,E){let P=b?Math.min(Yc,Math.round(b[0])):0,R=b?Math.min(Yc,Math.round(b[1])):0;t.emplaceBack(e,n,Math.round(32*a),Math.round(32*c),m,p,(P<<1)+(y?1:0),R,16*w,16*M,256*T,256*E)}function _0(t,e,n){t.emplaceBack(e,n)}function b0(t,e,n,a,c,m,p){t.emplaceBack(e,n,a,c,m,p)}function y0(t,e,n,a,c){t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c)}function $O(t){for(let e of t.sections)if(Ye(e.text))return!0;return!1}class tx{constructor(e){this.layoutVertexArray=new Gy,this.indexArray=new wr,this.programConfigurations=e,this.segments=new An,this.dynamicLayoutVertexArray=new Fc,this.opacityVertexArray=new $y,this.occlusionQueryOpacityVertexArray=new gh,this.placedSymbolArray=new uC,this.iconTransitioningVertexArray=new Nc,this.globeExtVertexArray=new qy,this.zOffsetVertexArray=new gh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,a,c,m){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,YP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,XP.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,qO,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,Vv.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,QP.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ZP.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,W2.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ne(tx,"SymbolBuffers");class ix{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new An,this.collisionVertexArray=new Xy,this.collisionVertexArrayExt=new Fc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,KP.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,JP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ne(ix,"CollisionBuffers");class cm{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=i.ad.identity([]),this.placementViewportMatrix=i.ad.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Uv(this.zoom,n["text-size"]),this.iconSizeData=Uv(this.zoom,n["icon-size"]);let a=this.layers[0].layout,c=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>ua[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new tx(new jc(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new tx(new jc(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new fC,this.lineVertexArray=new gC,this.symbolInstances=new pC}calculateGlyphDependencies(e,n,a,c,m){for(let p=0;p<e.length;p++){let b=e.codePointAt(p);if(b===void 0)break;if(n[b]=!0,c&&m&&b<=65535){let y=Df[e.charAt(p)];y&&(n[y.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Bv(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,n,a,c){let m=this.layers[0],p=m.layout,b=this.projection.name==="globe",y=p.get("text-font"),w=p.get("text-field"),M=p.get("icon-image"),T=(w.value.kind!=="constant"||w.value.value instanceof Vr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),E=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,P=p.get("symbol-sort-key");if(this.features=[],!T&&!E)return;let R=n.iconDependencies,F=n.glyphDependencies,B=n.availableImages,W=new Qt(this.zoom);for(let{feature:J,id:ee,index:te,sourceLayerIndex:me}of e){let he=m._featureFilter.needGeometry,ve=kl(J,he);if(!m._featureFilter.filter(W,ve,a))continue;if(he||(ve.geometry=Ka(J,a,c)),b&&J.type!==1&&a.z<=5){let ze=ve.geometry,$e=.98078528056,rt=(We,et)=>{let He=vf(We.x,We.y,a,1),tt=vf(et.x,et.y,a,1);return i._.dot(He,tt)<$e};for(let We=0;We<ze.length;We++)ze[We]=AA(ze[We],rt)}let Ce,De;if(T){let ze=m.getValueAndResolveTokens("text-field",ve,a,B),$e=Vr.factory(ze);$O($e)&&(this.hasRTLText=!0),(!this.hasRTLText||gi()==="unavailable"||this.hasRTLText&&Ji.isParsed())&&(Ce=yO($e,m,ve))}if(E){let ze=m.getValueAndResolveTokens("icon-image",ve,a,B);De=ze instanceof to?ze:to.fromString(ze)}if(!Ce&&!De)continue;let Ue=this.sortFeaturesByKey?P.evaluate(ve,{},a):void 0;if(this.features.push({id:ee,text:Ce,icon:De,index:te,sourceLayerIndex:me,geometry:ve.geometry,properties:J.properties,type:GO[J.type],sortKey:Ue}),De&&(R[De.namePrimary]=!0,De.nameSecondary&&(R[De.nameSecondary]=!0)),Ce){let ze=y.evaluate(ve,{},a).join(","),$e=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ua.vertical)>=0;for(let rt of Ce.sections)if(rt.image)R[rt.image.namePrimary]=!0;else{let We=Re(Ce.toString()),et=rt.fontStack||ze,He=F[et]=F[et]||{};this.calculateGlyphDependencies(rt.text,He,$e,this.allowVerticalPlacement,We)}}}p.get("symbol-placement")==="line"&&(this.features=function(J){let ee={},te={},me=[],he=0;function ve(ze){me.push(J[ze]),he++}function Ce(ze,$e,rt){let We=te[ze];return delete te[ze],te[$e]=We,me[We].geometry[0].pop(),me[We].geometry[0]=me[We].geometry[0].concat(rt[0]),We}function De(ze,$e,rt){let We=ee[$e];return delete ee[$e],ee[ze]=We,me[We].geometry[0].shift(),me[We].geometry[0]=rt[0].concat(me[We].geometry[0]),We}function Ue(ze,$e,rt){let We=rt?$e[0][$e[0].length-1]:$e[0][0];return`${ze}:${We.x}:${We.y}`}for(let ze=0;ze<J.length;ze++){let $e=J[ze],rt=$e.geometry,We=$e.text?$e.text.toString():null;if(!We){ve(ze);continue}let et=Ue(We,rt),He=Ue(We,rt,!0);if(et in te&&He in ee&&te[et]!==ee[He]){let tt=De(et,He,rt),st=Ce(et,He,me[tt].geometry);delete ee[et],delete te[He],te[Ue(We,me[st].geometry,!0)]=st,me[tt].geometry=null}else et in te?Ce(et,He,rt):He in ee?De(et,He,rt):(ve(ze),ee[et]=he-1,te[He]=he-1)}return me.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ee)=>J.sortKey-ee.sortKey)}update(e,n,a,c,m){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let b=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,b,a,c,m),this.icon.programConfigurations.updatePaintArrays(e,n,b,a,c,m)}updateOcclusionOpacities(e,n,a){if(!n.useOcclusionQueries)return!1;let c=this;if(c.projection.name==="globe")return!1;let m=!1;c.hasTextData()&&(m=m||c.text.occlusionQueryOpacityVertexArray.length!==0),c.hasIconData()&&(m=m||c.icon.occlusionQueryOpacityVertexArray.length!==0);let p=c.layers[0].paint,b=p.get("icon-occlusion-opacity").constantOr(0),y=p.get("text-occlusion-opacity").constantOr(0);if(!c.layers[0].hasInitialOcclusionOpacityProperties||b===1&&y===1)return!1;let w=!m;for(let P=0;P<c.symbolInstances.length;P++){let R=c.symbolInstances.get(P),F=R.occlusionOpacity;R.occlusionOpacity+=(R.occlusionState>.5?1:-1)*n.fadeSpeed*a*.001,R.occlusionOpacity=pi(R.occlusionOpacity,0,1),w=w||R.occlusionOpacity!==F}if(!w)return!1;let M=0,T=0,E=(P,R,F,B)=>{let W=0,J=0;F?(W=T,T+=B,J=T):(W=M,M+=B,J=M),J>R.occlusionQueryOpacityVertexArray.length&&R.occlusionQueryOpacityVertexArray.resize(J);let ee=P.occlusionOpacity;for(let te=0;te<B;te++)R.occlusionQueryOpacityVertexArray.emplace(te+W,ee)};for(let P=0;P<c.symbolInstances.length;P++){let R=c.symbolInstances.get(P),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:B,numIconVertices:W}=R,J=W>0;if((F>0||B>0)&&(E(R,c.text,!1,F),E(R,c.text,!1,B)),J){let{placedIconSymbolIndex:ee,verticalPlacedIconSymbolIndex:te}=R;ee>=0&&E(R,c.icon,!0,W),te>=0&&E(R,c.icon,!0,R.numVerticalIconVertices)}}return c.hasTextData()&&c.text.occlusionQueryOpacityVertexBuffer&&(c.text.occlusionQueryOpacityVertexBuffer.length<c.text.occlusionQueryOpacityVertexArray.length?c.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(c.text.occlusionQueryOpacityVertexArray,Vv.members,!0):c.text.occlusionQueryOpacityVertexBuffer.updateData(c.text.occlusionQueryOpacityVertexArray)),c.hasIconData()&&c.icon.occlusionQueryOpacityVertexBuffer&&(c.icon.occlusionQueryOpacityVertexBuffer.length<c.icon.occlusionQueryOpacityVertexArray.length?c.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(c.icon.occlusionQueryOpacityVertexArray,Vv.members,!0):c.icon.occlusionQueryOpacityVertexBuffer.updateData(c.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(m,p,b)=>{a+=p,a>m.length&&m.resize(a);for(let y=-p;y<0;y++)m.emplace(y+a,b)},n=(m,p,b)=>{c+=p,c>m.length&&m.resize(c);for(let y=-p;y<0;y++)m.emplace(y+c,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,c=0;for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:y,numIconVertices:w}=p,M=p.zOffset,T=w>0;if((b>0||y>0)&&(e(this.text.zOffsetVertexArray,b,M),e(this.text.zOffsetVertexArray,y,M)),T){let{placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:P}=p;E>=0&&n(this.icon.zOffsetVertexArray,w,M),P>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=FS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,n){let a=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:c,y:m}of n)this.lineVertexArray.emplaceBack(c,m);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B){let W=e.indexArray,J=e.layoutVertexArray,ee=e.globeExtVertexArray,te=e.segments.prepareSegment(4*n.length,J,W,this.canOverlap?p.sortKey:void 0),me=this.glyphOffsetArray.length,he=te.vertexLength,ve=this.allowVerticalPlacement&&b===ua.vertical?Math.PI/2:0,Ce=p.text&&p.text.sections;for(let Ue=0;Ue<n.length;Ue++){let{tl:ze,tr:$e,bl:rt,br:We,texPrimary:et,texSecondary:He,pixelOffsetTL:tt,pixelOffsetBR:st,minFontScaleX:nt,minFontScaleY:Mt,glyphOffset:ot,isSDF:dt,sectionIndex:Nt}=n[Ue],Ft=te.vertexLength,Pt=ot[1];if(g0(J,w.x,w.y,ze.x,Pt+ze.y,et.x,et.y,a,dt,tt.x,tt.y,nt,Mt),g0(J,w.x,w.y,$e.x,Pt+$e.y,et.x+et.w,et.y,a,dt,st.x,tt.y,nt,Mt),g0(J,w.x,w.y,rt.x,Pt+rt.y,et.x,et.y+et.h,a,dt,tt.x,st.y,nt,Mt),g0(J,w.x,w.y,We.x,Pt+We.y,et.x+et.w,et.y+et.h,a,dt,st.x,st.y,nt,Mt),y){let{x:ct,y:Vt,z:oi}=y.anchor,[Zt,di,ai]=y.up;b0(ee,ct,Vt,oi,Zt,di,ai),b0(ee,ct,Vt,oi,Zt,di,ai),b0(ee,ct,Vt,oi,Zt,di,ai),b0(ee,ct,Vt,oi,Zt,di,ai),y0(e.dynamicLayoutVertexArray,ct,Vt,oi,ve)}else y0(e.dynamicLayoutVertexArray,w.x,w.y,w.z,ve);if(B){let ct=He||et;_0(e.iconTransitioningVertexArray,ct.x,ct.y),_0(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y),_0(e.iconTransitioningVertexArray,ct.x,ct.y+ct.h),_0(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y+ct.h)}W.emplaceBack(Ft,Ft+1,Ft+2),W.emplaceBack(Ft+1,Ft+2,Ft+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ot[0]),Ue!==n.length-1&&Nt===n[Ue+1].sectionIndex||e.programConfigurations.populatePaintArrays(J.length,p,p.index,{},P,R,F,Ce&&Ce[Nt])}let De=y?y.anchor:w;e.placedSymbolArray.emplaceBack(De.x,De.y,De.z,w.x,w.y,me,this.glyphOffsetArray.length-me,he,M,T,w.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],b,0,!1,0,E,0)}_commitLayoutVertex(e,n,a,c,m,p,b){e.emplaceBack(n,a,c,m,p,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,n,a,c,m,p,b){let y=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),w=y.vertexLength,M=b.tileAnchorX,T=b.tileAnchorY;for(let P=0;P<4;P++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,n,e.padding,b.zOffset),this._commitLayoutVertex(a.layoutVertexArray,c,m,p,M,T,new yt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,m,p,M,T,new yt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,m,p,M,T,new yt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,m,p,M,T,new yt(e.x1,e.y2)),y.vertexLength+=4;let E=a.indexArray;E.emplaceBack(w,w+1),E.emplaceBack(w+1,w+2),E.emplaceBack(w+2,w+3),E.emplaceBack(w+3,w),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,c,m,p){for(let b=c;b<m;b++){let y=a.get(b),w=this.getSymbolInstanceTextSize(e,p,n,b);this._addCollisionDebugVertices(y,w,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,a,c,m,p){for(let b=c;b<m;b++){let y=a.get(b),w=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(y,w,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ix(R_,G2.members,Nc),this.iconCollisionBox=new ix(R_,G2.members,Nc);let a=nm(this.iconSizeData,e),c=nm(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,a,c){let m=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),p=l0(this.textSizeData,e,m)/jr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,a){let c=this.icon.placedSymbolArray.get(a),m=l0(this.iconSizeData,e,c);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,n,a,c){e.emplaceBack(n,-a,-a,c),e.emplaceBack(n,a,-a,c),e.emplaceBack(n,a,a,c),e.emplaceBack(n,-a,a,c)}_updateTextDebugCollisionBoxes(e,n,a,c,m,p){for(let b=c;b<m;b++){let y=a.get(b),w=this.getSymbolInstanceTextSize(e,p,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,y.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,a,c,m,p){for(let b=c;b<m;b++){let y=a.get(b),w=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,y.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let a=nm(this.iconSizeData,e),c=nm(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,c,m,p,b,y,w){let M={};if(n<a){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:me}=e.get(n);M.textBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.textFeatureIndex=me}if(c<m){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:me}=e.get(c);M.verticalTextBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.verticalTextFeatureIndex=me}if(p<b){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:me}=e.get(p);M.iconBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.iconFeatureIndex=me}if(y<w){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:me}=e.get(y);M.verticalIconBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.verticalIconFeatureIndex=me}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let a=e.placedSymbolArray.get(n),c=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<c;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),a=Math.cos(e),c=[],m=[],p=[];for(let b=0;b<this.symbolInstances.length;++b){p.push(b);let y=this.symbolInstances.get(b);c.push(0|Math.round(n*y.tileAnchorX+a*y.tileAnchorY)),m.push(y.featureIndex)}return p.sort((b,y)=>c[b]-c[y]||m[y]-m[b]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);let{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:w}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),m>=0&&m!==c&&this.addIndicesForPlacedSymbol(this.text,m),p>=0&&p!==m&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ne(cm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),cm.addDynamicAttributes=y0;class Ea{constructor(e,n,a,c){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,a){let{width:c,height:m}=e,{context:p}=this,{gl:b}=p;if(b.bindTexture(b.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||n.premultiply!==!1)),a||this.size&&this.size[0]===c&&this.size[1]===m){let{x:y,y:w}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)b.texSubImage2D(b.TEXTURE_2D,0,y,w,b.RGBA,b.UNSIGNED_BYTE,e);else{let M=this.format,T=b.UNSIGNED_BYTE;this.format===b.R32F&&(M=b.RED,T=b.FLOAT),b.texSubImage2D(b.TEXTURE_2D,0,y,w,c,m,M,T,e.data)}}else if(this.size=[c,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===b.R8&&(y=b.RED),b.texImage2D(b.TEXTURE_2D,0,this.format,y,b.UNSIGNED_BYTE,e)}else{let y=this.format,w=this.format,M=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(y=b.DEPTH_COMPONENT16,M=b.UNSIGNED_SHORT),this.format===b.R8&&(w=b.RED),this.format===b.R32F&&(M=b.FLOAT,w=b.RED),b.texImage2D(b.TEXTURE_2D,0,y,c,m,0,w,M,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,n,a=!1){let{context:c}=this,{gl:m}=c;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,n),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,a,c){let{context:m}=this,{gl:p}=m;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),this.wrapS=a),c!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class v0{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}}let Da=32,Ns=33,Xc=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,a=0,c=0,m=0,p=0,b=0;for(1&e?c=m=p=Da:n=a=b=Da;(e>>=1)>1;){let w=n+c>>1,M=a+m>>1;1&e?(c=n,m=a,n=p,a=b):(n=c,a=m,c=p,m=b),p=w,b=M}let y=4*t;Xc[y+0]=n,Xc[y+1]=a,Xc[y+2]=c,Xc[y+3]=m}let Vs=new Uint16Array(2178),Qc=new Uint8Array(1089),x0=new Uint16Array(1089);function zS(t){return t===0?-.03125:t===32?.03125:0}var w0=Gi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),YO=Gi([{name:"a_index",type:"Int16",components:1}]);let BS={type:2,extent:pt,loadGeometry:()=>[[new yt(0,0),new yt(pt+1,0),new yt(pt+1,pt+1),new yt(0,pt+1),new yt(0,0)]]};class C0{constructor(e,n,a,c,m){this.tileID=e,this.uid=au(),this.uses=0,this.tileSize=n,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,c&&c.style&&(this._lastUpdatedBrightness=c.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<kr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Sh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,m){let p={};if(!m)return p;for(let b of c){let y=b.layerIds.map(w=>m.getLayer(w)).filter(Boolean);if(y.length!==0){b.layers=y,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(w=>y.filter(M=>M.id===w)[0]));for(let w of y)p[w.fqid]=b}}return p}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let c in this.buckets){let m=this.buckets[c];if(m instanceof cm){if(this.hasSymbolBuckets=!0,!a)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let c in this.buckets){let m=this.buckets[c];if(m instanceof cm&&m.hasRTLText){this.hasRTLText=!0,Ji.isLoading()||Ji.isLoaded()||gi()!=="deferred"||Ii();break}}this.queryPadding=0;for(let c in this.buckets){let m=this.buckets[c],p=n.style.getOwnLayer(c);if(!p)continue;let b=p.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,b)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new rv}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let c in this.buckets){let m=this.buckets[c];m.uploadPending()&&m.upload(e)}let n=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){let c=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new Ea(e,a.image,n.RGBA,{useMipmap:c}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ea(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ea(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let c=n.style.getBrightness();(this._lastUpdatedBrightness||c)&&(this._lastUpdatedBrightness&&c&&Math.abs(this._lastUpdatedBrightness-c)<.001||(this._lastUpdatedBrightness=c,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,a,c,m,p,b,y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:b,transform:p,params:m,tileTransform:this.tileTransform},e,n,a):{}}querySourceFeatures(e,n){let a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;let c=a.loadVTLayers(),m=n?n.sourceLayer:"",p=c._geojsonTileLayer||c[m];if(!p)return;let b=fr(n&&n.filter),{z:y,x:w,y:M}=this.tileID.canonical,T={z:y,x:w,y:M};for(let E=0;E<p.length;E++){let P=p.feature(E);if(b.needGeometry){let B=kl(P,!0);if(!b.filter(new Qt(this.tileID.overscaledZ),B,this.tileID.canonical))continue}else if(!b.filter(new Qt(this.tileID.overscaledZ),P))continue;let R=a.getId(P,m),F=new oS(P,y,w,M,R);F.tile=T,e.push(F)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let a=bp(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let a=Date.now(),c=!1;if(this.expirationTime>a)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{let m=this.expirationTime-n;m?this.expirationTime=a+Math.max(m,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let a=this.latestFeatureIndex.loadVTLayers(),c=n.style.listImages(),m=n.style.getBrightness();for(let p in this.buckets){if(!n.style.hasLayer(p))continue;let b=this.buckets[p],y=b.layers[0].sourceLayer||"_geojsonTileLayer",w=a[y],M={};if(e&&(M=e[y],!w||!M||Object.keys(M).length===0))continue;if(b.update(M,w,c,this.imageAtlas&&this.imageAtlas.patternPositions||{},m),b instanceof r0||b instanceof X_){let E=n.style.getOwnSourceCache(b.layers[0].source);n._terrain&&n._terrain.enabled&&E&&b.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(E.id,this.tileID)}let T=n&&n.style&&n.style.getOwnLayer(p);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<kr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=kr.now()+e}setTexture(e,n){let a=n.context,c=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Ea?this.texture.update(e,{useMipmap:!0}):(this.texture=new Ea(a,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE))}setDependencies(e,n){let a={};for(let c of n)a[c]=!0;this.dependencies[e]=a}hasDependency(e,n){for(let a of e){let c=this.dependencies[a];if(c){for(let m of n)if(c[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let a=Ka(BS,this.tileID.canonical,this.tileTransform)[0],c=new Xa,m=new mf;for(let p=0;p<a.length;p++){let{x:b,y}=a[p];c.emplaceBack(b,y),m.emplaceBack(p)}m.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(m),this._tileDebugBuffer=e.createVertexBuffer(c,yf.members),this._tileDebugSegments=An.simpleSegment(0,0,c.length,m.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let a=Ka(BS,this.tileID.canonical,this.tileTransform)[0],c,m;if(this.isRaster){let p=function(b,y){let w=Sh(b,y),M=Math.pow(2,b.z);for(let B=0;B<Ns;B++)for(let W=0;W<Ns;W++){let J=Ao((b.x+(W+zS(W))/Da)/M),ee=Er((b.y+(B+zS(B))/Da)/M),te=y.project(J,ee),me=B*Ns+W;Vs[2*me+0]=Math.round((te.x*w.scale-w.x)*pt),Vs[2*me+1]=Math.round((te.y*w.scale-w.y)*pt)}Qc.fill(0),x0.fill(0);for(let B=2045;B>=0;B--){let W=4*B,J=Xc[W+0],ee=Xc[W+1],te=Xc[W+2],me=Xc[W+3],he=J+te>>1,ve=ee+me>>1,Ce=he+ve-ee,De=ve+J-he,Ue=ee*Ns+J,ze=me*Ns+te,$e=ve*Ns+he,rt=Math.hypot((Vs[2*Ue+0]+Vs[2*ze+0])/2-Vs[2*$e+0],(Vs[2*Ue+1]+Vs[2*ze+1])/2-Vs[2*$e+1])>=16;Qc[$e]=Qc[$e]||(rt?1:0),B<1022&&(Qc[$e]=Qc[$e]||Qc[(ee+De>>1)*Ns+(J+Ce>>1)]||Qc[(me+De>>1)*Ns+(te+Ce>>1)])}let T=new Lc,E=new wr,P=0;function R(B,W){let J=W*Ns+B;return x0[J]===0&&(T.emplaceBack(Vs[2*J+0],Vs[2*J+1],B*pt/Da,W*pt/Da),x0[J]=++P),x0[J]-1}function F(B,W,J,ee,te,me){let he=B+J>>1,ve=W+ee>>1;if(Math.abs(B-te)+Math.abs(W-me)>1&&Qc[ve*Ns+he])F(te,me,B,W,he,ve),F(J,ee,te,me,he,ve);else{let Ce=R(B,W),De=R(J,ee),Ue=R(te,me);E.emplaceBack(Ce,De,Ue)}}return F(0,0,Da,Da,Da,0),F(Da,Da,0,0,0,Da),{vertices:T,indices:E}}(this.tileID.canonical,n);c=p.vertices,m=p.indices}else{c=new Lc,m=new wr;for(let{x:b,y}of a)c.emplaceBack(b,y,0,0);let p=Cf(c.int16,void 0,4);for(let b=0;b<p.length;b+=3)m.emplaceBack(p[b],p[b+1],p[b+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,w0.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(m),this._tileBoundsSegments=An.simpleSegment(0,0,c.length,m.length)}_makeGlobeTileDebugBuffers(e,n){let a=n.projection;if(!a||a.name!=="globe"||n.freezeTileCoverage)return;let c=this.tileID.canonical,m=xf(HC(c,n)),p=Il(n.zoom),b;p>0&&(b=i.ad.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,n,m,b,p),this._makeGlobeTileDebugTextBuffer(e,c,n,m,b,p)}_globePoint(e,n,a,c,m,p,b){let y=vf(e,n,a);if(p){let w=1<<a.z,M=Ls(c.center.lng),T=Fs(c.center.lat),E=(a.x+.5)/w-M,P=0;E>.5?P=-1:E<-.5&&(P=1);let R=(e/pt+a.x)/w+P,F=(n/pt+a.y)/w;R=(R-M)*c._pixelsPerMercatorPixel+M,F=(F-T)*c._pixelsPerMercatorPixel+T;let B=[R*c.worldSize,F*c.worldSize,0];i._.transformMat4(B,B,p),y=Tl(y,B,b)}return i._.transformMat4(y,y,m)}_makeGlobeTileDebugBorderBuffer(e,n,a,c,m,p){let b=new Xa,y=new mf,w=new A_,M=(E,P,R,F,B)=>{let W=(R-E)/(B-1),J=(F-P)/(B-1),ee=b.length;for(let te=0;te<B;te++){let me=E+te*W,he=P+te*J;b.emplaceBack(me,he);let ve=this._globePoint(me,he,n,a,c,m,p);w.emplaceBack(ve[0],ve[1],ve[2]),y.emplaceBack(ee+te)}},T=pt;M(0,0,T,0,16),M(T,0,T,T,16),M(T,T,0,T,16),M(0,T,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(b,yf.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(w,jC.members),this._tileDebugSegments=An.simpleSegment(0,0,b.length,y.length)}_makeGlobeTileDebugTextBuffer(e,n,a,c,m,p){let b=pt/4,y=new Xa,w=new wr,M=new A_,T=25;w.reserve(32),y.reserve(T),M.reserve(T);let E=(P,R)=>T*P+R;for(let P=0;P<T;P++){let R=P*b;for(let F=0;F<T;F++){let B=F*b;y.emplaceBack(B,R);let W=this._globePoint(B,R,n,a,c,m,p);M.emplaceBack(W[0],W[1],W[2])}}for(let P=0;P<4;P++)for(let R=0;R<4;R++){let F=E(P,R),B=E(P,R+1),W=E(P+1,R),J=E(P+1,R+1);w.emplaceBack(F,B,W),w.emplaceBack(W,B,J)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(y,yf.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(M,jC.members),this._tileDebugTextSegments=An.simpleSegment(0,0,T,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Ea&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let ni={read:function(t,e){return t.readFields(ni._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(ni.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};ni.Filter.read=function(t,e){return t.readFields(ni.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},ni.Filter._readField=function(t,e,n){t===1?(e.delta_filter=ni.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=ni.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=ni.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=ni.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},ni.Filter.Delta={},ni.Filter.Delta.read=function(t,e){return t.readFields(ni.Filter.Delta._readField,{block_size:0},e)},ni.Filter.Delta._readField=function(t,e,n){t===1&&(e.block_size=n.readVarint())},ni.Filter.Zigzag={},ni.Filter.Zigzag.read=function(t,e){return t.readFields(ni.Filter.Zigzag._readField,{},e)},ni.Filter.Zigzag._readField=function(t,e,n){},ni.Filter.BitShuffle={},ni.Filter.BitShuffle.read=function(t,e){return t.readFields(ni.Filter.BitShuffle._readField,{},e)},ni.Filter.BitShuffle._readField=function(t,e,n){},ni.Filter.ByteShuffle={},ni.Filter.ByteShuffle.read=function(t,e){return t.readFields(ni.Filter.ByteShuffle._readField,{},e)},ni.Filter.ByteShuffle._readField=function(t,e,n){},ni.Codec={},ni.Codec.read=function(t,e){return t.readFields(ni.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},ni.Codec._readField=function(t,e,n){t===1?(e.gzip_data=ni.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=ni.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):t===3?(e.webp_image=ni.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):t===4&&(e.png_image=ni.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},ni.Codec.GzipData={},ni.Codec.GzipData.read=function(t,e){return t.readFields(ni.Codec.GzipData._readField,{},e)},ni.Codec.GzipData._readField=function(t,e,n){},ni.Codec.JpegImage={},ni.Codec.JpegImage.read=function(t,e){return t.readFields(ni.Codec.JpegImage._readField,{},e)},ni.Codec.JpegImage._readField=function(t,e,n){},ni.Codec.WebpImage={},ni.Codec.WebpImage.read=function(t,e){return t.readFields(ni.Codec.WebpImage._readField,{},e)},ni.Codec.WebpImage._readField=function(t,e,n){},ni.Codec.PngImage={},ni.Codec.PngImage.read=function(t,e){return t.readFields(ni.Codec.PngImage._readField,{},e)},ni.Codec.PngImage._readField=function(t,e,n){},ni.DataIndexEntry={},ni.DataIndexEntry.read=function(t,e){return t.readFields(ni.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},ni.DataIndexEntry._readField=function(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(ni.Filter.read(n,n.readVarint()+n.pos)):t===4?e.codec=ni.Codec.read(n,n.readVarint()+n.pos):t===5?e.offset=n.readFloat():t===6?e.scale=n.readFloat():t===7&&e.bands.push(n.readString())},ni.Layer={},ni.Layer.read=function(t,e){return t.readFields(ni.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},ni.Layer._readField=function(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(ni.DataIndexEntry.read(n,n.readVarint()+n.pos))};let is={read:function(t,e){return t.readFields(is._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,n){t===2?(e.uint32_values=is.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=is.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};is.Uint32Values.read=function(t,e){return t.readFields(is.Uint32Values._readField,{values:[]},e)},is.Uint32Values._readField=function(t,e,n){t===1&&(e.readValuesInto=function(a){if(a.type!==2)throw new Error(`Unsupported pbf type "${a.type}"`);let c=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(a),m=a.pos;return a.pos=c,function(p){a.pos=m;let b=0;for(;a.pos<c;){let y=a.readVarint();p[b++]=y}return p}}(n))},is.Fixed32Values={},is.Fixed32Values.read=function(t,e){return t.readFields(is.Fixed32Values._readField,{values:[]},e)},is.Fixed32Values._readField=function(t,e,n){throw new Error("Not implemented")};class ZO{constructor(e=0,n=0,a=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=a,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let a=this.items[e];this.ttl>0&&a.expiry<=Date.now()?this.delete(e):(n=a.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,a=!1,c=this.resetTtl){let m;if(a||this.has(e)){if(m=this.items[e],m.value=n,a===!1&&c&&(m.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==m){let p=this.last,b=m.next,y=m.prev;this.first===m&&(this.first=m.next),m.next=null,m.prev=this.last,p.next=m,y!==null&&(y.next=b),b!==null&&(b.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),m=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=m:this.last.next=m;return this.last=m,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function XO(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let a=2;a>=1;a--){let c=a===1?1:0,m=a===2?1:0;for(let p=0;p<e[0];p++){let b=e[1]*p;for(let y=c;y<e[1];y++){let w=e[2]*(y+b);for(let M=m;M<e[2];M++){let T=e[3]*(M+w);for(let E=0;E<e[3];E++){let P=T+E;t[P]+=t[P-n]}}}}n*=e[a]}return t}function QO(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function KO(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){let a=t[n],c=t[n+1];t[n]=(240&a)>>4|(61440&a)>>8|(240&c)<<4|61440&c,t[n+1]=15&a|(3840&a)>>4|(15&c)<<8|(3840&c)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){let a=t[n],c=t[n+1],m=t[n+2],p=t[n+3];t[n+0]=(192&a)>>6|(192&c)>>4|(192&m)>>2|192&p,t[n+1]=(48&a)>>4|(48&c)>>2|48&m|(48&p)<<2,t[n+2]=(12&a)>>2|12&c|(12&m)<<2|(12&p)<<4,t[n+3]=3&a|(3&c)<<2|(3&m)<<4|(3&p)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Kc extends Error{constructor(e){super(e),this.name="MRTError"}}var ma=Uint8Array,dm=Uint16Array,JO=Int32Array,NS=new ma([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),VS=new ma([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),eR=new ma([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),jS=function(t,e){for(var n=new dm(31),a=0;a<31;++a)n[a]=e+=1<<t[a-1];var c=new JO(n[30]);for(a=1;a<30;++a)for(var m=n[a];m<n[a+1];++m)c[m]=m-n[a]<<5|a;return{b:n,r:c}},US=jS(NS,2),HS=US.b,tR=US.r;HS[28]=258,tR[258]=28;for(var iR=jS(VS,0).b,nx=new dm(32768),tr=0;tr<32768;++tr){var hm=(43690&tr)>>1|(21845&tr)<<1;nx[tr]=((65280&(hm=(61680&(hm=(52428&hm)>>2|(13107&hm)<<2))>>4|(3855&hm)<<4))>>8|(255&hm)<<8)>>1}var Nf=function(t,e,n){for(var a=t.length,c=0,m=new dm(e);c<a;++c)t[c]&&++m[t[c]-1];var p,b=new dm(e);for(c=1;c<e;++c)b[c]=b[c-1]+m[c-1]<<1;if(n){p=new dm(1<<e);var y=15-e;for(c=0;c<a;++c)if(t[c])for(var w=c<<4|t[c],M=e-t[c],T=b[t[c]-1]++<<M,E=T|(1<<M)-1;T<=E;++T)p[nx[T]>>y]=w}else for(p=new dm(a),c=0;c<a;++c)t[c]&&(p[c]=nx[b[t[c]-1]++]>>15-t[c]);return p},Vf=new ma(288);for(tr=0;tr<144;++tr)Vf[tr]=8;for(tr=144;tr<256;++tr)Vf[tr]=9;for(tr=256;tr<280;++tr)Vf[tr]=7;for(tr=280;tr<288;++tr)Vf[tr]=8;var WS=new ma(32);for(tr=0;tr<32;++tr)WS[tr]=5;var nR=Nf(Vf,9,1),rR=Nf(WS,5,1),rx=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},ns=function(t,e,n){var a=e/8|0;return(t[a]|t[a+1]<<8)>>(7&e)&n},ox=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},oR=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],rs=function(t,e,n){var a=new Error(e||oR[t]);if(a.code=t,Error.captureStackTrace&&Error.captureStackTrace(a,rs),!n)throw a;return a},aR=new ma(0),sR=typeof TextDecoder<"u"&&new TextDecoder;try{sR.decode(aR,{stream:!0})}catch{}let lR={gzip_data:"gzip"},cR={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},dR={uint32:1,uint16:2,uint8:4},hR={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class ax{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),a=new DataView(e);if(n[0]!==13)throw new Kc("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),a=this.getHeaderLength(e);if(n.length<a)throw new Kc(`Expected header with length >= ${a} but got buffer of length ${n.length}`);let c=new im(n.subarray(0,a)),m=ni.read(c);if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new Kc(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(let p of m.layers)this.layers[p.name]=new uR(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],a=this.getLayer(e.layerName);for(let c=0;c<a.dataIndex.length;c++){let m=a.dataIndex[c],p=m.first_byte-e.firstByte,b=m.last_byte+1-e.firstByte;if(c<e.firstBlock||c>e.lastBlock||a._blocksInProgress.has(c))continue;let y={layerName:a.name,firstByte:p,lastByte:b,pixelFormat:a.pixelFormat,blockIndex:c,blockShape:[m.bands.length].concat(a.bandShape),buffer:a.buffer,codec:m.codec.codec,filters:m.filters.map(w=>w.filter)};a._blocksInProgress.add(c),n.push(y)}return new GS(n,()=>{n.forEach(c=>a._blocksInProgress.delete(c.blockIndex))},(c,m)=>{if(n.forEach(p=>a._blocksInProgress.delete(p.blockIndex)),c)throw c;m.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class uR{constructor({version:e,name:n,units:a,tilesize:c,pixel_format:m,buffer:p,data_index:b},y){if(this.version=e,this.version!==1)throw new Kc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=a,this.tileSize=c,this.buffer=p,this.pixelFormat=cR[m],this.dataIndex=b,this.bandShape=[c+2*p,c+2*p,dR[this.pixelFormat]],this._decodedBlocks=function(w=1e3,M=0,T=!1){if(isNaN(w)||w<0)throw new TypeError("Invalid max value");if(isNaN(M)||M<0)throw new TypeError("Invalid ttl value");if(typeof T!="boolean")throw new TypeError("Invalid resetTtl value");return new ZO(w,M,T)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[a,c]of this.dataIndex.entries()){for(let[m,p]of c.bands.entries())if(p===e)return{bandIndex:n+m,blockIndex:a,blockBandIndex:m};n+=c.bands.length}break;case"number":for(let[a,c]of this.dataIndex.entries()){if(e>=n&&e<n+c.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-n};n+=c.bands.length}break;default:throw new Kc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Kc(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,a=-1/0,c=1/0,m=-1/0;for(let p of e){let{blockIndex:b}=this.getBlockForBand(p);if(b<0)throw new Kc(`Invalid band: ${JSON.stringify(p)}`);let y=this.dataIndex[b];c=Math.min(c,b),m=Math.max(m,b),n=Math.min(n,y.first_byte),a=Math.max(a,y.last_byte)}return{layerName:this.name,firstByte:n,lastByte:a,firstBlock:c,lastBlock:m}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:a}=this.getBlockForBand(e),c=this._decodedBlocks.get(n.toString());if(!c)throw new Kc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let m=this.dataIndex[n],p=this.bandShape.reduce((w,M)=>w*M,1),b=a*p,y=c.subarray(b,b+p);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:m.offset,scale:m.scale}}}class GS{constructor(e,n,a){this.tasks=e,this._onCancel=n,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}ax.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{let{layerName:a,firstByte:c,lastByte:m,pixelFormat:p,blockShape:b,blockIndex:y,filters:w,codec:M}=n,T=new Uint8Array(t).subarray(c,m+1),E=new Uint32Array(b[0]*b[1]*b[2]),P;if(M!=="gzip_data")throw new Error(`Unhandled codec: ${M}`);return P=function(R,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((ee=function(he){he[0]==31&&he[1]==139&&he[2]==8||rs(6,"invalid gzip data");var ve=he[3],Ce=10;4&ve&&(Ce+=2+(he[10]|he[11]<<8));for(var De=(ve>>3&1)+(ve>>4&1);De>0;De-=!he[Ce++]);return Ce+(2&ve)}(J=R))+8>J.length&&rs(6,"invalid gzip data"),function(he,ve,Ce,De){var Ue=he.length;if(!Ue||ve.f&&!ve.l)return Ce||new ma(0);var ze=!Ce,$e=ze||ve.i!=2,rt=ve.i;ze&&(Ce=new ma(3*Ue));var We,et,He=function(ed){var td=Ce.length;if(ed>td){var Eh=new ma(Math.max(2*td,ed));Eh.set(Ce),Ce=Eh}},tt=ve.f||0,st=ve.p||0,nt=ve.b||0,Mt=ve.l,ot=ve.d,dt=ve.m,Nt=ve.n,Ft=8*Ue;do{if(!Mt){tt=ns(he,st,1);var Pt=ns(he,st+1,3);if(st+=3,!Pt){var ct=he[(Ei=4+((st+7)/8|0))-4]|he[Ei-3]<<8,Vt=Ei+ct;if(Vt>Ue){rt&&rs(0);break}$e&&He(nt+ct),Ce.set(he.subarray(Ei,Vt),nt),ve.b=nt+=ct,ve.p=st=8*Vt,ve.f=tt;continue}if(Pt==1)Mt=nR,ot=rR,dt=9,Nt=5;else if(Pt==2){var oi=ns(he,st,31)+257,Zt=ns(he,st+10,15)+4,di=oi+ns(he,st+5,31)+1;st+=14;for(var ai=new ma(di),_i=new ma(19),qt=0;qt<Zt;++qt)_i[eR[qt]]=ns(he,st+3*qt,7);st+=3*Zt;var rn=rx(_i),nn=(1<<rn)-1,Ni=Nf(_i,rn,1);for(qt=0;qt<di;){var Ei,Vi=Ni[ns(he,st,nn)];if(st+=15&Vi,(Ei=Vi>>4)<16)ai[qt++]=Ei;else{var gn=0,hn=0;for(Ei==16?(hn=3+ns(he,st,3),st+=2,gn=ai[qt-1]):Ei==17?(hn=3+ns(he,st,7),st+=3):Ei==18&&(hn=11+ns(he,st,127),st+=7);hn--;)ai[qt++]=gn}}var Ln=ai.subarray(0,oi),On=ai.subarray(oi);dt=rx(Ln),Nt=rx(On),Mt=Nf(Ln,dt,1),ot=Nf(On,Nt,1)}else rs(1);if(st>Ft){rt&&rs(0);break}}$e&&He(nt+131072);for(var $r=(1<<dt)-1,Vn=(1<<Nt)-1,Tn=st;;Tn=st){var sr=(gn=Mt[ox(he,st)&$r])>>4;if((st+=15&gn)>Ft){rt&&rs(0);break}if(gn||rs(2),sr<256)Ce[nt++]=sr;else{if(sr==256){Tn=st,Mt=null;break}var Dr=sr-254;sr>264&&(Dr=ns(he,st,(1<<(_o=NS[qt=sr-257]))-1)+HS[qt],st+=_o);var Ar=ot[ox(he,st)&Vn],mn=Ar>>4;if(Ar||rs(3),st+=15&Ar,On=iR[mn],mn>3){var _o=VS[mn];On+=ox(he,st)&(1<<_o)-1,st+=_o}if(st>Ft){rt&&rs(0);break}$e&&He(nt+131072);var Al=nt+Dr;if(nt<On){var Aa=0-On,as=Math.min(On,Al);for(Aa+nt<0&&rs(3);nt<as;++nt)Ce[nt]=(void 0)[Aa+nt]}for(;nt<Al;++nt)Ce[nt]=Ce[nt-On]}}ve.l=Mt,ve.p=Tn,ve.b=nt,ve.f=tt,Mt&&(tt=1,ve.m=dt,ve.d=ot,ve.n=Nt)}while(!tt);return nt!=Ce.length&&ze?(We=Ce,((et=nt)==null||et>We.length)&&(et=We.length),new ma(We.subarray(0,et))):Ce.subarray(0,nt)}(J.subarray(ee,-8),{i:2},new ma(((B=J)[(W=B.length)-4]|B[W-3]<<8|B[W-2]<<16|B[W-1]<<24)>>>0))));var B,W,J,ee;let te=lR[F];if(!te)throw new Error(`Unhandled codec: ${F}`);let me=new globalThis.DecompressionStream(te);return new Response(new Blob([R]).stream().pipeThrough(me)).arrayBuffer().then(he=>new Uint8Array(he))}(T,M).then(R=>{let F=is.read(new im(R));if(F.values==="uint32_values")return F.uint32_values.readValuesInto(E),new hR[p](E.buffer);throw new Error(`Unhandled numeric data "${F.values}"`)}),P.then(R=>{for(let F=w.length-1;F>=0;F--)switch(w[F]){case"delta_filter":XO(R,b);break;case"zigzag_filter":QO(R);break;case"bitshuffle_filter":KO(R,p);break;default:throw new Error(`Unhandled filter "${w[F]}"`)}return{layerName:a,blockIndex:y,data:R}}).catch(R=>{throw R})}))};class qS extends C0{constructor(e,n,a,c,m){super(e,n,a,c,m),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){let a=n.context,c=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Ea?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new Ea(a,e,c.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){let a=this._mrt=new ax(30),c=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=dl(c,(m,p,b,y)=>{if(m)n(m);else try{let w=a.getHeaderLength(p);if(w>e)return void(this.request=this.fetchHeader(w,n));a.parseHeader(p),this._isHeaderLoaded=!0;let M=0;for(let T of Object.values(a.layers))M=Math.max(M,T.dataIndex[T.dataIndex.length-1].last_byte);p.byteLength>=M&&(this.entireBuffer=p),n(null,this.entireBuffer||p,b,y)}catch(w){n(w)}}),this.request}fetchBand(e,n,a){let c=this._mrt;if(!this._isHeaderLoaded||!c)return void a(new Error("Tile header is not ready"));let m=this.actor;if(!m)return void a(new Error("Can't fetch tile band without an actor"));let p,b=(T,E)=>{p.complete(T,E),T?a(T):(this.updateTextureDescriptor(e,n),a(null,this.textureDescriptor&&this.textureDescriptor.img))},y=(T,E)=>{if(T)return a(T);let P=m.send("decodeRasterArray",{buffer:E,task:p},b,void 0,!0);this._workQueue.push(()=>{P&&P.cancel(),p.cancel()})},w=c.getLayer(e);if(!w)return void a(new Error(`Unknown sourceLayer "${e}"`));if(w.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void a(null,this.textureDescriptor?this.textureDescriptor.img:null);let M=w.getDataRange([n]);if(p=c.createDecodingTask(M),!p||p.tasks.length)if(this.flushQueues(),this.entireBuffer)y(null,this.entireBuffer.slice(M.firstByte,M.lastByte+1));else{let T=Object.assign({},this.requestParams,{headers:{Range:`bytes=${M.firstByte}-${M.lastByte}`}}),E=dl(T,y);this._fetchQueue.push(()=>{E.cancel(),p.cancel()})}else a(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,n){if(!this._mrt)return;let a=this._mrt.getLayer(e);if(!a||!a.hasBand(n)||!a.hasDataForBand(n))return;let{bytes:c,tileSize:m,buffer:p,offset:b,scale:y}=a.getBandView(n),w=m+2*p,M={data:c,width:w,height:w},T=this.texture;T&&T instanceof Ea&&T.update(M,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:M,buffer:p,offset:b,tileSize:m,format:a.pixelFormat,mix:[y,256*y,65536*y,16777216*y]}}}class mR{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){let c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);let m={value:n,timeout:void 0};if(a!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},a)),this.data[c].push(m),this.order.push(c),this.order.length>this.max){let p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let a=e.wrapped().key,c=n===void 0?0:this.data[a].indexOf(n),m=this.data[a][c];return this.data[a].splice(c,1),m.timeout&&clearTimeout(m.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(m.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let a in this.data)for(let c of this.data[a])e(c.value)||n.push(c);for(let a of n)this.remove(a.value.tileID,a)}}class Mh extends ul{constructor(e,n,a){super(),this.id=e,this._onlySymbols=a,n.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new mR(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new gO,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return zo(this._tiles).map(e=>e.tileID).sort($S).map(e=>e.key)}getRenderableIds(e,n){let a=[];for(let c in this._tiles)this._isIdRenderable(+c,e,n)&&a.push(this._tiles[c]);return e?a.sort((c,m)=>{let p=c.tileID,b=m.tileID,y=new yt(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),w=new yt(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-b.overscaledZ||w.y-y.y||w.x-y.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort($S).map(c=>c.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,e,n)))}_tileLoaded(e,n,a,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new wu(c,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new Jr("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=kr.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Jr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let c=0;c<n.length;c++){let m=n[c];if(e.neighboringTiles&&e.neighboringTiles[m]){let p=this.getTileByID(m);a(e,p),a(p,e)}}function a(c,m){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let p=m.tileID.canonical.x-c.tileID.canonical.x,b=m.tileID.canonical.y-c.tileID.canonical.y,y=Math.pow(2,c.tileID.canonical.z),w=m.tileID.key;p===0&&b===0||Math.abs(b)>1||(Math.abs(p)>1&&(Math.abs(p+y)===1?p+=y:Math.abs(p-y)===1&&(p-=y)),m.dem&&c.dem&&(c.dem.backfillBorder(m.dem,p,b),c.neighboringTiles&&c.neighboringTiles[w]&&(c.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,c){for(let m in this._tiles){let p=this._tiles[m];if(c[m]||!p.hasData()||p.tileID.overscaledZ<=n||p.tileID.overscaledZ>a)continue;let b=p.tileID;for(;p&&p.tileID.overscaledZ>n+1;){let w=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[w.key],p&&p.hasData()&&(b=w)}let y=b;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){c[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){let c=e.scaledTo(a),m=this._getLoadedTile(c);if(m)return m}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let a=Math.ceil(e.width/n)+1,c=Math.ceil(e.height/n)+1,m=Math.floor(a*c*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(b)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let a={};for(let c in this._tiles){let m=this._tiles[c];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),a[m.tileID.key]=m}this._tiles=a;for(let c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(let c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,n,a,c){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let m;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)m=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new dr(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y));else if(this.tileCoverLift!==0){let y=e.clone();y.tileCoverLift=this.tileCoverLift,m=y.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(m.push(new dr(1,0,1,0,0)),m.push(new dr(1,0,1,1,0)),m.push(new dr(1,0,1,0,1)),m.push(new dr(1,0,1,1,1)))}else if(m=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let y=this._source.hasTile.bind(this._source);m=m.filter(w=>y(w))}}else m=[];if(m.length>0&&this.castsShadows&&c&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!sx(this._source.type)){let y=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),w=Math.min(y,this._source.maxzoom),M=e.extendTileCoverForShadows(m,c,w);for(let T of M)this._shadowCasterTiles[T.key]=!0,m.push(T)}let p=this._updateRetainedTiles(m);if(sx(this._source.type)&&m.length!==0){let y={},w={},M=Object.keys(p);for(let E of M){let P=p[E],R=this._tiles[E];if(!R||R.fadeEndTime&&R.fadeEndTime<=kr.now())continue;let F=this.findLoadedParent(P,Math.max(P.overscaledZ-Mh.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),y[F.tileID.key]=F.tileID),w[E]=P}let T=m[m.length-1].overscaledZ;for(let E in this._tiles){let P=this._tiles[E];if(p[E]||!P.hasData())continue;let R=P.tileID;for(;R.overscaledZ>T;){R=R.scaledTo(R.overscaledZ-1);let F=this._tiles[R.key];if(F&&F.hasData()&&w[R.key]){p[E]=P.tileID;break}}}for(let E in y)p[E]||(this._coveredTiles[E]=!0,p[E]=y[E])}for(let y in p)this._tiles[y].clearFadeHold();let b=function(y,w){let M=[];for(let T in y)T in w||M.push(T);return M}(this._tiles,p);for(let y of b){let w=this._tiles[y];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let a={},c=e.reduce((w,M)=>Math.min(w,M.overscaledZ),1/0),m=e[0].overscaledZ,p=Math.max(m-Mh.maxOverzooming,this._source.minzoom),b=Math.max(m+Mh.maxUnderzooming,this._source.minzoom),y={};for(let w of e){let M=this._addTile(w);n[w.key]=w,M.hasData()||c<this._source.maxzoom&&(y[w.key]=w)}this._retainLoadedChildren(y,c,b,n);for(let w of e){let M=this._tiles[w.key];if(M.hasData())continue;if(w.canonical.z>=this._source.maxzoom){let E=w.children(this._source.maxzoom)[0],P=this.getTile(E);if(P&&P.hasData()){n[E.key]=E;continue}}else{let E=w.children(this._source.maxzoom);if(n[E[0].key]&&n[E[1].key]&&n[E[2].key]&&n[E[3].key])continue}let T=M.wasRequested();for(let E=w.overscaledZ-1;E>=p;--E){let P=w.scaledTo(E);if(a[P.key]||(a[P.key]=!0,M=this.getTile(P),!M&&T&&(M=this._addTile(P)),M&&(n[P.key]=P,T=M.wasRequested(),M.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],a,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}n.push(c.key);let m=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(m),a)break;c=m}for(let m of n)this._loadedParentTiles[m]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let a=!!n;if(!a){let c=this.map?this.map.painter:null,m=this._source.tileSize*e.overscaleFactor();n=this._source.type==="raster-array"?new qS(e,m,this.transform.tileZoom,c,this._isRaster):new C0(e,m,this.transform.tileZoom,c,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,a||this._source.fire(new Jr("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,a){let c=[],m=this.transform;if(!m)return c;let p=m.projection.name==="globe",b=Ls(m.center.lng);for(let y in this._tiles){let w=this._tiles[y];if(a&&w.clearQueryDebugViz(),w.holdingForFade())continue;let M;if(p){let T=w.tileID.canonical;if(T.z===0){let E=[Math.abs(pi(b,...jf(T,-1))-b),Math.abs(pi(b,...jf(T,1))-b)];M=[0,2*E.indexOf(Math.min(...E))-1]}else{let E=[Math.abs(pi(b,...jf(T,-1))-b),Math.abs(pi(b,...jf(T,0))-b),Math.abs(pi(b,...jf(T,1))-b)];M=[E.indexOf(Math.min(...E))-1]}}else M=[0];for(let T of M){let E=e.containsTile(w,m,n,T);E&&c.push(E)}}return c}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let a=this.getRenderableIds(e,n).map(m=>this._tiles[m].tileID),c=this.transform.projection.name==="globe";for(let m of a)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=c?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return a}sortCoordinatesByDistance(e){let n=e.slice(),a=this.transform._camera.position,c=this.transform._camera.forward(),m={};for(let p of n){let b=1/(1<<p.canonical.z);m[p.key]=((p.canonical.x+.5)*b+p.wrap-a[0])*c[0]+((p.canonical.y+.5)*b-a[1])*c[1]-a[2]*c[2]}return n.sort((p,b)=>m[p.key]-m[b.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(sx(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=kr.now())return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){let c=this._tiles[e];c&&c.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(let a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(e,n))};return void this._source.on("data",b)}let a=new Map,c=Array.isArray(e)?e:[e],m=this.map.painter.terrain,p=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(let b of c){let y=b.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let w of y)a.set(w.key,w);this.usedForTerrain&&b.updateElevation(!1)}hc(Array.from(a.values()),(b,y)=>{let w=new C0(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,M=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),y(M,w)})},n)}}function $S(t,e){let n=Math.abs(2*t.wrap)-+(t.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||a-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function sx(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function jf(t,e){let n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}Mh.maxOverzooming=10,Mh.maxUnderzooming=3;let YS=new class extends wt{possiblyEvaluate(t,e){return e=new Qt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,a){return e=Nr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,a)}}(o0.paint.properties["line-width"].specification);function ZS(t,e){return e>0?e+2*t:t}YS.useIntegerZoom=!0;let pR=new Wi({"symbol-placement":new Ke(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ke(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ke(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wt(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ke(Pe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ke(Pe.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Ke(Pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ke(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ke(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ke(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new wt(Pe.layout_symbol["icon-size"]),"icon-text-fit":new wt(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wt(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new wt(Pe.layout_symbol["icon-image"]),"icon-rotate":new wt(Pe.layout_symbol["icon-rotate"]),"icon-padding":new Ke(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ke(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new wt(Pe.layout_symbol["icon-offset"]),"icon-anchor":new wt(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ke(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ke(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ke(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new wt(Pe.layout_symbol["text-field"]),"text-font":new wt(Pe.layout_symbol["text-font"]),"text-size":new wt(Pe.layout_symbol["text-size"]),"text-max-width":new wt(Pe.layout_symbol["text-max-width"]),"text-line-height":new wt(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new wt(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new wt(Pe.layout_symbol["text-justify"]),"text-radial-offset":new wt(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ke(Pe.layout_symbol["text-variable-anchor"]),"text-anchor":new wt(Pe.layout_symbol["text-anchor"]),"text-max-angle":new Ke(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ke(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new wt(Pe.layout_symbol["text-rotate"]),"text-padding":new Ke(Pe.layout_symbol["text-padding"]),"text-keep-upright":new Ke(Pe.layout_symbol["text-keep-upright"]),"text-transform":new wt(Pe.layout_symbol["text-transform"]),"text-offset":new wt(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new Ke(Pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ke(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new Ke(Pe.layout_symbol["text-optional"]),visibility:new Ke(Pe.layout_symbol.visibility)});var lx={paint:new Wi({"icon-opacity":new wt(Pe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new wt(Pe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new wt(Pe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new wt(Pe.paint_symbol["text-emissive-strength"]),"icon-color":new wt(Pe.paint_symbol["icon-color"]),"icon-halo-color":new wt(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new wt(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wt(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ke(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ke(Pe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new wt(Pe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new wt(Pe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new wt(Pe.paint_symbol["text-occlusion-opacity"]),"text-color":new wt(Pe.paint_symbol["text-color"],{runtimeType:eo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new wt(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new wt(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new wt(Pe.paint_symbol["text-halo-blur"]),"text-translate":new Ke(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new Ke(Pe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ke(Pe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ke(Pe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ke(Pe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ke(Pe.paint_symbol["icon-color-brightness-max"])}),layout:pR};class XS{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:xc,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ne(XS,"FormatSectionOverride",{omit:["defaultValue"]});class S0 extends cr{constructor(e,n,a,c){super(e,lx,n,a,c),this._colorAdjustmentMatrix=i.ad.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let a=this.layout.get("text-writing-mode");if(a){let c=[];for(let m of a)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,a,c){return this._saturation===e&&this._contrast===n&&this._brightnessMin===a&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(m,p,b,y){m=uu(m),p=hu(p);let w=i.ad.create(),M=m/3,T=1-2*M,E=[T,M,M,0,M,T,M,0,M,M,T,0,0,0,0,1],P=.5-.5*p,R=y-b;return i.ad.multiply(w,[R,0,0,0,0,R,0,0,0,0,R,0,b,b,b,1],[p,0,0,0,0,p,0,0,0,0,p,0,P,P,P,1]),i.ad.multiply(w,w,E),w}(e,n,a,c),this._saturation=e,this._contrast=n,this._brightnessMin=a,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,a,c){let m=this.layout.get(e).evaluate(n,{},a,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||z(p.value)||!m?m:function(b,y){return y.replace(/{([^{}]+)}/g,(w,M)=>M in b?String(b[M]):"")}(n.properties,m)}createBucket(e){return new cm(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of lx.paint.overridableProperties){if(!S0.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),a=new XS(n),c=new L(a,n.property.specification,this.scope,this.options),m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new H("source",c):new $("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new yn(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&S0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let a=e.get("text-field"),c=lx.paint.properties[n],m=!1,p=b=>{for(let y of b)if(c.overrides&&c.overrides.hasOverride(y))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Vr)p(a.value.value.sections);else if(a.value.kind==="source"){let b=w=>{m||(w instanceof qa&&ar(w.value)===Cc?p(w.value.sections):w instanceof Kd?p(w.sections):w.eachChild(b))},y=a.value;y._styleExpression&&b(y._styleExpression.expression)}return m}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),n&&a.push("symbolSDF"),a}getDefaultProgramParams(e,n,a){return{config:new bh(this,{zoom:n,lut:a}),overrideFog:!1}}}let fR=new Wi({visibility:new Ke(Pe.layout_background.visibility)});var gR={paint:new Wi({"background-color":new Ke(Pe.paint_background["background-color"]),"background-pattern":new Ke(Pe.paint_background["background-pattern"]),"background-opacity":new Ke(Pe.paint_background["background-opacity"]),"background-emissive-strength":new Ke(Pe.paint_background["background-emissive-strength"])}),layout:fR};let _R=new Wi({visibility:new Ke(Pe.layout_raster.visibility)});var bR={paint:new Wi({"raster-opacity":new Ke(Pe.paint_raster["raster-opacity"]),"raster-color":new Dn(Pe.paint_raster["raster-color"]),"raster-color-mix":new Ke(Pe.paint_raster["raster-color-mix"]),"raster-color-range":new Ke(Pe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ke(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ke(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ke(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ke(Pe.paint_raster["raster-saturation"]),"raster-contrast":new Ke(Pe.paint_raster["raster-contrast"]),"raster-resampling":new Ke(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ke(Pe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ke(Pe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ke(Pe.paint_raster["raster-array-band"]),"raster-elevation":new Ke(Pe.paint_raster["raster-elevation"])}),layout:_R};function M0(t,e,n,a,c,m,p,b){let y=[t,e,1,n,a,1,c,m,1],w=[p,b,1],M=i.bC.adjoint([],y),[T,E,P]=i._.transformMat3(w,w,M);return i.bC.multiply(y,y,[T,0,0,0,E,0,0,0,P])}function QS(t,e,n,a,c,m,p,b){let y=function(w,M,T,E,P,R,F,B){let W=M0(0,0,1,0,1,1,0,1),J=M0(w,M,T,E,P,R,F,B),ee=i.bC.adjoint([],W);return i.bC.multiply(J,J,ee)}(t,e,n,a,c,m,p,b);return[y[2]/y[8]/pt,y[5]/y[8]/pt]}function k0(t){return[t[0],Math.min(Math.max(t[1],-Yn),Yn)]}class KS extends ul{constructor(e,n,a,c){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Jr("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ms(this.map._requestManager.transformRequest(this.url,_u.Image),(a,c)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new wu(a)):c&&(this.image=c instanceof HTMLImageElement?kr.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new v0(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Jr("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof v0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],a=e[0][1];for(let m of e)m[1]>a&&(a=m[1]),m[1]<n&&(n=m[1]);let c=(a+n)/2;if(c>Yn?this.onNorthPole=!0:c<-Yn&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let m=e.map(qr.fromLngLat);this.tileID=function(p){let b=1/0,y=1/0,w=-1/0,M=-1/0;for(let F of p)b=Math.min(b,F.x),y=Math.min(y,F.y),w=Math.max(w,F.x),M=Math.max(M,F.y);let T=Math.max(w-b,M-y),E=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),P=Math.pow(2,E),R=Math.floor((b+w)/2*P);return R>1&&(R-=1),new vh(E,R,Math.floor((y+M)/2*P))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Jr("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let B in this.tiles){let W=this.tiles[B];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=Sh(new vh(0,0,0),this.map.transform.projection),a=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(B){let W=B[1].x-B[0].x,J=B[1].y-B[0].y,ee=B[2].x-B[1].x,te=B[2].y-B[1].y,me=B[3].x-B[2].x,he=B[3].y-B[2].y,ve=B[0].x-B[3].x,Ce=B[0].y-B[3].y,De=W*te-ee*J,Ue=ee*he-me*te,ze=me*Ce-ve*he,$e=ve*J-W*Ce;return De>0&&Ue>0&&ze>0&&$e>0||De<0&&Ue<0&&ze<0&&$e<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let c=Sh(this.tileID,this.map.transform.projection),[m,p,b,y]=this.coordinates.map(B=>{let W=c.projection.project(B[0],B[1]);return AS(c,W)._round()});this.perspectiveTransform=QS(m.x,m.y,p.x,p.y,b.x,b.y,y.x,y.y);let w=this._boundsArray=new Lc;w.emplaceBack(m.x,m.y,0,0),w.emplaceBack(p.x,p.y,pt,0),w.emplaceBack(y.x,y.y,0,pt),w.emplaceBack(b.x,b.y,pt,pt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,w0.members),this.boundsSegments=An.simpleSegment(0,0,4,2);let M=[],T=function(B){return[k0(B[0]),k0(B[1]),k0(B[2]),k0(B[3])]}(this.coordinates),[E,P,R,F]=function(B){let W=B[0][0],J=W,ee=B[0][1],te=ee;for(let me=1;me<B.length;me++)B[me][0]<W?W=B[me][0]:B[me][0]>J&&(J=B[me][0]),B[me][1]<ee?ee=B[me][1]:B[me][1]>te&&(te=B[me][1]);return[W,ee,J-W,te-ee]}(T);{let B=new Lc,[W,J,ee,te]=function(He){let tt=He[0].x,st=tt,nt=He[0].y,Mt=nt;for(let ot=1;ot<He.length;ot++)He[ot].x<tt?tt=He[ot].x:He[ot].x>st&&(st=He[ot].x),He[ot].y<nt?nt=He[ot].y:He[ot].y>Mt&&(Mt=He[ot].y);return[tt,nt,st-tt,Mt-nt]}(a),me=He=>[(He.x-W)/ee,(He.y-J)/te],[he,ve,Ce,De]=a.map(me),Ue=function(He,tt,st,nt,Mt,ot,dt,Nt){let Ft=M0(0,0,1,0,1,1,0,1),Pt=M0(He,tt,st,nt,Mt,ot,dt,Nt),ct=i.bC.adjoint([],Pt);return i.bC.multiply(Ft,Ft,ct)}(he[0],he[1],ve[0],ve[1],Ce[0],Ce[1],De[0],De[1]);this.elevatedGlobePerspectiveTransform=QS(he[0],he[1],ve[0],ve[1],Ce[0],Ce[1],De[0],De[1]);let ze=(He,tt)=>{M.push(He.lng);let st=Math.round((He.lng-E)/R*pt),nt=Math.round((He.lat-P)/F*pt),Mt=me(tt),ot=i._.transformMat3([],[Mt[0],Mt[1],1],Ue),dt=Math.round(ot[0]/ot[2]*pt),Nt=Math.round(ot[1]/ot[2]*pt);B.emplaceBack(st,nt,dt,Nt)},$e=a[3].x-a[0].x,rt=a[3].y-a[0].y,We=a[2].x-a[1].x,et=a[2].y-a[1].y;for(let He=0;He<65;He++){let tt=He/64,st=[a[0].x+tt*$e,a[0].y+tt*rt],nt=[a[1].x+tt*We,a[1].y+tt*et],Mt=nt[0]-st[0],ot=nt[1]-st[1];for(let dt=0;dt<65;dt++){let Nt=dt/64,Ft={x:st[0]+Mt*Nt,y:st[1]+ot*Nt,z:0};ze(n.projection.unproject(Ft.x,Ft.y),Ft)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(B,w0.members)}{this.maxLongitudeTriangleSize=0;let B=[],W=new wr,J=(ee,te,me)=>{W.emplaceBack(ee,te,me);let he=M[ee],ve=M[te],Ce=M[me],De=Math.min(Math.min(he,ve),Ce),Ue=Math.max(Math.max(he,ve),Ce)-De;Ue>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ue),B.push(De+Ue/2)};for(let ee=0;ee<64;ee++)for(let te=0;te<64;te++){let me=65*ee+te,he=me+1,ve=me+65,Ce=ve+1;J(me,ve,he),J(he,ve,Ce)}[B,W]=function(ee,te){let me=Array.from({length:ee.length},(Ce,De)=>De);me.sort((Ce,De)=>ee[Ce]-ee[De]);let he=[],ve=new wr;for(let Ce=0;Ce<me.length;Ce++){let De=me[Ce];he.push(ee[De]);let Ue=3*De,ze=Ue+1;ve.emplaceBack(te.uint16[Ue],te.uint16[ze],te.uint16[ze+1])}return[he,ve]}(B,W),this.elevatedGlobeTrianglesCenterLongitudes=B,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(W)}this.elevatedGlobeSegments=An.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/pt,0,F/pt,0,0,P,E,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,a=n.gl;!this._dirty||this.texture instanceof v0||(this.texture?this.texture.update(this.image):(this.texture=new Ea(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let a=this.elevatedGlobeTrianglesCenterLongitudes,c=(m=e+180)+360*Math.round((a[0]-m)/360);var m;let p=new An,b=(T,E)=>{p.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:n.segments[0].vertexLength,primitiveLength:E,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-c)<=y){let T=jg(a,0,a.length,c+y);return T===a.length||b(T,vp(a,T+1,a.length,c+360-y)-T),p}c<a[0]&&(c+=360);let w=vp(a,0,a.length,c-y);if(w===a.length)return b(0,a.length),p;b(0,w-0);let M=jg(a,w+1,a.length,c+y);return M!==a.length&&b(M,a.length-M),p}}let yR=(Math.pow(256,2)-1)/16907520;class JS extends cr{constructor(e,n,a,c){super(e,bR,n,a,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof KS&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[a,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(c)||a===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=wf({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,c])}}let vR=new Wi({visibility:new Ke(Pe["layout_raster-particle"].visibility)});var xR={paint:new Wi({"raster-particle-array-band":new Ke(Pe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ke(Pe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Dn(Pe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ke(Pe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ke(Pe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ke(Pe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ke(Pe["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:vR};class eM extends cr{constructor(e,n,a,c){super(e,xR,n,a,c),this._updateColorRamp(),this.lastInvalidatedAt=kr.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=wf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=kr.now()}}class wR extends cr{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let CR=new Wi({visibility:new Ke(Pe.layout_sky.visibility)});var SR={paint:new Wi({"sky-type":new Ke(Pe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ke(Pe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ke(Pe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ke(Pe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ke(Pe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Dn(Pe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ke(Pe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ke(Pe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ke(Pe.paint_sky["sky-opacity"])}),layout:CR};function cx(t,e,n){let a=[0,0,1],c=i.av.identity([]);return i.av.rotateY(c,c,n?-Ti(t)+Math.PI:Ti(t)),i.av.rotateX(c,c,-Ti(e)),i._.transformQuat(a,a,c),i._.normalize(a,a)}var MR={paint:new Wi({})};function tM(t,e){let n=T0(t.projection,t.zoom,t.width,t.height),a=function(m,p,b,y,w){let M=new Oi(b.lng-180*Jc,b.lat),T=new Oi(b.lng+180*Jc,b.lat),E=m.project(M.lng,M.lat),P=m.project(T.lng,T.lat),R=-Math.atan2(P.y-E.y,P.x-E.x),F=qr.fromLngLat(b);F.y=pi(F.y,-1+Jc,1-Jc);let B=F.toLngLat(),W=m.project(B.lng,B.lat),J=qr.fromLngLat(B);J.x+=Jc;let ee=J.toLngLat(),te=m.project(ee.lng,ee.lat),me=rM(te.x-W.x,te.y-W.y,R),he=qr.fromLngLat(B);he.y+=Jc;let ve=he.toLngLat(),Ce=m.project(ve.lng,ve.lat),De=rM(Ce.x-W.x,Ce.y-W.y,R),Ue=Math.abs(me.x)/Math.abs(De.y),ze=i.ad.identity([]);i.ad.rotateZ(ze,ze,-R*(1-(w?0:y)));let $e=i.ad.identity([]);return i.ad.scale($e,$e,[1,1-(1-Ue)*y,1]),$e[4]=-De.x/De.y*y,i.ad.rotateZ($e,$e,R),i.ad.multiply($e,ze,$e),$e}(t.projection,0,t.center,n,e),c=iM(t);return i.ad.scale(a,a,[c,c,1]),a}function iM(t){let e=t.projection,n=T0(t.projection,t.zoom,t.width,t.height),a=nM(e,t.center),c=nM(e,Oi.convert(e.center));return Math.pow(2,a*n+(1-n)*c)}function T0(t,e,n,a,c=1/0){let m=t.range;if(!m)return 0;let p=Math.min(c,Math.max(n,a)),b=Math.log(p/1024)/Math.LN2;return al(m[0]+b,m[1]+b,e)}let Jc=1/4e4;function nM(t,e){let n=pi(e.lat,-Yn,Yn),a=new Oi(e.lng-180*Jc,n),c=new Oi(e.lng+180*Jc,n),m=t.project(a.lng,n),p=t.project(c.lng,n),b=qr.fromLngLat(a),y=qr.fromLngLat(c),w=p.x-m.x,M=p.y-m.y,T=y.x-b.x,E=y.y-b.y,P=Math.sqrt((T*T+E*E)/(w*w+M*M));return Math.log(P)/Math.LN2}function rM(t,e,n){let a=Math.cos(n),c=Math.sin(n);return{x:t*a-e*c,y:t*c+e*a}}function oM(t,e,n){i.ad.identity(t),i.ad.rotateZ(t,t,Ti(e[2])),i.ad.rotateX(t,t,Ti(e[0])),i.ad.rotateY(t,t,Ti(e[1])),i.ad.scale(t,t,n),i.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function I0(t,e,n,a,c,m,p,b){let y=[n[0]-e[0],n[1]-e[1],0],w=[a[0]-e[0],a[1]-e[1],0];if(i._.length(y)<1e-12||i._.length(w)<1e-12)return i.av.identity(t);let M=i._.cross([],y,w);i._.normalize(M,M),i._.subtract(w,a,e),y[2]=(m-c)*b,w[2]=(p-c)*b;let T=y;return i._.cross(T,y,w),i._.normalize(T,T),i.av.rotationTo(t,M,T)}function dx(t,e,n=!1){let a=Il(e.zoom),c=function(m,p,b){let y=p.worldSize,w=[m[12],m[13],m[14]],M=Er(w[1]/y),T=Ao(w[0]/y),E=i.ad.identity([]),P=go(1,M)*y,R=go(1,0)*y*xh(M,p.zoom),F=1/Iv(y),B=R*F;if(b){let te=T0(p.projection,p.zoom,p.width,p.height,1024);B=F*p.projection.pixelSpaceConversion(p.center.lat,y,te)}let W=yh(M,T);i._.add(W,W,i._.scale([],i._.normalize([],W),P*B*w[2]));let J=function(te){let me=[te[0],te[1],te[2]],he=[0,1,0],ve=i._.cross([],he,me);return i._.cross(he,me,ve),i._.squaredLength(he)===0&&(he=[0,1,0],i._.cross(ve,me,he)),i._.normalize(ve,ve),i._.normalize(he,he),i._.normalize(me,me),[ve[0],ve[1],ve[2],0,he[0],he[1],he[2],0,me[0],me[1],me[2],0,te[0],te[1],te[2],1]}(W);i.ad.scale(E,E,[B,B,B*P]),i.ad.translate(E,E,[-w[0],-w[1],-w[2]]);let ee=i.ad.multiply([],p.globeMatrix,J);return i.ad.multiply(ee,ee,E),i.ad.multiply(ee,ee,m),ee}(t,e,n);if(a>0){let m=function(p,b){let y=b.worldSize,w=go(1,0)*y*xh(b.center.lat,b.zoom)/Iv(y),M=go(1,b.center.lat)*y,T=i.ad.identity([]);return i.ad.rotateY(T,T,Ti(b.center.lng)),i.ad.rotateX(T,T,Ti(b.center.lat)),i.ad.translate(T,T,[0,0,fo]),i.ad.scale(T,T,[w,w,w*M]),i.ad.translate(T,T,[b.point.x-.5*y,b.point.y-.5*y,0]),i.ad.multiply(T,T,p),i.ad.multiply(T,b.globeMatrix,T)}(t,e);return function(p,b,y){let w=(R,F,B)=>{let W=i._.length(R),J=i._.length(F),ee=Tl(R,F,B);return i._.scale(ee,ee,1/i._.length(ee)*Wt(W,J,B))},M=w([p[0],p[1],p[2]],[b[0],b[1],b[2]],y),T=w([p[4],p[5],p[6]],[b[4],b[5],b[6]],y),E=w([p[8],p[9],p[10]],[b[8],b[9],b[10]],y),P=Tl([p[12],p[13],p[14]],[b[12],b[13],b[14]],y);return[M[0],M[1],M[2],0,T[0],T[1],T[2],0,E[0],E[1],E[2],0,P[0],P[1],P[2],1]}(c,m,a)}return c}function aM(t,e,n,a){let c=Pn.projectAabbCorners(a,n),m=Number.MAX_VALUE,p=-1;for(let w=0;w<c.length;++w){let M=c[w];M[0]=(.5*M[0]+.5)*e.width,M[1]=(.5-.5*M[1])*e.height,M[2]<m&&(p=w,m=M[2])}let b=w=>new yt(c[w][0],c[w][1]),y;switch(p){case 0:case 6:y=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:y=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:y=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:y=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(bv(t,y))return m}let kR=Gi([{name:"a_pos_3f",components:3,type:"Float32"}]),TR=Gi([{name:"a_color_3f",components:3,type:"Float32"}]),IR=Gi([{name:"a_color_4f",components:4,type:"Float32"}]),ER=Gi([{name:"a_uv_2f",components:2,type:"Float32"}]),DR=Gi([{name:"a_normal_3f",components:3,type:"Float32"}]),AR=Gi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),PR=Gi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class E0{constructor(e,n,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function sM(t,e){let n=t.indexOf("://")===-1;try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class lM{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class cM{constructor(){this.instancedDataArray=new tv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class hx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,a,c){this.tileToMeter=B_(a);let m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:b,index:y,sourceLayerIndex:w}of e){let M=b??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),T=kl(p,m);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),T,a))continue;let E={id:M,sourceLayerIndex:w,index:y,geometry:m?T.geometry:Ka(p,a,c),properties:p.properties,type:p.type,patterns:{}},P=this.addFeature(E,E.geometry,T);P&&n.featureIndex.insert(p,E.geometry,y,w,this.index,this.instancesPerModel[P].instancedDataArray.length,pt/32)}this.lookup=null}update(e,n,a,c){for(let m in this.instancesPerModel){let p=this.instancesPerModel[m];for(let b in e)p.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(p.features[p.idToFeaturesIndex[b]],e[b],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];for(let c of a.features){let m=this.layers[0],p=c.feature,b=this.canonical,y=m.paint.get("model-rotation").evaluate(p,{},b),w=m.paint.get("model-scale").evaluate(p,{},b),M=m.paint.get("model-translation").evaluate(p,{},b);i._.exactEquals(c.rotation,y)&&i._.exactEquals(c.scale,w)&&i._.exactEquals(c.translation,M)||(this.evaluate(c,c.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let c=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Bv(this.activeReplacements,c))return!1;this.activeReplacements=c;let m=!1;for(let p in this.instancesPerModel){let b=this.instancesPerModel[p],y=b.instancedDataArray;for(let w of b.features){let M=w.instancedDataOffset,T=w.instancedDataCount;for(let E=0;E<T;E++){let P=16*(E+M),R=y.float32[P+0];R=R>pt?R-pt:R;let F=Math.floor(R),B=y.float32[P+1],W=!1;for(let J of this.activeReplacements)if(!(J.order<a||J.order===1/0)&&J.clipMask&I2.Model&&!(J.min.x>F||F>J.max.x||J.min.y>B||B>J.max.y)&&(W=v2(y2(F,B,e.canonical,J.footprintTileId.canonical),J),W))break;y.float32[P]=W?R+pt:R,m=m||W}}}return m}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,AR.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,a){let c=this.layers[0],m=c.layout.get("model-id").evaluate(a,{},this.canonical);if(!m)return qn(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),m;sM(m,!1)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new cM);let p=this.instancesPerModel[m],b=p.instancedDataArray,y=new lM(a,b.length);for(let w of n)for(let M of w){if(M.x<0||M.x>=pt||M.y<0||M.y>=pt)continue;let T=(this.lookupDim-1)/pt,E=this.lookupDim*(M.y*T|0)+M.x*T|0;if(this.lookup){if(this.lookup[E]!==0)continue;this.lookup[E]=1}this.instanceCount++;let P=b.length;b.resize(P+1),p.instancesEvaluatedElevation.push(0),b.float32[16*P]=M.x,b.float32[16*P+1]=M.y}return y.instancedDataCount=p.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(y),this.evaluate(y,{},p,!1)),m}getModelUris(){return this.modelUris}evaluate(e,n,a,c){let m=this.layers[0],p=e.feature,b=this.canonical,y=e.rotation=m.paint.get("model-rotation").evaluate(p,n,b),w=e.scale=m.paint.get("model-scale").evaluate(p,n,b),M=e.translation=m.paint.get("model-translation").evaluate(p,n,b),T=m.paint.get("model-color").evaluate(p,n,b);T.a=m.paint.get("model-color-mix-intensity").evaluate(p,n,b);let E=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),oM(E,y,w);let P=Math.round(100*T.a)+T.b/1.05;for(let R=0;R<e.instancedDataCount;++R){let F=e.instancedDataOffset+R,B=16*F,W=a.instancedDataArray.float32,J=0;c&&(J=W[B+6]-a.instancesEvaluatedElevation[F]);let ee=0|W[B+1];W[B]=(0|W[B])+T.r/1.05,W[B+1]=ee+T.g/1.05,W[B+2]=P,W[B+3]=1/(b.z>10?this.tileToMeter:B_(b,ee)),W[B+4]=M[0],W[B+5]=M[1],W[B+6]=M[2]+J,W[B+7]=E[0],W[B+8]=E[1],W[B+9]=E[2],W[B+10]=E[4],W[B+11]=E[5],W[B+12]=E[6],W[B+13]=E[8],W[B+14]=E[9],W[B+15]=E[10],a.instancesEvaluatedElevation[F]=M[2]}}}ne(hx,"ModelBucket",{omit:["layers"]}),ne(cM,"PerModelAttributes"),ne(lM,"ModelFeature");let OR=new Wi({visibility:new Ke(Pe.layout_model.visibility),"model-id":new wt(Pe.layout_model["model-id"])});var RR={paint:new Wi({"model-opacity":new Ke(Pe.paint_model["model-opacity"]),"model-rotation":new wt(Pe.paint_model["model-rotation"]),"model-scale":new wt(Pe.paint_model["model-scale"]),"model-translation":new wt(Pe.paint_model["model-translation"]),"model-color":new wt(Pe.paint_model["model-color"]),"model-color-mix-intensity":new wt(Pe.paint_model["model-color-mix-intensity"]),"model-type":new Ke(Pe.paint_model["model-type"]),"model-cast-shadows":new Ke(Pe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ke(Pe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ke(Pe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new wt(Pe.paint_model["model-emissive-strength"]),"model-roughness":new wt(Pe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new wt(Pe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ke(Pe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ke(Pe.paint_model["model-front-cutoff"])}),layout:OR};let kh=64,um={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function dM(t,e,n,a,c,m,p,b,y,w=!1){let M=n.zoom,T=n.project(a),E=xh(a.lat,M),P=1/E;i.ad.identity(t),i.ad.translate(t,t,[T.x+p[0]*P,T.y+p[1]*P,p[2]]);let R=1,F=1,B=n.worldSize;if(w){if(n.projection.name==="mercator"){let te=0;n.elevation&&(te=n.elevation.getAtPointOrZero(new qr(T.x/B,T.y/B),0));let me=i.aA.transformMat4([],[T.x,T.y,te,1],n.projMatrix)[3]/n.cameraToCenterDistance;R=me,F=me*xh(n.center.lat,M)}else if(n.projection.name==="globe"){let te=dx(t,n),me=i.ad.multiply([],n.projMatrix,te),he=[0,0,0,1];i.aA.transformMat4(he,he,me);let ve=he[3]/n.cameraToCenterDistance,Ce=Il(M),De=n.projection.pixelsPerMeter(a.lat,B)*xh(a.lat,M),Ue=n.projection.pixelsPerMeter(n.center.lat,B)*xh(n.center.lat,M);R=ve/Wt(De,IC(n.center.lat),Ce),F=ve*E/De,R*=Ue,F*=Ue}}else R=P;i.ad.scale(t,t,[R,R,F]);let W=[...t],J=e.orientation,ee=[];if(oM(ee,[J[0]+c[0],J[1]+c[1],J[2]+c[2]],m),i.ad.multiply(t,W,ee),b&&n.elevation){let te=0,me=[];if(y&&n.elevation){te=function(Ce,De,Ue,ze,$e){let rt=De.elevation;if(!rt)return 0;let We=Pn.projectAabbCorners(Ue,ze),et=go(1,$e.lat)*De.worldSize,He=function(Vt,oi){let Zt=[0,0,1],di=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let ai of di){let _i=Vt[ai.corners[0]],qt=Vt[ai.corners[1]],rn=Vt[ai.corners[2]],nn=[qt[0]-_i[0],qt[1]-_i[1],oi*(qt[2]-_i[2])],Ni=i._.cross(nn,nn,[rn[0]-_i[0],rn[1]-_i[1],oi*(rn[2]-_i[2])]);i._.normalize(Ni,Ni),ai.dotProductWithUp=i._.dot(Ni,Zt)}return di.sort((ai,_i)=>ai.dotProductWithUp-_i.dotProductWithUp),di[0].corners}(We,et),tt=We[He[0]],st=We[He[1]],nt=We[He[2]],Mt=We[He[3]],ot=rt.getAtPointOrZero(new qr(tt[0]/De.worldSize,tt[1]/De.worldSize),0),dt=rt.getAtPointOrZero(new qr(st[0]/De.worldSize,st[1]/De.worldSize),0),Nt=rt.getAtPointOrZero(new qr(nt[0]/De.worldSize,nt[1]/De.worldSize),0),Ft=rt.getAtPointOrZero(new qr(Mt[0]/De.worldSize,Mt[1]/De.worldSize),0),Pt=(ot+Ft)/2,ct=(dt+Nt)/2;return Pt>ct?dt<Nt?I0(Ce,st,Mt,tt,dt,Ft,ot,et):I0(Ce,nt,tt,Mt,Nt,ot,Ft,et):ot<Ft?I0(Ce,tt,st,nt,ot,dt,Nt,et):I0(Ce,Mt,nt,st,Ft,Nt,dt,et),Math.max(Pt,ct)}(me,n,e.aabb,t,a);let he=i.ad.fromQuat([],me),ve=i.ad.multiply([],he,ee);i.ad.multiply(t,W,ve)}else te=n.elevation.getAtPointOrZero(new qr(T.x/B,T.y/B),0);te!==0&&(t[14]+=te)}}function Uf(t,e,n=!1){t.uploaded||(t.gfxTexture=new Ea(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function LR(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,kR.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,DR.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,ER.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?TR:IR).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,PR.members,!0)),t.segments=An.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let a=t.material;a.pbrMetallicRoughness.baseColorTexture&&Uf(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Uf(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Uf(a.normalTexture,e),a.occlusionTexture&&Uf(a.occlusionTexture,e,n),a.emissionTexture&&Uf(a.emissionTexture,e)}function ux(t,e,n){if(t.meshes)for(let a of t.meshes)LR(a,e,n);if(t.children)for(let a of t.children)ux(a,e,n)}function D0(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)D0(e)}function mx(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)mx(n)}class FR{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class zR{constructor(){this.tasks={},this.taskQueue=[],lu(["process"],this),this.invoker=new FR(this.process),this.nextId=0}add(e,n){let a=this.nextId++,c=function({type:m,isSymbolTile:p,zoom:b}){return b=b||0,m==="message"?0:m!=="maybePrepare"||p?m!=="parseTile"||p?m==="parseTile"&&p?300-b:m==="maybePrepare"&&p?400-b:500:200-b:100-b}(n);if(c===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:n,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){let m=this.tasks[this.taskQueue[c]];m.priority<n&&(n=m.priority,e=c)}if(e===null)return null;let a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class hM{constructor(e,n,a){this.target=e,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},lu(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new zR}send(e,n,a,c,m=!1,p){let b=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[b]=a);let y=new Set;return this.target.postMessage({id:b,type:e,hasCallback:!!a,targetMapId:c,mustQueue:m,sourceMapId:this.mapId,data:we(n,y)},y),{cancel:()=>{a&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){let n=e.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(n.mustQueue||Mr()){let c=this.callbacks[a],m=this.scheduler.add(()=>this.processTask(a,n),c&&c.metadata||{type:"message"});m&&(this.cancelCallbacks[a]=m)}else this.processTask(a,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let a=this.callbacks[e];delete this.callbacks[e],a&&(n.error?a(Oe(n.error)):a(null,Oe(n.data)))}else{let a=new Set,c=n.hasCallback?(p,b)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?we(p):null,data:we(b,a)},a)}:p=>{},m=Oe(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,m,c);else if(this.parent.getWorkerSource){let p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],m.source,m.scope)[p[1]](m,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let px=(()=>{class t{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=au();let c=this.workerPool.acquire(this.id);for(let m=0;m<c.length;m++){let p=new t.Actor(c[m],a,this.id);p.name=`Worker ${m}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,c){hc(this.actors,(m,p)=>{m.send(n,a,p)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=hM,t})();var Hf={workerUrl:"",workerClass:null,workerParams:void 0};function BR(){return Hf.workerClass!=null?new Hf.workerClass:new self.Worker(Hf.workerUrl,Hf.workerParams)}let fx="mapboxgl_preloaded_worker_pool";class Wf{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Wf.workerCount;)this.workers.push(new BR);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[fx]}numActive(){return Object.keys(this.active).length}}let Gf;function A0(){return Gf||(Gf=new Wf),Gf}Wf.workerCount=2;let P0,gx,os,mm,_x,pm=null;function uM(){return Mr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:gx||I.DRACO_URL}function mM(){if(Mr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(mm)return mm;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return mm=WebAssembly.validate(t)?I.MESHOPT_SIMD_URL:I.MESHOPT_URL,mm}let O0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},NR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},qf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function pM(t,e,n){let a=n.json.bufferViews.length,c=n.buffers.length;e.bufferView=a,n.json.bufferViews[a]={buffer:c,byteLength:t.byteLength},n.buffers[c]=t}let bx="KHR_draco_mesh_compression";function VR(t,e){let n=t.extensions&&t.extensions[bx];if(!n)return;let a=new os.Decoder,c=bM(e,n.bufferView),m=new os.Mesh;if(!a.DecodeArrayToMesh(c,c.byteLength,m))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[t.indices],b=O0[p.componentType],y=p.count*b.BYTES_PER_ELEMENT,w=os._malloc(y);b===Uint16Array?a.GetTrianglesUInt16Array(m,y,w):a.GetTrianglesUInt32Array(m,y,w),pM(os.memory.buffer.slice(w,w+y),p,e),os._free(w);for(let M of Object.keys(n.attributes)){let T=a.GetAttributeByUniqueId(m,n.attributes[M]),E=e.json.accessors[t.attributes[M]],P=NR[E.componentType],R=E.count*qf[E.type]*O0[E.componentType].BYTES_PER_ELEMENT,F=os._malloc(R);a.GetAttributeDataArrayForAllPoints(m,T,os[P],R,F),pM(os.memory.buffer.slice(F,F+R),E,e),os._free(F)}a.destroy(),m.destroy(),delete t.extensions[bx]}let R0="EXT_meshopt_compression";function jR(t,e){if(!t.extensions||!t.extensions[R0])return;let n=t.extensions[R0],a=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),c=new Uint8Array(n.count*n.byteStride);_x.decodeGltfBuffer(c,n.count,n.byteStride,a,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=c.buffer,delete t.extensions[R0]}let fM=1179937895,gM=new TextDecoder("utf8");function _M(t,e){return new URL(t,e).href}function UR(t,e,n,a){return fetch(_M(t.uri,a)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[n]=c})}function bM(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function HR(t,e,n,a){if(t.uri){let c=_M(t.uri,a);return fetch(c).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{e.images[n]=m})}if(t.bufferView!==void 0){let c=bM(e,t.bufferView),m=new Blob([c],{type:t.mimeType});return createImageBitmap(m).then(p=>{e.images[n]=p})}}function yM(t,e=0,n){let a={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===fM){let M=new Uint32Array(t,e),T=2,E=(M[T++]>>2)-3,P=M[T++]>>2;if(T++,a.json=JSON.parse(gM.decode(M.subarray(T,T+P))),T+=P,T<E){let R=M[T++];T++;let F=e+(T<<2);a.buffers[0]=t.slice(F,F+R)}}else a.json=JSON.parse(gM.decode(new Uint8Array(t,e)));let{buffers:c,images:m,meshes:p,extensionsUsed:b,bufferViews:y}=a.json,w=Promise.resolve();if(c){let M=[];for(let T=0;T<c.length;T++){let E=c[T];E.uri?M.push(UR(E,a,T,n)):a.buffers[T]||(a.buffers[T]=null)}w=Promise.all(M)}return w.then(()=>{let M=[],T=b&&b.includes(bx),E=b&&b.includes(R0);if(T&&M.push(function(){if(!os)return P0||(P0=function(P){let R,F=null;function B(){R=new Uint8Array(F.buffer)}function W(){throw new Error("Unexpected Draco error.")}let J={a:{a:W,d:function(ee,te,me){return R.copyWithin(ee,te,te+me)},c:function(ee){let te=R.length,me=Math.max(ee>>>0,Math.ceil(1.2*te)),he=Math.ceil((me-te)/65536);try{return F.grow(he),B(),!0}catch{return!1}},b:W}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,J):P.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,J))).then(ee=>{let{Rb:te,Qb:me,P:he,T:ve,X:Ce,Ja:De,La:Ue,Qa:ze,Va:$e,Wa:rt,eb:We,jb:et,f:He,e:tt,yb:st,zb:nt,Ab:Mt,Bb:ot,Db:dt,Gb:Nt}=ee.instance.exports;F=tt;let Ft=(()=>{let Pt=0,ct=0,Vt=0,oi=0;return Zt=>{Vt&&(te(oi),te(Pt),ct+=Vt,Vt=Pt=0),Pt||(ct+=128,Pt=me(ct));let di=Zt.length+7&-8,ai=Pt;di>=ct&&(Vt=di,ai=oi=me(di));for(let _i=0;_i<Zt.length;_i++)R[ai+_i]=Zt[_i];return ai}})();return B(),He(),{memory:tt,_free:te,_malloc:me,Mesh:class{constructor(){this.ptr=he()}destroy(){ve(this.ptr)}},Decoder:class{constructor(){this.ptr=De()}destroy(){et(this.ptr)}DecodeArrayToMesh(Pt,ct,Vt){let oi=Ft(Pt),Zt=Ue(this.ptr,oi,ct,Vt.ptr);return!!Ce(Zt)}GetAttributeByUniqueId(Pt,ct){return{ptr:ze(this.ptr,Pt.ptr,ct)}}GetTrianglesUInt16Array(Pt,ct,Vt){$e(this.ptr,Pt.ptr,ct,Vt)}GetTrianglesUInt32Array(Pt,ct,Vt){rt(this.ptr,Pt.ptr,ct,Vt)}GetAttributeDataArrayForAllPoints(Pt,ct,Vt,oi,Zt){We(this.ptr,Pt.ptr,ct.ptr,Vt,oi,Zt)}},DT_INT8:st(),DT_UINT8:nt(),DT_INT16:Mt(),DT_UINT16:ot(),DT_UINT32:dt(),DT_FLOAT32:Nt()}})}(fetch(uM())),P0.then(P=>{os=P,P0=void 0}))}()),E&&M.push(function(){if(_x)return;let P=function(R){let F,B=WebAssembly.instantiateStreaming(R,{}).then(ee=>{F=ee.instance,F.exports.__wasm_call_ctors()}),W={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},J={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(ee,te,me,he,ve,Ce){(function(De,Ue,ze,$e,rt,We,et){let He=De.exports.sbrk,tt=$e+3&-4,st=He(tt*rt),nt=He(We.length),Mt=new Uint8Array(De.exports.memory.buffer);Mt.set(We,nt);let ot=Ue(st,$e,rt,nt,We.length);if(ot===0&&et&&et(st,tt,rt),ze.set(Mt.subarray(st,st+$e*rt)),He(st-He(0)),ot!==0)throw new Error(`Malformed buffer data: ${ot}`)})(F,F.exports[J[ve]],ee,te,me,he,F.exports[W[Ce]])}}}(fetch(mM()));return P.ready.then(()=>{_x=P})}()),m)for(let P=0;P<m.length;P++)M.push(HR(m[P],a,P,n));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(T&&p)for(let{primitives:P}of p)for(let R of P)VR(R,a);if(E&&p&&y)for(let P of y)jR(P,a);return a})})}function Th(t,e){let n=t.json.bufferViews[e.bufferView],a=O0[e.componentType];return new a(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==qf[e.type]*a.BYTES_PER_ELEMENT?n.byteStride/a.BYTES_PER_ELEMENT:qf[e.type]))}function yx(t,e,n,a){let c=O0[e.componentType],m=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),p=t.json.bufferViews[e.bufferView],b=p.byteStride?p.byteStride/c.BYTES_PER_ELEMENT:qf[e.type],y=n.float32,w=y.length/n.capacity;for(let M=0,T=0;M<e.count*b;M+=b,T+=w)for(let E=0;E<w;E++)y[T+E]=a[M+E]*m;n._trim()}function WR(t,e,n){let a=t.indices,c=t.attributes,m={};m.indexArray=new wr;let p=e.json.accessors[a],b=p.count/3;m.indexArray.reserve(b);let y=Th(e,p);for(let E=0;E<b;E++)m.indexArray.emplaceBack(y[3*E],y[3*E+1],y[3*E+2]);m.indexArray._trim(),m.vertexArray=new zc;let w=e.json.accessors[c.POSITION];m.vertexArray.reserve(w.count);let M=Th(e,w);for(let E=0;E<w.count;E++)m.vertexArray.emplaceBack(M[3*E],M[3*E+1],M[3*E+2]);if(m.vertexArray._trim(),m.aabb=new Pn(w.min,w.max),m.centroid=function(E,P){let R=[0,0,0],F=E.length;if(F>0){for(let B=0;B<F;B++){let W=3*E[B];R[0]+=P[W],R[1]+=P[W+1],R[2]+=P[W+2]}R[0]/=F,R[1]/=F,R[2]/=F}return R}(y,M),c.COLOR_0!==void 0){let E=e.json.accessors[c.COLOR_0],P=qf[E.type],R=Th(e,E);m.colorArray=P===3?new zc:new Fc,m.colorArray.resize(E.count),yx(e,E,m.colorArray,R)}if(c.NORMAL!==void 0){m.normalArray=new zc;let E=e.json.accessors[c.NORMAL];m.normalArray.resize(E.count);let P=Th(e,E);yx(e,E,m.normalArray,P)}if(c.TEXCOORD_0!==void 0&&n.length>0){m.texcoordArray=new Wu;let E=e.json.accessors[c.TEXCOORD_0];m.texcoordArray.resize(E.count);let P=Th(e,E);yx(e,E,m.texcoordArray,P)}if(c._FEATURE_ID_RGBA4444!==void 0){let E=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Th(e,E))}c._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Th(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));let T=t.material;return m.material=function(E,P){let{emissiveFactor:R=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:B=.5,normalTexture:W,occlusionTexture:J,emissiveTexture:ee,doubleSided:te}=E,{baseColorFactor:me=[1,1,1,1],metallicFactor:he=1,roughnessFactor:ve=1,baseColorTexture:Ce,metallicRoughnessTexture:De}=E.pbrMetallicRoughness||{},Ue=J?P[J.index]:void 0;if(J&&J.extensions&&J.extensions.KHR_texture_transform&&Ue){let ze=J.extensions.KHR_texture_transform;Ue.offsetScale=[ze.offset[0],ze.offset[1],ze.scale[0],ze.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Fi(...me),metallicFactor:he,roughnessFactor:ve,baseColorTexture:Ce?P[Ce.index]:void 0,metallicRoughnessTexture:De?P[De.index]:void 0},doubleSided:te,emissiveFactor:R,alphaMode:F,alphaCutoff:B,normalTexture:W?P[W.index]:void 0,occlusionTexture:Ue,emissionTexture:ee?P[ee.index]:void 0,defined:E.defined===void 0}}(T!==void 0?e.json.materials[T]:{defined:!1},n),m}function vM(t,e,n){let{matrix:a,rotation:c,translation:m,scale:p,mesh:b,extras:y,children:w}=t,M={};if(M.matrix=a||i.ad.fromRotationTranslationScale([],c||[0,0,0,1],m||[0,0,0],p||[1,1,1]),b!==void 0){M.meshes=n[b];let T=M.anchor=[0,0];for(let E of M.meshes){let{min:P,max:R}=E.aabb;T[0]+=P[0]+R[0],T[1]+=P[1]+R[1]}T[0]=Math.floor(T[0]/M.meshes.length/2),T[1]=Math.floor(T[1]/M.meshes.length/2)}if(y&&(y.id&&(M.id=y.id),y.lights&&(M.lights=function(T){if(!T.length)return[];let E=function(W){let J=atob(W),ee=new Uint8Array(J.length);for(let te=0;te<J.length;te++)ee[te]=J.codePointAt(te);return ee}(T),P=[],R=E.length/24,F=new Uint16Array(E.buffer),B=new Float32Array(E.buffer);for(let W=0;W<R;W++){let J=F[2*W*6]/30,ee=F[2*W*6+1]/30,te=F[2*W*6+10]/100,me=B[6*W+1],he=B[6*W+2],ve=B[6*W+3],Ce=B[6*W+4],De=ve-me,Ue=Ce-he,ze=Math.hypot(De,Ue);P.push({pos:[me+.5*De,he+.5*Ue,ee],normal:[Ue/ze,-De/ze,0],width:ze,height:J,depth:te,points:[me,he,ve,Ce]})}return P}(y.lights))),w){let T=[];for(let E of w)T.push(vM(e.json.nodes[E],e,n));M.children=T}return M}function GR(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new Lv(t.vertices,t.indices,8,256),[n,a]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:a}}function qR(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let a=[];for(let p of n){if(!Array.isArray(p)||p.length!==2)continue;let b=p[0],y=p[1];typeof b=="number"&&typeof y=="number"&&a.push(new yt(b,y))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let c=0;for(let p=0;p<a.length;p++){let b=a[p],y=a[(p+1)%a.length],w=a[(p+2)%a.length];c+=(b.x-y.x)*(w.y-y.y)-(w.x-y.x)*(b.y-y.y)}c>0&&a.reverse();let m=Cf(a.flatMap(p=>[p.x,p.y]),[]);return m.length===0?null:{vertices:a,indices:m}}function $R(t,e){let n=[],a=[],c=0,m=[];for(let p of t){c=n.length;let b=p.vertexArray.float32,y=p.indexArray.uint16;for(let w=0;w<p.vertexArray.length;w++)m[0]=b[3*w+0],m[1]=b[3*w+1],m[2]=b[3*w+2],i._.transformMat4(m,m,e),n.push(new yt(m[0],m[1]));for(let w=0;w<3*p.indexArray.length;w++)a.push(y[w]+c)}if(a.length%3!=0)return null;for(let p=0;p<a.length;p+=3){let b=n[a[p+0]],y=n[a[p+1]],w=n[a[p+2]];(b.x-y.x)*(w.y-y.y)-(w.x-y.x)*(b.y-y.y)>0&&([a[p+1],a[p+2]]=[a[p+2],a[p+1]])}return{vertices:n,indices:a}}function xM(t){let e=function(y,w){let M=[],T=WebGL2RenderingContext;if(y.json.textures)for(let E of y.json.textures){let P={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};E.sampler!==void 0&&Object.assign(P,y.json.samplers[E.sampler]),M.push({image:w[E.source],sampler:P,uploaded:!1})}return M}(t,t.images),n=function(y,w){let M=[];for(let T of y.json.meshes){let E=[];for(let P of T.primitives)E.push(WR(P,y,w));M.push(E)}return M}(t,e),{scenes:a,scene:c,nodes:m}=t.json,p=a?a[c||0].nodes:m,b=[];for(let y of p)b.push(vM(m[y],t,n));return function(y,w,M){let T={},E=new Set;for(let P=0;P<y.length;P++){let R=M[w[P]];if(!R.extras)continue;let F=R.extras["mapbox:footprint:version"],B=R.extras["mapbox:footprint:id"];(F||B)&&E.add(P),F==="1.0.0"&&B&&(T[B]=P)}for(let P=0;P<y.length;P++){if(E.has(P))continue;let R=y[P],F=M[w[P]];if(!F.extras)continue;let B=null;R.id in T&&(B=$R(y[T[R.id]].meshes,R.matrix)),B||(B=qR(F)),B&&(R.footprint=GR(B))}if(E.size>0){let P=Array.from(E.values()).sort((R,F)=>R-F);for(let R=P.length-1;R>=0;R--)y.splice(P[R],1)}}(b,p,t.json.nodes),b}function YR(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,a=t.aabb.min[1]-1,c=kh/(t.aabb.max[0]-n+2),m=kh/(t.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){let b=e[p+2],y=(e[p+0]-n)*c|0,w=(e[p+1]-a)*m|0;b>t.heightmap[w*kh+y]&&(t.heightmap[w*kh+y]=b)}}function ZR(t,e){let n={};n.indexArray=new wr,n.indexArray.reserve(4*t.length),n.vertexArray=new zc,n.vertexArray.reserve(10*t.length),n.colorArray=new Fc,n.vertexArray.reserve(10*t.length);let a=0;for(let p of t){let b=Math.min(10,Math.max(4,1.3*p.height))*e,y=[-p.normal[1],p.normal[0],0],w=Math.min(.29,.1*p.width/p.depth),M=p.width-2*p.depth*e*(w+.01),T=i._.scaleAndAdd([],p.pos,y,M/2),E=i._.scaleAndAdd([],p.pos,y,-M/2),P=[T[0],T[1],T[2]+p.height],R=[E[0],E[1],E[2]+p.height],F=i._.scaleAndAdd([],p.normal,y,w);i._.scale(F,F,b);let B=i._.scaleAndAdd([],p.normal,y,-w);i._.scale(B,B,b),i._.add(F,T,F),i._.add(B,E,B),T[2]+=.1,E[2]+=.1,n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(B[0],B[1],B[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(B[0],B[1],B[2]);let W=M/b/2;n.colorArray.emplaceBack(-W-w,-1,W,.8),n.colorArray.emplaceBack(W+w,-1,W,.8),n.colorArray.emplaceBack(-W,0,W,1.3),n.colorArray.emplaceBack(W,0,W,1.3),n.colorArray.emplaceBack(W+w,-.8,W,.7),n.colorArray.emplaceBack(W+w,-.8,W,.7),n.colorArray.emplaceBack(0,0,W,1.3),n.colorArray.emplaceBack(0,0,W,1.3),n.colorArray.emplaceBack(W+w,-1.2,W,.8),n.colorArray.emplaceBack(W+w,-1.2,W,.8),n.indexArray.emplaceBack(6+a,4+a,8+a),n.indexArray.emplaceBack(7+a,9+a,5+a),n.indexArray.emplaceBack(0+a,1+a,2+a),n.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}let c={defined:!0,emissiveFactor:[0,0,0]},m={};return m.baseColorFactor=Fi.white,c.pbrMetallicRoughness=m,n.material=c,n.aabb=new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}let vx=new Float32Array(262144),Ih=new Uint8Array(262144);function wM(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,wM(n));return e}function CM(t,e,n){if(t.meshes)for(let a of t.meshes)a.aabb.min[0]!==1/0&&n.insert(e,a.aabb.min[0],a.aabb.min[1],a.aabb.max[0],a.aabb.max[1]);if(t.children)for(let a of t.children)CM(a,e,n)}let SM=["","wall","door","roof","window","lamp","logo"];class MM{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:wM(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=Pn.applyTransform(a.aabb,this.node.matrix),n.encapsulate(a.transformedAabb)),e++;this.aabb=n}return this.aabb}}class L0{constructor(e,n,a,c,m,p){this.id=n,this.modelTraits|=um.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=um.HasMapboxMeshFeatures),c&&(this.modelTraits|=um.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let b of e)this.nodesInfo.push(new MM(b)),CM(b,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(let a of this.getNodesInfo()){let c=a.node;c.footprint&&n.push({footprint:c.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let a of n){let c=a.node;this.uploaded?this.updatePbrBuffer(c):ux(c,e,!0)}for(let a of n)D0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),n=!0);return n}needsReEvaluation(e,n,a){let c=e.transform.projectionOptions,m=e.style.getBrightness(),p=this.brightness!==m;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||$f(a.paint.get("model-color").value,p)||$f(a.paint.get("model-color-mix-intensity").value,p)||$f(a.paint.get("model-roughness").value,p)||$f(a.paint.get("model-emissive-strength").value,p)||$f(a.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=c,this.brightness=m,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let a=this.getNodesInfo(),c=this.id.canonical;for(let m of a){let p=m.feature;m.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},c)}}evaluate(e){let n=this.getNodesInfo();for(let a of n){if(!a.node.meshes)continue;let c=a.feature,m=a.node.meshes&&a.node.meshes[0].featureData,p=a.evaluatedColor[2],b=a.evaluatedRMEA[2],y=this.id.canonical;if(a.hasTranslucentParts=!1,m){for(let w=0;w<SM.length;w++){let M=SM[w];M.length&&(c.properties.part=M);let T=e.paint.get("model-color").evaluate(c,{},y).toRenderColor(null),E=e.paint.get("model-color-mix-intensity").evaluate(c,{},y);a.evaluatedColor[w]=[T.r,T.g,T.b,E],a.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(c,{},y),a.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(c,{},y),a.evaluatedRMEA[w][3]=T.a,a.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},y),!a.hasTranslucentParts&&T.a<1&&(a.hasTranslucentParts=!0)}delete c.properties.part,QR(a,p!==a.evaluatedColor[2]||b!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,{},y);a.evaluatedScale=e.paint.get("model-scale").evaluate(c,{},y),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,a,c){let m=e.findDEMTileFor(a);if(m&&(m.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;let p=Ju.create(e,a,m);if(!p)return;this.modelTraits&um.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,c);for(let b of this.getNodesInfo()){let y=b.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let w=y.footprint.vertices,M=p.getElevationAt(w[0].x,w[0].y,!0,!0);for(let T=1;T<w.length;T++)M=Math.min(M,p.getElevationAt(w[T].x,w[T].y,!0,!0));y.elevation=M}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,a,c){let m=n._dem._modifiedForSources[c];if(m===void 0&&(n._dem._modifiedForSources[c]=[],m=n._dem._modifiedForSources[c]),m.includes(a.canonical))return;let p=n._dem.dim;m.push(a.canonical);let b=!1;for(let y of this.getNodesInfo()){let w=y.node;if(!w.footprint||!w.footprint.grid)continue;let M=w.footprint.grid,T=n.tileCoordToPixel(M.min.x,M.min.y),E=n.tileCoordToPixel(M.max.x,M.max.y),P=Math.min(Math.min(p-E.y,T.x),Math.min(T.y,p-E.x));if(P<0)continue;let R=pi(P,2,5),F=Math.max(0,T.x-R),B=Math.max(0,T.y-R),W=Math.min(E.x+R,p-1),J=Math.min(E.y+R,p-1);for(let he=B;he<=J;++he)for(let ve=F;ve<=W;++ve)Ih[he*p+ve]=255;let ee=0,te=0;for(let he=0;he<M.cellsY;++he)for(let ve=0;ve<M.cellsX;++ve){if(!M.cells[he*M.cellsX+ve])continue;let Ce=n.tileCoordToPixel(M.min.x+ve/M.xScale,M.min.y+he/M.yScale),De=n.tileCoordToPixel(M.min.x+(ve+1)/M.xScale,M.min.y+(he+1)/M.yScale);for(let Ue=Ce.y;Ue<=Math.min(De.y+1,p-1);++Ue)for(let ze=Ce.x;ze<=Math.min(De.x+1,p-1);++ze)Ih[Ue*p+ze]===255&&(Ih[Ue*p+ze]=0,ee+=n.getElevationAtPixel(ze,Ue),te++)}let me=ee/te;F=Math.max(1,T.x-R),B=Math.max(1,T.y-R),W=Math.min(E.x+R,p-2),J=Math.min(E.y+R,p-2),b=!0;for(let he=B;he<=J;++he)for(let ve=F;ve<=W;++ve)Ih[he*p+ve]===0&&(vx[he*p+ve]=n._dem.set(ve,he,me));for(let he=1;he<R;++he){F=Math.max(1,T.x-he),B=Math.max(1,T.y-he),W=Math.min(E.x+he,p-2),J=Math.min(E.y+he,p-2);for(let ve=B;ve<=J;++ve)for(let Ce=F;Ce<=W;++Ce){let De=ve*p+Ce;if(Ih[De]===255){let Ue=0,ze=0,$e=-1,rt=-1;for(let We=-1;We<=1;++We)for(let et=-1;et<=1;++et){let He=(ve+We)*p+Ce+et;if(Ih[He]>=he)continue;let tt=vx[He],st=Math.abs(tt);st>ze&&(Ue=tt,ze=st,$e=et,rt=We)}if(ze>.1){let We=1-(he+.5*Math.abs($e*rt))/R,et=n._dem.get(Ce,ve)+Ue*We,He=n._dem.get(Ce+$e,ve+rt),tt=n._dem.get(Ce-$e,ve-rt,!0);(et-He)*(et-tt)>0&&(et=(He+tt)/2),vx[De]=n._dem.set(Ce,ve,et),Ih[De]=he}}}}}b&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=kr.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)D0(n.node),mx(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let m=0;m<this.nodesInfo.length;m++){let p=c[m].node;c[m].hiddenByReplacement=!!p.footprint&&!a.find(b=>b.footprint===p.footprint)}}getHeightAtTileCoord(e,n){let a=this.getNodesInfo(),c=[],m=[0,0,0],p=i.ad.identity([]);for(let b=0;b<this.nodesInfo.length;b++){let y=a[b],w=y.node.meshes[0],M=w.transformedAabb;if(e<M.min[0]||n<M.min[1]||e>M.max[0]||n>M.max[1])continue;if(y.node.hidden===!0)return{height:0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};i.ad.invert(p,y.node.matrix),m[0]=e,m[1]=n,i._.transformMat4(m,m,p);let T=(m[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*kh|0,E=Math.min(63,(m[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*kh|0)*kh+Math.min(63,T),P=w.heightmap[E];if(!(P<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:P,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new yt(e,n),new yt(e,n),c),c.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function $f(t,e){return!t.isLightConstant&&e}function XR(t,e,n,a,c,m,p,b){let y=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;n[3]>0&&(y=Wt(y,255*n[0],n[3]),w=Wt(w,255*n[1],n[3]),M=Wt(M,255*n[2],n[3]));let T=y<<8|w,E=M<<8|Math.floor(255*a[3]),P=function(he){let ve=pi(he,0,2);return Math.min(Math.round(.5*ve*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],R=pi(c[0],0,1),F=pi(c[1],0,1),B=pi(c[2],0,1),W=pi(c[3],0,1),J,ee,te,me;if(R!==F&&p!==m&&F!==R){let he=p-m;ee=1/(he*(F-R)),te=-(m+he*R)/(he*(F-R));let ve=pi(c[4],-1,1);me=Math.pow(10,ve),J=255*B<<8|255*W}else J=65535,ee=0,te=1,me=1;if(t.emplaceBack(T,E,P,J,ee,te,me),b){let he=b.length;b.clear();for(let ve=0;ve<he;ve++)b.emplaceBack(T,E,P,J,ee,te,me)}}function QR(t,e,n){let a=t.node,c=0,m=n&um.HasMeshoptCompression;for(let p of a.meshes){if(a.lights&&a.lightMeshIndex===c||!p.featureData)continue;p.featureArray=new L_,p.featureArray.reserve(p.featureData.length);let b=e;for(let y of p.featureData){let w=m?65535&y:y>>16&65535,M=m?y>>16&65535:65535&y,T=(15&M)<8?15&M:0,E=t.evaluatedRMEA[T],P=t.evaluatedColor[T],R=t.emissionHeightBasedParams[T],F;if(b&&T===2&&a.lights&&(F=new L_,F.resize(10*a.lights.length)),XR(p.featureArray,w,P,E,R,p.aabb.min[2],p.aabb.max[2],F),F&&b){b=!1;let B=a.meshes[a.lightMeshIndex];B.featureArray=F,B.featureArray._trim()}}p.featureArray._trim(),c++}}function kM(t,e,n,a){let c=1<<t.z;e.lat=Er((a/pt+t.y)/c),e.lng=Ao((n/pt+t.x)/c)}ne(L0,"Tiled3dModelBucket",{omit:["layers"]}),ne(MM,"Tiled3dModelFeature");let KR={circle:class extends cr{constructor(t,e,n,a){super(t,BA,e,n,a)}createBucket(t){return new _v(t)}queryRadius(t){let e=t;return Xu("circle-radius",this,e)+Xu("circle-stroke-width",this,e)+j_(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,a,c,m,p,b){let y=zC(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,t.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return KC(t,a,m,p,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,n){let a=QC(this);return{config:new bh(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}},heatmap:class extends cr{createBucket(t){return new e2(t)}constructor(t,e,n,a){super(t,ZA,e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Xu("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,a,c,m,p,b){let y=this.paint.get("heatmap-radius").evaluate(e,n);return KC(t,a,m,p,b,!0,!0,new yt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,n){return t==="heatmap"?{config:new bh(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends cr{constructor(t,e,n,a){super(t,QA,e,n,a)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},fill:class extends cr{constructor(t,e,n,a){super(t,hP,e,n,a)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e,n){return{config:new bh(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new X_(t)}queryRadius(){return j_(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,a,c,m){return!t.queryGeometry.isAboveHorizon&&PC(FC(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,t.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends cr{constructor(t,e,n,a){super(t,jP,e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new n0(t)}queryRadius(){return j_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,a,c,m,p,b,y){let w=zC(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,t.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,n),T=this.paint.get("fill-extrusion-base").evaluate(e,n),E=[0,0],P=b&&m.elevation,R=m.elevation?m.elevation.exaggeration():1,F=t.tile.getBucket(this);if(P&&F instanceof n0){let te=F.centroidVertexArray,me=y+1;me<te.length&&(E[0]=te.geta_centroid_pos0(me),E[1]=te.geta_centroid_pos1(me))}if(E[0]===0&&E[1]===1)return!1;m.projection.name==="globe"&&(a=j2([a],[new yt(0,0),new yt(pt,pt)],t.tileID.canonical).map(te=>te.polygon).flat());let B=P?b:null,[W,J]=function(te,me,he,ve,Ce,De,Ue,ze,$e,rt,We){return te.projection.name==="globe"?function(et,He,tt,st,nt,Mt,ot,dt,Nt,Ft,Pt){let ct=[],Vt=[],oi=et.projection.upVectorScale(Pt,et.center.lat,et.worldSize).metersToTile,Zt=[0,0,0,1],di=[0,0,0,1],ai=(qt,rn,nn,Ni)=>{qt[0]=rn,qt[1]=nn,qt[2]=Ni,qt[3]=1},_i=V2();tt>0&&(tt+=_i),st+=_i;for(let qt of He){let rn=[],nn=[];for(let Ni of qt){let Ei=Ni.x+nt.x,Vi=Ni.y+nt.y,gn=et.projection.projectTilePoint(Ei,Vi,Pt),hn=et.projection.upVector(Pt,Ni.x,Ni.y),Ln=tt,On=st;if(ot){let $r=H2(Ei,Vi,tt,st,ot,dt,Nt,Ft);Ln+=$r.base,On+=$r.top}tt!==0?ai(Zt,gn.x+hn[0]*oi*Ln,gn.y+hn[1]*oi*Ln,gn.z+hn[2]*oi*Ln):ai(Zt,gn.x,gn.y,gn.z),ai(di,gn.x+hn[0]*oi*On,gn.y+hn[1]*oi*On,gn.z+hn[2]*oi*On),i._.transformMat4(Zt,Zt,Mt),i._.transformMat4(di,di,Mt),rn.push(new Ch(Zt[0],Zt[1],Zt[2])),nn.push(new Ch(di[0],di[1],di[2]))}ct.push(rn),Vt.push(nn)}return[ct,Vt]}(te,me,he,ve,Ce,De,Ue,ze,$e,rt,We):Ue?function(et,He,tt,st,nt,Mt,ot,dt,Nt){let Ft=[],Pt=[],ct=[0,0,0,1];for(let Vt of et){let oi=[],Zt=[];for(let di of Vt){let ai=di.x+st.x,_i=di.y+st.y,qt=H2(ai,_i,He,tt,Mt,ot,dt,Nt);ct[0]=ai,ct[1]=_i,ct[2]=qt.base,ct[3]=1,i.aA.transformMat4(ct,ct,nt),ct[3]=Math.max(ct[3],1e-5);let rn=new Ch(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);ct[0]=ai,ct[1]=_i,ct[2]=qt.top,ct[3]=1,i.aA.transformMat4(ct,ct,nt),ct[3]=Math.max(ct[3],1e-5);let nn=new Ch(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);oi.push(rn),Zt.push(nn)}Ft.push(oi),Pt.push(Zt)}return[Ft,Pt]}(me,he,ve,Ce,De,Ue,ze,$e,rt):function(et,He,tt,st,nt){let Mt=[],ot=[],dt=nt[8]*He,Nt=nt[9]*He,Ft=nt[10]*He,Pt=nt[11]*He,ct=nt[8]*tt,Vt=nt[9]*tt,oi=nt[10]*tt,Zt=nt[11]*tt;for(let di of et){let ai=[],_i=[];for(let qt of di){let rn=qt.x+st.x,nn=qt.y+st.y,Ni=nt[0]*rn+nt[4]*nn+nt[12],Ei=nt[1]*rn+nt[5]*nn+nt[13],Vi=nt[2]*rn+nt[6]*nn+nt[14],gn=nt[3]*rn+nt[7]*nn+nt[15],hn=Ni+dt,Ln=Ei+Nt,On=Vi+Ft,$r=Math.max(gn+Pt,1e-5),Vn=Ni+ct,Tn=Ei+Vt,sr=Vi+oi,Dr=Math.max(gn+Zt,1e-5);ai.push(new Ch(hn/$r,Ln/$r,On/$r)),_i.push(new Ch(Vn/Dr,Tn/Dr,sr/Dr))}Mt.push(ai),ot.push(_i)}return[Mt,ot]}(me,he,ve,Ce,De)}(m,a,T,M,w,p,B,E,R,m.center.lat,t.tileID.canonical),ee=t.queryGeometry;return function(te,me,he){let ve=1/0;PC(he,me)&&(ve=U2(he,me[0]));for(let Ce=0;Ce<me.length;Ce++){let De=me[Ce],Ue=te[Ce];for(let ze=0;ze<De.length-1;ze++){let $e=De[ze],rt=[$e,De[ze+1],Ue[ze+1],Ue[ze],$e];bv(he,rt)&&(ve=Math.min(ve,U2(he,rt)))}}return ve!==1/0&&ve}(W,J,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends cr{constructor(t,e,n,a){super(t,o0,e,n,a),o0.layout&&(this.layout=new tn(o0.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof hh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=YS.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new r0(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,n){let a=Q2(this);return{config:new bh(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}queryRadius(t){let e=t,n=ZS(Xu("line-width",this,e),Xu("line-gap-width",this,e)),a=Xu("line-offset",this,e);return n/2+Math.abs(a)+j_(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,a,c,m){if(t.queryGeometry.isAboveHorizon)return!1;let p=FC(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,t.pixelToTileUnitsFactor),b=t.pixelToTileUnitsFactor/2*ZS(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(a=function(w,M){let T=[],E=new yt(0,0);for(let P=0;P<w.length;P++){let R=w[P],F=[];for(let B=0;B<R.length;B++){let W=R[B],J=R[B+1],ee=B===0?E:W.sub(R[B-1])._unit()._perp(),te=B===R.length-1?E:J.sub(W)._unit()._perp(),me=ee._add(te)._unit();me._mult(1/(me.x*te.x+me.y*te.y)),F.push(me._mult(M)._add(W))}T.push(F)}return T}(a,y*t.pixelToTileUnitsFactor)),function(w,M,T){for(let E=0;E<M.length;E++){let P=M[E];if(w.length>=3){for(let R=0;R<P.length;R++)if(Hc(w,P[R]))return!0}if(RA(w,P,T))return!0}return!1}(p,a,b)}isTileClipped(){return!0}isDraped(t){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:S0,background:class extends cr{constructor(t,e,n,a){super(t,gR,e,n,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},raster:JS,"raster-particle":eM,sky:class extends cr{constructor(t,e,n,a){super(t,SR,e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=wf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let a=this.paint.get("sky-atmosphere-sun"),c=!a,m=t.style.light,p=m.properties.get("position");return c&&m.properties.get("anchor")==="viewport"&&qn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?cx(p.azimuthal,90-p.polar,e):cx(a[0],90-a[1],e)}let n=this.paint.get("sky-gradient-center");return cx(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends cr{constructor(t,e,n,a){super(t,MR,e,null)}},model:class extends cr{constructor(t,e,n,a){super(t,RR,e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new hx(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof L0?pt-1:0}queryIntersectsFeature(t,e,n,a,c,m){if(!this.modelManager)return!1;let p=this.modelManager,b=t.tile.getBucket(this);if(!(b&&b instanceof hx))return!1;let y=b;for(let w in y.instancesPerModel){let M=y.instancesPerModel[w],T=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty(T)){let E=M.features[M.idToFeaturesIndex[T]],P=p.getModel(w,this.scope);if(!P)return!1;let R=i.ad.create(),F=new Oi(0,0),B=y.canonical,W=Number.MAX_VALUE;for(let J=0;J<E.instancedDataCount;++J){let ee=16*(E.instancedDataOffset+J),te=M.instancedDataArray.float32,me=[te[ee+4],te[ee+5],te[ee+6]];kM(B,F,te[ee],0|te[ee+1]),dM(R,P,m,F,E.rotation,E.scale,me,!1,!1,!1),m.projection.name==="globe"&&(R=dx(R,m));let he=i.ad.multiply([],m.projMatrix,R),ve=t.queryGeometry,Ce=aM(ve.isPointQuery()?ve.screenBounds:ve.screenGeometry,m,he,P.aabb);Ce!=null&&(W=Math.min(Ce,W))}return W!==Number.MAX_VALUE&&W}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof $}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,a){let c=t.tile,m=c.getBucket(this),p=null,b=Number.MAX_VALUE;if(!(m&&m instanceof L0))return{queryFeature:p,intersectionZ:b};let y=m.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!n.filter(new Qt(c.tileID.overscaledZ),y.feature,c.tileID.canonical))return{queryFeature:p,intersectionZ:b};let w=y.node,M=a.calculatePosMatrix(c.tileID.toUnwrapped(),a.worldSize),T=y.evaluatedScale,E=0;a.elevation&&w.elevation&&(E=w.elevation*a.elevation.exaggeration()),i.ad.translate(M,M,[(w.anchor?w.anchor[0]:0)*(T[0]-1),(w.anchor?w.anchor[1]:0)*(T[1]-1),E]),i.ad.scale(M,M,T),i.ad.multiply(M,M,w.matrix);let P=t.queryGeometry,R=P.isPointQuery()?P.screenBounds:P.screenGeometry,F=function(W){let J=i.ad.multiply([],M,W.matrix),ee=i.ad.multiply(J,a.expandedFarZProjMatrix,J);for(let te=0;te<W.meshes.length;++te){let me=W.meshes[te];if(te===W.lightMeshIndex)continue;let he=aM(R,a,ee,me.aabb);he!=null&&(b=Math.min(he,b))}if(W.children)for(let te of W.children)F(te)};if(F(w),b===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:b};let B=new Oi(0,0);return kM(c.tileID.canonical,B,y.node.anchor[0],y.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[B.lng,B.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:b}}},clip:class extends cr{constructor(t,e,n,a){super(t,mP,e,n,a)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new l2(t)}isTileClipped(){return!0}is3D(){return!0}}};ne(GS,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let TM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class xx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);let m=TM[15&a];if(!m)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new xx(b,p,m,e)}constructor(e,n=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let m=TM.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+b+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return wx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:p,nodeSize:b}=this,y=[0,m.length-1,0],w=[];for(;y.length;){let M=y.pop()||0,T=y.pop()||0,E=y.pop()||0;if(T-E<=b){for(let B=E;B<=T;B++){let W=p[2*B],J=p[2*B+1];W>=e&&W<=a&&J>=n&&J<=c&&w.push(m[B])}continue}let P=E+T>>1,R=p[2*P],F=p[2*P+1];R>=e&&R<=a&&F>=n&&F<=c&&w.push(m[P]),(M===0?e<=R:n<=F)&&(y.push(E),y.push(P-1),y.push(1-M)),(M===0?a>=R:c>=F)&&(y.push(P+1),y.push(T),y.push(1-M))}return w}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:c,coords:m,nodeSize:p}=this,b=[0,c.length-1,0],y=[],w=a*a;for(;b.length;){let M=b.pop()||0,T=b.pop()||0,E=b.pop()||0;if(T-E<=p){for(let B=E;B<=T;B++)EM(m[2*B],m[2*B+1],e,n)<=w&&y.push(c[B]);continue}let P=E+T>>1,R=m[2*P],F=m[2*P+1];EM(R,F,e,n)<=w&&y.push(c[P]),(M===0?e-a<=R:n-a<=F)&&(b.push(E),b.push(P-1),b.push(1-M)),(M===0?e+a>=R:n+a>=F)&&(b.push(P+1),b.push(T),b.push(1-M))}return y}}function wx(t,e,n,a,c,m){if(c-a<=n)return;let p=a+c>>1;IM(t,e,p,a,c,m),wx(t,e,n,a,p-1,1-m),wx(t,e,n,p+1,c,1-m)}function IM(t,e,n,a,c,m){for(;c>a;){if(c-a>600){let w=c-a+1,M=n-a+1,T=Math.log(w),E=.5*Math.exp(2*T/3),P=.5*Math.sqrt(T*E*(w-E)/w)*(M-w/2<0?-1:1);IM(t,e,n,Math.max(a,Math.floor(n-M*E/w+P)),Math.min(c,Math.floor(n+(w-M)*E/w+P)),m)}let p=e[2*n+m],b=a,y=c;for(Yf(t,e,a,n),e[2*c+m]>p&&Yf(t,e,a,c);b<y;){for(Yf(t,e,b,y),b++,y--;e[2*b+m]<p;)b++;for(;e[2*y+m]>p;)y--}e[2*a+m]===p?Yf(t,e,a,y):(y++,Yf(t,e,y,c)),y<=n&&(a=y+1),n<=y&&(c=y-1)}}function Yf(t,e,n,a){Cx(t,n,a),Cx(e,2*n,2*a),Cx(e,2*n+1,2*a+1)}function Cx(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}function EM(t,e,n,a){let c=t-n,m=e-a;return c*c+m*m}i.$=al,i.A=lh,i.B=Ps,i.C=Fi,i.D=Wr,i.E=ul,i.G=Gr,i.H=h,i.I=WO,i.J=Uy,i.K=function(t){let e=t.value,n=[];if(!e)return n;let a=pl(e);return a!=="string"?(n=n.concat([new E0(t.key,e,`string expected, "${a}" found`)]),n):(sM(e,!0)||(n=n.concat([new E0(t.key,e,`invalid url "${e}"`)])),n)},i.L=Pe,i.M=class{constructor(t,e,n,a){this.id=t,this.position=e!=null?new Oi(e[0],e[1]):new Oi(0,0),this.orientation=n??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(i.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let a=Pn.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=i.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,a,c,m,p=!1){dM(this.matrix,this,t.transform,this.position,e,n,a,c,m,p)}upload(t){if(!this.uploaded){for(let e of this.nodes)ux(e,t);for(let e of this.nodes)D0(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)mx(t)}},i.N=Wi,i.O=Ke,i.P=yt,i.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Ha(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Wt(t.x,e.x,n),y:Wt(t.y,e.y,n),z:Wt(t.z,e.z,n),azimuthal:Wt(t.azimuthal,e.azimuthal,n),polar:Wt(t.polar,e.polar,n)}}},i.R=_u,i.S=iv,i.T=Ea,i.U=Xi,i.V=E0,i.W=Nr,i.X=Qt,i.Y=qr,i.Z=$,i.a=jo,i.a$=function(t){let{x:e,y:n}=t.point,{lng:a,lat:c}=t._center;return YC(e,n,t.worldSize,a,c)},i.a0=tn,i.a1=Il,i.a2=Wt,i.a3=pt,i.a4=Jg,i.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,a]){let c=Ha([1,n,a]);return{x:c.x,y:c.y,z:c.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Wt(t.x,e.x,n),y:Wt(t.y,e.y,n),z:Wt(t.z,e.z,n)}}},i.a6=ff,i.a7=z_,i.a8=Sl,i.a9=wC,i.aB=function(t,e){let{x:n,y:a}=t.point,c=YC(n,a,t.worldSize/t._pixelsPerMercatorPixel,0,0);return i.ad.multiply(c,c,Tv(zs(e)))},i.aD=nm,i.aE=ua,i.aF=l0,i.aG=function(t,e,n,a,c){let m=5*e+2;t.float32[m+0]=n,t.float32[m+1]=a,t.float32[m+2]=c},i.aH=y0,i.aI=Oi,i.aJ=FS,i.aK=kC,i.aL=dr,i.aM=Sv,i.aN=iM,i.aO=vh,i.aP=GC,i.aQ=function(t,e,n,a,c,m,p,b,y){if(y.name==="globe")return GC(t,e,new vh(n,a,c),!1);let w=Sh({z:n,x:a,y:c},y);return new Pn([(m+w.x/w.scale)*e,e*(w.y/w.scale),p],[(m+w.x2/w.scale)*e,e*(w.y2/w.scale),b])},i.aR=function(t,e,n){let a=0;for(let c=0;c<2;++c)t[c]>0&&(a+=(t[c]-0)*(t[c]-0)),e[c]<0&&(a+=(0-e[c])*(0-e[c]));return a},i.aS=Yn,i.aT=wv,i.aU=SC,i.aV=function(t){let e=i.ad.identity(new Float64Array(16));i.ad.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,Ta,0],a=[0,Ia,0];return i._.transformMat4(n,n,e),i._.transformMat4(a,a,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Ev(t,new Oi(t.center.lat,90)),a[0]>0&&a[0]<=t.width&&a[1]>0&&a[1]<=t.height&&!Ev(t,new Oi(t.center.lat,-90))]},i.aW=function(t,e){let{scale:n}=t.tileTransform,a=n*pt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return i.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},i.aX=T0,i.aY=tM,i.aZ=function(t){let e=tM(t,!0);return i.aC.invert([],[e[0],e[1],e[4],e[5]])},i.a_=Cv,i.aa=po,i.ab=Ti,i.ac=function(t,e,n){let a=Math.sqrt(t*t+e*e+n*n),c=a>0?Math.acos(n/a)*Ld:0,m=t!==0||e!==0?Math.atan2(-e,-t)*Ld+90:0;return m<0&&(m+=360),[a,m,c]},i.ae=lm,i.af=ts,i.ag=Kv,i.ah=function(t,e){let n={};for(let a=0;a<e.length;a++){let c=e[a];c in t&&(n[c]=t[c])}return n},i.ai=Uc,i.aj=Ls,i.ak=Fs,i.al=Uu,i.am=function(t){fu++,fu>Cp&&(t.getActor().send("enforceCacheSizeLimit",wp),fu=0)},i.an=Ap,i.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,a){let c=this.entries[t]=this.entries[t]||{callbacks:[]};if(c.result){let[m,p]=c.result;return this.scheduler?this.scheduler.add(()=>{a(m,p)},e):a(m,p),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=n((m,p)=>{c.result=[m,p];for(let b of c.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,p)},e):b(m,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(m=>m!==a),c.callbacks.length||(c.cancel(),delete this.entries[t]))}}},i.ap=function(t,e,n){let a=JSON.stringify(t.request);return t.data&&(this.deduped.entries[a]={result:[null,t.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{let m=dl(t.request,(p,b,y,w)=>{p?c(p):b&&c(null,{vectorTile:n?void 0:new Fv(new im(b)),rawData:b,cacheControl:y,expires:w})});return()=>{m.cancel(),c()}},e)},i.aq=av,i.ar=class extends Cl{constructor(t){super(t),this.current=vA}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},i.as=sv,i.at=pi,i.au=sl,i.aw=Vd,i.ax=go,i.ay=Er,i.az=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},i.b=An,i.b$=qc,i.b0=Br,i.b1=dv,i.b2=function(t){let e=Math.round((t+45+360)%360/90)%4;return Vg[e]},i.b3=45,i.b4=mv,i.b5=B_,i.b6=Pn,i.b7=Ha,i.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},i.b9=pp,i.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},i.bB=Y2,i.bD=$C,i.bE=uu,i.bF=hu,i.bG=256,i.bH=function(t,e){let n=[0,0,0],a=xf(zs(e.canonical));return i._.transformMat4(n,n,a),i._.transformMat4(n,n,t),n},i.bI=t=>({u_camera_to_center_distance:new po(t),u_extrude_scale:new lv(t),u_device_pixel_ratio:new po(t),u_matrix:new ff(t),u_inv_rot_matrix:new ff(t),u_merc_center:new Sl(t),u_tile_id:new av(t),u_zoom_transition:new po(t),u_up_dir:new av(t),u_emissive_strength:new po(t)}),i.bJ=t=>({u_matrix:new ff(t),u_pixels_to_tile_units:new lv(t),u_device_pixel_ratio:new po(t),u_units_to_pixels:new Sl(t),u_dash_image:new z_(t),u_gradient_image:new z_(t),u_image_height:new po(t),u_texsize:new Sl(t),u_tile_units_to_pixels:new po(t),u_alpha_discard_threshold:new po(t),u_trim_offset:new Sl(t),u_trim_fade_range:new Sl(t),u_trim_color:new sv(t),u_emissive_strength:new po(t)}),i.bK=t=>({u_matrix:new ff(t),u_texsize:new Sl(t),u_pixels_to_tile_units:new lv(t),u_device_pixel_ratio:new po(t),u_image:new z_(t),u_units_to_pixels:new Sl(t),u_tile_units_to_pixels:new po(t),u_alpha_discard_threshold:new po(t),u_trim_offset:new Sl(t)}),i.bL=Zy,i.bM=eO,i.bN=jr,i.bO=bO,i.bP=TS,i.bQ=Gv,i.bR=QC,i.bS=(t,e,n,a,c,m)=>{let p=t.transform,b=p.projection.name==="globe",y;if(m.paint.get("circle-pitch-alignment")==="map")if(b){let M=$C(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;y=Float32Array.from([M,0,0,M])}else y=p.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let w={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:kr.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:WA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(b){w.u_inv_rot_matrix=a,w.u_merc_center=c,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=Il(p.zoom);let M=c[0]*pt,T=c[1]*pt;w.u_up_dir=p.projection.upVector(new vh(0,0,0),M,T)}return w},i.bT=Q2,i.bU=(t,e,n,a,c,m)=>{let p=t.transform;return{u_matrix:X2(t,e,n,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:Z2(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:m}},i.bV=(t,e,n,a,c,m,p)=>{let b=t.transform,y=b.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:X2(t,e,n,a),u_pixels_to_tile_units:y,u_device_pixel_ratio:m,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:K2(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Z2(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},i.bW=fp,i.bX=wf,i.bY=V2,i.bZ=IA,i.b_=n0,i.ba=function(t,e,n){let a=Il(n.zoom),c=t.style.map._antialias,m=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return a===0&&!c&&!m},i.bb=function(t){let e=t.pixelsPerMeter,n=e/go(1,t.center.lat),a=i.ad.identity(new Float64Array(16));return i.ad.translate(a,a,[t.point.x,t.point.y,0]),i.ad.scale(a,a,[n,n,e]),Float32Array.from(a)},i.bc=W_,i.bd=function(t){let e=Yn-5;t=pi(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(Ti(t))),3);return Math.round(n*(hv.length-1))},i.be=function(t,e,n,a){let c=e.getNorth(),m=e.getSouth(),p=e.getWest(),b=e.getEast(),y=1<<t.z,w=b-p,M=c-m,T=w/qu,E=-M/hv[n],P=[0,T,0,E,0,0,c,p,0];if(t.z>0){let R=180/a;i.bC.multiply(P,P,[R/w+1,0,0,0,R/M+1,0,-.5*R/T,.5*R/E,1])}return P[2]=y,P[5]=t.x,P[8]=t.y,P},i.bf=xf,i.bg=zs,i.bh=function(t,e,n){let a=i.ad.identity(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return i.ad.rotateY(a,n.globeMatrix,c),Float32Array.from(a)},i.bi=pc,i.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},i.bk=JS,i.bl=eM,i.bm=KS,i.bn=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<t.length;a++){let c=document.createElement("source");Gg(t[a])||(n.crossOrigin="Anonymous"),c.src=t[a],n.appendChild(c)}return{cancel:()=>{}}},i.bo=v0,i.bp=lu,i.bq=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,a=1<<n,c=Math.floor(t.x),m=Math.floor((t.x-c)*a),p=Math.floor(t.y*a),b=this.findDEMTileFor(new dr(n,c,n,m,p));return!(!b||!b.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let a=this._source();if(!a||t.y<0||t.y>1)return e;let c=a.getSource().maxzoom,m=1<<c,p=Math.floor(t.x),b=t.x-p,y=new dr(c,p,c,Math.floor(b*m),Math.floor(t.y*m)),w=this.findDEMTileFor(y);if(!w||!w.dem)return e;let M=w.dem,T=1<<w.tileID.canonical.z,E=(b*T-w.tileID.canonical.x)*M.dim,P=(t.y*T-w.tileID.canonical.y)*M.dim,R=Math.floor(E),F=Math.floor(P);return(n?this.exaggeration():1)*Wt(Wt(M.get(R,F),M.get(R,F+1),P-F),Wt(M.get(R+1,F),M.get(R+1,F+1),P-F),E-R)}getAtTileOffset(t,e,n){let a=1<<t.canonical.z;return this.getAtPointOrZero(new qr(t.wrap+(t.canonical.x+e/pt)/a,(t.canonical.y+n/pt)/a))}getAtTileOffsetFunc(t,e,n,a){return c=>{let m=this.getAtTileOffset(t,c.x,c.y),p=a.upVector(t.canonical,c.x,c.y),b=a.upVectorScale(t.canonical,e,n).metersToTile;return i._.scale(p,p,m*b),p}}getForTilePoints(t,e,n,a){if(this.isUsingMockSource())return!1;let c=Ju.create(this,t,a);return!!c&&(e.forEach(m=>{m[2]=this.exaggeration()*c.getElevationAt(m[0],m[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,a=e.tileID,c=1<<t.canonical.z-a.canonical.z,m=t.canonical.x/c-a.canonical.x,p=t.canonical.y/c-a.canonical.y,b=0;for(let y=0;y<t.canonical.z-a.canonical.z&&!n.leaves[b];y++){m*=2,p*=2;let w=2*Math.floor(p)+Math.floor(m);b=n.childOffsets[b]+w,m%=1,p%=1}return{min:this.exaggeration()*n.minimums[b],max:this.exaggeration()*n.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(let c of t){let m=this.getMinMaxForTile(c.tileID);m&&(n=Math.min(n,m.min),a=Math.max(a,m.max),e=!0)}return e?{min:n,max:a}:null}},i.br=yf,i.bs=H_,i.bt=Xa,i.bu=wr,i.bv=Mh,i.bw=px,i.bx=A0,i.by=C0,i.bz=n2,i.c=xM,i.c$=Ud,i.c0=450,i.c1=7,i.c2=yR,i.c3=qS,i.c4=256,i.c5=HC,i.c6=Tv,i.c7=Gi,i.c8=zc,i.c9=_h,i.cA=function(t){let e=1/0,n=1/0,a=-1/0,c=-1/0;for(let m of t)e=Math.min(e,m.x),n=Math.min(n,m.y),a=Math.max(a,m.x),c=Math.max(c,m.y);return{min:new yt(e,n),max:new yt(a,c)}},i.cB=Hc,i.cC=DC,i.cD=fo,i.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.cF=vS,i.cG=bv,i.cH=y2,i.cI=v2,i.cJ=Zv,i.cK=xx,i.cL=function(t){return t({pluginStatus:it,pluginURL:Ge}),ei.on("pluginStateChange",t),t},i.cM=om,i.cN=$v,i.cO=bu,i.cP=Dt,i.cQ=N,i.cR=xp,i.cS=yc,i.cT=xa,i.cU=function(t){let e=t.indexOf(Oc);return e>=0?t.slice(0,e):t},i.cV=function(t){return t.indexOf(Oc)>=0},i.cW=function(t){let e=t.indexOf(Oc);return e>=0?t.slice(e+1):""},i.cX=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},i.cY=function(t,e,n,a){return t.type==="custom"?new wR(t,e):new KR[t.type](t,e,n,a)},i.cZ=ll,i.c_=ei,i.ca=1,i.cb=Bf,i.cc=0,i.cd=Jy,i.ce=function(t,e,n,a,c){return pi((t-e)/(n-e)*(c-a)+a,a,c)},i.cf=M_,i.cg=xh,i.ch=class{constructor(t,e,n,a){this.context=t,this.format=a,this.size=n,this.texture=t.gl.createTexture();let[c,m,p]=this.size,{gl:b}=t;b.bindTexture(b.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let y=this.format,w=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(y=b.DEPTH_COMPONENT16,w=b.UNSIGNED_SHORT),this.format===b.R8&&(a=b.RED),this.format===b.R32F&&(w=b.FLOAT,a=b.RED),b.texImage3D(b.TEXTURE_3D,0,y,c,m,p,0,a,w,e.data)}bind(t,e){let{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_3D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},i.ci=dx,i.cj=[1,1,1],i.ck=Ju,i.cl=um,i.cm=Nc,i.cn=Wu,i.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new yt(1/0,1/0),max:new yt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){let n=g2(new yt(0,0),new yt(pt,pt),t),a=[];if(e&&!zv(n,this._globalClipBounds))return a;for(let c of this._activeRegions){if(c.hiddenByOverlap||!zv(n,c))continue;let m=TP(c.min,c.max,t);a.push({min:m.min,max:m.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask})}return a}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let a of e.cache.getVisibleCoordinates()){let c=e.cache.getTile(a).buckets[e.layer];c&&c.updateFootprints(a.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){let e=t.getFootprints();if(e.length===0)return;let n=t.getOrder(),a=t.getClipMask();for(let c of e){if(!c.footprint)continue;let m=g2(c.footprint.min,c.footprint.max,c.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:c.id,footprint:c.footprint,order:n,clipMask:a})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||e0(e.min,n.min)||e0(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){let n=this._activeRegions[e],a=this._prevRegions[e];t=n.priority!==a.priority||!f2(n,a)||n.order!==a.order||n.clipMask!==a.clipMask,++e}}if(t){++this._updateTime;for(let n of this._activeRegions)n.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));let e=n=>{let a=this._activeRegions;if(n>=a.length)return n;let c=a[n].priority;for(;n<a.length&&a[n].priority===c;)++n;return n};if(this._sourceIds.length>1){let n=0,a=e(n);for(;n!==a;){let c=n,m=n;for(;c!==a;){let p=this._activeRegions[c];p.hiddenByOverlap=!1;for(let b=0;b<m;b++){let y=this._activeRegions[b];if(!y.hiddenByOverlap&&p.order===1/0&&zv(p,y)&&(p.hiddenByOverlap=b2(p.footprint,p.tileId,y.footprint,y.tileId),p.hiddenByOverlap))break}++c}n=a,a=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},i.cp=Lc,i.cq=w0,i.cr=mf,i.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new Xa,a=new wr,c=[],m=t+1+2,p=e[0]+1,b=e[0]+1+(1+e.length),y=(w,M,T)=>{let E=w===m-1?w-2:w===0?w:w-1;return E+=T?24575:0,[E,M]};for(let w=0;w<m;++w)n.emplaceBack(...y(w,0,!0));for(let w=0;w<p;++w)for(let M=0;M<m;++M)n.emplaceBack(...y(M,w,(M===0||M===m-1)&&!0));for(let w=0;w<e.length;++w){let M=e[w];for(let T=0;T<m;++T)n.emplaceBack(...y(T,M,!0))}for(let w=0;w<e.length;++w){let M=a.length,T=e[w]+1+2,E=new wr;for(let F=0;F<T-1;F++){let B=F===T-2,W=B?m*(b-e.length+w-F):m;for(let J=0;J<m-1;J++){let ee=F*m+J;F===0||B||J===0||J===m-2?(E.emplaceBack(ee+1,ee,ee+W),E.emplaceBack(ee+W,ee+W+1,ee+1)):(a.emplaceBack(ee+1,ee,ee+W),a.emplaceBack(ee+W,ee+W+1,ee+1))}}let P=An.simpleSegment(0,M,n.length,a.length-M);for(let F=0;F<E.uint16.length;F+=3)a.emplaceBack(E.uint16[F],E.uint16[F+1],E.uint16[F+2]);let R=An.simpleSegment(0,M,n.length,a.length-M);c.push({withoutSkirts:P,withSkirts:R})}return{vertices:n,indices:a,segments:c}}_createGrid(t){let e=this._fillGridMeshWithLods(qu,hv);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,yf.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new wr;for(let p=0;p<=qu;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new _h,a=new _h,c=new _h,m=new _h;this._poleSegments=[];for(let p=0,b=0;p<dv;p++){let y=360/(1<<p);n.emplaceBack(0,-fo,0,.5,0),a.emplaceBack(0,-fo,0,.5,1),c.emplaceBack(0,-fo,0,.5,.5),m.emplaceBack(0,-fo,0,.5,.5);for(let w=0;w<=qu;w++){let M=w/qu,T=0,E=Wt(0,y,M),[P,R,F]=$u(UA,HA,E,fo);n.emplaceBack(P,R,F,M,T),a.emplaceBack(P,R,F,M,1-T);let B=Ti(E);M=.5+.5*Math.sin(B),T=.5+.5*Math.cos(B),c.emplaceBack(P,R,F,M,T),m.emplaceBack(P,R,F,M,1-T)}this._poleSegments.push(An.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,U_,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,U_,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(c,U_,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(m,U_,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},i.ct=function(t){return $d.has(t)},i.cu=I2,i.cv=function(t,e,n=0,a=!0){let c=new yt(n,n),m=t.sub(c),p=e.add(c),b=[m,new yt(p.x,m.y),p,new yt(m.x,p.y)];return a&&b.push(m.clone()),b},i.cw=function(t,e){let n=[];for(let a=0;a<t.length;a++){let c=sl(a-1,-1,t.length-1),m=sl(a+1,-1,t.length-1),p=t[a],b=t[m],y=t[c].sub(p).unit(),w=b.sub(p).unit(),M=w.angleWithSep(y.x,y.y),T=y.add(w).unit().mult(-1*e/Math.sin(M/2));n.push(p.add(T))}return n},i.cx=AS,i.cy=LC,i.cz=function(t,e,n=0){return i._.fromValues(((e.x-n)*t.scale-t.x)*pt,(e.y*t.scale-t.y)*pt,TC(e.z,e.y))},i.d=wu,i.d$=ou,i.d0=Fd,i.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.d2=dc,i.d3=EC,i.d4=yh,i.d5=function([t,e,n]){let a=Math.hypot(t,e,n),c=Math.atan2(t,n),m=.5*Math.PI-Math.acos(-e/a);return new Oi(Br(c),Br(m))},i.d6=Ao,i.d7=Yu,i.d8=I,i.d9=Ev,i.dA=function(t){let e=Hg();if(!e)return;let n=e.delete(Ug);t&&n.catch(t).then(()=>t())},i.dB=Hf,i.dC=uM,i.dD=function(t){gx=kr.resolveURL(t),pm||(pm=new px(A0(),new ul)),pm.broadcast("setDracoUrl",gx)},i.dE=mM,i.dF=function(t){mm=kr.resolveURL(t),pm||(pm=new px(A0(),new ul)),pm.broadcast("setMeshoptUrl",mm)},i.dG=zo,i.dH=ne,i.dI=Wc,i.dJ=es,i.dK=Sh,i.dL=rv,i.dM=J2,i.dN=aS,i.dO=q2,i.dP=uc,i.dQ=wS,i.dR=cm,i.dS=function(t,e,n,a,c,m,p,b,y,w,M){t.createArrays(),t.tilePixelRatio=pt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let T=t.layers[0].layout,E=t.layers[0]._unevaluatedLayout._values,P={};if(t.textSizeData.kind==="composite"){let{minZoom:W,maxZoom:J}=t.textSizeData;P.compositeTextSizes=[E["text-size"].possiblyEvaluate(new Qt(W),b),E["text-size"].possiblyEvaluate(new Qt(J),b)]}if(t.iconSizeData.kind==="composite"){let{minZoom:W,maxZoom:J}=t.iconSizeData;P.compositeIconSizes=[E["icon-size"].possiblyEvaluate(new Qt(W),b),E["icon-size"].possiblyEvaluate(new Qt(J),b)]}P.layoutTextSize=E["text-size"].possiblyEvaluate(new Qt(y+1),b),P.layoutIconSize=E["icon-size"].possiblyEvaluate(new Qt(y+1),b),P.textMaxSize=E["text-size"].possiblyEvaluate(new Qt(18),b);let R=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",F=T.get("text-size"),B=!1;for(let W of t.features)if(W.icon&&W.icon.nameSecondary){B=!0;break}for(let W of t.features){let J=T.get("text-font").evaluate(W,{},b).join(","),ee=F.evaluate(W,{},b),te=P.layoutTextSize.evaluate(W,{},b),me=(P.layoutIconSize.evaluate(W,{},b),{horizontal:{},vertical:void 0}),he=W.text,ve,Ce=[0,0];if(he){let ze=he.toString(),$e=T.get("text-letter-spacing").evaluate(W,{},b)*jr,rt=T.get("text-line-height").evaluate(W,{},b)*jr,We=Be(ze)?$e:0,et=T.get("text-anchor").evaluate(W,{},b),He=T.get("text-variable-anchor");if(!He){let ot=T.get("text-radial-offset").evaluate(W,{},b);Ce=ot?TS(et,[ot*jr,Yv]):T.get("text-offset").evaluate(W,{},b).map(dt=>dt*jr)}let tt=R?"center":T.get("text-justify").evaluate(W,{},b),st=T.get("symbol-placement")==="point",nt=st?T.get("text-max-width").evaluate(W,{},b)*jr:1/0,Mt=ot=>{t.allowVerticalPlacement&&Re(ze)&&(me.vertical=Wv(he,e,n,c,J,nt,rt,et,ot,We,Ce,ua.vertical,!0,te,ee))};if(!R&&He){let ot=tt==="auto"?He.map(Nt=>Zv(Nt)):[tt],dt=!1;for(let Nt=0;Nt<ot.length;Nt++){let Ft=ot[Nt];if(!me.horizontal[Ft])if(dt)me.horizontal[Ft]=me.horizontal[0];else{let Pt=Wv(he,e,n,c,J,nt,rt,"center",Ft,We,Ce,ua.horizontal,!1,te,ee);Pt&&(me.horizontal[Ft]=Pt,dt=Pt.positionedLines.length===1)}}Mt("left")}else{if(tt==="auto"&&(tt=Zv(et)),st||T.get("text-writing-mode").indexOf("horizontal")>=0||!Re(ze)){let ot=Wv(he,e,n,c,J,nt,rt,et,tt,We,Ce,ua.horizontal,!1,te,ee);ot&&(me.horizontal[tt]=ot)}Mt(st?"left":tt)}}let De=!1;if(W.icon&&W.icon.namePrimary){let ze=a[W.icon.namePrimary];ze&&(ve=TO(c[W.icon.namePrimary],W.icon.nameSecondary?c[W.icon.nameSecondary]:void 0,T.get("icon-offset").evaluate(W,{},b),T.get("icon-anchor").evaluate(W,{},b)),De=ze.sdf,t.sdfIcons===void 0?t.sdfIcons=ze.sdf:t.sdfIcons!==ze.sdf&&qn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ze.pixelRatio!==t.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Ue=ES(me.horizontal)||me.vertical;t.iconsInText||(t.iconsInText=!!Ue&&Ue.iconsInText),(Ue||ve)&&RO(t,W,me,ve,a,P,te,0,Ce,De,p,b,w,M,B)}m&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},i.dT=r0,i.dU=X_,i.dV=Fv,i.dW=im,i.dX=t0,i.dY=ax,i.dZ=K_,i.d_=Q_,i.da=ZC,i.db=function(t){let e=[0,0,0],n=i.ad.identity(new Float64Array(16));return i.ad.multiply(n,t.pixelMatrix,t.globeMatrix),i._.transformMat4(e,e,n),new yt(e[0],e[1])},i.dc=ke,i.dd=xe,i.de=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(du==null){let a=n.navigator?n.navigator.userAgent:null;du=!!n.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return du}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.df=au,i.dg=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ep,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!N(t))return t;let n=ra(t);return n.params.push(`sdk=js-${_}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!N(t))return t;let n=ra(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!N(t))return t;let n=ra(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,a){if(!N(t))return t;let c=ra(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),n&&c.params.push(`language=${n}`),a&&c.params.push(`worldview=${a}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,a){let c=ra(t);return N(t)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||a)):(c.path+=`${e}${n}`,_c(c))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!N(t))return t;let a=ra(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&a.authority!=="raster"&&n===512?"@2x":""}${gu.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${I.RASTER_URL_PREFIX}${a.path}`:a.authority==="rasterarrays"?a.path=`/${I.RASTERARRAYS_URL_PREFIX}${a.path}`:a.authority==="3dtiles"?a.path=`/${I.TILES3D_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${I.TILE_URL_VERSION}${a.path}`);let c=this._customAccessToken||function(m){for(let p of m){let b=p.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(a.params)||I.ACCESS_TOKEN;return I.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,c)}canonicalizeTileURL(t,e){let n=ra(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+=`raster/${n.path.replace(`/${I.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?a+=`rasterarrays/${n.path.replace(`/${I.RASTERARRAYS_URL_PREFIX}/`,"")}`:a+=`tiles/${n.path.replace(`/${I.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(m=>!m.match(/^access_token=/))),c.length&&(a+=`?${c.join("&")}`),a}canonicalizeTileset(t,e){let n=!!e&&N(e),a=[];for(let c of t.tiles||[])O(c)?a.push(this.canonicalizeTileURL(c,n)):a.push(c);return a}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=ra(I.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){let c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(a.path!=="/"&&(t.path=`${a.path}${t.path}`),!I.REQUIRE_ACCESS_TOKEN)return _c(t);if(e=e||I.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),_c(t)}},i.dh=function(t,e){e?$d.add(t):$d.delete(t)},i.di=gu,i.dj=My,i.dk=xu,i.dl=Dp,i.dm=Yg,i.dn=Sy,i.dp=function(t){$d.delete(t)},i.dq=bc,i.dr=qd,i.ds=hc,i.dt=_,i.du=function(t,e){wp=t,Cp=e},i.dv=function(t,e,n=!1){if(it===ft||it===_t||it===kt)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ge=kr.resolveURL(t),it=ft,bt=e,ri(),n||Ii()},i.dw=gi,i.dx=function(){A0().acquire(fx)},i.dy=function(){let t=Gf;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(fx),Gf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dz=Wf,i.e=kr,i.e0=eS,i.e1=Xe,i.e2=dl,i.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==fM){let n=new Uint32Array(t,0,7),[,,a,c,m,p]=n;e=n.byteLength+c+m+p+m,(a!==t.byteLength||e>=t.byteLength)&&qn("Invalid b3dm header information.")}return yM(t,e)},i.e4=function(t,e){let n=xM(t);for(let a of n){for(let c of a.meshes)YR(c);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(ZR(a.lights,e)))}return n},i.e5=L0,i.e6=hM,i.e7=Ji,i.e8=function(t){jd(),Ga&&Ga.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-t;a++)e.delete(n[a])})})},i.f=Jr,i.g=function(t,e){return Ud(Nr(t,{type:"json"}),e)},i.h=Ms,i.i=ha,i.j=xS,i.k=qv,i.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>yM(e,0,t))},i.m=class extends E0{},i.n=pl,i.o=Lp,i.p=YO,i.q=ju,i.r=f,i.s=r,i.t=z,i.u=Eo,i.v=Ir,i.w=qn,i.x=Y,i.y=U,i.z=Au}),o(["./shared"],function(i){function _(Se){let G=Se?Se.url.toString():void 0;return G?performance.getEntriesByName(G):[]}function C(Se){if(typeof Se=="number"||typeof Se=="boolean"||typeof Se=="string"||Se==null)return JSON.stringify(Se);if(Array.isArray(Se)){let K="[";for(let ce of Se)K+=`${C(ce)},`;return`${K}]`}let G="{";for(let K of Object.keys(Se).sort())G+=`${K}:${C(Se[K])},`;return`${G}}`}function I(Se){let G="";for(let K of i.cE)G+=`/${C(Se[K])}`;return G}class O{constructor(G){this.keyCache={},this._layers={},this._layerConfigs={},G&&this.replace(G)}replace(G,K){this._layerConfigs={},this._layers={},this.update(G,[],K)}update(G,K,ce){this._options=ce;for(let be of G)this._layerConfigs[be.id]=be,(this._layers[be.id]=i.cY(be,this.scope,null,this._options)).compileFilter(),this.keyCache[be.id]&&delete this.keyCache[be.id];for(let be of K)delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be];this.familiesBySource={};let _e=function(be,Ee){let Ne={};for(let je=0;je<be.length;je++){let mt=Ee&&Ee[be[je].id]||I(be[je]);Ee&&(Ee[be[je].id]=mt);let at=Ne[mt];at||(at=Ne[mt]=[]),at.push(be[je])}let Te=[];for(let je in Ne)Te.push(Ne[je]);return Te}(i.dG(this._layerConfigs),this.keyCache);for(let be of _e){let Ee=be.map(Ot=>this._layers[Ot.id]),Ne=Ee[0];if(Ne.visibility==="none")continue;let Te=Ne.source||"",je=this.familiesBySource[Te];je||(je=this.familiesBySource[Te]={});let mt=Ne.sourceLayer||"_geojsonTileLayer",at=je[mt];at||(at=je[mt]=[]),at.push(Ee)}}}let N=1*i.dJ;class q{constructor(G){let K={},ce=[];for(let Ne in G){let Te=G[Ne],je=K[Ne]={};for(let mt in Te.glyphs){let at=Te.glyphs[+mt];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;let Ot=at.metrics.localGlyph?N:1,$t={x:0,y:0,w:at.bitmap.width+2*Ot,h:at.bitmap.height+2*Ot};ce.push($t),je[mt]=$t}}let{w:_e,h:be}=i.j(ce),Ee=new i.dI({width:_e||1,height:be||1});for(let Ne in G){let Te=G[Ne];for(let je in Te.glyphs){let mt=Te.glyphs[+je];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;let at=K[Ne][je],Ot=mt.metrics.localGlyph?N:1;i.dI.copy(mt.bitmap,Ee,{x:0,y:0},{x:at.x+Ot,y:at.y+Ot},mt.bitmap)}}this.image=Ee,this.positions=K}}i.dH(q,"GlyphAtlas");class ie{constructor(G){this.tileID=new i.aL(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.lut=G.lut,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.scope=G.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.promoteId=G.promoteId,this.isSymbolTile=G.isSymbolTile,this.tileTransform=i.dK(G.tileID.canonical,G.projection),this.projection=G.projection,this.brightness=G.brightness,this.extraShadowCaster=!!G.extraShadowCaster,this.tessellationStep=G.tessellationStep}parse(G,K,ce,_e,be){this.status="parsing",this.data=G,this.collisionBoxArray=new i.dL;let Ee=new i.dM(Object.keys(G.layers).sort()),Ne=new i.dN(this.tileID,this.promoteId);Ne.bucketLayerIDs=[];let Te={},je=new i.dO(256,256),mt={featureIndex:Ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:je,availableImages:ce,brightness:this.brightness},at=K.familiesBySource[this.source];for(let At in at){let Cn=G.layers[At];if(!Cn)continue;let Ki=!1,Di=!1,Gn=!1;for(let Fr of at[At])Fr[0].type==="symbol"?Ki=!0:Di=!0,Fr[0].is3D()&&Fr[0].type!=="model"&&(Gn=!0);if(this.extraShadowCaster&&!Gn||this.isSymbolTile===!0&&!Ki||this.isSymbolTile===!1&&!Di)continue;Cn.version===1&&i.w(`Vector tile source "${this.source}" layer "${At}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Sn=Ee.encode(At),or=[];for(let Fr=0;Fr<Cn.length;Fr++){let zr=Cn.feature(Fr),rl=Ne.getId(zr,At);or.push({feature:zr,id:rl,index:Fr,sourceLayerIndex:Sn})}for(let Fr of at[At]){let zr=Fr[0];(!this.extraShadowCaster||zr.is3D()&&zr.type!=="model")&&(this.isSymbolTile!==void 0&&zr.type==="symbol"!==this.isSymbolTile||zr.minzoom&&this.zoom<Math.floor(zr.minzoom)||zr.maxzoom&&this.zoom>=zr.maxzoom||zr.visibility!=="none"&&(de(Fr,this.zoom,mt.brightness,ce),(Te[zr.id]=zr.createBucket({index:Ne.bucketLayerIDs.length,layers:Fr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Sn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(or,mt,this.tileID.canonical,this.tileTransform),Ne.bucketLayerIDs.push(Fr.map(rl=>rl.id))))}}let Ot,$t,mi,fi;je.trim();let ii={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ki=()=>{if(Ot)return this.status="done",be(Ot);if(this.extraShadowCaster)this.status="done",be(null,{buckets:i.dG(Te).filter(At=>!At.isEmpty()),featureIndex:Ne,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:mt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if($t&&mi&&fi){let At=new q($t),Cn=new i.dQ(mi,fi,this.lut);for(let Ki in Te){let Di=Te[Ki];Di instanceof i.dR?(de(Di.layers,this.zoom,mt.brightness,ce),i.dS(Di,$t,At.positions,mi,Cn.iconPositions,this.showCollisionBoxes,ce,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Di.hasPattern&&(Di instanceof i.dT||Di instanceof i.dU||Di instanceof i.b_)&&(de(Di.layers,this.zoom,mt.brightness,ce),Di.addFeatures(mt,this.tileID.canonical,Cn.patternPositions,ce,this.tileTransform,this.brightness))}this.status="done",be(null,{buckets:i.dG(Te).filter(Ki=>!Ki.isEmpty()),featureIndex:Ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:At.image,lineAtlas:je,imageAtlas:Cn,brightness:mt.brightness})}};if(!this.extraShadowCaster){let At=i.dP(mt.glyphDependencies,Di=>Object.keys(Di).map(Number));Object.keys(At).length?_e.send("getGlyphs",{uid:this.uid,stacks:At,scope:this.scope},(Di,Gn)=>{Ot||(Ot=Di,$t=Gn,ki())},void 0,!1,ii):$t={};let Cn=Object.keys(mt.iconDependencies);Cn.length?_e.send("getImages",{icons:Cn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Di,Gn)=>{Ot||(Ot=Di,mi=Gn,ki())},void 0,!1,ii):mi={};let Ki=Object.keys(mt.patternDependencies);Ki.length?_e.send("getImages",{icons:Ki,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Di,Gn)=>{Ot||(Ot=Di,fi=Gn,ki())},void 0,!1,ii):fi={}}ki()}}function de(Se,G,K,ce){let _e=new i.X(G,{brightness:K});for(let be of Se)be.recalculate(_e,ce)}class xe extends i.E{constructor(G,K,ce,_e,be,Ee){super(),this.actor=G,this.layerIndex=K,this.availableImages=ce,this.loadVectorData=be||i.ap,this.loading={},this.loaded={},this.deduped=new i.ao(G.scheduler),this.isSpriteLoaded=_e,this.scheduler=G.scheduler,this.brightness=Ee}loadTile(G,K){let ce=G.uid,_e=G&&G.request,be=_e&&_e.collectResourceTiming,Ee=this.loading[ce]=new ie(G);Ee.abort=this.loadVectorData(G,(Ne,Te)=>{let je=!this.loading[ce];if(delete this.loading[ce],je||Ne||!Te)return Ee.status="done",je||(this.loaded[ce]=Ee),K(Ne);let mt=Te.rawData,at={};Te.expires&&(at.expires=Te.expires),Te.cacheControl&&(at.cacheControl=Te.cacheControl),Ee.vectorTile=Te.vectorTile||new i.dV(new i.dW(mt));let Ot=()=>{Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,($t,mi)=>{if($t||!mi)return K($t);let fi={};if(be){let ii=_(_e);ii.length>0&&(fi.resourceTiming=JSON.parse(JSON.stringify(ii)))}K(null,i.W({rawTileData:mt.slice(0)},mi,at,fi))})};this.isSpriteLoaded?Ot():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Ot,{type:"parseTile",isSymbolTile:G.isSymbolTile,zoom:G.tileZoom}):Ot()}),this.loaded=this.loaded||{},this.loaded[ce]=Ee})}reloadTile(G,K){let ce=this.loaded,_e=G.uid;if(ce&&ce[_e]){let be=ce[_e];be.showCollisionBoxes=G.showCollisionBoxes,be.projection=G.projection,be.brightness=G.brightness,be.tileTransform=i.dK(G.tileID.canonical,G.projection),be.extraShadowCaster=G.extraShadowCaster,be.lut=G.lut;let Ee=(Ne,Te)=>{let je=be.reloadCallback;je&&(delete be.reloadCallback,be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,je)),K(Ne,Te)};be.status==="parsing"?be.reloadCallback=Ee:be.status==="done"&&(be.vectorTile?be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,Ee):Ee())}else K(null,void 0)}abortTile(G,K){let ce=G.uid,_e=this.loading[ce];_e&&(_e.abort&&_e.abort(),delete this.loading[ce]),K()}removeTile(G,K){let ce=this.loaded,_e=G.uid;ce&&ce[_e]&&delete ce[_e],K()}}class ke{loadTile(G,K){let{uid:ce,encoding:_e,rawImageData:be,padding:Ee}=G,Ne=ImageBitmap&&be instanceof ImageBitmap?this.getImageData(be,Ee):be;K(null,new i.dX(ce,Ne,_e,Ee<1))}getImageData(G,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);let ce=this.offscreenCanvasContext.getImageData(-K,-K,G.width+2*K,G.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}class Ae{decodeRasterArray({task:G,buffer:K},ce){i.dY.performDecoding(K,G).then(_e=>{ce(null,_e)},_e=>{ce(_e)})}}let Xe=i.dZ.prototype.toGeoJSON,qe=class{constructor(Se){this._feature=Se,this.extent=i.a3,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){let Se=[];for(let G of this._feature.geometry)Se.push([new i.P(G[0],G[1])]);return Se}{let Se=[];for(let G of this._feature.geometry){let K=[];for(let ce of G)K.push(new i.P(ce[0],ce[1]));Se.push(K)}return Se}}toGeoJSON(Se,G,K){return Xe.call(this,Se,G,K)}},ht=class{constructor(Se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.a3,this.length=Se.length,this._features=Se}feature(Se){return new qe(this._features[Se])}},Tt=64/4096;class vt{constructor(){this.features=new Map}clear(){this.features.clear()}load(G=[],K){for(let ce of G){let _e=ce.id;if(_e==null)continue;let be=this.features.get(_e);be&&this.updateCache(be,K),ce.geometry?(be=Ut(ce),this.updateCache(be,K),this.features.set(_e,be)):this.features.delete(_e),this.updateCache(be,K)}}updateCache(G,K){for(let{canonical:ce,uid:_e}of Object.values(K)){let{z:be,x:Ee,y:Ne}=ce;Et(G,Math.pow(2,be),Ee,Ne)&&delete K[_e]}}getTile(G,K,ce){let _e=Math.pow(2,G),be=[];for(let Ee of this.features.values())Et(Ee,_e,K,ce)&&be.push(Si(Ee,_e,K,ce));return{features:be}}getFeatures(){return[...this.features.values()]}}function Et({minX:Se,minY:G,maxX:K,maxY:ce},_e,be,Ee){return Se<(be+1+Tt)/_e&&G<(Ee+1+Tt)/_e&&K>(be-Tt)/_e&&ce>(Ee-Tt)/_e}function Ut(Se){let{id:G,geometry:K,properties:ce}=Se;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:_e,coordinates:be}=K,Ee={id:G,type:1,geometry:[],tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ne=Ee.geometry;if(_e==="Point")xt(be,Ne,Ee);else if(_e==="MultiPoint")for(let Te of be)xt(Te,Ne,Ee);else if(_e==="LineString")Ee.type=2,Yt(be,Ne,Ee);else if(_e==="MultiLineString")Ee.type=2,zt(be,Ne,Ee);else if(_e==="Polygon")Ee.type=3,zt(be,Ne,Ee,!0);else{if(_e!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ee.type=3;for(let Te of be)zt(Te,Ne,Ee,!0)}return Ee}function xt([Se,G],K,ce){let _e=i.aj(Se),be=i.ak(G);be=be<0?0:be>1?1:be,K.push(_e,be),ce.minX=Math.min(ce.minX,_e),ce.minY=Math.min(ce.minY,be),ce.maxX=Math.max(ce.maxX,_e),ce.maxY=Math.max(ce.maxY,be)}function Yt(Se,G,K,ce=!1,_e=!1){let be=[];for(let Ee of Se)xt(Ee,be,K);G.push(be),ce&&function(Ee,Ne){let Te=0;for(let je=0,mt=Ee.length,at=mt-2;je<mt;at=je,je+=2)Te+=(Ee[je]-Ee[at])*(Ee[je+1]+Ee[at+1]);if(Te>0===Ne)for(let je=0,mt=Ee.length;je<mt/2;je+=2){let at=Ee[je],Ot=Ee[je+1];Ee[je]=Ee[mt-2-je],Ee[je+1]=Ee[mt-1-je],Ee[mt-2-je]=at,Ee[mt-1-je]=Ot}}(be,_e)}function zt(Se,G,K,ce=!1){for(let _e=0;_e<Se.length;_e++)Yt(Se[_e],G,K,ce,_e===0)}function Si(Se,G,K,ce){let{id:_e,type:be,geometry:Ee,tags:Ne}=Se,Te=[];if(be===1)Ui(Ee,G,K,ce,Te);else for(let je of Ee)Te.push(Ui(je,G,K,ce));return{id:_e,type:be,geometry:Te,tags:Ne}}function Ui(Se,G,K,ce,_e=[]){for(let be=0;be<Se.length;be+=2)_e.push(rr(Se[be],Se[be+1],G,K,ce));return _e}function rr(Se,G,K,ce,_e){return[Math.round(i.a3*(Se*K-ce)),Math.round(i.a3*(G*K-_e))]}var bi={exports:{}},cn=i.d$,en=i.d_.VectorTileFeature,zn=Lr;function Lr(Se,G){this.options=G||{},this.features=Se,this.length=Se.length}function Hn(Se,G){this.id=typeof Se.id=="number"?Se.id:void 0,this.type=Se.type,this.rawGeometry=Se.type===1?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=G||4096}Lr.prototype.feature=function(Se){return new Hn(this.features[Se],this.options.extent)},Hn.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var G=0;G<Se.length;G++){for(var K=Se[G],ce=[],_e=0;_e<K.length;_e++)ce.push(new cn(K[_e][0],K[_e][1]));this.geometry.push(ce)}return this.geometry},Hn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,G=1/0,K=-1/0,ce=1/0,_e=-1/0,be=0;be<Se.length;be++)for(var Ee=Se[be],Ne=0;Ne<Ee.length;Ne++){var Te=Ee[Ne];G=Math.min(G,Te.x),K=Math.max(K,Te.x),ce=Math.min(ce,Te.y),_e=Math.max(_e,Te.y)}return[G,ce,K,_e]},Hn.prototype.toGeoJSON=en.prototype.toGeoJSON;var Mi=i.e0,ta=zn;function Wn(Se){var G=new Mi;return function(K,ce){for(var _e in K.layers)ce.writeMessage(3,ga,K.layers[_e])}(Se,G),G.finish()}function ga(Se,G){var K;G.writeVarintField(15,Se.version||1),G.writeStringField(1,Se.name||""),G.writeVarintField(5,Se.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<Se.length;K++)ce.feature=Se.feature(K),G.writeMessage(2,Oo,ce);var _e=ce.keys;for(K=0;K<_e.length;K++)G.writeStringField(3,_e[K]);var be=ce.values;for(K=0;K<be.length;K++)G.writeMessage(4,Qh,be[K])}function Oo(Se,G){var K=Se.feature;K.id!==void 0&&G.writeVarintField(1,K.id),G.writeMessage(2,_a,Se),G.writeVarintField(3,K.type),G.writeMessage(4,wn,K)}function _a(Se,G){var K=Se.feature,ce=Se.keys,_e=Se.values,be=Se.keycache,Ee=Se.valuecache;for(var Ne in K.properties){var Te=K.properties[Ne],je=be[Ne];if(Te!==null){je===void 0&&(ce.push(Ne),be[Ne]=je=ce.length-1),G.writeVarint(je);var mt=typeof Te;mt!=="string"&&mt!=="boolean"&&mt!=="number"&&(Te=JSON.stringify(Te));var at=mt+":"+Te,Ot=Ee[at];Ot===void 0&&(_e.push(Te),Ee[at]=Ot=_e.length-1),G.writeVarint(Ot)}}}function Gt(Se,G){return(G<<3)+(7&Se)}function Yl(Se){return Se<<1^Se>>31}function wn(Se,G){for(var K=Se.loadGeometry(),ce=Se.type,_e=0,be=0,Ee=K.length,Ne=0;Ne<Ee;Ne++){var Te=K[Ne],je=1;ce===1&&(je=Te.length),G.writeVarint(Gt(1,je));for(var mt=ce===3?Te.length-1:Te.length,at=0;at<mt;at++){at===1&&ce!==1&&G.writeVarint(Gt(2,mt-1));var Ot=Te[at].x-_e,$t=Te[at].y-be;G.writeVarint(Yl(Ot)),G.writeVarint(Yl($t)),_e+=Ot,be+=$t}ce===3&&G.writeVarint(Gt(7,1))}}function Qh(Se,G){var K=typeof Se;K==="string"?G.writeStringField(1,Se):K==="boolean"?G.writeBooleanField(7,Se):K==="number"&&(Se%1!=0?G.writeDoubleField(3,Se):Se<0?G.writeSVarintField(6,Se):G.writeVarintField(5,Se))}bi.exports=Wn,bi.exports.fromVectorTileJs=Wn,bi.exports.fromGeojsonVt=function(Se,G){G=G||{};var K={};for(var ce in Se)K[ce]=new ta(Se[ce].features,G),K[ce].name=ce,K[ce].version=G.version,K[ce].extent=G.extent;return Wn({layers:K})},bi.exports.GeoJSONWrapper=ta;var Kh=i.e1(bi.exports);let Jh={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},Md=Math.fround||(Zl=new Float32Array(1),Se=>(Zl[0]=+Se,Zl[0]));var Zl;let ia=3,na=5,kd=6;class Xt{constructor(G){this.options=Object.assign(Object.create(Jh),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){let{log:K,minZoom:ce,maxZoom:_e}=this.options;K&&console.time("total time");let be=`prepare ${G.length} points`;K&&console.time(be),this.points=G;let Ee=[];for(let Te=0;Te<G.length;Te++){let je=G[Te];if(!je.geometry)continue;let[mt,at]=je.geometry.coordinates,Ot=Md(uo(mt)),$t=Md(el(at));Ee.push(Ot,$t,1/0,Te,-1,1),this.options.reduce&&Ee.push(0)}let Ne=this.trees[_e+1]=this._createTree(Ee);K&&console.timeEnd(be);for(let Te=_e;Te>=ce;Te--){let je=+Date.now();Ne=this.trees[Te]=this._createTree(this._cluster(Ne,Te)),K&&console.log("z%d: %d clusters in %dms",Te,Ne.numItems,+Date.now()-je)}return K&&console.timeEnd("total time"),this}getClusters(G,K){let ce=((G[0]+180)%360+360)%360-180,_e=Math.max(-90,Math.min(90,G[1])),be=G[2]===180?180:((G[2]+180)%360+360)%360-180,Ee=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ce=-180,be=180;else if(ce>be){let at=this.getClusters([ce,_e,180,Ee],K),Ot=this.getClusters([-180,_e,be,Ee],K);return at.concat(Ot)}let Ne=this.trees[this._limitZoom(K)],Te=Ne.range(uo(ce),el(Ee),uo(be),el(_e)),je=Ne.data,mt=[];for(let at of Te){let Ot=this.stride*at;mt.push(je[Ot+na]>1?Kt(je,Ot,this.clusterProps):this.points[je[Ot+ia]])}return mt}getChildren(G){let K=this._getOriginId(G),ce=this._getOriginZoom(G),_e="No cluster with the specified id.",be=this.trees[ce];if(!be)throw new Error(_e);let Ee=be.data;if(K*this.stride>=Ee.length)throw new Error(_e);let Ne=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Te=be.within(Ee[K*this.stride],Ee[K*this.stride+1],Ne),je=[];for(let mt of Te){let at=mt*this.stride;Ee[at+4]===G&&je.push(Ee[at+na]>1?Kt(Ee,at,this.clusterProps):this.points[Ee[at+ia]])}if(je.length===0)throw new Error(_e);return je}getLeaves(G,K,ce){let _e=[];return this._appendLeaves(_e,G,K=K||10,ce=ce||0,0),_e}getTile(G,K,ce){let _e=this.trees[this._limitZoom(G)],be=Math.pow(2,G),{extent:Ee,radius:Ne}=this.options,Te=Ne/Ee,je=(ce-Te)/be,mt=(ce+1+Te)/be,at={features:[]};return this._addTileFeatures(_e.range((K-Te)/be,je,(K+1+Te)/be,mt),_e.data,K,ce,be,at),K===0&&this._addTileFeatures(_e.range(1-Te/be,je,1,mt),_e.data,be,ce,be,at),K===be-1&&this._addTileFeatures(_e.range(0,je,Te/be,mt),_e.data,-1,ce,be,at),at.features.length?at:null}getClusterExpansionZoom(G){let K=this._getOriginZoom(G)-1;for(;K<=this.options.maxZoom;){let ce=this.getChildren(G);if(K++,ce.length!==1)break;G=ce[0].properties.cluster_id}return K}_appendLeaves(G,K,ce,_e,be){let Ee=this.getChildren(K);for(let Ne of Ee){let Te=Ne.properties;if(Te&&Te.cluster?be+Te.point_count<=_e?be+=Te.point_count:be=this._appendLeaves(G,Te.cluster_id,ce,_e,be):be<_e?be++:G.push(Ne),G.length===ce)break}return be}_createTree(G){let K=new i.cK(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<G.length;ce+=this.stride)K.add(G[ce],G[ce+1]);return K.finish(),K.data=G,K}_addTileFeatures(G,K,ce,_e,be,Ee){for(let Ne of G){let Te=Ne*this.stride,je=K[Te+na]>1,mt,at,Ot;if(je)mt=Xl(K,Te,this.clusterProps),at=K[Te],Ot=K[Te+1];else{let fi=this.points[K[Te+ia]];mt=fi.properties;let[ii,ki]=fi.geometry.coordinates;at=uo(ii),Ot=el(ki)}let $t={type:1,geometry:[[Math.round(this.options.extent*(at*be-ce)),Math.round(this.options.extent*(Ot*be-_e))]],tags:mt},mi;mi=je||this.options.generateId?K[Te+ia]:this.points[K[Te+ia]].id,mi!==void 0&&($t.id=mi),Ee.features.push($t)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,K){let{radius:ce,extent:_e,reduce:be,minPoints:Ee}=this.options,Ne=ce/(_e*Math.pow(2,K)),Te=G.data,je=[],mt=this.stride;for(let at=0;at<Te.length;at+=mt){if(Te[at+2]<=K)continue;Te[at+2]=K;let Ot=Te[at],$t=Te[at+1],mi=G.within(Te[at],Te[at+1],Ne),fi=Te[at+na],ii=fi;for(let ki of mi){let At=ki*mt;Te[At+2]>K&&(ii+=Te[At+na])}if(ii>fi&&ii>=Ee){let ki,At=Ot*fi,Cn=$t*fi,Ki=-1,Di=(at/mt<<5)+(K+1)+this.points.length;for(let Gn of mi){let Sn=Gn*mt;if(Te[Sn+2]<=K)continue;Te[Sn+2]=K;let or=Te[Sn+na];At+=Te[Sn]*or,Cn+=Te[Sn+1]*or,Te[Sn+4]=Di,be&&(ki||(ki=this._map(Te,at,!0),Ki=this.clusterProps.length,this.clusterProps.push(ki)),be(ki,this._map(Te,Sn)))}Te[at+4]=Di,je.push(At/ii,Cn/ii,1/0,Di,-1,ii),be&&je.push(Ki)}else{for(let ki=0;ki<mt;ki++)je.push(Te[at+ki]);if(ii>1)for(let ki of mi){let At=ki*mt;if(!(Te[At+2]<=K)){Te[At+2]=K;for(let Cn=0;Cn<mt;Cn++)je.push(Te[At+Cn])}}}}return je}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,K,ce){if(G[K+na]>1){let Ee=this.clusterProps[G[K+kd]];return ce?Object.assign({},Ee):Ee}let _e=this.points[G[K+ia]].properties,be=this.options.map(_e);return ce&&be===_e?Object.assign({},be):be}}function Kt(Se,G,K){return{type:"Feature",id:Se[G+ia],properties:Xl(Se,G,K),geometry:{type:"Point",coordinates:[(ce=Se[G],360*(ce-.5)),Ql(Se[G+1])]}};var ce}function Xl(Se,G,K){let ce=Se[G+na],_e=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,be=Se[G+kd],Ee=be===-1?{}:Object.assign({},K[be]);return Object.assign(Ee,{cluster:!0,cluster_id:Se[G+ia],point_count:ce,point_count_abbreviated:_e})}function uo(Se){return Se/360+.5}function el(Se){let G=Math.sin(Se*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function Ql(Se){let G=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function Kl(Se,G,K,ce){let _e=ce,be=G+(K-G>>1),Ee,Ne=K-G,Te=Se[G],je=Se[G+1],mt=Se[K],at=Se[K+1];for(let Ot=G+3;Ot<K;Ot+=3){let $t=Td(Se[Ot],Se[Ot+1],Te,je,mt,at);if($t>_e)Ee=Ot,_e=$t;else if($t===_e){let mi=Math.abs(Ot-be);mi<Ne&&(Ee=Ot,Ne=mi)}}_e>ce&&(Ee-G>3&&Kl(Se,G,Ee,ce),Se[Ee+2]=_e,K-Ee>3&&Kl(Se,Ee,K,ce))}function Td(Se,G,K,ce,_e,be){let Ee=_e-K,Ne=be-ce;if(Ee!==0||Ne!==0){let Te=((Se-K)*Ee+(G-ce)*Ne)/(Ee*Ee+Ne*Ne);Te>1?(K=_e,ce=be):Te>0&&(K+=Ee*Te,ce+=Ne*Te)}return Ee=Se-K,Ne=G-ce,Ee*Ee+Ne*Ne}function vs(Se,G,K,ce){let _e={id:Se??null,type:G,geometry:K,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")tl(_e,K);else if(G==="Polygon")tl(_e,K[0]);else if(G==="MultiLineString")for(let be of K)tl(_e,be);else if(G==="MultiPolygon")for(let be of K)tl(_e,be[0]);return _e}function tl(Se,G){for(let K=0;K<G.length;K+=3)Se.minX=Math.min(Se.minX,G[K]),Se.minY=Math.min(Se.minY,G[K+1]),Se.maxX=Math.max(Se.maxX,G[K]),Se.maxY=Math.max(Se.maxY,G[K+1])}function Jl(Se,G,K,ce){if(!G.geometry)return;let _e=G.geometry.coordinates;if(_e&&_e.length===0)return;let be=G.geometry.type,Ee=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),Ne=[],Te=G.id;if(K.promoteId?Te=G.properties[K.promoteId]:K.generateId&&(Te=ce||0),be==="Point")Id(_e,Ne);else if(be==="MultiPoint")for(let je of _e)Id(je,Ne);else if(be==="LineString")ec(_e,Ne,Ee,!1);else if(be==="MultiLineString"){if(K.lineMetrics){for(let je of _e)Ne=[],ec(je,Ne,Ee,!1),Se.push(vs(Te,"LineString",Ne,G.properties));return}tc(_e,Ne,Ee,!1)}else if(be==="Polygon")tc(_e,Ne,Ee,!0);else{if(be!=="MultiPolygon"){if(be==="GeometryCollection"){for(let je of G.geometry.geometries)Jl(Se,{id:Te,geometry:je,properties:G.properties},K,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let je of _e){let mt=[];tc(je,mt,Ee,!0),Ne.push(mt)}}Se.push(vs(Te,be,Ne,G.properties))}function Id(Se,G){G.push(Ro(Se[0]),eu(Se[1]),0)}function ec(Se,G,K,ce){let _e,be,Ee=0;for(let Te=0;Te<Se.length;Te++){let je=Ro(Se[Te][0]),mt=eu(Se[Te][1]);G.push(je,mt,0),Te>0&&(Ee+=ce?(_e*mt-je*be)/2:Math.sqrt(Math.pow(je-_e,2)+Math.pow(mt-be,2))),_e=je,be=mt}let Ne=G.length-3;G[2]=1,Kl(G,0,Ne,K),G[Ne+2]=1,G.size=Math.abs(Ee),G.start=0,G.end=G.size}function tc(Se,G,K,ce){for(let _e=0;_e<Se.length;_e++){let be=[];ec(Se[_e],be,K,ce),G.push(be)}}function Ro(Se){return Se/360+.5}function eu(Se){let G=Math.sin(Se*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function Jt(Se,G,K,ce,_e,be,Ee,Ne){if(ce/=G,be>=(K/=G)&&Ee<ce)return Se;if(Ee<K||be>=ce)return null;let Te=[];for(let je of Se){let mt=je.geometry,at=je.type,Ot=_e===0?je.minX:je.minY,$t=_e===0?je.maxX:je.maxY;if(Ot>=K&&$t<ce){Te.push(je);continue}if($t<K||Ot>=ce)continue;let mi=[];if(at==="Point"||at==="MultiPoint")Ed(mt,mi,K,ce,_e);else if(at==="LineString")Bn(mt,mi,K,ce,_e,!1,Ne.lineMetrics);else if(at==="MultiLineString")il(mt,mi,K,ce,_e,!1);else if(at==="Polygon")il(mt,mi,K,ce,_e,!0);else if(at==="MultiPolygon")for(let fi of mt){let ii=[];il(fi,ii,K,ce,_e,!0),ii.length&&mi.push(ii)}if(mi.length){if(Ne.lineMetrics&&at==="LineString"){for(let fi of mi)Te.push(vs(je.id,at,fi,je.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(mi.length===1?(at="LineString",mi=mi[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=mi.length===3?"Point":"MultiPoint"),Te.push(vs(je.id,at,mi,je.tags))}}return Te.length?Te:null}function Ed(Se,G,K,ce,_e){for(let be=0;be<Se.length;be+=3){let Ee=Se[be+_e];Ee>=K&&Ee<=ce&&ba(G,Se[be],Se[be+1],Se[be+2])}}function Bn(Se,G,K,ce,_e,be,Ee){let Ne=ic(Se),Te=_e===0?ya:Dd,je,mt,at=Se.start;for(let ii=0;ii<Se.length-3;ii+=3){let ki=Se[ii],At=Se[ii+1],Cn=Se[ii+2],Ki=Se[ii+3],Di=Se[ii+4],Gn=_e===0?ki:At,Sn=_e===0?Ki:Di,or=!1;Ee&&(je=Math.sqrt(Math.pow(ki-Ki,2)+Math.pow(At-Di,2))),Gn<K?Sn>K&&(mt=Te(Ne,ki,At,Ki,Di,K),Ee&&(Ne.start=at+je*mt)):Gn>ce?Sn<ce&&(mt=Te(Ne,ki,At,Ki,Di,ce),Ee&&(Ne.start=at+je*mt)):ba(Ne,ki,At,Cn),Sn<K&&Gn>=K&&(mt=Te(Ne,ki,At,Ki,Di,K),or=!0),Sn>ce&&Gn<=ce&&(mt=Te(Ne,ki,At,Ki,Di,ce),or=!0),!be&&or&&(Ee&&(Ne.end=at+je*mt),G.push(Ne),Ne=ic(Se)),Ee&&(at+=je)}let Ot=Se.length-3,$t=Se[Ot],mi=Se[Ot+1],fi=_e===0?$t:mi;fi>=K&&fi<=ce&&ba(Ne,$t,mi,Se[Ot+2]),Ot=Ne.length-3,be&&Ot>=3&&(Ne[Ot]!==Ne[0]||Ne[Ot+1]!==Ne[1])&&ba(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&G.push(Ne)}function ic(Se){let G=[];return G.size=Se.size,G.start=Se.start,G.end=Se.end,G}function il(Se,G,K,ce,_e,be){for(let Ee of Se)Bn(Ee,G,K,ce,_e,be,!1)}function ba(Se,G,K,ce){Se.push(G,K,ce)}function ya(Se,G,K,ce,_e,be){let Ee=(be-G)/(ce-G);return ba(Se,be,K+(_e-K)*Ee,1),Ee}function Dd(Se,G,K,ce,_e,be){let Ee=(be-K)/(_e-K);return ba(Se,G+(ce-G)*Ee,be,1),Ee}function xs(Se,G){let K=[];for(let ce=0;ce<Se.length;ce++){let _e=Se[ce],be=_e.type,Ee;if(be==="Point"||be==="MultiPoint"||be==="LineString")Ee=ws(_e.geometry,G);else if(be==="MultiLineString"||be==="Polygon"){Ee=[];for(let Ne of _e.geometry)Ee.push(ws(Ne,G))}else if(be==="MultiPolygon"){Ee=[];for(let Ne of _e.geometry){let Te=[];for(let je of Ne)Te.push(ws(je,G));Ee.push(Te)}}K.push(vs(_e.id,be,Ee,_e.tags))}return K}function ws(Se,G){let K=[];K.size=Se.size,Se.start!==void 0&&(K.start=Se.start,K.end=Se.end);for(let ce=0;ce<Se.length;ce+=3)K.push(Se[ce]+G,Se[ce+1],Se[ce+2]);return K}function nc(Se,G){if(Se.transformed)return Se;let K=1<<Se.z,ce=Se.x,_e=Se.y;for(let be of Se.features){let Ee=be.geometry,Ne=be.type;if(be.geometry=[],Ne===1)for(let Te=0;Te<Ee.length;Te+=2)be.geometry.push(rc(Ee[Te],Ee[Te+1],G,K,ce,_e));else for(let Te=0;Te<Ee.length;Te++){let je=[];for(let mt=0;mt<Ee[Te].length;mt+=2)je.push(rc(Ee[Te][mt],Ee[Te][mt+1],G,K,ce,_e));be.geometry.push(je)}}return Se.transformed=!0,Se}function rc(Se,G,K,ce,_e,be){return[Math.round(K*(Se*ce-_e)),Math.round(K*(G*ce-be))]}function tu(Se,G,K,ce,_e){let be=G===_e.maxZoom?0:_e.tolerance/((1<<G)*_e.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:Se.length,source:null,x:K,y:ce,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ne of Se)oc(Ee,Ne,be,_e);return Ee}function oc(Se,G,K,ce){let _e=G.geometry,be=G.type,Ee=[];if(Se.minX=Math.min(Se.minX,G.minX),Se.minY=Math.min(Se.minY,G.minY),Se.maxX=Math.max(Se.maxX,G.maxX),Se.maxY=Math.max(Se.maxY,G.maxY),be==="Point"||be==="MultiPoint")for(let Ne=0;Ne<_e.length;Ne+=3)Ee.push(_e[Ne],_e[Ne+1]),Se.numPoints++,Se.numSimplified++;else if(be==="LineString")Lo(Ee,_e,Se,K,!1,!1);else if(be==="MultiLineString"||be==="Polygon")for(let Ne=0;Ne<_e.length;Ne++)Lo(Ee,_e[Ne],Se,K,be==="Polygon",Ne===0);else if(be==="MultiPolygon")for(let Ne=0;Ne<_e.length;Ne++){let Te=_e[Ne];for(let je=0;je<Te.length;je++)Lo(Ee,Te[je],Se,K,!0,je===0)}if(Ee.length){let Ne=G.tags||null;if(be==="LineString"&&ce.lineMetrics){Ne={};for(let je in G.tags)Ne[je]=G.tags[je];Ne.mapbox_clip_start=_e.start/_e.size,Ne.mapbox_clip_end=_e.end/_e.size}let Te={geometry:Ee,type:be==="Polygon"||be==="MultiPolygon"?3:be==="LineString"||be==="MultiLineString"?2:1,tags:Ne};G.id!==null&&(Te.id=G.id),Se.features.push(Te)}}function Lo(Se,G,K,ce,_e,be){let Ee=ce*ce;if(ce>0&&G.size<(_e?Ee:ce))return void(K.numPoints+=G.length/3);let Ne=[];for(let Te=0;Te<G.length;Te+=3)(ce===0||G[Te+2]>Ee)&&(K.numSimplified++,Ne.push(G[Te],G[Te+1])),K.numPoints++;_e&&function(Te,je){let mt=0;for(let at=0,Ot=Te.length,$t=Ot-2;at<Ot;$t=at,at+=2)mt+=(Te[at]-Te[$t])*(Te[at+1]+Te[$t+1]);if(mt>0===je)for(let at=0,Ot=Te.length;at<Ot/2;at+=2){let $t=Te[at],mi=Te[at+1];Te[at]=Te[Ot-2-at],Te[at+1]=Te[Ot-1-at],Te[Ot-2-at]=$t,Te[Ot-1-at]=mi}}(Ne,be),Se.push(Ne)}let Cs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Fo{constructor(G,K){let ce=(K=this.options=function(be,Ee){for(let Ne in Ee)be[Ne]=Ee[Ne];return be}(Object.create(Cs),K)).debug;if(ce&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let _e=function(be,Ee){let Ne=[];if(be.type==="FeatureCollection")for(let Te=0;Te<be.features.length;Te++)Jl(Ne,be.features[Te],Ee,Te);else Jl(Ne,be.type==="Feature"?be:{geometry:be},Ee);return Ne}(G,K);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),_e=function(be,Ee){let Ne=Ee.buffer/Ee.extent,Te=be,je=Jt(be,1,-1-Ne,Ne,0,-1,2,Ee),mt=Jt(be,1,1-Ne,2+Ne,0,-1,2,Ee);return(je||mt)&&(Te=Jt(be,1,-Ne,1+Ne,0,-1,2,Ee)||[],je&&(Te=xs(je,1).concat(Te)),mt&&(Te=Te.concat(xs(mt,-1)))),Te}(_e,K),_e.length&&this.splitTile(_e,0,0,0),ce&&(_e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,K,ce,_e,be,Ee,Ne){let Te=[G,K,ce,_e],je=this.options,mt=je.debug;for(;Te.length;){_e=Te.pop(),ce=Te.pop(),K=Te.pop(),G=Te.pop();let at=1<<K,Ot=Sr(K,ce,_e),$t=this.tiles[Ot];if(!$t&&(mt>1&&console.time("creation"),$t=this.tiles[Ot]=tu(G,K,ce,_e,je),this.tileCoords.push({z:K,x:ce,y:_e}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ce,_e,$t.numFeatures,$t.numPoints,$t.numSimplified),console.timeEnd("creation"));let or=`z${K}`;this.stats[or]=(this.stats[or]||0)+1,this.total++}if($t.source=G,be==null){if(K===je.indexMaxZoom||$t.numPoints<=je.indexMaxPoints)continue}else{if(K===je.maxZoom||K===be)continue;if(be!=null){let or=be-K;if(ce!==Ee>>or||_e!==Ne>>or)continue}}if($t.source=null,G.length===0)continue;mt>1&&console.time("clipping");let mi=.5*je.buffer/je.extent,fi=.5-mi,ii=.5+mi,ki=1+mi,At=null,Cn=null,Ki=null,Di=null,Gn=Jt(G,at,ce-mi,ce+ii,0,$t.minX,$t.maxX,je),Sn=Jt(G,at,ce+fi,ce+ki,0,$t.minX,$t.maxX,je);G=null,Gn&&(At=Jt(Gn,at,_e-mi,_e+ii,1,$t.minY,$t.maxY,je),Cn=Jt(Gn,at,_e+fi,_e+ki,1,$t.minY,$t.maxY,je),Gn=null),Sn&&(Ki=Jt(Sn,at,_e-mi,_e+ii,1,$t.minY,$t.maxY,je),Di=Jt(Sn,at,_e+fi,_e+ki,1,$t.minY,$t.maxY,je),Sn=null),mt>1&&console.timeEnd("clipping"),Te.push(At||[],K+1,2*ce,2*_e),Te.push(Cn||[],K+1,2*ce,2*_e+1),Te.push(Ki||[],K+1,2*ce+1,2*_e),Te.push(Di||[],K+1,2*ce+1,2*_e+1)}}getTile(G,K,ce){G=+G,K=+K,ce=+ce;let _e=this.options,{extent:be,debug:Ee}=_e;if(G<0||G>24)return null;let Ne=1<<G,Te=Sr(G,K=K+Ne&Ne-1,ce);if(this.tiles[Te])return nc(this.tiles[Te],be);Ee>1&&console.log("drilling down to z%d-%d-%d",G,K,ce);let je,mt=G,at=K,Ot=ce;for(;!je&&mt>0;)mt--,at>>=1,Ot>>=1,je=this.tiles[Sr(mt,at,Ot)];return je&&je.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",mt,at,Ot),console.time("drilling down")),this.splitTile(je.source,mt,at,Ot,G,K,ce),Ee>1&&console.timeEnd("drilling down"),this.tiles[Te]?nc(this.tiles[Te],be):null):null}}function Sr(Se,G,K){return 32*((1<<Se)*K+G)+Se}function iu(Se,G){let K=Se.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);let ce=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ce)return G(null,null);let _e=new ht(ce.features),be=Kh(_e);be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),G(null,{vectorTile:_e,rawData:be.buffer})}class nl extends xe{constructor(G,K,ce,_e,be,Ee){super(G,K,ce,_e,iu,Ee),be&&(this.loadGeoJSON=be),this._dynamicIndex=new vt}loadData(G,K){let ce=G&&G.request,_e=ce&&ce.collectResourceTiming;this.loadGeoJSON(G,(be,Ee)=>{if(be||!Ee)return K(be);if(typeof Ee!="object")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{try{if(G.filter){let Te=i.y(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Te.result==="error")throw new Error(Te.value.map(je=>`${je.key}: ${je.message}`).join(", "));Ee.features=Ee.features.filter(je=>Te.value.evaluate({zoom:0},je))}G.dynamic?(Ee.type==="Feature"&&(Ee={type:"FeatureCollection",features:[Ee]}),G.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ee.features,this.loaded),G.cluster&&(Ee.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=G.cluster?new Xt(function({superclusterOptions:Te,clusterProperties:je}){if(!je||!Te)return Te;let mt={},at={},Ot={accumulated:null,zoom:0},$t={properties:null},mi=Object.keys(je);for(let fi of mi){let[ii,ki]=je[fi],At=i.y(ki),Cn=i.y(typeof ii=="string"?[ii,["accumulated"],["get",fi]]:ii);mt[fi]=At.value,at[fi]=Cn.value}return Te.map=fi=>{$t.properties=fi;let ii={};for(let ki of mi)ii[ki]=mt[ki].evaluate(Ot,$t);return ii},Te.reduce=(fi,ii)=>{$t.properties=ii;for(let ki of mi)Ot.accumulated=fi[ki],fi[ki]=at[ki].evaluate(Ot,$t)},Te}(G)).load(Ee.features):G.dynamic?this._dynamicIndex:function(Te,je){return new Fo(Te,je)}(Ee,G.geojsonVtOptions)}catch(Te){return K(Te)}let Ne={};if(_e){let Te=_(ce);Te&&(Ne.resourceTiming={},Ne.resourceTiming[G.source]=JSON.parse(JSON.stringify(Te)))}K(null,Ne)}})}reloadTile(G,K){let ce=this.loaded;return ce&&ce[G.uid]?G.partial?K(null,void 0):super.reloadTile(G,K):this.loadTile(G,K)}loadGeoJSON(G,K){if(G.request)i.g(G.request,K);else{if(typeof G.data!="string")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(G.data))}catch{return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(ce){K(ce)}}getClusterChildren(G,K){try{K(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(ce){K(ce)}}getClusterLeaves(G,K){try{K(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(ce){K(ce)}}}class ac{constructor(G,K){this.tileID=new i.aL(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=G.projection,this.brightness=K}parse(G,K,ce,_e){this.status="parsing";let be=new i.aL(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),Ee={},Ne=K.familiesBySource[ce.source],Te=new i.dN(be,ce.promoteId);return Te.bucketLayerIDs=[],Te.is3DTile=!0,i.e3(G).then(je=>{if(!je)return _e(new Error("Could not parse tile"));let mt=i.e4(je,1/i.b5(ce.tileID.canonical)),at=je.json.extensionsUsed&&je.json.extensionsUsed.includes("MAPBOX_mesh_features")||je.json.asset.extras&&je.json.asset.extras.MAPBOX_mesh_features,Ot=je.json.extensionsUsed&&je.json.extensionsUsed.includes("EXT_meshopt_compression"),$t=new i.X(this.zoom,{brightness:this.brightness});for(let mi in Ne)for(let fi of Ne[mi]){let ii=fi[0];Te.bucketLayerIDs.push(fi.map(At=>At.id)),ii.recalculate($t,[]);let ki=new i.e5(mt,be,at,Ot,this.brightness,Te);at||(ki.needsUpload=!0),Ee[ii.fqid]=ki,ki.evaluate(ii)}this.status="done",_e(null,{buckets:Ee,featureIndex:Te})}).catch(je=>_e(new Error(je.message)))}}class Ad{constructor(G,K,ce,_e,be,Ee){this.actor=G,this.layerIndex=K,this.brightness=Ee,this.loading={},this.loaded={}}loadTile(G,K){let ce=G.uid,_e=this.loading[ce]=new ac(G,this.brightness);i.e2(G.request,(be,Ee)=>{let Ne=!this.loading[ce];return delete this.loading[ce],Ne||be?(_e.status="done",Ne||(this.loaded[ce]=_e),K(be)):Ee&&Ee.byteLength!==0?void _e.parse(Ee,this.layerIndex,G,(Te,je)=>{_e.status="done",this.loaded=this.loaded||{},this.loaded[ce]=_e,Te||!je?K(Te):K(null,je)}):(_e.status="done",this.loaded[ce]=_e,K())})}reloadTile(G,K){let ce=this.loaded,_e=G.uid;if(ce&&ce[_e]){let be=ce[_e];be.projection=G.projection,be.brightness=G.brightness;let Ee=(Ne,Te)=>{be.reloadCallback&&(delete be.reloadCallback,this.loadTile(G,K)),K(Ne,Te)};be.status==="parsing"?be.reloadCallback=Ee:be.status==="done"&&this.loadTile(G,K)}}abortTile(G,K){let ce=G.uid;this.loading[ce]&&delete this.loading[ce],K()}removeTile(G,K){let ce=this.loaded,_e=G.uid;ce&&ce[_e]&&delete ce[_e],K()}}class sc{constructor(G){this.self=G,this.actor=new i.e6(G,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=i.aJ({name:"mercator"}),this.workerSourceTypes={vector:xe,geojson:nl,"batched-model":Ad},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,ce)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ce},this.self.registerRTLTextPlugin=K=>{if(i.e7.isParsed())throw new Error("RTL text plugin already registered.");i.e7.applyArabicShaping=K.applyArabicShaping,i.e7.processBidirectionalText=K.processBidirectionalText,i.e7.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(G,K,ce){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],delete this.rasterArrayWorkerSource,ce()}checkIfReady(G,K,ce){ce()}setReferrer(G,K){this.referrer=K}spriteLoaded(G,{scope:K,isLoaded:ce}){if(this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),this.isSpriteLoaded[G][K]=ce,this.workerSources[G]&&this.workerSources[G][K])for(let _e in this.workerSources[G][K]){let be=this.workerSources[G][K][_e];for(let Ee in be){let Ne=be[Ee];Ne instanceof xe&&(Ne.isSpriteLoaded=ce,Ne.fire(new i.f("isSpriteLoaded")))}}}setImages(G,{scope:K,images:ce},_e){if(this.availableImages[G]||(this.availableImages[G]={}),this.availableImages[G][K]=ce,this.workerSources[G]&&this.workerSources[G][K]){for(let be in this.workerSources[G][K]){let Ee=this.workerSources[G][K][be];for(let Ne in Ee)Ee[Ne].availableImages=ce}_e()}else _e()}setProjection(G,K){this.projections[G]=i.aJ(K)}setBrightness(G,K,ce){this.brightness=K,ce()}setLayers(G,K,ce){this.getLayerIndex(G,K.scope).replace(K.layers,K.options),ce()}updateLayers(G,K,ce){this.getLayerIndex(G,K.scope).update(K.layers,K.removedIds,K.options),ce()}loadTile(G,K,ce){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).loadTile(K,ce)}loadDEMTile(G,K,ce){this.getDEMWorkerSource(G,K.source,K.scope).loadTile(K,ce)}decodeRasterArray(G,K,ce){this.getRasterArrayWorkerSource().decodeRasterArray(K,ce)}reloadTile(G,K,ce){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).reloadTile(K,ce)}abortTile(G,K,ce){this.getWorkerSource(G,K.type,K.source,K.scope).abortTile(K,ce)}removeTile(G,K,ce){this.getWorkerSource(G,K.type,K.source,K.scope).removeTile(K,ce)}removeSource(G,K,ce){if(!(this.workerSources[G]&&this.workerSources[G][K.scope]&&this.workerSources[G][K.scope][K.type]&&this.workerSources[G][K.scope][K.type][K.source]))return;let _e=this.workerSources[G][K.scope][K.type][K.source];delete this.workerSources[G][K.scope][K.type][K.source],_e.removeSource!==void 0?_e.removeSource(K,ce):ce()}loadWorkerSource(G,K,ce){try{this.self.importScripts(K.url),ce()}catch(_e){ce(_e.toString())}}syncRTLPluginState(G,K,ce){try{i.e7.setState(K);let _e=i.e7.getPluginURL();if(i.e7.isLoaded()&&!i.e7.isParsed()&&_e!=null){this.self.importScripts(_e);let be=i.e7.isParsed();ce(be?void 0:new Error(`RTL Text Plugin failed to import scripts from ${_e}`),be)}}catch(_e){ce(_e.toString())}}setDracoUrl(G,K){this.dracoUrl=K}getAvailableImages(G,K){this.availableImages[G]||(this.availableImages[G]={});let ce=this.availableImages[G][K];return ce||(ce=[]),ce}getLayerIndex(G,K){this.layerIndexes[G]||(this.layerIndexes[G]={});let ce=this.layerIndexes[G][K];return ce||(ce=this.layerIndexes[G][K]=new O,ce.scope=K),ce}getWorkerSource(G,K,ce,_e){return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][_e]||(this.workerSources[G][_e]={}),this.workerSources[G][_e][K]||(this.workerSources[G][_e][K]={}),this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),this.workerSources[G][_e][K][ce]||(this.workerSources[G][_e][K][ce]=new this.workerSourceTypes[K]({send:(be,Ee,Ne,Te,je,mt)=>{this.actor.send(be,Ee,Ne,G,je,mt)},scheduler:this.actor.scheduler},this.getLayerIndex(G,_e),this.getAvailableImages(G,_e),this.isSpriteLoaded[G][_e],void 0,this.brightness)),this.workerSources[G][_e][K][ce]}getDEMWorkerSource(G,K,ce){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][ce]||(this.demWorkerSources[G][ce]={}),this.demWorkerSources[G][ce][K]||(this.demWorkerSources[G][ce][K]=new ke),this.demWorkerSources[G][ce][K]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ae),this.rasterArrayWorkerSource}enforceCacheSizeLimit(G,K){i.e8(K)}getWorkerPerformanceMetrics(G,K,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new sc(self)),sc}),o(["./shared"],function(i){function _(f,r){if(Array.isArray(f)){if(!Array.isArray(r)||f.length!==r.length)return!1;for(let h=0;h<f.length;h++)if(!_(f[h],r[h]))return!1;return!0}if(typeof f=="object"&&f!==null&&r!==null){if(typeof r!="object"||Object.keys(f).length!==Object.keys(r).length)return!1;for(let h in f)if(!_(f[h],r[h]))return!1;return!0}return f===r}var C=I;function I(f){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,x=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(x);try{v=new Worker(S),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(S),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===g.width}()?(O[h=r&&r.failIfMajorPerformanceCaveat]===void 0&&(O[h]=function(g){var v,x=function(S){var k=document.createElement("canvas"),D=Object.create(I.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=S,k.getContext("webgl2",D)}(g);if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),x.getShaderParameter(v,x.COMPILE_STATUS)===!0)}(h)),O[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var h}(f)}var O={};function N(f,r,h){let g=document.createElement(f);return r!=null&&(g.className=r),h&&h.appendChild(g),g}function q(f,r,h){let g=document.createElementNS("http://www.w3.org/2000/svg",f);for(let v of Object.keys(r))g.setAttributeNS(null,v,String(r[v]));return h&&h.appendChild(g),g}I.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let ie=typeof document<"u"?document.documentElement&&document.documentElement.style:null,de=ie&&ie.userSelect!==void 0?"userSelect":"WebkitUserSelect",xe;function ke(){ie&&de&&(xe=ie[de],ie[de]="none")}function Ae(){ie&&de&&(ie[de]=xe)}function Xe(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Xe,!0)}function qe(){window.addEventListener("click",Xe,!0),window.setTimeout(()=>{window.removeEventListener("click",Xe,!0)},0)}function ht(f,r){let h=f.getBoundingClientRect();return Et(f,h,r)}function Tt(f,r){let h=f.getBoundingClientRect(),g=[];for(let v=0;v<r.length;v++)g.push(Et(f,h,r[v]));return g}function vt(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function Et(f,r,h){let g=f.offsetWidth===r.width?1:f.offsetWidth/r.width;return new i.P((h.clientX-r.left)*g,(h.clientY-r.top)*g)}class Ut{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,h){this._updatedSourceCaches[r]=h,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){let h=r.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(r.id),this.setDirty()}removeLayer(r){let h=r.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][r.id]=r,this._updatedLayers[h].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){let r={};for(let h in this._updatedLayers)r[h]=r[h]||{},r[h].updatedIds=Array.from(this._updatedLayers[h].values());for(let h in this._removedLayers)r[h]=r[h]||{},r[h].removedIds=Object.keys(this._removedLayers[h]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(r){this._updatedImages.add(r),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let xt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yt{constructor(r,h,g,v,x,S){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.instanceCount=S,this.context=r;let k=r.gl;this.buffer=k.createBuffer(),r.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||x||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){let h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,h){for(let g=0;g<this.attributes.length;g++){let v=h.attributes[this.attributes[g].name];v!==void 0&&r.enableVertexAttribArray(v)}}setVertexAttribPointers(r,h,g){for(let v=0;v<this.attributes.length;v++){let x=this.attributes[v],S=h.attributes[x.name];S!==void 0&&r.vertexAttribPointer(S,x.components,r[xt[x.type]],!1,this.itemSize,x.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(r,h,g){for(let v=0;v<this.attributes.length;v++){let x=h.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(x,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zt{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Si extends zt{getDefault(){return i.C.transparent}set(r){let h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ui extends zt{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class rr extends zt{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class bi extends zt{getDefault(){return[!0,!0,!0,!0]}set(r){let h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class cn extends zt{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class en extends zt{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class zn extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){let h=this.current;(r.func!==h.func||r.ref!==h.ref||r.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Lr extends zt{getDefault(){let r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){let h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Hn extends zt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let h=this.gl;r?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=r,this.dirty=!1}}class Mi extends zt{getDefault(){return[0,1]}set(r){let h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class ta extends zt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let h=this.gl;r?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=r,this.dirty=!1}}class Wn extends zt{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class ga extends zt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let h=this.gl;r?h.enable(h.BLEND):h.disable(h.BLEND),this.current=r,this.dirty=!1}}class Oo extends zt{getDefault(){let r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){let h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class _a extends zt{getDefault(){return i.C.transparent}set(r){let h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Gt extends zt{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class Yl extends zt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let h=this.gl;r?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=r,this.dirty=!1}}class wn extends zt{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Qh extends zt{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Kh=class extends zt{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Jh extends zt{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Md extends zt{getDefault(){let r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){let h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Zl extends zt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class ia extends zt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class na extends zt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let h=this.gl;h.bindTexture(h.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class kd extends zt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Xt extends zt{getDefault(){return null}set(r){let h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Kt extends zt{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class Xl extends zt{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class uo extends zt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class el extends zt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Ql extends zt{constructor(r,h){super(r),this.context=r,this.parent=h}getDefault(){return null}}class Kl extends Ql{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Td extends Ql{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class vs extends Ql{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class tl extends Td{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Jl{constructor(r,h,g,v,x){this.context=r,this.width=h,this.height=g;let S=this.framebuffer=r.gl.createFramebuffer();v&&(this.colorAttachment=new Kl(r,S)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new Td(r,S):new vs(r,S))}destroy(){let r=this.context.gl;if(this.colorAttachment){let h=this.colorAttachment.get();h&&r.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let h=this.depthAttachment.get();h&&r.deleteRenderbuffer(h)}else{let h=this.depthAttachment.get();h&&r.deleteTexture(h)}r.deleteFramebuffer(this.framebuffer)}}class Id{constructor(r,h){this.gl=r,this.clearColor=new Si(this),this.clearDepth=new Ui(this),this.clearStencil=new rr(this),this.colorMask=new bi(this),this.depthMask=new cn(this),this.stencilMask=new en(this),this.stencilFunc=new zn(this),this.stencilOp=new Lr(this),this.stencilTest=new Hn(this),this.depthRange=new Mi(this),this.depthTest=new ta(this),this.depthFunc=new Wn(this),this.blend=new ga(this),this.blendFunc=new Oo(this),this.blendColor=new _a(this),this.blendEquation=new Gt(this),this.cullFace=new Yl(this),this.cullFaceSide=new wn(this),this.frontFace=new Qh(this),this.program=new Kh(this),this.activeTexture=new Jh(this),this.viewport=new Md(this),this.bindFramebuffer=new Zl(this),this.bindRenderbuffer=new ia(this),this.bindTexture=new na(this),this.bindVertexBuffer=new kd(this),this.bindElementBuffer=new Xt(this),this.bindVertexArrayOES=new Kt(this),this.pixelStoreUnpack=new Xl(this),this.pixelStoreUnpackPremultiplyAlpha=new uo(this),this.pixelStoreUnpackFlipY=new el(this),this.options=h?$i({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,h,g){return new i.I(this,r,h,g)}createVertexBuffer(r,h,g,v,x){return new Yt(this,r,h,g,v,x)}createRenderbuffer(r,h,g){let v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,r,h,g),this.bindRenderbuffer.set(null),x}createFramebuffer(r,h,g,v){return new Jl(this,r,h,g,v)}clear({color:r,depth:h,stencil:g,colorMask:v}){let x=this.gl,S=0;r&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(v||[!0,!0,!0,!0])),h!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(S)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){_(r.blendFunction,i.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class ec{constructor(r){this._gl=r.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let r=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,r}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class tc{constructor(r){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,r.registerParameter(this,["Symbols"],"useOcclusionQueries"),r.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),r.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),r.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),r.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class Ro{constructor(r,h,g,v){let x={width:g[0],height:g[1],data:null},S=r.gl;this.targetColorTexture=new i.T(r,x,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new i.T(r,x,S.RGBA,{useMipmap:!1}),this.context=r,this.updateParticleTexture(h,v),this.lastInvalidatedAt=0}updateParticleTexture(r,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let g=this.context.gl,v=h.width*h.height;this.particleTexture0=new i.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1});let x=new i.S;x.reserve(v);for(let S=0;S<v;S++)x.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(x,i.p.members,!0),this.particleSegment=i.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=i.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class eu extends i.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.numModelsLoading={}}loadModel(r,h){return i.l(this.requestManager.transformRequest(h,i.R.Model).url).then(g=>{if(!g)return;let v=i.c(g),x=new i.M(r,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(g=>{if(g&&g.status===404)return null;this.fire(new i.d(new Error(`Could not load model ${r} from ${h}: ${g.message}`)))})}load(r,h){this.models[h]||(this.models[h]={});let g=Object.keys(r);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+g.length;let v=[];for(let x of g)v.push(this.loadModel(x,r[x]));Promise.allSettled(v).then(x=>{for(let S=0;S<x.length;S++){let{status:k,value:D}=x[S];k==="fulfilled"&&D&&(this.models[h][g[S]]={model:D,numReferences:1})}this.numModelsLoading[h]-=g.length,this.fire(new i.f("data",{dataType:"style"}))}).catch(x=>{this.fire(new i.d(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(let r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,h){return!!this.getModel(r,h)}getModel(r,h){return this.models[h]||(this.models[h]={}),this.models[h][r]?this.models[h][r].model:void 0}addModel(r,h,g){this.models[g]||(this.models[g]={}),this.hasModel(r,g)&&this.models[g][r].numReferences++,this.load({[r]:this.requestManager.normalizeModelURL(h)},g)}addModels(r,h){this.models[h]||(this.models[h]={});let g={};for(let v in r)this.models[h][v]={},g[v]=this.requestManager.normalizeModelURL(r[v]);this.load(g,h)}addModelsFromBucket(r,h){this.models[h]||(this.models[h]={});let g={};for(let v of r)this.hasModel(v,h)?this.models[h][v].numReferences++:g[v]=this.requestManager.normalizeModelURL(v);this.load(g,h)}removeModel(r,h){if(this.models[h]&&this.models[h][r]&&(this.models[h][r].numReferences--,this.models[h][r].numReferences===0)){let g=this.models[h][r].model;delete this.models[h][r],g.destroy()}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,h){this.models[h]||(this.models[h]={});for(let g in this.models[h])this.models[h][g].model&&this.models[h][g].model.upload(r.context)}}function Jt(f){let{userImage:r}=f;return!!(r&&r.render&&r.render())&&(f.data.replace(new Uint8Array(r.data.buffer)),!0)}class Ed extends i.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(r){this.images[r]={},this.loaded[r]=!1,this.updatedImages[r]={},this.patterns[r]={},this.callbackDispatchedThisFrame[r]={},this.atlasImage[r]=new i.i({width:1,height:1})}isLoaded(){for(let r in this.loaded)if(!this.loaded[r])return!1;return!0}setLoaded(r,h){if(this.loaded[h]!==r&&(this.loaded[h]=r,r)){for(let{ids:g,callback:v}of this.requestors)this._notify(g,h,v);this.requestors=[]}}hasImage(r,h){return!!this.getImage(r,h)}getImage(r,h){return this.images[h][r]}addImage(r,h,g){this._validate(r,g)&&(this.images[h][r]=g)}_validate(r,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new i.d(new Error(`Image "${r}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new i.d(new Error(`Image "${r}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new i.d(new Error(`Image "${r}" has invalid "content" value`))),g=!1),g}_validateStretch(r,h){if(!r)return!0;let g=0;for(let v of r){if(v[0]<g||v[1]<v[0]||h<v[1])return!1;g=v[1]}return!0}_validateContent(r,h){return!(r&&(r.length!==4||r[0]<0||h.data.width<r[0]||r[1]<0||h.data.height<r[1]||r[2]<0||h.data.width<r[2]||r[3]<0||h.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,h,g){g.version=this.images[h][r].version+1,this.images[h][r]=g,this.updatedImages[h][r]=!0}removeImage(r,h){let g=this.images[h][r];delete this.images[h][r],delete this.patterns[h][r],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(r){return Object.keys(this.images[r])}getImages(r,h,g){let v=!0,x=!!this.loaded[h];if(!x)for(let S of r)this.images[h][S]||(v=!1);x||v?this._notify(r,h,g):this.requestors.push({ids:r,scope:h,callback:g})}getUpdatedImages(r){return this.updatedImages[r]}_notify(r,h,g){let v={};for(let x of r){this.images[h][x]||this.fire(new i.f("styleimagemissing",{id:x}));let S=this.images[h][x];S?v[x]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:i.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(r){let{width:h,height:g}=this.atlasImage[r];return{width:h,height:g}}getPattern(r,h,g){let v=this.patterns[h][r],x=this.getImage(r,h);if(!x)return null;if(v&&v.position.version===x.version)return v.position;if(v)v.position.version=x.version;else{let S={w:x.data.width+2,h:x.data.height+2,x:0,y:0},k=new i.k(S,x);this.patterns[h][r]={bin:S,position:k}}return this._updatePatternAtlas(h,g),this.patterns[h][r].position}bind(r,h){let g=r.gl,v=this.atlasTexture[h];v?this.dirty&&(v.update(this.atlasImage[h]),this.dirty=!1):(v=new i.T(r,this.atlasImage[h],g.RGBA),this.atlasTexture[h]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(r,h){let g=[];for(let k in this.patterns[r])g.push(this.patterns[r][k].bin);let{w:v,h:x}=i.j(g),S=this.atlasImage[r];S.resize({width:v||1,height:x||1});for(let k in this.patterns[r]){let{bin:D}=this.patterns[r][k],A=D.x+1,L=D.y+1,z=this.images[r][k].data,U=z.width,H=z.height;i.i.copy(z,S,{x:0,y:0},{x:A,y:L},{width:U,height:H},h),i.i.copy(z,S,{x:0,y:H-1},{x:A,y:L-1},{width:U,height:1},h),i.i.copy(z,S,{x:0,y:0},{x:A,y:L+H},{width:U,height:1},h),i.i.copy(z,S,{x:U-1,y:0},{x:A-1,y:L},{width:1,height:H},h),i.i.copy(z,S,{x:0,y:0},{x:A+U,y:L},{width:1,height:H},h)}this.dirty=!0}beginFrame(){for(let r in this.images)this.callbackDispatchedThisFrame[r]={}}dispatchRenderCallbacks(r,h){for(let g of r){if(this.callbackDispatchedThisFrame[h][g])continue;this.callbackDispatchedThisFrame[h][g]=!0;let v=this.images[h][g];Jt(v)&&this.updateImage(g,h,v)}}}function Bn(f){let r=f.key,h=f.value,g=f.valueSpec||{},v=f.objectElementValidators||{},x=f.style,S=f.styleSpec,k=[],D=i.n(h);if(D!=="object")return[new i.V(r,h,`object expected, ${D} found`)];for(let A in h){let L=A.split(".")[0],z;v[L]?z=v[L]:g[L]?z=G:v["*"]?z=v["*"]:g["*"]&&(z=G),z?k=k.concat(z({key:(r&&`${r}.`)+A,value:h[A],valueSpec:g[L]||g["*"],style:x,styleSpec:S,object:h,objectKey:A},h)):k.push(new i.m(r,h[A],`unknown property "${A}"`))}for(let A in g)v[A]||g[A].required&&g[A].default===void 0&&h[A]===void 0&&k.push(new i.V(r,h,`missing required property "${A}"`));return k}function ic(f){let r=f.value,h=f.valueSpec,g=f.style,v=f.styleSpec,x=f.key,S=f.arrayElementValidator||G;if(i.n(r)!=="array")return[new i.V(x,r,`array expected, ${i.n(r)} found`)];if(h.length&&r.length!==h.length)return[new i.V(x,r,`array length ${h.length} expected, length ${r.length} found`)];if(h["min-length"]&&r.length<h["min-length"])return[new i.V(x,r,`array length at least ${h["min-length"]} expected, length ${r.length} found`)];let k={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};v.$version<7&&(k.function=h.function),i.n(h.value)==="object"&&(k=h.value);let D=[];for(let A=0;A<r.length;A++)D=D.concat(S({array:r,arrayIndex:A,value:r[A],valueSpec:k,style:g,styleSpec:v,key:`${x}[${A}]`},!0));return D}function il(f){let r=f.key,h=f.value,g=f.valueSpec,v=i.n(h);if(v==="number"&&h!=h&&(v="NaN"),v!=="number")return[new i.V(r,h,`number expected, ${v} found`)];if("minimum"in g){let x=g.minimum;if(i.n(g.minimum)==="array"&&(x=g.minimum[f.arrayIndex]),h<x)return[new i.V(r,h,`${h} is less than the minimum value ${x}`)]}if("maximum"in g){let x=g.maximum;if(i.n(g.maximum)==="array"&&(x=g.maximum[f.arrayIndex]),h>x)return[new i.V(r,h,`${h} is greater than the maximum value ${x}`)]}return[]}function ba(f){let r=f.valueSpec,h=i.u(f.value.type),g,v,x,S={},k=h!=="categorical"&&f.value.property===void 0,D=!k,A=i.n(f.value.stops)==="array"&&i.n(f.value.stops[0])==="array"&&i.n(f.value.stops[0][0])==="object",L=Bn({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(H){if(h==="identity")return[new i.V(H.key,H.value,'identity function may not have a "stops" property')];let $=[],Y=H.value;return $=$.concat(ic({key:H.key,value:Y,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:z})),i.n(Y)==="array"&&Y.length===0&&$.push(new i.V(H.key,Y,"array must have at least one stop")),$},default:function(H){return G({key:H.key,value:H.value,valueSpec:r,style:H.style,styleSpec:H.styleSpec})}}});return h==="identity"&&k&&L.push(new i.V(f.key,f.value,'missing required property "property"')),h==="identity"||f.value.stops||L.push(new i.V(f.key,f.value,'missing required property "stops"')),h==="exponential"&&f.valueSpec.expression&&!i.s(f.valueSpec)&&L.push(new i.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(D&&!i.q(f.valueSpec)?L.push(new i.V(f.key,f.value,"property functions not supported")):k&&!i.r(f.valueSpec)&&L.push(new i.V(f.key,f.value,"zoom functions not supported"))),h!=="categorical"&&!A||f.value.property!==void 0||L.push(new i.V(f.key,f.value,'"property" property is required')),L;function z(H){let $=[],Y=H.value,Z=H.key;if(i.n(Y)!=="array")return[new i.V(Z,Y,`array expected, ${i.n(Y)} found`)];if(Y.length!==2)return[new i.V(Z,Y,`array length 2 expected, length ${Y.length} found`)];if(A){if(i.n(Y[0])!=="object")return[new i.V(Z,Y,`object expected, ${i.n(Y[0])} found`)];if(Y[0].zoom===void 0)return[new i.V(Z,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new i.V(Z,Y,"object stop key must have value")];let Q=i.u(Y[0].zoom);if(typeof Q!="number")return[new i.V(Z,Y[0].zoom,"stop zoom values must be numbers")];if(x&&x>Q)return[new i.V(Z,Y[0].zoom,"stop zoom values must appear in ascending order")];Q!==x&&(x=Q,v=void 0,S={}),$=$.concat(Bn({key:`${Z}[0]`,value:Y[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:il,value:U}}))}else $=$.concat(U({key:`${Z}[0]`,value:Y[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},Y));return i.t(i.v(Y[1]))?$.concat([new i.V(`${Z}[1]`,Y[1],"expressions are not allowed in function stops.")]):$.concat(G({key:`${Z}[1]`,value:Y[1],valueSpec:r,style:H.style,styleSpec:H.styleSpec}))}function U(H,$){let Y=i.n(H.value),Z=i.u(H.value),Q=H.value!==null?H.value:$;if(g){if(Y!==g)return[new i.V(H.key,Q,`${Y} stop domain type must match previous stop domain type ${g}`)]}else g=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean"&&typeof Z!="number"&&typeof Z!="string"&&typeof Z!="boolean")return[new i.V(H.key,Q,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&h!=="categorical"){let re=`number expected, ${Y} found`;return i.q(r)&&h===void 0&&(re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(H.key,Q,re)]}return h!=="categorical"||Y!=="number"||typeof Z=="number"&&isFinite(Z)&&Math.floor(Z)===Z?h!=="categorical"&&Y==="number"&&typeof Z=="number"&&typeof v=="number"&&v!==void 0&&Z<v?[new i.V(H.key,Q,"stop domain values must appear in ascending order")]:(v=Z,h==="categorical"&&Z in S?[new i.V(H.key,Q,"stop domain values must be unique")]:(S[Z]=!0,[])):[new i.V(H.key,Q,`integer expected, found ${String(Z)}`)]}}function ya(f){let r=(f.expressionContext==="property"?i.x:i.y)(i.v(f.value),f.valueSpec);if(r.result==="error")return r.value.map(g=>new i.V(`${f.key}${g.key}`,f.value,g.message));let h=r.value.expression||r.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!h.outputDefined())return[new i.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!i.z(h))return[new i.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Dd(h,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!i.A(h,["zoom","feature-state"]))return[new i.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!i.B(h))return[new i.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Dd(f,r){let h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(let v of r.valueSpec.expression.parameters)h.delete(v);if(h.size===0)return[];let g=[];return f instanceof i.D&&h.has(f.name)?[new i.V(r.key,r.value,`["${f.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(f.eachChild(v=>{g.push(...Dd(v,r))}),g)}function xs(f){let r=f.key,h=f.value,g=f.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(i.u(h))===-1&&v.push(new i.V(r,h,`expected one of [${g.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(g.values).indexOf(i.u(h))===-1&&v.push(new i.V(r,h,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function ws(f){return i.G(i.v(f.value))?ya(i.o({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):nc(f)}function nc(f){let r=f.value,h=f.key;if(i.n(r)!=="array")return[new i.V(h,r,`array expected, ${i.n(r)} found`)];let g=f.styleSpec,v,x=[];if(r.length<1)return[new i.V(h,r,"filter array must have at least 1 element")];switch(x=x.concat(xs({key:`${h}[0]`,value:r[0],valueSpec:g.filter_operator,style:f.style,styleSpec:f.styleSpec})),i.u(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&i.u(r[1])==="$type"&&x.push(new i.V(h,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&x.push(new i.V(h,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(v=i.n(r[1]),v!=="string"&&x.push(new i.V(`${h}[1]`,r[1],`string expected, ${v} found`)));for(let S=2;S<r.length;S++)v=i.n(r[S]),i.u(r[1])==="$type"?x=x.concat(xs({key:`${h}[${S}]`,value:r[S],valueSpec:g.geometry_type,style:f.style,styleSpec:f.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new i.V(`${h}[${S}]`,r[S],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let S=1;S<r.length;S++)x=x.concat(nc({key:`${h}[${S}]`,value:r[S],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":v=i.n(r[1]),r.length!==2?x.push(new i.V(h,r,`filter array for "${r[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new i.V(`${h}[1]`,r[1],`string expected, ${v} found`))}return x}function rc(f,r){let h=f.key,g=f.style,v=f.layer,x=f.styleSpec,S=f.value,k=f.objectKey,D=x[`${r}_${f.layerType}`];if(!D)return[];let A=k.match(/^(.*)-transition$/);if(r==="paint"&&A&&D[A[1]]&&D[A[1]].transition)return G({key:h,value:S,valueSpec:x.transition,style:g,styleSpec:x});let L=f.valueSpec||D[k];if(!L)return[new i.m(h,S,`unknown property "${k}"`)];let z;if(i.n(S)==="string"&&i.q(L)&&!L.tokens&&(z=/^{([^}]+)}$/.exec(S))){let H=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new i.V(h,S,`"${k}" does not support interpolation syntax
Use an identity property function instead: ${H}.`)]}let U=[];if(f.layerType==="symbol")k!=="text-field"||!g||g.glyphs||g.imports||U.push(new i.V(h,S,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&i.H(i.v(S))&&i.u(S.type)==="identity"&&U.push(new i.V(h,S,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&r==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&i.q(L)&&(i.J(L)||i.r(L))){let H=i.x(i.v(S),L),$=H.value.expression||H.value._styleExpression.expression;$&&!i.A($,["measure-light"])&&(k==="model-emissive-strength"&&i.B($)&&i.z($)||U.push(new i.V(h,S,`${k} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat(G({key:f.key,value:S,valueSpec:L,style:g,styleSpec:x,expressionContext:"property",propertyType:r,propertyKey:k}))}function tu(f){return rc(f,"paint")}function oc(f){return rc(f,"layout")}function Lo(f){let r=[],h=f.value,g=f.key,v=f.style,x=f.styleSpec;h.type||h.ref||r.push(new i.V(g,h,'either "type" or "ref" is required'));let S=i.u(h.type),k=i.u(h.ref);if(h.id){let D=i.u(h.id);for(let A=0;A<f.arrayIndex;A++){let L=v.layers[A];i.u(L.id)===D&&r.push(new i.V(g,h.id,`duplicate layer id "${h.id}", previously used at line ${L.id.__line__}`))}}if("ref"in h){let D;["type","source","source-layer","filter","layout"].forEach(A=>{A in h&&r.push(new i.V(g,h[A],`"${A}" is prohibited for ref layers`))}),v.layers.forEach(A=>{i.u(A.id)===k&&(D=A)}),D?D.ref?r.push(new i.V(g,h.ref,"ref cannot reference another ref layer")):S=i.u(D.type):typeof k=="string"&&r.push(new i.V(g,h.ref,`ref layer "${k}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(h.source){let D=v.sources&&v.sources[h.source],A=D&&i.u(D.type);D?A==="vector"&&S==="raster"?r.push(new i.V(g,h.source,`layer "${h.id}" requires a raster source`)):A==="raster"&&S!=="raster"?r.push(new i.V(g,h.source,`layer "${h.id}" requires a vector source`)):A!=="vector"||h["source-layer"]?A==="raster-dem"&&S!=="hillshade"?r.push(new i.V(g,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||A==="geojson"&&D.lineMetrics?S==="raster-particle"&&A!=="raster-array"&&r.push(new i.V(g,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):r.push(new i.V(g,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new i.V(g,h.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new i.V(g,h,`layer "${h.id}" must specify a "source-layer"`)):r.push(new i.V(g,h.source,`source "${h.source}" not found`))}else r.push(new i.V(g,h,'missing required property "source"'));return r=r.concat(Bn({key:g,value:h,valueSpec:x.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>G({key:`${g}.type`,value:h.type,valueSpec:x.layer.type,style:f.style,styleSpec:f.styleSpec,object:h,objectKey:"type"}),filter:D=>ws(i.o({layerType:S},D)),layout:D=>Bn({layer:h,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":A=>oc(i.o({layerType:S},A))}}),paint:D=>Bn({layer:h,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":A=>tu(i.o({layerType:S,layer:h},A))}})}})),r}function Cs(f){let r=f.value,h=f.key,g=i.n(r);return g!=="string"?[new i.V(h,r,`string expected, ${g} found`)]:[]}let Fo={promoteId:function({key:f,value:r}){if(i.n(r)==="string")return Cs({key:f,value:r});{let h=[];for(let g in r)h.push(...Cs({key:`${f}.${g}`,value:r[g]}));return h}}};function Sr(f){let r=f.value,h=f.key,g=f.styleSpec,v=f.style;if(!r.type)return[new i.V(h,r,'"type" is required')];let x=i.u(r.type),S=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(r.url||r.tiles||S.push(new i.m(h,r,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(Bn({key:h,value:r,valueSpec:g[`source_${x.replace("-","_")}`],style:f.style,styleSpec:g,objectElementValidators:Fo})),S;case"geojson":if(S=Bn({key:h,value:r,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:Fo}),r.cluster)for(let k in r.clusterProperties){let[D,A]=r.clusterProperties[k],L=typeof D=="string"?[D,["accumulated"],["get",k]]:D;S.push(...ya({key:`${h}.${k}.map`,value:A,expressionContext:"cluster-map"})),S.push(...ya({key:`${h}.${k}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return S;case"video":return Bn({key:h,value:r,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return Bn({key:h,value:r,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new i.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xs({key:`${h}.type`,value:r.type,valueSpec:{values:iu(g)},style:v,styleSpec:g})}}function iu(f){return f.source.reduce((r,h)=>{let g=f[h];return g.type.type==="enum"&&(r=r.concat(Object.keys(g.type.values))),r},[])}function nl(f){let r=f.value,h=f.styleSpec,g=h.light,v=f.style,x=[],S=i.n(r);if(r===void 0)return x;if(S!=="object")return x=x.concat([new i.V("light",r,`object expected, ${S} found`)]),x;for(let k in r){let D=k.match(/^(.*)-transition$/);x=x.concat(D&&g[D[1]]&&g[D[1]].transition?G({key:k,value:r[k],valueSpec:h.transition,style:v,styleSpec:h}):g[k]?G({key:k,value:r[k],valueSpec:g[k],style:v,styleSpec:h}):[new i.V(k,r[k],`unknown property "${k}"`)])}return x}function ac(f){let r=f.value,h=[];if(!r)return h;let g=i.n(r);if(g!=="object")return h=h.concat([new i.V("light-3d",r,`object expected, ${g} found`)]),h;let v=f.styleSpec,x=v["light-3d"],S=f.key,k=f.style,D=f.style.lights;for(let z of["type","id"])if(!(z in r))return h=h.concat([new i.V("light-3d",r,`missing property ${z} on light`)]),h;if(r.type&&D)for(let z=0;z<f.arrayIndex;z++){let U=i.u(r.type),H=D[z];i.u(H.type)===U&&h.push(new i.V(S,r.id,`duplicate light type "${r.type}", previously defined at line ${H.id.__line__}`))}let A=`properties_light_${r.type}`;if(!(A in v))return h=h.concat([new i.V("light-3d",r,`Invalid light type ${r.type}`)]),h;let L=v[A];for(let z in r)if(z==="properties"){let U=r[z],H=i.n(U);if(H!=="object")return h=h.concat([new i.V("properties",U,`object expected, ${H} found`)]),h;for(let $ in U)h=h.concat(L[$]?G({key:$,value:U[$],valueSpec:L[$],style:k,styleSpec:v}):[new i.m(f.key,U[$],`unknown property "${$}"`)])}else{let U=z.match(/^(.*)-transition$/);h=h.concat(U&&x[U[1]]&&x[U[1]].transition?G({key:z,value:r[z],valueSpec:v.transition,style:k,styleSpec:v}):x[z]?G({key:z,value:r[z],valueSpec:x[z],style:k,styleSpec:v}):[new i.m(z,r[z],`unknown property "${z}"`)])}return h}function Ad(f){let r=f.value,h=f.key,g=f.style,v=f.styleSpec,x=v.terrain,S=[],k=i.n(r);if(r===void 0||k==="null")return S;if(k!=="object")return S=S.concat([new i.V("terrain",r,`object expected, ${k} found`)]),S;for(let D in r){let A=D.match(/^(.*)-transition$/);S=S.concat(A&&x[A[1]]&&x[A[1]].transition?G({key:D,value:r[D],valueSpec:v.transition,style:g,styleSpec:v}):x[D]?G({key:D,value:r[D],valueSpec:x[D],style:g,styleSpec:v}):[new i.m(D,r[D],`unknown property "${D}"`)])}if(r.source){let D=g.sources&&g.sources[r.source],A=D&&i.u(D.type);D?A!=="raster-dem"&&S.push(new i.V(h,r.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):S.push(new i.V(h,r.source,`source "${r.source}" not found`))}else S.push(new i.V(h,r,'terrain is missing required property "source"'));return S}function sc(f){let r=f.value,h=f.style,g=f.styleSpec,v=g.fog,x=[],S=i.n(r);if(r===void 0)return x;if(S!=="object")return x=x.concat([new i.V("fog",r,`object expected, ${S} found`)]),x;for(let k in r){let D=k.match(/^(.*)-transition$/);x=x.concat(D&&v[D[1]]&&v[D[1]].transition?G({key:k,value:r[k],valueSpec:g.transition,style:h,styleSpec:g}):v[k]?G({key:k,value:r[k],valueSpec:v[k],style:h,styleSpec:g}):[new i.m(k,r[k],`unknown property "${k}"`)])}return x}let Se={"*":()=>[],array:ic,boolean:function(f){let r=f.value,h=f.key,g=i.n(r);return g!=="boolean"?[new i.V(h,r,`boolean expected, ${g} found`)]:[]},number:il,color:function(f){let r=f.key,h=f.value,g=i.n(h);return g!=="string"?[new i.V(r,h,`color expected, ${g} found`)]:i.F(h)===null?[new i.V(r,h,`color expected, "${h}" found`)]:[]},enum:xs,filter:ws,function:ba,layer:Lo,object:Bn,source:Sr,model:i.K,light:nl,"light-3d":ac,terrain:Ad,fog:sc,string:Cs,formatted:function(f){return Cs(f).length===0?[]:ya(f)},resolvedImage:function(f){return Cs(f).length===0?[]:ya(f)},projection:function(f){let r=f.value,h=f.styleSpec,g=h.projection,v=f.style,x=[],S=i.n(r);if(S==="object")for(let k in r)x=x.concat(G({key:k,value:r[k],valueSpec:g[k],style:v,styleSpec:h}));else S!=="string"&&(x=x.concat([new i.V("projection",r,`object or string expected, ${S} found`)]));return x},import:function(f){let{value:r,styleSpec:h}=f,S=r,{data:g}=S,v=NM(S,["data"]);Object.defineProperty(v,"__line__",{value:r.__line__,enumerable:!1});let x=Bn(i.o({},f,{value:v,valueSpec:h.import}));return i.u(v.id)===""&&x.push(new i.V(`${f.key}.id`,v,"import id can't be an empty string")),g&&(x=x.concat(ce(g,h,{key:`${f.key}.data`}))),x}};function G(f,r=!1){let h=f.value,g=f.valueSpec,v=f.styleSpec;if(g.expression&&i.H(i.u(h)))return ba(f);if(g.expression&&i.t(i.v(h)))return ya(f);if(g.type&&Se[g.type]){let x=Se[g.type](f);return r===!0&&x.length>0&&i.n(f.value)==="array"?ya(f):x}return Bn(i.o({},f,{valueSpec:g.type?v[g.type]:g}))}function K(f){let r=f.value,h=f.key,g=Cs(f);return g.length||(r.indexOf("{fontstack}")===-1&&g.push(new i.V(h,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&g.push(new i.V(h,r,'"glyphs" url must include a "{range}" token'))),g}function ce(f,r=i.L,h={}){return G({key:h.key||"",value:f,valueSpec:r.$root,styleSpec:r,style:f,objectElementValidators:{glyphs:K,"*":()=>[]}})}function _e(f,r=i.L){return fi(ce(f,r))}let be=f=>fi(Sr(f)),Ee=f=>fi(nl(f)),Ne=f=>fi(ac(f)),Te=f=>fi(Ad(f)),je=f=>fi(sc(f)),mt=f=>fi(Lo(f)),at=f=>fi(ws(f)),Ot=f=>fi(tu(f)),$t=f=>fi(oc(f)),mi=f=>fi(i.K(f));function fi(f){return f.slice().sort((r,h)=>r.line&&h.line?r.line-h.line:0)}function ii(f,r){let h=!1;if(r&&r.length)for(let g of r)g instanceof i.m?i.w(g.message):(f.fire(new i.d(new Error(g.message))),h=!0);return h}let ki=new i.N({anchor:new i.O(i.L.light.anchor),position:new i.Q(i.L.light.position),color:new i.O(i.L.light.color),intensity:new i.O(i.L.light.intensity)});class At extends i.E{constructor(r,h="flat"){super(),this._transitionable=new i.U(ki),this.setLight(r,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,h,g={}){this._validate(Ee,r,g)||(this._transitionable.setTransitionOrValue(r),this.id=h)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,h,g){return(!g||g.validate!==!1)&&ii(this,r.call(_e,i.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.L})))}}let Cn=new i.N({source:new i.O(i.L.terrain.source),exaggeration:new i.O(i.L.terrain.exaggeration)}),Ki=class extends i.E{constructor(f,r,h,g){super(),this.scope=h,this._transitionable=new i.U(Cn,h,g),this._transitionable.setTransitionOrValue(f,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(f,r){this._transitionable.setTransitionOrValue(f,r)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new i.X(f)).get("exaggeration")}isZoomDependent(){let f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof i.Z}},Di=45,Gn=65,Sn=.05;function or(f,r,h,g){let v=i.$(Di,Gn,h),[x,S]=Fr(f,g),k=1-Math.min(1,Math.exp((r-x)/(S-x)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*v*f.alpha}function Fr(f,r){let h=.5/Math.tan(.5*r);return[f.range[0]+h,f.range[1]+h]}function zr(f,r,h,g,v){let x=i._.transformMat4([],[r,h,g],v.mercatorFogMatrix);return or(f,i._.length(x),v.pitch,v._fov)}function rl(f,r,h,g,v,x,S){let k=[[h,g,0],[v,g,0],[v,x,0],[h,x,0]],D=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let L of k){let z=i._.transformMat4([],L,r),U=i._.length(z);D=Math.min(D,U),A=Math.max(A,U)}return[or(f,D,S.pitch,S._fov),or(f,A,S.pitch,S._fov)]}let tp=new i.N({range:new i.O(i.L.fog.range),color:new i.O(i.L.fog.color),"high-color":new i.O(i.L.fog["high-color"]),"space-color":new i.O(i.L.fog["space-color"]),"horizon-blend":new i.O(i.L.fog["horizon-blend"]),"star-intensity":new i.O(i.L.fog["star-intensity"]),"vertical-range":new i.O(i.L.fog["vertical-range"])});class Rg extends i.E{constructor(r,h,g,v){super(),this._transitionable=new i.U(tp,g,new Map(v)),this.set(r,v),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new i.a0(tp),this.scope=g}get state(){let r=this._transform,h=r.projection.name==="globe",g=i.a1(r.zoom),v=this.properties.get("range"),x=[.5,3];return{range:h?[i.a2(x[0],v[0],g),i.a2(x[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,h,g={}){if(this._validate(je,r,g))return;let v=i.W({},r);for(let x of Object.keys(i.L.fog))v[x]===void 0&&(v[x]=i.L.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;let h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.$(Di,Gn,r))*h.a}getOpacityAtLatLng(r,h){return this._transform.projection.supportsFog?function(g,v,x){let S=i.Y.fromLngLat(v),k=x.elevation?x.elevation.getAtPointOrZero(S):0;return zr(g,S.x,S.y,k,x)}(this.state,r,h):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];let h=this._transform.calculateFogTileMatrix(r.toUnwrapped());return rl(this.state,h,0,0,i.a3,i.a3,this._transform)}getOpacityForBounds(r,h,g,v,x){return this._transform.projection.supportsFog?rl(this.state,r,h,g,v,x,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Fr(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;let h=[4,5,6,7];for(let g of h){let v=r.points[g],x;if(v[2]>=0)x=v;else{let S=r.points[g-4];x=i.a4(S,v,S[2]/(S[2]-v[2]))}if(zr(this.state,x[0],x[1],0,this._transform)>=Sn)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,h,g){return(!g||g.validate!==!1)&&ii(this,r.call(_e,i.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.L})))}}class Pd extends i.E{constructor(r,h,g,v){super(),this.scope=g,this._options=r,this.properties=new i.a0(h),this._transitionable=new i.U(h,g,new Map(v)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,h){this._options=r,this._transitionable.setTransitionOrValue(r.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let ci=new i.N({color:new i.O(i.L.properties_light_ambient.color),intensity:new i.O(i.L.properties_light_ambient.intensity)}),ip=new i.N({direction:new i.a5(i.L.properties_light_directional.direction),color:new i.O(i.L.properties_light_directional.color),intensity:new i.O(i.L.properties_light_directional.intensity),"cast-shadows":new i.O(i.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new i.O(i.L.properties_light_directional["shadow-intensity"])});var Ss=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,np=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,rp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,op="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ap=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,sp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,lp=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,cp=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,dp=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,hp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Lg=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let lc=[];cc(Ss,lc),cc(rp,lc),cc(np,lc);let nu={"_prelude_fog.vertex.glsl":sp,"_prelude_terrain.vertex.glsl":ap,"_prelude_shadow.vertex.glsl":hp,"_prelude_fog.fragment.glsl":lp,"_prelude_shadow.fragment.glsl":Lg,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":cp,"_prelude_raster_particle.glsl":dp},ru={};wi("",ap),wi(lp,sp),wi(Lg,hp),wi(cp,""),wi(dp,"");let Fg=wi(np,rp),zg=Ss;var Bg={background:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:wi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:wi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:wi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:wi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:wi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:wi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:wi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:wi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:wi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:wi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:wi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:wi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:wi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:wi(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:wi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:wi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:wi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:wi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,op),skyboxGradient:wi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,op),skyboxCapture:wi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:wi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:wi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:wi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:wi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function cc(f,r){let h=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of h)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let v=g.split(" ");for(let x of v)r.includes(x)||r.push(x)}}function wi(f,r){let h=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(A=>{let L=A.split(" ");return L[L.length-1]}),v=[...new Set(v)]);let x={},S=[],k=[];if(f=f.replace(h,(A,L)=>(k.push(L),"")),(r=r.replace(h,(A,L)=>(S.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...lc];cc(f,D),cc(r,D);for(let A of[...S,...k])nu[A]||console.error(`Undefined include: ${A}`),ru[A]||(ru[A]=[],cc(nu[A],ru[A])),D=[...D,...ru[A]];return{fragmentSource:f=f.replace(g,(A,L,z,U,H)=>(x[H]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${z} ${U} ${H};
#else
uniform ${z} ${U} u_${H};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${H}
    ${z} ${U} ${H} = u_${H};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${z} ${U} ${H};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(g,(A,L,z,U,H)=>{let $=U==="float"?"vec2":U,Y=H.match(/color/)?"color":$;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${H}
in ${z} ${U} a_${H};
#endif
`:x[H]?L==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${z} ${$} a_${H};
out ${z} ${U} ${H};
#else
uniform ${z} ${U} u_${H};
#endif
`:L==="initialize"?Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${z} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${Y}(a_${H}, u_${H}_t);
#else
    ${z} ${U} ${H} = u_${H};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${z} ${U} a_${H};
    out ${z} ${U} ${H};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${H} = a_${H};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${z} ${$} a_${H};
#else
uniform ${z} ${U} u_${H};
#endif
`:L==="define-instanced"?Y==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${H}0;
in vec4 a_${H}1;
in vec4 a_${H}2;
in vec4 a_${H}3;
#else
uniform ${z} ${U} u_${H};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${z} ${$} a_${H};
#else
uniform ${z} ${U} u_${H};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${z} ${U} ${H} = a_${H};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${z} ${U} ${H} = a_${H};
#else
    ${z} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${z} ${U} ${H} = unpack_mix_${Y}(a_${H}, u_${H}_t);
#else
    ${z} ${U} ${H} = u_${H};
#endif
`}),staticAttributes:v,usedDefines:D,vertexIncludes:S,fragmentIncludes:k}}class yy{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,h,g,v,x,S,k,D){this.context=r;let A=this.boundPaintVertexBuffers.length!==v.length;for(let z=0;!A&&z<v.length;z++)this.boundPaintVertexBuffers[z]!==v[z]&&(A=!0);let L=this.boundDynamicVertexBuffers.length!==k.length;for(let z=0;!L&&z<k.length;z++)this.boundDynamicVertexBuffers[z]!==k[z]&&(L=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||A||L||this.boundIndexBuffer!==x||this.boundVertexOffset!==S)this.freshBind(h,g,v,x,S,k,D);else{r.bindVertexArrayOES.set(this.vao);for(let z of k)z&&(z.bind(),D&&z.instanceCount&&z.setVertexAttribDivisor(r.gl,h,D));x&&x.dynamicDraw&&x.bind()}}freshBind(r,h,g,v,x,S,k){let D=r.numAttributes,A=this.context,L=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=S,h.enableAttributes(L,r),h.bind(),h.setVertexAttribPointers(L,r,x);for(let z of g)z.enableAttributes(L,r),z.bind(),z.setVertexAttribPointers(L,r,x);for(let z of S)z&&(z.enableAttributes(L,r),z.bind(),z.setVertexAttribPointers(L,r,x),k&&z.instanceCount&&z.setVertexAttribDivisor(L,r,k));v&&v.bind(),A.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function vy(f,r){let h=Math.pow(2,r.canonical.z),g=r.canonical.y;return[new i.Y(0,g/h).toLngLat().lat,new i.Y(0,(g+1)/h).toLngLat().lat]}function xy(f,r,h,g,v,x,S){let k=f.context,D=k.gl,A=h.hillshadeFBO;if(!A)return;f.prepareDrawTile();let L=f.isTileAffectedByFog(r),z=f.getOrCreateProgram("hillshade",{overrideFog:L});k.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,A.colorAttachment.get());let U=((Z,Q,re,oe)=>{let ae=re.paint.get("hillshade-shadow-color"),ge=re.paint.get("hillshade-highlight-color"),fe=re.paint.get("hillshade-accent-color"),ne=re.paint.get("hillshade-emissive-strength"),se=i.ab(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")se-=Z.transform.angle;else if(Z.style&&Z.style.enable3dLights()&&Z.style.directionalLight){let we=Z.style.directionalLight.properties.get("direction"),Oe=i.ac(we.x,we.y,we.z);se=i.ab(Oe[1])}let le=!Z.options.moving;return{u_matrix:oe||Z.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),le),u_image:0,u_latrange:vy(0,Q.tileID),u_light:[re.paint.get("hillshade-exaggeration"),se],u_shadow:ae.toRenderColor(re.lut),u_highlight:ge.toRenderColor(re.lut),u_emissive_strength:ne,u_accent:fe.toRenderColor(re.lut)}})(f,h,g,f.terrain?r.projMatrix:null);f.uploadCommonUniforms(k,z,r.toUnwrapped());let{tileBoundsBuffer:H,tileBoundsIndexBuffer:$,tileBoundsSegments:Y}=f.getTileBoundsBuffers(h);z.draw(f,D.TRIANGLES,v,x,S,i.af.disabled,U,g.id,H,$,Y)}function up(f,r,h){if(!r.needsDEMTextureUpload)return;let g=f.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||f.getTileTexture(h.stride);let x=h.getPixels();r.demTexture?r.demTexture.update(x,{premultiply:!1}):r.demTexture=new i.T(g,x,v.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function va(f,r,h){let g=f.context,v=g.gl;if(!r.dem)return;let x=r.dem;if(g.activeTexture.set(v.TEXTURE1),up(f,r,x),!r.demTexture)return;r.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);let S=x.dim;g.activeTexture.set(v.TEXTURE0);let k=r.hillshadeFBO;if(!k){let U=new i.T(g,{width:S,height:S,data:null},v.RGBA);U.bind(v.LINEAR,v.CLAMP_TO_EDGE),k=r.hillshadeFBO=g.createFramebuffer(S,S,!0,"renderbuffer"),k.colorAttachment.set(U.texture)}g.bindFramebuffer.set(k.framebuffer),g.viewport.set([0,0,S,S]);let{tileBoundsBuffer:D,tileBoundsIndexBuffer:A,tileBoundsSegments:L}=f.getMercatorTileBoundsBuffers(),z=[];f.linearFloatFilteringSupported()&&z.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:z}).draw(f,v.TRIANGLES,i.ae.disabled,i.ag.disabled,i.a.unblended,i.af.disabled,((U,H)=>{let $=H.stride,Y=i.ad.create();return i.ad.ortho(Y,0,i.a3,-i.a3,0,0,1),i.ad.translate(Y,Y,[0,-i.a3,0]),{u_matrix:Y,u_image:1,u_dimension:[$,$],u_zoom:U.overscaledZ}})(r.tileID,x),h.id,D,A,L),r.needsHillshadePrepare=!1}function mp(f,r,h,g,v){let x=function(S,k){if(S)return v(S);if(k){if(f.url&&k.tiles&&f.tiles&&delete f.tiles,k.variants){if(!Array.isArray(k.variants))return v(new Error("variants must be an array"));for(let A of k.variants){if(A==null||typeof A!="object"||A.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(A.capabilities))return v(new Error("capabilities must be an array"));if(A.capabilities.length===1&&A.capabilities[0]==="meshopt"){k=i.W(k,A);break}}}let D=i.ah(i.W(k,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(D.vectorLayers=k.vector_layers,D.vectorLayerIds=D.vectorLayers.map(A=>A.id)),k.raster_layers&&(D.rasterLayers=k.raster_layers,D.rasterLayerIds=D.rasterLayers.map(A=>A.id)),D.tiles=r.canonicalizeTileset(D,f.url),v(null,D)}};return f.url?i.g(r.transformRequest(r.normalizeSourceURL(f.url,null,h,g),i.R.Source),x):i.e.frame(()=>x(null,f))}class Od{constructor(r,h,g){this.bounds=i.ai.convert(this.validateBounds(r)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){let h=Math.pow(2,r.z),g=Math.floor(i.aj(this.bounds.getWest())*h),v=Math.floor(i.ak(this.bounds.getNorth())*h),x=Math.ceil(i.aj(this.bounds.getEast())*h),S=Math.ceil(i.ak(this.bounds.getSouth())*h);return r.x>=g&&r.x<x&&r.y>=v&&r.y<S}}class Rd extends i.E{constructor(r,h,g,v){super(),this.id=r,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.W({type:"raster"},h),i.W(this,i.ah(h,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new i.f("dataloading",{dataType:"source"})),this._tileJSONRequest=mp(this._options,this.map._requestManager,null,null,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new i.d(h)):g&&(i.W(this,g),g.bounds&&(this.tileBounds=new Od(g.bounds,this.minzoom,this.maxzoom)),i.an(g.tiles),this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))),r&&r(h)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();let r=i.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return i.W({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,h){let g=i.e.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);r.request=i.h(this.map._requestManager.transformRequest(v,i.R.Tile),(x,S,k,D)=>(delete r.request,r.aborted?(r.state="unloaded",h(null)):x?(r.state="errored",h(x)):S?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:k,expires:D}),r.setTexture(S,this.map.painter),r.state="loaded",i.am(this.dispatcher),void h(null)):h(null)))}abortTile(r,h){r.request&&(r.request.cancel(),delete r.request),h&&h()}unloadTile(r,h){r.texture&&r.texture instanceof i.T?(r.destroy(!0),r.texture&&r.texture instanceof i.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ou extends i.E{constructor(r,h,g,v){if(super(),this.id=r,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.W(this,i.ah(h,["url","scheme","tileSize","promoteId"])),this._options=i.W({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new i.ao}load(r){this._loaded=!1,this.fire(new i.f("dataloading",{dataType:"source"}));let h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=mp(this._options,this.map._requestManager,h,g,(v,x)=>{this._tileJSONRequest=null,this._loaded=!0,v?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new i.d(v))):x&&(i.W(this,x),x.bounds&&(this.tileBounds=new Od(x.bounds,this.minzoom,this.maxzoom)),i.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))),r&&r(v)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();let r=i.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return i.W({},this._options)}loadTile(r,h){let g=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),v=this.map._requestManager.transformRequest(g,i.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,S={request:v,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,lut:x?{image:x.image.clone()}:null,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=h:r.request=r.actor.send("reloadTile",S,k.bind(this));else if(r.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",S,k.bind(this),void 0,!0);else{let D=i.ap.call({deduped:this._deduped},S,(A,L)=>{A||!L?k.call(this,A):(S.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},r.actor&&r.actor.send("loadTile",S,k.bind(this),void 0,!0))},!0);r.request={cancel:D}}function k(D,A){return delete r.request,r.aborted?h(null):D&&D.status!==404?h(D):(A&&A.resourceTiming&&(r.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&r.setExpiryData(A),r.loadVectorData(A,this.map.painter),i.am(this.dispatcher),h(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,h){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let ol=f=>({u_matrix:new i.a6(f),u_image0:new i.a7(f),u_skirt_height:new i.aa(f),u_ground_shadow_factor:new i.aq(f)}),yt=(f,r,h)=>({u_matrix:f,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:h}),Ng=(f,r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:S,u_frustum_tr:k,u_frustum_br:D,u_frustum_bl:A,u_globe_pos:L,u_globe_radius:z,u_viewport:U,u_grid_matrix:Y?Float32Array.from(Y):new Float32Array(9),u_skirt_height:H,u_far_z_cutoff:$});class Ld{constructor(r=0,h=0,g=0,v=0){if(isNaN(r)||r<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=h,this.left=g,this.right=v}interpolate(r,h,g){return h.top!=null&&r.top!=null&&(this.top=i.a2(r.top,h.top,g)),h.bottom!=null&&r.bottom!=null&&(this.bottom=i.a2(r.bottom,h.bottom,g)),h.left!=null&&r.left!=null&&(this.left=i.a2(r.left,h.left,g)),h.right!=null&&r.right!=null&&(this.right=i.a2(r.right,h.right,g)),this}getCenter(r,h){let g=i.at((this.left+r-this.right)/2,0,r),v=i.at((this.top+h-this.bottom)/2,0,h);return new i.P(g,v)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Ld(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ti(f,r){let h=i.aw(f,3);i.ad.fromQuat(f,r),i.az(f,3,h)}function Br(f,r){let h=i.av.identity([]);return i.av.rotateZ(h,h,-r),i.av.rotateX(h,h,-f),h}function Vg(f,r){let h=[f[0],f[1],0],g=[r[0],r[1],0];if(i._.length(h)>=1e-15){let S=i._.normalize([],h);i._.scale(g,S,i._.dot(g,S)),r[0]=g[0],r[1]=g[1]}let v=i._.cross([],r,f);if(i._.len(v)<1e-15)return null;let x=Math.atan2(-v[1],v[0]);return Br(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}class pp{constructor(r,h){this.position=r,this.orientation=h}get position(){return this._position}set position(r){if(r){let h=r instanceof i.Y?r:new i.Y(r[0],r[1],r[2]);this._renderWorldCopies&&(h.x=i.au(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(r,h){if(this.orientation=null,!this.position)return;let g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(i.Y.fromLngLat(r)):0,x=i.Y.fromLngLat(r,v),S=[x.x-g.x,x.y-g.y,x.z-g.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Vg(S,h)}setPitchBearing(r,h){this.orientation=Br(i.ab(r),i.ab(-h))}}class Fd{constructor(r,h){this._transform=i.ad.identity([]),this.orientation=h,this.position=r}get mercatorPosition(){let r=this.position;return new i.Y(r[0],r[1],r[2])}get position(){let r=i.aw(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var h;r&&i.az(this._transform,3,[(h=r)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||i.av.identity([]),r&&Ti(this._transform,this._orientation)}getPitchBearing(){let r=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,h){this._orientation=Br(r,h),Ti(this._transform,this._orientation)}forward(){let r=i.aw(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){let r=i.aw(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){let r=i.aw(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,h){let g=new Float64Array(16);return i.ad.invert(g,this.getWorldToCamera(r,h)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,h,g){let v=this.position;i._.scale(v,v,-r);let x=new Float64Array(16);return i.ad.fromScaling(x,[g,g,g]),i.ad.translate(x,x,v),x[10]*=h,x}getWorldToCamera(r,h){let g=new Float64Array(16),v=new Float64Array(4),x=this.position;return i.av.conjugate(v,this._orientation),i._.scale(x,x,-r),i.ad.fromQuat(g,v),i.ad.translate(g,g,x),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(r,h,g,v){let x=new Float64Array(16);return i.ad.perspective(x,r,h,g,v),x}getCameraToClipOrthographic(r,h,g,v,x,S){let k=new Float64Array(16);return i.ad.ortho(k,r,h,g,v,x,S),k}getDistanceToElevation(r,h=!1){let g=r===0?0:i.ax(r,h?i.ay(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new Fd([...this.position],[...this.orientation])}}let dc={unknown:0,flipRequired:1,flipNotRequired:2},pi=Math.tan(85*Math.PI/180);function al(f,r,h,g,v,x,S){let k=i.ad.create();if(h)if(x.name==="globe"){let D=i.aB(v,r);i.ad.multiply(k,k,D)}else{let D=i.aC.invert([],S);k[0]=D[0],k[1]=D[1],k[4]=D[2],k[5]=D[3],g||i.ad.rotateZ(k,k,v.angle)}else i.ad.multiply(k,v.labelPlaneMatrix,f);return k}function sl(f,r,h,g,v,x,S){let k=al(f,r,h,g,v,x,S);return x.name==="globe"&&h||(k[2]=k[6]=k[10]=k[14]=0),k}function hc(f,r,h,g,v,x,S){if(h){if(x.name==="globe"){let k=al(f,r,h,g,v,x,S);return i.ad.invert(k,k),i.ad.multiply(k,f,k),k}{let k=i.ad.clone(f),D=i.ad.identity([]);return D[0]=S[0],D[1]=S[1],D[4]=S[2],D[5]=S[3],i.ad.multiply(k,k,D),g||i.ad.rotateZ(k,k,-v.angle),k}}return v.glCoordMatrix}function zo(f,r,h,g){let v=[f,r,h,1];h?i.aA.transformMat4(v,v,g):xa(v,v,g);let x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function Nr(f,r){return Math.min(.5+f/r*.5,1.5)}function wy(f,r){let h=f[0]/f[3],g=f[1]/f[3];return h>=-r[0]&&h<=r[0]&&g>=-r[1]&&g<=r[1]}function au(f,r,h,g,v,x,S,k,D,A){let L=h.transform,z=g?f.textSizeData:f.iconSizeData,U=i.aD(z,h.transform.zoom),H=L.projection.name==="globe",$=[256/h.width*2+1,256/h.height*2+1],Y=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Y.clear();let Z=null;H&&(Z=g?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);let Q=f.lineVertexArray,re=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,oe=h.transform.width/h.transform.height,ae,ge=!1;for(let fe=0;fe<re.length;fe++){let ne=re.get(fe),{numGlyphs:se,writingMode:le}=ne;if(le!==i.aE.vertical||ge||ae===i.aE.horizontal||(ge=!0),ae=le,(ne.hidden||le===i.aE.vertical)&&!ge){ll(se,Y);continue}ge=!1;let we=new i.P(ne.tileAnchorX,ne.tileAnchorY),{x:Oe,y:ue,z:Re}=L.projection.projectTilePoint(we.x,we.y,A.canonical);if(D){let[kt,bt,it]=D(we);Oe+=kt,ue+=bt,Re+=it}let Be=[Oe,ue,Re,1];if(i.aA.transformMat4(Be,Be,r),!wy(Be,$)){ll(se,Y);continue}let Qe=Be[3],Je=Nr(h.transform.getCameraToCenterDistance(L.projection),Qe),Ze=i.aF(z,U,ne),Ie=S?Ze/Je:Ze*Je,Ve=zo(Oe,ue,Re,v);if(Ve[3]<=0){ll(se,Y);continue}let Ye={},ft=S?null:D,_t=gp(ne,Ie,!1,k,r,v,x,f.glyphOffsetArray,Q,Y,Z,Ve,we,Ye,oe,ft,L.projection,A,S);ge=_t.useVertical,ft&&_t.needsFlipping&&(Ye={}),(_t.notEnoughRoom||ge||_t.needsFlipping&&gp(ne,Ie,!0,k,r,v,x,f.glyphOffsetArray,Q,Y,Z,Ve,we,Ye,oe,ft,L.projection,A,S).notEnoughRoom)&&ll(se,Y)}g?(f.text.dynamicLayoutVertexBuffer.updateData(Y),Z&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(Z)):(f.icon.dynamicLayoutVertexBuffer.updateData(Y),Z&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(Z))}function su(f,r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y){let{lineStartIndex:Z,glyphStartIndex:Q,segment:re}=k,oe=Q+k.numGlyphs,ae=Z+k.lineLength,ge=r.getoffsetX(Q),fe=r.getoffsetX(oe-1),ne=uc(f*ge,h,g,v,x,S,re,Z,ae,D,A,L,z,U,!0,H,$,Y);if(!ne)return null;let se=uc(f*fe,h,g,v,x,S,re,Z,ae,D,A,L,z,U,!0,H,$,Y);return se?{first:ne,last:se}:null}function fp(f,r,h,g){return f===i.aE.horizontal&&Math.abs(g)>Math.abs(h)?{useVertical:!0}:f===i.aE.vertical?g>0?{needsFlipping:!0}:null:r!==dc.unknown&&function(v,x){return v===0||Math.abs(x/v)>pi}(h,g)?r===dc.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function gp(f,r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y,Z,Q,re){let oe=r/24,ae=f.lineOffsetX*oe,ge=f.lineOffsetY*oe,{lineStartIndex:fe,glyphStartIndex:ne,numGlyphs:se,segment:le,writingMode:we,flipState:Oe}=f,ue=fe+f.lineLength,Re=Be=>{if(L){let[Ie,Ve,Ye]=Be.up,ft=A.length;i.aG(L,ft+0,Ie,Ve,Ye),i.aG(L,ft+1,Ie,Ve,Ye),i.aG(L,ft+2,Ie,Ve,Ye),i.aG(L,ft+3,Ie,Ve,Ye)}let[Qe,Je,Ze]=Be.point;i.aH(A,Qe,Je,Ze,Be.angle)};if(se>1){let Be=su(oe,k,ae,ge,h,z,U,f,D,x,H,Y,!1,Z,Q,re);if(!Be)return{notEnoughRoom:!0};if(g&&!h){let[Qe,Je,Ze]=Be.first.point,[Ie,Ve,Ye]=Be.last.point;[Qe,Je]=zo(Qe,Je,Ze,S),[Ie,Ve]=zo(Ie,Ve,Ye,S);let ft=fp(we,Oe,(Ie-Qe)*$,Ve-Je);if(f.flipState=ft&&ft.needsFlipping?dc.flipRequired:dc.flipNotRequired,ft)return ft}Re(Be.first);for(let Qe=ne+1;Qe<ne+se-1;Qe++){let Je=uc(oe*k.getoffsetX(Qe),ae,ge,h,z,U,le,fe,ue,D,x,H,Y,!1,!1,Z,Q,re);if(!Je)return A.length-=4*(Qe-ne),{notEnoughRoom:!0};Re(Je)}Re(Be.last)}else{if(g&&!h){let Qe=zo(U.x,U.y,0,v),Je=fe+le+1,Ze=new i.P(D.getx(Je),D.gety(Je)),Ie=zo(Ze.x,Ze.y,0,v),Ve=Ie[3]>0?Ie:zd(U,Ze,Qe,1,v,void 0,Z,Q.canonical),Ye=fp(we,Oe,(Ve[0]-Qe[0])*$,Ve[1]-Qe[1]);if(f.flipState=Ye&&Ye.needsFlipping?dc.flipRequired:dc.flipNotRequired,Ye)return Ye}let Be=uc(oe*k.getoffsetX(ne),ae,ge,h,z,U,le,fe,ue,D,x,H,Y,!1,!1,Z,Q,re);if(!Be)return{notEnoughRoom:!0};Re(Be)}return{}}function lu(f,r,h,g,v){let{x,y:S,z:k}=g.projectTilePoint(f.x,f.y,r);if(!v)return zo(x,S,k,h);let[D,A,L]=v(f);return zo(x+D,S+A,k+L,h)}function zd(f,r,h,g,v,x,S,k){let D=lu(f.sub(r)._unit()._add(f),k,v,S,x);return i._.sub(D,h,D),i._.normalize(D,D),i._.scaleAndAdd(D,h,D,g)}function uc(f,r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y,Z,Q){let re=g?f-r:f+r,oe=re>0?1:-1,ae=0;g&&(oe*=-1,ae=Math.PI),oe<0&&(ae+=Math.PI);let ge=k+S+(oe>0?0:1)|0,fe=v,ne=v,se=0,le=0,we=Math.abs(re),Oe=[],ue=[],Re=x,Be=Re,Qe=()=>zd(Be,Re,ne,we-se+1,L,U,Y,Z.canonical);for(;se+le<=we;){if(ge+=oe,ge<k||ge>=D)return null;if(ne=fe,Be=Re,Oe.push(ne),H&&ue.push(Be),Re=new i.P(A.getx(ge),A.gety(ge)),fe=z[ge],!fe){let bt=lu(Re,Z.canonical,L,Y,U);fe=bt[3]>0?z[ge]=bt:Qe()}se+=le,le=i._.distance(ne,fe)}$&&U&&(z[ge]&&(fe=Qe(),le=i._.distance(ne,fe)),z[ge]=fe);let Je=(we-se)/le,Ze=Re.sub(Be)._mult(Je)._add(Be),Ie=i._.sub([],fe,ne),Ve=i._.scaleAndAdd([],ne,Ie,Je),Ye=[0,0,1],ft=Ie[0],_t=Ie[1];if(Q&&(Ye=Y.upVector(Z.canonical,Ze.x,Ze.y),Ye[0]!==0||Ye[1]!==0||Ye[2]!==1)){let bt=[Ye[2],0,-Ye[0]],it=i._.cross([],Ye,bt);i._.normalize(bt,bt),i._.normalize(it,it),ft=i._.dot(Ie,bt),_t=i._.dot(Ie,it)}if(h){let bt=i._.cross([],Ye,Ie);i._.normalize(bt,bt),i._.scaleAndAdd(Ve,Ve,bt,h*oe)}let kt=ae+Math.atan2(_t,ft);return Oe.push(Ve),H&&ue.push(Ze),{point:Ve,angle:kt,path:Oe,tilePath:ue,up:Ye}}function ll(f,r){let h=r.length,g=h+4*f;r.resize(g),r.float32.fill(-1/0,4*h,4*g)}function xa(f,r,h){let g=r[0],v=r[1];return f[0]=h[0]*g+h[4]*v+h[12],f[1]=h[1]*g+h[5]*v+h[13],f[3]=h[3]*g+h[7]*v+h[15],f}let _p=(f,r,h)=>(1-h)*f+h*r,qn=f=>f*f*f*f*f;class wa{constructor(r,h,g,v,x,S,k){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=r||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(S),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new i.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ld,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Fd,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let r=new wa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,h=!1){let g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(r||g)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return i.ah(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};let h=this.projection?this.getProjection():void 0;this.projection=i.aJ(this.projectionOptions);let g=!_(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){let r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.aJ({name:"mercator"});let h=r!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){let r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.au(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){let h=-r*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=i.aC.create(),i.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){let h=i.at(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=i.ab(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){let h=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){let r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let g=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let r=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop(),v=0,x=0;for(let S=0;S<h.length;S++){let k=new i.P(h[S][0]*this.width,g+h[S][1]*(this.height-g)),D=r.pointCoordinate(k);if(!D)continue;let A=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);v+=D[3]*A,x+=A}return x===0?NaN:v/x}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let r=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(r),x=this._mercatorZfromZoom(this._maxZoom),S=Math.max(v-g,x);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){let h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude())),g;g=r.z<this._camera.position[2]?[h.x,h.y,h.z]:[r.x,r.y,r.z];let v=i._.length(i._.sub([],this._camera.position,g));return i.at(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let h=!1;if(r.orientation&&!i.av.exactEquals(r.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(r.orientation)),r.position){let g=[r.position.x,r.position.y,r.position.z];i._.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let r=this._camera.position,h=new pp;return h.position=new i.Y(r[0],r[1],r[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(r){if(!i.av.length(r))return!1;i.av.normalize(r,r);let h=i._.transformQuat([],[0,0,-1],r),g=i._.transformQuat([],[0,-1,0],r);if(g[2]<0)return!1;let v=Vg(h,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(r){let h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;r[2]=i.at(r[2],v/g,v/h),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,h,g){this._unmodified=!1,this._edgeInsets.interpolate(r,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){let h=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(r){let h=[new i.aK(0,r)];if(this.renderWorldCopies){let g=this.pointCoordinate(new i.P(0,0)),v=this.pointCoordinate(new i.P(this.width,0)),x=this.pointCoordinate(new i.P(this.width,this.height)),S=this.pointCoordinate(new i.P(0,this.height)),k=Math.floor(Math.min(g.x,v.x,x.x,S.x)),D=Math.floor(Math.max(g.x,v.x,x.x,S.x)),A=1;for(let L=k-A;L<=D+A;L++)L!==0&&h.push(new i.aK(L,r))}return h}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(r,h,g){let v=[];if(h[0]===0&&h[1]===0)return v;for(let S of r){let k=S.canonical,D=S.overscaledZ,A=S.wrap,L=1<<k.z,z=k.x+1<L,U=k.x>0,H=k.y+1<L,$=k.y>0,Y=S.wrap-(U?0:1),Z=S.wrap+(z?0:1),Q=U?k.x-1:L-1,re=z?k.x+1:0;h[0]<0?(v.push(new i.aL(D,Z,k.z,re,k.y)),h[1]<0&&H&&(v.push(new i.aL(D,A,k.z,k.x,k.y+1)),v.push(new i.aL(D,Z,k.z,re,k.y+1))),h[1]>0&&$&&(v.push(new i.aL(D,A,k.z,k.x,k.y-1)),v.push(new i.aL(D,Z,k.z,re,k.y-1)))):h[0]>0?(v.push(new i.aL(D,Y,k.z,Q,k.y)),h[1]<0&&H&&(v.push(new i.aL(D,A,k.z,k.x,k.y+1)),v.push(new i.aL(D,Y,k.z,Q,k.y+1))),h[1]>0&&$&&(v.push(new i.aL(D,A,k.z,k.x,k.y-1)),v.push(new i.aL(D,Y,k.z,Q,k.y-1)))):h[1]<0&&H?v.push(new i.aL(D,A,k.z,k.x,k.y+1)):$&&v.push(new i.aL(D,A,k.z,k.x,k.y-1))}if(v.length>1){v.sort((D,A)=>D.overscaledZ-A.overscaledZ||D.wrap-A.wrap||D.canonical.z-A.canonical.z||D.canonical.x-A.canonical.x||D.canonical.y-A.canonical.y);let S=0,k=0;for(;k<v.length;)v[k].equals(v[S])?++k:v[++S]=v[k++];v.length=S+1}let x=[];for(let S of v)v.some(k=>S.isChildOf(k))||x.push(S);return v=x.filter(S=>!r.some(k=>!!(S.overscaledZ<g&&k.isChildOf(S))||S.equals(k)||S.isChildOf(k))),v}coveringTiles(r){let h=this.coveringZoomLevel(r),g=h,v=this.elevation&&this.elevation.exaggeration(),x=v&&!r.isTerrainDEM,S=this.projection.name==="mercator";if(r.minzoom!==void 0&&h<r.minzoom)return[];r.maxzoom!==void 0&&h>r.maxzoom&&(h=r.maxzoom);let k=this.locationCoordinate(this.center),D=this.center.lat,A=1<<h,L=[A*k.x,A*k.y,0],z=this.projection.name==="globe",U=!z,H=i.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,U),$=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=A*i.ax(1,this.center.lat),Z=this._camera.position[2]/i.ax(1,this.center.lat),Q=[A*$.x,A*$.y,Z*(U?1:Y)],re=z||v,oe=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ae=this.isLODDisabled(!0)?h:0,ge;if(this._elevation&&r.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){let Ie=this._elevation.getMinMaxForVisibleTiles();ge=Ie?Ie.max:this._centerAltitude}else ge=this._centerAltitude;let fe=r.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=this.projection.isReprojectedInTileSpace?i.aN(this):1,se=Ie=>{let Ye=new i.Y(Ie.x+25e-6,Ie.y,Ie.z),ft=new i.Y(Ie.x,Ie.y+25e-6,Ie.z),_t=Ie.toLngLat(),kt=Ye.toLngLat(),bt=ft.toLngLat(),it=this.locationCoordinate(_t),Ge=this.locationCoordinate(kt),Dt=this.locationCoordinate(bt),ri=Math.hypot(Ge.x-it.x,Ge.y-it.y),ei=Math.hypot(Dt.x-it.x,Dt.y-it.y);return Math.sqrt(ri*ei)*ne/25e-6},le=Ie=>{let Ve=ge,Ye=fe;return{aabb:i.aQ(this,A,0,0,0,Ie,Ye,Ve,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:Ve,wrap:Ie,fullyVisible:!1}},we=[],Oe=[],ue=h,Re=r.reparseOverscaled?g:h,Be=Ie=>Ie*Ie,Qe=Be((Z-this._centerAltitude)*Y),Je=Ie=>{if(!this._elevation||!Ie.tileID||!S)return;let Ve=this._elevation.getMinMaxForTile(Ie.tileID),Ye=Ie.aabb;Ve?(Ye.min[2]=Ve.min,Ye.max[2]=Ve.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(Ie.shouldSplit=Ze(Ie),Ie.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},Ze=Ie=>{if(Ie.zoom<ae)return!0;if(Ie.zoom===ue)return!1;if(Ie.shouldSplit!=null)return Ie.shouldSplit;let Ve=Ie.aabb.distanceX(Q),Ye=Ie.aabb.distanceY(Q),ft=Qe,_t=1;if(z){ft=Be(Ie.aabb.distanceZ(Q));let it=Math.pow(2,Ie.zoom),Ge=i.ay((Ie.y+1)/it),Dt=i.ay(Ie.y/it),ri=Math.min(Math.max(D,Ge),Dt),ei=i.b4(ri)/i.b4(D);if(_t=ri===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ei/this._mercatorScaleRatio),this.zoom<=i.b1&&Ie.zoom===ue-1&&ei>=.9)return!0}else if(x&&(ft=Be(Ie.aabb.distanceZ(Q)*Y)),this.projection.isReprojectedInTileSpace&&g<=5){let it=Math.pow(2,Ie.zoom),Ge=se(new i.Y((Ie.x+.5)/it,(Ie.y+.5)/it));_t=Ge>.85?1:Ge}let kt=Ve*Ve+Ye*Ye+ft,bt=Be((1<<ue-Ie.zoom)*oe*_t*((it,Ge)=>{if(Ge*Be(.707)<it)return 1;let Dt=Math.sqrt(Ge/it);return Dt/(1.4144271570014144+(Math.pow(1.1,Dt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ft,Qe),kt));return kt<bt};if(this.renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)we.push(le(-Ie)),we.push(le(Ie));for(we.push(le(0));we.length>0;){let Ie=we.pop(),Ve=Ie.x,Ye=Ie.y,ft=Ie.fullyVisible,_t=()=>this.projection.name==="globe"&&(Ie.y===0||Ie.y===(1<<Ie.zoom)-1);if(!ft){let kt=re?Ie.aabb.intersects(H):Ie.aabb.intersectsFlat(H);if(kt===0&&_t()){let bt=new i.aO(Ie.zoom,Ve,Ye);kt=i.aP(this,A,bt,!0).intersects(H)}if(kt===0)continue;ft=kt===2}if(Ie.zoom!==ue&&Ze(Ie))for(let kt=0;kt<4;kt++){let bt=(Ve<<1)+kt%2,it=(Ye<<1)+(kt>>1),Ge={aabb:S?Ie.aabb.quadrant(kt):i.aQ(this,A,Ie.zoom+1,bt,it,Ie.wrap,Ie.minZ,Ie.maxZ,this.projection),zoom:Ie.zoom+1,x:bt,y:it,wrap:Ie.wrap,fullyVisible:ft,tileID:void 0,shouldSplit:void 0,minZ:Ie.minZ,maxZ:Ie.maxZ};x&&!z&&(Ge.tileID=new i.aL(Ie.zoom+1===ue?Re:Ie.zoom+1,Ie.wrap,Ie.zoom+1,bt,it),Je(Ge)),we.push(Ge)}else{let kt=Ie.zoom===ue?Re:Ie.zoom;if(r.minzoom&&r.minzoom>kt)continue;if(!ft){let Dt=re?Ie.aabb.intersectsPrecise(H):Ie.aabb.intersectsPreciseFlat(H);if(Dt===0&&_t()){let ri=new i.aO(Ie.zoom,Ve,Ye);Dt=i.aP(this,A,ri,!0).intersectsPrecise(H)}if(Dt===0)continue}let bt=L[0]-(.5+Ve+(Ie.wrap<<Ie.zoom))*(1<<h-Ie.zoom),it=L[1]-.5-Ye,Ge=Ie.tileID?Ie.tileID:new i.aL(kt,Ie.wrap,Ie.zoom,Ve,Ye);Oe.push({tileID:Ge,distanceSq:bt*bt+it*it})}}if(this.fogCullDistSq){let Ie=this.fogCullDistSq,Ve=this.horizonLineFromTop();Oe=Oe.filter(Ye=>{let ft=[0,0,0,1],_t=[i.a3,i.a3,0,1],kt=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());i.aA.transformMat4(ft,ft,kt),i.aA.transformMat4(_t,_t,kt);let bt=i.aA.min([],ft,_t),it=i.aA.max([],ft,_t),Ge=i.aR(bt,it);if(Ge===0)return!0;let Dt=!1,ri=this._elevation;if(ri&&Ge>Ie&&Ve!==0){let ei=this.calculateProjMatrix(Ye.tileID.toUnwrapped()),gi;r.isTerrainDEM||(gi=ri.getMinMaxForTile(Ye.tileID)),gi||(gi={min:fe,max:ge});let Ii=i.b2(this.rotation),Ji=[Ii[0]*i.a3,Ii[1]*i.a3,gi.max];i._.transformMat4(Ji,Ji,ei),Dt=(1-Ji[1])*this.height*.5<Ve}return Ge<Ie||Dt})}return Oe.sort((Ie,Ve)=>Ie.distanceSq-Ve.distanceSq).map(Ie=>Ie.tileID)}resize(r,h){this.width=r,this.height=h,this.pixelsToGLUnits=[2/r,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){let h=i.at(r.lat,-i.aS,i.aS),g=this.projection.project(r.lng,h);return new i.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,h){let g,v,x=this.centerPoint;if(this.projection.name==="globe"){let k=this.worldSize;g=(h.x-x.x)/k,v=(h.y-x.y)/k}else{let k=this.pointCoordinate(h),D=this.pointCoordinate(x);g=k.x-D.x,v=k.y-D.y}let S=this.locationCoordinate(r);this.setLocation(new i.Y(S.x-g,S.y-v))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,h){let g=h?i.ax(h,r.lat):void 0,v=this.projection.project(r.lng,r.lat);return new i.Y(v.x,v.y,g)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,h){let g=h??this._centerAltitude,v=[r.x,r.y,0,1],x=[r.x,r.y,1,1];i.aA.transformMat4(v,v,this.pixelMatrixInverse),i.aA.transformMat4(x,x,this.pixelMatrixInverse);let S=x[3];i.aA.scale(v,v,1/v[3]),i.aA.scale(x,x,1/S);let k=v[2],D=x[2];return{p0:v,p1:x,t:k===D?0:(g-k)/(D-k)}}screenPointToMercatorRay(r){let h=[r.x,r.y,0,1],g=[r.x,r.y,1,1];return i.aA.transformMat4(h,h,this.pixelMatrixInverse),i.aA.transformMat4(g,g,this.pixelMatrixInverse),i.aA.scale(h,h,1/h[3]),i.aA.scale(g,g,1/g[3]),h[2]=i.ax(h[2],this._center.lat)*this.worldSize,g[2]=i.ax(g[2],this._center.lat)*this.worldSize,i.aA.scale(h,h,1/this.worldSize),i.aA.scale(g,g,1/this.worldSize),new i.aT([h[0],h[1],h[2]],i._.normalize([],i._.sub([],g,h)))}rayIntersectionCoordinate(r){let{p0:h,p1:g,t:v}=r,x=i.ax(h[2],this._center.lat),S=i.ax(g[2],this._center.lat);return new i.Y(i.a2(h[0],g[0],v)/this.worldSize,i.a2(h[1],g[1],v)/this.worldSize,i.a2(x,S,v))}pointCoordinate(r,h=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,h)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let h=this.projection.pointCoordinate3D(this,r.x,r.y);if(h)return new i.Y(h[0],h[1],h[2]);let g=0,v=this.horizonLineFromTop();if(r.y>v)return this.pointCoordinate(r);let x=.02*v,S=r.clone();for(let k=0;k<10&&v-g>x;k++){S.y=i.a2(g,v,.66);let D=this.projection.pointCoordinate3D(this,S.x,S.y);D?(v=S.y,h=D):g=S.y}return h?new i.Y(h[0],h[1],h[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=i.aU)return!this.isPointAboveHorizon(r);let h=this.pointCoordinate(r);return h.y>=0&&h.y<=1}_coordinatePoint(r,h){let g=h&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,v=[r.x*this.worldSize,r.y*this.worldSize,g+r.toAltitude(),1];return i.aA.transformMat4(v,v,this.pixelMatrix),v[3]>0?new i.P(v[0]/v[3],v[1]/v[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:r,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new i.P(h,r)),S=this.pointLocation3D(new i.P(v,r)),k=this.pointLocation3D(new i.P(v,g)),D=this.pointLocation3D(new i.P(h,g)),A=Math.min(x.lng,S.lng,k.lng,D.lng),L=Math.max(x.lng,S.lng,k.lng,D.lng),z=Math.min(x.lat,S.lat,k.lat,D.lat),U=Math.max(x.lat,S.lat,k.lat,D.lat),H=Math.pow(2,-this.zoom)/16*270,$=this.projection.name==="globe"?1:4,Y=(Z,Q,re,oe,ae)=>{let ge=(Z+re)/2,fe=(Q+oe)/2,ne=new i.P(ge,fe),{lng:se,lat:le}=this.pointLocation3D(ne),we=Math.max(0,A-se,z-le,se-L,le-U);A=Math.min(A,se),L=Math.max(L,se),z=Math.min(z,le),U=Math.max(U,le),(ae<$||we>H)&&(Y(Z,Q,ge,fe,ae+1),Y(ge,fe,re,oe,ae+1))};if(Y(h,r,v,r,1),Y(v,r,v,g,1),Y(v,g,h,g,1),Y(h,g,h,r,1),this.projection.name==="globe"){let[Z,Q]=i.aV(this);Z?(U=90,L=180,A=-180):Q&&(z=-90,L=180,A=-180)}return new i.ai(new i.aI(A,z),new i.aI(L,U))}_getBoundsRectangular(r,h){let{top:g,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,k=new i.P(v,g),D=new i.P(S,g),A=new i.P(S,x),L=new i.P(v,x),z=this.pointCoordinate(k,r),U=this.pointCoordinate(D,r),H=this.pointCoordinate(A,h),$=this.pointCoordinate(L,h),Y=(Z,Q)=>(Q.y-Z.y)/(Q.x-Z.x);return z.y>1&&U.y>=0?z=new i.Y((1-$.y)/Y($,z)+$.x,1):z.y<0&&U.y<=1&&(z=new i.Y(-$.y/Y($,z)+$.x,0)),U.y>1&&z.y>=0?U=new i.Y((1-H.y)/Y(H,U)+H.x,1):U.y<0&&z.y<=1&&(U=new i.Y(-H.y/Y(H,U)+H.x,0)),new i.ai().extend(this.coordinateLocation(z)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(H))}_getBoundsRectangularTerrain(){let r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);let h=r.visibleDemTiles.reduce((g,v)=>{if(v.dem){let x=v.dem.tree;g.min=Math.min(g.min,x.minimums[0]),g.max=Math.max(g.max,x.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*r.exaggeration(),h.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){let h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return r?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-i.aS,this.maxLat=i.aS,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aj(this.minLng)*this.tileSize,this.worldMaxX=i.aj(this.maxLng)*this.tileSize,this.worldMinY=i.ak(this.maxLat)*this.tileSize,this.worldMaxY=i.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,h){return this.projection.createTileMatrix(this,h,r)}calculateDistanceTileData(r){let h=r.key,g=this._distanceTileDataCache;if(g[h])return g[h];let v=r.canonical,x=1/this.height,S=this.cameraWorldSize,k=S/this.zoomScale(v.z),D=(v.x+Math.pow(2,v.z)*r.wrap)*k,A=v.y*k,L=this.point;L.x*=S/this.worldSize,L.y*=S/this.worldSize;let z=this.angle,U=Math.sin(-z),H=-Math.cos(-z);return g[h]={bearing:[U,H],center:[(L.x-D)*x,(L.y-A)*x],scale:k/i.a3*x},g[h]}calculateFogTileMatrix(r){let h=r.key,g=this._fogTileMatrixCache;if(g[h])return g[h];let v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return i.ad.multiply(v,this.worldToFogMatrix,v),g[h]=new Float32Array(v),g[h]}calculateProjMatrix(r,h=!1,g=!1){let v=r.key,x;if(x=g?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];let S=this.calculatePosMatrix(r,this.worldSize),k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,i.ad.multiply(S,k,S),x[v]=new Float32Array(S),x[v]}calculatePixelsToTileUnitsMatrix(r){let h=r.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];let v=i.aW(r,this);return g[h]=v,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let r=1/this.worldSize,h=i.ad.fromScaling([],[r,r,r]);return i.ad.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let r=this._elevation;this._updateCameraState();let h=i.ax(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=this._camera.forward(),x=i.ax(1,this._center.lat);g[2]/=x,v[2]/=x,i._.normalize(v,v);let S=r.raycast(g,v,r.exaggeration());if(S){let k=i._.scaleAndAdd([],g,v,S),D=new i.Y(k[0],k[1],i.ax(k[2],i.ay(k[1]))),A=(D.z+i._.length([D.x-g[0],D.y-g[1],D.z-g[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(A),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;let h=this._elevation,g=i.ax(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),x=h.getAtPointOrZero(new i.Y(...v)),S=this.pixelsPerMeter/this.worldSize*x,k=this._minimumHeightOverTerrain(),D=v[2]-S;if(D<=k)if(D<0||r){let A=this.locationCoordinate(this._center,this._centerAltitude),L=[v[0],v[1],A.z-v[2]],z=i._.length(L);L[2]-=(k-D)/this._pixelsPerMercatorPixel;let U=i._.length(L);if(U===0)return;i._.scale(L,L,z/U*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],A.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){let U=this.center;return U.lat=i.at(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(U.lng=i.at(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}let h=this._unmodified,{x:g,y:v}=this.point,x=0,S=g,k=v,D=this.width/2,A=this.height/2,L=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(v-A<L&&(k=L+A),v+A>z&&(k=z-A),z-L<this.height&&(x=Math.max(x,this.height/(z-L)),k=(z+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let U=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,$=this.worldSize/2-(U+H)/2;S=(g+$+this.worldSize)%this.worldSize-$,S-D<U&&(S=U+D),S+D>H&&(S=H-D),H-U<this.width&&(x=Math.max(x,this.width/(H-U)),S=(H+U)/2)}S===g&&k===v||(this.center=this.unproject(new i.P(S,k))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let r=this.centerOffset,h=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.ax(1,this.center.lat)/i.ax(1,i.b3));let v=i.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let x=this.projection.zAxisUnit==="meters"?g:1,S=this._camera.getWorldToCamera(this.worldSize,x),k,D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-r.x/this.width,D[9]=2*r.y/this.height,this.isOrthographic){let le=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),we=le*this.aspect,Oe=-we,ue=-le;we-=r.x,Oe-=r.x,le+=r.y,ue+=r.y,k=this._camera.getCameraToClipOrthographic(Oe,we,ue,le,this._nearZ,this._farZ),((Re,Be,Qe,Je)=>{for(let Ze=0;Ze<16;Ze++)Re[Ze]=_p(Be[Ze],Qe[Ze],Je)})(k,k,D,qn(this.pitch>=15?1:this.pitch/15))}else k=D;let A=i.ad.mul([],D,S),L=i.ad.mul([],k,S);if(this.projection.isReprojectedInTileSpace){let le=this.locationCoordinate(this.center),we=i.ad.identity([]);i.ad.translate(we,we,[le.x*this.worldSize,le.y*this.worldSize,0]),i.ad.multiply(we,we,i.aY(this)),i.ad.translate(we,we,[-le.x*this.worldSize,-le.y*this.worldSize,0]),i.ad.multiply(L,L,we),i.ad.multiply(A,A,we),this.inverseAdjustmentMatrix=i.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.ad.scale([],L,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=L,this.invProjMatrix=i.ad.invert(new Float64Array(16),this.projMatrix),h){let le=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);le[8]=2*-r.x/this.width,le[9]=2*r.y/this.height,this.expandedFarZProjMatrix=i.ad.mul([],le,S)}else this.expandedFarZProjMatrix=this.projMatrix;let z=i.ad.invert([],k);this.frustumCorners=i.a_.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);let U=new Float32Array(16);i.ad.identity(U),i.ad.scale(U,U,[1,-1,1]),i.ad.rotateX(U,U,this._pitch),i.ad.rotateZ(U,U,this.angle);let H=i.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.ad.clone(H);let $=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-r.x/this.width,H[9]=2*(r.y+$)/this.height,this.skyboxMatrix=i.ad.multiply(U,H,U);let Y=this.point,Z=Y.x,Q=Y.y,re=this.width%2/2,oe=this.height%2/2,ae=Math.cos(this.angle),ge=Math.sin(this.angle),fe=Z-Math.round(Z)+ae*re+ge*oe,ne=Q-Math.round(Q)+ae*oe+ge*re,se=new Float64Array(L);if(i.ad.translate(se,se,[fe>.5?fe-1:fe,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=se,L=i.ad.create(),i.ad.scale(L,L,[this.width/2,-this.height/2,1]),i.ad.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=i.ad.create(),i.ad.scale(L,L,[1,-1,1]),i.ad.translate(L,L,[-1,-1,0]),i.ad.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=i.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,A),this._calcFogMatrices(),this._distanceTileDataCache={},L=i.ad.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.a$(this);let le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i._.transformMat4(le,le,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let r=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[r,r,h];i._.scale(x,x,v),i._.scale(g,g,-1),i._.multiply(g,g,x);let S=i.ad.create();i.ad.translate(S,S,g),i.ad.scale(S,S,x),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,h,v)}_computeCameraPosition(r){let h=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-r/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*x,v.y/this.worldSize-g[1]*x,r/this.worldSize*this._centerAltitude-g[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){let h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=r[2],x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((h-g)/v,1)),this._camera.position=i._.scaleAndAdd([],this._camera.position,r,x),this._updateStateFromCamera()}_updateStateFromCamera(){let r=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),x=i.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.ab(this._maxPitch)),k=Math.max((r[2]-x)/Math.cos(g),S),D=this._zoomFromMercatorZ(k);i._.scaleAndAdd(r,r,h,k),this._pitch=i.at(g,i.ab(this.minPitch),i.ab(this.maxPitch)),this.angle=i.au(v,-Math.PI,Math.PI),this._setZoom(i.at(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.Y(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){let r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let h=0,g=i.aU,v=0,x=1/0;for(;g-h>1e-6&&g>h;){let S=h+.5*(g-h),k=this.tileSize*Math.pow(2,S),D=this.getCameraToCenterDistance(this.projection,S,k),A=this.scaleZoom(D/(r*this.tileSize)),L=Math.abs(S-A);L<x&&(x=L,v=S),S<A?h=S:g=S}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,h){let g=Math.min(r.x,h.x),v=Math.max(r.x,h.x),x=Math.min(r.y,h.y),S=Math.max(r.y,h.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let k=[new i.P(g,x),new i.P(v,S),new i.P(g,S),new i.P(v,x)],D=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(let L of k){let z=this.pointRayIntersection(L);if(z.t<0)return!0;let U=this.rayIntersectionCoordinate(z);if(U.x<D||U.y<0||U.x>A||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(r,h){let g=i._.length(i._.sub([],this._camera.position,r)),v=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){let r=function([h,g,v],x){let S=[h,g,v,1];i.aA.transformMat4(S,S,x);let k=S[3]=Math.max(S[3],1e-6);return S[0]/=k,S[1]/=k,S[2]/=k,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(r[0],r[1])}{let r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,r))}}getCameraToCenterDistance(r,h=this.zoom,g=this.worldSize){let v=i.aX(r,h,this.width,this.height,1024),x=r.pixelSpaceConversion(this.center.lat,g,v),S=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(S=_p(1,S,qn(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){let r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.ad.multiply(r,r,this.globeMatrix),r}getFrustum(r){return i.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}let Hr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},Ha=(f,r)=>{if(r>0&&f.terrain&&i.w("Cutoff is currently disabled on terrain"),r<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let h=f.transform,g=Math.max(Math.abs(h._zoom-(f.minCutoffZoom-1)),1),v=h.isLODDisabled(!1)?i.$(60,45,h.pitch):i.$(30,15,h.pitch),x=h._farZ-h._nearZ,S=r*h.height,k=((1-(D=v))*h.cameraToCenterDistance+D*(h._farZ+S))*g;var D;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(k-h._nearZ)/x,(k-S-h._nearZ)/x]}}},Mr={cascadeCount:2,shadowMapResolution:2048};class bp{constructor(r,h){this.aabb=r,this.lastCascade=h}}class yp{add(r,h){let g=this.receivers[r.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],h.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],h.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],h.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],h.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],h.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],h.max[2])):this.receivers[r.key]=new bp(h,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,h,g){let v=i.b6.fromPoints(r.points),x=0;for(let S in this.receivers){let k=this.receivers[S];if(!k||!v.intersectsAabb(k.aabb))continue;k.aabb.min=v.closestPoint(k.aabb.min),k.aabb.max=v.closestPoint(k.aabb.max);let D=k.aabb.getCorners();for(let A=0;A<g.length;A++){let L=!0;for(let z of D){let U=[z[0]*h,z[1]*h,z[2]];if(i._.transformMat4(U,U,g[A].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){L=!1;break}}if(k.lastCascade=A,x=Math.max(x,A),L)break}}return x+1}}class cu{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new yp,this._depthMode=new i.ae(r.context.gl.LEQUAL,i.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(Mr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(Mr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,h){let g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;let v=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce(($,Y)=>{let Z=g.style._mergedLayers[Y];return $+(Z.hasShadowPass()&&!Z.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let x=g.context,S=Mr.shadowMapResolution,k=Mr.shadowMapResolution;if(this._cascades.length===0||Mr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let $=0;$<Mr.cascadeCount;++$){let Y=g._shadowMapDebug,Z=x.gl,Q=x.createFramebuffer(S,k,Y,"texture"),re=new i.T(x,{width:S,height:k,data:null},Z.DEPTH_COMPONENT);if(Q.depthAttachment.set(re.texture),Y){let oe=new i.T(x,{width:S,height:k,data:null},Z.RGBA);Q.colorAttachment.set(oe.texture)}this._cascades.push({framebuffer:Q,texture:re,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.aM,scale:0})}}this.shadowDirection=Bd(h);let D=0;if(r.elevation){let $=r.elevation,Y=[1e4,-1e4];$.visibleDemTiles.filter(Z=>Z.dem).forEach(Z=>{let Q=Z.dem.tree;Y[0]=Math.min(Y[0],Q.minimums[0]),Y[1]=Math.max(Y[1],Q.maximums[0])}),Y[0]!==1e4&&(D=(Y[1]-Y[0])*$.exaggeration())}let A=1.5*r.cameraToCenterDistance,L=3*A,z=new Float64Array(16);for(let $=0;$<this._cascades.length;++$){let Y=this._cascades[$],Z=r.height/50,Q=1;Mr.cascadeCount===1?Q=L:$===0?Q=A:(Z=A,Q=L);let[re,oe]=Nd(r,this.shadowDirection,Z,Q,Mr.shadowMapResolution,D);Y.scale=r.scale,Y.matrix=re,Y.boundingSphereRadius=oe,i.ad.invert(z,Y.matrix),Y.frustum=i.aM.fromInvProjectionMatrix(z,1,0,!0),Y.far=Q}let U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Mr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Mr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Hr.ShadowMap0,this._uniformValues.u_shadowmap_1=Hr.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let H=g.transform.elevation;for(let $ of this._groundShadowTiles){let Y={min:0,max:0};if(H){let Z=H.getMinMaxForTile($);Z&&(Y=Z)}this.addShadowReceiver($.toUnwrapped(),Y.min,Y.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,h){if(!this.enabled)return;let g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,Mr.shadowMapResolution,Mr.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){g.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:i.C.white,depth:1});for(let S of r.order){let k=r._mergedLayers[S];if(!k.hasShadowPass()||k.isHidden(g.transform.zoom))continue;let D=r.getLayerSourceCache(k),A=D?h[D.id]:void 0;(k.type==="model"||A&&A.length)&&g.renderLayer(g,D,k,A)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let r=this.painter,h=r.style,g=r.context,v=h.directionalLight,x=h.ambientLight;if(!v||!x)return;let S=[],k=Ha(r,r.longestCutoffRange);k.shouldRenderCutoff&&S.push("RENDER_CUTOFF");let D=Wa(h,v,x),A=new i.ae(g.gl.LEQUAL,i.ae.ReadOnly,r.depthRangeFor3D);for(let L of this._groundShadowTiles){let z=L.toUnwrapped(),U=r.isTileAffectedByFog(L),H=r.getOrCreateProgram("groundShadow",{defines:S,overrideFog:U});this.setupShadows(z,H),r.uploadCommonUniforms(g,H,z,null,k);let $={u_matrix:r.transform.calculateProjMatrix(z),u_ground_shadow_factor:D};H.draw(r,g.gl.TRIANGLES,A,i.ag.disabled,i.a.multiply,i.af.disabled,$,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,{},r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?i.a.unblended:i.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){let h=this.painter.transform,g=h.calculatePosMatrix(r,h.worldSize);return i.ad.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(r){return i.ad.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,h,g,v=0){if(!this.enabled)return;let x=this.painter.transform,S=this.painter.context,k=S.gl,D=this._uniformValues,A=new Float64Array(16),L=x.calculatePosMatrix(r,x.worldSize);for(let z=0;z<this._cascades.length;z++)i.ad.multiply(A,this._cascades[z].matrix,L),D[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),S.activeTexture.set(k.TEXTURE0+Hr.ShadowMap0+z),this._cascades[z].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){let z=i.b5(r.canonical),U=2/x.tileSize*i.a3/Mr.shadowMapResolution,H=U*this._cascades[0].boundingSphereRadius,$=U*this._cascades[this._cascades.length-1].boundingSphereRadius,Y=(g==="vector-tile"?1:3)/Math.pow(2,v-r.canonical.z-(1-x.zoom+Math.floor(x.zoom)));D.u_shadow_normal_offset=[z,H*Y,$*Y],D.u_shadow_bias=[6e-5,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(S,D)}setupShadowsFromMatrix(r,h,g=!1){if(!this.enabled)return;let v=this.painter.context,x=v.gl,S=this._uniformValues,k=new Float64Array(16);for(let D=0;D<Mr.cascadeCount;D++)i.ad.multiply(k,this._cascades[D].matrix,r),S[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),v.activeTexture.set(x.TEXTURE0+Hr.ShadowMap0+D),this._cascades[D].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);this.useNormalOffset=g,g?(S.u_shadow_normal_offset=[1,5,5],S.u_shadow_bias=[6e-5,.0012,.012]):S.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(v,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,h,g,v){if(v[2]>=0)return{};let x=function(D,A,L){let z=L/(1<<D.canonical.z);return new i.b6([D.canonical.x*z+D.wrap*L,D.canonical.y*z+D.wrap*L,0],[(D.canonical.x+1)*z+D.wrap*L,(D.canonical.y+1)*z+D.wrap*L,A])}(r,h,g).getCorners(),S=h/-v[2];v[0]<0?(i._.add(x[0],x[0],[v[0]*S,0,0]),i._.add(x[3],x[3],[v[0]*S,0,0])):v[0]>0&&(i._.add(x[1],x[1],[v[0]*S,0,0]),i._.add(x[2],x[2],[v[0]*S,0,0])),v[1]<0?(i._.add(x[0],x[0],[0,v[1]*S,0]),i._.add(x[1],x[1],[0,v[1]*S,0])):v[1]>0&&(i._.add(x[2],x[2],[0,v[1]*S,0]),i._.add(x[3],x[3],[0,v[1]*S,0]));let k={};return k.vertices=x,k.planes=[mc(x[1],x[0],x[4]),mc(x[2],x[1],x[5]),mc(x[3],x[2],x[6]),mc(x[0],x[3],x[7])],k}addShadowReceiver(r,h,g){this._receivers.add(r,i.b6.fromTileIdAndHeight(r,h,g))}getMaxCascadeForTile(r){let h=this._receivers.get(r);return h&&h.lastCascade?h.lastCascade:0}}function mc(f,r,h){let g=i._.sub([],h,r),v=i._.sub([],f,r),x=i._.cross([],g,v),S=i._.length(x);return S===0?[0,0,1,0]:(i._.scale(x,x,1/S),[x[0],x[1],x[2],-i._.dot(x,r)])}function Bd(f){let r=f.properties.get("direction"),h=i.ac(r.x,r.y,r.z);h[2]=i.at(h[2],0,75);let g=i.b7([h[0],h[1],h[2]]);return i._.fromValues(g.x,g.y,g.z)}function Wa(f,r,h){let g=r.properties.get("color"),v=r.properties.get("intensity"),x=r.properties.get("direction"),S=[x.x,x.y,x.z],k=h.properties.get("color"),D=h.properties.get("intensity"),A=Math.max(i._.dot([0,0,1],S),0),L=[0,0,0];i._.scale(L,k.toRenderColor(f.getLut(r.scope)).toArray01Linear().slice(0,3),D);let z=[0,0,0];return i._.scale(z,g.toRenderColor(f.getLut(h.scope)).toArray01Linear().slice(0,3),A*v),i.b8([L[0]>0?L[0]/(L[0]+z[0]):0,L[1]>0?L[1]/(L[1]+z[1]):0,L[2]>0?L[2]/(L[2]+z[2]):0])}function Nd(f,r,h,g,v,x){let S=f.zoom,k=f.scale,D=f.worldSize,A=1/D,L=f.aspect,z=Math.sqrt(1+L*L)*Math.tan(.5*f.fovX),U=z*z,H=g-h,$=g+h,Y,Z;U>H/$?(Y=g,Z=g*z):(Y=.5*$*(1+U),Z=.5*Math.sqrt(H*H+2*(g*g+h*h)*U+$*$*U*U));let Q=f.projection.pixelsPerMeter(f.center.lat,D),re=f._camera.getCameraToWorldMercator(),oe=[0,0,-Y*A];i._.transformMat4(oe,oe,re);let ae=Z*A,ge=f._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){let ft=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?Q:1),_t=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,h,g);_t[8]=2*-f.centerOffset.x/f.width,_t[9]=2*f.centerOffset.y/f.height;let kt=new Float64Array(16);i.ad.mul(kt,_t,ft);let bt=new Float64Array(16);i.ad.invert(bt,kt);let it=i.aM.fromInvProjectionMatrix(bt,D,S,!0);for(let Ge of it.points){let Dt=((fe=Ge)[0]/=k,fe[1]/=k,fe[2]=i.ax(fe[2],f._center.lat),fe);ae=Math.max(ae,i._.len(i._.subtract([],oe,Dt)))}}var fe;ae*=v/(v-1);let ne=Math.acos(r[2]),se=Math.atan2(-r[0],-r[1]),le=new Fd;le.position=oe,le.setPitchBearing(ne,se);let we=le.getWorldToCamera(D,Q),Oe=ae*D,ue=Math.min(f._mercatorZfromZoom(17)*D*-2,-2*Oe),Re=le.getCameraToClipOrthographic(-Oe,Oe,-Oe,Oe,ue,(Oe+x*Q)/r[2]),Be=new Float64Array(16);i.ad.multiply(Be,Re,we);let Qe=i._.fromValues(Math.floor(1e6*oe[0])/1e6*D,Math.floor(1e6*oe[1])/1e6*D,0),Je=.5*v,Ze=[0,0,0];i._.transformMat4(Ze,Qe,Be),i._.scale(Ze,Ze,Je);let Ie=[Math.floor(Ze[0]),Math.floor(Ze[1]),Math.floor(Ze[2])],Ve=[0,0,0];i._.sub(Ve,Ze,Ie),i._.scale(Ve,Ve,-1/Je);let Ye=new Float64Array(16);return i.ad.identity(Ye),i.ad.translate(Ye,Ye,Ve),i.ad.multiply(Be,Ye,Be),[Be,Oe]}function du(f,r){return f!=null&&r!=null&&!(!f.hasData()||!r.hasData())&&f.demTexture!=null&&r.demTexture!=null&&f.tileID.key!==r.tileID.key}let cl=new class{constructor(){this.operations={}}newMorphing(f,r,h,g,v){if(f in this.operations){let x=this.operations[f];x.to.tileID.key!==h.tileID.key&&(x.queued=h)}else this.operations[f]={startTime:g,phase:0,duration:v,from:r,to:h,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;let r=this.operations[f];return{from:r.from,to:r.to,phase:r.phase}}update(f){for(let r in this.operations){let h=this.operations[r];for(h.phase=(f-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,f)){delete this.operations[r];break}}}_nextOp(f,r){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=r,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Vd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function vp(f,r,h){if(r===0)return 0;let g=r<1&&h===514?.25/r:1;return 6*Math.pow(1.5,22-f)*Math.max(r,1)*g}function jg(f,r){let h=1<<f.z;return!r&&(f.x===0||f.x===h-1)||f.y===0||f.y===h-1}let hu=f=>({u_matrix:f});function uu(f,r,h,g,v){if(v>0){let x=i.e.now(),S=(x-f.timeAdded)/v,k=r?(x-r.timeAdded)/v:-1,D=h.getSource(),A=g.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),L=!r||Math.abs(r.tileID.overscaledZ-A)>Math.abs(f.tileID.overscaledZ-A),z=L&&f.refreshedUponExpiration?1:i.at(L?S:1-k,0,1);return f.refreshedUponExpiration&&S>=1&&(f.refreshedUponExpiration=!1),r?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class pc extends Rd{constructor(r,h,g,v){super(r,h,g,v),this.type="raster-array",this.maxzoom=22,this._options=i.W({type:"raster-array"},h)}triggerRepaint(r){let h=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);h&&h.enabled&&g&&h._clearRenderCacheForTile(g.id,r.tileID),this.map.triggerRepaint()}loadTile(r,h){let g=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,i.R.Tile);r.requestParams=v,r.actor||(r.actor=this.dispatcher.getActor()),r.request=r.fetchHeader(void 0,(x,S,k,D)=>{if(delete r.request,r.aborted)return r.state="unloaded",h(null);if(x)return x.code===20?void 0:(r.state="errored",h(x));this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:k,expires:D}),r.state="empty",h(null)})}unloadTile(r,h){let g=r.texture;g&&g instanceof i.T?(r.destroy(!0),this.map.painter.saveTileTexture(g)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,h,g){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(h,g,(v,x)=>{if(v)return r.state="errored",this.fire(new i.d(v)),void this.triggerRepaint(r);x&&(r.setTexture(x,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;let h=this.rasterLayers.find(({id:x})=>x===r),g=h&&h.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(r,h,g){if(!r)return;let v=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;h instanceof i.bk?x=h.paint.get("raster-array-band"):h instanceof i.bl&&(x=h.paint.get("raster-particle-array-band"));let S=x||this.getInitialBand(v);if(S!=null)if(r.textureDescriptor){if(!r.updateNeeded(v,S)||g)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,v,S)}}let kr={vector:ou,raster:Rd,"raster-dem":class extends Rd{constructor(f,r,h,g){super(f,r,h,g),this.type="raster-dem",this.maxzoom=22,this._options=i.W({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(f,r){let h=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,x){v&&(f.state="errored",r(v)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",r(null))}f.request=i.h(this.map._requestManager.transformRequest(h,i.R.Tile),(function(v,x,S,k){if(delete f.request,f.aborted)f.state="unloaded",r(null);else if(v)f.state="errored",r(v);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:S,expires:k});let D=ImageBitmap&&x instanceof ImageBitmap&&i.bi(),A=1-(x.width-i.bj(x.width))/2;A<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));let L=D?x:i.e.getImageData(x,A),z={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:A};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",z,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){let r=f.canonical,h=Math.pow(2,r.z),g=(r.x-1+h)%h,v=r.x===0?f.wrap-1:f.wrap,x=(r.x+1+h)%h,S=r.x+1===h?f.wrap+1:f.wrap,k={};return k[new i.aL(f.overscaledZ,v,r.z,g,r.y).key]={backfilled:!1},k[new i.aL(f.overscaledZ,S,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(k[new i.aL(f.overscaledZ,v,r.z,g,r.y-1).key]={backfilled:!1},k[new i.aL(f.overscaledZ,f.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},k[new i.aL(f.overscaledZ,S,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<h&&(k[new i.aL(f.overscaledZ,v,r.z,g,r.y+1).key]={backfilled:!1},k[new i.aL(f.overscaledZ,f.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},k[new i.aL(f.overscaledZ,S,r.z,x,r.y+1).key]={backfilled:!1}),k}},"raster-array":pc,geojson:class extends i.E{constructor(f,r,h,g){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=r.data,this._options=i.W({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;let v=i.a3/this.tileSize;this.workerOptions=i.W({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*v,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*v,extent:i.a3,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:i.a3,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*v,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){return this._options.dynamic?typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection")?this.fire(new i.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...f.features):this._data=f,this._updateWorkerData(!0),this):this.fire(new i.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(f,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterChildren(f,r){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterLeaves(f,r,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:r,offset:h},g),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.f("dataloading",{dataType:"source"})),this._loaded=!1;let r=i.W({append:f},this.workerOptions);r.scope=this.scope;let h=this._data;typeof h=="string"?(r.request=this.map._requestManager.transformRequest(i.e.resolveURL(h),i.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new i.d(g));else{let x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new i.f("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,r){let h=f.actor?"reloadTile":"loadTile";f.actor=this.actor;let g=this.map.style?this.map.style.getLut(this.scope):null,v=this._partialReload,x={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g?{image:g.image.clone()}:null,scope:this.scope,pixelRatio:i.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:v};f.request=this.actor.send(h,x,(S,k)=>v&&!k?(f.state="loaded",r(null)):(delete f.request,f.destroy(),f.aborted?r(null):S?r(S):(f.loadVectorData(k,this.map.painter,h==="reloadTile"),r(null))),void 0,h==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,r){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.bm{constructor(f,r,h,g){super(f,r,h,g),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;let f=this.options;this.urls=[];for(let r of f.urls)this.urls.push(this.map._requestManager.transformRequest(r,i.R.Source).url);i.bn(this.urls,(r,h)=>{this._loaded=!0,r?this.fire(new i.d(r)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){let r=this.video.seekable;f<r.start(0)||f>r.end(0)?this.fire(new i.d(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let f=this.map.painter.context,r=f.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(f,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.bm,model:class extends i.E{constructor(f,r,h,g){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){let f=[];for(let r in this._options.models){let h=this._options.models[r],g=i.l(this.map._requestManager.transformRequest(h.uri,i.R.Model).url).then(v=>{if(!v)return;let x=i.c(v),S=new i.M(r,h.position,h.orientation,x);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(v=>{this.fire(new i.d(new Error(`Could not load model ${r} from ${h.uri}: ${v.message}`)))});f.push(g)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this.fire(new i.d(new Error(`Could not load models: ${r.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,r){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(f,r,h,g){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new i.f("dataloading",{dataType:"source"}));let r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=mp(this._options,this.map._requestManager,r,h,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new i.d(g))):v&&(i.W(this,v),v.bounds&&(this.tileBounds=new Od(v.bounds,this.minzoom,this.maxzoom)),i.an(v.tiles,this.map._requestManager._customAccessToken),this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))),f&&f(g)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,r){let h=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(h,i.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=r;else{if(f.buckets){let x=Object.values(f.buckets);for(let S of x)S.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",g,v.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(x,S){return f.aborted?r(null):x&&x.status!==404?r(x):(S&&(S.resourceTiming&&(f.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&f.setExpiryData(S),f.buckets=$i($i({},f.buckets),S.buckets),S.featureIndex&&(f.latestFeatureIndex=S.featureIndex)),f.state="loaded",void r(null))}}serialize(){return i.W({},this._options)}},canvas:class extends i.bm{constructor(f,r,h,g){super(f,r,h,g),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new i.d(new i.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.d(new i.V(`sources.${f}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new i.d(new i.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new i.d(new i.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.d(new i.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let r=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof i.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends i.E{constructor(f,r,h,g){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=r,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Od(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),i.W(this,i.ah(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new i.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){let{x:r,y:h,z:g}=f.canonical;return this._implementation.hasTile({x:r,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,r){let{x:h,y:g,z:v}=f.tileID.canonical,x=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:v},{signal:x.signal})).then((function(S){return delete f.request,f.aborted?(f.state="unloaded",r(null)):S===void 0?(f.state="errored",r(null)):S===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",r(null)):function(k){return k instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement}(S)?(this.loadTileData(f,S),f.state="loaded",void r(null)):(f.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(f.state="errored",r(S))}),f.request.cancel=()=>x.abort()}loadTileData(f,r){f.setTexture(r,this._map.painter)}unloadTile(f,r){if(f.texture&&f.texture instanceof i.T?(f.destroy(!0),f.texture&&f.texture instanceof i.T&&this._map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){let{x:h,y:g,z:v}=f.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:v})}r&&r()}abortTile(f,r){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){let f=i.al(this.id,this.scope);this._map.style.clearSource(f)}_update(){this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))}}},mu=function(f,r,h,g){let v=new kr[r.type](f,r,h,g);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return i.bp(["load","abort","unload","serialize","prepare"],v),v};class xp extends i.bv{constructor(r){let h={type:"raster-dem",maxzoom:r.transform.maxZoom},g=new i.bw(i.bx(),null),v=mu("mock-dem",h,g,r.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,h){r.state="loaded",h(null)}}class Ug extends i.bv{constructor(r){let h=mu("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new i.bw(i.bx(),null),r.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,h,g){if(r.freezeTileCoverage)return;this.transform=r;let v=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,S)=>{if(x[S.key]="",!this._tiles[S.key]){let k=new i.by(S,this._source.tileSize*S.overscaleFactor(),r.tileZoom);k.state="loaded",this._tiles[S.key]=k}return x},{});for(let x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(r){let h=this.proxyCachedFBO[r];if(h!==void 0){let g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class wp extends i.aL{constructor(r,h,g){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class Cp extends i.bq{constructor(r,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[g,v,x]=function(D){let A=new i.bt,L=new i.bu,z=131;A.reserve(17161),L.reserve(33800);let U=i.a3/128,H=i.a3+U/2,$=H+U;for(let Z=-U;Z<$;Z+=U)for(let Q=-U;Q<$;Q+=U){let re=Q<0||Q>H||Z<0||Z>H?24575:0,oe=i.at(Math.round(Q),0,i.a3),ae=i.at(Math.round(Z),0,i.a3);A.emplaceBack(oe+re,ae)}let Y=(Z,Q)=>{let re=Q*z+Z;L.emplaceBack(re+1,re,re+z),L.emplaceBack(re+z,re+z+1,re+1)};for(let Z=1;Z<129;Z++)for(let Q=1;Q<129;Q++)Y(Q,Z);return[0,129].forEach(Z=>{for(let Q=0;Q<130;Q++)Y(Q,Z),Y(Z,Q)}),[A,L,32768]}(),S=r.context;this.gridBuffer=S.createVertexBuffer(g,i.br.members),this.gridIndexBuffer=S.createIndexBuffer(v),this.gridSegments=i.b.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=i.b.simpleSegment(0,0,g.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ug(h.map),this.orthoMatrix=i.ad.create(),i.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.a3,0,i.a3,0,1);let k=S.gl;this._overlapStencilMode=new i.ag({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new xp(h.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,h,g){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);let v=r.terrain.properties,x=r.terrain.drapeRenderMode===0,S=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.e.now();let k=r.terrain&&r.terrain.scope,D=v.get("source"),A=x?this._mockSourceCache:r.getSourceCache(D,k);if(!A)return void i.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=A,this._exaggeration=S?this.calculateExaggeration(h):v.get("exaggeration"),!h.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;let L=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let z=this.getScaledDemTileSize();this.sourceCache.update(h,z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),h.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(r){let h=this._previousCameraAltitude,g=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=g;let v=h!=null?g-h:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;let x=r.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(x);let k=x-this._previousZoom,D=this._previousUpdateTimestamp,A=x;this._evaluationZoom!=null&&(A=this._evaluationZoom,Math.abs(x-A)>.5&&(k=.5*(x-A+k)),k*v<0&&(A+=k)),this._evaluationZoom=A;let L=S.getExaggeration(A),z=L===S.getExaggeration(Math.max(0,A-.1));if(z&&Math.abs(L-this._exaggeration)<.01)return L;let U=Math.min(.1,.00375*(this._updateTimestamp-D));return(z||L<.1||Math.abs(k)<1e-4)&&(U=Math.min(.2,4*U)),i.a2(this._exaggeration,L,U)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(i.Y.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let v=this.proxyCoords=h.getIds().map(D=>{let A=h.getTileByID(D).tileID;return A.projMatrix=g.calculateProjMatrix(A.toUnwrapped()),A});(function(D,A){let L=A.transform.pointCoordinate(A.transform.getCameraPoint()),z=new i.P(L.x,L.y);D.sort((U,H)=>{if(H.overscaledZ-U.overscaledZ)return H.overscaledZ-U.overscaledZ;let $=new i.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Y=new i.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),Z=z.mult(1<<U.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr($)-Z.distSqr(Y)})})(v,this.painter);let x=this.proxyToSource||{};this.proxyToSource={},v.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};let S=this._style._mergedSourceCaches;for(let D in S){let A=S[D];if(!A.used||(A!==this.sourceCache&&this.resetTileLookupCache(A.id),this._setupProxiedCoordsForOrtho(A,r[D],x),A.usedForTerrain))continue;let L=r[D];A.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[h.id]=v.map(D=>new wp(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;let k={};this._visibleDemTiles=[];for(let D of this.proxyCoords){let A=this.terrainTileForTile[D.key];if(!A)continue;let L=A.tileID.key;L in k||(this._visibleDemTiles.push(A),k[L]=L)}}_assignTerrainTiles(r){this._initializing||r.forEach(h=>{if(this.terrainTileForTile[h.key])return;let g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){let r=this.painter.context,h=r.gl;for(let g in this.terrainTileForTile){let v=this.terrainTileForTile[g],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(r.activeTexture.set(h.TEXTURE1),up(this.painter,v,x))}}_prepareDemTileUniforms(r,h,g,v){if(!h||h.demTexture==null)return!1;let x=r.tileID.canonical,S=Math.pow(2,h.tileID.canonical.z-x.z),k=v||"";return g[`u_dem_tl${k}`]=[x.x*S%1,x.y*S%1],g[`u_dem_scale${k}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let r=this.painter.context,h=r.gl;if(!this._emptyDepthBufferTexture){let g=new i.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new i.T(r,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0,h=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;let x=v.dem.tree.minimums[0];return x>0&&r++,g+x},0);return r?h/r:0}_updateEmptyDEMTexture(){let r=this.painter.context,h=r.gl;r.activeTexture.set(h.TEXTURE2);let g=this._getLoadedAreaMinimum(),[v,x]=(()=>{let k=new i.bz({width:1,height:1},new Float32Array([g]));return[h.R32F,k]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(x,{premultiply:!1}):S=this._emptyDEMTexture=new i.T(r,x,v,{premultiply:!1}),S}setupElevationDraw(r,h,g){let v=this.painter.context,x=v.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};S.u_exaggeration=this.exaggeration();let k=null,D=null,A=1;if(g&&g.morphing&&this._useVertexMorphing){let H=g.morphing.srcDemTile,$=g.morphing.dstDemTile;A=g.morphing.phase,H&&$&&(this._prepareDemTileUniforms(r,H,S,"_prev")&&(D=H),this._prepareDemTileUniforms(r,$,S)&&(k=$))}let L=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST,z=null;var U;if(this.enabled?D&&k?(z=k.demTexture,v.activeTexture.set(x.TEXTURE4),D.demTexture.bind(L(D),x.CLAMP_TO_EDGE),S.u_dem_lerp=A):(k=this.terrainTileForTile[r.tileID.key],z=this._prepareDemTileUniforms(r,k,S)?k.demTexture:this.emptyDEMTexture):z=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),z&&(S.u_dem_size=(U=z).size[0]===1?1:U.size[0]-2,z.bind(L(k),x.CLAMP_TO_EDGE)),v.activeTexture.set(x.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&k){let H=(1<<k.tileID.canonical.z)*i.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=H}if(g&&g.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(v,S),this.painter.transform.projection.name==="globe"){let H=this.globeUniformValues(this.painter.transform,r.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,H)}}globeUniformValues(r,h,g){let v=r.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,i.a3,0),u_tile_br_up:v.upVector(h,i.a3,i.a3),u_tile_bl_up:v.upVector(h,0,i.a3),u_tile_up_scale:g?i.bs(1):v.upVectorScale(h,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){let h=this.painter,g=this.painter.context;r.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,S,k,D){if(v.transform.projection.name==="globe")(function(A,L,z,U,H){let $=A.context,Y=$.gl,Z,Q,re=A.transform,oe=i.ba(A,$,re),ae=(Re,Be)=>{if(Q===Be)return;let Qe=[Vd[Be],"PROJECTION_GLOBE_VIEW"];oe&&Qe.push("CUSTOM_ANTIALIASING");let Je=A.isTileAffectedByFog(Re);Z=A.getOrCreateProgram("globeRaster",{defines:Qe,overrideFog:Je}),Q=Be},ge=A.colorModeForRenderPass(),fe=new i.ae(Y.LEQUAL,i.ae.ReadWrite,A.depthRangeFor3D);cl.update(H);let ne=i.bb(re),se=[i.aj(re.center.lng),i.ak(re.center.lat)],le=A.globeSharedBuffers,we=[re.width*i.e.devicePixelRatio,re.height*i.e.devicePixelRatio],Oe=Float32Array.from(re.globeMatrix),ue={useDenormalizedUpVectorScale:!0};{let Re=A.transform,Be=vp(Re.zoom,L.exaggeration(),L.sourceCache._source.tileSize);Q=-1;let Qe=Y.TRIANGLES;for(let Je of U){let Ze=z.getTile(Je),Ie=i.ag.disabled,Ve=L.prevTerrainTileForTile[Je.key],Ye=L.terrainTileForTile[Je.key];du(Ve,Ye)&&cl.newMorphing(Je.key,Ve,Ye,H,250),$.activeTexture.set(Y.TEXTURE0),Ze.texture&&Ze.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let ft=cl.getMorphValuesForProxy(Je.key),_t=ft?1:0;ft&&i.o(ue,{morphing:{srcDemTile:ft.from,dstDemTile:ft.to,phase:i.b9(ft.phase)}});let kt=i.bc(Je.canonical),bt=i.bd(kt.getCenter().lat),it=i.be(Je.canonical,kt,bt,Re.worldSize/Re._pixelsPerMercatorPixel),Ge=i.bf(i.bg(Je.canonical)),Dt=Ng(Re.expandedFarZProjMatrix,Oe,ne,Ge,i.a1(Re.zoom),se,Re.frustumCorners.TL,Re.frustumCorners.TR,Re.frustumCorners.BR,Re.frustumCorners.BL,Re.globeCenterInViewSpace,Re.globeRadius,we,Be,Re._farZ,it);if(ae(Je,_t),Z&&(L.setupElevationDraw(Ze,Z,ue),A.uploadCommonUniforms($,Z,Je.toUnwrapped()),le)){let[ri,ei,gi]=le.getGridBuffers(bt,Be!==0);Z.draw(A,Qe,fe,Ie,ge,i.af.backCCW,Dt,"globe_raster",ri,ei,gi)}}}if(le&&(A.renderDefaultNorthPole||A.renderDefaultSouthPole)){let Re=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&Re.push("CUSTOM_ANTIALIASING"),Z=A.getOrCreateProgram("globeRaster",{defines:Re});for(let Be of U){let{x:Qe,y:Je,z:Ze}=Be.canonical,Ie=Je===0,Ve=Je===(1<<Ze)-1,[Ye,ft,_t,kt]=le.getPoleBuffers(Ze,!1);if(kt&&(Ie||Ve)){let bt=z.getTile(Be);$.activeTexture.set(Y.TEXTURE0),bt.texture&&bt.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let it=i.bh(Ze,Qe,re),Ge=i.bf(i.bg(Be.canonical)),Dt=(ri,ei)=>ri.draw(A,Y.TRIANGLES,fe,i.ag.disabled,ge,i.af.disabled,Ng(re.expandedFarZProjMatrix,it,it,Ge,0,se,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,we,0,re._farZ),"globe_pole_raster",ei,_t,kt);L.setupElevationDraw(bt,Z,ue),A.uploadCommonUniforms($,Z,Be.toUnwrapped()),Ie&&A.renderDefaultNorthPole&&Dt(Z,Ye),Ve&&A.renderDefaultSouthPole&&(it=i.ad.scale(i.ad.create(),it,[1,-1,1]),Dt(Z,ft))}}}})(v,x,S,k,D);else{let A=v.context,L=A.gl,z,U,H=v.shadowRenderer,$=Ha(v,v.longestCutoffRange),Y=ge=>{if(U===ge)return;let fe=[];fe.push(Vd[ge]),$.shouldRenderCutoff&&fe.push("RENDER_CUTOFF"),z=v.getOrCreateProgram("terrainRaster",{defines:fe}),U=ge},Z=v.colorModeForRenderPass(),Q=new i.ae(L.LEQUAL,i.ae.ReadWrite,v.depthRangeFor3D);cl.update(D);let re=v.transform,oe=vp(re.zoom,x.exaggeration(),x.sourceCache._source.tileSize),ae=[0,0,0];if(H){let ge=v.style.directionalLight,fe=v.style.ambientLight;ge&&fe&&(ae=Wa(v.style,ge,fe))}{U=-1;let ge=L.TRIANGLES,[fe,ne]=[x.gridIndexBuffer,x.gridSegments];for(let se of k){let le=S.getTile(se),we=i.ag.disabled,Oe=x.prevTerrainTileForTile[se.key],ue=x.terrainTileForTile[se.key];du(Oe,ue)&&cl.newMorphing(se.key,Oe,ue,D,250),A.activeTexture.set(L.TEXTURE0),le.texture&&le.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);let Re=cl.getMorphValuesForProxy(se.key),Be=Re?1:0,Qe;Re&&(Qe={morphing:{srcDemTile:Re.from,dstDemTile:Re.to,phase:i.b9(Re.phase)}});let Je=yt(se.projMatrix,jg(se.canonical,re.renderWorldCopies)?oe/10:oe,ae);if(Y(Be),!z)continue;x.setupElevationDraw(le,z,Qe);let Ze=se.toUnwrapped();H&&H.setupShadows(Ze,z),v.uploadCommonUniforms(A,z,Ze,null,$),z.draw(v,ge,Q,we,Z,i.af.backCCW,Je,"terrain_raster",x.gridBuffer,fe,ne)}}}}(h,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;let h=this.painter,g=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],S=this._drapedRenderBatches.shift(),k=h.style.order,D=[],A=0;for(let L of x){let z=v.getTileByID(L.proxyTileKey),U=v.proxyCachedFBO[L.key]?v.proxyCachedFBO[L.key][r]:void 0,H=U!==void 0?v.renderCache[U]:this.pool[A++],$=U!==void 0;if(z.texture=H.tex,$&&!H.dirty){D.push(z.tileID);continue}let Y;g.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(g.clear({color:i.C.transparent,stencil:0}),H.dirty=!1);for(let Z=S.start;Z<=S.end;++Z){let Q=h.style._mergedLayers[k[Z]];if(Q.isHidden(h.transform.zoom))continue;let re=h.style.getLayerSourceCache(Q),oe=re?this.proxyToSource[L.key][re.id]:[L];if(!oe)continue;let ae=oe;g.viewport.set([0,0,H.fb.width,H.fb.height]),Y!==(re?re.id:null)&&(this._setupStencil(H,oe,Q,re),Y=re?re.id:null),h.renderLayer(h,re,Q,ae)}if(this._drapedRenderBatches.length===0)for(let Z of this._pendingGroundEffectLayers){let Q=h.style._mergedLayers[k[Z]];if(Q.isHidden(h.transform.zoom))continue;let re=h.style.getLayerSourceCache(Q),oe=re?this.proxyToSource[L.key][re.id]:[L];if(!oe)continue;let ae=oe;g.viewport.set([0,0,H.fb.width,H.fb.height]),Y!==(re?re.id:null)&&(this._setupStencil(H,oe,Q,re),Y=re?re.id:null),h.renderLayer(h,re,Q,ae)}this.renderedToTile?(H.dirty=!0,D.push(z.tileID)):$||--A,A===5&&(A=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),S.end+1}postRender(){}isLayerOrderingCorrect(r){let h=r.order.length,g=-1,v=h;for(let x=0;x<h;++x)this._style.isLayerDraped(r._mergedLayers[r.order[x]])?g=Math.max(g,x):v=Math.min(v,x);return v>g}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{r=Math.min(r,h.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,h,g){if(!this._visibleDemTiles)return null;let v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{let S=x.tileID,k=1<<S.overscaledZ,{x:D,y:A}=S.canonical,L=D/k,z=(D+1)/k,U=A/k,H=(A+1)/k;return{minx:L,miny:U,maxx:z,maxy:H,t:x.dem.tree.raycastRoot(L,U,z,H,r,h,g),tile:x}});v.sort((x,S)=>(x.t!==null?x.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(let x of v){if(x.t==null)return null;let S=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,r,h,g);if(S!=null)return S}return null}_createFBO(){let r=this.painter.context,h=r.gl,g=this.drapeBufferSize;r.activeTexture.set(h.TEXTURE0);let v=new i.T(r,{width:g[0],height:g[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);let x=r.createFramebuffer(g[0],g[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new tl(r,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{let h=this._style._mergedLayers[r],g=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!g&&h.shouldRedrape():!g&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(let g of this._style.getSources())if(g instanceof ou){r=!0;break}if(!r)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(x&&!h[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof i.Z){h[x.id]=!0;for(let S of this.proxyCoords){let k=this.proxyToSource[S.key][x.id];if(k)for(let D of k)this._clearRenderCacheForTile(x.id,D)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(let g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof Rd){r=!0;break}if(!r)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(!x||h[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;let S=v.paint.get("raster-fade-duration");for(let k of this.proxyCoords){let D=this.proxyToSource[k.key][x.id];if(D)for(let A of D){let L=uu(x.getTile(A),x.findLoadedParent(A,0),x,this.painter.transform,S);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(x.id,A)}}}}_setupDrapedRenderBatches(){let r=this._style.order,h=r.length;if(h===0)return;let g=[];this._pendingGroundEffectLayers=[];let v,x=0,S=this._style._mergedLayers[r[x]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++x<h;)S=this._style._mergedLayers[r[x]];for(;x<h;++x){let k=this._style._mergedLayers[r[x]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?v===void 0&&(v=x):(k.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(g.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&g.push({start:v,end:x-1}),g.length!==0){let k=g[g.length-1];this._pendingGroundEffectLayers.every(D=>D>k.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(r){let h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){let S=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let k=0;k<S.length;++k){let D=Object.values(S[k]);h.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();let g=this.proxyCoords,v=this._tilesDirty;for(let S=g.length-1;S>=0;S--){let k=g[S];if(h.getTileByID(k.key),h.proxyCachedFBO[k.key]!==void 0){let D=r[k.key],A=this.proxyToSource[k.key],L=0;for(let z in A){let U=A[z],H=D[z];if(!H||H.length!==U.length||U.some(($,Y)=>$!==H[Y]||v[z]&&v[z].hasOwnProperty($.key))){L=-1;break}++L}for(let z in h.proxyCachedFBO[k.key])h.renderCache[h.proxyCachedFBO[k.key][z]].dirty=L<0||L!==Object.values(D).length}}let x=[...this._drapedRenderBatches];x.sort((S,k)=>k.end-k.start-(S.end-S.start));for(let S of x)for(let k of g){if(h.proxyCachedFBO[k.key])continue;let D=h.renderCachePool.pop();D===void 0&&h.renderCache.length<50&&(D=h.renderCache.length,h.renderCache.push(this._createFBO())),D!==void 0&&(h.proxyCachedFBO[k.key]={},h.proxyCachedFBO[k.key][S.start]=D,h.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(r,h,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let x=this.painter.context,S=x.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let k;if(g.isTileClipped())k=h.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):i.ag.disabled}_renderTileClippingMasks(r,h){let g=this.painter,v=this.painter.context,x=v.gl;g._tileClippingMaskIDs={},v.setColorMode(i.a.disabled),v.setDepthMode(i.ae.disabled);let S=g.getOrCreateProgram("clippingMask");for(let k of r){let D=g._tileClippingMaskIDs[k.key]=--h;S.draw(g,x.TRIANGLES,i.ae.disabled,new i.ag({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),i.a.disabled,i.af.disabled,hu(k.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(r){let h=this.painter.transform;if(r.x<0||r.x>h.width||r.y<0||r.y>h.height)return null;let g=[r.x,r.y,1,1];i.aA.transformMat4(g,g,h.pixelMatrixInverse),i.aA.scale(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;let v=h._camera.position,x=i.ax(1,h.center.lat),S=[v[0],v[1],v[2]/x,0],k=i._.subtract([],g.slice(0,3),S);i._.normalize(k,k);let D=this.raycast(S,k,this._exaggeration);return D!==null&&D?(i._.scaleAndAdd(S,S,k,D),S[3]=S[2],S[2]*=x,S):null}drawDepth(){let r=this.painter,h=r.context,g=this.proxySourceCache,v=Math.ceil(r.width),x=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let S=h.gl,k=h.createFramebuffer(v,x,!0,"renderbuffer");h.activeTexture.set(S.TEXTURE0);let D=new i.T(h,{width:v,height:x,data:null},S.RGBA);D.bind(S.NEAREST,S.CLAMP_TO_EDGE),k.colorAttachment.set(D.texture);let A=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,x);k.depthAttachment.set(A),this._depthFBO=k,this._depthTexture=D}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,x]),function(S,k,D,A){if(S.transform.projection.name==="globe")return;let L=S.context,z=L.gl;L.clear({depth:1});let U=S.getOrCreateProgram("terrainDepth"),H=new i.ae(z.LESS,i.ae.ReadWrite,S.depthRangeFor3D);for(let $ of A){let Y=D.getTile($),Z=yt($.projMatrix,0,[0,0,0]);k.setupElevationDraw(Y,U),U.draw(S,z.TRIANGLES,H,i.ag.disabled,i.a.unblended,i.af.backCCW,Z,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(r,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,h,g){if(r.getSource()instanceof i.bm)return this._setupProxiedCoordsForImageSource(r,h,g);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};let v=this.proxiedCoords[r.id]=[],x=this.proxyCoords;for(let D=0;D<x.length;D++){let A=x[D],L=this._findTileCoveringTileID(A,r);if(L){let z=this._createProxiedId(A,L,g[A.key]&&g[A.key][r.id]);v.push(z),this.proxyToSource[A.key][r.id]=[z]}}let S=!1,k=new Set;for(let D=0;D<h.length;D++){let A=r.getTile(h[D]);if(!A||!A.hasData())continue;let L=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==A.tileID.canonical.z){let z=this.proxyToSource[L.tileID.key][r.id],U=this._createProxiedId(L.tileID,A,g[L.tileID.key]&&g[L.tileID.key][r.id]);z?z.splice(z.length-1,0,U):this.proxyToSource[L.tileID.key][r.id]=[U];let H=this.proxyToSource[L.tileID.key][r.id];k.has(H)||k.add(H),v.push(U),S=!0}}if(this._sourceTilesOverlap[r.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(let D of k)D.sort((A,L)=>L.overscaledZ-A.overscaledZ)}_setupProxiedCoordsForImageSource(r,h,g){if(!r.getSource().loaded())return;let v=this.proxiedCoords[r.id]=[],x=this.proxyCoords,S=r.getSource(),k=S.tileID;if(!k)return;let D=new i.P(k.x,k.y)._div(1<<k.z),A=S.coordinates.map(i.Y.fromLngLat).reduce((z,U)=>(z.min.x=Math.min(z.min.x,U.x-D.x),z.min.y=Math.min(z.min.y,U.y-D.y),z.max.x=Math.max(z.max.x,U.x-D.x),z.max.y=Math.max(z.max.y,U.y-D.y),z),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(z,U)=>{let H=z.wrap+z.canonical.x/(1<<z.canonical.z),$=z.canonical.y/(1<<z.canonical.z),Y=i.a3/(1<<z.canonical.z),Z=U.wrap+U.canonical.x/(1<<U.canonical.z),Q=U.canonical.y/(1<<U.canonical.z);return H+Y<Z+A.min.x||H>Z+A.max.x||$+Y<Q+A.min.y||$>Q+A.max.y};for(let z=0;z<x.length;z++){let U=x[z];for(let H=0;H<h.length;H++){let $=r.getTile(h[H]);if(!$||!$.hasData()||L(U,$.tileID))continue;let Y=this._createProxiedId(U,$,g[U.key]&&g[U.key][r.id]),Z=this.proxyToSource[U.key][r.id];Z?Z.push(Y):this.proxyToSource[U.key][r.id]=[Y],v.push(Y)}}}_createProxiedId(r,h,g){let v=this.orthoMatrix;if(g){let x=g.find(S=>S.key===h.tileID.key);if(x)return x}if(h.tileID.key!==r.key){let x=r.canonical.z-h.tileID.canonical.z,S,k,D;v=i.ad.create();let A=h.tileID.wrap-r.wrap<<r.overscaledZ;x>0?(S=i.a3>>x,k=S*((h.tileID.canonical.x<<x)-r.canonical.x+A),D=S*((h.tileID.canonical.y<<x)-r.canonical.y)):(S=i.a3<<-x,k=i.a3*(h.tileID.canonical.x-(r.canonical.x+A<<-x)),D=i.a3*(h.tileID.canonical.y-(r.canonical.y<<-x))),i.ad.ortho(v,0,S,0,S,0,1),i.ad.translate(v,v,[k,D,0])}return new wp(h.tileID,r.key,v)}_findTileCoveringTileID(r,h){let g=h.getTile(r);if(g&&g.hasData())return g;let v=this._findCoveringTileCache[h.id],x=v[r.key];if(g=x?h.getTileByID(x):null,g&&g.hasData()||x===null)return g;let S=g?g.tileID:r,k=S.overscaledZ,D=h.getSource().minzoom,A=[];if(!x){let z=h.getSource().maxzoom;if(r.canonical.z>=z){let U=r.canonical.z-z;h.getSource().reparseOverscaled?(k=Math.max(r.canonical.z+2,h.transform.tileZoom),S=new i.aL(k,r.wrap,z,r.canonical.x>>U,r.canonical.y>>U)):U!==0&&(k=z,S=new i.aL(k,r.wrap,z,r.canonical.x>>U,r.canonical.y>>U))}S.key!==r.key&&(A.push(S.key),g=h.getTile(S))}let L=z=>{A.forEach(U=>{v[U]=z}),A.length=0};for(k-=1;k>=D&&(!g||!g.hasData());k--){g&&L(g.tileID.key);let z=S.calculateScaledKey(k);if(g=h.getTileByID(z),g&&g.hasData())break;let U=v[z];if(U===null)break;U===void 0?A.push(z):g=h.getTileByID(U)}return L(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,h){let g=this._tilesDirty[r];g||(g=this._tilesDirty[r]={}),g[h.key]=!0}}function Ga(f,r,h){let g=function(k,D,A){let L=i._.dot(D,k),z=i._.dot(A,[.2126,.7152,.0722]),U=($,Y,Z)=>(1-Z)*$+Z*Y,H=U(1-.3*Math.min(z,1),1,Math.min(L+1,1));return U(.92,1,Math.asin(i.at(D[2],-1,1))/Math.PI+.5)*H}(f,[0,0,1],r),v=[0,0,0];i._.scale(v,h.slice(0,3),g);let x=[0,0,0];i._.scale(x,r.slice(0,3),f[2]);let S=[0,0,0];return i._.add(S,v,x),i.b8(S)}let pu=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Hg=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class jd{static cacheKey(r,h,g,v){let x=`${h}${v?v.cacheKey:""}`;for(let S of g)r.usedDefines.includes(S)&&(x+=`/${S}`);return x}constructor(r,h,g,v,x,S){let k=r.gl;this.program=k.createProgram(),this.configuration=v,this.name=h,this.fixedDefines=[...S];let D=v?v.getBinderAttributes():[],A=(g.staticAttributes||[]).concat(D),L=v?v.defines():[];L=L.concat(S.map(Z=>`#define ${Z}`));let z=`#version 300 es
`,U=z+L.concat("precision mediump float;",zg,Fg.fragmentSource).join(`
`);for(let Z of g.fragmentIncludes)U+=`
${nu[Z]}`;U+=`
${g.fragmentSource}`;let H=z+L.concat("precision highp float;",zg,Fg.vertexSource).join(`
`);for(let Z of g.vertexIncludes)H+=`
${nu[Z]}`;H+=`
${g.vertexSource}`;let $=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource($,U),k.compileShader($),k.attachShader(this.program,$);let Y=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(Y,H),k.compileShader(Y),k.attachShader(this.program,Y),this.attributes={},this.numAttributes=A.length;for(let Z=0;Z<this.numAttributes;Z++)if(A[Z]){let Q=A[Z].startsWith("a_")?A[Z]:`a_${A[Z]}`;k.bindAttribLocation(this.program,Z,Q),this.attributes[Q]=Z}k.linkProgram(this.program),k.deleteShader(Y),k.deleteShader($),this.fixedUniforms=x(r),this.binderUniforms=v?v.getUniforms(r):[],S.includes("TERRAIN")&&(this.terrainUniforms=(Z=>({u_dem:new i.a7(Z),u_dem_prev:new i.a7(Z),u_dem_tl:new i.a8(Z),u_dem_scale:new i.aa(Z),u_dem_tl_prev:new i.a8(Z),u_dem_scale_prev:new i.aa(Z),u_dem_size:new i.aa(Z),u_dem_lerp:new i.aa(Z),u_exaggeration:new i.aa(Z),u_depth:new i.a7(Z),u_depth_size_inv:new i.a8(Z),u_meter_to_dem:new i.aa(Z),u_label_plane_matrix_inv:new i.a6(Z)}))(r)),S.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new i.aq(Z),u_tile_tr_up:new i.aq(Z),u_tile_br_up:new i.aq(Z),u_tile_bl_up:new i.aq(Z),u_tile_up_scale:new i.aa(Z)}))(r)),S.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new i.a6(Z),u_fog_range:new i.a8(Z),u_fog_color:new i.as(Z),u_fog_horizon_blend:new i.aa(Z),u_fog_vertical_limit:new i.a8(Z),u_fog_temporal_offset:new i.aa(Z),u_frustum_tl:new i.aq(Z),u_frustum_tr:new i.aq(Z),u_frustum_br:new i.aq(Z),u_frustum_bl:new i.aq(Z),u_globe_pos:new i.aq(Z),u_globe_radius:new i.aa(Z),u_globe_transition:new i.aa(Z),u_is_globe:new i.a7(Z),u_viewport:new i.a8(Z)}))(r)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Z=>({u_cutoff_params:new i.as(Z)}))(r)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Z=>({u_lighting_ambient_color:new i.aq(Z),u_lighting_directional_dir:new i.aq(Z),u_lighting_directional_color:new i.aq(Z),u_ground_radiance:new i.aq(Z)}))(r)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Z=>({u_light_matrix_0:new i.a6(Z),u_light_matrix_1:new i.a6(Z),u_fade_range:new i.a8(Z),u_shadow_normal_offset:new i.aq(Z),u_shadow_intensity:new i.aa(Z),u_shadow_texel_size:new i.aa(Z),u_shadow_map_resolution:new i.aa(Z),u_shadow_direction:new i.aq(Z),u_shadow_bias:new i.aq(Z),u_shadowmap_0:new i.a7(Z),u_shadowmap_1:new i.a7(Z)}))(r))}}setTerrainUniformValues(r,h){if(!this.terrainUniforms)return;let g=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setGlobeUniformValues(r,h){if(!this.globeUniforms)return;let g=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setFogUniformValues(r,h){if(!this.fogUniforms)return;let g=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setCutoffUniformValues(r,h){if(!this.cutoffUniforms)return;let g=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setLightsUniformValues(r,h){if(!this.lightsUniforms)return;let g=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setShadowUniformValues(r,h){if(this.failedToCreate||!this.shadowUniforms)return;let g=this.shadowUniforms;r.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}_drawDebugWireframe(r,h,g,v,x,S,k,D,A,L){let z=r.options.wireframe;if(z.terrain===!1&&z.layers2D===!1&&z.layers3D===!1)return;let U=r.context;if(!(!(!z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!z.layers2D||r._terrain&&r._terrain.renderingToTexture||!pu.includes(this.name))||!(!z.layers3D||!Hg.includes(this.name))))return;let H=U.gl,$=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,x,U);if(!$)return;let Y=[...this.fixedDefines];Y.push("DEBUG_WIREFRAME");let Z=r.getOrCreateProgram(this.name,{config:this.configuration,defines:Y});U.program.set(Z.program);let Q=(ae,ge,fe)=>{if(ge[ae]&&fe[ae])for(let ne in ge[ae])fe[ae][ne]&&fe[ae][ne].set(fe.program,ne,ge[ae][ne].current)};A&&A.setUniforms(Z.program,U,Z.binderUniforms,k,{zoom:D}),Q("fixedUniforms",this,Z),Q("terrainUniforms",this,Z),Q("globeUniforms",this,Z),Q("fogUniforms",this,Z),Q("lightsUniforms",this,Z),Q("shadowUniforms",this,Z),$.bind(),U.setColorMode(new i.a([H.ONE,H.ONE_MINUS_SRC_ALPHA,H.ZERO,H.ONE],i.C.transparent,[!0,!0,!0,!1])),U.setDepthMode(new i.ae(h.func===H.LESS?H.LEQUAL:h.func,i.ae.ReadOnly,h.range)),U.setStencilMode(i.ag.disabled);let re=3*S.primitiveLength*2,oe=3*S.primitiveOffset*2*2;L&&L>1?H.drawElementsInstanced(H.LINES,re,H.UNSIGNED_SHORT,oe,L):H.drawElements(H.LINES,re,H.UNSIGNED_SHORT,oe),x.bind(),U.program.set(this.program),U.setDepthMode(h),U.setStencilMode(g),U.setColorMode(v)}draw(r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y,Z){let Q=r.context,re=Q.gl;if(this.failedToCreate)return;Q.program.set(this.program),Q.setDepthMode(g),Q.setStencilMode(v),Q.setColorMode(x),Q.setCullFace(S);for(let ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(this.program,ge,k[ge]);$&&$.setUniforms(this.program,Q,this.binderUniforms,U,{zoom:H});let oe={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[h],ae=Z&&Z>0?1:void 0;for(let ge of z.get()){let fe=ge.vaos||(ge.vaos={});(fe[D]||(fe[D]=new yy)).bind(Q,this,A,$?$.getPaintVertexBuffers():[],L,ge.vertexOffset,Y||[],ae),Z&&Z>1?re.drawElementsInstanced(h,ge.primitiveLength*oe,re.UNSIGNED_SHORT,ge.primitiveOffset*oe*2,Z):L?re.drawElements(h,ge.primitiveLength*oe,re.UNSIGNED_SHORT,ge.primitiveOffset*oe*2):re.drawArrays(h,ge.vertexOffset,ge.vertexLength),h===re.TRIANGLES&&L&&this._drawDebugWireframe(r,g,v,x,L,ge,U,H,$,Z)}}}function fu(f,r){let h=Math.pow(2,r.tileID.overscaledZ),g=r.tileSize*Math.pow(2,f.transform.tileZoom)/h,v=g*(r.tileID.canonical.x+r.tileID.wrap*h),x=g*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.bB(r,1,f.transform.tileZoom),u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}let gu=i.ad.create(),fc=(f,r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y)=>{let Z=r.style.light,Q=Z.properties.get("position"),re=[Q.x,Q.y,Q.z],oe=i.bC.create();Z.properties.get("anchor")==="viewport"&&(i.bC.fromRotation(oe,-r.transform.angle),i._.transformMat3(re,re,oe));let ae=Z.properties.get("color"),ge=r.transform,fe={u_matrix:f,u_lightpos:re,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:x,u_flood_light_color:z,u_vertical_scale:U,u_flood_light_intensity:H,u_ground_shadow_factor:$,u_emissive_strength:Y};return ge.projection.name==="globe"&&(fe.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],fe.u_zoom_transition=D,fe.u_inv_rot_matrix=L,fe.u_merc_center=A,fe.u_up_dir=ge.projection.upVector(new i.aO(0,0,0),A[0]*i.a3,A[1]*i.a3),fe.u_height_lift=k),fe},gc=(f,r,h)=>({u_matrix:f,u_edge_radius:r,u_vertical_scale:h}),Sp=(f,r,h,g,v,x,S,k,D,A,L,z,U,H)=>{let $=fc(f,r,h,g,v,x,S,D,A,L,z,U,H,1,[0,0,0],0),Y={u_height_factor:-Math.pow(2,S.overscaledZ)/k.tileSize/8};return i.W($,fu(r,k),Y)},Mp=(f,r)=>({u_matrix:f,u_emissive_strength:r}),kp=(f,r,h,g)=>i.W(Mp(f,r),fu(h,g)),Wg=(f,r,h)=>({u_matrix:f,u_world:h,u_emissive_strength:r}),_u=(f,r,h,g,v)=>i.W(kp(f,r,h,g),{u_world:v}),Tp=(f,r,h,g)=>{let v=i.a3/h.tileSize;return{u_matrix:f,u_camera_to_center_distance:r.getCameraToCenterDistance(g),u_extrude_scale:[r.pixelsToGLUnits[0]/v,r.pixelsToGLUnits[1]/v]}},bu=(f,r,h=1)=>({u_matrix:f,u_color:r.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),Ud=i.ad.create(),dl=(f,r,h,g,v,x,S)=>{let k=f.transform,D=k.projection.name==="globe",A=D?i.bD(k.zoom,r.canonical)*k._pixelsPerMercatorPixel:i.bB(h,1,x),L={u_matrix:r.projMatrix,u_extrude_scale:A,u_intensity:S,u_inv_rot_matrix:Ud,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){L.u_inv_rot_matrix=g,L.u_merc_center=v,L.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],L.u_zoom_transition=i.a1(k.zoom);let z=v[0]*i.a3,U=v[1]*i.a3;L.u_up_dir=k.projection.upVector(new i.aO(0,0,0),z,U)}return L};function Gg(f,[r,h,g,v],[x,S]){if(x===S)return[0,0,0,0];let k=255*(f-1)/(f*(S-x));return[r*k,h*k,g*k,v*k]}function Ip(f,r,[h,g]){return h===g?0:.5/f+(r-h)*(f-1)/(f*(g-h))}let Hd=(f,r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y,Z,Q,re,oe,ae)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:A,u_fade_t:L.mix,u_opacity:L.opacity*z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:z.paint.get("raster-brightness-min"),u_brightness_high:z.paint.get("raster-brightness-max"),u_saturation_factor:i.bE(z.paint.get("raster-saturation")),u_contrast_factor:i.bF(z.paint.get("raster-contrast")),u_spin_weights:Wd(z.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:H,u_zoom_transition:S,u_merc_center:k,u_cutoff_params:D,u_colorization_mix:Gg(i.bG,Y,Q),u_colorization_offset:Ip(i.bG,Z,Q),u_color_ramp:$,u_texture_offset:[oe/(re+2*oe),re/(re+2*oe)],u_texture_res:[re+2*oe,re+2*oe],u_emissive_strength:ae});function Wd(f){f*=Math.PI/180;let r=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*r-h+1)/3,(Math.sqrt(3)*r-h+1)/3]}let Ms=.15,Ep=(f,r,h,g,v,x,S,k,D,A,L,z)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:A,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:z,u_zoom_transition:S,u_merc_center:k,u_cutoff_params:D}),Dp=(f,r,h,g,v,x,S,k,D,A)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_tile_offset:h,u_velocity:g,u_color_ramp:x,u_velocity_res:v,u_max_speed:S,u_uv_offset:k,u_data_scale:D,u_data_offset:A,u_particle_pos_scale:1.3,u_particle_pos_offset:[Ms,Ms]}),Cy=(f,r,h,g,v,x,S,k,D,A)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_velocity:h,u_velocity_res:g,u_max_speed:v,u_speed_factor:x,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:k,u_data_scale:D,u_data_offset:A,u_particle_pos_scale:1.3,u_particle_pos_offset:[Ms,Ms]}),ra=i.ad.create(),_c=(f,r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y,Z,Q)=>{let re=v.transform,oe={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:re.getCameraToCenterDistance(Y),u_rotate_symbol:+h,u_aspect_ratio:re.width/re.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:S,u_coord_matrix:k,u_is_text:+D,u_pitch_with_map:+g,u_texsize:A,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ra,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ra,u_up_vector:[0,-1,0],u_color_adj_mat:Z,u_icon_transition:Q||0};return Y.name==="globe"&&(oe.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],oe.u_zoom_transition=z,oe.u_inv_rot_matrix=H,oe.u_merc_center=U,oe.u_camera_forward=re._camera.forward(),oe.u_ecef_origin=i.bH(re.globeMatrix,L.toUnwrapped()),oe.u_tile_matrix=Float32Array.from(re.globeMatrix),oe.u_up_vector=$),oe},yu=(f,r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y,Z)=>i.W(_c(f,r,h,g,v,x,S,k,D,A,z,U,H,$,Y,Z),{u_gamma_scale:g?v.transform.getCameraToCenterDistance(Z)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:i.e.devicePixelRatio,u_is_halo:+L,undefined:void 0}),qg=(f,r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y)=>i.W(yu(f,r,h,g,v,x,S,k,!0,D,!0,L,z,U,H,$,Y),{u_texsize_icon:A,u_texture_icon:1}),Gd=(f,r,h,g)=>({u_matrix:f,u_emissive_strength:r,u_opacity:h,u_color:g}),$g=(f,r,h,g,v,x,S,k)=>i.W(function(D,A,L,z,U){let{width:H,height:$}=z.imageManager.getPixelSize(A),Y=Math.pow(2,U.tileID.overscaledZ),Z=U.tileSize*Math.pow(2,z.transform.tileZoom)/Y,Q=Z*(U.tileID.canonical.x+U.tileID.wrap*Y),re=Z*U.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[H,$],u_pattern_size:L.displaySize,u_tile_units_to_pixels:1/i.bB(U,1,z.transform.tileZoom),u_pixel_coord_upper:[Q>>16,re>>16],u_pixel_coord_lower:[65535&Q,65535&re]}}(0,x,S,g,k),{u_matrix:f,u_emissive_strength:r,u_opacity:h}),Ap=new Float32Array(i.ad.identity([])),qd=(f,r,h,g,v,x,S,k,D,A,L,z,U,H=[0,0,0],$)=>{let Y=v.style.light,Z=Y.properties.get("position"),Q=[-Z.x,-Z.y,Z.z],re=i.bC.create();Y.properties.get("anchor")==="viewport"&&(i.bC.fromRotation(re,-v.transform.angle),i._.transformMat3(Q,Q,re));let oe=L.alphaMode==="MASK",ae=Y.properties.get("color").toRenderColor(null),ge=U.paint.get("model-ambient-occlusion-intensity"),fe=U.paint.get("model-color").constantOr(i.C.white).toRenderColor(null),ne=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:r,u_normal_matrix:h,u_node_matrix:g||Ap,u_lightpos:Q,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_camera_pos:H,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+oe,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[k[0],k[1],k[2],1],u_metallicFactor:D,u_roughnessFactor:A,u_baseColorTexture:Hr.BaseColor,u_metallicRoughnessTexture:Hr.MetallicRoughness,u_normalTexture:Hr.Normal,u_occlusionTexture:Hr.Occlusion,u_emissionTexture:Hr.Emission,u_lutTexture:Hr.LUT,u_color_mix:[fe.r,fe.g,fe.b,ne],u_aoIntensity:ge,u_emissive_strength:z,u_occlusionTextureTransform:$||[0,0,0,0]}},Yg=(f,r=Ap,h=Ap)=>({u_matrix:f,u_instance:r,u_node_matrix:h}),Zg=(f,r,h,g,v)=>({u_matrix:Float32Array.from(f),u_anchorPos:r,u_screenSizePx:h,u_occluderSizePx:g,u_color:v}),Sy={fillExtrusion:f=>({u_matrix:new i.a6(f),u_lightpos:new i.aq(f),u_lightintensity:new i.aa(f),u_lightcolor:new i.aq(f),u_vertical_gradient:new i.aa(f),u_opacity:new i.aa(f),u_edge_radius:new i.aa(f),u_ao:new i.a8(f),u_tile_id:new i.aq(f),u_zoom_transition:new i.aa(f),u_inv_rot_matrix:new i.a6(f),u_merc_center:new i.a8(f),u_up_dir:new i.aq(f),u_height_lift:new i.aa(f),u_flood_light_color:new i.aq(f),u_vertical_scale:new i.aa(f),u_flood_light_intensity:new i.aa(f),u_ground_shadow_factor:new i.aq(f),u_emissive_strength:new i.aa(f)}),fillExtrusionDepth:f=>({u_matrix:new i.a6(f),u_edge_radius:new i.aa(f),u_vertical_scale:new i.aa(f)}),fillExtrusionPattern:f=>({u_matrix:new i.a6(f),u_lightpos:new i.aq(f),u_lightintensity:new i.aa(f),u_lightcolor:new i.aq(f),u_vertical_gradient:new i.aa(f),u_height_factor:new i.aa(f),u_edge_radius:new i.aa(f),u_ao:new i.a8(f),u_tile_id:new i.aq(f),u_zoom_transition:new i.aa(f),u_inv_rot_matrix:new i.a6(f),u_merc_center:new i.a8(f),u_up_dir:new i.aq(f),u_height_lift:new i.aa(f),u_image:new i.a7(f),u_texsize:new i.a8(f),u_pixel_coord_upper:new i.a8(f),u_pixel_coord_lower:new i.a8(f),u_tile_units_to_pixels:new i.aa(f),u_opacity:new i.aa(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new i.a6(f),u_opacity:new i.aa(f),u_ao_pass:new i.aa(f),u_meter_to_tile:new i.aa(f),u_ao:new i.a8(f),u_flood_light_intensity:new i.aa(f),u_flood_light_color:new i.aq(f),u_attenuation:new i.aa(f),u_edge_radius:new i.aa(f),u_fb:new i.a7(f),u_fb_size:new i.aa(f)}),fill:f=>({u_matrix:new i.a6(f),u_emissive_strength:new i.aa(f)}),fillPattern:f=>({u_matrix:new i.a6(f),u_emissive_strength:new i.aa(f),u_image:new i.a7(f),u_texsize:new i.a8(f),u_pixel_coord_upper:new i.a8(f),u_pixel_coord_lower:new i.a8(f),u_tile_units_to_pixels:new i.aa(f)}),fillOutline:f=>({u_matrix:new i.a6(f),u_emissive_strength:new i.aa(f),u_world:new i.a8(f)}),fillOutlinePattern:f=>({u_matrix:new i.a6(f),u_emissive_strength:new i.aa(f),u_world:new i.a8(f),u_image:new i.a7(f),u_texsize:new i.a8(f),u_pixel_coord_upper:new i.a8(f),u_pixel_coord_lower:new i.a8(f),u_tile_units_to_pixels:new i.aa(f)}),circle:i.bI,collisionBox:f=>({u_matrix:new i.a6(f),u_camera_to_center_distance:new i.aa(f),u_extrude_scale:new i.a8(f)}),collisionCircle:f=>({u_matrix:new i.a6(f),u_inv_matrix:new i.a6(f),u_camera_to_center_distance:new i.aa(f),u_viewport_size:new i.a8(f)}),debug:f=>({u_color:new i.a9(f),u_matrix:new i.a6(f),u_overlay:new i.a7(f),u_overlay_scale:new i.aa(f)}),clippingMask:f=>({u_matrix:new i.a6(f)}),heatmap:f=>({u_extrude_scale:new i.aa(f),u_intensity:new i.aa(f),u_matrix:new i.a6(f),u_inv_rot_matrix:new i.a6(f),u_merc_center:new i.a8(f),u_tile_id:new i.aq(f),u_zoom_transition:new i.aa(f),u_up_dir:new i.aq(f)}),heatmapTexture:f=>({u_image:new i.a7(f),u_color_ramp:new i.a7(f),u_opacity:new i.aa(f)}),hillshade:f=>({u_matrix:new i.a6(f),u_image:new i.a7(f),u_latrange:new i.a8(f),u_light:new i.a8(f),u_shadow:new i.a9(f),u_highlight:new i.a9(f),u_emissive_strength:new i.aa(f),u_accent:new i.a9(f)}),hillshadePrepare:f=>({u_matrix:new i.a6(f),u_image:new i.a7(f),u_dimension:new i.a8(f),u_zoom:new i.aa(f)}),line:i.bJ,linePattern:i.bK,raster:f=>({u_matrix:new i.a6(f),u_normalize_matrix:new i.a6(f),u_globe_matrix:new i.a6(f),u_merc_matrix:new i.a6(f),u_grid_matrix:new i.ar(f),u_tl_parent:new i.a8(f),u_scale_parent:new i.aa(f),u_fade_t:new i.aa(f),u_opacity:new i.aa(f),u_image0:new i.a7(f),u_image1:new i.a7(f),u_brightness_low:new i.aa(f),u_brightness_high:new i.aa(f),u_saturation_factor:new i.aa(f),u_contrast_factor:new i.aa(f),u_spin_weights:new i.aq(f),u_perspective_transform:new i.a8(f),u_raster_elevation:new i.aa(f),u_zoom_transition:new i.aa(f),u_merc_center:new i.a8(f),u_cutoff_params:new i.as(f),u_colorization_mix:new i.as(f),u_colorization_offset:new i.aa(f),u_color_ramp:new i.a7(f),u_texture_offset:new i.a8(f),u_texture_res:new i.a8(f),u_emissive_strength:new i.aa(f)}),rasterParticle:f=>({u_matrix:new i.a6(f),u_normalize_matrix:new i.a6(f),u_globe_matrix:new i.a6(f),u_merc_matrix:new i.a6(f),u_grid_matrix:new i.ar(f),u_tl_parent:new i.a8(f),u_scale_parent:new i.aa(f),u_fade_t:new i.aa(f),u_opacity:new i.aa(f),u_image0:new i.a7(f),u_image1:new i.a7(f),u_raster_elevation:new i.aa(f),u_zoom_transition:new i.aa(f),u_merc_center:new i.a8(f),u_cutoff_params:new i.as(f)}),rasterParticleTexture:f=>({u_texture:new i.a7(f),u_opacity:new i.aa(f)}),rasterParticleDraw:f=>({u_particle_texture:new i.a7(f),u_particle_texture_side_len:new i.aa(f),u_tile_offset:new i.a8(f),u_velocity:new i.a7(f),u_color_ramp:new i.a7(f),u_velocity_res:new i.a8(f),u_max_speed:new i.aa(f),u_uv_offset:new i.a8(f),u_data_scale:new i.as(f),u_data_offset:new i.aa(f),u_particle_pos_scale:new i.aa(f),u_particle_pos_offset:new i.a8(f)}),rasterParticleUpdate:f=>({u_particle_texture:new i.a7(f),u_particle_texture_side_len:new i.aa(f),u_velocity:new i.a7(f),u_velocity_res:new i.a8(f),u_max_speed:new i.aa(f),u_speed_factor:new i.aa(f),u_reset_rate:new i.aa(f),u_rand_seed:new i.aa(f),u_uv_offset:new i.a8(f),u_data_scale:new i.as(f),u_data_offset:new i.aa(f),u_particle_pos_scale:new i.aa(f),u_particle_pos_offset:new i.a8(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new i.a7(f),u_is_size_feature_constant:new i.a7(f),u_size_t:new i.aa(f),u_size:new i.aa(f),u_camera_to_center_distance:new i.aa(f),u_rotate_symbol:new i.a7(f),u_aspect_ratio:new i.aa(f),u_fade_change:new i.aa(f),u_matrix:new i.a6(f),u_label_plane_matrix:new i.a6(f),u_coord_matrix:new i.a6(f),u_is_text:new i.a7(f),u_pitch_with_map:new i.a7(f),u_texsize:new i.a8(f),u_tile_id:new i.aq(f),u_zoom_transition:new i.aa(f),u_inv_rot_matrix:new i.a6(f),u_merc_center:new i.a8(f),u_camera_forward:new i.aq(f),u_tile_matrix:new i.a6(f),u_up_vector:new i.aq(f),u_ecef_origin:new i.aq(f),u_texture:new i.a7(f),u_icon_transition:new i.aa(f),u_color_adj_mat:new i.a6(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new i.a7(f),u_is_size_feature_constant:new i.a7(f),u_size_t:new i.aa(f),u_size:new i.aa(f),u_camera_to_center_distance:new i.aa(f),u_rotate_symbol:new i.a7(f),u_aspect_ratio:new i.aa(f),u_fade_change:new i.aa(f),u_matrix:new i.a6(f),u_label_plane_matrix:new i.a6(f),u_coord_matrix:new i.a6(f),u_is_text:new i.a7(f),u_pitch_with_map:new i.a7(f),u_texsize:new i.a8(f),u_texture:new i.a7(f),u_gamma_scale:new i.aa(f),u_device_pixel_ratio:new i.aa(f),u_tile_id:new i.aq(f),u_zoom_transition:new i.aa(f),u_inv_rot_matrix:new i.a6(f),u_merc_center:new i.a8(f),u_camera_forward:new i.aq(f),u_tile_matrix:new i.a6(f),u_up_vector:new i.aq(f),u_ecef_origin:new i.aq(f),u_is_halo:new i.a7(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new i.a7(f),u_is_size_feature_constant:new i.a7(f),u_size_t:new i.aa(f),u_size:new i.aa(f),u_camera_to_center_distance:new i.aa(f),u_rotate_symbol:new i.a7(f),u_aspect_ratio:new i.aa(f),u_fade_change:new i.aa(f),u_matrix:new i.a6(f),u_label_plane_matrix:new i.a6(f),u_coord_matrix:new i.a6(f),u_is_text:new i.a7(f),u_pitch_with_map:new i.a7(f),u_texsize:new i.a8(f),u_texsize_icon:new i.a8(f),u_texture:new i.a7(f),u_texture_icon:new i.a7(f),u_gamma_scale:new i.aa(f),u_device_pixel_ratio:new i.aa(f),u_is_halo:new i.a7(f)}),background:f=>({u_matrix:new i.a6(f),u_emissive_strength:new i.aa(f),u_opacity:new i.aa(f),u_color:new i.a9(f)}),backgroundPattern:f=>({u_matrix:new i.a6(f),u_emissive_strength:new i.aa(f),u_opacity:new i.aa(f),u_image:new i.a7(f),u_pattern_tl:new i.a8(f),u_pattern_br:new i.a8(f),u_texsize:new i.a8(f),u_pattern_size:new i.a8(f),u_pixel_coord_upper:new i.a8(f),u_pixel_coord_lower:new i.a8(f),u_tile_units_to_pixels:new i.aa(f)}),terrainRaster:ol,terrainDepth:ol,skybox:f=>({u_matrix:new i.a6(f),u_sun_direction:new i.aq(f),u_cubemap:new i.a7(f),u_opacity:new i.aa(f),u_temporal_offset:new i.aa(f)}),skyboxGradient:f=>({u_matrix:new i.a6(f),u_color_ramp:new i.a7(f),u_center_direction:new i.aq(f),u_radius:new i.aa(f),u_opacity:new i.aa(f),u_temporal_offset:new i.aa(f)}),skyboxCapture:f=>({u_matrix_3f:new i.ar(f),u_sun_direction:new i.aq(f),u_sun_intensity:new i.aa(f),u_color_tint_r:new i.as(f),u_color_tint_m:new i.as(f),u_luminance:new i.aa(f)}),globeRaster:f=>({u_proj_matrix:new i.a6(f),u_globe_matrix:new i.a6(f),u_normalize_matrix:new i.a6(f),u_merc_matrix:new i.a6(f),u_zoom_transition:new i.aa(f),u_merc_center:new i.a8(f),u_image0:new i.a7(f),u_grid_matrix:new i.ar(f),u_skirt_height:new i.aa(f),u_far_z_cutoff:new i.aa(f),u_frustum_tl:new i.aq(f),u_frustum_tr:new i.aq(f),u_frustum_br:new i.aq(f),u_frustum_bl:new i.aq(f),u_globe_pos:new i.aq(f),u_globe_radius:new i.aa(f),u_viewport:new i.a8(f)}),globeAtmosphere:f=>({u_frustum_tl:new i.aq(f),u_frustum_tr:new i.aq(f),u_frustum_br:new i.aq(f),u_frustum_bl:new i.aq(f),u_horizon:new i.aa(f),u_transition:new i.aa(f),u_fadeout_range:new i.aa(f),u_color:new i.as(f),u_high_color:new i.as(f),u_space_color:new i.as(f),u_temporal_offset:new i.aa(f),u_horizon_angle:new i.aa(f)}),model:f=>({u_matrix:new i.a6(f),u_lighting_matrix:new i.a6(f),u_normal_matrix:new i.a6(f),u_node_matrix:new i.a6(f),u_lightpos:new i.aq(f),u_lightintensity:new i.aa(f),u_lightcolor:new i.aq(f),u_camera_pos:new i.aq(f),u_opacity:new i.aa(f),u_baseColorFactor:new i.as(f),u_emissiveFactor:new i.as(f),u_metallicFactor:new i.aa(f),u_roughnessFactor:new i.aa(f),u_baseTextureIsAlpha:new i.a7(f),u_alphaMask:new i.a7(f),u_alphaCutoff:new i.aa(f),u_baseColorTexture:new i.a7(f),u_metallicRoughnessTexture:new i.a7(f),u_normalTexture:new i.a7(f),u_occlusionTexture:new i.a7(f),u_emissionTexture:new i.a7(f),u_lutTexture:new i.a7(f),u_color_mix:new i.as(f),u_aoIntensity:new i.aa(f),u_emissive_strength:new i.aa(f),u_occlusionTextureTransform:new i.as(f)}),modelDepth:f=>({u_matrix:new i.a6(f),u_instance:new i.a6(f),u_node_matrix:new i.a6(f)}),groundShadow:f=>({u_matrix:new i.a6(f),u_ground_shadow_factor:new i.aq(f)}),stars:f=>({u_matrix:new i.a6(f),u_up:new i.aq(f),u_right:new i.aq(f),u_intensity_multiplier:new i.aa(f)}),occlusion:f=>({u_matrix:new i.a6(f),u_anchorPos:new i.aq(f),u_screenSizePx:new i.a8(f),u_occluderSizePx:new i.a8(f),u_color:new i.as(f)})};function vu(f,r,h){let g=r.createTileMatrix(f,f.worldSize,h.toUnwrapped());return i.ad.multiply(new Float32Array(16),f.projMatrix,g)}function My(f,r,h){if(r.projection.name===h.projection.name)return f.projMatrix;let g=h.clone();return g.setProjection(r.projection),vu(g,r.getProjection(),f)}function bc(f,r,h){return r.name===h.projection.name?f.projMatrix:vu(h,r,f)}let xu;function $d(f,r,h,g,v,x,S){let k=f.context,D=k.gl,A=f.transform,L=f.getOrCreateProgram("collisionBox"),z=[],U=0,H=0;for(let ae=0;ae<g.length;ae++){let ge=g[ae],fe=r.getTile(ge),ne=fe.getBucket(h);if(!ne)continue;let se=My(ge,ne,A),le=se;v[0]===0&&v[1]===0||(le=f.translatePosMatrix(se,fe,v,x));let we=S?ne.textCollisionBox:ne.iconCollisionBox,Oe=ne.collisionCircleArray;if(Oe.length>0){let ue=i.ad.create(),Re=le;i.ad.mul(ue,ne.placementInvProjMatrix,A.glCoordMatrix),i.ad.mul(ue,ue,ne.placementViewportMatrix),z.push({circleArray:Oe,circleOffset:H,transform:Re,invTransform:ue,projection:ne.getProjection()}),U+=Oe.length/4,H=U}we&&(f.terrain&&f.terrain.setupElevationDraw(fe,L),L.draw(f,D.LINES,i.ae.disabled,i.ag.disabled,f.colorModeForRenderPass(),i.af.disabled,Tp(le,A,fe,ne.getProjection()),h.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,A.zoom,null,[we.collisionVertexBuffer,we.collisionVertexBufferExt]))}if(!S||!z.length)return;let $=f.getOrCreateProgram("collisionCircle"),Y=new i.bL;Y.resize(4*U),Y._trim();let Z=0;for(let ae of z)for(let ge=0;ge<ae.circleArray.length/4;ge++){let fe=4*ge,ne=ae.circleArray[fe+0],se=ae.circleArray[fe+1],le=ae.circleArray[fe+2],we=ae.circleArray[fe+3];Y.emplace(Z++,ne,se,le,we,0),Y.emplace(Z++,ne,se,le,we,1),Y.emplace(Z++,ne,se,le,we,2),Y.emplace(Z++,ne,se,le,we,3)}(!xu||xu.length<2*U)&&(xu=function(ae){let ge=2*ae,fe=new i.bu;fe.resize(ge),fe._trim();for(let ne=0;ne<ge;ne++){let se=6*ne;fe.uint16[se+0]=4*ne+0,fe.uint16[se+1]=4*ne+1,fe.uint16[se+2]=4*ne+2,fe.uint16[se+3]=4*ne+2,fe.uint16[se+4]=4*ne+3,fe.uint16[se+5]=4*ne+0}return fe}(U));let Q=k.createIndexBuffer(xu,!0),re=k.createVertexBuffer(Y,i.bM.members,!0);for(let ae of z){let ge={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(oe=A).getCameraToCenterDistance(ae.projection),u_viewport_size:[oe.width,oe.height]};$.draw(f,D.TRIANGLES,i.ae.disabled,i.ag.disabled,f.colorModeForRenderPass(),i.af.disabled,ge,h.id,re,Q,i.b.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,A.zoom)}var oe;re.destroy(),Q.destroy()}let hl=i.ad.create();function Xg(f){let r=f._camera.getWorldToCamera(f.worldSize,1),h=i.ad.multiply([],r,f.globeMatrix);i.ad.invert(h,h);let g=[0,0,0],v=[0,1,0,0];return i.aA.transformMat4(v,v,h),g[0]=v[0],g[1]=v[1],g[2]=v[2],i._.normalize(g,g),g}function ky({width:f,height:r,anchor:h,textOffset:g,textScale:v},x){let{horizontalAlign:S,verticalAlign:k}=i.bQ(h),D=-(S-.5)*f,A=-(k-.5)*r,L=i.bP(h,g);return new i.P((D/v+L[0])*x,(A/v+L[1])*x)}function Qg(f,r,h,g,v,x,S,k,D,A,L){let z=f.text.placedSymbolArray,U=f.text.dynamicLayoutVertexArray,H=f.icon.dynamicLayoutVertexArray,$={},Y=f.getProjection(),Z=bc(k,Y,x),Q=x.elevation,re=Y.upVectorScale(k.canonical,x.center.lat,x.worldSize).metersToTile;U.clear();for(let oe=0;oe<z.length;oe++){let ae=z.get(oe),{tileAnchorX:ge,tileAnchorY:fe,numGlyphs:ne}=ae,se=ae.hidden||!ae.crossTileID||f.allowVerticalPlacement&&!ae.placedOrientation?null:g[ae.crossTileID];if(se){let le=0,we=0,Oe=0;if(Q){let Ye=Q?Q.getAtTileOffset(k,ge,fe):0,[ft,_t,kt]=Y.upVector(k.canonical,ge,fe);le=Ye*ft*re,we=Ye*_t*re,Oe=Ye*kt*re}let[ue,Re,Be,Qe]=zo(ae.projectedAnchorX+le,ae.projectedAnchorY+we,ae.projectedAnchorZ+Oe,h?Z:S),Je=Nr(x.getCameraToCenterDistance(Y),Qe),Ze=v.evaluateSizeForFeature(f.textSizeData,A,ae)*Je/i.bN;h&&(Ze*=f.tilePixelRatio/D);let Ie=ky(se,Ze);h?({x:ue,y:Re,z:Be}=Y.projectTilePoint(ge+Ie.x,fe+Ie.y,k.canonical),[ue,Re,Be]=zo(ue+le,Re+we,Be+Oe,S)):(r&&Ie._rotate(-x.angle),ue+=Ie.x,Re+=Ie.y,Be=0);let Ve=f.allowVerticalPlacement&&ae.placedOrientation===i.aE.vertical?Math.PI/2:0;for(let Ye=0;Ye<ne;Ye++)i.aH(U,ue,Re,Be,Ve);L&&ae.associatedIconIndex>=0&&($[ae.associatedIconIndex]={x:ue,y:Re,z:Be,angle:Ve})}else ll(ne,U)}if(L){H.clear();let oe=f.icon.placedSymbolArray;for(let ae=0;ae<oe.length;ae++){let ge=oe.get(ae),{numGlyphs:fe}=ge,ne=$[ae];if(ge.hidden||!ne)ll(fe,H);else{let{x:se,y:le,z:we,angle:Oe}=ne;for(let ue=0;ue<fe;ue++)i.aH(H,se,le,we,Oe)}}f.icon.dynamicLayoutVertexBuffer.updateData(H)}f.text.dynamicLayoutVertexBuffer.updateData(U)}function Pp(f,r,h,g,v,x,S={}){let k=h.paint.get("icon-translate"),D=h.paint.get("text-translate"),A=h.paint.get("icon-translate-anchor"),L=h.paint.get("text-translate-anchor"),z=h.layout.get("icon-rotation-alignment"),U=h.layout.get("text-rotation-alignment"),H=h.layout.get("icon-pitch-alignment"),$=h.layout.get("text-pitch-alignment"),Y=h.layout.get("icon-keep-upright"),Z=h.layout.get("text-keep-upright"),Q=h.paint.get("icon-color-saturation"),re=h.paint.get("icon-color-contrast"),oe=h.paint.get("icon-color-brightness-min"),ae=h.paint.get("icon-color-brightness-max"),ge=h.paint.get("icon-occlusion-opacity").constantOr(0),fe=h.paint.get("text-occlusion-opacity").constantOr(0),ne=f.context,se=ne.gl,le=f.transform,we=z==="map",Oe=U==="map",ue=H==="map",Re=$==="map",Be=ge!==1,Qe=fe!==1,Je=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ze=!1,Ie=f.depthModeForSublayer(0,i.ae.ReadOnly),Ve=[i.aj(le.center.lng),i.ak(le.center.lat)],Ye=h.layout.get("text-variable-anchor"),ft=le.projection.name==="globe",_t=[],kt=[0,-1,0];for(let bt of g){let it=r.getTile(bt),Ge=it.getBucket(h);if(!Ge||Ge.projection.name==="mercator"&&ft||Ge.fullyClipped)continue;let Dt=Ge.projection.name==="globe",ri=Dt?i.a1(le.zoom):0,ei=bc(bt,Ge.getProjection(),le),gi=le.calculatePixelsToTileUnitsMatrix(it),Ii=Ye&&Ge.hasTextData(),Ji=Ge.hasIconTextFit()&&Ii&&Ge.hasIconData(),Qt=Ge.getProjection().createInversionMatrix(le,bt.canonical),Hi=()=>{let Ke=we&&h.layout.get("symbol-placement")!=="point",wt=[];h.hasInitialOcclusionOpacityProperties&&Be&&f.symbolParams.useOcclusionQueries&&!Dt&&!ft&&wt.push("OCCLUSION_QUERIES"),h.hasInitialOcclusionOpacityProperties||wt.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH");let Dn=Ke||Ji,Wi=h.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&ue&&wt.push("PITCH_WITH_MAP_TERRAIN"),Dt&&(wt.push("PROJECTION_GLOBE_VIEW"),Dn&&wt.push("PROJECTED_POS_ON_VIEWPORT")),Wi>0&&wt.push("ICON_TRANSITION"),Ge.icon.zOffsetVertexBuffer&&wt.push("Z_OFFSET"),Q===0&&re===0&&oe===0&&ae===1||wt.push("COLOR_ADJUSTMENT");let Pe=Ge.icon.programConfigurations.get(h.id),Eo=f.getOrCreateProgram(Ge.sdfIcons?"symbolSDF":"symbolIcon",{config:Pe,defines:wt}),Ir,Gr=it.imageAtlasTexture?it.imageAtlasTexture.size:[0,0],fr=Ge.iconSizeData,no=i.aD(fr,le.zoom),da=ue||le.pitch!==0,Do=al(ei,it.tileID.canonical,ue,we,le,Ge.getProjection(),gi),Os=hc(ei,it.tileID.canonical,ue,we,le,Ge.getProjection(),gi),Rs=f.translatePosMatrix(Os,it,k,A,!0),Ya=f.translatePosMatrix(ei,it,k,A),ka=Dn?hl:Do,Za=we&&!ue&&!Ke,Ac=kt;!ft&&!le.mercatorFromTransition||we||(Ac=Xg(le));let Pc=Dt?Ac:kt;if(Ge.sdfIcons&&!Ge.iconsInText)Ir=yu(fr.kind,no,Za,ue,f,Ya,ka,Rs,!1,Gr,!0,bt,ri,Ve,Qt,Pc,Ge.getProjection());else{let cr=h.getColorAdjustmentMatrix(Q,re,oe,ae);Ir=_c(fr.kind,no,Za,ue,f,Ya,ka,Rs,!1,Gr,bt,ri,Ve,Qt,Pc,Ge.getProjection(),cr,Wi)}let wl=it.imageAtlasTexture?it.imageAtlasTexture:null,Oc=h.layout.get("icon-size").constantOr(0)!==1||Ge.iconsNeedLinear,Uu=Ge.sdfIcons||f.options.rotating||f.options.zooming||Oc||da?se.LINEAR:se.NEAREST,Hu=Ge.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,hf=f.terrain&&ue&&Ke?i.ad.invert(i.ad.create(),Do):hl;if(Ke&&Ge.icon){let cr=le.elevation,uf=cr?cr.getAtTileOffsetFunc(bt,le.center.lat,le.worldSize,Ge.getProjection()):null,Rc=sl(ei,it.tileID.canonical,ue,we,le,Ge.getProjection(),gi);au(Ge,ei,f,!1,Rc,Os,ue,Y,uf,bt)}return{program:Eo,buffers:Ge.icon,uniformValues:Ir,atlasTexture:wl,atlasTextureIcon:null,atlasInterpolation:Uu,atlasInterpolationIcon:null,isSDF:Ge.sdfIcons,hasHalo:Hu,tile:it,labelPlaneMatrixInv:hf}},dn=()=>{let Ke=Oe&&h.layout.get("symbol-placement")!=="point",wt=[],Dn=Ke||Ye||Ji;h.hasInitialOcclusionOpacityProperties&&Qe&&f.symbolParams.useOcclusionQueries&&!Dt&&!ft&&wt.push("OCCLUSION_QUERIES"),h.hasInitialOcclusionOpacityProperties||wt.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH"),f.terrainRenderModeElevated()&&Re&&wt.push("PITCH_WITH_MAP_TERRAIN"),Dt&&(wt.push("PROJECTION_GLOBE_VIEW"),Dn&&wt.push("PROJECTED_POS_ON_VIEWPORT")),Ge.text.zOffsetVertexBuffer&&wt.push("Z_OFFSET");let Wi=Ge.text.programConfigurations.get(h.id),Pe=f.getOrCreateProgram(Ge.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Wi,defines:wt}),Eo,Ir=[0,0],Gr=null,fr=Ge.textSizeData;Ge.iconsInText&&(Ir=it.imageAtlasTexture?it.imageAtlasTexture.size:[0,0],Gr=it.imageAtlasTexture?it.imageAtlasTexture:null,Eo=Re||le.pitch!==0||f.options.rotating||f.options.zooming||fr.kind==="composite"||fr.kind==="camera"?se.LINEAR:se.NEAREST);let no=it.glyphAtlasTexture?it.glyphAtlasTexture.size:[0,0],da=i.aD(fr,le.zoom),Do=al(ei,it.tileID.canonical,Re,Oe,le,Ge.getProjection(),gi),Os=hc(ei,it.tileID.canonical,Re,Oe,le,Ge.getProjection(),gi),Rs=f.translatePosMatrix(Os,it,D,L,!0),Ya=f.translatePosMatrix(ei,it,D,L),ka=Dn?hl:Do,Za=Oe&&!Re&&!Ke,Ac=kt;!ft&&!le.mercatorFromTransition||Oe||(Ac=Xg(le));let Pc=Dt?Ac:kt,wl;wl=Ge.iconsInText?qg(fr.kind,da,Za,Re,f,Ya,ka,Rs,no,Ir,bt,ri,Ve,Qt,Pc,Ge.getProjection()):yu(fr.kind,da,Za,Re,f,Ya,ka,Rs,!0,no,!0,bt,ri,Ve,Qt,Pc,Ge.getProjection());let Oc=it.glyphAtlasTexture?it.glyphAtlasTexture:null,Uu=se.LINEAR,Hu=h.paint.get("text-halo-width").constantOr(1)!==0,hf=f.terrain&&Re&&Ke?i.ad.invert(i.ad.create(),Do):hl;if(Ke&&Ge.text){let cr=le.elevation,uf=cr?cr.getAtTileOffsetFunc(bt,le.center.lat,le.worldSize,Ge.getProjection()):null,Rc=sl(ei,it.tileID.canonical,Re,Oe,le,Ge.getProjection(),gi);au(Ge,ei,f,!0,Rc,Os,Re,Z,uf,bt)}return{program:Pe,buffers:Ge.text,uniformValues:wl,atlasTexture:Oc,atlasTextureIcon:Gr,atlasInterpolation:Uu,atlasInterpolationIcon:Eo,isSDF:!0,hasHalo:Hu,tile:it,labelPlaneMatrixInv:hf}},Xi=Ge.icon.segments.get().length,yi=Ge.text.segments.get().length,ti=Xi&&!S.onlyText?Hi():null,fn=yi&&!S.onlyIcons?dn():null,yn=h.paint.get("icon-opacity").constantOr(1),tn=h.paint.get("text-opacity").constantOr(1);if(Je&&Ge.canOverlap){Ze=!0;let Ke=yn&&!S.onlyText?Ge.icon.segments.get():[],wt=tn&&!S.onlyIcons?Ge.text.segments.get():[];for(let Dn of Ke)_t.push({segments:new i.b([Dn]),sortKey:Dn.sortKey,state:ti});for(let Dn of wt)_t.push({segments:new i.b([Dn]),sortKey:Dn.sortKey,state:fn})}else S.onlyText||_t.push({segments:yn?Ge.icon.segments:new i.b([]),sortKey:0,state:ti}),S.onlyIcons||_t.push({segments:tn?Ge.text.segments:new i.b([]),sortKey:0,state:fn})}Ze&&_t.sort((bt,it)=>bt.sortKey-it.sortKey);for(let bt of _t){let it=bt.state;if(it)if(f.terrain&&f.terrain.setupElevationDraw(it.tile,it.program,{useDepthForOcclusion:!h.hasInitialOcclusionOpacityProperties&&le.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:it.labelPlaneMatrixInv}),ne.activeTexture.set(se.TEXTURE0),it.atlasTexture&&it.atlasTexture.bind(it.atlasInterpolation,se.CLAMP_TO_EDGE,!0),it.atlasTextureIcon&&(ne.activeTexture.set(se.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,se.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,it.program),it.hasHalo){let Ge=it.uniformValues;Ge.u_is_halo=1,yc(it.buffers,bt.segments,h,f,it.program,Ie,v,x,Ge,2),Ge.u_is_halo=0}else{if(it.isSDF){let Ge=it.uniformValues;it.hasHalo&&(Ge.u_is_halo=1,yc(it.buffers,bt.segments,h,f,it.program,Ie,v,x,Ge,1)),Ge.u_is_halo=0}yc(it.buffers,bt.segments,h,f,it.program,Ie,v,x,it.uniformValues,1)}}}function yc(f,r,h,g,v,x,S,k,D,A){let L=g.context.gl,z=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];f.occlusionQueryOpacityVertexBuffer.length>0&&z.push(f.occlusionQueryOpacityVertexBuffer),v.draw(g,L.TRIANGLES,x,S,k,i.af.disabled,D,h.id,f.layoutVertexBuffer,f.indexBuffer,r,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),z,A)}function Op(f,r,h,g,v,x,S){let k=f.context.gl,D=h.paint.get("fill-pattern"),A=D&&D.constantOr(1),L,z,U,H,$;S?(z=A&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=k.LINES):(z=A?"fillPattern":"fill",L=k.TRIANGLES);for(let Y of g){let Z=r.getTile(Y);if(A&&!Z.patternsLoaded())continue;let Q=Z.getBucket(h);if(!Q)continue;f.prepareDrawTile();let re=Q.programConfigurations.get(h.id),oe=f.isTileAffectedByFog(Y),ae=f.getOrCreateProgram(z,{config:re,overrideFog:oe});A&&(f.context.activeTexture.set(k.TEXTURE0),Z.imageAtlasTexture&&Z.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),re.updatePaintBuffers());let ge=D.constantOr(null);if(ge&&Z.imageAtlas){let se=Z.imageAtlas.patternPositions[ge.toString()];se&&re.setConstantPatternPositions(se)}let fe=f.translatePosMatrix(Y.projMatrix,Z,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),ne=h.paint.get("fill-emissive-strength");if(S){H=Q.indexBuffer2,$=Q.segments2;let se=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];U=z==="fillOutlinePattern"&&A?_u(fe,ne,f,Z,se):Wg(fe,ne,se)}else H=Q.indexBuffer,$=Q.segments,U=A?kp(fe,ne,f,Z):Mp(fe,ne);f.uploadCommonUniforms(f.context,ae,Y.toUnwrapped()),ae.draw(f,L,v,f.stencilModeForClipping(Y),x,i.af.disabled,U,h.id,Q.layoutVertexBuffer,H,$,h.paint,f.transform.zoom,re,void 0)}}function vc(f,r,h,g,v,x,S,k){h.resetLayerRenderingStats(f);let D=f.context,A=D.gl,L=f.transform,z=h.paint.get("fill-extrusion-pattern"),U=z.constantOr(1),H=h.paint.get("fill-extrusion-opacity"),$=f.style.enable3dLights(),Y=h.paint.get($&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Z=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y],Q=h.layout.get("fill-extrusion-edge-radius"),re=Q>0&&!h.paint.get("fill-extrusion-rounded-roof"),oe=re?0:Q,ae=L.projection.name==="globe"?i.bY():0,ge=L.projection.name==="globe",fe=ge?i.a1(L.zoom):0,ne=[i.aj(L.center.lng),i.ak(L.center.lat)],se=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),le=h.paint.get("fill-extrusion-flood-light-intensity"),we=h.paint.get("fill-extrusion-vertical-scale"),Oe=Ha(f,h.paint.get("fill-extrusion-cutoff-fade-range")),ue=h.paint.get("fill-extrusion-emissive-strength"),Re=[],Be;ge&&Re.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&Re.push("FAUX_AO"),re&&Re.push("ZERO_ROOF_RADIUS"),k&&Re.push("HAS_CENTROID"),le>0&&Re.push("FLOOD_LIGHT"),Oe.shouldRenderCutoff&&Re.push("RENDER_CUTOFF");let Qe=f.renderPass==="shadow",Je=f.shadowRenderer,Ze=Qe&&!!Je;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Ie=[0,0,0];if(Je){let ft=f.style.directionalLight,_t=f.style.ambientLight;ft&&_t&&(Ie=Wa(f.style,ft,_t)),Be=Re.concat(["SHADOWS_SINGLE_CASCADE"])}let Ve=Ze?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",Ye=h.getLayerRenderingStats();for(let ft of g){let _t=r.getTile(ft),kt=_t.getBucket(h);if(!kt||kt.projection.name!==L.projection.name)continue;let bt=!1;Je&&(bt=Je.getMaxCascadeForTile(ft.toUnwrapped())===0);let it=f.isTileAffectedByFog(ft),Ge=kt.programConfigurations.get(h.id),Dt=f.getOrCreateProgram(Ve,{config:Ge,defines:bt?Be:Re,overrideFog:it});if(f.terrain&&f.terrain.setupElevationDraw(_t,Dt,{useMeterToDem:!0}),!kt.centroidVertexBuffer){let Qt=Dt.attributes.a_centroid_pos;Qt!==void 0&&A.vertexAttrib2f(Qt,0,0)}!Qe&&Je&&Je.setupShadows(_t.tileID.toUnwrapped(),Dt,"vector-tile",_t.tileID.overscaledZ),U&&(f.context.activeTexture.set(A.TEXTURE0),_t.imageAtlasTexture&&_t.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Ge.updatePaintBuffers());let ri=z.constantOr(null);if(ri&&_t.imageAtlas){let Qt=_t.imageAtlas.patternPositions[ri.toString()];Qt&&Ge.setConstantPatternPositions(Qt)}let ei=h.paint.get("fill-extrusion-vertical-gradient"),gi;if(Qe&&Je){if(Rp(_t.tileID,kt,f))continue;let Qt=Je.calculateShadowPassMatrixFromTile(_t.tileID.toUnwrapped());gi=gc(Qt,oe,we)}else{let Qt=f.translatePosMatrix(ft.expandedProjMatrix,_t,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Hi=L.projection.createInversionMatrix(L,ft.canonical);gi=U?Sp(Qt,f,ei,H,Z,oe,ft,_t,ae,fe,ne,Hi,se,we):fc(Qt,f,ei,H,Z,oe,ft,ae,fe,ne,Hi,se,we,le,Ie,ue)}f.uploadCommonUniforms(D,Dt,ft.toUnwrapped(),null,Oe);let Ii=kt.segments;if(L.projection.name==="mercator"&&!Qe&&(Ii=kt.getVisibleSegments(_t.tileID,f.terrain,f.transform.getFrustum(0)),!Ii.get().length))continue;if(Ye)if(Qe)for(let Qt of Ii.get())Ye.numRenderedVerticesInShadowPass+=Qt.primitiveLength;else for(let Qt of Ii.get())Ye.numRenderedVerticesInTransparentPass+=Qt.primitiveLength;let Ji=[];(f.terrain||k)&&Ji.push(kt.centroidVertexBuffer),ge&&Ji.push(kt.layoutVertexExtBuffer),Dt.draw(f,D.gl.TRIANGLES,v,x,S,i.af.backCCW,gi,h.id,kt.layoutVertexBuffer,kt.indexBuffer,Ii,h.paint,f.transform.zoom,Ge,Ji)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function Jr(f,r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y,Z,Q,re){let oe=f.context,ae=oe.gl,ge=f.transform,fe=f.transform.zoom,ne=[],se=Ha(f,h.paint.get("fill-extrusion-cutoff-fade-range"));A==="clear"?(ne.push("CLEAR_SUBPASS"),re&&(ne.push("CLEAR_FROM_TEXTURE"),oe.activeTexture.set(ae.TEXTURE0),re.bind(ae.LINEAR,ae.CLAMP_TO_EDGE))):A==="sdf"&&ne.push("SDF_SUBPASS"),Z&&ne.push("HAS_CENTROID"),se.shouldRenderCutoff&&ne.push("RENDER_CUTOFF");let le=h.layout.get("fill-extrusion-edge-radius"),we=(Oe,ue,Re,Be,Qe)=>{let Je=ue.programConfigurations.get(h.id),Ze=f.isTileAffectedByFog(Oe),Ie=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:Je,defines:ne,overrideFog:Ze}),Ve=((ft,_t,kt,bt,it,Ge,Dt,ri,ei,gi,Ii)=>({u_matrix:_t,u_opacity:kt,u_ao_pass:bt?1:0,u_meter_to_tile:it,u_ao:Ge,u_flood_light_intensity:Dt,u_flood_light_color:ri,u_attenuation:ei,u_edge_radius:gi,u_fb:0,u_fb_size:Ii}))(0,Be,L,D,Qe,[z,U*Qe],H,$,Y,fe>=17?0:le*Qe,re?re.size[0]:0),Ye=[];Z&&Ye.push(ue.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(oe,Ie,Oe.toUnwrapped(),null,se),Ie.draw(f,oe.gl.TRIANGLES,v,x,S,k,Ve,h.id,ue.vertexBuffer,ue.indexBuffer,Re,h.paint,fe,Je,Ye)};for(let Oe of g){let ue=r.getTile(Oe),Re=ue.getBucket(h);if(!Re||Re.projection.name!==ge.projection.name||!Re.groundEffect||Re.groundEffect&&!Re.groundEffect.hasData())continue;let Be=Re.groundEffect,Qe=1/Re.tileToMeter;{let Je=f.translatePosMatrix(Oe.projMatrix,ue,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ze=Be.getDefaultSegment();we(Oe,Be,Ze,Je,Qe)}if(Q)for(let Je=0;Je<4;Je++){let Ze=i.bZ[Je](Oe),Ie=r.getTile(Ze);if(!Ie)continue;let Ve=Ie.getBucket(h);if(!Ve||Ve.projection.name!==ge.projection.name||!Ve.groundEffect||Ve.groundEffect&&!Ve.groundEffect.hasData())continue;let Ye=Ve.groundEffect,ft,_t;Je===0?(ft=[-i.a3,0,0],_t=1):Je===1?(ft=[i.a3,0,0],_t=0):Je===2?(ft=[0,-i.a3,0],_t=3):(ft=[0,i.a3,0],_t=2);let kt=Ye.regionSegments[_t];if(!kt)continue;let bt=new Float32Array(16);i.ad.translate(bt,Oe.projMatrix,ft),we(Oe,Ye,kt,f.translatePosMatrix(bt,ue,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Qe)}}}function wu(f,r,h,g,v,x,S){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();let k=x?x.findDEMTileFor(h):null;if(!(k&&k.dem||S))return;let D=Q=>new i.P(Math.ceil((Q+i.c0)*i.c1),0),A=Q=>{let re=r.getSource().minzoom,oe=ge=>{let fe=r.getTileByID(ge);if(fe&&fe.hasData())return fe.getBucket(v)},ae=[0,-1,1];for(let ge of ae){if(Q.overscaledZ+ge<re)continue;let fe=oe(Q.calculateScaledKey(Q.overscaledZ+ge));if(fe)return fe}},L=[0,0,0],z=(Q,re)=>(L[0]=Math.min(Q.min.y,re.min.y),L[1]=Math.max(Q.max.y,re.max.y),L[2]=i.a3-re.min.x>Q.max.x?re.min.x-i.a3:Q.max.x,L),U=(Q,re)=>(L[0]=Math.min(Q.min.x,re.min.x),L[1]=Math.max(Q.max.x,re.max.x),L[2]=i.a3-re.min.y>Q.max.y?re.min.y-i.a3:Q.max.y,L),H=[(Q,re)=>z(Q,re),(Q,re)=>z(re,Q),(Q,re)=>U(Q,re),(Q,re)=>U(re,Q)],$=(Q,re,oe,ae,ge,fe,ne)=>{if(!x)return 0;let se=[[fe?oe:Q,fe?Q:oe,0],[fe?oe:re,fe?re:oe,0]],le=ne<0?i.a3+ne:ne,we=[fe?le:(Q+re)/2,fe?(Q+re)/2:le,0];return oe===0&&ne<0||oe!==0&&ne>0?x.getForTilePoints(ge,[we],!0,ae):se.push(we),x.getForTilePoints(h,se,!0,k),Math.max(se[0][2],se[1][2],we[2])/x.exaggeration()};for(let Q=0;Q<4;Q++){let re=g.borderFeatureIndices[Q];if(re.length===0)continue;let oe=i.bZ[Q](h),ae=A(oe);if(!(ae&&ae instanceof i.b_)||g.borderDoneWithNeighborZ[Q]===ae.canonical.z)continue;ae.centroidVertexArray.length===0&&ae.createCentroidsBuffer();let ge=x?x.findDEMTileFor(oe):null;if(!(ge&&ge.dem||S))continue;let fe=(Q<2?1:5)-Q,ne=ae.borderDoneWithNeighborZ[fe]!==g.canonical.z,se=ae.borderFeatureIndices[fe],le=0;if(g.canonical.z!==ae.canonical.z){for(let we of re)g.showCentroid(g.featuresOnBorder[we]);if(ne)for(let we of se)ae.showCentroid(ae.featuresOnBorder[we]);g.borderDoneWithNeighborZ[Q]=ae.canonical.z,ae.borderDoneWithNeighborZ[fe]=g.canonical.z}for(let we of re){let Oe=g.featuresOnBorder[we],ue=g.centroidData[Oe.centroidDataIndex],Re=Oe.borders[Q],Be;for(;le<se.length;){Be=ae.featuresOnBorder[se[le]];let Qe=Be.borders[fe];if(Qe[1]>Re[0]+3||Qe[0]>Re[0]-3)break;ae.showCentroid(Be),le++}if(Be&&le<se.length){let Qe=le,Je=0;for(;!(Be.borders[fe][0]>Re[1]-3)&&(Je++,++le!==se.length);)Be=ae.featuresOnBorder[se[le]];if(Be=ae.featuresOnBorder[se[Qe]],Je>1){let Ve=Be.borders[fe];Math.abs(Re[0]-Ve[0])<3&&Math.abs(Re[1]-Ve[1])<3&&(Je=1,le=Qe+1)}else if(Je===0){g.showCentroid(Oe);continue}let Ze=ae.centroidData[Be.centroidDataIndex];S&&Je===1&&(((Y=ue).flags|(Z=Ze).flags)&i.b$?(Y.flags|=i.b$,Z.flags|=i.b$):(Y.flags&=~i.b$,Z.flags&=~i.b$));let Ie=Oe.intersectsCount()>1||Be.intersectsCount()>1;if(Je>1)le=Qe,ue.centroidXY=Ze.centroidXY=new i.P(0,0);else if(ge&&ge.dem&&!Ie){let Ve=H[Q](ue,Ze),Ye=Q%2?i.a3-1:0,ft=$(Ve[0],Math.min(i.a3-1,Ve[1]),Ye,ge,oe,Q<2,Ve[2]);ue.centroidXY=Ze.centroidXY=D(ft)}else Ie?ue.centroidXY=Ze.centroidXY=new i.P(0,0):(ue.centroidXY=g.encodeBorderCentroid(Oe),Ze.centroidXY=ae.encodeBorderCentroid(Be));g.writeCentroidToBuffer(ue),ae.writeCentroidToBuffer(Ze)}else g.showCentroid(Oe)}g.borderDoneWithNeighborZ[Q]=ae.canonical.z,ae.borderDoneWithNeighborZ[fe]=g.canonical.z}var Y,Z;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(f)}let ul=[1,0,0],Kg=[0,1,0],Cu=[0,0,1];function Rp(f,r,h){let g=h.transform,v=h.shadowRenderer;if(!v)return!0;let x=f.toUnwrapped(),S=g.tileSize*v._cascades[h.currentShadowCascade].scale,k=r.maxHeight;if(g.elevation){let Y=g.elevation.getMinMaxForTile(f);Y&&(k+=Y.max)}let D=[...v.shadowDirection];D[2]=-D[2];let A=v.computeSimplifiedTileShadowVolume(x,k,S,D);if(!A)return!1;let L=[ul,Kg,Cu,D,[D[0],0,D[2]],[0,D[1],D[2]]],z=g.projection.name==="globe",U=g.scaleZoom(S),H=i.aM.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,U,!z),$=v.getCurrentCascadeFrustum();return H.intersectsPrecise(A.vertices,A.planes,L)===0||$.intersectsPrecise(A.vertices,A.planes,L)===0}function Yd(f){return[f[0]*i.c2,f[1]*i.c2,f[2]*i.c2,0]}function Zd(f,r,h,g,v,x,S,k,D){let A=g.getSource(),L=h.globeSharedBuffers;if(!L)return;let z,U,H;if(r&&(z=g.getTile(r)),A instanceof i.bm?(U=A.texture,H=i.bh(0,0,h.transform)):z&&r&&(U=z.texture,H=i.bh(r.canonical.z,r.canonical.x,h.transform)),!U||!H)return;f||(H=i.ad.scale(i.ad.create(),H,[1,-1,1]));let $=h.context,Y=$.gl,Z=v.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR,Q=h.colorModeForDrapableLayerRenderPass(x),re=S.defines;re.push("GLOBE_POLES");let oe=new i.ae(Y.LEQUAL,i.ae.ReadWrite,h.depthRangeFor3D),ae=Float32Array.from(h.transform.expandedFarZProjMatrix),ge=Float32Array.from(i.bf(i.bg(new i.aO(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),$.activeTexture.set(Y.TEXTURE0),U.bind(Z,Y.CLAMP_TO_EDGE),$.activeTexture.set(Y.TEXTURE1),U.bind(Z,Y.CLAMP_TO_EDGE),U.useMipmap&&$.extTextureFilterAnisotropic&&h.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);let[fe,ne,se,le]=r?L.getPoleBuffers(r.canonical.z,!1):L.getPoleBuffers(0,!0),we=v.paint.get("raster-elevation"),Oe;f?(Oe=fe,h.renderDefaultNorthPole=we!==0):(Oe=ne,h.renderDefaultSouthPole=we!==0);let ue=Yd(S.mix),Re=((Qe,Je,Ze,Ie,Ve,Ye,ft,_t,kt,bt,it,Ge,Dt)=>Hd(Qe,Je,Ze,new Float32Array(16),new Float32Array(9),[0,0],Ie,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ye,[0,0],_t,2,bt,it,Ge,1,0,Dt))(ae,ge,H,i.a1(h.transform.zoom),0,v,0,we,0,ue,S.offset,S.range,x),Be=h.getOrCreateProgram("raster",{defines:re});h.uploadCommonUniforms($,Be,null),Be.draw(h,Y.TRIANGLES,oe,D,Q,k,Re,v.id,Oe,se,le)}function Fi(f){let r=f._nearZ,h=f.projection.farthestPixelDistance(f),g=h-r,v=.2*f.height,x=r+v;return[r,h,(x-v-r)/g,(x-r)/g]}function Ty(f,r,h,g){if(f)return r instanceof pc&&f instanceof i.c3?r.getTextureDescriptor(f,h,!0):{texture:f.texture,mix:Yd(g.mix),offset:g.offset,buffer:0,tileSize:1}}function Wt(f,r,h){if(!f)return null;let g=r.getTextureDescriptor(f,h,!0);if(!g)return null;let{texture:v,mix:x,offset:S,tileSize:k,buffer:D,format:A}=g;if(!v||!A)return null;let L=!1;return A==="uint32"&&(L=!0,x[3]=0,x=Gg(i.c4,x,[0,h.paint.get("raster-particle-max-speed")]),S=Ip(i.c4,S,[0,h.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[D/(k+2*D),k/(k+2*D)],tileSize:k,scalarData:L,scale:x,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[A]]}}function Jg(f){let r=f._nearZ,h=f.projection.farthestPixelDistance(f),g=h-r,v=.2*f.height,x=r+v;return[r,h,(x-v-r)/g,(x-r)/g]}let Su=new i.C(1,0,0,1),Lp=new i.C(0,1,0,1),Ca=new i.C(0,0,1,1),Fp=new i.C(1,0,1,1),xc=new i.C(0,1,1,1);function It(f,r,h,g,v,x,S){let k=f.context,D=f.transform,A=k.gl,L=D.projection.name==="globe",z=L?["PROJECTION_GLOBE_VIEW"]:[],U=i.ad.clone(h.projMatrix);if(L&&i.a1(D.zoom)>0){let ue=i.c5(h.canonical,D),Re=i.c6(ue);U=i.ad.multiply(new Float32Array(16),D.globeMatrix,Re),i.ad.multiply(U,D.projMatrix,U)}let H=i.ad.create();H[12]+=2*v/(i.e.devicePixelRatio*D.width),H[13]+=2*x/(i.e.devicePixelRatio*D.height),i.ad.multiply(U,H,U);let $=f.getOrCreateProgram("debug",{defines:z}),Y=r.getTileByID(h.key);f.terrain&&f.terrain.setupElevationDraw(Y,$);let Z=i.ae.disabled,Q=i.ag.disabled,re=f.colorModeForRenderPass(),oe="$debug";k.activeTexture.set(A.TEXTURE0),f.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),L?Y._makeGlobeTileDebugBuffers(f.context,D):Y._makeDebugTileBoundsBuffers(f.context,D.projection);let ae=Y._tileDebugBuffer||f.debugBuffer,ge=Y._tileDebugIndexBuffer||f.debugIndexBuffer,fe=Y._tileDebugSegments||f.debugSegments;if($.draw(f,A.LINE_STRIP,Z,Q,re,i.af.disabled,bu(U,g),oe,ae,ge,fe,null,null,null,[Y._globeTileDebugBorderBuffer]),S){let ue=Y.latestRawTileData,Re=Math.floor((ue&&ue.byteLength||0)/1024),Be=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Be+=` => ${h.overscaledZ}`),Be+=` ${Y.state}`,Be+=` ${Re}kb`,function(Qe,Je){Qe.initDebugOverlayCanvas();let Ze=Qe.debugOverlayCanvas,Ie=Qe.context.gl,Ve=Qe.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,Ze.width,Ze.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(Je,5,5),Ve.strokeText(Je,5,5),Qe.debugOverlayTexture.update(Ze),Qe.debugOverlayTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}(f,Be)}let ne=r.getTile(h).tileSize,se=512/Math.min(ne,512)*(h.overscaledZ/D.zoom)*.5,le=Y._tileDebugTextBuffer||f.debugBuffer,we=Y._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Oe=Y._tileDebugTextSegments||f.debugSegments;$.draw(f,A.TRIANGLES,Z,Q,i.a.alphaBlended,i.af.disabled,bu(U,i.C.transparent,se),oe,le,we,Oe,null,null,null,[Y._globeTileDebugTextBuffer])}function zi(f,r,h,g){eo(f,0,r+h/2,f.transform.width,h,g)}function Bi(f,r,h,g){eo(f,r-h/2,0,h,f.transform.height,g)}function eo(f,r,h,g,v,x){let S=f.context,k=S.gl;k.enable(k.SCISSOR_TEST),k.scissor(r*i.e.devicePixelRatio,h*i.e.devicePixelRatio,g*i.e.devicePixelRatio,v*i.e.devicePixelRatio),S.clear({color:x}),k.disable(k.SCISSOR_TEST)}let wc=i.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Pi}=wc;function oa(f,r,h,g){f.emplaceBack(r,h,g)}class Cc{constructor(r){this.vertexArray=new i.c8,this.indices=new i.bu,oa(this.vertexArray,-1,-1,1),oa(this.vertexArray,1,-1,1),oa(this.vertexArray,-1,1,1),oa(this.vertexArray,1,1,1),oa(this.vertexArray,-1,-1,-1),oa(this.vertexArray,1,-1,-1),oa(this.vertexArray,-1,1,-1),oa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Pi),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=i.b.simpleSegment(0,0,36,12)}}function Sa(f,r,h,g,v,x){let S=f.context.gl,k=r.paint.get("sky-atmosphere-color"),D=r.paint.get("sky-atmosphere-halo-color"),A=r.paint.get("sky-atmosphere-sun-intensity"),L=((z,U,H,$,Y)=>({u_matrix_3f:z,u_sun_direction:U,u_sun_intensity:H,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(i.bC.fromMat4(i.bC.create(),g),v,A,k,D);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+x,r.skyboxTexture,0),h.draw(f,S.TRIANGLES,i.ae.disabled,i.ag.disabled,i.a.unblended,i.af.frontCW,L,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}let mo=i.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class $n{constructor(r){let h=new i.c9;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);let g=new i.bu;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(h,mo.members),this.indexBuffer=r.createIndexBuffer(g),this.segments=i.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Iy=i.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Xd{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class zp{constructor(r){this.colorModeAlphaBlendedWriteRGB=new i.a([i.ca,i.cb,i.ca,i.cb],i.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new i.a([i.ca,i.cc,i.ca,i.cc],i.C.transparent,[!1,!1,!1,!0]),this.params=new Xd,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){let h=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new $n(h);let g=this.params.sizeRange,v=this.params.intensityRange,x=function(L){let z=i.cf(30),U=[];for(let H=0;H<L;++H){let $=2*Math.PI*z(),Y=Math.acos(1-2*z())-.5*Math.PI;U.push(i._.fromValues(Math.cos(Y)*Math.cos($),Math.cos(Y)*Math.sin($),Math.sin(Y)))}return U}(this.params.starsCount),S=i.cf(300),k=new i.cd,D=new i.bu,A=0;for(let L=0;L<x.length;++L){let z=i._.scale([],x[L],200),U=Math.max(0,1+.01*g*(1*S()-.5)),H=Math.max(0,1+.01*v*(1*S()-.5));k.emplaceBack(z[0],z[1],z[2],-1,-1,U,H),k.emplaceBack(z[0],z[1],z[2],1,-1,U,H),k.emplaceBack(z[0],z[1],z[2],1,1,U,H),k.emplaceBack(z[0],z[1],z[2],-1,1,U,H),D.emplaceBack(A+0,A+1,A+2),D.emplaceBack(A+0,A+2,A+3),A+=4}this.starsVx=h.createVertexBuffer(k,Iy.members),this.starsIdx=h.createIndexBuffer(D),this.starsSegments=i.b.simpleSegment(0,0,k.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,h){let g=r.context,v=g.gl,x=r.transform,S=new i.ae(v.LEQUAL,i.ae.ReadOnly,[0,1]),k=i.a1(x.zoom),D=r.style.getLut(h.scope),A=h.properties.get("color").toRenderColor(D).toArray01(),L=h.properties.get("high-color").toRenderColor(D).toArray01(),z=h.properties.get("space-color").toRenderColor(D).toArray01PremultipliedAlpha(),U=5e-4,H=i.ce(h.properties.get("horizon-blend"),0,1,U,.25),$=i.ba(r,g,x)&&H===U?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,Y=r.frameCounter/1e3%1,Z=i._.length(x.globeCenterInViewSpace),Q=Math.sqrt(Math.pow(Z,2)-Math.pow($,2)),re=Math.acos(Q/Z),oe=ae=>{let ge=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ae&&ge.push("ALPHA_PASS");let fe=r.getOrCreateProgram("globeAtmosphere",{defines:ge}),ne=((le,we,Oe,ue,Re,Be,Qe,Je,Ze,Ie,Ve,Ye)=>({u_frustum_tl:le,u_frustum_tr:we,u_frustum_br:Oe,u_frustum_bl:ue,u_horizon:Re,u_transition:Be,u_fadeout_range:Qe,u_color:Je,u_high_color:Ze,u_space_color:Ie,u_temporal_offset:Ve,u_horizon_angle:Ye}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,k,H,A,L,z,Y,re);r.uploadCommonUniforms(g,fe);let se=this.atmosphereBuffer;se&&fe.draw(r,v.TRIANGLES,S,i.ag.disabled,ae?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,i.af.backCW,ne,ae?"atmosphere_glow_alpha":"atmosphere_glow",se.vertexBuffer,se.indexBuffer,se.segments)};oe(!1),oe(!0)}drawStars(r,h){let g=i.at(h.properties.get("star-intensity"),0,1);if(g===0)return;let v=r.context,x=v.gl,S=r.transform,k=r.getOrCreateProgram("stars"),D=i.av.identity([]);i.av.rotateX(D,D,-S._pitch),i.av.rotateZ(D,D,-S.angle),i.av.rotateX(D,D,i.ab(S._center.lat)),i.av.rotateY(D,D,-i.ab(S._center.lng));let A=i.ad.fromQuat(new Float32Array(16),D),L=i.ad.multiply([],S.starsProjMatrix,A),z=i.bC.fromMat4([],A),U=i.bC.invert([],z),H=[0,1,0];i._.transformMat3(H,H,U),i._.scale(H,H,this.params.sizeMultiplier);let $=[1,0,0];i._.transformMat3($,$,U),i._.scale($,$,this.params.sizeMultiplier);let Y=(Z=H,Q=$,re=g,{u_matrix:Float32Array.from(L),u_up:Z,u_right:Q,u_intensity_multiplier:re});var Z,Q,re;r.uploadCommonUniforms(v,k),this.starsVx&&this.starsIdx&&k.draw(r,x.TRIANGLES,i.ae.disabled,i.ag.disabled,this.colorModeAlphaBlendedWriteRGB,i.af.disabled,Y,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Sc(f,r){let h=[...f],g=r.cameraWorldSizeForFog/r.worldSize,v=i.ad.identity([]);return i.ad.scale(v,v,[g,g,1]),i.ad.multiply(h,v,h),i.ad.multiply(h,r.worldToFogMatrix,h),h}function Qd(f,r,h,g,v){let x=h.material,S=g.context,{baseColorTexture:k,metallicRoughnessTexture:D}=x.pbrMetallicRoughness,{normalTexture:A,occlusionTexture:L,emissionTexture:z}=x;function U(H,$,Y){if(H&&(f.push($),S.activeTexture.set(S.gl.TEXTURE0+Y),H.gfxTexture)){let{minFilter:Z,magFilter:Q,wrapS:re,wrapT:oe}=H.sampler;H.gfxTexture.bindExtraParam(Z,Q,re,oe)}}U(k,"HAS_TEXTURE_u_baseColorTexture",Hr.BaseColor),U(D,"HAS_TEXTURE_u_metallicRoughnessTexture",Hr.MetallicRoughness),U(A,"HAS_TEXTURE_u_normalTexture",Hr.Normal),U(L,"HAS_TEXTURE_u_occlusionTexture",Hr.Occlusion),U(z,"HAS_TEXTURE_u_emissionTexture",Hr.Emission),v&&(v.texture||(v.texture=new i.ch(g.context,v.image,[v.image.height,v.image.height,v.image.height],S.gl.RGBA)),S.activeTexture.set(S.gl.TEXTURE0+Hr.LUT),v.texture&&v.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(h.texcoordBuffer)),h.colorBuffer&&(f.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(h.colorBuffer)),h.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(h.normalBuffer)),h.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(h.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES")}function ml(f,r,h,g,v,x){let S=h.paint.get("model-opacity"),k=r.context,D=new i.ae(r.context.gl.LEQUAL,i.ae.ReadWrite,r.depthRangeFor3D),A=r.transform,L=f.mesh,z=L.material,U=z.pbrMetallicRoughness,H=r.style.fog,$;$=r.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:i.ad.multiply([],g.zScaleMatrix,f.nodeModelMatrix),i.ad.multiply($,g.negCameraPosMatrix,$);let Y=i.ad.invert([],$);i.ad.transpose(Y,Y);let Z=h.paint.get("model-emissive-strength").constantOr(0),Q=qd(new Float32Array(f.worldViewProjection),new Float32Array($),new Float32Array(Y),null,r,S,U.baseColorFactor.toRenderColor(null),z.emissiveFactor,U.metallicFactor,U.roughnessFactor,z,Z,h),re={defines:[]},oe=[];Qd(re.defines,oe,L,r,h.lut);let ae=r.shadowRenderer;ae&&(ae.useNormalOffset=!1);let ge=null;if(H){let se=Sc(f.nodeModelMatrix,r.transform);if(ge=new Float32Array(se),A.projection.name!=="globe"){let le=L.aabb.min,we=L.aabb.max,[Oe,ue]=H.getOpacityForBounds(se,le[0],le[1],we[0],we[1]);re.overrideFog=Oe>=Sn||ue>=Sn}}let fe=Ha(r,h.paint.get("model-cutoff-fade-range"));fe.shouldRenderCutoff&&re.defines.push("RENDER_CUTOFF");let ne=r.getOrCreateProgram("model",re);r.uploadCommonUniforms(k,ne,null,ge,fe),r.renderPass!=="shadow"&&ae&&ae.setupShadowsFromMatrix(f.nodeModelMatrix,ne),ne.draw(r,k.gl.TRIANGLES,D,v,x,L.material.doubleSided?i.af.disabled:i.af.backCCW,Q,h.id,L.vertexBuffer,L.indexBuffer,L.segments,h.paint,r.transform.zoom,void 0,oe)}function Vr(f,r,h,g,v,x,S){let k;k=f.projection.name==="globe"?i.ci(h,f):[...h],i.ad.multiply(k,k,r.matrix);let D=i.ad.multiply([],g,k);if(r.meshes)for(let A of r.meshes){if(A.material.alphaMode!=="BLEND"){S.push({mesh:A,depth:0,modelIndex:v,worldViewProjection:D,nodeModelMatrix:k});continue}let L=i._.transformMat4([],A.centroid,D);L[2]>0&&x.push({mesh:A,depth:L[2],modelIndex:v,worldViewProjection:D,nodeModelMatrix:k})}if(r.children)for(let A of r.children)Vr(f,A,h,g,v,x,S)}function to(f,r,h,g){let v=h.shadowRenderer;if(!v)return;let x=v.getShadowPassDepthMode(),S=v.getShadowPassColorMode(),k=v.calculateShadowPassMatrixFromMatrix(r),D=Yg(k);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,x,i.ag.disabled,S,i.af.backCCW,D,g.id,f.vertexBuffer,f.indexBuffer,f.segments,g.paint,h.transform.zoom,void 0,void 0)}function e_(f,r,h){let g=r.updateZoomBasedPaintProperties(),v=function(x,S,k){let D,A,L,z=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&z>0){let U=x.terrain,H=U.findDEMTileFor(k);H&&H.dem?D=i.ck.create(U,k,H):z=0}if(z===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),z===S.validForExaggeration&&(z===0||D&&D._demTile&&D._demTile.tileID===S.validForDEMTile.id&&D._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(let U in S.instancesPerModel){let H=S.instancesPerModel[U];for(let $=0;$<H.instancedDataArray.length;++$){let Y=(D?z*D.getElevationAt(0|H.instancedDataArray.float32[16*$],0|H.instancedDataArray.float32[16*$+1],!0,!0):0)+H.instancesEvaluatedElevation[$];H.instancedDataArray.float32[16*$+6]=Y,A=A?Math.min(S.terrainElevationMin,Y):Y,L=L?Math.max(S.terrainElevationMax,Y):Y}}return S.terrainElevationMin=A||0,S.terrainElevationMax=L||0,S.validForExaggeration=z,S.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,r,h);(g||v)&&(r.uploaded=!1,r.upload(f.context))}let io={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.b6([0,0,0],[i.a3,i.a3,0])};function ar(f,r){let h=1<<f.canonical.z,g=r.getFreeCameraOptions().position,v=r.elevation,x=f.canonical.x/h,S=(f.canonical.x+1)/h,k=f.canonical.y/h,D=(f.canonical.y+1)/h,A=r._centerAltitude;if(v){let H=v.getMinMaxForTile(f);H&&H.max>A&&(A=H.max)}let L=i.at(g.x,x,S)-g.x,z=i.at(g.y,k,D)-g.y,U=i.ax(A,r.center.lat)-g.z;return r._zoomFromMercatorZ(Math.sqrt(L*L+z*z+U*U))}function Bo(f,r,h,g,v,x,S){let k=f.context,D=f.renderPass==="shadow",A=f.shadowRenderer,L=D&&A?A.getShadowPassDepthMode():new i.ae(k.gl.LEQUAL,i.ae.ReadWrite,f.depthRangeFor3D),z=f.isTileAffectedByFog(x);if(h.meshes)for(let U of h.meshes){let H=["MODEL_POSITION_ON_GPU"],$=[],Y,Z,Q;g.instancedDataArray.length>20&&H.push("INSTANCED_ARRAYS");let re=Ha(f,r.paint.get("model-cutoff-fade-range"));if(re.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),D&&A)Y=f.getOrCreateProgram("modelDepth",{defines:H}),Z=Yg(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(h.matrix)),Q=A.getShadowPassColorMode();else{Qd(H,$,U,f,r.lut),Y=f.getOrCreateProgram("model",{defines:H,overrideFog:z});let ae=U.material,ge=ae.pbrMetallicRoughness,fe=r.paint.get("model-opacity"),ne=r.paint.get("model-emissive-strength").constantOr(0);Z=qd(x.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,f,fe,ge.baseColorFactor.toRenderColor(null),ae.emissiveFactor,ge.metallicFactor,ge.roughnessFactor,ae,ne,r,v),A&&(S.shadowUniformsInitialized?Y.setShadowUniformValues(k,A.getShadowUniformValues()):(A.setupShadows(x.toUnwrapped(),Y,"model-tile",x.overscaledZ),S.shadowUniformsInitialized=!0)),Q=re.shouldRenderCutoff||fe<1||ae.alphaMode!=="OPAQUE"?i.a.alphaBlended:i.a.unblended}f.uploadCommonUniforms(k,Y,x.toUnwrapped(),null,re);let oe=U.material.doubleSided?i.af.disabled:i.af.backCCW;if(g.instancedDataArray.length>20)$.push(g.instancedDataBuffer),Y.draw(f,k.gl.TRIANGLES,L,i.ag.disabled,Q,oe,Z,r.id,U.vertexBuffer,U.indexBuffer,U.segments,r.paint,f.transform.zoom,void 0,$,g.instancedDataArray.length);else{let ae=D?"u_instance":"u_normal_matrix";for(let ge=0;ge<g.instancedDataArray.length;++ge)Z[ae]=new Float32Array(g.instancedDataArray.arrayBuffer,64*ge,16),Y.draw(f,k.gl.TRIANGLES,L,i.ag.disabled,Q,oe,Z,r.id,U.vertexBuffer,U.indexBuffer,U.segments,r.paint,f.transform.zoom,void 0,$)}}if(h.children)for(let U of h.children)Bo(f,r,U,g,v,x,S)}let qa=[1,-1,1];function pr(f,r,h,g){if(!h.modelManager)return!0;let v=h.modelManager;if(!h.shadowRenderer)return!0;let x=h.shadowRenderer,S=r.aabb,k=!0,D=f.maxHeight;if(D===0){let L=0;for(let z in f.instancesPerModel){let U=v.getModel(z,g);U?L=Math.max(L,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):k=!1}D=f.maxScale*L*1.41+f.maxVerticalOffset,k&&(f.maxHeight=D)}S.max[2]=D,S.min[2]+=f.terrainElevationMin,S.max[2]+=f.terrainElevationMax,i._.transformMat4(S.min,S.min,r.tileMatrix),i._.transformMat4(S.max,S.max,r.tileMatrix);let A=S.intersects(x.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=A===2),A===0}function Bp(f,r){let h=f.uniformValues.u_cutoff_params[0],g=f.uniformValues.u_cutoff_params[1],v=f.uniformValues.u_cutoff_params[2],x=f.uniformValues.u_cutoff_params[3];return g===h||x===v?1:i.at(((r-h)/(g-h)-v)/(x-v),0,1)}function aa(f,r,h,g){if(r.pitch<20)return 1;let v=r.getWorldToCameraMatrix(),x=i.ad.multiply([],v,f),S=[...h.min,1],k=i.aA.transformMat4([],S,x),D=k,A=k;S[1]=h.max[1],k=i.aA.transformMat4([],S,x),D=k[1]<D[1]?k:D,A=k[1]>A[1]?k:A,S[0]=h.max[0],k=i.aA.transformMat4([],S,x),D=k[1]<D[1]?k:D,A=k[1]>A[1]?k:A,S[1]=h.min[1],k=i.aA.transformMat4([],S,x),D=k[1]<D[1]?k:D,A=k[1]>A[1]?k:A;let L=i.at(g[0],0,1),z=100*r.pixelsPerMeter*i.at(g[1],0,1),U=i.at(g[2],0,1),H=i._.lerp([],D,A,L),$=Math.tan(.5*r.fovX),Y=-H[2]*$;if(z===0)return H[1]<-Math.abs(Y)?U:1;let Z=(-Math.abs(Y)-H[1])/z,Q=(oe,ae,ge)=>(1-ge)*oe+ge*ae,re=i.at(Q(1,U,Z),U,1);return Q(1,re,i.at((r.pitch-20)/20,0,1))}class Kd{}class Jd{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,h,g){{let z=this._storage.get(h.id);if(z)return z.lastUsedFrameIdx=r,z.buf}let v=g.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),S=new ArrayBuffer(x),k=new Int16Array(S);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));let D=new i.cm;for(let z=0;z<x/2;z+=3){let U=k[z],H=k[z+1],$=k[z+2];D.emplaceBack(U,H),D.emplaceBack(H,$),D.emplaceBack($,U)}let A=g.bindVertexArrayOES.current,L=new Kd;return L.buf=new i.I(g,D),L.lastUsedFrameIdx=r,this._storage.set(h.id,L),g.bindVertexArrayOES.set(A),L.buf}update(r){for(let[h,g]of this._storage)r-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(h))}destroy(){for(let[r,h]of this._storage)h.buf.destroy(),this._storage.delete(r)}}let pl=i.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class Ey{constructor(r){let h=new i.cn,g=new i.bu;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1),g.emplaceBack(0,1,2),g.emplaceBack(0,2,3),this.segments=i.b.simpleSegment(0,0,h.length,g.length),this.vx=r.createVertexBuffer(h,pl.members),this.idx=r.createIndexBuffer(g)}destroy(){this.vx.destroy(),this.idx.destroy()}}let sa={symbol:function(f,r,h,g,v){if(f.renderPass!=="translucent")return;let x=i.ag.disabled,S=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,L,z,U,H,$,Y){let Z=L.transform,Q=H==="map",re=$==="map";for(let oe of A){let ae=U.getTile(oe),ge=ae.getBucket(z);if(!ge||!ge.text||!ge.text.segments.get().length)continue;let fe=i.aD(ge.textSizeData,Z.zoom),ne=bc(oe,ge.getProjection(),Z),se=Z.calculatePixelsToTileUnitsMatrix(ae),le=al(ne,ae.tileID.canonical,re,Q,Z,ge.getProjection(),se),we=ge.hasIconTextFit()&&ge.hasIconData();if(fe){let Oe=Math.pow(2,Z.zoom-ae.tileID.overscaledZ);Qg(ge,Q,re,Y,i.bO,Z,le,oe,Oe,fe,we)}}}(g,f,h,r,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v);let k=h.paint.get("icon-opacity").constantOr(1)!==0,D=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||D)?Pp(f,r,h,g,x,S):(k&&Pp(f,r,h,g,x,S,{onlyIcons:!0}),D&&Pp(f,r,h,g,x,S,{onlyText:!0}),function(A,L,z,U){if(!A.symbolParams.useOcclusionQueries)return;let H=A.context.gl,$=A.transform,Y=z.paint,Z=Y.get("icon-occlusion-opacity").constantOr(0),Q=Y.get("text-occlusion-opacity").constantOr(0);if(!z.hasInitialOcclusionOpacityProperties||Z===1&&Q===1)return;let re=$.projection.name==="globe";for(let oe of U){let ae=L.getTile(oe),ge=ae.getBucket(z);if(!ge||ge.projection.name==="mercator"&&re||ge.fullyClipped)continue;if(ge.projection.name==="globe"){i.w(`Occlusion not supported for globe mode. Layer: ${z.type}`);continue}let fe=bc(oe,ge.getProjection(),$),ne=i.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,A.symbolParams.depthOffset,1),se=i.ad.multiply([],ne,fe),le=A.symbolParams.visualizeOcclusions!=="none"?1:A.symbolParams.occlusionQueryFrameWindow;for(let we=0;we<ge.symbolInstances.length;we++){let Oe=ge.symbolInstances.get(we),ue=A.style.placement.opacities[Oe.crossTileID];if(ue&&ue.isHidden()||(A.frameCounter+we)%le!=0)continue;let Re=Oe.tileAnchorX,Be=Oe.tileAnchorY,Qe=Oe.zOffset,Je;if(A.symbolParams.visualizeOcclusions==="none"){let ft=ge.queries.get(we);if(ft){if(!ft.isFree()){if(!ft.isResultAvailable())continue;let _t=ft.consumeResult();Oe.occlusionState=_t===0?0:1;continue}Je=ft}else Je=new ec(A.context),ge.queries.set(we,Je)}let Ze=A.getOrCreateProgram("occlusion"),Ie=A.symbolParams.occluderSize,Ve=Zg(se,[Re,Be,Qe],[$.width,$.height],[Ie,Ie],A.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);A.terrain&&A.terrain.setupElevationDraw(ae,Ze,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),A.symbolParams.visualizeOcclusions==="none"&&Je&&Je.begin();let Ye=new i.ae(A.symbolParams.visualizeOcclusions==="zPass"?A.context.gl.ALWAYS:A.context.gl.LEQUAL,i.ae.ReadOnly,A.depthRangeFor3D);Ze.draw(A,H.TRIANGLES,Ye,i.ag.disabled,A.symbolParams.visualizeOcclusions!=="none"?i.a.alphaBlendedNonPremultiplied:i.a.disabled,i.af.disabled,Ve,"occlusion",A.occlusionBuffers.vx,A.occlusionBuffers.idx,A.occlusionBuffers.segments),A.symbolParams.visualizeOcclusions==="none"&&Je&&Je.end()}}}(f,r,h,g)),r.map.showCollisionBoxes&&($d(f,r,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),$d(f,r,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(f,r,h,g){if(f.renderPass!=="translucent")return;let v=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),S=h.paint.get("circle-stroke-opacity"),k=h.layout.get("circle-sort-key").constantOr(1)!==void 0,D=h.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||S.constantOr(1)===0))return;let A=f.context,L=A.gl,z=f.transform,U=f.depthModeForSublayer(0,i.ae.ReadOnly),H=i.ag.disabled,$=f.colorModeForDrapableLayerRenderPass(D),Y=z.projection.name==="globe",Z=[i.aj(z.center.lng),i.ak(z.center.lat)],Q=[];for(let oe=0;oe<g.length;oe++){let ae=g[oe],ge=r.getTile(ae),fe=ge.getBucket(h);if(!fe||fe.projection.name!==z.projection.name)continue;let ne=fe.programConfigurations.get(h.id),se=i.bR(h),le=f.isTileAffectedByFog(ae);Y&&se.push("PROJECTION_GLOBE_VIEW");let we=f.getOrCreateProgram("circle",{config:ne,defines:se,overrideFog:le}),Oe=fe.layoutVertexBuffer,ue=fe.globeExtVertexBuffer,Re=fe.indexBuffer,Be=z.projection.createInversionMatrix(z,ae.canonical),Qe={programConfiguration:ne,program:we,layoutVertexBuffer:Oe,globeExtVertexBuffer:ue,indexBuffer:Re,uniformValues:i.bS(f,ae,ge,Be,Z,h),tile:ge};if(k){let Je=fe.segments.get();for(let Ze of Je)Q.push({segments:new i.b([Ze]),sortKey:Ze.sortKey,state:Qe})}else Q.push({segments:fe.segments,sortKey:0,state:Qe})}k&&Q.sort((oe,ae)=>oe.sortKey-ae.sortKey);let re={useDepthForOcclusion:z.depthOcclusionForSymbolsAndCircles};for(let oe of Q){let{programConfiguration:ae,program:ge,layoutVertexBuffer:fe,globeExtVertexBuffer:ne,indexBuffer:se,uniformValues:le,tile:we}=oe.state,Oe=oe.segments;f.terrain&&f.terrain.setupElevationDraw(we,ge,re),f.uploadCommonUniforms(A,ge,we.tileID.toUnwrapped()),ge.draw(f,L.TRIANGLES,U,H,$,i.af.disabled,le,h.id,fe,se,Oe,h.paint,z.zoom,ae,[ne])}},heatmap:function(f,r,h,g){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){let v=f.context,x=v.gl,S=i.ag.disabled,k=new i.a([x.ONE,x.ONE,x.ONE,x.ONE],i.C.transparent,[!0,!0,!0,!0]);(function(H,$,Y,Z){let Q=H.gl,re=$.width*Z,oe=$.height*Z;H.activeTexture.set(Q.TEXTURE1),H.viewport.set([0,0,re,oe]);let ae=Y.heatmapFbo;if(!ae||ae&&(ae.width!==re||ae.height!==oe)){ae&&ae.destroy();let ge=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,ge),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),ae=Y.heatmapFbo=H.createFramebuffer(re,oe,!0,null),function(fe,ne,se,le,we,Oe){let ue=fe.gl;ue.texImage2D(ue.TEXTURE_2D,0,fe.extRenderToTextureHalfFloat?ue.RGBA16F:ue.RGBA,we,Oe,0,ue.RGBA,fe.extRenderToTextureHalfFloat?ue.HALF_FLOAT:ue.UNSIGNED_BYTE,null),le.colorAttachment.set(se)}(H,0,ge,ae,re,oe)}else Q.bindTexture(Q.TEXTURE_2D,ae.colorAttachment.get()),H.bindFramebuffer.set(ae.framebuffer)})(v,f,h,f.transform.projection.name==="globe"?.5:.25),v.clear({color:i.C.transparent});let D=f.transform,A=D.projection.name==="globe",L=A?["PROJECTION_GLOBE_VIEW"]:[],z=A?i.af.frontCCW:i.af.disabled,U=[i.aj(D.center.lng),i.ak(D.center.lat)];for(let H=0;H<g.length;H++){let $=g[H];if(r.hasRenderableParent($))continue;let Y=r.getTile($),Z=Y.getBucket(h);if(!Z||Z.projection.name!==D.projection.name)continue;let Q=f.isTileAffectedByFog($),re=Z.programConfigurations.get(h.id),oe=f.getOrCreateProgram("heatmap",{config:re,defines:L,overrideFog:Q}),{zoom:ae}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Y,oe),f.uploadCommonUniforms(v,oe,$.toUnwrapped());let ge=D.projection.createInversionMatrix(D,$.canonical);oe.draw(f,x.TRIANGLES,i.ae.disabled,S,k,z,dl(f,$,Y,ge,U,ae,h.paint.get("heatmap-intensity")),h.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,h.paint,f.transform.zoom,re,A?[Z.globeExtVertexBuffer]:null)}v.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,x){let S=v.context,k=S.gl,D=x.heatmapFbo;if(!D)return;S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,D.colorAttachment.get()),S.activeTexture.set(k.TEXTURE1);let A=x.colorRampTexture;A||(A=x.colorRampTexture=new i.T(S,x.colorRamp,k.RGBA)),A.bind(k.LINEAR,k.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,k.TRIANGLES,i.ae.disabled,i.ag.disabled,v.colorModeForRenderPass(),i.af.disabled,((L,z,U,H)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(f,h))},line:function(f,r,h,g){if(f.renderPass!=="translucent")return;let v=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;let S=h.paint.get("line-emissive-strength"),k=h.paint.get("line-occlusion-opacity"),D=f.context,A=D.gl,L=h.layout.get("line-z-offset"),z=!L.isConstant()||!!L.constantOr(0),U=z?new i.ae(f.depthOcclusion?A.GREATER:A.LEQUAL,i.ae.ReadOnly,f.depthRangeFor3D):f.depthModeForSublayer(0,i.ae.ReadOnly),H=f.colorModeForDrapableLayerRenderPass(S),$=f.terrain&&f.terrain.renderingToTexture,Y=$?1:i.e.devicePixelRatio,Z=h.paint.get("line-dasharray"),Q=Z.constantOr(1),re=h.layout.get("line-cap"),oe=Z.constantOr(null),ae=re.constantOr(null),ge=h.paint.get("line-pattern"),fe=ge.constantOr(1),ne=ge.constantOr(null),se=h.paint.get("line-opacity").constantOr(1),le=!fe&&se!==1||f.depthOcclusion&&k>0&&k<1,we=h.paint.get("line-gradient"),Oe=fe?"linePattern":"line",ue=i.bT(h),Re;if($&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(le=!1),k!==0&&f.depthOcclusion){let Qe=h.paint._values["line-opacity"];Qe&&Qe.value&&Qe.value.kind==="constant"?Re=Qe.value:i.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}if(z&&(f.forceTerrainMode=!0),!z&&k!==0&&f.terrain&&!$)return void i.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let Be=le&&z?f.stencilModeFor3D():i.ag.disabled;for(let Qe of g){let Je=r.getTile(Qe);if(fe&&!Je.patternsLoaded())continue;let Ze=Je.getBucket(h);if(!Ze)continue;f.prepareDrawTile();let Ie=Ze.programConfigurations.get(h.id),Ve=f.isTileAffectedByFog(Qe),Ye=f.getOrCreateProgram(Oe,{config:Ie,defines:z?[...ue,"ELEVATED"]:ue,overrideFog:Ve});if(ne&&Je.imageAtlas){let Ge=Je.imageAtlas.patternPositions[ne.toString()];Ge&&Ie.setConstantPatternPositions(Ge)}if(!fe&&oe&&ae&&Je.lineAtlas){let Ge=Je.lineAtlas.getDash(oe,ae);Ge&&Ie.setConstantPatternPositions(Ge)}let[ft,_t]=h.paint.get("line-trim-offset");(ae==="round"||ae==="square")&&ft!==_t&&(ft===0&&(ft-=1),_t===1&&(_t+=1));let kt=$?Qe.projMatrix:null,bt=fe?i.bU(f,Je,h,kt,Y,[ft,_t]):i.bV(f,Je,h,kt,Ze.lineClipsArray.length,Y,[ft,_t]);if(we){let Ge=Ze.gradients[h.id],Dt=Ge.texture;if(h.gradientVersion!==Ge.version){let ri=256;if(h.stepInterpolant){let ei=r.getSource().maxzoom,gi=Qe.canonical.z===ei?Math.ceil(1<<f.transform.maxZoom-Qe.canonical.z):1;ri=i.at(i.bW(Ze.maxLineLength/i.a3*1024*gi),256,D.maxTextureSize)}Ge.gradient=i.bX({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:ri,image:Ge.gradient||void 0,clips:Ze.lineClipsArray}),Ge.texture?Ge.texture.update(Ge.gradient):Ge.texture=new i.T(D,Ge.gradient,A.RGBA),Ge.version=h.gradientVersion,Dt=Ge.texture}D.activeTexture.set(A.TEXTURE1),Dt.bind(h.stepInterpolant?A.NEAREST:A.LINEAR,A.CLAMP_TO_EDGE)}Q&&(D.activeTexture.set(A.TEXTURE0),Je.lineAtlasTexture&&Je.lineAtlasTexture.bind(A.LINEAR,A.REPEAT),Ie.updatePaintBuffers()),fe&&(D.activeTexture.set(A.TEXTURE0),Je.imageAtlasTexture&&Je.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Ie.updatePaintBuffers()),z&&f.terrain.setupElevationDraw(Je,Ye),f.uploadCommonUniforms(D,Ye,Qe.toUnwrapped());let it=Ge=>{Re!=null&&(Re.value=se*k),Ye.draw(f,A.TRIANGLES,U,Ge,H,i.af.disabled,bt,h.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,h.paint,f.transform.zoom,Ie,[Ze.layoutVertexBuffer2,Ze.patternVertexBuffer,Ze.zOffsetVertexBuffer]),Re!=null&&(Re.value=se)};if(le&&!z){let Ge=f.stencilModeForClipping(Qe).ref;Ge===0&&$&&D.clear({stencil:0});let Dt={func:A.EQUAL,mask:255};bt.u_alpha_discard_threshold=.8,it(new i.ag(Dt,Ge,255,A.KEEP,A.KEEP,A.INVERT)),bt.u_alpha_discard_threshold=0,it(new i.ag(Dt,Ge,255,A.KEEP,A.KEEP,A.KEEP))}else le&&z&&(bt.u_alpha_discard_threshold=.001),it(z?Be:f.stencilModeForClipping(Qe))}le&&(f.resetStencilClippingMasks(),$&&D.clear({stencil:0})),k===0||f.depthOcclusion||$||f.layersWithOcclusionOpacity.push(f.currentLayer),z&&(f.forceTerrainMode=!1)},fill:function(f,r,h,g){let v=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;let S=h.paint.get("fill-emissive-strength"),k=f.colorModeForDrapableLayerRenderPass(S),D=h.paint.get("fill-pattern"),A=f.opaquePassEnabledForLayer()&&!D.constantOr(1)&&v.constantOr(i.C.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===A){let L=f.depthModeForSublayer(1,f.renderPass==="opaque"?i.ae.ReadWrite:i.ae.ReadOnly);Op(f,r,h,g,L,k,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){let L=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,i.ae.ReadOnly);Op(f,r,h,g,L,k,!0)}},"fill-extrusion":function(f,r,h,g){let v=h.paint.get("fill-extrusion-opacity"),x=f.context,S=x.gl,k=f.terrain,D=k&&k.renderingToTexture;if(v===0)return;let A=f.conflationActive&&f.style.isLayerClipped(h,r.getSource()),L=f.style.order.indexOf(h.fqid);if(A&&function(z,U,H,$,Y){for(let Z of $){let Q=U.getTile(Z).getBucket(H);Q&&(Q.updateReplacement(Z,z.replacementSource,Y),Q.uploadCentroid(z.context))}}(f,r,h,g,L),k||A)for(let z of g){let U=r.getTile(z).getBucket(h);U&&wu(f.context,r,z,U,h,k,A)}if(f.renderPass==="shadow"&&f.shadowRenderer){let z=f.shadowRenderer;if(k&&v<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.Z)return;let U=z.getShadowPassDepthMode(),H=z.getShadowPassColorMode();vc(f,r,h,g,U,i.ag.disabled,H,A)}else if(f.renderPass==="translucent"){let z=!h.paint.get("fill-extrusion-pattern").constantOr(1),U=h.paint.get("fill-extrusion-color").constantOr(i.C.white);if(!D&&U.a!==0){let H=new i.ae(f.context.gl.LEQUAL,i.ae.ReadWrite,f.depthRangeFor3D);v===1&&z?vc(f,r,h,g,H,i.ag.disabled,i.a.unblended,A):(vc(f,r,h,g,H,i.ag.disabled,i.a.disabled,A),vc(f,r,h,g,H,f.stencilModeFor3D(),f.colorModeForRenderPass(),A),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&z&&(!k&&f.transform.projection.name!=="globe"||D)){let H=h.paint.get("fill-extrusion-opacity"),$=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Z=h.paint.get("fill-extrusion-flood-light-intensity"),Q=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),re=$>0&&Y>0,oe=Z>0,ae=(fe,ne,se)=>(1-se)*fe+se*ne,ge=fe=>{let ne=f.depthModeForSublayer(1,i.ae.ReadOnly,S.LEQUAL,!0),se=h.paint.get(fe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),le=ae(.1,3,se),we=f._showOverdrawInspector;if(!we){let Oe=new i.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),ue=new i.a([S.ONE,S.ONE,S.ONE,S.ONE],i.C.transparent,[!1,!1,!1,!0],S.MIN);Jr(f,r,h,g,ne,Oe,ue,i.af.disabled,fe,"sdf",H,$,Y,Z,Q,le,A,!1)}{let Oe=we?i.ag.disabled:new i.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),ue=we?f.colorModeForRenderPass():new i.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],i.C.transparent,[!0,!0,!0,!0]);Jr(f,r,h,g,ne,Oe,ue,i.af.disabled,fe,"color",H,$,Y,Z,Q,le,A,!1)}};if(D){let fe=(ne,se,le)=>{let we=f.depthModeForSublayer(1,i.ae.ReadOnly,S.LEQUAL,!1),Oe=h.paint.get(ne?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ue=ae(.1,3,Oe);{let Re=new i.a([S.ONE,S.ONE,S.ONE,S.ONE],i.C.transparent,[!1,!1,!1,!0]);Jr(f,r,h,g,we,i.ag.disabled,Re,i.af.disabled,ne,"clear",H,$,Y,Z,Q,ue,A,se)}{let Re=new i.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Be=new i.a([S.ONE,S.ONE,S.ONE,S.ONE],i.C.transparent,[!1,!1,!1,!0],S.MIN);Jr(f,r,h,g,we,Re,Be,i.af.disabled,ne,"sdf",H,$,Y,Z,Q,ue,A,se)}{let Re=ne?S.ZERO:S.ONE_MINUS_DST_ALPHA,Be=new i.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Qe=new i.a([Re,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],i.C.transparent,[!0,!0,!0,!0]);Jr(f,r,h,g,we,Be,Qe,i.af.disabled,ne,"color",H,$,Y,Z,Q,ue,A,se)}{let Re=new i.a([S.ONE,S.ONE,S.ONE,ne?S.ZERO:S.ONE],i.C.transparent,[!1,!1,!1,!0],ne?S.FUNC_ADD:S.MAX);Jr(f,r,h,g,we,i.ag.disabled,Re,i.af.disabled,ne,"clear",H,$,Y,Z,Q,ue,A,se,le)}};if(re||oe){let ne;if(f.prepareDrawTile(),k){let se=k.drapeBufferSize[0],le=k.drapeBufferSize[1];ne=k.framebufferCopyTexture,ne&&(!ne||ne.size[0]===se&&ne.size[1]===le)||(ne&&ne.destroy(),ne=k.framebufferCopyTexture=new i.T(x,new i.i({width:se,height:le}),S.RGBA)),ne.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,se,le,0)}re&&fe(!0,!1,ne),oe&&fe(!1,!0,ne)}}else re&&ge(!0),oe&&ge(!1)}}},hillshade:function(f,r,h,g){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;let v=f.context,x=f.terrain&&f.terrain.renderingToTexture,[S,k]=f.renderPass!=="translucent"||x?[{},g]:f.stencilConfigForOverlap(g);for(let D of k){let A=r.getTile(D);if(A.needsHillshadePrepare&&f.renderPass==="offscreen")va(f,A,h);else if(f.renderPass==="translucent"){let L=f.depthModeForSublayer(0,i.ae.ReadOnly),z=h.paint.get("hillshade-emissive-strength"),U=f.colorModeForDrapableLayerRenderPass(z),H=x&&f.terrain?f.terrain.stencilModeForRTTOverlap(D):S[D.overscaledZ];xy(f,D,A,h,L,H,U)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,r,h,g,v,x){if(f.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;let S=f.transform.projection.name==="globe",k=h.paint.get("raster-elevation")!==0,D=k&&S;if(f.renderElevatedRasterBackface&&!D)return;let A=f.context,L=A.gl,z=r.getSource(),U=function(fe,ne,se,le){let we=ne.paint.get("raster-color"),Oe=fe.type==="raster-array",ue=[],Re=ne.paint.get("raster-resampling"),Be=ne.paint.get("raster-color-mix"),Qe=ne.paint.get("raster-color-range"),Je=[Be[0],Be[1],Be[2],0],Ze=Be[3],Ie=Re==="nearest"?le.NEAREST:le.LINEAR;if(Oe&&(ue.push("RASTER_ARRAY"),we||ue.push("RASTER_COLOR"),Re==="linear"&&ue.push("RASTER_ARRAY_LINEAR"),Ie=le.NEAREST,!Qe&&fe.rasterLayers)){let Ve=fe.rasterLayers.find(({id:Ye})=>Ye===ne.sourceLayer);Ve&&Ve.fields&&Ve.fields.range&&(Qe=Ve.fields.range)}if(Qe=Qe||[0,1],we){ue.push("RASTER_COLOR"),se.activeTexture.set(le.TEXTURE2),ne.updateColorRamp(Qe);let Ve=ne.colorRampTexture;Ve||(Ve=ne.colorRampTexture=new i.T(se,ne.colorRamp,le.RGBA)),Ve.bind(le.LINEAR,le.CLAMP_TO_EDGE)}return{mix:Je,range:Qe,offset:Ze,defines:ue,resampling:Ie}}(z,h,A,L);if(z instanceof i.bm&&!g.length&&!S)return;let H=h.paint.get("raster-emissive-strength"),$=f.colorModeForDrapableLayerRenderPass(H),Y=f.terrain&&f.terrain.renderingToTexture,Z=!f.options.moving,Q=h.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(z instanceof i.bm&&!g.length&&(z.onNorthPole||z.onSouthPole)){let fe=k?f.stencilModeFor3D():i.ag.disabled;return void Zd(!!z.onNorthPole,null,f,r,h,H,U,i.af.disabled,fe)}if(!g.length)return;let[re,oe]=z instanceof i.bm||Y?[{},g]:f.stencilConfigForOverlap(g),ae=oe[oe.length-1].overscaledZ;D&&U.defines.push("PROJECTION_GLOBE_VIEW"),k&&U.defines.push("RENDER_CUTOFF");let ge=(fe,ne,se)=>{for(let le of fe){let we=le.toUnwrapped(),Oe=r.getTile(le);if(Y&&(!Oe||!Oe.hasData()))continue;A.activeTexture.set(L.TEXTURE0);let ue=Ty(Oe,z,h,U);if(!ue||!ue.texture)continue;let{texture:Re,mix:Be,offset:Qe,tileSize:Je,buffer:Ze}=ue,Ie,Ve;Y?(Ie=i.ae.disabled,Ve=le.projMatrix):k?(Ie=new i.ae(L.LEQUAL,i.ae.ReadWrite,f.depthRangeFor3D),Ve=S?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(we,Z)):(Ie=f.depthModeForSublayer(le.overscaledZ-ae,h.paint.get("raster-opacity")===1?i.ae.ReadWrite:i.ae.ReadOnly,L.LESS),Ve=f.transform.calculateProjMatrix(we,Z));let Ye=f.terrain&&Y?f.terrain.stencilModeForRTTOverlap(le):re[le.overscaledZ],ft=x?0:h.paint.get("raster-fade-duration");Oe.registerFadeDuration(ft);let _t=r.findLoadedParent(le,0),kt=uu(Oe,_t,r,f.transform,ft),bt,it;f.terrain&&f.terrain.prepareDrawTile(),A.activeTexture.set(L.TEXTURE0),Re.bind(Q,L.CLAMP_TO_EDGE),A.activeTexture.set(L.TEXTURE1),_t?(_t.texture&&_t.texture.bind(Q,L.CLAMP_TO_EDGE),bt=Math.pow(2,_t.tileID.overscaledZ-Oe.tileID.overscaledZ),it=[Oe.tileID.canonical.x*bt%1,Oe.tileID.canonical.y*bt%1]):Re.bind(Q,L.CLAMP_TO_EDGE),Re.useMipmap&&A.extTextureFilterAnisotropic&&f.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);let Ge=f.transform,Dt,ri=k?Fi(Ge):[0,0,0,0],ei,gi,Ii,Ji,Qt,Hi=0;if(D&&z instanceof i.bm&&z.coordinates.length>3)ei=Float32Array.from(i.bf(i.bg(new i.aO(0,0,0)))),gi=Float32Array.from(Ge.globeMatrix),Ii=Float32Array.from(i.bb(Ge)),Ji=[i.aj(Ge.center.lng),i.ak(Ge.center.lat)],Dt=z.elevatedGlobePerspectiveTransform,Qt=z.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){let ti=i.bc(le.canonical);Hi=i.bd(ti.getCenter().lat),ei=Float32Array.from(i.bf(i.bg(le.canonical))),gi=Float32Array.from(Ge.globeMatrix),Ii=Float32Array.from(i.bb(Ge)),Ji=[i.aj(Ge.center.lng),i.ak(Ge.center.lat)],Dt=[0,0],Qt=Float32Array.from(i.be(le.canonical,ti,Hi,Ge.worldSize/Ge._pixelsPerMercatorPixel))}else Dt=z instanceof i.bm?z.perspectiveTransform:[0,0],ei=new Float32Array(16),gi=new Float32Array(9),Ii=new Float32Array(16),Ji=[0,0],Qt=new Float32Array(9);let dn=Hd(Ve,ei,gi,Ii,Qt,it||[0,0],i.a1(f.transform.zoom),Ji,ri,bt||1,kt,h,Dt,k?h.paint.get("raster-elevation"):0,2,Be,Qe,U.range,Je,Ze,H),Xi=f.isTileAffectedByFog(le),yi=f.getOrCreateProgram("raster",{defines:U.defines,overrideFog:Xi});if(f.uploadCommonUniforms(A,yi,we),z instanceof i.bm){let ti=z.elevatedGlobeVertexBuffer,fn=z.elevatedGlobeIndexBuffer;if(Y||!S)z.boundsBuffer&&z.boundsSegments&&yi.draw(f,L.TRIANGLES,Ie,i.ag.disabled,$,i.af.disabled,dn,h.id,z.boundsBuffer,f.quadTriangleIndexBuffer,z.boundsSegments);else if(ti&&fn){let yn=Ge.zoom<=i.b1?z.elevatedGlobeSegments:z.getSegmentsForLongitude(Ge.center.lng);yn&&yi.draw(f,L.TRIANGLES,Ie,i.ag.disabled,$,ne,dn,h.id,ti,fn,yn)}}else if(D){Ie=new i.ae(L.LEQUAL,i.ae.ReadOnly,f.depthRangeFor3D);let ti=f.globeSharedBuffers;if(ti){let[fn,yn,tn]=ti.getGridBuffers(Hi,!1);yi.draw(f,L.TRIANGLES,Ie,se||Ye,f.colorModeForRenderPass(),ne,dn,h.id,fn,yn,tn)}}else{let{tileBoundsBuffer:ti,tileBoundsIndexBuffer:fn,tileBoundsSegments:yn}=f.getTileBoundsBuffers(Oe);yi.draw(f,L.TRIANGLES,Ie,Ye,$,i.af.disabled,dn,h.id,ti,fn,yn)}}if(!(z instanceof i.bm)&&D)for(let le of fe){let we=le.canonical.y===(1<<le.canonical.z)-1;le.canonical.y===0&&Zd(!0,le,f,r,h,H,U,ne,se||i.ag.disabled),we&&Zd(!1,le,f,r,h,H,U,ne===i.af.frontCW?i.af.backCW:i.af.frontCW,se||i.ag.disabled)}};D?ge(oe,f.renderElevatedRasterBackface?i.af.backCW:i.af.frontCW,f.stencilModeFor3D()):ge(oe,i.af.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,r,h,g,v,x){f.renderPass==="offscreen"&&function(S,k,D,A){if(!A.length)return;let L=S.context,z=L.gl,U=k.getSource();if(!(U instanceof pc))return;let H=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count"))),$=D.particlePositionRGBAImage;if(!$||$.width!==H){let oe=function(ae){let ge=ae*ae,fe=new Uint8Array(4*ge),ne=function(le){return le|=0,le=Math.imul(2747636419^le,2654435769),le=Math.imul(le^le>>>16,2654435769),((le=Math.imul(le^le>>>16,2654435769))>>>0)/4294967296},se=1/1.3;for(let le=0;le<ge;le++){let we=se*(ne(2*le+0)+Ms),Oe=se*(ne(2*le+1)+Ms),ue=255*we%1,Re=255*Oe%1,Be=ue,Qe=Oe-Re/255,Je=Re;fe[4*le+0]=255*(we-ue/255),fe[4*le+1]=255*Be,fe[4*le+2]=255*Qe,fe[4*le+3]=255*Je}return fe}(H);$=D.particlePositionRGBAImage=new i.i({width:H,height:H},oe)}let Y=D.particleFramebuffer;Y?Y.width!==H&&(Y.destroy(),Y=D.particleFramebuffer=L.createFramebuffer(H,H,!0,null)):Y=D.particleFramebuffer=L.createFramebuffer(H,H,!0,null);let Z=[];for(let oe of A){let ae=k.getTile(oe);if(!(ae instanceof i.c3))continue;let ge=Wt(ae,U,D);if(!ge)continue;let fe=[ae.tileSize,ae.tileSize],ne=D.tileFramebuffer;ne||(ne=D.tileFramebuffer=L.createFramebuffer(fe[0],fe[1],!0,null));let se=ae.rasterParticleState;se||(se=ae.rasterParticleState=new Ro(L,oe,fe,$));let le=se.update(D.lastInvalidatedAt);se.particleTextureDimension!==H&&se.updateParticleTexture(oe,$);let we=se.targetColorTexture;se.targetColorTexture=se.backgroundColorTexture,se.backgroundColorTexture=we;let Oe=se.particleTexture0;se.particleTexture0=se.particleTexture1,se.particleTexture1=Oe,Z.push([oe,ge,se,le])}if(Z.length===0)return;let Q=i.e.now(),re=D.previousDrawTimestamp?.001*(Q-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=Q,D.hasColorMap()){L.activeTexture.set(z.TEXTURE0+2);let oe=D.colorRampTexture;oe||(oe=D.colorRampTexture=new i.T(L,D.colorRamp,z.RGBA)),oe.bind(z.LINEAR,z.CLAMP_TO_EDGE)}L.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(oe,ae,ge){let fe=oe.context,ne=fe.gl,se=ae.tileFramebuffer;fe.activeTexture.set(ne.TEXTURE0);let le={u_texture:0,u_opacity:1.05*(Oe=ae.paint.get("raster-particle-fade-opacity-factor"))/(Oe+.05)},we=oe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Oe;for(let ue of ge){let[,,Re,Be]=ue;se.colorAttachment.set(Re.targetColorTexture.texture),fe.viewport.set([0,0,se.width,se.height]),fe.clear({color:i.C.transparent}),Be&&(Re.backgroundColorTexture.bind(ne.NEAREST,ne.CLAMP_TO_EDGE),we.draw(oe,ne.TRIANGLES,i.ae.disabled,i.ag.disabled,i.a.alphaBlended,i.af.disabled,le,ae.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments))}}(S,D,Z),function(oe,ae,ge,fe){let ne=oe.context,se=ne.gl,le=ge.tileFramebuffer,we=oe.transform.projection.name==="globe",Oe=ge.paint.get("raster-particle-max-speed");for(let ue of fe){let[Re,Be,Qe]=ue;ne.activeTexture.set(se.TEXTURE0+0),Be.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE),le.colorAttachment.set(Qe.targetColorTexture.texture);let Je=oe.getOrCreateProgram("rasterParticleDraw",{defines:Be.defines,overrideFog:!1});ne.activeTexture.set(se.TEXTURE0+1);let Ze=Be.scalarData?[]:[0,1,2,3].map(Ye=>i.bZ[Ye](Re));Ze.push(Re);let Ie=Re.canonical.x,Ve=Re.canonical.y;for(let Ye of Ze){let ft=ae.getTile(we?Ye.wrapped():Ye);if(!ft)continue;let _t=ft.rasterParticleState;if(!_t)continue;let kt=Ye.canonical.x+(1<<Ye.canonical.z)*(Ye.wrap-Re.wrap),bt=Ye.canonical.y;_t.particleTexture0.bind(se.NEAREST,se.CLAMP_TO_EDGE);let it=Dp(1,_t.particleTexture0.size[0],[kt-Ie,bt-Ve],0,Be.texture.size,2,Oe,Be.textureOffset,Be.scale,Be.offset);Je.draw(oe,se.POINTS,i.ae.disabled,i.ag.disabled,i.a.alphaBlended,i.af.disabled,it,ge.id,_t.particleIndexBuffer,void 0,_t.particleSegment)}}}(S,k,D,Z),L.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(oe,ae,ge,fe){let ne=oe.context,se=ne.gl,le=ae.paint.get("raster-particle-max-speed"),we=fe*ae.paint.get("raster-particle-speed-factor")*.15,Oe=function(Re){return Math.pow(Re,6)}(.01+1*ae.paint.get("raster-particle-reset-rate-factor")),ue=ae.particleFramebuffer;ne.viewport.set([0,0,ue.width,ue.height]);for(let Re of ge){let[,Be,Qe]=Re;ne.activeTexture.set(se.TEXTURE0+0),Be.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE),ne.activeTexture.set(se.TEXTURE0+1);let Je=Qe.particleTexture0;Je.bind(se.NEAREST,se.CLAMP_TO_EDGE);let Ze=Cy(1,Je.size[0],0,Be.texture.size,le,we,Oe,Be.textureOffset,Be.scale,Be.offset);ue.colorAttachment.set(Qe.particleTexture1.texture),ne.clear({color:i.C.transparent}),oe.getOrCreateProgram("rasterParticleUpdate",{defines:Be.defines}).draw(oe,se.TRIANGLES,i.ae.disabled,i.ag.disabled,i.a.unblended,i.af.disabled,Ze,ae.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments)}}(S,D,Z,re)}(f,r,h,g),f.renderPass==="translucent"&&(function(S,k,D,A,L){let z=S.context,U=z.gl,H=!S.options.moving,$=S.transform.projection.name==="globe";if(!A.length)return;let[Y,Z]=S.stencilConfigForOverlap(A),Q=[];$&&Q.push("PROJECTION_GLOBE_VIEW");let re=S.stencilModeFor3D();for(let oe of Z){let ae=oe.toUnwrapped(),ge=k.getTile(oe);if(!ge.rasterParticleState)continue;let fe=ge.rasterParticleState,ne=100;ge.registerFadeDuration(ne);let se=k.findLoadedParent(oe,0),le=uu(ge,se,k,S.transform,ne),we,Oe;S.terrain&&S.terrain.prepareDrawTile(),z.activeTexture.set(U.TEXTURE0),fe.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),z.activeTexture.set(U.TEXTURE1),se&&se.rasterParticleState?(se.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),we=Math.pow(2,se.tileID.overscaledZ-ge.tileID.overscaledZ),Oe=[ge.tileID.canonical.x*we%1,ge.tileID.canonical.y*we%1]):fe.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let ue=$?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(ae,H),Re=S.transform,Be=Jg(Re),Qe=i.bc(oe.canonical),Je=i.bd(Qe.getCenter().lat),Ze,Ie,Ve,Ye,ft;$?(Ze=Float32Array.from(i.bf(i.bg(oe.canonical))),Ie=Float32Array.from(Re.globeMatrix),Ve=Float32Array.from(i.bb(Re)),Ye=[i.aj(Re.center.lng),i.ak(Re.center.lat)],ft=Float32Array.from(i.be(oe.canonical,Qe,Je,Re.worldSize/Re._pixelsPerMercatorPixel))):(Ze=new Float32Array(16),Ie=new Float32Array(9),Ve=new Float32Array(16),Ye=[0,0],ft=new Float32Array(9));let _t=Ep(ue,Ze,Ie,Ve,ft,Oe||[0,0],i.a1(S.transform.zoom),Ye,Be,we||1,le,250),kt=S.isTileAffectedByFog(oe),bt=S.getOrCreateProgram("rasterParticle",{defines:Q,overrideFog:kt});if(S.uploadCommonUniforms(z,bt,ae),$){let it=new i.ae(U.LEQUAL,i.ae.ReadWrite,S.depthRangeFor3D),Ge=0,Dt=S.globeSharedBuffers;if(Dt){let[ri,ei,gi]=Dt.getGridBuffers(Je,Ge!==0);bt.draw(S,U.TRIANGLES,it,re,i.a.alphaBlended,i.af.backCCW,_t,D.id,ri,ei,gi)}}else{let it=S.depthModeForSublayer(0,i.ae.ReadOnly),Ge=Y[oe.overscaledZ],{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:ri,tileBoundsSegments:ei}=S.getTileBoundsBuffers(ge);bt.draw(S,U.TRIANGLES,it,Ge,i.a.alphaBlended,i.af.disabled,_t,D.id,Dt,ri,ei)}}S.resetStencilClippingMasks()}(f,r,h,g),f.style.map.triggerRepaint())},background:function(f,r,h,g){let v=h.paint.get("background-color"),x=h.paint.get("background-opacity"),S=h.paint.get("background-emissive-strength");if(x===0)return;let k=f.context,D=k.gl,A=f.transform,L=A.tileSize,z=h.paint.get("background-pattern"),U;if(z!==void 0&&(z===null||(U=f.imageManager.getPattern(z.toString(),h.scope,f.style.getLut(h.scope)),!U)))return;let H=!z&&v.a===1&&x===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==H)return;let $=i.ag.disabled,Y=f.depthModeForSublayer(0,H==="opaque"?i.ae.ReadWrite:i.ae.ReadOnly),Z=f.colorModeForDrapableLayerRenderPass(S),Q=z?"backgroundPattern":"background",re,oe=g;oe||(re=f.getBackgroundTiles(),oe=Object.values(re).map(ae=>ae.tileID)),z&&(k.activeTexture.set(D.TEXTURE0),f.imageManager.bind(f.context,h.scope));for(let ae of oe){let ge=f.isTileAffectedByFog(ae),fe=f.getOrCreateProgram(Q,{overrideFog:ge}),ne=ae.toUnwrapped(),se=g?ae.projMatrix:f.transform.calculateProjMatrix(ne);f.prepareDrawTile();let le=r?r.getTile(ae):re?re[ae.key]:new i.by(ae,L,A.zoom,f),we=z?$g(se,S,x,f,0,h.scope,U,{tileID:ae,tileSize:L}):Gd(se,S,x,v.toRenderColor(h.lut));f.uploadCommonUniforms(k,fe,ne);let{tileBoundsBuffer:Oe,tileBoundsIndexBuffer:ue,tileBoundsSegments:Re}=f.getTileBoundsBuffers(le);fe.draw(f,D.TRIANGLES,Y,$,Z,i.af.disabled,we,h.id,Oe,ue,Re)}},sky:function(f,r,h){let g=f._atmosphere?i.a1(f.transform.zoom):1,v=h.paint.get("sky-opacity")*g;if(v===0)return;let x=f.context,S=h.paint.get("sky-type"),k=new i.ae(x.gl.LEQUAL,i.ae.ReadOnly,[0,1]),D=f.frameCounter/1e3%1;S==="atmosphere"?f.renderPass==="offscreen"?h.needsSkyboxCapture(f)&&(function(A,L,z,U){let H=A.context,$=H.gl,Y=L.skyboxFbo;if(!Y){Y=L.skyboxFbo=H.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Cc(H),L.skyboxTexture=H.gl.createTexture(),$.bindTexture($.TEXTURE_CUBE_MAP,L.skyboxTexture),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR);for(let oe=0;oe<6;++oe)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,$.RGBA,32,32,0,$.RGBA,$.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(Y.framebuffer),H.viewport.set([0,0,32,32]);let Z=L.getCenter(A,!0),Q=A.getOrCreateProgram("skyboxCapture"),re=new Float64Array(16);i.ad.identity(re),i.ad.rotateY(re,re,.5*-Math.PI),Sa(A,L,Q,re,Z,0),i.ad.identity(re),i.ad.rotateY(re,re,.5*Math.PI),Sa(A,L,Q,re,Z,1),i.ad.identity(re),i.ad.rotateX(re,re,.5*-Math.PI),Sa(A,L,Q,re,Z,2),i.ad.identity(re),i.ad.rotateX(re,re,.5*Math.PI),Sa(A,L,Q,re,Z,3),i.ad.identity(re),Sa(A,L,Q,re,Z,4),i.ad.identity(re),i.ad.rotateY(re,re,Math.PI),Sa(A,L,Q,re,Z,5),H.viewport.set([0,0,A.width,A.height])}(f,h),h.markSkyboxValid(f)):f.renderPass==="sky"&&function(A,L,z,U,H){let $=A.context,Y=$.gl,Z=A.transform,Q=A.getOrCreateProgram("skybox");$.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,L.skyboxTexture);let re=((oe,ae,ge,fe,ne)=>({u_matrix:oe,u_sun_direction:ae,u_cubemap:0,u_opacity:fe,u_temporal_offset:ne}))(Z.skyboxMatrix,L.getCenter(A,!1),0,U,H);A.uploadCommonUniforms($,Q),Q.draw(A,Y.TRIANGLES,z,i.ag.disabled,A.colorModeForRenderPass(),i.af.backCW,re,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,h,k,v,D):S==="gradient"&&f.renderPass==="sky"&&function(A,L,z,U,H){let $=A.context,Y=$.gl,Z=A.transform,Q=A.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Cc($)),$.activeTexture.set(Y.TEXTURE0);let re=L.colorRampTexture;re||(re=L.colorRampTexture=new i.T($,L.colorRamp,Y.RGBA)),re.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let oe=((ae,ge,fe,ne,se)=>({u_matrix:ae,u_color_ramp:0,u_center_direction:ge,u_radius:i.ab(fe),u_opacity:ne,u_temporal_offset:se}))(Z.skyboxMatrix,L.getCenter(A,!1),L.paint.get("sky-gradient-radius"),U,H);A.uploadCommonUniforms($,Q),Q.draw(A,Y.TRIANGLES,z,i.ag.disabled,A.colorModeForRenderPass(),i.af.backCW,oe,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,h,k,v,D)},debug:function(f,r,h,g,v,x){for(let S=0;S<h.length;S++)if(v){let A=new i.C(g.r*.8,g.g*.8,g.b*.8,1);It(f,r,h[S],g,-1,-1,x),It(f,r,h[S],g,-1,1,x),It(f,r,h[S],g,1,1,x),It(f,r,h[S],g,1,-1,x),It(f,r,h[S],A,0,0,x)}else It(f,r,h[S],g,0,0,x)},custom:function(f,r,h,g){let v=f.context,x=h.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&h.isDraped(r)){if(f.renderPass==="offscreen"){let S=x.prerender;if(S){if(f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){let k=f.transform.pointMerc;S.call(x,v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),i.a1(f.transform.zoom),[k.x,k.y],f.transform.pixelsPerMeterRatio)}else S.call(x,v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){let k=x.renderToTile;if(k){let D=g[0].canonical,A=new i.Y(D.x+g[0].wrap*(1<<D.z),D.y,D.z);v.setDepthMode(i.ae.disabled),v.setStencilMode(i.ag.disabled),v.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),k.call(x,v.gl,A),v.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),v.setStencilMode(i.ag.disabled);let S=x.renderingMode==="3d"?new i.ae(f.context.gl.LEQUAL,i.ae.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,i.ae.ReadOnly);if(v.setDepthMode(S),f.transform.projection.name==="globe"){let k=f.transform.pointMerc;x.render(v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),i.a1(f.transform.zoom),[k.x,k.y],f.transform.pixelsPerMeterRatio)}else x.render(v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState(),v.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,r,h,g){if(f.renderPass==="opaque")return;let v=h.paint.get("model-opacity");if(v===0)return;let x=h.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!x||f.terrain&&v<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof i.Z))return;let S=f.shadowRenderer,k=h.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,k||(S.enabled=!1));let D=()=>{S&&(S.useNormalOffset=!0,k||(S.enabled=!0))},A=r.getSource();if(f.renderPass==="light-beam"&&A.type!=="batched-model")return;if(A.type==="vector"||A.type==="geojson")return function(Q,re,oe,ae,ge){let fe=Q.transform;if(fe.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${fe.projection.name} projection is not yet implemented`);let ne=fe.getFreeCameraOptions().position;if(!Q.modelManager)return;let se=Q.modelManager;oe.modelManager=se;let le=Q.shadowRenderer;if(!oe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let we=oe._unevaluatedLayout._values["model-id"],Oe=$i({},oe.layout.get("model-id").parameters),ue=Q.style.order.indexOf(oe.fqid);for(let Re of ae){let Be=re.getTile(Re).getBucket(oe);if(!Be||Be.projection.name!==fe.projection.name)continue;let Qe=Be.getModelUris();Qe&&!Be.modelsRequested&&(se.addModelsFromBucket(Qe,ge),Be.modelsRequested=!0);let Je=ar(Re,fe);Oe.zoom=Je;let Ze=we.possiblyEvaluate(Oe);if(e_(Q,Be,Re),io.shadowUniformsInitialized=!1,io.useSingleShadowCascade=!!le&&le.getMaxCascadeForTile(Re.toUnwrapped())===0,Q.renderPass==="shadow"&&le){if(Q.currentShadowCascade===1&&Be.isInsideFirstShadowMapFrustum)continue;let Ye=fe.calculatePosMatrix(Re.toUnwrapped(),fe.worldSize);if(io.tileMatrix.set(Ye),io.shadowTileMatrix=Float32Array.from(le.calculateShadowPassMatrixFromMatrix(Ye)),io.aabb.min.fill(0),io.aabb.max[0]=io.aabb.max[1]=i.a3,io.aabb.max[2]=0,pr(Be,io,Q,oe.scope))continue}let Ie=1<<Re.canonical.z,Ve=[((ne.x-Re.wrap)*Ie-Re.canonical.x)*i.a3,(ne.y*Ie-Re.canonical.y)*i.a3,ne.z*Ie*i.a3];Q.conflationActive&&Object.keys(Be.instancesPerModel).length>0&&Q.style.isLayerClipped(oe,re.getSource())&&Be.updateReplacement(Re,Q.replacementSource,ue)&&(Be.uploaded=!1,Be.upload(Q.context));for(let Ye in Be.instancesPerModel){let ft=Be.instancesPerModel[Ye];ft.features.length>0&&(Ye=Ze.evaluate(ft.features[0].feature,{}));let _t=se.getModel(Ye,ge);if(_t&&_t.uploaded)for(let kt of _t.nodes)Bo(Q,oe,kt,ft,Ve,Re,io)}}}(f,r,h,g,A.type==="vector"?h.scope:""),void D();if(!A.loaded())return;if(A.type==="batched-model")return function(Q,re,oe,ae){oe.resetLayerRenderingStats(Q);let ge=Q.context,fe=Q.transform,ne=Q.style.fog,se=Q.shadowRenderer;if(fe.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${fe.projection.name} projection is not yet implemented`);let le=Q.transform.getFreeCameraOptions().position,we=i._.scale([],[le.x,le.y,le.z],Q.transform.worldSize);i._.negate(we,we);let Oe=i.ad.identity([]),ue=i.cg(fe.center.lat,fe.zoom),Re=i.ad.fromScaling([],[1,1,1/ue]);i.ad.translate(Oe,Oe,we);let Be=oe.paint.get("model-opacity"),Qe=new i.ae(ge.gl.LEQUAL,i.ae.ReadWrite,Q.depthRangeFor3D),Je=new i.ae(ge.gl.LEQUAL,i.ae.ReadOnly,Q.depthRangeFor3D),Ze=new i.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ie=Q.renderPass==="shadow",Ve=Ie&&se?se.getCurrentCascadeFrustum():fe.getFrustum(fe.scaleZoom(fe.worldSize)),Ye=oe.paint.get("model-front-cutoff"),ft=Ye[2]<1,_t=Ha(Q,oe.paint.get("model-cutoff-fade-range")),kt=oe.getLayerRenderingStats();(function(bt,it,Ge,Dt){let ri=bt.terrain?bt.terrain.exaggeration():0,ei=bt.transform.zoom;for(let gi of Dt){let Ii=it.getTile(gi).getBucket(Ge);Ii&&(bt.conflationActive&&Ii.updateReplacement(gi,bt.replacementSource),Ii.evaluateScale(bt,Ge),bt.terrain&&ri>0&&Ii.elevationUpdate(bt.terrain,ri,gi,Ge.source),Ii.needsReEvaluation(bt,ei,Ge)&&Ii.evaluate(Ge))}})(Q,re,oe,ae),function(){let bt,it,Ge;ft?(bt=ae.length-1,it=-1,Ge=-1):(bt=0,it=ae.length,Ge=1);for(let Dt=bt;Dt!==it;Dt+=Ge){let ri=ae[Dt],ei=re.getTile(ri).getBucket(oe);if(!ei||!ei.uploaded)continue;let gi=!1;se&&(gi=se.getMaxCascadeForTile(ri.toUnwrapped())===0);let Ii=fe.calculatePosMatrix(ri.toUnwrapped(),fe.worldSize),Ji=ei.modelTraits,Qt=[];for(let Hi of ei.getNodesInfo()){if(Hi.hiddenByReplacement||!Hi.node.meshes)continue;let dn=Hi.node,Xi=0;Q.terrain&&dn.elevation&&(Xi=dn.elevation*Q.terrain.exaggeration());let yi=Hi.evaluatedScale;if(yi[0]<=1&&yi[1]<=1&&yi[2]<=1&&(()=>{let Pe=Hi.aabb;return Ze.min=[...Pe.min],Ze.max=[...Pe.max],Ze.min[2]+=Xi,Ze.max[2]+=Xi,i._.transformMat4(Ze.min,Ze.min,Ii),i._.transformMat4(Ze.max,Ze.max,Ii),Ze})().intersects(Ve)===0)continue;let ti=[...Ii],fn=dn.anchor?dn.anchor[0]:0,yn=dn.anchor?dn.anchor[1]:0;i.ad.translate(ti,ti,[fn*(yi[0]-1),yn*(yi[1]-1),Xi]),i._.exactEquals(yi,i.cj)||i.ad.scale(ti,ti,yi);let tn=i.ad.multiply([],ti,dn.matrix),Ke=i.ad.multiply([],fe.expandedFarZProjMatrix,tn),wt=i.ad.multiply([],fe.expandedFarZProjMatrix,ti),Dn=i.aA.transformMat4([],[fn,yn,Xi,1],Ke)[2];dn.hidden=!1;let Wi=Be;Ie||(ft&&(Wi*=aa(ti,fe,Hi.aabb,Ye)),Wi*=Bp(_t,Dn)),Wi!==0?Qt.push({nodeInfo:Hi,depth:Dn,opacity:Wi,wvpForNode:Ke,wvpForTile:wt,nodeModelMatrix:tn,tileModelMatrix:ti}):dn.hidden=!0}Ie||Qt.sort((Hi,dn)=>!ft||Hi.opacity===1&&dn.opacity===1?Hi.depth<dn.depth?-1:1:Hi.opacity===1?-1:dn.opacity===1?1:Hi.depth>dn.depth?-1:1);for(let Hi of Qt){let dn=Hi.nodeInfo,Xi=dn.node,yi=i.ad.multiply([],Re,Hi.tileModelMatrix);i.ad.multiply(yi,Oe,yi);let ti=i.ad.invert([],yi);i.ad.transpose(ti,ti),i.ad.scale(ti,ti,qa),yi=i.ad.multiply(yi,yi,Xi.matrix);let fn=Q.renderPass==="light-beam",yn=Ji&i.cl.HasMapboxMeshFeatures,tn=yn?0:dn.evaluatedRMEA[0][2];for(let Ke=0;Ke<Xi.meshes.length;++Ke){let wt=Xi.meshes[Ke],Dn=Ke===Xi.lightMeshIndex,Wi=Hi.wvpForNode;if(Dn){if(!fn&&!Q.terrain&&Q.shadowRenderer){Q.currentLayer<Q.firstLightBeamLayer&&(Q.firstLightBeamLayer=Q.currentLayer);continue}Wi=Hi.wvpForTile}else if(fn)continue;let Pe={defines:[]},Eo=[];if(Qd(Pe.defines,Eo,wt,Q,oe.lut),yn||Pe.defines.push("DIFFUSE_SHADED"),gi&&Pe.defines.push("SHADOWS_SINGLE_CASCADE"),kt&&(Ie?kt.numRenderedVerticesInShadowPass+=wt.vertexArray.length:kt.numRenderedVerticesInTransparentPass+=wt.vertexArray.length),Ie){to(wt,Hi.nodeModelMatrix,Q,oe);continue}let Ir=null;if(ne){let Os=Sc(Hi.nodeModelMatrix,Q.transform);if(Ir=new Float32Array(Os),fe.projection.name!=="globe"){let Rs=wt.aabb.min,Ya=wt.aabb.max,[ka,Za]=ne.getOpacityForBounds(Os,Rs[0],Rs[1],Ya[0],Ya[1]);Pe.overrideFog=ka>=Sn||Za>=Sn}}let Gr=wt.material,fr;Gr.occlusionTexture&&Gr.occlusionTexture.offsetScale&&(fr=Gr.occlusionTexture.offsetScale,Pe.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Ie&&se&&(se.useNormalOffset=!!wt.normalBuffer);let no=Q.getOrCreateProgram("model",Pe);!Ie&&se&&se.setupShadowsFromMatrix(Hi.tileModelMatrix,no,se.useNormalOffset),Q.uploadCommonUniforms(ge,no,null,Ir);let da=Gr.pbrMetallicRoughness;da.metallicFactor=.9,da.roughnessFactor=.5;let Do=qd(new Float32Array(Wi),new Float32Array(yi),new Float32Array(ti),new Float32Array(Xi.matrix),Q,Hi.opacity,da.baseColorFactor.toRenderColor(null),Gr.emissiveFactor,da.metallicFactor,da.roughnessFactor,Gr,tn,oe,[0,0,0],fr);!Dn&&(dn.hasTranslucentParts||Hi.opacity<1)&&no.draw(Q,ge.gl.TRIANGLES,Qe,i.ag.disabled,i.a.disabled,i.af.backCCW,Do,oe.id,wt.vertexBuffer,wt.indexBuffer,wt.segments,oe.paint,Q.transform.zoom,void 0,Eo),no.draw(Q,ge.gl.TRIANGLES,Dn?Je:Qe,i.ag.disabled,Dn||Hi.opacity<1||dn.hasTranslucentParts?i.a.alphaBlended:i.a.unblended,i.af.backCCW,Do,oe.id,wt.vertexBuffer,wt.indexBuffer,wt.segments,oe.paint,Q.transform.zoom,void 0,Eo)}}}}()}(f,r,h,g),void D();let L=A.getModels(),z=[],U=f.transform.getFreeCameraOptions().position,H=i._.scale([],[U.x,U.y,U.z],f.transform.worldSize);i._.negate(H,H);let $=[],Y=[],Z=0;for(let Q of L){let re=h.paint.get("model-rotation").constantOr(null),oe=h.paint.get("model-scale").constantOr(null),ae=h.paint.get("model-translation").constantOr(null);Q.computeModelMatrix(f,re,oe,ae,!0,!0,!1);let ge=i.ad.identity([]),fe=i.cg(Q.position.lat,f.transform.zoom),ne=i.ad.fromScaling([],[1,1,1/fe]);i.ad.translate(ge,ge,H),z.push({zScaleMatrix:ne,negCameraPosMatrix:ge});for(let se of Q.nodes)Vr(f.transform,se,Q.matrix,f.transform.expandedFarZProjMatrix,Z,$,Y);Z++}if($.sort((Q,re)=>re.depth-Q.depth),f.renderPass!=="shadow"){if(v===1)for(let Q of Y)ml(Q,f,h,z[Q.modelIndex],i.ag.disabled,f.colorModeForRenderPass());else{for(let Q of Y)ml(Q,f,h,z[Q.modelIndex],i.ag.disabled,i.a.disabled);for(let Q of Y)ml(Q,f,h,z[Q.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(let Q of $)ml(Q,f,h,z[Q.modelIndex],i.ag.disabled,f.colorModeForRenderPass());D()}else{for(let Q of Y)to(Q.mesh,Q.nodeModelMatrix,f,h);for(let Q of $)to(Q.mesh,Q.nodeModelMatrix,f,h);D()}}},t_={model:function(f,r,h){let g=r.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,g.type==="vector"?f.scope:""));if(g.type==="batched-model")return;let v=g.getModels();for(let x of v)x.upload(h.context)},raster:function(f,r,h){let g=r.getSource();if(!(g instanceof pc&&g.loaded()))return;let v=f.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=f.paint.get("raster-array-band")||g.getInitialBand(v);if(x==null)return;let S=r.getIds().map(k=>r.getTileByID(k));for(let k of S)k.updateNeeded(v,x)&&g.prepareTile(k,v,x)},"raster-particle":function(f,r,h){let g=r.getSource();if(!(g instanceof pc&&g.loaded()))return;let v=f.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=f.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(x==null)return;let S=r.getIds().map(k=>r.getTileByID(k));for(let k of S)k.updateNeeded(v,x)&&g.prepareTile(k,v,x)}};class i_{constructor(r,h,g,v){this.context=new Id(r,h),this.occlusionBuffers=new Ey(this.context),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=i.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let S of x)this._debugParams.enabledLayers[S]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let S of x)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],S);this.symbolParams=new tc(v),this.setup(),this.numSublayers=i.bv.maxUnderzooming+i.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new cu(this),this._wireframeDebugCache=new Jd,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(r,h){let g=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Cp(this,r));let v=this._terrain;this.transform.elevation=g?v:null,v.update(r,this.transform,h),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(r){let h=r.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[g,v]=h.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);let x=g+.78*(v-g);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new Cp(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,h){if(this.width=r*i.e.devicePixelRatio,this.height=h*i.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let g of this.style.order)this.style._mergedLayers[g].resize()}setup(){let r=this.context,h=new i.bt;h.emplaceBack(0,0),h.emplaceBack(i.a3,0),h.emplaceBack(0,i.a3),h.emplaceBack(i.a3,i.a3),this.tileExtentBuffer=r.createVertexBuffer(h,i.br.members),this.tileExtentSegments=i.b.simpleSegment(0,0,4,2);let g=new i.bt;g.emplaceBack(0,0),g.emplaceBack(i.a3,0),g.emplaceBack(0,i.a3),g.emplaceBack(i.a3,i.a3),this.debugBuffer=r.createVertexBuffer(g,i.br.members),this.debugSegments=i.b.simpleSegment(0,0,4,5);let v=new i.bt;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(v,i.br.members),this.viewportSegments=i.b.simpleSegment(0,0,4,2);let x=new i.cp;x.emplaceBack(0,0,0,0),x.emplaceBack(i.a3,0,i.a3,0),x.emplaceBack(0,i.a3,0,i.a3),x.emplaceBack(i.a3,i.a3,i.a3,i.a3),this.mercatorBoundsBuffer=r.createVertexBuffer(x,i.cq.members),this.mercatorBoundsSegments=i.b.simpleSegment(0,0,4,2);let S=new i.bu;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(S);let k=new i.cr;for(let A of[0,1,3,2,0])k.emplaceBack(A);this.debugIndexBuffer=r.createIndexBuffer(k),this.emptyTexture=new i.T(r,new i.i({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=i.ad.create();let D=this.context.gl;this.stencilClearMode=new i.ag({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,i.ae.disabled,this.stencilClearMode,i.a.disabled,i.af.disabled,hu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,h,g){if(!h||this.currentStencilSource===h.id||!r.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(let D of g)if(this._tileClippingMaskIDs[D.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=h.id;let v=this.context,x=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(i.a.disabled),v.setDepthMode(i.ae.disabled);let S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let k of g){let D=h.getTile(k),A=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:z,tileBoundsSegments:U}=this.getTileBoundsBuffers(D);S.draw(this,x.TRIANGLES,i.ae.disabled,new i.ag({func:x.ALWAYS,mask:0},A,255,x.KEEP,x.KEEP,x.REPLACE),i.a.disabled,i.af.disabled,hu(k.projMatrix),"$clipping",L,z,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let r=this.nextStencilID++,h=this.context.gl;return new i.ag({func:h.NOTEQUAL,mask:255},r,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);let h=this.context.gl;return new i.ag({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(r){let h=this.context.gl,g=r.sort((S,k)=>k.overscaledZ-S.overscaledZ),v=g[g.length-1].overscaledZ,x=g[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();let S={};for(let k=0;k<x;k++)S[k+v]=new i.ag({func:h.GEQUAL,mask:255},k+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[S,g]}return[{[v]:i.ag.disabled},g]}colorModeForRenderPass(){let r=this.context.gl;return this._showOverdrawInspector?new i.a([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new i.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?i.a.unblended:i.a.alphaBlended}colorModeForDrapableLayerRenderPass(r){let h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new i.a([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new i.C(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,h,g,v=!1){if(this.depthOcclusion)return new i.ae(this.context.gl.GREATER,i.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return i.ae.disabled;let x=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new i.ae(g||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,h)=>r+h/this._fpsHistory.length,0))}render(r,h){let g=i.e.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=h;let v=this.style._mergedLayers,x=this.style.order.filter(se=>{let le=v[se];return!(le.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[le.type]}),S=x.map(se=>v[se]),k=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(i.e.now()),this.imageManager.beginFrame();let D=0,A=!1;for(let se in k){let le=k[se];le.used&&(le.prepare(this.context),le.getSource().usedInConflation&&++D)}let L=!1;for(let se of S)se.isHidden(this.transform.zoom)||(se.type==="clip"&&(L=!0),this.prepareLayer(se));let z={},U={},H={},$={},Y={};for(let se in k){let le=k[se];z[se]=le.getVisibleCoordinates(),U[se]=z[se].slice().reverse(),H[se]=le.getVisibleCoordinates(!0).reverse(),$[se]=le.getShadowCasterCoordinates(),Y[se]=le.sortCoordinatesByDistance(z[se])}let Z=se=>{let le=this.style.getLayerSourceCache(se);return le&&le.used?le.getSource():null};if(D||L){let se=[],le=[],we=0;for(let Oe of S)this.isSourceForClippingOrConflation(Oe,Z(Oe))&&(se.push(Oe),le.push(we)),we++;if(se&&(L||se.length>1)){let Oe=[];for(let ue=0;ue<se.length;ue++){let Re=se[ue],Be=le[ue],Qe=this.style.getLayerSourceCache(Re);if(!Qe||!Qe.used||!Qe.getSource().usedInConflation&&Re.type!=="clip")continue;let Je=1/0,Ze=i.cu.None;if(Re.type==="clip"){Je=Be;for(let Ie of Re.layout.get("clip-layer-types"))Ze|=Ie==="model"?i.cu.Model:Ie==="symbol"?i.cu.Symbol:i.cu.FillExtrusion}Oe.push({layer:Re.fqid,cache:Qe,order:Je,clipMask:Ze})}this.replacementSource.setSources(Oe),A=!0}}A||this.replacementSource.clear(),this.conflationActive=A,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let se=0;se<S.length;se++){let le=S[se],we=le.cutoffRange();if(this.longestCutoffRange=Math.max(we,this.longestCutoffRange),we>0){let Oe=Z(le);Oe&&(this.minCutoffZoom=Math.max(Oe.minzoom,this.minCutoffZoom)),le.minzoom&&(this.minCutoffZoom=Math.max(le.minzoom,this.minCutoffZoom))}le.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=se),this._lastOcclusionLayer=se)}let Q=this.style&&this.style.fog;Q?(this._fogVisible=Q.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Q.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(H),this.opaquePassCutoff=0);let re=this._shadowRenderer;if(re){re.updateShadowParameters(this.transform,this.style.directionalLight);for(let se in k)for(let le of z[se]){let we={min:0,max:0};this.terrain&&(we=this.terrain.getMinMaxForTile(le)||we),re.addShadowReceiver(le.toUnwrapped(),we.min,we.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new zp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!i.ct(this.context.gl))return;this.renderPass="offscreen";for(let se of S){let le=r.getLayerSourceCache(se);if(!se.hasOffscreenPass()||se.isHidden(this.transform.zoom))continue;let we=le?U[le.id]:void 0;(se.type==="custom"||se.type==="raster"||se.type==="raster-particle"||se.isSky()||we&&we.length)&&this.renderLayer(this,le,se,we)}this.depthRangeFor3D=[0,1-(S.length+2)*this.numSublayers*this.depthEpsilon];let oe=this.terrain;oe&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&oe.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,$)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ge=(()=>{if(h.showOverdrawInspector)return i.C.black;let se=this.style.fog;if(se&&this.transform.projection.supportsFog){let le=this.style.getLut(se.scope);if(!ae){let we=se.properties.get("color").toRenderColor(le).toArray01();return new i.C(...we)}if(ae){let we=se.properties.get("space-color").toRenderColor(le).toArray01();return new i.C(...we)}}return i.C.transparent})();if(this.context.clear({color:ge,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){let se=S[this.currentLayer],le=r.getLayerSourceCache(se);if(se.isSky())continue;let we=le?(se.is3D()?Y:U)[le.id]:void 0;this._renderTileClippingMasks(se,le,we),this.renderLayer(this,le,se,we)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){let se=S[this.currentLayer],le=r.getLayerSourceCache(se);se.isSky()&&this.renderLayer(this,le,se,le?U[le.id]:void 0)}function fe(se,le){let we;return le&&(we=(se.type==="symbol"?H:se.is3D()?Y:U)[le.id]),we}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){let se=S[this.currentLayer];if(se.type==="raster"){let le=r.getLayerSourceCache(se);this.renderLayer(this,le,se,fe(se,le))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ne=0;for(re&&(ne=re.getShadowCastingLayerCount());this.currentLayer<x.length;){let se=S[this.currentLayer],le=r.getLayerSourceCache(se);if(se.isSky())++this.currentLayer;else if(oe&&this.style.isLayerDraped(se)){if(se.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=oe.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(se.is3D()||this.terrain||this._renderTileClippingMasks(se,le,le?z[le.id]:void 0),this.renderLayer(this,le,se,fe(se,le)),!oe&&re&&ne>0&&se.hasShadowPass()&&--ne==0&&(re.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let we=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=we;this.currentLayer++){let Oe=S[this.currentLayer];if(!Oe.hasLightBeamPass())continue;let ue=r.getLayerSourceCache(Oe);this.renderLayer(this,ue,Oe,ue?U[ue.id]:void 0)}this.currentLayer=we,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let we=this.currentLayer;this.depthOcclusion=!0;for(let Oe of this.layersWithOcclusionOpacity){this.currentLayer=Oe;let ue=S[this.currentLayer],Re=r.getLayerSourceCache(ue),Be=Re?U[Re.id]:void 0;ue.is3D()||this.terrain||this._renderTileClippingMasks(ue,Re,Re?z[Re.id]:void 0),this.renderLayer(this,Re,ue,Be)}this.depthOcclusion=!1,this.currentLayer=we,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let se=null;S.forEach(le=>{let we=r.getLayerSourceCache(le);we&&!le.isHidden(this.transform.zoom)&&we.getVisibleCoordinates().length&&(!se||se.getSource().maxzoom<we.getSource().maxzoom)&&(se=we)}),se&&this.options.showTileBoundaries&&sa.debug(this,se,se.getVisibleCoordinates(),i.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&sa.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(se){let le=se.transform.padding;zi(se,se.transform.height-(le.top||0),3,Su),zi(se,le.bottom||0,3,Lp),Bi(se,le.left||0,3,Ca),Bi(se,se.transform.width-(le.right||0),3,Fp);let we=se.transform.centerPoint;(function(Oe,ue,Re,Be){eo(Oe,ue-1,Re-10,2,20,Be),eo(Oe,ue-10,Re-1,20,2,Be)})(se,we.x,se.transform.height-we.y,xc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),A||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);let{unsupportedLayers:h}=this.transform.projection,g=!h||!h.includes(r.type);if(t_[r.type]&&(g||this.terrain&&r.type==="custom")){let v=this.style.getLayerSourceCache(r);t_[r.type](r,v,this)}this.gpuTimingEnd()}renderLayer(r,h,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(g.type)&&(!r.terrain||g.type!=="custom")||g.type==="clip"||sa[g.type](r,h,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;let h=this.context.extTimerQuery,g=this.context.gl,v=this.gpuTimers[r.id];v||(v=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(h.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let r=this.context.extTimerQuery,h=this.context.gl,g=h.createQuery();this.deferredRenderGpuTimeQueries.push(g),h.beginQuery(r.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){let r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){let h={};for(let g in r){let v=r[g],x=this.context.extTimerQuery,S=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),h[g]=S}return h}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;let h=this.context.extTimerQuery,g=this.context.gl,v=0;for(let x of r)v+=h.getQueryParameter(x,g.QUERY_RESULT)/1e6,h.deleteQueryEXT(x);return v}translatePosMatrix(r,h,g,v,x){if(!g[0]&&!g[1])return r;let S=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(S){let A=Math.sin(S),L=Math.cos(S);g=[g[0]*L-g[1]*A,g[0]*A+g[1]*L]}let k=[x?g[0]:i.bB(h,g[0],this.transform.zoom),x?g[1]:i.bB(h,g[1],this.transform.zoom),0],D=new Float32Array(16);return i.ad.translate(D,r,k),D}saveTileTexture(r){let h=r.size[0],g=this._tileTextures[h];g?g.push(r):this._tileTextures[h]=[r]}getTileTexture(r){let h=this._tileTextures[r];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,h,g){let v=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,x=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||h!==void 0&&!h||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(r,h){this.cache=this.cache||{};let g=h&&h.defines||[],v=h&&h.config,x=this.currentGlobalDefines(r,h&&h.overrideFog,h&&h.overrideRtt).concat(g),S=jd.cacheKey(Bg[r],r,x,v);return this.cache[S]||(this.cache[S]=new jd(this.context,r,Bg[r],v,Sy[r],x)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,h){if(this.style.enable3dLights()){let g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){let x=((S,k,D)=>{let A=S.properties.get("direction"),L=S.properties.get("color").toRenderColor(D.getLut(S.scope)).toArray01(),z=S.properties.get("intensity"),U=k.properties.get("color").toRenderColor(D.getLut(k.scope)).toArray01(),H=k.properties.get("intensity"),$=[A.x,A.y,A.z],Y=i.bA(U,H),Z=i.bA(L,z);return{u_lighting_ambient_color:Y,u_lighting_directional_dir:$,u_lighting_directional_color:Z,u_ground_radiance:Ga($,Z,Y)}})(g,v,this.style);h.setLightsUniformValues(r,x)}}}uploadCommonUniforms(r,h,g,v,x){if(this.uploadCommonLightUniforms(r,h),this.terrain&&this.terrain.renderingToTexture)return;let S=this.style.fog;if(S){let k=S.getOpacity(this.transform.pitch),D=((A,L,z,U,H,$,Y,Z,Q,re,oe,ae)=>{let ge=A.transform,fe=L.properties.get("color").toRenderColor(A.style.getLut(L.scope)).toArray01();fe[3]=U;let ne=A.frameCounter/1e3%1,[se,le]=L.properties.get("vertical-range");return{u_fog_matrix:z?ge.calculateFogTileMatrix(z):ae||A.identityMat,u_fog_range:L.getFovAdjustedRange(ge._fov),u_fog_color:fe,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(se,le),le],u_fog_temporal_offset:ne,u_frustum_tl:H,u_frustum_tr:$,u_frustum_br:Y,u_frustum_bl:Z,u_globe_pos:Q,u_globe_radius:re,u_viewport:oe,u_globe_transition:i.a1(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,S,g,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.e.devicePixelRatio,this.transform.height*i.e.devicePixelRatio],v);h.setFogUniformValues(r,D)}x&&h.setCutoffUniformValues(r,x.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){let r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){let r=this.context.gl,h=r.createTexture();return r.bindTexture(r.TEXTURE_2D,h),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let r=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(let v of g)h[v.key]=r[v.key]||new i.by(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,h){return!(!r.is3D()||r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||r.sourceLayer!=="building")&&r.type!=="clip"&&(!h||h.type!=="batched-model"))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[r.key];return h||(this._cachedTileFogOpacities[r.key]=h=this.style.fog.getOpacityForTile(r)),h[0]>=Sn||h[1]>=Sn}}class Wr{constructor(r,h,g,v){this.screenBounds=r,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(r,h){let g,v;if(r instanceof i.P||typeof r[0]=="number"){let x=i.P.convert(r);g=[x],v=h.isPointAboveHorizon(x)}else{let x=i.P.convert(r[0]),S=i.P.convert(r[1]);g=[x,S],v=i.cv(x,S).every(k=>h.isPointAboveHorizon(k))}return new Wr(g,h.getCameraPoint(),v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return i.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],v=i.cv(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),i.cw(v,r)}bufferedCameraGeometryGlobe(r){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],v=i.cv(h,g,r),x=this.cameraPoint.clone();switch(3*((x.y>h.y)+(x.y>g.y))+((x.x>h.x)+(x.x>g.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(r,h,g,v=0){let x=r.queryPadding/h._pixelsPerMercatorPixel+1,S=g?this._bufferedCameraMercator(x,h):this._bufferedScreenMercator(x,h),k=r.tileID.wrap+(S.unwrapped?v:0),D=S.polygon.map(Z=>i.cx(r.tileTransform,Z,k));if(!i.cy(D,0,0,i.a3,i.a3))return;k=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);let A=this.screenGeometryMercator.polygon.map(Z=>i.cz(r.tileTransform,Z,k)),L=A.map(Z=>new i.P(Z[0],Z[1])),z=h.getFreeCameraOptions().position||new i.Y(0,0,0),U=i.cz(r.tileTransform,z,k),H=A.map(Z=>{let Q=i._.sub(Z,Z,U);return i._.normalize(Q,Q),new i.aT(U,Q)}),$=i.bB(r,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:H,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(Y=i.cA(D),Y.min.x=i.at(Y.min.x,0,i.a3),Y.min.y=i.at(Y.min.y,0,i.a3),Y.max.x=i.at(Y.max.x,0,i.a3),Y.max.y=i.at(Y.max.y,0,i.a3),Y),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:$};var Y}_bufferedScreenMercator(r,h){let g=Vp(r);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),h):{polygon:this.bufferedScreenGeometry(r).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(r,h){let g=Vp(r);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),h):{polygon:this.bufferedCameraGeometry(r).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(r,h){let g=function(x,S){let k=i.ad.multiply([],S.pixelMatrix,S.globeMatrix),D=[0,-i.cD,0,1],A=[0,i.cD,0,1],L=[0,0,0,1];i.aA.transformMat4(D,D,k),i.aA.transformMat4(A,A,k),i.aA.transformMat4(L,L,k);let z=new i.P(D[0]/D[3],D[1]/D[3]),U=new i.P(A[0]/A[3],A[1]/A[3]),H=i.cB(x,z)&&D[3]<L[3],$=i.cB(x,U)&&A[3]<L[3];if(!H&&!$)return null;let Y=function(ne,se,le){for(let we=1;we<ne.length;we++){let Oe=ks(se.pointCoordinate3D(ne[we-1]).x),ue=ks(se.pointCoordinate3D(ne[we]).x);if(le<0){if(Oe<ue)return{idx:we,t:-Oe/(ue-1-Oe)}}else if(ue<Oe)return{idx:we,t:(1-Oe)/(ue+1-Oe)}}return null}(x,S,H?-1:1);if(!Y)return null;let{idx:Z,t:Q}=Y,re=Z>1?Np(x.slice(0,Z),S):[],oe=Z<x.length?Np(x.slice(Z),S):[];re=re.map(ne=>new i.P(ks(ne.x),ne.y)),oe=oe.map(ne=>new i.P(ks(ne.x),ne.y));let ae=[...re];ae.length===0&&ae.push(oe[oe.length-1]);let ge=i.a2(ae[ae.length-1].y,(oe.length===0?re[0]:oe[0]).y,Q),fe;return fe=H?[new i.P(0,ge),new i.P(0,0),new i.P(1,0),new i.P(1,ge)]:[new i.P(1,ge),new i.P(1,1),new i.P(0,1),new i.P(0,ge)],ae.push(...fe),oe.length===0?ae.push(re[0]):ae.push(...oe),{polygon:ae.map(ne=>new i.Y(ne.x,ne.y)),unwrapped:!1}}(r,h);if(g)return g;let v=function(x,S){let k=!1,D=-1/0,A=0;for(let z=0;z<x.length-1;z++)x[z].x>D&&(D=x[z].x,A=z);for(let z=0;z<x.length-1;z++){let U=(A+z)%(x.length-1),H=x[U],$=x[U+1];Math.abs(H.x-$.x)>.5&&(H.x<$.x?(H.x+=1,U===0&&(x[x.length-1].x+=1)):($.x+=1,U+1===x.length-1&&(x[0].x+=1)),k=!0)}let L=i.aj(S.center.lng);return k&&L<Math.abs(L-1)&&x.forEach(z=>{z.x-=1}),{polygon:x,unwrapped:k}}(Np(r,h).map(x=>new i.P(ks(x.x),x.y)),h);return{polygon:v.polygon.map(x=>new i.Y(x.x,x.y)),unwrapped:v.unwrapped}}}function Np(f,r){return i.cC(f,h=>{let g=r.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function ks(f){return f<0?1+f%1:f%1}function Vp(f){return 100*f|0}function Dy(f,r){let h=i.ad.identity([]);return i.ad.scale(h,h,[.5*f.width,.5*-f.height,1]),i.ad.translate(h,h,[1,-1,0]),i.ad.multiply(h,h,f.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(h)}function Ay(f,r,h,g,v,x,S,k=!1){let D=f.tilesIn(g,S,k);D.sort(Mc);let A=[];for(let z of D)A.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(r,h,f._state,z,v,x,Dy(f.transform,z.tile.tileID),k)});let L=function(z){let U={},H={};for(let $ of z){let Y=$.queryResults,Z=$.wrappedTileID,Q=H[Z]=H[Z]||{};for(let re in Y){let oe=Y[re],ae=Q[re]=Q[re]||{},ge=U[re]=U[re]||[];for(let fe of oe)ae[fe.featureIndex]||(ae[fe.featureIndex]=!0,ge.push(fe))}}return U}(A);for(let z in L)L[z].forEach(U=>{let H=U.feature,$=H.layer;$&&$.type!=="background"&&$.type!=="sky"&&$.type!=="slot"&&(H.source=$.source,$["source-layer"]&&(H.sourceLayer=$["source-layer"]),H.state=H.id!==void 0?f.getFeatureState($["source-layer"],H.id):{})});return L}function eh(f,r){let h=f.getRenderableIds().map(x=>f.getTileByID(x)),g=[],v={};for(let x=0;x<h.length;x++){let S=h[x],k=S.tileID.canonical.key;v[k]||(v[k]=!0,S.querySourceFeatures(g,r))}return g}function Mc(f,r){let h=f.tileID,g=r.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}class Py{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let r=!1,h=!1;for(let g in this.style._mergedLayers){let v=this.style._mergedLayers[g];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:r,visibilityChanged:h});else if(v.type==="model"){let x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:r,visibilityChanged:h})}}}onNewFrame(r){this.layersGotHidden=!1;for(let h of this.layers){let g=h.layer,v=!1;g.type==="fill-extrusion"?v=!g.isHidden(r)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(v=!g.isHidden(r)&&g.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&h.visible,h.visible=v}}updateZOffset(r,h){this.currentBuildingBuckets=[];for(let v of this.layers){let x=v.layer,S=this.style.getLayerSourceCache(x),k=1;x.type==="fill-extrusion"&&(k=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let D=S?S.getTile(h):null;if(!D&&S&&h.canonical.z>S.getSource().minzoom){let A=h.scaledTo(Math.min(S.getSource().maxzoom,h.overscaledZ-1));for(;A.overscaledZ>=S.getSource().minzoom&&(D=S.getTile(A),!D&&A.overscaledZ!==0);)A=A.scaledTo(A.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:D?D.getBucket(x):null,tileID:D?D.tileID:h,verticalScale:k})}r.hasAnyZOffset=!1;let g=!1;for(let v=0;v<r.symbolInstances.length;v++){let x=r.symbolInstances.get(v),S=x.zOffset,k=this._getHeightAtTileOffset(h,x.tileAnchorX,x.tileAnchorY);x.zOffset=k!==Number.NEGATIVE_INFINITY?k:S,g||S===x.zOffset||(g=!0),r.hasAnyZOffset||x.zOffset===0||(r.hasAnyZOffset=!0)}g&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,h,g,v){let x=h,S=g;if(r.canonical.z!==v.canonical.z){let k=v.canonical,D=1/(1<<r.canonical.z-k.z);x=(h+r.canonical.x*i.a3)*D-k.x*i.a3|0,S=(g+r.canonical.y*i.a3)*D-k.y*i.a3|0}return{tileX:x,tileY:S}}_getHeightAtTileOffset(r,h,g){let v,x;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;let{bucket:k,tileID:D,verticalScale:A}=this.currentBuildingBuckets[S];if(!k)continue;let{tileX:L,tileY:z}=this._mapCoordToOverlappingTile(r,h,g,D),U=k.getHeightAtTileCoord(L,z);U&&U.height!==void 0&&(U.hidden?v=U.height:x=Math.max(U.height*A,x||0))}if(x!==void 0)return x;for(let S=0;S<this.layers.length;++S){let k=this.layers[S];if(k.layer.type!=="model"||!k.visible)continue;let{bucket:D,tileID:A}=this.currentBuildingBuckets[S];if(!D)continue;let{tileX:L,tileY:z}=this._mapCoordToOverlappingTile(r,h,g,A),U=D.getHeightAtTileCoord(L,z);if(U&&!U.hidden)return U.height===void 0&&v!==void 0?Math.min(U.maxHeight,v)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function kc(f,r){let h={};for(let g in f)g!=="ref"&&(h[g]=f[g]);return i.cE.forEach(g=>{g in r&&(h[g]=r[g])}),h}function jp(f){f=f.slice();let r=Object.create(null);for(let h=0;h<f.length;h++)r[f[h].id]=f[h];for(let h=0;h<f.length;h++)"ref"in f[h]&&(f[h]=kc(f[h],r[f[h].ref]));return f}let Ai={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function $a(f,r,h){h.push({command:Ai.addSource,args:[f,r[f]]})}function n_(f,r,h){r.push({command:Ai.removeSource,args:[f]}),h[f]=!0}function Oy(f,r,h,g){n_(f,h,g),$a(f,r,h)}function Ry(f,r,h){let g;for(g in f[h])if(f[h].hasOwnProperty(g)&&g!=="data"&&!_(f[h][g],r[h][g]))return!1;for(g in r[h])if(r[h].hasOwnProperty(g)&&g!=="data"&&!_(f[h][g],r[h][g]))return!1;return!0}function th(f,r,h,g,v,x){let S;for(S in r=r||{},f=f||{})f.hasOwnProperty(S)&&(_(f[S],r[S])||h.push({command:x,args:[g,S,r[S],v]}));for(S in r)r.hasOwnProperty(S)&&!f.hasOwnProperty(S)&&(_(f[S],r[S])||h.push({command:x,args:[g,S,r[S],v]}))}function Mu(f){return f.id}function Tc(f,r){return f[r.id]=r,f}class r_{constructor(r,h){this.reset(r,h)}reset(r,h){this.points=r||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=i.at(r,0,1);let h=1,g=this._distances[h],v=r*this.paddedLength+this.padding;for(;g<v&&h<this._distances.length;)g=this._distances[++h];let x=h-1,S=this._distances[x],k=g-S,D=k>0?(v-S)/k:0;return this.points[x].mult(1-D).add(this.points[h].mult(D))}}class Up{constructor(r,h,g){let v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(r/g),this.yCellCount=Math.ceil(h/g);for(let S=0;S<this.xCellCount*this.yCellCount;S++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=h,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,h,g,v,x){this._forEachCell(h,g,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(r,h,g,v){this._forEachCell(h-v,g-v,h+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(h),this.circles.push(g),this.circles.push(v)}_insertBoxCell(r,h,g,v,x,S){this.boxCells[x].push(S)}_insertCircleCell(r,h,g,v,x,S){this.circleCells[x].push(S)}_query(r,h,g,v,x,S){if(g<0||r>this.width||v<0||h>this.height)return!x&&[];let k=[];if(r<=0&&h<=0&&this.width<=g&&this.height<=v){if(x)return!0;for(let D=0;D<this.boxKeys.length;D++)k.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){let A=this.circles[3*D],L=this.circles[3*D+1],z=this.circles[3*D+2];k.push({key:this.circleKeys[D],x1:A-z,y1:L-z,x2:A+z,y2:L+z})}return S?k.filter(S):k}return this._forEachCell(r,h,g,v,this._queryCell,k,{hitTest:x,seenUids:{box:{},circle:{}}},S),x?k.length>0:k}_queryCircle(r,h,g,v,x){let S=r-g,k=r+g,D=h-g,A=h+g;if(k<0||S>this.width||A<0||D>this.height)return!v&&[];let L=[];return this._forEachCell(S,D,k,A,this._queryCellCircle,L,{hitTest:v,circle:{x:r,y:h,radius:g},seenUids:{box:{},circle:{}}},x),v?L.length>0:L}query(r,h,g,v,x){return this._query(r,h,g,v,!1,x)}hitTest(r,h,g,v,x){return this._query(r,h,g,v,!0,x)}hitTestCircle(r,h,g,v){return this._queryCircle(r,h,g,!0,v)}_queryCell(r,h,g,v,x,S,k,D){let A=k.seenUids,L=this.boxCells[x];if(L!==null){let U=this.bboxes;for(let H of L)if(!A.box[H]){A.box[H]=!0;let $=4*H;if(r<=U[$+2]&&h<=U[$+3]&&g>=U[$+0]&&v>=U[$+1]&&(!D||D(this.boxKeys[H]))){if(k.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[H],x1:U[$],y1:U[$+1],x2:U[$+2],y2:U[$+3]})}}}let z=this.circleCells[x];if(z!==null){let U=this.circles;for(let H of z)if(!A.circle[H]){A.circle[H]=!0;let $=3*H;if(this._circleAndRectCollide(U[$],U[$+1],U[$+2],r,h,g,v)&&(!D||D(this.circleKeys[H]))){if(k.hitTest)return S.push(!0),!0;{let Y=U[$],Z=U[$+1],Q=U[$+2];S.push({key:this.circleKeys[H],x1:Y-Q,y1:Z-Q,x2:Y+Q,y2:Z+Q})}}}}}_queryCellCircle(r,h,g,v,x,S,k,D){let A=k.circle,L=k.seenUids,z=this.boxCells[x];if(z!==null){let H=this.bboxes;for(let $ of z)if(!L.box[$]){L.box[$]=!0;let Y=4*$;if(this._circleAndRectCollide(A.x,A.y,A.radius,H[Y+0],H[Y+1],H[Y+2],H[Y+3])&&(!D||D(this.boxKeys[$])))return S.push(!0),!0}}let U=this.circleCells[x];if(U!==null){let H=this.circles;for(let $ of U)if(!L.circle[$]){L.circle[$]=!0;let Y=3*$;if(this._circlesCollide(H[Y],H[Y+1],H[Y+2],A.x,A.y,A.radius)&&(!D||D(this.circleKeys[$])))return S.push(!0),!0}}}_forEachCell(r,h,g,v,x,S,k,D){let A=this._convertToXCellCoord(r),L=this._convertToYCellCoord(h),z=this._convertToXCellCoord(g),U=this._convertToYCellCoord(v);for(let H=A;H<=z;H++)for(let $=L;$<=U;$++)if(x.call(this,r,h,g,v,this.xCellCount*$+H,S,k,D))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,h,g,v,x,S){let k=v-r,D=x-h,A=g+S;return A*A>k*k+D*D}_circleAndRectCollide(r,h,g,v,x,S,k){let D=(S-v)/2,A=Math.abs(r-(v+D));if(A>D+g)return!1;let L=(k-x)/2,z=Math.abs(h-(x+L));if(z>L+g)return!1;if(A<=D||z<=L)return!0;let U=A-D,H=z-L;return U*U+H*H<=g*g}}let la=100;class o_{constructor(r,h,g=new Up(r.width+200,r.height+200,25),v=new Up(r.width+200,r.height+200,25)){this.transform=r,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+la,this.screenBottomBoundary=r.height+la,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=h}placeCollisionBox(r,h,g,v,x,S,k,D){let A=g.projectedAnchorX,L=g.projectedAnchorY,z=g.projectedAnchorZ,U=g.elevation,H=g.tileID,$=r.getProjection();if(U&&H){let[fe,ne,se]=$.upVector(H.canonical,g.tileAnchorX,g.tileAnchorY),le=$.upVectorScale(H.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=fe*U*le,L+=ne*U*le,z+=se*U*le}let Y=this.projectAndGetPerspectiveRatio(k,A,L,z,g.tileID,$.name==="globe"||!!U||this.transform.pitch>0,$),Z=S*Y.perspectiveRatio,Q=(g.x1*h+v.x-g.padding)*Z+Y.point.x,re=(g.y1*h+v.y-g.padding)*Z+Y.point.y,oe=(g.x2*h+v.x+g.padding)*Z+Y.point.x,ae=(g.y2*h+v.y+g.padding)*Z+Y.point.y,ge=Y.perspectiveRatio<=.55||Y.occluded;return!this.isInsideGrid(Q,re,oe,ae)||!x&&this.grid.hitTest(Q,re,oe,ae,D)||ge?{box:[],offscreen:!1,occluded:Y.occluded}:{box:[Q,re,oe,ae],offscreen:this.isOffscreen(Q,re,oe,ae),occluded:!1}}placeCollisionCircles(r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y){let Z=[],Q=this.transform.elevation,re=r.getProjection(),oe=Q?Q.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,re):null,ae=new i.P(g.tileAnchorX,g.tileAnchorY),{x:ge,y:fe,z:ne}=re.projectTilePoint(ae.x,ae.y,Y.canonical);if(oe){let[Ze,Ie,Ve]=oe(ae);ge+=Ze,fe+=Ie,ne+=Ve}let se=re.name==="globe",le=this.projectAndGetPerspectiveRatio(k,ge,fe,ne,Y,se||!!Q||this.transform.pitch>0,re),{perspectiveRatio:we}=le,Oe=(z?S/we:S*we)/i.bN,ue=zo(ge,fe,ne,D),Re=le.signedDistanceFromCamera>0?su(Oe,x,g.lineOffsetX*Oe,g.lineOffsetY*Oe,!1,ue,ae,g,v,D,{},Q&&!z?oe:null,z&&!!Q,re,Y,z):null,Be=!1,Qe=!1,Je=!0;if(Re&&!le.occluded){let Ze=.5*H*we+$,Ie=new i.P(-100,-100),Ve=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Ye=new r_,{first:ft,last:_t}=Re,kt=ft.path.length,bt=[];for(let Dt=kt-1;Dt>=1;Dt--)bt.push(ft.path[Dt]);for(let Dt=1;Dt<_t.path.length;Dt++)bt.push(_t.path[Dt]);let it=2.5*Ze;A&&(bt=bt.map(([Dt,ri,ei],gi)=>(oe&&!se&&(ei=oe(gi<kt-1?ft.tilePath[kt-1-gi]:_t.tilePath[gi-kt+2])[2]),zo(Dt,ri,ei,A))),bt.some(Dt=>Dt[3]<=0)&&(bt=[]));let Ge=[];if(bt.length>0){let Dt=1/0,ri=-1/0,ei=1/0,gi=-1/0;for(let Ii of bt)Dt=Math.min(Dt,Ii[0]),ei=Math.min(ei,Ii[1]),ri=Math.max(ri,Ii[0]),gi=Math.max(gi,Ii[1]);ri>=Ie.x&&Dt<=Ve.x&&gi>=Ie.y&&ei<=Ve.y&&(Ge=[bt.map(Ii=>new i.P(Ii[0],Ii[1]))],(Dt<Ie.x||ri>Ve.x||ei<Ie.y||gi>Ve.y)&&(Ge=i.cF(Ge,Ie.x,Ie.y,Ve.x,Ve.y)))}for(let Dt of Ge){Ye.reset(Dt,.25*Ze);let ri=0;ri=Ye.length<=.5*Ze?1:Math.ceil(Ye.paddedLength/it)+1;for(let ei=0;ei<ri;ei++){let gi=ei/Math.max(ri-1,1),Ii=Ye.lerp(gi),Ji=Ii.x+la,Qt=Ii.y+la;Z.push(Ji,Qt,Ze,0);let Hi=Ji-Ze,dn=Qt-Ze,Xi=Ji+Ze,yi=Qt+Ze;if(Je=Je&&this.isOffscreen(Hi,dn,Xi,yi),Qe=Qe||this.isInsideGrid(Hi,dn,Xi,yi),!h&&this.grid.hitTestCircle(Ji,Qt,Ze,U)&&(Be=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Be,occluded:!1}}}}return{circles:!L&&Be||!Qe?[]:Z,offscreen:Je,collisionDetected:Be,occluded:le.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let h=[],g=1/0,v=1/0,x=-1/0,S=-1/0;for(let L of r){let z=new i.P(L.x+la,L.y+la);g=Math.min(g,z.x),v=Math.min(v,z.y),x=Math.max(x,z.x),S=Math.max(S,z.y),h.push(z)}let k=this.grid.query(g,v,x,S).concat(this.ignoredGrid.query(g,v,x,S)),D={},A={};for(let L of k){let z=L.key;if(D[z.bucketInstanceId]===void 0&&(D[z.bucketInstanceId]={}),D[z.bucketInstanceId][z.featureIndex])continue;let U=[new i.P(L.x1,L.y1),new i.P(L.x2,L.y1),new i.P(L.x2,L.y2),new i.P(L.x1,L.y2)];i.cG(h,U)&&(D[z.bucketInstanceId][z.featureIndex]=!0,A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(r,h,g,v,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:x},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,h,g,v,x){let S=h?this.ignoredGrid:this.grid,k={bucketInstanceId:g,featureIndex:v,collisionGroupID:x};for(let D=0;D<r.length;D+=4)S.insertCircle(k,r[D],r[D+1],r[D+2])}projectAndGetPerspectiveRatio(r,h,g,v,x,S,k){let D=[h,g,v,1],A=!1;v||this.transform.pitch>0?(i.aA.transformMat4(D,D,r),this.fogState&&x&&k.name!=="globe"&&(A=function(U,H,$,Y,Z,Q){let re=Q.calculateFogTileMatrix(Z),oe=[H,$,Y];return i._.transformMat4(oe,oe,re),or(U,i._.length(oe),Q.pitch,Q._fov)}(this.fogState,h,g,v,x.toUnwrapped(),this.transform)>.9)):xa(D,D,r);let L=D[3];return{point:new i.P((D[0]/L+1)/2*this.transform.width+la,(-D[1]/L+1)/2*this.transform.height+la),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/L*.5,1.5),signedDistanceFromCamera:L,occluded:S&&D[2]>L||A}}isOffscreen(r,h,g,v){return g<la||r>=this.screenRightBoundary||v<la||h>this.screenBottomBoundary}isInsideGrid(r,h,g,v){return g>=0&&r<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){let r=i.ad.identity([]);return i.ad.translate(r,r,[-100,-100,0]),r}}class Ts{constructor(r,h,g,v){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?h:-h))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Is{constructor(r,h,g,v,x,S=!1){this.text=new Ts(r?r.text:null,h,g,x),this.icon=new Ts(r?r.icon:null,h,v,x),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ku{constructor(r,h,g,v=!1){this.text=r,this.icon=h,this.skipFade=g,this.clipped=v}}class a_{constructor(){this.invProjMatrix=i.ad.create(),this.viewportMatrix=i.ad.create(),this.circles=[]}}class ih{constructor(r,h,g,v,x){this.bucketInstanceId=r,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=x}}class nh{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){let h=++this.maxGroupID;this.collisionGroups[r]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[r]}}function Hp(f,r,h,g,v){let{horizontalAlign:x,verticalAlign:S}=i.bQ(f),k=-(x-.5)*r,D=-(S-.5)*h,A=i.bP(f,g);return new i.P(k+A[0]*v,D+A[1]*v)}function rh(f,r,h,g,v){let x=new i.P(f,r);return h&&x._rotate(g?v:-v),x}class No{constructor(r,h,g,v,x,S){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new o_(this.transform,x),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new nh(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,h,g,v){let x=g.getBucket(h),S=g.latestFeatureIndex;if(!x||!S||h.fqid!==x.layerIds[0])return;let k=x.layers[0].layout,D=g.collisionBoxArray,A=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),L=g.tileSize/i.a3,z=g.tileID.toUnwrapped();this.transform.setProjection(x.projection);let U=(H=g.tileID,$=x.getProjection(),Y=this.transform,$.name===this.projection?Y.calculateProjMatrix(H.toUnwrapped()):vu(Y,$,H));var H,$,Y;let Z=k.get("text-pitch-alignment")==="map",Q=k.get("text-rotation-alignment")==="map";h.compileFilter();let re=h.dynamicFilter(),oe=h.dynamicFilterNeedsFeature(),ae=this.transform.calculatePixelsToTileUnitsMatrix(g),ge=sl(U,g.tileID.canonical,Z,Q,this.transform,x.getProjection(),ae),fe=null;if(Z){let le=hc(U,g.tileID.canonical,Z,Q,this.transform,x.getProjection(),ae);fe=i.ad.multiply([],this.transform.labelPlaneMatrix,le)}let ne=null;re&&g.latestFeatureIndex&&(ne={unwrappedTileID:z,dynamicFilter:re,dynamicFilterNeedsFeature:oe,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new ih(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,g.tileID);let se={bucket:x,layout:k,posMatrix:U,textLabelPlaneMatrix:ge,labelToScreenMatrix:fe,clippingData:ne,scale:A,textPixelRatio:L,holdingForFade:g.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:i.aD(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.aD(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(let le of x.sortKeyRanges){let{sortKey:we,symbolInstanceStart:Oe,symbolInstanceEnd:ue}=le;r.push({sortKey:we,symbolInstanceStart:Oe,symbolInstanceEnd:ue,parameters:se})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:se})}attemptAnchorPlacement(r,h,g,v,x,S,k,D,A,L,z,U,H,$,Y,Z,Q,re){let{textOffset0:oe,textOffset1:ae,crossTileID:ge}=U,fe=[oe,ae],ne=Hp(r,g,v,fe,x),se=this.collisionIndex.placeCollisionBox($,x,h,rh(ne.x,ne.y,S,k,this.transform.angle),z,D,A,L.predicate);if(Z){let le=$.getSymbolInstanceIconSize(re,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox($,le,Z,rh(ne.x,ne.y,S,k,this.transform.angle),z,D,A,L.predicate).box.length===0)return}if(se.box.length>0){let le;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&(le=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:fe,width:g,height:v,anchor:r,textScale:x,prevAnchor:le},this.markUsedJustification($,r,U,Y),$.allowVerticalPlacement&&(this.markUsedOrientation($,Y,U),this.placedOrientations[ge]=Y),{shift:ne,placedGlyphBoxes:se}}}placeLayerBucketPart(r,h,g,v){let{bucket:x,layout:S,posMatrix:k,textLabelPlaneMatrix:D,labelToScreenMatrix:A,clippingData:L,textPixelRatio:z,holdingForFade:U,collisionBoxArray:H,partiallyEvaluatedTextSize:$,partiallyEvaluatedIconSize:Y,collisionGroup:Z}=r.parameters,Q=S.get("text-optional"),re=S.get("icon-optional"),oe=S.get("text-allow-overlap"),ae=S.get("icon-allow-overlap"),ge=S.get("text-rotation-alignment")==="map",fe=S.get("text-pitch-alignment")==="map",ne=S.get("symbol-z-order")==="viewport-y",se=S.get("symbol-z-elevate");this.transform.setProjection(x.projection);let le=oe&&(ae||!x.hasIconData()||re),we=ae&&(oe||!x.hasTextData()||Q);!x.collisionArrays&&H&&x.deserializeCollisionBoxes(H),g&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,H);let Oe=(ue,Re,Be)=>{let{crossTileID:Qe,numVerticalGlyphVertices:Je}=ue;if(L){let Xi={zoom:this.transform.zoom,pitch:this.transform.pitch},yi=null;if(L.dynamicFilterNeedsFeature){let ti=this.retainedQueryData[x.bucketInstanceId];yi=L.featureIndex.loadFeature({featureIndex:ue.featureIndex,bucketIndex:ti.bucketIndex,sourceLayerIndex:ti.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Xi,yi,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new i.P(ue.tileAnchorX,ue.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Qe]=new ku(!1,!1,!1,!0),void h.add(Qe)}if(h.has(Qe))return;if(U)return void(this.placements[Qe]=new ku(!1,!1,!1));let Ze=!1,Ie=!1,Ve=!0,Ye=!1,ft=!1,_t=null,kt={box:null,offscreen:null,occluded:null},bt={box:null,offscreen:null,occluded:null},it=null,Ge=null,Dt=null,ri=0,ei=0,gi=0;Be.textFeatureIndex?ri=Be.textFeatureIndex:ue.useRuntimeCollisionCircles&&(ri=ue.featureIndex),Be.verticalTextFeatureIndex&&(ei=Be.verticalTextFeatureIndex);let Ii=Xi=>{Xi.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let yi=this.transform.elevation;Xi.elevation=ue.zOffset+(yi?yi.getAtTileOffset(Xi.tileID,Xi.tileAnchorX,Xi.tileAnchorY):0)},Ji=Be.textBox;if(Ji){Ii(Ji);let Xi=ti=>{let fn=i.aE.horizontal;if(x.allowVerticalPlacement&&!ti&&this.prevPlacement){let yn=this.prevPlacement.placedOrientations[Qe];yn&&(this.placedOrientations[Qe]=yn,fn=yn,this.markUsedOrientation(x,fn,ue))}return fn},yi=(ti,fn)=>{if(x.allowVerticalPlacement&&Je>0&&Be.verticalTextBox){for(let yn of x.writingModes)if(yn===i.aE.vertical?(kt=fn(),bt=kt):kt=ti(),kt&&kt.box&&kt.box.length)break}else kt=ti()};if(S.get("text-variable-anchor")){let ti=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Qe]){let tn=this.prevPlacement.variableOffsets[Qe];ti.indexOf(tn.anchor)>0&&(ti=ti.filter(Ke=>Ke!==tn.anchor),ti.unshift(tn.anchor))}let fn=(tn,Ke,wt)=>{let Dn=x.getSymbolInstanceTextSize($,ue,this.transform.zoom,Re),Wi=(tn.x2-tn.x1)*Dn+2*tn.padding,Pe=(tn.y2-tn.y1)*Dn+2*tn.padding,Eo=ue.hasIconTextFit&&!ae?Ke:null;Eo&&Ii(Eo);let Ir={box:[],offscreen:!1,occluded:!1},Gr=oe?2*ti.length:ti.length;for(let fr=0;fr<Gr;++fr){let no=this.attemptAnchorPlacement(ti[fr%ti.length],tn,Wi,Pe,Dn,ge,fe,z,k,Z,fr>=ti.length,ue,Re,x,wt,Eo,$,Y);if(no&&(Ir=no.placedGlyphBoxes,Ir&&Ir.box&&Ir.box.length)){Ze=!0,_t=no.shift;break}}return Ir};yi(()=>fn(Ji,Be.iconBox,i.aE.horizontal),()=>{let tn=Be.verticalTextBox;return tn&&Ii(tn),x.allowVerticalPlacement&&!(kt&&kt.box&&kt.box.length)&&Je>0&&tn?fn(tn,Be.verticalIconBox,i.aE.vertical):{box:null,offscreen:null,occluded:null}}),kt&&(Ze=kt.box,Ve=kt.offscreen,Ye=kt.occluded);let yn=Xi(!(!kt||!kt.box));if(!Ze&&this.prevPlacement){let tn=this.prevPlacement.variableOffsets[Qe];tn&&(this.variableOffsets[Qe]=tn,this.markUsedJustification(x,tn.anchor,ue,yn))}}else{let ti=(fn,yn)=>{let tn=x.getSymbolInstanceTextSize($,ue,this.transform.zoom,Re),Ke=this.collisionIndex.placeCollisionBox(x,tn,fn,new i.P(0,0),oe,z,k,Z.predicate);return Ke&&Ke.box&&Ke.box.length&&(this.markUsedOrientation(x,yn,ue),this.placedOrientations[Qe]=yn),Ke};yi(()=>ti(Ji,i.aE.horizontal),()=>{let fn=Be.verticalTextBox;return x.allowVerticalPlacement&&Je>0&&fn?(Ii(fn),ti(fn,i.aE.vertical)):{box:null,offscreen:null,occluded:null}}),Xi(!!(kt&&kt.box&&kt.box.length))}}if(it=kt,Ze=it&&it.box&&it.box.length>0,Ve=it&&it.offscreen,Ye=it&&it.occluded,ue.useRuntimeCollisionCircles){let Xi=x.text.placedSymbolArray.get(ue.centerJustifiedTextSymbolIndex>=0?ue.centerJustifiedTextSymbolIndex:ue.verticalPlacedTextSymbolIndex),yi=i.aF(x.textSizeData,$,Xi),ti=S.get("text-padding");Ge=this.collisionIndex.placeCollisionCircles(x,oe,Xi,x.lineVertexArray,x.glyphOffsetArray,yi,k,D,A,g,fe,Z.predicate,ue.collisionCircleDiameter*yi/i.bN,ti,this.retainedQueryData[x.bucketInstanceId].tileID),Ze=oe||Ge.circles.length>0&&!Ge.collisionDetected,Ve=Ve&&Ge.offscreen,Ye=Ge.occluded}if(Be.iconFeatureIndex&&(gi=Be.iconFeatureIndex),Be.iconBox){let Xi=yi=>{Ii(yi);let ti=ue.hasIconTextFit&&_t?rh(_t.x,_t.y,ge,fe,this.transform.angle):new i.P(0,0),fn=x.getSymbolInstanceIconSize(Y,this.transform.zoom,ue.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,fn,yi,ti,ae,z,k,Z.predicate)};bt&&bt.box&&bt.box.length&&Be.verticalIconBox?(Dt=Xi(Be.verticalIconBox),Ie=Dt.box.length>0):(Dt=Xi(Be.iconBox),Ie=Dt.box.length>0),Ve=Ve&&Dt.offscreen,ft=Dt.occluded}let Qt=Q||ue.numHorizontalGlyphVertices===0&&Je===0,Hi=re||ue.numIconVertices===0;if(Qt||Hi?Hi?Qt||(Ie=Ie&&Ze):Ze=Ie&&Ze:Ie=Ze=Ie&&Ze,Ze&&it&&it.box&&this.collisionIndex.insertCollisionBox(it.box,S.get("text-ignore-placement"),x.bucketInstanceId,bt&&bt.box&&ei?ei:ri,Z.ID),Ie&&Dt&&this.collisionIndex.insertCollisionBox(Dt.box,S.get("icon-ignore-placement"),x.bucketInstanceId,gi,Z.ID),Ge&&(Ze&&this.collisionIndex.insertCollisionCircles(Ge.circles,S.get("text-ignore-placement"),x.bucketInstanceId,ri,Z.ID),g)){let Xi=x.bucketInstanceId,yi=this.collisionCircleArrays[Xi];yi===void 0&&(yi=this.collisionCircleArrays[Xi]=new a_);for(let ti=0;ti<Ge.circles.length;ti+=4)yi.circles.push(Ge.circles[ti+0]),yi.circles.push(Ge.circles[ti+1]),yi.circles.push(Ge.circles[ti+2]),yi.circles.push(Ge.collisionDetected?1:0)}let dn=x.projection.name!=="globe";le=le&&(dn||!Ye),we=we&&(dn||!ft),this.placements[Qe]=new ku(Ze||le,Ie||we,Ve||x.justReloaded),h.add(Qe)};if(se&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),ne){let ue=x.getSortedSymbolIndexes(this.transform.angle);for(let Re=ue.length-1;Re>=0;--Re){let Be=ue[Re];Oe(x.symbolInstances.get(Be),Be,x.collisionArrays[Be])}x.hasAnyZOffset&&i.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let ue=x.getSortedIndexesByZOffset();for(let Re=0;Re<ue.length;++Re){let Be=ue[Re];Oe(x.symbolInstances.get(Be),Be,x.collisionArrays[Be])}}else for(let ue=r.symbolInstanceStart;ue<r.symbolInstanceEnd;ue++)Oe(x.symbolInstances.get(ue),ue,x.collisionArrays[ue]);if(g&&x.bucketInstanceId in this.collisionCircleArrays){let ue=this.collisionCircleArrays[x.bucketInstanceId];i.ad.invert(ue.invProjMatrix,k),ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(r,h,g,v){let{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:D,crossTileID:A}=g,L=i.cJ(h),z=v===i.aE.vertical?D:L==="left"?x:L==="center"?S:L==="right"?k:-1;x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=z>=0&&x!==z?0:A),S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=z>=0&&S!==z?0:A),k>=0&&(r.text.placedSymbolArray.get(k).crossTileID=z>=0&&k!==z?0:A),D>=0&&(r.text.placedSymbolArray.get(D).crossTileID=z>=0&&D!==z?0:A)}markUsedOrientation(r,h,g){let v=h===i.aE.horizontal||h===i.aE.horizontalOnly?h:0,x=h===i.aE.vertical?h:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:A}=g,L=r.text.placedSymbolArray;S>=0&&(L.get(S).placedOrientation=v),k>=0&&(L.get(k).placedOrientation=v),D>=0&&(L.get(D).placedOrientation=v),A>=0&&(L.get(A).placedOrientation=x)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;let h=this.prevPlacement,g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;let v=h?h.symbolFadeChange(r):1,x=h?h.opacities:{},S=h?h.variableOffsets:{},k=h?h.placedOrientations:{};for(let D in this.placements){let A=this.placements[D],L=x[D];L?(this.opacities[D]=new Is(L,v,A.text,A.icon,null,A.clipped),g=g||A.text!==L.text.placed||A.icon!==L.icon.placed):(this.opacities[D]=new Is(null,v,A.text,A.icon,A.skipFade,A.clipped),g=g||A.text||A.icon)}for(let D in x){let A=x[D];if(!this.opacities[D]){let L=new Is(A,v,!1,!1);L.isHidden()||(this.opacities[D]=L,g=g||A.text.placed||A.icon.placed)}}for(let D in S)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=S[D]);for(let D in k)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=k[D]);g?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:r)}updateLayerOpacities(r,h,g,v){let x=new Set;for(let S of h){let k=S.getBucket(r);k&&S.latestFeatureIndex&&r.fqid===k.layerIds[0]&&(this.updateBucketOpacities(k,x,S.collisionBoxArray,g,v,S.tileID),k.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(k,S.tileID),k.updateZOffset()))}}updateBucketOpacities(r,h,g,v,x,S){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();let k=r.layers[0].layout,D=!!r.layers[0].dynamicFilter(),A=new Is(null,0,!1,!1,!0),L=k.get("text-allow-overlap"),z=k.get("icon-allow-overlap"),U=k.get("text-variable-anchor"),H=k.get("text-rotation-alignment")==="map",$=k.get("text-pitch-alignment")==="map",Y=new Is(null,0,L&&(z||!r.hasIconData()||k.get("icon-optional")),z&&(L||!r.hasTextData()||k.get("text-optional")),!0);!r.collisionArrays&&g&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(g);let Z=(re,oe,ae)=>{for(let ge=0;ge<oe/4;ge++)re.opacityVertexArray.emplaceBack(ae)},Q=0;x&&r.updateReplacement(S,x);for(let re=0;re<r.symbolInstances.length;re++){let oe=r.symbolInstances.get(re),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:ge,crossTileID:fe,numIconVertices:ne,tileAnchorX:se,tileAnchorY:le}=oe,we=h.has(fe),Oe=this.opacities[fe];we?Oe=A:Oe||(Oe=Y,this.opacities[fe]=Oe),h.add(fe);let ue=ae>0||ge>0,Re=ne>0,Be=this.placedOrientations[fe],Qe=Be===i.aE.vertical,Je=Be===i.aE.horizontal||Be===i.aE.horizontalOnly;!ue&&!Re||Oe.isHidden()||Q++;let Ze=!1;if((ue||Re)&&x)for(let Ie of r.activeReplacements){if(Ie.order<v||Ie.order===1/0||!(Ie.clipMask&i.cu.Symbol)||Ie.min.x>se||se>Ie.max.x||Ie.min.y>le||le>Ie.max.y)continue;let Ve=i.cH(se,le,S.canonical,Ie.footprintTileId.canonical);if(Ze=i.cI(Ve,Ie),Ze)break}if(ue){let Ie=Ze?Es:Ma(Oe.text);Z(r.text,ae,Qe?Es:Ie),Z(r.text,ge,Je?Es:Ie);let Ve=Oe.text.isHidden(),{leftJustifiedTextSymbolIndex:Ye,centerJustifiedTextSymbolIndex:ft,rightJustifiedTextSymbolIndex:_t,verticalPlacedTextSymbolIndex:kt}=oe,bt=r.text.placedSymbolArray,it=Ve||Qe?1:0;Ye>=0&&(bt.get(Ye).hidden=it),ft>=0&&(bt.get(ft).hidden=it),_t>=0&&(bt.get(_t).hidden=it),kt>=0&&(bt.get(kt).hidden=Ve||Je?1:0);let Ge=this.variableOffsets[fe];Ge&&this.markUsedJustification(r,Ge.anchor,oe,Be);let Dt=this.placedOrientations[fe];Dt&&(this.markUsedJustification(r,"left",oe,Dt),this.markUsedOrientation(r,Dt,oe))}if(Re){let Ie=Ze?Es:Ma(Oe.icon),{placedIconSymbolIndex:Ve,verticalPlacedIconSymbolIndex:Ye}=oe,ft=r.icon.placedSymbolArray,_t=Oe.icon.isHidden()?1:0;Ve>=0&&(Z(r.icon,ne,Qe?Es:Ie),ft.get(Ve).hidden=_t),Ye>=0&&(Z(r.icon,oe.numVerticalIconVertices,Je?Es:Ie),ft.get(Ye).hidden=_t)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){let Ie=r.collisionArrays[re];if(Ie){let Ve=new i.P(0,0),Ye=!0;if(Ie.textBox||Ie.verticalTextBox){if(U){let _t=this.variableOffsets[fe];_t?(Ve=Hp(_t.anchor,_t.width,_t.height,_t.textOffset,_t.textScale),H&&Ve._rotate($?this.transform.angle:-this.transform.angle)):Ye=!1}D&&(Ye=!Oe.clipped),Ie.textBox&&oh(r.textCollisionBox.collisionVertexArray,Oe.text.placed,!Ye||Qe,Ve.x,Ve.y),Ie.verticalTextBox&&oh(r.textCollisionBox.collisionVertexArray,Oe.text.placed,!Ye||Je,Ve.x,Ve.y)}let ft=Ye&&!!(!Je&&Ie.verticalIconBox);Ie.iconBox&&oh(r.iconCollisionBox.collisionVertexArray,Oe.icon.placed,ft,oe.hasIconTextFit?Ve.x:0,oe.hasIconTextFit?Ve.y:0),Ie.verticalIconBox&&oh(r.iconCollisionBox.collisionVertexArray,Oe.icon.placed,!ft,oe.hasIconTextFit?Ve.x:0,oe.hasIconTextFit?Ve.y:0)}}}if(r.fullyClipped=Q===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){let re=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=re.invProjMatrix,r.placementViewportMatrix=re.viewportMatrix,r.collisionCircleArray=re.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,h){let g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>r}setStale(){this.stale=!0}}function oh(f,r,h,g,v){f.emplaceBack(r?1:0,h?1:0,g||0,v||0),f.emplaceBack(r?1:0,h?1:0,g||0,v||0),f.emplaceBack(r?1:0,h?1:0,g||0,v||0),f.emplaceBack(r?1:0,h?1:0,g||0,v||0)}let Wp=Math.pow(2,25),pt=Math.pow(2,24),s_=Math.pow(2,17),Gp=Math.pow(2,16),qp=Math.pow(2,9),l_=Math.pow(2,8),Tu=Math.pow(2,1);function Ma(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let r=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Wp+r*pt+h*s_+r*Gp+h*qp+r*l_+h*Tu+r}let Es=0;class fl{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,h,g,v,x){let S=this._bucketParts;for(;this._currentTileIndex<r.length;)if(h.getBucketParts(S,v,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((k,D)=>k.sortKey-D.sortKey));this._currentPartIndex<S.length;){let k=S[this._currentPartIndex];if(h.placeLayerBucketPart(k,this._seenCrossTileIDs,g,k.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Iu{constructor(r,h,g,v,x,S,k,D,A){this.placement=new No(r,x,S,k,D,A),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(r,h,g,v){let x=i.e.now(),S=()=>{let k=i.e.now()-x;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){let k=h[r[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=D)&&(!k.maxzoom||k.maxzoom>D)){let A=k,L=A.layout.get("symbol-z-elevate"),z=this._inProgressLayer=this._inProgressLayer||new fl(A),U=i.al(k.source,k.scope);if(z.continuePlacement(L?v[U]:g[U],this.placement,this._showCollisionBoxes,k,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}let Ds=512/i.a3/2;class Ly{constructor(r,h,g){this.tileID=r,this.bucketInstanceId=g,this.index=new i.cK(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let v=r.canonical.x*i.a3,x=r.canonical.y*i.a3;for(let S=0;S<h.length;S++){let{key:k,crossTileID:D,tileAnchorX:A,tileAnchorY:L}=h.get(S),z=Math.floor((v+A)*Ds),U=Math.floor((x+L)*Ds);this.index.add(z,U),this.keys.push(k),this.crossTileIDs.push(D)}this.index.finish()}findMatches(r,h,g){let v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),x=Ds/Math.pow(2,h.canonical.z-this.tileID.canonical.z),S=h.canonical.x*i.a3,k=h.canonical.y*i.a3;for(let D=0;D<r.length;D++){let A=r.get(D);if(A.crossTileID)continue;let{key:L,tileAnchorX:z,tileAnchorY:U}=A,H=Math.floor((S+z)*x),$=Math.floor((k+U)*x),Y=this.index.range(H-v,$-v,H+v,$+v);for(let Z of Y){let Q=this.crossTileIDs[Z];if(this.keys[Z]===L&&!g.has(Q)){g.add(Q),A.crossTileID=Q;break}}}}}class Fy{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class $p{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){let h=Math.round((r-this.lng)/360);if(h!==0)for(let g in this.indexes){let v=this.indexes[g],x={};for(let S in v){let k=v[S];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+h),x[k.tileID.key]=k}this.indexes[g]=x}this.lng=r}addBucket(r,h,g){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);let v=this.usedCrossTileIDs[r.overscaledZ];for(let x in this.indexes){let S=this.indexes[x];if(Number(x)>r.overscaledZ)for(let k in S){let D=S[k];D.tileID.isChildOf(r)&&D.findMatches(h.symbolInstances,r,v)}else{let k=S[r.scaledTo(Number(x)).key];k&&k.findMatches(h.symbolInstances,r,v)}}for(let x=0;x<h.symbolInstances.length;x++){let S=h.symbolInstances.get(x);S.crossTileID||(S.crossTileID=g.generate(),v.add(S.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Ly(r,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(r,h){for(let g of h.crossTileIDs)this.usedCrossTileIDs[r].delete(g)}removeStaleBuckets(r){let h=!1;for(let g in this.indexes){let v=this.indexes[g];for(let x in v)r[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[x]),delete v[x],h=!0)}return h}}class zy{constructor(){this.layerIndexes={},this.crossTileIDs=new Fy,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,h,g,v){let x=this.layerIndexes[r.fqid];x===void 0&&(x=this.layerIndexes[r.fqid]=new $p);let S=!1,k={};v.name!=="globe"&&x.handleWrapJump(g);for(let D of h){let A=D.getBucket(r);A&&r.fqid===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(D.tileID,A,this.crossTileIDs)&&(S=!0),k[A.bucketInstanceId]=!0)}return x.removeStaleBuckets(k)&&(S=!0),S}pruneUnusedLayers(r){let h={};r.forEach(g=>{h[g]=!0});for(let g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}let c_=new i.N({data:new i.O(i.L.colorTheme.data)}),As=(f,r)=>ii(f,r&&r.filter(h=>h.identifier!=="source.canvas")),Yp=i.ah(Ai,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),By=i.ah(Ai,["setCenter","setZoom","setBearing","setPitch"]),d_={version:8,layers:[],sources:{}},h_={duration:300,delay:0};class ca extends i.E{constructor(r,h={}){super(),this.map=r,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=i.W({},h_),this._buildingIndex=new Py(this),this.crossTileSymbolIndex=new zy,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new Ut,this.dispatcher=h.dispatcher?h.dispatcher:new i.bw(i.bx(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Ed,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new i.cM(r._requestManager,h.localFontFamily?i.cN.all:h.localIdeographFontFamily?i.cN.ideographs:i.cN.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new eu(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",i.cO());let g=this;this._rtlTextPluginCallback=ca.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,S)=>{if(i.cP(x),S&&S.every(k=>k))for(let k in g._sourceCaches){let D=g._sourceCaches[k],A=D.getSource().type;A!=="vector"&&A!=="geojson"||D.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(let S in this._layers){let k=this._layers[S];k.source===x.id&&this._validateLayer(k)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(i.cQ(r))return r;let h=i.cR(r);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${i.cS(JSON.stringify(r))}`}_diffStyle(r,h,g){this.globalId=this._getGlobalId(r);let v=(x,S)=>{try{S(null,this.setState(x,g))}catch(k){S(k,!1)}};if(typeof r=="string"){let x=this.map._requestManager.normalizeStyleURL(r),S=this.map._requestManager.transformRequest(x,i.R.Style);i.g(S,(k,D)=>{k?this.fire(new i.d(k)):D&&v(D,h)})}else typeof r=="object"&&v(r,h)}loadURL(r,h={}){this.fire(new i.f("dataloading",{dataType:"style"}));let g=typeof h.validate=="boolean"?h.validate:!i.cQ(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,h.accessToken),this.resolvedImports.add(r);let v=this.importsCache.get(r);if(v)return this._load(v,g);let x=this.map._requestManager.transformRequest(r,i.R.Style);this._request=i.g(x,(S,k)=>{if(this._request=null,S)this.fire(new i.d(S));else if(k)return this.importsCache.set(r,k),this._load(k,g)})}loadJSON(r,h={}){this.fire(new i.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=i.e.frame(()=>{this._request=null,this._load(r,h.validate!==!1)})}loadEmpty(){this.fire(new i.f("dataloading",{dataType:"style"})),this._load(d_,!1)}_loadImports(r,h,g){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let v=[];for(let x of r){let S=this._createFragmentStyle(x),k=new Promise(L=>{S.once("style.import.load",L),S.once("error",L)}).then(()=>this.mergeAll());if(v.push(k),this.resolvedImports.has(x.url)){S.loadEmpty();continue}let D=x.data||this.importsCache.get(x.url);D?(S.loadJSON(D,{validate:h}),this._isInternalStyle(D)&&(S.globalId=null)):x.url?S.loadURL(x.url,{validate:h}):S.loadEmpty();let A={style:S,id:x.id,config:x.config};if(g){let L=this.fragments.findIndex(({id:z})=>z===g);this.fragments=this.fragments.slice(0,L).concat(A).concat(this.fragments.slice(L))}else this.fragments.push(A)}return Promise.allSettled(v)}getImportGlobalIds(r=this,h=new Set){for(let g of r.fragments)g.style.globalId&&h.add(g.style.globalId),this.getImportGlobalIds(g.style,h);return[...h.values()]}_createFragmentStyle(r){let h=this.scope?i.al(r.id,this.scope):r.id,g,v=this._initialConfig&&this._initialConfig[h];(r.config||v)&&(g=i.W({},r.config,v));let x=new ca(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,h){let g=r.schema;if(this._isInternalStyle(r)){let S=i.W({},d_,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(S,h)}if(this.updateConfig(this._config,g),h&&As(this,_e(r)))return;this._loaded=!0,this.stylesheet=i.cT(r);let v=()=>{for(let A in r.sources)this.addSource(A,r.sources[A],{validate:!1,isInitialLoad:!0});r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(r.glyphs,this.scope);let S=jp(this.stylesheet.layers);if(this._order=S.map(A=>A.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let A=this.stylesheet.lights[0];this.light=new At(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new At(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let A of S){let L=i.cY(A,this.scope,this._styleColorTheme.lut,this.options);L.isConfigDependent&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L,this._serializedLayers[L.id]=L.serialize();let z=this.getOwnLayerSourceCache(L),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&L.canCastShadows()&&U&&(z.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.f("data",{dataType:"style"}));let D=this.isRootStyle();r.imports?this._loadImports(r.imports,h).then(()=>{this._reloadImports(),this.fire(new i.f(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.f(D?"style.load":"style.import.load")))},x=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=x,x){let S=this._evaluateColorThemeData(x);this._loadColorTheme(S).then(()=>{v()}).catch(k=>{i.w(`Couldn't load color theme from the stylesheet: ${k}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,h,g,v,x,S,k,D,A={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(L=>{if(L.stylesheet){if(L.light!=null&&(r=L.light),L.stylesheet.lights)for(let z of L.stylesheet.lights)z.type==="ambient"&&L.ambientLight!=null&&(h=L.ambientLight),z.type==="directional"&&L.directionalLight!=null&&(g=L.directionalLight);v=this._prioritizeTerrain(v,L.terrain,L.stylesheet.terrain),L.stylesheet.fog&&L.fog!=null&&(x=L.fog),L.stylesheet.camera!=null&&(D=L.stylesheet.camera),L.stylesheet.projection!=null&&(S=L.stylesheet.projection),L.stylesheet.transition!=null&&(k=L.stylesheet.transition),A[L.scope]=L._styleColorTheme}}),this.light=r,this.ambientLight=h,this.directionalLight=g,this.fog=x,this._styleColorThemeForScope=A,v===null?delete this.terrain:this.terrain=v,this.camera=D||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=i.W({},h_,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){let h=g=>{for(let v of g.fragments)h(v.style);r(g)};h(this)}_prioritizeTerrain(r,h,g){let v=r&&r.drapeRenderMode===0;return g===null?h&&h.drapeRenderMode===0?h:v?r:null:h!=null&&(!r||v||h&&h.drapeRenderMode===1)?h:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{r=this._prioritizeTerrain(r,h.terrain,h.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(r=h.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){let r={},h={},g={};this.forEachFragmentStyle(v=>{for(let x in v._sourceCaches){let S=i.al(x,v.scope);r[S]=v._sourceCaches[x]}for(let x in v._otherSourceCaches){let S=i.al(x,v.scope);h[S]=v._otherSourceCaches[x]}for(let x in v._symbolSourceCaches){let S=i.al(x,v.scope);g[S]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=g}mergeLayers(){let r={},h=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(let k of S._order){let D=S._layers[k];if(D.type==="slot"){let A=i.cU(k);if(r[A])continue;r[A]=[]}D.slot&&r[D.slot]?r[D.slot].push(D):h.push(D)}}),this._mergedOrder=[],this._clipLayerIndices=[];let v=0,x=(S=[])=>{for(let k of S)if(k.type==="slot"){let D=i.cU(k.id);r[D]&&x(r[D]),this._mergedSlots.push(D)}else{let D=i.al(k.id,k.scope);this._mergedOrder.push(D),g[D]=k,k.is3D()&&(this._has3DLayers=!0),k.type==="circle"&&(this._hasCircleLayers=!0),k.type==="symbol"&&(this._hasSymbolLayers=!0),k.type==="clip"&&this._clipLayerIndices.push(v),v++}};x(h),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=i.W({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(h,g,v){let x=i.W({},g);for(let k of Object.keys(i.L.colorTheme))x[k]===void 0&&(x[k]=i.L.colorTheme[k].default);let S=new i.U(c_,h,new Map(v));return S.setTransitionOrValue(x,v),S.untransitioned().possiblyEvaluate(new i.X(0))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){return this._styleColorTheme.lutLoading=!0,new Promise((h,g)=>{let v="data:image/png;base64,";if(r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();r.startsWith(v)||(r=v+r);let x="mapbox-reserved-lut",S=new Image;S.src=r,S.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},S.onload=()=>{this._styleColorTheme.lutLoading=!1;let{width:k,height:D,data:A}=i.e.getImageData(S);if(D>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(k!==D*D)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(x)&&this.removeImage(x),this.addImage(x,{data:new i.i({width:k,height:D},A),pixelRatio:1,sdf:!1,version:0});let L=this.imageManager.getImage(x,this.scope);L?(this._styleColorTheme.lut={image:L.data,data:r},h()):g(new Error("Missing LUT image."))}})}getLut(r){let h=this._styleColorThemeForScope[r];return h?h.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(h,g,v){let x,S,k,D=i.e.devicePixelRatio>1?"@2x":"",A=i.g(g.transformRequest(g.normalizeSpriteURL(h,D,".json"),i.R.SpriteJSON),(U,H)=>{A=null,k||(k=U,x=H,z())}),L=i.h(g.transformRequest(g.normalizeSpriteURL(h,D,".png"),i.R.SpriteImage),(U,H)=>{L=null,k||(k=U,S=H,z())});function z(){if(k)v(k);else if(x&&S){let U=i.e.getImageData(S),H={};for(let $ in x){let{width:Y,height:Z,x:Q,y:re,sdf:oe,pixelRatio:ae,stretchX:ge,stretchY:fe,content:ne}=x[$],se=new i.i({width:Y,height:Z});i.i.copy(U,se,{x:Q,y:re},{x:0,y:0},{width:Y,height:Z},null),H[$]={data:se,pixelRatio:ae,sdf:oe,stretchX:ge,stretchY:fe,content:ne}}v(null,H)}}return{cancel(){A&&(A.cancel(),A=null),L&&(L.cancel(),L=null)}}}(r,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new i.d(h));else if(g)for(let v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.f("data",{dataType:"style"}))})}_validateLayer(r){let h=this.getOwnSource(r.source);if(!h)return;let g=r.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new i.d(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,h)=>{let g=this.fragments[h];return g&&g.style&&(r.data=g.style.serialize()),r})}_serializeSources(){let r={};for(let h in this._sourceCaches){let g=this._sourceCaches[h].getSource();r[g.id]||(r[g.id]=g.serialize())}return r}_serializeLayers(r){let h=[];for(let g of r){let v=this._layers[g];v&&v.type!=="custom"&&h.push(v.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(let r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){let h=this.getOwnLayer(r);if(h)return h;this.fire(new i.d(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){let h=this.getOwnSource(r);if(h)return h;this.fire(new i.d(new Error(`The source '${r}' does not exist in the map's style.`)))}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);let h=this.calculateLightsBrightness();r.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));let g=this._changes.isDirty(),v=!1;if(this._changes.isDirty()){let S=this._changes.getLayerUpdatesByScope();for(let k in S){let{updatedIds:D,removedIds:A}=S[k];(D||A)&&(this._updateWorkerLayers(k,D,A),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._changes.reset()}let x={};for(let S in this._mergedSourceCaches){let k=this._mergedSourceCaches[S];x[S]=k.used,k.used=!1,k.tileCoverLift=0}for(let S of this._mergedOrder){let k=this._mergedLayers[S];if(k.recalculate(r,this._availableImages),!k.isHidden(r.zoom)){let D=this.getLayerSourceCache(k);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,k.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let D=k.minzoom||0;D<(k.maxzoom||25.5);D++){let A=this.map.painter;if(A){let L=k.getProgramIds();if(!L)continue;for(let z of L){let U=k.getDefaultProgramParams(z,r.zoom,this._styleColorTheme.lut);U&&(A.style=this,this.fog&&(A._fogVisible=!0,U.overrideFog=!0,A.getOrCreateProgram(z,U)),A._fogVisible=!1,U.overrideFog=!1,A.getOrCreateProgram(z,U),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(U.overrideRtt=!0,A.getOrCreateProgram(z,U)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(let S in x){let k=this._mergedSourceCaches[S];x[S]!==k.used&&k.getSource().fire(new i.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new i.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let r=this._changes.getUpdatedImages();if(r.length){for(let h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],r);this._changes.resetUpdatedImages()}}_updateWorkerLayers(r,h,g){let v=this.getFragmentStyle(r);v&&this.dispatcher.broadcast("updateLayers",{layers:h?v._serializeLayers(h):[],scope:r,removedIds:g||[],options:v.options})}setState(r,h){if(this._checkLoaded(),As(this,_e(r)))return!1;(r=i.cT(r)).layers=jp(r.layers);let g=function(S,k){if(!S)return[{command:Ai.setStyle,args:[k]}];let D=[];try{if(!_(S.version,k.version))return[{command:Ai.setStyle,args:[k]}];if(_(S.center,k.center)||D.push({command:Ai.setCenter,args:[k.center]}),_(S.zoom,k.zoom)||D.push({command:Ai.setZoom,args:[k.zoom]}),_(S.bearing,k.bearing)||D.push({command:Ai.setBearing,args:[k.bearing]}),_(S.pitch,k.pitch)||D.push({command:Ai.setPitch,args:[k.pitch]}),_(S.sprite,k.sprite)||D.push({command:Ai.setSprite,args:[k.sprite]}),_(S.glyphs,k.glyphs)||D.push({command:Ai.setGlyphs,args:[k.glyphs]}),_(S.imports,k.imports)||function(H=[],$=[],Y){$=$||[];let Z=(H=H||[]).map(Mu),Q=$.map(Mu),re=H.reduce(Tc,{}),oe=$.reduce(Tc,{}),ae=Z.slice(),ge,fe,ne,se;for(ge=0,fe=0;ge<Z.length;ge++)ne=Z[ge],oe.hasOwnProperty(ne)?fe++:(Y.push({command:Ai.removeImport,args:[ne]}),ae.splice(ae.indexOf(ne,fe),1));for(ge=0,fe=0;ge<Q.length;ge++)ne=Q[Q.length-1-ge],ae[ae.length-1-ge]!==ne&&(re.hasOwnProperty(ne)?(Y.push({command:Ai.removeImport,args:[ne]}),ae.splice(ae.lastIndexOf(ne,ae.length-fe),1)):fe++,se=ae[ae.length-ge],Y.push({command:Ai.addImport,args:[oe[ne],se]}),ae.splice(ae.length-ge,0,ne));for(let le of $){let we=re[le.id];we&&!_(we,le)&&Y.push({command:Ai.updateImport,args:[le.id,le]})}}(S.imports,k.imports,D),_(S.transition,k.transition)||D.push({command:Ai.setTransition,args:[k.transition]}),_(S.light,k.light)||D.push({command:Ai.setLight,args:[k.light]}),_(S.fog,k.fog)||D.push({command:Ai.setFog,args:[k.fog]}),_(S.projection,k.projection)||D.push({command:Ai.setProjection,args:[k.projection]}),_(S.lights,k.lights)||D.push({command:Ai.setLights,args:[k.lights]}),_(S.camera,k.camera)||D.push({command:Ai.setCamera,args:[k.camera]}),!_(S["color-theme"],k["color-theme"]))return[{command:Ai.setStyle,args:[k]}];let A={},L=[];(function(H,$,Y,Z){let Q;for(Q in $=$||{},H=H||{})H.hasOwnProperty(Q)&&($.hasOwnProperty(Q)||n_(Q,Y,Z));for(Q in $){if(!$.hasOwnProperty(Q))continue;let re=$[Q];H.hasOwnProperty(Q)?_(H[Q],re)||(H[Q].type==="geojson"&&re.type==="geojson"&&Ry(H,$,Q)?Y.push({command:Ai.setGeoJSONSourceData,args:[Q,re.data]}):Oy(Q,$,Y,Z)):$a(Q,$,Y)}})(S.sources,k.sources,L,A);let z=[];S.layers&&S.layers.forEach(H=>{H.source&&A[H.source]?D.push({command:Ai.removeLayer,args:[H.id]}):z.push(H)});let U=S.terrain;U&&A[U.source]&&(D.push({command:Ai.setTerrain,args:[void 0]}),U=void 0),D=D.concat(L),_(U,k.terrain)||D.push({command:Ai.setTerrain,args:[k.terrain]}),function(H,$,Y){$=$||[];let Z=(H=H||[]).map(Mu),Q=$.map(Mu),re=H.reduce(Tc,{}),oe=$.reduce(Tc,{}),ae=Z.slice(),ge=Object.create(null),fe,ne,se,le,we,Oe,ue;for(fe=0,ne=0;fe<Z.length;fe++)se=Z[fe],oe.hasOwnProperty(se)?ne++:(Y.push({command:Ai.removeLayer,args:[se]}),ae.splice(ae.indexOf(se,ne),1));for(fe=0,ne=0;fe<Q.length;fe++)se=Q[Q.length-1-fe],ae[ae.length-1-fe]!==se&&(re.hasOwnProperty(se)?(Y.push({command:Ai.removeLayer,args:[se]}),ae.splice(ae.lastIndexOf(se,ae.length-ne),1)):ne++,Oe=ae[ae.length-fe],Y.push({command:Ai.addLayer,args:[oe[se],Oe]}),ae.splice(ae.length-fe,0,se),ge[se]=!0);for(fe=0;fe<Q.length;fe++)if(se=Q[fe],le=re[se],we=oe[se],!ge[se]&&!_(le,we))if(_(le.source,we.source)&&_(le["source-layer"],we["source-layer"])&&_(le.type,we.type)){for(ue in th(le.layout,we.layout,Y,se,null,Ai.setLayoutProperty),th(le.paint,we.paint,Y,se,null,Ai.setPaintProperty),_(le.slot,we.slot)||Y.push({command:Ai.setSlot,args:[se,we.slot]}),_(le.filter,we.filter)||Y.push({command:Ai.setFilter,args:[se,we.filter]}),_(le.minzoom,we.minzoom)&&_(le.maxzoom,we.maxzoom)||Y.push({command:Ai.setLayerZoomRange,args:[se,we.minzoom,we.maxzoom]}),le)le.hasOwnProperty(ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&ue!=="slot"&&(ue.indexOf("paint.")===0?th(le[ue],we[ue],Y,se,ue.slice(6),Ai.setPaintProperty):_(le[ue],we[ue])||Y.push({command:Ai.setLayerProperty,args:[se,ue,we[ue]]}));for(ue in we)we.hasOwnProperty(ue)&&!le.hasOwnProperty(ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&ue!=="slot"&&(ue.indexOf("paint.")===0?th(le[ue],we[ue],Y,se,ue.slice(6),Ai.setPaintProperty):_(le[ue],we[ue])||Y.push({command:Ai.setLayerProperty,args:[se,ue,we[ue]]}))}else Y.push({command:Ai.removeLayer,args:[se]}),Oe=ae[ae.lastIndexOf(se)+1],Y.push({command:Ai.addLayer,args:[we,Oe]})}(z,k.layers,D)}catch(A){console.warn("Unable to compute style diff:",A),D=[{command:Ai.setStyle,args:[k]}]}return D}(this.serialize(),r).filter(S=>!(S.command in By));if(g.length===0)return!1;let v=g.filter(S=>!(S.command in Yp));if(v.length>0)throw new Error(`Unimplemented: ${v.map(S=>S.command).join(", ")}.`);let x=[];return g.forEach(S=>{x.push(this[S.command].apply(this,S.args))}),h&&Promise.all(x).then(h),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(r,h){return this.getImage(r)?this.fire(new i.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,this.scope,h),this._afterImageUpdated(r),this)}updateImage(r,h){this.imageManager.updateImage(r,this.scope,h)}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._afterImageUpdated(r),this):this.fire(new i.d(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(r),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new i.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(r,h,g={}){return this._checkLoaded(),this._validate(mi,`models.${r}`,h,null,g)||(this.modelManager.addModel(r,h,this.scope),this._changes.setDirty()),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this):this.fire(new i.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,h,g={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(be,`sources.${r}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);let v=mu(r,h,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));let x=S=>{let k=(S?"symbol:":"other:")+v.id,D=i.al(k,this.scope),A=this._sourceCaches[k]=new i.bv(D,v,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=A,A.onAdd(this.map)};x(!1),h.type!=="vector"&&h.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();let h=this.getOwnSource(r);if(!h)throw new Error("There is no source with this ID");for(let v in this._layers)if(this._layers[v].source===r)return this.fire(new i.d(new Error(`Source "${r}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new i.d(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));let g=this.getOwnSourceCaches(r);for(let v of g){let x=i.cU(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new i.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,h){this._checkLoaded(),this.getOwnSource(r).setData(h),this._changes.setDirty()}getOwnSource(r){let h=this.getOwnSourceCache(r);return h&&h.getSource()}getOwnSources(){let r=[];for(let h in this._otherSourceCaches){let g=this.getOwnSourceCache(h);g&&r.push(g.getSource())}return r}areTilesLoaded(){let r=this._mergedSourceCaches;for(let h in r){let g=r[h]._tiles;for(let v in g){let x=g[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;let h=this._getTransitionParameters();for(let v of r){if(this._validate(Ne,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(v),x.updateTransitions(h)}else this.ambientLight=new Pd(v,ci,this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(v),x.updateTransitions(h)}else this.directionalLight=new Pd(v,ip,this.scope,this.options)}}let g=new i.X(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let r=this.directionalLight,h=this.ambientLight;if(!r||!h)return;let g=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),v=r.properties.get("color").toRenderColor(null).toArray01(),x=r.properties.get("intensity"),S=r.properties.get("direction"),k=1-i.ac(S.x,S.y,S.z)[2]/90,D=g(v)*x*k,A=h.properties.get("color").toRenderColor(null).toArray01(),L=h.properties.get("intensity");return(D+g(A)*L)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(!r)return this;if(i.cV(r)){let h=i.cW(r),g=this.fragments.find(({id:x})=>x===h);if(!g)throw new Error(`Style import not found: ${r}`);let v=i.cU(r);return g.style.getFragmentStyle(v)}{let h=this.fragments.find(({id:g})=>g===r);if(!h)throw new Error(`Style import not found: ${r}`);return h.style}}getConfigProperty(r,h){let g=this.getFragmentStyle(r);if(!g)return null;let v=i.al(h,g.scope),x=g.options.get(v),S=x?x.value||x.default:null;return S?S.serialize():null}setConfigProperty(r,h,g){let v=this.getFragmentStyle(r);if(!v)return;let x=v.stylesheet.schema;if(!x||!x[h])return;let S=i.y(g);if(S.result!=="success")return void As(this,S.value);let k=S.value.expression,D=i.al(h,v.scope),A=v.options.get(D);if(!A)return;let L,{minValue:z,maxValue:U,stepValue:H,type:$,values:Y}=x[h],Z=i.y(x[h].default);Z.result==="success"&&(L=Z.value.expression),L?(this.options.set(D,Pa($i({},A),{value:k,default:L,minValue:z,maxValue:U,stepValue:H,type:$,values:Y})),this.updateConfigDependencies()):this.fire(new i.d(new Error(`No schema defined for the config option "${h}" in the "${r}" fragment.`)))}getConfig(r){let h=this.getFragmentStyle(r);if(!h)return null;let g=h.stylesheet.schema;if(!g)return null;let v={};for(let x in g){let S=i.al(x,h.scope),k=h.options.get(S),D=k?k.value||k.default:null;v[x]=D?D.serialize():null}return v}setConfig(r,h){let g=this.getFragmentStyle(r);g&&(g.updateConfig(h,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){let h=this.getFragmentStyle(r);return h?h.stylesheet.schema:null}setSchema(r,h){let g=this.getFragmentStyle(r);g&&(g.stylesheet.schema=h,g.updateConfig(g._config,h),this.updateConfigDependencies())}updateConfig(r,h){if(this._config=r,r||h)if(h)for(let g in h){let v,x,S=i.y(h[g].default);if(S.result==="success"&&(v=S.value.expression),r&&r[g]!==void 0){let U=i.y(r[g]);U.result==="success"&&(x=U.value.expression)}let{minValue:k,maxValue:D,stepValue:A,type:L,values:z}=h[g];if(v){let U=i.al(g,this.scope);this.options.set(U,{default:v,value:x,minValue:k,maxValue:D,stepValue:A,type:L,values:z})}else this.fire(new i.d(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new i.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let r of this._configDependentLayers){let h=this.getLayer(r);h&&(h.possiblyEvaluateVisibility(),this._updateLayer(h))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(r=>{if(r._styleColorTheme.colorTheme){let h=r._evaluateColorThemeData(r._styleColorTheme.colorTheme);(!r._styleColorTheme.lut||r._styleColorTheme.lut&&h!==r._styleColorTheme.lut.data)&&r.setColorTheme(r._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(r,h,g={}){this._checkLoaded();let v=r.id;if(this._layers[v])return void this.fire(new i.d(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(r.type==="custom"){if(As(this,i.cX(r)))return;x=i.cY(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(v,r.source),r=i.cT(r),r=i.W(r,{source:v})),this._validate(mt,`layers.${v}`,r,{arrayIndex:-1},g))return;x=i.cY(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize()}x.isConfigDependent&&this._configDependentLayers.add(x.fqid);let S=this._order.length;if(h){let L=this._order.indexOf(h);if(L===-1)return void this.fire(new i.d(new Error(`Layer with id "${h}" does not exist on this map.`)));x.slot===this._layers[h].slot?S=L:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,v),this._layerOrderChanged=!0,this._layers[v]=x;let k=this.getOwnLayerSourceCache(x),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&x.canCastShadows()&&D&&(k.castsShadows=!0);let A=this._changes.getRemovedLayer(x);if(A&&x.source&&k&&x.type!=="custom"){this._changes.discardLayerRemoval(x);let L=i.al(x.source,x.scope);A.type!==x.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),k.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(r,h){this._checkLoaded();let g=this._checkLayer(r);if(!g||r===h)return;let v=this._order.indexOf(r);this._order.splice(v,1);let x=this._order.length;if(h){let S=this._order.indexOf(h);if(S===-1)return void this.fire(new i.d(new Error(`Layer with id "${h}" does not exist on this map.`)));g.slot===this._layers[h].slot?x=S:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();let h=this._checkLayer(r);if(!h)return;h.setEventedParent(null);let g=this._order.indexOf(r);this._order.splice(g,1),delete this._layers[r],delete this._serializedLayers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);let v=this.getOwnLayerSourceCache(h);if(v&&v.castsShadows){let x=!1;for(let S in this._layers)if(this._layers[S].source===h.source&&this._layers[S].canCastShadows()){x=!0;break}v.castsShadows=x}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(let h in this._layers)if(this._layers[h].type===r)return!0;return!1}setLayerZoomRange(r,h,g){this._checkLoaded();let v=this._checkLayer(r);v&&(v.minzoom===h&&v.maxzoom===g||(h!=null&&(v.minzoom=h),g!=null&&(v.maxzoom=g),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,h){this._checkLoaded();let g=this._checkLayer(r);g&&g.slot!==h&&(g.slot=h,this._updateLayer(g))}setFilter(r,h,g={}){this._checkLoaded();let v=this._checkLayer(r);if(v&&!_(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(at,`layers.${v.id}.filter`,h,{layerType:v.type},g)||(v.filter=i.cT(h),this._updateLayer(v)))}getFilter(r){let h=this._checkLayer(r);if(h)return i.cT(h.filter)}setLayoutProperty(r,h,g,v={}){this._checkLoaded();let x=this._checkLayer(r);if(x&&!_(x.getLayoutProperty(h),g)){if(g!=null&&(!v||v.validate!==!1)&&As(x,$t.call(_e,{key:`layers.${r}.layout.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:i.L,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(h,g),x.isConfigDependent&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(r,h){let g=this._checkLayer(r);if(g)return g.getLayoutProperty(h)}setPaintProperty(r,h,g,v={}){this._checkLoaded();let x=this._checkLayer(r);if(!x||_(x.getPaintProperty(h),g)||g!=null&&(!v||v.validate!==!1)&&As(x,Ot.call(_e,{key:`layers.${r}.paint.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:i.L})))return;let S=x.setPaintProperty(h,g);x.isConfigDependent&&this._configDependentLayers.add(x.fqid),S&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(r,h){let g=this._checkLayer(r);if(g)return g.getPaintProperty(h)}setFeatureState(r,h){this._checkLoaded();let g=r.source,v=r.sourceLayer,x=this._checkSource(g);if(!x)return;let S=x.type;if(S==="geojson"&&v)return void this.fire(new i.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!v)return void this.fire(new i.d(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new i.d(new Error("The feature id parameter must be provided.")));let k=this.getOwnSourceCaches(g);for(let D of k)D.setFeatureState(v,r.id,h)}removeFeatureState(r,h){this._checkLoaded();let g=r.source,v=this._checkSource(g);if(!v)return;let x=v.type,S=x==="vector"?r.sourceLayer:void 0;if(x==="vector"&&!S)return void this.fire(new i.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new i.d(new Error("A feature id is required to remove its specific state property.")));let k=this.getOwnSourceCaches(g);for(let D of k)D.removeFeatureState(S,r.id,h)}getFeatureState(r){this._checkLoaded();let h=r.source,g=r.sourceLayer,v=this._checkSource(h);if(v){if(v.type!=="vector"||g)return r.id===void 0&&this.fire(new i.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(g,r.id);this.fire(new i.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=i.W({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return i.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let r=this.getTerrain(),h=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return i.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(r){this._changes.updateLayer(r);let h=this.getLayerSourceCache(r),g=i.al(r.source,r.scope),v=this._changes.getUpdatedSourceCaches();r.source&&!v[g]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),h.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){let h=k=>this._mergedLayers[k].type==="fill-extrusion"||this._mergedLayers[k].type==="model",g=this.order,v={},x=[];for(let k=g.length-1;k>=0;k--){let D=g[k];if(h(D)){v[D]=k;for(let A of r){let L=A[D];if(L)for(let z of L)x.push(z)}}}x.sort((k,D)=>D.intersectionZ-k.intersectionZ);let S=[];for(let k=g.length-1;k>=0;k--){let D=g[k];if(h(D))for(let A=x.length-1;A>=0;A--){let L=x[A].feature;if(L.layer&&v[L.layer.id]<k)break;S.push(L),x.pop()}else for(let A of r){let L=A[D];if(L)for(let z of L)S.push(z.feature)}}return S}queryRenderedFeatures(r,h,g){h&&h.filter&&this._validate(at,"queryRenderedFeatures.filter",h.filter,null,h),h.scope=this.scope,h.availableImages=this._availableImages,h.serializedLayers=this._serializedLayers;let v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new i.d(new Error("parameters.layers must be an Array."))),[];for(let A of h.layers){let L=this._mergedLayers[A];if(!L)return this.fire(new i.d(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];v[L.source]=!0}}let x=[],S=h.serializedLayers||{},k=h&&h.layers?h.layers.some(A=>{let L=this.getLayer(A);return L&&L.is3D()}):this.has3DLayers(),D=Wr.createFromScreenPoints(r,g);for(let A in this._mergedSourceCaches){let L=this._mergedSourceCaches[A].getSource();if(!L||L.scope!==h.scope)continue;let z=this._mergedSourceCaches[A].getSource().id;h.layers&&!v[z]||x.push(Ay(this._mergedSourceCaches[A],this._mergedLayers,S,D,h,g,k,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(A,L,z,U,H,$,Y){let Z={},Q=$.queryRenderedSymbols(U),re=[];for(let oe of Object.keys(Q).map(Number))re.push(Y[oe]);re.sort(Mc);for(let oe of re){let ae=oe.featureIndex.lookupSymbolFeatures(Q[oe.bucketInstanceId],L,oe.bucketIndex,oe.sourceLayerIndex,H.filter,H.layers,H.availableImages,A);for(let ge in ae){let fe=Z[ge]=Z[ge]||[],ne=ae[ge];ne.sort((se,le)=>{let we=oe.featureSortOrder;if(we){let Oe=we.indexOf(se.featureIndex);return we.indexOf(le.featureIndex)-Oe}return le.featureIndex-se.featureIndex});for(let se of ne)fe.push(se)}}for(let oe in Z)Z[oe].forEach(ae=>{let ge=ae.feature,fe=z(A[oe]);if(!fe)return;let ne=fe.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=ne});return Z}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),D.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(r,h){h&&h.filter&&this._validate(at,"querySourceFeatures.filter",h.filter,null,h);let g=this.getOwnSourceCaches(r),v=[];for(let x of g)v=v.concat(eh(x,h));return v}addSourceType(r,h,g){return ca.getSourceType(r)?g(new Error(`A source type called "${r}" already exists.`)):(ca.setSourceType(r,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:h.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,h,g={}){this._checkLoaded();let v=this.light.getLight(),x=!1;for(let k in r)if(!_(r[k],v[k])){x=!0;break}if(!x)return;let S=this._getTransitionParameters();this.light.setLight(r,h,g),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,h=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()&&h!==0||delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=r,v=r.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){let k="terrain-dem-src";this.addSource(k,g.source),g=i.cT(g),g=i.W(g,{source:k})}let x=i.W({},g),S={};if(this.terrain&&v){x.source=this.terrain.get().source;let k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(S.style=k.serialize())}if(this._validate(Te,"terrain",x,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&h!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,h),this.fire(new i.f("data",{dataType:"style"}))}else{let x=this.terrain,S=x.get();for(let k of Object.keys(i.L.terrain))!g.hasOwnProperty(k)&&i.L.terrain[k].default&&(g[k]=i.L.terrain[k].default);for(let k in r)if(!_(r[k],S[k])){x.set(r,this.options),this.stylesheet.terrain=r;let D=this._getTransitionParameters({duration:0});x.updateTransitions(D),this.fire(new i.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){let h=this.fog=new Rg(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let h=this.fog;if(!_(h.get(),r)){h.set(r,this.options),this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}}else this._createFog(r);this._markersNeedUpdate=!0}setColorTheme(r){this._checkLoaded();let h=()=>{for(let v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(let v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=r,!r)return this._styleColorTheme.lut=null,void h();let g=this._evaluateColorThemeData(r);this._loadColorTheme(g).then(()=>{h()}).catch(v=>{i.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(r){return{now:i.e.now(),transition:i.W(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;let r=[],h=[];for(let g in this._mergedLayers)this.isLayerDraped(this._mergedLayers[g])?r.push(g):h.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...h)}_createTerrain(r,h){let g=this.terrain=new Ki(r,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(let r in this._layers){let h=this._layers[r];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(let r in this._layers){let h=this._layers[r];h.type==="symbol"&&this._updateLayer(h)}}_validate(r,h,g,v,x={}){if(x&&x.validate===!1)return!1;let S=i.W({},this.serialize());return As(this,r.call(_e,i.W({key:h,style:S,value:g,styleSpec:i.L},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(let r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(r){let h=this.getSourceCaches(r);for(let g of h)g.clearTiles()}clearSources(){for(let r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){let h=this.getSourceCaches(r);for(let g of h)g.resume(),g.reload()}reloadSources(){for(let r of this.getSources())r.reload&&r.reload()}updateSources(r){let h;this.directionalLight&&(h=Bd(this.directionalLight));for(let g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(r,void 0,void 0,h)}_generateCollisionBoxes(){for(let r in this._sourceCaches){let h=this._sourceCaches[r];h.resume(),h.reload()}}_updatePlacement(r,h,g,v,x,S,k=!1){let D=!1,A=!1,L={},z={};for(let H of this._mergedOrder){let $=this._mergedLayers[H];if($.type!=="symbol")continue;let Y=i.al($.source,$.scope),Z=L[Y];if(!Z){let re=this.getLayerSourceCache($);if(!re)continue;let oe=re.getRenderableIds(!0).map(ae=>re.getTileByID(ae));z[Y]=oe.slice(),Z=L[Y]=oe.sort((ae,ge)=>ge.tileID.overscaledZ-ae.tileID.overscaledZ||(ae.tileID.isLessThan(ge.tileID)?-1:1))}let Q=this.crossTileSymbolIndex.addLayer($,Z,h.center.lng,h.projection);D=D||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),k=k||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new i.f("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.e.now(),h.zoom))&&(this.pauseablePlacement=new Iu(h,this._mergedOrder,k,g,v,x,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.e.now()),A=!0),D&&this.pauseablePlacement.placement.setStale()),A||D){this._buildingIndex.onNewFrame(h.zoom);for(let H=0;H<this._mergedOrder.length;H++){let $=this._mergedLayers[this._mergedOrder[H]];if($.type!=="symbol")continue;let Y=this.isLayerClipped($)&&this._clipLayerIndices.some(Z=>H<Z);this.placement.updateLayerOpacities($,L[i.al($.source,$.scope)],H,Y?S:null)}}let U=!1;for(let H of this._mergedOrder){let $=this._mergedLayers[H];if($.type!=="symbol")continue;let Y=L[i.al($.source,$.scope)];for(let Z of Y){let Q=Z.getBucket($);Q&&Z.latestFeatureIndex&&$.fqid===Q.layerIds[0]&&(U=Q.updateOcclusionOpacities(r.context,r.symbolParams,r._dt)||U)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.e.now())||U,occlusionQueryBasedOpacityChanged:U}}_releaseSymbolFadeTiles(){for(let r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,h){this._checkLoaded();let g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:x})=>x===r.id)!==-1)return void this.fire(new i.d(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!h)return g.push(r),this._loadImports([r],!0);let v=g.findIndex(({id:x})=>x===h);return v===-1&&this.fire(new i.d(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(r).concat(g.slice(v)),this._loadImports([r],!0,h)}updateImport(r,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(r);return v===-1?this:typeof h=="string"?(this.setImportUrl(r,h),this):(h.url&&h.url!==g[v].url&&this.setImportUrl(r,h.url),_(h.config,g[v].config)||this.setImportConfig(r,h.config),_(h.data,g[v].data)||this.setImportData(r,h.data),this)}moveImport(r,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(r);if(v===-1)return this;let x=this.getImportIndex(h);if(x===-1)return this;let S=g[v],k=this.fragments[v];return g=g.filter(({id:D})=>D!==r),this.fragments=this.fragments.filter(({id:D})=>D!==r),this.stylesheet.imports=g.slice(0,x).concat(S).concat(g.slice(x)),this.fragments=this.fragments.slice(0,x).concat(k).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(r,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(r);if(v===-1)return this;g[v].url=h;let x=this.fragments[v];return x.style=this._createFragmentStyle(g[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(h),this}setImportData(r,h){this._checkLoaded();let g=this.getImportIndex(r),v=this.stylesheet.imports||[];return g===-1?this:h?(this.fragments[g].style.setState(h),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(r,v[g].url))}setImportConfig(r,h){this._checkLoaded();let g=this.getImportIndex(r),v=this.stylesheet.imports||[];if(g===-1)return this;h?v[g].config=h:delete v[g].config;let x=this.fragments[g],S=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=h,x.style.updateConfig(h,S),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();let h=this.stylesheet.imports||[],g=this.getImportIndex(r);g!==-1&&(h.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(r){let h=(this.stylesheet.imports||[]).findIndex(g=>g.id===r);return h===-1&&this.fire(new i.d(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),h}getLayer(r){return this._mergedLayers[r]}getSources(){let r=[];for(let h in this._mergedOtherSourceCaches){let g=this._mergedOtherSourceCaches[h];g&&r.push(g.getSource())}return r}getSource(r,h){let g=this.getSourceCache(r,h);return g&&g.getSource()}getLayerSource(r){let h=this.getLayerSourceCache(r);return h&&h.getSource()}getSourceCache(r,h){let g=i.al(r,h);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(r){let h=i.al(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);let h=[];return this._mergedOtherSourceCaches[r]&&h.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&h.push(this._mergedSymbolSourceCaches[r]),h}updateSourceCaches(){let r=this._changes.getUpdatedSourceCaches();for(let h in r){let g=r[h];g==="reload"?this.reloadSource(h):g==="clear"&&this.clearSource(h)}}updateLayers(r){let h=this._changes.getUpdatedPaintProperties();for(let g of h){let v=this.getLayer(g);v&&v.updateTransitions(r)}}getImages(r,h,g){this.imageManager.getImages(h.icons,h.scope,g),this._updateTilesForChangedImages();let v=x=>{x&&x.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(r,h,g){this.glyphManager.getGlyphs(h.stacks,h.scope,g)}getResource(r,h,g){return i.c$(h,g)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){let h=[];return this._otherSourceCaches[r]&&h.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&h.push(this._symbolSourceCaches[r]),h}_isSourceCacheLoaded(r){let h=this.getOwnSourceCaches(r);return h.length===0?(this.fire(new i.d(new Error(`There is no source with ID '${r}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,h){if(this._clipLayerIndices.length===0&&r.type!=="fill-extrusion")return!1;let g=r.type==="fill-extrusion"&&r.sourceLayer==="building",v=0;if(r.is3D()){if(g||h&&h.type==="batched-model")return!0;r.type==="model"&&(v=i.cu.Model)}else r.type==="symbol"&&(v=i.cu.Symbol);for(let x of this._clipLayerIndices){let S=this._mergedLayers[this._mergedOrder[x]];if(!S)continue;let k=[];for(let D of S.layout.get("clip-layer-types"))k.push(D==="model"?i.cu.Model:D==="symbol"?i.cu.Symbol:i.cu.FillExtrusion);for(let D of k)if(v&D)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Zp(f,r){let h=!1,g=null,v=()=>{g=null,h&&(f(),g=setTimeout(v,r),h=!1)};return()=>(h=!0,g||v(),g)}ca.getSourceType=function(f){return kr[f]},ca.setSourceType=function(f,r){kr[f]=r},ca.registerForPluginStateChange=i.cL;class Ny{constructor(r){this._hashName=r&&encodeURIComponent(r),i.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Zp(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let r=this._map;if(!r)return"";let h=ah(r);if(this._hashName){let g=this._hashName,v=!1,x=location.hash.slice(1).split("&").map(S=>{let k=S.split("=")[0];return k===g?(v=!0,`${k}=${h}`):S}).filter(S=>S);return v||x.push(`${g}=${h}`),`#${x.join("&")}`}return`#${h}`}_getCurrentHash(){let r=location.hash.replace("#","");if(this._hashName){let h;return r.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return r.split("/")}_onHashChange(){let r=this._map;if(!r)return!1;let h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){let g=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(h[3]||0):r.getBearing();return r.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ah(f,r){let h=f.getCenter(),g=Math.round(100*f.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),S=Math.round(h.lng*x)/x,k=Math.round(h.lat*x)/x,D=f.getBearing(),A=f.getPitch(),L=r?`/${S}/${k}/${g}`:`${g}/${k}/${S}`;return(D||A)&&(L+="/"+Math.round(10*D)/10),A&&(L+=`/${Math.round(A)}`),L}let Eu={linearity:.3,easing:i.d0(0,0,.3,1)},u_=i.W({deceleration:2500,maxSpeed:1400},Eu),Xp=i.W({deceleration:20,maxSpeed:1400},Eu),Du=i.W({deceleration:1e3,maxSpeed:360},Eu),Qp=i.W({deceleration:1e3,maxSpeed:90},Eu);class gl{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.e.now(),settings:r})}_drainInertiaBuffer(){let r=this._inertiaBuffer,h=i.e.now();for(;r.length>0&&h-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let h={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);let g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){let x=sh(h.pan.mag(),g,i.W({},u_,r||{}));v.offset=h.pan.mult(x.amount/h.pan.mag()),v.center=this._map.transform.center,Ic(v,x)}if(h.zoom){let x=sh(h.zoom,g,Xp);v.zoom=this._map.transform.zoom+x.amount,Ic(v,x)}if(h.bearing){let x=sh(h.bearing,g,Du);v.bearing=this._map.transform.bearing+i.at(x.amount,-179,179),Ic(v,x)}if(h.pitch){let x=sh(h.pitch,g,Qp);v.pitch=this._map.transform.pitch+x.amount,Ic(v,x)}if(v.zoom||v.bearing){let x=h.pinchAround===void 0?h.around:h.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Ic(f,r){(!f.duration||f.duration<r.duration)&&(f.duration=r.duration,f.easing=r.easing)}function sh(f,r,h){let{maxSpeed:g,linearity:v,deceleration:x}=h,S=i.at(f*v/(r/1e3),-g,g),k=Math.abs(S)/(x*v);return{easing:h.easing,duration:1e3*k,amount:S*(k/2)}}class Tr extends i.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,g,v={}){let x=ht(h.getCanvasContainer(),g),S=h.unproject(x);super(r,i.W({point:x,lngLat:S,originalEvent:g},v)),this._defaultPrevented=!1,this.target=h}}class Ps extends i.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,g){let v=r==="touchend"?g.changedTouches:g.touches,x=Tt(h.getCanvasContainer(),v),S=x.map(D=>h.unproject(D)),k=x.reduce((D,A,L,z)=>D.add(A.div(z.length)),new i.P(0,0));super(r,{points:x,point:k,lngLats:S,lngLat:h.unproject(k),originalEvent:g}),this._defaultPrevented=!1}}class Au extends i.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,g){super(r,{originalEvent:g}),this._defaultPrevented=!1}}class Kp{constructor(r,h){this._map=r,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Au(r.type,this._map,r))}mousedown(r,h){return this._mousedownPos=h,this._firePreventable(new Tr(r.type,this._map,r))}mouseup(r){this._map.fire(new Tr(r.type,this._map,r))}preclick(r){let h=i.W({},r);h.type="preclick",this._map.fire(new Tr(h.type,this._map,h))}click(r,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Tr(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Tr(r.type,this._map,r))}mouseover(r){this._map.fire(new Tr(r.type,this._map,r))}mouseout(r){this._map.fire(new Tr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ps(r.type,this._map,r))}touchmove(r){this._map.fire(new Ps(r.type,this._map,r))}touchend(r){this._map.fire(new Ps(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ps(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lh{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Tr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Tr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pu{constructor(r,h){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,h){this.isEnabled()&&r.shiftKey&&r.button===0&&(ke(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(r,h){if(!this._active)return;let g=h,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=N("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));let S=Math.min(v.x,g.x),k=Math.max(v.x,g.x),D=Math.min(v.y,g.y),A=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${D}px)`,this._box.style.width=k-S+"px",this._box.style.height=A-D+"px")})}mouseupWindow(r,h){if(!this._active)return;let g=this._startPos,v=h;if(g&&r.button===0){if(this.reset(),qe(),g.x!==v.x||g.y!==v.y)return this._map.fire(new i.f("boxzoomend",{originalEvent:r})),{cameraAnimation:x=>x.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ae(),delete this._startPos,delete this._lastPos}_fireEvent(r,h){return this._map.fire(new i.f(r,{originalEvent:h}))}}function ch(f,r){let h={};for(let g=0;g<f.length;g++)h[f[g].identifier]=r[g];return h}class m_{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){let x=new i.P(0,0);for(let S of v)x._add(S);return x.div(v.length)}(h),this.touches=ch(g,h)))}touchmove(r,h,g){if(this.aborted||!this.centroid)return;let v=ch(g,h);for(let x in this.touches){let S=v[x];(!S||S.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(r,h,g){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class dh{constructor(r){this.singleTap=new m_(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,h,g){this.singleTap.touchstart(r,h,g)}touchmove(r,h,g){this.singleTap.touchmove(r,h,g)}touchend(r,h,g){let v=this.singleTap.touchend(r,h,g);if(v){let x=r.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(v)<30;if(x&&S||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Ou{constructor(){this._zoomIn=new dh({numTouches:1,numTaps:2}),this._zoomOut=new dh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,h,g){this._zoomIn.touchstart(r,h,g),this._zoomOut.touchstart(r,h,g)}touchmove(r,h,g){this._zoomIn.touchmove(r,h,g),this._zoomOut.touchmove(r,h,g)}touchend(r,h,g){let v=this._zoomIn.touchend(r,h,g),x=this._zoomOut.touchend(r,h,g);return v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(v)},{originalEvent:r})}):x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(x)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let hh={0:1,2:2};class Ru{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,h){return!1}_move(r,h){return{}}mousedown(r,h){if(this._lastPoint)return;let g=vt(r);this._correctButton(r,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(r,h){let g=this._lastPoint;if(g){if(r.preventDefault(),this._eventButton!=null&&function(v,x){let S=hh[x];return v.buttons===void 0||(v.buttons&S)!==S}(r,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(r){this._lastPoint&&vt(r)===this._eventButton&&(this._moved&&qe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class p_ extends Ru{mousedown(r,h){super.mousedown(r,h),this._lastPoint&&(this._active=!0)}_correctButton(r,h){return h===0&&!r.ctrlKey}_move(r,h){return{around:h,panDelta:h.sub(r)}}}class Jp extends Ru{_correctButton(r,h){return h===0&&r.ctrlKey||h===2}_move(r,h){let g=.8*(h.x-r.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(r){r.preventDefault()}}class _l extends Ru{_correctButton(r,h){return h===0&&r.ctrlKey||h===2}_move(r,h){let g=-.5*(h.y-r.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(r){r.preventDefault()}}class f_{constructor(r,h){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),i.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(r,h,g){return this._calculateTransform(r,h,g)}touchmove(r,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!i.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,h,g)}}touchend(r,h,g){this._calculateTransform(r,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,h,g){g.length>0&&(this._active=!0);let v=ch(g,h),x=new i.P(0,0),S=new i.P(0,0),k=0;for(let A in v){let L=v[A],z=this._touches[A];z&&(x._add(L),S._add(L.sub(z)),k++,v[A]=L)}if(this._touches=v,k<this._minTouches||!S.mag())return;let D=S.div(k);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(k),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ef{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,h,g){return{}}touchstart(r,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(r,h,g){let v=this._firstTwoTouches;if(!v)return;r.preventDefault();let[x,S]=v,k=Lu(g,h,x),D=Lu(g,h,S);if(!k||!D)return;let A=this._aroundCenter?null:k.add(D).div(2);return this._move([k,D],A,r)}touchend(r,h,g){if(!this._firstTwoTouches)return;let[v,x]=this._firstTwoTouches,S=Lu(g,h,v),k=Lu(g,h,x);S&&k||(this._active&&qe(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Lu(f,r,h){for(let g=0;g<f.length;g++)if(f[g].identifier===h)return r[g]}function g_(f,r){return Math.log(f/r)/Math.LN2}class tf extends ef{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,h){let g=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(g_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:g_(this._distance,g),pinchAround:h}}}function Fu(f,r){return 180*f.angleWith(r)/Math.PI}class nf extends ef{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,h){let g=this._vector;if(this._vector=r[0].sub(r[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Fu(this._vector,g),pinchAround:h}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());let h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;let v=Fu(r,g);return Math.abs(v)<h}}function uh(f){return Math.abs(f.y)>Math.abs(f.x)}class __ extends ef{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,uh(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,h,g){let v=this._lastPoints;if(!v)return;let x=r[0].sub(v[0]),S=r[1].sub(v[1]);return this._map._cooperativeGestures&&!i.d1()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(x,S,g.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(x.y+S.y)/2*-.5})}gestureBeginsVertically(r,h,g){if(this._valid!==void 0)return this._valid;let v=r.mag()>=2,x=h.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;let S=r.y>0==h.y>0;return uh(r)&&uh(h)&&S}}let b_={panStep:100,bearingStep:15,pitchStep:10};class Vy{constructor(){let r=b_;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let h=0,g=0,v=0,x=0,S=0;switch(r.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:r.shiftKey?g=-1:(r.preventDefault(),x=-1);break;case 39:r.shiftKey?g=1:(r.preventDefault(),x=1);break;case 38:r.shiftKey?v=1:(r.preventDefault(),S=-1);break;case 40:r.shiftKey?v=-1:(r.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:k=>{let D=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:mh,zoom:h?Math.round(D)+h*(r.shiftKey?2:1):D,bearing:k.getBearing()+g*this._bearingStep,pitch:k.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-S*this._panStep],center:k.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function mh(f){return f*(2-f)}let Ec=4.000244140625,y_=1/450;class Io{constructor(r,h){this._map=r,this._el=r.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=y_,i.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||i.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY,g=i.e.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%Ec==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),r.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=r,this._delta-=h,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let h=ht(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let h=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){let A=this._type==="wheel"&&Math.abs(this._delta)>Ec?this._wheelZoomRate:this._defaultZoomRate,L=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&L!==0&&(L=1/L);let z=h(),U=Math.pow(2,z),H=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(H*L))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let g=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,x=this._easing,S,k=!1;if(this._type==="wheel"&&v&&x){let A=Math.min((i.e.now()-this._lastWheelEventTime)/200,1),L=x(A);S=i.a2(v,g,L),A<1?this._frameId||(this._frameId=!0):k=!0}else S=g,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=S-h();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let h=i.d2;if(this._prevEase){let g=this._prevEase,v=(i.e.now()-g.start)/g.duration,x=g.easing(v+.01)-g.easing(v),S=.27/Math.sqrt(x*x+1e-4)*.01,k=Math.sqrt(.0729-S*S);h=i.d0(S,k,.25,1)}return this._prevEase={start:i.e.now(),duration:r,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class rf{constructor(r,h){this._clickZoom=r,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,h){return r.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(r.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bu{constructor(){this._tap=new dh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,h,g){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(r,h,g))}touchmove(r,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;let v=h[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,r.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(r,h,g)}touchend(r,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(r,h,g)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class of{constructor(r,h,g){this._el=r,this._mousePan=h,this._touchPan=g}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class af{constructor(r,h,g){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nu{constructor(r,h,g,v){this._el=r,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Dc=f=>f.zoom||f.drag||f.pitch||f.rotate;class sf extends i.f{}class Vu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,h){let g=i._.sub([],h,r);this.radius=i._.length(g[2]<0?i._.div([],g,this.constants):[g[0],g[1],0])}projectRay(r){i._.div(r,r,this.constants),i._.normalize(r,r),i._.mul(r,r,this.constants);let h=i._.scale([],r,this.radius);if(h[2]>0){let g=i._.scale([],[0,0,1],i._.dot(h,[0,0,1])),v=i._.scale([],i._.normalize([],[h[0],h[1],0]),this.radius),x=i._.add([],h,i._.scale([],i._.sub([],i._.add([],v,g),h),2));h[0]=x[0],h[1]=x[1]}return h}}function ph(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class v_{constructor(r,h){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gl(r),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Vu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),i.bp(["handleEvent","handleWindowEvent"],this);let g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,x,S]of this._listeners){let k=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,k,S)}}destroy(){for(let[r,h,g]of this._listeners){let v=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(h,v,g)}}_addDefaultHandlers(r){let h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new Kp(h,r));let v=h.boxZoom=new Pu(h,r);this._add("boxZoom",v);let x=new Ou,S=new zu;h.doubleClickZoom=new rf(S,x),this._add("tapZoom",x),this._add("clickZoom",S);let k=new Bu;this._add("tapDragZoom",k);let D=h.touchPitch=new __(h);this._add("touchPitch",D);let A=new Jp(r),L=new _l(r);h.dragRotate=new af(r,A,L),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);let z=new p_(r),U=new f_(h,r);h.dragPan=new of(g,z,U),this._add("mousePan",z),this._add("touchPan",U,["touchZoom","touchRotate"]);let H=new nf,$=new tf;h.touchZoomRotate=new Nu(g,$,H,k),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new lh(h));let Y=h.scrollZoom=new Io(h,this);this._add("scrollZoom",Y,["mousePan"]);let Z=h.keyboard=new Vy;this._add("keyboard",Z);for(let Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[Q]&&h[Q].enable(r[Q])}_add(r,h,g){this._handlers.push({handlerName:r,handler:h,allowed:g}),this._handlersById[r]=h}stop(r){if(!this._updatingCamera){for(let{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Dc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,h,g){for(let v in r)if(v!==g&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){let h=[];for(let g of r)this._el.contains(g.target)&&h.push(g);return h}handleEvent(r,h){this._updatingCamera=!0;let g=r.type==="renderFrame",v=g?void 0:r,x={needsRenderFrame:!1},S={},k={},D=r.touches?this._getMapTouches(r.touches):void 0,A=D?Tt(this._el,D):g?void 0:ht(this._el,r);for(let{handlerName:U,handler:H,allowed:$}of this._handlers){if(!H.isEnabled())continue;let Y;this._blockedByActive(k,$,U)?H.reset():H[h||r.type]&&(Y=H[h||r.type](r,A,D),this.mergeHandlerResult(x,S,Y,U,v),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||H.isActive())&&(k[U]=H)}let L={};for(let U in this._previousActiveHandlers)k[U]||(L[U]=v);this._previousActiveHandlers=k,(Object.keys(L).length||ph(x))&&(this._changes.push([x,S,L]),this._triggerRenderFrame()),(Object.keys(k).length||ph(x))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:z}=x;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(r,h,g,v,x){if(!g)return;i.W(r,g);let S={handlerName:v,originalEvent:g.originalEvent||x};g.zoomDelta!==void 0&&(h.zoom=S),g.panDelta!==void 0&&(h.drag=S),g.pitchDelta!==void 0&&(h.pitch=S),g.bearingDelta!==void 0&&(h.rotate=S)}_applyChanges(){let r={},h={},g={};for(let[v,x,S]of this._changes)v.panDelta&&(r.panDelta=(r.panDelta||new i.P(0,0))._add(v.panDelta)),v.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(r.around=v.around),v.aroundCoord!==void 0&&(r.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(r.pinchAround=v.pinchAround),v.noInertia&&(r.noInertia=v.noInertia),i.W(h,x),i.W(g,S);this._updateMapTransform(r,h,g),this._changes=[]}_updateMapTransform(r,h,g){let v=this._map,x=v.transform,S=re=>[re.x,re.y,re.z];if((re=>{let oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!ph(r)){let re=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),re!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!ph(r))return void this._fireEvents(h,g,!0);let{panDelta:k,zoomDelta:D,bearingDelta:A,pitchDelta:L,around:z,aroundCoord:U,pinchAround:H}=r;x._isCameraConstrained&&(D>0&&(D=0),x._isCameraConstrained=!1),H!==void 0&&(z=H),(D||(re=>h[re]&&!this._eventsInProgress[re])("drag"))&&z&&(this._dragOrigin=S(x.pointCoordinate3D(z)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),z=z||v.transform.centerPoint,A&&(x.bearing+=A),L&&(x.pitch+=L),x._updateCameraState();let $=[0,0,0];if(k)if(x.projection.name==="mercator"){let re=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(z).dir),oe=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(z.sub(k)).dir);$[0]=oe[0]-re[0],$[1]=oe[1]-re[1]}else{let re=x.pointCoordinate(z);if(x.projection.name==="globe"){k=k.rotate(-x.angle);let oe=x._pixelsPerMercatorPixel/x.worldSize;$[0]=-k.x*i.d3(i.ay(re.y))*oe,$[1]=-k.y*i.d3(x.center.lat)*oe}else{let oe=x.pointCoordinate(z.sub(k));re&&oe&&($[0]=oe.x-re.x,$[1]=oe.y-re.y)}}let Y=x.zoom,Z=[0,0,0];if(D){let re=S(U||x.pointCoordinate3D(z)),oe={dir:i._.normalize([],i._.sub([],re,x._camera.position))};if(oe.dir[2]<0){let ae=x.zoomDeltaToMovement(re,D);i._.scale(Z,oe.dir,ae)}}let Q=i._.add($,$,Z);x._translateCameraConstrained(Q),D&&Math.abs(x.zoom-Y)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(h,g,!0)}_fireEvents(r,h,g){let v=Dc(this._eventsInProgress),x=Dc(r),S={};for(let L in r){let{originalEvent:z}=r[L];this._eventsInProgress[L]||(S[`${L}start`]=z),this._eventsInProgress[L]=r[L]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(let L in S)this._fireEvent(L,S[L]);x&&this._fireEvent("move",x.originalEvent);for(let L in r){let{originalEvent:z}=r[L];this._fireEvent(L,z)}let k={},D;for(let L in this._eventsInProgress){let{handlerName:z,originalEvent:U}=this._eventsInProgress[L];this._handlersById[z].isActive()||(delete this._eventsInProgress[L],D=h[z]||U,k[`${L}end`]=D)}for(let L in k)this._fireEvent(L,k[L]);let A=Dc(this._eventsInProgress);if(g&&(v||x)&&!A){this._updatingCamera=!0;let L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;L?(z(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:D})):(this._map.fire(new i.f("moveend",{originalEvent:D})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,h){this._map.fire(new i.f(r,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new sf("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let bl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class jy extends i.E{constructor(r,h){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,i.bp(["_renderFrameCallback"],this)}getCenter(){return new i.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(r,h){return this.jumpTo({center:r},h)}panBy(r,h,g){return r=i.P.convert(r).mult(-1),this.panTo(this.transform.center,i.W({offset:r},h),g)}panTo(r,h,g){return this.easeTo(i.W({center:r},h),g)}getZoom(){return this.transform.zoom}setZoom(r,h){return this.jumpTo({zoom:r},h),this}zoomTo(r,h,g){return this.easeTo(i.W({zoom:r},h),g)}zoomIn(r,h){return this.zoomTo(this.getZoom()+1,r,h),this}zoomOut(r,h){return this.zoomTo(this.getZoom()-1,r,h),this}getBearing(){return this.transform.bearing}setBearing(r,h){return this.jumpTo({bearing:r},h),this}getPadding(){return this.transform.padding}setPadding(r,h){return this.jumpTo({padding:r},h),this}rotateTo(r,h,g){return this.easeTo(i.W({bearing:r},h),g)}resetNorth(r,h){return this.rotateTo(0,i.W({duration:1e3},r),h),this}resetNorthPitch(r,h){return this.easeTo(i.W({bearing:0,pitch:0,duration:1e3},r),h),this}snapToNorth(r,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,h):this}getPitch(){return this.transform.pitch}setPitch(r,h){return this.jumpTo({pitch:r},h),this}cameraForBounds(r,h){r=i.ai.convert(r);let g=h&&h.bearing||0,v=h&&h.pitch||0,x=r.getNorthWest(),S=r.getSouthEast();return this._cameraForBounds(this.transform,x,S,g,v,h)}_extendPadding(r){let h={top:0,right:0,bottom:0,left:0};return r==null?i.W({},h,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:i.W({},h,r)}_extendCameraOptions(r){return(r=i.W({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,h){let g=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return g/v>r.aspect?g/(2*Math.tan(.5*r.fovX)*r.aspect):v/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,h,g,v,x,S){let k=r.clone(),D=this._extendCameraOptions(S);k.bearing=v,k.pitch=x;let A=i.aI.convert(h),L=i.aI.convert(g),z=.5*(A.lat+L.lat),U=.5*(A.lng+L.lng),H=i.d4(z,U),$=i._.normalize([],H),Y=i._.normalize([],i._.cross([],$,[0,1,0])),Z=i._.cross([],Y,$),Q=[Y[0],Y[1],Y[2],0,Z[0],Z[1],Z[2],0,$[0],$[1],$[2],0,0,0,0,1],re=[H,i.d4(A.lat,A.lng),i.d4(L.lat,A.lng),i.d4(L.lat,L.lng),i.d4(A.lat,L.lng),i.d4(z,A.lng),i.d4(z,L.lng),i.d4(A.lat,U),i.d4(L.lat,U)],oe=i.b6.fromPoints(re.map(Ye=>[i._.dot(Y,Ye),i._.dot(Z,Ye),i._.dot($,Ye)])),ae=i._.transformMat4([],oe.center,Q);i._.squaredLength(ae)===0&&i._.set(ae,0,0,1),i._.normalize(ae,ae),i._.scale(ae,ae,i.cD),k.center=i.d5(ae);let ge=k.getWorldToCameraMatrix(),fe=i.ad.invert(new Float64Array(16),ge);oe=i.b6.applyTransform(oe,i.ad.multiply([],ge,Q));let ne=this._extendAABB(oe,k,D,v);if(!ne)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=ne,i._.transformMat4(ae,ae,ge);let se=.5*(oe.max[2]-oe.min[2]),le=this._minimumAABBFrustumDistance(k,oe),we=i._.scale([],[0,0,1],se),Oe=i._.add(we,ae,we),ue=le+(k.pitch===0?0:i._.distance(ae,Oe)),Re=k.globeCenterInViewSpace,Be=i._.sub([],ae,[Re[0],Re[1],Re[2]]);i._.normalize(Be,Be),i._.scale(Be,Be,ue);let Qe=i._.add([],ae,Be);i._.transformMat4(Qe,Qe,fe);let Je=i.d7/i.cD,Ze=i._.length(Qe),Ie=i.ax(Math.max(Ze*Je-i.d7,Number.EPSILON),0),Ve=Math.min(k.zoomFromMercatorZAdjusted(Ie),D.maxZoom);return Ve>.5*(i.b1+i.aU)?(k.setProjection({name:"mercator"}),k.zoom=Ve,this._cameraForBounds(k,h,g,v,x,S)):{center:k.center,zoom:Ve,bearing:v,pitch:x}}_extendAABB(r,h,g,v){let x=.5*((g.padding.left||0)+(g.padding.right||0)),S=.5*((g.padding.top||0)+(g.padding.bottom||0)),k=S,D=x,A=x,L=S,z=h.width-(D+A),U=h.height-(k+L),H=i._.sub([],r.max,r.min),$=Math.min(z/H[0],U/H[1]),Y=Math.min(h.scaleZoom(h.scale*$),g.maxZoom);if(isNaN(Y))return null;let Z=h.scale/h.zoomScale(Y),Q=new i.b6([r.min[0]-D*Z,r.min[1]-L*Z,r.min[2]],[r.max[0]+A*Z,r.max[1]+k*Z,r.max[2]]),re=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new i.P(g.offset.x,g.offset.y):i.P.convert(g.offset)).rotate(-i.ab(v));return Q.center[0]-=re.x*Z,Q.center[1]+=re.y*Z,Q}queryTerrainElevation(r,h){let g=this.transform.elevation;return g?(h=i.W({},{exaggerated:!0},h),g.getAtPoint(i.Y.fromLngLat(r),null,h.exaggerated)):null}_cameraForBounds(r,h,g,v,x,S){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,h,g,v,x,S);let k=r.clone(),D=this._extendCameraOptions(S);k.bearing=v,k.pitch=x;let A=i.aI.convert(h),L=i.aI.convert(g),z=new i.aI(A.lng,L.lat),U=new i.aI(L.lng,A.lat),H=k.project(A),$=k.project(L),Y=this.queryTerrainElevation(A),Z=this.queryTerrainElevation(L),Q=this.queryTerrainElevation(z),re=this.queryTerrainElevation(U),oe=[[H.x,H.y,Math.min(Y||0,Z||0,Q||0,re||0)],[$.x,$.y,Math.max(Y||0,Z||0,Q||0,re||0)]],ae=i.b6.fromPoints(oe),ge=k.getWorldToCameraMatrix(),fe=i.ad.invert(new Float64Array(16),ge);ae=i.b6.applyTransform(ae,ge);let ne=this._extendAABB(ae,k,D,v);if(!ne)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=ne;let se=.5*i._.sub([],ae.max,ae.min)[2],le=this._minimumAABBFrustumDistance(k,ae),we=[0,0,1,0];i.aA.transformMat4(we,we,ge),i.aA.normalize(we,we);let Oe=i._.scale([],we,le+se),ue=i._.add([],ae.center,Oe);i._.transformMat4(ae.center,ae.center,fe),i._.transformMat4(ue,ue,fe);let Re=[ae.center[0],ae.center[1],ue[2]*k.pixelsPerMeter];i._.scale(Re,Re,1/k.worldSize);let Be=i.d6(Re[0]),Qe=i.ay(Re[1]),Je=Math.min(k._zoomFromMercatorZ(Re[2]),D.maxZoom),Ze=new i.aI(Be,Qe);return k.mercatorFromTransition&&Je<.5*(i.b1+i.aU)?(k.setProjection({name:"globe"}),k.zoom=Je,this._cameraForBounds(k,h,g,v,x,S)):{center:Ze,zoom:Je,bearing:v,pitch:x}}fitBounds(r,h,g){let v=this.cameraForBounds(r,h);return this._fitInternal(v,h,g)}fitScreenCoordinates(r,h,g,v,x){let S=i.P.convert(r),k=i.P.convert(h),D=new i.P(Math.min(S.x,k.x),Math.min(S.y,k.y)),A=new i.P(Math.max(S.x,k.x),Math.max(S.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,k))return this;let L=this.transform.pointLocation3D(D),z=this.transform.pointLocation3D(A),U=this.transform.pointLocation3D(new i.P(D.x,A.y)),H=this.transform.pointLocation3D(new i.P(A.x,D.y)),$=[Math.min(L.lng,z.lng,U.lng,H.lng),Math.min(L.lat,z.lat,U.lat,H.lat)],Y=[Math.max(L.lng,z.lng,U.lng,H.lng),Math.max(L.lat,z.lat,U.lat,H.lat)],Z=v&&v.pitch?v.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,$,Y,g,Z,v);return this._fitInternal(Q,v,x)}_fitInternal(r,h,g){return r?(h=i.W(r,h)).linear?this.easeTo(h,g):this.flyTo(h,g):this}jumpTo(r,h){this.stop();let g=r.preloadOnly?this.transform.clone():this.transform,v=!1,x=!1,S=!1;return"zoom"in r&&g.zoom!==+r.zoom&&(v=!0,g.zoom=+r.zoom),r.center!==void 0&&(g.center=i.aI.convert(r.center)),"bearing"in r&&g.bearing!==+r.bearing&&(x=!0,g.bearing=+r.bearing),"pitch"in r&&g.pitch!==+r.pitch&&(S=!0,g.pitch=+r.pitch),r.padding==null||g.isPaddingEqual(r.padding)||(g.padding=r.padding),r.preloadOnly?(this._preloadTiles(g),this):(this.fire(new i.f("movestart",h)).fire(new i.f("move",h)),v&&this.fire(new i.f("zoomstart",h)).fire(new i.f("zoom",h)).fire(new i.f("zoomend",h)),x&&this.fire(new i.f("rotatestart",h)).fire(new i.f("rotate",h)).fire(new i.f("rotateend",h)),S&&this.fire(new i.f("pitchstart",h)).fire(new i.f("pitch",h)).fire(new i.f("pitchend",h)),this.fire(new i.f("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(bl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,h){let g=this.transform;if(!g.projection.supportsFreeCamera)return i.w(bl),this;this.stop();let v=g.zoom,x=g.pitch,S=g.bearing;g.setFreeCameraOptions(r);let k=v!==g.zoom,D=x!==g.pitch,A=S!==g.bearing;return this.fire(new i.f("movestart",h)).fire(new i.f("move",h)),k&&this.fire(new i.f("zoomstart",h)).fire(new i.f("zoom",h)).fire(new i.f("zoomend",h)),A&&this.fire(new i.f("rotatestart",h)).fire(new i.f("rotate",h)).fire(new i.f("rotateend",h)),D&&this.fire(new i.f("pitchstart",h)).fire(new i.f("pitch",h)).fire(new i.f("pitchend",h)),this.fire(new i.f("moveend",h)),this}easeTo(r,h){this._stop(!1,r.easeId),((r=i.W({offset:[0,0],duration:500,easing:i.d2},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);let g=this.transform,v=this.getZoom(),x=this.getBearing(),S=this.getPitch(),k=this.getPadding(),D="zoom"in r?+r.zoom:v,A="bearing"in r?this._normalizeBearing(r.bearing,x):x,L="pitch"in r?+r.pitch:S,z=this._extendPadding(r.padding),U=i.P.convert(r.offset),H,$,Y;if(g.projection.name==="globe"){let le=i.Y.fromLngLat(g.center),we=U.rotate(-g.angle);le.x+=we.x/g.worldSize,le.y+=we.y/g.worldSize;let Oe=le.toLngLat(),ue=i.aI.convert(r.center||Oe);this._normalizeCenter(ue),H=g.centerPoint.add(we),$=new i.P(le.x,le.y).mult(g.worldSize),Y=new i.P(i.aj(ue.lng),i.ak(ue.lat)).mult(g.worldSize).sub($)}else{H=g.centerPoint.add(U);let le=g.pointLocation(H),we=i.aI.convert(r.center||le);this._normalizeCenter(we),$=g.project(le),Y=g.project(we).sub($)}let Z=g.zoomScale(D-v),Q,re;r.around&&(Q=i.aI.convert(r.around),re=g.locationPoint(Q));let oe=this._zooming||D!==v,ae=this._rotating||x!==A,ge=this._pitching||L!==S,fe=!g.isPaddingEqual(z),ne=le=>we=>{if(oe&&(le.zoom=i.a2(v,D,we)),ae&&(le.bearing=i.a2(x,A,we)),ge&&(le.pitch=i.a2(S,L,we)),fe&&(le.interpolatePadding(k,z,we),H=le.centerPoint.add(U)),Q)le.setLocationAtPoint(Q,re);else{let Oe=le.zoomScale(le.zoom-v),ue=D>v?Math.min(2,Z):Math.max(.5,Z),Re=Math.pow(ue,1-we),Be=le.unproject($.add(Y.mult(we*Re)).mult(Oe));le.setLocationAtPoint(le.renderWorldCopies?Be.wrap():Be,H)}return r.preloadOnly||this._fireMoveEvents(h),le};if(r.preloadOnly){let le=this._emulate(ne,r.duration,g);return this._preloadTiles(le),this}let se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=ae,this._pitching=ge,this._padding=fe,this._easeId=r.easeId,this._prepareEase(h,r.noMoveStart,se),this._ease(ne(g),le=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(h,le)},r),this}_prepareEase(r,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||g.moving||this.fire(new i.f("movestart",r)),this._zooming&&!g.zooming&&this.fire(new i.f("zoomstart",r)),this._rotating&&!g.rotating&&this.fire(new i.f("rotatestart",r)),this._pitching&&!g.pitching&&this.fire(new i.f("pitchstart",r))}_fireMoveEvents(r){this.fire(new i.f("move",r)),this._zooming&&this.fire(new i.f("zoom",r)),this._rotating&&this.fire(new i.f("rotate",r)),this._pitching&&this.fire(new i.f("pitch",r))}_afterEase(r,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let g=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new i.f("zoomend",r)),v&&this.fire(new i.f("rotateend",r)),x&&this.fire(new i.f("pitchend",r)),this.fire(new i.f("moveend",r))}flyTo(r,h){if(this._prefersReducedMotion(r)){let Ve=i.ah(r,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Ve,h)}this.stop(),r=i.W({offset:[0,0],speed:1.2,curve:1.42,easing:i.d2},r);let g=this.transform,v=this.getZoom(),x=this.getBearing(),S=this.getPitch(),k=this.getPadding(),D="zoom"in r?i.at(+r.zoom,g.minZoom,g.maxZoom):v,A="bearing"in r?this._normalizeBearing(r.bearing,x):x,L="pitch"in r?+r.pitch:S,z=this._extendPadding(r.padding),U=g.zoomScale(D-v),H=i.P.convert(r.offset),$=g.centerPoint.add(H),Y=g.pointLocation($),Z=i.aI.convert(r.center||Y);this._normalizeCenter(Z);let Q=g.project(Y),re=g.project(Z).sub(Q),oe=r.curve,ae=Math.max(g.width,g.height),ge=ae/U,fe=re.mag();if("minZoom"in r){let Ve=i.at(Math.min(r.minZoom,v,D),g.minZoom,g.maxZoom),Ye=ae/g.zoomScale(Ve-v);oe=Math.sqrt(Ye/fe*2)}let ne=oe*oe;function se(Ve){let Ye=(ge*ge-ae*ae+(Ve?-1:1)*ne*ne*fe*fe)/(2*(Ve?ge:ae)*ne*fe);return Math.log(Math.sqrt(Ye*Ye+1)-Ye)}function le(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function we(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}let Oe=se(0),ue=function(Ve){return we(Oe)/we(Oe+oe*Ve)},Re=function(Ve){return ae*((we(Oe)*(le(Ye=Oe+oe*Ve)/we(Ye))-le(Oe))/ne)/fe;var Ye},Be=(se(1)-Oe)/oe;if(Math.abs(fe)<1e-6||!isFinite(Be)){if(Math.abs(ae-ge)<1e-6)return this.easeTo(r,h);let Ve=ge<ae?-1:1;Be=Math.abs(Math.log(ge/ae))/oe,Re=function(){return 0},ue=function(Ye){return Math.exp(Ve*oe*Ye)}}r.duration="duration"in r?+r.duration:1e3*Be/("screenSpeed"in r?+r.screenSpeed/oe:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);let Qe=x!==A,Je=L!==S,Ze=!g.isPaddingEqual(z),Ie=Ve=>Ye=>{let ft=Ye*Be,_t=1/ue(ft);Ve.zoom=Ye===1?D:v+Ve.scaleZoom(_t),Qe&&(Ve.bearing=i.a2(x,A,Ye)),Je&&(Ve.pitch=i.a2(S,L,Ye)),Ze&&(Ve.interpolatePadding(k,z,Ye),$=Ve.centerPoint.add(H));let kt=Ye===1?Z:Ve.unproject(Q.add(re.mult(Re(ft))).mult(_t));return Ve.setLocationAtPoint(Ve.renderWorldCopies?kt.wrap():kt,$),Ve._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(h),Ve};if(r.preloadOnly){let Ve=this._emulate(Ie,r.duration,g);return this._preloadTiles(Ve),this}return this._zooming=!0,this._rotating=Qe,this._pitching=Je,this._padding=Ze,this._prepareEase(h,!1),this._ease(Ie(g),()=>this._afterEase(h),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!r){let g=this.handlers;g&&g.stop(!1)}return this}_ease(r,h,g){g.animate===!1||g.duration===0?(r(1),h()):(this._easeStart=i.e.now(),this._easeOptions=g,this._onEaseFrame=r,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let r=Math.min((i.e.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,h){r=i.au(r,-180,180);let g=Math.abs(r-h);return Math.abs(r-360-h)<g&&(r-=360),Math.abs(r+360-h)<g&&(r+=360),r}_normalizeCenter(r){let h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;let g=r.lng-h.center.lng;r.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&i.e.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,h,g){let v=Math.ceil(15*h/1e3),x=[],S=r(g.clone());for(let k=0;k<=v;k++){let D=S(k/v);x.push(D.clone())}return x}_preloadTiles(r,h){}}class x_{constructor(r={}){this.options=r,i.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){let h=this.options&&this.options.compact;return this._map=r,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=N("button","mapboxgl-ctrl-attrib-button",this._container),N("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,h){let g=this._map._getUIString(`AttributionControl.${h}`);r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));let h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.d8.ACCESS_TOKEN}];if(r){let g=h.reduce((v,x,S)=>(x.value&&(v+=`${x.key}=${x.value}${S<h.length-1?"&":""}`),v),"?");r.href=`${i.d8.FEEDBACK_URL}/${g}#${ah(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let h=this._map.style._mergedSourceCaches;for(let v in h){let x=h[v];if(x.used){let S=x.getSource();S.attribution&&r.indexOf(S.attribution)<0&&r.push(S.attribution)}}r.sort((v,x)=>v.length-x.length),r=r.filter((v,x)=>{for(let S=x+1;S<r.length;S++)if(r[S].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));let g=r.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,r.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class w_{constructor(){i.bp(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=N("div","mapboxgl-ctrl");let h=N("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(let h in r){let g=r[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){let r=this._container.children;if(r.length){let h=r[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class C_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){let h=++this._id;return this._queue.push({callback:r,id:h,cancelled:!1}),h}remove(r){let h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(let v of g)if(v.id===r)return void(v.cancelled=!0)}run(r=0){let h=this._currentlyRunning=this._queue;this._queue=[];for(let g of h)if(!g.cancelled&&(g.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function S_(f,r,h){if(f=new i.aI(f.lng,f.lat),r){let g=new i.aI(f.lng-360,f.lat),v=new i.aI(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-h.center.lng)/360),S=h.locationPoint(f).distSqr(r),k=r.x<0||r.y<0||r.x>h.width||r.y>h.height;h.locationPoint(g).distSqr(r)<S&&(k||Math.abs(g.lng-h.center.lng)<x)?f=g:h.locationPoint(v).distSqr(r)<S&&(k||Math.abs(v.lng-h.center.lng)<x)&&(f=v)}for(;Math.abs(f.lng-h.center.lng)>180;){let g=h.locationPoint(f);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}let lf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class fh extends i.E{constructor(r,h){if(super(),(r instanceof HTMLElement||h)&&(r=i.W({element:r},h)),i.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=i.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=N("div");let x=41,S=27,k=q("svg",{display:"block",height:x*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${x}`},this._element),D=q("radialGradient",{id:"shadowGradient"},q("defs",{},k));q("stop",{offset:"10%","stop-opacity":.4},D),q("stop",{offset:"100%","stop-opacity":.05},D),q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=i.P.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});let g=this._element.classList;for(let x in lf)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);let v=r&&r.className?r.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){let r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=i.aI.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){let v=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){let h=r.code,g=r.charCode||r.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(r){let h=r.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let r=this._map,h=this._pos;if(!r||!h)return!1;let g=r.unproject(h),v=r.getFreeCameraOptions();if(!v.position)return!1;let x=v.position.toLngLat();return x.distanceTo(g)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){let r=this._map;if(!r)return;let h=this._pos;if(!h||h.x<0||h.x>r.transform.width||h.y<0||h.y>r.transform.height)return void this._clearFadeTimer();let g=r.unproject(h),v;r._showingGlobe()&&i.d9(r.transform,this._lngLat)?v=0:(v=1-r._queryFogOpacity(g),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let r=this._pos;if(!r||!this._map)return;let h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${lf[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){let r=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!r||g!=="map")return"";if(!h._showingGlobe()){let D=h.getPitch();return D?`rotateX(${D}deg)`:""}let v=i.b0(i.da(h.transform,this._lngLat)),x=r.sub(i.db(h.transform)),S=Math.abs(x.x)+Math.abs(x.y);if(S===0)return"";let k=v/S;return`rotateX(${-x.y*k}deg) rotateY(${x.x*k}deg)`}_calculateZTransform(){let r=this._pos,h=this._map;if(!h||!r)return"";let g=0,v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){let x=h.project(new i.aI(this._lngLat.lng,this._lngLat.lat+.001)),S=h.project(new i.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);g=i.b0(Math.atan2(S.y,S.x))-90}else g=-h.getBearing();else if(v==="horizon"){let x=i.$(4,6,h.getZoom()),S=i.db(h.transform);S.y+=x*h.transform.height;let k=r.sub(S),D=i.b0(Math.atan2(k.y,k.x));g=(D>90?D-270:D+90)*(1-x)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);let h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=S_(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=i.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){let h=this._map;if(!h)return;let g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){let x=this._clickTolerance||h._clickTolerance;if(r.point.dist(g)<x)return;this._isDragging=!0}this._pos=r.point.sub(v),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.f("dragstart"))),this.fire(new i.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.f("dragend")),this._state="inactive"}_addDragHandler(r){let h=this._map,g=this._pos;h&&g&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(g),this._pointerdownPos=r.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;let h=this._map;return h&&(r?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let cf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},M_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function yl(f=new i.P(0,0),r="bottom"){if(typeof f=="number"){let h=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(r){case"top":return new i.P(0,f);case"top-left":return new i.P(h,h);case"top-right":return new i.P(-h,h);case"bottom":return new i.P(0,-f);case"bottom-left":return new i.P(h,-h);case"bottom-right":return new i.P(-h,-h);case"left":return new i.P(f,0);case"right":return new i.P(-f,0)}return new i.P(0,0)}return f instanceof i.P||Array.isArray(f)?i.P.convert(f):i.P.convert(f[r]||[0,0])}class k_{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;let h=i.b9((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,h,g){this._start=this.getValue(h),this._end=r,this._startTime=h,this._endTime=h+g}}let T_={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class I_{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let df={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},vl={showCompass:!0,showZoom:!0,visualizePitch:!1};class E_{constructor(r,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Jp({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,g&&(this.mousePitch=new _l({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),i.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(r,h){this.mouseRotate.mousedown(r,h),this.mousePitch&&this.mousePitch.mousedown(r,h),ke()}move(r,h){let g=this.map,v=this.mouseRotate.mousemoveWindow(r,h),x=v&&v.bearingDelta;if(x&&g.setBearing(g.getBearing()+x),this.mousePitch){let S=this.mousePitch.mousemoveWindow(r,h),k=S&&S.pitchDelta;k&&g.setPitch(g.getPitch()+k)}}off(){let r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ae(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(i.W({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),ht(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,ht(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Tt(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=Tt(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let xl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},D_={maxWidth:100,unit:"metric"},ju={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:i.dt,supported:C,setRTLTextPlugin:i.dv,getRTLTextPluginStatus:i.dw,Map:class extends jy{constructor(f){i.dc.mark(i.dd.create);let r=f;if((f=i.W({},df,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&i.de(window)&&(f.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new wa(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new C_,this._domRenderTaskQueue=new C_,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.df(),this._locale=i.W({},T_,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new k_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new i.dg(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?$i({},f.contextCreateOptions):{},typeof f.container=="string"){let h=document.getElementById(f.container);if(!h)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=h}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),i.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new I_),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new v_(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||i.d8.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new Ny(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});let h=f.bounds;h&&(this.resize(),this.fitBounds(h,i.W({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new x_({customAttribution:f.customAttribution})),this._logoControl=new w_,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new i.f(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new i.f(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(f,r){if(r===void 0&&(r=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new i.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let h=f.onAdd(this);this._controls.push(f);let g=this._controlPositions[r];return r.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new i.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let r=this._controls.indexOf(f);return r>-1&&this._controls.splice(r,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let r=!this._moving;return r&&this.fire(new i.f("movestart",f)).fire(new i.f("move",f)),this.fire(new i.f("resize",f)),r&&this.fire(new i.f("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(i.ai.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new i.f("zoomstart")).fire(new i.f("zoom")).fire(new i.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new i.f("zoomstart")).fire(new i.f("zoom")).fire(new i.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new i.f("pitchstart")).fire(new i.f("pitch")).fire(new i.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new i.f("pitchstart")).fire(new i.f("pitch")).fire(new i.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(r=>r==="auto"?navigator.language:r):f}setLanguage(f){let r=this._parseLanguage(f);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(let h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let f=this.transform,r=f.projection.name,h;r==="globe"&&f.zoom>=i.aU?(f.setMercatorFromTransition(),h=!0):r==="mercator"&&f.zoom<i.aU&&(f.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,r){return this._updateProjection(f||r||{name:"mercator"})}_updateProjection(f){let r;return r=f.name==="globe"&&this.transform.zoom>=i.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(i.aI.convert(f))}unproject(f){return this.transform.pointLocation3D(i.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,r,h){if(f==="mouseenter"||f==="mouseover"){let g=!1,v=S=>{let k=r.filter(A=>this.getLayer(A)),D=k.length?this.queryRenderedFeatures(S.point,{layers:k}):[];D.length?g||(g=!0,h.call(this,new Tr(f,this,S.originalEvent,{features:D}))):g=!1},x=()=>{g=!1};return{layers:new Set(r),listener:h,delegates:{mousemove:v,mouseout:x}}}if(f==="mouseleave"||f==="mouseout"){let g=!1,v=S=>{let k=r.filter(D=>this.getLayer(D));(k.length?this.queryRenderedFeatures(S.point,{layers:k}):[]).length?g=!0:g&&(g=!1,h.call(this,new Tr(f,this,S.originalEvent)))},x=S=>{g&&(g=!1,h.call(this,new Tr(f,this,S.originalEvent)))};return{layers:new Set(r),listener:h,delegates:{mousemove:v,mouseout:x}}}{let g=v=>{let x=r.filter(k=>this.getLayer(k)),S=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];S.length&&(v.features=S,h.call(this,v),delete v.features)};return{layers:new Set(r),listener:h,delegates:{[f]:g}}}}on(f,r,h){if(typeof r=="function"||h===void 0)return super.on(f,r);if(Array.isArray(r)||(r=[r]),r){for(let v of r)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(f,r,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(g);for(let v in g.delegates)this.on(v,g.delegates[v]);return this}once(f,r,h){if(typeof r=="function"||h===void 0)return super.once(f,r);if(Array.isArray(r)||(r=[r]),r){for(let v of r)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(f,r,h);for(let v in g.delegates)this.once(v,g.delegates[v]);return this}off(f,r,h){if(typeof r=="function"||h===void 0)return super.off(f,r);let g=new Set(Array.isArray(r)?r:[r]);for(let S of g)if(!this._isValidId(S))return this;let v=(S,k)=>{if(S.size!==k.size)return!1;for(let D of S)if(!k.has(D))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[f]:void 0;return x&&(S=>{for(let k=0;k<S.length;k++){let D=S[k];if(D.listener===h&&v(D.layers,g)){for(let A in D.delegates)this.off(A,D.delegates[A]);return S.splice(k,1),this}}})(x),this}queryRenderedFeatures(f,r){if(!this.style)return[];if(r!==void 0||f===void 0||f instanceof i.P||Array.isArray(f)||(r=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],(r=r||{}).layers&&Array.isArray(r.layers)){for(let h of r.layers)if(!this._isValidId(h))return[]}return this.style.queryRenderedFeatures(f,r,this.transform)}querySourceFeatures(f,r){return this._isValidId(f)?this.style.querySourceFeatures(f,r):[]}isPointOnSurface(f){let{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&i.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(f))}setStyle(f,r){return r=i.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&f&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(f,(h,g)=>{h?(i.w(`Unable to perform style diff: ${String(h.message||h.error||h)}. Rebuilding the style from scratch.`),this._updateStyle(f,r)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(f,r))}_getUIString(f){let r=this._locale[f];if(r==null)throw new Error(`Missing UI string '${f}'`);return r}_updateStyle(f,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){let h=i.W({},r);r&&r.config&&(h.initialConfig=r.config,delete h.config),this.style=new ca(this,h).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new i.d(new Error("IDs can't be empty."))),!1):!i.cV(f)||(this.fire(new i.d(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}addSource(f,r){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,r),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,r,h){this._lazyInitEmptyStyle(),this.style.addSourceType(f,r,h)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,r,{pixelRatio:h=1,sdf:g=!1,stretchX:v,stretchY:x,content:S}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){let{width:k,height:D,data:A}=i.e.getImageData(r);this.style.addImage(f,{data:new i.i({width:k,height:D},A),pixelRatio:h,stretchX:v,stretchY:x,content:S,sdf:g,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new i.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:k,height:D}=r,A=r;this.style.addImage(f,{data:new i.i({width:k,height:D},new Uint8Array(A.data)),pixelRatio:h,stretchX:v,stretchY:x,content:S,sdf:g,version:0,userImage:A}),A.onAdd&&A.onAdd(this,f)}}updateImage(f,r){this._lazyInitEmptyStyle();let h=this.style.getImage(f);if(!h)return void this.fire(new i.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let g=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?i.e.getImageData(r):r,{width:v,height:x,data:S}=g;if(v===void 0||x===void 0)return void this.fire(new i.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||x!==h.data.height)return void this.fire(new i.d(new Error(`The width and height of the updated image (${v}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));let k=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);h.data.replace(S,k),this.style.updateImage(f,h)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new i.d(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,r){i.h(this._requestManager.transformRequest(f,i.R.Image),(h,g)=>{r(h,g instanceof HTMLImageElement?i.e.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(f,r){this._lazyInitEmptyStyle(),this.style.addModel(f,r)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new i.d(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,r){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,r),this._update(!0)):this}getSlot(f){let r=this.getLayer(f);return r&&r.slot||null}setSlot(f,r){return this.style.setSlot(f,r),this.style.mergeLayers(),this._update(!0)}addImport(f,r){return this.style.addImport(f,r),this}updateImport(f,r){return typeof r!="string"&&r.id!==f?(this.removeImport(f),this.addImport(r)):(this.style.updateImport(f,r),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,r){return this.style.moveImport(f,r),this._update(!0)}moveLayer(f,r){return this._isValidId(f)?(this.style.moveLayer(f,r),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){return this._isValidId(f)?this.style.getOwnLayer(f):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,r,h){return this._isValidId(f)?(this.style.setLayerZoomRange(f,r,h),this._update(!0)):this}setFilter(f,r,h={}){return this._isValidId(f)?(this.style.setFilter(f,r,h),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,r,h,g={}){return this._isValidId(f)?(this.style.setPaintProperty(f,r,h,g),this._update(!0)):this}getPaintProperty(f,r){return this._isValidId(f)?this.style.getPaintProperty(f,r):null}setLayoutProperty(f,r,h,g={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,r,h,g),this._update(!0)):this}getLayoutProperty(f,r){return this._isValidId(f)?this.style.getLayoutProperty(f,r):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,r){return this.style.setSchema(f,r),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,r){return this.style.setConfig(f,r),this._update(!0)}getConfigProperty(f,r){return this.style.getConfigProperty(f,r)}setConfigProperty(f,r,h){return this.style.setConfigProperty(f,r,h),this._update(!0)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){let r=f[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aI.convert(f),this.transform):0}setFeatureState(f,r){return this._isValidId(f.source)?(this.style.setFeatureState(f,r),this._update()):this}removeFeatureState(f,r){return this._isValidId(f.source)?(this.style.removeFeatureState(f,r),this._update()):this}getFeatureState(f){return this._isValidId(f.source)?this.style.getFeatureState(f):null}_updateContainerDimensions(){if(!this._container)return;let f=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300,h,g,v,x=this._container;for(;x&&(!g||!v);){let S=window.getComputedStyle(x).transform;S&&S!=="none"&&(h=S.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),x=x.parentElement}this._containerWidth=g?Math.abs(f/g):f,this._containerHeight=v?Math.abs(r/v):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=N("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();let r=this._canvasContainer=N("div","mapboxgl-canvas-container",f);this._canvas=N("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let h=this._controlContainer=N("div","mapboxgl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=N("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,r){let h=i.e.devicePixelRatio||1;this._canvas.width=h*Math.ceil(f),this._canvas.height=h*Math.ceil(r),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${r}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){let r=this._markers.indexOf(f);r!==-1&&this._markers.splice(r,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){let r=this._popups.indexOf(f);r!==-1&&this._popups.splice(r,1)}_setupPainter(){let f=i.W({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",f);r?(i.dh(r,!0),this.painter=new i_(r,this._contextCreateOptions,this.transform,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.di.testSupport(r)):this.fire(new i.d(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.f("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new i.f("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let r;this.fire(new i.f("renderstart")),++this._frameId;let h=this.painter.context.extTimerQuery,g=i.e.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=v.createQuery(),v.beginQuery(h.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();let x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let A=this.transform.zoom,L=this.transform.pitch,z=i.e.now(),U=new i.X(A,{now:z,fadeDuration:x,pitch:L,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(g);let k=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource);if(k&&(this._placementDirty=k.needsRerender,this._occlusionOpacityChanged=k.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,i.dc.mark(i.dd.load),this.fire(new i.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){let A=i.e.now()-g;v.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{let L=v.getQueryParameter(r,v.QUERY_RESULT)/1e6;v.deleteQuery(r),this.fire(new i.f("gpu-timing-frame",{cpuTime:A,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){let A=this.painter.collectGpuTimers();setTimeout(()=>{let L=this.painter.queryGpuTimers(A);this.fire(new i.f("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){let A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let L=this.painter.queryGpuTimeDeferredRender(A);this.fire(new i.f("gpu-timing-deferred-render",{gpuTime:L}))},50)}let D=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||S;if((this._sourcesDirty||this._styleDirty||S||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),D||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let A=!this.isMoving()&&this.loaded();if(A&&(S=this._updateAverageElevation(g,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new i.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let L=this._calculateSpeedIndex();this.fire(new i.f("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!D&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,i.dc.mark(i.dd.fullLoad),this._performanceMetricsCollection&&i.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(let r of this._markers)f&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(let r of this._popups)!f||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(f,r=!1){let h=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);let g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(r||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){let v=this.transform.averageElevation,x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=f;let S=Math.abs(v-x);if(S>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,f,300)}else if(S>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(f)&&h(this._averageElevation.getValue(f))}_authenticate(){i.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===i.dl||f.status===401)){let r=this.painter.context.gl;i.dh(r,!1),this._logoControl instanceof w_&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),i.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&i.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){let f=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());let h=this.painter.context.gl,g=h.createFramebuffer();function v(x){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,x,0);let S=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,S),S}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(v(f),r.canvasCopies.map(v),r.timeStamps)}_canvasPixelComparison(f,r,h){let g=h[1]-h[0],v=f.length/4;for(let x=0;x<r.length;x++){let S=r[x],k=0;for(let D=0;D<S.length;D+=4)S[D]===f[D]&&S[D+1]===f[D+1]&&S[D+2]===f[D+2]&&S[D+3]===f[D+3]&&(k+=1);g+=(h[x+2]-h[x+1])*(1-k/v)}return g}remove(){this._hash&&this._hash.remove();for(let r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),i.dp(this.painter.context.gl),i.dq.remove(),i.dr.remove(),this._removed=!0,this.fire(new i.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=i.e.frame(r=>{let h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(r)}))}_preloadTiles(f){let r=this.style?this.style.getSourceCaches():[];return i.ds(r,(h,g)=>h._preloadTiles(f,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,r){i.du(f,r)}_occlusionCriteriaSatisfied(){let f=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&f&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return i.dt}},NavigationControl:class{constructor(f){this.options=i.W({},vl,f),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(i.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),N("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),N("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{let h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:r}):h.resetNorth({},{originalEvent:r}))}),this._compassIcon=N("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let f=this._map;if(!f)return;let r=f.getZoom(),h=r===f.getMaxZoom(),g=r===f.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){let f=this._map;if(!f)return;let r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new E_(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){let f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,r){let h=N("button",f,this._container);return h.type="button",h.addEventListener("click",r),h}_setButtonTitle(f,r){if(!this._map)return;let h=this._map._getUIString(`NavigationControl.${r}`);f.setAttribute("aria-label",h),f.firstElementChild&&f.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends i.E{constructor(f){super();let r=navigator.geolocation;this.options=i.W({geolocation:r},xl,f),i.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Zp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){let r=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,f(h)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>r(h.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(f){let r=this._map.getMaxBounds(),h=f.coords;return!!r&&(h.longitude<r.getWest()||h.longitude>r.getEast()||h.latitude<r.getSouth()||h.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new i.f("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.f("geolocate",f)),this._finish()}}_updateCamera(f){let r=new i.aI(f.coords.longitude,f.coords.latitude),h=f.coords.accuracy,g=this._map.getBearing(),v=i.W({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(h),v,{geolocateSource:!0})}_updateMarker(f){if(f){let r=new i.aI(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let f=this._map.transform,r=i.ax(1,f._center.lat)*f.worldSize,h=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.f("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=N("button","mapboxgl-ctrl-geolocate",this._container),N("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{let r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N("div","mapboxgl-user-location"),this._dotElement.appendChild(N("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(N("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new fh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=N("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.f("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:x_,ScaleControl:class{constructor(f){this.options=i.W({},D_,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let f=this.options.maxWidth||100,r=this._map,h=r._containerHeight/2,g=r._containerWidth/2-f/2,v=r.unproject([g,h]),x=r.unproject([g+f,h]),S=v.distanceTo(x);if(this.options.unit==="imperial"){let k=3.2808*S;k>5280?this._setScale(f,k/5280,"mile"):this._setScale(f,k,"foot")}else this.options.unit==="nautical"?this._setScale(f,S/1852,"nautical-mile"):S>=1e3?this._setScale(f,S/1e3,"kilometer"):this._setScale(f,S,"meter")}_setScale(f,r,h){this._map._requestDomTask(()=>{let g=function(x){let S=Math.pow(10,`${Math.floor(x)}`.length-1),k=x/S;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(D){let A=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*A)/A}(k),S*k}(r),v=g/r;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(g):`${g}&nbsp;${ju[h]}`,this._container.style.width=f*v+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:i.w("Full screen control 'container' must be a DOM element.")),i.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let f=this._fullscreenButton=N("button","mapboxgl-ctrl-fullscreen",this._controlContainer);N("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(f){super(),this.options=i.W(Object.create(cf),f),i.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new i.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new i.f("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=i.aI.convert(f),this._pos=null,this._trackPointer=!1,this._update();let r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){let r=document.createDocumentFragment(),h=document.createElement("body"),g;for(h.innerHTML=f;g=h.firstChild,g;)r.appendChild(g);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=N("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(f),this.options.closeButton){let h=this._closeButton=N("button","mapboxgl-popup-close-button",r);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let r;return this._classList.delete(f)?r=!1:(this._classList.add(f),r=!0),this._updateClassList(),r}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;let r=this._map,h=this._container,g=this._pos;if(!r||!h||!g)return"bottom";let v=h.offsetWidth,x=h.offsetHeight,S=g.x<v/2,k=g.x>r.transform.width-v/2;if(g.y+f<x)return S?"top-left":k?"top-right":"top";if(g.y>r.transform.height-x){if(S)return"bottom-left";if(k)return"bottom-right"}return S?"left":k?"right":"bottom"}_updateClassList(){let f=this._container;if(!f)return;let r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),f.className=r.join(" ")}_update(f){let r=this._map,h=this._content;if(!r||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=N("div","mapboxgl-popup",r.getContainer()),this._tip=N("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=S_(this._lngLat,this._pos,r.transform)),!this._trackPointer||f){let v=this._pos=this._trackPointer&&f?f:r.project(this._lngLat),x=yl(this.options.offset),S=this._anchor=this._getAnchor(x.y),k=yl(this.options.offset,S),D=v.add(k).round();r._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${lf[S]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&r._showingGlobe()){let v=i.d9(r.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(M_);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:fh,Style:ca,LngLat:i.aI,LngLatBounds:i.ai,Point:i.P,MercatorCoordinate:i.Y,FreeCameraOptions:pp,Evented:i.E,config:i.d8,prewarm:i.dx,clearPrewarmedResources:i.dy,get accessToken(){return i.d8.ACCESS_TOKEN},set accessToken(f){i.d8.ACCESS_TOKEN=f},get baseApiUrl(){return i.d8.API_URL},set baseApiUrl(f){i.d8.API_URL=f},get workerCount(){return i.dz.workerCount},set workerCount(f){i.dz.workerCount=f},get maxParallelImageRequests(){return i.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){i.d8.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){i.dA(f)},get workerUrl(){return i.dB.workerUrl},set workerUrl(f){i.dB.workerUrl=f},get workerClass(){return i.dB.workerClass},set workerClass(f){i.dB.workerClass=f},get workerParams(){return i.dB.workerParams},set workerParams(f){i.dB.workerParams=f},get dracoUrl(){return i.dC()},set dracoUrl(f){i.dD(f)},get meshoptUrl(){return i.dE()},set meshoptUrl(f){i.dF(f)},setNow:i.e.setNow,restoreNow:i.e.restoreNow}});var l=u;return l})});var t3=(()=>{let s=class s extends J0{constructor(o,l,i){super(o,l,i,vn(U0,{optional:!0}))}ngOnDestroy(){this.flush()}};s.\u0275fac=function(l){return new(l||s)(lt(un),lt(Jf),lt(K0))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac});let d=s;return d})();function i3(){return new wk}function n3(d,s,u){return new Sk(d,s,u)}var Ek=[{provide:K0,useFactory:i3},{provide:J0,useClass:t3},{provide:H0,useFactory:n3,deps:[Z0,J0,Ri]}],Ik=[{provide:Jf,useFactory:()=>new Ck},{provide:Zr,useValue:"BrowserAnimations"},...Ek],r3=[{provide:Jf,useClass:xk},{provide:Zr,useValue:"NoopAnimations"},...Ek],Dk=(()=>{let s=class s{static withConfig(o){return{ngModule:s,providers:o.disableAnimations?r3:Ik}}};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:Ik,imports:[X0]});let d=s;return d})();var Yx;try{Yx=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Yx=!1}var jn=(()=>{let s=class s{constructor(o){this._platformId=o,this.isBrowser=this._platformId?ck(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||Yx)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};s.\u0275fac=function(l){return new(l||s)(lt(rd))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var eg;function o3(){if(eg==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>eg=!0}))}finally{eg=eg||!1}return eg}function Gs(d){return o3()?d:!!d.capture}var Lh;function Ak(){if(Lh==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Lh=!1,Lh;if("scrollBehavior"in document.documentElement.style)Lh=!0;else{let d=Element.prototype.scrollTo;d?Lh=!/\{\s*\[native code\]\s*\}/.test(d.toString()):Lh=!1}}return Lh}var $x;function a3(){if($x==null){let d=typeof document<"u"?document.head:null;$x=!!(d&&(d.createShadowRoot||d.attachShadow))}return $x}function Pk(d){if(a3()){let s=d.getRootNode?d.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&s instanceof ShadowRoot)return s}return null}function Fh(){let d=typeof document<"u"&&document?document.activeElement:null;for(;d&&d.shadowRoot;){let s=d.shadowRoot.activeElement;if(s===d)break;d=s}return d}function ps(d){return d.composedPath?d.composedPath()[0]:d.target}function tg(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Sm(d,...s){return s.length?s.some(u=>d[u]):d.altKey||d.shiftKey||d.ctrlKey||d.metaKey}function ig(d,s=0){return s3(d)?Number(d):s}function s3(d){return!isNaN(parseFloat(d))&&!isNaN(Number(d))}function Mm(d){return Array.isArray(d)?d:[d]}function Cr(d){return d==null?"":typeof d=="string"?d:`${d}px`}function Ll(d){return d instanceof sn?d.nativeElement:d}var l3=(()=>{let s=class s{create(o){return typeof MutationObserver>"u"?null:new MutationObserver(o)}};s.\u0275fac=function(l){return new(l||s)},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var rb=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[l3]});let d=s;return d})();var Ok=new Set,zh,c3=(()=>{let s=class s{constructor(o,l){this._platform=o,this._nonce=l,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):h3}matchMedia(o){return(this._platform.WEBKIT||this._platform.BLINK)&&d3(o,this._nonce),this._matchMedia(o)}};s.\u0275fac=function(l){return new(l||s)(lt(jn),lt(KM,8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function d3(d,s){if(!Ok.has(d))try{zh||(zh=document.createElement("style"),s&&zh.setAttribute("nonce",s),zh.setAttribute("type","text/css"),document.head.appendChild(zh)),zh.sheet&&(zh.sheet.insertRule(`@media ${d} {body{ }}`,0),Ok.add(d))}catch(u){console.error(u)}}function h3(d){return{matches:d==="all"||d==="",media:d,addListener:()=>{},removeListener:()=>{}}}var Lk=(()=>{let s=class s{constructor(o,l){this._mediaMatcher=o,this._zone=l,this._queries=new Map,this._destroySubject=new In}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(o){return Rk(Mm(o)).some(i=>this._registerQuery(i).mql.matches)}observe(o){let i=Rk(Mm(o)).map(C=>this._registerQuery(C).observable),_=WM(i);return _=z0(_.pipe(Oa(1)),_.pipe(N0(1),Ax(0))),_.pipe(gm(C=>{let I={matches:!1,breakpoints:{}};return C.forEach(({matches:O,query:N})=>{I.matches=I.matches||O,I.breakpoints[N]=O}),I}))}_registerQuery(o){if(this._queries.has(o))return this._queries.get(o);let l=this._mediaMatcher.matchMedia(o),_={observable:new yo(C=>{let I=O=>this._zone.run(()=>C.next(O));return l.addListener(I),()=>{l.removeListener(I)}}).pipe(ls(l),gm(({matches:C})=>({query:o,matches:C})),Oh(this._destroySubject)),mql:l};return this._queries.set(o,_),_}};s.\u0275fac=function(l){return new(l||s)(lt(c3),lt(Ri))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function Rk(d){return d.map(s=>s.split(",")).reduce((s,u)=>s.concat(u)).map(s=>s.trim())}var ng=(()=>{let s=class s{constructor(o){this._platform=o}isDisabled(o){return o.hasAttribute("disabled")}isVisible(o){return m3(o)&&getComputedStyle(o).visibility==="visible"}isTabbable(o){if(!this._platform.isBrowser)return!1;let l=u3(x3(o));if(l&&(Fk(l)===-1||!this.isVisible(l)))return!1;let i=o.nodeName.toLowerCase(),_=Fk(o);return o.hasAttribute("contenteditable")?_!==-1:i==="iframe"||i==="object"||this._platform.WEBKIT&&this._platform.IOS&&!y3(o)?!1:i==="audio"?o.hasAttribute("controls")?_!==-1:!1:i==="video"?_===-1?!1:_!==null?!0:this._platform.FIREFOX||o.hasAttribute("controls"):o.tabIndex>=0}isFocusable(o,l){return v3(o)&&!this.isDisabled(o)&&(l?.ignoreVisibility||this.isVisible(o))}};s.\u0275fac=function(l){return new(l||s)(lt(jn))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function u3(d){try{return d.frameElement}catch{return null}}function m3(d){return!!(d.offsetWidth||d.offsetHeight||typeof d.getClientRects=="function"&&d.getClientRects().length)}function p3(d){let s=d.nodeName.toLowerCase();return s==="input"||s==="select"||s==="button"||s==="textarea"}function f3(d){return _3(d)&&d.type=="hidden"}function g3(d){return b3(d)&&d.hasAttribute("href")}function _3(d){return d.nodeName.toLowerCase()=="input"}function b3(d){return d.nodeName.toLowerCase()=="a"}function Nk(d){if(!d.hasAttribute("tabindex")||d.tabIndex===void 0)return!1;let s=d.getAttribute("tabindex");return!!(s&&!isNaN(parseInt(s,10)))}function Fk(d){if(!Nk(d))return null;let s=parseInt(d.getAttribute("tabindex")||"",10);return isNaN(s)?-1:s}function y3(d){let s=d.nodeName.toLowerCase(),u=s==="input"&&d.type;return u==="text"||u==="password"||s==="select"||s==="textarea"}function v3(d){return f3(d)?!1:p3(d)||g3(d)||d.hasAttribute("contenteditable")||Nk(d)}function x3(d){return d.ownerDocument&&d.ownerDocument.defaultView||window}var Xx=class{get enabled(){return this._enabled}set enabled(s){this._enabled=s,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(s,this._startAnchor),this._toggleAnchorTabIndex(s,this._endAnchor))}constructor(s,u,o,l,i=!1){this._element=s,this._checker=u,this._ngZone=o,this._document=l,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,i||this.attachAnchors()}destroy(){let s=this._startAnchor,u=this._endAnchor;s&&(s.removeEventListener("focus",this.startAnchorListener),s.remove()),u&&(u.removeEventListener("focus",this.endAnchorListener),u.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(s){return new Promise(u=>{this._executeOnStable(()=>u(this.focusInitialElement(s)))})}focusFirstTabbableElementWhenReady(s){return new Promise(u=>{this._executeOnStable(()=>u(this.focusFirstTabbableElement(s)))})}focusLastTabbableElementWhenReady(s){return new Promise(u=>{this._executeOnStable(()=>u(this.focusLastTabbableElement(s)))})}_getRegionBoundary(s){let u=this._element.querySelectorAll(`[cdk-focus-region-${s}], [cdkFocusRegion${s}], [cdk-focus-${s}]`);return s=="start"?u.length?u[0]:this._getFirstTabbableElement(this._element):u.length?u[u.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(s){let u=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(u){if(!this._checker.isFocusable(u)){let o=this._getFirstTabbableElement(u);return o?.focus(s),!!o}return u.focus(s),!0}return this.focusFirstTabbableElement(s)}focusFirstTabbableElement(s){let u=this._getRegionBoundary("start");return u&&u.focus(s),!!u}focusLastTabbableElement(s){let u=this._getRegionBoundary("end");return u&&u.focus(s),!!u}hasAttached(){return this._hasAttached}_getFirstTabbableElement(s){if(this._checker.isFocusable(s)&&this._checker.isTabbable(s))return s;let u=s.children;for(let o=0;o<u.length;o++){let l=u[o].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(u[o]):null;if(l)return l}return null}_getLastTabbableElement(s){if(this._checker.isFocusable(s)&&this._checker.isTabbable(s))return s;let u=s.children;for(let o=u.length-1;o>=0;o--){let l=u[o].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(u[o]):null;if(l)return l}return null}_createAnchor(){let s=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,s),s.classList.add("cdk-visually-hidden"),s.classList.add("cdk-focus-trap-anchor"),s.setAttribute("aria-hidden","true"),s}_toggleAnchorTabIndex(s,u){s?u.setAttribute("tabindex","0"):u.removeAttribute("tabindex")}toggleAnchors(s){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(s,this._startAnchor),this._toggleAnchorTabIndex(s,this._endAnchor))}_executeOnStable(s){this._ngZone.isStable?s():this._ngZone.onStable.pipe(Oa(1)).subscribe(s)}},rg=(()=>{let s=class s{constructor(o,l,i){this._checker=o,this._ngZone=l,this._document=i}create(o,l=!1){return new Xx(o,this._checker,this._ngZone,this._document,l)}};s.\u0275fac=function(l){return new(l||s)(lt(ng),lt(Ri),lt(un))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Vk=(()=>{let s=class s{get enabled(){return this.focusTrap?.enabled||!1}set enabled(o){this.focusTrap&&(this.focusTrap.enabled=o)}constructor(o,l,i){this._elementRef=o,this._focusTrapFactory=l,this._previouslyFocusedElement=null,vn(jn).isBrowser&&(this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0))}ngOnDestroy(){this.focusTrap?.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap?.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap&&!this.focusTrap.hasAttached()&&this.focusTrap.attachAnchors()}ngOnChanges(o){let l=o.autoCapture;l&&!l.firstChange&&this.autoCapture&&this.focusTrap?.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=Fh(),this.focusTrap?.focusInitialElementWhenReady()}};s.\u0275fac=function(l){return new(l||s)(ye(sn),ye(rg),ye(un))},s.\u0275dir=Zn({type:s,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:[Yi.HasDecoratorInputTransform,"cdkTrapFocus","enabled",Xr],autoCapture:[Yi.HasDecoratorInputTransform,"cdkTrapFocusAutoCapture","autoCapture",Xr]},exportAs:["cdkTrapFocus"],standalone:!0,features:[xo,vo]});let d=s;return d})();function Qx(d){return d.buttons===0||d.detail===0}function Kx(d){let s=d.touches&&d.touches[0]||d.changedTouches&&d.changedTouches[0];return!!s&&s.identifier===-1&&(s.radiusX==null||s.radiusX===1)&&(s.radiusY==null||s.radiusY===1)}var w3=new pn("cdk-input-modality-detector-options"),C3={ignoreKeys:[18,17,224,91,16]},jk=650,km=Gs({passive:!0,capture:!0}),S3=(()=>{let s=class s{get mostRecentModality(){return this._modality.value}constructor(o,l,i,_){this._platform=o,this._mostRecentTarget=null,this._modality=new F0(null),this._lastTouchMs=0,this._onKeydown=C=>{this._options?.ignoreKeys?.some(I=>I===C.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=ps(C))},this._onMousedown=C=>{Date.now()-this._lastTouchMs<jk||(this._modality.next(Qx(C)?"keyboard":"mouse"),this._mostRecentTarget=ps(C))},this._onTouchstart=C=>{if(Kx(C)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=ps(C)},this._options=$i($i({},C3),_),this.modalityDetected=this._modality.pipe(N0(1)),this.modalityChanged=this.modalityDetected.pipe(Px()),o.isBrowser&&l.runOutsideAngular(()=>{i.addEventListener("keydown",this._onKeydown,km),i.addEventListener("mousedown",this._onMousedown,km),i.addEventListener("touchstart",this._onTouchstart,km)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,km),document.removeEventListener("mousedown",this._onMousedown,km),document.removeEventListener("touchstart",this._onTouchstart,km))}};s.\u0275fac=function(l){return new(l||s)(lt(jn),lt(Ri),lt(un),lt(w3,8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var ab=function(d){return d[d.IMMEDIATE=0]="IMMEDIATE",d[d.EVENTUAL=1]="EVENTUAL",d}(ab||{}),M3=new pn("cdk-focus-monitor-default-options"),ob=Gs({passive:!0,capture:!0}),Fl=(()=>{let s=class s{constructor(o,l,i,_,C){this._ngZone=o,this._platform=l,this._inputModalityDetector=i,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new In,this._rootNodeFocusAndBlurListener=I=>{let O=ps(I);for(let N=O;N;N=N.parentElement)I.type==="focus"?this._onFocus(I,N):this._onBlur(I,N)},this._document=_,this._detectionMode=C?.detectionMode||ab.IMMEDIATE}monitor(o,l=!1){let i=Ll(o);if(!this._platform.isBrowser||i.nodeType!==1)return Yr();let _=Pk(i)||this._getDocument(),C=this._elementInfo.get(i);if(C)return l&&(C.checkChildren=!0),C.subject;let I={checkChildren:l,subject:new In,rootNode:_};return this._elementInfo.set(i,I),this._registerGlobalListeners(I),I.subject}stopMonitoring(o){let l=Ll(o),i=this._elementInfo.get(l);i&&(i.subject.complete(),this._setClasses(l),this._elementInfo.delete(l),this._removeGlobalListeners(i))}focusVia(o,l,i){let _=Ll(o),C=this._getDocument().activeElement;_===C?this._getClosestElementsInfo(_).forEach(([I,O])=>this._originChanged(I,l,O)):(this._setOrigin(l),typeof _.focus=="function"&&_.focus(i))}ngOnDestroy(){this._elementInfo.forEach((o,l)=>this.stopMonitoring(l))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(o){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(o)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:o&&this._isLastInteractionFromInputLabel(o)?"mouse":"program"}_shouldBeAttributedToTouch(o){return this._detectionMode===ab.EVENTUAL||!!o?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(o,l){o.classList.toggle("cdk-focused",!!l),o.classList.toggle("cdk-touch-focused",l==="touch"),o.classList.toggle("cdk-keyboard-focused",l==="keyboard"),o.classList.toggle("cdk-mouse-focused",l==="mouse"),o.classList.toggle("cdk-program-focused",l==="program")}_setOrigin(o,l=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=o,this._originFromTouchInteraction=o==="touch"&&l,this._detectionMode===ab.IMMEDIATE){clearTimeout(this._originTimeoutId);let i=this._originFromTouchInteraction?jk:1;this._originTimeoutId=setTimeout(()=>this._origin=null,i)}})}_onFocus(o,l){let i=this._elementInfo.get(l),_=ps(o);!i||!i.checkChildren&&l!==_||this._originChanged(l,this._getFocusOrigin(_),i)}_onBlur(o,l){let i=this._elementInfo.get(l);!i||i.checkChildren&&o.relatedTarget instanceof Node&&l.contains(o.relatedTarget)||(this._setClasses(l),this._emitOrigin(i,null))}_emitOrigin(o,l){o.subject.observers.length&&this._ngZone.run(()=>o.subject.next(l))}_registerGlobalListeners(o){if(!this._platform.isBrowser)return;let l=o.rootNode,i=this._rootNodeFocusListenerCount.get(l)||0;i||this._ngZone.runOutsideAngular(()=>{l.addEventListener("focus",this._rootNodeFocusAndBlurListener,ob),l.addEventListener("blur",this._rootNodeFocusAndBlurListener,ob)}),this._rootNodeFocusListenerCount.set(l,i+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Oh(this._stopInputModalityDetector)).subscribe(_=>{this._setOrigin(_,!0)}))}_removeGlobalListeners(o){let l=o.rootNode;if(this._rootNodeFocusListenerCount.has(l)){let i=this._rootNodeFocusListenerCount.get(l);i>1?this._rootNodeFocusListenerCount.set(l,i-1):(l.removeEventListener("focus",this._rootNodeFocusAndBlurListener,ob),l.removeEventListener("blur",this._rootNodeFocusAndBlurListener,ob),this._rootNodeFocusListenerCount.delete(l))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(o,l,i){this._setClasses(o,l),this._emitOrigin(i,l),this._lastFocusOrigin=l}_getClosestElementsInfo(o){let l=[];return this._elementInfo.forEach((i,_)=>{(_===o||i.checkChildren&&_.contains(o))&&l.push([_,i])}),l}_isLastInteractionFromInputLabel(o){let{_mostRecentTarget:l,mostRecentModality:i}=this._inputModalityDetector;if(i!=="mouse"||!l||l===o||o.nodeName!=="INPUT"&&o.nodeName!=="TEXTAREA"||o.disabled)return!1;let _=o.labels;if(_){for(let C=0;C<_.length;C++)if(_[C].contains(l))return!0}return!1}};s.\u0275fac=function(l){return new(l||s)(lt(Ri),lt(jn),lt(S3),lt(un,8),lt(M3,8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Uk=(()=>{let s=class s{constructor(o,l){this._elementRef=o,this._focusMonitor=l,this._focusOrigin=null,this.cdkFocusChange=new on}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){let o=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(o,o.nodeType===1&&o.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(l=>{this._focusOrigin=l,this.cdkFocusChange.emit(l)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}};s.\u0275fac=function(l){return new(l||s)(ye(sn),ye(Fl))},s.\u0275dir=Zn({type:s,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"],standalone:!0});let d=s;return d})(),Bh=function(d){return d[d.NONE=0]="NONE",d[d.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",d[d.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",d}(Bh||{}),zk="cdk-high-contrast-black-on-white",Bk="cdk-high-contrast-white-on-black",Zx="cdk-high-contrast-active",Jx=(()=>{let s=class s{constructor(o,l){this._platform=o,this._document=l,this._breakpointSubscription=vn(Lk).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return Bh.NONE;let o=this._document.createElement("div");o.style.backgroundColor="rgb(1,2,3)",o.style.position="absolute",this._document.body.appendChild(o);let l=this._document.defaultView||window,i=l&&l.getComputedStyle?l.getComputedStyle(o):null,_=(i&&i.backgroundColor||"").replace(/ /g,"");switch(o.remove(),_){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return Bh.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return Bh.BLACK_ON_WHITE}return Bh.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let o=this._document.body.classList;o.remove(Zx,zk,Bk),this._hasCheckedHighContrastMode=!0;let l=this.getHighContrastMode();l===Bh.BLACK_ON_WHITE?o.add(Zx,zk):l===Bh.WHITE_ON_BLACK&&o.add(Zx,Bk)}}};s.\u0275fac=function(l){return new(l||s)(lt(jn),lt(un))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),sb=(()=>{let s=class s{constructor(o){o._applyBodyHighContrastModeCssClasses()}};s.\u0275fac=function(l){return new(l||s)(lt(Jx))},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[rb]});let d=s;return d})();var k3=new pn("cdk-dir-doc",{providedIn:"root",factory:T3});function T3(){return vn(un)}var I3=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function E3(d){let s=d?.toLowerCase()||"";return s==="auto"&&typeof navigator<"u"&&navigator?.language?I3.test(navigator.language)?"rtl":"ltr":s==="rtl"?"rtl":"ltr"}var zl=(()=>{let s=class s{constructor(o){if(this.value="ltr",this.change=new on,o){let l=o.body?o.body.dir:null,i=o.documentElement?o.documentElement.dir:null;this.value=E3(l||i||"ltr")}}ngOnDestroy(){this.change.complete()}};s.\u0275fac=function(l){return new(l||s)(lt(k3,8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var dd=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({});let d=s;return d})();var D3=["mat-internal-form-field",""],A3=["*"];function P3(){return!0}var O3=new pn("mat-sanity-checks",{providedIn:"root",factory:P3}),Fn=(()=>{let s=class s{constructor(o,l,i){this._sanityChecks=l,this._document=i,this._hasDoneGlobalChecks=!1,o._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(o){return tg()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[o]}};s.\u0275fac=function(l){return new(l||s)(lt(Jx),lt(O3,8),lt(un))},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[dd,dd]});let d=s;return d})();var Wk=new pn("MAT_DATE_LOCALE",{providedIn:"root",factory:R3});function R3(){return vn(ok)}var $o=class{constructor(){this._localeChanges=new In,this.localeChanges=this._localeChanges}getValidDateOrNull(s){return this.isDateInstance(s)&&this.isValid(s)?s:null}deserialize(s){return s==null||this.isDateInstance(s)&&this.isValid(s)?s:this.invalid()}setLocale(s){this.locale=s,this._localeChanges.next()}compareDate(s,u){return this.getYear(s)-this.getYear(u)||this.getMonth(s)-this.getMonth(u)||this.getDate(s)-this.getDate(u)}sameDate(s,u){if(s&&u){let o=this.isValid(s),l=this.isValid(u);return o&&l?!this.compareDate(s,u):o==l}return s==u}clampDate(s,u,o){return u&&this.compareDate(s,u)<0?u:o&&this.compareDate(s,o)>0?o:s}},Tm=new pn("mat-date-formats"),L3=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function e1(d,s){let u=Array(d);for(let o=0;o<d;o++)u[o]=s(o);return u}var F3=(()=>{let s=class s extends $o{constructor(o){super(),this.useUtcForDisplay=!1,this._matDateLocale=vn(Wk,{optional:!0}),o!==void 0&&(this._matDateLocale=o),super.setLocale(this._matDateLocale)}getYear(o){return o.getFullYear()}getMonth(o){return o.getMonth()}getDate(o){return o.getDate()}getDayOfWeek(o){return o.getDay()}getMonthNames(o){let l=new Intl.DateTimeFormat(this.locale,{month:o,timeZone:"utc"});return e1(12,i=>this._format(l,new Date(2017,i,1)))}getDateNames(){let o=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return e1(31,l=>this._format(o,new Date(2017,0,l+1)))}getDayOfWeekNames(o){let l=new Intl.DateTimeFormat(this.locale,{weekday:o,timeZone:"utc"});return e1(7,i=>this._format(l,new Date(2017,0,i+1)))}getYearName(o){let l=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(l,o)}getFirstDayOfWeek(){return 0}getNumDaysInMonth(o){return this.getDate(this._createDateWithOverflow(this.getYear(o),this.getMonth(o)+1,0))}clone(o){return new Date(o.getTime())}createDate(o,l,i){let _=this._createDateWithOverflow(o,l,i);return _.getMonth()!=l,_}today(){return new Date}parse(o,l){return typeof o=="number"?new Date(o):o?new Date(Date.parse(o)):null}format(o,l){if(!this.isValid(o))throw Error("NativeDateAdapter: Cannot format invalid date.");let i=new Intl.DateTimeFormat(this.locale,Pa($i({},l),{timeZone:"utc"}));return this._format(i,o)}addCalendarYears(o,l){return this.addCalendarMonths(o,l*12)}addCalendarMonths(o,l){let i=this._createDateWithOverflow(this.getYear(o),this.getMonth(o)+l,this.getDate(o));return this.getMonth(i)!=((this.getMonth(o)+l)%12+12)%12&&(i=this._createDateWithOverflow(this.getYear(i),this.getMonth(i),0)),i}addCalendarDays(o,l){return this._createDateWithOverflow(this.getYear(o),this.getMonth(o),this.getDate(o)+l)}toIso8601(o){return[o.getUTCFullYear(),this._2digit(o.getUTCMonth()+1),this._2digit(o.getUTCDate())].join("-")}deserialize(o){if(typeof o=="string"){if(!o)return null;if(L3.test(o)){let l=new Date(o);if(this.isValid(l))return l}}return super.deserialize(o)}isDateInstance(o){return o instanceof Date}isValid(o){return!isNaN(o.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(o,l,i){let _=new Date;return _.setFullYear(o,l,i),_.setHours(0,0,0,0),_}_2digit(o){return("00"+o).slice(-2)}_format(o,l){let i=new Date;return i.setUTCFullYear(l.getFullYear(),l.getMonth(),l.getDate()),i.setUTCHours(l.getHours(),l.getMinutes(),l.getSeconds(),l.getMilliseconds()),o.format(i)}};s.\u0275fac=function(l){return new(l||s)(lt(Wk,8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac});let d=s;return d})(),z3={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};var Jk=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[B3()]});let d=s;return d})();function B3(d=z3){return[{provide:$o,useClass:F3},{provide:Tm,useValue:d}]}var za=function(d){return d[d.FADING_IN=0]="FADING_IN",d[d.VISIBLE=1]="VISIBLE",d[d.FADING_OUT=2]="FADING_OUT",d[d.HIDDEN=3]="HIDDEN",d}(za||{}),n1=class{constructor(s,u,o,l=!1){this._renderer=s,this.element=u,this.config=o,this._animationForciblyDisabledThroughCss=l,this.state=za.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},Gk=Gs({passive:!0,capture:!0}),r1=class{constructor(){this._events=new Map,this._delegateEventHandler=s=>{let u=ps(s);u&&this._events.get(s.type)?.forEach((o,l)=>{(l===u||l.contains(u))&&o.forEach(i=>i.handleEvent(s))})}}addHandler(s,u,o,l){let i=this._events.get(u);if(i){let _=i.get(o);_?_.add(l):i.set(o,new Set([l]))}else this._events.set(u,new Map([[o,new Set([l])]])),s.runOutsideAngular(()=>{document.addEventListener(u,this._delegateEventHandler,Gk)})}removeHandler(s,u,o){let l=this._events.get(s);if(!l)return;let i=l.get(u);i&&(i.delete(o),i.size===0&&l.delete(u),l.size===0&&(this._events.delete(s),document.removeEventListener(s,this._delegateEventHandler,Gk)))}},qk={enterDuration:225,exitDuration:150},N3=800,$k=Gs({passive:!0,capture:!0}),Yk=["mousedown","touchstart"],Zk=["mouseup","mouseleave","touchend","touchcancel"],og=class og{constructor(s,u,o,l){this._target=s,this._ngZone=u,this._platform=l,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,l.isBrowser&&(this._containerElement=Ll(o))}fadeInRipple(s,u,o={}){let l=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),i=$i($i({},qk),o.animation);o.centered&&(s=l.left+l.width/2,u=l.top+l.height/2);let _=o.radius||V3(s,u,l),C=s-l.left,I=u-l.top,O=i.enterDuration,N=document.createElement("div");N.classList.add("mat-ripple-element"),N.style.left=`${C-_}px`,N.style.top=`${I-_}px`,N.style.height=`${_*2}px`,N.style.width=`${_*2}px`,o.color!=null&&(N.style.backgroundColor=o.color),N.style.transitionDuration=`${O}ms`,this._containerElement.appendChild(N);let q=window.getComputedStyle(N),ie=q.transitionProperty,de=q.transitionDuration,xe=ie==="none"||de==="0s"||de==="0s, 0s"||l.width===0&&l.height===0,ke=new n1(this,N,o,xe);N.style.transform="scale3d(1, 1, 1)",ke.state=za.FADING_IN,o.persistent||(this._mostRecentTransientRipple=ke);let Ae=null;return!xe&&(O||i.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Xe=()=>this._finishRippleTransition(ke),qe=()=>this._destroyRipple(ke);N.addEventListener("transitionend",Xe),N.addEventListener("transitioncancel",qe),Ae={onTransitionEnd:Xe,onTransitionCancel:qe}}),this._activeRipples.set(ke,Ae),(xe||!O)&&this._finishRippleTransition(ke),ke}fadeOutRipple(s){if(s.state===za.FADING_OUT||s.state===za.HIDDEN)return;let u=s.element,o=$i($i({},qk),s.config.animation);u.style.transitionDuration=`${o.exitDuration}ms`,u.style.opacity="0",s.state=za.FADING_OUT,(s._animationForciblyDisabledThroughCss||!o.exitDuration)&&this._finishRippleTransition(s)}fadeOutAll(){this._getActiveRipples().forEach(s=>s.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(s=>{s.config.persistent||s.fadeOut()})}setupTriggerEvents(s){let u=Ll(s);!this._platform.isBrowser||!u||u===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=u,Yk.forEach(o=>{og._eventManager.addHandler(this._ngZone,o,u,this)}))}handleEvent(s){s.type==="mousedown"?this._onMousedown(s):s.type==="touchstart"?this._onTouchStart(s):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{Zk.forEach(u=>{this._triggerElement.addEventListener(u,this,$k)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(s){s.state===za.FADING_IN?this._startFadeOutTransition(s):s.state===za.FADING_OUT&&this._destroyRipple(s)}_startFadeOutTransition(s){let u=s===this._mostRecentTransientRipple,{persistent:o}=s.config;s.state=za.VISIBLE,!o&&(!u||!this._isPointerDown)&&s.fadeOut()}_destroyRipple(s){let u=this._activeRipples.get(s)??null;this._activeRipples.delete(s),this._activeRipples.size||(this._containerRect=null),s===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),s.state=za.HIDDEN,u!==null&&(s.element.removeEventListener("transitionend",u.onTransitionEnd),s.element.removeEventListener("transitioncancel",u.onTransitionCancel)),s.element.remove()}_onMousedown(s){let u=Qx(s),o=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+N3;!this._target.rippleDisabled&&!u&&!o&&(this._isPointerDown=!0,this.fadeInRipple(s.clientX,s.clientY,this._target.rippleConfig))}_onTouchStart(s){if(!this._target.rippleDisabled&&!Kx(s)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let u=s.changedTouches;if(u)for(let o=0;o<u.length;o++)this.fadeInRipple(u[o].clientX,u[o].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(s=>{let u=s.state===za.VISIBLE||s.config.terminateOnPointerUp&&s.state===za.FADING_IN;!s.config.persistent&&u&&s.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let s=this._triggerElement;s&&(Yk.forEach(u=>og._eventManager.removeHandler(u,s,this)),this._pointerUpEventsRegistered&&(Zk.forEach(u=>s.removeEventListener(u,this,$k)),this._pointerUpEventsRegistered=!1))}};og._eventManager=new r1;var o1=og;function V3(d,s,u){let o=Math.max(Math.abs(d-u.left),Math.abs(d-u.right)),l=Math.max(Math.abs(s-u.top),Math.abs(s-u.bottom));return Math.sqrt(o*o+l*l)}var a1=new pn("mat-ripple-global-options"),db=(()=>{let s=class s{get disabled(){return this._disabled}set disabled(o){o&&this.fadeOutAllNonPersistent(),this._disabled=o,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(o){this._trigger=o,this._setupTriggerEventsIfEnabled()}constructor(o,l,i,_,C){this._elementRef=o,this._animationMode=C,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=_||{},this._rippleRenderer=new o1(this,l,o,i)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:$i($i($i({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(o,l=0,i){return typeof o=="number"?this._rippleRenderer.fadeInRipple(o,l,$i($i({},this.rippleConfig),i)):this._rippleRenderer.fadeInRipple(0,0,$i($i({},this.rippleConfig),o))}};s.\u0275fac=function(l){return new(l||s)(ye(sn),ye(Ri),ye(jn),ye(a1,8),ye(Zr,8))},s.\u0275dir=Zn({type:s,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(l,i){l&2&&ji("mat-ripple-unbounded",i.unbounded)},inputs:{color:[Yi.None,"matRippleColor","color"],unbounded:[Yi.None,"matRippleUnbounded","unbounded"],centered:[Yi.None,"matRippleCentered","centered"],radius:[Yi.None,"matRippleRadius","radius"],animation:[Yi.None,"matRippleAnimation","animation"],disabled:[Yi.None,"matRippleDisabled","disabled"],trigger:[Yi.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let d=s;return d})(),eT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[Fn,Fn]});let d=s;return d})();var Xk={capture:!0},Qk=["focus","click","mouseenter","touchstart"],t1="mat-ripple-loader-uninitialized",i1="mat-ripple-loader-class-name",Kk="mat-ripple-loader-centered",cb="mat-ripple-loader-disabled",tT=(()=>{let s=class s{constructor(){this._document=vn(un,{optional:!0}),this._animationMode=vn(Zr,{optional:!0}),this._globalRippleOptions=vn(a1,{optional:!0}),this._platform=vn(jn),this._ngZone=vn(Ri),this._hosts=new Map,this._onInteraction=o=>{if(!(o.target instanceof HTMLElement))return;let i=o.target.closest(`[${t1}]`);i&&this._createRipple(i)},this._ngZone.runOutsideAngular(()=>{for(let o of Qk)this._document?.addEventListener(o,this._onInteraction,Xk)})}ngOnDestroy(){let o=this._hosts.keys();for(let l of o)this.destroyRipple(l);for(let l of Qk)this._document?.removeEventListener(l,this._onInteraction,Xk)}configureRipple(o,l){o.setAttribute(t1,""),(l.className||!o.hasAttribute(i1))&&o.setAttribute(i1,l.className||""),l.centered&&o.setAttribute(Kk,""),l.disabled&&o.setAttribute(cb,"")}getRipple(o){return this._hosts.get(o)||this._createRipple(o)}setDisabled(o,l){let i=this._hosts.get(o);if(i){i.disabled=l;return}l?o.setAttribute(cb,""):o.removeAttribute(cb)}_createRipple(o){if(!this._document)return;let l=this._hosts.get(o);if(l)return l;o.querySelector(".mat-ripple")?.remove();let i=this._document.createElement("span");i.classList.add("mat-ripple",o.getAttribute(i1)),o.append(i);let _=new db(new sn(i),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return _._isInitialized=!0,_.trigger=o,_.centered=o.hasAttribute(Kk),_.disabled=o.hasAttribute(cb),this.attachRipple(o,_),_}attachRipple(o,l){o.removeAttribute(t1),this._hosts.set(o,l)}destroyRipple(o){let l=this._hosts.get(o);l&&(l.ngOnDestroy(),this._hosts.delete(o))}};s.\u0275fac=function(l){return new(l||s)},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),iT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275cmp=gt({type:s,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(l,i){l&2&&ji("mdc-form-field--align-end",i.labelPosition==="before")},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[Nn],attrs:D3,ngContentSelectors:A3,decls:1,vars:0,template:function(l,i){l&1&&(Wo(),wo(0))},styles:[".mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-form-field{font-family:var(--mdc-form-field-label-text-font);line-height:var(--mdc-form-field-label-text-line-height);font-size:var(--mdc-form-field-label-text-size);font-weight:var(--mdc-form-field-label-text-weight);letter-spacing:var(--mdc-form-field-label-text-tracking);color:var(--mdc-form-field-label-text-color)}.mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}"],encapsulation:2,changeDetection:0});let d=s;return d})();var nT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[Fn]});let d=s;return d})();var rT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({});let d=s;return d})();var s1=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[Fn,Hs,rb,Fn]});let d=s;return d})();var oT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[Fn,s1,s1,rT,Fn]});let d=s;return d})();var aT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[Fn,Hs,Fn]});let d=s;return d})();var sT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[Hs,Fn]});let d=s;return d})();var ag=class{attach(s){return this._attachedHost=s,s.attach(this)}detach(){let s=this._attachedHost;s!=null&&(this._attachedHost=null,s.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(s){this._attachedHost=s}},hd=class extends ag{constructor(s,u,o,l,i){super(),this.component=s,this.viewContainerRef=u,this.injector=o,this.componentFactoryResolver=l,this.projectableNodes=i}},Nh=class extends ag{constructor(s,u,o,l){super(),this.templateRef=s,this.viewContainerRef=u,this.context=o,this.injector=l}get origin(){return this.templateRef.elementRef}attach(s,u=this.context){return this.context=u,super.attach(s)}detach(){return this.context=void 0,super.detach()}},l1=class extends ag{constructor(s){super(),this.element=s instanceof sn?s.nativeElement:s}},Im=class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(s){if(s instanceof hd)return this._attachedPortal=s,this.attachComponentPortal(s);if(s instanceof Nh)return this._attachedPortal=s,this.attachTemplatePortal(s);if(this.attachDomPortal&&s instanceof l1)return this._attachedPortal=s,this.attachDomPortal(s)}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(s){this._disposeFn=s}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var hb=class extends Im{constructor(s,u,o,l,i){super(),this.outletElement=s,this._componentFactoryResolver=u,this._appRef=o,this._defaultInjector=l,this.attachDomPortal=_=>{this._document;let C=_.element;C.parentNode;let I=this._document.createComment("dom-portal");C.parentNode.insertBefore(I,C),this.outletElement.appendChild(C),this._attachedPortal=_,super.setDisposeFn(()=>{I.parentNode&&I.parentNode.replaceChild(C,I)})},this._document=i}attachComponentPortal(s){let o=(s.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(s.component),l;return s.viewContainerRef?(l=s.viewContainerRef.createComponent(o,s.viewContainerRef.length,s.injector||s.viewContainerRef.injector,s.projectableNodes||void 0),this.setDisposeFn(()=>l.destroy())):(l=o.create(s.injector||this._defaultInjector||Ra.NULL),this._appRef.attachView(l.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(l.hostView),l.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(l)),this._attachedPortal=s,l}attachTemplatePortal(s){let u=s.viewContainerRef,o=u.createEmbeddedView(s.templateRef,s.context,{injector:s.injector});return o.rootNodes.forEach(l=>this.outletElement.appendChild(l)),o.detectChanges(),this.setDisposeFn(()=>{let l=u.indexOf(o);l!==-1&&u.remove(l)}),this._attachedPortal=s,o}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(s){return s.hostView.rootNodes[0]}};var ud=(()=>{let s=class s extends Im{constructor(o,l,i){super(),this._componentFactoryResolver=o,this._viewContainerRef=l,this._isInitialized=!1,this.attached=new on,this.attachDomPortal=_=>{this._document;let C=_.element;C.parentNode;let I=this._document.createComment("dom-portal");_.setAttachedHost(this),C.parentNode.insertBefore(I,C),this._getRootNode().appendChild(C),this._attachedPortal=_,super.setDisposeFn(()=>{I.parentNode&&I.parentNode.replaceChild(C,I)})},this._document=i}get portal(){return this._attachedPortal}set portal(o){this.hasAttached()&&!o&&!this._isInitialized||(this.hasAttached()&&super.detach(),o&&super.attach(o),this._attachedPortal=o||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(o){o.setAttachedHost(this);let l=o.viewContainerRef!=null?o.viewContainerRef:this._viewContainerRef,_=(o.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(o.component),C=l.createComponent(_,l.length,o.injector||l.injector,o.projectableNodes||void 0);return l!==this._viewContainerRef&&this._getRootNode().appendChild(C.hostView.rootNodes[0]),super.setDisposeFn(()=>C.destroy()),this._attachedPortal=o,this._attachedRef=C,this.attached.emit(C),C}attachTemplatePortal(o){o.setAttachedHost(this);let l=this._viewContainerRef.createEmbeddedView(o.templateRef,o.context,{injector:o.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=o,this._attachedRef=l,this.attached.emit(l),l}_getRootNode(){let o=this._viewContainerRef.element.nativeElement;return o.nodeType===o.ELEMENT_NODE?o:o.parentNode}};s.\u0275fac=function(l){return new(l||s)(ye(Zf),ye(vm),ye(un))},s.\u0275dir=Zn({type:s,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[Yi.None,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],standalone:!0,features:[Po]});let d=s;return d})();var Bl=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({});let d=s;return d})();var H3=20,lT=(()=>{let s=class s{constructor(o,l,i){this._ngZone=o,this._platform=l,this._scrolled=new In,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=i}register(o){this.scrollContainers.has(o)||this.scrollContainers.set(o,o.elementScrolled().subscribe(()=>this._scrolled.next(o)))}deregister(o){let l=this.scrollContainers.get(o);l&&(l.unsubscribe(),this.scrollContainers.delete(o))}scrolled(o=H3){return this._platform.isBrowser?new yo(l=>{this._globalSubscription||this._addGlobalListener();let i=o>0?this._scrolled.pipe(Dx(o)).subscribe(l):this._scrolled.subscribe(l);return this._scrolledCount++,()=>{i.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Yr()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((o,l)=>this.deregister(l)),this._scrolled.complete()}ancestorScrolled(o,l){let i=this.getAncestorScrollContainers(o);return this.scrolled(l).pipe(pa(_=>!_||i.indexOf(_)>-1))}getAncestorScrollContainers(o){let l=[];return this.scrollContainers.forEach((i,_)=>{this._scrollableContainsElement(_,o)&&l.push(_)}),l}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(o,l){let i=Ll(l),_=o.getElementRef().nativeElement;do if(i==_)return!0;while(i=i.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let o=this._getWindow();return qM(o.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};s.\u0275fac=function(l){return new(l||s)(lt(Ri),lt(jn),lt(un,8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var W3=20,c1=(()=>{let s=class s{constructor(o,l,i){this._platform=o,this._change=new In,this._changeListener=_=>{this._change.next(_)},this._document=i,l.runOutsideAngular(()=>{if(o.isBrowser){let _=this._getWindow();_.addEventListener("resize",this._changeListener),_.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let o=this._getWindow();o.removeEventListener("resize",this._changeListener),o.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let o={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),o}getViewportRect(){let o=this.getViewportScrollPosition(),{width:l,height:i}=this.getViewportSize();return{top:o.top,left:o.left,bottom:o.top+i,right:o.left+l,height:i,width:l}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let o=this._document,l=this._getWindow(),i=o.documentElement,_=i.getBoundingClientRect(),C=-_.top||o.body.scrollTop||l.scrollY||i.scrollTop||0,I=-_.left||o.body.scrollLeft||l.scrollX||i.scrollLeft||0;return{top:C,left:I}}change(o=W3){return o>0?this._change.pipe(Dx(o)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let o=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:o.innerWidth,height:o.innerHeight}:{width:0,height:0}}};s.\u0275fac=function(l){return new(l||s)(lt(jn),lt(Ri),lt(un,8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var ub=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({});let d=s;return d})(),d1=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[dd,ub,dd,ub]});let d=s;return d})();var cT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[Fn,Fn]});let d=s;return d})();var q3=["switch"],$3=["*"];function Y3(d,s){d&1&&(V(0,"div",10),nd(),V(1,"svg",12),Me(2,"path",13),j(),V(3,"svg",14),Me(4,"path",15),j()())}var Z3=new pn("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1})}),X3={provide:uk,useExisting:V0(()=>pb),multi:!0},mb=class{constructor(s,u){this.source=s,this.checked=u}},Q3=0,pb=(()=>{let s=class s{_createChangeEvent(o){return new mb(this,o)}get buttonId(){return`${this.id||this._uniqueId}-button`}focus(){this._switchElement.nativeElement.focus()}get checked(){return this._checked}set checked(o){this._checked=o,this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(o,l,i,_,C,I){this._elementRef=o,this._focusMonitor=l,this._changeDetectorRef=i,this.defaults=C,this._onChange=O=>{},this._onTouched=()=>{},this._validatorOnChange=()=>{},this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.change=new on,this.toggleChange=new on,this.tabIndex=parseInt(_)||0,this.color=C.color||"accent",this._noopAnimations=I==="NoopAnimations",this.id=this._uniqueId=`mat-mdc-slide-toggle-${++Q3}`,this.hideIcon=C.hideIcon??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(o=>{o==="keyboard"||o==="program"?(this._focused=!0,this._changeDetectorRef.markForCheck()):o||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(o){o.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(o){this.checked=!!o}registerOnChange(o){this._onChange=o}registerOnTouched(o){this._onTouched=o}validate(o){return this.required&&o.value!==!0?{required:!0}:null}registerOnValidatorChange(o){this._validatorOnChange=o}setDisabledState(o){this.disabled=o,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new mb(this,this.checked)))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}};s.\u0275fac=function(l){return new(l||s)(ye(sn),ye(Fl),ye(lo),bm("tabindex"),ye(Z3),ye(Zr,8))},s.\u0275cmp=gt({type:s,selectors:[["mat-slide-toggle"]],viewQuery:function(l,i){if(l&1&&Ci(q3,5),l&2){let _;vi(_=xi())&&(i._switchElement=_.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(l,i){l&2&&(Rl("id",i.id),_n("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),ds(i.color?"mat-"+i.color:""),ji("mat-mdc-slide-toggle-focused",i._focused)("mat-mdc-slide-toggle-checked",i.checked)("_mat-animation-noopable",i._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[Yi.None,"aria-label","ariaLabel"],ariaLabelledby:[Yi.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[Yi.None,"aria-describedby","ariaDescribedby"],required:[Yi.HasDecoratorInputTransform,"required","required",Xr],color:"color",disabled:[Yi.HasDecoratorInputTransform,"disabled","disabled",Xr],disableRipple:[Yi.HasDecoratorInputTransform,"disableRipple","disableRipple",Xr],tabIndex:[Yi.HasDecoratorInputTransform,"tabIndex","tabIndex",o=>o==null?0:Ux(o)],checked:[Yi.HasDecoratorInputTransform,"checked","checked",Xr],hideIcon:[Yi.HasDecoratorInputTransform,"hideIcon","hideIcon",Xr]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],standalone:!0,features:[us([X3,{provide:mk,useExisting:s,multi:!0}]),xo,vo,Nn],ngContentSelectors:$3,decls:13,vars:24,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(l,i){if(l&1){let _=si();Wo(),V(0,"div",1)(1,"button",2,0),Fe("click",function(){return Ct(_),St(i._handleClick())}),Me(3,"div",3),V(4,"div",4)(5,"div",5)(6,"div",6),Me(7,"div",7),j(),V(8,"div",8),Me(9,"div",9),j(),Bt(10,Y3,5,0,"div",10),j()()(),V(11,"label",11),Fe("click",function(I){return Ct(_),St(I.stopPropagation())}),wo(12),j()()}if(l&2){let _=hs(2);Le("labelPosition",i.labelPosition),pe(),ji("mdc-switch--selected",i.checked)("mdc-switch--unselected",!i.checked)("mdc-switch--checked",i.checked)("mdc-switch--disabled",i.disabled),Le("tabIndex",i.disabled?-1:i.tabIndex)("disabled",i.disabled),_n("id",i.buttonId)("name",i.name)("aria-label",i.ariaLabel)("aria-labelledby",i._getAriaLabelledBy())("aria-describedby",i.ariaDescribedby)("aria-required",i.required||null)("aria-checked",i.checked),pe(8),Le("matRippleTrigger",_)("matRippleDisabled",i.disableRipple||i.disabled)("matRippleCentered",!0),pe(),Xn(10,i.hideIcon?-1:10),pe(),Le("for",i.buttonId),_n("id",i._labelId)}},dependencies:[db,iT],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1);background-color:var(--mdc-elevation-overlay-color)}.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative}.mdc-switch[hidden]{display:none}.mdc-switch:disabled{cursor:default;pointer-events:none}.mdc-switch__track{overflow:hidden;position:relative;width:100%}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%}@media screen and (forced-colors: active){.mdc-switch__track::before,.mdc-switch__track::after{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(-100%)}[dir=rtl] .mdc-switch__track::after,.mdc-switch__track[dir=rtl]::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track[dir=rtl]::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0)}[dir=rtl] .mdc-switch__handle-track,.mdc-switch__handle-track[dir=rtl]{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track,.mdc-switch--selected .mdc-switch__handle-track[dir=rtl]{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto}[dir=rtl] .mdc-switch__handle,.mdc-switch__handle[dir=rtl]{left:auto;right:0}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media screen and (forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-elevation-overlay{bottom:0;left:0;right:0;top:0}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1}.mdc-switch:disabled .mdc-switch__ripple{display:none}.mdc-switch__icons{height:100%;position:relative;width:100%;z-index:1}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}.mdc-switch{width:var(--mdc-switch-track-width)}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color)}.mdc-switch.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color)}.mdc-switch .mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation)}.mdc-switch .mdc-switch__focus-ring-wrapper,.mdc-switch .mdc-switch__handle{height:var(--mdc-switch-handle-height)}.mdc-switch .mdc-switch__handle{border-radius:var(--mdc-switch-handle-shape)}.mdc-switch .mdc-switch__handle{width:var(--mdc-switch-handle-width)}.mdc-switch .mdc-switch__handle-track{width:calc(100% - var(--mdc-switch-handle-width))}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__icon{fill:var(--mdc-switch-selected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__icon{fill:var(--mdc-switch-unselected-icon-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size)}.mdc-switch.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-hover-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-focus-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-pressed-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-hover-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-focus-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-pressed-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-selected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-selected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-unselected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-unselected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch .mdc-switch__ripple{height:var(--mdc-switch-state-layer-size);width:var(--mdc-switch-state-layer-size)}.mdc-switch .mdc-switch__track{height:var(--mdc-switch-track-height)}.mdc-switch:disabled .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch:enabled .mdc-switch__track::after{background:var(--mdc-switch-selected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color)}.mdc-switch:enabled .mdc-switch__track::before{background:var(--mdc-switch-unselected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color)}.mdc-switch .mdc-switch__track{border-radius:var(--mdc-switch-track-shape)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mat-mdc-slide-toggle{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle .mdc-switch__ripple::after{content:"";opacity:0}.mat-mdc-slide-toggle .mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:opacity 75ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-elevation-overlay,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mdc-switch__handle{transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size);height:var(--mat-switch-unselected-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size);height:var(--mat-switch-selected-handle-size)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size);height:var(--mat-switch-with-icon-handle-size)}.mat-mdc-slide-toggle:active .mdc-switch:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size);height:var(--mat-switch-pressed-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{margin:var(--mat-switch-selected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{margin:var(--mat-switch-unselected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--selected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--unselected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin)}.mdc-switch__track::after,.mdc-switch__track::before{border-width:var(--mat-switch-track-outline-width);border-color:var(--mat-switch-track-outline-color)}.mdc-switch--selected .mdc-switch__track::after,.mdc-switch--selected .mdc-switch__track::before{border-width:var(--mat-switch-selected-track-outline-width)}.mdc-switch--disabled .mdc-switch__track::after,.mdc-switch--disabled .mdc-switch__track::before{border-width:var(--mat-switch-disabled-unselected-track-outline-width);border-color:var(--mat-switch-disabled-unselected-track-outline-color)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity)}'],encapsulation:2,changeDetection:0});let d=s;return d})();var dT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[pb,Fn,Fn]});let d=s;return d})();var hT=Ak(),h1=class{constructor(s,u){this._viewportRuler=s,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=u}attach(){}enable(){if(this._canBeEnabled()){let s=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=s.style.left||"",this._previousHTMLStyles.top=s.style.top||"",s.style.left=Cr(-this._previousScrollPosition.left),s.style.top=Cr(-this._previousScrollPosition.top),s.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let s=this._document.documentElement,u=this._document.body,o=s.style,l=u.style,i=o.scrollBehavior||"",_=l.scrollBehavior||"";this._isEnabled=!1,o.left=this._previousHTMLStyles.left,o.top=this._previousHTMLStyles.top,s.classList.remove("cdk-global-scrollblock"),hT&&(o.scrollBehavior=l.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),hT&&(o.scrollBehavior=i,l.scrollBehavior=_)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let u=this._document.body,o=this._viewportRuler.getViewportSize();return u.scrollHeight>o.height||u.scrollWidth>o.width}};var u1=class{constructor(s,u,o,l){this._scrollDispatcher=s,this._ngZone=u,this._viewportRuler=o,this._config=l,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(s){this._overlayRef,this._overlayRef=s}enable(){if(this._scrollSubscription)return;let s=this._scrollDispatcher.scrolled(0).pipe(pa(u=>!u||!this._overlayRef.overlayElement.contains(u.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=s.subscribe(()=>{let u=this._viewportRuler.getViewportScrollPosition().top;Math.abs(u-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=s.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},fb=class{enable(){}disable(){}attach(){}};function m1(d,s){return s.some(u=>{let o=d.bottom<u.top,l=d.top>u.bottom,i=d.right<u.left,_=d.left>u.right;return o||l||i||_})}function uT(d,s){return s.some(u=>{let o=d.top<u.top,l=d.bottom>u.bottom,i=d.left<u.left,_=d.right>u.right;return o||l||i||_})}var p1=class{constructor(s,u,o,l){this._scrollDispatcher=s,this._viewportRuler=u,this._ngZone=o,this._config=l,this._scrollSubscription=null}attach(s){this._overlayRef,this._overlayRef=s}enable(){if(!this._scrollSubscription){let s=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(s).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let u=this._overlayRef.overlayElement.getBoundingClientRect(),{width:o,height:l}=this._viewportRuler.getViewportSize();m1(u,[{width:o,height:l,bottom:l,right:o,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},J3=(()=>{let s=class s{constructor(o,l,i,_){this._scrollDispatcher=o,this._viewportRuler=l,this._ngZone=i,this.noop=()=>new fb,this.close=C=>new u1(this._scrollDispatcher,this._ngZone,this._viewportRuler,C),this.block=()=>new h1(this._viewportRuler,this._document),this.reposition=C=>new p1(this._scrollDispatcher,this._viewportRuler,this._ngZone,C),this._document=_}};s.\u0275fac=function(l){return new(l||s)(lt(lT),lt(c1),lt(Ri),lt(un))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Em=class{constructor(s){if(this.scrollStrategy=new fb,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,s){let u=Object.keys(s);for(let o of u)s[o]!==void 0&&(this[o]=s[o])}}};var f1=class{constructor(s,u){this.connectionPair=s,this.scrollableViewProperties=u}};var _T=(()=>{let s=class s{constructor(o){this._attachedOverlays=[],this._document=o}ngOnDestroy(){this.detach()}add(o){this.remove(o),this._attachedOverlays.push(o)}remove(o){let l=this._attachedOverlays.indexOf(o);l>-1&&this._attachedOverlays.splice(l,1),this._attachedOverlays.length===0&&this.detach()}};s.\u0275fac=function(l){return new(l||s)(lt(un))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),eL=(()=>{let s=class s extends _T{constructor(o,l){super(o),this._ngZone=l,this._keydownListener=i=>{let _=this._attachedOverlays;for(let C=_.length-1;C>-1;C--)if(_[C]._keydownEvents.observers.length>0){let I=_[C]._keydownEvents;this._ngZone?this._ngZone.run(()=>I.next(i)):I.next(i);break}}}add(o){super.add(o),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}};s.\u0275fac=function(l){return new(l||s)(lt(un),lt(Ri,8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),tL=(()=>{let s=class s extends _T{constructor(o,l,i){super(o),this._platform=l,this._ngZone=i,this._cursorStyleIsSet=!1,this._pointerDownListener=_=>{this._pointerDownEventTarget=ps(_)},this._clickListener=_=>{let C=ps(_),I=_.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:C;this._pointerDownEventTarget=null;let O=this._attachedOverlays.slice();for(let N=O.length-1;N>-1;N--){let q=O[N];if(q._outsidePointerEvents.observers.length<1||!q.hasAttached())continue;if(q.overlayElement.contains(C)||q.overlayElement.contains(I))break;let ie=q._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>ie.next(_)):ie.next(_)}}}add(o){if(super.add(o),!this._isAttached){let l=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(l)):this._addEventListeners(l),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=l.style.cursor,l.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let o=this._document.body;o.removeEventListener("pointerdown",this._pointerDownListener,!0),o.removeEventListener("click",this._clickListener,!0),o.removeEventListener("auxclick",this._clickListener,!0),o.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(o.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(o){o.addEventListener("pointerdown",this._pointerDownListener,!0),o.addEventListener("click",this._clickListener,!0),o.addEventListener("auxclick",this._clickListener,!0),o.addEventListener("contextmenu",this._clickListener,!0)}};s.\u0275fac=function(l){return new(l||s)(lt(un),lt(jn),lt(Ri,8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Dm=(()=>{let s=class s{constructor(o,l){this._platform=l,this._document=o}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let o="cdk-overlay-container";if(this._platform.isBrowser||tg()){let i=this._document.querySelectorAll(`.${o}[platform="server"], .${o}[platform="test"]`);for(let _=0;_<i.length;_++)i[_].remove()}let l=this._document.createElement("div");l.classList.add(o),tg()?l.setAttribute("platform","test"):this._platform.isBrowser||l.setAttribute("platform","server"),this._document.body.appendChild(l),this._containerElement=l}};s.\u0275fac=function(l){return new(l||s)(lt(un),lt(jn))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Nl=class{constructor(s,u,o,l,i,_,C,I,O,N=!1){this._portalOutlet=s,this._host=u,this._pane=o,this._config=l,this._ngZone=i,this._keyboardDispatcher=_,this._document=C,this._location=I,this._outsideClickDispatcher=O,this._animationsDisabled=N,this._backdropElement=null,this._backdropClick=new In,this._attachments=new In,this._detachments=new In,this._locationChanges=ss.EMPTY,this._backdropClickHandler=q=>this._backdropClick.next(q),this._backdropTransitionendHandler=q=>{this._disposeBackdrop(q.target)},this._keydownEvents=new In,this._outsidePointerEvents=new In,l.scrollStrategy&&(this._scrollStrategy=l.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=l.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(s){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let u=this._portalOutlet.attach(s);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Oa(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof u?.onDestroy=="function"&&u.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),u}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let s=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),s}dispose(){let s=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,s&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(s){s!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=s,this.hasAttached()&&(s.attach(this),this.updatePosition()))}updateSize(s){this._config=$i($i({},this._config),s),this._updateElementSize()}setDirection(s){this._config=Pa($i({},this._config),{direction:s}),this._updateElementDirection()}addPanelClass(s){this._pane&&this._toggleClasses(this._pane,s,!0)}removePanelClass(s){this._pane&&this._toggleClasses(this._pane,s,!1)}getDirection(){let s=this._config.direction;return s?typeof s=="string"?s:s.value:"ltr"}updateScrollStrategy(s){s!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=s,this.hasAttached()&&(s.attach(this),s.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let s=this._pane.style;s.width=Cr(this._config.width),s.height=Cr(this._config.height),s.minWidth=Cr(this._config.minWidth),s.minHeight=Cr(this._config.minHeight),s.maxWidth=Cr(this._config.maxWidth),s.maxHeight=Cr(this._config.maxHeight)}_togglePointerEvents(s){this._pane.style.pointerEvents=s?"":"none"}_attachBackdrop(){let s="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(s)})}):this._backdropElement.classList.add(s)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let s=this._backdropElement;if(s){if(this._animationsDisabled){this._disposeBackdrop(s);return}s.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{s.addEventListener("transitionend",this._backdropTransitionendHandler)}),s.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(s)},500))}}_toggleClasses(s,u,o){let l=Mm(u||[]).filter(i=>!!i);l.length&&(o?s.classList.add(...l):s.classList.remove(...l))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{let s=this._ngZone.onStable.pipe(Oh(Ph(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),s.unsubscribe())})})}_disposeScrollStrategy(){let s=this._scrollStrategy;s&&(s.disable(),s.detach&&s.detach())}_disposeBackdrop(s){s&&(s.removeEventListener("click",this._backdropClickHandler),s.removeEventListener("transitionend",this._backdropTransitionendHandler),s.remove(),this._backdropElement===s&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},mT="cdk-overlay-connected-position-bounding-box",iL=/([A-Za-z%]+)$/,gb=class{get positions(){return this._preferredPositions}constructor(s,u,o,l,i){this._viewportRuler=u,this._document=o,this._platform=l,this._overlayContainer=i,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new In,this._resizeSubscription=ss.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(s)}attach(s){this._overlayRef&&this._overlayRef,this._validatePositions(),s.hostElement.classList.add(mT),this._overlayRef=s,this._boundingBox=s.hostElement,this._pane=s.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let s=this._originRect,u=this._overlayRect,o=this._viewportRect,l=this._containerRect,i=[],_;for(let C of this._preferredPositions){let I=this._getOriginPoint(s,l,C),O=this._getOverlayPoint(I,u,C),N=this._getOverlayFit(O,u,o,C);if(N.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(C,I);return}if(this._canFitWithFlexibleDimensions(N,O,o)){i.push({position:C,origin:I,overlayRect:u,boundingBoxRect:this._calculateBoundingBoxRect(I,C)});continue}(!_||_.overlayFit.visibleArea<N.visibleArea)&&(_={overlayFit:N,overlayPoint:O,originPoint:I,position:C,overlayRect:u})}if(i.length){let C=null,I=-1;for(let O of i){let N=O.boundingBoxRect.width*O.boundingBoxRect.height*(O.position.weight||1);N>I&&(I=N,C=O)}this._isPushed=!1,this._applyPosition(C.position,C.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(_.position,_.originPoint);return}this._applyPosition(_.position,_.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Vh(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(mT),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let s=this._lastPosition;if(s){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let u=this._getOriginPoint(this._originRect,this._containerRect,s);this._applyPosition(s,u)}else this.apply()}withScrollableContainers(s){return this._scrollables=s,this}withPositions(s){return this._preferredPositions=s,s.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(s){return this._viewportMargin=s,this}withFlexibleDimensions(s=!0){return this._hasFlexibleDimensions=s,this}withGrowAfterOpen(s=!0){return this._growAfterOpen=s,this}withPush(s=!0){return this._canPush=s,this}withLockedPosition(s=!0){return this._positionLocked=s,this}setOrigin(s){return this._origin=s,this}withDefaultOffsetX(s){return this._offsetX=s,this}withDefaultOffsetY(s){return this._offsetY=s,this}withTransformOriginOn(s){return this._transformOriginSelector=s,this}_getOriginPoint(s,u,o){let l;if(o.originX=="center")l=s.left+s.width/2;else{let _=this._isRtl()?s.right:s.left,C=this._isRtl()?s.left:s.right;l=o.originX=="start"?_:C}u.left<0&&(l-=u.left);let i;return o.originY=="center"?i=s.top+s.height/2:i=o.originY=="top"?s.top:s.bottom,u.top<0&&(i-=u.top),{x:l,y:i}}_getOverlayPoint(s,u,o){let l;o.overlayX=="center"?l=-u.width/2:o.overlayX==="start"?l=this._isRtl()?-u.width:0:l=this._isRtl()?0:-u.width;let i;return o.overlayY=="center"?i=-u.height/2:i=o.overlayY=="top"?0:-u.height,{x:s.x+l,y:s.y+i}}_getOverlayFit(s,u,o,l){let i=fT(u),{x:_,y:C}=s,I=this._getOffset(l,"x"),O=this._getOffset(l,"y");I&&(_+=I),O&&(C+=O);let N=0-_,q=_+i.width-o.width,ie=0-C,de=C+i.height-o.height,xe=this._subtractOverflows(i.width,N,q),ke=this._subtractOverflows(i.height,ie,de),Ae=xe*ke;return{visibleArea:Ae,isCompletelyWithinViewport:i.width*i.height===Ae,fitsInViewportVertically:ke===i.height,fitsInViewportHorizontally:xe==i.width}}_canFitWithFlexibleDimensions(s,u,o){if(this._hasFlexibleDimensions){let l=o.bottom-u.y,i=o.right-u.x,_=pT(this._overlayRef.getConfig().minHeight),C=pT(this._overlayRef.getConfig().minWidth),I=s.fitsInViewportVertically||_!=null&&_<=l,O=s.fitsInViewportHorizontally||C!=null&&C<=i;return I&&O}return!1}_pushOverlayOnScreen(s,u,o){if(this._previousPushAmount&&this._positionLocked)return{x:s.x+this._previousPushAmount.x,y:s.y+this._previousPushAmount.y};let l=fT(u),i=this._viewportRect,_=Math.max(s.x+l.width-i.width,0),C=Math.max(s.y+l.height-i.height,0),I=Math.max(i.top-o.top-s.y,0),O=Math.max(i.left-o.left-s.x,0),N=0,q=0;return l.width<=i.width?N=O||-_:N=s.x<this._viewportMargin?i.left-o.left-s.x:0,l.height<=i.height?q=I||-C:q=s.y<this._viewportMargin?i.top-o.top-s.y:0,this._previousPushAmount={x:N,y:q},{x:s.x+N,y:s.y+q}}_applyPosition(s,u){if(this._setTransformOrigin(s),this._setOverlayElementStyles(u,s),this._setBoundingBoxStyles(u,s),s.panelClass&&this._addPanelClasses(s.panelClass),this._positionChanges.observers.length){let o=this._getScrollVisibility();if(s!==this._lastPosition||!this._lastScrollVisibility||!nL(this._lastScrollVisibility,o)){let l=new f1(s,o);this._positionChanges.next(l)}this._lastScrollVisibility=o}this._lastPosition=s,this._isInitialRender=!1}_setTransformOrigin(s){if(!this._transformOriginSelector)return;let u=this._boundingBox.querySelectorAll(this._transformOriginSelector),o,l=s.overlayY;s.overlayX==="center"?o="center":this._isRtl()?o=s.overlayX==="start"?"right":"left":o=s.overlayX==="start"?"left":"right";for(let i=0;i<u.length;i++)u[i].style.transformOrigin=`${o} ${l}`}_calculateBoundingBoxRect(s,u){let o=this._viewportRect,l=this._isRtl(),i,_,C;if(u.overlayY==="top")_=s.y,i=o.height-_+this._viewportMargin;else if(u.overlayY==="bottom")C=o.height-s.y+this._viewportMargin*2,i=o.height-C+this._viewportMargin;else{let de=Math.min(o.bottom-s.y+o.top,s.y),xe=this._lastBoundingBoxSize.height;i=de*2,_=s.y-de,i>xe&&!this._isInitialRender&&!this._growAfterOpen&&(_=s.y-xe/2)}let I=u.overlayX==="start"&&!l||u.overlayX==="end"&&l,O=u.overlayX==="end"&&!l||u.overlayX==="start"&&l,N,q,ie;if(O)ie=o.width-s.x+this._viewportMargin*2,N=s.x-this._viewportMargin;else if(I)q=s.x,N=o.right-s.x;else{let de=Math.min(o.right-s.x+o.left,s.x),xe=this._lastBoundingBoxSize.width;N=de*2,q=s.x-de,N>xe&&!this._isInitialRender&&!this._growAfterOpen&&(q=s.x-xe/2)}return{top:_,left:q,bottom:C,right:ie,width:N,height:i}}_setBoundingBoxStyles(s,u){let o=this._calculateBoundingBoxRect(s,u);!this._isInitialRender&&!this._growAfterOpen&&(o.height=Math.min(o.height,this._lastBoundingBoxSize.height),o.width=Math.min(o.width,this._lastBoundingBoxSize.width));let l={};if(this._hasExactPosition())l.top=l.left="0",l.bottom=l.right=l.maxHeight=l.maxWidth="",l.width=l.height="100%";else{let i=this._overlayRef.getConfig().maxHeight,_=this._overlayRef.getConfig().maxWidth;l.height=Cr(o.height),l.top=Cr(o.top),l.bottom=Cr(o.bottom),l.width=Cr(o.width),l.left=Cr(o.left),l.right=Cr(o.right),u.overlayX==="center"?l.alignItems="center":l.alignItems=u.overlayX==="end"?"flex-end":"flex-start",u.overlayY==="center"?l.justifyContent="center":l.justifyContent=u.overlayY==="bottom"?"flex-end":"flex-start",i&&(l.maxHeight=Cr(i)),_&&(l.maxWidth=Cr(_))}this._lastBoundingBoxSize=o,Vh(this._boundingBox.style,l)}_resetBoundingBoxStyles(){Vh(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Vh(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(s,u){let o={},l=this._hasExactPosition(),i=this._hasFlexibleDimensions,_=this._overlayRef.getConfig();if(l){let N=this._viewportRuler.getViewportScrollPosition();Vh(o,this._getExactOverlayY(u,s,N)),Vh(o,this._getExactOverlayX(u,s,N))}else o.position="static";let C="",I=this._getOffset(u,"x"),O=this._getOffset(u,"y");I&&(C+=`translateX(${I}px) `),O&&(C+=`translateY(${O}px)`),o.transform=C.trim(),_.maxHeight&&(l?o.maxHeight=Cr(_.maxHeight):i&&(o.maxHeight="")),_.maxWidth&&(l?o.maxWidth=Cr(_.maxWidth):i&&(o.maxWidth="")),Vh(this._pane.style,o)}_getExactOverlayY(s,u,o){let l={top:"",bottom:""},i=this._getOverlayPoint(u,this._overlayRect,s);if(this._isPushed&&(i=this._pushOverlayOnScreen(i,this._overlayRect,o)),s.overlayY==="bottom"){let _=this._document.documentElement.clientHeight;l.bottom=`${_-(i.y+this._overlayRect.height)}px`}else l.top=Cr(i.y);return l}_getExactOverlayX(s,u,o){let l={left:"",right:""},i=this._getOverlayPoint(u,this._overlayRect,s);this._isPushed&&(i=this._pushOverlayOnScreen(i,this._overlayRect,o));let _;if(this._isRtl()?_=s.overlayX==="end"?"left":"right":_=s.overlayX==="end"?"right":"left",_==="right"){let C=this._document.documentElement.clientWidth;l.right=`${C-(i.x+this._overlayRect.width)}px`}else l.left=Cr(i.x);return l}_getScrollVisibility(){let s=this._getOriginRect(),u=this._pane.getBoundingClientRect(),o=this._scrollables.map(l=>l.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:uT(s,o),isOriginOutsideView:m1(s,o),isOverlayClipped:uT(u,o),isOverlayOutsideView:m1(u,o)}}_subtractOverflows(s,...u){return u.reduce((o,l)=>o-Math.max(l,0),s)}_getNarrowedViewportRect(){let s=this._document.documentElement.clientWidth,u=this._document.documentElement.clientHeight,o=this._viewportRuler.getViewportScrollPosition();return{top:o.top+this._viewportMargin,left:o.left+this._viewportMargin,right:o.left+s-this._viewportMargin,bottom:o.top+u-this._viewportMargin,width:s-2*this._viewportMargin,height:u-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(s,u){return u==="x"?s.offsetX==null?this._offsetX:s.offsetX:s.offsetY==null?this._offsetY:s.offsetY}_validatePositions(){}_addPanelClasses(s){this._pane&&Mm(s).forEach(u=>{u!==""&&this._appliedPanelClasses.indexOf(u)===-1&&(this._appliedPanelClasses.push(u),this._pane.classList.add(u))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(s=>{this._pane.classList.remove(s)}),this._appliedPanelClasses=[])}_getOriginRect(){let s=this._origin;if(s instanceof sn)return s.nativeElement.getBoundingClientRect();if(s instanceof Element)return s.getBoundingClientRect();let u=s.width||0,o=s.height||0;return{top:s.y,bottom:s.y+o,left:s.x,right:s.x+u,height:o,width:u}}};function Vh(d,s){for(let u in s)s.hasOwnProperty(u)&&(d[u]=s[u]);return d}function pT(d){if(typeof d!="number"&&d!=null){let[s,u]=d.split(iL);return!u||u==="px"?parseFloat(s):null}return d||null}function fT(d){return{top:Math.floor(d.top),right:Math.floor(d.right),bottom:Math.floor(d.bottom),left:Math.floor(d.left),width:Math.floor(d.width),height:Math.floor(d.height)}}function nL(d,s){return d===s?!0:d.isOriginClipped===s.isOriginClipped&&d.isOriginOutsideView===s.isOriginOutsideView&&d.isOverlayClipped===s.isOverlayClipped&&d.isOverlayOutsideView===s.isOverlayOutsideView}var gT="cdk-global-overlay-wrapper",g1=class{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(s){let u=s.getConfig();this._overlayRef=s,this._width&&!u.width&&s.updateSize({width:this._width}),this._height&&!u.height&&s.updateSize({height:this._height}),s.hostElement.classList.add(gT),this._isDisposed=!1}top(s=""){return this._bottomOffset="",this._topOffset=s,this._alignItems="flex-start",this}left(s=""){return this._xOffset=s,this._xPosition="left",this}bottom(s=""){return this._topOffset="",this._bottomOffset=s,this._alignItems="flex-end",this}right(s=""){return this._xOffset=s,this._xPosition="right",this}start(s=""){return this._xOffset=s,this._xPosition="start",this}end(s=""){return this._xOffset=s,this._xPosition="end",this}width(s=""){return this._overlayRef?this._overlayRef.updateSize({width:s}):this._width=s,this}height(s=""){return this._overlayRef?this._overlayRef.updateSize({height:s}):this._height=s,this}centerHorizontally(s=""){return this.left(s),this._xPosition="center",this}centerVertically(s=""){return this.top(s),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let s=this._overlayRef.overlayElement.style,u=this._overlayRef.hostElement.style,o=this._overlayRef.getConfig(),{width:l,height:i,maxWidth:_,maxHeight:C}=o,I=(l==="100%"||l==="100vw")&&(!_||_==="100%"||_==="100vw"),O=(i==="100%"||i==="100vh")&&(!C||C==="100%"||C==="100vh"),N=this._xPosition,q=this._xOffset,ie=this._overlayRef.getConfig().direction==="rtl",de="",xe="",ke="";I?ke="flex-start":N==="center"?(ke="center",ie?xe=q:de=q):ie?N==="left"||N==="end"?(ke="flex-end",de=q):(N==="right"||N==="start")&&(ke="flex-start",xe=q):N==="left"||N==="start"?(ke="flex-start",de=q):(N==="right"||N==="end")&&(ke="flex-end",xe=q),s.position=this._cssPosition,s.marginLeft=I?"0":de,s.marginTop=O?"0":this._topOffset,s.marginBottom=this._bottomOffset,s.marginRight=I?"0":xe,u.justifyContent=ke,u.alignItems=O?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let s=this._overlayRef.overlayElement.style,u=this._overlayRef.hostElement,o=u.style;u.classList.remove(gT),o.justifyContent=o.alignItems=s.marginTop=s.marginBottom=s.marginLeft=s.marginRight=s.position="",this._overlayRef=null,this._isDisposed=!0}},rL=(()=>{let s=class s{constructor(o,l,i,_){this._viewportRuler=o,this._document=l,this._platform=i,this._overlayContainer=_}global(){return new g1}flexibleConnectedTo(o){return new gb(o,this._viewportRuler,this._document,this._platform,this._overlayContainer)}};s.\u0275fac=function(l){return new(l||s)(lt(c1),lt(un),lt(jn),lt(Dm))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),oL=0,Yo=(()=>{let s=class s{constructor(o,l,i,_,C,I,O,N,q,ie,de,xe){this.scrollStrategies=o,this._overlayContainer=l,this._componentFactoryResolver=i,this._positionBuilder=_,this._keyboardDispatcher=C,this._injector=I,this._ngZone=O,this._document=N,this._directionality=q,this._location=ie,this._outsideClickDispatcher=de,this._animationsModuleType=xe}create(o){let l=this._createHostElement(),i=this._createPaneElement(l),_=this._createPortalOutlet(i),C=new Em(o);return C.direction=C.direction||this._directionality.value,new Nl(_,l,i,C,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations")}position(){return this._positionBuilder}_createPaneElement(o){let l=this._document.createElement("div");return l.id=`cdk-overlay-${oL++}`,l.classList.add("cdk-overlay-pane"),o.appendChild(l),l}_createHostElement(){let o=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(o),o}_createPortalOutlet(o){return this._appRef||(this._appRef=this._injector.get(rk)),new hb(o,this._componentFactoryResolver,this._appRef,this._injector,this._document)}};s.\u0275fac=function(l){return new(l||s)(lt(J3),lt(Dm),lt(Zf),lt(rL),lt(eL),lt(Ra),lt(Ri),lt(un),lt(zl),lt(Li),lt(tL),lt(Zr,8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var aL=new pn("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let d=vn(Yo);return()=>d.scrollStrategies.reposition()}});function sL(d){return()=>d.scrollStrategies.reposition()}var lL={provide:aL,deps:[Yo],useFactory:sL},Am=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[Yo,lL],imports:[dd,Bl,d1,d1]});let d=s;return d})();var cL=["mat-button",""],dL=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],hL=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var uL=".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}";var mL=["mat-icon-button",""],pL=["*"];var fL=new pn("MAT_BUTTON_CONFIG");var gL=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],yT=(()=>{let s=class s{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(o){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,o)}get disableRipple(){return this._disableRipple}set disableRipple(o){this._disableRipple=o,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(o){this._disabled=o,this._updateRippleDisabled()}constructor(o,l,i,_){this._elementRef=o,this._platform=l,this._ngZone=i,this._animationMode=_,this._focusMonitor=vn(Fl),this._rippleLoader=vn(tT),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let C=vn(fL,{optional:!0}),I=o.nativeElement,O=I.classList;this.disabledInteractive=C?.disabledInteractive??!1,this._rippleLoader?.configureRipple(I,{className:"mat-mdc-button-ripple"});for(let{attribute:N,mdcClasses:q}of gL)I.hasAttribute(N)&&O.add(...q)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(o="program",l){o?this._focusMonitor.focusVia(this._elementRef.nativeElement,o,l):this._elementRef.nativeElement.focus(l)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};s.\u0275fac=function(l){ym()},s.\u0275dir=Zn({type:s,inputs:{color:"color",disableRipple:[Yi.HasDecoratorInputTransform,"disableRipple","disableRipple",Xr],disabled:[Yi.HasDecoratorInputTransform,"disabled","disabled",Xr],ariaDisabled:[Yi.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",Xr],disabledInteractive:[Yi.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",Xr]},features:[xo]});let d=s;return d})();var _1=(()=>{let s=class s extends yT{constructor(o,l,i,_){super(o,l,i,_)}};s.\u0275fac=function(l){return new(l||s)(ye(sn),ye(jn),ye(Ri),ye(Zr,8))},s.\u0275cmp=gt({type:s,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(l,i){l&2&&(_n("disabled",i._getDisabledAttribute())("aria-disabled",i._getAriaDisabled()),ds(i.color?"mat-"+i.color:""),ji("mat-mdc-button-disabled",i.disabled)("mat-mdc-button-disabled-interactive",i.disabledInteractive)("_mat-animation-noopable",i._animationMode==="NoopAnimations")("mat-unthemed",!i.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Po,Nn],attrs:cL,ngContentSelectors:hL,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(l,i){l&1&&(Wo(dL),Me(0,"span",0),wo(1),V(2,"span",1),wo(3,1),j(),wo(4,2),Me(5,"span",2)(6,"span",3)),l&2&&ji("mdc-button__ripple",!i._isFab)("mdc-fab__ripple",i._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let d=s;return d})();var b1=(()=>{let s=class s extends yT{constructor(o,l,i,_){super(o,l,i,_),this._rippleLoader.configureRipple(this._elementRef.nativeElement,{centered:!0})}};s.\u0275fac=function(l){return new(l||s)(ye(sn),ye(jn),ye(Ri),ye(Zr,8))},s.\u0275cmp=gt({type:s,selectors:[["button","mat-icon-button",""]],hostVars:14,hostBindings:function(l,i){l&2&&(_n("disabled",i._getDisabledAttribute())("aria-disabled",i._getAriaDisabled()),ds(i.color?"mat-"+i.color:""),ji("mat-mdc-button-disabled",i.disabled)("mat-mdc-button-disabled-interactive",i.disabledInteractive)("_mat-animation-noopable",i._animationMode==="NoopAnimations")("mat-unthemed",!i.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Po,Nn],attrs:mL,ngContentSelectors:pL,decls:4,vars:0,consts:[[1,"mat-mdc-button-persistent-ripple","mdc-icon-button__ripple"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(l,i){l&1&&(Wo(),Me(0,"span",0),wo(1),Me(2,"span",1)(3,"span",2))},styles:['.mdc-icon-button{display:inline-block;position:relative;box-sizing:border-box;border:none;outline:none;background-color:rgba(0,0,0,0);fill:currentColor;color:inherit;text-decoration:none;cursor:pointer;user-select:none;z-index:0;overflow:visible}.mdc-icon-button .mdc-icon-button__touch{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}@media screen and (forced-colors: active){.mdc-icon-button.mdc-ripple-upgraded--background-focused .mdc-icon-button__focus-ring,.mdc-icon-button:not(.mdc-ripple-upgraded):focus .mdc-icon-button__focus-ring{display:block}}.mdc-icon-button:disabled{cursor:default;pointer-events:none}.mdc-icon-button[hidden]{display:none}.mdc-icon-button--display-flex{align-items:center;display:inline-flex;justify-content:center}.mdc-icon-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%;display:none}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring{border-color:CanvasText}}.mdc-icon-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring::after{border-color:CanvasText}}.mdc-icon-button__icon{display:inline-block}.mdc-icon-button__icon.mdc-icon-button__icon--on{display:none}.mdc-icon-button--on .mdc-icon-button__icon{display:none}.mdc-icon-button--on .mdc-icon-button__icon.mdc-icon-button__icon--on{display:inline-block}.mdc-icon-button__link{height:100%;left:0;outline:none;position:absolute;top:0;width:100%}.mat-mdc-icon-button{color:var(--mdc-icon-button-icon-color)}.mat-mdc-icon-button .mdc-button__icon{font-size:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button svg,.mat-mdc-icon-button img{width:var(--mdc-icon-button-icon-size);height:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button:disabled{color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button{border-radius:50%;flex-shrink:0;text-align:center;width:var(--mdc-icon-button-state-layer-size, 48px);height:var(--mdc-icon-button-state-layer-size, 48px);padding:calc(calc(var(--mdc-icon-button-state-layer-size, 48px) - var(--mdc-icon-button-icon-size, 24px)) / 2);font-size:var(--mdc-icon-button-icon-size);-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-icon-button svg{vertical-align:baseline}.mat-mdc-icon-button[disabled],.mat-mdc-icon-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-icon-button .mat-mdc-button-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-icon-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-icon-button .mdc-button__label{z-index:1}.mat-mdc-icon-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-icon-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-icon-button .mat-ripple-element{background-color:var(--mat-icon-button-ripple-color)}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-state-layer-color)}.mat-mdc-icon-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-disabled-state-layer-color)}.mat-mdc-icon-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-hover-state-layer-opacity)}.mat-mdc-icon-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-focus-state-layer-opacity)}.mat-mdc-icon-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-pressed-state-layer-opacity)}.mat-mdc-icon-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-icon-button-touch-target-display)}.mat-mdc-icon-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple{border-radius:50%}.mat-mdc-icon-button.mat-unthemed:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-primary:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-accent:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-warn:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}',uL],encapsulation:2,changeDetection:0});let d=s;return d})();var vT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[Fn,eT,Fn]});let d=s;return d})();var _L=["mat-calendar-body",""];function bL(d,s){if(d&1&&(V(0,"tr",0)(1,"td",3),X(2),j()()),d&2){let u=ut();pe(),La("padding-top",u._cellPadding)("padding-bottom",u._cellPadding),_n("colspan",u.numCols),pe(),Qi(" ",u.label," ")}}function yL(d,s){if(d&1&&(V(0,"td",3),X(1),j()),d&2){let u=ut(2);La("padding-top",u._cellPadding)("padding-bottom",u._cellPadding),_n("colspan",u._firstRowOffset),pe(),Qi(" ",u._firstRowOffset>=u.labelMinRequiredCells?u.label:""," ")}}function vL(d,s){if(d&1){let u=si();V(0,"td",6)(1,"button",7),Fe("click",function(l){let i=Ct(u).$implicit,_=ut(2);return St(_._cellClicked(i,l))})("focus",function(l){let i=Ct(u).$implicit,_=ut(2);return St(_._emitActiveDateChange(i,l))}),V(2,"span",8),X(3),j(),Me(4,"span",9),j()()}if(d&2){let u=s.$implicit,o=s.$index,l=ut().$index,i=ut();La("width",i._cellWidth)("padding-top",i._cellPadding)("padding-bottom",i._cellPadding),_n("data-mat-row",l)("data-mat-col",o),pe(),ji("mat-calendar-body-disabled",!u.enabled)("mat-calendar-body-active",i._isActiveCell(l,o))("mat-calendar-body-range-start",i._isRangeStart(u.compareValue))("mat-calendar-body-range-end",i._isRangeEnd(u.compareValue))("mat-calendar-body-in-range",i._isInRange(u.compareValue))("mat-calendar-body-comparison-bridge-start",i._isComparisonBridgeStart(u.compareValue,l,o))("mat-calendar-body-comparison-bridge-end",i._isComparisonBridgeEnd(u.compareValue,l,o))("mat-calendar-body-comparison-start",i._isComparisonStart(u.compareValue))("mat-calendar-body-comparison-end",i._isComparisonEnd(u.compareValue))("mat-calendar-body-in-comparison-range",i._isInComparisonRange(u.compareValue))("mat-calendar-body-preview-start",i._isPreviewStart(u.compareValue))("mat-calendar-body-preview-end",i._isPreviewEnd(u.compareValue))("mat-calendar-body-in-preview",i._isInPreview(u.compareValue)),Le("ngClass",u.cssClasses)("tabindex",i._isActiveCell(l,o)?0:-1),_n("aria-label",u.ariaLabel)("aria-disabled",!u.enabled||null)("aria-pressed",i._isSelected(u.compareValue))("aria-current",i.todayValue===u.compareValue?"date":null)("aria-describedby",i._getDescribedby(u.compareValue)),pe(),ji("mat-calendar-body-selected",i._isSelected(u.compareValue))("mat-calendar-body-comparison-identical",i._isComparisonIdentical(u.compareValue))("mat-calendar-body-today",i.todayValue===u.compareValue),pe(),Qi(" ",u.displayValue," ")}}function xL(d,s){if(d&1&&(V(0,"tr",1),Bt(1,yL,2,6,"td",4),gr(2,vL,5,48,"td",5,Xf),j()),d&2){let u=s.$implicit,o=s.$index,l=ut();pe(),Xn(1,o===0&&l._firstRowOffset?1:-1),pe(),_r(u)}}function wL(d,s){if(d&1&&(V(0,"th",2)(1,"span",6),X(2),j(),V(3,"span",3),X(4),j()()),d&2){let u=s.$implicit;pe(2),Rt(u.long),pe(2),Rt(u.narrow)}}var CL=["*"];function SL(d,s){}function ML(d,s){if(d&1){let u=si();V(0,"mat-month-view",2),so("activeDateChange",function(l){Ct(u);let i=ut();return ao(i.activeDate,l)||(i.activeDate=l),St(l)}),Fe("_userSelection",function(l){Ct(u);let i=ut();return St(i._dateSelected(l))})("dragStarted",function(l){Ct(u);let i=ut();return St(i._dragStarted(l))})("dragEnded",function(l){Ct(u);let i=ut();return St(i._dragEnded(l))}),j()}if(d&2){let u=ut();oo("activeDate",u.activeDate),Le("selected",u.selected)("dateFilter",u.dateFilter)("maxDate",u.maxDate)("minDate",u.minDate)("dateClass",u.dateClass)("comparisonStart",u.comparisonStart)("comparisonEnd",u.comparisonEnd)("startDateAccessibleName",u.startDateAccessibleName)("endDateAccessibleName",u.endDateAccessibleName)("activeDrag",u._activeDrag)}}function kL(d,s){if(d&1){let u=si();V(0,"mat-year-view",3),so("activeDateChange",function(l){Ct(u);let i=ut();return ao(i.activeDate,l)||(i.activeDate=l),St(l)}),Fe("monthSelected",function(l){Ct(u);let i=ut();return St(i._monthSelectedInYearView(l))})("selectedChange",function(l){Ct(u);let i=ut();return St(i._goToDateInView(l,"month"))}),j()}if(d&2){let u=ut();oo("activeDate",u.activeDate),Le("selected",u.selected)("dateFilter",u.dateFilter)("maxDate",u.maxDate)("minDate",u.minDate)("dateClass",u.dateClass)}}function TL(d,s){if(d&1){let u=si();V(0,"mat-multi-year-view",4),so("activeDateChange",function(l){Ct(u);let i=ut();return ao(i.activeDate,l)||(i.activeDate=l),St(l)}),Fe("yearSelected",function(l){Ct(u);let i=ut();return St(i._yearSelectedInMultiYearView(l))})("selectedChange",function(l){Ct(u);let i=ut();return St(i._goToDateInView(l,"year"))}),j()}if(d&2){let u=ut();oo("activeDate",u.activeDate),Le("selected",u.selected)("dateFilter",u.dateFilter)("maxDate",u.maxDate)("minDate",u.minDate)("dateClass",u.dateClass)}}function IL(d,s){}var EL=["button"],DL=[[["","matDatepickerToggleIcon",""]]],AL=["[matDatepickerToggleIcon]"];function PL(d,s){d&1&&(nd(),V(0,"svg",2),Me(1,"path",3),j())}var dg=(()=>{let s=class s{constructor(){this.changes=new In,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(o,l){return`${o} \u2013 ${l}`}formatYearRangeLabel(o,l){return`${o} to ${l}`}};s.\u0275fac=function(l){return new(l||s)},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),lg=class{constructor(s,u,o,l,i={},_=s,C){this.value=s,this.displayValue=u,this.ariaLabel=o,this.enabled=l,this.cssClasses=i,this.compareValue=_,this.rawValue=C}},OL=1,xT=Gs({passive:!1,capture:!0}),md=Gs({passive:!0,capture:!0}),_b=Gs({passive:!0}),Rm=(()=>{let s=class s{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(o,l){this._elementRef=o,this._ngZone=l,this._platform=vn(jn),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new on,this.previewChange=new on,this.activeDateChange=new on,this.dragStarted=new on,this.dragEnded=new on,this._didDragSinceMouseDown=!1,this._enterHandler=i=>{if(this._skipNextFocus&&i.type==="focus"){this._skipNextFocus=!1;return}if(i.target&&this.isRange){let _=this._getCellFromElement(i.target);_&&this._ngZone.run(()=>this.previewChange.emit({value:_.enabled?_:null,event:i}))}},this._touchmoveHandler=i=>{if(!this.isRange)return;let _=wT(i),C=_?this._getCellFromElement(_):null;_!==i.target&&(this._didDragSinceMouseDown=!0),v1(i.target)&&i.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:C?.enabled?C:null,event:i}))},this._leaveHandler=i=>{this.previewEnd!==null&&this.isRange&&(i.type!=="blur"&&(this._didDragSinceMouseDown=!0),i.target&&this._getCellFromElement(i.target)&&!(i.relatedTarget&&this._getCellFromElement(i.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:i})))},this._mousedownHandler=i=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;let _=i.target&&this._getCellFromElement(i.target);!_||!this._isInRange(_.compareValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:_.rawValue,event:i})})},this._mouseupHandler=i=>{if(!this.isRange)return;let _=v1(i.target);if(!_){this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:i})});return}_.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{let C=this._getCellFromElement(_);this.dragEnded.emit({value:C?.rawValue??null,event:i})})},this._touchendHandler=i=>{let _=wT(i);_&&this._mouseupHandler({target:_})},this._id=`mat-calendar-body-${OL++}`,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,l.runOutsideAngular(()=>{let i=o.nativeElement;i.addEventListener("touchmove",this._touchmoveHandler,xT),i.addEventListener("mouseenter",this._enterHandler,md),i.addEventListener("focus",this._enterHandler,md),i.addEventListener("mouseleave",this._leaveHandler,md),i.addEventListener("blur",this._leaveHandler,md),i.addEventListener("mousedown",this._mousedownHandler,_b),i.addEventListener("touchstart",this._mousedownHandler,_b),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(o,l){this._didDragSinceMouseDown||o.enabled&&this.selectedValueChange.emit({value:o.value,event:l})}_emitActiveDateChange(o,l){o.enabled&&this.activeDateChange.emit({value:o.value,event:l})}_isSelected(o){return this.startValue===o||this.endValue===o}ngOnChanges(o){let l=o.numCols,{rows:i,numCols:_}=this;(o.rows||l)&&(this._firstRowOffset=i&&i.length&&i[0].length?_-i[0].length:0),(o.cellAspectRatio||l||!this._cellPadding)&&(this._cellPadding=`${50*this.cellAspectRatio/_}%`),(l||!this._cellWidth)&&(this._cellWidth=`${100/_}%`)}ngOnDestroy(){let o=this._elementRef.nativeElement;o.removeEventListener("touchmove",this._touchmoveHandler,xT),o.removeEventListener("mouseenter",this._enterHandler,md),o.removeEventListener("focus",this._enterHandler,md),o.removeEventListener("mouseleave",this._leaveHandler,md),o.removeEventListener("blur",this._leaveHandler,md),o.removeEventListener("mousedown",this._mousedownHandler,_b),o.removeEventListener("touchstart",this._mousedownHandler,_b),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(o,l){let i=o*this.numCols+l;return o&&(i-=this._firstRowOffset),i==this.activeCell}_focusActiveCell(o=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(Oa(1)).subscribe(()=>{setTimeout(()=>{let l=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");l&&(o||(this._skipNextFocus=!0),l.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(o){return x1(o,this.startValue,this.endValue)}_isRangeEnd(o){return w1(o,this.startValue,this.endValue)}_isInRange(o){return C1(o,this.startValue,this.endValue,this.isRange)}_isComparisonStart(o){return x1(o,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(o,l,i){if(!this._isComparisonStart(o)||this._isRangeStart(o)||!this._isInRange(o))return!1;let _=this.rows[l][i-1];if(!_){let C=this.rows[l-1];_=C&&C[C.length-1]}return _&&!this._isRangeEnd(_.compareValue)}_isComparisonBridgeEnd(o,l,i){if(!this._isComparisonEnd(o)||this._isRangeEnd(o)||!this._isInRange(o))return!1;let _=this.rows[l][i+1];if(!_){let C=this.rows[l+1];_=C&&C[0]}return _&&!this._isRangeStart(_.compareValue)}_isComparisonEnd(o){return w1(o,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(o){return C1(o,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(o){return this.comparisonStart===this.comparisonEnd&&o===this.comparisonStart}_isPreviewStart(o){return x1(o,this.previewStart,this.previewEnd)}_isPreviewEnd(o){return w1(o,this.previewStart,this.previewEnd)}_isInPreview(o){return C1(o,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(o){return this.isRange?this.startValue===o&&this.endValue===o?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===o?this._startDateLabelId:this.endValue===o?this._endDateLabelId:null:null}_getCellFromElement(o){let l=v1(o);if(l){let i=l.getAttribute("data-mat-row"),_=l.getAttribute("data-mat-col");if(i&&_)return this.rows[parseInt(i)][parseInt(_)]}return null}};s.\u0275fac=function(l){return new(l||s)(ye(sn),ye(Ri))},s.\u0275cmp=gt({type:s,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],standalone:!0,features:[vo,Nn],attrs:_L,decls:7,vars:5,consts:[["aria-hidden","true"],["role","row"],[1,"mat-calendar-body-hidden-label",3,"id"],[1,"mat-calendar-body-label"],[1,"mat-calendar-body-label",3,"paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"click","focus","ngClass","tabindex"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"]],template:function(l,i){l&1&&(Bt(0,bL,3,6,"tr",0),gr(1,xL,4,1,"tr",1,Xf),V(3,"label",2),X(4),j(),V(5,"label",2),X(6),j()),l&2&&(Xn(0,i._firstRowOffset<i.labelMinRequiredCells?0:-1),pe(),_r(i.rows),pe(2),Le("id",i._startDateLabelId),pe(),Qi(" ",i.startDateAccessibleName,`
`),pe(),Le("id",i._endDateLabelId),pe(),Qi(" ",i.endDateAccessibleName,`
`))},dependencies:[Co],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:start;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}'],encapsulation:2,changeDetection:0});let d=s;return d})();function y1(d){return d?.nodeName==="TD"}function v1(d){let s;return y1(d)?s=d:y1(d.parentNode)?s=d.parentNode:y1(d.parentNode?.parentNode)&&(s=d.parentNode.parentNode),s?.getAttribute("data-mat-row")!=null?s:null}function x1(d,s,u){return u!==null&&s!==u&&d<u&&d===s}function w1(d,s,u){return s!==null&&s!==u&&d>=s&&d===u}function C1(d,s,u,o){return o&&s!==null&&u!==null&&s!==u&&d>=s&&d<=u}function wT(d){let s=d.changedTouches[0];return document.elementFromPoint(s.clientX,s.clientY)}var Ba=class{constructor(s,u){this.start=s,this.end=u}},bb=(()=>{let s=class s{constructor(o,l){this.selection=o,this._adapter=l,this._selectionChanged=new In,this.selectionChanged=this._selectionChanged,this.selection=o}updateSelection(o,l){let i=this.selection;this.selection=o,this._selectionChanged.next({selection:o,source:l,oldValue:i})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(o){return this._adapter.isDateInstance(o)&&this._adapter.isValid(o)}};s.\u0275fac=function(l){ym()},s.\u0275prov=Ht({token:s,factory:s.\u0275fac});let d=s;return d})(),RL=(()=>{let s=class s extends bb{constructor(o){super(null,o)}add(o){super.updateSelection(o,this)}isValid(){return this.selection!=null&&this._isValidDateInstance(this.selection)}isComplete(){return this.selection!=null}clone(){let o=new s(this._adapter);return o.updateSelection(this.selection,this),o}};s.\u0275fac=function(l){return new(l||s)(lt($o))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac});let d=s;return d})();function LL(d,s){return d||new RL(s)}var FL={provide:bb,deps:[[new j0,new XM,bb],$o],useFactory:LL};var TT=new pn("MAT_DATE_RANGE_SELECTION_STRATEGY");var S1=7,CT=(()=>{let s=class s{get activeDate(){return this._activeDate}set activeDate(o){let l=this._activeDate,i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(i,this.minDate,this.maxDate),this._hasSameMonthAndYear(l,this._activeDate)||this._init()}get selected(){return this._selected}set selected(o){o instanceof Ba?this._selected=o:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(o){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))}get maxDate(){return this._maxDate}set maxDate(o){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))}constructor(o,l,i,_,C){this._changeDetectorRef=o,this._dateFormats=l,this._dateAdapter=i,this._dir=_,this._rangeStrategy=C,this._rerenderSubscription=ss.EMPTY,this.activeDrag=null,this.selectedChange=new on,this._userSelection=new on,this.dragStarted=new on,this.dragEnded=new on,this.activeDateChange=new on,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(ls(null)).subscribe(()=>this._init())}ngOnChanges(o){let l=o.comparisonStart||o.comparisonEnd;l&&!l.firstChange&&this._setRanges(this.selected),o.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(o){let l=o.value,i=this._getDateFromDayOfMonth(l),_,C;this._selected instanceof Ba?(_=this._getDateInCurrentMonth(this._selected.start),C=this._getDateInCurrentMonth(this._selected.end)):_=C=this._getDateInCurrentMonth(this._selected),(_!==l||C!==l)&&this.selectedChange.emit(i),this._userSelection.emit({value:i,event:o.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(o){let l=o.value,i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(l),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(o){let l=this._activeDate,i=this._isRtl();switch(o.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,i?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,i?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=o.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=o.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:this._selectionKeyPressed=!0,this._canSelect(this._activeDate)&&o.preventDefault();return;case 27:this._previewEnd!=null&&!Sm(o)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:o}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:o})),o.preventDefault(),o.stopPropagation());return;default:return}this._dateAdapter.compareDate(l,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),o.preventDefault()}_handleCalendarBodyKeyup(o){(o.keyCode===32||o.keyCode===13)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:o}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let o=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(S1+this._dateAdapter.getDayOfWeek(o)-this._dateAdapter.getFirstDayOfWeek())%S1,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(o){this._matCalendarBody._focusActiveCell(o)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:o,value:l}){if(this._rangeStrategy){let i=l?l.rawValue:null,_=this._rangeStrategy.createPreview(i,this.selected,o);if(this._previewStart=this._getCellCompareValue(_.start),this._previewEnd=this._getCellCompareValue(_.end),this.activeDrag&&i){let C=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,i,o);C&&(this._previewStart=this._getCellCompareValue(C.start),this._previewEnd=this._getCellCompareValue(C.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(o){if(this.activeDrag)if(o.value){let l=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,o.value,o.event);this.dragEnded.emit({value:l??null,event:o.event})}else this.dragEnded.emit({value:null,event:o.event})}_getDateFromDayOfMonth(o){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),o)}_initWeekdays(){let o=this._dateAdapter.getFirstDayOfWeek(),l=this._dateAdapter.getDayOfWeekNames("narrow"),_=this._dateAdapter.getDayOfWeekNames("long").map((C,I)=>({long:C,narrow:l[I]}));this._weekdays=_.slice(o).concat(_.slice(0,o))}_createWeekCells(){let o=this._dateAdapter.getNumDaysInMonth(this.activeDate),l=this._dateAdapter.getDateNames();this._weeks=[[]];for(let i=0,_=this._firstWeekOffset;i<o;i++,_++){_==S1&&(this._weeks.push([]),_=0);let C=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),i+1),I=this._shouldEnableDate(C),O=this._dateAdapter.format(C,this._dateFormats.display.dateA11yLabel),N=this.dateClass?this.dateClass(C,"month"):void 0;this._weeks[this._weeks.length-1].push(new lg(i+1,l[i],O,I,N,this._getCellCompareValue(C),C))}}_shouldEnableDate(o){return!!o&&(!this.minDate||this._dateAdapter.compareDate(o,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(o,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(o))}_getDateInCurrentMonth(o){return o&&this._hasSameMonthAndYear(o,this.activeDate)?this._dateAdapter.getDate(o):null}_hasSameMonthAndYear(o,l){return!!(o&&l&&this._dateAdapter.getMonth(o)==this._dateAdapter.getMonth(l)&&this._dateAdapter.getYear(o)==this._dateAdapter.getYear(l))}_getCellCompareValue(o){if(o){let l=this._dateAdapter.getYear(o),i=this._dateAdapter.getMonth(o),_=this._dateAdapter.getDate(o);return new Date(l,i,_).getTime()}return null}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setRanges(o){o instanceof Ba?(this._rangeStart=this._getCellCompareValue(o.start),this._rangeEnd=this._getCellCompareValue(o.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(o),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(o){return!this.dateFilter||this.dateFilter(o)}_clearPreview(){this._previewStart=this._previewEnd=null}};s.\u0275fac=function(l){return new(l||s)(ye(lo),ye(Tm,8),ye($o,8),ye(zl,8),ye(TT,8))},s.\u0275cmp=gt({type:s,selectors:[["mat-month-view"]],viewQuery:function(l,i){if(l&1&&Ci(Rm,5),l&2){let _;vi(_=xi())&&(i._matCalendarBody=_.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],standalone:!0,features:[vo,Nn],decls:8,vars:14,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["scope","col"],["aria-hidden","true"],["colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown","label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName"],[1,"cdk-visually-hidden"]],template:function(l,i){l&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),gr(3,wL,5,2,"th",2,Xf),j(),V(5,"tr",3),Me(6,"th",4),j()(),V(7,"tbody",5),Fe("selectedValueChange",function(C){return i._dateSelected(C)})("activeDateChange",function(C){return i._updateActiveDate(C)})("previewChange",function(C){return i._previewChanged(C)})("dragStarted",function(C){return i.dragStarted.emit(C)})("dragEnded",function(C){return i._dragEnded(C)})("keyup",function(C){return i._handleCalendarBodyKeyup(C)})("keydown",function(C){return i._handleCalendarBodyKeydown(C)}),j()()),l&2&&(pe(3),_r(i._weekdays),pe(4),Le("label",i._monthLabel)("rows",i._weeks)("todayValue",i._todayDate)("startValue",i._rangeStart)("endValue",i._rangeEnd)("comparisonStart",i._comparisonRangeStart)("comparisonEnd",i._comparisonRangeEnd)("previewStart",i._previewStart)("previewEnd",i._previewEnd)("isRange",i._isRange)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1)("startDateAccessibleName",i.startDateAccessibleName)("endDateAccessibleName",i.endDateAccessibleName))},dependencies:[Rm],encapsulation:2,changeDetection:0});let d=s;return d})(),fa=24,M1=4,ST=(()=>{let s=class s{get activeDate(){return this._activeDate}set activeDate(o){let l=this._activeDate,i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(i,this.minDate,this.maxDate),IT(this._dateAdapter,l,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(o){o instanceof Ba?this._selected=o:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o)),this._setSelectedYear(o)}get minDate(){return this._minDate}set minDate(o){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))}get maxDate(){return this._maxDate}set maxDate(o){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))}constructor(o,l,i){this._changeDetectorRef=o,this._dateAdapter=l,this._dir=i,this._rerenderSubscription=ss.EMPTY,this.selectedChange=new on,this.yearSelected=new on,this.activeDateChange=new on,this._dateAdapter,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(ls(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());let l=this._dateAdapter.getYear(this._activeDate)-sg(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let i=0,_=[];i<fa;i++)_.push(l+i),_.length==M1&&(this._years.push(_.map(C=>this._createCellForYear(C))),_=[]);this._changeDetectorRef.markForCheck()}_yearSelected(o){let l=o.value,i=this._dateAdapter.createDate(l,0,1),_=this._getDateFromYear(l);this.yearSelected.emit(i),this.selectedChange.emit(_)}_updateActiveDate(o){let l=o.value,i=this._activeDate;this.activeDate=this._getDateFromYear(l),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(o){let l=this._activeDate,i=this._isRtl();switch(o.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,i?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,i?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-M1);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,M1);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-sg(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,fa-sg(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,o.altKey?-fa*10:-fa);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,o.altKey?fa*10:fa);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(l,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),o.preventDefault()}_handleCalendarBodyKeyup(o){(o.keyCode===32||o.keyCode===13)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:o}),this._selectionKeyPressed=!1)}_getActiveCell(){return sg(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(o){let l=this._dateAdapter.getMonth(this.activeDate),i=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(o,l,1));return this._dateAdapter.createDate(o,l,Math.min(this._dateAdapter.getDate(this.activeDate),i))}_createCellForYear(o){let l=this._dateAdapter.createDate(o,0,1),i=this._dateAdapter.getYearName(l),_=this.dateClass?this.dateClass(l,"multi-year"):void 0;return new lg(o,i,i,this._shouldEnableYear(o),_)}_shouldEnableYear(o){if(o==null||this.maxDate&&o>this._dateAdapter.getYear(this.maxDate)||this.minDate&&o<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;let l=this._dateAdapter.createDate(o,0,1);for(let i=l;this._dateAdapter.getYear(i)==o;i=this._dateAdapter.addCalendarDays(i,1))if(this.dateFilter(i))return!0;return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedYear(o){if(this._selectedYear=null,o instanceof Ba){let l=o.start||o.end;l&&(this._selectedYear=this._dateAdapter.getYear(l))}else o&&(this._selectedYear=this._dateAdapter.getYear(o))}};s.\u0275fac=function(l){return new(l||s)(ye(lo),ye($o,8),ye(zl,8))},s.\u0275cmp=gt({type:s,selectors:[["mat-multi-year-view"]],viewQuery:function(l,i){if(l&1&&Ci(Rm,5),l&2){let _;vi(_=xi())&&(i._matCalendarBody=_.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],standalone:!0,features:[Nn],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell"]],template:function(l,i){l&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),Me(3,"th",2),j()(),V(4,"tbody",3),Fe("selectedValueChange",function(C){return i._yearSelected(C)})("activeDateChange",function(C){return i._updateActiveDate(C)})("keyup",function(C){return i._handleCalendarBodyKeyup(C)})("keydown",function(C){return i._handleCalendarBodyKeydown(C)}),j()()),l&2&&(pe(4),Le("rows",i._years)("todayValue",i._todayYear)("startValue",i._selectedYear)("endValue",i._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",i._getActiveCell()))},dependencies:[Rm],encapsulation:2,changeDetection:0});let d=s;return d})();function IT(d,s,u,o,l){let i=d.getYear(s),_=d.getYear(u),C=ET(d,o,l);return Math.floor((i-C)/fa)===Math.floor((_-C)/fa)}function sg(d,s,u,o){let l=d.getYear(s);return zL(l-ET(d,u,o),fa)}function ET(d,s,u){let o=0;return u?o=d.getYear(u)-fa+1:s&&(o=d.getYear(s)),o}function zL(d,s){return(d%s+s)%s}var MT=(()=>{let s=class s{get activeDate(){return this._activeDate}set activeDate(o){let l=this._activeDate,i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(i,this.minDate,this.maxDate),this._dateAdapter.getYear(l)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(o){o instanceof Ba?this._selected=o:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o)),this._setSelectedMonth(o)}get minDate(){return this._minDate}set minDate(o){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))}get maxDate(){return this._maxDate}set maxDate(o){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))}constructor(o,l,i,_){this._changeDetectorRef=o,this._dateFormats=l,this._dateAdapter=i,this._dir=_,this._rerenderSubscription=ss.EMPTY,this.selectedChange=new on,this.monthSelected=new on,this.activeDateChange=new on,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(ls(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(o){let l=o.value,i=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),l,1);this.monthSelected.emit(i);let _=this._getDateFromMonth(l);this.selectedChange.emit(_)}_updateActiveDate(o){let l=o.value,i=this._activeDate;this.activeDate=this._getDateFromMonth(l),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(o){let l=this._activeDate,i=this._isRtl();switch(o.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,i?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,i?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,o.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,o.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(l,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),o.preventDefault()}_handleCalendarBodyKeyup(o){(o.keyCode===32||o.keyCode===13)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:o}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let o=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(l=>l.map(i=>this._createCellForMonth(i,o[i]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(o){return o&&this._dateAdapter.getYear(o)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(o):null}_getDateFromMonth(o){let l=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),o,1),i=this._dateAdapter.getNumDaysInMonth(l);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),o,Math.min(this._dateAdapter.getDate(this.activeDate),i))}_createCellForMonth(o,l){let i=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),o,1),_=this._dateAdapter.format(i,this._dateFormats.display.monthYearA11yLabel),C=this.dateClass?this.dateClass(i,"year"):void 0;return new lg(o,l.toLocaleUpperCase(),_,this._shouldEnableMonth(o),C)}_shouldEnableMonth(o){let l=this._dateAdapter.getYear(this.activeDate);if(o==null||this._isYearAndMonthAfterMaxDate(l,o)||this._isYearAndMonthBeforeMinDate(l,o))return!1;if(!this.dateFilter)return!0;let i=this._dateAdapter.createDate(l,o,1);for(let _=i;this._dateAdapter.getMonth(_)==o;_=this._dateAdapter.addCalendarDays(_,1))if(this.dateFilter(_))return!0;return!1}_isYearAndMonthAfterMaxDate(o,l){if(this.maxDate){let i=this._dateAdapter.getYear(this.maxDate),_=this._dateAdapter.getMonth(this.maxDate);return o>i||o===i&&l>_}return!1}_isYearAndMonthBeforeMinDate(o,l){if(this.minDate){let i=this._dateAdapter.getYear(this.minDate),_=this._dateAdapter.getMonth(this.minDate);return o<i||o===i&&l<_}return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedMonth(o){o instanceof Ba?this._selectedMonth=this._getMonthInCurrentYear(o.start)||this._getMonthInCurrentYear(o.end):this._selectedMonth=this._getMonthInCurrentYear(o)}};s.\u0275fac=function(l){return new(l||s)(ye(lo),ye(Tm,8),ye($o,8),ye(zl,8))},s.\u0275cmp=gt({type:s,selectors:[["mat-year-view"]],viewQuery:function(l,i){if(l&1&&Ci(Rm,5),l&2){let _;vi(_=xi())&&(i._matCalendarBody=_.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],standalone:!0,features:[Nn],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell"]],template:function(l,i){l&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),Me(3,"th",2),j()(),V(4,"tbody",3),Fe("selectedValueChange",function(C){return i._monthSelected(C)})("activeDateChange",function(C){return i._updateActiveDate(C)})("keyup",function(C){return i._handleCalendarBodyKeyup(C)})("keydown",function(C){return i._handleCalendarBodyKeydown(C)}),j()()),l&2&&(pe(4),Le("label",i._yearLabel)("rows",i._months)("todayValue",i._todayMonth)("startValue",i._selectedMonth)("endValue",i._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",i._dateAdapter.getMonth(i.activeDate)))},dependencies:[Rm],encapsulation:2,changeDetection:0});let d=s;return d})(),BL=1,DT=(()=>{let s=class s{constructor(o,l,i,_,C){this._intl=o,this.calendar=l,this._dateAdapter=i,this._dateFormats=_,this._id=`mat-calendar-header-${BL++}`,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>C.markForCheck())}get periodButtonText(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return this.calendar.currentView=="month"?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView=this.calendar.currentView=="month"?"multi-year":"month"}previousClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?-1:-fa)}nextClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?1:fa)}previousEnabled(){return this.calendar.minDate?!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate):!0}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(o,l){return this.calendar.currentView=="month"?this._dateAdapter.getYear(o)==this._dateAdapter.getYear(l)&&this._dateAdapter.getMonth(o)==this._dateAdapter.getMonth(l):this.calendar.currentView=="year"?this._dateAdapter.getYear(o)==this._dateAdapter.getYear(l):IT(this._dateAdapter,o,l,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){let l=this._dateAdapter.getYear(this.calendar.activeDate)-sg(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),i=l+fa-1,_=this._dateAdapter.getYearName(this._dateAdapter.createDate(l,0,1)),C=this._dateAdapter.getYearName(this._dateAdapter.createDate(i,0,1));return[_,C]}};s.\u0275fac=function(l){return new(l||s)(ye(dg),ye(V0(()=>k1)),ye($o,8),ye(Tm,8),ye(lo))},s.\u0275cmp=gt({type:s,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],standalone:!0,features:[Nn],ngContentSelectors:CL,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],[1,"cdk-visually-hidden",3,"id"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"click","disabled"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"click","disabled"]],template:function(l,i){l&1&&(Wo(),V(0,"div",0)(1,"div",1)(2,"label",2),X(3),j(),V(4,"button",3),Fe("click",function(){return i.currentPeriodClicked()}),V(5,"span",4),X(6),j(),nd(),V(7,"svg",5),Me(8,"polygon",6),j()(),Fx(),Me(9,"div",7),wo(10),V(11,"button",8),Fe("click",function(){return i.previousClicked()}),j(),V(12,"button",9),Fe("click",function(){return i.nextClicked()}),j()()()),l&2&&(pe(2),Le("id",i._periodButtonLabelId),pe(),Rt(i.periodButtonDescription),pe(),_n("aria-label",i.periodButtonLabel)("aria-describedby",i._periodButtonLabelId),pe(2),Rt(i.periodButtonText),pe(),ji("mat-calendar-invert",i.calendar.currentView!=="month"),pe(4),Le("disabled",!i.previousEnabled()),_n("aria-label",i.prevButtonLabel),pe(),Le("disabled",!i.nextEnabled()),_n("aria-label",i.nextButtonLabel))},dependencies:[_1,b1],encapsulation:2,changeDetection:0});let d=s;return d})(),k1=(()=>{let s=class s{get startAt(){return this._startAt}set startAt(o){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))}get selected(){return this._selected}set selected(o){o instanceof Ba?this._selected=o:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))}get minDate(){return this._minDate}set minDate(o){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))}get maxDate(){return this._maxDate}set maxDate(o){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(o))}get activeDate(){return this._clampedActiveDate}set activeDate(o){this._clampedActiveDate=this._dateAdapter.clampDate(o,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(o){let l=this._currentView!==o?o:null;this._currentView=o,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),l&&this.viewChanged.emit(l)}constructor(o,l,i,_){this._dateAdapter=l,this._dateFormats=i,this._changeDetectorRef=_,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new on,this.yearSelected=new on,this.monthSelected=new on,this.viewChanged=new on(!0),this._userSelection=new on,this._userDragDrop=new on,this._activeDrag=null,this.stateChanges=new In,this._intlChanges=o.changes.subscribe(()=>{_.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new hd(this.headerComponent||DT),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(o){let l=o.minDate&&!this._dateAdapter.sameDate(o.minDate.previousValue,o.minDate.currentValue)?o.minDate:void 0,i=o.maxDate&&!this._dateAdapter.sameDate(o.maxDate.previousValue,o.maxDate.currentValue)?o.maxDate:void 0,_=l||i||o.dateFilter;if(_&&!_.firstChange){let C=this._getCurrentViewComponent();C&&(this._changeDetectorRef.detectChanges(),C._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(o){let l=o.value;(this.selected instanceof Ba||l&&!this._dateAdapter.sameDate(l,this.selected))&&this.selectedChange.emit(l),this._userSelection.emit(o)}_yearSelectedInMultiYearView(o){this.yearSelected.emit(o)}_monthSelectedInYearView(o){this.monthSelected.emit(o)}_goToDateInView(o,l){this.activeDate=o,this.currentView=l}_dragStarted(o){this._activeDrag=o}_dragEnded(o){this._activeDrag&&(o.value&&this._userDragDrop.emit(o),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}};s.\u0275fac=function(l){return new(l||s)(ye(dg),ye($o,8),ye(Tm,8),ye(lo))},s.\u0275cmp=gt({type:s,selectors:[["mat-calendar"]],viewQuery:function(l,i){if(l&1&&(Ci(CT,5),Ci(MT,5),Ci(ST,5)),l&2){let _;vi(_=xi())&&(i.monthView=_.first),vi(_=xi())&&(i.yearView=_.first),vi(_=xi())&&(i.multiYearView=_.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],standalone:!0,features:[us([FL]),vo,Nn],decls:5,vars:2,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content"],[3,"activeDateChange","_userSelection","dragStarted","dragEnded","activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag"],[3,"activeDateChange","monthSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"],[3,"activeDateChange","yearSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"]],template:function(l,i){if(l&1&&(Bt(0,SL,0,0,"ng-template",0),V(1,"div",1),Bt(2,ML,1,11)(3,kL,1,6)(4,TL,1,6),j()),l&2){let _;Le("cdkPortalOutlet",i._calendarHeaderPortal),pe(2),Xn(2,(_=i.currentView)==="month"?2:_==="year"?3:_==="multi-year"?4:-1)}},dependencies:[ud,Uk,CT,MT,ST],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight);--mdc-text-button-label-text-color:var(--mat-datepicker-calendar-period-button-text-color)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button:not(.mat-mdc-button-disabled),.mat-datepicker-content .mat-calendar-next-button:not(.mat-mdc-button-disabled){color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let d=s;return d})(),kT={transformPanel:Hx("transformPanel",[Kf("void => enter-dropdown",Qf("120ms cubic-bezier(0, 0, 0.2, 1)",Gx([cd({opacity:0,transform:"scale(1, 0.8)"}),cd({opacity:1,transform:"scale(1, 1)"})]))),Kf("void => enter-dialog",Qf("150ms cubic-bezier(0, 0, 0.2, 1)",Gx([cd({opacity:0,transform:"scale(0.7)"}),cd({transform:"none",opacity:1})]))),Kf("* => void",Qf("100ms linear",cd({opacity:0})))]),fadeInCalendar:Hx("fadeInCalendar",[Wx("void",cd({opacity:0})),Wx("enter",cd({opacity:1})),Kf("void => *",Qf("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])};var NL=new pn("mat-datepicker-scroll-strategy",{providedIn:"root",factory:()=>{let d=vn(Yo);return()=>d.scrollStrategies.reposition()}});function VL(d){return()=>d.scrollStrategies.reposition()}var jL={provide:NL,deps:[Yo],useFactory:VL},UL=(()=>{let s=class s{constructor(o,l,i,_,C,I){this._elementRef=o,this._changeDetectorRef=l,this._globalModel=i,this._dateAdapter=_,this._rangeSelectionStrategy=C,this._subscriptions=new ss,this._animationDone=new In,this._isAnimating=!1,this._actionsPortal=null,this._closeButtonText=I.closeCalendarLabel}ngOnInit(){this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(o){let l=this._model.selection,i=o.value,_=l instanceof Ba;if(_&&this._rangeSelectionStrategy){let C=this._rangeSelectionStrategy.selectionFinished(i,l,o.event);this._model.updateSelection(C,this)}else i&&(_||!this._dateAdapter.sameDate(i,l))&&this._model.add(i);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(o){this._model.updateSelection(o.value,this)}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_handleAnimationEvent(o){this._isAnimating=o.phaseName==="start",this._isAnimating||this._animationDone.next()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(o,l){this._model=o?this._globalModel.clone():this._globalModel,this._actionsPortal=o,l&&this._changeDetectorRef.detectChanges()}};s.\u0275fac=function(l){return new(l||s)(ye(sn),ye(lo),ye(bb),ye($o),ye(TT,8),ye(dg))},s.\u0275cmp=gt({type:s,selectors:[["mat-datepicker-content"]],viewQuery:function(l,i){if(l&1&&Ci(k1,5),l&2){let _;vi(_=xi())&&(i._calendar=_.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:5,hostBindings:function(l,i){l&1&&tk("@transformPanel.start",function(C){return i._handleAnimationEvent(C)})("@transformPanel.done",function(C){return i._handleAnimationEvent(C)}),l&2&&(ek("@transformPanel",i._animationState),ds(i.color?"mat-"+i.color:""),ji("mat-datepicker-content-touch",i.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],standalone:!0,features:[Nn],decls:5,vars:27,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop","id","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"focus","blur","click","color"]],template:function(l,i){if(l&1&&(V(0,"div",0)(1,"mat-calendar",1),Fe("yearSelected",function(C){return i.datepicker._selectYear(C)})("monthSelected",function(C){return i.datepicker._selectMonth(C)})("viewChanged",function(C){return i.datepicker._viewChanged(C)})("_userSelection",function(C){return i._handleUserSelection(C)})("_userDragDrop",function(C){return i._handleUserDragDrop(C)}),j(),Bt(2,IL,0,0,"ng-template",2),V(3,"button",3),Fe("focus",function(){return i._closeButtonFocused=!0})("blur",function(){return i._closeButtonFocused=!1})("click",function(){return i.datepicker.close()}),X(4),j()()),l&2){let _;ji("mat-datepicker-content-container-with-custom-header",i.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",i._actionsPortal),_n("aria-modal",!0)("aria-labelledby",(_=i._dialogLabelId)!==null&&_!==void 0?_:void 0),pe(),ds(i.datepicker.panelClass),Le("id",i.datepicker.id)("startAt",i.datepicker.startAt)("startView",i.datepicker.startView)("minDate",i.datepicker._getMinDate())("maxDate",i.datepicker._getMaxDate())("dateFilter",i.datepicker._getDateFilter())("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i._getSelected())("dateClass",i.datepicker.dateClass)("comparisonStart",i.comparisonStart)("comparisonEnd",i.comparisonEnd)("@fadeInCalendar","enter")("startDateAccessibleName",i.startDateAccessibleName)("endDateAccessibleName",i.endDateAccessibleName),pe(),Le("cdkPortalOutlet",i._actionsPortal),pe(),ji("cdk-visually-hidden",!i._closeButtonFocused),Le("color",i.color||"primary"),pe(),Rt(i._closeButtonText)}},dependencies:[Vk,k1,ud,_1],styles:[".mat-datepicker-content{display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color);color:var(--mat-datepicker-calendar-container-text-color);box-shadow:var(--mat-datepicker-calendar-container-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-shape)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;box-shadow:var(--mat-datepicker-calendar-container-touch-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-touch-shape);position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}"],encapsulation:2,data:{animation:[kT.transformPanel,kT.fadeInCalendar]},changeDetection:0});let d=s;return d})();var HL=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275dir=Zn({type:s,selectors:[["","matDatepickerToggleIcon",""]],standalone:!0});let d=s;return d})(),WL=(()=>{let s=class s{get disabled(){return this._disabled===void 0&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(o){this._disabled=o}constructor(o,l,i){this._intl=o,this._changeDetectorRef=l,this._stateChanges=ss.EMPTY;let _=Number(i);this.tabIndex=_||_===0?_:null}ngOnChanges(o){o.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(o){this.datepicker&&!this.disabled&&(this.datepicker.open(),o.stopPropagation())}_watchStateChanges(){let o=this.datepicker?this.datepicker.stateChanges:Yr(),l=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:Yr(),i=this.datepicker?Ph(this.datepicker.openedStream,this.datepicker.closedStream):Yr();this._stateChanges.unsubscribe(),this._stateChanges=Ph(this._intl.changes,o,l,i).subscribe(()=>this._changeDetectorRef.markForCheck())}};s.\u0275fac=function(l){return new(l||s)(ye(dg),ye(lo),bm("tabindex"))},s.\u0275cmp=gt({type:s,selectors:[["mat-datepicker-toggle"]],contentQueries:function(l,i,_){if(l&1&&W0(_,HL,5),l&2){let C;vi(C=xi())&&(i._customIcon=C.first)}},viewQuery:function(l,i){if(l&1&&Ci(EL,5),l&2){let _;vi(_=xi())&&(i._button=_.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(l,i){l&1&&Fe("click",function(C){return i._open(C)}),l&2&&(_n("tabindex",null)("data-mat-calendar",i.datepicker?i.datepicker.id:null),ji("mat-datepicker-toggle-active",i.datepicker&&i.datepicker.opened)("mat-accent",i.datepicker&&i.datepicker.color==="accent")("mat-warn",i.datepicker&&i.datepicker.color==="warn"))},inputs:{datepicker:[Yi.None,"for","datepicker"],tabIndex:"tabIndex",ariaLabel:[Yi.None,"aria-label","ariaLabel"],disabled:[Yi.HasDecoratorInputTransform,"disabled","disabled",Xr],disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],standalone:!0,features:[xo,vo,Nn],ngContentSelectors:AL,decls:4,vars:6,consts:[["button",""],["mat-icon-button","","type","button",3,"disabled","disableRipple"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(l,i){l&1&&(Wo(DL),V(0,"button",1,0),Bt(2,PL,2,0,":svg:svg",2),wo(3),j()),l&2&&(Le("disabled",i.disabled)("disableRipple",i.disableRipple),_n("aria-haspopup",i.datepicker?"dialog":null)("aria-label",i.ariaLabel||i._intl.openCalendarLabel)("tabindex",i.disabled?-1:i.tabIndex),pe(2),Xn(2,i._customIcon?-1:2))},dependencies:[b1],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color)}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color)}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}"],encapsulation:2,changeDetection:0});let d=s;return d})();var AT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[dg,jL],imports:[Hs,vT,Am,sb,Bl,Fn,UL,WL,DT,ub]});let d=s;return d})();function GL(d,s){}var jh=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}};var F1=(()=>{let s=class s extends Im{constructor(o,l,i,_,C,I,O,N){super(),this._elementRef=o,this._focusTrapFactory=l,this._config=_,this._interactivityChecker=C,this._ngZone=I,this._overlayRef=O,this._focusMonitor=N,this._platform=vn(jn),this._focusTrap=null,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this._changeDetectorRef=vn(lo),this.attachDomPortal=q=>{this._portalOutlet.hasAttached();let ie=this._portalOutlet.attachDomPortal(q);return this._contentAttached(),ie},this._document=i,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(o){this._ariaLabelledByQueue.push(o),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(o){let l=this._ariaLabelledByQueue.indexOf(o);l>-1&&(this._ariaLabelledByQueue.splice(l,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(o){this._portalOutlet.hasAttached();let l=this._portalOutlet.attachComponentPortal(o);return this._contentAttached(),l}attachTemplatePortal(o){this._portalOutlet.hasAttached();let l=this._portalOutlet.attachTemplatePortal(o);return this._contentAttached(),l}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(o,l){this._interactivityChecker.isFocusable(o)||(o.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let i=()=>{o.removeEventListener("blur",i),o.removeEventListener("mousedown",i),o.removeAttribute("tabindex")};o.addEventListener("blur",i),o.addEventListener("mousedown",i)})),o.focus(l)}_focusByCssSelector(o,l){let i=this._elementRef.nativeElement.querySelector(o);i&&this._forceFocus(i,l)}_trapFocus(){let o=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||o.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElementWhenReady().then(l=>{l||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}}_restoreFocus(){let o=this._config.restoreFocus,l=null;if(typeof o=="string"?l=this._document.querySelector(o):typeof o=="boolean"?l=o?this._elementFocusedBeforeDialogWasOpened:null:o&&(l=o),this._config.restoreFocus&&l&&typeof l.focus=="function"){let i=Fh(),_=this._elementRef.nativeElement;(!i||i===this._document.body||i===_||_.contains(i))&&(this._focusMonitor?(this._focusMonitor.focusVia(l,this._closeInteractionType),this._closeInteractionType=null):l.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let o=this._elementRef.nativeElement,l=Fh();return o===l||o.contains(l)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=Fh()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}};s.\u0275fac=function(l){return new(l||s)(ye(sn),ye(rg),ye(un,8),ye(jh),ye(ng),ye(Ri),ye(Nl),ye(Fl))},s.\u0275cmp=gt({type:s,selectors:[["cdk-dialog-container"]],viewQuery:function(l,i){if(l&1&&Ci(ud,7),l&2){let _;vi(_=xi())&&(i._portalOutlet=_.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(l,i){l&2&&_n("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledByQueue[0])("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},standalone:!0,features:[Po,Nn],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(l,i){l&1&&Bt(0,GL,0,0,"ng-template",0)},dependencies:[ud],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2});let d=s;return d})(),hg=class{constructor(s,u){this.overlayRef=s,this.config=u,this.closed=new In,this.disableClose=u.disableClose,this.backdropClick=s.backdropClick(),this.keydownEvents=s.keydownEvents(),this.outsidePointerEvents=s.outsidePointerEvents(),this.id=u.id,this.keydownEvents.subscribe(o=>{o.keyCode===27&&!this.disableClose&&!Sm(o)&&(o.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=s.detachments().subscribe(()=>{u.closeOnOverlayDetachments!==!1&&this.close()})}close(s,u){if(this.containerInstance){let o=this.closed;this.containerInstance._closeInteractionType=u?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),o.next(s),o.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(s="",u=""){return this.overlayRef.updateSize({width:s,height:u}),this}addPanelClass(s){return this.overlayRef.addPanelClass(s),this}removePanelClass(s){return this.overlayRef.removePanelClass(s),this}},qL=new pn("DialogScrollStrategy",{providedIn:"root",factory:()=>{let d=vn(Yo);return()=>d.scrollStrategies.block()}}),$L=new pn("DialogData"),YL=new pn("DefaultDialogConfig");var ZL=0,z1=(()=>{let s=class s{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(o,l,i,_,C,I){this._overlay=o,this._injector=l,this._defaultOptions=i,this._parentDialog=_,this._overlayContainer=C,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new In,this._afterOpenedAtThisLevel=new In,this._ariaHiddenElements=new Map,this.afterAllClosed=B0(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ls(void 0))),this._scrollStrategy=I}open(o,l){let i=this._defaultOptions||new jh;l=$i($i({},i),l),l.id=l.id||`cdk-dialog-${ZL++}`,l.id&&this.getDialogById(l.id);let _=this._getOverlayConfig(l),C=this._overlay.create(_),I=new hg(C,l),O=this._attachContainer(C,I,l);return I.containerInstance=O,this._attachDialogContent(o,I,O,l),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(I),I.closed.subscribe(()=>this._removeOpenDialog(I,!0)),this.afterOpened.next(I),I}closeAll(){L1(this.openDialogs,o=>o.close())}getDialogById(o){return this.openDialogs.find(l=>l.id===o)}ngOnDestroy(){L1(this._openDialogsAtThisLevel,o=>{o.config.closeOnDestroy===!1&&this._removeOpenDialog(o,!1)}),L1(this._openDialogsAtThisLevel,o=>o.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(o){let l=new Em({positionStrategy:o.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:o.scrollStrategy||this._scrollStrategy(),panelClass:o.panelClass,hasBackdrop:o.hasBackdrop,direction:o.direction,minWidth:o.minWidth,minHeight:o.minHeight,maxWidth:o.maxWidth,maxHeight:o.maxHeight,width:o.width,height:o.height,disposeOnNavigation:o.closeOnNavigation});return o.backdropClass&&(l.backdropClass=o.backdropClass),l}_attachContainer(o,l,i){let _=i.injector||i.viewContainerRef?.injector,C=[{provide:jh,useValue:i},{provide:hg,useValue:l},{provide:Nl,useValue:o}],I;i.container?typeof i.container=="function"?I=i.container:(I=i.container.type,C.push(...i.container.providers(i))):I=F1;let O=new hd(I,i.viewContainerRef,Ra.create({parent:_||this._injector,providers:C}),i.componentFactoryResolver);return o.attach(O).instance}_attachDialogContent(o,l,i,_){if(o instanceof Rh){let C=this._createInjector(_,l,i,void 0),I={$implicit:_.data,dialogRef:l};_.templateContext&&(I=$i($i({},I),typeof _.templateContext=="function"?_.templateContext():_.templateContext)),i.attachTemplatePortal(new Nh(o,null,I,C))}else{let C=this._createInjector(_,l,i,this._injector),I=i.attachComponentPortal(new hd(o,_.viewContainerRef,C,_.componentFactoryResolver));l.componentRef=I,l.componentInstance=I.instance}}_createInjector(o,l,i,_){let C=o.injector||o.viewContainerRef?.injector,I=[{provide:$L,useValue:o.data},{provide:hg,useValue:l}];return o.providers&&(typeof o.providers=="function"?I.push(...o.providers(l,o,i)):I.push(...o.providers)),o.direction&&(!C||!C.get(zl,null,{optional:!0}))&&I.push({provide:zl,useValue:{value:o.direction,change:Yr()}}),Ra.create({parent:C||_,providers:I})}_removeOpenDialog(o,l){let i=this.openDialogs.indexOf(o);i>-1&&(this.openDialogs.splice(i,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((_,C)=>{_?C.setAttribute("aria-hidden",_):C.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),l&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let o=this._overlayContainer.getContainerElement();if(o.parentElement){let l=o.parentElement.children;for(let i=l.length-1;i>-1;i--){let _=l[i];_!==o&&_.nodeName!=="SCRIPT"&&_.nodeName!=="STYLE"&&!_.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(_,_.getAttribute("aria-hidden")),_.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let o=this._parentDialog;return o?o._getAfterAllClosed():this._afterAllClosedAtThisLevel}};s.\u0275fac=function(l){return new(l||s)(lt(Yo),lt(Ra),lt(YL,8),lt(s,12),lt(Dm),lt(qL))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function L1(d,s){let u=d.length;for(;u--;)s(d[u])}var PT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[z1],imports:[Am,Bl,sb,Bl]});let d=s;return d})();function XL(d,s){}var ug=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}},B1="mdc-dialog--open",OT="mdc-dialog--opening",RT="mdc-dialog--closing",QL=150,KL=75,JL=(()=>{let s=class s extends F1{constructor(o,l,i,_,C,I,O,N,q){super(o,l,i,_,C,I,O,q),this._animationMode=N,this._animationStateChanged=new on,this._animationsEnabled=this._animationMode!=="NoopAnimations",this._actionSectionCount=0,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?FT(this._config.enterAnimationDuration)??QL:0,this._exitAnimationDuration=this._animationsEnabled?FT(this._config.exitAnimationDuration)??KL:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(LT,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(OT,B1)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(B1),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(B1),this._animationsEnabled?(this._hostElement.style.setProperty(LT,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(RT)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(o){this._actionSectionCount+=o,this._changeDetectorRef.markForCheck()}_clearAnimationClasses(){this._hostElement.classList.remove(OT,RT)}_waitForAnimationToComplete(o,l){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(l,o)}_requestAnimationFrame(o){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(o):o()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(o){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:o})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(o){let l=super.attachComponentPortal(o);return l.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),l}};s.\u0275fac=function(l){return new(l||s)(ye(sn),ye(rg),ye(un,8),ye(ug),ye(ng),ye(Ri),ye(Nl),ye(Zr,8),ye(Fl))},s.\u0275cmp=gt({type:s,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(l,i){l&2&&(Rl("id",i._config.id),_n("aria-modal",i._config.ariaModal)("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledByQueue[0])("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),ji("_mat-animation-noopable",!i._animationsEnabled)("mat-mdc-dialog-container-with-actions",i._actionSectionCount>0))},standalone:!0,features:[Po,Nn],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1),Bt(2,XL,0,0,"ng-template",2),j()())},dependencies:[ud],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0;transform:scale(0.8)}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--closing .mdc-dialog__surface{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{opacity:1}.mdc-dialog--open .mdc-dialog__surface{transform:none}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{width:100%;height:100%}.mat-mdc-dialog-component-host{display:contents}.mat-mdc-dialog-container{--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition:opacity linear var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container .mdc-dialog__surface{transition:transform var(--mat-dialog-transition-duration, 0ms) 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container,.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__surface{transition:none}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 80vw);min-width:var(--mat-dialog-container-min-width, 0)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, 80vw)}}.mat-mdc-dialog-title{padding:var(--mat-dialog-headline-padding, 0 24px 9px)}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{padding:var(--mat-dialog-actions-padding, 8px);justify-content:var(--mat-dialog-actions-alignment, start)}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2});let d=s;return d})(),LT="--mat-dialog-transition-duration";function FT(d){return d==null?null:typeof d=="number"?d:d.endsWith("ms")?ig(d.substring(0,d.length-2)):d.endsWith("s")?ig(d.substring(0,d.length-1))*1e3:d==="0"?0:null}var yb=function(d){return d[d.OPEN=0]="OPEN",d[d.CLOSING=1]="CLOSING",d[d.CLOSED=2]="CLOSED",d}(yb||{}),Lm=class{constructor(s,u,o){this._ref=s,this._containerInstance=o,this._afterOpened=new In,this._beforeClosed=new In,this._state=yb.OPEN,this.disableClose=u.disableClose,this.id=s.id,s.addPanelClass("mat-mdc-dialog-panel"),o._animationStateChanged.pipe(pa(l=>l.state==="opened"),Oa(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),o._animationStateChanged.pipe(pa(l=>l.state==="closed"),Oa(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),s.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Ph(this.backdropClick(),this.keydownEvents().pipe(pa(l=>l.keyCode===27&&!this.disableClose&&!Sm(l)))).subscribe(l=>{this.disableClose||(l.preventDefault(),eF(this,l.type==="keydown"?"keyboard":"mouse"))})}close(s){this._result=s,this._containerInstance._animationStateChanged.pipe(pa(u=>u.state==="closing"),Oa(1)).subscribe(u=>{this._beforeClosed.next(s),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),u.totalTime+100)}),this._state=yb.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(s){let u=this._ref.config.positionStrategy;return s&&(s.left||s.right)?s.left?u.left(s.left):u.right(s.right):u.centerHorizontally(),s&&(s.top||s.bottom)?s.top?u.top(s.top):u.bottom(s.bottom):u.centerVertically(),this._ref.updatePosition(),this}updateSize(s="",u=""){return this._ref.updateSize(s,u),this}addPanelClass(s){return this._ref.addPanelClass(s),this}removePanelClass(s){return this._ref.removePanelClass(s),this}getState(){return this._state}_finishDialogClose(){this._state=yb.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function eF(d,s,u){return d._closeInteractionType=s,d.close(u)}var N1=new pn("MatMdcDialogData"),tF=new pn("mat-mdc-dialog-default-options"),iF=new pn("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let d=vn(Yo);return()=>d.scrollStrategies.block()}});var nF=0,Fm=(()=>{let s=class s{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let o=this._parentDialog;return o?o._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(o,l,i,_,C,I,O,N){this._overlay=o,this._defaultOptions=_,this._scrollStrategy=C,this._parentDialog=I,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new In,this._afterOpenedAtThisLevel=new In,this.dialogConfigClass=ug,this.afterAllClosed=B0(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ls(void 0))),this._dialog=l.get(z1),this._dialogRefConstructor=Lm,this._dialogContainerType=JL,this._dialogDataToken=N1}open(o,l){let i;l=$i($i({},this._defaultOptions||new ug),l),l.id=l.id||`mat-mdc-dialog-${nF++}`,l.scrollStrategy=l.scrollStrategy||this._scrollStrategy();let _=this._dialog.open(o,Pa($i({},l),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:l},{provide:jh,useValue:l}]},templateContext:()=>({dialogRef:i}),providers:(C,I,O)=>(i=new this._dialogRefConstructor(C,l,O),i.updatePosition(l?.position),[{provide:this._dialogContainerType,useValue:O},{provide:this._dialogDataToken,useValue:I.data},{provide:this._dialogRefConstructor,useValue:i}])}));return i.componentRef=_.componentRef,i.componentInstance=_.componentInstance,this.openDialogs.push(i),this.afterOpened.next(i),i.afterClosed().subscribe(()=>{let C=this.openDialogs.indexOf(i);C>-1&&(this.openDialogs.splice(C,1),this.openDialogs.length||this._getAfterAllClosed().next())}),i}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(o){return this.openDialogs.find(l=>l.id===o)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(o){let l=o.length;for(;l--;)o[l].close()}};s.\u0275fac=function(l){return new(l||s)(lt(Yo),lt(Ra),lt(Li,8),lt(tF,8),lt(iF),lt(s,12),lt(Dm),lt(Zr,8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),rF=0;var zT=(()=>{let s=class s{constructor(o,l,i){this._dialogRef=o,this._elementRef=l,this._dialog=i}ngOnInit(){this._dialogRef||(this._dialogRef=oF(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{this._onAdd()})}ngOnDestroy(){this._dialogRef?._containerInstance&&Promise.resolve().then(()=>{this._onRemove()})}};s.\u0275fac=function(l){return new(l||s)(ye(Lm,8),ye(sn),ye(Fm))},s.\u0275dir=Zn({type:s,standalone:!0});let d=s;return d})(),BT=(()=>{let s=class s extends zT{constructor(){super(...arguments),this.id=`mat-mdc-dialog-title-${rF++}`}_onAdd(){this._dialogRef._containerInstance?._addAriaLabelledBy?.(this.id)}_onRemove(){this._dialogRef?._containerInstance?._removeAriaLabelledBy?.(this.id)}};s.\u0275fac=(()=>{let o;return function(i){return(o||(o=_m(s)))(i||s)}})(),s.\u0275dir=Zn({type:s,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-mdc-dialog-title","mdc-dialog__title"],hostVars:1,hostBindings:function(l,i){l&2&&Rl("id",i.id)},inputs:{id:"id"},exportAs:["matDialogTitle"],standalone:!0,features:[Po]});let d=s;return d})(),NT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275dir=Zn({type:s,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],standalone:!0});let d=s;return d})(),VT=(()=>{let s=class s extends zT{_onAdd(){this._dialogRef._containerInstance?._updateActionSectionCount?.(1)}_onRemove(){this._dialogRef._containerInstance?._updateActionSectionCount?.(-1)}};s.\u0275fac=(()=>{let o;return function(i){return(o||(o=_m(s)))(i||s)}})(),s.\u0275dir=Zn({type:s,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:6,hostBindings:function(l,i){l&2&&ji("mat-mdc-dialog-actions-align-start",i.align==="start")("mat-mdc-dialog-actions-align-center",i.align==="center")("mat-mdc-dialog-actions-align-end",i.align==="end")},inputs:{align:"align"},standalone:!0,features:[Po]});let d=s;return d})();function oF(d,s){let u=d.nativeElement.parentElement;for(;u&&!u.classList.contains("mat-mdc-dialog-container");)u=u.parentElement;return u?s.find(o=>o.id===u.id):null}var jT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[Fm],imports:[PT,Am,Bl,Fn,Fn]});let d=s;return d})();var UT=(()=>{let s=class s{constructor(o){this.router=o,setTimeout(()=>{this.router.navigate(["started"])},4e3)}};s.\u0275fac=function(l){return new(l||s)(ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-landing-page"]],decls:3,vars:0,consts:[["gifElement",""],[1,"container"],["src","assets/new/ti.gif","alt","Loading...",1,"gif-loader"]],template:function(l,i){l&1&&(V(0,"div",1),Me(1,"img",2,0),j())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}"]});let d=s;return d})();function aF(d,s){if(d&1){let u=si();V(0,"div",7)(1,"div",8),X(2),j(),Me(3,"br")(4,"br"),V(5,"div")(6,"label",9),Fe("click",function(){let l=Ct(u).$implicit,i=ut();return St(i.selectOnlyOne(l))}),Me(7,"input",10),j()()()}if(d&2){let u=s.$implicit;pe(2),Rt(u.languages),pe(4),ji("checked",u.isChecked),pe(),Le("checked",u.isChecked)}}var HT=(()=>{let s=class s{constructor(o){this.router=o,this.Language=[{languages:"English",isChecked:!1},{languages:"\u0939\u093F\u0902\u0926\u0940",isChecked:!1},{languages:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41",isChecked:!1},{languages:"\u0C95\u0CA8\u0CCD\u0CA8\u0CA1",isChecked:!1},{languages:"\u0627\u0631\u062F\u0648",isChecked:!1}]}toggleCheckbox(o){o.isChecked?o.isChecked=!1:o.isChecked=!0}selectOnlyOne(o){this.Language.forEach(l=>{l.isChecked=!1}),o.isChecked=!0,console.log(o.languages)}submit(){this.router.navigate(["log-in"])}};s.\u0275fac=function(l){return new(l||s)(ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-language"]],decls:14,vars:1,consts:[[1,"container"],[1,"sub-container"],[1,"select-language"],["src","assets\\logo\\language logo.png"],["class","Language-div",4,"ngFor","ngForOf"],[1,"btn"],[3,"click"],[1,"Language-div"],[1,"language-text"],[1,"custom-checkbox",3,"click"],["type","checkbox",3,"checked"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),X(4,"Select Language"),j(),Me(5,"img",3),j(),Me(6,"br")(7,"br"),Bt(8,aF,8,4,"div",4),Me(9,"br")(10,"br"),V(11,"div",5)(12,"button",6),Fe("click",function(){return i.submit()}),X(13,"Continue"),j()()()()),l&2&&(pe(8),Le("ngForOf",i.Language))},dependencies:[br],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:90%;position:relative;top:10%;left:5%}.select-language[_ngcontent-%COMP%]{display:flex;justify-content:space-between}span[_ngcontent-%COMP%]{font-size:1.4rem;font-family:inter;font-weight:500}.Language-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.language-text[_ngcontent-%COMP%]{font-size:1.3rem;font-family:inter;font-weight:500}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:#d16611}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}.btn[_ngcontent-%COMP%]{width:100%;align-items:center}button[_ngcontent-%COMP%]{width:90%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}']});let d=s;return d})();var xn="https://appsvc-apibackend-dev.azurewebsites.net/v1.0/";var WT=(()=>{let s=class s{constructor(o){this.http=o,this.apiUrl=xn,this.api=this.apiUrl+"providers/provider-auth/signup"}setLog(o){console.log(o);let l={phone:o};console.log(l),this.http.post(this.api,l).subscribe(i=>{console.log(i)},i=>{console.log(i)})}setDefult(){this.api="",this.apiUrl=""}};s.\u0275fac=function(l){return new(l||s)(lt(Zi))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var vb=(()=>{let s=class s{constructor(o,l){this.dialogRef=o,this.data=l,this.content="",this.content=l.content,setTimeout(()=>{this.onNoClick()},3e3)}onNoClick(){this.dialogRef.close()}};s.\u0275fac=function(l){return new(l||s)(ye(Lm),ye(N1))},s.\u0275cmp=gt({type:s,selectors:[["app-demo"]],inputs:{content:"content"},decls:3,vars:1,consts:[[1,"mat-dialog-container","bottom-dialog-container"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"p"),X(2),j()()),l&2&&(pe(2),Rt(i.content))},styles:[".mat-dialog-container[_ngcontent-%COMP%]{position:fixed;bottom:2rem;left:5%;width:90%;height:auto;border-radius:16px;color:#fff;background-color:#0d0c0cad;padding:8px;display:flex;align-items:center;justify-content:center}"]});let d=s;return d})();var Zo=(()=>{let s=class s{constructor(o){this.dialog=o}openDialog(o){let l={content:o};this.dialog.open(vb,{width:"100%",height:"auto",panelClass:"bottom-dialog-container",data:l})}};s.\u0275fac=function(l){return new(l||s)(lt(Fm))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Qn=(()=>{let s=class s{constructor(o,l,i){this.http=o,this.router=l,this.dialogService=i,this.apiUrl=xn,this.userDetails=[],this.workDetails=[],this.alreadyHasAccount=!1,this.isAccountVerify=!0,this.api="",this.name="",this.experience=0,this.selectedSubCategories=[],this.userFromServer=[]}setLogInApi(){this.api=this.apiUrl+"providers/provider-auth/login",console.log(this.api)}setSignUpApi(){this.api=this.apiUrl+"providers/provider-auth/signup",console.log(this.api)}setLog(o){console.log(o),console.log(this.api);let l={phone:o};console.log(l),this.http.post(this.api,l).subscribe(i=>{console.log(i),this.responseOtp=i,this.userNumber=o,this.router.navigate(["verify"])},i=>{console.log(i),console.log(i.error),console.log(i.error.message),i.error.message==="User does not exist. Please sign up first."?(alert("Account was not found. Please signUp first."),this.router.navigate(["selectAccount"])):alert("something went wrong.Please retry again")})}showOtp(){alert(this.responseOtp.otp)}resendOtp(){console.log(this.userNumber),console.log(this.api);let o={phone:this.userNumber};console.log(o),this.http.post(this.api,o).subscribe(l=>{console.log(l)},l=>{console.log(l)})}verifyOtp(o){let l={otp:o,phone:this.userNumber},i=this.apiUrl+"providers/provider-auth/verify-otp";return this.http.post(i,l)}setUserInLocalStroage(o){localStorage.setItem("providerId",o)}setUser(o){this.userDetails.push({number:this.userNumber}),console.log(this.userDetails),localStorage.setItem("providerId",o),this.userId=localStorage.getItem("providerId")}getUserId(){let o=localStorage.getItem("providerId");return console.log(o),Yr(o)}removeUser(){localStorage.removeItem("providerId")}setWork(o,l){this.workName=o,this.workId=l}setSubCat(o){console.log(o),this.selectedSubCategories.push(o),console.log(this.selectedSubCategories)}setAge(o){console.log(o),this.age=o,console.log(this.age)}setExperiance(o){console.log(o),this.experience=o}setWorkDetails(){console.log(this.selectedSubCategories);let o=[{categoryId:this.workId,experience:this.experience,subcategoryId:this.selectedSubCategories}];this.workDetails.push(o),console.log(this.workDetails.flat())}getSubCategory(){let o=this.apiUrl+`core/sub-categories/category/${this.categoryId}`;return this.http.get(o)}sendWorkDetails(){let o=this.apiUrl+"providers/provider-work",l=this.workDetails.flat(),_={providerId:localStorage.getItem("providerId"),works:l};return console.log(_),this.http.post(o,_)}UserDetails(o){let l=[];o.forEach((_,C)=>{l.push(C=_)}),console.log(l),console.log(o);let i=this.apiUrl+"providers/provider-details";this.http.post(i,o).subscribe(_=>{console.log("Success",_),this.userFromServer=_,this.router.navigate(["aadharVerify"])},_=>{console.error("Error",_),_.error instanceof ErrorEvent?alert("A network error occurred. Please try again later."):alert("An error occurred. Please try again later."),console.error(`Backend returned code ${_.status}, body was: `,_.error)})}formatingResponse(o){console.log(o.work),console.log(o.work);let i=JSON.parse(o.work).flat();this.userFromServer.work=i,console.log(this.userFromServer)}updateUserWork(o,l){console.log(o);let i=localStorage.getItem("providerId");console.log(l);let _={providerId:i,works:o};console.log("work in service",_);let C=this.apiUrl+"providers/provider-work";this.http.post(C,_).subscribe(I=>{console.log(I),this.dialogService.openDialog("Service has been updated"),this.router.navigate(["home"])},I=>{console.log(I)})}getPhoneNumber(){let o=localStorage.getItem("providerId"),l=this.apiUrl+`providers/provider-auth/${o}`;return this.http.get(l).subscribe(i=>{this.userNumber=i.phone,console.log(this.userNumber)},i=>{console.log(i)}),this.userNumber}setDefult(){this.userDetails=[],this.workDetails=[],this.userNumber=null,this.userId="",this.alreadyHasAccount=!1,this.isAccountVerify=!0,this.api="",this.responseOtp="",this.name="",this.pincode="",this.radius=void 0,this.workName="",this.workId="",this.age="",this.gender="",this.experience=0,this.selectedSubCategories=[],this.categoryId="",this.userFromServer=[]}};s.\u0275fac=function(l){return new(l||s)(lt(Zi),lt(jt),lt(Zo))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Va=d=>({"full-screen":d}),lF=(d,s)=>({"border-radius":d,"background-color":s}),cF=(d,s,u,o)=>({"border-top-color":d,"border-right-color":s,"border-bottom-color":u,"border-left-color":o}),nr=d=>({"background-color":d}),dF=d=>({color:d});function hF(d,s){if(d&1&&Me(0,"div",14),d&2){let u=ut(2);Le("ngClass",li(2,Va,u.config.fullScreenBackdrop===!0))("ngStyle",ik(4,cF,u.config.secondaryColour,u.config.secondaryColour,u.config.secondaryColour,u.config.primaryColour))}}function uF(d,s){if(d&1&&(V(0,"div",15),Me(1,"div",16)(2,"div",17)(3,"div",18)(4,"div",19)(5,"div",20)(6,"div",21)(7,"div",22)(8,"div",23)(9,"div",24),j()),d&2){let u=ut(2);Le("ngClass",li(10,Va,u.config.fullScreenBackdrop===!0)),pe(),Le("ngStyle",li(12,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(14,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(16,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(18,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(20,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(22,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(24,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(26,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(28,nr,u.config.primaryColour))}}function mF(d,s){if(d&1&&Me(0,"div",25),d&2){let u=ut(2);Le("ngStyle",li(2,nr,u.config.primaryColour))("ngClass",li(4,Va,u.config.fullScreenBackdrop===!0))}}function pF(d,s){if(d&1&&(V(0,"div",26),Me(1,"div",27)(2,"div",28)(3,"div",29)(4,"div",30)(5,"div",31),j()),d&2){let u=ut(2);Le("ngClass",li(6,Va,u.config.fullScreenBackdrop===!0)),pe(),Le("ngStyle",li(8,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(10,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(12,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(14,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(16,nr,u.config.primaryColour))}}function fF(d,s){if(d&1&&(V(0,"div",32),Me(1,"div",33)(2,"div",34),j()),d&2){let u=ut(2);Le("ngClass",li(3,Va,u.config.fullScreenBackdrop===!0)),pe(),Le("ngStyle",li(5,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(7,nr,u.config.secondaryColour))}}function gF(d,s){if(d&1&&(V(0,"div",35),Me(1,"div",36)(2,"div",37),j()),d&2){let u=ut(2);Le("ngClass",li(3,Va,u.config.fullScreenBackdrop===!0)),pe(),Le("ngStyle",li(5,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(7,nr,u.config.secondaryColour))}}function _F(d,s){if(d&1&&Me(0,"div",38),d&2){let u=ut(2);Le("ngClass",li(2,Va,u.config.fullScreenBackdrop===!0))("ngStyle",li(4,nr,u.config.primaryColour))}}function bF(d,s){if(d&1&&(V(0,"div",39),Me(1,"div",40)(2,"div",41),j()),d&2){let u=ut(2);Le("ngClass",li(3,Va,u.config.fullScreenBackdrop===!0)),pe(),Le("ngStyle",li(5,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(7,nr,u.config.secondaryColour))}}function yF(d,s){if(d&1&&Me(0,"div",42),d&2){let u=ut(2);Le("ngClass",li(2,Va,u.config.fullScreenBackdrop===!0))("ngStyle",li(4,dF,u.config.primaryColour))}}function vF(d,s){if(d&1&&Me(0,"div",43),d&2){let u=ut(2);Le("ngClass",li(1,Va,u.config.fullScreenBackdrop===!0))}}function xF(d,s){if(d&1&&(V(0,"div",44),Me(1,"div",45)(2,"div",46)(3,"div",47),j()),d&2){let u=ut(2);Le("ngClass",li(4,Va,u.config.fullScreenBackdrop===!0)),pe(),Le("ngStyle",li(6,nr,u.config.primaryColour)),pe(),Le("ngStyle",li(8,nr,u.config.secondaryColour)),pe(),Le("ngStyle",li(10,nr,u.config.tertiaryColour))}}function wF(d,s){d&1&&Bx(0)}function CF(d,s){if(d&1&&(od(0),Bt(1,wF,1,0,"ng-container",48),ad()),d&2){let u=ut(2);pe(),Le("ngTemplateOutlet",u.template)}}function SF(d,s){if(d&1&&(V(0,"div"),Me(1,"div",1),V(2,"div",2),Bt(3,hF,1,9,"div",3)(4,uF,10,30,"div",4)(5,mF,1,6,"div",5)(6,pF,6,18,"div",6)(7,fF,3,9,"div",7)(8,gF,3,9,"div",8)(9,_F,1,6,"div",9)(10,bF,3,9,"div",10)(11,yF,1,6,"div",11)(12,vF,1,3,"div",12)(13,xF,4,12,"div",13)(14,CF,2,1,"ng-container",0),j()()),d&2){let u=ut();pe(),Le("ngClass",li(14,Va,u.config.fullScreenBackdrop===!0))("ngStyle",Nx(16,lF,u.config.backdropBorderRadius,u.config.backdropBackgroundColour)),pe(),Le("ngSwitch",u.config.animationType),pe(),Le("ngSwitchCase",u.ngxLoadingAnimationTypes.circle),pe(),Le("ngSwitchCase",u.ngxLoadingAnimationTypes.cubeGrid),pe(),Le("ngSwitchCase",u.ngxLoadingAnimationTypes.rotatingPlane),pe(),Le("ngSwitchCase",u.ngxLoadingAnimationTypes.rectangleBounce),pe(),Le("ngSwitchCase",u.ngxLoadingAnimationTypes.wanderingCubes),pe(),Le("ngSwitchCase",u.ngxLoadingAnimationTypes.doubleBounce),pe(),Le("ngSwitchCase",u.ngxLoadingAnimationTypes.pulse),pe(),Le("ngSwitchCase",u.ngxLoadingAnimationTypes.chasingDots),pe(),Le("ngSwitchCase",u.ngxLoadingAnimationTypes.circleSwish),pe(),Le("ngSwitchCase",u.ngxLoadingAnimationTypes.none),pe(2),Le("ngIf",u.template)}}var xb=class{constructor(s={}){this.backdropBorderRadius=s.backdropBorderRadius,this.backdropBackgroundColour=s.backdropBackgroundColour,this.fullScreenBackdrop=s.fullScreenBackdrop,this.animationType=s.animationType,this.primaryColour=s.primaryColour,this.secondaryColour=s.secondaryColour,this.tertiaryColour=s.tertiaryColour}},GT={chasingDots:"chasing-dots",circle:"sk-circle",circleSwish:"circleSwish",cubeGrid:"sk-cube-grid",doubleBounce:"double-bounce",none:"none",pulse:"pulse",rectangleBounce:"rectangle-bounce",rotatingPlane:"rotating-plane",threeBounce:"three-bounce",wanderingCubes:"wandering-cubes"},MF=(()=>{let s=class s{constructor(o){this.config=o,this.loadingConfig=this.config||new xb}};s.\u0275fac=function(l){return new(l||s)(lt("loadingConfig",8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),wb=(()=>{let s=class s{constructor(o){this.LoadingService=o,this.show=!1,this.config=new xb,this.defaultConfig={animationType:GT.threeBounce,backdropBackgroundColour:"rgba(0, 0, 0, 0.3)",backdropBorderRadius:"0px",fullScreenBackdrop:!1,primaryColour:"#ffffff",secondaryColour:"#ffffff",tertiaryColour:"#ffffff"},this.ngxLoadingAnimationTypes=GT}ngOnInit(){this.setupConfig()}setupConfig(){for(let o in this.defaultConfig)this.config[o]==null&&(this.config[o]=this.LoadingService.loadingConfig[o]!=null?this.LoadingService.loadingConfig[o]:this.defaultConfig[o])}};s.\u0275fac=function(l){return new(l||s)(ye(MF))},s.\u0275cmp=gt({type:s,selectors:[["ngx-loading"]],inputs:{show:"show",config:"config",template:"template"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"backdrop",3,"ngClass","ngStyle"],[3,"ngSwitch"],["class","spinner-circle",3,"ngClass","ngStyle",4,"ngSwitchCase"],["class","sk-cube-grid",3,"ngClass",4,"ngSwitchCase"],["class","spinner-sk-rotateplane",3,"ngStyle","ngClass",4,"ngSwitchCase"],["class","spinner-rectangle-bounce",3,"ngClass",4,"ngSwitchCase"],["class","spinner-wandering-cubes",3,"ngClass",4,"ngSwitchCase"],["class","spinner-double-bounce",3,"ngClass",4,"ngSwitchCase"],["class","spinner-pulse",3,"ngClass","ngStyle",4,"ngSwitchCase"],["class","spinner-chasing-dots",3,"ngClass",4,"ngSwitchCase"],["class","spinner-circle-swish",3,"ngClass","ngStyle",4,"ngSwitchCase"],[3,"ngClass",4,"ngSwitchCase"],["class","spinner-three-bounce",3,"ngClass",4,"ngSwitchDefault"],[1,"spinner-circle",3,"ngClass","ngStyle"],[1,"sk-cube-grid",3,"ngClass"],[1,"sk-cube","sk-cube1",3,"ngStyle"],[1,"sk-cube","sk-cube2",3,"ngStyle"],[1,"sk-cube","sk-cube3",3,"ngStyle"],[1,"sk-cube","sk-cube4",3,"ngStyle"],[1,"sk-cube","sk-cube5",3,"ngStyle"],[1,"sk-cube","sk-cube6",3,"ngStyle"],[1,"sk-cube","sk-cube7",3,"ngStyle"],[1,"sk-cube","sk-cube8",3,"ngStyle"],[1,"sk-cube","sk-cube9",3,"ngStyle"],[1,"spinner-sk-rotateplane",3,"ngStyle","ngClass"],[1,"spinner-rectangle-bounce",3,"ngClass"],[1,"rect1",3,"ngStyle"],[1,"rect2",3,"ngStyle"],[1,"rect3",3,"ngStyle"],[1,"rect4",3,"ngStyle"],[1,"rect5",3,"ngStyle"],[1,"spinner-wandering-cubes",3,"ngClass"],[1,"cube1",3,"ngStyle"],[1,"cube2",3,"ngStyle"],[1,"spinner-double-bounce",3,"ngClass"],[1,"double-bounce1",3,"ngStyle"],[1,"double-bounce2",3,"ngStyle"],[1,"spinner-pulse",3,"ngClass","ngStyle"],[1,"spinner-chasing-dots",3,"ngClass"],[1,"dot1",3,"ngStyle"],[1,"dot2",3,"ngStyle"],[1,"spinner-circle-swish",3,"ngClass","ngStyle"],[3,"ngClass"],[1,"spinner-three-bounce",3,"ngClass"],[1,"bounce1",3,"ngStyle"],[1,"bounce2",3,"ngStyle"],[1,"bounce3",3,"ngStyle"],[4,"ngTemplateOutlet"]],template:function(l,i){l&1&&Bt(0,SF,15,19,"div",0),l&2&&Le("ngIf",i.show)},dependencies:[Co,lr,Y0,$0,ak,sk,lk],styles:['.backdrop[_ngcontent-%COMP%]{z-index:1999;position:absolute;inset:0;background-color:#0000004d}.spinner-circle[_ngcontent-%COMP%], .spinner-circle[_ngcontent-%COMP%]:after{border-radius:50%;width:10em;height:10em}.spinner-circle[_ngcontent-%COMP%]{font-size:6px;border-top:1.1em solid rgba(255,255,255,.2);border-right:1.1em solid rgba(255,255,255,.2);border-bottom:1.1em solid rgba(255,255,255,.2);border-left:1.1em solid #ffffff;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:_ngcontent-%COMP%_load8 1.1s infinite linear;animation:_ngcontent-%COMP%_load8 1.1s infinite linear}@-webkit-keyframes _ngcontent-%COMP%_load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.spinner-circle-swish[_ngcontent-%COMP%]{font-size:60px;overflow:hidden;width:1em;height:1em;border-radius:50%;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:_ngcontent-%COMP%_load6 1.7s infinite ease;animation:_ngcontent-%COMP%_load6 1.7s infinite ease}@-webkit-keyframes _ngcontent-%COMP%_load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;-webkit-transform:rotate(0deg)}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}to{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;-webkit-transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;transform:rotate(0)}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}to{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;transform:rotate(360deg)}}.sk-cube-grid[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube[_ngcontent-%COMP%]{width:33%;height:33%;background-color:#333;float:left;-webkit-animation:_ngcontent-%COMP%_sk-cubeGridScaleDelay 1.3s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-cubeGridScaleDelay 1.3s infinite ease-in-out}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube1[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube2[_ngcontent-%COMP%]{-webkit-animation-delay:.3s;animation-delay:.3s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube3[_ngcontent-%COMP%]{-webkit-animation-delay:.4s;animation-delay:.4s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube4[_ngcontent-%COMP%]{-webkit-animation-delay:.1s;animation-delay:.1s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube5[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube6[_ngcontent-%COMP%]{-webkit-animation-delay:.3s;animation-delay:.3s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube7[_ngcontent-%COMP%]{-webkit-animation-delay:0s;animation-delay:0s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube8[_ngcontent-%COMP%]{-webkit-animation-delay:.1s;animation-delay:.1s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube9[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}@-webkit-keyframes _ngcontent-%COMP%_sk-cubeGridScaleDelay{0%,70%,to{-webkit-transform:scale3D(1,1,1);transform:scaleZ(1)}35%{-webkit-transform:scale3D(0,0,1);transform:scale3D(0,0,1)}}@keyframes _ngcontent-%COMP%_sk-cubeGridScaleDelay{0%,70%,to{-webkit-transform:scale3D(1,1,1);transform:scaleZ(1)}35%{-webkit-transform:scale3D(0,0,1);transform:scale3D(0,0,1)}}.spinner-double-bounce[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.double-bounce1[_ngcontent-%COMP%], .double-bounce2[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;background-color:#333;opacity:.6;position:absolute;top:0;left:0;-webkit-animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out}.double-bounce2[_ngcontent-%COMP%]{-webkit-animation-delay:-1s;animation-delay:-1s}.spinner-pulse[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#333;position:absolute;inset:0;margin:auto;z-index:2000;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-scaleout 1s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-scaleout 1s infinite ease-in-out}@-webkit-keyframes _ngcontent-%COMP%_sk-scaleout{0%{-webkit-transform:scale(0)}to{-webkit-transform:scale(1);opacity:0}}@keyframes _ngcontent-%COMP%_sk-scaleout{0%{-webkit-transform:scale(0);transform:scale(0)}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.spinner-three-bounce[_ngcontent-%COMP%]{width:70px;text-align:center;position:absolute;inset:0;height:20px;margin:auto;z-index:2000}.spinner-three-bounce[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:18px;height:18px;background-color:#fff;border-radius:100%;display:inline-block;-webkit-animation:_ngcontent-%COMP%_sk-bouncedelay 1.4s infinite ease-in-out both;animation:_ngcontent-%COMP%_sk-bouncedelay 1.4s infinite ease-in-out both}.spinner-three-bounce[_ngcontent-%COMP%]   .bounce1[_ngcontent-%COMP%]{-webkit-animation-delay:-.32s;animation-delay:-.32s}.spinner-three-bounce[_ngcontent-%COMP%]   .bounce2[_ngcontent-%COMP%]{-webkit-animation-delay:-.16s;animation-delay:-.16s}@-webkit-keyframes _ngcontent-%COMP%_sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0)}40%{-webkit-transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.spinner-sk-rotateplane[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#fff;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-animation:_ngcontent-%COMP%_sk-rotateplane 1.2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-rotateplane 1.2s infinite ease-in-out}@-webkit-keyframes _ngcontent-%COMP%_sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}to{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes _ngcontent-%COMP%_sk-rotateplane{0%{transform:perspective(120px) rotateX(0) rotateY(0);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}to{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}.spinner-rectangle-bounce[_ngcontent-%COMP%]{width:50px;height:40px;font-size:10px;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000}.spinner-rectangle-bounce[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background-color:#fff;height:100%;width:6px;display:inline-block;-webkit-animation:_ngcontent-%COMP%_sk-stretchdelay 1.2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-stretchdelay 1.2s infinite ease-in-out}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect2[_ngcontent-%COMP%]{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect3[_ngcontent-%COMP%]{-webkit-animation-delay:-1s;animation-delay:-1s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect4[_ngcontent-%COMP%]{-webkit-animation-delay:-.9s;animation-delay:-.9s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect5[_ngcontent-%COMP%]{-webkit-animation-delay:-.8s;animation-delay:-.8s}@-webkit-keyframes _ngcontent-%COMP%_sk-stretchdelay{0%,40%,to{-webkit-transform:scaleY(.4)}20%{-webkit-transform:scaleY(1)}}@keyframes _ngcontent-%COMP%_sk-stretchdelay{0%,40%,to{transform:scaleY(.4);-webkit-transform:scaleY(.4)}20%{transform:scaleY(1);-webkit-transform:scaleY(1)}}.spinner-wandering-cubes[_ngcontent-%COMP%]{width:60px;height:58px;font-size:10px;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000}.cube1[_ngcontent-%COMP%], .cube2[_ngcontent-%COMP%]{background-color:#fff;width:15px;height:15px;position:absolute;top:0;left:0;-webkit-animation:_ngcontent-%COMP%_sk-cubemove 1.8s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-cubemove 1.8s infinite ease-in-out}.cube2[_ngcontent-%COMP%]{-webkit-animation-delay:-.9s;animation-delay:-.9s}@-webkit-keyframes _ngcontent-%COMP%_sk-cubemove{25%{-webkit-transform:translateX(42px) rotate(-90deg) scale(.5)}50%{-webkit-transform:translateX(42px) translateY(42px) rotate(-180deg)}75%{-webkit-transform:translateX(0px) translateY(42px) rotate(-270deg) scale(.5)}to{-webkit-transform:rotate(-360deg)}}@keyframes _ngcontent-%COMP%_sk-cubemove{25%{transform:translate(42px) rotate(-90deg) scale(.5);-webkit-transform:translateX(42px) rotate(-90deg) scale(.5)}50%{transform:translate(42px) translateY(42px) rotate(-179deg);-webkit-transform:translateX(42px) translateY(42px) rotate(-179deg)}50.1%{transform:translate(42px) translateY(42px) rotate(-180deg);-webkit-transform:translateX(42px) translateY(42px) rotate(-180deg)}75%{transform:translate(0) translateY(42px) rotate(-270deg) scale(.5);-webkit-transform:translateX(0px) translateY(42px) rotate(-270deg) scale(.5)}to{transform:rotate(-360deg);-webkit-transform:rotate(-360deg)}}.sk-circle[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.sk-circle[_ngcontent-%COMP%]   .sk-child[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;left:0;top:0}.sk-circle[_ngcontent-%COMP%]   .sk-child[_ngcontent-%COMP%]:before{content:"";display:block;margin:0 auto;width:15%;height:15%;background-color:#333;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-circleBounceDelay 1.2s infinite ease-in-out both;animation:_ngcontent-%COMP%_sk-circleBounceDelay 1.2s infinite ease-in-out both}.sk-circle[_ngcontent-%COMP%]   .sk-circle2[_ngcontent-%COMP%]{-webkit-transform:rotate(30deg);-ms-transform:rotate(30deg);transform:rotate(30deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle3[_ngcontent-%COMP%]{-webkit-transform:rotate(60deg);-ms-transform:rotate(60deg);transform:rotate(60deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle4[_ngcontent-%COMP%]{-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle5[_ngcontent-%COMP%]{-webkit-transform:rotate(120deg);-ms-transform:rotate(120deg);transform:rotate(120deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle6[_ngcontent-%COMP%]{-webkit-transform:rotate(150deg);-ms-transform:rotate(150deg);transform:rotate(150deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle7[_ngcontent-%COMP%]{-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle8[_ngcontent-%COMP%]{-webkit-transform:rotate(210deg);-ms-transform:rotate(210deg);transform:rotate(210deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle9[_ngcontent-%COMP%]{-webkit-transform:rotate(240deg);-ms-transform:rotate(240deg);transform:rotate(240deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle10[_ngcontent-%COMP%]{-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle11[_ngcontent-%COMP%]{-webkit-transform:rotate(300deg);-ms-transform:rotate(300deg);transform:rotate(300deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle12[_ngcontent-%COMP%]{-webkit-transform:rotate(330deg);-ms-transform:rotate(330deg);transform:rotate(330deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle2[_ngcontent-%COMP%]:before{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.sk-circle[_ngcontent-%COMP%]   .sk-circle3[_ngcontent-%COMP%]:before{-webkit-animation-delay:-1s;animation-delay:-1s}.sk-circle[_ngcontent-%COMP%]   .sk-circle4[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.9s;animation-delay:-.9s}.sk-circle[_ngcontent-%COMP%]   .sk-circle5[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.8s;animation-delay:-.8s}.sk-circle[_ngcontent-%COMP%]   .sk-circle6[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.7s;animation-delay:-.7s}.sk-circle[_ngcontent-%COMP%]   .sk-circle7[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.6s;animation-delay:-.6s}.sk-circle[_ngcontent-%COMP%]   .sk-circle8[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.5s;animation-delay:-.5s}.sk-circle[_ngcontent-%COMP%]   .sk-circle9[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.4s;animation-delay:-.4s}.sk-circle[_ngcontent-%COMP%]   .sk-circle10[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.3s;animation-delay:-.3s}.sk-circle[_ngcontent-%COMP%]   .sk-circle11[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.2s;animation-delay:-.2s}.sk-circle[_ngcontent-%COMP%]   .sk-circle12[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.1s;animation-delay:-.1s}@-webkit-keyframes _ngcontent-%COMP%_sk-circleBounceDelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-circleBounceDelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.spinner-chasing-dots[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000;text-align:center;-webkit-animation:_ngcontent-%COMP%_sk-rotate 2s infinite linear;animation:_ngcontent-%COMP%_sk-rotate 2s infinite linear}.dot1[_ngcontent-%COMP%], .dot2[_ngcontent-%COMP%]{width:60%;height:60%;display:inline-block;position:absolute;top:0;background-color:#333;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out}.dot2[_ngcontent-%COMP%]{top:auto;bottom:0;-webkit-animation-delay:-1s;animation-delay:-1s}@-webkit-keyframes _ngcontent-%COMP%_sk-rotate{to{-webkit-transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_sk-rotate{to{transform:rotate(360deg);-webkit-transform:rotate(360deg)}}@-webkit-keyframes _ngcontent-%COMP%_sk-bounce{0%,to{-webkit-transform:scale(0)}50%{-webkit-transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-bounce{0%,to{transform:scale(0);-webkit-transform:scale(0)}50%{transform:scale(1);-webkit-transform:scale(1)}}.full-screen[_ngcontent-%COMP%]{position:fixed;position:-ms-page}']});let d=s;return d})(),qT=(()=>{let s=class s{static forRoot(o){return{ngModule:s,providers:[{provide:"loadingConfig",useValue:o}]}}};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[Hs]});let d=s;return d})();var kF=d=>({disabled:d}),TF=()=>({backdropBorderRadius:"3px",backdropBackgroundColour:"rgba(0, 0, 0, 0.5)"});function IF(d,s){d&1&&(V(0,"div",16)(1,"p",17),X(2,"***Please enter a valid 10-digit phone number."),j()())}function EF(d,s){if(d&1&&Me(0,"ngx-loading",15),d&2){let u=ut();Le("show",u.loading)("config",G0(2,TF))}}var YT=(()=>{let s=class s{constructor(o,l,i,_,C){this.router=o,this.fb=l,this.auth=i,this.http=_,this.logInService=C,this.loading=!1,this.showError=!1,this.myForm=this.fb.group({phoneNumber:[null,[Qr.required,Qr.pattern("^[0-9]{10}$")]]})}validate(){this.myForm.value.phoneNumber.length===10?this.showError=!1:this.showError=!0}login(){this.loading=!0,this.logInService.setLog(this.myForm.value.phoneNumber),this.loading=!1}};s.\u0275fac=function(l){return new(l||s)(ye(jt),ye(qo),ye(WT),ye(Zi),ye(Qn))},s.\u0275cmp=gt({type:s,selectors:[["app-log-in"]],decls:29,vars:7,consts:[[1,"container"],[1,"sub-container"],[1,"banner-div"],[1,"banner"],[3,"submit","input","formGroup"],[1,"phone-div"],[1,"num"],[1,"line"],["type","tel","formControlName","phoneNumber",1,"input-box"],["class","error",4,"ngIf"],[1,"update-div"],["type","checkbox"],["src","assets\\logo\\wts up .png"],[1,"btn"],[3,"disabled","ngClass"],[3,"show","config"],[1,"error"],[1,"error-message",2,"color","red"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span"),X(5,"Earn more"),j(),Me(6,"br"),V(7,"p"),X(8,"fill your dreams"),j()()(),V(9,"form",4),Fe("submit",function(){return i.login()})("input",function(){return i.validate()}),V(10,"div",5)(11,"div")(12,"span",6),X(13,"+91"),j(),Me(14,"span",7)(15,"input",8),j()(),Bt(16,IF,3,0,"div",9),V(17,"div",10),Me(18,"input",11),V(19,"span"),X(20,"Get update on \xA0"),Me(21,"img",12),X(22," whatsapp"),j()(),Me(23,"br")(24,"br"),V(25,"div",13)(26,"button",14),X(27,"Get OTP"),j()()()()(),Bt(28,EF,1,3,"ngx-loading",15)),l&2&&(pe(9),Le("formGroup",i.myForm),pe(7),Le("ngIf",i.showError),pe(10),Le("disabled",!i.myForm.valid)("ngClass",li(5,kF,!i.myForm.valid)),pe(2),Xn(28,i.loading?28:-1))},dependencies:[Co,lr,ko,So,yr,Mo,Go,Fa,wb],styles:['.container[_ngcontent-%COMP%]{width:99vw;max-width:450px;height:100vh;display:flex;flex-direction:column;align-items:center}.sub-container[_ngcontent-%COMP%]{width:100%;position:relative;top:3%;display:grid;grid-gap:1.2rem;align-items:center}.banner-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}.banner[_ngcontent-%COMP%]{width:90%;max-width:450px;height:26rem;background-image:url("./media/Rectangle 25-RGNGM5F3.png");background-size:cover;background-repeat:no-repeat;background-position:center;display:flex;flex-direction:column;justify-content:center;text-align:center}.banner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:42px;font-family:Inter,sans-serif;font-weight:600;color:#fff}.banner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:26px;font-family:Inter,sans-serif;font-weight:600;color:#fff}.phone-div[_ngcontent-%COMP%]{width:90%;align-items:start;border-radius:.5rem;height:3.5rem;border:1px solid rgba(0,0,0,1);position:relative;left:5%}.phone-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:flex;position:relative;top:30%;left:5%;font-size:1.3rem}.phone-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:26px;height:17px}.num[_ngcontent-%COMP%]{font-size:1.4rem}.line[_ngcontent-%COMP%]{margin-top:-.2rem;font-size:2.2rem}.input-box[_ngcontent-%COMP%]{float:left;margin-top:-.4rem;width:70%;height:2rem;outline:0;border-width:0 0 0;font-size:1.5rem}input[type=checkbox][_ngcontent-%COMP%]{accent-color:#D16611}.update-div[_ngcontent-%COMP%]{width:80%;height:1.6rem;margin-left:5%;margin-top:.4rem;align-items:center;display:flex}.update-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;background-color:#d70d09}.update-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.1rem;font-family:inter;font-weight:400;line-height:1.4rem}.btn[_ngcontent-%COMP%]{width:90%;align-items:center;margin-left:5%}button[_ngcontent-%COMP%]{width:100%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}.disabled[_ngcontent-%COMP%]{background-color:#838180}.error[_ngcontent-%COMP%]{width:90%;margin-left:5%}']});let d=s;return d})();var Or=(()=>{let s=class s{constructor(o,l,i){this.http=o,this.router=l,this.dialogService=i,this.apiUrl=xn,this.userId=localStorage.getItem("provider"),this.isVerify=!1,this.checkingDetails=!1,this.items=[],this.selectedJob=[],this.userName="",this.workDetails=[],this.getServices()}setCheckingDetails(o){this.checkingDetails=o}getcheckingDetails(){return this.checkingDetails}selectedJobDetails(o){console.log(o),this.selectedJob=o}getSelectedJob(){return console.log(this.selectedJob),this.selectedJob}getUserDetails(o){let l=this.apiUrl+`providers/provider-details/${o}`;return new yo(i=>{this.http.get(l).subscribe(_=>{console.log(_),console.log("response",_),this.isVerify=_.isVerified,this.userDetails=_,this.formatingResponse(this.userDetails),i.next(!1),i.complete()},_=>{console.log(_),_.error.message=="No items found for this user"?(console.log("not found"),i.next(!0)):(i.error(_),this.checkingDetails||(this.dialogService.openDialog("Please add the details"),this.checkingDetails=!0,this.router.navigate(["aboutUser"]))),i.complete()})})}formatingResponse(o){try{typeof o.work=="string"&&(this.workDetails=o.work);let i=o.work;this.workDetails=i,console.log(this.workDetails)}catch(l){console.error("Error processing response.work",l)}}flattenArray(o){return o.reduce((l,i)=>Array.isArray(i)?l.concat(this.flattenArray(i)):l.concat(i),[])}getServices(){let o=this.apiUrl+"core/categories";this.http.get(o).subscribe(l=>{console.log(l),this.formattingServices(l)},l=>{console.log(l)})}formattingServices(o){o.forEach(l=>{this.items.push({id:l._id,names:l.name,checked:!1,image:l.imageKey})})}getAvailability(){let o=this.apiUrl+`providers/provider-date/${localStorage.getItem("providerId")}`;return this.http.get(o)}setDefault(){this.items=[],this.selectedJob=[],this.userDetails="",this.userName=""}};s.\u0275fac=function(l){return new(l||s)(lt(Zi),lt(jt),lt(Zo))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var DF=["input1"],AF=["input2"],PF=["input3"],OF=["input4"];function RF(d,s){if(d&1){let u=si();V(0,"u",16),Fe("click",function(){Ct(u);let l=ut();return St(l.resend())}),X(1,"Resend"),j()}}function LF(d,s){if(d&1&&(V(0,"div",17)(1,"p"),X(2),j()()),d&2){let u=ut();pe(2),Us("",u.minutes," : ",u.seconds,"")}}var ZT=(()=>{let s=class s{constructor(o,l,i,_,C,I,O){this.form=o,this.logInService=l,this.jobDetailsService=i,this.loginServices=_,this.router=C,this.dialogeService=I,this.http=O,this.apiUrl=xn,this.userNumber=0,this.resendToggling="resend",this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}ngOnInit(){this.userNumber=this.logInService.userNumber,this.logInService.showOtp()}onInput(o,l){if(o.target.value.length===1)switch(l){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}onKeyDown(o,l){console.log("called",o,l);let i=o.target;if(console.log("input :",i.value),console.log(l==1),o.key==="Backspace"&&!i.value&&l>1){let _=l-1;if(console.log("previous input",`#input${l-1}`),_)switch(_){case 3:this.input3.nativeElement.focus();break;case 2:this.input2.nativeElement.focus();break;case 1:this.input1.nativeElement.focus();break;default:console.log("something went wrong")}}}login(){return bo(this,null,function*(){let o=this.otp.value,l=o.inputOne+o.inputTwo+o.inputThree+o.inputFour;console.log("OTP:",this.otp.value),console.log(l),this.logInService.verifyOtp(l).subscribe(i=>bo(this,null,function*(){console.log("log in done",i),console.log(i.providerId),yield this.logInService.setUser(i.providerId),this.storeUserData(),yield this.chekingUser()}),i=>{console.log("error",i),alert(i.error.message)})})}storeUserData(){}resend(){this.logInService.resendOtp(),this.resendToggling="countdown",this.startCountdown()}startCountdown(){let o=120;this.updateDisplay(o),this.countdownInterval=setInterval(()=>{o-=1,o<=0?(this.stopCountdown(),this.resendToggling="resend"):this.updateDisplay(o)},1e3)}stopCountdown(){clearInterval(this.countdownInterval)}ngOnDestroy(){this.stopCountdown()}updateDisplay(o){this.minutes=Math.floor(o/60),this.seconds=o%60}chekingUser(){return bo(this,null,function*(){let o=localStorage.getItem("providerId"),l=`${this.apiUrl}providers/provider-details/${o}`;this.http.get(l).subscribe(i=>{console.log("response",i),console.log(i.providerName),this.logInService.alreadyHasAccount=!0,this.navTo()},i=>{console.log(i),this.dialogeService.openDialog("Please add your Details"),this.router.navigate(["aboutUser"])})})}navTo(){this.logInService.alreadyHasAccount?this.router.navigate(["home"]):(this.dialogeService.openDialog("Please add your Details"),this.router.navigate(["aboutUser"]))}};s.\u0275fac=function(l){return new(l||s)(ye(qo),ye(Qn),ye(Or),ye(Qn),ye(jt),ye(Zo),ye(Zi))},s.\u0275cmp=gt({type:s,selectors:[["app-verify"]],viewQuery:function(l,i){if(l&1&&(Ci(DF,5),Ci(AF,5),Ci(PF,5),Ci(OF,5)),l&2){let _;vi(_=xi())&&(i.input1=_.first),vi(_=xi())&&(i.input2=_.first),vi(_=xi())&&(i.input3=_.first),vi(_=xi())&&(i.input4=_.first)}},decls:27,vars:3,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"info-text"],[3,"ngSubmit","formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputTwo",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputThree",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputFour",3,"input","keydown"],[1,"resend-div"],["type","submit",1,"login-btn",3,"click"],[1,"resend",3,"click"],[1,"resend"]],template:function(l,i){if(l&1){let _=si();V(0,"div",4)(1,"div",5)(2,"span",6),X(3,"Enter OTP "),j(),Me(4,"br"),V(5,"span",7),X(6,"Please enter the code we just send to"),j(),V(7,"p",7),X(8),j(),Me(9,"br"),V(10,"form",8),Fe("ngSubmit",function(){return Ct(_),St(i.login())}),V(11,"div",9)(12,"input",10,0),Fe("input",function(I){return Ct(_),St(i.onInput(I,1))})("keydown",function(I){return Ct(_),St(i.onKeyDown(I,1))}),j(),V(14,"input",11,1),Fe("input",function(I){return Ct(_),St(i.onInput(I,2))})("keydown",function(I){return Ct(_),St(i.onKeyDown(I,2))}),j(),V(16,"input",12,2),Fe("input",function(I){return Ct(_),St(i.onInput(I,3))})("keydown",function(I){return Ct(_),St(i.onKeyDown(I,3))}),j(),V(18,"input",13,3),Fe("input",function(I){return Ct(_),St(i.onInput(I,4))})("keydown",function(I){return Ct(_),St(i.onKeyDown(I,4))}),j()(),V(20,"div",14)(21,"span"),X(22,"Didn\u2019t receive OTP? "),Bt(23,RF,2,0)(24,LF,3,2),j()(),V(25,"button",15),Fe("click",function(){return Ct(_),St(i.login())}),X(26,"Verify"),j()()()()}if(l&2){let _;pe(8),Qi("+91 ",i.userNumber,""),pe(2),Le("formGroup",i.otp),pe(13),Xn(23,(_=i.resendToggling)==="resend"?23:_==="countdown"?24:-1)}},dependencies:[ko,So,yr,Mo,xm,Go,Fa],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;text-align:center;align-items:center}.sub-container[_ngcontent-%COMP%]{position:relative;top:10%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:2.1rem}.info-text[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.3rem;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:2.5rem;font-weight:300;align-items:center}.resend-div[_ngcontent-%COMP%]{margin-top:3rem;width:90%;height:4rem;display:grid;align-items:center;row-gap:0}.resend-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer;font-size:1.1rem;font-family:Roboto,sans-serif;font-weight:400;color:#000}.resend[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#000}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}@media screen and (min-width: 600px){.container[_ngcontent-%COMP%]{align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:30%;border:1px solid black;position:relative;left:35%}}"]});let d=s;return d})();var vr=(()=>{let s=class s{constructor(o){this.http=o,this.workResponse=[],this.api=xn}getUserDetails(o){let l=this.api+`providers/provider-details/${o}`;return this.providerDetails?Yr(this.providerDetails):new yo(i=>{this.http.get(l).subscribe(_=>{console.log(_),this.providerDetails=_,i.next(this.providerDetails),i.complete()},_=>{console.log(_),i.error(_)})})}selectWork(o){return o}getWork(o){let l=this.api+`providers/provider-work/${o}`;return console.log(l),this.http.get(l)}deleteWork(o,l){let i=`${this.api}/providers/provider-work/delete-subcategory`,_={providerId:localStorage.getItem("providerId"),workId:o,subcategoryId:l};return this.http.post(i,_)}getFinancialDetails(){let o=this.api+`providers/provider-finance/${localStorage.getItem("providerId")}`;return this.http.get(o)}getPackages(){let o=this.api+"admin/provider-package";return this.http.get(o)}getCertificated(o){let l=this.api+`providers/provider-certificate/${o}`;return this.http.get(l)}setDefult(){this.workResponseId="",this.workResponse=[],this.currentLocation="",this.currentCordinates="",this.userRegistered="",this.api=""}};s.\u0275fac=function(l){return new(l||s)(lt(Zi))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Cb=(()=>{let s=class s{constructor(o){this.http=o,this.apiUrl=xn,this.currentLocation$=new F0(null),this.onlineStatus=!1}setonlineStatus(o,l){this.onlineStatus=o,localStorage.setItem("onlineStatus",o.toString()),localStorage.setItem("onlineText",l)}getonlineStatus(){let o=localStorage.getItem("onlineStatus"),l=localStorage.getItem("onlineText");return{status:o==="true",text:l||"Go"}}getCoordinates(){return navigator.geolocation.getCurrentPosition(o=>{let l={lat:o.coords.latitude,lng:o.coords.longitude};this.currentLocation$.next(l)},o=>{console.log(o)}),this.currentLocation$.asObservable()}sendCordinates(o){let l=this.apiUrl+"providers/provider-cordinates",i=localStorage.getItem("providerId");console.log(o);let _={providerId:i,longitude:o.location.lng,latitude:o.location.lat};return console.log(_),this.http.post(l,_)}getCoordinatesFromPlaceName(o){let l=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(o)}&key=AIzaSyCJQHv3pYfnPd6F3ju1DXZ7jm46PJbncuk`;return this.http.get(l)}};s.\u0275fac=function(l){return new(l||s)(lt(Zi))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function FF(d,s){if(d&1){let u=si();V(0,"div",5)(1,"label",8),X(2,"what work do you do?"),j(),Me(3,"br"),V(4,"input",33),Fe("click",function(){Ct(u);let l=ut();return St(l.navTo())}),j(),Me(5,"i",34),j()}if(d&2){let u=ut();pe(4),Le("ngModel",u.selectedWork)}}function zF(d,s){d&1&&Me(0,"img",35)}function BF(d,s){if(d&1&&Me(0,"img",36),d&2){let u=ut();Le("src",u.imagePreview,ir)}}var QT=(()=>{let s=class s{constructor(o,l,i,_,C,I){this.fb=o,this.router=l,this.location=i,this.loginService=_,this.userDetailsService=C,this.googleMapService=I,this.selectedFile=null,this.imagePreview=null,this.workAdded=!0,this.aboutProvider=this.fb.group({userId:localStorage.getItem("providerId"),providerName:["",Qr.required],work:["",Qr.required],pincode:["",Qr.required],phone:[this.loginService.userNumber,Qr.required],age:[this.loginService.age,Qr.required],gender:["",Qr.required],houseNo:"",landmark:"",address:["",Qr.required],city:"",state:"",image:[""]});let O=this.loginService.workDetails.flat();this.aboutProvider.controls.work.setValue(O),console.log(O),console.log("inform",this.aboutProvider.value.work),this.selectedWork=this.loginService.workDetails.flatMap(N=>N.flatMap(q=>q.nameOfService)).join(", ")}ngOnInit(){this.getNumber(),this.getWork()}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe({next:o=>{console.log(o),o.works.length>0&&(this.workAdded=!1)},error:o=>{console.log(o)}})}getNumber(){return bo(this,null,function*(){let o=this.loginService.getPhoneNumber();console.log(o),this.userNumber=yield this.loginService.userNumber,console.log(this.userNumber)})}flattenWorkDetails(o){return o.flatMap(l=>l.flatMap(i=>i.nameOfService))}onFileSelected(o){let l=o.target;if(l.files&&l.files.length>0){this.selectedFile=l.files[0];let i=new FileReader;i.onload=()=>{this.imagePreview=i.result},i.readAsDataURL(this.selectedFile)}}navTo(){this.router.navigate(["selectWork"])}getCoordinates(){let o=`${this.aboutProvider.value.houseNo} ${this.aboutProvider.value.landmark} ${this.aboutProvider.value.address} ${this.aboutProvider.value.city} ${this.aboutProvider.value.state} ${this.aboutProvider.value.pincode}`;console.log(o),this.googleMapService.getCoordinatesFromPlaceName(o).subscribe({next:l=>{console.log(l),this.googleMapService.sendCordinates(l.results[0].geometry).subscribe({next:i=>{console.log(i),alert("coordinates are updated")},error:i=>{console.log(i)}})},error:l=>{console.log(l)}})}submit(){this.getCoordinates();let o=new FormData;o.append("providerName",this.aboutProvider.value.providerName),o.append("age",this.aboutProvider.value.age),o.append("pincode",this.aboutProvider.value.pincode),o.append("providerId",this.aboutProvider.value.userId),o.append("gender",this.aboutProvider.value.gender),o.append("address",this.aboutProvider.value.address),o.append("phone",this.loginService.userNumber),o.append("houseNo",this.aboutProvider.value.houseNo),o.append("landMark",this.aboutProvider.value.landmark),o.append("city",this.aboutProvider.value.city),o.append("state",this.aboutProvider.value.state),this.selectedFile&&o.append("image",this.selectedFile,this.selectedFile.name),o.forEach((l,i)=>{console.log(`${i}: ${l}`)}),this.loginService.UserDetails(o)}navToBack(){console.log("back"),this.location.back()}};s.\u0275fac=function(l){return new(l||s)(ye(qo),ye(jt),ye(Li),ye(Qn),ye(vr),ye(Cb))},s.\u0275cmp=gt({type:s,selectors:[["app-about-user"]],decls:67,vars:4,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[3,"formGroup"],[1,"form-div"],[2,"position","relative"],["for","name"],["type","text","placeholder","Name","formControlName","providerName","id","names","required",""],["for","work"],["for","name","formControlName","gender"],["value","","disabled","","selected",""],["value","Male"],["value","Female"],["value","Others"],["for","houseNo"],["type","text","formControlName","houseNo","required","","placeholder","Address"],["for","landmark"],["type","text","formControlName","landmark","required","","placeholder","Address"],["for","address"],["type","text","formControlName","address","required","","placeholder","Address"],["for","city"],["type","text","formControlName","city","required","","placeholder","Address"],["for","state"],["type","text","formControlName","state","required","","placeholder","Address"],["for","pincode"],["type","text","formControlName","pincode","required","","placeholder","Address"],["for","file",1,"image-label"],[1,"file-input-container"],["for","file-input",1,"file-label"],["src","assets/documents/Group.png","alt","Upload image","class","placeholder-image",4,"ngIf"],["alt","Selected image","class","preview-image",3,"src",4,"ngIf"],["type","file","id","file-input","formControlName","image","required","",1,"file-input",3,"change"],["type","submit",1,"login-btn",3,"click"],["formControlName","work","id","providerType","required","","placeholder","please select the Work ",3,"click","ngModel"],[1,"fa","fa-angle-down",2,"font-size","36px","position","absolute","right","10px","top","75%","transform","translateY(-50%)","pointer-events","none"],["src","assets/documents/Group.png","alt","Upload image",1,"placeholder-image"],["alt","Selected image",1,"preview-image",3,"src"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),X(3,"Tell us about yourself"),j(),Me(4,"br"),V(5,"form",3)(6,"div",4),Bt(7,FF,6,1,"div",5),V(8,"div")(9,"label",6),X(10,"what's your Name"),j(),Me(11,"br")(12,"input",7),j(),V(13,"div")(14,"label",8),X(15,"Select your Gender"),j(),Me(16,"br"),V(17,"select",9)(18,"option",10),X(19,"Select"),j(),V(20,"option",11),X(21,"Male"),j(),V(22,"option",12),X(23,"Female"),j(),V(24,"option",13),X(25,"Others"),j()(),Me(26,"br"),j(),V(27,"div")(28,"label",14),X(29," H no "),j(),Me(30,"br")(31,"input",15),j(),V(32,"div")(33,"label",16),X(34," Landmark "),j(),Me(35,"br")(36,"input",17),j(),V(37,"div")(38,"label",18),X(39," Address "),j(),Me(40,"br")(41,"input",19),j(),V(42,"div")(43,"label",20),X(44," City"),j(),Me(45,"br")(46,"input",21),j(),V(47,"div")(48,"label",22),X(49," State "),j(),Me(50,"br")(51,"input",23),j(),V(52,"div")(53,"label",24),X(54," Pincode "),j(),Me(55,"br")(56,"input",25),j(),V(57,"label",26),X(58," Upload image "),j(),V(59,"div",27)(60,"label",28),Bt(61,zF,1,0,"img",29)(62,BF,1,1,"img",30),j(),V(63,"input",31),Fe("change",function(C){return i.onFileSelected(C)}),j()(),V(64,"button",32),Fe("click",function(){return i.submit()}),X(65,"Continue"),j()()()()(),Me(66,"br")),l&2&&(pe(5),Le("formGroup",i.aboutProvider),pe(2),Xn(7,i.workAdded?7:-1),pe(54),Le("ngIf",!i.selectedFile),pe(),Le("ngIf",i.selectedFile))},dependencies:[lr,ko,gk,_k,So,fk,yr,Mo,bk,Go,Fa],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;top:10%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.form-div[_ngcontent-%COMP%]{width:100%;display:grid;grid-gap:1rem}.form-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:grid;text-align:left}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;height:3rem;border:1px solid black;border-radius:.8rem;font-size:1rem}input[_ngcontent-%COMP%]::placeholder{padding-left:.5rem}label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:400;font-family:inter;line-height:19px}#providerType[_ngcontent-%COMP%]   option[value=""][disabled][_ngcontent-%COMP%]{display:none}.file-input-container[_ngcontent-%COMP%]{position:relative;width:200px;height:200px;border:.25px solid #ccc;display:flex;align-items:center;justify-content:center;border-radius:.5rem}.file-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:60%;cursor:pointer;position:relative}.placeholder-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.preview-image[_ngcontent-%COMP%]{width:10rem;height:8rem}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.image-label[_ngcontent-%COMP%]{float:left;text-align:left}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:100%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;margin-bottom:3rem}']});let d=s;return d})();var KT=(()=>{let s=class s{constructor(o){this.router=o,this.currentUrl=this.router.url,this.router.events.pipe(pa(l=>l instanceof eb),Ox()).subscribe(l=>{this.previousUrl=l[0].url,this.currentUrl=l[1].url})}getPreviousUrl(){return this.previousUrl}};s.\u0275fac=function(l){return new(l||s)(lt(jt))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function VF(d,s){if(d&1){let u=si();V(0,"div",8)(1,"div",10),Fe("click",function(){let l=Ct(u).$implicit,i=ut();return St(i.selectedCat(l))}),Me(2,"img",11),X(3),j(),V(4,"div")(5,"input",12),so("ngModelChange",function(l){let i=Ct(u).$implicit;return ao(i.checked,l)||(i.checked=l),St(l)}),Fe("change",function(l){let i=Ct(u).$implicit,_=ut();return St(_.onChange(l,i))}),j()()()}if(d&2){let u=s.$implicit;pe(2),Le("src",u.image,ir),pe(),Qi(" ",u.names,""),pe(2),oo("ngModel",u.checked)}}function jF(d,s){if(d&1){let u=si();V(0,"div",8)(1,"div",13),X(2),j(),V(3,"div")(4,"input",12),so("ngModelChange",function(l){let i=Ct(u).$implicit;return ao(i.checked,l)||(i.checked=l),St(l)}),Fe("change",function(l){let i=Ct(u).$implicit,_=ut();return St(_.onChange(l,i))}),j()()()}if(d&2){let u=s.$implicit;pe(2),Rt(u.names),pe(2),oo("ngModel",u.checked)}}var JT=(()=>{let s=class s{ngOnInit(){this.previousUrl=this.routeTrackingService.getPreviousUrl(),this.getWork(),console.log(this.items)}constructor(o,l,i,_,C,I){this.router=o,this.logInservice=l,this.jobDetails=i,this.routeTrackingService=_,this.userDetailsService=C,this.dialogeService=I,this.searchQuery="",this.workSeleceted=[],this.items=this.jobDetails.items,this.workForSending=[]}onInputChange(o){console.log(this.searchQuery);let l=this.jobDetails.items.filter(i=>i.names.toLowerCase().includes(this.searchQuery.toLowerCase()));console.log(l),this.items=l}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(o=>{console.log(o),this.workSeleceted=o.works,this.autoCheckServices()},o=>{console.log(o)})}onChange(o,l){let i=o.target;if(i&&i.checked){let C=this.items.indexOf(l);this.jobDetails.items[C].checked=!0,console.log("Item checked:",this.items.indexOf(l)),console.log("Item checked:",l.names),console.log("categoryId",l.id),this.logInservice.categoryId=l.id,this.logInservice.setWork(l.names,l.id),this.router.navigate(["subServices"])}}selectedCat(o){console.log("clciked");let l=this.items.indexOf(o);this.jobDetails.items[l].checked=!0,console.log("Item checked:",this.items.indexOf(o)),console.log("Item checked:",o.names),console.log("categoryId",o.id),this.logInservice.categoryId=o.id,this.logInservice.setWork(o.names,o.id),this.router.navigate(["subServices"])}autoCheckServices(){this.workSeleceted.forEach(o=>{let l=this.items.find(i=>i.names===o.categoryId.name);console.log(l),l&&l&&(l.checked=!0)})}send(){let o=this.items.filter(l=>l.checked===!0);if(console.log(o),this.jobDetails.userDetails&&this.jobDetails.userDetails.providerName!=null){let l=this.logInservice.workDetails.flat();this.UpdatingUserWork(l)}else o.length<1?alert("please select any one service"):this.logInservice.sendWorkDetails().subscribe(l=>{console.log(l),this.dialogeService.openDialog("Service has been added"),this.router.navigate(["aboutUser"])},l=>{console.log(l)})}UpdatingUserWork(o){console.log(o);let l=this.userDetailsService.workResponseId;console.log("work before",this.userDetailsService.workResponse),console.log("id before",l),this.workForSending.push(this.userDetailsService.workResponse),this.workForSending.push(o),console.log(this.workForSending.flat()),this.logInservice.updateUserWork(this.workForSending.flat(),l)}};s.\u0275fac=function(l){return new(l||s)(ye(jt),ye(Qn),ye(Or),ye(KT),ye(vr),ye(Zo))},s.\u0275cmp=gt({type:s,selectors:[["app-select-work"]],decls:22,vars:2,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"search-container"],["type","text","placeholder","Search for Service",1,"search-input",3,"ngModelChange","input","ngModel"],[1,"material-symbols-outlined",3,"hidden"],[1,"serivce"],[1,"tittle2"],[1,"service-div"],["type","submit",1,"login-btn",3,"click"],[1,"names",3,"click"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"],[1,"names"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),X(3,"what work do you do?"),j(),Me(4,"br"),V(5,"div",3)(6,"input",4),so("ngModelChange",function(C){return ao(i.searchQuery,C)||(i.searchQuery=C),C}),Fe("input",function(C){return i.onInputChange(C)}),j(),V(7,"span",5),X(8,"search"),j()(),V(9,"div",6)(10,"span",7),X(11,"Popular categories"),j(),Me(12,"br"),gr(13,VF,6,3,"div",8,ro),V(15,"span",7),X(16,"All categories"),j(),Me(17,"br"),gr(18,jF,5,2,"div",8,ro),j()(),V(20,"button",9),Fe("click",function(){return i.send()}),X(21,"Continue"),j()()),l&2&&(pe(6),oo("ngModel",i.searchQuery),pe(),Le("hidden",i.searchQuery),pe(6),_r(i.items),pe(5),_r(i.items))},dependencies:[So,ld,yr,Ws],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-container[_ngcontent-%COMP%]{position:relative}.search-container[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{padding-right:30px;width:70%;height:2.5rem;border-radius:.8rem;font-size:1.5rem}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.search-container[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{position:absolute;top:50%;left:7%;transform:translateY(-50%);cursor:pointer;pointer-events:none;font-size:32px;margin:0}.tittle2[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:500;line-height:24px;display:flex;align-items:start}.serivce[_ngcontent-%COMP%]{height:70vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.7rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2rem;height:2rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let d=s;return d})();var eI=(()=>{let s=class s{constructor(o,l){this.router=o,this.loginService=l,this.selectedExperiance="",this.selectedAge="",this.workSelected=this.loginService.workName,this.selectedCheckbox=null}sendResponse(){console.log(this.selectedAge,this.selectedExperiance)}expSelected(o){this.selectedExperiance===o?this.selectedExperiance=null:this.selectedExperiance=o,console.log(this.selectedExperiance),this.selectedExperiance==="yes"?this.router.navigate(["workExperiance"]):(this.loginService.setExperiance("0"),this.loginService.setWorkDetails(),this.router.navigate(["selectWork"]))}onCheckboxChange(o){this.selectedAge===o?this.selectedAge=null:this.selectedAge=o,console.log("Selected Checkbox:",this.selectedAge),this.loginService.setAge(this.selectedAge)}};s.\u0275fac=function(l){return new(l||s)(ye(jt),ye(Qn))},s.\u0275cmp=gt({type:s,selectors:[["app-about-work"]],decls:44,vars:6,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["type","checkbox",3,"change","checked"],[2,"padding","0.5rem"],[1,"select-div"],[1,"conditions"],["type","checkbox"],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),X(3,"Tell us about your work!"),j(),Me(4,"br")(5,"br"),V(6,"div",3)(7,"pre"),X(8,"What is your age?"),j(),Me(9,"hr"),V(10,"div")(11,"span"),X(12,"16 - 18"),j(),V(13,"input",4),Fe("change",function(){return i.onCheckboxChange("16-18")}),j()(),Me(14,"hr"),V(15,"div")(16,"span"),X(17,"18 - 40"),j(),V(18,"input",4),Fe("change",function(){return i.onCheckboxChange("18-40")}),j()(),Me(19,"hr"),V(20,"div")(21,"span"),X(22,"More than 40"),j(),V(23,"input",4),Fe("change",function(){return i.onCheckboxChange("more than 40")}),j()()(),V(24,"div",3)(25,"p",5),X(26),j(),Me(27,"hr"),V(28,"div",6)(29,"span"),X(30,"Yes"),j(),V(31,"input",4),Fe("change",function(){return i.expSelected("yes")}),j()(),Me(32,"hr"),V(33,"div")(34,"span"),X(35,"No"),j(),V(36,"input",4),Fe("change",function(){return i.expSelected("no")}),j()()(),V(37,"div",7),Me(38,"input",8),X(39," \xA0 Agree with Terms & conditions"),j(),Me(40,"br")(41,"br"),V(42,"button",9),Fe("click",function(){return i.sendResponse()}),X(43,"Continue"),j()()()),l&2&&(pe(13),Le("checked",i.selectedAge==="16-18"),pe(5),Le("checked",i.selectedAge==="18-40"),pe(5),Le("checked",i.selectedAge==="more than 40"),pe(3),Qi("Do you have any experience in ",i.workSelected," services?"),pe(5),Le("checked",i.selectedExperiance==="yes"),pe(5),Le("checked",i.selectedExperiance==="no"))},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content;border:1px solid black;margin-bottom:5%;border-radius:1rem}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5%;display:flex;justify-content:space-between}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:95%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611}.conditions[_ngcontent-%COMP%]{width:max-content;font-size:1.2rem;font-family:inter,sans-serif;font-weight:400;line-height:1.4rem;float:left;display:flex;justify-content:space-around}.conditions[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}.sub-div1[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1rem}"]});let d=s;return d})();var tI=(()=>{let s=class s{constructor(o,l){this.logInservice=o,this.router=l,this.experiance=""}onCheckboxChange(o){this.experiance===o?this.experiance=null:this.experiance=o,console.log("Selected Checkbox:",this.experiance)}sendResponse(){this.logInservice.setExperiance(this.experiance),this.logInservice.setWorkDetails(),this.router.navigate(["selectWork"])}};s.\u0275fac=function(l){return new(l||s)(ye(Qn),ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-work-experiance"]],decls:30,vars:4,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["type","checkbox",3,"change","checked"],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),X(3,"Tell us about your work!"),j(),Me(4,"br")(5,"br"),V(6,"div",3)(7,"div")(8,"span"),X(9,"0-1 Years"),j(),V(10,"input",4),Fe("change",function(){return i.onCheckboxChange("0-1")}),j()(),Me(11,"hr"),V(12,"div")(13,"span"),X(14,"2-4 Years"),j(),V(15,"input",4),Fe("change",function(){return i.onCheckboxChange("2-4")}),j()(),Me(16,"hr"),V(17,"div")(18,"span"),X(19,"3-5 Years"),j(),V(20,"input",4),Fe("change",function(){return i.onCheckboxChange("3-5")}),j()(),Me(21,"hr"),V(22,"div")(23,"span"),X(24,"More than 5 Years"),j(),V(25,"input",4),Fe("change",function(){return i.onCheckboxChange("more than 5")}),j()()()(),Me(26,"br")(27,"br"),V(28,"button",5),Fe("click",function(){return i.sendResponse()}),X(29,"Continue"),j()()),l&2&&(pe(10),Le("checked",i.experiance==="0-1"),pe(5),Le("checked",i.experiance==="2-4"),pe(5),Le("checked",i.experiance==="3-5"),pe(5),Le("checked",i.experiance==="moreThan5"))},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content;border:1px solid black;margin-bottom:5%;border-radius:1rem}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5%;display:flex;justify-content:space-between}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:95%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611}"]});let d=s;return d})();var iI=(()=>{let s=class s{constructor(o){this.router=o}verify(){console.log("inside"),this.router.navigate(["pancard"])}};s.\u0275fac=function(l){return new(l||s)(ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-aadhar-verification"]],decls:24,vars:0,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["for","name"],["type","number","placeholder","name","id","names","required",""],["type","number","placeholder","OTP","id","names","required",""],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),X(3,"Lets Get the Documentation Done....!!"),j(),Me(4,"br")(5,"br"),V(6,"div",3)(7,"div")(8,"label",4),X(9,"Adhar Number"),j(),Me(10,"br")(11,"input",5),j(),Me(12,"br"),V(13,"button"),X(14,"Verify"),j(),V(15,"div")(16,"label",4),X(17,"OTP"),j(),Me(18,"br")(19,"input",6),j()(),V(20,"button",7),Fe("click",function(){return i.verify()}),X(21,"Verify"),j()(),Me(22,"br")(23,"br"),j())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.6rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:grid;text-align:left}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;height:3rem;border:1px solid black;border-radius:.8rem;font-size:1rem}input[_ngcontent-%COMP%]::placeholder{padding-left:.5rem}label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:400;font-family:inter,sans-serif;line-height:19px}.sub-div1[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:4rem;height:1.4rem;background-color:#d16611;color:#fff;font-size:.8rem;font-family:inter;float:right;border:none;border-radius:.4rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}"]});let d=s;return d})();var nI=(()=>{let s=class s{constructor(o){this.router=o}skip(){this.router.navigate(["bankDetails"])}submit(){this.router.navigate(["bankDetails"])}};s.\u0275fac=function(l){return new(l||s)(ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-pancard"]],decls:21,vars:0,consts:[[1,"container"],[1,"skip-btn",3,"click"],[1,"sub-container"],[1,"tittle"],[1,"tittle1"],[1,"pan"],["src","assets\\documents\\pancard.png"],[1,"input"],["type","number","placeholder","PAN Number","id","Enter GST Number","required",""],["type","number","placeholder","Enter GST Number","id","Enter GST Number","required",""],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"button",1),Fe("click",function(){return i.skip()}),X(2,"skip"),j(),V(3,"div",2)(4,"div")(5,"span",3),X(6,"PAN Number"),j(),Me(7,"br")(8,"br"),V(9,"span",4),X(10,"Please Input your PAN number"),j(),Me(11,"br")(12,"br"),j(),V(13,"div",5),Me(14,"img",6),j(),V(15,"div",7),Me(16,"input",8)(17,"br")(18,"input",9),j(),V(19,"button",10),Fe("click",function(){return i.submit()}),X(20,"Submit"),j()()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.skip-btn[_ngcontent-%COMP%]{width:max-content;height:max-content;float:right;margin:1rem;margin-bottom:0;background-color:transparent;border:none;font-family:"Inter" sans-serif;color:#00000080;font-size:16px;font-weight:400;line-height:16.94px;text-align:left}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:0%;left:5%;display:grid;grid-template-rows:auto auto auto;row-gap:30px;align-items:center;text-align:center;justify-content:center}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.6rem;font-weight:600;line-height:24px}.tittle1[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1rem;font-weight:400;line-height:19px}.pan[_ngcontent-%COMP%]{width:19rem;height:11.5rem}.pan[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.input[_ngcontent-%COMP%]{width:100%;height:7rem}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-top:1rem;width:98%;height:2rem;border-radius:.9rem;font-size:1rem;text-align:center}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{text-align:center;font-size:1rem;font-weight:600;color:#000}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:89%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}']});let d=s;return d})();var rI=(()=>{let s=class s{constructor(o,l,i){this.fb=o,this.router=l,this.http=i,this.apiUrl=xn,this.bankDetails=this.fb.group({accountName:["",Qr.required],accountNumber:["",Qr.required],PANNumber:["",Qr.required],bankName:["",Qr.required],IFSC:["",Qr.required],branch:["",Qr.required],aadhaarNumber:532268448050})}submit(){let o=`${this.apiUrl}providers/provider-finance`,l=new FormData;l.append("accountName",this.bankDetails.value.accountName),l.append("providerId",localStorage.getItem("providerId")||""),l.append("aadhaarNumber",this.bankDetails.value.aadhaarNumber),l.append("accountNumber",this.bankDetails.value.accountNumber),l.append("pan",this.bankDetails.value.PANNumber),l.append("bankName",this.bankDetails.value.bankName),l.append("ifscCode",this.bankDetails.value.IFSC),l.append("branch",this.bankDetails.value.branch),this.http.post(o,l).subscribe(i=>{console.log(i),this.router.navigate(["induction"])},i=>{console.log(i),i.error.error==='E11000 duplicate key error collection: test.finances index: pan_1 dup key: { pan: "cggpc1173E" }'&&alert("Pancard is already registered")})}skip(){this.router.navigate(["induction"])}};s.\u0275fac=function(l){return new(l||s)(ye(qo),ye(jt),ye(Zi))},s.\u0275cmp=gt({type:s,selectors:[["app-bank-details"]],decls:50,vars:1,consts:[[1,"skip-btn",3,"click"],[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],[1,"form-main",3,"formGroup"],[1,"form-div-section"],["for","accountName"],["type","text","id","accountName","formControlName","accountName"],["for","accountNumber"],["type","number","id","accountNumber","formControlName","accountNumber"],["for","PANNumber"],["type","text","id","PANNumber","formControlName","PANNumber"],["for","bankName"],["type","text","id","bankName","formControlName","bankName"],["for","IFSC"],["type","text","id","IFSC","formControlName","IFSC"],["for","branch"],["type","text","id","branch","formControlName","branch"],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){l&1&&(V(0,"button",0),Fe("click",function(){return i.skip()}),X(1,"skip"),j(),V(2,"div",1)(3,"div",2)(4,"span",3),X(5,"Banking details"),j(),Me(6,"br")(7,"br"),V(8,"div",4)(9,"form",5)(10,"div",6)(11,"fieldset")(12,"legend",7),X(13," Account Name \xA0"),j(),Me(14,"input",8)(15,"br"),j()(),V(16,"div",6)(17,"fieldset")(18,"legend",9),X(19," Account Number \xA0"),j(),Me(20,"input",10)(21,"br"),j()(),V(22,"div",6)(23,"fieldset")(24,"legend",11),X(25," PAN Number \xA0"),j(),Me(26,"input",12)(27,"br"),j()(),V(28,"div",6)(29,"fieldset")(30,"legend",13),X(31," Bank name \xA0"),j(),Me(32,"input",14)(33,"br"),j()(),V(34,"div",6)(35,"fieldset")(36,"legend",15),X(37," IFSC \xA0"),j(),Me(38,"input",16)(39,"br"),j()(),V(40,"div",6)(41,"fieldset")(42,"legend",17),X(43," Branch \xA0"),j(),Me(44,"input",18)(45,"br"),j()()()(),V(46,"button",19),Fe("click",function(){return i.submit()}),X(47,"Submit"),j()(),Me(48,"br")(49,"br"),j()),l&2&&(pe(9),Le("formGroup",i.bankDetails))},dependencies:[ko,So,Q0,yr,Mo,Go,Fa],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;justify-content:center;align-items:center;text-align:center}.skip-btn[_ngcontent-%COMP%]{width:max-content;height:max-content;float:right;margin:1rem;margin-bottom:0;background-color:transparent;border:none;font-family:"Inter" sans-serif;color:#00000080;font-size:16px;font-weight:400;line-height:16.94px;text-align:left}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:0%;left:0%;display:grid;grid-template-rows:max-content max-content;align-items:start;text-align:left}.tittle[_ngcontent-%COMP%]{float:left;font-family:Inter,sans-serif;font-size:1.6rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content}.form-main[_ngcontent-%COMP%]{width:90%;height:max-content;display:flex;flex-direction:column;gap:.9rem}fieldset[_ngcontent-%COMP%]{width:100%;height:2.5rem;border-radius:.5rem}fieldset[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{font-size:.9rem;font-family:Inter,sans-serif;font-weight:400;line-height:1rem;flex-shrink:0;margin-right:10px;color:#030b33b3}input[_ngcontent-%COMP%]{flex-grow:1;outline:0;border-width:0 0 0 0;border-color:#000;font-size:1.1rem;padding:5px 0}.login-btn[_ngcontent-%COMP%]{height:3rem;width:90%;font-size:1.3rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:3rem;border:none;background-color:#d16611;position:fixed;top:90%;left:5%}.mat-mdc-text-field-wrapper.mdc-text-field.mdc-text-field--filled[_ngcontent-%COMP%]{background-color:transparent;height:5rem}']});let d=s;return d})();var Bm=(()=>{let s=class s{constructor(o){this.http=o,this.apiUrl=xn,this.apiForVideo=this.apiUrl+"admin"}getingVideos(){return this.http.get(`${this.apiForVideo}/training`)}gettingInductionVeideos(){return this.http.get(`${this.apiForVideo}/induction`)}};s.\u0275fac=function(l){return new(l||s)(lt(Zi))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Xo=(()=>{let s=class s{constructor(o){this.http=o,this.apiUrl=xn,this.userId=localStorage.getItem("providerId"),this.userCredit=0}payWithRazorpay(o,l,i){let _={key:"rzp_test_b8XfUOQ4u8dlSq",amount:o*100,currency:i,name:"Coolie no.1",description:"Test Transaction",image:"assets/location/logo-v3 3.png",handler:I=>{console.log(I),this.addingCredit(o)},prefill:{name:"Customer Name",email:"customer@example.com",contact:"9999999999"},notes:{address:"Razorpay Corporate Office"},theme:{color:"#3399cc"},modal:{ondismiss:function(){console.log("Checkout form closed")},escape:!1,backdropclose:!1,handleback:!0}};new Razorpay(_).open()}addingCredit(o){let l=this.apiUrl+"providers/provider-credits/recharge",i={providerId:this.userId,amount:o};return this.http.post(l,i).subscribe(_=>{console.log(_),this.getNow()},_=>{console.log(_)})}getCredits(){let o=this.apiUrl+`providers/provider-credits/${this.userId}`;return this.http.get(o)}getNow(){this.getCredits().subscribe(o=>{console.log(o),this.userCredit=o.credits},o=>{console.log(o)})}getCreditHistory(){let o=this.apiUrl+`providers/provider-credits/${this.userId}`;return this.http.get}setDefault(){this.userId="",this.userCredit=0}};s.\u0275fac=function(l){return new(l||s)(lt(Zi))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var _s=VM(W1());var pd=(()=>{let s=class s{setonlineStatus(o,l){this.onlineStatus=o,localStorage.setItem("onlineStatus",o.toString()),localStorage.setItem("onlineText",l)}getonlineStatus(){let o=localStorage.getItem("onlineStatus"),l=localStorage.getItem("onlineText");return{status:o==="true",text:l||"Go"}}constructor(o,l){this.platformId=o,this.http=l,this.apiUrl=xn,this.destinationInput="",this.currentLocation=[0,0],this.directionsLayerId="directions",this.userCordinates=[0,0],this.onlineStatus=!1,_s.default.accessToken="pk.eyJ1IjoiY29vbGllbm8xLWFkbWluIiwiYSI6ImNsdWZjZGR1ZzBtZHcybnJvaHBiYTd2NzMifQ.TQ6FrqUIUUWv7J7n75A3tQ"}ngOnInit(){this.initializeMap()}ngOnDestroy(){this.watchId&&navigator.geolocation.clearWatch(this.watchId)}initializeMap(){navigator.geolocation.getCurrentPosition(o=>{this.currentLocation=[o.coords.longitude,o.coords.latitude],console.log(this.currentLocation,"currect location"),this.map=new _s.default.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:this.currentLocation,zoom:12}),this.map.addControl(new _s.default.NavigationControl),this.userMarker=new _s.default.Marker({color:"blue"}).setLngLat(this.currentLocation).setPopup(new _s.default.Popup().setText("You are here")).addTo(this.map),this.watchId=navigator.geolocation.watchPosition(l=>{let i=[l.coords.longitude,l.coords.latitude];this.currentLocation=i,this.userMarker&&this.userMarker.setLngLat(i),this.userCordinates[0]!=0&&this.addDestinationMarker(this.userCordinates)},l=>{console.error("Error watching position:",l)})})}navigateToPlace(){if(!this.destinationInput){console.error("Please enter the destination address or coordinates.");return}if(/^(-?\d+(\.\d+)?),\s*(-?\d+(\.\d+)?)$/.test(this.destinationInput)){let[l,i]=this.destinationInput.split(",").map(_=>parseFloat(_.trim()));this.addDestinationMarker([l,i])}else fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(this.destinationInput)}.json?access_token=${_s.default.accessToken}`).then(l=>{if(!l.ok)throw new Error("Network response was not ok");return l.json()}).then(l=>{if(l.features.length===0)throw new Error("No results found");let i=l.features[0].geometry.coordinates;this.addDestinationMarker(i)}).catch(l=>{console.error("Error fetching destination coordinates:",l),alert("Error: Could not find the location. Please check your input.")})}addDestinationMarker(o){console.log(o),this.destinationMarker&&this.destinationMarker.remove(),this.destinationMarker=new _s.default.Marker({color:"red"}).setLngLat(o).setPopup(new _s.default.Popup().setText(this.destinationInput)).addTo(this.map),this.map.flyTo({center:o,zoom:12}),this.getDirections(o)}getDirections(o){let l=`https://api.mapbox.com/directions/v5/mapbox/driving/${this.currentLocation[0]},${this.currentLocation[1]};${o[0]},${o[1]}?alternatives=true&geometries=geojson&steps=true&access_token=${_s.default.accessToken}`;fetch(l).then(i=>{if(!i.ok)throw new Error("NoRoute");return i.json()}).then(i=>{if(console.log("Directions data:",i),i.routes.length===0)throw new Error("No routes found");this.map.getSource(this.directionsLayerId)&&(this.map.removeLayer(this.directionsLayerId),this.map.removeSource(this.directionsLayerId)),this.map.addSource(this.directionsLayerId,{type:"geojson",data:{type:"Feature",properties:{},geometry:i.routes[0].geometry}}),this.map.addLayer({id:this.directionsLayerId,type:"line",source:this.directionsLayerId,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"red","line-width":5}});let _=new _s.default.LngLatBounds;i.routes[0].geometry.coordinates.forEach(C=>{_.extend(C)}),this.map.fitBounds(_,{padding:50})}).catch(i=>{console.error("Error fetching directions:",i),alert("Error: Could not find a route.")})}getCurrentLocation(){return new yo(o=>{navigator.geolocation.getCurrentPosition(l=>{let i=[l.coords.longitude,l.coords.latitude];console.log("current location inside getcurrent location",i),alert(i),this.getPlaceNameFromCoordinates(i),o.next(i),o.complete()},l=>{o.error(l)})})}getPlaceNameFromCoordinates(o){let i=`https://api.mapbox.com/geocoding/v5/mapbox.places/${o[0]},${o[1]}.json?access_token=pk.eyJ1IjoiY29vbGllbm8xLWFkbWluIiwiYSI6ImNsdWZjZGR1ZzBtZHcybnJvaHBiYTd2NzMifQ.TQ6FrqUIUUWv7J7n75A3tQ`;return new yo(_=>{fetch(i).then(C=>{if(!C.ok)throw console.error("Network response was not ok:",C.status,C.statusText),new Error(`Network response was not ok: ${C.status} ${C.statusText}`);return C.json()}).then(C=>{if(C.features.length===0)throw console.error("No results found:",C),new Error("No results found");let I=C.features[0].place_name;_.next(I),_.complete()}).catch(C=>{console.error("Error fetching place name:",C),_.error(C)})})}sendCordinates(o){let l=this.apiUrl+"providers/provider-cordinates",_={providerId:localStorage.getItem("providerId"),longitude:o[0],latitude:o[1]};return console.log(_),this.http.post(l,_)}};s.\u0275fac=function(l){return new(l||s)(lt(rd),lt(Zi))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Kr=(()=>{let s=class s{constructor(o){this.http=o,this.oredrDetails=[],this.apiUrl=xn}getOrder(o){let l=this.apiUrl+`users/order/category/${o}`;return this.http.get(l)}getOrderDetails(o){return this.http.get("")}accept(o){let l={orderId:o,providerId:localStorage.getItem("providerId")},i=this.apiUrl+"users/order-history/accept-order";return this.http.post(i,l)}verifyOtp(){let o=this.apiUrl+"users/order-history/verify-start-order",l={orderId:this.orderIds};return this.http.post(o,l)}verifyStartOrder(o){let l=this.apiUrl+"users/order-history/verify-start-order",i={orderHistoryId:this.orderIds,otp:o};return this.http.post(l,i)}cancelOrder(){let o=this.apiUrl+"users/order-history/cancel-order",l={orderHistoryId:this.orderIds,providerId:localStorage.getItem("providerId"),reason:"nothing"};return console.log(l),this.http.post(o,l)}completeOrder(){let o=this.apiUrl+"users/order-history/order-completed-generateotp",l={orderHistoryId:this.orderIds,providerId:localStorage.getItem("providerId")};return console.log(l),this.http.post(o,l)}verifyAfterComplete(o){let l=this.apiUrl+"users/order-history/order-completed-verify",i={orderId:this.orderIds,providerId:localStorage.getItem("providerId"),otp:o};return this.http.post(l,i)}orderHistory(){let o=localStorage.getItem("providerId"),l=this.apiUrl+`users/order-history/${o}`;return this.http.get(l)}setDefult(){this.orderIds="",this.oredrDetails=[],this.userFullAddress=""}};s.\u0275fac=function(l){return new(l||s)(lt(Zi))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Mb=d=>({active:d}),$s=(()=>{let s=class s{constructor(o){this.router=o,this.activeIcon="home"}ngOnInit(){this.router.events.subscribe(o=>{o instanceof eb&&this.setActiveIcon(o.urlAfterRedirects)}),this.setActiveIcon(this.router.url)}changeColor(o,l){this.activeIcon=o,this.router.navigate([l])}setActiveIcon(o){o.includes("home")?this.activeIcon="home":o.includes("ongoing")?this.activeIcon="Services":o.includes("earnings")?this.activeIcon="Activity":o.includes("target")&&(this.activeIcon="Account")}};s.\u0275fac=function(l){return new(l||s)(ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-fotter"]],decls:25,vars:12,consts:[[1,"fottersss"],[1,"sub-fotterss",3,"click","ngClass"],[1,"material-symbols-outlined"],[1,"names"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1),Fe("click",function(){return i.changeColor("home","home")}),V(2,"i",2),X(3,"home"),j(),X(4," \xA0 "),V(5,"span",3),X(6,"Home"),j()(),V(7,"div",1),Fe("click",function(){return i.changeColor("Services","ongoing")}),V(8,"i",2),X(9,"work_history"),j(),X(10,"\xA0 "),V(11,"span",3),X(12,"Ongoing"),j()(),V(13,"div",1),Fe("click",function(){return i.changeColor("Activity","earnings")}),V(14,"i",2),X(15,"payments"),j(),X(16,"\xA0 "),V(17,"span",3),X(18,"Earnings"),j()(),V(19,"div",1),Fe("click",function(){return i.changeColor("Account","target")}),V(20,"i",2),X(21,"ads_click"),j(),X(22,"\xA0 "),V(23,"span",3),X(24,"Target"),j()()()),l&2&&(pe(),Le("ngClass",li(4,Mb,i.activeIcon==="home")),pe(6),Le("ngClass",li(6,Mb,i.activeIcon==="Services")),pe(6),Le("ngClass",li(8,Mb,i.activeIcon==="Activity")),pe(6),Le("ngClass",li(10,Mb,i.activeIcon==="Account")))},dependencies:[Co],styles:[".fottersss[_ngcontent-%COMP%]{border:0;width:100%;display:flex;justify-content:space-around;position:fixed;bottom:0;text-align:center;padding-top:.5rem;padding-bottom:.5rem;background-color:#fff}.sub-fotterss[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{font-size:2rem;color:#00000080}.names[_ngcontent-%COMP%]{display:none}.active[_ngcontent-%COMP%]{background-color:#d16611;border-radius:25px;padding:.5rem 1rem}.active[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{color:#fff}.active[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]{display:block;color:#fff}"]});let d=s;return d})();var UF=["footer"],HF=()=>({backdropBorderRadius:"3px",backdropBackgroundColour:"rgba(0, 0, 0, 0.5)"});function WF(d,s){if(d&1&&(V(0,"div")(1,"div",25),Me(2,"img",26),j()()),d&2){let u=s.$implicit;pe(2),Le("src",u.src,ir)}}function GF(d,s){if(d&1&&(V(0,"div")(1,"span"),X(2),j(),V(3,"span"),Me(4,"i",30),X(5),j()()),d&2){let u=s.$implicit;pe(2),sd("",u.day,", ",u.month," ",u.date,""),pe(3),Qi(" ",u.isWorking,"")}}function qF(d,s){if(d&1){let u=si();V(0,"div",27),Bt(1,GF,6,4,"div",11),V(2,"div",28),Fe("click",function(){Ct(u);let l=ut();return St(l.navToCal())}),V(3,"pre",29),X(4,"calendar_today"),j()()()}if(d&2){let u=ut();pe(),Le("ngForOf",u.nextWorking)}}function $F(d,s){d&1&&(V(0,"span"),X(1,"No more jobs today"),j())}function YF(d,s){if(d&1&&(V(0,"span"),X(1),j()),d&2){let u=ut();pe(),Qi("",u.noOfPendingOrders," more jobs today")}}function ZF(d,s){if(d&1&&(V(0,"div")(1,"div",32)(2,"video",33),Me(3,"source",34),j()()()),d&2){let u=s.$implicit,o=ut(2);pe(3),Le("src","https://"+o.bucketName+".s3."+o.region+".amazonaws.com/"+u.videoKey,ir)}}function XF(d,s){if(d&1&&(V(0,"div",31),Bt(1,ZF,4,1,"div",11),j()),d&2){let u=ut();pe(),Le("ngForOf",u.data)}}function QF(d,s){if(d&1&&Me(0,"ngx-loading",24),d&2){let u=ut();Le("show",u.loading)("config",G0(2,HF))}}var aI=(()=>{let s=class s{ngOnInit(){let o=localStorage.getItem("onlineStatus"),l=localStorage.getItem("onlineText");o!==null&&(this.online=o==="true"),l!==null&&(this.onlineText=l),this.isAccountVerify=this.logInService.isAccountVerify,this.trainingService.getingVideos().subscribe(i=>{console.log(i),this.data=i},i=>{console.log(i)})}toggleDrawer(){this.isDrawerOpen=!this.isDrawerOpen,this.router.navigate(["menu"])}navToCredit(){this.router.navigate(["credits"])}navToNotification(){this.router.navigate(["notification"])}navToCal(){this.router.navigate(["calender"])}constructor(o,l,i,_,C,I,O,N,q,ie,de){this.router=o,this.http=l,this.trainingService=i,this.logInService=_,this.userDetailsService=C,this.jobDetailsService=I,this.razorpayService=O,this.mapboxService=N,this.orderService=q,this.dialogService=ie,this.googleMapService=de,this.isDrawerOpen=!1,this.data=[],this.bucketName="coolie1-dev",this.region="ap-south-1",this.nextWorking=[],this.loading=!1,this.ads=[{src:"assets/demo/ad.png"},{src:"assets/demo/ad.png"},{src:"assets/demo/ad.png"},{src:"assets/documents/pancard.png"}],this.dates=[],this.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.credits=0,this.online=!1,this.onlineText="Go",this.noOfPendingOrders=0,console.log(this.nextWorking.length),this.getProviderDetails(),this.workingDates(),this.getAvalibility(),this.getWork(),this.getCredit(),this.getPendingOrders()}getProviderDetails(){return bo(this,null,function*(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")),setTimeout(()=>{this.navToAboutUser()},2e3)})}navToAboutUser(){let o;this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")).subscribe(l=>{console.log(l),o=l,o&&!this.jobDetailsService.getcheckingDetails()&&(console.log("inside",this.jobDetailsService.getcheckingDetails()),this.dialogService.openDialog("Please add the details"),this.jobDetailsService.setCheckingDetails(!0),this.router.navigate(["aboutUser"]))}),console.log(o)}workingDates(){this.nextWorking=this.dates.splice(0,2),console.log(this.nextWorking)}getAvalibility(){this.jobDetailsService.getAvailability().subscribe(o=>{console.log(o),this.formattingAvailbility(o)},o=>{console.log(o)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(o=>{console.log(o),console.log(o[0]._id),this.userDetailsService.workResponse=o[0].works,this.userDetailsService.workResponseId=o[0]._id},o=>{console.log(o)})}formattingAvailbility(o){let l=new Date;for(let i=0;i<o.length;i++){let C=o[i].date.split("T")[0],I=new Date(C),O=this.dayNames[I.getDay()],N=this.monthNames[I.getMonth()],q=I.getFullYear(),ie=I.getDate();(I>=l||I.toDateString()===l.toDateString())&&(this.dates.some(xe=>xe.date===ie&&xe.day===O&&xe.month===N&&xe.year===q)||(this.dates.push({date:ie,day:O,month:N,year:q,isWorking:"working"}),this.dates.sort((xe,ke)=>{let Ae=this.monthNames.indexOf(xe.month),Xe=this.monthNames.indexOf(ke.month);if(Ae===-1||Xe===-1)return 0;let qe=new Date(xe.year,Ae,xe.date),ht=new Date(ke.year,Xe,ke.date);return qe.getTime()-ht.getTime()})))}this.workingDates()}getCredit(){this.razorpayService.getCredits().subscribe(o=>{console.log(o),this.razorpayService.userCredit=o.creditBalance,this.credits=o.creditBalance},o=>{console.log(o)})}onlineStatus(){try{this.loading=!0;let o=this.jobDetailsService.isVerify;console.log(o),this.online=!this.online,this.onlineText=this.online?"Off":"Go",this.googleMapService.onlineStatus=this.online,this.googleMapService.setonlineStatus(this.online,this.onlineText),localStorage.setItem("onlineStatus",this.online.toString()),localStorage.setItem("onlineText",this.onlineText),this.online&&this.googleMapService.getCoordinates().subscribe(l=>{console.log("Current Location:",l),this.sendCordinates(l),this.getname(l),alert(l?.lat),this.loading=!1},l=>{console.error("Error getting current location:",l),alert(l.error.message),this.loading=!1})}catch(o){console.error("Error in onlineStatus method:",o)}console.log(this.online)}getname(o){this.mapboxService.getPlaceNameFromCoordinates(o).subscribe(l=>{console.log("Place Name:",l),this.userDetailsService.currentCordinates=o,this.userDetailsService.currentLocation=l,this.mapboxService.placeName=l},l=>{console.error("Error getting place name:",l)})}sendCordinates(o){this.googleMapService.sendCordinates(o).subscribe({next:l=>{console.log(l),alert(l.message)},error:l=>{console.log(l),alert(l.errors.message)}})}sendTokens(){let o="",l={};this.http.post(o,l).subscribe(i=>{console.log(i)},i=>{console.log(i)})}getPendingOrders(){this.orderService.orderHistory().subscribe({next:o=>{console.log(o);let l="InProgress",i=o.filter(_=>_.status.toLowerCase().includes(l.toLowerCase()));this.noOfPendingOrders=i.length},error:o=>{console.log(o)}})}};s.\u0275fac=function(l){return new(l||s)(ye(jt),ye(Zi),ye(Bm),ye(Qn),ye(vr),ye(Or),ye(Xo),ye(pd),ye(Kr),ye(Zo),ye(Cb))},s.\u0275cmp=gt({type:s,selectors:[["app-home"]],viewQuery:function(l,i){if(l&1&&Ci(UF,5),l&2){let _;vi(_=xi())&&(i.footer=_.first)}},decls:59,vars:9,consts:[[1,"container"],[1,"header"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets/logo/credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined"],[1,"sub-container"],[1,"ads-div"],[1,"wrapperrr"],[4,"ngFor","ngForOf"],[1,"sub-divs"],["class","availability-div",4,"ngIf"],[1,"new-jobs"],[1,"text-div"],[1,"icon-div"],[1,"more-jobs"],[1,"text-div1"],[1,"pending-task-div"],[1,"quick-links"],["routerLinkActive","help",1,"helps",3,"routerLink"],["id","video-div",4,"ngIf"],[2,"height","5rem"],[3,"show","config"],[1,"slidesss"],[3,"src"],[1,"availability-div"],[3,"click"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"fa","fa-circle",2,"font-size","10px"],["id","video-div"],["id","video-slidess"],["controls","","id","videoss"],["type","video/mp4",3,"src"]],template:function(l,i){l&1&&(V(0,"div",0),Me(1,"br"),V(2,"div",1)(3,"div",2),Fe("click",function(){return i.toggleDrawer()}),X(4,"\u2630"),j(),V(5,"div",3)(6,"div",4),Fe("click",function(){return i.navToCredit()}),Me(7,"img",5),V(8,"pre"),X(9),j()(),V(10,"div",6),Fe("click",function(){return i.navToNotification()}),V(11,"span",7),X(12,"notifications"),j()()()(),Me(13,"br"),V(14,"div",8)(15,"div",9)(16,"div",10),Bt(17,WF,3,1,"div",11),j()(),V(18,"div",12),Bt(19,qF,5,1,"div",13),V(20,"div")(21,"div",14)(22,"div",15)(23,"span"),X(24,"No new jobs"),j(),V(25,"span"),X(26,"5 jobs missed recently"),j()(),V(27,"div",16)(28,"span",7),X(29,"arrow_forward_ios"),j()()(),Me(30,"br"),V(31,"div",17)(32,"div",18),Bt(33,$F,2,0,"span")(34,YF,2,1),j(),V(35,"div",16)(36,"span",7),X(37,"arrow_forward_ios"),j()()()(),V(38,"div",19)(39,"span"),X(40,"Pending Tasks"),j(),Me(41,"br")(42,"br"),V(43,"p"),X(44," 80 subscription jobs . 4days left to buy job pack now "),j(),V(45,"p"),X(46," Only 50 credits left.Recharge credits to get new jobs "),j()(),V(47,"div",20)(48,"div")(49,"span"),X(50,"Quick links"),j()(),V(51,"div",21)(52,"span"),X(53,"Help?"),j()()(),Bt(54,XF,2,1,"div",22),j()()(),Me(55,"div",23)(56,"router-outlet")(57,"app-fotter"),Bt(58,QF,1,3,"ngx-loading",24)),l&2&&(ji("overlap",i.isDrawerOpen),pe(9),Rt(i.credits),pe(8),Le("ngForOf",i.ads),pe(2),Le("ngIf",i.nextWorking.length!=0),pe(14),Xn(33,i.noOfPendingOrders===0?33:34),pe(18),Le("routerLink","/help"),pe(3),Le("ngIf",i.isAccountVerify),pe(4),Xn(58,i.loading?58:-1))},dependencies:[br,lr,tb,ib,nb,wb,$s],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%;transition:padding-left .3s ease;margin-top:0}#drawer[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000;color:red;padding:20px;box-sizing:border-box;transition:transform .3s ease;transform:translate(-100%);z-index:2}#drawer.open[_ngcontent-%COMP%]{transform:translate(0);overlay:auto}.header[_ngcontent-%COMP%]{margin-top:0rem;width:90%;display:flex;justify-content:space-between}#menu-button[_ngcontent-%COMP%]{cursor:pointer;z-index:2;color:#d16611;font-size:24px}.list-menu[_ngcontent-%COMP%]{list-style-type:none;font-size:1rem;font-weight:400;font-family:Roboto Condensed}.bell-credit[_ngcontent-%COMP%]{width:max-content;height:2.5rem;display:flex;justify-content:space-between;gap:.5rem;border-radius:.2rem}.package[_ngcontent-%COMP%]{width:max-content;padding:0 .5rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.credit[_ngcontent-%COMP%]{width:5rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .package[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%], .package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center;border-radius:.4rem}.sub-container[_ngcontent-%COMP%]{width:95%;height:90vh;overflow-y:auto;scroll-snap-type:y;scroll-behavior:smooth;scrollbar-width:none}.sub-divs[_ngcontent-%COMP%]{margin-top:1rem;display:grid;row-gap:1.4rem}.ads-div[_ngcontent-%COMP%]{display:flex;height:7rem;width:100%}.wrapperrr[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;grid-gap:.5rem;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}.slidesss[_ngcontent-%COMP%]{width:100%;height:100%}.slidesss[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:auto;object-fit:cover}.availability-div[_ngcontent-%COMP%]{width:98%;height:max-content;display:flex;column-gap:4%;row-gap:0;align-items:center;margin-left:.5rem;justify-content:space-between}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:22px;text-align:left}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:22px;text-align:left}.new-jobs[_ngcontent-%COMP%]{width:100%;height:5rem;background-color:#d70d09;border-radius:1.3rem;color:#f5f5f5;display:flex;justify-content:space-between;align-items:center}.text-div[_ngcontent-%COMP%]{width:max-content;height:4rem;display:grid;justify-content:center;row-gap:0rem;text-align:left;align-items:center;padding-left:2rem}.text-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(1), .pending-task-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .quick-links[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .text-div1[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-size:1.4rem;font-weight:500}.text-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(2){font-family:Inter,sans-serif;font-size:.95rem;font-weight:400}.icon-div[_ngcontent-%COMP%]{width:30%;display:flex;justify-content:center;align-items:center}.more-jobs[_ngcontent-%COMP%]{width:100%;height:4rem;background-color:#d70d09;border-radius:1.3rem;color:#fff;display:flex;align-items:center;justify-content:space-between}.text-div1[_ngcontent-%COMP%]{width:max-content;height:4rem;display:grid;justify-content:center;align-items:center;padding-left:2rem}.pending-task-div[_ngcontent-%COMP%]{text-align:left}.pending-task-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:15px;font-weight:400;line-height:16.94px;letter-spacing:.05em;text-align:left}.quick-links[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.helps[_ngcontent-%COMP%]{width:6rem;height:3rem;background-color:#20193f;color:#fff;display:flex;justify-content:center;align-items:center;border-radius:1.8rem}#video-div[_ngcontent-%COMP%]{width:100%;height:10rem;display:flex;grid-gap:.5rem;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}video[_ngcontent-%COMP%]{width:100vw;height:10rem;object-fit:cover;cursor:pointer}.online[_ngcontent-%COMP%]{background-color:#d16611;width:6rem;height:6rem;border-radius:50%;position:fixed;bottom:70px;left:40%;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:500;color:#fff;overflow:hidden}.online[_ngcontent-%COMP%]:before{content:"";position:absolute;width:50%;height:50%;border:.2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_wave 1.9s ease-out infinite;pointer-events:none}@keyframes _ngcontent-%COMP%_wave{50%{transform:scale(1);width:50%;height:50%}60%{transform:scale(1.5);width:60%;height:60%}70%{transform:scale(2);width:70%;height:70%}to{transform:scale(2.5);width:100%;height:100%}}']});let d=s;return d})();var KF=d=>({active:d});function JF(d,s){if(d&1){let u=si();V(0,"button",14),Fe("click",function(){let l=Ct(u).$implicit,i=ut();return St(i.setActiveButton(l))}),X(1),j()}if(d&2){let u=s.$implicit,o=ut();Le("ngClass",li(2,KF,o.activeButton===u)),pe(),Qi(" ",u," ")}}function ez(d,s){if(d&1&&(V(0,"div",15)(1,"span",16)(2,"span",17),X(3),j(),V(4,"span",18),X(5),j()(),V(6,"span",18),X(7),j()(),Me(8,"div",19)),d&2){let u=s.$implicit;pe(3),Rt(u.date),pe(2),Rt(u.details),pe(2),Rt(u.amount)}}var sI=(()=>{let s=class s{navBack(){this.location.back()}navToAddCredit(){this.router.navigate(["addCredit"])}constructor(o,l,i){this.location=o,this.router=l,this.razorpayServie=i,this.buttons=["All","Recharge","Expenses","Penalties"],this.activeButton="All",this.history=[],this.filteredCreditHistory=[],this.credits=this.razorpayServie.userCredit,console.log(this.razorpayServie.userCredit),this.getCredit()}setActiveButton(o){this.activeButton=o,this.filter(this.activeButton)}getCredit(){this.razorpayServie.getCredits().subscribe({next:o=>{console.log(o),this.credits=o.creditBalance,this.history=o.transactions,this.filteredCreditHistory=this.history},error:o=>{console.log(o)}})}filter(o){let l=this.history,i;o!="All"?(i=l.filter(_=>_.type.toLowerCase().includes(o.toLowerCase())),this.filteredCreditHistory=i):this.filteredCreditHistory=l,console.log(this.filteredCreditHistory)}};s.\u0275fac=function(l){return new(l||s)(ye(Li),ye(jt),ye(Xo))},s.\u0275cmp=gt({type:s,selectors:[["app-credit"]],decls:24,vars:2,consts:[[1,"container"],[1,"header"],[1,"arrow_back",3,"click"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"logo"],["src","assets\\documents\\credit bg.png"],[1,"credit"],[1,"credit-details"],[3,"click"],[1,"sub-container"],[1,"cat"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"content"],[1,"content-div"],[3,"click","ngClass"],[1,"sub-content-div"],[1,"span-div"],[1,"highlight"],[1,"normal-text"],[1,"line"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2),Fe("click",function(){return i.navBack()}),V(3,"span",3),X(4,"arrow_back"),j()(),V(5,"div",4),Me(6,"img",5),j()(),V(7,"div",6)(8,"div",7)(9,"span"),X(10,"Credit balance :"),j(),X(11,"\xA0 "),V(12,"span"),X(13),j()(),V(14,"div")(15,"button",8),Fe("click",function(){return i.navToAddCredit()}),X(16,"Add+"),j()()(),V(17,"div",9)(18,"div",10),Bt(19,JF,2,4,"button",11),j(),V(20,"div",12)(21,"div",13),gr(22,ez,9,3,null,null,ro),j()()()()),l&2&&(pe(13),Rt(i.credits),pe(6),Le("ngForOf",i.buttons),pe(3),_r(i.filteredCreditHistory))},dependencies:[Co,br],styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh;align-items:center;text-align:center;display:grid;grid-template-rows:max-content max-content auto;row-gap:2rem;gap:2rem;grid-gap:2rem}.header[_ngcontent-%COMP%]{border:1px solid black;width:90%;height:10rem;display:flex;position:relative;left:5%;top:10%;border-radius:.8rem}.arrow_back[_ngcontent-%COMP%]{width:10%;position:relative;top:8%;left:2%}.logo[_ngcontent-%COMP%]{width:90%;display:flex;justify-content:center;align-items:center}.credit[_ngcontent-%COMP%]{width:90%;height:max-content;display:flex;justify-content:space-between;position:relative;left:5%}.credit-details[_ngcontent-%COMP%]{float:left;text-align:left}.credit-details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:1rem;font-family:"Inter" sans-serif;font-weight:500;line-height:1.2rem}.credit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:4rem;height:2rem;background-color:#5ba36b;color:#fff;border:none;border-radius:.6rem}.sub-container[_ngcontent-%COMP%]{width:90%;height:70vh;position:relative;left:5%}.cat[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px;border-bottom:2px solid transparent;cursor:pointer}.cat[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-bottom:2px solid #f40905}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:border-bottom .3s}.content[_ngcontent-%COMP%]{width:100%;margin-top:.8rem}.content-div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-content-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.span-div[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.highlight[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:16.94px;text-align:left}.normal-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:14.52px;text-align:left}.line[_ngcontent-%COMP%]{margin-top:.5rem;border:none;border-bottom:.25px solid black}']});let d=s;return d})();function tz(d,s){d&1&&(V(0,"span"),X(1,"Name"),j())}function iz(d,s){if(d&1&&(V(0,"span"),X(1),j()),d&2){let u=ut();pe(),Rt(u.userName)}}function nz(d,s){if(d&1){let u=si();Me(0,"br"),V(1,"div",12),Fe("click",function(){let l=Ct(u).$implicit,i=ut();return St(i.navTo(l.name))}),V(2,"div",12),Fe("click",function(){let l=Ct(u).$implicit,i=ut();return St(i.navTo(l.name))}),V(3,"span",11),X(4),j(),X(5," \xA0 \xA0 "),V(6,"span"),X(7),j()(),V(8,"span",11),X(9,"arrow_forward_ios"),j()(),Me(10,"hr")}if(d&2){let u=s.$implicit;pe(4),Rt(u.icon),pe(3),Rt(u.name)}}var lI=(()=>{let s=class s{constructor(o,l,i,_,C,I,O,N){this.location=o,this.router=l,this.loginService=i,this.jobDetailsService=_,this.ordersService=C,this.razorpayService=I,this.userDetals=O,this.dialougeService=N,this.userName="",this.userImage="",this.whatsAppStaus="on",this.options=[{icon:"calendar_today",name:"Calendar"},{icon:"work",name:"Job History"},{icon:"poker_chip",name:"Credits"},{icon:"tv_gen",name:"Tranning"},{icon:"featured_seasonal_and_gifts",name:"Invite a friend"},{icon:"question_mark",name:"Help Center"},{icon:"emoji_events",name:"Certificate & documents"}]}ngOnInit(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")),this.getUsername()}getUsername(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")).subscribe({next:o=>{console.log(o)},complete:()=>{this.userName=this.jobDetailsService.userDetails?.providerName,this.userImage=this.jobDetailsService.userDetails?.image,console.log(this.jobDetailsService.userDetails),console.log(this.userName),this.apiSubscription?.unsubscribe()}})}navTo(o){switch(console.log(o),o){case"Calendar":this.router.navigate(["calender"]);break;case"Job History":this.router.navigate(["jobHistory"]);break;case"Credits":console.log("inside"),this.router.navigate(["credits"]);break;case"Tranning":this.router.navigate(["training"]);break;case"Invite a friend":this.router.navigate(["referAndEarn"]);break;case"Help Center":this.router.navigate(["help"]);break;case"Certificate & documents":this.router.navigate(["awards"]);break;case"packages":this.router.navigate(["packages"]);break;default:console.log("No matching case found")}}navToFinancial(){this.router.navigate(["financialDetails"])}navBack(){this.location.back()}navToVisiting(){let o=localStorage.getItem("providerId");this.userDetals.getUserDetails(o).subscribe({next:l=>{console.log(l),this.router.navigate(["visitingCard"])},error:l=>{console.log(l),this.dialougeService.openDialog("Provider details are missing"),this.router.navigate(["aboutUser"])}})}logOut(){this.jobDetailsService.setDefault(),this.loginService.setDefult(),this.ordersService.setDefult(),this.razorpayService.setDefault(),this.userDetals.setDefult(),this.loginService.removeUser(),this.router.navigate(["selectAccount"]),localStorage.clear()}statusChange(){this.whatsAppStaus==="on"?this.whatsAppStaus="off":(this.whatsAppStaus="off")&&(this.whatsAppStaus="on")}};s.\u0275fac=function(l){return new(l||s)(ye(Li),ye(jt),ye(Qn),ye(Or),ye(Kr),ye(Xo),ye(vr),ye(Zo))},s.\u0275cmp=gt({type:s,selectors:[["app-menu"]],decls:66,vars:4,consts:[[1,"material-symbols-outlined",3,"click"],[1,"container"],[1,"sub-container"],[1,"profile"],[1,"image"],[1,"profile-img",3,"src"],[1,"details"],[1,"details-div"],[1,"package",3,"click"],["src","assets/packages/silver coin 1.png",1,"package-img"],[1,"rating"],[1,"material-symbols-outlined"],[3,"click"],[1,"category"],[1,"updates"],[1,"finacial",3,"click"],[1,"iconss"],[1,"finacial"],[1,"fa","fa-whatsapp"],["routerLinkActive","language",1,"finacial",3,"routerLink"],[1,"btn",3,"click"]],template:function(l,i){l&1&&(Me(0,"br")(1,"br"),X(2,"\xA0\xA0 \xA0"),V(3,"span",0),Fe("click",function(){return i.navBack()}),X(4,"arrow_back"),j(),Me(5,"br")(6,"br"),V(7,"div",1)(8,"div",2)(9,"div",3)(10,"div",4),Me(11,"img",5),j(),V(12,"div",6)(13,"div",7),Bt(14,tz,2,0,"span")(15,iz,2,1),V(16,"span",8),Fe("click",function(){return i.navTo("packages")}),Me(17,"img",9),X(18,"\xA0 "),V(19,"pre"),X(20,"Silver"),j()()(),V(21,"div",10)(22,"span",11),X(23,"star"),j(),X(24," 4.89"),j(),V(25,"button",12),Fe("click",function(){return i.navToVisiting()}),X(26,"View more"),j()()(),Me(27,"br"),V(28,"div",13),gr(29,nz,11,2,null,null,ro),j(),Me(31,"br"),V(32,"div",14)(33,"div",15),Fe("click",function(){return i.navToFinancial()}),V(34,"div",16)(35,"span",11),X(36,"currency_rupee"),j()(),V(37,"div")(38,"span"),X(39,"Financial details"),j(),Me(40,"br"),X(41," GST,PAN and bank information "),j()(),V(42,"div",17)(43,"div",16),Me(44,"span",18),j(),V(45,"div")(46,"span"),X(47,"Send whatsApp updates"),j(),Me(48,"br"),V(49,"span",12),Fe("click",function(){return i.statusChange()}),X(50),j()()(),V(51,"div",19)(52,"div",16)(53,"span",11),X(54,"g_translate"),j()(),V(55,"div")(56,"span"),X(57,"Change language"),j(),Me(58,"br"),X(59," English "),j()()(),Me(60,"br"),V(61,"div",20),Fe("click",function(){return i.logOut()}),V(62,"button")(63,"span",11),X(64,"power_settings_new"),j(),X(65,"\xA0 Logout"),j()()()()),l&2&&(pe(11),Le("src",i.userImage?i.userImage:"assets/logo/profile.png",ir),pe(3),Xn(14,i.userName===""?14:15),pe(15),_r(i.options),pe(21),Rt(i.whatsAppStaus),pe(),Le("routerLink","/language"))},dependencies:[ib,nb],styles:['.container[_ngcontent-%COMP%]{width:90%;height:100vh;padding:1rem}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;left:5%}.profile[_ngcontent-%COMP%]{width:100%;height:9rem;display:flex;align-items:center;justify-content:space-evenly;border:.25px solid black;border-radius:.5rem}.image[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.profile-img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.details[_ngcontent-%COMP%]{width:70%;display:flex;flex-direction:column;text-align:left;gap:.5rem}.details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.5rem;font-family:"Inter" sans-serif;font-weight:500}.details-div[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.package[_ngcontent-%COMP%]{width:max-content;height:2rem;padding:0 .3rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.package-img[_ngcontent-%COMP%]{width:1.3rem;height:1.3rem}.package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1rem;line-height:1.7rem}.details[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:18px;border:none;background-color:transparent;width:max-content;border-bottom:2px solid black;display:flex;align-items:center}.rating[_ngcontent-%COMP%]{display:flex;width:max-content;height:max-content;align-items:center}.category[_ngcontent-%COMP%]{width:100%}.category[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.category[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .finacial[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:500}.updates[_ngcontent-%COMP%]{border:.25px solid black;width:100%;height:11.5rem;border-radius:.5rem;display:flex;flex-direction:column;align-items:center;justify-content:center}.finacial[_ngcontent-%COMP%]{display:flex;width:100%;height:3.2rem}.iconss[_ngcontent-%COMP%]{width:20%;display:flex;justify-content:center;align-items:center;text-align:center}.iconss[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px}.btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:18px;border:none;background-color:transparent;display:flex;align-items:center}.btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;color:red}']});let d=s;return d})();function rz(d,s){d&1&&(V(0,"span"),X(1,"Name"),j())}function oz(d,s){if(d&1&&(V(0,"span"),X(1),j()),d&2){let u=ut();pe(),Rt(u.userName)}}function az(d,s){if(d&1&&X(0),d&2){let u=ut().$implicit;Qi(" ",u.categoryId.name," ")}}function sz(d,s){if(d&1&&(V(0,"span"),Bt(1,az,1,1),j()),d&2){let u=s.index;pe(),Xn(1,u<2?1:-1)}}function lz(d,s){if(d&1&&Bt(0,sz,2,1,"span",19),d&2){let u=ut();Le("ngForOf",u.workSeleceted)}}var cI=(()=>{let s=class s{constructor(o,l,i,_,C){this.router=o,this.location=l,this.jobDetailsService=i,this.logInService=_,this.userService=C,this.userImage="",this.userName="",this.userId=localStorage.getItem("providerId"),this.workSeleceted=this.jobDetailsService?.userDetails?.work,this.certificateImages=[{images:"assets/demo/awards.png"},{images:"assets/demo/certificate2.png"}]}ngOnInit(){this.signingDetails(),this.getWork(),this.getCertificates()}signingDetails(){this.phoneNumber=this.jobDetailsService.userDetails?.phone,this.userName=this.jobDetailsService.userDetails?.providerName,this.userImage=this.jobDetailsService.userDetails?.image}getWork(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(o=>{console.log(o),this.workSeleceted=o.works},o=>{console.log(o)})}getCertificates(){let o=localStorage.getItem("providerId");this.userService.getCertificated(o).subscribe({next:l=>{console.log(l);let i=[];for(let _=0;_<l.length;_++){let C=l[_];i.push({images:C.image})}this.certificateImages=i},error:l=>{console.log(l)},complete:()=>{this.apiSubscription?.unsubscribe()}})}navTo(){this.router.navigate(["manageServices"])}navToBack(){this.location.back()}navToVerification(){this.logInService.isAccountVerify?this.router.navigate(["identityVerification"]):this.router.navigate(["aadharVerify"])}navToCertificates(){this.router.navigate(["awards"])}};s.\u0275fac=function(l){return new(l||s)(ye(jt),ye(Li),ye(Or),ye(Qn),ye(vr))},s.\u0275cmp=gt({type:s,selectors:[["app-visiting-card"]],decls:67,vars:7,consts:[[1,"container"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"sub-container"],[1,"profile"],[1,"image"],["alt","User Image",3,"src"],[1,"details"],[1,"rating"],[1,"category"],[1,"ids"],[1,"tittle"],[1,"ids",3,"click"],[3,"click"],[1,"tittle2"],[1,"material-symbols-outlined"],[1,"awards-div"],[1,"awards"],[3,"src"],[2,"height","3rem"],[4,"ngFor","ngForOf"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"span",1),Fe("click",function(){return i.navToBack()}),X(2,"arrow_back"),j(),Me(3,"br"),V(4,"div",2)(5,"div",3)(6,"div",4),Me(7,"img",5),j(),V(8,"div",6),Bt(9,rz,2,0,"span")(10,oz,2,1),V(11,"div",7),X(12," \u2605 4.89 "),j(),Bt(13,lz,1,1,"span"),j()(),V(14,"div",8)(15,"div")(16,"div",9)(17,"span",10),X(18,"My Id"),j(),V(19,"span",10),X(20),j()(),Me(21,"hr"),j(),V(22,"div")(23,"div",11),Fe("click",function(){return i.navTo()}),V(24,"span",10),X(25,"Manage Service"),j(),V(26,"span",10),X(27,"+"),j()(),Me(28,"hr"),j(),V(29,"div")(30,"div",9)(31,"div",12),Fe("click",function(){return i.navToVerification()}),V(32,"span",10),X(33,"Identity verification"),j(),Me(34,"br"),V(35,"span",13),X(36,"Identity Proof and Personal details"),j()(),V(37,"span",14),X(38,"arrow_forward_ios"),j()()()(),V(39,"div",15)(40,"span"),X(41,"Award and certificate "),j(),V(42,"div",16)(43,"div"),Me(44,"img",17),j(),V(45,"div"),Me(46,"img",17),j()(),V(47,"span",12),Fe("click",function(){return i.navToCertificates()}),X(48,"View More"),j()(),V(49,"div",15)(50,"span"),X(51,"Contact Details"),j(),V(52,"div"),Me(53,"hr"),j(),V(54,"div")(55,"pre"),X(56,"Phone"),j(),V(57,"span"),X(58),j()(),V(59,"div")(60,"pre"),X(61,"Email"),j(),V(62,"span"),X(63,"abcdgmail.com"),j()()()()(),Me(64,"br")(65,"br")(66,"div",18)),l&2&&(pe(7),Le("src",i.userImage?i.userImage:"assets/logo/profile.png",ir),pe(2),Xn(9,i.userName===""?9:10),pe(4),Xn(13,i.workSeleceted?13:-1),pe(7),Rt(i.userId),pe(24),Le("src",i.certificateImages[0].images,ir),pe(2),Le("src",i.certificateImages[0].images,ir),pe(12),Rt(i.phoneNumber))},dependencies:[br],styles:['.container[_ngcontent-%COMP%]{width:100%;margin-bottom:3rem}.material-symbols-outlined[_ngcontent-%COMP%]{margin:1rem}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;left:5%;display:grid;row-gap:2rem}.profile[_ngcontent-%COMP%]{width:100%;height:8rem;display:flex;align-items:center;justify-content:space-evenly;border:.25px solid black;border-radius:.5rem}.image[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.profile[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.details[_ngcontent-%COMP%]{width:70%;height:5rem}.details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:500}.rating[_ngcontent-%COMP%]{display:flex;width:max-content;height:1.3rem;align-items:center;text-align:left}.category[_ngcontent-%COMP%]{width:100%;padding:.5rem;display:flex;flex-direction:column;gap:.8rem}.work-names[_ngcontent-%COMP%]{border:1px solid red;width:100%;display:flex;flex-direction:row}.ids[_ngcontent-%COMP%]{width:100%;height:max-content;display:flex;justify-content:space-between;margin-top:.5rem;margin-bottom:.5rem}.tittle[_ngcontent-%COMP%], .awards-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter"sans-serif;font-weight:500}.tittle2[_ngcontent-%COMP%], pre[_ngcontent-%COMP%]{font-size:1rem;font-family:"Inter"sans-serif;font-weight:400}.awards-div[_ngcontent-%COMP%]{display:grid;row-gap:1rem;border:.25px solid black;border-radius:.5rem;padding:1rem}.awards[_ngcontent-%COMP%]{width:100%;border:1px solid black;display:flex;justify-content:space-between}.awards[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:48%;height:141px}.awards[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}hr[_ngcontent-%COMP%]{color:#000}']});let d=s;return d})();var dI=(()=>{let s=class s{navToBack(){this.location.back()}constructor(o){this.location=o}};s.\u0275fac=function(l){return new(l||s)(ye(Li))},s.\u0275cmp=gt({type:s,selectors:[["app-refer-and-earn"]],decls:54,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"refer-div"],[1,"refer"],[1,"tittle1"],["src","assets\\documents\\invite.png"],[1,"dot"],[1,"line"],[1,"links"],["src","assets\\logo\\whatsup.png"],[1,"material-symbols-outlined"],[1,"how"],[1,"steps-div"],[1,"steps"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return i.navToBack()}),X(3,"arrow_back"),j(),X(4,"\xA0 "),V(5,"span",3),X(6,"Refer and Earn"),j()(),V(7,"div",4)(8,"div",5)(9,"div",6)(10,"div")(11,"span",7),X(12,"Refer and get FREE services "),j(),V(13,"p"),X(14,"Invite your to our company off.You win \u20B9 500 once they take services.They get instant \u20B9 500 "),j()(),V(15,"div"),Me(16,"img",8),j()(),V(17,"div",9),Me(18,"div",10),V(19,"span"),X(20,"Refer via"),j(),Me(21,"div",10),j(),V(22,"div",11)(23,"div"),Me(24,"img",12)(25,"br"),V(26,"span"),X(27,"Whatsapp"),j()(),V(28,"div")(29,"span",13),X(30,"link"),j(),Me(31,"br"),V(32,"span"),X(33,"Link"),j()()()(),V(34,"div",14)(35,"span",7),X(36,"How it works?"),j(),Me(37,"br"),V(38,"div",15)(39,"div",16)(40,"div"),X(41,"1"),j(),V(42,"span"),X(43,"Invite your friends & get rewarded"),j()(),V(44,"div",16)(45,"div"),X(46,"2"),j(),V(47,"span"),X(48,"They get free service on first order"),j()(),V(49,"div",16)(50,"div"),X(51,"3"),j(),V(52,"span"),X(53,"You get reward once their service is completed"),j()()()()()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-rows:auto auto auto;row-gap:30px;align-items:center;text-align:center;justify-content:center}.tittle[_ngcontent-%COMP%]{float:left;font-family:inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:24px}.refer-div[_ngcontent-%COMP%]{border:.25px solid black;border-radius:.5rem}.refer[_ngcontent-%COMP%]{padding:1rem;width:90%;height:max-content;display:flex;border-radius:.4rem}.refer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:92px;height:92px}.dot[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto max-content auto}.dot[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1rem;font-weight:500;line-height:14.52px}.line[_ngcontent-%COMP%]{margin-top:8px;border:none;border-top:1.2px dashed rgb(91,90,90)}.links[_ngcontent-%COMP%]{display:flex;justify-content:space-around;padding:1rem}.tittle1[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:500;line-height:24px}.how[_ngcontent-%COMP%]{width:90%;height:max-content;padding:1rem;border:.25px solid black;border-radius:.5rem;display:grid;text-align:left}.how[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.steps-div[_ngcontent-%COMP%]{display:grid;row-gap:1.5rem}.steps[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background-color:#49a010;color:#fff;align-items:center}.steps[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:80%}']});let d=s;return d})();function cz(d,s){d&1&&(V(0,"div",13)(1,"span"),X(2,"+"),j(),V(3,"span"),X(4,"Add Photo"),j()())}function dz(d,s){if(d&1&&Me(0,"img",14),d&2){let u=ut();Le("src",u.imagePreview,ir)}}function hz(d,s){d&1&&(V(0,"div",13)(1,"span"),X(2,"+"),j(),V(3,"span"),X(4,"Add Documents"),j()())}function uz(d,s){if(d&1&&Me(0,"img",14),d&2){let u=ut();Le("src",u.documentPreview,ir)}}function mz(d,s){if(d&1&&(V(0,"div",12),Me(1,"img",15),j()),d&2){let u=s.$implicit;pe(),Le("src",u.image,ir)}}var hI=(()=>{let s=class s{navToBack(){this.location.back()}constructor(o,l,i,_){this.location=o,this.http=l,this.fb=i,this.userDetalsService=_,this.apiUrl=xn,this.items=[],this.bucketName="coolie1-dev",this.region="ap-south-1",this.userId=localStorage.getItem("providerId"),this.selectedFile=null,this.selectedDocument=null,this.base64Image=null,this.imagePreview=null,this.documentPreview=null,this.getCertificates(),this.imageForm=this.fb.group({image:"",user:this.userId,isverified:!1}),console.log(this.items)}onFileSelected(o){let l=o.target;if(l.files&&l.files.length>0){this.selectedFile=l.files[0],this.imagePreview=l.files[0];let i=l.files[0],_=new FileReader;_.onload=()=>{this.imagePreview=_.result},_.readAsDataURL(this.selectedFile),console.log("image",this.imagePreview),this.imageForm.value.image=i}this.sending()}onDocumentSelected(o){let l=o.target;if(l.files&&l.files.length>0){this.selectedDocument=l.files[0],this.imagePreview=l.files[0];let i=l.files[0],_=new FileReader;_.onload=()=>{this.imagePreview=_.result},_.readAsDataURL(this.selectedDocument),console.log("image",this.imagePreview),this.imageForm.value.image=i}this.sending()}sending(){console.log("sending doc");let o=new FormData;o.append("image",this.imageForm.value.image),o.append("isVerified",this.imageForm.value.isverified),o.append("providerId",this.imageForm.value.user);let l=this.apiUrl+"providers/provider-certificate";this.http.post(l,o).subscribe({next:i=>{console.log(i),this.getCertificates()},error:i=>{console.log(i)}})}getCertificates(){this.userDetalsService.getCertificated(this.userId).subscribe({next:o=>{console.log(o),this.items=o,console.log(this.items[0].image)},error:o=>{console.log(o)},complete:()=>{this.apiSubscription?.unsubscribe()}})}};s.\u0275fac=function(l){return new(l||s)(ye(Li),ye(Zi),ye(qo),ye(vr))},s.\u0275cmp=gt({type:s,selectors:[["app-awards"]],decls:22,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"addPhoto"],["for","file-input",1,"file-label"],["class","placeholder-image",4,"ngIf"],["alt","Selected image","class","preview-image",3,"src",4,"ngIf"],[3,"formGroup"],["type","file","id","file-input","required","",1,"file-input",3,"change"],["type","file","id","document-inputs","required","",1,"file-input",3,"change"],[1,"awards"],[1,"placeholder-image"],["alt","Selected image",1,"preview-image",3,"src"],["alt","Image from AWS S3",3,"src"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return i.navToBack()}),X(3,"arrow_back"),j(),X(4,"\xA0\xA0 "),V(5,"span",3),X(6,"Certificate and Documents"),j()(),V(7,"div",4)(8,"div",5)(9,"label",6),Bt(10,cz,5,0,"div",7)(11,dz,1,1,"img",8),j(),V(12,"form",9)(13,"input",10),Fe("change",function(C){return i.onFileSelected(C)}),j()()(),V(14,"div",5)(15,"label",6),Bt(16,hz,5,0,"div",7)(17,uz,1,1,"img",8),j(),V(18,"form",9)(19,"input",11),Fe("change",function(C){return i.onDocumentSelected(C)}),j()()(),gr(20,mz,2,1,"div",12,ro),j()()),l&2&&(pe(10),Le("ngIf",!i.selectedFile),pe(),Le("ngIf",i.selectedFile),pe(),Le("formGroup",i.imageForm),pe(4),Le("ngIf",!i.selectedDocument),pe(),Le("ngIf",i.selectedDocument),pe(),Le("formGroup",i.imageForm),pe(2),_r(i.items))},dependencies:[lr,ko,Mo,Go],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-columns:auto auto;row-gap:30px;column-gap:30px;align-items:center;text-align:center;justify-content:space-around}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:24px}.addPhoto[_ngcontent-%COMP%]{width:8.5rem;height:8rem;display:grid;align-items:center;border:1px dashed black}span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:600;line-height:19px}.awards[_ngcontent-%COMP%]{width:8.5rem;height:8rem}.awards[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.file-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:60%;cursor:pointer;position:relative}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.placeholder-image[_ngcontent-%COMP%]{display:grid;row-gap:1rem}.preview-image[_ngcontent-%COMP%]{width:10rem;height:8rem}']});let d=s;return d})();var pz=["path"],fz=Math.PI/180,gz=(()=>{let s=class s{constructor(o){this.supportsSvg=!!(o&&o.createElementNS&&o.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect),this.base=o&&o.head.querySelector("base"),this.hasPerf=typeof window<"u"&&window.performance&&window.performance.now&&typeof window.performance.now()=="number"}resolveColor(o){if(this.base&&this.base.href){let l=o.indexOf("#");if(l>-1&&o.indexOf("url")>-1)return o.slice(0,l)+location.href+o.slice(l)}return o}getTimestamp(){return this.hasPerf?window.performance.now():Date.now()}getArc(o,l,i,_,C=!1){let I=Math.max(0,Math.min(o||0,l)),O=C?180:359.9999,N=l===0?O:I/l*O,q=this._polarToCartesian(_,i,N),ie=this._polarToCartesian(_,i,0),de=N<=180?0:1;return`M ${q} A ${i} ${i} 0 ${de} 0 ${ie}`}_polarToCartesian(o,l,i){let _=(i-90)*fz,C=o+l*Math.cos(_),I=o+l*Math.sin(_);return C+" "+I}};s.\u0275fac=function(l){return new(l||s)(lt(un,8))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),uI={radius:125,animation:"easeOutCubic",animationDelay:void 0,duration:500,stroke:15,color:"#45CCCE",background:"#EAEAEA",responsive:!1,clockwise:!0,semicircle:!1,rounded:!1},mI=new pn("ROUND_PROGRESS_DEFAULTS",{providedIn:"root",factory:()=>uI}),_z={provide:mI,useValue:uI},bz=(()=>{let s=class s{linearEase(o,l,i,_){return i*o/_+l}easeInQuad(o,l,i,_){return i*(o/=_)*o+l}easeOutQuad(o,l,i,_){return-i*(o/=_)*(o-2)+l}easeInOutQuad(o,l,i,_){return(o/=_/2)<1?i/2*o*o+l:-i/2*(--o*(o-2)-1)+l}easeInCubic(o,l,i,_){return i*(o/=_)*o*o+l}easeOutCubic(o,l,i,_){return i*((o=o/_-1)*o*o+1)+l}easeInOutCubic(o,l,i,_){return(o/=_/2)<1?i/2*o*o*o+l:i/2*((o-=2)*o*o+2)+l}easeInQuart(o,l,i,_){return i*(o/=_)*o*o*o+l}easeOutQuart(o,l,i,_){return-i*((o=o/_-1)*o*o*o-1)+l}easeInOutQuart(o,l,i,_){return(o/=_/2)<1?i/2*o*o*o*o+l:-i/2*((o-=2)*o*o*o-2)+l}easeInQuint(o,l,i,_){return i*(o/=_)*o*o*o*o+l}easeOutQuint(o,l,i,_){return i*((o=o/_-1)*o*o*o*o+1)+l}easeInOutQuint(o,l,i,_){return(o/=_/2)<1?i/2*o*o*o*o*o+l:i/2*((o-=2)*o*o*o*o+2)+l}easeInSine(o,l,i,_){return-i*Math.cos(o/_*(Math.PI/2))+i+l}easeOutSine(o,l,i,_){return i*Math.sin(o/_*(Math.PI/2))+l}easeInOutSine(o,l,i,_){return-i/2*(Math.cos(Math.PI*o/_)-1)+l}easeInExpo(o,l,i,_){return o===0?l:i*Math.pow(2,10*(o/_-1))+l}easeOutExpo(o,l,i,_){return o===_?l+i:i*(-Math.pow(2,-10*o/_)+1)+l}easeInOutExpo(o,l,i,_){return o===0?l:o===_?l+i:(o/=_/2)<1?i/2*Math.pow(2,10*(o-1))+l:i/2*(-Math.pow(2,-10*--o)+2)+l}easeInCirc(o,l,i,_){return-i*(Math.sqrt(1-(o/=_)*o)-1)+l}easeOutCirc(o,l,i,_){return i*Math.sqrt(1-(o=o/_-1)*o)+l}easeInOutCirc(o,l,i,_){return(o/=_/2)<1?-i/2*(Math.sqrt(1-o*o)-1)+l:i/2*(Math.sqrt(1-(o-=2)*o)+1)+l}easeInElastic(o,l,i,_){let C=_*.3,I=1.70158,O=i;return o===0?l:(o/=_)===1?l+i:(O<Math.abs(i)?(O=i,I=C/4):I=C/(2*Math.PI)*Math.asin(i/O),-(O*Math.pow(2,10*o--)*Math.sin((o*_-I)*(2*Math.PI)/C))+l)}easeOutElastic(o,l,i,_){let C=_*.3,I=1.70158,O=i;return o===0?l:(o/=_)===1?l+i:(O<Math.abs(i)?(O=i,I=C/4):I=C/(2*Math.PI)*Math.asin(i/O),O*Math.pow(2,-10*o)*Math.sin((o*_-I)*(2*Math.PI)/C)+i+l)}easeInOutElastic(o,l,i,_){let C=_*.44999999999999996,I=1.70158,O=i;return o===0?l:(o/=_/2)===2?l+i:(O<Math.abs(i)?(O=i,I=C/4):I=C/(2*Math.PI)*Math.asin(i/O),o<1?-.5*(O*Math.pow(2,10*(o-=1))*Math.sin((o*_-I)*(2*Math.PI)/C))+l:O*Math.pow(2,-10*(o-=1))*Math.sin((o*_-I)*(2*Math.PI)/C)*.5+i+l)}easeInBack(o,l,i,_,C=1.70158){return i*(o/=_)*o*((C+1)*o-C)+l}easeOutBack(o,l,i,_,C=1.70158){return i*((o=o/_-1)*o*((C+1)*o+C)+1)+l}easeInOutBack(o,l,i,_,C=1.70158){return(o/=_/2)<1?i/2*(o*o*(((C*=1.525)+1)*o-C))+l:i/2*((o-=2)*o*(((C*=1.525)+1)*o+C)+2)+l}easeInBounce(o,l,i,_){return i-this.easeOutBounce(_-o,0,i,_)+l}easeOutBounce(o,l,i,_){return(o/=_)<1/2.75?i*(7.5625*o*o)+l:o<2/2.75?i*(7.5625*(o-=1.5/2.75)*o+.75)+l:o<2.5/2.75?i*(7.5625*(o-=2.25/2.75)*o+.9375)+l:i*(7.5625*(o-=2.625/2.75)*o+.984375)+l}easeInOutBounce(o,l,i,_){return o<_/2?this.easeInBounce(o*2,0,i,_)*.5+l:this.easeOutBounce(o*2-_,0,i,_)*.5+i*.5+l}};s.\u0275fac=function(l){return new(l||s)},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Tb=(()=>{let s=class s{constructor(o,l,i,_){this.service=o,this.easing=l,this.defaults=i,this.ngZone=_,this.currentLinecap="",this.current=0,this.max=0,this.radius=this.defaults.radius,this.animation=this.defaults.animation,this.animationDelay=this.defaults.animationDelay,this.duration=this.defaults.duration,this.stroke=this.defaults.stroke,this.color=this.defaults.color,this.background=this.defaults.background,this.responsive=this.defaults.responsive,this.clockwise=this.defaults.clockwise,this.semicircle=this.defaults.semicircle,this.rounded=this.defaults.rounded,this.onRender=new on,this.lastAnimationId=0}_animateChange(o,l){typeof o!="number"&&(o=0),l=this._clamp(l),o=this._clamp(o);let i=this,_=l-o,C=i.duration;i.ngZone.runOutsideAngular(()=>{let I=()=>{let O=i.service.getTimestamp(),N=++i.lastAnimationId;requestAnimationFrame(function q(){let ie=Math.min(i.service.getTimestamp()-O,C),de=i.easing[i.animation],xe=de(ie,o,_,C);i._updatePath(xe),i.onRender.observers.length>0&&i.onRender.emit(xe),N===i.lastAnimationId&&ie<C&&requestAnimationFrame(q)})};this.animationDelay>0?setTimeout(I,this.animationDelay):I()})}_updatePath(o){if(this.path){let l=this.service.getArc(o,this.max,this.radius-this.stroke/2,this.radius,this.semicircle),i=this.path.nativeElement,_=this.rounded&&o>0?"round":"";_!==this.currentLinecap&&(this.currentLinecap=_,i.style.strokeLinecap=_),i.setAttribute("d",l)}}_clamp(o){return Math.max(0,Math.min(o||0,this.max))}getPathTransform(){let o=this._getDiameter();return this.semicircle?this.clockwise?`translate(0, ${o}) rotate(-90)`:`translate(${o+","+o}) rotate(90) scale(-1, 1)`:this.clockwise?null:`scale(-1, 1) translate(-${o} 0)`}resolveColor(o){return this.service.resolveColor(o)}ngOnChanges(o){o.current?this._animateChange(o.current.previousValue,o.current.currentValue):this._updatePath(this.current)}_getDiameter(){return this.radius*2}_getElementHeight(){return this.responsive?null:(this.semicircle?this.radius:this._getDiameter())+"px"}_getViewBox(){let o=this._getDiameter();return`0 0 ${o} ${this.semicircle?this.radius:o}`}_getPaddingBottom(){return this.responsive?this.semicircle?"50%":"100%":null}};s.\u0275fac=function(l){return new(l||s)(ye(gz),ye(bz),ye(mI),ye(Ri))},s.\u0275cmp=gt({type:s,selectors:[["round-progress"]],viewQuery:function(l,i){if(l&1&&Ci(pz,5),l&2){let _;vi(_=xi())&&(i.path=_.first)}},hostAttrs:["role","progressbar"],hostVars:11,hostBindings:function(l,i){l&2&&(_n("aria-valuemin",0)("aria-valuemax",i.max)("aria-valuenow",i.current),La("width",i.responsive?"":i._getDiameter()+"px")("height",i._getElementHeight())("padding-bottom",i._getPaddingBottom()),ji("responsive",i.responsive))},inputs:{current:"current",max:"max",radius:"radius",animation:"animation",animationDelay:"animationDelay",duration:"duration",stroke:"stroke",color:"color",background:"background",responsive:"responsive",clockwise:"clockwise",semicircle:"semicircle",rounded:"rounded"},outputs:{onRender:"onRender"},standalone:!0,features:[vo,Nn],decls:4,vars:13,consts:[["path",""],["xmlns","http://www.w3.org/2000/svg"],["fill","none"]],template:function(l,i){l&1&&(nd(),V(0,"svg",1),Me(1,"circle",2)(2,"path",2,0),j()),l&2&&(_n("viewBox",i._getViewBox()),pe(),La("stroke",i.resolveColor(i.background))("stroke-width",i.stroke),_n("cx",i.radius)("cy",i.radius)("r",i.radius-i.stroke/2),pe(),La("stroke-width",i.stroke)("stroke",i.resolveColor(i.color)),_n("transform",i.getPathTransform()))},styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden}.responsive[_nghost-%COMP%]{width:100%;padding-bottom:100%}.responsive[_nghost-%COMP%] > svg[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0}"],changeDetection:0});let d=s;return d})(),pI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[_z]});let d=s;return d})();var gI=d=>({color:d}),_I=(()=>{let s=class s{constructor(o,l,i){this.http=o,this.router=l,this.razorpayService=i,this.apiUrl=xn,this.enteredValue=0,this.maxValue=5,this.minTarget=0,this.min=80,this.divColor="black",this.creditBalance=50,this.isDrawerOpen=!1,this.current=0,this.max=5,this.radius=150,this.semicircle=!0,this.color="black",this.background="#eaeaea",this.cancelRate=0,this.workingHours=0,this.credits=0,this.colorChange(),this.getTarget(),this.credits=this.razorpayService.userCredit}colorChange(){this.minTarget<this.min&&(this.divColor="red")}calculateProgress(o,l){let i=o+5;return l===0?0:i/l*100}toggleDrawer(){this.isDrawerOpen=!this.isDrawerOpen,this.router.navigate(["menu"])}increment(o=1){this.current+=o}getOverlayStyle(){let o=this.semicircle,l=(o?"":"translateY(-50%) ")+"translateX(-50%)";return{top:o?"auto":"50%",bottom:o?"5%":"auto",left:"50%",transform:l,"font-size":this.radius/3.5+"px"}}getTarget(){let o=localStorage.getItem("providerId"),l=`${this.apiUrl}providers/service-provider-targets/${o}`;this.http.get(l).subscribe(i=>{console.log(i),this.current=i.specialRating,this.minTarget=i.responseRate,this.cancelRate=i.cancellationRate,this.workingHours=i.totalWorkingHours},i=>{console.log(i)})}navTo(o){switch(o){case"credit":this.router.navigate(["credits"]);break;case"notification":this.router.navigate(["notification"]);break;case"buyNow":this.router.navigate(["addCredit"])}}};s.\u0275fac=function(l){return new(l||s)(ye(Zi),ye(jt),ye(Xo))},s.\u0275cmp=gt({type:s,selectors:[["app-target"]],decls:70,vars:21,consts:[[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined"],[1,"sub-container"],[1,"container-target"],[1,"progress-wrapper"],[1,"current",3,"ngStyle"],[3,"current","max","color","background","radius","semicircle","rounded","stroke"],[1,"progress-content"],[1,"fa","fa-star"],[1,"section-div"],[1,"section"],[1,"info"],[1,"sub-info"],[1,"material-symbols-outlined",3,"ngStyle"],[2,"font-size","1.4rem",3,"ngStyle"],[1,"material-symbols-outlined",2,"color","red","font-size","28px"],[1,"credit-balance-div"],[3,"click"],[2,"height","10rem"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1),Fe("click",function(){return i.toggleDrawer()}),X(2,"\u2630"),j(),V(3,"div",2)(4,"div",3),Fe("click",function(){return i.navTo("credit")}),Me(5,"img",4),V(6,"pre"),X(7),j()(),V(8,"div",5),Fe("click",function(){return i.navTo("notification")}),V(9,"span",6),X(10,"notifications"),j()()(),V(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10),X(15),j(),Me(16,"round-progress",11),V(17,"div",12),Me(18,"br"),V(19,"div"),Me(20,"span",13),V(21,"span"),X(22,"Min : 4.7"),j()()()()(),V(23,"div",14)(24,"div",15)(25,"span",6),X(26,"schedule"),j(),Me(27,"br")(28,"br"),V(29,"span",16),X(30),j(),Me(31,"br"),V(32,"span",17),X(33,"Weekend hours"),j()(),V(34,"div",15)(35,"span",18),X(36,"draft"),j(),X(37," \xA0"),V(38,"span",19),X(39,"Min:80%"),j(),Me(40,"br")(41,"br"),V(42,"span",16),X(43),j(),Me(44,"br"),V(45,"span",17),X(46,"Response rate"),j()(),V(47,"div",15)(48,"span",20),X(49,"privacy_tip"),j(),Me(50,"br")(51,"br"),V(52,"span",16),X(53),j(),Me(54,"br"),V(55,"span",17),X(56,"Cancellation"),j()()(),Me(57,"br"),V(58,"div",21)(59,"span",17),X(60),j(),Me(61,"br")(62,"br"),V(63,"div")(64,"button",22),Fe("click",function(){return i.navTo("buyNow")}),X(65,"Buy now"),j(),V(66,"button"),X(67,"See details"),j()()()()(),Me(68,"div",23)(69,"app-fotter")),l&2&&(pe(7),Rt(i.credits),pe(7),Le("ngStyle",i.getOverlayStyle()),pe(),Qi("",i.current,"%"),pe(),Le("current",i.current)("max",i.max)("color",i.color)("background",i.background)("radius",i.radius)("semicircle",i.semicircle)("rounded",!0)("stroke",20),pe(14),Qi("",i.workingHours," HRS"),pe(5),Le("ngStyle",li(17,gI,i.divColor)),pe(3),Le("ngStyle",li(19,gI,i.divColor)),pe(5),Qi("",i.minTarget,"%"),pe(10),Rt(i.cancelRate),pe(7),Qi("Credit Balance ",i.credits,""))},dependencies:[$0,Tb,$s],styles:['.left-half-spinner-container[_ngcontent-%COMP%]{position:relative;width:100px;height:100px;overflow:hidden;transform:rotate(90deg)}.left-half-spinner-container[_ngcontent-%COMP%]   .mat-progress-spinner[_ngcontent-%COMP%]{width:100px;height:100px}.left-half-spinner-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;right:0;width:50%;height:100%;background:#fff;z-index:1}.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%;margin-bottom:5rem}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#000;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:9rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:6rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border:1px solid black;width:2.3rem;border-radius:.4rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh}.section-div[_ngcontent-%COMP%]{display:grid;grid-template-columns:45% 45%;column-gap:2%;width:100%;height:max-content;justify-content:space-around}.section[_ngcontent-%COMP%]{border:.25px solid black;border-radius:.4rem;height:7rem;margin-top:2rem;padding:2rem 1rem 1rem;text-align:left}.info[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:600;line-height:19.36px}.sub-info[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:16.94px}.credit-balance-div[_ngcontent-%COMP%]{width:88%;height:5.5rem;border:.25px solid black;text-align:left;padding:1rem;padding-left:6%;border-radius:.8rem}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:max-content;height:2rem;display:flex;align-items:center;justify-content:center;font-family:"Inter" sans-serif;font-size:14px;font-weight:500;line-height:16.94px;border-radius:.5rem}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#3cc04b;color:#fff;border:none}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:transparent;border:.25 solid black}.credit-balance-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%;display:grid;grid-template-columns:auto auto;column-gap:1rem}cf[_ngcontent-%COMP%]:before, .cf[_ngcontent-%COMP%]:after{content:" ";display:table}.cf[_ngcontent-%COMP%]:after{clear:both}.progress-wrapper[_ngcontent-%COMP%]{position:relative;margin:20px auto;font-size:40px}.current[_ngcontent-%COMP%]{position:absolute;color:#bbb;font-weight:100;line-height:1}round-progress[_ngcontent-%COMP%]{margin:auto}.container-target[_ngcontent-%COMP%]{width:80%;max-width:650px;margin:40px auto 80px;text-align:center;padding:40px;background:#fff;border:solid 1px #ccc;border-radius:4px}button[_ngcontent-%COMP%]{display:inline-block;padding:10px 20px;background:#45ccce;color:#fff;font-size:16px;border:none;cursor:pointer;border-radius:4px;text-align:center;margin:0 5px 5px 0}button[_ngcontent-%COMP%]:nth-child(2){color:#000;border:.25px solid black;border-radius:4px;display:inline-block;text-align:center}form[_ngcontent-%COMP%]{text-align:left;max-width:350px;margin:30px auto}form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:15px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{float:right;padding:5px;width:150px}input[type=checkbox][_ngcontent-%COMP%]{width:auto}input[type=color][_ngcontent-%COMP%]{height:30px}.back[_ngcontent-%COMP%]{position:fixed;top:5px;right:5px}.progress-container[_ngcontent-%COMP%]   round-progress[_ngcontent-%COMP%]{position:relative;z-index:1}.progress-content[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(-50%,-50%);text-align:center;font-size:1.1rem;font-weight:400;line-height:1.2;z-index:2}.progress-content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;top:.5rem;display:flex;flex-direction:column}@media (max-width: 650px){.back[_ngcontent-%COMP%]{position:static;display:block;text-align:center}h2[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]{margin-bottom:20px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;margin-top:5px;float:none}.container-target[_ngcontent-%COMP%]{margin:0 auto 50px;padding:25px}}']});let d=s;return d})();function fg(d){return d+.5|0}var fd=(d,s,u)=>Math.max(Math.min(d,u),s);function mg(d){return fd(fg(d*2.55),0,255)}function gd(d){return fd(fg(d*255),0,255)}function jl(d){return fd(fg(d/2.55)/100,0,1)}function bI(d){return fd(fg(d*100),0,100)}var ja={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},q1=[..."0123456789ABCDEF"],yz=d=>q1[d&15],vz=d=>q1[(d&240)>>4]+q1[d&15],Ib=d=>(d&240)>>4===(d&15),xz=d=>Ib(d.r)&&Ib(d.g)&&Ib(d.b)&&Ib(d.a);function wz(d){var s=d.length,u;return d[0]==="#"&&(s===4||s===5?u={r:255&ja[d[1]]*17,g:255&ja[d[2]]*17,b:255&ja[d[3]]*17,a:s===5?ja[d[4]]*17:255}:(s===7||s===9)&&(u={r:ja[d[1]]<<4|ja[d[2]],g:ja[d[3]]<<4|ja[d[4]],b:ja[d[5]]<<4|ja[d[6]],a:s===9?ja[d[7]]<<4|ja[d[8]]:255})),u}var Cz=(d,s)=>d<255?s(d):"";function Sz(d){var s=xz(d)?yz:vz;return d?"#"+s(d.r)+s(d.g)+s(d.b)+Cz(d.a,s):void 0}var Mz=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function wI(d,s,u){let o=s*Math.min(u,1-u),l=(i,_=(i+d/30)%12)=>u-o*Math.max(Math.min(_-3,9-_,1),-1);return[l(0),l(8),l(4)]}function kz(d,s,u){let o=(l,i=(l+d/60)%6)=>u-u*s*Math.max(Math.min(i,4-i,1),0);return[o(5),o(3),o(1)]}function Tz(d,s,u){let o=wI(d,1,.5),l;for(s+u>1&&(l=1/(s+u),s*=l,u*=l),l=0;l<3;l++)o[l]*=1-s-u,o[l]+=s;return o}function Iz(d,s,u,o,l){return d===l?(s-u)/o+(s<u?6:0):s===l?(u-d)/o+2:(d-s)/o+4}function $1(d){let u=d.r/255,o=d.g/255,l=d.b/255,i=Math.max(u,o,l),_=Math.min(u,o,l),C=(i+_)/2,I,O,N;return i!==_&&(N=i-_,O=C>.5?N/(2-i-_):N/(i+_),I=Iz(u,o,l,N,i),I=I*60+.5),[I|0,O||0,C]}function Y1(d,s,u,o){return(Array.isArray(s)?d(s[0],s[1],s[2]):d(s,u,o)).map(gd)}function Z1(d,s,u){return Y1(wI,d,s,u)}function Ez(d,s,u){return Y1(Tz,d,s,u)}function Dz(d,s,u){return Y1(kz,d,s,u)}function CI(d){return(d%360+360)%360}function Az(d){let s=Mz.exec(d),u=255,o;if(!s)return;s[5]!==o&&(u=s[6]?mg(+s[5]):gd(+s[5]));let l=CI(+s[2]),i=+s[3]/100,_=+s[4]/100;return s[1]==="hwb"?o=Ez(l,i,_):s[1]==="hsv"?o=Dz(l,i,_):o=Z1(l,i,_),{r:o[0],g:o[1],b:o[2],a:u}}function Pz(d,s){var u=$1(d);u[0]=CI(u[0]+s),u=Z1(u),d.r=u[0],d.g=u[1],d.b=u[2]}function Oz(d){if(!d)return;let s=$1(d),u=s[0],o=bI(s[1]),l=bI(s[2]);return d.a<255?`hsla(${u}, ${o}%, ${l}%, ${jl(d.a)})`:`hsl(${u}, ${o}%, ${l}%)`}var yI={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},vI={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Rz(){let d={},s=Object.keys(vI),u=Object.keys(yI),o,l,i,_,C;for(o=0;o<s.length;o++){for(_=C=s[o],l=0;l<u.length;l++)i=u[l],C=C.replace(i,yI[i]);i=parseInt(vI[_],16),d[C]=[i>>16&255,i>>8&255,i&255]}return d}var Eb;function Lz(d){Eb||(Eb=Rz(),Eb.transparent=[0,0,0,0]);let s=Eb[d.toLowerCase()];return s&&{r:s[0],g:s[1],b:s[2],a:s.length===4?s[3]:255}}var Fz=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function zz(d){let s=Fz.exec(d),u=255,o,l,i;if(s){if(s[7]!==o){let _=+s[7];u=s[8]?mg(_):fd(_*255,0,255)}return o=+s[1],l=+s[3],i=+s[5],o=255&(s[2]?mg(o):fd(o,0,255)),l=255&(s[4]?mg(l):fd(l,0,255)),i=255&(s[6]?mg(i):fd(i,0,255)),{r:o,g:l,b:i,a:u}}}function Bz(d){return d&&(d.a<255?`rgba(${d.r}, ${d.g}, ${d.b}, ${jl(d.a)})`:`rgb(${d.r}, ${d.g}, ${d.b})`)}var G1=d=>d<=.0031308?d*12.92:Math.pow(d,1/2.4)*1.055-.055,Nm=d=>d<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4);function Nz(d,s,u){let o=Nm(jl(d.r)),l=Nm(jl(d.g)),i=Nm(jl(d.b));return{r:gd(G1(o+u*(Nm(jl(s.r))-o))),g:gd(G1(l+u*(Nm(jl(s.g))-l))),b:gd(G1(i+u*(Nm(jl(s.b))-i))),a:d.a+u*(s.a-d.a)}}function Db(d,s,u){if(d){let o=$1(d);o[s]=Math.max(0,Math.min(o[s]+o[s]*u,s===0?360:1)),o=Z1(o),d.r=o[0],d.g=o[1],d.b=o[2]}}function SI(d,s){return d&&Object.assign(s||{},d)}function xI(d){var s={r:0,g:0,b:0,a:255};return Array.isArray(d)?d.length>=3&&(s={r:d[0],g:d[1],b:d[2],a:255},d.length>3&&(s.a=gd(d[3]))):(s=SI(d,{r:0,g:0,b:0,a:1}),s.a=gd(s.a)),s}function Vz(d){return d.charAt(0)==="r"?zz(d):Az(d)}var pg=class d{constructor(s){if(s instanceof d)return s;let u=typeof s,o;u==="object"?o=xI(s):u==="string"&&(o=wz(s)||Lz(s)||Vz(s)),this._rgb=o,this._valid=!!o}get valid(){return this._valid}get rgb(){var s=SI(this._rgb);return s&&(s.a=jl(s.a)),s}set rgb(s){this._rgb=xI(s)}rgbString(){return this._valid?Bz(this._rgb):void 0}hexString(){return this._valid?Sz(this._rgb):void 0}hslString(){return this._valid?Oz(this._rgb):void 0}mix(s,u){if(s){let o=this.rgb,l=s.rgb,i,_=u===i?.5:u,C=2*_-1,I=o.a-l.a,O=((C*I===-1?C:(C+I)/(1+C*I))+1)/2;i=1-O,o.r=255&O*o.r+i*l.r+.5,o.g=255&O*o.g+i*l.g+.5,o.b=255&O*o.b+i*l.b+.5,o.a=_*o.a+(1-_)*l.a,this.rgb=o}return this}interpolate(s,u){return s&&(this._rgb=Nz(this._rgb,s._rgb,u)),this}clone(){return new d(this.rgb)}alpha(s){return this._rgb.a=gd(s),this}clearer(s){let u=this._rgb;return u.a*=1-s,this}greyscale(){let s=this._rgb,u=fg(s.r*.3+s.g*.59+s.b*.11);return s.r=s.g=s.b=u,this}opaquer(s){let u=this._rgb;return u.a*=1+s,this}negate(){let s=this._rgb;return s.r=255-s.r,s.g=255-s.g,s.b=255-s.b,this}lighten(s){return Db(this._rgb,2,s),this}darken(s){return Db(this._rgb,2,-s),this}saturate(s){return Db(this._rgb,1,s),this}desaturate(s){return Db(this._rgb,1,-s),this}rotate(s){return Pz(this._rgb,s),this}};function Xs(){}var LI=(()=>{let d=0;return()=>d++})();function bn(d){return d===null||typeof d>"u"}function Kn(d){if(Array.isArray&&Array.isArray(d))return!0;let s=Object.prototype.toString.call(d);return s.slice(0,7)==="[object"&&s.slice(-6)==="Array]"}function ln(d){return d!==null&&Object.prototype.toString.call(d)==="[object Object]"}function ur(d){return(typeof d=="number"||d instanceof Number)&&isFinite(+d)}function Ko(d,s){return ur(d)?d:s}function qi(d,s){return typeof d>"u"?s:d}var FI=(d,s)=>typeof d=="string"&&d.endsWith("%")?parseFloat(d)/100:+d/s,J1=(d,s)=>typeof d=="string"&&d.endsWith("%")?parseFloat(d)/100*s:+d;function Un(d,s,u){if(d&&typeof d.call=="function")return d.apply(u,s)}function Rn(d,s,u,o){let l,i,_;if(Kn(d))if(i=d.length,o)for(l=i-1;l>=0;l--)s.call(u,d[l],l);else for(l=0;l<i;l++)s.call(u,d[l],l);else if(ln(d))for(_=Object.keys(d),i=_.length,l=0;l<i;l++)s.call(u,d[_[l]],_[l])}function bg(d,s){let u,o,l,i;if(!d||!s||d.length!==s.length)return!1;for(u=0,o=d.length;u<o;++u)if(l=d[u],i=s[u],l.datasetIndex!==i.datasetIndex||l.index!==i.index)return!1;return!0}function Rb(d){if(Kn(d))return d.map(Rb);if(ln(d)){let s=Object.create(null),u=Object.keys(d),o=u.length,l=0;for(;l<o;++l)s[u[l]]=Rb(d[u[l]]);return s}return d}function zI(d){return["__proto__","prototype","constructor"].indexOf(d)===-1}function jz(d,s,u,o){if(!zI(d))return;let l=s[d],i=u[d];ln(l)&&ln(i)?jm(l,i,o):s[d]=Rb(i)}function jm(d,s,u){let o=Kn(s)?s:[s],l=o.length;if(!ln(d))return d;u=u||{};let i=u.merger||jz,_;for(let C=0;C<l;++C){if(_=o[C],!ln(_))continue;let I=Object.keys(_);for(let O=0,N=I.length;O<N;++O)i(I[O],d,_,u)}return d}function Hm(d,s){return jm(d,s,{merger:Uz})}function Uz(d,s,u){if(!zI(d))return;let o=s[d],l=u[d];ln(o)&&ln(l)?Hm(o,l):Object.prototype.hasOwnProperty.call(s,d)||(s[d]=Rb(l))}var MI={"":d=>d,x:d=>d.x,y:d=>d.y};function Hz(d){let s=d.split("."),u=[],o="";for(let l of s)o+=l,o.endsWith("\\")?o=o.slice(0,-1)+".":(u.push(o),o="");return u}function Wz(d){let s=Hz(d);return u=>{for(let o of s){if(o==="")break;u=u&&u[o]}return u}}function Wl(d,s){return(MI[s]||(MI[s]=Wz(s)))(d)}function Bb(d){return d.charAt(0).toUpperCase()+d.slice(1)}var Wm=d=>typeof d<"u",Ul=d=>typeof d=="function",ew=(d,s)=>{if(d.size!==s.size)return!1;for(let u of d)if(!s.has(u))return!1;return!0};function BI(d){return d.type==="mouseup"||d.type==="click"||d.type==="contextmenu"}var Jn=Math.PI,er=2*Jn,Gz=er+Jn,Lb=Number.POSITIVE_INFINITY,qz=Jn/180,xr=Jn/2,Hh=Jn/4,kI=Jn*2/3,Hl=Math.log10,bs=Math.sign;function Gm(d,s,u){return Math.abs(d-s)<u}function tw(d){let s=Math.round(d);d=Gm(d,s,d/1e3)?s:d;let u=Math.pow(10,Math.floor(Hl(d))),o=d/u;return(o<=1?1:o<=2?2:o<=5?5:10)*u}function NI(d){let s=[],u=Math.sqrt(d),o;for(o=1;o<u;o++)d%o===0&&(s.push(o),s.push(d/o));return u===(u|0)&&s.push(u),s.sort((l,i)=>l-i).pop(),s}function qh(d){return!isNaN(parseFloat(d))&&isFinite(d)}function VI(d,s){let u=Math.round(d);return u-s<=d&&u+s>=d}function iw(d,s,u){let o,l,i;for(o=0,l=d.length;o<l;o++)i=d[o][u],isNaN(i)||(s.min=Math.min(s.min,i),s.max=Math.max(s.max,i))}function Ua(d){return d*(Jn/180)}function Nb(d){return d*(180/Jn)}function nw(d){if(!ur(d))return;let s=1,u=0;for(;Math.round(d*s)/s!==d;)s*=10,u++;return u}function rw(d,s){let u=s.x-d.x,o=s.y-d.y,l=Math.sqrt(u*u+o*o),i=Math.atan2(o,u);return i<-.5*Jn&&(i+=er),{angle:i,distance:l}}function Fb(d,s){return Math.sqrt(Math.pow(s.x-d.x,2)+Math.pow(s.y-d.y,2))}function $z(d,s){return(d-s+Gz)%er-Jn}function Qo(d){return(d%er+er)%er}function qm(d,s,u,o){let l=Qo(d),i=Qo(s),_=Qo(u),C=Qo(i-l),I=Qo(_-l),O=Qo(l-i),N=Qo(l-_);return l===i||l===_||o&&i===_||C>I&&O<N}function Ur(d,s,u){return Math.max(s,Math.min(u,d))}function jI(d){return Ur(d,-32768,32767)}function Qs(d,s,u,o=1e-6){return d>=Math.min(s,u)-o&&d<=Math.max(s,u)+o}function Vb(d,s,u){u=u||(_=>d[_]<s);let o=d.length-1,l=0,i;for(;o-l>1;)i=l+o>>1,u(i)?l=i:o=i;return{lo:l,hi:o}}var Ys=(d,s,u,o)=>Vb(d,u,o?l=>{let i=d[l][s];return i<u||i===u&&d[l+1][s]===u}:l=>d[l][s]<u),UI=(d,s,u)=>Vb(d,u,o=>d[o][s]>=u);function HI(d,s,u){let o=0,l=d.length;for(;o<l&&d[o]<s;)o++;for(;l>o&&d[l-1]>u;)l--;return o>0||l<d.length?d.slice(o,l):d}var WI=["push","pop","shift","splice","unshift"];function GI(d,s){if(d._chartjs){d._chartjs.listeners.push(s);return}Object.defineProperty(d,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[s]}}),WI.forEach(u=>{let o="_onData"+Bb(u),l=d[u];Object.defineProperty(d,u,{configurable:!0,enumerable:!1,value(...i){let _=l.apply(this,i);return d._chartjs.listeners.forEach(C=>{typeof C[o]=="function"&&C[o](...i)}),_}})})}function ow(d,s){let u=d._chartjs;if(!u)return;let o=u.listeners,l=o.indexOf(s);l!==-1&&o.splice(l,1),!(o.length>0)&&(WI.forEach(i=>{delete d[i]}),delete d._chartjs)}function aw(d){let s=new Set(d);return s.size===d.length?d:Array.from(s)}var sw=function(){return typeof window>"u"?function(d){return d()}:window.requestAnimationFrame}();function lw(d,s){let u=[],o=!1;return function(...l){u=l,o||(o=!0,sw.call(window,()=>{o=!1,d.apply(s,u)}))}}function qI(d,s){let u;return function(...o){return s?(clearTimeout(u),u=setTimeout(d,s,o)):d.apply(this,o),s}}var jb=d=>d==="start"?"left":d==="end"?"right":"center",co=(d,s,u)=>d==="start"?s:d==="end"?u:(s+u)/2,$I=(d,s,u,o)=>d===(o?"left":"right")?u:d==="center"?(s+u)/2:s;function cw(d,s,u){let o=s.length,l=0,i=o;if(d._sorted){let{iScale:_,_parsed:C}=d,I=_.axis,{min:O,max:N,minDefined:q,maxDefined:ie}=_.getUserBounds();q&&(l=Ur(Math.min(Ys(C,I,O).lo,u?o:Ys(s,I,_.getPixelForValue(O)).lo),0,o-1)),ie?i=Ur(Math.max(Ys(C,_.axis,N,!0).hi+1,u?0:Ys(s,I,_.getPixelForValue(N),!0).hi+1),l,o)-l:i=o-l}return{start:l,count:i}}function dw(d){let{xScale:s,yScale:u,_scaleRanges:o}=d,l={xmin:s.min,xmax:s.max,ymin:u.min,ymax:u.max};if(!o)return d._scaleRanges=l,!0;let i=o.xmin!==s.min||o.xmax!==s.max||o.ymin!==u.min||o.ymax!==u.max;return Object.assign(o,l),i}var Ab=d=>d===0||d===1,TI=(d,s,u)=>-(Math.pow(2,10*(d-=1))*Math.sin((d-s)*er/u)),II=(d,s,u)=>Math.pow(2,-10*d)*Math.sin((d-s)*er/u)+1,Vm={linear:d=>d,easeInQuad:d=>d*d,easeOutQuad:d=>-d*(d-2),easeInOutQuad:d=>(d/=.5)<1?.5*d*d:-.5*(--d*(d-2)-1),easeInCubic:d=>d*d*d,easeOutCubic:d=>(d-=1)*d*d+1,easeInOutCubic:d=>(d/=.5)<1?.5*d*d*d:.5*((d-=2)*d*d+2),easeInQuart:d=>d*d*d*d,easeOutQuart:d=>-((d-=1)*d*d*d-1),easeInOutQuart:d=>(d/=.5)<1?.5*d*d*d*d:-.5*((d-=2)*d*d*d-2),easeInQuint:d=>d*d*d*d*d,easeOutQuint:d=>(d-=1)*d*d*d*d+1,easeInOutQuint:d=>(d/=.5)<1?.5*d*d*d*d*d:.5*((d-=2)*d*d*d*d+2),easeInSine:d=>-Math.cos(d*xr)+1,easeOutSine:d=>Math.sin(d*xr),easeInOutSine:d=>-.5*(Math.cos(Jn*d)-1),easeInExpo:d=>d===0?0:Math.pow(2,10*(d-1)),easeOutExpo:d=>d===1?1:-Math.pow(2,-10*d)+1,easeInOutExpo:d=>Ab(d)?d:d<.5?.5*Math.pow(2,10*(d*2-1)):.5*(-Math.pow(2,-10*(d*2-1))+2),easeInCirc:d=>d>=1?d:-(Math.sqrt(1-d*d)-1),easeOutCirc:d=>Math.sqrt(1-(d-=1)*d),easeInOutCirc:d=>(d/=.5)<1?-.5*(Math.sqrt(1-d*d)-1):.5*(Math.sqrt(1-(d-=2)*d)+1),easeInElastic:d=>Ab(d)?d:TI(d,.075,.3),easeOutElastic:d=>Ab(d)?d:II(d,.075,.3),easeInOutElastic(d){return Ab(d)?d:d<.5?.5*TI(d*2,.1125,.45):.5+.5*II(d*2-1,.1125,.45)},easeInBack(d){return d*d*((1.70158+1)*d-1.70158)},easeOutBack(d){return(d-=1)*d*((1.70158+1)*d+1.70158)+1},easeInOutBack(d){let s=1.70158;return(d/=.5)<1?.5*(d*d*(((s*=1.525)+1)*d-s)):.5*((d-=2)*d*(((s*=1.525)+1)*d+s)+2)},easeInBounce:d=>1-Vm.easeOutBounce(1-d),easeOutBounce(d){return d<1/2.75?7.5625*d*d:d<2/2.75?7.5625*(d-=1.5/2.75)*d+.75:d<2.5/2.75?7.5625*(d-=2.25/2.75)*d+.9375:7.5625*(d-=2.625/2.75)*d+.984375},easeInOutBounce:d=>d<.5?Vm.easeInBounce(d*2)*.5:Vm.easeOutBounce(d*2-1)*.5+.5};function hw(d){if(d&&typeof d=="object"){let s=d.toString();return s==="[object CanvasPattern]"||s==="[object CanvasGradient]"}return!1}function uw(d){return hw(d)?d:new pg(d)}function X1(d){return hw(d)?d:new pg(d).saturate(.5).darken(.1).hexString()}var Yz=["x","y","borderWidth","radius","tension"],Zz=["color","borderColor","backgroundColor"];function Xz(d){d.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),d.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:s=>s!=="onProgress"&&s!=="onComplete"&&s!=="fn"}),d.set("animations",{colors:{type:"color",properties:Zz},numbers:{type:"number",properties:Yz}}),d.describe("animations",{_fallback:"animation"}),d.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:s=>s|0}}}})}function Qz(d){d.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}var EI=new Map;function Kz(d,s){s=s||{};let u=d+JSON.stringify(s),o=EI.get(u);return o||(o=new Intl.NumberFormat(d,s),EI.set(u,o)),o}function $m(d,s,u){return Kz(s,u).format(d)}var YI={values(d){return Kn(d)?d:""+d},numeric(d,s,u){if(d===0)return"0";let o=this.chart.options.locale,l,i=d;if(u.length>1){let O=Math.max(Math.abs(u[0].value),Math.abs(u[u.length-1].value));(O<1e-4||O>1e15)&&(l="scientific"),i=Jz(d,u)}let _=Hl(Math.abs(i)),C=isNaN(_)?1:Math.max(Math.min(-1*Math.floor(_),20),0),I={notation:l,minimumFractionDigits:C,maximumFractionDigits:C};return Object.assign(I,this.options.ticks.format),$m(d,o,I)},logarithmic(d,s,u){if(d===0)return"0";let o=u[s].significand||d/Math.pow(10,Math.floor(Hl(d)));return[1,2,3,5,10,15].includes(o)||s>.8*u.length?YI.numeric.call(this,d,s,u):""}};function Jz(d,s){let u=s.length>3?s[2].value-s[1].value:s[1].value-s[0].value;return Math.abs(u)>=1&&d!==Math.floor(d)&&(u=d-Math.floor(d)),u}var yg={formatters:YI};function e5(d){d.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(s,u)=>u.lineWidth,tickColor:(s,u)=>u.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:yg.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),d.route("scale.ticks","color","","color"),d.route("scale.grid","color","","borderColor"),d.route("scale.border","color","","borderColor"),d.route("scale.title","color","","color"),d.describe("scale",{_fallback:!1,_scriptable:s=>!s.startsWith("before")&&!s.startsWith("after")&&s!=="callback"&&s!=="parser",_indexable:s=>s!=="borderDash"&&s!=="tickBorderDash"&&s!=="dash"}),d.describe("scales",{_fallback:"scale"}),d.describe("scale.ticks",{_scriptable:s=>s!=="backdropPadding"&&s!=="callback",_indexable:s=>s!=="backdropPadding"})}var bd=Object.create(null),Ub=Object.create(null);function gg(d,s){if(!s)return d;let u=s.split(".");for(let o=0,l=u.length;o<l;++o){let i=u[o];d=d[i]||(d[i]=Object.create(null))}return d}function Q1(d,s,u){return typeof s=="string"?jm(gg(d,s),u):jm(gg(d,""),s)}var K1=class{constructor(s,u){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=o=>o.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(o,l)=>X1(l.backgroundColor),this.hoverBorderColor=(o,l)=>X1(l.borderColor),this.hoverColor=(o,l)=>X1(l.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(s),this.apply(u)}set(s,u){return Q1(this,s,u)}get(s){return gg(this,s)}describe(s,u){return Q1(Ub,s,u)}override(s,u){return Q1(bd,s,u)}route(s,u,o,l){let i=gg(this,s),_=gg(this,o),C="_"+u;Object.defineProperties(i,{[C]:{value:i[u],writable:!0},[u]:{enumerable:!0,get(){let I=this[C],O=_[l];return ln(I)?Object.assign({},O,I):qi(I,O)},set(I){this[C]=I}}})}apply(s){s.forEach(u=>u(this))}},mr=new K1({_scriptable:d=>!d.startsWith("on"),_indexable:d=>d!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Xz,Qz,e5]);function t5(d){return!d||bn(d.size)||bn(d.family)?null:(d.style?d.style+" ":"")+(d.weight?d.weight+" ":"")+d.size+"px "+d.family}function _g(d,s,u,o,l){let i=s[l];return i||(i=s[l]=d.measureText(l).width,u.push(l)),i>o&&(o=i),o}function ZI(d,s,u,o){o=o||{};let l=o.data=o.data||{},i=o.garbageCollect=o.garbageCollect||[];o.font!==s&&(l=o.data={},i=o.garbageCollect=[],o.font=s),d.save(),d.font=s;let _=0,C=u.length,I,O,N,q,ie;for(I=0;I<C;I++)if(q=u[I],q!=null&&!Kn(q))_=_g(d,l,i,_,q);else if(Kn(q))for(O=0,N=q.length;O<N;O++)ie=q[O],ie!=null&&!Kn(ie)&&(_=_g(d,l,i,_,ie));d.restore();let de=i.length/2;if(de>u.length){for(I=0;I<de;I++)delete l[i[I]];i.splice(0,de)}return _}function yd(d,s,u){let o=d.currentDevicePixelRatio,l=u!==0?Math.max(u/2,.5):0;return Math.round((s-l)*o)/o+l}function mw(d,s){!s&&!d||(s=s||d.getContext("2d"),s.save(),s.resetTransform(),s.clearRect(0,0,d.width,d.height),s.restore())}function Hb(d,s,u,o){pw(d,s,u,o,null)}function pw(d,s,u,o,l){let i,_,C,I,O,N,q,ie,de=s.pointStyle,xe=s.rotation,ke=s.radius,Ae=(xe||0)*qz;if(de&&typeof de=="object"&&(i=de.toString(),i==="[object HTMLImageElement]"||i==="[object HTMLCanvasElement]")){d.save(),d.translate(u,o),d.rotate(Ae),d.drawImage(de,-de.width/2,-de.height/2,de.width,de.height),d.restore();return}if(!(isNaN(ke)||ke<=0)){switch(d.beginPath(),de){default:l?d.ellipse(u,o,l/2,ke,0,0,er):d.arc(u,o,ke,0,er),d.closePath();break;case"triangle":N=l?l/2:ke,d.moveTo(u+Math.sin(Ae)*N,o-Math.cos(Ae)*ke),Ae+=kI,d.lineTo(u+Math.sin(Ae)*N,o-Math.cos(Ae)*ke),Ae+=kI,d.lineTo(u+Math.sin(Ae)*N,o-Math.cos(Ae)*ke),d.closePath();break;case"rectRounded":O=ke*.516,I=ke-O,_=Math.cos(Ae+Hh)*I,q=Math.cos(Ae+Hh)*(l?l/2-O:I),C=Math.sin(Ae+Hh)*I,ie=Math.sin(Ae+Hh)*(l?l/2-O:I),d.arc(u-q,o-C,O,Ae-Jn,Ae-xr),d.arc(u+ie,o-_,O,Ae-xr,Ae),d.arc(u+q,o+C,O,Ae,Ae+xr),d.arc(u-ie,o+_,O,Ae+xr,Ae+Jn),d.closePath();break;case"rect":if(!xe){I=Math.SQRT1_2*ke,N=l?l/2:I,d.rect(u-N,o-I,2*N,2*I);break}Ae+=Hh;case"rectRot":q=Math.cos(Ae)*(l?l/2:ke),_=Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,ie=Math.sin(Ae)*(l?l/2:ke),d.moveTo(u-q,o-C),d.lineTo(u+ie,o-_),d.lineTo(u+q,o+C),d.lineTo(u-ie,o+_),d.closePath();break;case"crossRot":Ae+=Hh;case"cross":q=Math.cos(Ae)*(l?l/2:ke),_=Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,ie=Math.sin(Ae)*(l?l/2:ke),d.moveTo(u-q,o-C),d.lineTo(u+q,o+C),d.moveTo(u+ie,o-_),d.lineTo(u-ie,o+_);break;case"star":q=Math.cos(Ae)*(l?l/2:ke),_=Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,ie=Math.sin(Ae)*(l?l/2:ke),d.moveTo(u-q,o-C),d.lineTo(u+q,o+C),d.moveTo(u+ie,o-_),d.lineTo(u-ie,o+_),Ae+=Hh,q=Math.cos(Ae)*(l?l/2:ke),_=Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,ie=Math.sin(Ae)*(l?l/2:ke),d.moveTo(u-q,o-C),d.lineTo(u+q,o+C),d.moveTo(u+ie,o-_),d.lineTo(u-ie,o+_);break;case"line":_=l?l/2:Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,d.moveTo(u-_,o-C),d.lineTo(u+_,o+C);break;case"dash":d.moveTo(u,o),d.lineTo(u+Math.cos(Ae)*(l?l/2:ke),o+Math.sin(Ae)*ke);break;case!1:d.closePath();break}d.fill(),s.borderWidth>0&&d.stroke()}}function Zs(d,s,u){return u=u||.5,!s||d&&d.x>s.left-u&&d.x<s.right+u&&d.y>s.top-u&&d.y<s.bottom+u}function vg(d,s){d.save(),d.beginPath(),d.rect(s.left,s.top,s.right-s.left,s.bottom-s.top),d.clip()}function xg(d){d.restore()}function XI(d,s,u,o,l){if(!s)return d.lineTo(u.x,u.y);if(l==="middle"){let i=(s.x+u.x)/2;d.lineTo(i,s.y),d.lineTo(i,u.y)}else l==="after"!=!!o?d.lineTo(s.x,u.y):d.lineTo(u.x,s.y);d.lineTo(u.x,u.y)}function QI(d,s,u,o){if(!s)return d.lineTo(u.x,u.y);d.bezierCurveTo(o?s.cp1x:s.cp2x,o?s.cp1y:s.cp2y,o?u.cp2x:u.cp1x,o?u.cp2y:u.cp1y,u.x,u.y)}function i5(d,s){s.translation&&d.translate(s.translation[0],s.translation[1]),bn(s.rotation)||d.rotate(s.rotation),s.color&&(d.fillStyle=s.color),s.textAlign&&(d.textAlign=s.textAlign),s.textBaseline&&(d.textBaseline=s.textBaseline)}function n5(d,s,u,o,l){if(l.strikethrough||l.underline){let i=d.measureText(o),_=s-i.actualBoundingBoxLeft,C=s+i.actualBoundingBoxRight,I=u-i.actualBoundingBoxAscent,O=u+i.actualBoundingBoxDescent,N=l.strikethrough?(I+O)/2:O;d.strokeStyle=d.fillStyle,d.beginPath(),d.lineWidth=l.decorationWidth||2,d.moveTo(_,N),d.lineTo(C,N),d.stroke()}}function r5(d,s){let u=d.fillStyle;d.fillStyle=s.color,d.fillRect(s.left,s.top,s.width,s.height),d.fillStyle=u}function vd(d,s,u,o,l,i={}){let _=Kn(s)?s:[s],C=i.strokeWidth>0&&i.strokeColor!=="",I,O;for(d.save(),d.font=l.string,i5(d,i),I=0;I<_.length;++I)O=_[I],i.backdrop&&r5(d,i.backdrop),C&&(i.strokeColor&&(d.strokeStyle=i.strokeColor),bn(i.strokeWidth)||(d.lineWidth=i.strokeWidth),d.strokeText(O,u,o,i.maxWidth)),d.fillText(O,u,o,i.maxWidth),n5(d,u,o,O,i),o+=Number(l.lineHeight);d.restore()}function Ym(d,s){let{x:u,y:o,w:l,h:i,radius:_}=s;d.arc(u+_.topLeft,o+_.topLeft,_.topLeft,1.5*Jn,Jn,!0),d.lineTo(u,o+i-_.bottomLeft),d.arc(u+_.bottomLeft,o+i-_.bottomLeft,_.bottomLeft,Jn,xr,!0),d.lineTo(u+l-_.bottomRight,o+i),d.arc(u+l-_.bottomRight,o+i-_.bottomRight,_.bottomRight,xr,0,!0),d.lineTo(u+l,o+_.topRight),d.arc(u+l-_.topRight,o+_.topRight,_.topRight,0,-xr,!0),d.lineTo(u+_.topLeft,o)}var o5=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,a5=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function s5(d,s){let u=(""+d).match(o5);if(!u||u[1]==="normal")return s*1.2;switch(d=+u[2],u[3]){case"px":return d;case"%":d/=100;break}return s*d}var l5=d=>+d||0;function Wb(d,s){let u={},o=ln(s),l=o?Object.keys(s):s,i=ln(d)?o?_=>qi(d[_],d[s[_]]):_=>d[_]:()=>d;for(let _ of l)u[_]=l5(i(_));return u}function fw(d){return Wb(d,{top:"y",right:"x",bottom:"y",left:"x"})}function xd(d){return Wb(d,["topLeft","topRight","bottomLeft","bottomRight"])}function ho(d){let s=fw(d);return s.width=s.left+s.right,s.height=s.top+s.bottom,s}function Rr(d,s){d=d||{},s=s||mr.font;let u=qi(d.size,s.size);typeof u=="string"&&(u=parseInt(u,10));let o=qi(d.style,s.style);o&&!(""+o).match(a5)&&(console.warn('Invalid font style specified: "'+o+'"'),o=void 0);let l={family:qi(d.family,s.family),lineHeight:s5(qi(d.lineHeight,s.lineHeight),u),size:u,style:o,weight:qi(d.weight,s.weight),string:""};return l.string=t5(l),l}function Zm(d,s,u,o){let l=!0,i,_,C;for(i=0,_=d.length;i<_;++i)if(C=d[i],C!==void 0&&(s!==void 0&&typeof C=="function"&&(C=C(s),l=!1),u!==void 0&&Kn(C)&&(C=C[u%C.length],l=!1),C!==void 0))return o&&!l&&(o.cacheable=!1),C}function KI(d,s,u){let{min:o,max:l}=d,i=J1(s,(l-o)/2),_=(C,I)=>u&&C===0?0:C+I;return{min:_(o,-Math.abs(i)),max:_(l,i)}}function Gl(d,s){return Object.assign(Object.create(d),s)}function Gb(d,s=[""],u,o,l=()=>d[0]){let i=u||d;typeof o>"u"&&(o=tE("_fallback",d));let _={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:d,_rootScopes:i,_fallback:o,_getTarget:l,override:C=>Gb([C,...d],s,i,o)};return new Proxy(_,{deleteProperty(C,I){return delete C[I],delete C._keys,delete d[0][I],!0},get(C,I){return JI(C,I,()=>g5(I,s,d,C))},getOwnPropertyDescriptor(C,I){return Reflect.getOwnPropertyDescriptor(C._scopes[0],I)},getPrototypeOf(){return Reflect.getPrototypeOf(d[0])},has(C,I){return AI(C).includes(I)},ownKeys(C){return AI(C)},set(C,I,O){let N=C._storage||(C._storage=l());return C[I]=N[I]=O,delete C._keys,!0}})}function Gh(d,s,u,o){let l={_cacheable:!1,_proxy:d,_context:s,_subProxy:u,_stack:new Set,_descriptors:gw(d,o),setContext:i=>Gh(d,i,u,o),override:i=>Gh(d.override(i),s,u,o)};return new Proxy(l,{deleteProperty(i,_){return delete i[_],delete d[_],!0},get(i,_,C){return JI(i,_,()=>d5(i,_,C))},getOwnPropertyDescriptor(i,_){return i._descriptors.allKeys?Reflect.has(d,_)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(d,_)},getPrototypeOf(){return Reflect.getPrototypeOf(d)},has(i,_){return Reflect.has(d,_)},ownKeys(){return Reflect.ownKeys(d)},set(i,_,C){return d[_]=C,delete i[_],!0}})}function gw(d,s={scriptable:!0,indexable:!0}){let{_scriptable:u=s.scriptable,_indexable:o=s.indexable,_allKeys:l=s.allKeys}=d;return{allKeys:l,scriptable:u,indexable:o,isScriptable:Ul(u)?u:()=>u,isIndexable:Ul(o)?o:()=>o}}var c5=(d,s)=>d?d+Bb(s):s,_w=(d,s)=>ln(s)&&d!=="adapters"&&(Object.getPrototypeOf(s)===null||s.constructor===Object);function JI(d,s,u){if(Object.prototype.hasOwnProperty.call(d,s)||s==="constructor")return d[s];let o=u();return d[s]=o,o}function d5(d,s,u){let{_proxy:o,_context:l,_subProxy:i,_descriptors:_}=d,C=o[s];return Ul(C)&&_.isScriptable(s)&&(C=h5(s,C,d,u)),Kn(C)&&C.length&&(C=u5(s,C,d,_.isIndexable)),_w(s,C)&&(C=Gh(C,l,i&&i[s],_)),C}function h5(d,s,u,o){let{_proxy:l,_context:i,_subProxy:_,_stack:C}=u;if(C.has(d))throw new Error("Recursion detected: "+Array.from(C).join("->")+"->"+d);C.add(d);let I=s(i,_||o);return C.delete(d),_w(d,I)&&(I=bw(l._scopes,l,d,I)),I}function u5(d,s,u,o){let{_proxy:l,_context:i,_subProxy:_,_descriptors:C}=u;if(typeof i.index<"u"&&o(d))return s[i.index%s.length];if(ln(s[0])){let I=s,O=l._scopes.filter(N=>N!==I);s=[];for(let N of I){let q=bw(O,l,d,N);s.push(Gh(q,i,_&&_[d],C))}}return s}function eE(d,s,u){return Ul(d)?d(s,u):d}var m5=(d,s)=>d===!0?s:typeof d=="string"?Wl(s,d):void 0;function p5(d,s,u,o,l){for(let i of s){let _=m5(u,i);if(_){d.add(_);let C=eE(_._fallback,u,l);if(typeof C<"u"&&C!==u&&C!==o)return C}else if(_===!1&&typeof o<"u"&&u!==o)return null}return!1}function bw(d,s,u,o){let l=s._rootScopes,i=eE(s._fallback,u,o),_=[...d,...l],C=new Set;C.add(o);let I=DI(C,_,u,i||u,o);return I===null||typeof i<"u"&&i!==u&&(I=DI(C,_,i,I,o),I===null)?!1:Gb(Array.from(C),[""],l,i,()=>f5(s,u,o))}function DI(d,s,u,o,l){for(;u;)u=p5(d,s,u,o,l);return u}function f5(d,s,u){let o=d._getTarget();s in o||(o[s]={});let l=o[s];return Kn(l)&&ln(u)?u:l||{}}function g5(d,s,u,o){let l;for(let i of s)if(l=tE(c5(i,d),u),typeof l<"u")return _w(d,l)?bw(u,o,d,l):l}function tE(d,s){for(let u of s){if(!u)continue;let o=u[d];if(typeof o<"u")return o}}function AI(d){let s=d._keys;return s||(s=d._keys=_5(d._scopes)),s}function _5(d){let s=new Set;for(let u of d)for(let o of Object.keys(u).filter(l=>!l.startsWith("_")))s.add(o);return Array.from(s)}function yw(d,s,u,o){let{iScale:l}=d,{key:i="r"}=this._parsing,_=new Array(o),C,I,O,N;for(C=0,I=o;C<I;++C)O=C+u,N=s[O],_[C]={r:l.parse(Wl(N,i),O)};return _}var b5=Number.EPSILON||1e-14,Um=(d,s)=>s<d.length&&!d[s].skip&&d[s],iE=d=>d==="x"?"y":"x";function y5(d,s,u,o){let l=d.skip?s:d,i=s,_=u.skip?s:u,C=Fb(i,l),I=Fb(_,i),O=C/(C+I),N=I/(C+I);O=isNaN(O)?0:O,N=isNaN(N)?0:N;let q=o*O,ie=o*N;return{previous:{x:i.x-q*(_.x-l.x),y:i.y-q*(_.y-l.y)},next:{x:i.x+ie*(_.x-l.x),y:i.y+ie*(_.y-l.y)}}}function v5(d,s,u){let o=d.length,l,i,_,C,I,O=Um(d,0);for(let N=0;N<o-1;++N)if(I=O,O=Um(d,N+1),!(!I||!O)){if(Gm(s[N],0,b5)){u[N]=u[N+1]=0;continue}l=u[N]/s[N],i=u[N+1]/s[N],C=Math.pow(l,2)+Math.pow(i,2),!(C<=9)&&(_=3/Math.sqrt(C),u[N]=l*_*s[N],u[N+1]=i*_*s[N])}}function x5(d,s,u="x"){let o=iE(u),l=d.length,i,_,C,I=Um(d,0);for(let O=0;O<l;++O){if(_=C,C=I,I=Um(d,O+1),!C)continue;let N=C[u],q=C[o];_&&(i=(N-_[u])/3,C[`cp1${u}`]=N-i,C[`cp1${o}`]=q-i*s[O]),I&&(i=(I[u]-N)/3,C[`cp2${u}`]=N+i,C[`cp2${o}`]=q+i*s[O])}}function w5(d,s="x"){let u=iE(s),o=d.length,l=Array(o).fill(0),i=Array(o),_,C,I,O=Um(d,0);for(_=0;_<o;++_)if(C=I,I=O,O=Um(d,_+1),!!I){if(O){let N=O[s]-I[s];l[_]=N!==0?(O[u]-I[u])/N:0}i[_]=C?O?bs(l[_-1])!==bs(l[_])?0:(l[_-1]+l[_])/2:l[_-1]:l[_]}v5(d,l,i),x5(d,i,s)}function Pb(d,s,u){return Math.max(Math.min(d,u),s)}function C5(d,s){let u,o,l,i,_,C=Zs(d[0],s);for(u=0,o=d.length;u<o;++u)_=i,i=C,C=u<o-1&&Zs(d[u+1],s),i&&(l=d[u],_&&(l.cp1x=Pb(l.cp1x,s.left,s.right),l.cp1y=Pb(l.cp1y,s.top,s.bottom)),C&&(l.cp2x=Pb(l.cp2x,s.left,s.right),l.cp2y=Pb(l.cp2y,s.top,s.bottom)))}function nE(d,s,u,o,l){let i,_,C,I;if(s.spanGaps&&(d=d.filter(O=>!O.skip)),s.cubicInterpolationMode==="monotone")w5(d,l);else{let O=o?d[d.length-1]:d[0];for(i=0,_=d.length;i<_;++i)C=d[i],I=y5(O,C,d[Math.min(i+1,_-(o?0:1))%_],s.tension),C.cp1x=I.previous.x,C.cp1y=I.previous.y,C.cp2x=I.next.x,C.cp2y=I.next.y,O=C}s.capBezierPoints&&C5(d,u)}function qb(){return typeof window<"u"&&typeof document<"u"}function $b(d){let s=d.parentNode;return s&&s.toString()==="[object ShadowRoot]"&&(s=s.host),s}function zb(d,s,u){let o;return typeof d=="string"?(o=parseInt(d,10),d.indexOf("%")!==-1&&(o=o/100*s.parentNode[u])):o=d,o}var Yb=d=>d.ownerDocument.defaultView.getComputedStyle(d,null);function S5(d,s){return Yb(d).getPropertyValue(s)}var M5=["top","right","bottom","left"];function Wh(d,s,u){let o={};u=u?"-"+u:"";for(let l=0;l<4;l++){let i=M5[l];o[i]=parseFloat(d[s+"-"+i+u])||0}return o.width=o.left+o.right,o.height=o.top+o.bottom,o}var k5=(d,s,u)=>(d>0||s>0)&&(!u||!u.shadowRoot);function T5(d,s){let u=d.touches,o=u&&u.length?u[0]:d,{offsetX:l,offsetY:i}=o,_=!1,C,I;if(k5(l,i,d.target))C=l,I=i;else{let O=s.getBoundingClientRect();C=o.clientX-O.left,I=o.clientY-O.top,_=!0}return{x:C,y:I,box:_}}function wd(d,s){if("native"in d)return d;let{canvas:u,currentDevicePixelRatio:o}=s,l=Yb(u),i=l.boxSizing==="border-box",_=Wh(l,"padding"),C=Wh(l,"border","width"),{x:I,y:O,box:N}=T5(d,u),q=_.left+(N&&C.left),ie=_.top+(N&&C.top),{width:de,height:xe}=s;return i&&(de-=_.width+C.width,xe-=_.height+C.height),{x:Math.round((I-q)/de*u.width/o),y:Math.round((O-ie)/xe*u.height/o)}}function I5(d,s,u){let o,l;if(s===void 0||u===void 0){let i=d&&$b(d);if(!i)s=d.clientWidth,u=d.clientHeight;else{let _=i.getBoundingClientRect(),C=Yb(i),I=Wh(C,"border","width"),O=Wh(C,"padding");s=_.width-O.width-I.width,u=_.height-O.height-I.height,o=zb(C.maxWidth,i,"clientWidth"),l=zb(C.maxHeight,i,"clientHeight")}}return{width:s,height:u,maxWidth:o||Lb,maxHeight:l||Lb}}var Ob=d=>Math.round(d*10)/10;function rE(d,s,u,o){let l=Yb(d),i=Wh(l,"margin"),_=zb(l.maxWidth,d,"clientWidth")||Lb,C=zb(l.maxHeight,d,"clientHeight")||Lb,I=I5(d,s,u),{width:O,height:N}=I;if(l.boxSizing==="content-box"){let ie=Wh(l,"border","width"),de=Wh(l,"padding");O-=de.width+ie.width,N-=de.height+ie.height}return O=Math.max(0,O-i.width),N=Math.max(0,o?O/o:N-i.height),O=Ob(Math.min(O,_,I.maxWidth)),N=Ob(Math.min(N,C,I.maxHeight)),O&&!N&&(N=Ob(O/2)),(s!==void 0||u!==void 0)&&o&&I.height&&N>I.height&&(N=I.height,O=Ob(Math.floor(N*o))),{width:O,height:N}}function vw(d,s,u){let o=s||1,l=Math.floor(d.height*o),i=Math.floor(d.width*o);d.height=Math.floor(d.height),d.width=Math.floor(d.width);let _=d.canvas;return _.style&&(u||!_.style.height&&!_.style.width)&&(_.style.height=`${d.height}px`,_.style.width=`${d.width}px`),d.currentDevicePixelRatio!==o||_.height!==l||_.width!==i?(d.currentDevicePixelRatio=o,_.height=l,_.width=i,d.ctx.setTransform(o,0,0,o,0,0),!0):!1}var oE=function(){let d=!1;try{let s={get passive(){return d=!0,!1}};qb()&&(window.addEventListener("test",null,s),window.removeEventListener("test",null,s))}catch{}return d}();function xw(d,s){let u=S5(d,s),o=u&&u.match(/^(\d+)(\.\d+)?px$/);return o?+o[1]:void 0}function _d(d,s,u,o){return{x:d.x+u*(s.x-d.x),y:d.y+u*(s.y-d.y)}}function aE(d,s,u,o){return{x:d.x+u*(s.x-d.x),y:o==="middle"?u<.5?d.y:s.y:o==="after"?u<1?d.y:s.y:u>0?s.y:d.y}}function sE(d,s,u,o){let l={x:d.cp2x,y:d.cp2y},i={x:s.cp1x,y:s.cp1y},_=_d(d,l,u),C=_d(l,i,u),I=_d(i,s,u),O=_d(_,C,u),N=_d(C,I,u);return _d(O,N,u)}var E5=function(d,s){return{x(u){return d+d+s-u},setWidth(u){s=u},textAlign(u){return u==="center"?u:u==="right"?"left":"right"},xPlus(u,o){return u-o},leftForLtr(u,o){return u-o}}},D5=function(){return{x(d){return d},setWidth(d){},textAlign(d){return d},xPlus(d,s){return d+s},leftForLtr(d,s){return d}}};function $h(d,s,u){return d?E5(s,u):D5()}function ww(d,s){let u,o;(s==="ltr"||s==="rtl")&&(u=d.canvas.style,o=[u.getPropertyValue("direction"),u.getPropertyPriority("direction")],u.setProperty("direction",s,"important"),d.prevTextDirection=o)}function Cw(d,s){s!==void 0&&(delete d.prevTextDirection,d.canvas.style.setProperty("direction",s[0],s[1]))}function lE(d){return d==="angle"?{between:qm,compare:$z,normalize:Qo}:{between:Qs,compare:(s,u)=>s-u,normalize:s=>s}}function PI({start:d,end:s,count:u,loop:o,style:l}){return{start:d%u,end:s%u,loop:o&&(s-d+1)%u===0,style:l}}function A5(d,s,u){let{property:o,start:l,end:i}=u,{between:_,normalize:C}=lE(o),I=s.length,{start:O,end:N,loop:q}=d,ie,de;if(q){for(O+=I,N+=I,ie=0,de=I;ie<de&&_(C(s[O%I][o]),l,i);++ie)O--,N--;O%=I,N%=I}return N<O&&(N+=I),{start:O,end:N,loop:q,style:d.style}}function Sw(d,s,u){if(!u)return[d];let{property:o,start:l,end:i}=u,_=s.length,{compare:C,between:I,normalize:O}=lE(o),{start:N,end:q,loop:ie,style:de}=A5(d,s,u),xe=[],ke=!1,Ae=null,Xe,qe,ht,Tt=()=>I(l,ht,Xe)&&C(l,ht)!==0,vt=()=>C(i,Xe)===0||I(i,ht,Xe),Et=()=>ke||Tt(),Ut=()=>!ke||vt();for(let xt=N,Yt=N;xt<=q;++xt)qe=s[xt%_],!qe.skip&&(Xe=O(qe[o]),Xe!==ht&&(ke=I(Xe,l,i),Ae===null&&Et()&&(Ae=C(Xe,l)===0?xt:Yt),Ae!==null&&Ut()&&(xe.push(PI({start:Ae,end:xt,loop:ie,count:_,style:de})),Ae=null),Yt=xt,ht=Xe));return Ae!==null&&xe.push(PI({start:Ae,end:q,loop:ie,count:_,style:de})),xe}function Mw(d,s){let u=[],o=d.segments;for(let l=0;l<o.length;l++){let i=Sw(o[l],d.points,s);i.length&&u.push(...i)}return u}function P5(d,s,u,o){let l=0,i=s-1;if(u&&!o)for(;l<s&&!d[l].skip;)l++;for(;l<s&&d[l].skip;)l++;for(l%=s,u&&(i+=l);i>l&&d[i%s].skip;)i--;return i%=s,{start:l,end:i}}function O5(d,s,u,o){let l=d.length,i=[],_=s,C=d[s],I;for(I=s+1;I<=u;++I){let O=d[I%l];O.skip||O.stop?C.skip||(o=!1,i.push({start:s%l,end:(I-1)%l,loop:o}),s=_=O.stop?I:null):(_=I,C.skip&&(s=I)),C=O}return _!==null&&i.push({start:s%l,end:_%l,loop:o}),i}function cE(d,s){let u=d.points,o=d.options.spanGaps,l=u.length;if(!l)return[];let i=!!d._loop,{start:_,end:C}=P5(u,l,i,o);if(o===!0)return OI(d,[{start:_,end:C,loop:i}],u,s);let I=C<_?C+l:C,O=!!d._fullLoop&&_===0&&C===l-1;return OI(d,O5(u,_,I,O),u,s)}function OI(d,s,u,o){return!o||!o.setContext||!u?s:R5(d,s,u,o)}function R5(d,s,u,o){let l=d._chart.getContext(),i=RI(d.options),{_datasetIndex:_,options:{spanGaps:C}}=d,I=u.length,O=[],N=i,q=s[0].start,ie=q;function de(xe,ke,Ae,Xe){let qe=C?-1:1;if(xe!==ke){for(xe+=I;u[xe%I].skip;)xe-=qe;for(;u[ke%I].skip;)ke+=qe;xe%I!==ke%I&&(O.push({start:xe%I,end:ke%I,loop:Ae,style:Xe}),N=Xe,q=ke%I)}}for(let xe of s){q=C?q:xe.start;let ke=u[q%I],Ae;for(ie=q+1;ie<=xe.end;ie++){let Xe=u[ie%I];Ae=RI(o.setContext(Gl(l,{type:"segment",p0:ke,p1:Xe,p0DataIndex:(ie-1)%I,p1DataIndex:ie%I,datasetIndex:_}))),L5(Ae,N)&&de(q,ie-1,xe.loop,N),ke=Xe,N=Ae}q<ie-1&&de(q,ie-1,xe.loop,N)}return O}function RI(d){return{backgroundColor:d.backgroundColor,borderCapStyle:d.borderCapStyle,borderDash:d.borderDash,borderDashOffset:d.borderDashOffset,borderJoinStyle:d.borderJoinStyle,borderWidth:d.borderWidth,borderColor:d.borderColor}}function L5(d,s){if(!s)return!1;let u=[],o=function(l,i){return hw(i)?(u.includes(i)||u.push(i),u.indexOf(i)):i};return JSON.stringify(d,o)!==JSON.stringify(s,o)}var Lw=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(s,u,o,l){let i=u.listeners[l],_=u.duration;i.forEach(C=>C({chart:s,initial:u.initial,numSteps:_,currentStep:Math.min(o-u.start,_)}))}_refresh(){this._request||(this._running=!0,this._request=sw.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(s=Date.now()){let u=0;this._charts.forEach((o,l)=>{if(!o.running||!o.items.length)return;let i=o.items,_=i.length-1,C=!1,I;for(;_>=0;--_)I=i[_],I._active?(I._total>o.duration&&(o.duration=I._total),I.tick(s),C=!0):(i[_]=i[i.length-1],i.pop());C&&(l.draw(),this._notify(l,o,s,"progress")),i.length||(o.running=!1,this._notify(l,o,s,"complete"),o.initial=!1),u+=i.length}),this._lastDate=s,u===0&&(this._running=!1)}_getAnims(s){let u=this._charts,o=u.get(s);return o||(o={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},u.set(s,o)),o}listen(s,u,o){this._getAnims(s).listeners[u].push(o)}add(s,u){!u||!u.length||this._getAnims(s).items.push(...u)}has(s){return this._getAnims(s).items.length>0}start(s){let u=this._charts.get(s);u&&(u.running=!0,u.start=Date.now(),u.duration=u.items.reduce((o,l)=>Math.max(o,l._duration),0),this._refresh())}running(s){if(!this._running)return!1;let u=this._charts.get(s);return!(!u||!u.running||!u.items.length)}stop(s){let u=this._charts.get(s);if(!u||!u.items.length)return;let o=u.items,l=o.length-1;for(;l>=0;--l)o[l].cancel();u.items=[],this._notify(s,u,Date.now(),"complete")}remove(s){return this._charts.delete(s)}},ql=new Lw,dE="transparent",F5={boolean(d,s,u){return u>.5?s:d},color(d,s,u){let o=uw(d||dE),l=o.valid&&uw(s||dE);return l&&l.valid?l.mix(o,u).hexString():s},number(d,s,u){return d+(s-d)*u}},Fw=class{constructor(s,u,o,l){let i=u[o];l=Zm([s.to,l,i,s.from]);let _=Zm([s.from,i,l]);this._active=!0,this._fn=s.fn||F5[s.type||typeof _],this._easing=Vm[s.easing]||Vm.linear,this._start=Math.floor(Date.now()+(s.delay||0)),this._duration=this._total=Math.floor(s.duration),this._loop=!!s.loop,this._target=u,this._prop=o,this._from=_,this._to=l,this._promises=void 0}active(){return this._active}update(s,u,o){if(this._active){this._notify(!1);let l=this._target[this._prop],i=o-this._start,_=this._duration-i;this._start=o,this._duration=Math.floor(Math.max(_,s.duration)),this._total+=i,this._loop=!!s.loop,this._to=Zm([s.to,u,l,s.from]),this._from=Zm([s.from,l,u])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(s){let u=s-this._start,o=this._duration,l=this._prop,i=this._from,_=this._loop,C=this._to,I;if(this._active=i!==C&&(_||u<o),!this._active){this._target[l]=C,this._notify(!0);return}if(u<0){this._target[l]=i;return}I=u/o%2,I=_&&I>1?2-I:I,I=this._easing(Math.min(1,Math.max(0,I))),this._target[l]=this._fn(i,C,I)}wait(){let s=this._promises||(this._promises=[]);return new Promise((u,o)=>{s.push({res:u,rej:o})})}_notify(s){let u=s?"res":"rej",o=this._promises||[];for(let l=0;l<o.length;l++)o[l][u]()}},ry=class{constructor(s,u){this._chart=s,this._properties=new Map,this.configure(u)}configure(s){if(!ln(s))return;let u=Object.keys(mr.animation),o=this._properties;Object.getOwnPropertyNames(s).forEach(l=>{let i=s[l];if(!ln(i))return;let _={};for(let C of u)_[C]=i[C];(Kn(i.properties)&&i.properties||[l]).forEach(C=>{(C===l||!o.has(C))&&o.set(C,_)})})}_animateOptions(s,u){let o=u.options,l=B5(s,o);if(!l)return[];let i=this._createAnimations(l,o);return o.$shared&&z5(s.options.$animations,o).then(()=>{s.options=o},()=>{}),i}_createAnimations(s,u){let o=this._properties,l=[],i=s.$animations||(s.$animations={}),_=Object.keys(u),C=Date.now(),I;for(I=_.length-1;I>=0;--I){let O=_[I];if(O.charAt(0)==="$")continue;if(O==="options"){l.push(...this._animateOptions(s,u));continue}let N=u[O],q=i[O],ie=o.get(O);if(q)if(ie&&q.active()){q.update(ie,N,C);continue}else q.cancel();if(!ie||!ie.duration){s[O]=N;continue}i[O]=q=new Fw(ie,s,O,N),l.push(q)}return l}update(s,u){if(this._properties.size===0){Object.assign(s,u);return}let o=this._createAnimations(s,u);if(o.length)return ql.add(this._chart,o),!0}};function z5(d,s){let u=[],o=Object.keys(s);for(let l=0;l<o.length;l++){let i=d[o[l]];i&&i.active()&&u.push(i.wait())}return Promise.all(u)}function B5(d,s){if(!s)return;let u=d.options;if(!u){d.options=s;return}return u.$shared&&(d.options=u=Object.assign({},u,{$shared:!1,$animations:{}})),u}function hE(d,s){let u=d&&d.options||{},o=u.reverse,l=u.min===void 0?s:0,i=u.max===void 0?s:0;return{start:o?i:l,end:o?l:i}}function N5(d,s,u){if(u===!1)return!1;let o=hE(d,u),l=hE(s,u);return{top:l.end,right:o.end,bottom:l.start,left:o.start}}function V5(d){let s,u,o,l;return ln(d)?(s=d.top,u=d.right,o=d.bottom,l=d.left):s=u=o=l=d,{top:s,right:u,bottom:o,left:l,disabled:d===!1}}function hD(d,s){let u=[],o=d._getSortedDatasetMetas(s),l,i;for(l=0,i=o.length;l<i;++l)u.push(o[l].index);return u}function uE(d,s,u,o={}){let l=d.keys,i=o.mode==="single",_,C,I,O;if(s!==null){for(_=0,C=l.length;_<C;++_){if(I=+l[_],I===u){if(o.all)continue;break}O=d.values[I],ur(O)&&(i||s===0||bs(s)===bs(O))&&(s+=O)}return s}}function j5(d,s){let{iScale:u,vScale:o}=s,l=u.axis==="x"?"x":"y",i=o.axis==="x"?"x":"y",_=Object.keys(d),C=new Array(_.length),I,O,N;for(I=0,O=_.length;I<O;++I)N=_[I],C[I]={[l]:N,[i]:d[N]};return C}function mE(d,s){let u=d&&d.options.stacked;return u||u===void 0&&s.stack!==void 0}function U5(d,s,u){return`${d.id}.${s.id}.${u.stack||u.type}`}function H5(d){let{min:s,max:u,minDefined:o,maxDefined:l}=d.getUserBounds();return{min:o?s:Number.NEGATIVE_INFINITY,max:l?u:Number.POSITIVE_INFINITY}}function W5(d,s,u){let o=d[s]||(d[s]={});return o[u]||(o[u]={})}function pE(d,s,u,o){for(let l of s.getMatchingVisibleMetas(o).reverse()){let i=d[l.index];if(u&&i>0||!u&&i<0)return l.index}return null}function fE(d,s){let{chart:u,_cachedMeta:o}=d,l=u._stacks||(u._stacks={}),{iScale:i,vScale:_,index:C}=o,I=i.axis,O=_.axis,N=U5(i,_,o),q=s.length,ie;for(let de=0;de<q;++de){let xe=s[de],{[I]:ke,[O]:Ae}=xe,Xe=xe._stacks||(xe._stacks={});ie=Xe[O]=W5(l,N,ke),ie[C]=Ae,ie._top=pE(ie,_,!0,o.type),ie._bottom=pE(ie,_,!1,o.type);let qe=ie._visualValues||(ie._visualValues={});qe[C]=Ae}}function kw(d,s){let u=d.scales;return Object.keys(u).filter(o=>u[o].axis===s).shift()}function G5(d,s){return Gl(d,{active:!1,dataset:void 0,datasetIndex:s,index:s,mode:"default",type:"dataset"})}function q5(d,s,u){return Gl(d,{active:!1,dataIndex:s,parsed:void 0,raw:void 0,element:u,index:s,mode:"default",type:"data"})}function wg(d,s){let u=d.controller.index,o=d.vScale&&d.vScale.axis;if(o){s=s||d._parsed;for(let l of s){let i=l._stacks;if(!i||i[o]===void 0||i[o][u]===void 0)return;delete i[o][u],i[o]._visualValues!==void 0&&i[o]._visualValues[u]!==void 0&&delete i[o]._visualValues[u]}}}var Tw=d=>d==="reset"||d==="none",gE=(d,s)=>s?d:Object.assign({},d),$5=(d,s,u)=>d&&!s.hidden&&s._stacked&&{keys:hD(u,!0),values:null},Sd=(()=>{class d{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(u,o){this.chart=u,this._ctx=u.ctx,this.index=o,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){let u=this._cachedMeta;this.configure(),this.linkScales(),u._stacked=mE(u.vScale,u),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(u){this.index!==u&&wg(this._cachedMeta),this.index=u}linkScales(){let u=this.chart,o=this._cachedMeta,l=this.getDataset(),i=(ie,de,xe,ke)=>ie==="x"?de:ie==="r"?ke:xe,_=o.xAxisID=qi(l.xAxisID,kw(u,"x")),C=o.yAxisID=qi(l.yAxisID,kw(u,"y")),I=o.rAxisID=qi(l.rAxisID,kw(u,"r")),O=o.indexAxis,N=o.iAxisID=i(O,_,C,I),q=o.vAxisID=i(O,C,_,I);o.xScale=this.getScaleForId(_),o.yScale=this.getScaleForId(C),o.rScale=this.getScaleForId(I),o.iScale=this.getScaleForId(N),o.vScale=this.getScaleForId(q)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(u){return this.chart.scales[u]}_getOtherScale(u){let o=this._cachedMeta;return u===o.iScale?o.vScale:o.iScale}reset(){this._update("reset")}_destroy(){let u=this._cachedMeta;this._data&&ow(this._data,this),u._stacked&&wg(u)}_dataCheck(){let u=this.getDataset(),o=u.data||(u.data=[]),l=this._data;if(ln(o)){let i=this._cachedMeta;this._data=j5(o,i)}else if(l!==o){if(l){ow(l,this);let i=this._cachedMeta;wg(i),i._parsed=[]}o&&Object.isExtensible(o)&&GI(o,this),this._syncList=[],this._data=o}}addElements(){let u=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(u.dataset=new this.datasetElementType)}buildOrUpdateElements(u){let o=this._cachedMeta,l=this.getDataset(),i=!1;this._dataCheck();let _=o._stacked;o._stacked=mE(o.vScale,o),o.stack!==l.stack&&(i=!0,wg(o),o.stack=l.stack),this._resyncElements(u),(i||_!==o._stacked)&&fE(this,o._parsed)}configure(){let u=this.chart.config,o=u.datasetScopeKeys(this._type),l=u.getOptionScopes(this.getDataset(),o,!0);this.options=u.createResolver(l,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(u,o){let{_cachedMeta:l,_data:i}=this,{iScale:_,_stacked:C}=l,I=_.axis,O=u===0&&o===i.length?!0:l._sorted,N=u>0&&l._parsed[u-1],q,ie,de;if(this._parsing===!1)l._parsed=i,l._sorted=!0,de=i;else{Kn(i[u])?de=this.parseArrayData(l,i,u,o):ln(i[u])?de=this.parseObjectData(l,i,u,o):de=this.parsePrimitiveData(l,i,u,o);let xe=()=>ie[I]===null||N&&ie[I]<N[I];for(q=0;q<o;++q)l._parsed[q+u]=ie=de[q],O&&(xe()&&(O=!1),N=ie);l._sorted=O}C&&fE(this,de)}parsePrimitiveData(u,o,l,i){let{iScale:_,vScale:C}=u,I=_.axis,O=C.axis,N=_.getLabels(),q=_===C,ie=new Array(i),de,xe,ke;for(de=0,xe=i;de<xe;++de)ke=de+l,ie[de]={[I]:q||_.parse(N[ke],ke),[O]:C.parse(o[ke],ke)};return ie}parseArrayData(u,o,l,i){let{xScale:_,yScale:C}=u,I=new Array(i),O,N,q,ie;for(O=0,N=i;O<N;++O)q=O+l,ie=o[q],I[O]={x:_.parse(ie[0],q),y:C.parse(ie[1],q)};return I}parseObjectData(u,o,l,i){let{xScale:_,yScale:C}=u,{xAxisKey:I="x",yAxisKey:O="y"}=this._parsing,N=new Array(i),q,ie,de,xe;for(q=0,ie=i;q<ie;++q)de=q+l,xe=o[de],N[q]={x:_.parse(Wl(xe,I),de),y:C.parse(Wl(xe,O),de)};return N}getParsed(u){return this._cachedMeta._parsed[u]}getDataElement(u){return this._cachedMeta.data[u]}applyStack(u,o,l){let i=this.chart,_=this._cachedMeta,C=o[u.axis],I={keys:hD(i,!0),values:o._stacks[u.axis]._visualValues};return uE(I,C,_.index,{mode:l})}updateRangeFromParsed(u,o,l,i){let _=l[o.axis],C=_===null?NaN:_,I=i&&l._stacks[o.axis];i&&I&&(i.values=I,C=uE(i,_,this._cachedMeta.index)),u.min=Math.min(u.min,C),u.max=Math.max(u.max,C)}getMinMax(u,o){let l=this._cachedMeta,i=l._parsed,_=l._sorted&&u===l.iScale,C=i.length,I=this._getOtherScale(u),O=$5(o,l,this.chart),N={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:q,max:ie}=H5(I),de,xe;function ke(){xe=i[de];let Ae=xe[I.axis];return!ur(xe[u.axis])||q>Ae||ie<Ae}for(de=0;de<C&&!(!ke()&&(this.updateRangeFromParsed(N,u,xe,O),_));++de);if(_){for(de=C-1;de>=0;--de)if(!ke()){this.updateRangeFromParsed(N,u,xe,O);break}}return N}getAllParsedValues(u){let o=this._cachedMeta._parsed,l=[],i,_,C;for(i=0,_=o.length;i<_;++i)C=o[i][u.axis],ur(C)&&l.push(C);return l}getMaxOverflow(){return!1}getLabelAndValue(u){let o=this._cachedMeta,l=o.iScale,i=o.vScale,_=this.getParsed(u);return{label:l?""+l.getLabelForValue(_[l.axis]):"",value:i?""+i.getLabelForValue(_[i.axis]):""}}_update(u){let o=this._cachedMeta;this.update(u||"default"),o._clip=V5(qi(this.options.clip,N5(o.xScale,o.yScale,this.getMaxOverflow())))}update(u){}draw(){let u=this._ctx,o=this.chart,l=this._cachedMeta,i=l.data||[],_=o.chartArea,C=[],I=this._drawStart||0,O=this._drawCount||i.length-I,N=this.options.drawActiveElementsOnTop,q;for(l.dataset&&l.dataset.draw(u,_,I,O),q=I;q<I+O;++q){let ie=i[q];ie.hidden||(ie.active&&N?C.push(ie):ie.draw(u,_))}for(q=0;q<C.length;++q)C[q].draw(u,_)}getStyle(u,o){let l=o?"active":"default";return u===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(l):this.resolveDataElementOptions(u||0,l)}getContext(u,o,l){let i=this.getDataset(),_;if(u>=0&&u<this._cachedMeta.data.length){let C=this._cachedMeta.data[u];_=C.$context||(C.$context=q5(this.getContext(),u,C)),_.parsed=this.getParsed(u),_.raw=i.data[u],_.index=_.dataIndex=u}else _=this.$context||(this.$context=G5(this.chart.getContext(),this.index)),_.dataset=i,_.index=_.datasetIndex=this.index;return _.active=!!o,_.mode=l,_}resolveDatasetElementOptions(u){return this._resolveElementOptions(this.datasetElementType.id,u)}resolveDataElementOptions(u,o){return this._resolveElementOptions(this.dataElementType.id,o,u)}_resolveElementOptions(u,o="default",l){let i=o==="active",_=this._cachedDataOpts,C=u+"-"+o,I=_[C],O=this.enableOptionSharing&&Wm(l);if(I)return gE(I,O);let N=this.chart.config,q=N.datasetElementScopeKeys(this._type,u),ie=i?[`${u}Hover`,"hover",u,""]:[u,""],de=N.getOptionScopes(this.getDataset(),q),xe=Object.keys(mr.elements[u]),ke=()=>this.getContext(l,i,o),Ae=N.resolveNamedOptions(de,xe,ke,ie);return Ae.$shared&&(Ae.$shared=O,_[C]=Object.freeze(gE(Ae,O))),Ae}_resolveAnimations(u,o,l){let i=this.chart,_=this._cachedDataOpts,C=`animation-${o}`,I=_[C];if(I)return I;let O;if(i.options.animation!==!1){let q=this.chart.config,ie=q.datasetAnimationScopeKeys(this._type,o),de=q.getOptionScopes(this.getDataset(),ie);O=q.createResolver(de,this.getContext(u,l,o))}let N=new ry(i,O&&O.animations);return O&&O._cacheable&&(_[C]=Object.freeze(N)),N}getSharedOptions(u){if(u.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},u))}includeOptions(u,o){return!o||Tw(u)||this.chart._animationsDisabled}_getSharedOptions(u,o){let l=this.resolveDataElementOptions(u,o),i=this._sharedOptions,_=this.getSharedOptions(l),C=this.includeOptions(o,_)||_!==i;return this.updateSharedOptions(_,o,l),{sharedOptions:_,includeOptions:C}}updateElement(u,o,l,i){Tw(i)?Object.assign(u,l):this._resolveAnimations(o,i).update(u,l)}updateSharedOptions(u,o,l){u&&!Tw(o)&&this._resolveAnimations(void 0,o).update(u,l)}_setStyle(u,o,l,i){u.active=i;let _=this.getStyle(o,i);this._resolveAnimations(o,l,i).update(u,{options:!i&&this.getSharedOptions(_)||_})}removeHoverStyle(u,o,l){this._setStyle(u,l,"active",!1)}setHoverStyle(u,o,l){this._setStyle(u,l,"active",!0)}_removeDatasetHoverStyle(){let u=this._cachedMeta.dataset;u&&this._setStyle(u,void 0,"active",!1)}_setDatasetHoverStyle(){let u=this._cachedMeta.dataset;u&&this._setStyle(u,void 0,"active",!0)}_resyncElements(u){let o=this._data,l=this._cachedMeta.data;for(let[I,O,N]of this._syncList)this[I](O,N);this._syncList=[];let i=l.length,_=o.length,C=Math.min(_,i);C&&this.parse(0,C),_>i?this._insertElements(i,_-i,u):_<i&&this._removeElements(_,i-_)}_insertElements(u,o,l=!0){let i=this._cachedMeta,_=i.data,C=u+o,I,O=N=>{for(N.length+=o,I=N.length-1;I>=C;I--)N[I]=N[I-o]};for(O(_),I=u;I<C;++I)_[I]=new this.dataElementType;this._parsing&&O(i._parsed),this.parse(u,o),l&&this.updateElements(_,u,o,"reset")}updateElements(u,o,l,i){}_removeElements(u,o){let l=this._cachedMeta;if(this._parsing){let i=l._parsed.splice(u,o);l._stacked&&wg(l,i)}l.data.splice(u,o)}_sync(u){if(this._parsing)this._syncList.push(u);else{let[o,l,i]=u;this[o](l,i)}this.chart._dataChanges.push([this.index,...u])}_onDataPush(){let u=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-u,u])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(u,o){o&&this._sync(["_removeElements",u,o]);let l=arguments.length-2;l&&this._sync(["_insertElements",u,l])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return d})();function Y5(d,s){if(!d._cache.$bar){let u=d.getMatchingVisibleMetas(s),o=[];for(let l=0,i=u.length;l<i;l++)o=o.concat(u[l].controller.getAllParsedValues(d));d._cache.$bar=aw(o.sort((l,i)=>l-i))}return d._cache.$bar}function Z5(d){let s=d.iScale,u=Y5(s,d.type),o=s._length,l,i,_,C,I=()=>{_===32767||_===-32768||(Wm(C)&&(o=Math.min(o,Math.abs(_-C)||o)),C=_)};for(l=0,i=u.length;l<i;++l)_=s.getPixelForValue(u[l]),I();for(C=void 0,l=0,i=s.ticks.length;l<i;++l)_=s.getPixelForTick(l),I();return o}function X5(d,s,u,o){let l=u.barThickness,i,_;return bn(l)?(i=s.min*u.categoryPercentage,_=u.barPercentage):(i=l*o,_=1),{chunk:i/o,ratio:_,start:s.pixels[d]-i/2}}function Q5(d,s,u,o){let l=s.pixels,i=l[d],_=d>0?l[d-1]:null,C=d<l.length-1?l[d+1]:null,I=u.categoryPercentage;_===null&&(_=i-(C===null?s.end-s.start:C-i)),C===null&&(C=i+i-_);let O=i-(i-Math.min(_,C))/2*I;return{chunk:Math.abs(C-_)/2*I/o,ratio:u.barPercentage,start:O}}function K5(d,s,u,o){let l=u.parse(d[0],o),i=u.parse(d[1],o),_=Math.min(l,i),C=Math.max(l,i),I=_,O=C;Math.abs(_)>Math.abs(C)&&(I=C,O=_),s[u.axis]=O,s._custom={barStart:I,barEnd:O,start:l,end:i,min:_,max:C}}function uD(d,s,u,o){return Kn(d)?K5(d,s,u,o):s[u.axis]=u.parse(d,o),s}function _E(d,s,u,o){let l=d.iScale,i=d.vScale,_=l.getLabels(),C=l===i,I=[],O,N,q,ie;for(O=u,N=u+o;O<N;++O)ie=s[O],q={},q[l.axis]=C||l.parse(_[O],O),I.push(uD(ie,q,i,O));return I}function Iw(d){return d&&d.barStart!==void 0&&d.barEnd!==void 0}function J5(d,s,u){return d!==0?bs(d):(s.isHorizontal()?1:-1)*(s.min>=u?1:-1)}function e4(d){let s,u,o,l,i;return d.horizontal?(s=d.base>d.x,u="left",o="right"):(s=d.base<d.y,u="bottom",o="top"),s?(l="end",i="start"):(l="start",i="end"),{start:u,end:o,reverse:s,top:l,bottom:i}}function t4(d,s,u,o){let l=s.borderSkipped,i={};if(!l){d.borderSkipped=i;return}if(l===!0){d.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}let{start:_,end:C,reverse:I,top:O,bottom:N}=e4(d);l==="middle"&&u&&(d.enableBorderRadius=!0,(u._top||0)===o?l=O:(u._bottom||0)===o?l=N:(i[bE(N,_,C,I)]=!0,l=O)),i[bE(l,_,C,I)]=!0,d.borderSkipped=i}function bE(d,s,u,o){return o?(d=i4(d,s,u),d=yE(d,u,s)):d=yE(d,s,u),d}function i4(d,s,u){return d===s?u:d===u?s:d}function yE(d,s,u){return d==="start"?s:d==="end"?u:d}function n4(d,{inflateAmount:s},u){d.inflateAmount=s==="auto"?u===1?.33:0:s}var r4=(()=>{class d extends Sd{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(u,o,l,i){return _E(u,o,l,i)}parseArrayData(u,o,l,i){return _E(u,o,l,i)}parseObjectData(u,o,l,i){let{iScale:_,vScale:C}=u,{xAxisKey:I="x",yAxisKey:O="y"}=this._parsing,N=_.axis==="x"?I:O,q=C.axis==="x"?I:O,ie=[],de,xe,ke,Ae;for(de=l,xe=l+i;de<xe;++de)Ae=o[de],ke={},ke[_.axis]=_.parse(Wl(Ae,N),de),ie.push(uD(Wl(Ae,q),ke,C,de));return ie}updateRangeFromParsed(u,o,l,i){super.updateRangeFromParsed(u,o,l,i);let _=l._custom;_&&o===this._cachedMeta.vScale&&(u.min=Math.min(u.min,_.min),u.max=Math.max(u.max,_.max))}getMaxOverflow(){return 0}getLabelAndValue(u){let o=this._cachedMeta,{iScale:l,vScale:i}=o,_=this.getParsed(u),C=_._custom,I=Iw(C)?"["+C.start+", "+C.end+"]":""+i.getLabelForValue(_[i.axis]);return{label:""+l.getLabelForValue(_[l.axis]),value:I}}initialize(){this.enableOptionSharing=!0,super.initialize();let u=this._cachedMeta;u.stack=this.getDataset().stack}update(u){let o=this._cachedMeta;this.updateElements(o.data,0,o.data.length,u)}updateElements(u,o,l,i){let _=i==="reset",{index:C,_cachedMeta:{vScale:I}}=this,O=I.getBasePixel(),N=I.isHorizontal(),q=this._getRuler(),{sharedOptions:ie,includeOptions:de}=this._getSharedOptions(o,i);for(let xe=o;xe<o+l;xe++){let ke=this.getParsed(xe),Ae=_||bn(ke[I.axis])?{base:O,head:O}:this._calculateBarValuePixels(xe),Xe=this._calculateBarIndexPixels(xe,q),qe=(ke._stacks||{})[I.axis],ht={horizontal:N,base:Ae.base,enableBorderRadius:!qe||Iw(ke._custom)||C===qe._top||C===qe._bottom,x:N?Ae.head:Xe.center,y:N?Xe.center:Ae.head,height:N?Xe.size:Math.abs(Ae.size),width:N?Math.abs(Ae.size):Xe.size};de&&(ht.options=ie||this.resolveDataElementOptions(xe,u[xe].active?"active":i));let Tt=ht.options||u[xe].options;t4(ht,Tt,qe,C),n4(ht,Tt,q.ratio),this.updateElement(u[xe],xe,ht,i)}}_getStacks(u,o){let{iScale:l}=this._cachedMeta,i=l.getMatchingVisibleMetas(this._type).filter(O=>O.controller.options.grouped),_=l.options.stacked,C=[],I=O=>{let N=O.controller.getParsed(o),q=N&&N[O.vScale.axis];if(bn(q)||isNaN(q))return!0};for(let O of i)if(!(o!==void 0&&I(O))&&((_===!1||C.indexOf(O.stack)===-1||_===void 0&&O.stack===void 0)&&C.push(O.stack),O.index===u))break;return C.length||C.push(void 0),C}_getStackCount(u){return this._getStacks(void 0,u).length}_getStackIndex(u,o,l){let i=this._getStacks(u,l),_=o!==void 0?i.indexOf(o):-1;return _===-1?i.length-1:_}_getRuler(){let u=this.options,o=this._cachedMeta,l=o.iScale,i=[],_,C;for(_=0,C=o.data.length;_<C;++_)i.push(l.getPixelForValue(this.getParsed(_)[l.axis],_));let I=u.barThickness;return{min:I||Z5(o),pixels:i,start:l._startPixel,end:l._endPixel,stackCount:this._getStackCount(),scale:l,grouped:u.grouped,ratio:I?1:u.categoryPercentage*u.barPercentage}}_calculateBarValuePixels(u){let{_cachedMeta:{vScale:o,_stacked:l,index:i},options:{base:_,minBarLength:C}}=this,I=_||0,O=this.getParsed(u),N=O._custom,q=Iw(N),ie=O[o.axis],de=0,xe=l?this.applyStack(o,O,l):ie,ke,Ae;xe!==ie&&(de=xe-ie,xe=ie),q&&(ie=N.barStart,xe=N.barEnd-N.barStart,ie!==0&&bs(ie)!==bs(N.barEnd)&&(de=0),de+=ie);let Xe=!bn(_)&&!q?_:de,qe=o.getPixelForValue(Xe);if(this.chart.getDataVisibility(u)?ke=o.getPixelForValue(de+xe):ke=qe,Ae=ke-qe,Math.abs(Ae)<C){Ae=J5(Ae,o,I)*C,ie===I&&(qe-=Ae/2);let ht=o.getPixelForDecimal(0),Tt=o.getPixelForDecimal(1),vt=Math.min(ht,Tt),Et=Math.max(ht,Tt);qe=Math.max(Math.min(qe,Et),vt),ke=qe+Ae,l&&!q&&(O._stacks[o.axis]._visualValues[i]=o.getValueForPixel(ke)-o.getValueForPixel(qe))}if(qe===o.getPixelForValue(I)){let ht=bs(Ae)*o.getLineWidthForValue(I)/2;qe+=ht,Ae-=ht}return{size:Ae,base:qe,head:ke,center:ke+Ae/2}}_calculateBarIndexPixels(u,o){let l=o.scale,i=this.options,_=i.skipNull,C=qi(i.maxBarThickness,1/0),I,O;if(o.grouped){let N=_?this._getStackCount(u):o.stackCount,q=i.barThickness==="flex"?Q5(u,o,i,N):X5(u,o,i,N),ie=this._getStackIndex(this.index,this._cachedMeta.stack,_?u:void 0);I=q.start+q.chunk*ie+q.chunk/2,O=Math.min(C,q.chunk*q.ratio)}else I=l.getPixelForValue(this.getParsed(u)[l.axis],u),O=Math.min(C,o.min*o.ratio);return{base:I-O/2,head:I+O/2,center:I,size:O}}draw(){let u=this._cachedMeta,o=u.vScale,l=u.data,i=l.length,_=0;for(;_<i;++_)this.getParsed(_)[o.axis]!==null&&!l[_].hidden&&l[_].draw(this._ctx)}}return d})(),o4=(()=>{class d extends Sd{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(u,o,l,i){let _=super.parsePrimitiveData(u,o,l,i);for(let C=0;C<_.length;C++)_[C]._custom=this.resolveDataElementOptions(C+l).radius;return _}parseArrayData(u,o,l,i){let _=super.parseArrayData(u,o,l,i);for(let C=0;C<_.length;C++){let I=o[l+C];_[C]._custom=qi(I[2],this.resolveDataElementOptions(C+l).radius)}return _}parseObjectData(u,o,l,i){let _=super.parseObjectData(u,o,l,i);for(let C=0;C<_.length;C++){let I=o[l+C];_[C]._custom=qi(I&&I.r&&+I.r,this.resolveDataElementOptions(C+l).radius)}return _}getMaxOverflow(){let u=this._cachedMeta.data,o=0;for(let l=u.length-1;l>=0;--l)o=Math.max(o,u[l].size(this.resolveDataElementOptions(l))/2);return o>0&&o}getLabelAndValue(u){let o=this._cachedMeta,l=this.chart.data.labels||[],{xScale:i,yScale:_}=o,C=this.getParsed(u),I=i.getLabelForValue(C.x),O=_.getLabelForValue(C.y),N=C._custom;return{label:l[u]||"",value:"("+I+", "+O+(N?", "+N:"")+")"}}update(u){let o=this._cachedMeta.data;this.updateElements(o,0,o.length,u)}updateElements(u,o,l,i){let _=i==="reset",{iScale:C,vScale:I}=this._cachedMeta,{sharedOptions:O,includeOptions:N}=this._getSharedOptions(o,i),q=C.axis,ie=I.axis;for(let de=o;de<o+l;de++){let xe=u[de],ke=!_&&this.getParsed(de),Ae={},Xe=Ae[q]=_?C.getPixelForDecimal(.5):C.getPixelForValue(ke[q]),qe=Ae[ie]=_?I.getBasePixel():I.getPixelForValue(ke[ie]);Ae.skip=isNaN(Xe)||isNaN(qe),N&&(Ae.options=O||this.resolveDataElementOptions(de,xe.active?"active":i),_&&(Ae.options.radius=0)),this.updateElement(xe,de,Ae,i)}}resolveDataElementOptions(u,o){let l=this.getParsed(u),i=super.resolveDataElementOptions(u,o);i.$shared&&(i=Object.assign({},i,{$shared:!1}));let _=i.radius;return o!=="active"&&(i.radius=0),i.radius+=qi(l&&l._custom,_),i}}return d})();function a4(d,s,u){let o=1,l=1,i=0,_=0;if(s<er){let C=d,I=C+s,O=Math.cos(C),N=Math.sin(C),q=Math.cos(I),ie=Math.sin(I),de=(ht,Tt,vt)=>qm(ht,C,I,!0)?1:Math.max(Tt,Tt*u,vt,vt*u),xe=(ht,Tt,vt)=>qm(ht,C,I,!0)?-1:Math.min(Tt,Tt*u,vt,vt*u),ke=de(0,O,q),Ae=de(xr,N,ie),Xe=xe(Jn,O,q),qe=xe(Jn+xr,N,ie);o=(ke-Xe)/2,l=(Ae-qe)/2,i=-(ke+Xe)/2,_=-(Ae+qe)/2}return{ratioX:o,ratioY:l,offsetX:i,offsetY:_}}var iC=(()=>{class d extends Sd{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:u=>u!=="spacing",_indexable:u=>u!=="spacing"&&!u.startsWith("borderDash")&&!u.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(u){let o=u.data;if(o.labels.length&&o.datasets.length){let{labels:{pointStyle:l,color:i}}=u.legend.options;return o.labels.map((_,C)=>{let O=u.getDatasetMeta(0).controller.getStyle(C);return{text:_,fillStyle:O.backgroundColor,strokeStyle:O.borderColor,fontColor:i,lineWidth:O.borderWidth,pointStyle:l,hidden:!u.getDataVisibility(C),index:C}})}return[]}},onClick(u,o,l){l.chart.toggleDataVisibility(o.index),l.chart.update()}}}};constructor(u,o){super(u,o),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(u,o){let l=this.getDataset().data,i=this._cachedMeta;if(this._parsing===!1)i._parsed=l;else{let _=O=>+l[O];if(ln(l[u])){let{key:O="value"}=this._parsing;_=N=>+Wl(l[N],O)}let C,I;for(C=u,I=u+o;C<I;++C)i._parsed[C]=_(C)}}_getRotation(){return Ua(this.options.rotation-90)}_getCircumference(){return Ua(this.options.circumference)}_getRotationExtents(){let u=er,o=-er;for(let l=0;l<this.chart.data.datasets.length;++l)if(this.chart.isDatasetVisible(l)&&this.chart.getDatasetMeta(l).type===this._type){let i=this.chart.getDatasetMeta(l).controller,_=i._getRotation(),C=i._getCircumference();u=Math.min(u,_),o=Math.max(o,_+C)}return{rotation:u,circumference:o-u}}update(u){let o=this.chart,{chartArea:l}=o,i=this._cachedMeta,_=i.data,C=this.getMaxBorderWidth()+this.getMaxOffset(_)+this.options.spacing,I=Math.max((Math.min(l.width,l.height)-C)/2,0),O=Math.min(FI(this.options.cutout,I),1),N=this._getRingWeight(this.index),{circumference:q,rotation:ie}=this._getRotationExtents(),{ratioX:de,ratioY:xe,offsetX:ke,offsetY:Ae}=a4(ie,q,O),Xe=(l.width-C)/de,qe=(l.height-C)/xe,ht=Math.max(Math.min(Xe,qe)/2,0),Tt=J1(this.options.radius,ht),vt=Math.max(Tt*O,0),Et=(Tt-vt)/this._getVisibleDatasetWeightTotal();this.offsetX=ke*Tt,this.offsetY=Ae*Tt,i.total=this.calculateTotal(),this.outerRadius=Tt-Et*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Et*N,0),this.updateElements(_,0,_.length,u)}_circumference(u,o){let l=this.options,i=this._cachedMeta,_=this._getCircumference();return o&&l.animation.animateRotate||!this.chart.getDataVisibility(u)||i._parsed[u]===null||i.data[u].hidden?0:this.calculateCircumference(i._parsed[u]*_/er)}updateElements(u,o,l,i){let _=i==="reset",C=this.chart,I=C.chartArea,N=C.options.animation,q=(I.left+I.right)/2,ie=(I.top+I.bottom)/2,de=_&&N.animateScale,xe=de?0:this.innerRadius,ke=de?0:this.outerRadius,{sharedOptions:Ae,includeOptions:Xe}=this._getSharedOptions(o,i),qe=this._getRotation(),ht;for(ht=0;ht<o;++ht)qe+=this._circumference(ht,_);for(ht=o;ht<o+l;++ht){let Tt=this._circumference(ht,_),vt=u[ht],Et={x:q+this.offsetX,y:ie+this.offsetY,startAngle:qe,endAngle:qe+Tt,circumference:Tt,outerRadius:ke,innerRadius:xe};Xe&&(Et.options=Ae||this.resolveDataElementOptions(ht,vt.active?"active":i)),qe+=Tt,this.updateElement(vt,ht,Et,i)}}calculateTotal(){let u=this._cachedMeta,o=u.data,l=0,i;for(i=0;i<o.length;i++){let _=u._parsed[i];_!==null&&!isNaN(_)&&this.chart.getDataVisibility(i)&&!o[i].hidden&&(l+=Math.abs(_))}return l}calculateCircumference(u){let o=this._cachedMeta.total;return o>0&&!isNaN(u)?er*(Math.abs(u)/o):0}getLabelAndValue(u){let o=this._cachedMeta,l=this.chart,i=l.data.labels||[],_=$m(o._parsed[u],l.options.locale);return{label:i[u]||"",value:_}}getMaxBorderWidth(u){let o=0,l=this.chart,i,_,C,I,O;if(!u){for(i=0,_=l.data.datasets.length;i<_;++i)if(l.isDatasetVisible(i)){C=l.getDatasetMeta(i),u=C.data,I=C.controller;break}}if(!u)return 0;for(i=0,_=u.length;i<_;++i)O=I.resolveDataElementOptions(i),O.borderAlign!=="inner"&&(o=Math.max(o,O.borderWidth||0,O.hoverBorderWidth||0));return o}getMaxOffset(u){let o=0;for(let l=0,i=u.length;l<i;++l){let _=this.resolveDataElementOptions(l);o=Math.max(o,_.offset||0,_.hoverOffset||0)}return o}_getRingWeightOffset(u){let o=0;for(let l=0;l<u;++l)this.chart.isDatasetVisible(l)&&(o+=this._getRingWeight(l));return o}_getRingWeight(u){return Math.max(qi(this.chart.data.datasets[u].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return d})(),s4=(()=>{class d extends Sd{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(u){let o=this._cachedMeta,{dataset:l,data:i=[],_dataset:_}=o,C=this.chart._animationsDisabled,{start:I,count:O}=cw(o,i,C);this._drawStart=I,this._drawCount=O,dw(o)&&(I=0,O=i.length),l._chart=this.chart,l._datasetIndex=this.index,l._decimated=!!_._decimated,l.points=i;let N=this.resolveDatasetElementOptions(u);this.options.showLine||(N.borderWidth=0),N.segment=this.options.segment,this.updateElement(l,void 0,{animated:!C,options:N},u),this.updateElements(i,I,O,u)}updateElements(u,o,l,i){let _=i==="reset",{iScale:C,vScale:I,_stacked:O,_dataset:N}=this._cachedMeta,{sharedOptions:q,includeOptions:ie}=this._getSharedOptions(o,i),de=C.axis,xe=I.axis,{spanGaps:ke,segment:Ae}=this.options,Xe=qh(ke)?ke:Number.POSITIVE_INFINITY,qe=this.chart._animationsDisabled||_||i==="none",ht=o+l,Tt=u.length,vt=o>0&&this.getParsed(o-1);for(let Et=0;Et<Tt;++Et){let Ut=u[Et],xt=qe?Ut:{};if(Et<o||Et>=ht){xt.skip=!0;continue}let Yt=this.getParsed(Et),zt=bn(Yt[xe]),Si=xt[de]=C.getPixelForValue(Yt[de],Et),Ui=xt[xe]=_||zt?I.getBasePixel():I.getPixelForValue(O?this.applyStack(I,Yt,O):Yt[xe],Et);xt.skip=isNaN(Si)||isNaN(Ui)||zt,xt.stop=Et>0&&Math.abs(Yt[de]-vt[de])>Xe,Ae&&(xt.parsed=Yt,xt.raw=N.data[Et]),ie&&(xt.options=q||this.resolveDataElementOptions(Et,Ut.active?"active":i)),qe||this.updateElement(Ut,Et,xt,i),vt=Yt}}getMaxOverflow(){let u=this._cachedMeta,o=u.dataset,l=o.options&&o.options.borderWidth||0,i=u.data||[];if(!i.length)return l;let _=i[0].size(this.resolveDataElementOptions(0)),C=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(l,_,C)/2}draw(){let u=this._cachedMeta;u.dataset.updateControlPoints(this.chart.chartArea,u.iScale.axis),super.draw()}}return d})(),mD=(()=>{class d extends Sd{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(u){let o=u.data;if(o.labels.length&&o.datasets.length){let{labels:{pointStyle:l,color:i}}=u.legend.options;return o.labels.map((_,C)=>{let O=u.getDatasetMeta(0).controller.getStyle(C);return{text:_,fillStyle:O.backgroundColor,strokeStyle:O.borderColor,fontColor:i,lineWidth:O.borderWidth,pointStyle:l,hidden:!u.getDataVisibility(C),index:C}})}return[]}},onClick(u,o,l){l.chart.toggleDataVisibility(o.index),l.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(u,o){super(u,o),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(u){let o=this._cachedMeta,l=this.chart,i=l.data.labels||[],_=$m(o._parsed[u].r,l.options.locale);return{label:i[u]||"",value:_}}parseObjectData(u,o,l,i){return yw.bind(this)(u,o,l,i)}update(u){let o=this._cachedMeta.data;this._updateRadius(),this.updateElements(o,0,o.length,u)}getMinMax(){let u=this._cachedMeta,o={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return u.data.forEach((l,i)=>{let _=this.getParsed(i).r;!isNaN(_)&&this.chart.getDataVisibility(i)&&(_<o.min&&(o.min=_),_>o.max&&(o.max=_))}),o}_updateRadius(){let u=this.chart,o=u.chartArea,l=u.options,i=Math.min(o.right-o.left,o.bottom-o.top),_=Math.max(i/2,0),C=Math.max(l.cutoutPercentage?_/100*l.cutoutPercentage:1,0),I=(_-C)/u.getVisibleDatasetCount();this.outerRadius=_-I*this.index,this.innerRadius=this.outerRadius-I}updateElements(u,o,l,i){let _=i==="reset",C=this.chart,O=C.options.animation,N=this._cachedMeta.rScale,q=N.xCenter,ie=N.yCenter,de=N.getIndexAngle(0)-.5*Jn,xe=de,ke,Ae=360/this.countVisibleElements();for(ke=0;ke<o;++ke)xe+=this._computeAngle(ke,i,Ae);for(ke=o;ke<o+l;ke++){let Xe=u[ke],qe=xe,ht=xe+this._computeAngle(ke,i,Ae),Tt=C.getDataVisibility(ke)?N.getDistanceFromCenterForValue(this.getParsed(ke).r):0;xe=ht,_&&(O.animateScale&&(Tt=0),O.animateRotate&&(qe=ht=de));let vt={x:q,y:ie,innerRadius:0,outerRadius:Tt,startAngle:qe,endAngle:ht,options:this.resolveDataElementOptions(ke,Xe.active?"active":i)};this.updateElement(Xe,ke,vt,i)}}countVisibleElements(){let u=this._cachedMeta,o=0;return u.data.forEach((l,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&o++}),o}_computeAngle(u,o,l){return this.chart.getDataVisibility(u)?Ua(this.resolveDataElementOptions(u,o).angle||l):0}}return d})(),l4=(()=>{class d extends iC{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}return d})(),c4=(()=>{class d extends Sd{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(u){let o=this._cachedMeta.vScale,l=this.getParsed(u);return{label:o.getLabels()[u],value:""+o.getLabelForValue(l[o.axis])}}parseObjectData(u,o,l,i){return yw.bind(this)(u,o,l,i)}update(u){let o=this._cachedMeta,l=o.dataset,i=o.data||[],_=o.iScale.getLabels();if(l.points=i,u!=="resize"){let C=this.resolveDatasetElementOptions(u);this.options.showLine||(C.borderWidth=0);let I={_loop:!0,_fullLoop:_.length===i.length,options:C};this.updateElement(l,void 0,I,u)}this.updateElements(i,0,i.length,u)}updateElements(u,o,l,i){let _=this._cachedMeta.rScale,C=i==="reset";for(let I=o;I<o+l;I++){let O=u[I],N=this.resolveDataElementOptions(I,O.active?"active":i),q=_.getPointPositionForValue(I,this.getParsed(I).r),ie=C?_.xCenter:q.x,de=C?_.yCenter:q.y,xe={x:ie,y:de,angle:q.angle,skip:isNaN(ie)||isNaN(de),options:N};this.updateElement(O,I,xe,i)}}}return d})(),d4=(()=>{class d extends Sd{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(u){let o=this._cachedMeta,l=this.chart.data.labels||[],{xScale:i,yScale:_}=o,C=this.getParsed(u),I=i.getLabelForValue(C.x),O=_.getLabelForValue(C.y);return{label:l[u]||"",value:"("+I+", "+O+")"}}update(u){let o=this._cachedMeta,{data:l=[]}=o,i=this.chart._animationsDisabled,{start:_,count:C}=cw(o,l,i);if(this._drawStart=_,this._drawCount=C,dw(o)&&(_=0,C=l.length),this.options.showLine){this.datasetElementType||this.addElements();let{dataset:I,_dataset:O}=o;I._chart=this.chart,I._datasetIndex=this.index,I._decimated=!!O._decimated,I.points=l;let N=this.resolveDatasetElementOptions(u);N.segment=this.options.segment,this.updateElement(I,void 0,{animated:!i,options:N},u)}else this.datasetElementType&&(delete o.dataset,this.datasetElementType=!1);this.updateElements(l,_,C,u)}addElements(){let{showLine:u}=this.options;!this.datasetElementType&&u&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(u,o,l,i){let _=i==="reset",{iScale:C,vScale:I,_stacked:O,_dataset:N}=this._cachedMeta,q=this.resolveDataElementOptions(o,i),ie=this.getSharedOptions(q),de=this.includeOptions(i,ie),xe=C.axis,ke=I.axis,{spanGaps:Ae,segment:Xe}=this.options,qe=qh(Ae)?Ae:Number.POSITIVE_INFINITY,ht=this.chart._animationsDisabled||_||i==="none",Tt=o>0&&this.getParsed(o-1);for(let vt=o;vt<o+l;++vt){let Et=u[vt],Ut=this.getParsed(vt),xt=ht?Et:{},Yt=bn(Ut[ke]),zt=xt[xe]=C.getPixelForValue(Ut[xe],vt),Si=xt[ke]=_||Yt?I.getBasePixel():I.getPixelForValue(O?this.applyStack(I,Ut,O):Ut[ke],vt);xt.skip=isNaN(zt)||isNaN(Si)||Yt,xt.stop=vt>0&&Math.abs(Ut[xe]-Tt[xe])>qe,Xe&&(xt.parsed=Ut,xt.raw=N.data[vt]),de&&(xt.options=ie||this.resolveDataElementOptions(vt,Et.active?"active":i)),ht||this.updateElement(Et,vt,xt,i),Tt=Ut}this.updateSharedOptions(ie,i,q)}getMaxOverflow(){let u=this._cachedMeta,o=u.data||[];if(!this.options.showLine){let I=0;for(let O=o.length-1;O>=0;--O)I=Math.max(I,o[O].size(this.resolveDataElementOptions(O))/2);return I>0&&I}let l=u.dataset,i=l.options&&l.options.borderWidth||0;if(!o.length)return i;let _=o[0].size(this.resolveDataElementOptions(0)),C=o[o.length-1].size(this.resolveDataElementOptions(o.length-1));return Math.max(i,_,C)/2}}return d})(),h4=Object.freeze({__proto__:null,BarController:r4,BubbleController:o4,DoughnutController:iC,LineController:s4,PieController:l4,PolarAreaController:mD,RadarController:c4,ScatterController:d4});function Yh(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var zw=class d{static override(s){Object.assign(d.prototype,s)}options;constructor(s){this.options=s||{}}init(){}formats(){return Yh()}parse(){return Yh()}format(){return Yh()}add(){return Yh()}diff(){return Yh()}startOf(){return Yh()}endOf(){return Yh()}},u4={_date:zw};function m4(d,s,u,o){let{controller:l,data:i,_sorted:_}=d,C=l._cachedMeta.iScale;if(C&&s===C.axis&&s!=="r"&&_&&i.length){let I=C._reversePixels?UI:Ys;if(o){if(l._sharedOptions){let O=i[0],N=typeof O.getRange=="function"&&O.getRange(s);if(N){let q=I(i,s,u-N),ie=I(i,s,u+N);return{lo:q.lo,hi:ie.hi}}}}else return I(i,s,u)}return{lo:0,hi:i.length-1}}function Pg(d,s,u,o,l){let i=d.getSortedVisibleDatasetMetas(),_=u[s];for(let C=0,I=i.length;C<I;++C){let{index:O,data:N}=i[C],{lo:q,hi:ie}=m4(i[C],s,_,l);for(let de=q;de<=ie;++de){let xe=N[de];xe.skip||o(xe,O,de)}}}function p4(d){let s=d.indexOf("x")!==-1,u=d.indexOf("y")!==-1;return function(o,l){let i=s?Math.abs(o.x-l.x):0,_=u?Math.abs(o.y-l.y):0;return Math.sqrt(Math.pow(i,2)+Math.pow(_,2))}}function Ew(d,s,u,o,l){let i=[];return!l&&!d.isPointInArea(s)||Pg(d,u,s,function(C,I,O){!l&&!Zs(C,d.chartArea,0)||C.inRange(s.x,s.y,o)&&i.push({element:C,datasetIndex:I,index:O})},!0),i}function f4(d,s,u,o){let l=[];function i(_,C,I){let{startAngle:O,endAngle:N}=_.getProps(["startAngle","endAngle"],o),{angle:q}=rw(_,{x:s.x,y:s.y});qm(q,O,N)&&l.push({element:_,datasetIndex:C,index:I})}return Pg(d,u,s,i),l}function g4(d,s,u,o,l,i){let _=[],C=p4(u),I=Number.POSITIVE_INFINITY;function O(N,q,ie){let de=N.inRange(s.x,s.y,l);if(o&&!de)return;let xe=N.getCenterPoint(l);if(!(!!i||d.isPointInArea(xe))&&!de)return;let Ae=C(s,xe);Ae<I?(_=[{element:N,datasetIndex:q,index:ie}],I=Ae):Ae===I&&_.push({element:N,datasetIndex:q,index:ie})}return Pg(d,u,s,O),_}function Dw(d,s,u,o,l,i){return!i&&!d.isPointInArea(s)?[]:u==="r"&&!o?f4(d,s,u,l):g4(d,s,u,o,l,i)}function vE(d,s,u,o,l){let i=[],_=u==="x"?"inXRange":"inYRange",C=!1;return Pg(d,u,s,(I,O,N)=>{I[_](s[u],l)&&(i.push({element:I,datasetIndex:O,index:N}),C=C||I.inRange(s.x,s.y,l))}),o&&!C?[]:i}var _4={evaluateInteractionItems:Pg,modes:{index(d,s,u,o){let l=wd(s,d),i=u.axis||"x",_=u.includeInvisible||!1,C=u.intersect?Ew(d,l,i,o,_):Dw(d,l,i,!1,o,_),I=[];return C.length?(d.getSortedVisibleDatasetMetas().forEach(O=>{let N=C[0].index,q=O.data[N];q&&!q.skip&&I.push({element:q,datasetIndex:O.index,index:N})}),I):[]},dataset(d,s,u,o){let l=wd(s,d),i=u.axis||"xy",_=u.includeInvisible||!1,C=u.intersect?Ew(d,l,i,o,_):Dw(d,l,i,!1,o,_);if(C.length>0){let I=C[0].datasetIndex,O=d.getDatasetMeta(I).data;C=[];for(let N=0;N<O.length;++N)C.push({element:O[N],datasetIndex:I,index:N})}return C},point(d,s,u,o){let l=wd(s,d),i=u.axis||"xy",_=u.includeInvisible||!1;return Ew(d,l,i,o,_)},nearest(d,s,u,o){let l=wd(s,d),i=u.axis||"xy",_=u.includeInvisible||!1;return Dw(d,l,i,u.intersect,o,_)},x(d,s,u,o){let l=wd(s,d);return vE(d,l,"x",u.intersect,o)},y(d,s,u,o){let l=wd(s,d);return vE(d,l,"y",u.intersect,o)}}},pD=["left","top","right","bottom"];function Cg(d,s){return d.filter(u=>u.pos===s)}function xE(d,s){return d.filter(u=>pD.indexOf(u.pos)===-1&&u.box.axis===s)}function Sg(d,s){return d.sort((u,o)=>{let l=s?o:u,i=s?u:o;return l.weight===i.weight?l.index-i.index:l.weight-i.weight})}function b4(d){let s=[],u,o,l,i,_,C;for(u=0,o=(d||[]).length;u<o;++u)l=d[u],{position:i,options:{stack:_,stackWeight:C=1}}=l,s.push({index:u,box:l,pos:i,horizontal:l.isHorizontal(),weight:l.weight,stack:_&&i+_,stackWeight:C});return s}function y4(d){let s={};for(let u of d){let{stack:o,pos:l,stackWeight:i}=u;if(!o||!pD.includes(l))continue;let _=s[o]||(s[o]={count:0,placed:0,weight:0,size:0});_.count++,_.weight+=i}return s}function v4(d,s){let u=y4(d),{vBoxMaxWidth:o,hBoxMaxHeight:l}=s,i,_,C;for(i=0,_=d.length;i<_;++i){C=d[i];let{fullSize:I}=C.box,O=u[C.stack],N=O&&C.stackWeight/O.weight;C.horizontal?(C.width=N?N*o:I&&s.availableWidth,C.height=l):(C.width=o,C.height=N?N*l:I&&s.availableHeight)}return u}function x4(d){let s=b4(d),u=Sg(s.filter(O=>O.box.fullSize),!0),o=Sg(Cg(s,"left"),!0),l=Sg(Cg(s,"right")),i=Sg(Cg(s,"top"),!0),_=Sg(Cg(s,"bottom")),C=xE(s,"x"),I=xE(s,"y");return{fullSize:u,leftAndTop:o.concat(i),rightAndBottom:l.concat(I).concat(_).concat(C),chartArea:Cg(s,"chartArea"),vertical:o.concat(l).concat(I),horizontal:i.concat(_).concat(C)}}function wE(d,s,u,o){return Math.max(d[u],s[u])+Math.max(d[o],s[o])}function fD(d,s){d.top=Math.max(d.top,s.top),d.left=Math.max(d.left,s.left),d.bottom=Math.max(d.bottom,s.bottom),d.right=Math.max(d.right,s.right)}function w4(d,s,u,o){let{pos:l,box:i}=u,_=d.maxPadding;if(!ln(l)){u.size&&(d[l]-=u.size);let q=o[u.stack]||{size:0,count:1};q.size=Math.max(q.size,u.horizontal?i.height:i.width),u.size=q.size/q.count,d[l]+=u.size}i.getPadding&&fD(_,i.getPadding());let C=Math.max(0,s.outerWidth-wE(_,d,"left","right")),I=Math.max(0,s.outerHeight-wE(_,d,"top","bottom")),O=C!==d.w,N=I!==d.h;return d.w=C,d.h=I,u.horizontal?{same:O,other:N}:{same:N,other:O}}function C4(d){let s=d.maxPadding;function u(o){let l=Math.max(s[o]-d[o],0);return d[o]+=l,l}d.y+=u("top"),d.x+=u("left"),u("right"),u("bottom")}function S4(d,s){let u=s.maxPadding;function o(l){let i={left:0,top:0,right:0,bottom:0};return l.forEach(_=>{i[_]=Math.max(s[_],u[_])}),i}return o(d?["left","right"]:["top","bottom"])}function Tg(d,s,u,o){let l=[],i,_,C,I,O,N;for(i=0,_=d.length,O=0;i<_;++i){C=d[i],I=C.box,I.update(C.width||s.w,C.height||s.h,S4(C.horizontal,s));let{same:q,other:ie}=w4(s,u,C,o);O|=q&&l.length,N=N||ie,I.fullSize||l.push(C)}return O&&Tg(l,s,u,o)||N}function Zb(d,s,u,o,l){d.top=u,d.left=s,d.right=s+o,d.bottom=u+l,d.width=o,d.height=l}function CE(d,s,u,o){let l=u.padding,{x:i,y:_}=s;for(let C of d){let I=C.box,O=o[C.stack]||{count:1,placed:0,weight:1},N=C.stackWeight/O.weight||1;if(C.horizontal){let q=s.w*N,ie=O.size||I.height;Wm(O.start)&&(_=O.start),I.fullSize?Zb(I,l.left,_,u.outerWidth-l.right-l.left,ie):Zb(I,s.left+O.placed,_,q,ie),O.start=_,O.placed+=q,_=I.bottom}else{let q=s.h*N,ie=O.size||I.width;Wm(O.start)&&(i=O.start),I.fullSize?Zb(I,i,l.top,ie,u.outerHeight-l.bottom-l.top):Zb(I,i,s.top+O.placed,ie,q),O.start=i,O.placed+=q,i=I.right}}s.x=i,s.y=_}var To={addBox(d,s){d.boxes||(d.boxes=[]),s.fullSize=s.fullSize||!1,s.position=s.position||"top",s.weight=s.weight||0,s._layers=s._layers||function(){return[{z:0,draw(u){s.draw(u)}}]},d.boxes.push(s)},removeBox(d,s){let u=d.boxes?d.boxes.indexOf(s):-1;u!==-1&&d.boxes.splice(u,1)},configure(d,s,u){s.fullSize=u.fullSize,s.position=u.position,s.weight=u.weight},update(d,s,u,o){if(!d)return;let l=ho(d.options.layout.padding),i=Math.max(s-l.width,0),_=Math.max(u-l.height,0),C=x4(d.boxes),I=C.vertical,O=C.horizontal;Rn(d.boxes,ke=>{typeof ke.beforeLayout=="function"&&ke.beforeLayout()});let N=I.reduce((ke,Ae)=>Ae.box.options&&Ae.box.options.display===!1?ke:ke+1,0)||1,q=Object.freeze({outerWidth:s,outerHeight:u,padding:l,availableWidth:i,availableHeight:_,vBoxMaxWidth:i/2/N,hBoxMaxHeight:_/2}),ie=Object.assign({},l);fD(ie,ho(o));let de=Object.assign({maxPadding:ie,w:i,h:_,x:l.left,y:l.top},l),xe=v4(I.concat(O),q);Tg(C.fullSize,de,q,xe),Tg(I,de,q,xe),Tg(O,de,q,xe)&&Tg(I,de,q,xe),C4(de),CE(C.leftAndTop,de,q,xe),de.x+=de.w,de.y+=de.h,CE(C.rightAndBottom,de,q,xe),d.chartArea={left:de.left,top:de.top,right:de.left+de.w,bottom:de.top+de.h,height:de.h,width:de.w},Rn(C.chartArea,ke=>{let Ae=ke.box;Object.assign(Ae,d.chartArea),Ae.update(de.w,de.h,{left:0,top:0,right:0,bottom:0})})}},oy=class{acquireContext(s,u){}releaseContext(s){return!1}addEventListener(s,u,o){}removeEventListener(s,u,o){}getDevicePixelRatio(){return 1}getMaximumSize(s,u,o,l){return u=Math.max(0,u||s.width),o=o||s.height,{width:u,height:Math.max(0,l?Math.floor(u/l):o)}}isAttached(s){return!0}updateConfig(s){}},Bw=class extends oy{acquireContext(s){return s&&s.getContext&&s.getContext("2d")||null}updateConfig(s){s.options.animation=!1}},iy="$chartjs",M4={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},SE=d=>d===null||d==="";function k4(d,s){let u=d.style,o=d.getAttribute("height"),l=d.getAttribute("width");if(d[iy]={initial:{height:o,width:l,style:{display:u.display,height:u.height,width:u.width}}},u.display=u.display||"block",u.boxSizing=u.boxSizing||"border-box",SE(l)){let i=xw(d,"width");i!==void 0&&(d.width=i)}if(SE(o))if(d.style.height==="")d.height=d.width/(s||2);else{let i=xw(d,"height");i!==void 0&&(d.height=i)}return d}var gD=oE?{passive:!0}:!1;function T4(d,s,u){d&&d.addEventListener(s,u,gD)}function I4(d,s,u){d&&d.canvas&&d.canvas.removeEventListener(s,u,gD)}function E4(d,s){let u=M4[d.type]||d.type,{x:o,y:l}=wd(d,s);return{type:u,chart:s,native:d,x:o!==void 0?o:null,y:l!==void 0?l:null}}function ay(d,s){for(let u of d)if(u===s||u.contains(s))return!0}function D4(d,s,u){let o=d.canvas,l=new MutationObserver(i=>{let _=!1;for(let C of i)_=_||ay(C.addedNodes,o),_=_&&!ay(C.removedNodes,o);_&&u()});return l.observe(document,{childList:!0,subtree:!0}),l}function A4(d,s,u){let o=d.canvas,l=new MutationObserver(i=>{let _=!1;for(let C of i)_=_||ay(C.removedNodes,o),_=_&&!ay(C.addedNodes,o);_&&u()});return l.observe(document,{childList:!0,subtree:!0}),l}var Eg=new Map,ME=0;function _D(){let d=window.devicePixelRatio;d!==ME&&(ME=d,Eg.forEach((s,u)=>{u.currentDevicePixelRatio!==d&&s()}))}function P4(d,s){Eg.size||window.addEventListener("resize",_D),Eg.set(d,s)}function O4(d){Eg.delete(d),Eg.size||window.removeEventListener("resize",_D)}function R4(d,s,u){let o=d.canvas,l=o&&$b(o);if(!l)return;let i=lw((C,I)=>{let O=l.clientWidth;u(C,I),O<l.clientWidth&&u()},window),_=new ResizeObserver(C=>{let I=C[0],O=I.contentRect.width,N=I.contentRect.height;O===0&&N===0||i(O,N)});return _.observe(l),P4(d,i),_}function Aw(d,s,u){u&&u.disconnect(),s==="resize"&&O4(d)}function L4(d,s,u){let o=d.canvas,l=lw(i=>{d.ctx!==null&&u(E4(i,d))},d);return T4(o,s,l),l}var Nw=class extends oy{acquireContext(s,u){let o=s&&s.getContext&&s.getContext("2d");return o&&o.canvas===s?(k4(s,u),o):null}releaseContext(s){let u=s.canvas;if(!u[iy])return!1;let o=u[iy].initial;["height","width"].forEach(i=>{let _=o[i];bn(_)?u.removeAttribute(i):u.setAttribute(i,_)});let l=o.style||{};return Object.keys(l).forEach(i=>{u.style[i]=l[i]}),u.width=u.width,delete u[iy],!0}addEventListener(s,u,o){this.removeEventListener(s,u);let l=s.$proxies||(s.$proxies={}),_={attach:D4,detach:A4,resize:R4}[u]||L4;l[u]=_(s,u,o)}removeEventListener(s,u){let o=s.$proxies||(s.$proxies={}),l=o[u];if(!l)return;({attach:Aw,detach:Aw,resize:Aw}[u]||I4)(s,u,l),o[u]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(s,u,o,l){return rE(s,u,o,l)}isAttached(s){let u=s&&$b(s);return!!(u&&u.isConnected)}};function F4(d){return!qb()||typeof OffscreenCanvas<"u"&&d instanceof OffscreenCanvas?Bw:Nw}var ys=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(s){let{x:u,y:o}=this.getProps(["x","y"],s);return{x:u,y:o}}hasValue(){return qh(this.x)&&qh(this.y)}getProps(s,u){let o=this.$animations;if(!u||!o)return this;let l={};return s.forEach(i=>{l[i]=o[i]&&o[i].active()?o[i]._to:this[i]}),l}};function z4(d,s){let u=d.options.ticks,o=B4(d),l=Math.min(u.maxTicksLimit||o,o),i=u.major.enabled?V4(s):[],_=i.length,C=i[0],I=i[_-1],O=[];if(_>l)return j4(s,O,i,_/l),O;let N=N4(i,s,l);if(_>0){let q,ie,de=_>1?Math.round((I-C)/(_-1)):null;for(Xb(s,O,N,bn(de)?0:C-de,C),q=0,ie=_-1;q<ie;q++)Xb(s,O,N,i[q],i[q+1]);return Xb(s,O,N,I,bn(de)?s.length:I+de),O}return Xb(s,O,N),O}function B4(d){let s=d.options.offset,u=d._tickSize(),o=d._length/u+(s?0:1),l=d._maxLength/u;return Math.floor(Math.min(o,l))}function N4(d,s,u){let o=U4(d),l=s.length/u;if(!o)return Math.max(l,1);let i=NI(o);for(let _=0,C=i.length-1;_<C;_++){let I=i[_];if(I>l)return I}return Math.max(l,1)}function V4(d){let s=[],u,o;for(u=0,o=d.length;u<o;u++)d[u].major&&s.push(u);return s}function j4(d,s,u,o){let l=0,i=u[0],_;for(o=Math.ceil(o),_=0;_<d.length;_++)_===i&&(s.push(d[_]),l++,i=u[l*o])}function Xb(d,s,u,o,l){let i=qi(o,0),_=Math.min(qi(l,d.length),d.length),C=0,I,O,N;for(u=Math.ceil(u),l&&(I=l-o,u=I/Math.floor(I/u)),N=i;N<0;)C++,N=Math.round(i+C*u);for(O=Math.max(i,0);O<_;O++)O===N&&(s.push(d[O]),C++,N=Math.round(i+C*u))}function U4(d){let s=d.length,u,o;if(s<2)return!1;for(o=d[0],u=1;u<s;++u)if(d[u]-d[u-1]!==o)return!1;return o}var H4=d=>d==="left"?"right":d==="right"?"left":d,kE=(d,s,u)=>s==="top"||s==="left"?d[s]+u:d[s]-u,TE=(d,s)=>Math.min(s||d,d);function IE(d,s){let u=[],o=d.length/s,l=d.length,i=0;for(;i<l;i+=o)u.push(d[Math.floor(i)]);return u}function W4(d,s,u){let o=d.ticks.length,l=Math.min(s,o-1),i=d._startPixel,_=d._endPixel,C=1e-6,I=d.getPixelForTick(l),O;if(!(u&&(o===1?O=Math.max(I-i,_-I):s===0?O=(d.getPixelForTick(1)-I)/2:O=(I-d.getPixelForTick(l-1))/2,I+=l<s?O:-O,I<i-C||I>_+C)))return I}function G4(d,s){Rn(d,u=>{let o=u.gc,l=o.length/2,i;if(l>s){for(i=0;i<l;++i)delete u.data[o[i]];o.splice(0,l)}})}function Mg(d){return d.drawTicks?d.tickLength:0}function EE(d,s){if(!d.display)return 0;let u=Rr(d.font,s),o=ho(d.padding);return(Kn(d.text)?d.text.length:1)*u.lineHeight+o.height}function q4(d,s){return Gl(d,{scale:s,type:"scale"})}function $4(d,s,u){return Gl(d,{tick:u,index:s,type:"tick"})}function Y4(d,s,u){let o=jb(d);return(u&&s!=="right"||!u&&s==="right")&&(o=H4(o)),o}function Z4(d,s,u,o){let{top:l,left:i,bottom:_,right:C,chart:I}=d,{chartArea:O,scales:N}=I,q=0,ie,de,xe,ke=_-l,Ae=C-i;if(d.isHorizontal()){if(de=co(o,i,C),ln(u)){let Xe=Object.keys(u)[0],qe=u[Xe];xe=N[Xe].getPixelForValue(qe)+ke-s}else u==="center"?xe=(O.bottom+O.top)/2+ke-s:xe=kE(d,u,s);ie=C-i}else{if(ln(u)){let Xe=Object.keys(u)[0],qe=u[Xe];de=N[Xe].getPixelForValue(qe)-Ae+s}else u==="center"?de=(O.left+O.right)/2-Ae+s:de=kE(d,u,s);xe=co(o,_,l),q=u==="left"?-xr:xr}return{titleX:de,titleY:xe,maxWidth:ie,rotation:q}}var Xh=class d extends ys{constructor(s){super(),this.id=s.id,this.type=s.type,this.options=void 0,this.ctx=s.ctx,this.chart=s.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(s){this.options=s.setContext(this.getContext()),this.axis=s.axis,this._userMin=this.parse(s.min),this._userMax=this.parse(s.max),this._suggestedMin=this.parse(s.suggestedMin),this._suggestedMax=this.parse(s.suggestedMax)}parse(s,u){return s}getUserBounds(){let{_userMin:s,_userMax:u,_suggestedMin:o,_suggestedMax:l}=this;return s=Ko(s,Number.POSITIVE_INFINITY),u=Ko(u,Number.NEGATIVE_INFINITY),o=Ko(o,Number.POSITIVE_INFINITY),l=Ko(l,Number.NEGATIVE_INFINITY),{min:Ko(s,o),max:Ko(u,l),minDefined:ur(s),maxDefined:ur(u)}}getMinMax(s){let{min:u,max:o,minDefined:l,maxDefined:i}=this.getUserBounds(),_;if(l&&i)return{min:u,max:o};let C=this.getMatchingVisibleMetas();for(let I=0,O=C.length;I<O;++I)_=C[I].controller.getMinMax(this,s),l||(u=Math.min(u,_.min)),i||(o=Math.max(o,_.max));return u=i&&u>o?o:u,o=l&&u>o?u:o,{min:Ko(u,Ko(o,u)),max:Ko(o,Ko(u,o))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let s=this.chart.data;return this.options.labels||(this.isHorizontal()?s.xLabels:s.yLabels)||s.labels||[]}getLabelItems(s=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(s))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Un(this.options.beforeUpdate,[this])}update(s,u,o){let{beginAtZero:l,grace:i,ticks:_}=this.options,C=_.sampleSize;this.beforeUpdate(),this.maxWidth=s,this.maxHeight=u,this._margins=o=Object.assign({left:0,right:0,top:0,bottom:0},o),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+o.left+o.right:this.height+o.top+o.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=KI(this,i,l),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let I=C<this.ticks.length;this._convertTicksToLabels(I?IE(this.ticks,C):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),_.display&&(_.autoSkip||_.source==="auto")&&(this.ticks=z4(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),I&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let s=this.options.reverse,u,o;this.isHorizontal()?(u=this.left,o=this.right):(u=this.top,o=this.bottom,s=!s),this._startPixel=u,this._endPixel=o,this._reversePixels=s,this._length=o-u,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Un(this.options.afterUpdate,[this])}beforeSetDimensions(){Un(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Un(this.options.afterSetDimensions,[this])}_callHooks(s){this.chart.notifyPlugins(s,this.getContext()),Un(this.options[s],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Un(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(s){let u=this.options.ticks,o,l,i;for(o=0,l=s.length;o<l;o++)i=s[o],i.label=Un(u.callback,[i.value,o,s],this)}afterTickToLabelConversion(){Un(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Un(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let s=this.options,u=s.ticks,o=TE(this.ticks.length,s.ticks.maxTicksLimit),l=u.minRotation||0,i=u.maxRotation,_=l,C,I,O;if(!this._isVisible()||!u.display||l>=i||o<=1||!this.isHorizontal()){this.labelRotation=l;return}let N=this._getLabelSizes(),q=N.widest.width,ie=N.highest.height,de=Ur(this.chart.width-q,0,this.maxWidth);C=s.offset?this.maxWidth/o:de/(o-1),q+6>C&&(C=de/(o-(s.offset?.5:1)),I=this.maxHeight-Mg(s.grid)-u.padding-EE(s.title,this.chart.options.font),O=Math.sqrt(q*q+ie*ie),_=Nb(Math.min(Math.asin(Ur((N.highest.height+6)/C,-1,1)),Math.asin(Ur(I/O,-1,1))-Math.asin(Ur(ie/O,-1,1)))),_=Math.max(l,Math.min(i,_))),this.labelRotation=_}afterCalculateLabelRotation(){Un(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Un(this.options.beforeFit,[this])}fit(){let s={width:0,height:0},{chart:u,options:{ticks:o,title:l,grid:i}}=this,_=this._isVisible(),C=this.isHorizontal();if(_){let I=EE(l,u.options.font);if(C?(s.width=this.maxWidth,s.height=Mg(i)+I):(s.height=this.maxHeight,s.width=Mg(i)+I),o.display&&this.ticks.length){let{first:O,last:N,widest:q,highest:ie}=this._getLabelSizes(),de=o.padding*2,xe=Ua(this.labelRotation),ke=Math.cos(xe),Ae=Math.sin(xe);if(C){let Xe=o.mirror?0:Ae*q.width+ke*ie.height;s.height=Math.min(this.maxHeight,s.height+Xe+de)}else{let Xe=o.mirror?0:ke*q.width+Ae*ie.height;s.width=Math.min(this.maxWidth,s.width+Xe+de)}this._calculatePadding(O,N,Ae,ke)}}this._handleMargins(),C?(this.width=this._length=u.width-this._margins.left-this._margins.right,this.height=s.height):(this.width=s.width,this.height=this._length=u.height-this._margins.top-this._margins.bottom)}_calculatePadding(s,u,o,l){let{ticks:{align:i,padding:_},position:C}=this.options,I=this.labelRotation!==0,O=C!=="top"&&this.axis==="x";if(this.isHorizontal()){let N=this.getPixelForTick(0)-this.left,q=this.right-this.getPixelForTick(this.ticks.length-1),ie=0,de=0;I?O?(ie=l*s.width,de=o*u.height):(ie=o*s.height,de=l*u.width):i==="start"?de=u.width:i==="end"?ie=s.width:i!=="inner"&&(ie=s.width/2,de=u.width/2),this.paddingLeft=Math.max((ie-N+_)*this.width/(this.width-N),0),this.paddingRight=Math.max((de-q+_)*this.width/(this.width-q),0)}else{let N=u.height/2,q=s.height/2;i==="start"?(N=0,q=s.height):i==="end"&&(N=u.height,q=0),this.paddingTop=N+_,this.paddingBottom=q+_}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Un(this.options.afterFit,[this])}isHorizontal(){let{axis:s,position:u}=this.options;return u==="top"||u==="bottom"||s==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(s){this.beforeTickToLabelConversion(),this.generateTickLabels(s);let u,o;for(u=0,o=s.length;u<o;u++)bn(s[u].label)&&(s.splice(u,1),o--,u--);this.afterTickToLabelConversion()}_getLabelSizes(){let s=this._labelSizes;if(!s){let u=this.options.ticks.sampleSize,o=this.ticks;u<o.length&&(o=IE(o,u)),this._labelSizes=s=this._computeLabelSizes(o,o.length,this.options.ticks.maxTicksLimit)}return s}_computeLabelSizes(s,u,o){let{ctx:l,_longestTextCache:i}=this,_=[],C=[],I=Math.floor(u/TE(u,o)),O=0,N=0,q,ie,de,xe,ke,Ae,Xe,qe,ht,Tt,vt;for(q=0;q<u;q+=I){if(xe=s[q].label,ke=this._resolveTickFontOptions(q),l.font=Ae=ke.string,Xe=i[Ae]=i[Ae]||{data:{},gc:[]},qe=ke.lineHeight,ht=Tt=0,!bn(xe)&&!Kn(xe))ht=_g(l,Xe.data,Xe.gc,ht,xe),Tt=qe;else if(Kn(xe))for(ie=0,de=xe.length;ie<de;++ie)vt=xe[ie],!bn(vt)&&!Kn(vt)&&(ht=_g(l,Xe.data,Xe.gc,ht,vt),Tt+=qe);_.push(ht),C.push(Tt),O=Math.max(ht,O),N=Math.max(Tt,N)}G4(i,u);let Et=_.indexOf(O),Ut=C.indexOf(N),xt=Yt=>({width:_[Yt]||0,height:C[Yt]||0});return{first:xt(0),last:xt(u-1),widest:xt(Et),highest:xt(Ut),widths:_,heights:C}}getLabelForValue(s){return s}getPixelForValue(s,u){return NaN}getValueForPixel(s){}getPixelForTick(s){let u=this.ticks;return s<0||s>u.length-1?null:this.getPixelForValue(u[s].value)}getPixelForDecimal(s){this._reversePixels&&(s=1-s);let u=this._startPixel+s*this._length;return jI(this._alignToPixels?yd(this.chart,u,0):u)}getDecimalForPixel(s){let u=(s-this._startPixel)/this._length;return this._reversePixels?1-u:u}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:s,max:u}=this;return s<0&&u<0?u:s>0&&u>0?s:0}getContext(s){let u=this.ticks||[];if(s>=0&&s<u.length){let o=u[s];return o.$context||(o.$context=$4(this.getContext(),s,o))}return this.$context||(this.$context=q4(this.chart.getContext(),this))}_tickSize(){let s=this.options.ticks,u=Ua(this.labelRotation),o=Math.abs(Math.cos(u)),l=Math.abs(Math.sin(u)),i=this._getLabelSizes(),_=s.autoSkipPadding||0,C=i?i.widest.width+_:0,I=i?i.highest.height+_:0;return this.isHorizontal()?I*o>C*l?C/o:I/l:I*l<C*o?I/o:C/l}_isVisible(){let s=this.options.display;return s!=="auto"?!!s:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(s){let u=this.axis,o=this.chart,l=this.options,{grid:i,position:_,border:C}=l,I=i.offset,O=this.isHorizontal(),q=this.ticks.length+(I?1:0),ie=Mg(i),de=[],xe=C.setContext(this.getContext()),ke=xe.display?xe.width:0,Ae=ke/2,Xe=function(en){return yd(o,en,ke)},qe,ht,Tt,vt,Et,Ut,xt,Yt,zt,Si,Ui,rr;if(_==="top")qe=Xe(this.bottom),Ut=this.bottom-ie,Yt=qe-Ae,Si=Xe(s.top)+Ae,rr=s.bottom;else if(_==="bottom")qe=Xe(this.top),Si=s.top,rr=Xe(s.bottom)-Ae,Ut=qe+Ae,Yt=this.top+ie;else if(_==="left")qe=Xe(this.right),Et=this.right-ie,xt=qe-Ae,zt=Xe(s.left)+Ae,Ui=s.right;else if(_==="right")qe=Xe(this.left),zt=s.left,Ui=Xe(s.right)-Ae,Et=qe+Ae,xt=this.left+ie;else if(u==="x"){if(_==="center")qe=Xe((s.top+s.bottom)/2+.5);else if(ln(_)){let en=Object.keys(_)[0],zn=_[en];qe=Xe(this.chart.scales[en].getPixelForValue(zn))}Si=s.top,rr=s.bottom,Ut=qe+Ae,Yt=Ut+ie}else if(u==="y"){if(_==="center")qe=Xe((s.left+s.right)/2);else if(ln(_)){let en=Object.keys(_)[0],zn=_[en];qe=Xe(this.chart.scales[en].getPixelForValue(zn))}Et=qe-Ae,xt=Et-ie,zt=s.left,Ui=s.right}let bi=qi(l.ticks.maxTicksLimit,q),cn=Math.max(1,Math.ceil(q/bi));for(ht=0;ht<q;ht+=cn){let en=this.getContext(ht),zn=i.setContext(en),Lr=C.setContext(en),Hn=zn.lineWidth,Mi=zn.color,ta=Lr.dash||[],Wn=Lr.dashOffset,ga=zn.tickWidth,Oo=zn.tickColor,_a=zn.tickBorderDash||[],Gt=zn.tickBorderDashOffset;Tt=W4(this,ht,I),Tt!==void 0&&(vt=yd(o,Tt,Hn),O?Et=xt=zt=Ui=vt:Ut=Yt=Si=rr=vt,de.push({tx1:Et,ty1:Ut,tx2:xt,ty2:Yt,x1:zt,y1:Si,x2:Ui,y2:rr,width:Hn,color:Mi,borderDash:ta,borderDashOffset:Wn,tickWidth:ga,tickColor:Oo,tickBorderDash:_a,tickBorderDashOffset:Gt}))}return this._ticksLength=q,this._borderValue=qe,de}_computeLabelItems(s){let u=this.axis,o=this.options,{position:l,ticks:i}=o,_=this.isHorizontal(),C=this.ticks,{align:I,crossAlign:O,padding:N,mirror:q}=i,ie=Mg(o.grid),de=ie+N,xe=q?-N:de,ke=-Ua(this.labelRotation),Ae=[],Xe,qe,ht,Tt,vt,Et,Ut,xt,Yt,zt,Si,Ui,rr="middle";if(l==="top")Et=this.bottom-xe,Ut=this._getXAxisLabelAlignment();else if(l==="bottom")Et=this.top+xe,Ut=this._getXAxisLabelAlignment();else if(l==="left"){let cn=this._getYAxisLabelAlignment(ie);Ut=cn.textAlign,vt=cn.x}else if(l==="right"){let cn=this._getYAxisLabelAlignment(ie);Ut=cn.textAlign,vt=cn.x}else if(u==="x"){if(l==="center")Et=(s.top+s.bottom)/2+de;else if(ln(l)){let cn=Object.keys(l)[0],en=l[cn];Et=this.chart.scales[cn].getPixelForValue(en)+de}Ut=this._getXAxisLabelAlignment()}else if(u==="y"){if(l==="center")vt=(s.left+s.right)/2-de;else if(ln(l)){let cn=Object.keys(l)[0],en=l[cn];vt=this.chart.scales[cn].getPixelForValue(en)}Ut=this._getYAxisLabelAlignment(ie).textAlign}u==="y"&&(I==="start"?rr="top":I==="end"&&(rr="bottom"));let bi=this._getLabelSizes();for(Xe=0,qe=C.length;Xe<qe;++Xe){ht=C[Xe],Tt=ht.label;let cn=i.setContext(this.getContext(Xe));xt=this.getPixelForTick(Xe)+i.labelOffset,Yt=this._resolveTickFontOptions(Xe),zt=Yt.lineHeight,Si=Kn(Tt)?Tt.length:1;let en=Si/2,zn=cn.color,Lr=cn.textStrokeColor,Hn=cn.textStrokeWidth,Mi=Ut;_?(vt=xt,Ut==="inner"&&(Xe===qe-1?Mi=this.options.reverse?"left":"right":Xe===0?Mi=this.options.reverse?"right":"left":Mi="center"),l==="top"?O==="near"||ke!==0?Ui=-Si*zt+zt/2:O==="center"?Ui=-bi.highest.height/2-en*zt+zt:Ui=-bi.highest.height+zt/2:O==="near"||ke!==0?Ui=zt/2:O==="center"?Ui=bi.highest.height/2-en*zt:Ui=bi.highest.height-Si*zt,q&&(Ui*=-1),ke!==0&&!cn.showLabelBackdrop&&(vt+=zt/2*Math.sin(ke))):(Et=xt,Ui=(1-Si)*zt/2);let ta;if(cn.showLabelBackdrop){let Wn=ho(cn.backdropPadding),ga=bi.heights[Xe],Oo=bi.widths[Xe],_a=Ui-Wn.top,Gt=0-Wn.left;switch(rr){case"middle":_a-=ga/2;break;case"bottom":_a-=ga;break}switch(Ut){case"center":Gt-=Oo/2;break;case"right":Gt-=Oo;break;case"inner":Xe===qe-1?Gt-=Oo:Xe>0&&(Gt-=Oo/2);break}ta={left:Gt,top:_a,width:Oo+Wn.width,height:ga+Wn.height,color:cn.backdropColor}}Ae.push({label:Tt,font:Yt,textOffset:Ui,options:{rotation:ke,color:zn,strokeColor:Lr,strokeWidth:Hn,textAlign:Mi,textBaseline:rr,translation:[vt,Et],backdrop:ta}})}return Ae}_getXAxisLabelAlignment(){let{position:s,ticks:u}=this.options;if(-Ua(this.labelRotation))return s==="top"?"left":"right";let l="center";return u.align==="start"?l="left":u.align==="end"?l="right":u.align==="inner"&&(l="inner"),l}_getYAxisLabelAlignment(s){let{position:u,ticks:{crossAlign:o,mirror:l,padding:i}}=this.options,_=this._getLabelSizes(),C=s+i,I=_.widest.width,O,N;return u==="left"?l?(N=this.right+i,o==="near"?O="left":o==="center"?(O="center",N+=I/2):(O="right",N+=I)):(N=this.right-C,o==="near"?O="right":o==="center"?(O="center",N-=I/2):(O="left",N=this.left)):u==="right"?l?(N=this.left+i,o==="near"?O="right":o==="center"?(O="center",N-=I/2):(O="left",N-=I)):(N=this.left+C,o==="near"?O="left":o==="center"?(O="center",N+=I/2):(O="right",N=this.right)):O="right",{textAlign:O,x:N}}_computeLabelArea(){if(this.options.ticks.mirror)return;let s=this.chart,u=this.options.position;if(u==="left"||u==="right")return{top:0,left:this.left,bottom:s.height,right:this.right};if(u==="top"||u==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:s.width}}drawBackground(){let{ctx:s,options:{backgroundColor:u},left:o,top:l,width:i,height:_}=this;u&&(s.save(),s.fillStyle=u,s.fillRect(o,l,i,_),s.restore())}getLineWidthForValue(s){let u=this.options.grid;if(!this._isVisible()||!u.display)return 0;let l=this.ticks.findIndex(i=>i.value===s);return l>=0?u.setContext(this.getContext(l)).lineWidth:0}drawGrid(s){let u=this.options.grid,o=this.ctx,l=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(s)),i,_,C=(I,O,N)=>{!N.width||!N.color||(o.save(),o.lineWidth=N.width,o.strokeStyle=N.color,o.setLineDash(N.borderDash||[]),o.lineDashOffset=N.borderDashOffset,o.beginPath(),o.moveTo(I.x,I.y),o.lineTo(O.x,O.y),o.stroke(),o.restore())};if(u.display)for(i=0,_=l.length;i<_;++i){let I=l[i];u.drawOnChartArea&&C({x:I.x1,y:I.y1},{x:I.x2,y:I.y2},I),u.drawTicks&&C({x:I.tx1,y:I.ty1},{x:I.tx2,y:I.ty2},{color:I.tickColor,width:I.tickWidth,borderDash:I.tickBorderDash,borderDashOffset:I.tickBorderDashOffset})}}drawBorder(){let{chart:s,ctx:u,options:{border:o,grid:l}}=this,i=o.setContext(this.getContext()),_=o.display?i.width:0;if(!_)return;let C=l.setContext(this.getContext(0)).lineWidth,I=this._borderValue,O,N,q,ie;this.isHorizontal()?(O=yd(s,this.left,_)-_/2,N=yd(s,this.right,C)+C/2,q=ie=I):(q=yd(s,this.top,_)-_/2,ie=yd(s,this.bottom,C)+C/2,O=N=I),u.save(),u.lineWidth=i.width,u.strokeStyle=i.color,u.beginPath(),u.moveTo(O,q),u.lineTo(N,ie),u.stroke(),u.restore()}drawLabels(s){if(!this.options.ticks.display)return;let o=this.ctx,l=this._computeLabelArea();l&&vg(o,l);let i=this.getLabelItems(s);for(let _ of i){let C=_.options,I=_.font,O=_.label,N=_.textOffset;vd(o,O,0,N,I,C)}l&&xg(o)}drawTitle(){let{ctx:s,options:{position:u,title:o,reverse:l}}=this;if(!o.display)return;let i=Rr(o.font),_=ho(o.padding),C=o.align,I=i.lineHeight/2;u==="bottom"||u==="center"||ln(u)?(I+=_.bottom,Kn(o.text)&&(I+=i.lineHeight*(o.text.length-1))):I+=_.top;let{titleX:O,titleY:N,maxWidth:q,rotation:ie}=Z4(this,I,u,C);vd(s,o.text,0,0,i,{color:o.color,maxWidth:q,rotation:ie,textAlign:Y4(C,u,l),textBaseline:"middle",translation:[O,N]})}draw(s){this._isVisible()&&(this.drawBackground(),this.drawGrid(s),this.drawBorder(),this.drawTitle(),this.drawLabels(s))}_layers(){let s=this.options,u=s.ticks&&s.ticks.z||0,o=qi(s.grid&&s.grid.z,-1),l=qi(s.border&&s.border.z,0);return!this._isVisible()||this.draw!==d.prototype.draw?[{z:u,draw:i=>{this.draw(i)}}]:[{z:o,draw:i=>{this.drawBackground(),this.drawGrid(i),this.drawTitle()}},{z:l,draw:()=>{this.drawBorder()}},{z:u,draw:i=>{this.drawLabels(i)}}]}getMatchingVisibleMetas(s){let u=this.chart.getSortedVisibleDatasetMetas(),o=this.axis+"AxisID",l=[],i,_;for(i=0,_=u.length;i<_;++i){let C=u[i];C[o]===this.id&&(!s||C.type===s)&&l.push(C)}return l}_resolveTickFontOptions(s){let u=this.options.ticks.setContext(this.getContext(s));return Rr(u.font)}_maxDigits(){let s=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/s}},Qm=class{constructor(s,u,o){this.type=s,this.scope=u,this.override=o,this.items=Object.create(null)}isForType(s){return Object.prototype.isPrototypeOf.call(this.type.prototype,s.prototype)}register(s){let u=Object.getPrototypeOf(s),o;K4(u)&&(o=this.register(u));let l=this.items,i=s.id,_=this.scope+"."+i;if(!i)throw new Error("class does not have id: "+s);return i in l||(l[i]=s,X4(s,_,o),this.override&&mr.override(s.id,s.overrides)),_}get(s){return this.items[s]}unregister(s){let u=this.items,o=s.id,l=this.scope;o in u&&delete u[o],l&&o in mr[l]&&(delete mr[l][o],this.override&&delete bd[o])}};function X4(d,s,u){let o=jm(Object.create(null),[u?mr.get(u):{},mr.get(s),d.defaults]);mr.set(s,o),d.defaultRoutes&&Q4(s,d.defaultRoutes),d.descriptors&&mr.describe(s,d.descriptors)}function Q4(d,s){Object.keys(s).forEach(u=>{let o=u.split("."),l=o.pop(),i=[d].concat(o).join("."),_=s[u].split("."),C=_.pop(),I=_.join(".");mr.route(i,l,I,C)})}function K4(d){return"id"in d&&"defaults"in d}var Vw=class{constructor(){this.controllers=new Qm(Sd,"datasets",!0),this.elements=new Qm(ys,"elements"),this.plugins=new Qm(Object,"plugins"),this.scales=new Qm(Xh,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...s){this._each("register",s)}remove(...s){this._each("unregister",s)}addControllers(...s){this._each("register",s,this.controllers)}addElements(...s){this._each("register",s,this.elements)}addPlugins(...s){this._each("register",s,this.plugins)}addScales(...s){this._each("register",s,this.scales)}getController(s){return this._get(s,this.controllers,"controller")}getElement(s){return this._get(s,this.elements,"element")}getPlugin(s){return this._get(s,this.plugins,"plugin")}getScale(s){return this._get(s,this.scales,"scale")}removeControllers(...s){this._each("unregister",s,this.controllers)}removeElements(...s){this._each("unregister",s,this.elements)}removePlugins(...s){this._each("unregister",s,this.plugins)}removeScales(...s){this._each("unregister",s,this.scales)}_each(s,u,o){[...u].forEach(l=>{let i=o||this._getRegistryForType(l);o||i.isForType(l)||i===this.plugins&&l.id?this._exec(s,i,l):Rn(l,_=>{let C=o||this._getRegistryForType(_);this._exec(s,C,_)})})}_exec(s,u,o){let l=Bb(s);Un(o["before"+l],[],o),u[s](o),Un(o["after"+l],[],o)}_getRegistryForType(s){for(let u=0;u<this._typedRegistries.length;u++){let o=this._typedRegistries[u];if(o.isForType(s))return o}return this.plugins}_get(s,u,o){let l=u.get(s);if(l===void 0)throw new Error('"'+s+'" is not a registered '+o+".");return l}},Js=new Vw,jw=class{constructor(){this._init=[]}notify(s,u,o,l){u==="beforeInit"&&(this._init=this._createDescriptors(s,!0),this._notify(this._init,s,"install"));let i=l?this._descriptors(s).filter(l):this._descriptors(s),_=this._notify(i,s,u,o);return u==="afterDestroy"&&(this._notify(i,s,"stop"),this._notify(this._init,s,"uninstall")),_}_notify(s,u,o,l){l=l||{};for(let i of s){let _=i.plugin,C=_[o],I=[u,l,i.options];if(Un(C,I,_)===!1&&l.cancelable)return!1}return!0}invalidate(){bn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(s){if(this._cache)return this._cache;let u=this._cache=this._createDescriptors(s);return this._notifyStateChanges(s),u}_createDescriptors(s,u){let o=s&&s.config,l=qi(o.options&&o.options.plugins,{}),i=J4(o);return l===!1&&!u?[]:tB(s,i,l,u)}_notifyStateChanges(s){let u=this._oldCache||[],o=this._cache,l=(i,_)=>i.filter(C=>!_.some(I=>C.plugin.id===I.plugin.id));this._notify(l(u,o),s,"stop"),this._notify(l(o,u),s,"start")}};function J4(d){let s={},u=[],o=Object.keys(Js.plugins.items);for(let i=0;i<o.length;i++)u.push(Js.getPlugin(o[i]));let l=d.plugins||[];for(let i=0;i<l.length;i++){let _=l[i];u.indexOf(_)===-1&&(u.push(_),s[_.id]=!0)}return{plugins:u,localIds:s}}function eB(d,s){return!s&&d===!1?null:d===!0?{}:d}function tB(d,{plugins:s,localIds:u},o,l){let i=[],_=d.getContext();for(let C of s){let I=C.id,O=eB(o[I],l);O!==null&&i.push({plugin:C,options:iB(d.config,{plugin:C,local:u[I]},O,_)})}return i}function iB(d,{plugin:s,local:u},o,l){let i=d.pluginScopeKeys(s),_=d.getOptionScopes(o,i);return u&&s.defaults&&_.push(s.defaults),d.createResolver(_,l,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Uw(d,s){let u=mr.datasets[d]||{};return((s.datasets||{})[d]||{}).indexAxis||s.indexAxis||u.indexAxis||"x"}function nB(d,s){let u=d;return d==="_index_"?u=s:d==="_value_"&&(u=s==="x"?"y":"x"),u}function rB(d,s){return d===s?"_index_":"_value_"}function DE(d){if(d==="x"||d==="y"||d==="r")return d}function oB(d){if(d==="top"||d==="bottom")return"x";if(d==="left"||d==="right")return"y"}function Hw(d,...s){if(DE(d))return d;for(let u of s){let o=u.axis||oB(u.position)||d.length>1&&DE(d[0].toLowerCase());if(o)return o}throw new Error(`Cannot determine type of '${d}' axis. Please provide 'axis' or 'position' option.`)}function AE(d,s,u){if(u[s+"AxisID"]===d)return{axis:s}}function aB(d,s){if(s.data&&s.data.datasets){let u=s.data.datasets.filter(o=>o.xAxisID===d||o.yAxisID===d);if(u.length)return AE(d,"x",u[0])||AE(d,"y",u[0])}return{}}function sB(d,s){let u=bd[d.type]||{scales:{}},o=s.scales||{},l=Uw(d.type,s),i=Object.create(null);return Object.keys(o).forEach(_=>{let C=o[_];if(!ln(C))return console.error(`Invalid scale configuration for scale: ${_}`);if(C._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${_}`);let I=Hw(_,C,aB(_,d),mr.scales[C.type]),O=rB(I,l),N=u.scales||{};i[_]=Hm(Object.create(null),[{axis:I},C,N[I],N[O]])}),d.data.datasets.forEach(_=>{let C=_.type||d.type,I=_.indexAxis||Uw(C,s),N=(bd[C]||{}).scales||{};Object.keys(N).forEach(q=>{let ie=nB(q,I),de=_[ie+"AxisID"]||ie;i[de]=i[de]||Object.create(null),Hm(i[de],[{axis:ie},o[de],N[q]])})}),Object.keys(i).forEach(_=>{let C=i[_];Hm(C,[mr.scales[C.type],mr.scale])}),i}function bD(d){let s=d.options||(d.options={});s.plugins=qi(s.plugins,{}),s.scales=sB(d,s)}function yD(d){return d=d||{},d.datasets=d.datasets||[],d.labels=d.labels||[],d}function lB(d){return d=d||{},d.data=yD(d.data),bD(d),d}var PE=new Map,vD=new Set;function Qb(d,s){let u=PE.get(d);return u||(u=s(),PE.set(d,u),vD.add(u)),u}var kg=(d,s,u)=>{let o=Wl(s,u);o!==void 0&&d.add(o)},Ww=class{constructor(s){this._config=lB(s),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(s){this._config.type=s}get data(){return this._config.data}set data(s){this._config.data=yD(s)}get options(){return this._config.options}set options(s){this._config.options=s}get plugins(){return this._config.plugins}update(){let s=this._config;this.clearCache(),bD(s)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(s){return Qb(s,()=>[[`datasets.${s}`,""]])}datasetAnimationScopeKeys(s,u){return Qb(`${s}.transition.${u}`,()=>[[`datasets.${s}.transitions.${u}`,`transitions.${u}`],[`datasets.${s}`,""]])}datasetElementScopeKeys(s,u){return Qb(`${s}-${u}`,()=>[[`datasets.${s}.elements.${u}`,`datasets.${s}`,`elements.${u}`,""]])}pluginScopeKeys(s){let u=s.id,o=this.type;return Qb(`${o}-plugin-${u}`,()=>[[`plugins.${u}`,...s.additionalOptionScopes||[]]])}_cachedScopes(s,u){let o=this._scopeCache,l=o.get(s);return(!l||u)&&(l=new Map,o.set(s,l)),l}getOptionScopes(s,u,o){let{options:l,type:i}=this,_=this._cachedScopes(s,o),C=_.get(u);if(C)return C;let I=new Set;u.forEach(N=>{s&&(I.add(s),N.forEach(q=>kg(I,s,q))),N.forEach(q=>kg(I,l,q)),N.forEach(q=>kg(I,bd[i]||{},q)),N.forEach(q=>kg(I,mr,q)),N.forEach(q=>kg(I,Ub,q))});let O=Array.from(I);return O.length===0&&O.push(Object.create(null)),vD.has(u)&&_.set(u,O),O}chartOptionScopes(){let{options:s,type:u}=this;return[s,bd[u]||{},mr.datasets[u]||{},{type:u},mr,Ub]}resolveNamedOptions(s,u,o,l=[""]){let i={$shared:!0},{resolver:_,subPrefixes:C}=OE(this._resolverCache,s,l),I=_;if(dB(_,u)){i.$shared=!1,o=Ul(o)?o():o;let O=this.createResolver(s,o,C);I=Gh(_,o,O)}for(let O of u)i[O]=I[O];return i}createResolver(s,u,o=[""],l){let{resolver:i}=OE(this._resolverCache,s,o);return ln(u)?Gh(i,u,void 0,l):i}};function OE(d,s,u){let o=d.get(s);o||(o=new Map,d.set(s,o));let l=u.join(),i=o.get(l);return i||(i={resolver:Gb(s,u),subPrefixes:u.filter(C=>!C.toLowerCase().includes("hover"))},o.set(l,i)),i}var cB=d=>ln(d)&&Object.getOwnPropertyNames(d).some(s=>Ul(d[s]));function dB(d,s){let{isScriptable:u,isIndexable:o}=gw(d);for(let l of s){let i=u(l),_=o(l),C=(_||i)&&d[l];if(i&&(Ul(C)||cB(C))||_&&Kn(C))return!0}return!1}var hB="4.4.3",uB=["top","bottom","left","right","chartArea"];function RE(d,s){return d==="top"||d==="bottom"||uB.indexOf(d)===-1&&s==="x"}function LE(d,s){return function(u,o){return u[d]===o[d]?u[s]-o[s]:u[d]-o[d]}}function FE(d){let s=d.chart,u=s.options.animation;s.notifyPlugins("afterRender"),Un(u&&u.onComplete,[d],s)}function mB(d){let s=d.chart,u=s.options.animation;Un(u&&u.onProgress,[d],s)}function xD(d){return qb()&&typeof d=="string"?d=document.getElementById(d):d&&d.length&&(d=d[0]),d&&d.canvas&&(d=d.canvas),d}var ny={},zE=d=>{let s=xD(d);return Object.values(ny).filter(u=>u.canvas===s).pop()};function pB(d,s,u){let o=Object.keys(d);for(let l of o){let i=+l;if(i>=s){let _=d[l];delete d[l],(u>0||i>s)&&(d[i+u]=_)}}}function fB(d,s,u,o){return!u||d.type==="mouseout"?null:o?s:d}function Kb(d,s,u){return d.options.clip?d[u]:s[u]}function gB(d,s){let{xScale:u,yScale:o}=d;return u&&o?{left:Kb(u,s,"left"),right:Kb(u,s,"right"),top:Kb(o,s,"top"),bottom:Kb(o,s,"bottom")}:s}var Jm=(()=>{class d{static defaults=mr;static instances=ny;static overrides=bd;static registry=Js;static version=hB;static getChart=zE;static register(...u){Js.add(...u),BE()}static unregister(...u){Js.remove(...u),BE()}constructor(u,o){let l=this.config=new Ww(o),i=xD(u),_=zE(i);if(_)throw new Error("Canvas is already in use. Chart with ID '"+_.id+"' must be destroyed before the canvas with ID '"+_.canvas.id+"' can be reused.");let C=l.createResolver(l.chartOptionScopes(),this.getContext());this.platform=new(l.platform||F4(i)),this.platform.updateConfig(l);let I=this.platform.acquireContext(i,C.aspectRatio),O=I&&I.canvas,N=O&&O.height,q=O&&O.width;if(this.id=LI(),this.ctx=I,this.canvas=O,this.width=q,this.height=N,this._options=C,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new jw,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=qI(ie=>this.update(ie),C.resizeDelay||0),this._dataChanges=[],ny[this.id]=this,!I||!O){console.error("Failed to create chart: can't acquire context from the given item");return}ql.listen(this,"complete",FE),ql.listen(this,"progress",mB),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:u,maintainAspectRatio:o},width:l,height:i,_aspectRatio:_}=this;return bn(u)?o&&_?_:i?l/i:null:u}get data(){return this.config.data}set data(u){this.config.data=u}get options(){return this._options}set options(u){this.config.options=u}get registry(){return Js}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():vw(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return mw(this.canvas,this.ctx),this}stop(){return ql.stop(this),this}resize(u,o){ql.running(this)?this._resizeBeforeDraw={width:u,height:o}:this._resize(u,o)}_resize(u,o){let l=this.options,i=this.canvas,_=l.maintainAspectRatio&&this.aspectRatio,C=this.platform.getMaximumSize(i,u,o,_),I=l.devicePixelRatio||this.platform.getDevicePixelRatio(),O=this.width?"resize":"attach";this.width=C.width,this.height=C.height,this._aspectRatio=this.aspectRatio,vw(this,I,!0)&&(this.notifyPlugins("resize",{size:C}),Un(l.onResize,[this,C],this),this.attached&&this._doResize(O)&&this.render())}ensureScalesHaveIDs(){let o=this.options.scales||{};Rn(o,(l,i)=>{l.id=i})}buildOrUpdateScales(){let u=this.options,o=u.scales,l=this.scales,i=Object.keys(l).reduce((C,I)=>(C[I]=!1,C),{}),_=[];o&&(_=_.concat(Object.keys(o).map(C=>{let I=o[C],O=Hw(C,I),N=O==="r",q=O==="x";return{options:I,dposition:N?"chartArea":q?"bottom":"left",dtype:N?"radialLinear":q?"category":"linear"}}))),Rn(_,C=>{let I=C.options,O=I.id,N=Hw(O,I),q=qi(I.type,C.dtype);(I.position===void 0||RE(I.position,N)!==RE(C.dposition))&&(I.position=C.dposition),i[O]=!0;let ie=null;if(O in l&&l[O].type===q)ie=l[O];else{let de=Js.getScale(q);ie=new de({id:O,type:q,ctx:this.ctx,chart:this}),l[ie.id]=ie}ie.init(I,u)}),Rn(i,(C,I)=>{C||delete l[I]}),Rn(l,C=>{To.configure(this,C,C.options),To.addBox(this,C)})}_updateMetasets(){let u=this._metasets,o=this.data.datasets.length,l=u.length;if(u.sort((i,_)=>i.index-_.index),l>o){for(let i=o;i<l;++i)this._destroyDatasetMeta(i);u.splice(o,l-o)}this._sortedMetasets=u.slice(0).sort(LE("order","index"))}_removeUnreferencedMetasets(){let{_metasets:u,data:{datasets:o}}=this;u.length>o.length&&delete this._stacks,u.forEach((l,i)=>{o.filter(_=>_===l._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){let u=[],o=this.data.datasets,l,i;for(this._removeUnreferencedMetasets(),l=0,i=o.length;l<i;l++){let _=o[l],C=this.getDatasetMeta(l),I=_.type||this.config.type;if(C.type&&C.type!==I&&(this._destroyDatasetMeta(l),C=this.getDatasetMeta(l)),C.type=I,C.indexAxis=_.indexAxis||Uw(I,this.options),C.order=_.order||0,C.index=l,C.label=""+_.label,C.visible=this.isDatasetVisible(l),C.controller)C.controller.updateIndex(l),C.controller.linkScales();else{let O=Js.getController(I),{datasetElementType:N,dataElementType:q}=mr.datasets[I];Object.assign(O,{dataElementType:Js.getElement(q),datasetElementType:N&&Js.getElement(N)}),C.controller=new O(this,l),u.push(C.controller)}}return this._updateMetasets(),u}_resetElements(){Rn(this.data.datasets,(u,o)=>{this.getDatasetMeta(o).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(u){let o=this.config;o.update();let l=this._options=o.createResolver(o.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!l.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:u,cancelable:!0})===!1)return;let _=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let C=0;for(let N=0,q=this.data.datasets.length;N<q;N++){let{controller:ie}=this.getDatasetMeta(N),de=!i&&_.indexOf(ie)===-1;ie.buildOrUpdateElements(de),C=Math.max(+ie.getMaxOverflow(),C)}C=this._minPadding=l.layout.autoPadding?C:0,this._updateLayout(C),i||Rn(_,N=>{N.reset()}),this._updateDatasets(u),this.notifyPlugins("afterUpdate",{mode:u}),this._layers.sort(LE("z","_idx"));let{_active:I,_lastEvent:O}=this;O?this._eventHandler(O,!0):I.length&&this._updateHoverStyles(I,I,!0),this.render()}_updateScales(){Rn(this.scales,u=>{To.removeBox(this,u)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let u=this.options,o=new Set(Object.keys(this._listeners)),l=new Set(u.events);(!ew(o,l)||!!this._responsiveListeners!==u.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:u}=this,o=this._getUniformDataChanges()||[];for(let{method:l,start:i,count:_}of o){let C=l==="_removeElements"?-_:_;pB(u,i,C)}}_getUniformDataChanges(){let u=this._dataChanges;if(!u||!u.length)return;this._dataChanges=[];let o=this.data.datasets.length,l=_=>new Set(u.filter(C=>C[0]===_).map((C,I)=>I+","+C.splice(1).join(","))),i=l(0);for(let _=1;_<o;_++)if(!ew(i,l(_)))return;return Array.from(i).map(_=>_.split(",")).map(_=>({method:_[1],start:+_[2],count:+_[3]}))}_updateLayout(u){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;To.update(this,this.width,this.height,u);let o=this.chartArea,l=o.width<=0||o.height<=0;this._layers=[],Rn(this.boxes,i=>{l&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,_)=>{i._idx=_}),this.notifyPlugins("afterLayout")}_updateDatasets(u){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:u,cancelable:!0})!==!1){for(let o=0,l=this.data.datasets.length;o<l;++o)this.getDatasetMeta(o).controller.configure();for(let o=0,l=this.data.datasets.length;o<l;++o)this._updateDataset(o,Ul(u)?u({datasetIndex:o}):u);this.notifyPlugins("afterDatasetsUpdate",{mode:u})}}_updateDataset(u,o){let l=this.getDatasetMeta(u),i={meta:l,index:u,mode:o,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(l.controller._update(o),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(ql.has(this)?this.attached&&!ql.running(this)&&ql.start(this):(this.draw(),FE({chart:this})))}draw(){let u;if(this._resizeBeforeDraw){let{width:l,height:i}=this._resizeBeforeDraw;this._resize(l,i),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let o=this._layers;for(u=0;u<o.length&&o[u].z<=0;++u)o[u].draw(this.chartArea);for(this._drawDatasets();u<o.length;++u)o[u].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(u){let o=this._sortedMetasets,l=[],i,_;for(i=0,_=o.length;i<_;++i){let C=o[i];(!u||C.visible)&&l.push(C)}return l}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let u=this.getSortedVisibleDatasetMetas();for(let o=u.length-1;o>=0;--o)this._drawDataset(u[o]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(u){let o=this.ctx,l=u._clip,i=!l.disabled,_=gB(u,this.chartArea),C={meta:u,index:u.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",C)!==!1&&(i&&vg(o,{left:l.left===!1?0:_.left-l.left,right:l.right===!1?this.width:_.right+l.right,top:l.top===!1?0:_.top-l.top,bottom:l.bottom===!1?this.height:_.bottom+l.bottom}),u.controller.draw(),i&&xg(o),C.cancelable=!1,this.notifyPlugins("afterDatasetDraw",C))}isPointInArea(u){return Zs(u,this.chartArea,this._minPadding)}getElementsAtEventForMode(u,o,l,i){let _=_4.modes[o];return typeof _=="function"?_(this,u,l,i):[]}getDatasetMeta(u){let o=this.data.datasets[u],l=this._metasets,i=l.filter(_=>_&&_._dataset===o).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:o&&o.order||0,index:u,_dataset:o,_parsed:[],_sorted:!1},l.push(i)),i}getContext(){return this.$context||(this.$context=Gl(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(u){let o=this.data.datasets[u];if(!o)return!1;let l=this.getDatasetMeta(u);return typeof l.hidden=="boolean"?!l.hidden:!o.hidden}setDatasetVisibility(u,o){let l=this.getDatasetMeta(u);l.hidden=!o}toggleDataVisibility(u){this._hiddenIndices[u]=!this._hiddenIndices[u]}getDataVisibility(u){return!this._hiddenIndices[u]}_updateVisibility(u,o,l){let i=l?"show":"hide",_=this.getDatasetMeta(u),C=_.controller._resolveAnimations(void 0,i);Wm(o)?(_.data[o].hidden=!l,this.update()):(this.setDatasetVisibility(u,l),C.update(_,{visible:l}),this.update(I=>I.datasetIndex===u?i:void 0))}hide(u,o){this._updateVisibility(u,o,!1)}show(u,o){this._updateVisibility(u,o,!0)}_destroyDatasetMeta(u){let o=this._metasets[u];o&&o.controller&&o.controller._destroy(),delete this._metasets[u]}_stop(){let u,o;for(this.stop(),ql.remove(this),u=0,o=this.data.datasets.length;u<o;++u)this._destroyDatasetMeta(u)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:u,ctx:o}=this;this._stop(),this.config.clearCache(),u&&(this.unbindEvents(),mw(u,o),this.platform.releaseContext(o),this.canvas=null,this.ctx=null),delete ny[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...u){return this.canvas.toDataURL(...u)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let u=this._listeners,o=this.platform,l=(_,C)=>{o.addEventListener(this,_,C),u[_]=C},i=(_,C,I)=>{_.offsetX=C,_.offsetY=I,this._eventHandler(_)};Rn(this.options.events,_=>l(_,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let u=this._responsiveListeners,o=this.platform,l=(O,N)=>{o.addEventListener(this,O,N),u[O]=N},i=(O,N)=>{u[O]&&(o.removeEventListener(this,O,N),delete u[O])},_=(O,N)=>{this.canvas&&this.resize(O,N)},C,I=()=>{i("attach",I),this.attached=!0,this.resize(),l("resize",_),l("detach",C)};C=()=>{this.attached=!1,i("resize",_),this._stop(),this._resize(0,0),l("attach",I)},o.isAttached(this.canvas)?I():C()}unbindEvents(){Rn(this._listeners,(u,o)=>{this.platform.removeEventListener(this,o,u)}),this._listeners={},Rn(this._responsiveListeners,(u,o)=>{this.platform.removeEventListener(this,o,u)}),this._responsiveListeners=void 0}updateHoverStyle(u,o,l){let i=l?"set":"remove",_,C,I,O;for(o==="dataset"&&(_=this.getDatasetMeta(u[0].datasetIndex),_.controller["_"+i+"DatasetHoverStyle"]()),I=0,O=u.length;I<O;++I){C=u[I];let N=C&&this.getDatasetMeta(C.datasetIndex).controller;N&&N[i+"HoverStyle"](C.element,C.datasetIndex,C.index)}}getActiveElements(){return this._active||[]}setActiveElements(u){let o=this._active||[],l=u.map(({datasetIndex:_,index:C})=>{let I=this.getDatasetMeta(_);if(!I)throw new Error("No dataset found at index "+_);return{datasetIndex:_,element:I.data[C],index:C}});!bg(l,o)&&(this._active=l,this._lastEvent=null,this._updateHoverStyles(l,o))}notifyPlugins(u,o,l){return this._plugins.notify(this,u,o,l)}isPluginEnabled(u){return this._plugins._cache.filter(o=>o.plugin.id===u).length===1}_updateHoverStyles(u,o,l){let i=this.options.hover,_=(O,N)=>O.filter(q=>!N.some(ie=>q.datasetIndex===ie.datasetIndex&&q.index===ie.index)),C=_(o,u),I=l?u:_(u,o);C.length&&this.updateHoverStyle(C,i.mode,!1),I.length&&i.mode&&this.updateHoverStyle(I,i.mode,!0)}_eventHandler(u,o){let l={event:u,replay:o,cancelable:!0,inChartArea:this.isPointInArea(u)},i=C=>(C.options.events||this.options.events).includes(u.native.type);if(this.notifyPlugins("beforeEvent",l,i)===!1)return;let _=this._handleEvent(u,o,l.inChartArea);return l.cancelable=!1,this.notifyPlugins("afterEvent",l,i),(_||l.changed)&&this.render(),this}_handleEvent(u,o,l){let{_active:i=[],options:_}=this,C=o,I=this._getActiveElements(u,i,l,C),O=BI(u),N=fB(u,this._lastEvent,l,O);l&&(this._lastEvent=null,Un(_.onHover,[u,I,this],this),O&&Un(_.onClick,[u,I,this],this));let q=!bg(I,i);return(q||o)&&(this._active=I,this._updateHoverStyles(I,i,o)),this._lastEvent=N,q}_getActiveElements(u,o,l,i){if(u.type==="mouseout")return[];if(!l)return o;let _=this.options.hover;return this.getElementsAtEventForMode(u,_.mode,_,i)}}return d})();function BE(){return Rn(Jm.instances,d=>d._plugins.invalidate())}function _B(d,s,u){let{startAngle:o,pixelMargin:l,x:i,y:_,outerRadius:C,innerRadius:I}=s,O=l/C;d.beginPath(),d.arc(i,_,C,o-O,u+O),I>l?(O=l/I,d.arc(i,_,I,u+O,o-O,!0)):d.arc(i,_,l,u+xr,o-xr),d.closePath(),d.clip()}function bB(d){return Wb(d,["outerStart","outerEnd","innerStart","innerEnd"])}function yB(d,s,u,o){let l=bB(d.options.borderRadius),i=(u-s)/2,_=Math.min(i,o*s/2),C=I=>{let O=(u-Math.min(i,I))*o/2;return Ur(I,0,Math.min(i,O))};return{outerStart:C(l.outerStart),outerEnd:C(l.outerEnd),innerStart:Ur(l.innerStart,0,_),innerEnd:Ur(l.innerEnd,0,_)}}function Xm(d,s,u,o){return{x:u+d*Math.cos(s),y:o+d*Math.sin(s)}}function sy(d,s,u,o,l,i){let{x:_,y:C,startAngle:I,pixelMargin:O,innerRadius:N}=s,q=Math.max(s.outerRadius+o+u-O,0),ie=N>0?N+o+u+O:0,de=0,xe=l-I;if(o){let cn=N>0?N-o:0,en=q>0?q-o:0,zn=(cn+en)/2,Lr=zn!==0?xe*zn/(zn+o):xe;de=(xe-Lr)/2}let ke=Math.max(.001,xe*q-u/Jn)/q,Ae=(xe-ke)/2,Xe=I+Ae+de,qe=l-Ae-de,{outerStart:ht,outerEnd:Tt,innerStart:vt,innerEnd:Et}=yB(s,ie,q,qe-Xe),Ut=q-ht,xt=q-Tt,Yt=Xe+ht/Ut,zt=qe-Tt/xt,Si=ie+vt,Ui=ie+Et,rr=Xe+vt/Si,bi=qe-Et/Ui;if(d.beginPath(),i){let cn=(Yt+zt)/2;if(d.arc(_,C,q,Yt,cn),d.arc(_,C,q,cn,zt),Tt>0){let Hn=Xm(xt,zt,_,C);d.arc(Hn.x,Hn.y,Tt,zt,qe+xr)}let en=Xm(Ui,qe,_,C);if(d.lineTo(en.x,en.y),Et>0){let Hn=Xm(Ui,bi,_,C);d.arc(Hn.x,Hn.y,Et,qe+xr,bi+Math.PI)}let zn=(qe-Et/ie+(Xe+vt/ie))/2;if(d.arc(_,C,ie,qe-Et/ie,zn,!0),d.arc(_,C,ie,zn,Xe+vt/ie,!0),vt>0){let Hn=Xm(Si,rr,_,C);d.arc(Hn.x,Hn.y,vt,rr+Math.PI,Xe-xr)}let Lr=Xm(Ut,Xe,_,C);if(d.lineTo(Lr.x,Lr.y),ht>0){let Hn=Xm(Ut,Yt,_,C);d.arc(Hn.x,Hn.y,ht,Xe-xr,Yt)}}else{d.moveTo(_,C);let cn=Math.cos(Yt)*q+_,en=Math.sin(Yt)*q+C;d.lineTo(cn,en);let zn=Math.cos(zt)*q+_,Lr=Math.sin(zt)*q+C;d.lineTo(zn,Lr)}d.closePath()}function vB(d,s,u,o,l){let{fullCircles:i,startAngle:_,circumference:C}=s,I=s.endAngle;if(i){sy(d,s,u,o,I,l);for(let O=0;O<i;++O)d.fill();isNaN(C)||(I=_+(C%er||er))}return sy(d,s,u,o,I,l),d.fill(),I}function xB(d,s,u,o,l){let{fullCircles:i,startAngle:_,circumference:C,options:I}=s,{borderWidth:O,borderJoinStyle:N,borderDash:q,borderDashOffset:ie}=I,de=I.borderAlign==="inner";if(!O)return;d.setLineDash(q||[]),d.lineDashOffset=ie,de?(d.lineWidth=O*2,d.lineJoin=N||"round"):(d.lineWidth=O,d.lineJoin=N||"bevel");let xe=s.endAngle;if(i){sy(d,s,u,o,xe,l);for(let ke=0;ke<i;++ke)d.stroke();isNaN(C)||(xe=_+(C%er||er))}de&&_B(d,s,xe),i||(sy(d,s,u,o,xe,l),d.stroke())}var Gw=class extends ys{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:s=>s!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(s){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,s&&Object.assign(this,s)}inRange(s,u,o){let l=this.getProps(["x","y"],o),{angle:i,distance:_}=rw(l,{x:s,y:u}),{startAngle:C,endAngle:I,innerRadius:O,outerRadius:N,circumference:q}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],o),ie=(this.options.spacing+this.options.borderWidth)/2,xe=qi(q,I-C)>=er||qm(i,C,I),ke=Qs(_,O+ie,N+ie);return xe&&ke}getCenterPoint(s){let{x:u,y:o,startAngle:l,endAngle:i,innerRadius:_,outerRadius:C}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],s),{offset:I,spacing:O}=this.options,N=(l+i)/2,q=(_+C+O+I)/2;return{x:u+Math.cos(N)*q,y:o+Math.sin(N)*q}}tooltipPosition(s){return this.getCenterPoint(s)}draw(s){let{options:u,circumference:o}=this,l=(u.offset||0)/4,i=(u.spacing||0)/2,_=u.circular;if(this.pixelMargin=u.borderAlign==="inner"?.33:0,this.fullCircles=o>er?Math.floor(o/er):0,o===0||this.innerRadius<0||this.outerRadius<0)return;s.save();let C=(this.startAngle+this.endAngle)/2;s.translate(Math.cos(C)*l,Math.sin(C)*l);let I=1-Math.sin(Math.min(Jn,o||0)),O=l*I;s.fillStyle=u.backgroundColor,s.strokeStyle=u.borderColor,vB(s,this,O,i,_),xB(s,this,O,i,_),s.restore()}};function wD(d,s,u=s){d.lineCap=qi(u.borderCapStyle,s.borderCapStyle),d.setLineDash(qi(u.borderDash,s.borderDash)),d.lineDashOffset=qi(u.borderDashOffset,s.borderDashOffset),d.lineJoin=qi(u.borderJoinStyle,s.borderJoinStyle),d.lineWidth=qi(u.borderWidth,s.borderWidth),d.strokeStyle=qi(u.borderColor,s.borderColor)}function wB(d,s,u){d.lineTo(u.x,u.y)}function CB(d){return d.stepped?XI:d.tension||d.cubicInterpolationMode==="monotone"?QI:wB}function CD(d,s,u={}){let o=d.length,{start:l=0,end:i=o-1}=u,{start:_,end:C}=s,I=Math.max(l,_),O=Math.min(i,C),N=l<_&&i<_||l>C&&i>C;return{count:o,start:I,loop:s.loop,ilen:O<I&&!N?o+O-I:O-I}}function SB(d,s,u,o){let{points:l,options:i}=s,{count:_,start:C,loop:I,ilen:O}=CD(l,u,o),N=CB(i),{move:q=!0,reverse:ie}=o||{},de,xe,ke;for(de=0;de<=O;++de)xe=l[(C+(ie?O-de:de))%_],!xe.skip&&(q?(d.moveTo(xe.x,xe.y),q=!1):N(d,ke,xe,ie,i.stepped),ke=xe);return I&&(xe=l[(C+(ie?O:0))%_],N(d,ke,xe,ie,i.stepped)),!!I}function MB(d,s,u,o){let l=s.points,{count:i,start:_,ilen:C}=CD(l,u,o),{move:I=!0,reverse:O}=o||{},N=0,q=0,ie,de,xe,ke,Ae,Xe,qe=Tt=>(_+(O?C-Tt:Tt))%i,ht=()=>{ke!==Ae&&(d.lineTo(N,Ae),d.lineTo(N,ke),d.lineTo(N,Xe))};for(I&&(de=l[qe(0)],d.moveTo(de.x,de.y)),ie=0;ie<=C;++ie){if(de=l[qe(ie)],de.skip)continue;let Tt=de.x,vt=de.y,Et=Tt|0;Et===xe?(vt<ke?ke=vt:vt>Ae&&(Ae=vt),N=(q*N+Tt)/++q):(ht(),d.lineTo(Tt,vt),xe=Et,q=0,ke=Ae=vt),Xe=vt}ht()}function qw(d){let s=d.options,u=s.borderDash&&s.borderDash.length;return!d._decimated&&!d._loop&&!s.tension&&s.cubicInterpolationMode!=="monotone"&&!s.stepped&&!u?MB:SB}function kB(d){return d.stepped?aE:d.tension||d.cubicInterpolationMode==="monotone"?sE:_d}function TB(d,s,u,o){let l=s._path;l||(l=s._path=new Path2D,s.path(l,u,o)&&l.closePath()),wD(d,s.options),d.stroke(l)}function IB(d,s,u,o){let{segments:l,options:i}=s,_=qw(s);for(let C of l)wD(d,i,C.style),d.beginPath(),_(d,s,C,{start:u,end:u+o-1})&&d.closePath(),d.stroke()}var EB=typeof Path2D=="function";function DB(d,s,u,o){EB&&!s.options.segment?TB(d,s,u,o):IB(d,s,u,o)}var dy=(()=>{class d extends ys{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:u=>u!=="borderDash"&&u!=="fill"};constructor(u){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,u&&Object.assign(this,u)}updateControlPoints(u,o){let l=this.options;if((l.tension||l.cubicInterpolationMode==="monotone")&&!l.stepped&&!this._pointsUpdated){let i=l.spanGaps?this._loop:this._fullLoop;nE(this._points,l,u,i,o),this._pointsUpdated=!0}}set points(u){this._points=u,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=cE(this,this.options.segment))}first(){let u=this.segments,o=this.points;return u.length&&o[u[0].start]}last(){let u=this.segments,o=this.points,l=u.length;return l&&o[u[l-1].end]}interpolate(u,o){let l=this.options,i=u[o],_=this.points,C=Mw(this,{property:o,start:i,end:i});if(!C.length)return;let I=[],O=kB(l),N,q;for(N=0,q=C.length;N<q;++N){let{start:ie,end:de}=C[N],xe=_[ie],ke=_[de];if(xe===ke){I.push(xe);continue}let Ae=Math.abs((i-xe[o])/(ke[o]-xe[o])),Xe=O(xe,ke,Ae,l.stepped);Xe[o]=u[o],I.push(Xe)}return I.length===1?I[0]:I}pathSegment(u,o,l){return qw(this)(u,this,o,l)}path(u,o,l){let i=this.segments,_=qw(this),C=this._loop;o=o||0,l=l||this.points.length-o;for(let I of i)C&=_(u,this,I,{start:o,end:o+l-1});return!!C}draw(u,o,l,i){let _=this.options||{};(this.points||[]).length&&_.borderWidth&&(u.save(),DB(u,this,l,i),u.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return d})();function NE(d,s,u,o){let l=d.options,{[u]:i}=d.getProps([u],o);return Math.abs(s-i)<l.radius+l.hitRadius}var AB=(()=>{class d extends ys{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(u){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,u&&Object.assign(this,u)}inRange(u,o,l){let i=this.options,{x:_,y:C}=this.getProps(["x","y"],l);return Math.pow(u-_,2)+Math.pow(o-C,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(u,o){return NE(this,u,"x",o)}inYRange(u,o){return NE(this,u,"y",o)}getCenterPoint(u){let{x:o,y:l}=this.getProps(["x","y"],u);return{x:o,y:l}}size(u){u=u||this.options||{};let o=u.radius||0;o=Math.max(o,o&&u.hoverRadius||0);let l=o&&u.borderWidth||0;return(o+l)*2}draw(u,o){let l=this.options;this.skip||l.radius<.1||!Zs(this,o,this.size(l)/2)||(u.strokeStyle=l.borderColor,u.lineWidth=l.borderWidth,u.fillStyle=l.backgroundColor,Hb(u,l,this.x,this.y))}getRange(){let u=this.options||{};return u.radius+u.hitRadius}}return d})();function SD(d,s){let{x:u,y:o,base:l,width:i,height:_}=d.getProps(["x","y","base","width","height"],s),C,I,O,N,q;return d.horizontal?(q=_/2,C=Math.min(u,l),I=Math.max(u,l),O=o-q,N=o+q):(q=i/2,C=u-q,I=u+q,O=Math.min(o,l),N=Math.max(o,l)),{left:C,top:O,right:I,bottom:N}}function Cd(d,s,u,o){return d?0:Ur(s,u,o)}function PB(d,s,u){let o=d.options.borderWidth,l=d.borderSkipped,i=fw(o);return{t:Cd(l.top,i.top,0,u),r:Cd(l.right,i.right,0,s),b:Cd(l.bottom,i.bottom,0,u),l:Cd(l.left,i.left,0,s)}}function OB(d,s,u){let{enableBorderRadius:o}=d.getProps(["enableBorderRadius"]),l=d.options.borderRadius,i=xd(l),_=Math.min(s,u),C=d.borderSkipped,I=o||ln(l);return{topLeft:Cd(!I||C.top||C.left,i.topLeft,0,_),topRight:Cd(!I||C.top||C.right,i.topRight,0,_),bottomLeft:Cd(!I||C.bottom||C.left,i.bottomLeft,0,_),bottomRight:Cd(!I||C.bottom||C.right,i.bottomRight,0,_)}}function RB(d){let s=SD(d),u=s.right-s.left,o=s.bottom-s.top,l=PB(d,u/2,o/2),i=OB(d,u/2,o/2);return{outer:{x:s.left,y:s.top,w:u,h:o,radius:i},inner:{x:s.left+l.l,y:s.top+l.t,w:u-l.l-l.r,h:o-l.t-l.b,radius:{topLeft:Math.max(0,i.topLeft-Math.max(l.t,l.l)),topRight:Math.max(0,i.topRight-Math.max(l.t,l.r)),bottomLeft:Math.max(0,i.bottomLeft-Math.max(l.b,l.l)),bottomRight:Math.max(0,i.bottomRight-Math.max(l.b,l.r))}}}}function Pw(d,s,u,o){let l=s===null,i=u===null,C=d&&!(l&&i)&&SD(d,o);return C&&(l||Qs(s,C.left,C.right))&&(i||Qs(u,C.top,C.bottom))}function LB(d){return d.topLeft||d.topRight||d.bottomLeft||d.bottomRight}function FB(d,s){d.rect(s.x,s.y,s.w,s.h)}function Ow(d,s,u={}){let o=d.x!==u.x?-s:0,l=d.y!==u.y?-s:0,i=(d.x+d.w!==u.x+u.w?s:0)-o,_=(d.y+d.h!==u.y+u.h?s:0)-l;return{x:d.x+o,y:d.y+l,w:d.w+i,h:d.h+_,radius:d.radius}}var $w=class extends ys{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(s){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,s&&Object.assign(this,s)}draw(s){let{inflateAmount:u,options:{borderColor:o,backgroundColor:l}}=this,{inner:i,outer:_}=RB(this),C=LB(_.radius)?Ym:FB;s.save(),(_.w!==i.w||_.h!==i.h)&&(s.beginPath(),C(s,Ow(_,u,i)),s.clip(),C(s,Ow(i,-u,_)),s.fillStyle=o,s.fill("evenodd")),s.beginPath(),C(s,Ow(i,u)),s.fillStyle=l,s.fill(),s.restore()}inRange(s,u,o){return Pw(this,s,u,o)}inXRange(s,u){return Pw(this,s,null,u)}inYRange(s,u){return Pw(this,null,s,u)}getCenterPoint(s){let{x:u,y:o,base:l,horizontal:i}=this.getProps(["x","y","base","horizontal"],s);return{x:i?(u+l)/2:u,y:i?o:(o+l)/2}}getRange(s){return s==="x"?this.width/2:this.height/2}},zB=Object.freeze({__proto__:null,ArcElement:Gw,BarElement:$w,LineElement:dy,PointElement:AB}),Yw=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],VE=Yw.map(d=>d.replace("rgb(","rgba(").replace(")",", 0.5)"));function MD(d){return Yw[d%Yw.length]}function kD(d){return VE[d%VE.length]}function BB(d,s){return d.borderColor=MD(s),d.backgroundColor=kD(s),++s}function NB(d,s){return d.backgroundColor=d.data.map(()=>MD(s++)),s}function VB(d,s){return d.backgroundColor=d.data.map(()=>kD(s++)),s}function jB(d){let s=0;return(u,o)=>{let l=d.getDatasetMeta(o).controller;l instanceof iC?s=NB(u,s):l instanceof mD?s=VB(u,s):l&&(s=BB(u,s))}}function jE(d){let s;for(s in d)if(d[s].borderColor||d[s].backgroundColor)return!0;return!1}function UB(d){return d&&(d.borderColor||d.backgroundColor)}var HB={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(d,s,u){if(!u.enabled)return;let{data:{datasets:o},options:l}=d.config,{elements:i}=l;if(!u.forceOverride&&(jE(o)||UB(l)||i&&jE(i)))return;let _=jB(d);o.forEach(_)}};function WB(d,s,u,o,l){let i=l.samples||o;if(i>=u)return d.slice(s,s+u);let _=[],C=(u-2)/(i-2),I=0,O=s+u-1,N=s,q,ie,de,xe,ke;for(_[I++]=d[N],q=0;q<i-2;q++){let Ae=0,Xe=0,qe,ht=Math.floor((q+1)*C)+1+s,Tt=Math.min(Math.floor((q+2)*C)+1,u)+s,vt=Tt-ht;for(qe=ht;qe<Tt;qe++)Ae+=d[qe].x,Xe+=d[qe].y;Ae/=vt,Xe/=vt;let Et=Math.floor(q*C)+1+s,Ut=Math.min(Math.floor((q+1)*C)+1,u)+s,{x:xt,y:Yt}=d[N];for(de=xe=-1,qe=Et;qe<Ut;qe++)xe=.5*Math.abs((xt-Ae)*(d[qe].y-Yt)-(xt-d[qe].x)*(Xe-Yt)),xe>de&&(de=xe,ie=d[qe],ke=qe);_[I++]=ie,N=ke}return _[I++]=d[O],_}function GB(d,s,u,o){let l=0,i=0,_,C,I,O,N,q,ie,de,xe,ke,Ae=[],Xe=s+u-1,qe=d[s].x,Tt=d[Xe].x-qe;for(_=s;_<s+u;++_){C=d[_],I=(C.x-qe)/Tt*o,O=C.y;let vt=I|0;if(vt===N)O<xe?(xe=O,q=_):O>ke&&(ke=O,ie=_),l=(i*l+C.x)/++i;else{let Et=_-1;if(!bn(q)&&!bn(ie)){let Ut=Math.min(q,ie),xt=Math.max(q,ie);Ut!==de&&Ut!==Et&&Ae.push(Pa($i({},d[Ut]),{x:l})),xt!==de&&xt!==Et&&Ae.push(Pa($i({},d[xt]),{x:l}))}_>0&&Et!==de&&Ae.push(d[Et]),Ae.push(C),N=vt,i=0,xe=ke=O,q=ie=de=_}}return Ae}function TD(d){if(d._decimated){let s=d._data;delete d._decimated,delete d._data,Object.defineProperty(d,"data",{configurable:!0,enumerable:!0,writable:!0,value:s})}}function UE(d){d.data.datasets.forEach(s=>{TD(s)})}function qB(d,s){let u=s.length,o=0,l,{iScale:i}=d,{min:_,max:C,minDefined:I,maxDefined:O}=i.getUserBounds();return I&&(o=Ur(Ys(s,i.axis,_).lo,0,u-1)),O?l=Ur(Ys(s,i.axis,C).hi+1,o,u)-o:l=u-o,{start:o,count:l}}var $B={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(d,s,u)=>{if(!u.enabled){UE(d);return}let o=d.width;d.data.datasets.forEach((l,i)=>{let{_data:_,indexAxis:C}=l,I=d.getDatasetMeta(i),O=_||l.data;if(Zm([C,d.options.indexAxis])==="y"||!I.controller.supportsDecimation)return;let N=d.scales[I.xAxisID];if(N.type!=="linear"&&N.type!=="time"||d.options.parsing)return;let{start:q,count:ie}=qB(I,O),de=u.threshold||4*o;if(ie<=de){TD(l);return}bn(_)&&(l._data=O,delete l.data,Object.defineProperty(l,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(ke){this._data=ke}}));let xe;switch(u.algorithm){case"lttb":xe=WB(O,q,ie,o,u);break;case"min-max":xe=GB(O,q,ie,o);break;default:throw new Error(`Unsupported decimation algorithm '${u.algorithm}'`)}l._decimated=xe})},destroy(d){UE(d)}};function YB(d,s,u){let o=d.segments,l=d.points,i=s.points,_=[];for(let C of o){let{start:I,end:O}=C;O=nC(I,O,l);let N=Zw(u,l[I],l[O],C.loop);if(!s.segments){_.push({source:C,target:N,start:l[I],end:l[O]});continue}let q=Mw(s,N);for(let ie of q){let de=Zw(u,i[ie.start],i[ie.end],ie.loop),xe=Sw(C,l,de);for(let ke of xe)_.push({source:ke,target:ie,start:{[u]:HE(N,de,"start",Math.max)},end:{[u]:HE(N,de,"end",Math.min)}})}}return _}function Zw(d,s,u,o){if(o)return;let l=s[d],i=u[d];return d==="angle"&&(l=Qo(l),i=Qo(i)),{property:d,start:l,end:i}}function ZB(d,s){let{x:u=null,y:o=null}=d||{},l=s.points,i=[];return s.segments.forEach(({start:_,end:C})=>{C=nC(_,C,l);let I=l[_],O=l[C];o!==null?(i.push({x:I.x,y:o}),i.push({x:O.x,y:o})):u!==null&&(i.push({x:u,y:I.y}),i.push({x:u,y:O.y}))}),i}function nC(d,s,u){for(;s>d;s--){let o=u[s];if(!isNaN(o.x)&&!isNaN(o.y))break}return s}function HE(d,s,u,o){return d&&s?o(d[u],s[u]):d?d[u]:s?s[u]:0}function ID(d,s){let u=[],o=!1;return Kn(d)?(o=!0,u=d):u=ZB(d,s),u.length?new dy({points:u,options:{tension:0},_loop:o,_fullLoop:o}):null}function WE(d){return d&&d.fill!==!1}function XB(d,s,u){let l=d[s].fill,i=[s],_;if(!u)return l;for(;l!==!1&&i.indexOf(l)===-1;){if(!ur(l))return l;if(_=d[l],!_)return!1;if(_.visible)return l;i.push(l),l=_.fill}return!1}function QB(d,s,u){let o=tN(d);if(ln(o))return isNaN(o.value)?!1:o;let l=parseFloat(o);return ur(l)&&Math.floor(l)===l?KB(o[0],s,l,u):["origin","start","end","stack","shape"].indexOf(o)>=0&&o}function KB(d,s,u,o){return(d==="-"||d==="+")&&(u=s+u),u===s||u<0||u>=o?!1:u}function JB(d,s){let u=null;return d==="start"?u=s.bottom:d==="end"?u=s.top:ln(d)?u=s.getPixelForValue(d.value):s.getBasePixel&&(u=s.getBasePixel()),u}function eN(d,s,u){let o;return d==="start"?o=u:d==="end"?o=s.options.reverse?s.min:s.max:ln(d)?o=d.value:o=s.getBaseValue(),o}function tN(d){let s=d.options,u=s.fill,o=qi(u&&u.target,u);return o===void 0&&(o=!!s.backgroundColor),o===!1||o===null?!1:o===!0?"origin":o}function iN(d){let{scale:s,index:u,line:o}=d,l=[],i=o.segments,_=o.points,C=nN(s,u);C.push(ID({x:null,y:s.bottom},o));for(let I=0;I<i.length;I++){let O=i[I];for(let N=O.start;N<=O.end;N++)rN(l,_[N],C)}return new dy({points:l,options:{}})}function nN(d,s){let u=[],o=d.getMatchingVisibleMetas("line");for(let l=0;l<o.length;l++){let i=o[l];if(i.index===s)break;i.hidden||u.unshift(i.dataset)}return u}function rN(d,s,u){let o=[];for(let l=0;l<u.length;l++){let i=u[l],{first:_,last:C,point:I}=oN(i,s,"x");if(!(!I||_&&C)){if(_)o.unshift(I);else if(d.push(I),!C)break}}d.push(...o)}function oN(d,s,u){let o=d.interpolate(s,u);if(!o)return{};let l=o[u],i=d.segments,_=d.points,C=!1,I=!1;for(let O=0;O<i.length;O++){let N=i[O],q=_[N.start][u],ie=_[N.end][u];if(Qs(l,q,ie)){C=l===q,I=l===ie;break}}return{first:C,last:I,point:o}}var ly=class{constructor(s){this.x=s.x,this.y=s.y,this.radius=s.radius}pathSegment(s,u,o){let{x:l,y:i,radius:_}=this;return u=u||{start:0,end:er},s.arc(l,i,_,u.end,u.start,!0),!o.bounds}interpolate(s){let{x:u,y:o,radius:l}=this,i=s.angle;return{x:u+Math.cos(i)*l,y:o+Math.sin(i)*l,angle:i}}};function aN(d){let{chart:s,fill:u,line:o}=d;if(ur(u))return sN(s,u);if(u==="stack")return iN(d);if(u==="shape")return!0;let l=lN(d);return l instanceof ly?l:ID(l,o)}function sN(d,s){let u=d.getDatasetMeta(s);return u&&d.isDatasetVisible(s)?u.dataset:null}function lN(d){return(d.scale||{}).getPointPositionForValue?dN(d):cN(d)}function cN(d){let{scale:s={},fill:u}=d,o=JB(u,s);if(ur(o)){let l=s.isHorizontal();return{x:l?o:null,y:l?null:o}}return null}function dN(d){let{scale:s,fill:u}=d,o=s.options,l=s.getLabels().length,i=o.reverse?s.max:s.min,_=eN(u,s,i),C=[];if(o.grid.circular){let I=s.getPointPositionForValue(0,i);return new ly({x:I.x,y:I.y,radius:s.getDistanceFromCenterForValue(_)})}for(let I=0;I<l;++I)C.push(s.getPointPositionForValue(I,_));return C}function Rw(d,s,u){let o=aN(s),{line:l,scale:i,axis:_}=s,C=l.options,I=C.fill,O=C.backgroundColor,{above:N=O,below:q=O}=I||{};o&&l.points.length&&(vg(d,u),hN(d,{line:l,target:o,above:N,below:q,area:u,scale:i,axis:_}),xg(d))}function hN(d,s){let{line:u,target:o,above:l,below:i,area:_,scale:C}=s,I=u._loop?"angle":s.axis;d.save(),I==="x"&&i!==l&&(GE(d,o,_.top),qE(d,{line:u,target:o,color:l,scale:C,property:I}),d.restore(),d.save(),GE(d,o,_.bottom)),qE(d,{line:u,target:o,color:i,scale:C,property:I}),d.restore()}function GE(d,s,u){let{segments:o,points:l}=s,i=!0,_=!1;d.beginPath();for(let C of o){let{start:I,end:O}=C,N=l[I],q=l[nC(I,O,l)];i?(d.moveTo(N.x,N.y),i=!1):(d.lineTo(N.x,u),d.lineTo(N.x,N.y)),_=!!s.pathSegment(d,C,{move:_}),_?d.closePath():d.lineTo(q.x,u)}d.lineTo(s.first().x,u),d.closePath(),d.clip()}function qE(d,s){let{line:u,target:o,property:l,color:i,scale:_}=s,C=YB(u,o,l);for(let{source:I,target:O,start:N,end:q}of C){let{style:{backgroundColor:ie=i}={}}=I,de=o!==!0;d.save(),d.fillStyle=ie,uN(d,_,de&&Zw(l,N,q)),d.beginPath();let xe=!!u.pathSegment(d,I),ke;if(de){xe?d.closePath():$E(d,o,q,l);let Ae=!!o.pathSegment(d,O,{move:xe,reverse:!0});ke=xe&&Ae,ke||$E(d,o,N,l)}d.closePath(),d.fill(ke?"evenodd":"nonzero"),d.restore()}}function uN(d,s,u){let{top:o,bottom:l}=s.chart.chartArea,{property:i,start:_,end:C}=u||{};i==="x"&&(d.beginPath(),d.rect(_,o,C-_,l-o),d.clip())}function $E(d,s,u,o){let l=s.interpolate(u,o);l&&d.lineTo(l.x,l.y)}var mN={id:"filler",afterDatasetsUpdate(d,s,u){let o=(d.data.datasets||[]).length,l=[],i,_,C,I;for(_=0;_<o;++_)i=d.getDatasetMeta(_),C=i.dataset,I=null,C&&C.options&&C instanceof dy&&(I={visible:d.isDatasetVisible(_),index:_,fill:QB(C,_,o),chart:d,axis:i.controller.options.indexAxis,scale:i.vScale,line:C}),i.$filler=I,l.push(I);for(_=0;_<o;++_)I=l[_],!(!I||I.fill===!1)&&(I.fill=XB(l,_,u.propagate))},beforeDraw(d,s,u){let o=u.drawTime==="beforeDraw",l=d.getSortedVisibleDatasetMetas(),i=d.chartArea;for(let _=l.length-1;_>=0;--_){let C=l[_].$filler;C&&(C.line.updateControlPoints(i,C.axis),o&&C.fill&&Rw(d.ctx,C,i))}},beforeDatasetsDraw(d,s,u){if(u.drawTime!=="beforeDatasetsDraw")return;let o=d.getSortedVisibleDatasetMetas();for(let l=o.length-1;l>=0;--l){let i=o[l].$filler;WE(i)&&Rw(d.ctx,i,d.chartArea)}},beforeDatasetDraw(d,s,u){let o=s.meta.$filler;!WE(o)||u.drawTime!=="beforeDatasetDraw"||Rw(d.ctx,o,d.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}},YE=(d,s)=>{let{boxHeight:u=s,boxWidth:o=s}=d;return d.usePointStyle&&(u=Math.min(u,s),o=d.pointStyleWidth||Math.min(o,s)),{boxWidth:o,boxHeight:u,itemHeight:Math.max(s,u)}},pN=(d,s)=>d!==null&&s!==null&&d.datasetIndex===s.datasetIndex&&d.index===s.index,cy=class extends ys{constructor(s){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,u,o){this.maxWidth=s,this.maxHeight=u,this._margins=o,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let s=this.options.labels||{},u=Un(s.generateLabels,[this.chart],this)||[];s.filter&&(u=u.filter(o=>s.filter(o,this.chart.data))),s.sort&&(u=u.sort((o,l)=>s.sort(o,l,this.chart.data))),this.options.reverse&&u.reverse(),this.legendItems=u}fit(){let{options:s,ctx:u}=this;if(!s.display){this.width=this.height=0;return}let o=s.labels,l=Rr(o.font),i=l.size,_=this._computeTitleHeight(),{boxWidth:C,itemHeight:I}=YE(o,i),O,N;u.font=l.string,this.isHorizontal()?(O=this.maxWidth,N=this._fitRows(_,i,C,I)+10):(N=this.maxHeight,O=this._fitCols(_,l,C,I)+10),this.width=Math.min(O,s.maxWidth||this.maxWidth),this.height=Math.min(N,s.maxHeight||this.maxHeight)}_fitRows(s,u,o,l){let{ctx:i,maxWidth:_,options:{labels:{padding:C}}}=this,I=this.legendHitBoxes=[],O=this.lineWidths=[0],N=l+C,q=s;i.textAlign="left",i.textBaseline="middle";let ie=-1,de=-N;return this.legendItems.forEach((xe,ke)=>{let Ae=o+u/2+i.measureText(xe.text).width;(ke===0||O[O.length-1]+Ae+2*C>_)&&(q+=N,O[O.length-(ke>0?0:1)]=0,de+=N,ie++),I[ke]={left:0,top:de,row:ie,width:Ae,height:l},O[O.length-1]+=Ae+C}),q}_fitCols(s,u,o,l){let{ctx:i,maxHeight:_,options:{labels:{padding:C}}}=this,I=this.legendHitBoxes=[],O=this.columnSizes=[],N=_-s,q=C,ie=0,de=0,xe=0,ke=0;return this.legendItems.forEach((Ae,Xe)=>{let{itemWidth:qe,itemHeight:ht}=fN(o,u,i,Ae,l);Xe>0&&de+ht+2*C>N&&(q+=ie+C,O.push({width:ie,height:de}),xe+=ie+C,ke++,ie=de=0),I[Xe]={left:xe,top:de,col:ke,width:qe,height:ht},ie=Math.max(ie,qe),de+=ht+C}),q+=ie,O.push({width:ie,height:de}),q}adjustHitBoxes(){if(!this.options.display)return;let s=this._computeTitleHeight(),{legendHitBoxes:u,options:{align:o,labels:{padding:l},rtl:i}}=this,_=$h(i,this.left,this.width);if(this.isHorizontal()){let C=0,I=co(o,this.left+l,this.right-this.lineWidths[C]);for(let O of u)C!==O.row&&(C=O.row,I=co(o,this.left+l,this.right-this.lineWidths[C])),O.top+=this.top+s+l,O.left=_.leftForLtr(_.x(I),O.width),I+=O.width+l}else{let C=0,I=co(o,this.top+s+l,this.bottom-this.columnSizes[C].height);for(let O of u)O.col!==C&&(C=O.col,I=co(o,this.top+s+l,this.bottom-this.columnSizes[C].height)),O.top=I,O.left+=this.left+l,O.left=_.leftForLtr(_.x(O.left),O.width),I+=O.height+l}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){let s=this.ctx;vg(s,this),this._draw(),xg(s)}}_draw(){let{options:s,columnSizes:u,lineWidths:o,ctx:l}=this,{align:i,labels:_}=s,C=mr.color,I=$h(s.rtl,this.left,this.width),O=Rr(_.font),{padding:N}=_,q=O.size,ie=q/2,de;this.drawTitle(),l.textAlign=I.textAlign("left"),l.textBaseline="middle",l.lineWidth=.5,l.font=O.string;let{boxWidth:xe,boxHeight:ke,itemHeight:Ae}=YE(_,q),Xe=function(Et,Ut,xt){if(isNaN(xe)||xe<=0||isNaN(ke)||ke<0)return;l.save();let Yt=qi(xt.lineWidth,1);if(l.fillStyle=qi(xt.fillStyle,C),l.lineCap=qi(xt.lineCap,"butt"),l.lineDashOffset=qi(xt.lineDashOffset,0),l.lineJoin=qi(xt.lineJoin,"miter"),l.lineWidth=Yt,l.strokeStyle=qi(xt.strokeStyle,C),l.setLineDash(qi(xt.lineDash,[])),_.usePointStyle){let zt={radius:ke*Math.SQRT2/2,pointStyle:xt.pointStyle,rotation:xt.rotation,borderWidth:Yt},Si=I.xPlus(Et,xe/2),Ui=Ut+ie;pw(l,zt,Si,Ui,_.pointStyleWidth&&xe)}else{let zt=Ut+Math.max((q-ke)/2,0),Si=I.leftForLtr(Et,xe),Ui=xd(xt.borderRadius);l.beginPath(),Object.values(Ui).some(rr=>rr!==0)?Ym(l,{x:Si,y:zt,w:xe,h:ke,radius:Ui}):l.rect(Si,zt,xe,ke),l.fill(),Yt!==0&&l.stroke()}l.restore()},qe=function(Et,Ut,xt){vd(l,xt.text,Et,Ut+Ae/2,O,{strikethrough:xt.hidden,textAlign:I.textAlign(xt.textAlign)})},ht=this.isHorizontal(),Tt=this._computeTitleHeight();ht?de={x:co(i,this.left+N,this.right-o[0]),y:this.top+N+Tt,line:0}:de={x:this.left+N,y:co(i,this.top+Tt+N,this.bottom-u[0].height),line:0},ww(this.ctx,s.textDirection);let vt=Ae+N;this.legendItems.forEach((Et,Ut)=>{l.strokeStyle=Et.fontColor,l.fillStyle=Et.fontColor;let xt=l.measureText(Et.text).width,Yt=I.textAlign(Et.textAlign||(Et.textAlign=_.textAlign)),zt=xe+ie+xt,Si=de.x,Ui=de.y;I.setWidth(this.width),ht?Ut>0&&Si+zt+N>this.right&&(Ui=de.y+=vt,de.line++,Si=de.x=co(i,this.left+N,this.right-o[de.line])):Ut>0&&Ui+vt>this.bottom&&(Si=de.x=Si+u[de.line].width+N,de.line++,Ui=de.y=co(i,this.top+Tt+N,this.bottom-u[de.line].height));let rr=I.x(Si);if(Xe(rr,Ui,Et),Si=$I(Yt,Si+xe+ie,ht?Si+zt:this.right,s.rtl),qe(I.x(Si),Ui,Et),ht)de.x+=zt+N;else if(typeof Et.text!="string"){let bi=O.lineHeight;de.y+=ED(Et,bi)+N}else de.y+=vt}),Cw(this.ctx,s.textDirection)}drawTitle(){let s=this.options,u=s.title,o=Rr(u.font),l=ho(u.padding);if(!u.display)return;let i=$h(s.rtl,this.left,this.width),_=this.ctx,C=u.position,I=o.size/2,O=l.top+I,N,q=this.left,ie=this.width;if(this.isHorizontal())ie=Math.max(...this.lineWidths),N=this.top+O,q=co(s.align,q,this.right-ie);else{let xe=this.columnSizes.reduce((ke,Ae)=>Math.max(ke,Ae.height),0);N=O+co(s.align,this.top,this.bottom-xe-s.labels.padding-this._computeTitleHeight())}let de=co(C,q,q+ie);_.textAlign=i.textAlign(jb(C)),_.textBaseline="middle",_.strokeStyle=u.color,_.fillStyle=u.color,_.font=o.string,vd(_,u.text,de,N,o)}_computeTitleHeight(){let s=this.options.title,u=Rr(s.font),o=ho(s.padding);return s.display?u.lineHeight+o.height:0}_getLegendItemAt(s,u){let o,l,i;if(Qs(s,this.left,this.right)&&Qs(u,this.top,this.bottom)){for(i=this.legendHitBoxes,o=0;o<i.length;++o)if(l=i[o],Qs(s,l.left,l.left+l.width)&&Qs(u,l.top,l.top+l.height))return this.legendItems[o]}return null}handleEvent(s){let u=this.options;if(!bN(s.type,u))return;let o=this._getLegendItemAt(s.x,s.y);if(s.type==="mousemove"||s.type==="mouseout"){let l=this._hoveredItem,i=pN(l,o);l&&!i&&Un(u.onLeave,[s,l,this],this),this._hoveredItem=o,o&&!i&&Un(u.onHover,[s,o,this],this)}else o&&Un(u.onClick,[s,o,this],this)}};function fN(d,s,u,o,l){let i=gN(o,d,s,u),_=_N(l,o,s.lineHeight);return{itemWidth:i,itemHeight:_}}function gN(d,s,u,o){let l=d.text;return l&&typeof l!="string"&&(l=l.reduce((i,_)=>i.length>_.length?i:_)),s+u.size/2+o.measureText(l).width}function _N(d,s,u){let o=d;return typeof s.text!="string"&&(o=ED(s,u)),o}function ED(d,s){let u=d.text?d.text.length:0;return s*u}function bN(d,s){return!!((d==="mousemove"||d==="mouseout")&&(s.onHover||s.onLeave)||s.onClick&&(d==="click"||d==="mouseup"))}var yN={id:"legend",_element:cy,start(d,s,u){let o=d.legend=new cy({ctx:d.ctx,options:u,chart:d});To.configure(d,o,u),To.addBox(d,o)},stop(d){To.removeBox(d,d.legend),delete d.legend},beforeUpdate(d,s,u){let o=d.legend;To.configure(d,o,u),o.options=u},afterUpdate(d){let s=d.legend;s.buildLabels(),s.adjustHitBoxes()},afterEvent(d,s){s.replay||d.legend.handleEvent(s.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(d,s,u){let o=s.datasetIndex,l=u.chart;l.isDatasetVisible(o)?(l.hide(o),s.hidden=!0):(l.show(o),s.hidden=!1)},onHover:null,onLeave:null,labels:{color:d=>d.chart.options.color,boxWidth:40,padding:10,generateLabels(d){let s=d.data.datasets,{labels:{usePointStyle:u,pointStyle:o,textAlign:l,color:i,useBorderRadius:_,borderRadius:C}}=d.legend.options;return d._getSortedDatasetMetas().map(I=>{let O=I.controller.getStyle(u?0:void 0),N=ho(O.borderWidth);return{text:s[I.index].label,fillStyle:O.backgroundColor,fontColor:i,hidden:!I.visible,lineCap:O.borderCapStyle,lineDash:O.borderDash,lineDashOffset:O.borderDashOffset,lineJoin:O.borderJoinStyle,lineWidth:(N.width+N.height)/4,strokeStyle:O.borderColor,pointStyle:o||O.pointStyle,rotation:O.rotation,textAlign:l||O.textAlign,borderRadius:_&&(C||O.borderRadius),datasetIndex:I.index}},this)}},title:{color:d=>d.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:d=>!d.startsWith("on"),labels:{_scriptable:d=>!["generateLabels","filter","sort"].includes(d)}}},Dg=class extends ys{constructor(s){super(),this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,u){let o=this.options;if(this.left=0,this.top=0,!o.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=s,this.height=this.bottom=u;let l=Kn(o.text)?o.text.length:1;this._padding=ho(o.padding);let i=l*Rr(o.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=i:this.width=i}isHorizontal(){let s=this.options.position;return s==="top"||s==="bottom"}_drawArgs(s){let{top:u,left:o,bottom:l,right:i,options:_}=this,C=_.align,I=0,O,N,q;return this.isHorizontal()?(N=co(C,o,i),q=u+s,O=i-o):(_.position==="left"?(N=o+s,q=co(C,l,u),I=Jn*-.5):(N=i-s,q=co(C,u,l),I=Jn*.5),O=l-u),{titleX:N,titleY:q,maxWidth:O,rotation:I}}draw(){let s=this.ctx,u=this.options;if(!u.display)return;let o=Rr(u.font),i=o.lineHeight/2+this._padding.top,{titleX:_,titleY:C,maxWidth:I,rotation:O}=this._drawArgs(i);vd(s,u.text,0,0,o,{color:u.color,maxWidth:I,rotation:O,textAlign:jb(u.align),textBaseline:"middle",translation:[_,C]})}};function vN(d,s){let u=new Dg({ctx:d.ctx,options:s,chart:d});To.configure(d,u,s),To.addBox(d,u),d.titleBlock=u}var xN={id:"title",_element:Dg,start(d,s,u){vN(d,u)},stop(d){let s=d.titleBlock;To.removeBox(d,s),delete d.titleBlock},beforeUpdate(d,s,u){let o=d.titleBlock;To.configure(d,o,u),o.options=u},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},Jb=new WeakMap,wN={id:"subtitle",start(d,s,u){let o=new Dg({ctx:d.ctx,options:u,chart:d});To.configure(d,o,u),To.addBox(d,o),Jb.set(d,o)},stop(d){To.removeBox(d,Jb.get(d)),Jb.delete(d)},beforeUpdate(d,s,u){let o=Jb.get(d);To.configure(d,o,u),o.options=u},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},Ig={average(d){if(!d.length)return!1;let s,u,o=new Set,l=0,i=0;for(s=0,u=d.length;s<u;++s){let C=d[s].element;if(C&&C.hasValue()){let I=C.tooltipPosition();o.add(I.x),l+=I.y,++i}}return{x:[...o].reduce((C,I)=>C+I)/o.size,y:l/i}},nearest(d,s){if(!d.length)return!1;let u=s.x,o=s.y,l=Number.POSITIVE_INFINITY,i,_,C;for(i=0,_=d.length;i<_;++i){let I=d[i].element;if(I&&I.hasValue()){let O=I.getCenterPoint(),N=Fb(s,O);N<l&&(l=N,C=I)}}if(C){let I=C.tooltipPosition();u=I.x,o=I.y}return{x:u,y:o}}};function Ks(d,s){return s&&(Kn(s)?Array.prototype.push.apply(d,s):d.push(s)),d}function $l(d){return(typeof d=="string"||d instanceof String)&&d.indexOf(`
`)>-1?d.split(`
`):d}function CN(d,s){let{element:u,datasetIndex:o,index:l}=s,i=d.getDatasetMeta(o).controller,{label:_,value:C}=i.getLabelAndValue(l);return{chart:d,label:_,parsed:i.getParsed(l),raw:d.data.datasets[o].data[l],formattedValue:C,dataset:i.getDataset(),dataIndex:l,datasetIndex:o,element:u}}function ZE(d,s){let u=d.chart.ctx,{body:o,footer:l,title:i}=d,{boxWidth:_,boxHeight:C}=s,I=Rr(s.bodyFont),O=Rr(s.titleFont),N=Rr(s.footerFont),q=i.length,ie=l.length,de=o.length,xe=ho(s.padding),ke=xe.height,Ae=0,Xe=o.reduce((Tt,vt)=>Tt+vt.before.length+vt.lines.length+vt.after.length,0);if(Xe+=d.beforeBody.length+d.afterBody.length,q&&(ke+=q*O.lineHeight+(q-1)*s.titleSpacing+s.titleMarginBottom),Xe){let Tt=s.displayColors?Math.max(C,I.lineHeight):I.lineHeight;ke+=de*Tt+(Xe-de)*I.lineHeight+(Xe-1)*s.bodySpacing}ie&&(ke+=s.footerMarginTop+ie*N.lineHeight+(ie-1)*s.footerSpacing);let qe=0,ht=function(Tt){Ae=Math.max(Ae,u.measureText(Tt).width+qe)};return u.save(),u.font=O.string,Rn(d.title,ht),u.font=I.string,Rn(d.beforeBody.concat(d.afterBody),ht),qe=s.displayColors?_+2+s.boxPadding:0,Rn(o,Tt=>{Rn(Tt.before,ht),Rn(Tt.lines,ht),Rn(Tt.after,ht)}),qe=0,u.font=N.string,Rn(d.footer,ht),u.restore(),Ae+=xe.width,{width:Ae,height:ke}}function SN(d,s){let{y:u,height:o}=s;return u<o/2?"top":u>d.height-o/2?"bottom":"center"}function MN(d,s,u,o){let{x:l,width:i}=o,_=u.caretSize+u.caretPadding;if(d==="left"&&l+i+_>s.width||d==="right"&&l-i-_<0)return!0}function kN(d,s,u,o){let{x:l,width:i}=u,{width:_,chartArea:{left:C,right:I}}=d,O="center";return o==="center"?O=l<=(C+I)/2?"left":"right":l<=i/2?O="left":l>=_-i/2&&(O="right"),MN(O,d,s,u)&&(O="center"),O}function XE(d,s,u){let o=u.yAlign||s.yAlign||SN(d,u);return{xAlign:u.xAlign||s.xAlign||kN(d,s,u,o),yAlign:o}}function TN(d,s){let{x:u,width:o}=d;return s==="right"?u-=o:s==="center"&&(u-=o/2),u}function IN(d,s,u){let{y:o,height:l}=d;return s==="top"?o+=u:s==="bottom"?o-=l+u:o-=l/2,o}function QE(d,s,u,o){let{caretSize:l,caretPadding:i,cornerRadius:_}=d,{xAlign:C,yAlign:I}=u,O=l+i,{topLeft:N,topRight:q,bottomLeft:ie,bottomRight:de}=xd(_),xe=TN(s,C),ke=IN(s,I,O);return I==="center"?C==="left"?xe+=O:C==="right"&&(xe-=O):C==="left"?xe-=Math.max(N,ie)+l:C==="right"&&(xe+=Math.max(q,de)+l),{x:Ur(xe,0,o.width-s.width),y:Ur(ke,0,o.height-s.height)}}function ey(d,s,u){let o=ho(u.padding);return s==="center"?d.x+d.width/2:s==="right"?d.x+d.width-o.right:d.x+o.left}function KE(d){return Ks([],$l(d))}function EN(d,s,u){return Gl(d,{tooltip:s,tooltipItems:u,type:"tooltip"})}function JE(d,s){let u=s&&s.dataset&&s.dataset.tooltip&&s.dataset.tooltip.callbacks;return u?d.override(u):d}var DD={beforeTitle:Xs,title(d){if(d.length>0){let s=d[0],u=s.chart.data.labels,o=u?u.length:0;if(this&&this.options&&this.options.mode==="dataset")return s.dataset.label||"";if(s.label)return s.label;if(o>0&&s.dataIndex<o)return u[s.dataIndex]}return""},afterTitle:Xs,beforeBody:Xs,beforeLabel:Xs,label(d){if(this&&this.options&&this.options.mode==="dataset")return d.label+": "+d.formattedValue||d.formattedValue;let s=d.dataset.label||"";s&&(s+=": ");let u=d.formattedValue;return bn(u)||(s+=u),s},labelColor(d){let u=d.chart.getDatasetMeta(d.datasetIndex).controller.getStyle(d.dataIndex);return{borderColor:u.borderColor,backgroundColor:u.backgroundColor,borderWidth:u.borderWidth,borderDash:u.borderDash,borderDashOffset:u.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(d){let u=d.chart.getDatasetMeta(d.datasetIndex).controller.getStyle(d.dataIndex);return{pointStyle:u.pointStyle,rotation:u.rotation}},afterLabel:Xs,afterBody:Xs,beforeFooter:Xs,footer:Xs,afterFooter:Xs};function Jo(d,s,u,o){let l=d[s].call(u,o);return typeof l>"u"?DD[s].call(u,o):l}var eD=(()=>{class d extends ys{static positioners=Ig;constructor(u){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=u.chart,this.options=u.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(u){this.options=u,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let u=this._cachedAnimations;if(u)return u;let o=this.chart,l=this.options.setContext(this.getContext()),i=l.enabled&&o.options.animation&&l.animations,_=new ry(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(_)),_}getContext(){return this.$context||(this.$context=EN(this.chart.getContext(),this,this._tooltipItems))}getTitle(u,o){let{callbacks:l}=o,i=Jo(l,"beforeTitle",this,u),_=Jo(l,"title",this,u),C=Jo(l,"afterTitle",this,u),I=[];return I=Ks(I,$l(i)),I=Ks(I,$l(_)),I=Ks(I,$l(C)),I}getBeforeBody(u,o){return KE(Jo(o.callbacks,"beforeBody",this,u))}getBody(u,o){let{callbacks:l}=o,i=[];return Rn(u,_=>{let C={before:[],lines:[],after:[]},I=JE(l,_);Ks(C.before,$l(Jo(I,"beforeLabel",this,_))),Ks(C.lines,Jo(I,"label",this,_)),Ks(C.after,$l(Jo(I,"afterLabel",this,_))),i.push(C)}),i}getAfterBody(u,o){return KE(Jo(o.callbacks,"afterBody",this,u))}getFooter(u,o){let{callbacks:l}=o,i=Jo(l,"beforeFooter",this,u),_=Jo(l,"footer",this,u),C=Jo(l,"afterFooter",this,u),I=[];return I=Ks(I,$l(i)),I=Ks(I,$l(_)),I=Ks(I,$l(C)),I}_createItems(u){let o=this._active,l=this.chart.data,i=[],_=[],C=[],I=[],O,N;for(O=0,N=o.length;O<N;++O)I.push(CN(this.chart,o[O]));return u.filter&&(I=I.filter((q,ie,de)=>u.filter(q,ie,de,l))),u.itemSort&&(I=I.sort((q,ie)=>u.itemSort(q,ie,l))),Rn(I,q=>{let ie=JE(u.callbacks,q);i.push(Jo(ie,"labelColor",this,q)),_.push(Jo(ie,"labelPointStyle",this,q)),C.push(Jo(ie,"labelTextColor",this,q))}),this.labelColors=i,this.labelPointStyles=_,this.labelTextColors=C,this.dataPoints=I,I}update(u,o){let l=this.options.setContext(this.getContext()),i=this._active,_,C=[];if(!i.length)this.opacity!==0&&(_={opacity:0});else{let I=Ig[l.position].call(this,i,this._eventPosition);C=this._createItems(l),this.title=this.getTitle(C,l),this.beforeBody=this.getBeforeBody(C,l),this.body=this.getBody(C,l),this.afterBody=this.getAfterBody(C,l),this.footer=this.getFooter(C,l);let O=this._size=ZE(this,l),N=Object.assign({},I,O),q=XE(this.chart,l,N),ie=QE(l,N,q,this.chart);this.xAlign=q.xAlign,this.yAlign=q.yAlign,_={opacity:1,x:ie.x,y:ie.y,width:O.width,height:O.height,caretX:I.x,caretY:I.y}}this._tooltipItems=C,this.$context=void 0,_&&this._resolveAnimations().update(this,_),u&&l.external&&l.external.call(this,{chart:this.chart,tooltip:this,replay:o})}drawCaret(u,o,l,i){let _=this.getCaretPosition(u,l,i);o.lineTo(_.x1,_.y1),o.lineTo(_.x2,_.y2),o.lineTo(_.x3,_.y3)}getCaretPosition(u,o,l){let{xAlign:i,yAlign:_}=this,{caretSize:C,cornerRadius:I}=l,{topLeft:O,topRight:N,bottomLeft:q,bottomRight:ie}=xd(I),{x:de,y:xe}=u,{width:ke,height:Ae}=o,Xe,qe,ht,Tt,vt,Et;return _==="center"?(vt=xe+Ae/2,i==="left"?(Xe=de,qe=Xe-C,Tt=vt+C,Et=vt-C):(Xe=de+ke,qe=Xe+C,Tt=vt-C,Et=vt+C),ht=Xe):(i==="left"?qe=de+Math.max(O,q)+C:i==="right"?qe=de+ke-Math.max(N,ie)-C:qe=this.caretX,_==="top"?(Tt=xe,vt=Tt-C,Xe=qe-C,ht=qe+C):(Tt=xe+Ae,vt=Tt+C,Xe=qe+C,ht=qe-C),Et=Tt),{x1:Xe,x2:qe,x3:ht,y1:Tt,y2:vt,y3:Et}}drawTitle(u,o,l){let i=this.title,_=i.length,C,I,O;if(_){let N=$h(l.rtl,this.x,this.width);for(u.x=ey(this,l.titleAlign,l),o.textAlign=N.textAlign(l.titleAlign),o.textBaseline="middle",C=Rr(l.titleFont),I=l.titleSpacing,o.fillStyle=l.titleColor,o.font=C.string,O=0;O<_;++O)o.fillText(i[O],N.x(u.x),u.y+C.lineHeight/2),u.y+=C.lineHeight+I,O+1===_&&(u.y+=l.titleMarginBottom-I)}}_drawColorBox(u,o,l,i,_){let C=this.labelColors[l],I=this.labelPointStyles[l],{boxHeight:O,boxWidth:N}=_,q=Rr(_.bodyFont),ie=ey(this,"left",_),de=i.x(ie),xe=O<q.lineHeight?(q.lineHeight-O)/2:0,ke=o.y+xe;if(_.usePointStyle){let Ae={radius:Math.min(N,O)/2,pointStyle:I.pointStyle,rotation:I.rotation,borderWidth:1},Xe=i.leftForLtr(de,N)+N/2,qe=ke+O/2;u.strokeStyle=_.multiKeyBackground,u.fillStyle=_.multiKeyBackground,Hb(u,Ae,Xe,qe),u.strokeStyle=C.borderColor,u.fillStyle=C.backgroundColor,Hb(u,Ae,Xe,qe)}else{u.lineWidth=ln(C.borderWidth)?Math.max(...Object.values(C.borderWidth)):C.borderWidth||1,u.strokeStyle=C.borderColor,u.setLineDash(C.borderDash||[]),u.lineDashOffset=C.borderDashOffset||0;let Ae=i.leftForLtr(de,N),Xe=i.leftForLtr(i.xPlus(de,1),N-2),qe=xd(C.borderRadius);Object.values(qe).some(ht=>ht!==0)?(u.beginPath(),u.fillStyle=_.multiKeyBackground,Ym(u,{x:Ae,y:ke,w:N,h:O,radius:qe}),u.fill(),u.stroke(),u.fillStyle=C.backgroundColor,u.beginPath(),Ym(u,{x:Xe,y:ke+1,w:N-2,h:O-2,radius:qe}),u.fill()):(u.fillStyle=_.multiKeyBackground,u.fillRect(Ae,ke,N,O),u.strokeRect(Ae,ke,N,O),u.fillStyle=C.backgroundColor,u.fillRect(Xe,ke+1,N-2,O-2))}u.fillStyle=this.labelTextColors[l]}drawBody(u,o,l){let{body:i}=this,{bodySpacing:_,bodyAlign:C,displayColors:I,boxHeight:O,boxWidth:N,boxPadding:q}=l,ie=Rr(l.bodyFont),de=ie.lineHeight,xe=0,ke=$h(l.rtl,this.x,this.width),Ae=function(Yt){o.fillText(Yt,ke.x(u.x+xe),u.y+de/2),u.y+=de+_},Xe=ke.textAlign(C),qe,ht,Tt,vt,Et,Ut,xt;for(o.textAlign=C,o.textBaseline="middle",o.font=ie.string,u.x=ey(this,Xe,l),o.fillStyle=l.bodyColor,Rn(this.beforeBody,Ae),xe=I&&Xe!=="right"?C==="center"?N/2+q:N+2+q:0,vt=0,Ut=i.length;vt<Ut;++vt){for(qe=i[vt],ht=this.labelTextColors[vt],o.fillStyle=ht,Rn(qe.before,Ae),Tt=qe.lines,I&&Tt.length&&(this._drawColorBox(o,u,vt,ke,l),de=Math.max(ie.lineHeight,O)),Et=0,xt=Tt.length;Et<xt;++Et)Ae(Tt[Et]),de=ie.lineHeight;Rn(qe.after,Ae)}xe=0,de=ie.lineHeight,Rn(this.afterBody,Ae),u.y-=_}drawFooter(u,o,l){let i=this.footer,_=i.length,C,I;if(_){let O=$h(l.rtl,this.x,this.width);for(u.x=ey(this,l.footerAlign,l),u.y+=l.footerMarginTop,o.textAlign=O.textAlign(l.footerAlign),o.textBaseline="middle",C=Rr(l.footerFont),o.fillStyle=l.footerColor,o.font=C.string,I=0;I<_;++I)o.fillText(i[I],O.x(u.x),u.y+C.lineHeight/2),u.y+=C.lineHeight+l.footerSpacing}}drawBackground(u,o,l,i){let{xAlign:_,yAlign:C}=this,{x:I,y:O}=u,{width:N,height:q}=l,{topLeft:ie,topRight:de,bottomLeft:xe,bottomRight:ke}=xd(i.cornerRadius);o.fillStyle=i.backgroundColor,o.strokeStyle=i.borderColor,o.lineWidth=i.borderWidth,o.beginPath(),o.moveTo(I+ie,O),C==="top"&&this.drawCaret(u,o,l,i),o.lineTo(I+N-de,O),o.quadraticCurveTo(I+N,O,I+N,O+de),C==="center"&&_==="right"&&this.drawCaret(u,o,l,i),o.lineTo(I+N,O+q-ke),o.quadraticCurveTo(I+N,O+q,I+N-ke,O+q),C==="bottom"&&this.drawCaret(u,o,l,i),o.lineTo(I+xe,O+q),o.quadraticCurveTo(I,O+q,I,O+q-xe),C==="center"&&_==="left"&&this.drawCaret(u,o,l,i),o.lineTo(I,O+ie),o.quadraticCurveTo(I,O,I+ie,O),o.closePath(),o.fill(),i.borderWidth>0&&o.stroke()}_updateAnimationTarget(u){let o=this.chart,l=this.$animations,i=l&&l.x,_=l&&l.y;if(i||_){let C=Ig[u.position].call(this,this._active,this._eventPosition);if(!C)return;let I=this._size=ZE(this,u),O=Object.assign({},C,this._size),N=XE(o,u,O),q=QE(u,O,N,o);(i._to!==q.x||_._to!==q.y)&&(this.xAlign=N.xAlign,this.yAlign=N.yAlign,this.width=I.width,this.height=I.height,this.caretX=C.x,this.caretY=C.y,this._resolveAnimations().update(this,q))}}_willRender(){return!!this.opacity}draw(u){let o=this.options.setContext(this.getContext()),l=this.opacity;if(!l)return;this._updateAnimationTarget(o);let i={width:this.width,height:this.height},_={x:this.x,y:this.y};l=Math.abs(l)<.001?0:l;let C=ho(o.padding),I=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;o.enabled&&I&&(u.save(),u.globalAlpha=l,this.drawBackground(_,u,i,o),ww(u,o.textDirection),_.y+=C.top,this.drawTitle(_,u,o),this.drawBody(_,u,o),this.drawFooter(_,u,o),Cw(u,o.textDirection),u.restore())}getActiveElements(){return this._active||[]}setActiveElements(u,o){let l=this._active,i=u.map(({datasetIndex:I,index:O})=>{let N=this.chart.getDatasetMeta(I);if(!N)throw new Error("Cannot find a dataset at index "+I);return{datasetIndex:I,element:N.data[O],index:O}}),_=!bg(l,i),C=this._positionChanged(i,o);(_||C)&&(this._active=i,this._eventPosition=o,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(u,o,l=!0){if(o&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let i=this.options,_=this._active||[],C=this._getActiveElements(u,_,o,l),I=this._positionChanged(C,u),O=o||!bg(C,_)||I;return O&&(this._active=C,(i.enabled||i.external)&&(this._eventPosition={x:u.x,y:u.y},this.update(!0,o))),O}_getActiveElements(u,o,l,i){let _=this.options;if(u.type==="mouseout")return[];if(!i)return o.filter(I=>this.chart.data.datasets[I.datasetIndex]&&this.chart.getDatasetMeta(I.datasetIndex).controller.getParsed(I.index)!==void 0);let C=this.chart.getElementsAtEventForMode(u,_.mode,_,l);return _.reverse&&C.reverse(),C}_positionChanged(u,o){let{caretX:l,caretY:i,options:_}=this,C=Ig[_.position].call(this,u,o);return C!==!1&&(l!==C.x||i!==C.y)}}return d})(),DN={id:"tooltip",_element:eD,positioners:Ig,afterInit(d,s,u){u&&(d.tooltip=new eD({chart:d,options:u}))},beforeUpdate(d,s,u){d.tooltip&&d.tooltip.initialize(u)},reset(d,s,u){d.tooltip&&d.tooltip.initialize(u)},afterDraw(d){let s=d.tooltip;if(s&&s._willRender()){let u={tooltip:s};if(d.notifyPlugins("beforeTooltipDraw",Pa($i({},u),{cancelable:!0}))===!1)return;s.draw(d.ctx),d.notifyPlugins("afterTooltipDraw",u)}},afterEvent(d,s){if(d.tooltip){let u=s.replay;d.tooltip.handleEvent(s.event,u,s.inChartArea)&&(s.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(d,s)=>s.bodyFont.size,boxWidth:(d,s)=>s.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:DD},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:d=>d!=="filter"&&d!=="itemSort"&&d!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},AN=Object.freeze({__proto__:null,Colors:HB,Decimation:$B,Filler:mN,Legend:yN,SubTitle:wN,Title:xN,Tooltip:DN}),PN=(d,s,u,o)=>(typeof s=="string"?(u=d.push(s)-1,o.unshift({index:u,label:s})):isNaN(s)&&(u=null),u);function ON(d,s,u,o){let l=d.indexOf(s);if(l===-1)return PN(d,s,u,o);let i=d.lastIndexOf(s);return l!==i?u:l}var RN=(d,s)=>d===null?null:Ur(Math.round(d),0,s);function tD(d){let s=this.getLabels();return d>=0&&d<s.length?s[d]:d}var LN=(()=>{class d extends Xh{static id="category";static defaults={ticks:{callback:tD}};constructor(u){super(u),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(u){let o=this._addedLabels;if(o.length){let l=this.getLabels();for(let{index:i,label:_}of o)l[i]===_&&l.splice(i,1);this._addedLabels=[]}super.init(u)}parse(u,o){if(bn(u))return null;let l=this.getLabels();return o=isFinite(o)&&l[o]===u?o:ON(l,u,qi(o,u),this._addedLabels),RN(o,l.length-1)}determineDataLimits(){let{minDefined:u,maxDefined:o}=this.getUserBounds(),{min:l,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(u||(l=0),o||(i=this.getLabels().length-1)),this.min=l,this.max=i}buildTicks(){let u=this.min,o=this.max,l=this.options.offset,i=[],_=this.getLabels();_=u===0&&o===_.length-1?_:_.slice(u,o+1),this._valueRange=Math.max(_.length-(l?0:1),1),this._startValue=this.min-(l?.5:0);for(let C=u;C<=o;C++)i.push({value:C});return i}getLabelForValue(u){return tD.call(this,u)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(u){return typeof u!="number"&&(u=this.parse(u)),u===null?NaN:this.getPixelForDecimal((u-this._startValue)/this._valueRange)}getPixelForTick(u){let o=this.ticks;return u<0||u>o.length-1?null:this.getPixelForValue(o[u].value)}getValueForPixel(u){return Math.round(this._startValue+this.getDecimalForPixel(u)*this._valueRange)}getBasePixel(){return this.bottom}}return d})();function FN(d,s){let u=[],{bounds:l,step:i,min:_,max:C,precision:I,count:O,maxTicks:N,maxDigits:q,includeBounds:ie}=d,de=i||1,xe=N-1,{min:ke,max:Ae}=s,Xe=!bn(_),qe=!bn(C),ht=!bn(O),Tt=(Ae-ke)/(q+1),vt=tw((Ae-ke)/xe/de)*de,Et,Ut,xt,Yt;if(vt<1e-14&&!Xe&&!qe)return[{value:ke},{value:Ae}];Yt=Math.ceil(Ae/vt)-Math.floor(ke/vt),Yt>xe&&(vt=tw(Yt*vt/xe/de)*de),bn(I)||(Et=Math.pow(10,I),vt=Math.ceil(vt*Et)/Et),l==="ticks"?(Ut=Math.floor(ke/vt)*vt,xt=Math.ceil(Ae/vt)*vt):(Ut=ke,xt=Ae),Xe&&qe&&i&&VI((C-_)/i,vt/1e3)?(Yt=Math.round(Math.min((C-_)/vt,N)),vt=(C-_)/Yt,Ut=_,xt=C):ht?(Ut=Xe?_:Ut,xt=qe?C:xt,Yt=O-1,vt=(xt-Ut)/Yt):(Yt=(xt-Ut)/vt,Gm(Yt,Math.round(Yt),vt/1e3)?Yt=Math.round(Yt):Yt=Math.ceil(Yt));let zt=Math.max(nw(vt),nw(Ut));Et=Math.pow(10,bn(I)?zt:I),Ut=Math.round(Ut*Et)/Et,xt=Math.round(xt*Et)/Et;let Si=0;for(Xe&&(ie&&Ut!==_?(u.push({value:_}),Ut<_&&Si++,Gm(Math.round((Ut+Si*vt)*Et)/Et,_,iD(_,Tt,d))&&Si++):Ut<_&&Si++);Si<Yt;++Si){let Ui=Math.round((Ut+Si*vt)*Et)/Et;if(qe&&Ui>C)break;u.push({value:Ui})}return qe&&ie&&xt!==C?u.length&&Gm(u[u.length-1].value,C,iD(C,Tt,d))?u[u.length-1].value=C:u.push({value:C}):(!qe||xt===C)&&u.push({value:xt}),u}function iD(d,s,{horizontal:u,minRotation:o}){let l=Ua(o),i=(u?Math.sin(l):Math.cos(l))||.001,_=.75*s*(""+d).length;return Math.min(s/i,_)}var Km=class extends Xh{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(s,u){return bn(s)||(typeof s=="number"||s instanceof Number)&&!isFinite(+s)?null:+s}handleTickRangeOptions(){let{beginAtZero:s}=this.options,{minDefined:u,maxDefined:o}=this.getUserBounds(),{min:l,max:i}=this,_=I=>l=u?l:I,C=I=>i=o?i:I;if(s){let I=bs(l),O=bs(i);I<0&&O<0?C(0):I>0&&O>0&&_(0)}if(l===i){let I=i===0?1:Math.abs(i*.05);C(i+I),s||_(l-I)}this.min=l,this.max=i}getTickLimit(){let s=this.options.ticks,{maxTicksLimit:u,stepSize:o}=s,l;return o?(l=Math.ceil(this.max/o)-Math.floor(this.min/o)+1,l>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${o} would result generating up to ${l} ticks. Limiting to 1000.`),l=1e3)):(l=this.computeTickLimit(),u=u||11),u&&(l=Math.min(u,l)),l}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let s=this.options,u=s.ticks,o=this.getTickLimit();o=Math.max(2,o);let l={maxTicks:o,bounds:s.bounds,min:s.min,max:s.max,precision:u.precision,step:u.stepSize,count:u.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:u.minRotation||0,includeBounds:u.includeBounds!==!1},i=this._range||this,_=FN(l,i);return s.bounds==="ticks"&&iw(_,this,"value"),s.reverse?(_.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),_}configure(){let s=this.ticks,u=this.min,o=this.max;if(super.configure(),this.options.offset&&s.length){let l=(o-u)/Math.max(s.length-1,1)/2;u-=l,o+=l}this._startValue=u,this._endValue=o,this._valueRange=o-u}getLabelForValue(s){return $m(s,this.chart.options.locale,this.options.ticks.format)}},Xw=class extends Km{static id="linear";static defaults={ticks:{callback:yg.formatters.numeric}};determineDataLimits(){let{min:s,max:u}=this.getMinMax(!0);this.min=ur(s)?s:0,this.max=ur(u)?u:1,this.handleTickRangeOptions()}computeTickLimit(){let s=this.isHorizontal(),u=s?this.width:this.height,o=Ua(this.options.ticks.minRotation),l=(s?Math.sin(o):Math.cos(o))||.001,i=this._resolveTickFontOptions(0);return Math.ceil(u/Math.min(40,i.lineHeight/l))}getPixelForValue(s){return s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getValueForPixel(s){return this._startValue+this.getDecimalForPixel(s)*this._valueRange}},Ag=d=>Math.floor(Hl(d)),Zh=(d,s)=>Math.pow(10,Ag(d)+s);function nD(d){return d/Math.pow(10,Ag(d))===1}function rD(d,s,u){let o=Math.pow(10,u),l=Math.floor(d/o);return Math.ceil(s/o)-l}function zN(d,s){let u=s-d,o=Ag(u);for(;rD(d,s,o)>10;)o++;for(;rD(d,s,o)<10;)o--;return Math.min(o,Ag(d))}function BN(d,{min:s,max:u}){s=Ko(d.min,s);let o=[],l=Ag(s),i=zN(s,u),_=i<0?Math.pow(10,Math.abs(i)):1,C=Math.pow(10,i),I=l>i?Math.pow(10,l):0,O=Math.round((s-I)*_)/_,N=Math.floor((s-I)/C/10)*C*10,q=Math.floor((O-N)/Math.pow(10,i)),ie=Ko(d.min,Math.round((I+N+q*Math.pow(10,i))*_)/_);for(;ie<u;)o.push({value:ie,major:nD(ie),significand:q}),q>=10?q=q<15?15:20:q++,q>=20&&(i++,q=2,_=i>=0?1:_),ie=Math.round((I+N+q*Math.pow(10,i))*_)/_;let de=Ko(d.max,ie);return o.push({value:de,major:nD(de),significand:q}),o}var Qw=class extends Xh{static id="logarithmic";static defaults={ticks:{callback:yg.formatters.logarithmic,major:{enabled:!0}}};constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(s,u){let o=Km.prototype.parse.apply(this,[s,u]);if(o===0){this._zero=!0;return}return ur(o)&&o>0?o:null}determineDataLimits(){let{min:s,max:u}=this.getMinMax(!0);this.min=ur(s)?Math.max(0,s):null,this.max=ur(u)?Math.max(0,u):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!ur(this._userMin)&&(this.min=s===Zh(this.min,0)?Zh(this.min,-1):Zh(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:s,maxDefined:u}=this.getUserBounds(),o=this.min,l=this.max,i=C=>o=s?o:C,_=C=>l=u?l:C;o===l&&(o<=0?(i(1),_(10)):(i(Zh(o,-1)),_(Zh(l,1)))),o<=0&&i(Zh(l,-1)),l<=0&&_(Zh(o,1)),this.min=o,this.max=l}buildTicks(){let s=this.options,u={min:this._userMin,max:this._userMax},o=BN(u,this);return s.bounds==="ticks"&&iw(o,this,"value"),s.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}getLabelForValue(s){return s===void 0?"0":$m(s,this.chart.options.locale,this.options.ticks.format)}configure(){let s=this.min;super.configure(),this._startValue=Hl(s),this._valueRange=Hl(this.max)-Hl(s)}getPixelForValue(s){return(s===void 0||s===0)&&(s=this.min),s===null||isNaN(s)?NaN:this.getPixelForDecimal(s===this.min?0:(Hl(s)-this._startValue)/this._valueRange)}getValueForPixel(s){let u=this.getDecimalForPixel(s);return Math.pow(10,this._startValue+u*this._valueRange)}};function Kw(d){let s=d.ticks;if(s.display&&d.display){let u=ho(s.backdropPadding);return qi(s.font&&s.font.size,mr.font.size)+u.height}return 0}function NN(d,s,u){return u=Kn(u)?u:[u],{w:ZI(d,s.string,u),h:u.length*s.lineHeight}}function oD(d,s,u,o,l){return d===o||d===l?{start:s-u/2,end:s+u/2}:d<o||d>l?{start:s-u,end:s}:{start:s,end:s+u}}function VN(d){let s={l:d.left+d._padding.left,r:d.right-d._padding.right,t:d.top+d._padding.top,b:d.bottom-d._padding.bottom},u=Object.assign({},s),o=[],l=[],i=d._pointLabels.length,_=d.options.pointLabels,C=_.centerPointLabels?Jn/i:0;for(let I=0;I<i;I++){let O=_.setContext(d.getPointLabelContext(I));l[I]=O.padding;let N=d.getPointPosition(I,d.drawingArea+l[I],C),q=Rr(O.font),ie=NN(d.ctx,q,d._pointLabels[I]);o[I]=ie;let de=Qo(d.getIndexAngle(I)+C),xe=Math.round(Nb(de)),ke=oD(xe,N.x,ie.w,0,180),Ae=oD(xe,N.y,ie.h,90,270);jN(u,s,de,ke,Ae)}d.setCenterPoint(s.l-u.l,u.r-s.r,s.t-u.t,u.b-s.b),d._pointLabelItems=WN(d,o,l)}function jN(d,s,u,o,l){let i=Math.abs(Math.sin(u)),_=Math.abs(Math.cos(u)),C=0,I=0;o.start<s.l?(C=(s.l-o.start)/i,d.l=Math.min(d.l,s.l-C)):o.end>s.r&&(C=(o.end-s.r)/i,d.r=Math.max(d.r,s.r+C)),l.start<s.t?(I=(s.t-l.start)/_,d.t=Math.min(d.t,s.t-I)):l.end>s.b&&(I=(l.end-s.b)/_,d.b=Math.max(d.b,s.b+I))}function UN(d,s,u){let o=d.drawingArea,{extra:l,additionalAngle:i,padding:_,size:C}=u,I=d.getPointPosition(s,o+l+_,i),O=Math.round(Nb(Qo(I.angle+xr))),N=$N(I.y,C.h,O),q=GN(O),ie=qN(I.x,C.w,q);return{visible:!0,x:I.x,y:N,textAlign:q,left:ie,top:N,right:ie+C.w,bottom:N+C.h}}function HN(d,s){if(!s)return!0;let{left:u,top:o,right:l,bottom:i}=d;return!(Zs({x:u,y:o},s)||Zs({x:u,y:i},s)||Zs({x:l,y:o},s)||Zs({x:l,y:i},s))}function WN(d,s,u){let o=[],l=d._pointLabels.length,i=d.options,{centerPointLabels:_,display:C}=i.pointLabels,I={extra:Kw(i)/2,additionalAngle:_?Jn/l:0},O;for(let N=0;N<l;N++){I.padding=u[N],I.size=s[N];let q=UN(d,N,I);o.push(q),C==="auto"&&(q.visible=HN(q,O),q.visible&&(O=q))}return o}function GN(d){return d===0||d===180?"center":d<180?"left":"right"}function qN(d,s,u){return u==="right"?d-=s:u==="center"&&(d-=s/2),d}function $N(d,s,u){return u===90||u===270?d-=s/2:(u>270||u<90)&&(d-=s),d}function YN(d,s,u){let{left:o,top:l,right:i,bottom:_}=u,{backdropColor:C}=s;if(!bn(C)){let I=xd(s.borderRadius),O=ho(s.backdropPadding);d.fillStyle=C;let N=o-O.left,q=l-O.top,ie=i-o+O.width,de=_-l+O.height;Object.values(I).some(xe=>xe!==0)?(d.beginPath(),Ym(d,{x:N,y:q,w:ie,h:de,radius:I}),d.fill()):d.fillRect(N,q,ie,de)}}function ZN(d,s){let{ctx:u,options:{pointLabels:o}}=d;for(let l=s-1;l>=0;l--){let i=d._pointLabelItems[l];if(!i.visible)continue;let _=o.setContext(d.getPointLabelContext(l));YN(u,_,i);let C=Rr(_.font),{x:I,y:O,textAlign:N}=i;vd(u,d._pointLabels[l],I,O+C.lineHeight/2,C,{color:_.color,textAlign:N,textBaseline:"middle"})}}function AD(d,s,u,o){let{ctx:l}=d;if(u)l.arc(d.xCenter,d.yCenter,s,0,er);else{let i=d.getPointPosition(0,s);l.moveTo(i.x,i.y);for(let _=1;_<o;_++)i=d.getPointPosition(_,s),l.lineTo(i.x,i.y)}}function XN(d,s,u,o,l){let i=d.ctx,_=s.circular,{color:C,lineWidth:I}=s;!_&&!o||!C||!I||u<0||(i.save(),i.strokeStyle=C,i.lineWidth=I,i.setLineDash(l.dash),i.lineDashOffset=l.dashOffset,i.beginPath(),AD(d,u,_,o),i.closePath(),i.stroke(),i.restore())}function QN(d,s,u){return Gl(d,{label:u,index:s,type:"pointLabel"})}var Jw=class extends Km{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:yg.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(s){return s},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(s){super(s),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let s=this._padding=ho(Kw(this.options)/2),u=this.width=this.maxWidth-s.width,o=this.height=this.maxHeight-s.height;this.xCenter=Math.floor(this.left+u/2+s.left),this.yCenter=Math.floor(this.top+o/2+s.top),this.drawingArea=Math.floor(Math.min(u,o)/2)}determineDataLimits(){let{min:s,max:u}=this.getMinMax(!1);this.min=ur(s)&&!isNaN(s)?s:0,this.max=ur(u)&&!isNaN(u)?u:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Kw(this.options))}generateTickLabels(s){Km.prototype.generateTickLabels.call(this,s),this._pointLabels=this.getLabels().map((u,o)=>{let l=Un(this.options.pointLabels.callback,[u,o],this);return l||l===0?l:""}).filter((u,o)=>this.chart.getDataVisibility(o))}fit(){let s=this.options;s.display&&s.pointLabels.display?VN(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(s,u,o,l){this.xCenter+=Math.floor((s-u)/2),this.yCenter+=Math.floor((o-l)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(s,u,o,l))}getIndexAngle(s){let u=er/(this._pointLabels.length||1),o=this.options.startAngle||0;return Qo(s*u+Ua(o))}getDistanceFromCenterForValue(s){if(bn(s))return NaN;let u=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-s)*u:(s-this.min)*u}getValueForDistanceFromCenter(s){if(bn(s))return NaN;let u=s/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-u:this.min+u}getPointLabelContext(s){let u=this._pointLabels||[];if(s>=0&&s<u.length){let o=u[s];return QN(this.getContext(),s,o)}}getPointPosition(s,u,o=0){let l=this.getIndexAngle(s)-xr+o;return{x:Math.cos(l)*u+this.xCenter,y:Math.sin(l)*u+this.yCenter,angle:l}}getPointPositionForValue(s,u){return this.getPointPosition(s,this.getDistanceFromCenterForValue(u))}getBasePosition(s){return this.getPointPositionForValue(s||0,this.getBaseValue())}getPointLabelPosition(s){let{left:u,top:o,right:l,bottom:i}=this._pointLabelItems[s];return{left:u,top:o,right:l,bottom:i}}drawBackground(){let{backgroundColor:s,grid:{circular:u}}=this.options;if(s){let o=this.ctx;o.save(),o.beginPath(),AD(this,this.getDistanceFromCenterForValue(this._endValue),u,this._pointLabels.length),o.closePath(),o.fillStyle=s,o.fill(),o.restore()}}drawGrid(){let s=this.ctx,u=this.options,{angleLines:o,grid:l,border:i}=u,_=this._pointLabels.length,C,I,O;if(u.pointLabels.display&&ZN(this,_),l.display&&this.ticks.forEach((N,q)=>{if(q!==0||q===0&&this.min<0){I=this.getDistanceFromCenterForValue(N.value);let ie=this.getContext(q),de=l.setContext(ie),xe=i.setContext(ie);XN(this,de,I,_,xe)}}),o.display){for(s.save(),C=_-1;C>=0;C--){let N=o.setContext(this.getPointLabelContext(C)),{color:q,lineWidth:ie}=N;!ie||!q||(s.lineWidth=ie,s.strokeStyle=q,s.setLineDash(N.borderDash),s.lineDashOffset=N.borderDashOffset,I=this.getDistanceFromCenterForValue(u.ticks.reverse?this.min:this.max),O=this.getPointPosition(C,I),s.beginPath(),s.moveTo(this.xCenter,this.yCenter),s.lineTo(O.x,O.y),s.stroke())}s.restore()}}drawBorder(){}drawLabels(){let s=this.ctx,u=this.options,o=u.ticks;if(!o.display)return;let l=this.getIndexAngle(0),i,_;s.save(),s.translate(this.xCenter,this.yCenter),s.rotate(l),s.textAlign="center",s.textBaseline="middle",this.ticks.forEach((C,I)=>{if(I===0&&this.min>=0&&!u.reverse)return;let O=o.setContext(this.getContext(I)),N=Rr(O.font);if(i=this.getDistanceFromCenterForValue(this.ticks[I].value),O.showLabelBackdrop){s.font=N.string,_=s.measureText(C.label).width,s.fillStyle=O.backdropColor;let q=ho(O.backdropPadding);s.fillRect(-_/2-q.left,-i-N.size/2-q.top,_+q.width,N.size+q.height)}vd(s,C.label,0,-i,N,{color:O.color,strokeColor:O.textStrokeColor,strokeWidth:O.textStrokeWidth})}),s.restore()}drawTitle(){}},hy={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ea=Object.keys(hy);function aD(d,s){return d-s}function sD(d,s){if(bn(s))return null;let u=d._adapter,{parser:o,round:l,isoWeekday:i}=d._parseOpts,_=s;return typeof o=="function"&&(_=o(_)),ur(_)||(_=typeof o=="string"?u.parse(_,o):u.parse(_)),_===null?null:(l&&(_=l==="week"&&(qh(i)||i===!0)?u.startOf(_,"isoWeek",i):u.startOf(_,l)),+_)}function lD(d,s,u,o){let l=ea.length;for(let i=ea.indexOf(d);i<l-1;++i){let _=hy[ea[i]],C=_.steps?_.steps:Number.MAX_SAFE_INTEGER;if(_.common&&Math.ceil((u-s)/(C*_.size))<=o)return ea[i]}return ea[l-1]}function KN(d,s,u,o,l){for(let i=ea.length-1;i>=ea.indexOf(u);i--){let _=ea[i];if(hy[_].common&&d._adapter.diff(l,o,_)>=s-1)return _}return ea[u?ea.indexOf(u):0]}function JN(d){for(let s=ea.indexOf(d)+1,u=ea.length;s<u;++s)if(hy[ea[s]].common)return ea[s]}function cD(d,s,u){if(!u)d[s]=!0;else if(u.length){let{lo:o,hi:l}=Vb(u,s),i=u[o]>=s?u[o]:u[l];d[i]=!0}}function eV(d,s,u,o){let l=d._adapter,i=+l.startOf(s[0].value,o),_=s[s.length-1].value,C,I;for(C=i;C<=_;C=+l.add(C,1,o))I=u[C],I>=0&&(s[I].major=!0);return s}function dD(d,s,u){let o=[],l={},i=s.length,_,C;for(_=0;_<i;++_)C=s[_],l[C]=_,o.push({value:C,major:!1});return i===0||!u?o:eV(d,o,l,u)}var eC=(()=>{class d extends Xh{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(u){super(u),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(u,o={}){let l=u.time||(u.time={}),i=this._adapter=new u4._date(u.adapters.date);i.init(o),Hm(l.displayFormats,i.formats()),this._parseOpts={parser:l.parser,round:l.round,isoWeekday:l.isoWeekday},super.init(u),this._normalized=o.normalized}parse(u,o){return u===void 0?null:sD(this,u)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let u=this.options,o=this._adapter,l=u.time.unit||"day",{min:i,max:_,minDefined:C,maxDefined:I}=this.getUserBounds();function O(N){!C&&!isNaN(N.min)&&(i=Math.min(i,N.min)),!I&&!isNaN(N.max)&&(_=Math.max(_,N.max))}(!C||!I)&&(O(this._getLabelBounds()),(u.bounds!=="ticks"||u.ticks.source!=="labels")&&O(this.getMinMax(!1))),i=ur(i)&&!isNaN(i)?i:+o.startOf(Date.now(),l),_=ur(_)&&!isNaN(_)?_:+o.endOf(Date.now(),l)+1,this.min=Math.min(i,_-1),this.max=Math.max(i+1,_)}_getLabelBounds(){let u=this.getLabelTimestamps(),o=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return u.length&&(o=u[0],l=u[u.length-1]),{min:o,max:l}}buildTicks(){let u=this.options,o=u.time,l=u.ticks,i=l.source==="labels"?this.getLabelTimestamps():this._generate();u.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);let _=this.min,C=this.max,I=HI(i,_,C);return this._unit=o.unit||(l.autoSkip?lD(o.minUnit,this.min,this.max,this._getLabelCapacity(_)):KN(this,I.length,o.minUnit,this.min,this.max)),this._majorUnit=!l.major.enabled||this._unit==="year"?void 0:JN(this._unit),this.initOffsets(i),u.reverse&&I.reverse(),dD(this,I,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(u=>+u.value))}initOffsets(u=[]){let o=0,l=0,i,_;this.options.offset&&u.length&&(i=this.getDecimalForValue(u[0]),u.length===1?o=1-i:o=(this.getDecimalForValue(u[1])-i)/2,_=this.getDecimalForValue(u[u.length-1]),u.length===1?l=_:l=(_-this.getDecimalForValue(u[u.length-2]))/2);let C=u.length<3?.5:.25;o=Ur(o,0,C),l=Ur(l,0,C),this._offsets={start:o,end:l,factor:1/(o+1+l)}}_generate(){let u=this._adapter,o=this.min,l=this.max,i=this.options,_=i.time,C=_.unit||lD(_.minUnit,o,l,this._getLabelCapacity(o)),I=qi(i.ticks.stepSize,1),O=C==="week"?_.isoWeekday:!1,N=qh(O)||O===!0,q={},ie=o,de,xe;if(N&&(ie=+u.startOf(ie,"isoWeek",O)),ie=+u.startOf(ie,N?"day":C),u.diff(l,o,C)>1e5*I)throw new Error(o+" and "+l+" are too far apart with stepSize of "+I+" "+C);let ke=i.ticks.source==="data"&&this.getDataTimestamps();for(de=ie,xe=0;de<l;de=+u.add(de,I,C),xe++)cD(q,de,ke);return(de===l||i.bounds==="ticks"||xe===1)&&cD(q,de,ke),Object.keys(q).sort(aD).map(Ae=>+Ae)}getLabelForValue(u){let o=this._adapter,l=this.options.time;return l.tooltipFormat?o.format(u,l.tooltipFormat):o.format(u,l.displayFormats.datetime)}format(u,o){let i=this.options.time.displayFormats,_=this._unit,C=o||i[_];return this._adapter.format(u,C)}_tickFormatFunction(u,o,l,i){let _=this.options,C=_.ticks.callback;if(C)return Un(C,[u,o,l],this);let I=_.time.displayFormats,O=this._unit,N=this._majorUnit,q=O&&I[O],ie=N&&I[N],de=l[o],xe=N&&ie&&de&&de.major;return this._adapter.format(u,i||(xe?ie:q))}generateTickLabels(u){let o,l,i;for(o=0,l=u.length;o<l;++o)i=u[o],i.label=this._tickFormatFunction(i.value,o,u)}getDecimalForValue(u){return u===null?NaN:(u-this.min)/(this.max-this.min)}getPixelForValue(u){let o=this._offsets,l=this.getDecimalForValue(u);return this.getPixelForDecimal((o.start+l)*o.factor)}getValueForPixel(u){let o=this._offsets,l=this.getDecimalForPixel(u)/o.factor-o.end;return this.min+l*(this.max-this.min)}_getLabelSize(u){let o=this.options.ticks,l=this.ctx.measureText(u).width,i=Ua(this.isHorizontal()?o.maxRotation:o.minRotation),_=Math.cos(i),C=Math.sin(i),I=this._resolveTickFontOptions(0).size;return{w:l*_+I*C,h:l*C+I*_}}_getLabelCapacity(u){let o=this.options.time,l=o.displayFormats,i=l[o.unit]||l.millisecond,_=this._tickFormatFunction(u,0,dD(this,[u],this._majorUnit),i),C=this._getLabelSize(_),I=Math.floor(this.isHorizontal()?this.width/C.w:this.height/C.h)-1;return I>0?I:1}getDataTimestamps(){let u=this._cache.data||[],o,l;if(u.length)return u;let i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(o=0,l=i.length;o<l;++o)u=u.concat(i[o].controller.getAllParsedValues(this));return this._cache.data=this.normalize(u)}getLabelTimestamps(){let u=this._cache.labels||[],o,l;if(u.length)return u;let i=this.getLabels();for(o=0,l=i.length;o<l;++o)u.push(sD(this,i[o]));return this._cache.labels=this._normalized?u:this.normalize(u)}normalize(u){return aw(u.sort(aD))}}return d})();function ty(d,s,u){let o=0,l=d.length-1,i,_,C,I;u?(s>=d[o].pos&&s<=d[l].pos&&({lo:o,hi:l}=Ys(d,"pos",s)),{pos:i,time:C}=d[o],{pos:_,time:I}=d[l]):(s>=d[o].time&&s<=d[l].time&&({lo:o,hi:l}=Ys(d,"time",s)),{time:i,pos:C}=d[o],{time:_,pos:I}=d[l]);let O=_-i;return O?C+(I-C)*(s-i)/O:C}var tC=class extends eC{static id="timeseries";static defaults=eC.defaults;constructor(s){super(s),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let s=this._getTimestampsForTable(),u=this._table=this.buildLookupTable(s);this._minPos=ty(u,this.min),this._tableRange=ty(u,this.max)-this._minPos,super.initOffsets(s)}buildLookupTable(s){let{min:u,max:o}=this,l=[],i=[],_,C,I,O,N;for(_=0,C=s.length;_<C;++_)O=s[_],O>=u&&O<=o&&l.push(O);if(l.length<2)return[{time:u,pos:0},{time:o,pos:1}];for(_=0,C=l.length;_<C;++_)N=l[_+1],I=l[_-1],O=l[_],Math.round((N+I)/2)!==O&&i.push({time:O,pos:_/(C-1)});return i}_generate(){let s=this.min,u=this.max,o=super.getDataTimestamps();return(!o.includes(s)||!o.length)&&o.splice(0,0,s),(!o.includes(u)||o.length===1)&&o.push(u),o.sort((l,i)=>l-i)}_getTimestampsForTable(){let s=this._cache.all||[];if(s.length)return s;let u=this.getDataTimestamps(),o=this.getLabelTimestamps();return u.length&&o.length?s=this.normalize(u.concat(o)):s=u.length?u:o,s=this._cache.all=s,s}getDecimalForValue(s){return(ty(this._table,s)-this._minPos)/this._tableRange}getValueForPixel(s){let u=this._offsets,o=this.getDecimalForPixel(s)/u.factor-u.end;return ty(this._table,o*this._tableRange+this._minPos,!0)}},tV=Object.freeze({__proto__:null,CategoryScale:LN,LinearScale:Xw,LogarithmicScale:Qw,RadialLinearScale:Jw,TimeScale:eC,TimeSeriesScale:tC}),uy=[h4,zB,AN,tV];Jm.register(...uy);var iV=["chartContainer"];Jm.register(...uy);var PD=(()=>{let s=class s{constructor(o,l,i){this.http=o,this.router=l,this.razorpayService=i,this.apiUrl=xn,this.earn=null,this.years=[],this.selectedYear=0,this.selectedMonth=0,this.months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.currentWeek=0,this.totalWeeks=0,this.allChartData=[],this.allLabelsData=[],this.dateRange="",this.credits=this.razorpayService.userCredit;for(let _=2022;_<=2030;_++)this.years.push(_)}ngOnInit(){this.initializeChart(),this.loadDefaultEarnings()}initializeChart(){let o=document.getElementById("MyChart");this.chart=new Jm(o,{type:"bar",data:{labels:[],datasets:[{data:[],backgroundColor:"limegreen",barPercentage:.8,categoryPercentage:.8}]},options:{aspectRatio:1.8,plugins:{tooltip:{enabled:!1}},scales:{y:{display:!1},x:{display:!0,grid:{display:!1}}}}}),this.chart.canvas.addEventListener("click",l=>{let i=this.chart.getElementsAtEventForMode(l,"nearest",{intersect:!0},!1);if(i.length>0){let _=i[0],C=this.chart.data.labels[_.index],I=this.chart.data.datasets[_.datasetIndex].data[_.index];this.earn=I}})}loadDefaultEarnings(){let o=new Date;this.selectedYear=o.getFullYear(),this.selectedMonth=o.getMonth(),this.updateChartData(this.selectedYear,this.selectedMonth)}onYearMonthChange(){this.selectedYear!==0&&this.selectedMonth!==0&&this.updateChartData(this.selectedYear,this.selectedMonth)}updateChartData(o,l){let i=localStorage.getItem("providerId"),_=`${this.apiUrl}providers/earnings/get-earnings/${i}`;this.http.get(_).subscribe(C=>{console.log("API Response:",C);let O=C.sort((q,ie)=>{let de=new Date(q.date),xe=new Date(ie.date);return de.getTime()-xe.getTime()}).filter(q=>{let ie=new Date(q.date);return ie.getFullYear()===o&&ie.getMonth()===l});console.log("Filtered Data:",O);let N=this.transformData(O,o,l);this.allChartData=N.data,this.allLabelsData=N.labels,this.totalWeeks=Math.ceil(this.allChartData.length/7),this.currentWeek=0,this.displayCurrentWeek()},C=>{console.error(C)})}transformData(o,l,i){let _=new Date(l,i+1,0).getDate(),C=Array.from({length:_},(O,N)=>(N+1).toString()),I=new Array(_).fill(0);return o.forEach(O=>{let q=new Date(O.date).getDate();I[q-1]+=O.amount}),console.log("Transformed Data:",{labels:C,amounts:I}),{labels:C,data:I}}displayCurrentWeek(){let o=this.currentWeek*7,l=o+7,i=this.allLabelsData.slice(o,l),_=this.allChartData.slice(o,l);console.log("Week Labels:",i),console.log("Week Data:",_),this.chart.data.labels=i,this.chart.data.datasets[0].data=_,this.chart.update(),this.updateDateRange(i)}updateDateRange(o){if(o.length>0){let l=this.selectedYear,i=this.selectedMonth,_=new Date(l,i,parseInt(o[0])),C=new Date(l,i,parseInt(o[o.length-1]));this.dateRange=`${_.toDateString()} - ${C.toDateString()}`}else this.dateRange=""}previousWeek(){this.currentWeek>0?this.currentWeek--:this.navigateMonth("previous"),this.displayCurrentWeek()}nextWeek(){this.currentWeek<this.totalWeeks-1?this.currentWeek++:this.navigateMonth("next"),this.displayCurrentWeek()}navigateMonth(o){o==="previous"?this.selectedMonth===0?Number(this.selectedYear)>this.years[0]&&(this.selectedYear--,this.selectedMonth=11):this.selectedMonth--:this.selectedMonth===11?this.selectedYear<this.years[this.years.length-1]&&(this.selectedYear++,this.selectedMonth=0):this.selectedMonth++,this.updateChartData(this.selectedYear,this.selectedMonth)}navToCredit(){this.router.navigate(["credits"])}navToMenu(){this.router.navigate(["menu"])}navToPackage(){this.router.navigate(["packages"])}};s.\u0275fac=function(l){return new(l||s)(ye(Zi),ye(jt),ye(Xo))},s.\u0275cmp=gt({type:s,selectors:[["app-earnings"]],viewQuery:function(l,i){if(l&1&&Ci(iV,5),l&2){let _;vi(_=xi())&&(i.chartContainer=_.first)}},decls:76,vars:5,consts:[["chartContainer",""],[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell"],[1,"material-symbols-outlined"],[1,"sub-container"],[1,"chart-container"],[1,"chart-navigation"],[2,"font-size","36px",3,"click"],[1,"date-range"],[1,"scroll-container"],[1,"icon2"],["id","MyChart"],[1,"bank-transfer"],[1,"middle-text"],[1,"withdraw-div"],[1,"big-text"],[1,"credit-div"],[1,"icon-credit"],[1,"icon"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"credit1"],[1,"title"],[1,"material-symbols-outlined",3,"click"],[1,"credit-div",3,"click"],[1,"package"],["src","assets/packages/silver coin 1.png",1,"package-img"],[2,"height","5rem"]],template:function(l,i){if(l&1){let _=si();V(0,"div",1)(1,"div",2),Fe("click",function(){return Ct(_),St(i.navToMenu())}),X(2,"\u2630"),j(),V(3,"div",3)(4,"div",4),Fe("click",function(){return Ct(_),St(i.navToCredit())}),Me(5,"img",5),V(6,"pre"),X(7),j()(),V(8,"div",6)(9,"span",7),X(10,"notifications"),j()()(),V(11,"div",8)(12,"div",9)(13,"div",10)(14,"span",11),Fe("click",function(){return Ct(_),St(i.previousWeek())}),X(15,"	<"),j(),V(16,"p",12),X(17),j(),V(18,"span",11),Fe("click",function(){return Ct(_),St(i.nextWeek())}),X(19,">"),j()(),V(20,"div",13,0)(22,"span",14),X(23,"\u20B9 \xA0"),V(24,"span"),X(25),j()(),Me(26,"br")(27,"br"),V(28,"canvas",15),X(29),j()()(),V(30,"div")(31,"div",16)(32,"span",17),X(33,"Bank transfer"),j(),V(34,"span",7),X(35,"chevron_right"),j()(),Me(36,"br"),V(37,"div",18)(38,"div")(39,"span",19),X(40,"\u20B9 1897"),j(),V(41,"span",17),X(42,"28-29 Mar"),j(),V(43,"span",17),X(44,"Upcoming"),j()(),V(45,"div")(46,"span",19),X(47,"\u20B9 176"),j(),V(48,"span",17),X(49,"26-27 Mar"),j(),V(50,"span",17),X(51,"Success"),j()()()(),V(52,"div",20)(53,"div",21)(54,"div",22)(55,"span",23),X(56,"poker_chip"),j()(),X(57," \xA0 \xA0 "),V(58,"div",24)(59,"span",25),X(60,"Credits"),j(),V(61,"span",25),X(62),j()()(),V(63,"span",26),Fe("click",function(){return Ct(_),St(i.navToCredit())}),X(64,"chevron_right"),j()(),V(65,"div",27),Fe("click",function(){return Ct(_),St(i.navToPackage())}),V(66,"div",21)(67,"span",28),Me(68,"img",29),X(69,"\xA0 "),V(70,"pre"),X(71,"Silver"),j()()(),V(72,"span",26),Fe("click",function(){return Ct(_),St(i.navToPackage())}),X(73,"chevron_right"),j()()()(),Me(74,"div",30)(75,"app-fotter")}l&2&&(pe(7),Rt(i.credits),pe(10),Rt(i.dateRange),pe(8),Rt(i.earn),pe(4),Rt(i.chart),pe(33),Rt(i.credits))},dependencies:[$s],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100%;height:100%}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#d16611;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:8rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:5rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border-radius:.4rem;border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh;display:grid;row-gap:2rem}.chart-container[_ngcontent-%COMP%]{width:100%;height:fit-content;display:grid;row-gap:1rem;box-shadow:0 5px 5px #00000080;border-radius:.5rem}.scroll-container[_ngcontent-%COMP%]{position:relative;width:100%;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}#MyChart[_ngcontent-%COMP%]{background-color:#d6ffdf3b;width:100%;display:inline-block;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none;min-width:100%}.chart-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .chart-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{float:left;text-align:left}.icon2[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.8rem;font-weight:500;line-height:24.2px;color:#49a010;float:left;text-align:left;display:flex;margin-left:1rem}.earning-tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:24.2px;float:left;text-align:left}.bank-transfer[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.withdraw-div[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:49% 49%;column-gap:2%}.withdraw-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:grid;padding:1rem;row-gap:0;height:120px;border:.25px solid black;border-radius:.5rem}.credit-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;height:2rem}.icon[_ngcontent-%COMP%]{width:2rem;height:2rem;border-radius:.4rem;border:.25px solid black}.icon-credit[_ngcontent-%COMP%]{display:flex;width:30%;height:2rem}.credit1[_ngcontent-%COMP%]{display:grid;border:none;justify-content:space-around}.rank[_ngcontent-%COMP%]{display:grid;float:left;text-align:left}.title[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:22.94px}.middle-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px}.big-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:20px;font-weight:600;line-height:19.36px}.date-div[_ngcontent-%COMP%]{width:100%;display:flex;column-gap:.5rem}.date-div[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:10rem;height:2rem;border:.25px solid black}.chart-navigation[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.date-range[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"inter" sans-serif;font-weight:500}.package[_ngcontent-%COMP%]{width:max-content;height:2rem;padding:0 .3rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.package-img[_ngcontent-%COMP%]{width:1.3rem;height:1.3rem}.package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1rem;line-height:1.7rem}']});let d=s;return d})();var OD=(()=>{let s=class s{constructor(o){this.router=o}navToHome(){this.router.navigate(["home"])}};s.\u0275fac=function(l){return new(l||s)(ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-waiting-page"]],decls:10,vars:0,consts:[[1,"container"],[1,"sub-container"],["src","assets/new/Man playing Basketball.gif"],[3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div"),Me(3,"img",2)(4,"br")(5,"br"),V(6,"p"),X(7,"Thanks for uploading your documents, your documents are under review. We will let you once you ready to work."),j()()(),V(8,"button",3),Fe("click",function(){return i.navToHome()}),X(9,"Next"),j()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:3rem}.sub-container[_ngcontent-%COMP%]{width:80%;margin-top:-5rem;height:max-content;display:grid;align-items:center}.sub-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column}.sub-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60%;height:60%}p[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:16.94px;text-align:center;color:#00000080}button[_ngcontent-%COMP%]{width:90%;height:2.5rem;background:#d16611;color:#f0f8ff;font-size:1.1rem;font-weight:400;line-height:16.94px;border:none;border-radius:.5rem}']});let d=s;return d})();var RD=(()=>{let s=class s{constructor(o){this.router=o}};s.\u0275fac=function(l){return new(l||s)(ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-notification"]],decls:2,vars:0,template:function(l,i){l&1&&(V(0,"p"),X(1,"notification works!"),j())}});let d=s;return d})();var nV=["dialogTemplate"],rV=d=>({selected:d});function oV(d,s){if(d&1){let u=si();od(0),V(1,"div")(2,"p",3),Fe("click",function(){Ct(u);let l=ut();return St(l.extend())}),X(3,"expand_circle_right"),j()(),ad()}}function aV(d,s){if(d&1){let u=si();od(0),V(1,"span",17)(2,"input",18),Fe("change",function(){Ct(u);let l=ut().$implicit,i=ut();return St(i.availabilityService(l.nameOfService))}),j(),X(3,"\xA0 "),V(4,"span",19),X(5),j()(),ad()}if(d&2){let u=ut().$implicit,o=ut();pe(2),Le("checked",o.selectedService===u.nameOfService),pe(3),Rt(u.nameOfService)}}function sV(d,s){if(d&1){let u=si();od(0),V(1,"span",3),Fe("click",function(){Ct(u);let l=ut(2);return St(l.openServiceDialog())}),X(2,"expand_circle_down"),j(),ad()}}function lV(d,s){if(d&1){let u=si();V(0,"div",20)(1,"span",21)(2,"input",18),Fe("change",function(){Ct(u);let l=ut().$implicit,i=ut();return St(i.availabilityService(l.nameOfService))}),j(),V(3,"span",19),X(4),j()()()}if(d&2){let u=ut().$implicit,o=ut();pe(2),Le("checked",o.selectedService===u.nameOfService),pe(2),Rt(u.nameOfService)}}function cV(d,s){if(d&1&&(od(0),Bt(1,aV,6,2,"ng-container",4)(2,sV,3,0,"ng-container",4)(3,lV,5,2,"div",16),ad()),d&2){let u=s.index,o=ut();pe(),Le("ngIf",u<=1&&!o.extendServices),pe(),Le("ngIf",u===2&&!o.extendServices),pe(),Le("ngIf",o.extendServices)}}function dV(d,s){if(d&1){let u=si();od(0),V(1,"div",22),Fe("click",function(){let l=Ct(u),i=l.$implicit,_=l.index,C=ut();return St(C.selected(i,_))}),V(2,"p"),X(3),j(),V(4,"p"),X(5),j(),V(6,"span",23),X(7),j()(),ad()}if(d&2){let u=s.$implicit,o=s.index,l=ut();pe(),Le("ngClass",li(4,rV,l.selectedIndex===o)),pe(2),Rt(u.day.substring(0,3).toUpperCase()),pe(2),Rt(u.date.split("-")[0]),pe(2),Rt(u.workingStaus?"check":"close")}}function hV(d,s){if(d&1){let u=si();V(0,"div",28)(1,"span"),X(2),j(),V(3,"p")(4,"mat-slide-toggle",29),so("ngModelChange",function(l){let i=Ct(u).$implicit;return ao(i.isSelected,l)||(i.isSelected=l),St(l)}),Fe("change",function(l){let i=Ct(u).$implicit,_=ut(2);return St(_.onToggleChange(l,i))}),j()()()}if(d&2){let u=s.$implicit;pe(2),Rt(u.time),pe(2),oo("ngModel",u.isSelected)}}function uV(d,s){if(d&1&&(V(0,"div",24)(1,"div",25)(2,"span",12),X(3,"check"),j(),V(4,"p"),X(5,"confirmation your working hours"),j(),V(6,"span",12),X(7,"expand_circle_up"),j()(),Me(8,"br")(9,"div",26),Bt(10,hV,5,2,"div",27),j()),d&2){let u=ut();pe(10),Le("ngForOf",u.nextDaysOfIndex.timming)}}function mV(d,s){if(d&1){let u=si();V(0,"div")(1,"div",34)(2,"input",18),Fe("change",function(){let l=Ct(u).$implicit,i=ut(2);return St(i.availabilityService(l.nameOfService))}),j(),X(3," \xA0"),V(4,"span",35),X(5),j()()()}if(d&2){let u=s.$implicit,o=ut(2);pe(2),Le("checked",o.selectedService===u.nameOfService),pe(3),Rt(u.nameOfService)}}function pV(d,s){if(d&1){let u=si();V(0,"h1",30),X(1,"Select Services"),j(),V(2,"div",31)(3,"form"),Bt(4,mV,6,2,"div",5),j()(),V(5,"div",32)(6,"button",33),Fe("click",function(){Ct(u);let l=ut();return St(l.onCancel())}),X(7,"Cancel"),j(),V(8,"button",33),Fe("click",function(){Ct(u);let l=ut();return St(l.onSubmit())}),X(9,"Submit"),j()()}if(d&2){let u=ut();pe(4),Le("ngForOf",u.services)}}var LD=(()=>{let s=class s{constructor(o,l,i,_,C,I,O){this.location=o,this.renderer=l,this.el=i,this.http=_,this.dialog=C,this.jobDetailsService=I,this.userService=O,this.date=new Date,this.userId=localStorage.getItem("providerId"),this.apiUrl=xn,this.defaultMonth=this.date.toLocaleDateString("default",{month:"long"}),this.daySelected=String(this.date.getDate()).padStart(2,"0"),this.monthSelected=this.defaultMonth.substring(0,3),this.dateSelected=this.date.getDate(),this.isChecked=!1,this.working=!1,this.extendServices=!1,this.services=[],this.nextFourDays=[],this.nextDaysOfIndex=[],this.selectedService="",this.timing=[{time:"07:00AM - 10:00AM",isSelected:!1},{time:"10:00AM - 01:00PM",isSelected:!1},{time:"01:00PM - 04:00PM",isSelected:!1},{time:"04:00PM - 07:00PM",isSelected:!1}],this.selectedIndex=0,this.api="",this.availabilityResponse=[]}extend(){this.extendServices=!this.extendServices}openServiceDialog(){this.dialogRef=this.dialog.open(this.dialogTemplate),this.dialogRef.afterClosed().subscribe(o=>{o&&(this.services=o)})}onCancel(){this.dialogRef.close()}onSubmit(){this.dialogRef.close(this.services)}ngOnInit(){this.getDetails(),this.getNextFourDays();let o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];this.daySelected=o[this.date.getDay()],this.getSelectedService()}getSelectedService(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(o=>{console.log(o),this.services=o[0].works},o=>{console.log(o)})}availabilityService(o){this.selectedService=o,this.showAvailabilityForService(o)}getNextFourDays(){let o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=new Date;for(let i=0;i<10;i++){let _=new Date(l);_.setDate(l.getDate()+i);let C=this.formatDate(_);this.nextFourDays.push({date:C,day:o[_.getDay()],workingStaus:!1,timming:this.timing.map(I=>$i({},I))})}this.nextDaysOfIndex=this.nextFourDays[this.selectedIndex]}formatDate(o){let l=String(o.getDate()).padStart(2,"0"),i=o.getFullYear(),_=o.toLocaleDateString("default",{month:"long"});return`${l}-${_}-${i}`}selected(o,l){console.log(o),this.isChecked=!1,o.workingStaus?this.working=!0:this.working=!1,this.selectedIndex=l,this.dateSelected=o.date.toString().split("-")[0],this.daySelected=o.day,this.monthSelected=o.date.toString().split("-")[1],this.yearSelected=o.date.toString().split("-")[2],this.nextDaysOfIndex=this.nextFourDays[this.selectedIndex],console.log(this.nextDaysOfIndex),console.log(this.monthSelected),this.timing.forEach(i=>i.isSelected=!1)}workingChange(){this.nextFourDays[this.selectedIndex].workingStaus=!this.nextFourDays[this.selectedIndex].workingStaus}onToggleChange(o,l){this.nextDaysOfIndex.timming.forEach(q=>{q.time===l.time&&(q.isSelected=o.checked)}),this.timeSelected=o.checked?l.time:"",console.log(this.dateSelected);let i=new Date(`${this.monthSelected} ${this.dateSelected} ${this.yearSelected}`);i.setDate(this.dateSelected);let _=i.getDate(),C=i.getMonth()+1,I=_<10?`0${_}`:_,O=C<10?`0${C}`:C,N=this.yearSelected;this.fullDate=`${N}-${O}-${I}`,console.log(O)}submitAllData(){console.log(this.checkDuplicate(this.fullDate,this.timeSelected,this.selectedService)),this.checkDuplicate(this.fullDate,this.timeSelected,this.selectedService)?alert("The same time slot on the selected date for the selected service is already taken."):this.sendingData()}sendingData(){this.timeSelected!=""?this.api=`${this.apiUrl}providers/provider-date`:this.api=`${this.apiUrl}providers/provider-date/delete`;let o={providerId:this.userId,service:this.selectedService,date:this.fullDate,availability:this.working,time:this.timeSelected};console.log(o),console.log(this.api),this.http.post(this.api,o).subscribe(l=>{console.log(l),alert("Availability added successfully"),this.timing.forEach(i=>i.isSelected=!1),console.log(this.timing),this.getDetails()},l=>{console.log(l),alert("Something went wrong")})}getDetails(){let o=`${this.apiUrl}providers/provider-date/${this.userId}`;this.http.get(o).subscribe(l=>{console.log(l),this.availabilityResponse=l,this.showAvailability(this.availabilityResponse)},l=>{console.log(l)})}deleteData(){}showAvailability(o){console.log(this.services),o.forEach(l=>{let i=l.date,_=new Date(i),C=_.getDate(),I=_.toLocaleDateString("default",{month:"long"}),O=`${String(C).padStart(2,"0")}-${I}-${_.getFullYear()}`;this.nextFourDays.forEach(N=>{N.date===O&&(N.workingStaus=l.work,N.timming.forEach(q=>{q.time===l.time&&(q.isSelected=!0)}))})}),console.log(this.nextFourDays)}checkDuplicate(o,l,i){return this.availabilityResponse.some(_=>_.date===o&&_.time===l&&_.service===i)}navToBack(){this.location.back()}showAvailabilityForService(o){console.log("new called"),this.nextFourDays.forEach(l=>{l.workingStaus=!1,l.timming.forEach(i=>{i.isSelected=!1})}),console.log(this.availabilityResponse),this.availabilityResponse.forEach(l=>{if(l.service===o){let i=l.date,_=new Date(i),C=_.getDate(),I=_.toLocaleDateString("default",{month:"long"}),O=`${String(C).padStart(2,"0")}-${I}-${_.getFullYear()}`;this.nextFourDays.forEach(N=>{O===N.date&&(N.workingStaus=!0,N.timming.forEach(q=>{q.time===l.time&&(q.isSelected=!0)}))})}})}};s.\u0275fac=function(l){return new(l||s)(ye(Li),ye(JM),ye(sn),ye(Zi),ye(Fm),ye(Or),ye(vr))},s.\u0275cmp=gt({type:s,selectors:[["app-calender"]],viewQuery:function(l,i){if(l&1&&Ci(nV,5),l&2){let _;vi(_=xi())&&(i.dialogTemplate=_.first)}},decls:27,vars:12,consts:[["dialogTemplate",""],[1,"container"],[1,"headers"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"sub-container"],[1,"working-dates"],[1,"selected-date"],[1,"update"],[1,"custom-checkbox"],["type","checkbox",3,"change","ngModelChange","checked","ngModel"],[1,"material-symbols-outlined",2,"font-size","28px"],["class","confirmation-div",4,"ngIf"],[3,"click"],[2,"width","300px"],["class","extended",4,"ngIf"],[2,"display","flex","align-items","center","justify-content","center"],["type","checkbox",3,"change","checked"],[1,"service-tittle"],[1,"extended"],[1,"service"],[1,"datess",3,"click","ngClass"],[1,"material-symbols-outlined"],[1,"confirmation-div"],[1,"conformation"],[1,"line"],["class","time-confirm",4,"ngFor","ngForOf"],[1,"time-confirm"],["color","accent",3,"ngModelChange","change","ngModel"],["mat-dialog-title",""],["mat-dialog-content","",2,"width","300px"],["mat-dialog-actions","",2,"display","flex","justify-content","space-evenly"],["mat-button","",2,"width","30%","height","2rem",3,"click"],[2,"display","flex","align-items","center","width","100%","height","3rem"],[2,"color","black"]],template:function(l,i){if(l&1){let _=si();V(0,"div",1)(1,"div",2)(2,"span",3),Fe("click",function(){return Ct(_),St(i.navToBack())}),X(3,"arrow_back"),j(),Bt(4,oV,4,0,"ng-container",4)(5,cV,4,3,"ng-container",5),j(),Me(6,"br")(7,"br"),V(8,"div",6)(9,"div",7),Bt(10,dV,8,6,"ng-container",5),j(),V(11,"div",8)(12,"span"),X(13),j()(),V(14,"div",9)(15,"div")(16,"label",10)(17,"input",11),Fe("change",function(){return Ct(_),St(i.workingChange())}),so("ngModelChange",function(I){return Ct(_),ao(i.working,I)||(i.working=I),St(I)}),j()(),V(18,"span"),X(19,"Working"),j()(),V(20,"span",12),X(21),j()(),Bt(22,uV,11,1,"div",13),V(23,"button",14),Fe("click",function(){return Ct(_),St(i.submitAllData())}),X(24,"submit"),j()()(),Bt(25,pV,10,1,"ng-template",15,0,q0)}l&2&&(pe(4),Le("ngIf",i.extendServices),pe(),Le("ngForOf",i.services),pe(5),Le("ngForOf",i.nextFourDays),pe(3),sd("",i.daySelected,",",i.monthSelected," ",i.dateSelected,""),pe(3),ji("checked",i.isChecked),pe(),Le("checked",i.isChecked),oo("ngModel",i.working),pe(4),Rt(i.working?"expand_circle_right":"expand_circle_down"),pe(),Le("ngIf",i.working))},dependencies:[Co,br,lr,ko,ld,yr,Mo,Ws,pk,BT,VT,NT,pb],styles:['.container[_ngcontent-%COMP%]{width:90%;height:100vh;padding:1rem}.headers[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.service[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.service-tittle[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1.2rem;font-weight:400;line-height:16.94px;text-align:left}.extended[_ngcontent-%COMP%]{border:1px solid red}.sub-container[_ngcontent-%COMP%]{width:95%;position:relative;left:2.5%;display:grid;row-gap:3rem}.working-dates[_ngcontent-%COMP%]{width:100%;display:flex;column-gap:2rem;justify-content:space-between;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;flex-direction:row;-ms-overflow-style:none;scrollbar-width:none}.datess[_ngcontent-%COMP%]{width:5rem;height:5rem;display:flex;text-align:center;flex-direction:column;border:1px solid black;border-radius:.5rem;flex:0 0 20%;padding-top:1rem;padding-bottom:1rem}.datess.selected[_ngcontent-%COMP%]{background-color:#72d388;border:none;color:#fff}.selected-date[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;letter-spacing:.07em}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:#72d388;border:0}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}.btn[_ngcontent-%COMP%]{width:100%;align-items:center}button[_ngcontent-%COMP%]{width:100%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}.update[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-around;border:.25px solid black;border-radius:.4rem;align-items:center}.update[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%;display:flex;justify-content:space-around;text-align:center;align-items:center}.update[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px;letter-spacing:.07em;text-align:center;align-items:center}.confirmation-div[_ngcontent-%COMP%]{background:#fcf5fc;border:.25px solid rgba(0,0,0,1);border-radius:.4rem;padding:1rem}.conformation[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.line[_ngcontent-%COMP%]{height:1rem;border-bottom:.2px solid transparent;border-top:.25px dashed black}.time-confirm[_ngcontent-%COMP%]{display:flex;justify-content:space-between}']});let d=s;return d})();function fV(d,s){if(d&1){let u=si();V(0,"div",5),Fe("click",function(){let l=Ct(u).$implicit,i=ut();return St(i.selectedJob(l))}),V(1,"div")(2,"p")(3,"span",6),X(4),j()(),V(5,"p")(6,"span",7),Fe("click",function(){Ct(u);let l=ut();return St(l.navToBack())}),X(7,"account_balance_wallet"),j(),X(8,"\xA0 "),V(9,"span",8),X(10),j()(),V(11,"p")(12,"span",7),Fe("click",function(){Ct(u);let l=ut();return St(l.navToBack())}),X(13,"description"),j(),X(14,"\xA0 "),V(15,"span",8),X(16),j()()(),V(17,"div")(18,"p",6),X(19,"9:30"),j(),V(20,"p",8),X(21,"89-0"),j()()(),Me(22,"br")}if(d&2){let u=s.$implicit;pe(4),Rt(u.name),pe(6),Qi("Job value:",u.value,""),pe(6),Qi("Online Payments:",u.paymentDone,"")}}var FD=(()=>{let s=class s{navToBack(){this.location.back()}constructor(o,l,i){this.location=o,this.jobDetailsService=l,this.router=i,this.jobs=[{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"},{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"},{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"}]}selectedJob(o){console.log(o),this.jobDetailsService.selectedJobDetails(o),this.router.navigate(["jobDetails"])}};s.\u0275fac=function(l){return new(l||s)(ye(Li),ye(Or),ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-job-history"]],decls:11,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","24px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"section",3,"click"],[1,"main-text"],[1,"material-symbols-outlined",2,"font-size","1rem",3,"click"],[1,"text"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return i.navToBack()}),X(3,"arrow_back"),j(),X(4,"\xA0"),V(5,"span",3),X(6,"Job History"),j()(),V(7,"div",4)(8,"div"),gr(9,fV,23,3,null,null,ro),j()()()),l&2&&(pe(9),_r(i.jobs))},styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%}.section[_ngcontent-%COMP%]{width:100%;height:7rem;border:.25px solid black;border-radius:.5rem;display:flex;justify-content:space-between;align-items:center;text-align:center}.section[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:.5rem;display:flexbox;text-align:left}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:19.36px}.main-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:19.36px}.text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:14.52px}']});let d=s;return d})();function gV(d,s){if(d&1){let u=si();V(0,"div",16),Fe("click",function(){let l=Ct(u).$implicit,i=ut();return St(i.selected(l))}),X(1),j()}if(d&2){let u=s.$implicit;pe(),Rt(u)}}var zD=(()=>{let s=class s{navToBack(){this.location.back()}constructor(o,l,i){this.location=o,this.http=l,this.razorPayService=i,this.credits=[20,50,100,250],this.selectedValue=0,this.AmountToPay=0,this.payOnline=!1,this.deductNextPayout=!1}entredAmount(){this.AmountToPay=this.selectedValue}selected(o){this.selectedValue=o,this.AmountToPay=this.selectedValue}togglePayOnline(o){this.payOnline=!this.payOnline,this.payOnline&&(this.deductNextPayout=!1,this.makePayment())}toggleDeductNextPayout(){this.deductNextPayout=!this.deductNextPayout,this.deductNextPayout&&(this.payOnline=!1)}makePayment(){let o=this.AmountToPay;this.razorPayService.payWithRazorpay(o,"order_id_from_backend","INR")}};s.\u0275fac=function(l){return new(l||s)(ye(Li),ye(Zi),ye(Xo))},s.\u0275cmp=gt({type:s,selectors:[["app-add-credit"]],decls:32,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","32px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"credit-input"],["src","assets/logo/credit12.png"],["type","number","placeholder","Enter number of credits",3,"ngModelChange","input","value","ngModel"],[1,"quickSelect-div"],[1,"maintext"],[1,"selec-div"],["class","maintext",3,"click",4,"ngFor","ngForOf"],[1,"Amount-div"],[1,"selecPayment-div"],[1,"minText"],["type","checkbox",3,"change","checked"],[1,"maintext",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return i.navToBack()}),X(3,"arrow_back"),j(),X(4,"\xA0 "),V(5,"span",3),X(6,"Add credits"),j()(),V(7,"div",4)(8,"div",5),Me(9,"img",6),V(10,"input",7),so("ngModelChange",function(C){return ao(i.selectedValue,C)||(i.selectedValue=C),C}),Fe("input",function(){return i.entredAmount()}),j()(),V(11,"div",8)(12,"span",9),X(13,"Quick select"),j(),V(14,"div",10),Bt(15,gV,2,1,"div",11),j()(),V(16,"div",12)(17,"span",9),X(18,"Amount to pay"),j(),V(19,"p",9),X(20),j()(),V(21,"div",13)(22,"span",9),X(23,"Select payment method"),j(),Me(24,"br")(25,"br"),V(26,"p",14)(27,"input",15),Fe("change",function(C){return i.togglePayOnline(C)}),j(),X(28,"\xA0Pay Online "),j(),V(29,"p",14)(30,"input",15),Fe("change",function(){return i.toggleDeductNextPayout()}),j(),X(31,"\xA0Deduct from next payout "),j()()()()),l&2&&(pe(10),Le("value",i.selectedValue),oo("ngModel",i.selectedValue),pe(5),Le("ngForOf",i.credits),pe(5),Qi("\u20B9\xA0 ",i.AmountToPay,""),pe(7),Le("checked",i.payOnline),pe(3),Le("checked",i.deductNextPayout))},dependencies:[br,So,Q0,yr,Ws],styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.6rem;font-weight:500;line-height:19.36px}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%;display:grid;row-gap:2rem}.maintext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px}.minText[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:19.36px}.credit-input[_ngcontent-%COMP%]{height:3rem;width:100%;border:.25px solid black;border-radius:.4rem;display:flex;align-items:center;justify-content:space-around}.credit-input[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1rem;height:1rem}.credit-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80%;height:2.5rem;outline:0;border-width:0;font-size:1.2rem}.quickSelect-div[_ngcontent-%COMP%]{width:100%;height:max-content;display:grid;row-gap:1.5rem}.selec-div[_ngcontent-%COMP%]{width:100%;height:max-content;display:flex;flex-wrap:wrap;column-gap:3rem;row-gap:1.5rem}.selec-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{border:.25px solid black;width:4.8rem;height:2.5rem;display:flex;border-radius:.5rem;align-items:center;justify-content:center}.Amount-div[_ngcontent-%COMP%]{width:90%;height:4rem;display:flex;align-items:center;text-align:center;padding-left:5%;padding-right:5%;justify-content:space-between;border:.25px solid black;border-radius:.5rem}.minText[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}']});let d=s;return d})();var BD=(()=>{let s=class s{navToBack(){this.location.back()}constructor(o,l){this.location=o,this.userDetails=l,this.bankDetails=[],this.getUserDetails()}getUserDetails(){this.userDetails.getFinancialDetails().subscribe(o=>{console.log(o),this.bankDetails=o},o=>{console.log(o)})}};s.\u0275fac=function(l){return new(l||s)(ye(Li),ye(vr))},s.\u0275cmp=gt({type:s,selectors:[["app-financial-details"]],decls:61,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"gst-div"],[1,"largetext"],[1,"panDetails"],[1,"edit"],[1,"bankdetails"],[1,"normaltext"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return i.navToBack()}),X(3,"arrow_back"),j(),X(4,"\xA0 "),V(5,"span",3),X(6,"Financial details"),j()(),V(7,"div",4)(8,"div",5)(9,"span",6),X(10,"GST Details"),j(),V(11,"span",6),X(12,"Add+"),j()(),V(13,"div",7)(14,"p")(15,"span",6),X(16,"Aadhar Card details"),j(),V(17,"span",8),X(18,"Edit"),j()(),V(19,"p")(20,"span",6),X(21,"Aadhar "),j(),V(22,"span",6),X(23),j()()(),V(24,"div",7)(25,"p")(26,"span",6),X(27,"PAN Card details"),j(),V(28,"span",8),X(29,"Edit"),j()(),V(30,"p")(31,"span",6),X(32,"PAN "),j(),V(33,"span",6),X(34),j()()(),V(35,"div",9)(36,"p")(37,"span",6),X(38,"Bank account details"),j(),V(39,"span",8),X(40,"Edit"),j()(),V(41,"p")(42,"span",10),X(43,"Account number"),j(),V(44,"span",6),X(45),j()(),V(46,"p")(47,"span",10),X(48,"Bank name"),j(),V(49,"span",6),X(50),j()(),V(51,"p")(52,"span",10),X(53,"IFSC code"),j(),V(54,"span",6),X(55),j()(),V(56,"p")(57,"span",10),X(58,"Name in account"),j(),V(59,"span",6),X(60),j()()()()()),l&2&&(pe(23),Rt(i.bankDetails.aadhaarNumber),pe(11),Rt(i.bankDetails.pan),pe(11),Rt(i.bankDetails.accountNumber),pe(5),Rt(i.bankDetails.bankName),pe(5),Rt(i.bankDetails.ifscCode),pe(5),Rt(i.bankDetails.accountName))},styles:['.container[_ngcontent-%COMP%]{width:93vw;height:100vh;padding:1rem .5rem 0 1rem}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.5rem;font-weight:500;line-height:19.36px}.sub-container[_ngcontent-%COMP%]{width:97%;position:relative;top:3.5%;display:grid;row-gap:2rem}.gst-div[_ngcontent-%COMP%]{width:90%;height:4rem;border:.25px solid black;display:flex;justify-content:space-between;align-items:center;text-align:center;padding:5%;border-radius:.5rem}.panDetails[_ngcontent-%COMP%]{width:90%;height:5rem;border:.25px solid black;display:flex;flex-direction:column;row-gap:1rem;padding:5%;border-radius:.5rem}p[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;text-align:center}.bankdetails[_ngcontent-%COMP%]{width:90%;height:13rem;border:.25px solid black;display:flex;flex-direction:column;row-gap:1rem;padding:5%;border-radius:.5rem}.largetext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px}.edit[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px;color:#00000080}.normaltext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px}']});let d=s;return d})();var ND=(()=>{let s=class s{navToBack(){this.location.back()}navToHelp(){this.router.navigate(["help"])}constructor(o,l,i){this.jobDetailsService=o,this.location=l,this.router=i,this.orderDetails={_id:"669e626966dc877d8f903918",providerId:"669caa1c061e2bbc2ae85c1c",status:"Accepted",orderId:{_id:"669cec5b2646b0e97309c544",userId:"669115768f0d9e6728c61edd",addressId:"669caa31061e2bbc2ae85c24",address:{latitude:17.4975851,longitude:78.3961531,pincode:"500060",city:"Hyderabad",state:"Telangana",username:"Ramarao",mobileNumber:"9490856692"},paymentId:"pay_ObBS9ZdsRoztUF",categoryIds:["Lock smith"],subCategoryIds:["Key duplication & replacement"],items:[{serviceName:"Lost car key replacement & programming (transponder keys)",serviceVariants:[{variantName:"Normal cleaning",price:5e3,serviceTime:239,metric:"quantity",min:1,max:2}],quantity:1,selectedDate:"22",selectedTime:"9AM - 10AM",scheduledDate:"22-6-2024 9AM - 10AM"}]}},this.noJobs=this.orderDetails.orderId,this.jobDetailsService.getSelectedJob(),console.log(this.jobDetailsService.getSelectedJob())}};s.\u0275fac=function(l){return new(l||s)(ye(Or),ye(Li),ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-job-details"]],decls:65,vars:9,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","24px",3,"click"],[1,"help",3,"click"],[1,"sub-container"],[1,"name"],[1,"tittle"],[1,"customer-details"],[1,"sub-tittle"],[1,"Details"],[1,"para-section"],[1,"highlight-text"],[1,"line"],[1,"time-div"],[1,"summary"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return i.navToBack()}),X(3,"arrow_back"),j(),V(4,"div",3),Fe("click",function(){return i.navToHelp()}),X(5,"Help?"),j()(),V(6,"div",4)(7,"div",5)(8,"span",6),X(9),j(),V(10,"span"),X(11),j()(),V(12,"div",7)(13,"span",8),X(14,"Customers Details"),j(),V(15,"div",9)(16,"p",10)(17,"span",11),X(18,"Location"),j(),V(19,"span"),X(20),j()(),Me(21,"div",12)(22,"br"),V(23,"div",13)(24,"p",10)(25,"span",11),X(26,"Job start"),j(),V(27,"span"),X(28," 12 Apr 06:30 PM "),j()(),V(29,"p",10)(30,"span",11),X(31,"Job End"),j(),V(32,"span"),X(33,"12 Apr 07:30 PM"),j()()()()(),V(34,"div",14)(35,"span",8),X(36,"Summary"),j(),V(37,"div",9)(38,"div",13)(39,"span",11),X(40),j(),V(41,"span",8),X(42),j()(),Me(43,"div",12)(44,"br"),V(45,"div",13)(46,"p")(47,"span"),X(48,"Others"),j(),Me(49,"br"),V(50,"span",11),X(51,"Convenience Fee"),j()(),V(52,"p",8),X(53,"69"),j()(),Me(54,"div",12)(55,"br"),V(56,"div",13)(57,"p")(58,"span",11),X(59,"Total value"),j(),Me(60,"br"),V(61,"span"),X(62,"commission 5 credits"),j()(),V(63,"p",8),X(64),j()()()()()()),l&2&&(pe(9),Rt(i.orderDetails.orderId.address.username),pe(2),Rt(i.orderDetails.orderId.items[0].scheduledDate),pe(9),sd(" ",i.orderDetails.orderId.address.city,", ",i.orderDetails.orderId.address.state,", ",i.orderDetails.orderId.address.pincode," "),pe(20),Us("",i.orderDetails.orderId.items[0].quantity," \xA0 X \xA0 ",i.orderDetails.orderId.categoryIds,""),pe(2),Qi("\u20B9 \xA0",i.orderDetails.orderId.items[0].serviceVariants[0].price,""),pe(22),Rt(i.orderDetails.orderId.items[0].serviceVariants[0].price))},styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;justify-content:space-between;align-items:center}.help[_ngcontent-%COMP%]{width:4rem;height:2.5rem;border:none;background:#20193f;border-radius:1.3rem;color:#fff;display:flex;justify-content:center;align-items:center}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:19.36px;margin-bottom:1rem}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%;display:grid;row-gap:1.5rem}.name[_ngcontent-%COMP%]{position:relative;left:5%;display:flex;flex-direction:column}.sub-tittle[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;padding:0 0 1rem 1rem;margin-bottom:.5rem}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:600;line-height:16.94px;margin-bottom:.5rem}.customer-details[_ngcontent-%COMP%]{padding-top:1rem;display:grid;row-gap:1rem}.time-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.Details[_ngcontent-%COMP%]{width:90%;padding:1rem;border:.25px solid black;border-radius:.5rem}.summary[_ngcontent-%COMP%]{padding-top:1rem;display:grid;row-gap:1rem}.line[_ngcontent-%COMP%]{border:0;border-bottom:1px dashed rgb(45,44,44)}.para-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}']});let d=s;return d})();function _V(d,s){if(d&1&&(V(0,"div")(1,"label",6),Me(2,"input",7),j(),X(3," \xA0 "),V(4,"span",3),X(5),j()(),Me(6,"br")),d&2){let u=s.$implicit;pe(),ji("checked",u.checked),pe(),Le("checked",u.checked),pe(3),Rt(u.name)}}var VD=(()=>{let s=class s{navToBack(){this.location.back()}constructor(o){this.location=o,this.items=[{name:"Contact Details",checked:!0},{name:"Aadhar card",checked:!0},{name:"Bank Details",checked:!0},{name:"Professional documents",checked:!1}]}toggleCheckbox(){}};s.\u0275fac=function(l){return new(l||s)(ye(Li))},s.\u0275cmp=gt({type:s,selectors:[["app-identity-verification"]],decls:13,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"para"],[1,"verify-div"],[1,"custom-checkbox"],["type","checkbox","disabled","",3,"checked"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return i.navToBack()}),X(3,"arrow_back"),j(),X(4,"\xA0 "),V(5,"span",3),X(6,"Identity Verification"),j()(),V(7,"div",4)(8,"p"),X(9,"We were to successfully verify your details . As a part of our quality process we will request you to re-verify the information every 5months "),j()(),V(10,"div",5),gr(11,_V,7,4,null,null,ro),j()()),l&2&&(pe(11),_r(i.items))},styles:['.container[_ngcontent-%COMP%]{width:92vw;padding:1rem;display:grid;row-gap:2rem}.para[_ngcontent-%COMP%]{background-color:#ef8c534d;width:90%;padding:1rem;border-radius:.5rem;color:#ffa800}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:green}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}input[type=checkbox][disabled][_ngcontent-%COMP%]{cursor:not-allowed;background-color:#f0f0f0}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.5rem;font-weight:500;line-height:19.36px}']});let d=s;return d})();var bV=["footer"],yV=d=>({active:d});function vV(d,s){if(d&1){let u=si();V(0,"button",13),Fe("click",function(){let l=Ct(u).$implicit,i=ut();return St(i.setActiveButton(l))}),X(1),j()}if(d&2){let u=s.$implicit,o=ut();Le("ngClass",li(2,yV,o.activeButton===u)),pe(),Qi(" ",u," ")}}function xV(d,s){if(d&1){let u=si();V(0,"span",15)(1,"a",20)(2,"span",6),X(3," call "),j()(),V(4,"span",6),X(5," chat "),j(),V(6,"span",21),Fe("click",function(){Ct(u);let l=ut(2);return St(l.navToArrived())}),X(7," directions "),j()()}}function wV(d,s){if(d&1&&(V(0,"div",14)(1,"span",15)(2,"span",16),X(3),j(),Bt(4,xV,8,0,"span",17),j(),V(5,"span",16),X(6),j(),V(7,"span",18),X(8),j(),V(9,"span",19)(10,"span",18),X(11),j(),V(12,"span",16),X(13),j()(),V(14,"span",18),X(15),j()()),d&2){let u=s.$implicit;pe(3),Rt(u.orderId.address.username),pe(),Le("ngIf",u.status==="Accepted"||u.status==="InProgress"),pe(2),Rt(u.orderId.categoryIds[0]),pe(2),Rt(u.orderId.subCategoryIds[0]),pe(3),Rt(u.orderId.items[0].scheduledDate),pe(2),Rt(u.orderId.items[0].serviceVariants[0].price),pe(2),sd("",u.orderId.address.city," ",u.orderId.address.state," ",u.orderId.address.pincode,"")}}var jD=(()=>{let s=class s{navBack(){this.location.back()}constructor(o,l,i,_){this.location=o,this.router=l,this.razorpayService=i,this.orderService=_,this.buttons=["Ongoing","Pending","Completed","Cancelled"],this.activeButton="Ongoing",this.text=this.activeButton,this.filterStatus="Accepted",this.credits=this.razorpayService.userCredit,this.getOrderDetails()}getOrderDetails(){this.orderService.orderHistory().subscribe({next:o=>{console.log(o),this.order=o,this.filterOrder()},error:o=>{console.log(o)}})}setActiveButton(o){this.activeButton=o,this.text=o,this.assignOrder()}assignOrder(){switch(this.activeButton){case"Ongoing":this.filterStatus="Accepted";break;case"Pending":this.filterStatus="InProgress";break;case"Completed":this.filterStatus="Completed";break;case"Cancelled":this.filterStatus="Cancelled";break}this.filterOrder()}filterOrder(){let o=this.order.filter(l=>l.status.toLowerCase().includes(this.filterStatus.toLowerCase()));console.log(o),this.filteredOrder=o}navTo(o){switch(o){case"credit":this.router.navigate(["credits"]);break;case"notification":this.router.navigate(["notification"]);break;case"menu":this.router.navigate(["menu"])}}navToArrived(){this.router.navigate(["arrived"])}};s.\u0275fac=function(l){return new(l||s)(ye(Li),ye(jt),ye(Xo),ye(Kr))},s.\u0275cmp=gt({type:s,selectors:[["app-ongoing"]],viewQuery:function(l,i){if(l&1&&Ci(bV,5),l&2){let _;vi(_=xi())&&(i.footer=_.first)}},decls:20,vars:3,consts:[[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined"],[1,"sub-container"],[1,"cat"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"content-container"],["class","content",4,"ngFor","ngForOf"],[2,"height","5rem"],[3,"click","ngClass"],[1,"content"],[1,"icons-div"],[1,"highlight-text"],["class","icons-div",4,"ngIf"],[1,"normal-text"],[1,"service-div"],["href","'tel:'+ item.orderId.address.mobileNumber"],[1,"material-symbols-outlined",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1),Fe("click",function(){return i.navTo("menu")}),X(2,"\u2630"),j(),V(3,"div",2)(4,"div",3),Fe("click",function(){return i.navTo("credit")}),Me(5,"img",4),V(6,"pre"),X(7),j()(),V(8,"div",5),Fe("click",function(){return i.navTo("notification")}),V(9,"span",6),X(10,"notifications"),j()()(),V(11,"div",7)(12,"div",8),Bt(13,vV,2,4,"button",9),j(),V(14,"div",10),Me(15,"br"),Bt(16,wV,16,9,"div",11),j(),Me(17,"br"),j()(),Me(18,"div",12)(19,"app-fotter")),l&2&&(pe(7),Rt(i.credits),pe(6),Le("ngForOf",i.buttons),pe(3),Le("ngForOf",i.filteredOrder))},dependencies:[Co,br,lr,$s],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#d16611;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:8rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:5rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border-radius:.4rem;border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh}.cat[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px;border-bottom:2px solid transparent;cursor:pointer}.cat[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-bottom:1px solid #D70D09}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:border-bottom .3s}.content-container[_ngcontent-%COMP%]{width:100%;height:92%;overflow-y:auto;scroll-snap-type:y;scrollbar-width:none;display:flex;flex-direction:column;gap:2rem}.content[_ngcontent-%COMP%]{width:87%;display:flex;flex-direction:column;gap:.8rem;padding:1.5rem;box-shadow:0 1px 3px #000;border-radius:.5rem}.icons-div[_ngcontent-%COMP%]{display:flex;gap:1rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:16.94px;text-align:left;color:#000}.normal-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:15.73px;text-align:left;color:#000}']});let d=s;return d})();var CV=["videoPlayer"],SV=["activeVideo"];function MV(d,s){if(d&1){let u=si();V(0,"div",10),Fe("click",function(){let l=Ct(u).index,i=ut();return St(i.getVideoUrl(l))}),V(1,"div",11),Fe("click",function(){let l=Ct(u).index,i=ut();return St(i.getVideoUrl(l))}),Me(2,"img",12),j(),Me(3,"br"),j()}}function kV(d,s){if(d&1){let u=si();V(0,"div",13),Fe("click",function(){Ct(u);let l=ut();return St(l.stopVideo())}),V(1,"video",14,0),Fe("ended",function(){Ct(u);let l=ut();return St(l.onVideoEnded())})("timeupdate",function(){Ct(u);let l=hs(2),i=ut();return St(i.preventSeek(l))})("loadedmetadata",function(){Ct(u);let l=hs(2),i=ut();return St(i.onVideoLoaded(l))}),j()()}if(d&2){let u=ut();pe(),Le("src",u.getVideoUrl(u.currentVideoIndex),ir)}}function TV(d,s){if(d&1){let u=si();V(0,"div")(1,"button",15),Fe("click",function(){Ct(u);let l=ut();return St(l.navigateWaiting())}),X(2,"Go to Home"),j()()}}var UD=(()=>{let s=class s{navBack(){}constructor(o,l,i){this.http=o,this.tranningService=l,this.router=i,this.videos=[],this.pupUp=!1,this.bucketName="coolie1-dev",this.region="ap-south-1",this.currentVideoIndex=0,this.lastTime=0,this.isVideoPlaying=!1,this.showNavigationButton=!1}ngOnInit(){this.gettingVideos()}gettingVideos(){this.tranningService.gettingInductionVeideos().subscribe(o=>{console.log(o),this.videos=o},o=>{console.log(o)})}playVideo(o){this.pupUp=!0,this.currentVideoIndex=o,this.isVideoPlaying=!0,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())}stopVideo(){this.isVideoPlaying=!1,this.activeVideo&&this.activeVideo.nativeElement&&this.activeVideo.nativeElement.pause()}skipVideo(){this.playNextVideo()}onVideoEnded(){this.pupUp=!1,this.playNextVideo()}onVideoLoaded(o){o.play()}preventSeek(o){o.currentTime>this.lastTime+1?o.currentTime=this.lastTime:this.lastTime=o.currentTime}playNextVideo(){this.currentVideoIndex<this.videos.length-1?(this.currentVideoIndex++,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())):(this.isVideoPlaying=!1,alert("Congrats you have completed the traning"),this.navigateWaiting(),this.showNavigationButton=!0)}getVideoUrl(o){return this.pupUp=!0,`https://${this.bucketName}.s3.${this.region}.amazonaws.com/${this.videos[o].videoKey}`}navigateWaiting(){this.router.navigate(["waiting"])}};s.\u0275fac=function(l){return new(l||s)(ye(Zi),ye(Bm),ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-induction"]],viewQuery:function(l,i){if(l&1&&(Ci(CV,5),Ci(SV,5)),l&2){let _;vi(_=xi())&&(i.videoPlayer=_.first),vi(_=xi())&&(i.activeVideo=_.first)}},decls:15,vars:5,consts:[["activeVideo",""],[1,"tittle-div"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-tittle-div"],[1,"container"],[1,"sub-container"],["class","videoss",3,"click",4,"ngFor","ngForOf"],["class","overlay",3,"click",4,"ngIf"],[4,"ngIf"],[1,"videoss",3,"click"],[1,"dummy-video",3,"click"],["src","assets/demo/video.png"],[1,"overlay",3,"click"],["controls","","autoplay","","type","video/mp4",1,"active-video",3,"ended","timeupdate","loadedmetadata","src"],[3,"click"]],template:function(l,i){l&1&&(V(0,"div",1)(1,"span",2),Fe("click",function(){return i.navBack()}),X(2,"arrow_back"),j(),V(3,"span",3),X(4,"Induction videos"),j()(),V(5,"div",4)(6,"span"),X(7," Complete the Training session!! "),j(),V(8,"span"),X(9," You will be moved to next process "),j()(),V(10,"div",5)(11,"div",6),Bt(12,MV,4,0,"div",7),j()(),Bt(13,kV,3,1,"div",8)(14,TV,3,0,"div",9)),l&2&&(pe(10),ji("blur",i.isVideoPlaying),pe(2),Le("ngForOf",i.videos),pe(),Le("ngIf",i.pupUp),pe(),Le("ngIf",i.showNavigationButton))},dependencies:[br,lr],styles:['.tittle-div[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin:1rem 0 2rem 1rem}.tittle[_ngcontent-%COMP%]{font-size:1.3rem;font-family:"inter" sans-serif;font-weight:500}.sub-tittle-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem;justify-content:center;text-align:center;margin-bottom:1rem}.sub-tittle-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-size:1.1rem;font-family:"inter" sans-serif;font-weight:500;color:red}.sub-tittle-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.1rem;font-family:"inter" sans-serif;font-weight:400;color:#0009}#video[_ngcontent-%COMP%]{width:100%}video[_ngcontent-%COMP%]{width:90%;height:360px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin-top:10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:space-around;align-items:center;text-align:center}.blur[_ngcontent-%COMP%]{filter:blur(5px)}video[_ngcontent-%COMP%]{width:300px;height:200px;margin:10px;cursor:pointer}.videoss[_ngcontent-%COMP%]{width:90%;display:grid;row-gap:2rem}.dummy-video[_ngcontent-%COMP%]{width:100%}.dummy-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:fixed;top:0%;width:100%;height:100%;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}.overlay[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.active-video[_ngcontent-%COMP%]{width:640px;height:360px}button[_ngcontent-%COMP%]{margin-top:10px;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{cursor:pointer}']});let d=s;return d})();var HD=(()=>{let s=class s{constructor(o,l){this.logInService=o,this.router=l}navTo(){console.log(localStorage.getItem("providerId")),localStorage.getItem("providerId")?this.router.navigate(["home"]):this.router.navigate(["selectAccount"])}};s.\u0275fac=function(l){return new(l||s)(ye(Qn),ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-start"]],decls:18,vars:0,consts:[["id","main"],[1,"container"],[1,"logo"],["src","assets/logo/logo png1.png","alt","Coolie No. 1"],[1,"check"],[1,"content"],["src","assets/location/login-home-services-image.png","alt","Worker",1,"worker-image"],[1,"text"],[1,"cta-button",3,"click"],[1,"material-symbols-outlined"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2),Me(3,"img",3),j()(),V(4,"div",4)(5,"div",5),Me(6,"img",6),V(7,"div",7)(8,"span"),X(9,"Home "),V(10,"span"),X(11,"SERVICES"),j()(),V(12,"span"),X(13,"at your Door Step"),j(),V(14,"button",8),Fe("click",function(){return i.navTo()}),X(15,"Let's Go \xA0 "),V(16,"span",9),X(17," arrow_forward "),j()()()()()())},styles:["#main[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100vh;background:radial-gradient(circle at bottom right,#cd2e28 60%,#fff 40%)}.container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;flex:0 0 40%}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80%;max-width:300px;margin-bottom:20px}.content[_ngcontent-%COMP%]{width:100%;position:relative;display:flex;flex-direction:column;align-items:center}.worker-image[_ngcontent-%COMP%]{width:50%;height:50%}.check[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;flex:0 0 60%}.text[_ngcontent-%COMP%]{margin-top:5%;text-align:center;display:flex;flex-direction:column}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Roboto;font-size:1.5rem;color:#fff}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-weight:300;line-height:1.6rem}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1)   span[_ngcontent-%COMP%]{font-weight:500}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.1rem;font-weight:300;line-height:1.4rem}.cta-button[_ngcontent-%COMP%]{background-color:transparent;color:#ffffffde;border:none;padding:22px 30px;font-size:1.5rem;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;border-radius:5px}.cta-button[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{margin-left:10px;font-size:24px}"]});let d=s;return d})();function IV(d,s){d&1&&(V(0,"span"),X(1,"\u2192"),j())}function EV(d,s){d&1&&(V(0,"span"),X(1,"\u2714"),j())}function DV(d,s){d&1&&(V(0,"span"),X(1,"\u2192"),j())}function AV(d,s){d&1&&(V(0,"span"),X(1,"\u2714"),j())}var WD=(()=>{let s=class s{constructor(o,l,i){this.loginService=o,this.router=l,this.jobDetailsService=i,this.isExistingActive=!1,this.isNewActive=!1,this.startX=0,this.currentX=0,this.sliderPosition=5,this.isDragging=!1;let _=localStorage.getItem("providerId");this.jobDetailsService.getUserDetails(_)}onTouchStart(o,l){this.startX=o.touches[0].clientX,this.isDragging=!0}onTouchMove(o,l){this.isDragging&&(this.currentX=o.touches[0].clientX-this.startX,this.updateSliderPosition(this.currentX,l))}onTouchEnd(o){this.isDragging=!1,this.checkFinalPosition(o)}onMouseDown(o,l){this.startX=o.clientX,this.isDragging=!0}onMouseMove(o,l){this.isDragging&&(this.currentX=o.clientX-this.startX,this.updateSliderPosition(this.currentX,l))}onMouseUp(o){this.isDragging=!1,this.checkFinalPosition(o)}updateSliderPosition(o,l){if(l==="existing"){let C=Math.min(Math.max(5,5+o),240);this.sliderPosition=C}else if(l==="new"){let C=Math.min(Math.max(5,5+o),240);this.sliderPosition=C}}checkFinalPosition(o){o==="existing"?this.sliderPosition>150&&!this.isExistingActive?(this.isExistingActive=!0,this.sliderPosition=240,this.onToggleChange("existing")):(this.sliderPosition=5,this.isExistingActive=!1):o==="new"&&(this.sliderPosition>150&&!this.isNewActive?(this.isNewActive=!0,this.sliderPosition=240,this.onToggleChange("new")):(this.sliderPosition=5,this.isNewActive=!1))}onToggleChange(o){o==="existing"?(this.loginService.setLogInApi(),this.navigateBasedOnAccount()):o==="new"&&(this.loginService.setSignUpApi(),setTimeout(()=>{this.router.navigate(["log-in"])},1e3))}navigateBasedOnAccount(){localStorage.getItem("providerId")?this.jobDetailsService.userDetails?setTimeout(()=>{this.router.navigate(["home"])},1e3):setTimeout(()=>{this.router.navigate(["aboutUser"])},1e3):setTimeout(()=>{this.router.navigate(["log-in"])},1e3)}};s.\u0275fac=function(l){return new(l||s)(ye(Qn),ye(jt),ye(Or))},s.\u0275cmp=gt({type:s,selectors:[["app-select-account"]],decls:23,vars:8,consts:[[1,"container"],[1,"sub-container"],[1,"sp-div"],[1,"img-div"],["src","assets/logo/start2.png","alt","Logo"],[1,"slide-container",3,"touchstart","touchmove","touchend","mousedown","mousemove","mouseup"],[1,"placehlder"],[1,"slider"],[4,"ngIf"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),X(4,"Hey!"),j(),V(5,"span"),X(6,"Join now"),j()(),V(7,"div",3),Me(8,"img",4),j(),V(9,"div",5),Fe("touchstart",function(C){return i.onTouchStart(C,"existing")})("touchmove",function(C){return i.onTouchMove(C,"existing")})("touchend",function(){return i.onTouchEnd("existing")})("mousedown",function(C){return i.onMouseDown(C,"existing")})("mousemove",function(C){return i.onMouseMove(C,"existing")})("mouseup",function(){return i.onMouseUp("existing")}),V(10,"div",6)(11,"span"),X(12,"Existing Provider"),j()(),V(13,"div",7),Bt(14,IV,2,0,"span",8)(15,EV,2,0,"span",8),j()(),V(16,"div",5),Fe("touchstart",function(C){return i.onTouchStart(C,"new")})("touchmove",function(C){return i.onTouchMove(C,"new")})("touchend",function(){return i.onTouchEnd("new")})("mousedown",function(C){return i.onMouseDown(C,"new")})("mousemove",function(C){return i.onMouseMove(C,"new")})("mouseup",function(){return i.onMouseUp("new")}),V(17,"div",6)(18,"span"),X(19,"New Provider"),j()(),V(20,"div",7),Bt(21,DV,2,0,"span",8)(22,AV,2,0,"span",8),j()()()()),l&2&&(pe(13),ji("active",i.isExistingActive),pe(),Le("ngIf",!i.isExistingActive),pe(),Le("ngIf",i.isExistingActive),pe(5),ji("active",i.isNewActive),pe(),Le("ngIf",!i.isNewActive),pe(),Le("ngIf",i.isNewActive))},dependencies:[lr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;align-items:center;justify-content:center;background-color:#f5f5f5}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:400px;display:flex;flex-direction:column;align-items:center;row-gap:1rem}.sp-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:left}span[_ngcontent-%COMP%]{float:left;font-family:Poppins,sans-serif;font-size:24px;font-weight:600;line-height:36px;text-align:left}.img-div[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.img-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.slide-container[_ngcontent-%COMP%]{width:100%;height:50px;background-color:#d16611;border-radius:25px;position:relative;display:flex;align-items:center}.slider[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#000;font-size:14px;font-weight:200;position:absolute;left:calc(var(--sliderPosition, 5px));transition:left .3s}.slider.active[_ngcontent-%COMP%]{left:80%}.placehlder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:50px;font-family:"Poppins" sans-serif;font-size:16px;font-weight:400;color:#fff}']});let d=s;return d})();var GD=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275cmp=gt({type:s,selectors:[["app-congrats"]],decls:14,vars:0,consts:[[1,"main"],[1,"container"],["src","assets/new/congrats.png"],[1,"text"],[1,"arrow-container"],["src","assets/new/round arrow.png"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div"),Me(3,"img",2),j(),Me(4,"br"),V(5,"div",3)(6,"p"),X(7,"congratulations"),j(),V(8,"p"),X(9,"You have completed induction videos"),j(),V(10,"p"),X(11,"you are now. Partner of Coolieno1! You are successfully on boarded."),j()()(),V(12,"div",4),Me(13,"img",5),j()())},styles:['.main[_ngcontent-%COMP%]{width:100%;height:100vh}.container[_ngcontent-%COMP%]{width:100%;display:grid;row-gap:1rem;align-items:center;justify-content:center;text-align:center;position:relative;top:15%}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;height:max-content}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){width:100%;display:flex;align-items:center;justify-content:center}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:130px;height:130px}.arrow-container[_ngcontent-%COMP%]{position:fixed;bottom:10%;left:40%;display:flex;align-items:center;justify-content:center}.text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(1){font-family:"Archivo" sans-serif Black;font-size:1.2rem;font-weight:600;line-height:17.41px;letter-spacing:.04em}.text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(2){font-family:"inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;letter-spacing:.04em}']});let d=s;return d})();var PV=d=>({"first-package":d,package:!0});function OV(d,s){d&1&&(V(0,"button"),X(1,"1 month"),j())}function RV(d,s){d&1&&(V(0,"span"),X(1,"Amount Payable"),j())}function LV(d,s){if(d&1&&(V(0,"div",6),Me(1,"br"),V(2,"div")(3,"p",7)(4,"span"),X(5,"UPGRADE TO"),j(),V(6,"button"),X(7,"1 Month"),j()(),V(8,"p",8),Me(9,"img",9),X(10," \xA0"),V(11,"span"),X(12),j()(),V(13,"p",7)(14,"span")(15,"span",10),X(16,"Current"),j(),V(17,"span",11),X(18,"lock_open"),j()(),V(19,"span"),X(20,"Expire : 19th Jul 24"),j()(),V(21,"ul")(22,"li"),X(23),j(),V(24,"li"),X(25),j()(),V(26,"p",7),Bt(27,OV,2,0,"button",12)(28,RV,2,0,"span",12),V(29,"span"),X(30,"\u20B9 1499"),j()()()()),d&2){let u=s.$implicit,o=ut();Le("ngClass",li(7,PV,u.packageName==="silver")),pe(9),Le("src",u.image,ir),pe(3),Rt(u.packageName),pe(11),Rt(u.noOfJobOffers),pe(2),Rt(u.bonus),pe(2),Le("ngIf",o.isEnrolled),pe(),Le("ngIf",!o.isEnrolled)}}var qD=(()=>{let s=class s{navToBack(){this.location.back()}constructor(o,l){this.userDetails=o,this.location=l,this.isEnrolled=!0,this.packages=[],this.getPackage()}getPackage(){this.userDetails.getPackages().subscribe(o=>{console.log(o),this.packages=o},o=>{console.log(o)})}};s.\u0275fac=function(l){return new(l||s)(ye(vr),ye(Li))},s.\u0275cmp=gt({type:s,selectors:[["app-packages"]],decls:8,vars:1,consts:[[1,"container"],[1,"sub-container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"upgrade"],[1,"package-name"],[3,"src"],[1,"Current"],[1,"material-symbols-outlined",2,"font-size","1rem"],[4,"ngIf"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),Fe("click",function(){return i.navToBack()}),X(4,"arrow_back"),j(),V(5,"span",4),X(6,"Packages"),j()(),Bt(7,LV,31,9,"div",5),j()()),l&2&&(pe(7),Le("ngForOf",i.packages))},dependencies:[Co,br,lr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:670px;position:relative;top:2%;left:5%;display:flex;flex-direction:column;gap:2rem}.arrow[_ngcontent-%COMP%]{width:100%;display:flex;text-align:center}.tittle[_ngcontent-%COMP%]{width:80%;font-family:"Inter" sans-serif;font-size:22px;font-weight:500;line-height:26.63px;text-align:center}.package[_ngcontent-%COMP%]{border-radius:.6rem;background-color:#414141}.first-package[_ngcontent-%COMP%]{background:#605c5c}.package[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;width:90%;left:5%;top:5%;display:flex;flex-direction:column;gap:.5rem}.upgrade[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.upgrade[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px;text-align:left;color:#fff}.package-name[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center}.package-name[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem}.package-name[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], li[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px;text-align:left;color:#fff}.upgrade[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff}.Current[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:18px;font-weight:500;line-height:21.78px;text-align:left;color:#fff}.material-symbols-outlined[_ngcontent-%COMP%]{font-variation-settings:"FILL" 0,"wght" 400,"GRAD" 0,"opsz" 20}button[_ngcontent-%COMP%]{background-color:transparent;border:1px solid rgba(212,175,55,1);color:#d4af37;border-radius:.2rem}ul[_ngcontent-%COMP%]{float:left}']});let d=s;return d})();var FV=["videoPlayer"],zV=["activeVideo"];function BV(d,s){if(d&1){let u=si();V(0,"div",6),Fe("click",function(){let l=Ct(u).index,i=ut();return St(i.getVideoUrl(l))}),V(1,"div",7),Fe("click",function(){let l=Ct(u).index,i=ut();return St(i.getVideoUrl(l))}),Me(2,"img",8),j(),Me(3,"br"),j()}}function NV(d,s){if(d&1){let u=si();V(0,"div",9),Fe("click",function(){Ct(u);let l=ut();return St(l.stopVideo())}),V(1,"video",10,0),Fe("ended",function(){Ct(u);let l=ut();return St(l.onVideoEnded())})("timeupdate",function(){Ct(u);let l=hs(2),i=ut();return St(i.preventSeek(l))})("loadedmetadata",function(){Ct(u);let l=hs(2),i=ut();return St(i.onVideoLoaded(l))}),j()()}if(d&2){let u=ut();pe(),Le("src",u.getVideoUrl(u.currentVideoIndex),ir)}}var $D=(()=>{let s=class s{navBack(){}constructor(o,l){this.http=o,this.tranningService=l,this.videos=[],this.pupUp=!1,this.bucketName="coolie1-dev",this.region="ap-south-1",this.currentVideoIndex=0,this.lastTime=0,this.isVideoPlaying=!1}ngOnInit(){this.gettingVideos()}gettingVideos(){this.tranningService.getingVideos().subscribe(o=>{console.log(o),this.videos=o},o=>{console.log(o)})}playVideo(o){this.pupUp=!0,console.log(this.pupUp),this.currentVideoIndex=o,this.isVideoPlaying=!0,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())}stopVideo(){this.isVideoPlaying=!1,this.activeVideo&&this.activeVideo.nativeElement&&this.activeVideo.nativeElement.pause()}skipVideo(){this.playNextVideo()}onVideoEnded(){console.log("ended"),this.pupUp=!1}onVideoLoaded(o){o.play()}preventSeek(o){o.currentTime>this.lastTime+1?o.currentTime=this.lastTime:this.lastTime=o.currentTime}playNextVideo(){this.currentVideoIndex<this.videos.length-1?(this.currentVideoIndex++,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())):this.isVideoPlaying=!1}getVideoUrl(o){return this.pupUp=!0,console.log(this.pupUp),`https://${this.bucketName}.s3.${this.region}.amazonaws.com/${this.videos[o].videoKey}`}};s.\u0275fac=function(l){return new(l||s)(ye(Zi),ye(Bm))},s.\u0275cmp=gt({type:s,selectors:[["app-training"]],viewQuery:function(l,i){if(l&1&&(Ci(FV,5),Ci(zV,5)),l&2){let _;vi(_=xi())&&(i.videoPlayer=_.first),vi(_=xi())&&(i.activeVideo=_.first)}},decls:11,vars:4,consts:[["activeVideo",""],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"container"],[1,"sub-container"],["class","videoss",3,"click",4,"ngFor","ngForOf"],["class","overlay",3,"click",4,"ngIf"],[1,"videoss",3,"click"],[1,"dummy-video",3,"click"],["src","assets/demo/video.png"],[1,"overlay",3,"click"],["controls","","autoplay","","type","video/mp4",1,"active-video",3,"ended","timeupdate","loadedmetadata","src"]],template:function(l,i){l&1&&(Me(0,"br")(1,"br"),X(2,"\xA0\xA0 \xA0"),V(3,"span",1),Fe("click",function(){return i.navBack()}),X(4,"arrow_back"),j(),Me(5,"br")(6,"br"),V(7,"div",2)(8,"div",3),Bt(9,BV,4,0,"div",4),j()(),Bt(10,NV,3,1,"div",5)),l&2&&(pe(7),ji("blur",i.isVideoPlaying),pe(2),Le("ngForOf",i.videos),pe(),Le("ngIf",i.pupUp))},dependencies:[br,lr],styles:["#video[_ngcontent-%COMP%]{width:100%}video[_ngcontent-%COMP%]{width:90%;height:360px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin-top:10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:space-around;align-items:center;text-align:center}.blur[_ngcontent-%COMP%]{filter:blur(5px)}video[_ngcontent-%COMP%]{width:300px;height:200px;margin:10px;cursor:pointer}.videoss[_ngcontent-%COMP%]{width:90%;display:grid;row-gap:2rem}.dummy-video[_ngcontent-%COMP%]{width:100%}.dummy-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:fixed;top:0%;width:100%;height:100%;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}.overlay[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.active-video[_ngcontent-%COMP%]{width:640px;height:360px}button[_ngcontent-%COMP%]{margin-top:10px;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{cursor:pointer}"]});let d=s;return d})();var ep=wm("PushNotifications",{});var VV="firebase",jV="10.12.4";kk(VV,jV,"app");var Og=new Vx("ANGULARFIRE2_VERSION");var my=class{zone;delegate;constructor(s,u=UM){this.zone=s,this.delegate=u}now(){return this.delegate.now()}schedule(s,u,o){let l=this.zone,i=function(_){l.runGuarded(()=>{s.apply(this,[_])})};return this.delegate.schedule(i,u,o)}};var YD=(()=>{class d{ngZone;outsideAngular;insideAngular;constructor(u){this.ngZone=u,this.outsideAngular=u.runOutsideAngular(()=>new my(Zone.current)),this.insideAngular=u.run(()=>new my(Zone.current,jM)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(o){return new(o||d)(lt(Ri))};static \u0275prov=Ht({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})();var HV="firebase",WV="10.12.4";ms.registerVersion(HV,WV,"app-compat");var GV=["ngOnDestroy"],XD=(d,s,u,o={})=>new Proxy(d,{get:(l,i)=>u.runOutsideAngular(()=>{if(d[i])return o?.spy?.get&&o.spy.get(i,d[i]),d[i];if(GV.indexOf(i)>-1)return()=>{};let _=s.toPromise().then(C=>{let I=C?.[i];return typeof I=="function"?I.bind(C):I?.then?I.then(O=>u.run(()=>O)):u.run(()=>I)});return new Proxy(()=>{},{get:(C,I)=>_[I],apply:(C,I,O)=>_.then(N=>{let q=N?.(...O);return o?.spy?.apply&&o.spy.apply(i,O,q),q})})})});var py=class{constructor(s){return s}},fy=new pn("angularfire2.app.options"),gy=new pn("angularfire2.app.name");function rC(d,s,u){let o=typeof u=="string"&&u||"[DEFAULT]",l=typeof u=="object"&&u||{};l.name=l.name||o;let _=ms.apps.filter(C=>C&&C.name===l.name)[0]||s.runOutsideAngular(()=>ms.initializeApp(d,l));try{if(JSON.stringify(d)!==JSON.stringify(_.options)){let C=!!module.hot;qV("error",`${_.name} Firebase App already initialized with different options${C?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new py(_)}var qV=(d,...s)=>{jx()&&typeof console<"u"&&console[d](...s)},$V={provide:py,useFactory:rC,deps:[fy,Ri,[new j0,gy]]},QD=(()=>{class d{static initializeApp(u,o){return{ngModule:d,providers:[{provide:fy,useValue:u},{provide:gy,useValue:o}]}}constructor(u){ms.registerVersion("angularfire",Og.full,"core"),ms.registerVersion("angularfire",Og.full,"app-compat"),ms.registerVersion("angular",nk.full,u.toString())}static \u0275fac=function(o){return new(o||d)(lt(rd))};static \u0275mod=ui({type:d});static \u0275inj=hi({providers:[$V]})}return d})();function KD(d,s,u,o,l){let[,i,_]=globalThis.\u0275AngularfireInstanceCache.find(C=>C[0]===d)||[];if(i)return YV(l,_)||(ZD("error",`${s} was already initialized on the ${u} Firebase App with different settings.${ZV?" You may need to reload as Firebase is not HMR aware.":""}`),ZD("warn",{is:l,was:_})),i;{let C=o();return globalThis.\u0275AngularfireInstanceCache.push([d,C,l]),C}}function YV(d,s){try{return d.toString()===s.toString()}catch{return d===s}}var ZV=typeof module<"u"&&!!module.hot,ZD=(d,...s)=>{jx()&&typeof console<"u"&&console[d](...s)};globalThis.\u0275AngularfireInstanceCache||=[];var XV=new pn("angularfire2.messaging.vapid-key"),QV=new pn("angularfire2.messaging.service-worker-registeration"),oC=(()=>{class d{requestPermission;getToken;tokenChanges;messages;requestToken;deleteToken;constructor(u,o,l,i,_,C,I){let O=I,N=Yr(void 0).pipe(Ol(_.outsideAngular),Pl(_.insideAngular),cs(Tk),cs(de=>de?import("./chunk-WCJOXY6X.js"):HM),gm(()=>rC(u,i,o)),cs(de=>KD(`${de.name}.messaging`,"AngularFireMessaging",de.name,()=>Yr(de.messaging()),[])),Rx({bufferSize:1,refCount:!1}));this.requestPermission=N.pipe(Ol(_.outsideAngular),Pl(_.insideAngular),cs(()=>Notification.requestPermission())),this.getToken=N.pipe(Ol(_.outsideAngular),Pl(_.insideAngular),cs(de=>bo(this,null,function*(){if(Notification.permission==="granted"){let xe=O?yield O:null;return yield de.getToken({vapidKey:C,serviceWorkerRegistration:xe})}else return null})));let q=new yo(de=>{navigator.permissions.query({name:"notifications"}).then(xe=>{xe.onchange=()=>de.next()})}),ie=N.pipe(Ol(_.outsideAngular),Pl(_.insideAngular),Lx(q),Lx(this.getToken));return this.tokenChanges=N.pipe(Ol(_.outsideAngular),Pl(_.insideAngular),cs(()=>z0(this.getToken,ie))),this.messages=N.pipe(Ol(_.outsideAngular),Pl(_.insideAngular),cs(de=>new yo(xe=>de.onMessage(xe)))),this.requestToken=N.pipe(Ol(_.outsideAngular),Pl(_.insideAngular),cs(()=>this.requestPermission),$M(()=>Yr(null)),GM(()=>this.tokenChanges)),this.deleteToken=()=>N.pipe(Ol(_.outsideAngular),Pl(_.insideAngular),cs(de=>de.deleteToken()),YM(!1)),XD(this,N,i)}static \u0275fac=function(o){return new(o||d)(lt(fy),lt(gy,8),lt(rd),lt(Ri),lt(YD),lt(XV,8),lt(QV,8))};static \u0275prov=Ht({token:d,factory:d.\u0275fac,providedIn:"any"})}return d})(),JD=(()=>{class d{constructor(){ms.registerVersion("angularfire",Og.full,"fcm-compat")}static \u0275fac=function(o){return new(o||d)};static \u0275mod=ui({type:d});static \u0275inj=hi({providers:[oC]})}return d})();var _y=(()=>{let s=class s{constructor(o,l,i){this.afMessaging=o,this.http=l,this.router=i,this.apiUrl=xn,this.listenForMessages()}requestPermission(){Mk.isNativePlatform()?ep.requestPermissions().then(o=>{o.receive==="granted"&&(ep.register(),ep.addListener("registration",l=>{console.log("Push registration success, token: "+l.value),this.token=l.value,this.sendTokenToBackend(l.value)}),ep.addListener("pushNotificationReceived",l=>{this.handleInAppNotification(l),console.log("Push received: ",l)}),ep.addListener("pushNotificationActionPerformed",l=>{console.log("Push action performed: ",l),this.handleNotificationClick(l)}))}):this.afMessaging.requestToken.subscribe({next:o=>{console.log("FCM token:",o),this.token=o,this.sendTokenToBackend(o)},error:o=>{console.error("Error getting token",o)}})}listenForMessages(){console.log("listing..................."),this.afMessaging.messages.subscribe(o=>{console.log(o),alert(o),this.router.navigate(["getOrder"]),console.log(o.notification),console.log(o.data?.order),console.log(o.notification?.title)},o=>{console.log(o)})}sendTokenToBackend(o){alert(o);let l=this.apiUrl+"providers/provider-token",i={providerId:localStorage.getItem("providerId"),token:o};alert(i.providerId),alert(i.token),this.http.post(l,i).subscribe({next:_=>{console.log(_),alert("token send sucessfully")},error:_=>{console.log(_),alert("error"),alert(_.error.message)}})}handleInAppNotification(o){alert("inapp notification");let l=o.notification?.title||o.title,i=o.notification?.body||o.body;l&&i&&(l==="New Order"&&this.router.navigate(["getOrder"]),alert(i))}handleNotificationClick(o){let l=o.notification.data,i=o.notification?.title,_=o.notification?.body;l&&l.orderId&&i?i==="New Order"&&this.router.navigate(["getOrder",l.orderId]):this.router.navigate(["getOrder"])}};s.\u0275fac=function(l){return new(l||s)(lt(oC),lt(Zi),lt(jt))},s.\u0275prov=Ht({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var tA=(()=>{let s=class s{constructor(o,l,i,_,C){this.router=o,this.jobDetailsService=l,this.orderService=i,this.mapboxService=_,this.getOrderService=C,this.timeLeft=120,this.extractedDetails=[],this.current=0,this.max=120,this.radius=100,this.color="rgba(255, 0, 0, 1)",this.background="rgba(253, 5, 0, 0.4)",this.cancelRate=0,this.workingHours=0,this.credits=0,this.serviceName=[{name:"cleaning"},{name:"tank cleaning"},{name:"tankcleaning"}],this.userCoordinates=[0,0],this.orderIds=[],this.workSeleceted=this.jobDetailsService.workDetails}ngOnInit(){this.startTimer(),this.providerCurrentLocation=this.mapboxService.placeName,this.order=this.getOrderService.order,this.details()}startTimer(){this.interval=setInterval(()=>{this.timeLeft>0?(this.timeLeft--,this.current=this.timeLeft):clearInterval(this.interval)},1e3)}ngOnDestroy(){clearInterval(this.interval)}get minutes(){return Math.floor(this.timeLeft/60)}get seconds(){return this.timeLeft%60}details(){this.order=JSON.parse(this.order.order),this.orderService.oredrDetails=this.order,this.parsedOrder=this.order,this.getCartId(this.order),this.extractedDetails.push({fullAddress:`${this.parsedOrder.addressId.city}, ${this.parsedOrder.addressId.state}, ${this.parsedOrder.addressId.pincode}`,latitude:this.parsedOrder.addressId.latitude,longitude:this.parsedOrder.addressId.longitude,categoryName:this.parsedOrder.items[0].categoryId.name,subCategoryName:this.parsedOrder.items[0].subCategoryId.name,quantity:this.parsedOrder.items[0].quantity,scheduledDate:this.parsedOrder.items[0].scheduledDate,price:this.parsedOrder.items[0].serviceId.serviceVariants[0].price}),console.log(this.extractedDetails),this.userCoordinates=[this.extractedDetails[0].longitude,this.extractedDetails[0].latitude],this.orderService.userFullAddress=this.extractedDetails[0].fullAddress,this.mapboxService.userCordinates=this.userCoordinates}getCartId(o){let l=this.order._id,i=_=>{let C=setInterval(()=>{if(this.acceptStatus)if(clearInterval(C),this.acceptStatus){this.acceptStatus=!1,this.acceptedOrder(l),console.log("User accepted, exiting the loop");return}else console.log("User declined, moving to the next item"),this.acceptStatus=!1,i(_+1)},1e3);setTimeout(()=>{this.acceptStatus===null&&(clearInterval(C),console.log("Automatically moving to the next item"),i(_+1))},12e4)};i(0)}accepted(){this.acceptStatus=!0}declined(){this.acceptStatus=!1,console.log("declined"),this.acceptStatus=!1,this.timeLeft=120,this.router.navigate(["home"])}acceptedOrder(o){console.log(o),this.orderService.accept(o).subscribe(l=>{console.log(l),this.orderService.orderIds=l.orderHistoryId,this.router.navigate(["arrived"])},l=>{console.log(l)})}};s.\u0275fac=function(l){return new(l||s)(ye(jt),ye(Or),ye(Kr),ye(pd),ye(_y))},s.\u0275cmp=gt({type:s,selectors:[["app-get-order"]],decls:57,vars:16,consts:[[1,"container"],[1,"timer"],[3,"current","max","color","background","radius","rounded","stroke"],[1,"timer-container"],[1,"time"],[1,"location-container"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"line"],[1,"address"],[1,"location-txt"],[1,"location"],[1,"service-details"],[1,"main-Text"],[1,"value-Text"],[1,"acc-rej-btns"],[3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1),Me(2,"round-progress",2),V(3,"div",3)(4,"p",4)(5,"span"),X(6),j(),V(7,"span"),X(8,"Time left"),j()()()(),V(9,"div",5)(10,"div")(11,"span",6),X(12," location_on "),j(),Me(13,"div",7),V(14,"span",6),X(15," location_on "),j()(),V(16,"div",8)(17,"p")(18,"span",9),X(19,"My location"),j(),V(20,"span",10),X(21),j()(),Me(22,"br"),V(23,"p"),X(24,"10 Km"),j(),Me(25,"br"),V(26,"p")(27,"span",9),X(28,"User location"),j(),V(29,"span",10),X(30),j()()()(),V(31,"div",11)(32,"span")(33,"span",12),X(34,"Category Type :"),j(),V(35,"span",13),X(36),j()(),V(37,"span")(38,"span",12),X(39,"Service Type :"),j(),V(40,"span",13),X(41),j()(),V(42,"span")(43,"span",12),X(44,"Price :"),j(),V(45,"span",13),X(46),j()(),V(47,"span")(48,"span",12),X(49,"Schedule :"),j(),V(50,"span",13),X(51),j()()(),V(52,"div",14)(53,"button",15),Fe("click",function(){return i.declined()}),X(54,"Reject"),j(),V(55,"button",15),Fe("click",function(){return i.accepted()}),X(56,"Accept"),j()()()),l&2&&(pe(2),Le("current",i.current)("max",i.max)("color",i.color)("background",i.background)("radius",i.radius)("rounded",!0)("stroke",10),pe(4),Us("",i.minutes,":",i.seconds<10?"0"+i.seconds:i.seconds,""),pe(15),Rt(i.providerCurrentLocation),pe(9),Rt(i.extractedDetails[0]==null?null:i.extractedDetails[0].fullAddress),pe(6),Rt(i.extractedDetails[0]==null?null:i.extractedDetails[0].categoryName),pe(5),Rt(i.extractedDetails[0]==null?null:i.extractedDetails[0].subCategoryName),pe(5),Us("",i.extractedDetails[0]==null?null:i.extractedDetails[0].price," X ",i.extractedDetails[0]==null?null:i.extractedDetails[0].quantity,""),pe(5),Rt(i.extractedDetails[0]==null?null:i.extractedDetails[0].scheduledDate))},dependencies:[Tb],styles:[".container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;top:5%;left:2.5%;display:flex;flex-direction:column;gap:2rem}.timer[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.timer-container[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center}.time[_ngcontent-%COMP%]{font-size:2em;text-align:center;display:flex;flex-direction:column;gap:.5rem}.time[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1rem}.location-container[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:10% 80%}.location-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){display:flex;flex-direction:column;align-items:center;justify-content:center}.line[_ngcontent-%COMP%]{width:1px;height:6rem;border-left:.25px dashed black}.address[_ngcontent-%COMP%], .address[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-align:left}.location-txt[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:500}.location[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:.9rem;font-weight:400;color:#b8b8b8}.service-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.main-Text[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:500;color:#5a5a5a80}.value-Text[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:400;color:#515151}.acc-rej-btns[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-around}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:150px;height:50px;border:none;border-radius:.4rem;font-family:Inter,sans-serif;font-size:1rem;font-weight:500;letter-spacing:1px;color:#fff;text-align:center}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#d70d09}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:#409000}"]});let d=s;return d})();var iA=(()=>{let s=class s{navTOBack(){this.location.back()}constructor(o,l,i,_){this.router=o,this.mapboxService=l,this.orderService=i,this.location=_,this.toggleChecked=!1}ngOnInit(){this.intalizeMap()}intalizeMap(){return bo(this,null,function*(){let o=this.mapboxService.userCordinates;console.log(o),this.mapboxService.initializeMap(),console.log(this.mapboxService.mapStatus),this.userFullAddress=this.orderService.userFullAddress,yield this.mapboxService.addDestinationMarker(o)})}toggleDisplay(o){this.toggleChecked=!this.toggleChecked,console.log(this.toggleChecked),this.router.navigate(["startWork"])}cancel(){this.orderService.cancelOrder().subscribe(o=>{console.log(o),this.router.navigate(["home"])},o=>{console.log(o)})}};s.\u0275fac=function(l){return new(l||s)(ye(jt),ye(pd),ye(Kr),ye(Li))},s.\u0275cmp=gt({type:s,selectors:[["app-arvied"]],decls:18,vars:1,consts:[[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"arival-status"],[3,"click"],["id","map"],[1,"location"],[1,"material-symbols-outlined"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"change"],["for","toggle",1,"already-label",2,"content","'Iam Existing provider '"]],template:function(l,i){l&1&&(V(0,"section",0)(1,"span",1),Fe("click",function(){return i.navTOBack()}),X(2," arrow_back "),j(),V(3,"div",2)(4,"span"),X(5,"On the way "),j(),V(6,"button",3),Fe("click",function(){return i.cancel()}),X(7,"Cancel"),j()(),Me(8,"div",4)(9,"br"),V(10,"div",5)(11,"span",6),X(12," near_me "),j(),V(13,"span"),X(14),j()(),V(15,"div",7)(16,"input",8),Fe("change",function(C){return i.toggleDisplay(C)}),j(),Me(17,"label",9),j()()),l&2&&(pe(14),Qi(" ",i.userFullAddress," "))},styles:['.container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;left:2.5%;top:2.5%;display:flex;flex-direction:column;gap:2rem}.arival-status[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-between;border-radius:.5rem;align-items:center;background-color:#d70d09}.arival-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Poppins" sans-serif;margin-left:1.5rem;font-size:1.1rem;font-weight:500;line-height:24px;text-align:left;color:#fff}.arival-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:6rem;height:2.5rem;color:#fff;background-color:transparent;border:.25px solid #ffff;font-family:"Poppins" sans-serif;font-size:1.1rem;font-weight:500;border-radius:.4rem;margin-right:1rem}#map[_ngcontent-%COMP%]{width:100%;height:20rem}.location[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:20% 80%}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){display:flex;justify-content:center;align-items:center}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Poppins" sans-serif;font-size:14px;font-weight:400;line-height:25px;letter-spacing:.05em;text-align:left}.slide-toggle[_ngcontent-%COMP%]{position:fixed;width:95%;height:46px;left:2%;bottom:10%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Arrived";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#409000;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:2px;left:2px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;content:"Arrived";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;pointer-events:none}']});let d=s;return d})();var nA=(()=>{let s=class s{navTOBack(){this.location.back()}constructor(o,l,i,_){this.router=o,this.orderService=l,this.mapboxService=i,this.location=_,this.toggleChecked=!1,this.intalizeMap()}intalizeMap(){return bo(this,null,function*(){let o=this.mapboxService.userCordinates;console.log(o),this.mapboxService.initializeMap(),console.log(this.mapboxService.mapStatus),this.userFullAddress=this.orderService.userFullAddress,yield this.mapboxService.addDestinationMarker(o)})}getOtp(){this.orderService.verifyOtp().subscribe(o=>{console.log(o)},o=>{console.log(o)})}toggleDisplay(o){this.toggleChecked=!this.toggleChecked,console.log(this.toggleChecked),this.router.navigate(["work/otp"])}navToChat(){this.router.navigate(["help/chatlanding","user"])}};s.\u0275fac=function(l){return new(l||s)(ye(jt),ye(Kr),ye(pd),ye(Li))},s.\u0275cmp=gt({type:s,selectors:[["app-start-work"]],decls:21,vars:1,consts:[[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"arival-status"],[1,"material-symbols-outlined",2,"font-size","24px","margin-right","1.5rem"],[1,"material-symbols-outlined",2,"font-size","24px","margin-right","1.5rem",3,"click"],["id","map"],[1,"location"],[1,"material-symbols-outlined"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"change"],["for","toggle",1,"already-label",2,"content","'Iam Existing provider '"]],template:function(l,i){l&1&&(V(0,"section",0)(1,"span",1),Fe("click",function(){return i.navTOBack()}),X(2," arrow_back "),j(),V(3,"div",2)(4,"span"),X(5,"Reached customer location "),j(),V(6,"div")(7,"span",3),X(8," call "),j(),V(9,"span",4),Fe("click",function(){return i.navToChat()}),X(10," forum "),j()()(),Me(11,"div",5)(12,"br"),V(13,"div",6)(14,"span",7),X(15," near_me "),j(),V(16,"span"),X(17),j()(),V(18,"div",8)(19,"input",9),Fe("change",function(C){return i.toggleDisplay(C)}),j(),Me(20,"label",10),j()()),l&2&&(pe(17),Qi(" ",i.userFullAddress," "))},styles:['.container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;left:2.5%;display:flex;flex-direction:column;gap:2rem;margin-top:2.5%}.arival-status[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-between;border-radius:.5rem;align-items:center;background-color:#d70d09}.arival-status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.arival-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Poppins" sans-serif;margin-left:1.5rem;font-size:1.1rem;font-weight:500;line-height:24px;text-align:left;color:#fff}#map[_ngcontent-%COMP%]{width:100%;height:20rem}.map[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.location[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:20% 80%}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){display:flex;justify-content:center;align-items:center}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Poppins" sans-serif;font-size:14px;font-weight:400;line-height:25px;letter-spacing:.05em;text-align:left}.slide-toggle[_ngcontent-%COMP%]{position:fixed;width:95%;height:60px;left:2%;bottom:10%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Arrived";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#409000;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:10px;left:15px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;content:"Start working";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;pointer-events:none}']});let d=s;return d})();var JV=["input1"],ej=["input2"],tj=["input3"],ij=["input4"],rA=(()=>{let s=class s{navTOBack(){this.location.back()}constructor(o,l,i,_){this.form=o,this.orderService=l,this.router=i,this.location=_,this.getOtp(),this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}onInput(o,l){if(o.target.value.length===1)switch(l){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}getOtp(){}verifyOtp(){let o=this.otp.value,l=o.inputOne+o.inputTwo+o.inputThree+o.inputFour;console.log(l),this.orderService.verifyStartOrder(l).subscribe(i=>{console.log(i),this.router.navigate(["completeWork"])},i=>{console.log(i)}),this.router.navigate(["completeWork"])}};s.\u0275fac=function(l){return new(l||s)(ye(qo),ye(Kr),ye(jt),ye(Li))},s.\u0275cmp=gt({type:s,selectors:[["app-work-otp"]],viewQuery:function(l,i){if(l&1&&(Ci(JV,5),Ci(ej,5),Ci(tj,5),Ci(ij,5)),l&2){let _;vi(_=xi())&&(i.input1=_.first),vi(_=xi())&&(i.input2=_.first),vi(_=xi())&&(i.input3=_.first),vi(_=xi())&&(i.input4=_.first)}},decls:24,vars:1,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"sub-container"],[1,"image-div"],["src","assets/demo/Stylist doing haircut.png"],[1,"info-text"],[1,"numberss"],[3,"formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input"],["type","text","maxlength","1","formControlName","inputTwo",3,"input"],["type","text","maxlength","1","formControlName","inputThree",3,"input"],["type","text","maxlength","1","formControlName","inputFour",3,"input"],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){if(l&1){let _=si();V(0,"div",4)(1,"span",5),Fe("click",function(){return Ct(_),St(i.navTOBack())}),X(2," arrow_back "),j(),V(3,"div",6)(4,"div",7),Me(5,"img",8),j(),V(6,"span")(7,"span",9),X(8,"Before start the work"),j(),Me(9,"br"),V(10,"span",10),X(11,"Enter OTP from user"),j()(),V(12,"form",11)(13,"div",12)(14,"input",13,0),Fe("input",function(I){return Ct(_),St(i.onInput(I,1))}),j(),V(16,"input",14,1),Fe("input",function(I){return Ct(_),St(i.onInput(I,2))}),j(),V(18,"input",15,2),Fe("input",function(I){return Ct(_),St(i.onInput(I,3))}),j(),V(20,"input",16,3),Fe("input",function(I){return Ct(_),St(i.onInput(I,4))}),j()(),V(22,"button",17),Fe("click",function(){return Ct(_),St(i.verifyOtp())}),X(23,"Confirm"),j()()()()}l&2&&(pe(12),Le("formGroup",i.otp))},dependencies:[ko,So,yr,Mo,xm,Go,Fa],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;margin-top:2.5%}.material-symbols-outlined[_ngcontent-%COMP%]{width:max-content;margin-left:2.5%}.sub-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;text-align:center}.image-div[_ngcontent-%COMP%]{width:100%;height:25rem}.image-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px;color:#414141}.info-text[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0;color:#414141}.numberss[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:600;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;margin-left:5%}"]});let d=s;return d})();function nj(d,s){if(d&1&&(V(0,"div",5)(1,"span",12)(2,"span",7),X(3),j(),V(4,"span",7),X(5),j()(),V(6,"span",13),X(7),j(),Me(8,"div",8),j()),d&2){let u=s.$implicit;pe(3),Us("",u.quantity," X ",u.categoryId.name,""),pe(2),Rt(u.serviceId.serviceVariants[0].price),pe(2),Us("",u.quantity," X ",u.subCategoryId.name,"")}}var oA=(()=>{let s=class s{navTOBack(){this.location.back()}constructor(o,l,i){this.orderService=o,this.router=l,this.location=i,this.total=0,this.work=[],this.alreadyHasAccount="",this.getWorkDetails()}getWorkDetails(){let o=this.orderService.oredrDetails;console.log(o);for(let l=0;l<o.items.length;l++){let i=o.items[l];this.work.push(i)}console.log(o.items),this.work.forEach(l=>{this.total=this.total+l.serviceId.serviceVariants[0].price})}toggleDisplay(){this.orderService.completeOrder().subscribe(o=>{console.log(o),this.router.navigate(["verifyAfterWork"])},o=>{console.log(o)})}};s.\u0275fac=function(l){return new(l||s)(ye(Kr),ye(jt),ye(Li))},s.\u0275cmp=gt({type:s,selectors:[["app-work-complete"]],decls:31,vars:2,consts:[[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"image"],["src","assets\\new\\Man washing hand.png"],[1,"details"],[1,"details-div"],[1,"time-div"],[1,"highlight-text"],[1,"line"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"ngModelChange","change","ngModel"],["for","toggle",1,"already-label",2,"content","'Iam Existing provider '"],[1,"about"],[1,"sub-tittle"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"span",1),Fe("click",function(){return i.navTOBack()}),X(2," arrow_back "),j(),V(3,"div",2),Me(4,"img",3),j(),V(5,"section",4),gr(6,nj,9,5,"div",5,ro),V(8,"div",6)(9,"p")(10,"span"),X(11,"Others"),j(),Me(12,"br"),V(13,"span",7),X(14,"Convenience Fee"),j()(),V(15,"p",7),X(16,"69"),j()(),Me(17,"div",8)(18,"br"),V(19,"div",6)(20,"p")(21,"span",7),X(22,"Total value"),j(),Me(23,"br"),V(24,"span"),X(25,"commission credits"),j()(),V(26,"p",7),X(27),j()()(),V(28,"div",9)(29,"input",10),so("ngModelChange",function(C){return ao(i.alreadyHasAccount,C)||(i.alreadyHasAccount=C),C}),Fe("change",function(){return i.toggleDisplay()}),j(),Me(30,"label",11),j()()),l&2&&(pe(6),_r(i.work),pe(21),Rt(i.total),pe(2),oo("ngModel",i.alreadyHasAccount))},dependencies:[ld,yr,Ws],styles:['.container[_ngcontent-%COMP%]{width:95vw;height:100%;display:flex;flex-direction:column;gap:1rem;position:relative;left:2.5%;right:2.5%;top:2.5%}.image[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.details[_ngcontent-%COMP%], .details-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem}.about[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.slide-toggle[_ngcontent-%COMP%]{position:relative;width:95%;height:46px;left:2%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Placeholder Text";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#bb0e0e;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:2px;left:2px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;color:#fff;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#000;font-size:14px;pointer-events:none}.slide-toggle[_ngcontent-%COMP%]   label.already-label[_ngcontent-%COMP%]:before{content:"Swipe to Complete";color:#fff;font-family:Poppins;font-size:1.1rem;font-weight:500;line-height:22.82px;text-align:left}.time-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.Details[_ngcontent-%COMP%]{width:90%;border:.25px solid black;border-radius:.5rem}.line[_ngcontent-%COMP%]{width:100%;height:0;border:0;border-bottom:1px dashed rgb(45,44,44)}.sub-tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:.9rem;font-weight:400;line-height:14.52px;text-align:left}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:600;line-height:16.94px;text-align:left}']});let d=s;return d})();var rj=["input1"],oj=["input2"],aj=["input3"],sj=["input4"],aA=(()=>{let s=class s{navTOBack(){this.location.back()}constructor(o,l,i,_){this.form=o,this.orderService=l,this.router=i,this.location=_,this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}onInput(o,l){if(o.target.value.length===1)switch(l){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}login(){let o=this.otp.value,l=o.inputOne+o.inputTwo+o.inputThree+o.inputFour;console.log(l),this.orderService.verifyAfterComplete(l).subscribe(i=>{console.log(i),this.router.navigate(["home"])},i=>{console.log(i)})}};s.\u0275fac=function(l){return new(l||s)(ye(qo),ye(Kr),ye(jt),ye(Li))},s.\u0275cmp=gt({type:s,selectors:[["app-verify-after-work"]],viewQuery:function(l,i){if(l&1&&(Ci(rj,5),Ci(oj,5),Ci(aj,5),Ci(sj,5)),l&2){let _;vi(_=xi())&&(i.input1=_.first),vi(_=xi())&&(i.input2=_.first),vi(_=xi())&&(i.input3=_.first),vi(_=xi())&&(i.input4=_.first)}},decls:24,vars:1,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"sub-container"],[1,"image-div"],["src","assets/demo/Stylist doing haircut.png"],[1,"info-text"],[1,"numberss"],[3,"formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input"],["type","text","maxlength","1","formControlName","inputTwo",3,"input"],["type","text","maxlength","1","formControlName","inputThree",3,"input"],["type","text","maxlength","1","formControlName","inputFour",3,"input"],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){if(l&1){let _=si();V(0,"div",4)(1,"span",5),Fe("click",function(){return Ct(_),St(i.navTOBack())}),X(2," arrow_back "),j(),V(3,"div",6)(4,"div",7),Me(5,"img",8),j(),V(6,"span")(7,"span",9),X(8,"Before start the work"),j(),Me(9,"br"),V(10,"span",10),X(11,"Enter OTP from user"),j()(),V(12,"form",11)(13,"div",12)(14,"input",13,0),Fe("input",function(I){return Ct(_),St(i.onInput(I,1))}),j(),V(16,"input",14,1),Fe("input",function(I){return Ct(_),St(i.onInput(I,2))}),j(),V(18,"input",15,2),Fe("input",function(I){return Ct(_),St(i.onInput(I,3))}),j(),V(20,"input",16,3),Fe("input",function(I){return Ct(_),St(i.onInput(I,4))}),j()(),V(22,"button",17),Fe("click",function(){return Ct(_),St(i.login())}),X(23,"Confirm"),j()()()()}l&2&&(pe(12),Le("formGroup",i.otp))},dependencies:[ko,So,yr,Mo,xm,Go,Fa],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;margin-top:2.5%;align-items:center}.material-symbols-outlined[_ngcontent-%COMP%]{width:max-content;margin-left:2.5%}.sub-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;text-align:center}.image-div[_ngcontent-%COMP%]{width:100%;height:25rem}.image-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px;color:#414141}.info-text[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0;color:#414141}.numberss[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:600;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#cd2e28;margin-left:5%}"]});let d=s;return d})();function lj(d,s){if(d&1){let u=si();V(0,"div",4)(1,"div",6),Me(2,"img",7),X(3),j(),V(4,"div")(5,"input",8),so("ngModelChange",function(l){let i=Ct(u).$implicit;return ao(i.checked,l)||(i.checked=l),St(l)}),Fe("change",function(l){let i=Ct(u).$implicit,_=ut();return St(_.onChange(l,i))}),j()()()}if(d&2){let u=s.$implicit;pe(2),Le("src",u.imageKey,ir),pe(),Rt(u.name),pe(2),oo("ngModel",u.checked)}}var sA=(()=>{let s=class s{constructor(o,l,i,_){this.loginService=o,this.logInService=l,this.router=i,this.userDetailsService=_,this.workSeleceted=[],this.items=[]}ngOnInit(){this.getSubServices()}getSubServices(){this.loginService.getSubCategory().subscribe(o=>{console.log(o),this.items=o,this.getWork()},o=>{console.log(o)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(o=>{console.log(o),this.workSeleceted=o.works,this.autoCheckServices()},o=>{console.log(o)})}autoCheckServices(){this.workSeleceted.forEach(o=>{let l=this.items.filter(i=>i.categoryId===o.categoryId._id);l.length>0&&o.subcategoryId.forEach(i=>{l.forEach(_=>{_._id===i._id&&(_.checked=!0,console.log(`Checked subcategory: ${_.name}`))})})})}send(){this.logInService.selectedSubCategories.length>0?this.router.navigate(["aboutWork"]):alert("Please select atleat one sub-category ")}onChange(o,l){let i=o.target;if(console.log(l),i&&i.checked){let C=this.items.indexOf(l);console.log("categoryId",l._),this.logInService.setSubCat(l._id)}}};s.\u0275fac=function(l){return new(l||s)(ye(Qn),ye(Qn),ye(jt),ye(vr))},s.\u0275cmp=gt({type:s,selectors:[["app-sub-services"]],decls:10,vars:0,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"serivce"],[1,"service-div"],["type","submit",1,"login-btn",3,"click"],[1,"names"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),X(3,"Select Sub-Services"),j(),Me(4,"br"),V(5,"div",3),gr(6,lj,6,3,"div",4,ro),j()(),V(8,"button",5),Fe("click",function(){return i.send()}),X(9,"Continue"),j()()),l&2&&(pe(6),_r(i.items))},dependencies:[ld,yr,Ws],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.serivce[_ngcontent-%COMP%]{height:78vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.5rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2rem;height:2rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let d=s;return d})();var lA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275cmp=gt({type:s,selectors:[["app-not-found"]],decls:11,vars:0,consts:[[1,"container"],[1,"material-symbols-outlined"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"span",1),X(2," wifi_off "),j(),V(3,"span"),X(4,"You're offline"),j(),V(5,"span"),X(6,"Please connect to internet and try again"),j(),V(7,"button")(8,"span",1),X(9," refresh "),j(),X(10," Retry "),j()())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center}.material-symbols-outlined[_ngcontent-%COMP%]{font-weight:300}"]});let d=s;return d})();var cA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275cmp=gt({type:s,selectors:[["app-location"]],decls:2,vars:0,template:function(l,i){l&1&&(V(0,"p"),X(1,"location works!"),j())}});let d=s;return d})();function cj(d,s){if(d&1){let u=si();V(0,"li"),X(1),V(2,"span",11),Fe("click",function(){let l=Ct(u).$implicit,i=ut(2).$implicit,_=ut();return St(_.removeSubcategory(i._id,l._id))}),X(3," delete "),j()()}if(d&2){let u=s.$implicit;pe(),Qi(" ",u.name," ")}}function dj(d,s){if(d&1&&(V(0,"div")(1,"ul"),Bt(2,cj,4,1,"li",10),j()()),d&2){let u=ut().$implicit;pe(2),Le("ngForOf",u.subcategoryId)}}function hj(d,s){d&1&&(V(0,"p"),X(1,"No subcategories available"),j())}function uj(d,s){if(d&1&&(V(0,"div",8)(1,"h3"),X(2),j(),Bt(3,dj,3,1,"div",9)(4,hj,2,0,"p",9),V(5,"p"),X(6),j()()),d&2){let u=s.$implicit;pe(2),Rt(u.categoryId.name),pe(),Le("ngIf",u.subcategoryId.length>0),pe(),Le("ngIf",u.subcategoryId.length===0),pe(2),Qi("Experience: ",u.experience,"")}}var dA=(()=>{let s=class s{constructor(o,l,i){this.location=o,this.userDetailsService=l,this.router=i,this.works=[]}ngOnInit(){this.getWork()}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe({next:o=>{console.log(o),this.works=o.works},error:o=>{console.log(o)}})}removeSubcategory(o,l){console.log(o,"subCat",l),this.userDetailsService.deleteWork(o,l).subscribe({next:i=>{console.log(i),this.getWork()},error:i=>{console.log(i)}})}navToSelectWork(){this.router.navigate(["selectWork"])}navToBack(){console.log("back"),this.location.back()}};s.\u0275fac=function(l){return new(l||s)(ye(Li),ye(vr),ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-manage-services"]],decls:14,vars:1,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"new-address",3,"click"],[1,"material-symbols-outlined","notranslate"],["class","work-div",4,"ngFor","ngForOf"],[1,"work-div"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"material-icons",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return i.navToBack()}),X(3,"arrow_back"),j(),V(4,"span",3),X(5,"Manage Services"),j()(),V(6,"div",4)(7,"div",5),Fe("click",function(){return i.navToSelectWork()}),V(8,"div")(9,"span",6),X(10," add "),j(),V(11,"span"),X(12,"Add new Services"),j()()(),Bt(13,uj,7,4,"div",7),j()()),l&2&&(pe(13),Le("ngForOf",i.works))},dependencies:[br,lr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:670px;position:relative;top:2%;left:5%;display:flex;flex-direction:column;gap:1rem}.new-address[_ngcontent-%COMP%]{width:100%;height:2.5rem;border-radius:.6rem;border:.25px solid black;display:flex;justify-content:space-between;align-items:center}.new-address[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:60%;display:flex;align-items:center;gap:.5rem;padding-left:.5rem}.new-address[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:16.94px;color:#f9a600}.arrow[_ngcontent-%COMP%]{width:100%;display:flex;text-align:center;margin:1rem 0 0 1rem}.tittle[_ngcontent-%COMP%]{width:80%;font-family:"Inter" sans-serif;font-size:22px;font-weight:500;line-height:26.63px;text-align:center}.work-div[_ngcontent-%COMP%]{margin-bottom:20px;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:2px 2px 10px #0000001a}h3[_ngcontent-%COMP%]{margin:0;color:#2c3e50}ul[_ngcontent-%COMP%]{list-style:none;padding:0}li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin:5px 0;padding:5px;border:1px solid #ddd;border-radius:4px;background-color:#f9f9f9}p[_ngcontent-%COMP%]{color:#7f8c8d;font-size:14px;margin:5px 0}.material-icons[_ngcontent-%COMP%]{cursor:pointer;color:#e74c3c;font-size:24px;transition:color .2s ease}.material-icons[_ngcontent-%COMP%]:hover{color:#c0392b}p[ngIf][_ngcontent-%COMP%]{color:#95a5a6;font-style:italic}']});let d=s;return d})();var mj=[{path:"",component:UT},{path:"language",component:HT},{path:"log-in",component:YT},{path:"location",component:cA},{path:"verify",component:ZT},{path:"aboutUser",component:QT},{path:"selectWork",component:JT},{path:"aboutWork",component:eI},{path:"workExperiance",component:tI},{path:"aadharVerify",component:iI},{path:"pancard",component:nI},{path:"bankDetails",component:rI},{path:"waiting",component:OD},{path:"home",component:aI},{path:"fotter",component:$s},{path:"credits",component:sI},{path:"notification",component:RD},{path:"menu",component:lI},{path:"visitingCard",component:cI},{path:"referAndEarn",component:dI},{path:"awards",component:hI},{path:"help",loadChildren:()=>import("./chunk-UQ5Y4HBM.js").then(d=>d.HelpModule)},{path:"target",component:_I},{path:"earnings",component:PD},{path:"calender",component:LD},{path:"jobHistory",component:FD},{path:"jobDetails",component:ND},{path:"addCredit",component:zD},{path:"financialDetails",component:BD},{path:"identityVerification",component:VD},{path:"ongoing",component:jD},{path:"demo",component:vb},{path:"induction",component:UD},{path:"started",component:HD},{path:"selectAccount",component:WD},{path:"congrats",component:GD},{path:"packages",component:qD},{path:"training",component:$D},{path:"getOrder",component:tA},{path:"arrived",component:iA},{path:"startWork",component:nA},{path:"work/otp",component:rA},{path:"completeWork",component:oA},{path:"verifyAfterWork",component:aA},{path:"subServices",component:sA},{path:"notFound",component:lA},{path:"manageServices",component:dA}],hA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[qx.forRoot(mj),qx]});let d=s;return d})();var aC=wm("App",{web:()=>import("./chunk-4TIA3IU3.js").then(d=>new d.AppWeb)});var sC=wm("Network",{web:()=>import("./chunk-Y3XLC3XN.js").then(d=>new d.NetworkWeb)});var uA=(()=>{let s=class s{constructor(o,l,i){this.location=o,this.messagingService=l,this.router=i,this.title="CoolieNo.1_Provider",this.myObject={}}ngOnInit(){this.messagingService.requestPermission(),setTimeout(()=>{this.myObject=this.messagingService.token?{token:this.messagingService.token}:{}},5e3),this.messagingService.listenForMessages(),this.monitorNetworkStatus(),this.registerBackButtonListener()}registerBackButtonListener(){aC.addListener("backButton",o=>{o.canGoBack?(this.location.back(),console.log("Back button pressed, navigating back")):(console.log("Back button pressed, exiting app"),aC.exitApp())})}monitorNetworkStatus(){return bo(this,null,function*(){(yield sC.getStatus()).connected||this.router.navigate(["not-found"]),sC.addListener("networkStatusChange",l=>{l.connected||this.router.navigate(["not-found"])})})}};s.\u0275fac=function(l){return new(l||s)(ye(Li),ye(_y),ye(jt))},s.\u0275cmp=gt({type:s,selectors:[["app-root"]],decls:1,vars:0,template:function(l,i){l&1&&Me(0,"router-outlet")},dependencies:[tb]});let d=s;return d})();var pj="@",fj=(()=>{let s=class s{constructor(o,l,i,_,C){this.doc=o,this.delegate=l,this.zone=i,this.animationType=_,this.moduleImpl=C,this._rendererFactoryPromise=null,this.scheduler=vn(U0,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-7R6AAWBE.js")).catch(l=>{throw new ZM(5300,!1)}).then(({\u0275createEngine:l,\u0275AnimationRendererFactory:i})=>{this._engine=l(this.animationType,this.doc,this.scheduler);let _=new i(this.delegate,this._engine,this.zone);return this.delegate=_,_})}createRenderer(o,l){let i=this.delegate.createRenderer(o,l);if(i.\u0275type===0)return i;typeof i.throwOnSyntheticProps=="boolean"&&(i.throwOnSyntheticProps=!1);let _=new lC(i);return l?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(C=>{let I=C.createRenderer(o,l);_.use(I)}).catch(C=>{_.use(i)}),_}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};s.\u0275fac=function(l){ym()},s.\u0275prov=Ht({token:s,factory:s.\u0275fac});let d=s;return d})(),lC=class{constructor(s){this.delegate=s,this.replay=[],this.\u0275type=1}use(s){if(this.delegate=s,this.replay!==null){for(let u of this.replay)u(s);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(s,u){return this.delegate.createElement(s,u)}createComment(s){return this.delegate.createComment(s)}createText(s){return this.delegate.createText(s)}get destroyNode(){return this.delegate.destroyNode}appendChild(s,u){this.delegate.appendChild(s,u)}insertBefore(s,u,o,l){this.delegate.insertBefore(s,u,o,l)}removeChild(s,u,o){this.delegate.removeChild(s,u,o)}selectRootElement(s,u){return this.delegate.selectRootElement(s,u)}parentNode(s){return this.delegate.parentNode(s)}nextSibling(s){return this.delegate.nextSibling(s)}setAttribute(s,u,o,l){this.delegate.setAttribute(s,u,o,l)}removeAttribute(s,u,o){this.delegate.removeAttribute(s,u,o)}addClass(s,u){this.delegate.addClass(s,u)}removeClass(s,u){this.delegate.removeClass(s,u)}setStyle(s,u,o,l){this.delegate.setStyle(s,u,o,l)}removeStyle(s,u,o){this.delegate.removeStyle(s,u,o)}setProperty(s,u,o){this.shouldReplay(u)&&this.replay.push(l=>l.setProperty(s,u,o)),this.delegate.setProperty(s,u,o)}setValue(s,u){this.delegate.setValue(s,u)}listen(s,u,o){return this.shouldReplay(u)&&this.replay.push(l=>l.listen(s,u,o)),this.delegate.listen(s,u,o)}shouldReplay(s){return this.replay!==null&&s.startsWith(pj)}};function mA(d="animations"){return zx("NgAsyncAnimations"),QM([{provide:H0,useFactory:(s,u,o)=>new fj(s,u,o,d),deps:[un,Z0,Ri]},{provide:Zr,useValue:d==="noop"?"NoopAnimations":"BrowserAnimations"}])}var gj=VM(W1());var by={production:!1,firebase:{apiKey:"AIzaSyAcziwgDyx2SxCSeuGbgFDr9_94R2tpDfk",authDomain:"coolie-9cc38.firebaseapp.com",projectId:"coolie-9cc38",storageBucket:"coolie-9cc38.appspot.com",messagingSenderId:"425618348845",appId:"1:425618348845:android:dfb682ab264340b4f611a4",measurementId:"G-X6752VX6L5",vapidKey:"BFLySRIkI2i4ZrxUJjrsCDeG921cCUs-9zLhyulNlP7HUawhIVFefo8GFfxxgnpTWV9zgiKJ9m9Vx8C39MRgPYA"}};var pA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s,bootstrap:[uA]}),s.\u0275inj=hi({providers:[mA(),Zo],imports:[X0,hA,yk,vk,dk,Dk,nT,oT,aT,sT,cT,jT,dT,pI,AT,Jk,QD.initializeApp(by.firebase),JD,qT]});let d=s;return d})();by.production&&void 0;hk().bootstrapModule(pA).catch(d=>console.error(d));"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js").then(d=>{console.log("Service Worker registered with scope:",d.scope)}).catch(d=>{console.log("Service Worker registration failed:",d)});
