import{$ as zD,$a as hn,$b as wC,A as wr,Aa as ND,Ab as Ts,Ac as SC,B as sC,Ba as o_,Bb as Y,Bc as u_,C as Md,Ca as VD,Cb as zt,Cc as Fd,D as Td,Da as $o,Db as bn,Dc as MC,E as lC,Ea as lo,Eb as rl,Ec as TC,F as n_,Fa as a_,Fb as Rd,Fc as p_,G as ao,Ga as Er,Gb as wo,H as RD,Ha as jD,Hb as Co,I as cC,Ia as s_,Ib as So,J as pu,Ja as xe,Jb as gr,K as Id,Ka as ge,Kb as Bn,L as dC,La as Pd,Lb as Mo,Lc as sk,M as FD,Ma as fu,Mb as Lb,Mc as m_,N as hC,Na as Rb,Nb as um,Nc as Gb,O as LD,Oa as l_,Ob as GD,P as uC,Pa as lm,Pb as zb,Q as Pb,Qa as nl,Qb as $D,R as ka,Ra as Fb,Rb as Bb,S as ur,Sa as di,Sb as Nb,Sc as lk,T as pC,Ta as _C,Tb as bC,Tc as $b,U as Kl,Ua as Od,Ub as Vb,V as so,Va as zn,Vb as vC,Vc as ck,W as $n,Wa as co,Wb as xC,X as Ed,Xa as UD,Xb as pm,Y as Fo,Ya as yC,Yb as jb,Z as At,Za as c_,Zb as qD,_ as ii,_a as Zt,_b as YD,_c as dk,a as Da,aa as Qt,ab as rt,ac as _r,b as ED,ba as mC,bb as Ka,bc as ZD,c as Ro,ca as Ye,cb as Ni,cc as XD,d as rC,da as Nt,db as Ms,dc as sr,e as oC,ea as mu,eb as Dr,ec as CC,f as dn,fa as Ob,fb as xo,fc as KD,g as aa,ga as r_,gb as d_,gc as gu,h as DD,ha as bi,hb as Cr,hc as QD,i as kD,ia as gt,ib as Sr,ic as JD,j as tl,ja as ni,jb as V,jc as Ai,k as Zl,ka as Ei,kb as j,kc as ek,l as Xl,la as sm,lb as Ee,lc as h_,m as oo,ma as BD,mb as cm,mc as tk,n as Jt,na as Dd,nb as dm,nc as ik,o as t_,oa as il,ob as gi,oc as Pi,p as aC,pa as ar,pb as Ql,pc as Ub,q as AD,qa as Mt,qb as HD,qc as Qa,r as pn,ra as Tt,rb as Fe,rc as Vr,s as om,sa as kd,sb as WD,sc as jr,t as Go,ta as fC,tb as Et,tc as nk,u as i_,ua as vo,ub as sa,uc as ol,v as am,va as Ad,vb as zo,vc as rk,w as hu,wa as Lo,wb as hm,wc as ok,x as PD,xa as gC,xb as ki,xc as Hb,y as OD,ya as Zi,yb as Ci,yc as ak,z as uu,za as Ii,zb as Si,zc as Wb}from"./chunk-YLYD3P2Y.js";import{i as uk,j as Is,k as pk}from"./chunk-VR2CY5TD.js";import{a as hk,b as mm}from"./chunk-5WWDFZLP.js";import{a as kt,b as Cn,c as nC,d as DB,f as ID,g as Qr}from"./chunk-MON7YFGF.js";var P2=DB((k2,A2)=>{"use strict";(function(a,n){typeof k2=="object"&&typeof A2<"u"?A2.exports=n():typeof define=="function"&&define.amd?define(n):(a=typeof globalThis<"u"?globalThis:a||self,a.mapboxgl=n())})(k2,function(){"use strict";var a,n,d;function r(t,g){if(!a)a=g;else if(!n)n=g;else{var b="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",M={};a(M),d=g(M),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([b],{type:"text/javascript"})))}}r(["exports"],function(t){var g="3.5.1";let b,M={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(b==null){let i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{b=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):i}catch{b=i}}return b},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!M.API_URL)return null;try{let i=new URL(M.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function k(i){return M.API_URL_REGEX.test(i)}function L(i){return i.indexOf("mapbox:")===0}function G(i){return M.API_CDN_URL_REGEX.test(i)}function J(i){return M.API_SPRITE_REGEX.test(i)}function oe(i){return M.API_STYLE_REGEX.test(i)&&!J(i)}let be={create:"create",load:"load",fullLoad:"fullLoad"},Me={mark(i){performance.mark(i)},measure(i,e,o){performance.measure(i,e,o)}};function Te(i){let e=i.name.split("?")[0];return G(e)&&e.includes("mapbox-gl.js")?"javascript":G(e)&&e.includes("mapbox-gl.css")?"css":function(o){return M.API_FONTS_REGEX.test(o)}(e)?"fontRange":J(e)?"sprite":oe(e)?"style":function(o){return M.API_TILEJSON_REGEX.test(o)}(e)?"tilejson":"other"}function He(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var We={},dt={};Object.defineProperty(dt,"__esModule",{value:!0}),dt.setMatrixArrayType=function(i){dt.ARRAY_TYPE=ft=i},dt.toRadian=function(i){return i*Wt},dt.equals=function(i,e){return Math.abs(i-e)<=bt*Math.max(1,Math.abs(i),Math.abs(e))},dt.RANDOM=dt.ARRAY_TYPE=dt.EPSILON=void 0;var bt=1e-6;dt.EPSILON=bt;var ft=typeof Float32Array<"u"?Float32Array:Array;dt.ARRAY_TYPE=ft;var It=Math.random;dt.RANDOM=It;var Wt=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var xt={};function Xt(i){return Xt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xt(i)}Object.defineProperty(xt,"__esModule",{value:!0}),xt.create=function(){var i=new Vt.ARRAY_TYPE(4);return Vt.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},xt.clone=function(i){var e=new Vt.ARRAY_TYPE(4);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e},xt.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},xt.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i},xt.fromValues=function(i,e,o,c){var h=new Vt.ARRAY_TYPE(4);return h[0]=i,h[1]=e,h[2]=o,h[3]=c,h},xt.set=function(i,e,o,c,h){return i[0]=e,i[1]=o,i[2]=c,i[3]=h,i},xt.transpose=function(i,e){if(i===e){var o=e[1];i[1]=e[2],i[2]=o}else i[0]=e[0],i[1]=e[2],i[2]=e[1],i[3]=e[3];return i},xt.invert=function(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=o*p-h*c;return m?(i[0]=p*(m=1/m),i[1]=-c*m,i[2]=-h*m,i[3]=o*m,i):null},xt.adjoint=function(i,e){var o=e[0];return i[0]=e[3],i[1]=-e[1],i[2]=-e[2],i[3]=o,i},xt.determinant=function(i){return i[0]*i[3]-i[2]*i[1]},xt.multiply=Xi,xt.rotate=function(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=Math.sin(o),v=Math.cos(o);return i[0]=c*v+p*y,i[1]=h*v+m*y,i[2]=c*-y+p*v,i[3]=h*-y+m*v,i},xt.scale=function(i,e,o){var c=e[1],h=e[2],p=e[3],m=o[0],y=o[1];return i[0]=e[0]*m,i[1]=c*m,i[2]=h*y,i[3]=p*y,i},xt.fromRotation=function(i,e){var o=Math.sin(e),c=Math.cos(e);return i[0]=c,i[1]=o,i[2]=-o,i[3]=c,i},xt.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=e[1],i},xt.str=function(i){return"mat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},xt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},xt.LDU=function(i,e,o,c){return i[2]=c[2]/c[0],o[0]=c[0],o[1]=c[1],o[3]=c[3]-i[2]*o[1],[i,e,o]},xt.add=function(i,e,o){return i[0]=e[0]+o[0],i[1]=e[1]+o[1],i[2]=e[2]+o[2],i[3]=e[3]+o[3],i},xt.subtract=lr,xt.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},xt.equals=function(i,e){var o=i[0],c=i[1],h=i[2],p=i[3],m=e[0],y=e[1],v=e[2],C=e[3];return Math.abs(o-m)<=Vt.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(c-y)<=Vt.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-v)<=Vt.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(p-C)<=Vt.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))},xt.multiplyScalar=function(i,e,o){return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i},xt.multiplyScalarAndAdd=function(i,e,o,c){return i[0]=e[0]+o[0]*c,i[1]=e[1]+o[1]*c,i[2]=e[2]+o[2]*c,i[3]=e[3]+o[3]*c,i},xt.sub=xt.mul=void 0;var Vt=function(i,e){if(i&&i.__esModule)return i;if(i===null||Xt(i)!=="object"&&typeof i!="function")return{default:i};var o=Oi(void 0);if(o&&o.has(i))return o.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,o&&o.set(i,c),c}(dt);function Oi(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(Oi=function(c){return c?o:e})(i)}function Xi(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=o[0],v=o[1],C=o[2],T=o[3];return i[0]=c*y+p*v,i[1]=h*y+m*v,i[2]=c*C+p*T,i[3]=h*C+m*T,i}function lr(i,e,o){return i[0]=e[0]-o[0],i[1]=e[1]-o[1],i[2]=e[2]-o[2],i[3]=e[3]-o[3],i}xt.mul=Xi,xt.sub=lr;var Mi={};function gn(i){return gn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gn(i)}Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.create=function(){var i=new sn.ARRAY_TYPE(6);return sn.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[4]=0,i[5]=0),i[0]=1,i[3]=1,i},Mi.clone=function(i){var e=new sn.ARRAY_TYPE(6);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e},Mi.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i},Mi.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i},Mi.fromValues=function(i,e,o,c,h,p){var m=new sn.ARRAY_TYPE(6);return m[0]=i,m[1]=e,m[2]=o,m[3]=c,m[4]=h,m[5]=p,m},Mi.set=function(i,e,o,c,h,p,m){return i[0]=e,i[1]=o,i[2]=c,i[3]=h,i[4]=p,i[5]=m,i},Mi.invert=function(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=e[4],y=e[5],v=o*p-c*h;return v?(i[0]=p*(v=1/v),i[1]=-c*v,i[2]=-h*v,i[3]=o*v,i[4]=(h*y-p*m)*v,i[5]=(c*m-o*y)*v,i):null},Mi.determinant=function(i){return i[0]*i[3]-i[1]*i[2]},Mi.multiply=Gr,Mi.rotate=function(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=e[4],v=e[5],C=Math.sin(o),T=Math.cos(o);return i[0]=c*T+p*C,i[1]=h*T+m*C,i[2]=c*-C+p*T,i[3]=h*-C+m*T,i[4]=y,i[5]=v,i},Mi.scale=function(i,e,o){var c=e[1],h=e[2],p=e[3],m=e[4],y=e[5],v=o[0],C=o[1];return i[0]=e[0]*v,i[1]=c*v,i[2]=h*C,i[3]=p*C,i[4]=m,i[5]=y,i},Mi.translate=function(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=e[4],v=e[5],C=o[0],T=o[1];return i[0]=c,i[1]=h,i[2]=p,i[3]=m,i[4]=c*C+p*T+y,i[5]=h*C+m*T+v,i},Mi.fromRotation=function(i,e){var o=Math.sin(e),c=Math.cos(e);return i[0]=c,i[1]=o,i[2]=-o,i[3]=c,i[4]=0,i[5]=0,i},Mi.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=e[1],i[4]=0,i[5]=0,i},Mi.fromTranslation=function(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=e[0],i[5]=e[1],i},Mi.str=function(i){return"mat2d("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+")"},Mi.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],1)},Mi.add=function(i,e,o){return i[0]=e[0]+o[0],i[1]=e[1]+o[1],i[2]=e[2]+o[2],i[3]=e[3]+o[3],i[4]=e[4]+o[4],i[5]=e[5]+o[5],i},Mi.subtract=Zn,Mi.multiplyScalar=function(i,e,o){return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*o,i[5]=e[5]*o,i},Mi.multiplyScalarAndAdd=function(i,e,o,c){return i[0]=e[0]+o[0]*c,i[1]=e[1]+o[1]*c,i[2]=e[2]+o[2]*c,i[3]=e[3]+o[3]*c,i[4]=e[4]+o[4]*c,i[5]=e[5]+o[5]*c,i},Mi.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]},Mi.equals=function(i,e){var o=i[0],c=i[1],h=i[2],p=i[3],m=i[4],y=i[5],v=e[0],C=e[1],T=e[2],E=e[3],D=e[4],O=e[5];return Math.abs(o-v)<=sn.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(c-C)<=sn.EPSILON*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(h-T)<=sn.EPSILON*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(p-E)<=sn.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(m-D)<=sn.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(y-O)<=sn.EPSILON*Math.max(1,Math.abs(y),Math.abs(O))},Mi.sub=Mi.mul=void 0;var sn=function(i,e){if(i&&i.__esModule)return i;if(i===null||gn(i)!=="object"&&typeof i!="function")return{default:i};var o=Hn(void 0);if(o&&o.has(i))return o.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,o&&o.set(i,c),c}(dt);function Hn(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(Hn=function(c){return c?o:e})(i)}function Gr(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=e[4],v=e[5],C=o[0],T=o[1],E=o[2],D=o[3],O=o[4],R=o[5];return i[0]=c*C+p*T,i[1]=h*C+m*T,i[2]=c*E+p*D,i[3]=h*E+m*D,i[4]=c*O+p*R+y,i[5]=h*O+m*R+v,i}function Zn(i,e,o){return i[0]=e[0]-o[0],i[1]=e[1]-o[1],i[2]=e[2]-o[2],i[3]=e[3]-o[3],i[4]=e[4]-o[4],i[5]=e[5]-o[5],i}Mi.mul=Gr,Mi.sub=Zn;var Ri={};function ga(i){return ga=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ga(i)}Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.create=function(){var i=new Xn.ARRAY_TYPE(9);return Xn.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},Ri.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},Ri.clone=function(i){var e=new Xn.ARRAY_TYPE(9);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e},Ri.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i},Ri.fromValues=function(i,e,o,c,h,p,m,y,v){var C=new Xn.ARRAY_TYPE(9);return C[0]=i,C[1]=e,C[2]=o,C[3]=c,C[4]=h,C[5]=p,C[6]=m,C[7]=y,C[8]=v,C},Ri.set=function(i,e,o,c,h,p,m,y,v,C){return i[0]=e,i[1]=o,i[2]=c,i[3]=h,i[4]=p,i[5]=m,i[6]=y,i[7]=v,i[8]=C,i},Ri.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Ri.transpose=function(i,e){if(i===e){var o=e[1],c=e[2],h=e[5];i[1]=e[3],i[2]=e[6],i[3]=o,i[5]=e[7],i[6]=c,i[7]=h}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},Ri.invert=function(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=e[4],y=e[5],v=e[6],C=e[7],T=e[8],E=T*m-y*C,D=-T*p+y*v,O=C*p-m*v,R=o*E+c*D+h*O;return R?(i[0]=E*(R=1/R),i[1]=(-T*c+h*C)*R,i[2]=(y*c-h*m)*R,i[3]=D*R,i[4]=(T*o-h*v)*R,i[5]=(-y*o+h*p)*R,i[6]=O*R,i[7]=(-C*o+c*v)*R,i[8]=(m*o-c*p)*R,i):null},Ri.adjoint=function(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=e[4],y=e[5],v=e[6],C=e[7],T=e[8];return i[0]=m*T-y*C,i[1]=h*C-c*T,i[2]=c*y-h*m,i[3]=y*v-p*T,i[4]=o*T-h*v,i[5]=h*p-o*y,i[6]=p*C-m*v,i[7]=c*v-o*C,i[8]=o*m-c*p,i},Ri.determinant=function(i){var e=i[3],o=i[4],c=i[5],h=i[6],p=i[7],m=i[8];return i[0]*(m*o-c*p)+i[1]*(-m*e+c*h)+i[2]*(p*e-o*h)},Ri.multiply=Zo,Ri.translate=function(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=e[4],v=e[5],C=e[6],T=e[7],E=e[8],D=o[0],O=o[1];return i[0]=c,i[1]=h,i[2]=p,i[3]=m,i[4]=y,i[5]=v,i[6]=D*c+O*m+C,i[7]=D*h+O*y+T,i[8]=D*p+O*v+E,i},Ri.rotate=function(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=e[4],v=e[5],C=e[6],T=e[7],E=e[8],D=Math.sin(o),O=Math.cos(o);return i[0]=O*c+D*m,i[1]=O*h+D*y,i[2]=O*p+D*v,i[3]=O*m-D*c,i[4]=O*y-D*h,i[5]=O*v-D*p,i[6]=C,i[7]=T,i[8]=E,i},Ri.scale=function(i,e,o){var c=o[0],h=o[1];return i[0]=c*e[0],i[1]=c*e[1],i[2]=c*e[2],i[3]=h*e[3],i[4]=h*e[4],i[5]=h*e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i},Ri.fromTranslation=function(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=e[0],i[7]=e[1],i[8]=1,i},Ri.fromRotation=function(i,e){var o=Math.sin(e),c=Math.cos(e);return i[0]=c,i[1]=o,i[2]=0,i[3]=-o,i[4]=c,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Ri.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=e[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Ri.fromMat2d=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=0,i[3]=e[2],i[4]=e[3],i[5]=0,i[6]=e[4],i[7]=e[5],i[8]=1,i},Ri.fromQuat=function(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=o+o,y=c+c,v=h+h,C=o*m,T=c*m,E=c*y,D=h*m,O=h*y,R=h*v,z=p*m,N=p*y,W=p*v;return i[0]=1-E-R,i[3]=T-W,i[6]=D+N,i[1]=T+W,i[4]=1-C-R,i[7]=O-z,i[2]=D-N,i[5]=O+z,i[8]=1-C-E,i},Ri.normalFromMat4=function(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=e[4],y=e[5],v=e[6],C=e[7],T=e[8],E=e[9],D=e[10],O=e[11],R=e[12],z=e[13],N=e[14],W=e[15],ee=o*y-c*m,te=o*v-h*m,ie=o*C-p*m,pe=c*v-h*y,he=c*C-p*y,ve=h*C-p*v,Ce=T*z-E*R,Ae=T*N-D*R,je=T*W-O*R,Le=E*N-D*z,qe=E*W-O*z,ot=D*W-O*N,Ge=ee*ot-te*qe+ie*Le+pe*je-he*Ae+ve*Ce;return Ge?(i[0]=(y*ot-v*qe+C*Le)*(Ge=1/Ge),i[1]=(v*je-m*ot-C*Ae)*Ge,i[2]=(m*qe-y*je+C*Ce)*Ge,i[3]=(h*qe-c*ot-p*Le)*Ge,i[4]=(o*ot-h*je+p*Ae)*Ge,i[5]=(c*je-o*qe-p*Ce)*Ge,i[6]=(z*ve-N*he+W*pe)*Ge,i[7]=(N*ie-R*ve-W*te)*Ge,i[8]=(R*he-z*ie+W*ee)*Ge,i):null},Ri.projection=function(i,e,o){return i[0]=2/e,i[1]=0,i[2]=0,i[3]=0,i[4]=-2/o,i[5]=0,i[6]=-1,i[7]=1,i[8]=1,i},Ri.str=function(i){return"mat3("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+")"},Ri.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},Ri.add=function(i,e,o){return i[0]=e[0]+o[0],i[1]=e[1]+o[1],i[2]=e[2]+o[2],i[3]=e[3]+o[3],i[4]=e[4]+o[4],i[5]=e[5]+o[5],i[6]=e[6]+o[6],i[7]=e[7]+o[7],i[8]=e[8]+o[8],i},Ri.subtract=La,Ri.multiplyScalar=function(i,e,o){return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*o,i[5]=e[5]*o,i[6]=e[6]*o,i[7]=e[7]*o,i[8]=e[8]*o,i},Ri.multiplyScalarAndAdd=function(i,e,o,c){return i[0]=e[0]+o[0]*c,i[1]=e[1]+o[1]*c,i[2]=e[2]+o[2]*c,i[3]=e[3]+o[3]*c,i[4]=e[4]+o[4]*c,i[5]=e[5]+o[5]*c,i[6]=e[6]+o[6]*c,i[7]=e[7]+o[7]*c,i[8]=e[8]+o[8]*c,i},Ri.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]},Ri.equals=function(i,e){var o=i[0],c=i[1],h=i[2],p=i[3],m=i[4],y=i[5],v=i[6],C=i[7],T=i[8],E=e[0],D=e[1],O=e[2],R=e[3],z=e[4],N=e[5],W=e[6],ee=e[7],te=e[8];return Math.abs(o-E)<=Xn.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(c-D)<=Xn.EPSILON*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(h-O)<=Xn.EPSILON*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(p-R)<=Xn.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(m-z)<=Xn.EPSILON*Math.max(1,Math.abs(m),Math.abs(z))&&Math.abs(y-N)<=Xn.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(v-W)<=Xn.EPSILON*Math.max(1,Math.abs(v),Math.abs(W))&&Math.abs(C-ee)<=Xn.EPSILON*Math.max(1,Math.abs(C),Math.abs(ee))&&Math.abs(T-te)<=Xn.EPSILON*Math.max(1,Math.abs(T),Math.abs(te))},Ri.sub=Ri.mul=void 0;var Xn=function(i,e){if(i&&i.__esModule)return i;if(i===null||ga(i)!=="object"&&typeof i!="function")return{default:i};var o=Fa(void 0);if(o&&o.has(i))return o.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,o&&o.set(i,c),c}(dt);function Fa(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(Fa=function(c){return c?o:e})(i)}function Zo(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=e[4],v=e[5],C=e[6],T=e[7],E=e[8],D=o[0],O=o[1],R=o[2],z=o[3],N=o[4],W=o[5],ee=o[6],te=o[7],ie=o[8];return i[0]=D*c+O*m+R*C,i[1]=D*h+O*y+R*T,i[2]=D*p+O*v+R*E,i[3]=z*c+N*m+W*C,i[4]=z*h+N*y+W*T,i[5]=z*p+N*v+W*E,i[6]=ee*c+te*m+ie*C,i[7]=ee*h+te*y+ie*T,i[8]=ee*p+te*v+ie*E,i}function La(i,e,o){return i[0]=e[0]-o[0],i[1]=e[1]-o[1],i[2]=e[2]-o[2],i[3]=e[3]-o[3],i[4]=e[4]-o[4],i[5]=e[5]-o[5],i[6]=e[6]-o[6],i[7]=e[7]-o[7],i[8]=e[8]-o[8],i}Ri.mul=Zo,Ri.sub=La;var $t={};function gc(i){return gc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gc(i)}Object.defineProperty($t,"__esModule",{value:!0}),$t.create=function(){var i=new In.ARRAY_TYPE(16);return In.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},$t.clone=function(i){var e=new In.ARRAY_TYPE(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},$t.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},$t.fromValues=function(i,e,o,c,h,p,m,y,v,C,T,E,D,O,R,z){var N=new In.ARRAY_TYPE(16);return N[0]=i,N[1]=e,N[2]=o,N[3]=c,N[4]=h,N[5]=p,N[6]=m,N[7]=y,N[8]=v,N[9]=C,N[10]=T,N[11]=E,N[12]=D,N[13]=O,N[14]=R,N[15]=z,N},$t.set=function(i,e,o,c,h,p,m,y,v,C,T,E,D,O,R,z,N){return i[0]=e,i[1]=o,i[2]=c,i[3]=h,i[4]=p,i[5]=m,i[6]=y,i[7]=v,i[8]=C,i[9]=T,i[10]=E,i[11]=D,i[12]=O,i[13]=R,i[14]=z,i[15]=N,i},$t.identity=ju,$t.transpose=function(i,e){if(i===e){var o=e[1],c=e[2],h=e[3],p=e[6],m=e[7],y=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=o,i[6]=e[9],i[7]=e[13],i[8]=c,i[9]=p,i[11]=e[14],i[12]=h,i[13]=m,i[14]=y}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i},$t.invert=function(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=e[4],y=e[5],v=e[6],C=e[7],T=e[8],E=e[9],D=e[10],O=e[11],R=e[12],z=e[13],N=e[14],W=e[15],ee=o*y-c*m,te=o*v-h*m,ie=o*C-p*m,pe=c*v-h*y,he=c*C-p*y,ve=h*C-p*v,Ce=T*z-E*R,Ae=T*N-D*R,je=T*W-O*R,Le=E*N-D*z,qe=E*W-O*z,ot=D*W-O*N,Ge=ee*ot-te*qe+ie*Le+pe*je-he*Ae+ve*Ce;return Ge?(i[0]=(y*ot-v*qe+C*Le)*(Ge=1/Ge),i[1]=(h*qe-c*ot-p*Le)*Ge,i[2]=(z*ve-N*he+W*pe)*Ge,i[3]=(D*he-E*ve-O*pe)*Ge,i[4]=(v*je-m*ot-C*Ae)*Ge,i[5]=(o*ot-h*je+p*Ae)*Ge,i[6]=(N*ie-R*ve-W*te)*Ge,i[7]=(T*ve-D*ie+O*te)*Ge,i[8]=(m*qe-y*je+C*Ce)*Ge,i[9]=(c*je-o*qe-p*Ce)*Ge,i[10]=(R*he-z*ie+W*ee)*Ge,i[11]=(E*ie-T*he-O*ee)*Ge,i[12]=(y*Ae-m*Le-v*Ce)*Ge,i[13]=(o*Le-c*Ae+h*Ce)*Ge,i[14]=(z*te-R*pe-N*ee)*Ge,i[15]=(T*pe-E*te+D*ee)*Ge,i):null},$t.adjoint=function(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=e[4],y=e[5],v=e[6],C=e[7],T=e[8],E=e[9],D=e[10],O=e[11],R=e[12],z=e[13],N=e[14],W=e[15];return i[0]=y*(D*W-O*N)-E*(v*W-C*N)+z*(v*O-C*D),i[1]=-(c*(D*W-O*N)-E*(h*W-p*N)+z*(h*O-p*D)),i[2]=c*(v*W-C*N)-y*(h*W-p*N)+z*(h*C-p*v),i[3]=-(c*(v*O-C*D)-y*(h*O-p*D)+E*(h*C-p*v)),i[4]=-(m*(D*W-O*N)-T*(v*W-C*N)+R*(v*O-C*D)),i[5]=o*(D*W-O*N)-T*(h*W-p*N)+R*(h*O-p*D),i[6]=-(o*(v*W-C*N)-m*(h*W-p*N)+R*(h*C-p*v)),i[7]=o*(v*O-C*D)-m*(h*O-p*D)+T*(h*C-p*v),i[8]=m*(E*W-O*z)-T*(y*W-C*z)+R*(y*O-C*E),i[9]=-(o*(E*W-O*z)-T*(c*W-p*z)+R*(c*O-p*E)),i[10]=o*(y*W-C*z)-m*(c*W-p*z)+R*(c*C-p*y),i[11]=-(o*(y*O-C*E)-m*(c*O-p*E)+T*(c*C-p*y)),i[12]=-(m*(E*N-D*z)-T*(y*N-v*z)+R*(y*D-v*E)),i[13]=o*(E*N-D*z)-T*(c*N-h*z)+R*(c*D-h*E),i[14]=-(o*(y*N-v*z)-m*(c*N-h*z)+R*(c*v-h*y)),i[15]=o*(y*D-v*E)-m*(c*D-h*E)+T*(c*v-h*y),i},$t.determinant=function(i){var e=i[0],o=i[1],c=i[2],h=i[3],p=i[4],m=i[5],y=i[6],v=i[7],C=i[8],T=i[9],E=i[10],D=i[11],O=i[12],R=i[13],z=i[14],N=i[15];return(e*m-o*p)*(E*N-D*z)-(e*y-c*p)*(T*N-D*R)+(e*v-h*p)*(T*z-E*R)+(o*y-c*m)*(C*N-D*O)-(o*v-h*m)*(C*z-E*O)+(c*v-h*y)*(C*R-T*O)},$t.multiply=Uu,$t.translate=function(i,e,o){var c,h,p,m,y,v,C,T,E,D,O,R,z=o[0],N=o[1],W=o[2];return e===i?(i[12]=e[0]*z+e[4]*N+e[8]*W+e[12],i[13]=e[1]*z+e[5]*N+e[9]*W+e[13],i[14]=e[2]*z+e[6]*N+e[10]*W+e[14],i[15]=e[3]*z+e[7]*N+e[11]*W+e[15]):(h=e[1],p=e[2],m=e[3],y=e[4],v=e[5],C=e[6],T=e[7],E=e[8],D=e[9],O=e[10],R=e[11],i[0]=c=e[0],i[1]=h,i[2]=p,i[3]=m,i[4]=y,i[5]=v,i[6]=C,i[7]=T,i[8]=E,i[9]=D,i[10]=O,i[11]=R,i[12]=c*z+y*N+E*W+e[12],i[13]=h*z+v*N+D*W+e[13],i[14]=p*z+C*N+O*W+e[14],i[15]=m*z+T*N+R*W+e[15]),i},$t.scale=function(i,e,o){var c=o[0],h=o[1],p=o[2];return i[0]=e[0]*c,i[1]=e[1]*c,i[2]=e[2]*c,i[3]=e[3]*c,i[4]=e[4]*h,i[5]=e[5]*h,i[6]=e[6]*h,i[7]=e[7]*h,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},$t.rotate=function(i,e,o,c){var h,p,m,y,v,C,T,E,D,O,R,z,N,W,ee,te,ie,pe,he,ve,Ce,Ae,je,Le,qe=c[0],ot=c[1],Ge=c[2],et=Math.hypot(qe,ot,Ge);return et<In.EPSILON?null:(qe*=et=1/et,ot*=et,Ge*=et,h=Math.sin(o),p=Math.cos(o),v=e[1],C=e[2],T=e[3],D=e[5],O=e[6],R=e[7],N=e[9],W=e[10],ee=e[11],te=qe*qe*(m=1-p)+p,he=qe*ot*m-Ge*h,ve=ot*ot*m+p,Ce=Ge*ot*m+qe*h,Ae=qe*Ge*m+ot*h,je=ot*Ge*m-qe*h,Le=Ge*Ge*m+p,i[0]=(y=e[0])*te+(E=e[4])*(ie=ot*qe*m+Ge*h)+(z=e[8])*(pe=Ge*qe*m-ot*h),i[1]=v*te+D*ie+N*pe,i[2]=C*te+O*ie+W*pe,i[3]=T*te+R*ie+ee*pe,i[4]=y*he+E*ve+z*Ce,i[5]=v*he+D*ve+N*Ce,i[6]=C*he+O*ve+W*Ce,i[7]=T*he+R*ve+ee*Ce,i[8]=y*Ae+E*je+z*Le,i[9]=v*Ae+D*je+N*Le,i[10]=C*Ae+O*je+W*Le,i[11]=T*Ae+R*je+ee*Le,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)},$t.rotateX=function(i,e,o){var c=Math.sin(o),h=Math.cos(o),p=e[4],m=e[5],y=e[6],v=e[7],C=e[8],T=e[9],E=e[10],D=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*h+C*c,i[5]=m*h+T*c,i[6]=y*h+E*c,i[7]=v*h+D*c,i[8]=C*h-p*c,i[9]=T*h-m*c,i[10]=E*h-y*c,i[11]=D*h-v*c,i},$t.rotateY=function(i,e,o){var c=Math.sin(o),h=Math.cos(o),p=e[0],m=e[1],y=e[2],v=e[3],C=e[8],T=e[9],E=e[10],D=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*h-C*c,i[1]=m*h-T*c,i[2]=y*h-E*c,i[3]=v*h-D*c,i[8]=p*c+C*h,i[9]=m*c+T*h,i[10]=y*c+E*h,i[11]=v*c+D*h,i},$t.rotateZ=function(i,e,o){var c=Math.sin(o),h=Math.cos(o),p=e[0],m=e[1],y=e[2],v=e[3],C=e[4],T=e[5],E=e[6],D=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*h+C*c,i[1]=m*h+T*c,i[2]=y*h+E*c,i[3]=v*h+D*c,i[4]=C*h-p*c,i[5]=T*h-m*c,i[6]=E*h-y*c,i[7]=D*h-v*c,i},$t.fromTranslation=function(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},$t.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},$t.fromRotation=function(i,e,o){var c,h,p,m=o[0],y=o[1],v=o[2],C=Math.hypot(m,y,v);return C<In.EPSILON?null:(m*=C=1/C,y*=C,v*=C,c=Math.sin(e),h=Math.cos(e),i[0]=m*m*(p=1-h)+h,i[1]=y*m*p+v*c,i[2]=v*m*p-y*c,i[3]=0,i[4]=m*y*p-v*c,i[5]=y*y*p+h,i[6]=v*y*p+m*c,i[7]=0,i[8]=m*v*p+y*c,i[9]=y*v*p-m*c,i[10]=v*v*p+h,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)},$t.fromXRotation=function(i,e){var o=Math.sin(e),c=Math.cos(e);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=c,i[6]=o,i[7]=0,i[8]=0,i[9]=-o,i[10]=c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},$t.fromYRotation=function(i,e){var o=Math.sin(e),c=Math.cos(e);return i[0]=c,i[1]=0,i[2]=-o,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=o,i[9]=0,i[10]=c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},$t.fromZRotation=function(i,e){var o=Math.sin(e),c=Math.cos(e);return i[0]=c,i[1]=o,i[2]=0,i[3]=0,i[4]=-o,i[5]=c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},$t.fromRotationTranslation=rh,$t.fromQuat2=function(i,e){var o=new In.ARRAY_TYPE(3),c=-e[0],h=-e[1],p=-e[2],m=e[3],y=e[4],v=e[5],C=e[6],T=e[7],E=c*c+h*h+p*p+m*m;return E>0?(o[0]=2*(y*m+T*c+v*p-C*h)/E,o[1]=2*(v*m+T*h+C*c-y*p)/E,o[2]=2*(C*m+T*p+y*h-v*c)/E):(o[0]=2*(y*m+T*c+v*p-C*h),o[1]=2*(v*m+T*h+C*c-y*p),o[2]=2*(C*m+T*p+y*h-v*c)),rh(i,e,o),i},$t.getTranslation=function(i,e){return i[0]=e[12],i[1]=e[13],i[2]=e[14],i},$t.getScaling=_c,$t.getRotation=function(i,e){var o=new In.ARRAY_TYPE(3);_c(o,e);var c=1/o[0],h=1/o[1],p=1/o[2],m=e[0]*c,y=e[1]*h,v=e[2]*p,C=e[4]*c,T=e[5]*h,E=e[6]*p,D=e[8]*c,O=e[9]*h,R=e[10]*p,z=m+T+R,N=0;return z>0?(N=2*Math.sqrt(z+1),i[3]=.25*N,i[0]=(E-O)/N,i[1]=(D-v)/N,i[2]=(y-C)/N):m>T&&m>R?(N=2*Math.sqrt(1+m-T-R),i[3]=(E-O)/N,i[0]=.25*N,i[1]=(y+C)/N,i[2]=(D+v)/N):T>R?(N=2*Math.sqrt(1+T-m-R),i[3]=(D-v)/N,i[0]=(y+C)/N,i[1]=.25*N,i[2]=(E+O)/N):(N=2*Math.sqrt(1+R-m-T),i[3]=(y-C)/N,i[0]=(D+v)/N,i[1]=(E+O)/N,i[2]=.25*N),i},$t.fromRotationTranslationScale=function(i,e,o,c){var h=e[0],p=e[1],m=e[2],y=e[3],v=h+h,C=p+p,T=m+m,E=h*v,D=h*C,O=h*T,R=p*C,z=p*T,N=m*T,W=y*v,ee=y*C,te=y*T,ie=c[0],pe=c[1],he=c[2];return i[0]=(1-(R+N))*ie,i[1]=(D+te)*ie,i[2]=(O-ee)*ie,i[3]=0,i[4]=(D-te)*pe,i[5]=(1-(E+N))*pe,i[6]=(z+W)*pe,i[7]=0,i[8]=(O+ee)*he,i[9]=(z-W)*he,i[10]=(1-(E+R))*he,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i},$t.fromRotationTranslationScaleOrigin=function(i,e,o,c,h){var p=e[0],m=e[1],y=e[2],v=e[3],C=p+p,T=m+m,E=y+y,D=p*C,O=p*T,R=p*E,z=m*T,N=m*E,W=y*E,ee=v*C,te=v*T,ie=v*E,pe=c[0],he=c[1],ve=c[2],Ce=h[0],Ae=h[1],je=h[2],Le=(1-(z+W))*pe,qe=(O+ie)*pe,ot=(R-te)*pe,Ge=(O-ie)*he,et=(1-(D+W))*he,Ue=(N+ee)*he,tt=(R+te)*ve,lt=(N-ee)*ve,nt=(1-(D+z))*ve;return i[0]=Le,i[1]=qe,i[2]=ot,i[3]=0,i[4]=Ge,i[5]=et,i[6]=Ue,i[7]=0,i[8]=tt,i[9]=lt,i[10]=nt,i[11]=0,i[12]=o[0]+Ce-(Le*Ce+Ge*Ae+tt*je),i[13]=o[1]+Ae-(qe*Ce+et*Ae+lt*je),i[14]=o[2]+je-(ot*Ce+Ue*Ae+nt*je),i[15]=1,i},$t.fromQuat=function(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=o+o,y=c+c,v=h+h,C=o*m,T=c*m,E=c*y,D=h*m,O=h*y,R=h*v,z=p*m,N=p*y,W=p*v;return i[0]=1-E-R,i[1]=T+W,i[2]=D-N,i[3]=0,i[4]=T-W,i[5]=1-C-R,i[6]=O+z,i[7]=0,i[8]=D+N,i[9]=O-z,i[10]=1-C-E,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},$t.frustum=function(i,e,o,c,h,p,m){var y=1/(o-e),v=1/(h-c),C=1/(p-m);return i[0]=2*p*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*p*v,i[6]=0,i[7]=0,i[8]=(o+e)*y,i[9]=(h+c)*v,i[10]=(m+p)*C,i[11]=-1,i[12]=0,i[13]=0,i[14]=m*p*2*C,i[15]=0,i},$t.perspectiveNO=_a,$t.perspectiveZO=function(i,e,o,c,h){var p,m=1/Math.tan(e/2);return i[0]=m/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=h*(p=1/(c-h)),i[14]=h*c*p):(i[10]=-1,i[14]=-c),i},$t.perspectiveFromFieldOfView=function(i,e,o,c){var h=Math.tan(e.upDegrees*Math.PI/180),p=Math.tan(e.downDegrees*Math.PI/180),m=Math.tan(e.leftDegrees*Math.PI/180),y=Math.tan(e.rightDegrees*Math.PI/180),v=2/(m+y),C=2/(h+p);return i[0]=v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=C,i[6]=0,i[7]=0,i[8]=-(m-y)*v*.5,i[9]=(h-p)*C*.5,i[10]=c/(o-c),i[11]=-1,i[12]=0,i[13]=0,i[14]=c*o/(o-c),i[15]=0,i},$t.orthoNO=ya,$t.orthoZO=function(i,e,o,c,h,p,m){var y=1/(e-o),v=1/(c-h),C=1/(p-m);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=C,i[11]=0,i[12]=(e+o)*y,i[13]=(h+c)*v,i[14]=p*C,i[15]=1,i},$t.lookAt=function(i,e,o,c){var h,p,m,y,v,C,T,E,D,O,R=e[0],z=e[1],N=e[2],W=c[0],ee=c[1],te=c[2],ie=o[0],pe=o[1],he=o[2];return Math.abs(R-ie)<In.EPSILON&&Math.abs(z-pe)<In.EPSILON&&Math.abs(N-he)<In.EPSILON?ju(i):(T=R-ie,E=z-pe,D=N-he,h=ee*(D*=O=1/Math.hypot(T,E,D))-te*(E*=O),p=te*(T*=O)-W*D,m=W*E-ee*T,(O=Math.hypot(h,p,m))?(h*=O=1/O,p*=O,m*=O):(h=0,p=0,m=0),y=E*m-D*p,v=D*h-T*m,C=T*p-E*h,(O=Math.hypot(y,v,C))?(y*=O=1/O,v*=O,C*=O):(y=0,v=0,C=0),i[0]=h,i[1]=y,i[2]=T,i[3]=0,i[4]=p,i[5]=v,i[6]=E,i[7]=0,i[8]=m,i[9]=C,i[10]=D,i[11]=0,i[12]=-(h*R+p*z+m*N),i[13]=-(y*R+v*z+C*N),i[14]=-(T*R+E*z+D*N),i[15]=1,i)},$t.targetTo=function(i,e,o,c){var h=e[0],p=e[1],m=e[2],y=c[0],v=c[1],C=c[2],T=h-o[0],E=p-o[1],D=m-o[2],O=T*T+E*E+D*D;O>0&&(T*=O=1/Math.sqrt(O),E*=O,D*=O);var R=v*D-C*E,z=C*T-y*D,N=y*E-v*T;return(O=R*R+z*z+N*N)>0&&(R*=O=1/Math.sqrt(O),z*=O,N*=O),i[0]=R,i[1]=z,i[2]=N,i[3]=0,i[4]=E*N-D*z,i[5]=D*R-T*N,i[6]=T*z-E*R,i[7]=0,i[8]=T,i[9]=E,i[10]=D,i[11]=0,i[12]=h,i[13]=p,i[14]=m,i[15]=1,i},$t.str=function(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"},$t.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])},$t.add=function(i,e,o){return i[0]=e[0]+o[0],i[1]=e[1]+o[1],i[2]=e[2]+o[2],i[3]=e[3]+o[3],i[4]=e[4]+o[4],i[5]=e[5]+o[5],i[6]=e[6]+o[6],i[7]=e[7]+o[7],i[8]=e[8]+o[8],i[9]=e[9]+o[9],i[10]=e[10]+o[10],i[11]=e[11]+o[11],i[12]=e[12]+o[12],i[13]=e[13]+o[13],i[14]=e[14]+o[14],i[15]=e[15]+o[15],i},$t.subtract=oh,$t.multiplyScalar=function(i,e,o){return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*o,i[5]=e[5]*o,i[6]=e[6]*o,i[7]=e[7]*o,i[8]=e[8]*o,i[9]=e[9]*o,i[10]=e[10]*o,i[11]=e[11]*o,i[12]=e[12]*o,i[13]=e[13]*o,i[14]=e[14]*o,i[15]=e[15]*o,i},$t.multiplyScalarAndAdd=function(i,e,o,c){return i[0]=e[0]+o[0]*c,i[1]=e[1]+o[1]*c,i[2]=e[2]+o[2]*c,i[3]=e[3]+o[3]*c,i[4]=e[4]+o[4]*c,i[5]=e[5]+o[5]*c,i[6]=e[6]+o[6]*c,i[7]=e[7]+o[7]*c,i[8]=e[8]+o[8]*c,i[9]=e[9]+o[9]*c,i[10]=e[10]+o[10]*c,i[11]=e[11]+o[11]*c,i[12]=e[12]+o[12]*c,i[13]=e[13]+o[13]*c,i[14]=e[14]+o[14]*c,i[15]=e[15]+o[15]*c,i},$t.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},$t.equals=function(i,e){var o=i[0],c=i[1],h=i[2],p=i[3],m=i[4],y=i[5],v=i[6],C=i[7],T=i[8],E=i[9],D=i[10],O=i[11],R=i[12],z=i[13],N=i[14],W=i[15],ee=e[0],te=e[1],ie=e[2],pe=e[3],he=e[4],ve=e[5],Ce=e[6],Ae=e[7],je=e[8],Le=e[9],qe=e[10],ot=e[11],Ge=e[12],et=e[13],Ue=e[14],tt=e[15];return Math.abs(o-ee)<=In.EPSILON*Math.max(1,Math.abs(o),Math.abs(ee))&&Math.abs(c-te)<=In.EPSILON*Math.max(1,Math.abs(c),Math.abs(te))&&Math.abs(h-ie)<=In.EPSILON*Math.max(1,Math.abs(h),Math.abs(ie))&&Math.abs(p-pe)<=In.EPSILON*Math.max(1,Math.abs(p),Math.abs(pe))&&Math.abs(m-he)<=In.EPSILON*Math.max(1,Math.abs(m),Math.abs(he))&&Math.abs(y-ve)<=In.EPSILON*Math.max(1,Math.abs(y),Math.abs(ve))&&Math.abs(v-Ce)<=In.EPSILON*Math.max(1,Math.abs(v),Math.abs(Ce))&&Math.abs(C-Ae)<=In.EPSILON*Math.max(1,Math.abs(C),Math.abs(Ae))&&Math.abs(T-je)<=In.EPSILON*Math.max(1,Math.abs(T),Math.abs(je))&&Math.abs(E-Le)<=In.EPSILON*Math.max(1,Math.abs(E),Math.abs(Le))&&Math.abs(D-qe)<=In.EPSILON*Math.max(1,Math.abs(D),Math.abs(qe))&&Math.abs(O-ot)<=In.EPSILON*Math.max(1,Math.abs(O),Math.abs(ot))&&Math.abs(R-Ge)<=In.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ge))&&Math.abs(z-et)<=In.EPSILON*Math.max(1,Math.abs(z),Math.abs(et))&&Math.abs(N-Ue)<=In.EPSILON*Math.max(1,Math.abs(N),Math.abs(Ue))&&Math.abs(W-tt)<=In.EPSILON*Math.max(1,Math.abs(W),Math.abs(tt))},$t.sub=$t.mul=$t.ortho=$t.perspective=void 0;var In=function(i,e){if(i&&i.__esModule)return i;if(i===null||gc(i)!=="object"&&typeof i!="function")return{default:i};var o=Vu(void 0);if(o&&o.has(i))return o.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,o&&o.set(i,c),c}(dt);function Vu(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(Vu=function(c){return c?o:e})(i)}function ju(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Uu(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=e[4],v=e[5],C=e[6],T=e[7],E=e[8],D=e[9],O=e[10],R=e[11],z=e[12],N=e[13],W=e[14],ee=e[15],te=o[0],ie=o[1],pe=o[2],he=o[3];return i[0]=te*c+ie*y+pe*E+he*z,i[1]=te*h+ie*v+pe*D+he*N,i[2]=te*p+ie*C+pe*O+he*W,i[3]=te*m+ie*T+pe*R+he*ee,i[4]=(te=o[4])*c+(ie=o[5])*y+(pe=o[6])*E+(he=o[7])*z,i[5]=te*h+ie*v+pe*D+he*N,i[6]=te*p+ie*C+pe*O+he*W,i[7]=te*m+ie*T+pe*R+he*ee,i[8]=(te=o[8])*c+(ie=o[9])*y+(pe=o[10])*E+(he=o[11])*z,i[9]=te*h+ie*v+pe*D+he*N,i[10]=te*p+ie*C+pe*O+he*W,i[11]=te*m+ie*T+pe*R+he*ee,i[12]=(te=o[12])*c+(ie=o[13])*y+(pe=o[14])*E+(he=o[15])*z,i[13]=te*h+ie*v+pe*D+he*N,i[14]=te*p+ie*C+pe*O+he*W,i[15]=te*m+ie*T+pe*R+he*ee,i}function rh(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=c+c,v=h+h,C=p+p,T=c*y,E=c*v,D=c*C,O=h*v,R=h*C,z=p*C,N=m*y,W=m*v,ee=m*C;return i[0]=1-(O+z),i[1]=E+ee,i[2]=D-W,i[3]=0,i[4]=E-ee,i[5]=1-(T+z),i[6]=R+N,i[7]=0,i[8]=D+W,i[9]=R-N,i[10]=1-(T+O),i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i}function _c(i,e){var o=e[4],c=e[5],h=e[6],p=e[8],m=e[9],y=e[10];return i[0]=Math.hypot(e[0],e[1],e[2]),i[1]=Math.hypot(o,c,h),i[2]=Math.hypot(p,m,y),i}function _a(i,e,o,c,h){var p,m=1/Math.tan(e/2);return i[0]=m/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+c)*(p=1/(c-h)),i[14]=2*h*c*p):(i[10]=-1,i[14]=-2*c),i}function ya(i,e,o,c,h,p,m){var y=1/(e-o),v=1/(c-h),C=1/(p-m);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*C,i[11]=0,i[12]=(e+o)*y,i[13]=(h+c)*v,i[14]=(m+p)*C,i[15]=1,i}function oh(i,e,o){return i[0]=e[0]-o[0],i[1]=e[1]-o[1],i[2]=e[2]-o[2],i[3]=e[3]-o[3],i[4]=e[4]-o[4],i[5]=e[5]-o[5],i[6]=e[6]-o[6],i[7]=e[7]-o[7],i[8]=e[8]-o[8],i[9]=e[9]-o[9],i[10]=e[10]-o[10],i[11]=e[11]-o[11],i[12]=e[12]-o[12],i[13]=e[13]-o[13],i[14]=e[14]-o[14],i[15]=e[15]-o[15],i}$t.perspective=_a,$t.ortho=ya,$t.mul=Uu,$t.sub=oh;var ei={},ri={};function yc(i){return yc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yc(i)}Object.defineProperty(ri,"__esModule",{value:!0}),ri.create=bc,ri.clone=function(i){var e=new Eo.ARRAY_TYPE(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},ri.length=vc,ri.fromValues=function(i,e,o){var c=new Eo.ARRAY_TYPE(3);return c[0]=i,c[1]=e,c[2]=o,c},ri.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i},ri.set=function(i,e,o,c){return i[0]=e,i[1]=o,i[2]=c,i},ri.add=function(i,e,o){return i[0]=e[0]+o[0],i[1]=e[1]+o[1],i[2]=e[2]+o[2],i},ri.subtract=ah,ri.multiply=Os,ri.divide=yl,ri.ceil=function(i,e){return i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i[2]=Math.ceil(e[2]),i},ri.floor=function(i,e){return i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i[2]=Math.floor(e[2]),i},ri.min=function(i,e,o){return i[0]=Math.min(e[0],o[0]),i[1]=Math.min(e[1],o[1]),i[2]=Math.min(e[2],o[2]),i},ri.max=function(i,e,o){return i[0]=Math.max(e[0],o[0]),i[1]=Math.max(e[1],o[1]),i[2]=Math.max(e[2],o[2]),i},ri.round=function(i,e){return i[0]=Math.round(e[0]),i[1]=Math.round(e[1]),i[2]=Math.round(e[2]),i},ri.scale=function(i,e,o){return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i},ri.scaleAndAdd=function(i,e,o,c){return i[0]=e[0]+o[0]*c,i[1]=e[1]+o[1]*c,i[2]=e[2]+o[2]*c,i},ri.distance=xc,ri.squaredDistance=sh,ri.squaredLength=wc,ri.negate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i},ri.inverse=function(i,e){return i[0]=1/e[0],i[1]=1/e[1],i[2]=1/e[2],i},ri.normalize=function(i,e){var o=e[0],c=e[1],h=e[2],p=o*o+c*c+h*h;return p>0&&(p=1/Math.sqrt(p)),i[0]=e[0]*p,i[1]=e[1]*p,i[2]=e[2]*p,i},ri.dot=Cc,ri.cross=function(i,e,o){var c=e[0],h=e[1],p=e[2],m=o[0],y=o[1],v=o[2];return i[0]=h*v-p*y,i[1]=p*m-c*v,i[2]=c*y-h*m,i},ri.lerp=function(i,e,o,c){var h=e[0],p=e[1],m=e[2];return i[0]=h+c*(o[0]-h),i[1]=p+c*(o[1]-p),i[2]=m+c*(o[2]-m),i},ri.hermite=function(i,e,o,c,h,p){var m=p*p,y=m*(2*p-3)+1,v=m*(p-2)+p,C=m*(p-1),T=m*(3-2*p);return i[0]=e[0]*y+o[0]*v+c[0]*C+h[0]*T,i[1]=e[1]*y+o[1]*v+c[1]*C+h[1]*T,i[2]=e[2]*y+o[2]*v+c[2]*C+h[2]*T,i},ri.bezier=function(i,e,o,c,h,p){var m=1-p,y=m*m,v=p*p,C=y*m,T=3*p*y,E=3*v*m,D=v*p;return i[0]=e[0]*C+o[0]*T+c[0]*E+h[0]*D,i[1]=e[1]*C+o[1]*T+c[1]*E+h[1]*D,i[2]=e[2]*C+o[2]*T+c[2]*E+h[2]*D,i},ri.random=function(i,e){e=e||1;var o=2*Eo.RANDOM()*Math.PI,c=2*Eo.RANDOM()-1,h=Math.sqrt(1-c*c)*e;return i[0]=Math.cos(o)*h,i[1]=Math.sin(o)*h,i[2]=c*e,i},ri.transformMat4=function(i,e,o){var c=e[0],h=e[1],p=e[2],m=o[3]*c+o[7]*h+o[11]*p+o[15];return i[0]=(o[0]*c+o[4]*h+o[8]*p+o[12])/(m=m||1),i[1]=(o[1]*c+o[5]*h+o[9]*p+o[13])/m,i[2]=(o[2]*c+o[6]*h+o[10]*p+o[14])/m,i},ri.transformMat3=function(i,e,o){var c=e[0],h=e[1],p=e[2];return i[0]=c*o[0]+h*o[3]+p*o[6],i[1]=c*o[1]+h*o[4]+p*o[7],i[2]=c*o[2]+h*o[5]+p*o[8],i},ri.transformQuat=function(i,e,o){var c=o[0],h=o[1],p=o[2],m=e[0],y=e[1],v=e[2],C=h*v-p*y,T=p*m-c*v,E=c*y-h*m,D=h*E-p*T,O=p*C-c*E,R=c*T-h*C,z=2*o[3];return T*=z,E*=z,O*=2,R*=2,i[0]=m+(C*=z)+(D*=2),i[1]=y+T+O,i[2]=v+E+R,i},ri.rotateX=function(i,e,o,c){var h=[],p=[];return h[0]=e[0]-o[0],h[1]=e[1]-o[1],h[2]=e[2]-o[2],p[0]=h[0],p[1]=h[1]*Math.cos(c)-h[2]*Math.sin(c),p[2]=h[1]*Math.sin(c)+h[2]*Math.cos(c),i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},ri.rotateY=function(i,e,o,c){var h=[],p=[];return h[0]=e[0]-o[0],h[1]=e[1]-o[1],h[2]=e[2]-o[2],p[0]=h[2]*Math.sin(c)+h[0]*Math.cos(c),p[1]=h[1],p[2]=h[2]*Math.cos(c)-h[0]*Math.sin(c),i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},ri.rotateZ=function(i,e,o,c){var h=[],p=[];return h[0]=e[0]-o[0],h[1]=e[1]-o[1],h[2]=e[2]-o[2],p[0]=h[0]*Math.cos(c)-h[1]*Math.sin(c),p[1]=h[0]*Math.sin(c)+h[1]*Math.cos(c),p[2]=h[2],i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},ri.angle=function(i,e){var o=i[0],c=i[1],h=i[2],p=e[0],m=e[1],y=e[2],v=Math.sqrt(o*o+c*c+h*h)*Math.sqrt(p*p+m*m+y*y),C=v&&Cc(i,e)/v;return Math.acos(Math.min(Math.max(C,-1),1))},ri.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i},ri.str=function(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"},ri.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},ri.equals=function(i,e){var o=i[0],c=i[1],h=i[2],p=e[0],m=e[1],y=e[2];return Math.abs(o-p)<=Eo.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-m)<=Eo.EPSILON*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(h-y)<=Eo.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))},ri.forEach=ri.sqrLen=ri.len=ri.sqrDist=ri.dist=ri.div=ri.mul=ri.sub=void 0;var Eo=function(i,e){if(i&&i.__esModule)return i;if(i===null||yc(i)!=="object"&&typeof i!="function")return{default:i};var o=_l(void 0);if(o&&o.has(i))return o.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,o&&o.set(i,c),c}(dt);function _l(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(_l=function(c){return c?o:e})(i)}function bc(){var i=new Eo.ARRAY_TYPE(3);return Eo.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function vc(i){return Math.hypot(i[0],i[1],i[2])}function ah(i,e,o){return i[0]=e[0]-o[0],i[1]=e[1]-o[1],i[2]=e[2]-o[2],i}function Os(i,e,o){return i[0]=e[0]*o[0],i[1]=e[1]*o[1],i[2]=e[2]*o[2],i}function yl(i,e,o){return i[0]=e[0]/o[0],i[1]=e[1]/o[1],i[2]=e[2]/o[2],i}function xc(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])}function sh(i,e){var o=e[0]-i[0],c=e[1]-i[1],h=e[2]-i[2];return o*o+c*c+h*h}function wc(i){var e=i[0],o=i[1],c=i[2];return e*e+o*o+c*c}function Cc(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}ri.sub=ah,ri.mul=Os,ri.div=yl,ri.dist=xc,ri.sqrDist=sh,ri.len=vc,ri.sqrLen=wc;var Xo,Hu=(Xo=bc(),function(i,e,o,c,h,p){var m,y;for(e||(e=3),o||(o=0),y=c?Math.min(c*e+o,i.length):i.length,m=o;m<y;m+=e)Xo[0]=i[m],Xo[1]=i[m+1],Xo[2]=i[m+2],h(Xo,Xo,p),i[m]=Xo[0],i[m+1]=Xo[1],i[m+2]=Xo[2];return i});ri.forEach=Hu;var oi={};function lh(i){return lh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lh(i)}Object.defineProperty(oi,"__esModule",{value:!0}),oi.create=bl,oi.clone=function(i){var e=new Wn.ARRAY_TYPE(4);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e},oi.fromValues=function(i,e,o,c){var h=new Wn.ARRAY_TYPE(4);return h[0]=i,h[1]=e,h[2]=o,h[3]=c,h},oi.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},oi.set=function(i,e,o,c,h){return i[0]=e,i[1]=o,i[2]=c,i[3]=h,i},oi.add=function(i,e,o){return i[0]=e[0]+o[0],i[1]=e[1]+o[1],i[2]=e[2]+o[2],i[3]=e[3]+o[3],i},oi.subtract=za,oi.multiply=Ba,oi.divide=ch,oi.ceil=function(i,e){return i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i[2]=Math.ceil(e[2]),i[3]=Math.ceil(e[3]),i},oi.floor=function(i,e){return i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i[2]=Math.floor(e[2]),i[3]=Math.floor(e[3]),i},oi.min=function(i,e,o){return i[0]=Math.min(e[0],o[0]),i[1]=Math.min(e[1],o[1]),i[2]=Math.min(e[2],o[2]),i[3]=Math.min(e[3],o[3]),i},oi.max=function(i,e,o){return i[0]=Math.max(e[0],o[0]),i[1]=Math.max(e[1],o[1]),i[2]=Math.max(e[2],o[2]),i[3]=Math.max(e[3],o[3]),i},oi.round=function(i,e){return i[0]=Math.round(e[0]),i[1]=Math.round(e[1]),i[2]=Math.round(e[2]),i[3]=Math.round(e[3]),i},oi.scale=function(i,e,o){return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i},oi.scaleAndAdd=function(i,e,o,c){return i[0]=e[0]+o[0]*c,i[1]=e[1]+o[1]*c,i[2]=e[2]+o[2]*c,i[3]=e[3]+o[3]*c,i},oi.distance=Rs,oi.squaredDistance=Fs,oi.length=Mc,oi.squaredLength=Tc,oi.negate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=-e[3],i},oi.inverse=function(i,e){return i[0]=1/e[0],i[1]=1/e[1],i[2]=1/e[2],i[3]=1/e[3],i},oi.normalize=function(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=o*o+c*c+h*h+p*p;return m>0&&(m=1/Math.sqrt(m)),i[0]=o*m,i[1]=c*m,i[2]=h*m,i[3]=p*m,i},oi.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},oi.cross=function(i,e,o,c){var h=o[0]*c[1]-o[1]*c[0],p=o[0]*c[2]-o[2]*c[0],m=o[0]*c[3]-o[3]*c[0],y=o[1]*c[2]-o[2]*c[1],v=o[1]*c[3]-o[3]*c[1],C=o[2]*c[3]-o[3]*c[2],T=e[0],E=e[1],D=e[2],O=e[3];return i[0]=E*C-D*v+O*y,i[1]=-T*C+D*m-O*p,i[2]=T*v-E*m+O*h,i[3]=-T*y+E*p-D*h,i},oi.lerp=function(i,e,o,c){var h=e[0],p=e[1],m=e[2],y=e[3];return i[0]=h+c*(o[0]-h),i[1]=p+c*(o[1]-p),i[2]=m+c*(o[2]-m),i[3]=y+c*(o[3]-y),i},oi.random=function(i,e){var o,c,h,p,m,y;e=e||1;do m=(o=2*Wn.RANDOM()-1)*o+(c=2*Wn.RANDOM()-1)*c;while(m>=1);do y=(h=2*Wn.RANDOM()-1)*h+(p=2*Wn.RANDOM()-1)*p;while(y>=1);var v=Math.sqrt((1-m)/y);return i[0]=e*o,i[1]=e*c,i[2]=e*h*v,i[3]=e*p*v,i},oi.transformMat4=function(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3];return i[0]=o[0]*c+o[4]*h+o[8]*p+o[12]*m,i[1]=o[1]*c+o[5]*h+o[9]*p+o[13]*m,i[2]=o[2]*c+o[6]*h+o[10]*p+o[14]*m,i[3]=o[3]*c+o[7]*h+o[11]*p+o[15]*m,i},oi.transformQuat=function(i,e,o){var c=e[0],h=e[1],p=e[2],m=o[0],y=o[1],v=o[2],C=o[3],T=C*c+y*p-v*h,E=C*h+v*c-m*p,D=C*p+m*h-y*c,O=-m*c-y*h-v*p;return i[0]=T*C+O*-m+E*-v-D*-y,i[1]=E*C+O*-y+D*-m-T*-v,i[2]=D*C+O*-v+T*-y-E*-m,i[3]=e[3],i},oi.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i},oi.str=function(i){return"vec4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},oi.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},oi.equals=function(i,e){var o=i[0],c=i[1],h=i[2],p=i[3],m=e[0],y=e[1],v=e[2],C=e[3];return Math.abs(o-m)<=Wn.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(c-y)<=Wn.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-v)<=Wn.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(p-C)<=Wn.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))},oi.forEach=oi.sqrLen=oi.len=oi.sqrDist=oi.dist=oi.div=oi.mul=oi.sub=void 0;var Wn=function(i,e){if(i&&i.__esModule)return i;if(i===null||lh(i)!=="object"&&typeof i!="function")return{default:i};var o=Sc(void 0);if(o&&o.has(i))return o.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,o&&o.set(i,c),c}(dt);function Sc(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(Sc=function(c){return c?o:e})(i)}function bl(){var i=new Wn.ARRAY_TYPE(4);return Wn.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function za(i,e,o){return i[0]=e[0]-o[0],i[1]=e[1]-o[1],i[2]=e[2]-o[2],i[3]=e[3]-o[3],i}function Ba(i,e,o){return i[0]=e[0]*o[0],i[1]=e[1]*o[1],i[2]=e[2]*o[2],i[3]=e[3]*o[3],i}function ch(i,e,o){return i[0]=e[0]/o[0],i[1]=e[1]/o[1],i[2]=e[2]/o[2],i[3]=e[3]/o[3],i}function Rs(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2],e[3]-i[3])}function Fs(i,e){var o=e[0]-i[0],c=e[1]-i[1],h=e[2]-i[2],p=e[3]-i[3];return o*o+c*c+h*h+p*p}function Mc(i){return Math.hypot(i[0],i[1],i[2],i[3])}function Tc(i){var e=i[0],o=i[1],c=i[2],h=i[3];return e*e+o*o+c*c+h*h}oi.sub=za,oi.mul=Ba,oi.div=ch,oi.dist=Rs,oi.sqrDist=Fs,oi.len=Mc,oi.sqrLen=Tc;var Wu=function(){var i=bl();return function(e,o,c,h,p,m){var y,v;for(o||(o=4),c||(c=0),v=h?Math.min(h*o+c,e.length):e.length,y=c;y<v;y+=o)i[0]=e[y],i[1]=e[y+1],i[2]=e[y+2],i[3]=e[y+3],p(i,i,m),e[y]=i[0],e[y+1]=i[1],e[y+2]=i[2],e[y+3]=i[3];return e}}();function Ic(i){return Ic=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ic(i)}oi.forEach=Wu,Object.defineProperty(ei,"__esModule",{value:!0}),ei.create=Ec,ei.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i},ei.setAxisAngle=dh,ei.getAxisAngle=function(i,e){var o=2*Math.acos(e[3]),c=Math.sin(o/2);return c>Ko.EPSILON?(i[0]=e[0]/c,i[1]=e[1]/c,i[2]=e[2]/c):(i[0]=1,i[1]=0,i[2]=0),o},ei.getAngle=function(i,e){var o=ye(i,e);return Math.acos(2*o*o-1)},ei.multiply=Dc,ei.rotateX=function(i,e,o){o*=.5;var c=e[0],h=e[1],p=e[2],m=e[3],y=Math.sin(o),v=Math.cos(o);return i[0]=c*v+m*y,i[1]=h*v+p*y,i[2]=p*v-h*y,i[3]=m*v-c*y,i},ei.rotateY=function(i,e,o){o*=.5;var c=e[0],h=e[1],p=e[2],m=e[3],y=Math.sin(o),v=Math.cos(o);return i[0]=c*v-p*y,i[1]=h*v+m*y,i[2]=p*v+c*y,i[3]=m*v-h*y,i},ei.rotateZ=function(i,e,o){o*=.5;var c=e[0],h=e[1],p=e[2],m=e[3],y=Math.sin(o),v=Math.cos(o);return i[0]=c*v+h*y,i[1]=h*v-c*y,i[2]=p*v+m*y,i[3]=m*v-p*y,i},ei.calculateW=function(i,e){var o=e[0],c=e[1],h=e[2];return i[0]=o,i[1]=c,i[2]=h,i[3]=Math.sqrt(Math.abs(1-o*o-c*c-h*h)),i},ei.exp=Se,ei.ln=$,ei.pow=function(i,e,o){return $(i,e),_e(i,i,o),Se(i,i),i},ei.slerp=Q,ei.random=function(i){var e=Ko.RANDOM(),o=Ko.RANDOM(),c=Ko.RANDOM(),h=Math.sqrt(1-e),p=Math.sqrt(e);return i[0]=h*Math.sin(2*Math.PI*o),i[1]=h*Math.cos(2*Math.PI*o),i[2]=p*Math.sin(2*Math.PI*c),i[3]=p*Math.cos(2*Math.PI*c),i},ei.invert=function(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=o*o+c*c+h*h+p*p,y=m?1/m:0;return i[0]=-o*y,i[1]=-c*y,i[2]=-h*y,i[3]=p*y,i},ei.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},ei.fromMat3=de,ei.fromEuler=function(i,e,o,c){var h=.5*Math.PI/180;e*=h,o*=h,c*=h;var p=Math.sin(e),m=Math.cos(e),y=Math.sin(o),v=Math.cos(o),C=Math.sin(c),T=Math.cos(c);return i[0]=p*v*T-m*y*C,i[1]=m*y*T+p*v*C,i[2]=m*v*C-p*y*T,i[3]=m*v*T+p*y*C,i},ei.str=function(i){return"quat("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},ei.setAxes=ei.sqlerp=ei.rotationTo=ei.equals=ei.exactEquals=ei.normalize=ei.sqrLen=ei.squaredLength=ei.len=ei.length=ei.lerp=ei.dot=ei.scale=ei.mul=ei.add=ei.set=ei.copy=ei.fromValues=ei.clone=void 0;var Ko=vl(dt),Ls=vl(Ri),Qo=vl(ri),Pr=vl(oi);function Gu(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(Gu=function(c){return c?o:e})(i)}function vl(i,e){if(i&&i.__esModule)return i;if(i===null||Ic(i)!=="object"&&typeof i!="function")return{default:i};var o=Gu(e);if(o&&o.has(i))return o.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,o&&o.set(i,c),c}function Ec(){var i=new Ko.ARRAY_TYPE(4);return Ko.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function dh(i,e,o){o*=.5;var c=Math.sin(o);return i[0]=c*e[0],i[1]=c*e[1],i[2]=c*e[2],i[3]=Math.cos(o),i}function Dc(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=o[0],v=o[1],C=o[2],T=o[3];return i[0]=c*T+m*y+h*C-p*v,i[1]=h*T+m*v+p*y-c*C,i[2]=p*T+m*C+c*v-h*y,i[3]=m*T-c*y-h*v-p*C,i}function Se(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=Math.sqrt(o*o+c*c+h*h),y=Math.exp(p),v=m>0?y*Math.sin(m)/m:0;return i[0]=o*v,i[1]=c*v,i[2]=h*v,i[3]=y*Math.cos(m),i}function $(i,e){var o=e[0],c=e[1],h=e[2],p=e[3],m=Math.sqrt(o*o+c*c+h*h),y=m>0?Math.atan2(m,p)/m:0;return i[0]=o*y,i[1]=c*y,i[2]=h*y,i[3]=.5*Math.log(o*o+c*c+h*h+p*p),i}function Q(i,e,o,c){var h,p,m,y,v,C=e[0],T=e[1],E=e[2],D=e[3],O=o[0],R=o[1],z=o[2],N=o[3];return(p=C*O+T*R+E*z+D*N)<0&&(p=-p,O=-O,R=-R,z=-z,N=-N),1-p>Ko.EPSILON?(h=Math.acos(p),m=Math.sin(h),y=Math.sin((1-c)*h)/m,v=Math.sin(c*h)/m):(y=1-c,v=c),i[0]=y*C+v*O,i[1]=y*T+v*R,i[2]=y*E+v*z,i[3]=y*D+v*N,i}function de(i,e){var o,c=e[0]+e[4]+e[8];if(c>0)o=Math.sqrt(c+1),i[3]=.5*o,i[0]=(e[5]-e[7])*(o=.5/o),i[1]=(e[6]-e[2])*o,i[2]=(e[1]-e[3])*o;else{var h=0;e[4]>e[0]&&(h=1),e[8]>e[3*h+h]&&(h=2);var p=(h+1)%3,m=(h+2)%3;o=Math.sqrt(e[3*h+h]-e[3*p+p]-e[3*m+m]+1),i[h]=.5*o,i[3]=(e[3*p+m]-e[3*m+p])*(o=.5/o),i[p]=(e[3*p+h]+e[3*h+p])*o,i[m]=(e[3*m+h]+e[3*h+m])*o}return i}ei.clone=Pr.clone,ei.fromValues=Pr.fromValues,ei.copy=Pr.copy,ei.set=Pr.set,ei.add=Pr.add,ei.mul=Dc;var _e=Pr.scale;ei.scale=_e;var ye=Pr.dot;ei.dot=ye,ei.lerp=Pr.lerp;var ke=Pr.length;ei.length=ke,ei.len=ke;var Be=Pr.squaredLength;ei.squaredLength=Be,ei.sqrLen=Be;var Ie=Pr.normalize;ei.normalize=Ie,ei.exactEquals=Pr.exactEquals,ei.equals=Pr.equals;var Ve,ut,st,Lt=(Ve=Qo.create(),ut=Qo.fromValues(1,0,0),st=Qo.fromValues(0,1,0),function(i,e,o){var c=Qo.dot(e,o);return c<-.999999?(Qo.cross(Ve,ut,e),Qo.len(Ve)<1e-6&&Qo.cross(Ve,st,e),Qo.normalize(Ve,Ve),dh(i,Ve,Math.PI),i):c>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Qo.cross(Ve,e,o),i[0]=Ve[0],i[1]=Ve[1],i[2]=Ve[2],i[3]=1+c,Ie(i,i))});ei.rotationTo=Lt;var Yt,_i,vi=(Yt=Ec(),_i=Ec(),function(i,e,o,c,h,p){return Q(Yt,e,h,p),Q(_i,o,c,p),Q(i,Yt,_i,2*p*(1-p)),i});ei.sqlerp=vi;var li,Fi=(li=Ls.create(),function(i,e,o,c){return li[0]=o[0],li[3]=o[1],li[6]=o[2],li[1]=c[0],li[4]=c[1],li[7]=c[2],li[2]=-e[0],li[5]=-e[1],li[8]=-e[2],Ie(i,de(i,li))});ei.setAxes=Fi;var Ot={};function En(i){return En=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},En(i)}Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.create=function(){var i=new on.ARRAY_TYPE(8);return on.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0),i[3]=1,i},Ot.clone=function(i){var e=new on.ARRAY_TYPE(8);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e},Ot.fromValues=function(i,e,o,c,h,p,m,y){var v=new on.ARRAY_TYPE(8);return v[0]=i,v[1]=e,v[2]=o,v[3]=c,v[4]=h,v[5]=p,v[6]=m,v[7]=y,v},Ot.fromRotationTranslationValues=function(i,e,o,c,h,p,m){var y=new on.ARRAY_TYPE(8);y[0]=i,y[1]=e,y[2]=o,y[3]=c;var v=.5*h,C=.5*p,T=.5*m;return y[4]=v*c+C*o-T*e,y[5]=C*c+T*i-v*o,y[6]=T*c+v*e-C*i,y[7]=-v*i-C*e-T*o,y},Ot.fromRotationTranslation=$r,Ot.fromTranslation=function(i,e){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=.5*e[0],i[5]=.5*e[1],i[6]=.5*e[2],i[7]=0,i},Ot.fromRotation=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},Ot.fromMat4=function(i,e){var o=Vi.create();Kn.getRotation(o,e);var c=new on.ARRAY_TYPE(3);return Kn.getTranslation(c,e),$r(i,o,c),i},Ot.copy=qr,Ot.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},Ot.set=function(i,e,o,c,h,p,m,y,v){return i[0]=e,i[1]=o,i[2]=c,i[3]=h,i[4]=p,i[5]=m,i[6]=y,i[7]=v,i},Ot.getDual=function(i,e){return i[0]=e[4],i[1]=e[5],i[2]=e[6],i[3]=e[7],i},Ot.setDual=function(i,e){return i[4]=e[0],i[5]=e[1],i[6]=e[2],i[7]=e[3],i},Ot.getTranslation=function(i,e){var o=e[4],c=e[5],h=e[6],p=e[7],m=-e[0],y=-e[1],v=-e[2],C=e[3];return i[0]=2*(o*C+p*m+c*v-h*y),i[1]=2*(c*C+p*y+h*m-o*v),i[2]=2*(h*C+p*v+o*y-c*m),i},Ot.translate=function(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=.5*o[0],v=.5*o[1],C=.5*o[2],T=e[4],E=e[5],D=e[6],O=e[7];return i[0]=c,i[1]=h,i[2]=p,i[3]=m,i[4]=m*y+h*C-p*v+T,i[5]=m*v+p*y-c*C+E,i[6]=m*C+c*v-h*y+D,i[7]=-c*y-h*v-p*C+O,i},Ot.rotateX=function(i,e,o){var c=-e[0],h=-e[1],p=-e[2],m=e[3],y=e[4],v=e[5],C=e[6],T=e[7],E=y*m+T*c+v*p-C*h,D=v*m+T*h+C*c-y*p,O=C*m+T*p+y*h-v*c,R=T*m-y*c-v*h-C*p;return Vi.rotateX(i,e,o),i[4]=E*(m=i[3])+R*(c=i[0])+D*(p=i[2])-O*(h=i[1]),i[5]=D*m+R*h+O*c-E*p,i[6]=O*m+R*p+E*h-D*c,i[7]=R*m-E*c-D*h-O*p,i},Ot.rotateY=function(i,e,o){var c=-e[0],h=-e[1],p=-e[2],m=e[3],y=e[4],v=e[5],C=e[6],T=e[7],E=y*m+T*c+v*p-C*h,D=v*m+T*h+C*c-y*p,O=C*m+T*p+y*h-v*c,R=T*m-y*c-v*h-C*p;return Vi.rotateY(i,e,o),i[4]=E*(m=i[3])+R*(c=i[0])+D*(p=i[2])-O*(h=i[1]),i[5]=D*m+R*h+O*c-E*p,i[6]=O*m+R*p+E*h-D*c,i[7]=R*m-E*c-D*h-O*p,i},Ot.rotateZ=function(i,e,o){var c=-e[0],h=-e[1],p=-e[2],m=e[3],y=e[4],v=e[5],C=e[6],T=e[7],E=y*m+T*c+v*p-C*h,D=v*m+T*h+C*c-y*p,O=C*m+T*p+y*h-v*c,R=T*m-y*c-v*h-C*p;return Vi.rotateZ(i,e,o),i[4]=E*(m=i[3])+R*(c=i[0])+D*(p=i[2])-O*(h=i[1]),i[5]=D*m+R*h+O*c-E*p,i[6]=O*m+R*p+E*h-D*c,i[7]=R*m-E*c-D*h-O*p,i},Ot.rotateByQuatAppend=function(i,e,o){var c=o[0],h=o[1],p=o[2],m=o[3],y=e[0],v=e[1],C=e[2],T=e[3];return i[0]=y*m+T*c+v*p-C*h,i[1]=v*m+T*h+C*c-y*p,i[2]=C*m+T*p+y*h-v*c,i[3]=T*m-y*c-v*h-C*p,i[4]=(y=e[4])*m+(T=e[7])*c+(v=e[5])*p-(C=e[6])*h,i[5]=v*m+T*h+C*c-y*p,i[6]=C*m+T*p+y*h-v*c,i[7]=T*m-y*c-v*h-C*p,i},Ot.rotateByQuatPrepend=function(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=o[0],v=o[1],C=o[2],T=o[3];return i[0]=c*T+m*y+h*C-p*v,i[1]=h*T+m*v+p*y-c*C,i[2]=p*T+m*C+c*v-h*y,i[3]=m*T-c*y-h*v-p*C,i[4]=c*(T=o[7])+m*(y=o[4])+h*(C=o[6])-p*(v=o[5]),i[5]=h*T+m*v+p*y-c*C,i[6]=p*T+m*C+c*v-h*y,i[7]=m*T-c*y-h*v-p*C,i},Ot.rotateAroundAxis=function(i,e,o,c){if(Math.abs(c)<on.EPSILON)return qr(i,e);var h=Math.hypot(o[0],o[1],o[2]);c*=.5;var p=Math.sin(c),m=p*o[0]/h,y=p*o[1]/h,v=p*o[2]/h,C=Math.cos(c),T=e[0],E=e[1],D=e[2],O=e[3];i[0]=T*C+O*m+E*v-D*y,i[1]=E*C+O*y+D*m-T*v,i[2]=D*C+O*v+T*y-E*m,i[3]=O*C-T*m-E*y-D*v;var R=e[4],z=e[5],N=e[6],W=e[7];return i[4]=R*C+W*m+z*v-N*y,i[5]=z*C+W*y+N*m-R*v,i[6]=N*C+W*v+R*y-z*m,i[7]=W*C-R*m-z*y-N*v,i},Ot.add=function(i,e,o){return i[0]=e[0]+o[0],i[1]=e[1]+o[1],i[2]=e[2]+o[2],i[3]=e[3]+o[3],i[4]=e[4]+o[4],i[5]=e[5]+o[5],i[6]=e[6]+o[6],i[7]=e[7]+o[7],i},Ot.multiply=xl,Ot.scale=function(i,e,o){return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*o,i[5]=e[5]*o,i[6]=e[6]*o,i[7]=e[7]*o,i},Ot.lerp=function(i,e,o,c){var h=1-c;return lf(e,o)<0&&(c=-c),i[0]=e[0]*h+o[0]*c,i[1]=e[1]*h+o[1]*c,i[2]=e[2]*h+o[2]*c,i[3]=e[3]*h+o[3]*c,i[4]=e[4]*h+o[4]*c,i[5]=e[5]*h+o[5]*c,i[6]=e[6]*h+o[6]*c,i[7]=e[7]*h+o[7]*c,i},Ot.invert=function(i,e){var o=hh(e);return i[0]=-e[0]/o,i[1]=-e[1]/o,i[2]=-e[2]/o,i[3]=e[3]/o,i[4]=-e[4]/o,i[5]=-e[5]/o,i[6]=-e[6]/o,i[7]=e[7]/o,i},Ot.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i[4]=-e[4],i[5]=-e[5],i[6]=-e[6],i[7]=e[7],i},Ot.normalize=function(i,e){var o=hh(e);if(o>0){o=Math.sqrt(o);var c=e[0]/o,h=e[1]/o,p=e[2]/o,m=e[3]/o,y=e[4],v=e[5],C=e[6],T=e[7],E=c*y+h*v+p*C+m*T;i[0]=c,i[1]=h,i[2]=p,i[3]=m,i[4]=(y-c*E)/o,i[5]=(v-h*E)/o,i[6]=(C-p*E)/o,i[7]=(T-m*E)/o}return i},Ot.str=function(i){return"quat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+")"},Ot.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]},Ot.equals=function(i,e){var o=i[0],c=i[1],h=i[2],p=i[3],m=i[4],y=i[5],v=i[6],C=i[7],T=e[0],E=e[1],D=e[2],O=e[3],R=e[4],z=e[5],N=e[6],W=e[7];return Math.abs(o-T)<=on.EPSILON*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(c-E)<=on.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(h-D)<=on.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(p-O)<=on.EPSILON*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(m-R)<=on.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(y-z)<=on.EPSILON*Math.max(1,Math.abs(y),Math.abs(z))&&Math.abs(v-N)<=on.EPSILON*Math.max(1,Math.abs(v),Math.abs(N))&&Math.abs(C-W)<=on.EPSILON*Math.max(1,Math.abs(C),Math.abs(W))},Ot.sqrLen=Ot.squaredLength=Ot.len=Ot.length=Ot.dot=Ot.mul=Ot.setReal=Ot.getReal=void 0;var on=cr(dt),Vi=cr(ei),Kn=cr($t);function Dn(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(Dn=function(c){return c?o:e})(i)}function cr(i,e){if(i&&i.__esModule)return i;if(i===null||En(i)!=="object"&&typeof i!="function")return{default:i};var o=Dn(e);if(o&&o.has(i))return o.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,o&&o.set(i,c),c}function $r(i,e,o){var c=.5*o[0],h=.5*o[1],p=.5*o[2],m=e[0],y=e[1],v=e[2],C=e[3];return i[0]=m,i[1]=y,i[2]=v,i[3]=C,i[4]=c*C+h*v-p*y,i[5]=h*C+p*m-c*v,i[6]=p*C+c*y-h*m,i[7]=-c*m-h*y-p*v,i}function qr(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i}function xl(i,e,o){var c=e[0],h=e[1],p=e[2],m=e[3],y=o[4],v=o[5],C=o[6],T=o[7],E=e[4],D=e[5],O=e[6],R=e[7],z=o[0],N=o[1],W=o[2],ee=o[3];return i[0]=c*ee+m*z+h*W-p*N,i[1]=h*ee+m*N+p*z-c*W,i[2]=p*ee+m*W+c*N-h*z,i[3]=m*ee-c*z-h*N-p*W,i[4]=c*T+m*y+h*C-p*v+E*ee+R*z+D*W-O*N,i[5]=h*T+m*v+p*y-c*C+D*ee+R*N+O*z-E*W,i[6]=p*T+m*C+c*v-h*y+O*ee+R*W+E*N-D*z,i[7]=m*T-c*y-h*v-p*C+R*ee-E*z-D*N-O*W,i}Ot.getReal=Vi.copy,Ot.setReal=Vi.copy,Ot.mul=xl;var lf=Vi.dot;Ot.dot=lf;var k0=Vi.length;Ot.length=k0,Ot.len=k0;var hh=Vi.squaredLength;Ot.squaredLength=hh,Ot.sqrLen=hh;var mi={};function cf(i){return cf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cf(i)}Object.defineProperty(mi,"__esModule",{value:!0}),mi.create=hf,mi.clone=function(i){var e=new zs.ARRAY_TYPE(2);return e[0]=i[0],e[1]=i[1],e},mi.fromValues=function(i,e){var o=new zs.ARRAY_TYPE(2);return o[0]=i,o[1]=e,o},mi.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i},mi.set=function(i,e,o){return i[0]=e,i[1]=o,i},mi.add=function(i,e,o){return i[0]=e[0]+o[0],i[1]=e[1]+o[1],i},mi.subtract=uf,mi.multiply=pf,mi.divide=mf,mi.ceil=function(i,e){return i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i},mi.floor=function(i,e){return i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i},mi.min=function(i,e,o){return i[0]=Math.min(e[0],o[0]),i[1]=Math.min(e[1],o[1]),i},mi.max=function(i,e,o){return i[0]=Math.max(e[0],o[0]),i[1]=Math.max(e[1],o[1]),i},mi.round=function(i,e){return i[0]=Math.round(e[0]),i[1]=Math.round(e[1]),i},mi.scale=function(i,e,o){return i[0]=e[0]*o,i[1]=e[1]*o,i},mi.scaleAndAdd=function(i,e,o,c){return i[0]=e[0]+o[0]*c,i[1]=e[1]+o[1]*c,i},mi.distance=ff,mi.squaredDistance=gf,mi.length=_f,mi.squaredLength=yf,mi.negate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i},mi.inverse=function(i,e){return i[0]=1/e[0],i[1]=1/e[1],i},mi.normalize=function(i,e){var o=e[0],c=e[1],h=o*o+c*c;return h>0&&(h=1/Math.sqrt(h)),i[0]=e[0]*h,i[1]=e[1]*h,i},mi.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]},mi.cross=function(i,e,o){var c=e[0]*o[1]-e[1]*o[0];return i[0]=i[1]=0,i[2]=c,i},mi.lerp=function(i,e,o,c){var h=e[0],p=e[1];return i[0]=h+c*(o[0]-h),i[1]=p+c*(o[1]-p),i},mi.random=function(i,e){e=e||1;var o=2*zs.RANDOM()*Math.PI;return i[0]=Math.cos(o)*e,i[1]=Math.sin(o)*e,i},mi.transformMat2=function(i,e,o){var c=e[0],h=e[1];return i[0]=o[0]*c+o[2]*h,i[1]=o[1]*c+o[3]*h,i},mi.transformMat2d=function(i,e,o){var c=e[0],h=e[1];return i[0]=o[0]*c+o[2]*h+o[4],i[1]=o[1]*c+o[3]*h+o[5],i},mi.transformMat3=function(i,e,o){var c=e[0],h=e[1];return i[0]=o[0]*c+o[3]*h+o[6],i[1]=o[1]*c+o[4]*h+o[7],i},mi.transformMat4=function(i,e,o){var c=e[0],h=e[1];return i[0]=o[0]*c+o[4]*h+o[12],i[1]=o[1]*c+o[5]*h+o[13],i},mi.rotate=function(i,e,o,c){var h=e[0]-o[0],p=e[1]-o[1],m=Math.sin(c),y=Math.cos(c);return i[0]=h*y-p*m+o[0],i[1]=h*m+p*y+o[1],i},mi.angle=function(i,e){var o=i[0],c=i[1],h=e[0],p=e[1],m=Math.sqrt(o*o+c*c)*Math.sqrt(h*h+p*p);return Math.acos(Math.min(Math.max(m&&(o*h+c*p)/m,-1),1))},mi.zero=function(i){return i[0]=0,i[1]=0,i},mi.str=function(i){return"vec2("+i[0]+", "+i[1]+")"},mi.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]},mi.equals=function(i,e){var o=i[0],c=i[1],h=e[0],p=e[1];return Math.abs(o-h)<=zs.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(c-p)<=zs.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))},mi.forEach=mi.sqrLen=mi.sqrDist=mi.dist=mi.div=mi.mul=mi.sub=mi.len=void 0;var zs=function(i,e){if(i&&i.__esModule)return i;if(i===null||cf(i)!=="object"&&typeof i!="function")return{default:i};var o=df(void 0);if(o&&o.has(i))return o.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,o&&o.set(i,c),c}(dt);function df(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(df=function(c){return c?o:e})(i)}function hf(){var i=new zs.ARRAY_TYPE(2);return zs.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0),i}function uf(i,e,o){return i[0]=e[0]-o[0],i[1]=e[1]-o[1],i}function pf(i,e,o){return i[0]=e[0]*o[0],i[1]=e[1]*o[1],i}function mf(i,e,o){return i[0]=e[0]/o[0],i[1]=e[1]/o[1],i}function ff(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1])}function gf(i,e){var o=e[0]-i[0],c=e[1]-i[1];return o*o+c*c}function _f(i){return Math.hypot(i[0],i[1])}function yf(i){var e=i[0],o=i[1];return e*e+o*o}mi.len=_f,mi.sub=uf,mi.mul=pf,mi.div=mf,mi.dist=ff,mi.sqrDist=gf,mi.sqrLen=yf;var A0=function(){var i=hf();return function(e,o,c,h,p,m){var y,v;for(o||(o=2),c||(c=0),v=h?Math.min(h*o+c,e.length):e.length,y=c;y<v;y+=o)i[0]=e[y],i[1]=e[y+1],p(i,i,m),e[y]=i[0],e[y+1]=i[1];return e}}();function kc(i){return kc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kc(i)}mi.forEach=A0,Object.defineProperty(We,"__esModule",{value:!0}),t.aA=We.vec4=t._=We.vec3=We.vec2=We.quat2=t.av=We.quat=t.ad=We.mat4=t.bC=We.mat3=We.mat2d=t.aC=We.mat2=We.glMatrix=void 0;var $u=Na(dt);We.glMatrix=$u;var qu=Na(xt);t.aC=We.mat2=qu;var P0=Na(Mi);We.mat2d=P0;var O0=Na(Ri);t.bC=We.mat3=O0;var R0=Na($t);t.ad=We.mat4=R0;var Ac=Na(ei);t.av=We.quat=Ac;var Di=Na(Ot);We.quat2=Di;var $x=Na(mi);We.vec2=$x;var qx=Na(ri);t._=We.vec3=qx;var Yx=Na(oi);function bf(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(bf=function(c){return c?o:e})(i)}function Na(i,e){if(i&&i.__esModule)return i;if(i===null||kc(i)!=="object"&&typeof i!="function")return{default:i};var o=bf(e);if(o&&o.has(i))return o.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,o&&o.set(i,c),c}t.aA=We.vec4=Yx;var vf=uh;function uh(i,e,o,c){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(c-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=o,this.p2y=c}uh.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,c=0;c<8;c++){var h=this.sampleCurveX(o)-i;if(Math.abs(h)<e)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=h/p}var m=0,y=1;for(o=i,c=0;c<20&&(h=this.sampleCurveX(o),!(Math.abs(h-i)<e));c++)i>h?m=o:y=o,o=.5*(y-m)+m;return o},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var ph=He(vf),Yu=wl;function wl(i,e){this.x=i,this.y=e}wl.prototype={clone:function(){return new wl(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,o=i.y-this.y;return e*e+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),o=Math.sin(i),c=o*this.x+e*this.y;return this.x=e*this.x-o*this.y,this.y=c,this},_rotateAround:function(i,e){var o=Math.cos(i),c=Math.sin(i),h=e.y+c*(this.x-e.x)+o*(this.y-e.y);return this.x=e.x+o*(this.x-e.x)-c*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},wl.convert=function(i){return i instanceof wl?i:Array.isArray(i)?new wl(i[0],i[1]):i};var vt=He(Yu);let F0=Math.PI/180,mh=180/Math.PI;function Li(i){return i*F0}function Yr(i){return i*mh}let L0=[[0,0],[1,0],[1,1],[0,1]];function xf(i){if(i<=0)return 0;if(i>=1)return 1;let e=i*i,o=e*i;return 4*(i<.5?o:3*(i-e)+o-.75)}function fh(i,e,o,c){let h=new ph(i,e,o,c);return function(p){return h.solve(p)}}let Pc=fh(.25,.1,.25,1);function yi(i,e,o){return Math.min(o,Math.max(e,i))}function Cl(i,e,o){return(o=yi((o-i)/(e-i),0,1))*o*(3-2*o)}function Sl(i,e,o){let c=o-e,h=((i-e)%c+c)%c+e;return h===e?o:h}function Oc(i,e,o){if(!i.length)return o(null,[]);let c=i.length,h=new Array(i.length),p=null;i.forEach((m,y)=>{e(m,(v,C)=>{v&&(p=v),h[y]=C,--c==0&&o(p,h)})})}function Jo(i){let e=[];for(let o in i)e.push(i[o]);return e}function Zr(i,...e){for(let o of e)for(let c in o)i[c]=o[c];return i}let Zx=1;function Zu(){return Zx++}function Xu(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function wf(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Cf(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Ku(i,e){i.forEach(o=>{e[o]&&(e[o]=e[o].bind(e))})}function gh(i,e){return i.indexOf(e,i.length-e.length)!==-1}function Rc(i,e,o){let c={};for(let h in i)c[h]=e.call(this,i[h],h,i);return c}function Ml(i,e,o){let c={};for(let h in i)e.call(this,i[h],h,i)&&(c[h]=i[h]);return c}function Va(i){return Array.isArray(i)?i.map(Va):typeof i=="object"&&i?Rc(i,Va):i}let Sf={};function Qn(i){Sf[i]||(typeof console<"u"&&console.warn(i),Sf[i]=!0)}function ja(i,e,o){return(o.y-i.y)*(e.x-i.x)>(e.y-i.y)*(o.x-i.x)}function eo(i){let e=0;for(let o,c,h=0,p=i.length,m=p-1;h<p;m=h++)o=i[h],c=i[m],e+=(c.x-o.x)*(o.y+c.y);return e}function ss([i,e,o]){let c=Li(e+90),h=Li(o);return{x:i*Math.cos(c)*Math.sin(h),y:i*Math.sin(c)*Math.sin(h),z:i*Math.cos(h),azimuthal:e,polar:o}}function Or(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Mf(i){let e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,c,h,p)=>{let m=h||p;return e[c]=!m||m.toLowerCase(),""}),e["max-age"]){let o=parseInt(e["max-age"],10);isNaN(o)?delete e["max-age"]:e["max-age"]=o}return e}let Tf,Qu,Fc,_h,ls,yh,Ju=null;function Tl(i){try{let e=self[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function bh(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}function If(i,e,o,c){for(;e<o;){let h=e+o>>1;i[h]<c?e=h+1:o=h}return e}function z0(i,e,o,c){for(;e<o;){let h=e+o>>1;i[h]<=c?e=h+1:o=h}return e}function ep(i){return i>0?1/(1.001-i):1+i}function tp(i){return i>0?1-1/(1.001-i):-i}function Lc(){return Tf==null&&(Tf=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Tf}let Rr={now:()=>_h!==void 0?_h:performance.now(),setNow(i){_h=i},restoreNow(){_h=void 0},frame(i){let e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){let{width:o,height:c}=i;ls||(ls=document.createElement("canvas"));let h=ls.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(o>ls.width||c>ls.height)&&(ls.width=o,ls.height=c),h.clearRect(-e,-e,o+2*e,c+2*e),h.drawImage(i,0,0,o,c),h.getImageData(-e,-e,o+2*e,c+2*e)},resolveURL:i=>(Qu||(Qu=document.createElement("a")),Qu.href=i,Qu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Fc==null&&(Fc=window.matchMedia("(prefers-reduced-motion: reduce)")),Fc.matches)},hasCanvasFingerprintNoise(){if(yh!==void 0)return yh;if(!Lc())return yh=!1,!1;let i=new OffscreenCanvas(85,1),e=i.getContext("2d",{willReadFrequently:!0}),o=0;for(let h=0;h<i.width;++h)e.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,e.fillRect(h,0,1,1);let c=e.getImageData(0,0,i.width,i.height);o=0;for(let h=0;h<c.data.length;++h)if(h%4!=3&&o++!==c.data[h])return yh=!0,!0;return yh=!1,!1}};function ip(i,e){let o=i.indexOf("?");if(o<0)return`${i}?${new URLSearchParams(e).toString()}`;let c=new URLSearchParams(i.slice(o));for(let h in e)c.set(h,e[h]);return`${i.slice(0,o)}?${c.toString()}`}function Ef(i,e={persistentParams:[]}){let o=i.indexOf("?");if(o<0)return i;let c=new URLSearchParams,h=new URLSearchParams(i.slice(o));for(let m of e.persistentParams){let y=h.get(m);y&&c.set(m,y)}let p=c.toString();return`${i.slice(0,o)}${p.length>0?`?${p}`:""}`}let B0="mapbox-tiles",Df=500,kf=50,cs,np;function N0(){try{return caches}catch{}}function vh(){let i=N0();i&&!cs&&(cs=i.open(B0))}let rp=1/0,op={supported:!1,testSupport:function(i){!Af&&Bc&&(Pf?V0(i):zc=i)}},zc,Bc,Af=!1,Pf=!1,Of=typeof self<"u"?self:{};function V0(i){let e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Bc),i.isContextLost())return;op.supported=!0}catch{}i.deleteTexture(e),Af=!0}Of.document&&(Bc=Of.document.createElement("img"),Bc.onload=function(){zc&&V0(zc),zc=null,Pf=!0},Bc.onerror=function(){Af=!0,zc=null},Bc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let ap={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ap);class Rf extends Error{constructor(e,o,c){o===401&&k(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=o,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let sp=Or()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,xh=function(i,e){if(!(/^file:/.test(o=i.url)||/^file:/.test(sp())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,h){let p=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:sp(),referrerPolicy:c.referrerPolicy,signal:p.signal}),y=!1,v=!1,C=(T=m.url).indexOf("sku=")>0&&k(T);var T;c.type==="json"&&m.headers.set("Accept","application/json");let E=(O,R,z)=>{if(v)return;if(O&&O.message!=="SecurityError"&&Qn(O.toString()),R&&z)return D(R);let N=Date.now();fetch(m).then(W=>{if(W.ok){let ee=C?W.clone():null;return D(W,ee,N)}return h(new Rf(W.statusText,W.status,c.url))}).catch(W=>{W.name!=="AbortError"&&h(new Error(`${W.message} ${c.url}`))})},D=(O,R,z)=>{(c.type==="arrayBuffer"?O.arrayBuffer():c.type==="json"?O.json():O.text()).then(N=>{v||(R&&z&&function(W,ee,te){if(vh(),!cs)return;let ie=Mf(ee.headers.get("Cache-Control")||"");if(ie["no-store"])return;let pe={status:ee.status,statusText:ee.statusText,headers:new Headers};ee.headers.forEach((Ce,Ae)=>pe.headers.set(Ae,Ce)),ie["max-age"]&&pe.headers.set("Expires",new Date(te+1e3*ie["max-age"]).toUTCString());let he=pe.headers.get("Expires");if(!he||new Date(he).getTime()-te<42e4)return;let ve=Ef(W.url,{persistentParams:["language","worldview"]});if(ee.status===206){let Ce=W.headers.get("Range");if(!Ce)return;pe.status=200,ve=ip(ve,{range:Ce})}(function(Ce,Ae){if(np===void 0)try{new Response(new ReadableStream),np=!0}catch{np=!1}np?Ae(Ce.body):Ce.blob().then(Ae)})(ee,Ce=>{let Ae=new Response((je=ee.status)!==200&&je!==404&&[101,103,204,205,304].includes(je)?null:Ce,pe);var je;vh(),cs&&cs.then(Le=>Le.put(ve,Ae)).catch(Le=>Qn(Le.message))})}(m,R,z),y=!0,h(null,N,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(N=>{v||h(new Error(N.message))})};return C?function(O,R){if(vh(),!cs)return R(null);cs.then(z=>{let N=Ef(O.url,{persistentParams:["language","worldview"]}),W=O.headers.get("Range");W&&(N=ip(N,{range:W})),z.match(N).then(ee=>{let te=function(ie){if(!ie)return!1;let pe=new Date(ie.headers.get("Expires")||0),he=Mf(ie.headers.get("Cache-Control")||"");return pe>Date.now()&&!he["no-cache"]}(ee);z.delete(N),te&&z.put(N,ee.clone()),R(null,ee,te)}).catch(R)}).catch(R)}(m,E):E(null,null),{cancel:()=>{v=!0,y||p.abort()}}}(i,e);if(Or()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var o;return function(c,h){let p=new XMLHttpRequest;p.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(let m in c.headers)p.setRequestHeader(m,c.headers[m]);return c.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=c.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(c.type==="json")try{m=JSON.parse(p.response)}catch(y){return h(y)}h(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new Rf(p.statusText,p.status,c.url))},p.send(c.body),{cancel:()=>p.abort()}}(i,e)},Il=function(i,e){return xh(Zr(i,{type:"arrayBuffer"}),e)};function j0(i){let e=document.createElement("a");return e.href=i,e.protocol===location.protocol&&e.host===location.host}let Ff="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",wh,Ch;wh=[],Ch=0;let Bs=function(i,e){if(op.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Ch>=M.MAX_PARALLEL_IMAGE_REQUESTS){let p={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return wh.push(p),p}Ch++;let o=!1,c=()=>{if(!o)for(o=!0,Ch--;wh.length&&Ch<M.MAX_PARALLEL_IMAGE_REQUESTS;){let p=wh.shift(),{requestParameters:m,callback:y,cancelled:v}=p;v||(p.cancel=Bs(m,y).cancel)}},h=Il(i,(p,m,y,v)=>{c(),p?e(p):m&&(self.createImageBitmap?function(C,T){let E=new Blob([new Uint8Array(C)],{type:"image/png"});createImageBitmap(E).then(D=>{T(null,D)}).catch(D=>{T(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(C,T)=>e(C,T,y,v)):function(C,T){let E=new Image;E.onload=()=>{T(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=Ff})},E.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let D=new Blob([new Uint8Array(C)],{type:"image/png"});E.src=C.byteLength?URL.createObjectURL(D):Ff}(m,(C,T)=>e(C,T,y,v)))});return{cancel:()=>{h.cancel(),c()}}},Lf="01",zf="NO_ACCESS_TOKEN",Xx=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ba(i){let e=i.match(Xx);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Nc(i){let e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}let lp="mapbox.eventData";function U0(i){if(!i)return null;let e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Sh{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let o=U0(M.ACCESS_TOKEN),c="";return c=o&&o.u?btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(+("0x"+p)))):M.ACCESS_TOKEN||"",e?`${lp}.${e}:${c}`:`${lp}:${c}`}fetchEventData(){let e=Tl("localStorage"),o=this.getStorageKey(),c=this.getStorageKey("uuid");if(e)try{let h=localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));let p=localStorage.getItem(c);p&&(this.anonId=p)}catch{Qn("Unable to read from LocalStorage")}}saveEventData(){let e=Tl("localStorage"),o=this.getStorageKey(),c=this.getStorageKey("uuid"),h=this.anonId;if(e&&h)try{localStorage.setItem(c,h),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{Qn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,o,c,h){if(!M.EVENTS_URL)return;let p=ba(M.EVENTS_URL);p.params.push(`access_token=${h||M.ACCESS_TOKEN||""}`);let m={event:this.type,created:new Date(e).toISOString()},y=o?Zr(m,o):m,v={url:Nc(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(C,T){return xh(Zr(C,{method:"POST"}),T)}(v,C=>{this.pendingRequest=null,c(C),this.saveEventData(),this.processRequests(h)})}queueRequest(e,o){this.queue.push(e),this.processRequests(o)}}let H0=new class extends Sh{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){M.EVENTS_URL&&M.ACCESS_TOKEN&&Array.isArray(i)&&i.some(o=>L(o)||k(o))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=U0(M.ACCESS_TOKEN),o=e?e.u:M.ACCESS_TOKEN,c=o!==this.eventData.tokenU;Cf(this.anonId)||(this.anonId=Xu(),c=!0);let h=this.queue.shift();if(this.eventData.lastSuccess){let p=new Date(this.eventData.lastSuccess),m=new Date(h),y=(h-this.eventData.lastSuccess)/864e5;c=c||y>=1||y<-1||p.getDate()!==m.getDate()}else c=!0;c?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:g,skuId:Lf,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=o)},i):this.processRequests()}},Bf=H0.postTurnstileEvent.bind(H0),Mh=new class extends Sh{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,o,c){this.skuToken=e,this.errorCb=c,M.EVENTS_URL&&(o||M.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(zf)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:o}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Cf(this.anonId)||(this.anonId=Xu()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:g,skuId:Lf,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):e&&(this.success[e]=!0)},i))}remove(){this.errorCb=null}},W0=Mh.postMapLoadEvent.bind(Mh),G0=new class extends Sh{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(i){let e=this.mapInstanceIdMap.get(i);return e||(e=Xu(),this.mapInstanceIdMap.set(i,e)),e}getEventId(i){let e=this.eventIdPerMapInstanceMap.get(i)||0;return this.eventIdPerMapInstanceMap.set(i,e+1),e}postStyleLoadEvent(i,e){let{map:o,style:c,importedStyles:h}=e;if(!M.EVENTS_URL||!i&&!M.ACCESS_TOKEN)return;let p=this.getMapInstanceId(o),m={mapInstanceId:p,eventId:this.getEventId(p),style:c};h.length&&(m.importedStyles=h),this.queueRequest({timestamp:Date.now(),payload:m},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:o}=this.queue.shift();this.postEvent(e,o,()=>{},i)}},Kx=G0.postStyleLoadEvent.bind(G0),cp=new class extends Sh{constructor(){super("gljs.performance")}postPerformanceEvent(i,e){M.EVENTS_URL&&(i||M.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:o}=this.queue.shift(),c=function(h){let p=performance.getEntriesByType("resource"),m=performance.getEntriesByType("mark"),y=function(O){let R={};if(O){for(let z in O)if(z!=="other")for(let N of O[z]){let W=`${z}ResolveRangeMin`,ee=`${z}ResolveRangeMax`,te=`${z}RequestCount`,ie=`${z}RequestCachedCount`;R[W]=Math.min(R[W]||1/0,N.startTime),R[ee]=Math.max(R[ee]||-1/0,N.responseEnd);let pe=he=>{R[he]===void 0&&(R[he]=0),++R[he]};N.transferSize!==void 0&&N.transferSize===0&&pe(ie),pe(te)}}return R}(function(O,R){let z={};if(O)for(let N of O){let W=R(N);z[W]===void 0&&(z[W]=[]),z[W].push(N)}return z}(p,Te)),v=window.devicePixelRatio,C=navigator.connection||navigator.mozConnection||navigator.webkitConnection,T=C?C.effectiveType:void 0,E={counters:[],metadata:[],attributes:[]},D=(O,R,z)=>{z!=null&&O.push({name:R,value:z.toString()})};for(let O in y)D(E.counters,O,y[O]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(D(E.counters,"interactionRangeMin",h.interactionRange[0]),D(E.counters,"interactionRangeMax",h.interactionRange[1])),m)for(let O of Object.keys(be)){let R=be[O],z=m.find(N=>N.name===R);z&&D(E.counters,R,z.startTime)}return D(E.counters,"visibilityHidden",h.visibilityHidden),D(E.attributes,"style",function(O){if(O)for(let R of O){let z=R.name.split("?")[0];if(oe(z)){let N=z.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(p)),D(E.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),D(E.attributes,"fogEnabled",h.fogEnabled?"true":"false"),D(E.attributes,"projection",h.projection),D(E.attributes,"zoom",h.zoom),D(E.metadata,"devicePixelRatio",v),D(E.metadata,"connectionEffectiveType",T),D(E.metadata,"navigatorUserAgent",navigator.userAgent),D(E.metadata,"screenWidth",window.screen.width),D(E.metadata,"screenHeight",window.screen.height),D(E.metadata,"windowWidth",window.innerWidth),D(E.metadata,"windowHeight",window.innerHeight),D(E.metadata,"mapWidth",h.width/v),D(E.metadata,"mapHeight",h.height/v),D(E.metadata,"webglRenderer",h.renderer),D(E.metadata,"webglVendor",h.vendor),D(E.metadata,"sdkVersion",g),D(E.metadata,"sdkIdentifier","mapbox-gl-js"),E}(o);for(let h of c.metadata);for(let h of c.counters);for(let h of c.attributes);this.postEvent(e,c,()=>{},i)}},Qx=cp.postPerformanceEvent.bind(cp),Vc=new class extends Sh{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,o,c){if(!M.API_URL||!M.SESSION_PATH)return;let h=ba(M.API_URL+M.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${c||M.ACCESS_TOKEN||""}`);let p={url:Nc(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,y){return xh(Zr(m,{method:"GET"}),y)}(p,m=>{this.pendingRequest=null,o(m),this.saveEventData(),this.processRequests(c)})}getSessionAPI(i,e,o,c){this.skuToken=e,this.errorCb=c,M.SESSION_PATH&&M.API_URL&&(o||M.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(zf)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:o}=this.queue.shift();e&&this.success[e]||this.getSession(o,this.skuToken,c=>{c?this.errorCb(c):e&&(this.success[e]=!0)},i)}remove(){this.errorCb=null}},dp=Vc.getSessionAPI.bind(Vc),Th=new Set;var El={exports:{}},$0={exports:function(i,e){var o,c,h,p,m,y,v,C;for(c=i.length-(o=3&i.length),h=e,m=3432918353,y=461845907,C=0;C<c;)v=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,h=27492+(65535&(p=5*(65535&(h=(h^=v=(65535&(v=(v=(65535&v)*m+(((v>>>16)*m&65535)<<16)&4294967295)<<15|v>>>17))*y+(((v>>>16)*y&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(v=0,o){case 3:v^=(255&i.charCodeAt(C+2))<<16;case 2:v^=(255&i.charCodeAt(C+1))<<8;case 1:h^=v=(65535&(v=(v=(65535&(v^=255&i.charCodeAt(C)))*m+(((v>>>16)*m&65535)<<16)&4294967295)<<15|v>>>17))*y+(((v>>>16)*y&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}},Jx={exports:function(i,e){for(var o,c=i.length,h=e^c,p=0;c>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(o>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++p;switch(c){case 3:h^=(255&i.charCodeAt(p+2))<<16;case 2:h^=(255&i.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}},q0=$0.exports,Nf=Jx.exports;El.exports=q0,El.exports.murmur3=q0,El.exports.murmur2=Nf;var jc=He(El.exports);function Vf(i,e,o){o[i]&&o[i].indexOf(e)!==-1||(o[i]=o[i]||[],o[i].push(e))}function Uc(i,e,o){if(o&&o[i]){let c=o[i].indexOf(e);c!==-1&&o[i].splice(c,1)}}class fo{constructor(e,o={}){Zr(this,o),this.type=e}}class hp extends fo{constructor(e,o={}){super("error",Zr({error:e},o))}}class Dl{on(e,o){return this._listeners=this._listeners||{},Vf(e,o,this._listeners),this}off(e,o){return Uc(e,o,this._listeners),Uc(e,o,this._oneTimeListeners),this}once(e,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Vf(e,o,this._oneTimeListeners),this):new Promise(c=>this.once(e,c))}fire(e,o){typeof e=="string"&&(e=new fo(e,o||{}));let c=e.type;if(this.listens(c)){e.target=this;let h=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(let y of h)y.call(this,e);let p=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(let y of p)Uc(c,y,this._oneTimeListeners),y.call(this,e);let m=this._eventedParent;m&&(Zr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof hp&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,o){return this._eventedParent=e,this._eventedParentData=o,this}}t.F=void 0;var Y0={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function up(i){return(i=Math.round(i))<0?0:i>255?255:i}function jf(i){return up(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function Ih(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function Eh(i,e,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?i+(e-i)*o*6:2*o<1?e:3*o<2?i+(e-i)*(2/3-o)*6:i}try{t.F={}.parseCSSColor=function(i){var e,o=i.replace(/ /g,"").toLowerCase();if(o in Y0)return Y0[o].slice();if(o[0]==="#")return o.length===4?(e=parseInt(o.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:o.length===7&&(e=parseInt(o.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var c=o.indexOf("("),h=o.indexOf(")");if(c!==-1&&h+1===o.length){var p=o.substr(0,c),m=o.substr(c+1,h-(c+1)).split(","),y=1;switch(p){case"rgba":if(m.length!==4)return null;y=Ih(m.pop());case"rgb":return m.length!==3?null:[jf(m[0]),jf(m[1]),jf(m[2]),y];case"hsla":if(m.length!==4)return null;y=Ih(m.pop());case"hsl":if(m.length!==3)return null;var v=(parseFloat(m[0])%360+360)%360/360,C=Ih(m[1]),T=Ih(m[2]),E=T<=.5?T*(C+1):T+C-T*C,D=2*T-E;return[up(255*Eh(D,E,v+1/3)),up(255*Eh(D,E,v)),up(255*Eh(D,E,v-1/3)),y];default:return null}}return null}}catch{}class Wi{constructor(e,o,c,h=1){this.r=e,this.g=o,this.b=c,this.a=h}static parse(e){if(!e)return;if(e instanceof Wi)return e;if(typeof e!="string")return;let o=t.F(e);return o?new Wi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){let[e,o,c,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(o)},${Math.round(c)},${h})`}toRenderColor(e){let{r:o,g:c,b:h,a:p}=this;return new e1(e,o,c,h,p)}}class e1{constructor(e,o,c,h,p){if(e){let m=e.image.height,y=m*m;o=p===0?0:o/p*(m-1),c=p===0?0:c/p*(m-1),h=p===0?0:h/p*(m-1);let v=Math.floor(o),C=Math.floor(c),T=Math.floor(h),E=Math.ceil(o),D=Math.ceil(c),O=Math.ceil(h),R=o-v,z=c-C,N=h-T,W=e.image.data,ee=4*(v+C*y+T*m),te=4*(v+C*y+O*m),ie=4*(v+D*y+T*m),pe=4*(v+D*y+O*m),he=4*(E+C*y+T*m),ve=4*(E+C*y+O*m),Ce=4*(E+D*y+T*m),Ae=4*(E+D*y+O*m);if(ee<0||Ae>=W.length)throw new Error("out of range");this.r=Gt(Gt(Gt(W[ee],W[te],N),Gt(W[ie],W[pe],N),z),Gt(Gt(W[he],W[ve],N),Gt(W[Ce],W[Ae],N),z),R)/255*p,this.g=Gt(Gt(Gt(W[ee+1],W[te+1],N),Gt(W[ie+1],W[pe+1],N),z),Gt(Gt(W[he+1],W[ve+1],N),Gt(W[Ce+1],W[Ae+1],N),z),R)/255*p,this.b=Gt(Gt(Gt(W[ee+2],W[te+2],N),Gt(W[ie+2],W[pe+2],N),z),Gt(Gt(W[he+2],W[ve+2],N),Gt(W[Ce+2],W[Ae+2],N),z),R)/255*p,this.a=p}else this.r=o,this.g=c,this.b=h,this.a=p}toArray(){let{r:e,g:o,b:c,a:h}=this;return h===0?[0,0,0,0]:[255*e/h,255*o/h,255*c/h,h]}toArray01(){let{r:e,g:o,b:c,a:h}=this;return h===0?[0,0,0,0]:[e/h,o/h,c/h,h]}toArray01Scaled(e){let{r:o,g:c,b:h,a:p}=this;return p===0?[0,0,0]:[o/p*e,c/p*e,h/p*e]}toArray01PremultipliedAlpha(){let{r:e,g:o,b:c,a:h}=this;return[e,o,c,h]}toArray01Linear(){let{r:e,g:o,b:c,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(e/h,2.2),Math.pow(o/h,2.2),Math.pow(c/h,2.2),h]}}function Gt(i,e,o){return i*(1-o)+e*o}function Z0(i,e,o){return i.map((c,h)=>Gt(c,e[h],o))}Wi.black=new Wi(0,0,0,1),Wi.white=new Wi(1,1,1,1),Wi.transparent=new Wi(0,0,0,0),Wi.red=new Wi(1,0,0,1),Wi.blue=new Wi(0,0,1,1);var pp=Object.freeze({__proto__:null,array:Z0,color:function(i,e,o){return new Wi(Gt(i.r,e.r,o),Gt(i.g,e.g,o),Gt(i.b,e.b,o),Gt(i.a,e.a,o))},number:Gt});function Uf(i,...e){for(let o of e)for(let c in o)i[c]=o[c];return i}class Ua extends Error{constructor(e,o){super(o),this.message=o,this.key=e}}class Hf{constructor(e,o=[]){this.parent=e,this.bindings={};for(let[c,h]of o)this.bindings[c]=h}concat(e){return new Hf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Hc={kind:"null"},Dt={kind:"number"},Gi={kind:"string"},$i={kind:"boolean"},go={kind:"color"},Wc={kind:"object"},Ui={kind:"value"},va={kind:"collator"},Gc={kind:"formatted"},Ha={kind:"resolvedImage"};function Do(i,e){return{kind:"array",itemType:i,N:e}}function Jn(i){if(i.kind==="array"){let e=Jn(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}let t1=[Hc,Dt,Gi,$i,go,Gc,Wc,Do(Ui),Ha];function Dh(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Dh(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(let o of t1)if(!Dh(o,e))return null}}return`Expected ${Jn(i)} but found ${Jn(e)} instead.`}function Wf(i,e){return e.some(o=>o.kind===i.kind)}function $c(i,e){return e.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}class kh{constructor(e,o,c){this.sensitivity=e?o?"variant":"case":o?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,o){return this.collator.compare(e,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class kl{constructor(e,o,c,h,p){this.text=e.normalize?e.normalize():e,this.image=o,this.scale=c,this.fontStack=h,this.textColor=p}}class Xr{constructor(e){this.sections=e}static fromString(e){return new Xr([new kl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Xr?e:Xr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let o of this.sections){if(o.image){e.push(["image",o.image.namePrimary]);continue}e.push(o.text);let c={};o.fontStack&&(c["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(c["font-scale"]=o.scale),o.textColor&&(c["text-color"]=["rgba"].concat(o.textColor.toRenderColor(null).toArray())),e.push(c)}return e}}class _o{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,o){return e?new _o({namePrimary:e,nameSecondary:o,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function X0(i,e,o,c){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof o=="number"&&o>=0&&o<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[i,e,o,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[i,e,o,c]:[i,e,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function yo(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Wi||i instanceof kh||i instanceof Xr||i instanceof _o)return!0;if(Array.isArray(i)){for(let e of i)if(!yo(e))return!1;return!0}if(typeof i=="object"){for(let e in i)if(!yo(i[e]))return!1;return!0}return!1}function dr(i){if(i===null)return Hc;if(typeof i=="string")return Gi;if(typeof i=="boolean")return $i;if(typeof i=="number")return Dt;if(i instanceof Wi)return go;if(i instanceof kh)return va;if(i instanceof Xr)return Gc;if(i instanceof _o)return Ha;if(Array.isArray(i)){let e=i.length,o;for(let c of i){let h=dr(c);if(o){if(o===h)continue;o=Ui;break}o=h}return Do(o||Ui,e)}return Wc}function ea(i){let e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Wi||i instanceof Xr||i instanceof _o?i.toString():JSON.stringify(i)}class ds{constructor(e,o){this.type=e,this.value=o}static parse(e,o){if(e.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!yo(e[1]))return o.error("invalid value");let c=e[1],h=dr(c),p=o.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new ds(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Wi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Xr?this.value.serialize():this.value}}class vr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let Gf={string:Gi,number:Dt,boolean:$i,object:Wc};class xa{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");let c,h=1,p=e[0];if(p==="array"){let y,v;if(e.length>2){let C=e[1];if(typeof C!="string"||!(C in Gf)||C==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);y=Gf[C],h++}else y=Ui;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return o.error('The length argument to "array" must be a positive integer literal',2);v=e[2],h++}c=Do(y,v)}else c=Gf[p];let m=[];for(;h<e.length;h++){let y=o.parse(e[h],h,Ui);if(!y)return null;m.push(y)}return new xa(c,m)}evaluate(e){for(let o=0;o<this.args.length;o++){let c=this.args[o].evaluate(e);if(!Dh(this.type,dr(c)))return c;if(o===this.args.length-1)throw new vr(`Expected value to be of type ${Jn(this.type)}, but found ${Jn(dr(c))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,o=[e.kind];if(e.kind==="array"){let c=e.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){o.push(c.kind);let h=e.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(c=>c.serialize()))}}class Ah{constructor(e){this.type=Gc,this.sections=e}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");let c=e[1];if(!Array.isArray(c)&&typeof c=="object")return o.error("First argument must be an image or text section.");let h=[],p=!1;for(let m=1;m<=e.length-1;++m){let y=e[m];if(p&&typeof y=="object"&&!Array.isArray(y)){p=!1;let v=null;if(y["font-scale"]&&(v=o.parse(y["font-scale"],1,Dt),!v))return null;let C=null;if(y["text-font"]&&(C=o.parse(y["text-font"],1,Do(Gi)),!C))return null;let T=null;if(y["text-color"]&&(T=o.parse(y["text-color"],1,go),!T))return null;let E=h[h.length-1];E.scale=v,E.font=C,E.textColor=T}else{let v=o.parse(e[m],1,Ui);if(!v)return null;let C=v.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:v,scale:null,font:null,textColor:null})}}return new Ah(h)}evaluate(e){return new Xr(this.sections.map(o=>{let c=o.content.evaluate(e);return dr(c)===Ha?new kl("",c,null,null,null):new kl(ea(c),null,o.scale?o.scale.evaluate(e):null,o.font?o.font.evaluate(e).join(","):null,o.textColor?o.textColor.evaluate(e):null)}))}eachChild(e){for(let o of this.sections)e(o.content),o.scale&&e(o.scale),o.font&&e(o.font),o.textColor&&e(o.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let o of this.sections){e.push(o.content.serialize());let c={};o.scale&&(c["font-scale"]=o.scale.serialize()),o.font&&(c["text-font"]=o.font.serialize()),o.textColor&&(c["text-color"]=o.textColor.serialize()),e.push(c)}return e}}class Ph{constructor(e,o){this.type=Ha,this.inputPrimary=e,this.inputSecondary=o}static parse(e,o){if(e.length<2)return o.error("Expected two or more arguments.");let c=o.parse(e[1],1,Gi);if(!c)return o.error("No image name provided.");if(e.length===2)return new Ph(c);let h=o.parse(e[2],1,Gi);return h?new Ph(c,h):o.error("Secondary image variant is not a string.")}evaluate(e){let o=_o.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(o.namePrimary)>-1,o.nameSecondary&&o.available&&e.availableImages&&(o.available=e.availableImages.indexOf(o.nameSecondary)>-1)),o}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Al(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}let i1={"to-boolean":$i,"to-color":go,"to-number":Dt,"to-string":Gi};class wa{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");let c=e[0],h=[],p=Hc;if(c==="to-array"){if(!Array.isArray(e[1]))return null;let m=e[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);p=Do(o.expectedType.itemType,m)}else{if(!(m>0&&yo(e[1][0])))return null;p=Do(dr(e[1][0]),m)}for(let y=0;y<m;y++){let v=e[1][y],C;if(Al(v)==="array")C=o.parse(v,void 0,p.itemType);else{let T=Al(v);if(T!==p.itemType.kind)return o.error(`Expected ${p.itemType.kind} but found ${T}.`);C=o.registry.literal.parse(["literal",v===void 0?null:v],o)}if(!C)return null;h.push(C)}}else{if((c==="to-boolean"||c==="to-string")&&e.length!==2)return o.error("Expected one argument.");p=i1[c];for(let m=1;m<e.length;m++){let y=o.parse(e[m],m,Ui);if(!y)return null;h.push(y)}}return new wa(p,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let o,c;for(let h of this.args){if(o=h.evaluate(e),c=null,o instanceof Wi)return o;if(typeof o=="string"){let p=e.parseColor(o);if(p)return p}else if(Array.isArray(o)&&(c=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:X0(o[0],o[1],o[2],o[3]),!c))return new Wi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new vr(c||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(let c of this.args){if(o=c.evaluate(e),o===null)return 0;let h=Number(o);if(!isNaN(h))return h}throw new vr(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?Xr.fromString(ea(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?_o.fromString(ea(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(o=>o.evaluate(e)):ea(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ah([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ph(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{e.push(o.serialize())}),e}}let K0=["Unknown","Point","LineString","Polygon"];class Q0{constructor(e,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?K0[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:c,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*o-e[0])+this.featureDistanceData.bearing[1]*(h*o-e[1])}return 0}parseColor(e){let o=this._parseColorCache[e];return o||(o=this._parseColorCache[e]=Wi.parse(e)),o}getConfig(e){return this.options?this.options.get(e):null}}class to{constructor(e,o,c,h,p){this.name=e,this.type=o,this._evaluate=c,this.args=h,this._overloadIndex=p}evaluate(e){if(!this._evaluate){let o=to.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,o){let c=e[0],h=to.definitions[c];if(!h)return o.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);let p=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,y=[],v=null,C=-1;for(let[T,E]of m){if(Array.isArray(T)&&T.length!==e.length-1)continue;y.push(T),C++,v=new cy(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);let D=[],O=!1;for(let R=1;R<e.length;R++){let z=e[R],N=Array.isArray(T)?T[R-1]:T.type,W=v.parse(z,1+D.length,N);if(!W){O=!0;break}D.push(W)}if(!O)if(Array.isArray(T)&&T.length!==D.length)v.error(`Expected ${T.length} arguments, but found ${D.length} instead.`);else{for(let R=0;R<D.length;R++){let z=Array.isArray(T)?T[R]:T.type,N=D[R];v.concat(R+1).checkSubtype(z,N.type)}if(v.errors.length===0)return new to(c,p,E,D,C)}}if(y.length===1)o.errors.push(...v.errors);else{let T=(y.length?y:m.map(([D])=>D)).map($f).join(" | "),E=[];for(let D=1;D<e.length;D++){let O=o.parse(e[D],1+E.length);if(!O)return null;E.push(Jn(O.type))}o.error(`Expected arguments of type ${T}, but found (${E.join(", ")}) instead.`)}return null}static register(e,o){to.definitions=o;for(let c in o)e[c]=to}}function $f(i){return Array.isArray(i)?`(${i.map(Jn).join(", ")})`:`(${Jn(i.type)}...)`}class Ns{constructor(e,o,c){this.type=va,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=o}static parse(e,o){if(e.length!==2)return o.error("Expected one argument.");let c=e[1];if(typeof c!="object"||Array.isArray(c))return o.error("Collator options argument must be an object.");let h=o.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,$i);if(!h)return null;let p=o.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,$i);if(!p)return null;let m=null;return c.locale&&(m=o.parse(c.locale,1,Gi),!m)?null:new Ns(h,p,m)}evaluate(e){return new kh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var qf={exports:{}};qf.exports=function(){function i(c,h,p,m,y){for(;m>p;){if(m-p>600){var v=m-p+1,C=h-p+1,T=Math.log(v),E=.5*Math.exp(2*T/3),D=.5*Math.sqrt(T*E*(v-E)/v)*(C-v/2<0?-1:1);i(c,h,Math.max(p,Math.floor(h-C*E/v+D)),Math.min(m,Math.floor(h+(v-C)*E/v+D)),y)}var O=c[h],R=p,z=m;for(e(c,p,h),y(c[m],O)>0&&e(c,p,m);R<z;){for(e(c,R,z),R++,z--;y(c[R],O)<0;)R++;for(;y(c[z],O)>0;)z--}y(c[p],O)===0?e(c,p,z):e(c,++z,m),z<=h&&(p=z+1),h<=z&&(m=z-1)}}function e(c,h,p){var m=c[h];c[h]=c[p],c[p]=m}function o(c,h){return c<h?-1:c>h?1:0}return function(c,h,p,m,y){i(c,h,p||0,m||c.length-1,y||o)}}();var n1=He(qf.exports);function r1(i){let e=0;for(let o,c,h=0,p=i.length,m=p-1;h<p;m=h++)o=i[h],c=i[m],e+=(c.x-o.x)*(o.y+c.y);return e}function Oh(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function qc(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function o1(i,e,o){let c=i[0]-e[0],h=i[1]-e[1],p=i[0]-o[0],m=i[1]-o[1];return c*m-p*h==0&&c*p<=0&&h*m<=0}function Yc(i,e,o=!1){let c=!1;for(let y=0,v=e.length;y<v;y++){let C=e[y];for(let T=0,E=C.length,D=E-1;T<E;D=T++){let O=C[D],R=C[T];if(o1(i,O,R))return o;(p=O)[1]>(h=i)[1]!=(m=R)[1]>h[1]&&h[0]<(m[0]-p[0])*(h[1]-p[1])/(m[1]-p[1])+p[0]&&(c=!c)}}var h,p,m;return c}function Yf(i,e,o,c){let h=c[0]-o[0],p=c[1]-o[1],m=(i[0]-o[0])*p-h*(i[1]-o[1]),y=(e[0]-o[0])*p-h*(e[1]-o[1]);return m>0&&y<0||m<0&&y>0}function ji(i,e,o,c){return(h=[c[0]-o[0],c[1]-o[1]])[0]*(p=[e[0]-i[0],e[1]-i[1]])[1]-h[1]*p[0]!=0&&!(!Yf(i,e,o,c)||!Yf(o,c,i,e));var h,p}let hs=8192;function J0(i,e){let o=(180+i[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(o*h*hs),Math.round(c*h*hs)]}function a1(i,e){for(let o=0;o<e.length;o++)if(Yc(i,e[o]))return!0;return!1}function s1(i,e,o){for(let c of o)for(let h=0,p=c.length,m=p-1;h<p;m=h++)if(ji(i,e,c[m],c[h]))return!0;return!1}function Rh(i,e){for(let o=0;o<i.length;++o)if(!Yc(i[o],e))return!1;for(let o=0;o<i.length-1;++o)if(s1(i[o],i[o+1],e))return!1;return!0}function mp(i,e){for(let o=0;o<e.length;o++)if(Rh(i,e[o]))return!0;return!1}function Zc(i,e,o){let c=[];for(let h=0;h<i.length;h++){let p=[];for(let m=0;m<i[h].length;m++){let y=J0(i[h][m],o);Oh(e,y),p.push(y)}c.push(p)}return c}function ey(i,e,o){let c=[];for(let h=0;h<i.length;h++){let p=Zc(i[h],e,o);c.push(p)}return c}function Zf(i,e,o,c){if(i[0]<o[0]||i[0]>o[2]){let h=.5*c,p=i[0]-o[0]>h?-c:o[0]-i[0]>h?c:0;p===0&&(p=i[0]-o[2]>h?-c:o[2]-i[0]>h?c:0),i[0]+=p}Oh(e,i)}function Ca(i,e,o,c){let h=Math.pow(2,c.z)*hs,p=[c.x*hs,c.y*hs],m=[];if(!i)return m;for(let y of i)for(let v of y){let C=[v.x+p[0],v.y+p[1]];Zf(C,e,o,h),m.push(C)}return m}function ty(i,e,o,c){let h=Math.pow(2,c.z)*hs,p=[c.x*hs,c.y*hs],m=[];if(!i)return m;for(let v of i){let C=[];for(let T of v){let E=[T.x+p[0],T.y+p[1]];Oh(e,E),C.push(E)}m.push(C)}if(e[2]-e[0]<=h/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(let v of m)for(let C of v)Zf(C,e,o,h)}var y;return m}class Vs{constructor(e,o){this.type=$i,this.geojson=e,this.geometries=o}static parse(e,o){if(e.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(yo(e[1])){let c=e[1];if(c.type==="FeatureCollection")for(let h=0;h<c.features.length;++h){let p=c.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Vs(c,c.features[h].geometry)}else if(c.type==="Feature"){let h=c.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Vs(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Vs(c,c)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(o,c){let h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=o.canonicalID();if(!m)return!1;if(c.type==="Polygon"){let y=Zc(c.coordinates,p,m),v=Ca(o.geometry(),h,p,m);if(!qc(h,p))return!1;for(let C of v)if(!Yc(C,y))return!1}if(c.type==="MultiPolygon"){let y=ey(c.coordinates,p,m),v=Ca(o.geometry(),h,p,m);if(!qc(h,p))return!1;for(let C of v)if(!a1(C,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(o,c){let h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=o.canonicalID();if(!m)return!1;if(c.type==="Polygon"){let y=Zc(c.coordinates,p,m),v=ty(o.geometry(),h,p,m);if(!qc(h,p))return!1;for(let C of v)if(!Rh(C,y))return!1}if(c.type==="MultiPolygon"){let y=ey(c.coordinates,p,m),v=ty(o.geometry(),h,p,m);if(!qc(h,p))return!1;for(let C of v)if(!mp(C,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let js={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},fp=1/298.257223563,iy=fp*(2-fp),Fh=Math.PI/180;class Lh{static fromTile(e,o,c){let h=Math.PI*(1-2*(e+.5)/Math.pow(2,o)),p=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Fh;return new Lh(p,c)}static get units(){return js}constructor(e,o){if(e===void 0)throw new Error("No latitude given.");if(o&&!js[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(js).join(", ")}`);let c=6378.137*Fh*(o?js[o]:1),h=Math.cos(e*Fh),p=1/(1-iy*(1-h*h)),m=Math.sqrt(p);this.kx=c*m*h,this.ky=c*m*p*(1-iy)}distance(e,o){let c=ta(e[0]-o[0])*this.kx,h=(e[1]-o[1])*this.ky;return Math.sqrt(c*c+h*h)}bearing(e,o){let c=ta(o[0]-e[0])*this.kx;return Math.atan2(c,(o[1]-e[1])*this.ky)/Fh}destination(e,o,c){let h=c*Fh;return this.offset(e,Math.sin(h)*o,Math.cos(h)*o)}offset(e,o,c){return[e[0]+o/this.kx,e[1]+c/this.ky]}lineDistance(e){let o=0;for(let c=0;c<e.length-1;c++)o+=this.distance(e[c],e[c+1]);return o}area(e){let o=0;for(let c=0;c<e.length;c++){let h=e[c];for(let p=0,m=h.length,y=m-1;p<m;y=p++)o+=ta(h[p][0]-h[y][0])*(h[p][1]+h[y][1])*(c?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(e,o){let c=0;if(o<=0)return e[0];for(let h=0;h<e.length-1;h++){let p=e[h],m=e[h+1],y=this.distance(p,m);if(c+=y,c>o)return zh(p,m,(o-(c-y))/y)}return e[e.length-1]}pointToSegmentDistance(e,o,c){let[h,p]=o,m=ta(c[0]-h)*this.kx,y=(c[1]-p)*this.ky;if(m!==0||y!==0){let v=(ta(e[0]-h)*this.kx*m+(e[1]-p)*this.ky*y)/(m*m+y*y);v>1?(h=c[0],p=c[1]):v>0&&(h+=m/this.kx*v,p+=y/this.ky*v)}return m=ta(e[0]-h)*this.kx,y=(e[1]-p)*this.ky,Math.sqrt(m*m+y*y)}pointOnLine(e,o){let c=1/0,h=e[0][0],p=e[0][1],m=0,y=0;for(let v=0;v<e.length-1;v++){let C=e[v][0],T=e[v][1],E=ta(e[v+1][0]-C)*this.kx,D=(e[v+1][1]-T)*this.ky,O=0;E===0&&D===0||(O=(ta(o[0]-C)*this.kx*E+(o[1]-T)*this.ky*D)/(E*E+D*D),O>1?(C=e[v+1][0],T=e[v+1][1]):O>0&&(C+=E/this.kx*O,T+=D/this.ky*O)),E=ta(o[0]-C)*this.kx,D=(o[1]-T)*this.ky;let R=E*E+D*D;R<c&&(c=R,h=C,p=T,m=v,y=O)}return{point:[h,p],index:m,t:Math.max(0,Math.min(1,y))}}lineSlice(e,o,c){let h=this.pointOnLine(c,e),p=this.pointOnLine(c,o);if(h.index>p.index||h.index===p.index&&h.t>p.t){let C=h;h=p,p=C}let m=[h.point],y=h.index+1,v=p.index;!Xf(c[y],m[0])&&y<=v&&m.push(c[y]);for(let C=y+1;C<=v;C++)m.push(c[C]);return Xf(c[v],p.point)||m.push(p.point),m}lineSliceAlong(e,o,c){let h=0,p=[];for(let m=0;m<c.length-1;m++){let y=c[m],v=c[m+1],C=this.distance(y,v);if(h+=C,h>e&&p.length===0&&p.push(zh(y,v,(e-(h-C))/C)),h>=o)return p.push(zh(y,v,(o-(h-C))/C)),p;h>e&&p.push(v)}return p}bufferPoint(e,o){let c=o/this.ky,h=o/this.kx;return[e[0]-h,e[1]-c,e[0]+h,e[1]+c]}bufferBBox(e,o){let c=o/this.ky,h=o/this.kx;return[e[0]-h,e[1]-c,e[2]+h,e[3]+c]}insideBBox(e,o){return ta(e[0]-o[0])>=0&&ta(e[0]-o[2])<=0&&e[1]>=o[1]&&e[1]<=o[3]}}function Xf(i,e){return i[0]===e[0]&&i[1]===e[1]}function zh(i,e,o){let c=ta(e[0]-i[0]);return[i[0]+c*o,i[1]+(e[1]-i[1])*o]}function ta(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}var Bh={exports:{}};(function(i,e){i.exports=function(){var o=function(h,p){if(h===void 0&&(h=[]),p===void 0&&(p=c),this.data=h,this.length=this.data.length,this.compare=p,this.length>0)for(var m=(this.length>>1)-1;m>=0;m--)this._down(m)};function c(h,p){return h<p?-1:h>p?1:0}return o.prototype.push=function(h){this.data.push(h),this.length++,this._up(this.length-1)},o.prototype.pop=function(){if(this.length!==0){var h=this.data[0],p=this.data.pop();return this.length--,this.length>0&&(this.data[0]=p,this._down(0)),h}},o.prototype.peek=function(){return this.data[0]},o.prototype._up=function(h){for(var p=this.data,m=this.compare,y=p[h];h>0;){var v=h-1>>1,C=p[v];if(m(y,C)>=0)break;p[h]=C,h=v}p[h]=y},o.prototype._down=function(h){for(var p=this.data,m=this.compare,y=this.length>>1,v=p[h];h<y;){var C=1+(h<<1),T=p[C],E=C+1;if(E<this.length&&m(p[E],T)<0&&(C=E,T=p[E]),m(T,v)>=0)break;p[h]=T,h=C}p[h]=v},o}()})(Bh);var Kf=He(Bh.exports),pt=8192;function ny(i,e){return e.dist-i.dist}let Qf=100,Jf=50;function ry(i){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(e[o]!==i[o])return!1;return!0}function gp(i){return i[1]-i[0]+1}function Wa(i,e){let o=i[1]>=i[0]&&i[1]<e;return o||console.warn("Distance Expression: Index is out of range"),o}function Us(i,e){if(i[0]>i[1])return[null,null];let o=gp(i);if(e){if(o===2)return[i,null];let c=Math.floor(o/2);return[[i[0],i[0]+c],[i[0]+c,i[1]]]}{if(o===1)return[i,null];let c=Math.floor(o/2)-1;return[[i[0],i[0]+c],[i[0]+c+1,i[1]]]}}function Pl(i,e){let o=[1/0,1/0,-1/0,-1/0];if(!Wa(e,i.length))return o;for(let c=e[0];c<=e[1];++c)Oh(o,i[c]);return o}function _p(i){let e=[1/0,1/0,-1/0,-1/0];for(let o=0;o<i.length;++o)for(let c=0;c<i[o].length;++c)Oh(e,i[o][c]);return e}function Hs(i,e,o){if(ry(i)||ry(e))return NaN;let c=0,h=0;return i[2]<e[0]&&(c=e[0]-i[2]),i[0]>e[2]&&(c=i[0]-e[2]),i[1]>e[3]&&(h=i[1]-e[3]),i[3]<e[1]&&(h=e[1]-i[3]),o.distance([0,0],[c,h])}function l1(i){return 360*i-180}function c1(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function eg(i,e){let o=Math.pow(2,e.z),c=(i.y/pt+e.y)/o;return[l1((i.x/pt+e.x)/o),c1(c)]}function d1(i,e){let o=[];for(let c=0;c<i.length;++c)o.push(eg(i[c],e));return o}function oy(i,e,o){let c=o.pointOnLine(e,i).point;return o.distance(i,c)}function Ws(i,e,o,c,h){let p=o.slice(c[0],c[1]+1),m=1/0;for(let y=e[0];y<=e[1];++y)if((m=Math.min(m,oy(i[y],p,h)))===0)return 0;return m}function tg(i,e,o,c,h){let p=Math.min(h.pointToSegmentDistance(i,o,c),h.pointToSegmentDistance(e,o,c)),m=Math.min(h.pointToSegmentDistance(o,i,e),h.pointToSegmentDistance(c,i,e));return Math.min(p,m)}function h1(i,e,o,c,h){if(!Wa(e,i.length)||!Wa(c,o.length))return NaN;let p=1/0;for(let m=e[0];m<e[1];++m)for(let y=c[0];y<c[1];++y){if(ji(i[m],i[m+1],o[y],o[y+1]))return 0;p=Math.min(p,tg(i[m],i[m+1],o[y],o[y+1],h))}return p}function ay(i,e,o,c,h){if(!Wa(e,i.length)||!Wa(c,o.length))return NaN;let p=1/0;for(let m=e[0];m<=e[1];++m)for(let y=c[0];y<=c[1];++y)if((p=Math.min(p,h.distance(i[m],o[y])))===0)return p;return p}function sy(i,e,o){if(Yc(i,e,!0))return 0;let c=1/0;for(let h of e){let p=h.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[p-1]&&(c=Math.min(c,o.pointToSegmentDistance(i,h[p-1],h[0])))===0||(c=Math.min(c,oy(i,h,o)))===0)return c}return c}function Sa(i,e,o,c){if(!Wa(e,i.length))return NaN;for(let p=e[0];p<=e[1];++p)if(Yc(i[p],o,!0))return 0;let h=1/0;for(let p=e[0];p<e[1];++p)for(let m of o)for(let y=0,v=m.length,C=v-1;y<v;C=y++){if(ji(i[p],i[p+1],m[C],m[y]))return 0;h=Math.min(h,tg(i[p],i[p+1],m[C],m[y],c))}return h}function ig(i,e){for(let o of i)for(let c=0;c<=o.length-1;++c)if(Yc(o[c],e,!0))return!0;return!1}function u1(i,e,o,c=1/0){let h=_p(i),p=_p(e);if(c!==1/0&&Hs(h,p,o)>=c)return c;if(qc(h,p)){if(ig(i,e))return 0}else if(ig(e,i))return 0;let m=c;for(let y of i)for(let v=0,C=y.length,T=C-1;v<C;T=v++)for(let E of e)for(let D=0,O=E.length,R=O-1;D<O;R=D++){if(ji(y[T],y[v],E[R],E[D]))return 0;m=Math.min(m,tg(y[T],y[v],E[R],E[D],o))}return m}function Nh(i,e,o,c,h,p,m){if(p===null||m===null)return;let y=Hs(Pl(c,p),Pl(h,m),o);y<e&&i.push({dist:y,range1:p,range2:m})}function yp(i,e,o,c,h=1/0){let p=Math.min(c.distance(i[0],o[0][0]),h);if(p===0)return p;let m=new Kf([{dist:0,range1:[0,i.length-1],range2:[0,0]}],ny),y=e?Jf:Qf,v=_p(o);for(;m.length;){let C=m.pop();if(C.dist>=p)continue;let T=C.range1;if(gp(T)<=y){if(!Wa(T,i.length))return NaN;if(e){let E=Sa(i,T,o,c);if((p=Math.min(p,E))===0)return p}else for(let E=T[0];E<=T[1];++E){let D=sy(i[E],o,c);if((p=Math.min(p,D))===0)return p}}else{let E=Us(T,e);if(E[0]!==null){let D=Hs(Pl(i,E[0]),v,c);D<p&&m.push({dist:D,range1:E[0],range2:[0,0]})}if(E[1]!==null){let D=Hs(Pl(i,E[1]),v,c);D<p&&m.push({dist:D,range1:E[1],range2:[0,0]})}}}return p}function ly(i,e,o,c,h,p=1/0){let m=Math.min(p,h.distance(i[0],o[0]));if(m===0)return m;let y=new Kf([{dist:0,range1:[0,i.length-1],range2:[0,o.length-1]}],ny),v=e?Jf:Qf,C=c?Jf:Qf;for(;y.length;){let T=y.pop();if(T.dist>=m)continue;let E=T.range1,D=T.range2;if(gp(E)<=v&&gp(D)<=C){if(!Wa(E,i.length)||!Wa(D,o.length))return NaN;if(e&&c?m=Math.min(m,h1(i,E,o,D,h)):e||c?e&&!c?m=Math.min(m,Ws(o,D,i,E,h)):!e&&c&&(m=Math.min(m,Ws(i,E,o,D,h))):m=Math.min(m,ay(i,E,o,D,h)),m===0)return m}else{let O=Us(E,e),R=Us(D,c);Nh(y,m,h,i,o,O[0],R[0]),Nh(y,m,h,i,o,O[0],R[1]),Nh(y,m,h,i,o,O[1],R[0]),Nh(y,m,h,i,o,O[1],R[1])}}return m}function ng(i,e,o,c,h=1/0){let p=h,m=Pl(i,[0,i.length-1]);for(let y of o)if(!(p!==1/0&&Hs(m,Pl(y,[0,y.length-1]),c)>=p)&&(p=Math.min(p,ly(i,e,y,!0,c,p)),p===0))return p;return p}function bp(i,e,o,c,h=1/0){let p=h,m=Pl(i,[0,i.length-1]);for(let y of o){if(p!==1/0&&Hs(m,_p(y),c)>=p)continue;let v=yp(i,e,y,c,p);if(isNaN(v))return v;if((p=Math.min(p,v))===0)return p}return p}function rg(i){return i==="Point"||i==="MultiPoint"||i==="LineString"||i==="MultiLineString"||i==="Polygon"||i==="MultiPolygon"}class Ol{constructor(e,o){this.type=Dt,this.geojson=e,this.geometries=o}static parse(e,o){if(e.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(yo(e[1])){let c=e[1];if(c.type==="FeatureCollection"){for(let h=0;h<c.features.length;++h)if(rg(c.features[h].geometry.type))return new Ol(c,c.features[h].geometry)}else if(c.type==="Feature"){if(rg(c.geometry.type))return new Ol(c,c.geometry)}else if(rg(c.type))return new Ol(c,c)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let o=e.geometry(),c=e.canonicalID();if(o!=null&&c!=null){if(e.geometryType()==="Point")return function(h,p,m){let y=[];for(let C of h)for(let T of C)y.push(eg(T,p));let v=new Lh(y[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?ly(y,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v):m.type==="MultiLineString"?ng(y,!1,m.coordinates,v):m.type==="Polygon"||m.type==="MultiPolygon"?bp(y,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,v):null}(o,c,this.geometries);if(e.geometryType()==="LineString")return function(h,p,m){let y=[];for(let C of h){let T=[];for(let E of C)T.push(eg(E,p));y.push(T)}let v=new Lh(y[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return ng(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",y,v);if(m.type==="MultiLineString"){let C=1/0;for(let T=0;T<m.coordinates.length;T++){let E=ng(m.coordinates[T],!0,y,v,C);if(isNaN(E))return E;if((C=Math.min(C,E))===0)return C}return C}if(m.type==="Polygon"||m.type==="MultiPolygon"){let C=1/0;for(let T=0;T<y.length;T++){let E=bp(y[T],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,v,C);if(isNaN(E))return E;if((C=Math.min(C,E))===0)return C}return C}return null}(o,c,this.geometries);if(e.geometryType()==="Polygon")return function(h,p,m){let y=[];for(let C of function(T,E){let D=T.length;if(D<=1)return[T];let O=[],R,z;for(let N=0;N<D;N++){let W=r1(T[N]);W!==0&&(T[N].area=Math.abs(W),z===void 0&&(z=W<0),z===W<0?(R&&O.push(R),R=[T[N]]):R.push(T[N]))}return R&&O.push(R),O}(h)){let T=[];for(let E=0;E<C.length;++E)T.push(d1(C[E],p));y.push(T)}let v=new Lh(y[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return bp(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",y,v);if(m.type==="MultiLineString"){let C=1/0;for(let T=0;T<m.coordinates.length;T++){let E=bp(m.coordinates[T],!0,y,v,C);if(isNaN(E))return E;if((C=Math.min(C,E))===0)return C}return C}return m.type==="Polygon"||m.type==="MultiPolygon"?function(C,T,E){let D=1/0;for(let O of C)for(let R of T){let z=u1(O,R,E,D);if(isNaN(z))return z;if((D=Math.min(D,z))===0)return D}return D}(m.type==="Polygon"?[m.coordinates]:m.coordinates,y,v):null}(o,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Xc(i,e){switch(i){case"string":return ea(e);case"number":return+e;case"boolean":return!!e;case"color":return Wi.parse(e);case"formatted":return Xr.fromString(ea(e));case"resolvedImage":return _o.fromString(ea(e))}return e}function Vh(i,e,o,c){return c!==void 0&&(i=c*Math.round(i/c)),e!==void 0&&i<e&&(i=e),o!==void 0&&i>o&&(i=o),i}class Fr{constructor(e,o,c){this.type=e,this.key=o,this.scope=c}static parse(e,o){let c=o.expectedType;if(c==null&&(c=Ui),e.length<2||e.length>3)return o.error("Invalid number of arguments for 'config' expression.");let h=o.parse(e[1],1);if(!(h instanceof ds))return o.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let p=o.parse(e[2],2);return p instanceof ds?new Fr(c,ea(h.value),ea(p.value)):o.error("Scope of 'config' expression must be a string literal.")}return new Fr(c,ea(h.value))}evaluate(e){let o=[this.key,this.scope,e.scope].filter(Boolean).join(""),c=e.getConfig(o);if(!c)return null;let{type:h,value:p,values:m,minValue:y,maxValue:v,stepValue:C}=c,T=c.default.evaluate(e),E=T;if(p){let D=e.scope;e.scope=(D||"").split("").slice(1).join(""),E=p.evaluate(e),e.scope=D}return h&&(E=Xc(h,E)),E===void 0||y===void 0&&v===void 0&&C===void 0||(typeof E=="number"?E=Vh(E,y,v,C):Array.isArray(E)&&(E=E.map(D=>typeof D=="number"?Vh(D,y,v,C):D))),p!==void 0&&E!==void 0&&m&&!m.includes(E)&&(E=T,h&&(E=Xc(h,E))),(h&&h!==this.type||E!==void 0&&dr(E)!==this.type)&&(E=Xc(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Gs(i){if(i instanceof to&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Vs||i instanceof Ol)return!1;let e=!0;return i.eachChild(o=>{e&&!Gs(o)&&(e=!1)}),e}function vp(i){if(i instanceof to&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(o=>{e&&!vp(o)&&(e=!1)}),e}function og(i){if(i instanceof Fr)return!1;let e=!0;return i.eachChild(o=>{e&&!og(o)&&(e=!1)}),e}function jh(i,e){if(i instanceof to&&e.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(c=>{o&&!jh(c,e)&&(o=!1)}),o}class xp{constructor(e,o){this.type=o.type,this.name=e,this.boundExpression=o}static parse(e,o){if(e.length!==2||typeof e[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");let c=e[1];return o.scope.has(c)?new xp(c,o.scope.get(c)):o.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Uh{constructor(e,o=[],c,h=new Hf,p=[],m,y){this.registry=e,this.path=o,this.key=o.map(v=>`[${v}]`).join(""),this.scope=h,this.errors=p,this.expectedType=c,this._scope=m,this.options=y}parse(e,o,c,h,p={}){return o||c?this.concat(o,c,h)._parse(e,p):this._parse(e,p)}_parse(e,o){function c(h,p,m){return m==="assert"?new xa(p,[h]):m==="coerce"?new wa(p,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){let m=this.expectedType,y=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||y.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(m,y))return null}else p=c(p,m,o.typeAnnotation||"coerce");else p=c(p,m,o.typeAnnotation||"assert")}if(!(p instanceof ds)&&p.type.kind!=="resolvedImage"&&Hh(p)){let m=new Q0(this._scope,this.options);try{p=new ds(p.type,p.evaluate(m))}catch(y){return this.error(y.message),null}}return p}return wa.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,o,c){let h=typeof e=="number"?this.path.concat(e):this.path,p=c?this.scope.concat(c):this.scope;return new Uh(this.registry,h,o||null,p,this.errors,this._scope,this.options)}error(e,...o){let c=`${this.key}${o.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ua(c,e))}checkSubtype(e,o){let c=Dh(e,o);return c&&this.error(c),c}}var cy=Uh;function Hh(i){if(i instanceof xp)return Hh(i.boundExpression);if(i instanceof to&&i.name==="error"||i instanceof Ns||i instanceof Vs||i instanceof Ol||i instanceof Fr)return!1;let e=i instanceof wa||i instanceof xa,o=!0;return i.eachChild(c=>{o=e?o&&Hh(c):o&&c instanceof ds}),!!o&&Gs(i)&&jh(i,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function wp(i,e){let o=i.length-1,c,h,p=0,m=o,y=0;for(;p<=m;)if(y=Math.floor((p+m)/2),c=i[y],h=i[y+1],c<=e){if(y===o||e<h)return y;p=y+1}else{if(!(c>e))throw new vr("Input is not a number.");m=y-1}return 0}class Wh{constructor(e,o,c){this.type=e,this.input=o,this.labels=[],this.outputs=[];for(let[h,p]of c)this.labels.push(h),this.outputs.push(p)}static parse(e,o){if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");let c=o.parse(e[1],1,Dt);if(!c)return null;let h=[],p=null;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(let m=1;m<e.length;m+=2){let y=m===1?-1/0:e[m],v=e[m+1],C=m,T=m+1;if(typeof y!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(h.length&&h[h.length-1][0]>=y)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);let E=o.parse(v,T,p);if(!E)return null;p=p||E.type,h.push([y,E])}return new Wh(p,c,h)}evaluate(e){let o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(e);let h=this.input.evaluate(e);if(h<=o[0])return c[0].evaluate(e);let p=o.length;return h>=o[p-1]?c[p-1].evaluate(e):c[wp(o,h)].evaluate(e)}eachChild(e){e(this.input);for(let o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&e.push(this.labels[o]),e.push(this.outputs[o].serialize());return e}}let Cp=.95047,dy=1.08883,ag=4/29,Rl=6/29,hy=3*Rl*Rl,sg=Rl*Rl*Rl,Sp=Math.PI/180,uy=180/Math.PI;function lg(i){return i>sg?Math.pow(i,1/3):i/hy+ag}function Mp(i){return i>Rl?i*i*i:hy*(i-ag)}function cg(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Gh(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function py(i){let e=Gh(i.r),o=Gh(i.g),c=Gh(i.b),h=lg((.4124564*e+.3575761*o+.1804375*c)/Cp),p=lg((.2126729*e+.7151522*o+.072175*c)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-lg((.0193339*e+.119192*o+.9503041*c)/dy)),alpha:i.a}}function my(i){let e=(i.l+16)/116,o=isNaN(i.a)?e:e+i.a/500,c=isNaN(i.b)?e:e-i.b/200;return e=1*Mp(e),o=Cp*Mp(o),c=dy*Mp(c),new Wi(cg(3.2404542*o-1.5371385*e-.4985314*c),cg(-.969266*o+1.8760108*e+.041556*c),cg(.0556434*o-.2040259*e+1.0572252*c),i.alpha)}function p1(i,e,o){let c=e-i;return i+o*(c>180||c<-180?c-360*Math.round(c/360):c)}let $h={forward:py,reverse:my,interpolate:function(i,e,o){return{l:Gt(i.l,e.l,o),a:Gt(i.a,e.a,o),b:Gt(i.b,e.b,o),alpha:Gt(i.alpha,e.alpha,o)}}},Kc={forward:function(i){let{l:e,a:o,b:c}=py(i),h=Math.atan2(c,o)*uy;return{h:h<0?h+360:h,c:Math.sqrt(o*o+c*c),l:e,alpha:i.a}},reverse:function(i){let e=i.h*Sp,o=i.c;return my({l:i.l,a:Math.cos(e)*o,b:Math.sin(e)*o,alpha:i.alpha})},interpolate:function(i,e,o){return{h:p1(i.h,e.h,o),c:Gt(i.c,e.c,o),l:Gt(i.l,e.l,o),alpha:Gt(i.alpha,e.alpha,o)}}};var fy=Object.freeze({__proto__:null,hcl:Kc,lab:$h});class jo{constructor(e,o,c,h,p){this.type=e,this.operator=o,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(let[m,y]of p)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,o,c,h){let p=0;if(e.name==="exponential")p=dg(o,e.base,c,h);else if(e.name==="linear")p=dg(o,1,c,h);else if(e.name==="cubic-bezier"){let m=e.controlPoints;p=new ph(m[0],m[1],m[2],m[3]).solve(dg(o,1,c,h))}return p}static parse(e,o){let[c,h,p,...m]=e;if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){let C=h[1];if(typeof C!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:C}}else{if(h[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(h[0])}`,1,0);{let C=h.slice(1);if(C.length!==4||C.some(T=>typeof T!="number"||T<0||T>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(p=o.parse(p,2,Dt),!p)return null;let y=[],v=null;c==="interpolate-hcl"||c==="interpolate-lab"?v=go:o.expectedType&&o.expectedType.kind!=="value"&&(v=o.expectedType);for(let C=0;C<m.length;C+=2){let T=m[C],E=m[C+1],D=C+3,O=C+4;if(typeof T!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=T)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);let R=o.parse(E,O,v);if(!R)return null;v=v||R.type,y.push([T,R])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new jo(v,c,h,p,y):o.error(`Type ${Jn(v)} is not interpolatable.`)}evaluate(e){let o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(e);let h=this.input.evaluate(e);if(h<=o[0])return c[0].evaluate(e);let p=o.length;if(h>=o[p-1])return c[p-1].evaluate(e);let m=wp(o,h),y=jo.interpolationFactor(this.interpolation,h,o[m],o[m+1]),v=c[m].evaluate(e),C=c[m+1].evaluate(e);return this.operator==="interpolate"?pp[this.type.kind.toLowerCase()](v,C,y):this.operator==="interpolate-hcl"?Kc.reverse(Kc.interpolate(Kc.forward(v),Kc.forward(C),y)):$h.reverse($h.interpolate($h.forward(v),$h.forward(C),y))}eachChild(e){e(this.input);for(let o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let o=[this.operator,e,this.input.serialize()];for(let c=0;c<this.labels.length;c++)o.push(this.labels[c],this.outputs[c].serialize());return o}}function dg(i,e,o,c){let h=c-o,p=i-o;return h===0?0:e===1?p/h:(Math.pow(e,p)-1)/(Math.pow(e,h)-1)}class Tp{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expectected at least one argument.");let c=null,h=o.expectedType;h&&h.kind!=="value"&&(c=h);let p=[];for(let y of e.slice(1)){let v=o.parse(y,1+p.length,c,void 0,{typeAnnotation:"omit"});if(!v)return null;c=c||v.type,p.push(v)}let m=h&&p.some(y=>Dh(h,y.type));return new Tp(m?Ui:c,p)}evaluate(e){let o,c=null,h=0;for(let p of this.args){if(h++,c=p.evaluate(e),c&&c instanceof _o&&!c.available&&(o||(o=c),c=null,h===this.args.length))return o;if(c!==null)break}return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(o=>{e.push(o.serialize())}),e}}class Ip{constructor(e,o){this.type=o.type,this.bindings=[].concat(e),this.result=o}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let o of this.bindings)e(o[1]);e(this.result)}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let c=[];for(let p=1;p<e.length-1;p+=2){let m=e[p];if(typeof m!="string")return o.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);let y=o.parse(e[p+1],p+1);if(!y)return null;c.push([m,y])}let h=o.parse(e[e.length-1],e.length-1,o.expectedType,c);return h?new Ip(c,h):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[o,c]of this.bindings)e.push(o,c.serialize());return e.push(this.result.serialize()),e}}class hg{constructor(e,o,c){this.type=e,this.index=o,this.input=c}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let c=o.parse(e[1],1,Dt),h=o.parse(e[2],2,Do(o.expectedType||Ui));return c&&h?new hg(h.type.itemType,c,h):null}evaluate(e){let o=this.index.evaluate(e),c=this.input.evaluate(e);if(o<0)throw new vr(`Array index out of bounds: ${o} < 0.`);if(o>=c.length)throw new vr(`Array index out of bounds: ${o} > ${c.length-1}.`);if(o!==Math.floor(o))throw new vr(`Array index must be an integer, but found ${o} instead.`);return c[o]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ug{constructor(e,o){this.type=$i,this.needle=e,this.haystack=o}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let c=o.parse(e[1],1,Ui),h=o.parse(e[2],2,Ui);return c&&h?Wf(c.type,[$i,Gi,Dt,Hc,Ui])?new ug(c,h):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(c.type)} instead`):null}evaluate(e){let o=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(c==null)return!1;if(!$c(o,["boolean","string","number","null"]))throw new vr(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(dr(o))} instead.`);if(!$c(c,["string","array"]))throw new vr(`Expected second argument to be of type array or string, but found ${Jn(dr(c))} instead.`);return c.indexOf(o)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ep{constructor(e,o,c){this.type=Dt,this.needle=e,this.haystack=o,this.fromIndex=c}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let c=o.parse(e[1],1,Ui),h=o.parse(e[2],2,Ui);if(!c||!h)return null;if(!Wf(c.type,[$i,Gi,Dt,Hc,Ui]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(c.type)} instead`);if(e.length===4){let p=o.parse(e[3],3,Dt);return p?new Ep(c,h,p):null}return new Ep(c,h)}evaluate(e){let o=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!$c(o,["boolean","string","number","null"]))throw new vr(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(dr(o))} instead.`);if(!$c(c,["string","array"]))throw new vr(`Expected second argument to be of type array or string, but found ${Jn(dr(c))} instead.`);if(this.fromIndex){let h=this.fromIndex.evaluate(e);return c.indexOf(o,h)}return c.indexOf(o)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Qc{constructor(e,o,c,h,p,m){this.inputType=e,this.type=o,this.input=c,this.cases=h,this.outputs=p,this.otherwise=m}static parse(e,o){if(e.length<5)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return o.error("Expected an even number of arguments.");let c,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);let p={},m=[];for(let C=2;C<e.length-1;C+=2){let T=e[C],E=e[C+1];Array.isArray(T)||(T=[T]);let D=o.concat(C);if(T.length===0)return D.error("Expected at least one branch label.");for(let R of T){if(typeof R!="number"&&typeof R!="string")return D.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return D.error("Numeric branch labels must be integer values.");if(c){if(D.checkSubtype(c,dr(R)))return null}else c=dr(R);if(p[String(R)]!==void 0)return D.error("Branch labels must be unique.");p[String(R)]=m.length}let O=o.parse(E,C,h);if(!O)return null;h=h||O.type,m.push(O)}let y=o.parse(e[1],1,Ui);if(!y)return null;let v=o.parse(e[e.length-1],e.length-1,h);return v?y.type.kind!=="value"&&o.concat(1).checkSubtype(c,y.type)?null:new Qc(c,h,y,p,m,v):null}evaluate(e){let o=this.input.evaluate(e);return(dr(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),c=[],h={};for(let m of o){let y=h[this.cases[m]];y===void 0?(h[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[y][1].push(m)}let p=m=>this.inputType.kind==="number"?Number(m):m;for(let[m,y]of c)e.push(y.length===1?p(y[0]):y.map(p)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class pg{constructor(e,o,c){this.type=e,this.branches=o,this.otherwise=c}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return o.error("Expected an odd number of arguments.");let c;o.expectedType&&o.expectedType.kind!=="value"&&(c=o.expectedType);let h=[];for(let m=1;m<e.length-1;m+=2){let y=o.parse(e[m],m,$i);if(!y)return null;let v=o.parse(e[m+1],m+1,c);if(!v)return null;h.push([y,v]),c=c||v.type}let p=o.parse(e[e.length-1],e.length-1,c);return p?new pg(c,h,p):null}evaluate(e){for(let[o,c]of this.branches)if(o.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[o,c]of this.branches)e(o),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(o=>{e.push(o.serialize())}),e}}class Dp{constructor(e,o,c,h){this.type=e,this.input=o,this.beginIndex=c,this.endIndex=h}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let c=o.parse(e[1],1,Ui),h=o.parse(e[2],2,Dt);if(!c||!h)return null;if(!Wf(c.type,[Do(Ui),Gi,Ui]))return o.error(`Expected first argument to be of type array or string, but found ${Jn(c.type)} instead`);if(e.length===4){let p=o.parse(e[3],3,Dt);return p?new Dp(c.type,c,h,p):null}return new Dp(c.type,c,h)}evaluate(e){let o=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!$c(o,["string","array"]))throw new vr(`Expected first argument to be of type array or string, but found ${Jn(dr(o))} instead.`);if(this.endIndex){let h=this.endIndex.evaluate(e);return o.slice(c,h)}return o.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function qh(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function gy(i,e,o,c){return c.compare(e,o)===0}function Fl(i,e,o){let c=i!=="=="&&i!=="!=";return class RO{constructor(p,m,y){this.type=$i,this.lhs=p,this.rhs=m,this.collator=y,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");let y=p[0],v=m.parse(p[1],1,Ui);if(!v)return null;if(!qh(y,v.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${Jn(v.type)}'.`);let C=m.parse(p[2],2,Ui);if(!C)return null;if(!qh(y,C.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${Jn(C.type)}'.`);if(v.type.kind!==C.type.kind&&v.type.kind!=="value"&&C.type.kind!=="value")return m.error(`Cannot compare types '${Jn(v.type)}' and '${Jn(C.type)}'.`);c&&(v.type.kind==="value"&&C.type.kind!=="value"?v=new xa(C.type,[v]):v.type.kind!=="value"&&C.type.kind==="value"&&(C=new xa(v.type,[C])));let T=null;if(p.length===4){if(v.type.kind!=="string"&&C.type.kind!=="string"&&v.type.kind!=="value"&&C.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(T=m.parse(p[3],3,va),!T)return null}return new RO(v,C,T)}evaluate(p){let m=this.lhs.evaluate(p),y=this.rhs.evaluate(p);if(c&&this.hasUntypedArgument){let v=dr(m),C=dr(y);if(v.kind!==C.kind||v.kind!=="string"&&v.kind!=="number")throw new vr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${v.kind}, ${C.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){let v=dr(m),C=dr(y);if(v.kind!=="string"||C.kind!=="string")return e(p,m,y)}return this.collator?o(p,m,y,this.collator.evaluate(p)):e(p,m,y)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){let p=[i];return this.eachChild(m=>{p.push(m.serialize())}),p}}}let m1=Fl("==",function(i,e,o){return e===o},gy),_y=Fl("!=",function(i,e,o){return e!==o},function(i,e,o,c){return!gy(0,e,o,c)}),yy=Fl("<",function(i,e,o){return e<o},function(i,e,o,c){return c.compare(e,o)<0}),by=Fl(">",function(i,e,o){return e>o},function(i,e,o,c){return c.compare(e,o)>0}),vy=Fl("<=",function(i,e,o){return e<=o},function(i,e,o,c){return c.compare(e,o)<=0}),mg=Fl(">=",function(i,e,o){return e>=o},function(i,e,o,c){return c.compare(e,o)>=0});class Yh{constructor(e,o,c,h,p,m){this.type=Gi,this.number=e,this.locale=o,this.currency=c,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(e,o){if(e.length!==3)return o.error("Expected two arguments.");let c=o.parse(e[1],1,Dt);if(!c)return null;let h=e[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=o.parse(h.locale,1,Gi),!p))return null;let m=null;if(h.currency&&(m=o.parse(h.currency,1,Gi),!m))return null;let y=null;if(h.unit&&(y=o.parse(h.unit,1,Gi),!y))return null;let v=null;if(h["min-fraction-digits"]&&(v=o.parse(h["min-fraction-digits"],1,Dt),!v))return null;let C=null;return h["max-fraction-digits"]&&(C=o.parse(h["max-fraction-digits"],1,Dt),!C)?null:new Yh(c,p,m,y,v,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class fg{constructor(e){this.type=Dt,this.input=e}static parse(e,o){if(e.length!==2)return o.error(`Expected 1 argument, but found ${e.length-1} instead.`);let c=o.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Jn(c.type)} instead.`):new fg(c):null}evaluate(e){let o=this.input.evaluate(e);if(typeof o=="string"||Array.isArray(o))return o.length;throw new vr(`Expected value to be of type string or array, but found ${Jn(dr(o))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(o=>{e.push(o.serialize())}),e}}function xy(i){return function(){i=1831565813+(i|=0)|0;let e=Math.imul(i^i>>>15,1|i);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Ll={"==":m1,"!=":_y,">":by,"<":yy,">=":mg,"<=":vy,array:xa,at:hg,boolean:xa,case:pg,coalesce:Tp,collator:Ns,format:Ah,image:Ph,in:ug,"index-of":Ep,interpolate:jo,"interpolate-hcl":jo,"interpolate-lab":jo,length:fg,let:Ip,literal:ds,match:Qc,number:xa,"number-format":Yh,object:xa,slice:Dp,step:Wh,string:xa,"to-boolean":wa,"to-color":wa,"to-number":wa,"to-string":wa,var:xp,within:Vs,distance:Ol,config:Fr};function wy(i,[e,o,c,h]){e=e.evaluate(i),o=o.evaluate(i),c=c.evaluate(i);let p=h?h.evaluate(i):1,m=X0(e,o,c,p);if(m)throw new vr(m);return new Wi(e/255*p,o/255*p,c/255*p,p)}function Cy(i,[e,o,c,h]){e=e.evaluate(i),o=o.evaluate(i),c=c.evaluate(i);let p=h?h.evaluate(i):1,m=function(C,T,E,D){return typeof C=="number"&&C>=0&&C<=360?typeof T=="number"&&T>=0&&T<=100&&typeof E=="number"&&E>=0&&E<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[C,T,E,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[C,T,E,D]:[C,T,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[C,T,E,D]:[C,T,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,o,c,p);if(m)throw new vr(m);let y=`hsla(${e}, ${o}%, ${c}%, ${p})`,v=Wi.parse(y);if(!v)throw new vr(`Failed to parse HSLA color: ${y}`);return v}function Sy(i,e){return i in e}function gg(i,e){let o=e[i];return o===void 0?null:o}function zl(i){return{type:i}}function My(i){return{result:"success",value:i}}function Bl(i){return{result:"error",value:i}}function Ty(i,e){return!!i&&!!i.parameters&&i.parameters.indexOf(e)>-1}function kp(i){return i["property-type"]==="data-driven"}function f1(i){return Ty(i.expression,"measure-light")}function f(i){return Ty(i.expression,"zoom")}function l(i){return!!i.expression&&i.expression.interpolated}function u(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function _(i){return i}function x(i,e){let o=e.type==="color",c=i.stops&&typeof i.stops[0][0]=="object",h=c||!(c||i.property!==void 0),p=i.type||(l(e)?"exponential":"interval");if(o&&((i=Uf({},i)).stops&&(i.stops=i.stops.map(C=>[C[0],Wi.parse(C[1])])),i.default=Wi.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!fy[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let m,y,v;if(p==="exponential")m=A;else if(p==="interval")m=I;else if(p==="categorical"){m=S,y=Object.create(null);for(let C of i.stops)y[C[0]]=C[1];v=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=P}if(c){let C={},T=[];for(let O=0;O<i.stops.length;O++){let R=i.stops[O],z=R[0].zoom;C[z]===void 0&&(C[z]={zoom:z,type:i.type,property:i.property,default:i.default,stops:[]},T.push(z)),C[z].stops.push([R[0].value,R[1]])}let E=[];for(let O of T)E.push([C[O].zoom,x(C[O],e)]);let D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:jo.interpolationFactor.bind(void 0,D),zoomStops:E.map(O=>O[0]),evaluate:({zoom:O},R)=>A({stops:E,base:i.base},e,O).evaluate(O,R)}}if(h){let C=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:jo.interpolationFactor.bind(void 0,C),zoomStops:i.stops.map(T=>T[0]),evaluate:({zoom:T})=>m(i,e,T,y,v)}}return{kind:"source",evaluate(C,T){let E=T&&T.properties?T.properties[i.property]:void 0;return E===void 0?w(i.default,e.default):m(i,e,E,y,v)}}}function w(i,e,o){return i!==void 0?i:e!==void 0?e:o!==void 0?o:void 0}function S(i,e,o,c,h){return w(typeof o===h?c[o]:void 0,i.default,e.default)}function I(i,e,o){if(Al(o)!=="number")return w(i.default,e.default);let c=i.stops.length;if(c===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[c-1][0])return i.stops[c-1][1];let h=wp(i.stops.map(p=>p[0]),o);return i.stops[h][1]}function A(i,e,o){let c=i.base!==void 0?i.base:1;if(Al(o)!=="number")return w(i.default,e.default);let h=i.stops.length;if(h===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[h-1][0])return i.stops[h-1][1];let p=wp(i.stops.map(T=>T[0]),o),m=function(T,E,D,O){let R=O-D,z=T-D;return R===0?0:E===1?z/R:(Math.pow(E,z)-1)/(Math.pow(E,R)-1)}(o,c,i.stops[p][0],i.stops[p+1][0]),y=i.stops[p][1],v=i.stops[p+1][1],C=pp[e.type]||_;if(i.colorSpace&&i.colorSpace!=="rgb"){let T=fy[i.colorSpace];C=(E,D)=>T.reverse(T.interpolate(T.forward(E),T.forward(D),m))}return typeof y.evaluate=="function"?{evaluate(...T){let E=y.evaluate.apply(void 0,T),D=v.evaluate.apply(void 0,T);if(E!==void 0&&D!==void 0)return C(E,D,m)}}:C(y,v,m)}function P(i,e,o){return e.type==="color"?o=Wi.parse(o):e.type==="formatted"?o=Xr.fromString(o.toString()):e.type==="resolvedImage"?o=_o.fromString(o.toString()):Al(o)===e.type||e.type==="enum"&&e.values[o]||(o=void 0),w(o,i.default,e.default)}to.register(Ll,{error:[{kind:"error"},[Gi],(i,[e])=>{throw new vr(e.evaluate(i))}],typeof:[Gi,[Ui],(i,[e])=>Jn(dr(e.evaluate(i)))],"to-rgba":[Do(Dt,4),[go],(i,[e])=>e.evaluate(i).toRenderColor(null).toArray()],rgb:[go,[Dt,Dt,Dt],wy],rgba:[go,[Dt,Dt,Dt,Dt],wy],hsl:[go,[Dt,Dt,Dt],Cy],hsla:[go,[Dt,Dt,Dt,Dt],Cy],has:{type:$i,overloads:[[[Gi],(i,[e])=>Sy(e.evaluate(i),i.properties())],[[Gi,Wc],(i,[e,o])=>Sy(e.evaluate(i),o.evaluate(i))]]},get:{type:Ui,overloads:[[[Gi],(i,[e])=>gg(e.evaluate(i),i.properties())],[[Gi,Wc],(i,[e,o])=>gg(e.evaluate(i),o.evaluate(i))]]},"feature-state":[Ui,[Gi],(i,[e])=>gg(e.evaluate(i),i.featureState||{})],properties:[Wc,[],i=>i.properties()],"geometry-type":[Gi,[],i=>i.geometryType()],id:[Ui,[],i=>i.id()],zoom:[Dt,[],i=>i.globals.zoom],pitch:[Dt,[],i=>i.globals.pitch||0],"distance-from-center":[Dt,[],i=>i.distanceFromCenter()],"measure-light":[Dt,[Gi],(i,[e])=>i.measureLight(e.evaluate(i))],"heatmap-density":[Dt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Dt,[],i=>i.globals.lineProgress||0],"raster-value":[Dt,[],i=>i.globals.rasterValue||0],"raster-particle-speed":[Dt,[],i=>i.globals.rasterParticleSpeed||0],"sky-radial-progress":[Dt,[],i=>i.globals.skyRadialProgress||0],accumulated:[Ui,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Dt,zl(Dt),(i,e)=>{let o=0;for(let c of e)o+=c.evaluate(i);return o}],"*":[Dt,zl(Dt),(i,e)=>{let o=1;for(let c of e)o*=c.evaluate(i);return o}],"-":{type:Dt,overloads:[[[Dt,Dt],(i,[e,o])=>e.evaluate(i)-o.evaluate(i)],[[Dt],(i,[e])=>-e.evaluate(i)]]},"/":[Dt,[Dt,Dt],(i,[e,o])=>e.evaluate(i)/o.evaluate(i)],"%":[Dt,[Dt,Dt],(i,[e,o])=>e.evaluate(i)%o.evaluate(i)],ln2:[Dt,[],()=>Math.LN2],pi:[Dt,[],()=>Math.PI],e:[Dt,[],()=>Math.E],"^":[Dt,[Dt,Dt],(i,[e,o])=>Math.pow(e.evaluate(i),o.evaluate(i))],sqrt:[Dt,[Dt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Dt,[Dt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Dt,[Dt],(i,[e])=>Math.log(e.evaluate(i))],log2:[Dt,[Dt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Dt,[Dt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Dt,[Dt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Dt,[Dt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Dt,[Dt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Dt,[Dt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Dt,[Dt],(i,[e])=>Math.atan(e.evaluate(i))],min:[Dt,zl(Dt),(i,e)=>Math.min(...e.map(o=>o.evaluate(i)))],max:[Dt,zl(Dt),(i,e)=>Math.max(...e.map(o=>o.evaluate(i)))],abs:[Dt,[Dt],(i,[e])=>Math.abs(e.evaluate(i))],round:[Dt,[Dt],(i,[e])=>{let o=e.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[Dt,[Dt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Dt,[Dt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[$i,[Gi,Ui],(i,[e,o])=>i.properties()[e.value]===o.value],"filter-id-==":[$i,[Ui],(i,[e])=>i.id()===e.value],"filter-type-==":[$i,[Gi],(i,[e])=>i.geometryType()===e.value],"filter-<":[$i,[Gi,Ui],(i,[e,o])=>{let c=i.properties()[e.value],h=o.value;return typeof c==typeof h&&c<h}],"filter-id-<":[$i,[Ui],(i,[e])=>{let o=i.id(),c=e.value;return typeof o==typeof c&&o<c}],"filter->":[$i,[Gi,Ui],(i,[e,o])=>{let c=i.properties()[e.value],h=o.value;return typeof c==typeof h&&c>h}],"filter-id->":[$i,[Ui],(i,[e])=>{let o=i.id(),c=e.value;return typeof o==typeof c&&o>c}],"filter-<=":[$i,[Gi,Ui],(i,[e,o])=>{let c=i.properties()[e.value],h=o.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[$i,[Ui],(i,[e])=>{let o=i.id(),c=e.value;return typeof o==typeof c&&o<=c}],"filter->=":[$i,[Gi,Ui],(i,[e,o])=>{let c=i.properties()[e.value],h=o.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[$i,[Ui],(i,[e])=>{let o=i.id(),c=e.value;return typeof o==typeof c&&o>=c}],"filter-has":[$i,[Ui],(i,[e])=>e.value in i.properties()],"filter-has-id":[$i,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[$i,[Do(Gi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[$i,[Do(Ui)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[$i,[Gi,Do(Ui)],(i,[e,o])=>o.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[$i,[Gi,Do(Ui)],(i,[e,o])=>function(c,h,p,m){for(;p<=m;){let y=p+m>>1;if(h[y]===c)return!0;h[y]>c?m=y-1:p=y+1}return!1}(i.properties()[e.value],o.value,0,o.value.length-1)],all:{type:$i,overloads:[[[$i,$i],(i,[e,o])=>e.evaluate(i)&&o.evaluate(i)],[zl($i),(i,e)=>{for(let o of e)if(!o.evaluate(i))return!1;return!0}]]},any:{type:$i,overloads:[[[$i,$i],(i,[e,o])=>e.evaluate(i)||o.evaluate(i)],[zl($i),(i,e)=>{for(let o of e)if(o.evaluate(i))return!0;return!1}]]},"!":[$i,[$i],(i,[e])=>!e.evaluate(i)],"is-supported-script":[$i,[Gi],(i,[e])=>{let o=i.globals&&i.globals.isSupportedScript;return!o||o(e.evaluate(i))}],upcase:[Gi,[Gi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Gi,[Gi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Gi,zl(Ui),(i,e)=>e.map(o=>ea(o.evaluate(i))).join("")],"resolved-locale":[Gi,[va],(i,[e])=>e.evaluate(i).resolvedLocale()],random:[Dt,[Dt,Dt,Ui],(i,e)=>{let[o,c,h]=e.map(m=>m.evaluate(i));if(o>c||o===c)return o;let p;if(typeof h=="string")p=function(m){let y=0;if(m.length===0)return y;for(let v=0;v<m.length;v++)y=(y<<5)-y+m.charCodeAt(v),y|=0;return y}(h);else{if(typeof h!="number")throw new vr(`Invalid seed input: ${h}`);p=h}return o+xy(p)()*(c-o)}]});class F{constructor(e,o,c,h){this.expression=e,this._warningHistory={},this._evaluator=new Q0(c,h),this._defaultValue=o?function(p){return p.type==="color"&&(u(p.default)||Array.isArray(p.default))?new Wi(0,0,0,0):p.type==="color"?Wi.parse(p.default)||null:p.default===void 0?null:p.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(e,o,c,h,p,m,y,v){return this._evaluator.globals=e,this._evaluator.feature=o,this._evaluator.featureState=c,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,o,c,h,p,m,y,v){this._evaluator.globals=e,this._evaluator.feature=o||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=v||null;try{let C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new vr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(C.message)),this._defaultValue}}}function B(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ll}function U(i,e,o,c){let h=new cy(Ll,[],e?function(m){let y={color:go,string:Gi,number:Dt,enum:Gi,boolean:$i,formatted:Gc,resolvedImage:Ha};return m.type==="array"?Do(y[m.value]||Ui,m.length):y[m.type]}(e):void 0,void 0,void 0,o,c),p=h.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?My(new F(p,e,o,c)):Bl(h.errors)}class H{constructor(e,o,c){this.kind=e,this._styleExpression=o,this.isLightConstant=c,this.isStateDependent=e!=="constant"&&!vp(o.expression),this.isConfigDependent=!og(o.expression)}evaluateWithoutErrorHandling(e,o,c,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,o,c,h,p,m)}evaluate(e,o,c,h,p,m){return this._styleExpression.evaluate(e,o,c,h,p,m)}}class q{constructor(e,o,c,h,p){this.kind=e,this.zoomStops=c,this._styleExpression=o,this.isStateDependent=e!=="camera"&&!vp(o.expression),this.isLightConstant=p,this.isConfigDependent=!og(o.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,o,c,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,o,c,h,p,m)}evaluate(e,o,c,h,p,m){return this._styleExpression.evaluate(e,o,c,h,p,m)}interpolationFactor(e,o,c){return this.interpolationType?jo.interpolationFactor(this.interpolationType,e,o,c):0}}function Z(i,e,o,c){if((i=U(i,e,o,c)).result==="error")return i;let h=i.value.expression,p=Gs(h);if(!p&&!kp(e))return Bl([new Ua("","data expressions not supported")]);let m=jh(h,["zoom","pitch","distance-from-center"]);if(!m&&!f(e))return Bl([new Ua("","zoom expressions not supported")]);let y=jh(h,["measure-light"]);if(!y&&!f1(e))return Bl([new Ua("","measure-light expression not supported")]);let v=e.expression&&e.expression.relaxZoomRestriction,C=K(h);return C||m||v?C instanceof Ua?Bl([C]):C instanceof jo&&!l(e)?Bl([new Ua("",'"interpolate" expressions cannot be used with this property')]):My(C?new q(p?"camera":"composite",i.value,C.labels,C instanceof jo?C.interpolation:void 0,y):new H(p?"constant":"source",i.value,y)):Bl([new Ua("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class X{constructor(e,o){this._parameters=e,this._specification=o,Uf(this,x(this._parameters,this._specification))}static deserialize(e){return new X(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function K(i){let e=null;if(i instanceof Ip)e=K(i.result);else if(i instanceof Tp){for(let o of i.args)if(e=K(o),e)break}else(i instanceof Wh||i instanceof jo)&&i.input instanceof to&&i.input.name==="zoom"&&(e=i);return e instanceof Ua||i.eachChild(o=>{let c=K(o);c instanceof Ua?e=c:e&&c&&e!==c&&(e=new Ua("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var re=se,ae=3;function se(i,e,o){var c=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(e=h[1])+2*(o=h[2]);for(var p=0;p<this.d*this.d;p++){var m=h[ae+p],y=h[ae+p+1];c.push(m===y?null:h.subarray(m,y))}var v=h[ae+c.length+1];this.keys=h.subarray(h[ae+c.length],v),this.bboxes=h.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*o;for(var C=0;C<this.d*this.d;C++)c.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=o,this.scale=e/i,this.uid=0;var T=o/e*i;this.min=-T,this.max=i+T}se.prototype.insert=function(i,e,o,c,h){this._forEachCell(e,o,c,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(h)},se.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},se.prototype._insertCell=function(i,e,o,c,h,p){this.cells[h].push(p)},se.prototype.query=function(i,e,o,c,h){var p=this.min,m=this.max;if(i<=p&&e<=p&&m<=o&&m<=c&&!h)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(i,e,o,c,this._queryCell,y,{},h),y},se.prototype._queryCell=function(i,e,o,c,h,p,m,y){var v=this.cells[h];if(v!==null)for(var C=this.keys,T=this.bboxes,E=0;E<v.length;E++){var D=v[E];if(m[D]===void 0){var O=4*D;(y?y(T[O+0],T[O+1],T[O+2],T[O+3]):i<=T[O+2]&&e<=T[O+3]&&o>=T[O+0]&&c>=T[O+1])?(m[D]=!0,p.push(C[D])):m[D]=!1}}},se.prototype._forEachCell=function(i,e,o,c,h,p,m,y){for(var v=this._convertToCellCoord(i),C=this._convertToCellCoord(e),T=this._convertToCellCoord(o),E=this._convertToCellCoord(c),D=v;D<=T;D++)for(var O=C;O<=E;O++){var R=this.d*O+D;if((!y||y(this._convertFromCellCoord(D),this._convertFromCellCoord(O),this._convertFromCellCoord(D+1),this._convertFromCellCoord(O+1)))&&h.call(this,i,e,o,c,R,p,m,y))return}},se.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},se.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},se.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=ae+this.cells.length+1+1,o=0,c=0;c<this.cells.length;c++)o+=this.cells[c].length;var h=new Int32Array(e+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=e,m=0;m<i.length;m++){var y=i[m];h[ae+m]=p,h.set(y,p),p+=y.length}return h[ae+i.length]=p,h.set(this.keys,p),h[ae+i.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};var fe=He(re);let me={};function ne(i,e,o={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writable:!1}),me[e]={klass:i,omit:o.omit||[]}}ne(Object,"Object"),fe.serialize=function(i,e){let o=i.toArrayBuffer();return e&&e.add(o),{buffer:o}},fe.deserialize=function(i){return new fe(i.buffer)},Object.defineProperty(fe,"name",{value:"Grid"}),ne(fe,"Grid"),ne(Wi,"Color"),ne(Error,"Error"),ne(Xr,"Formatted"),ne(kl,"FormattedSection"),ne(Rf,"AJAXError"),ne(_o,"ResolvedImage"),ne(X,"StylePropertyFunction"),ne(F,"StyleExpression",{omit:["_evaluator"]}),ne(q,"ZoomDependentExpression"),ne(H,"ZoomConstantExpression"),ne(to,"CompoundExpression",{omit:["_evaluate"]});for(let i in Ll)me[Ll[i]._classRegistryKey]||ne(Ll[i],`Expression${i}`);function le(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ce(i){return self.ImageBitmap&&i instanceof ImageBitmap}function we(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(le(i)||ce(i))return e&&e.add(i),i;if(ArrayBuffer.isView(i)){let o=i;return e&&e.add(o.buffer),o}if(i instanceof ImageData)return e&&e.add(i.data.buffer),i;if(Array.isArray(i)){let o=[];for(let c of i)o.push(we(c,e));return o}if(i instanceof Map){let o={$name:"Map"};for(let[c,h]of i.entries())o[c]=we(h);return o}if(typeof i=="object"){let o=i.constructor,c=o._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);let h=o.serialize?o.serialize(i,e):{};if(!o.serialize){for(let p in i)i.hasOwnProperty(p)&&(me[c].omit.indexOf(p)>=0||(h[p]=we(i[p],e)));i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(h.$name=c),h}throw new Error("can't serialize object of type "+typeof i)}function Oe(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||le(i)||ce(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Oe);if(typeof i=="object"){let e=i.$name||"Object";if(e==="Map"){let h=new Map;for(let p of Object.keys(i))p!=="$name"&&h.set(p,Oe(i[p]));return h}let{klass:o}=me[e];if(!o)throw new Error(`can't deserialize unregistered class ${e}`);if(o.deserialize)return o.deserialize(i);let c=Object.create(o.prototype);for(let h of Object.keys(i))h!=="$name"&&(c[h]=Oe(i[h]));return c}throw new Error("can't deserialize object of type "+typeof i)}let ue={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519,"CJK Unified Ideographs Extension B":i=>i>=131072&&i<=173791};function Re(i){for(let e of i)if(Je(e.charCodeAt(0)))return!0;return!1}function ze(i){for(let e of i)if(!Ke(e.charCodeAt(0)))return!1;return!0}function Ke(i){return!(ue.Arabic(i)||ue["Arabic Supplement"](i)||ue["Arabic Extended-A"](i)||ue["Arabic Presentation Forms-A"](i)||ue["Arabic Presentation Forms-B"](i))}function Je(i){return!(i!==746&&i!==747&&(i<4352||!(ue["Bopomofo Extended"](i)||ue.Bopomofo(i)||ue["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||ue["CJK Compatibility Ideographs"](i)||ue["CJK Compatibility"](i)||ue["CJK Radicals Supplement"](i)||ue["CJK Strokes"](i)||!(!ue["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||ue["CJK Unified Ideographs Extension A"](i)||ue["CJK Unified Ideographs"](i)||ue["Enclosed CJK Letters and Months"](i)||ue["Hangul Compatibility Jamo"](i)||ue["Hangul Jamo Extended-A"](i)||ue["Hangul Jamo Extended-B"](i)||ue["Hangul Jamo"](i)||ue["Hangul Syllables"](i)||ue.Hiragana(i)||ue["Ideographic Description Characters"](i)||ue.Kanbun(i)||ue["Kangxi Radicals"](i)||ue["Katakana Phonetic Extensions"](i)||ue.Katakana(i)&&i!==12540||!(!ue["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!ue["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||ue["Unified Canadian Aboriginal Syllabics"](i)||ue["Unified Canadian Aboriginal Syllabics Extended"](i)||ue["Vertical Forms"](i)||ue["Yijing Hexagram Symbols"](i)||ue["Yi Syllables"](i)||ue["Yi Radicals"](i))))}function Xe(i){return!(Je(i)||function(e){return!!(ue["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ue["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ue["Letterlike Symbols"](e)||ue["Number Forms"](e)||ue["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ue["Control Pictures"](e)&&e!==9251||ue["Optical Character Recognition"](e)||ue["Enclosed Alphanumerics"](e)||ue["Geometric Shapes"](e)||ue["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ue["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ue["CJK Symbols and Punctuation"](e)||ue.Katakana(e)||ue["Private Use Area"](e)||ue["CJK Compatibility Forms"](e)||ue["Small Form Variants"](e)||ue["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function De(i){return i>=1424&&i<=2303||ue["Arabic Presentation Forms-A"](i)||ue["Arabic Presentation Forms-B"](i)}function Ne(i,e){return!(!e&&De(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||ue.Khmer(i))}function Ze(i){for(let e of i)if(De(e.charCodeAt(0)))return!0;return!1}let mt="deferred",_t="loading",St="loaded",yt=null,it="unavailable",$e=null,Pt=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(it="error"),yt&&yt(i)};function hi(){ai.fire(new fo("pluginStateChange",{pluginStatus:it,pluginURL:$e}))}let ai=new Dl,xi=function(){return it},zi=function(){if(it!==mt||!$e)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");it=_t,hi(),$e&&Il({url:$e},i=>{i?Pt(i):(it=St,hi())})},an={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>it===St||an.applyArabicShaping!=null,isLoading:()=>it===_t,setState(i){it=i.pluginStatus,$e=i.pluginURL},isParsed:()=>an.applyArabicShaping!=null&&an.processBidirectionalText!=null&&an.processStyledBidirectionalText!=null,getPluginURL:()=>$e};class ti{constructor(e,o){this.zoom=e,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(o,c){for(let h of o)if(!Ne(h.charCodeAt(0),c))return!1;return!0}(e,an.isLoaded())}}class Ki{constructor(e,o,c,h){this.property=e,this.value=o,this.expression=function(p,m,y,v){if(u(p))return new X(p,m);if(B(p)||Array.isArray(p)&&p.length>0){let C=Z(p,m,y,v);if(C.result==="error")throw new Error(C.value.map(T=>`${T.key}: ${T.message}`).join(", "));return C.value}{let C=p;return typeof p=="string"&&m.type==="color"&&(C=Wi.parse(p)),{kind:"constant",isConfigDependent:!1,evaluate:()=>C}}}(o===void 0?e.specification.default:o,e.specification,c,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,o,c){return this.property.possiblyEvaluate(this,e,o,c)}}class _n{constructor(e,o,c){this.property=e,this.value=new Ki(e,void 0,o,c)}transitioned(e,o){return new Ti(this.property,this.value,o,Zr({},e.transition,this.transition),e.now)}untransitioned(){return new Ti(this.property,this.value,null,{},0)}}class tn{constructor(e,o,c){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=o,this._options=c,this.isConfigDependent=!1}getValue(e){return Va(this._values[e].value.value)}setValue(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new _n(this._values[e].property,this._scope,this._options)),this._values[e].value=new Ki(this._values[e].property,o===null?void 0:Va(o),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,o){o&&(this._options=o);let c=this._properties.properties;if(e)for(let h in e){let p=e[h];if(gh(h,"-transition")){let m=h.slice(0,-11);c[m]&&this.setTransition(m,p)}else c.hasOwnProperty(h)&&this.setValue(h,p)}}getTransition(e){return Va(this._values[e].transition)}setTransition(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new _n(this._values[e].property)),this._values[e].transition=Va(o)||void 0}serialize(){let e={};for(let o of Object.keys(this._values)){let c=this.getValue(o);c!==void 0&&(e[o]=c);let h=this.getTransition(o);h!==void 0&&(e[`${o}-transition`]=h)}return e}transitioned(e,o){let c=new si(this._properties);for(let h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(e,o._values[h]);return c}untransitioned(){let e=new si(this._properties);for(let o of Object.keys(this._values))e._values[o]=this._values[o].untransitioned();return e}}class Ti{constructor(e,o,c,h,p){let m=h.delay||0,y=h.duration||0;p=p||0,this.property=e,this.value=o,this.begin=p+m,this.end=this.begin+y,e.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(e,o,c){let h=e.now||0,p=this.value.possiblyEvaluate(e,o,c),m=this.prior;if(m){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return m.possiblyEvaluate(e,o,c);{let y=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,o,c),p,xf(y))}}return p}}class si{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,o,c){let h=new ln(this._properties);for(let p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,o,c);return h}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class xn{constructor(e,o,c){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=o,this._options=c,this.isConfigDependent=!1}getValue(e){return Va(this._values[e].value)}setValue(e,o){this._values[e]=new Ki(this._values[e].property,o===null?void 0:Va(o),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let o of Object.keys(this._values)){let c=this.getValue(o);c!==void 0&&(e[o]=c)}return e}possiblyEvaluate(e,o,c){let h=new ln(this._properties);for(let p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,o,c);return h}}class Mn{constructor(e,o,c){this.property=e,this.value=o,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,o,c,h){return this.property.evaluate(this.value,this.parameters,e,o,c,h)}}class ln{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Qe{constructor(e){this.specification=e}possiblyEvaluate(e,o){return e.expression.evaluate(o)}interpolate(e,o,c){let h=pp[this.specification.type];return h?h(e,o,c):e}}class wt{constructor(e,o){this.specification=e,this.overrides=o}possiblyEvaluate(e,o,c,h){return new Mn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(o,null,{},c,h)}:e.expression,o)}interpolate(e,o,c){if(e.value.kind!=="constant"||o.value.kind!=="constant")return e;if(e.value.value===void 0||o.value.value===void 0)return new Mn(this,{kind:"constant",value:void 0},e.parameters);let h=pp[this.specification.type];return h?new Mn(this,{kind:"constant",value:h(e.value.value,o.value.value,c)},e.parameters):e}evaluate(e,o,c,h,p,m){return e.kind==="constant"?e.value:e.evaluate(o,c,h,p,m)}}class On{constructor(e){this.specification=e}possiblyEvaluate(e,o,c,h){return!!e.expression.evaluate(o,null,{},c,h)}interpolate(){return!1}}class Qi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let o=new ti(0,{});for(let c in e){let h=e[c];h.specification.overridable&&this.overridableProperties.push(c);let p=this.defaultPropertyValues[c]=new Ki(h,void 0),m=this.defaultTransitionablePropertyValues[c]=new _n(h);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=p.possiblyEvaluate(o)}}}ne(wt,"DataDrivenProperty"),ne(Qe,"DataConstantProperty"),ne(On,"ColorRampProperty");var Pe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Uo(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Lr(i){if(Array.isArray(i))return i.map(Lr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let e={};for(let o in i)e[o]=Lr(i[o]);return e}return Uo(i)}function io(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let e of i.slice(1))if(!io(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function xr(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};io(i)||(i=Ga(i));let o=i,c=!0;try{c=function(C){if(!Ho(C))return C;let T=Lr(C);return Ma(T),T=bo(T),T}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}let h=Pe[`filter_${e}`],p=U(c,h),m=null;if(p.result==="error")throw new Error(p.value.map(C=>`${C.key}: ${C.message}`).join(", "));m=(C,T,E)=>p.value.evaluate(C,T,{},E);let y=null,v=null;if(c!==o){let C=U(o,h);if(C.result==="error")throw new Error(C.value.map(T=>`${T.key}: ${T.message}`).join(", "));y=(T,E,D,O,R)=>C.value.evaluate(T,E,{},D,void 0,void 0,O,R),v=!Gs(C.value.expression)}return{filter:m,dynamicFilter:y||void 0,needGeometry:us(c),needFeature:!!v}}function bo(i){if(!Array.isArray(i))return i;let e=function(o){if($s.has(o[0])){for(let c=1;c<o.length;c++)if(Ho(o[c]))return!0}return o}(i);return e===!0?e:e.map(o=>bo(o))}function Ma(i){let e=!1,o=[];if(i[0]==="case"){for(let c=1;c<i.length-1;c+=2)e=e||Ho(i[c]),o.push(i[c+1]);o.push(i[i.length-1])}else if(i[0]==="match"){e=e||Ho(i[1]);for(let c=2;c<i.length-1;c+=2)o.push(i[c+1]);o.push(i[i.length-1])}else if(i[0]==="step"){e=e||Ho(i[1]);for(let c=1;c<i.length-1;c+=2)o.push(i[c+1])}e&&(i.length=0,i.push("any",...o));for(let c=1;c<i.length;c++)Ma(i[c])}function Ho(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let o=1;o<i.length;o++)if(Ho(i[o]))return!0;return!1}let $s=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function qs(i,e){return i<e?-1:i>e?1:0}function us(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(us(i[e]))return!0;return!1}function Ga(i){if(!i)return!0;let e=i[0];return i.length<=1?e!=="any":e==="=="?ps(i[1],i[2],"=="):e==="!="?Nl(ps(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ps(i[1],i[2],e):e==="any"?(o=i.slice(1),["any"].concat(o.map(Ga))):e==="all"?["all"].concat(i.slice(1).map(Ga)):e==="none"?["all"].concat(i.slice(1).map(Ga).map(Nl)):e==="in"?Jc(i[1],i.slice(2)):e==="!in"?Nl(Jc(i[1],i.slice(2))):e==="has"?ed(i[1]):e!=="!has"||Nl(ed(i[1]));var o}function ps(i,e,o){switch(i){case"$type":return[`filter-type-${o}`,e];case"$id":return[`filter-id-${o}`,e];default:return[`filter-${o}`,i,e]}}function Jc(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(o=>typeof o!=typeof e[0])?["filter-in-large",i,["literal",e.sort(qs)]]:["filter-in-small",i,["literal",e]]}}function ed(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Nl(i){return["!",i]}let td="";function Ap(i,e){return e?`${i}${td}${e}`:i}let Pp="-transition",_g=new Set(["fill","line","background","hillshade","raster"]);class pr extends Dl{constructor(e,o,c,h,p){if(super(),this.id=e.id,this.fqid=Ap(this.id,c),this.type=e.type,this.scope=c,this.lut=h,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),o.layout&&(this._unevaluatedLayout=new xn(o.layout,this.scope,p),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),o.paint)){this._transitionablePaint=new tn(o.paint,this.scope,p);for(let m in e.paint)this.setPaintProperty(m,e.paint[m]);for(let m in e.layout)this.setLayoutProperty(m,e.layout[m]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ln(o.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return _g.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,o){if(this.type==="custom"&&e==="visibility")return void(this.visibility=o);let c=this._unevaluatedLayout;c._properties.properties[e]&&(c.setValue(e,o),this.isConfigDependent=this.isConfigDependent||c.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return gh(e,Pp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,o){let c=this._transitionablePaint,h=c._properties.properties;if(gh(e,Pp)){let E=e.slice(0,-11);return h[E]&&c.setTransition(E,o||void 0),!1}if(!h[e])return!1;let p=c._values[e],m=p.value.isDataDriven(),y=p.value;c.setValue(e,o),this.isConfigDependent=this.isConfigDependent||c.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let v=c._values[e].value,C=v.isDataDriven(),T=gh(e,"pattern")||e==="line-dasharray";return C||m||T||this._handleOverridablePaintPropertyUpdate(e,y,v)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,o,c){return null}_handleOverridablePaintPropertyUpdate(e,o,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,o)}serialize(){return Ml({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,o)=>!(e===void 0||o==="layout"&&!Object.keys(e).length||o==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let o=this.paint.get(e);if(o instanceof Mn&&kp(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=xr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,o,c,h,p,m,y,v,C){}queryIntersectsMatchingFeature(e,o,c,h){}}let yg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class id{constructor(e,o){this._structArray=e,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,o){return e._trim(),o&&(e.isTransferred=!0,o.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let o=Object.create(this.prototype);return o.arrayBuffer=e.arrayBuffer,o.length=e.length,o.capacity=e.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ji(i,e=1){let o=0,c=0;return{members:i.map(h=>{let p=yg[h.type].BYTES_PER_ELEMENT,m=o=KM(o,Math.max(e,p)),y=h.components||1;return c=Math.max(c,p),o+=p*y,{name:h.name,type:h.type,components:y,offset:m}}),size:KM(o,Math.max(c,e)),alignment:e}}function KM(i,e){return Math.ceil(i/e)*e}class ms extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,o)}emplace(e,o,c){let h=2*e;return this.int16[h+0]=o,this.int16[h+1]=c,e}}ms.prototype.bytesPerElement=4,ne(ms,"StructArrayLayout2i4");class Iy extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,c){let h=this.length;return this.resize(h+1),this.emplace(h,e,o,c)}emplace(e,o,c,h){let p=3*e;return this.int16[p+0]=o,this.int16[p+1]=c,this.int16[p+2]=h,e}}Iy.prototype.bytesPerElement=6,ne(Iy,"StructArrayLayout3i6");class nd extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,c,h){let p=this.length;return this.resize(p+1),this.emplace(p,e,o,c,h)}emplace(e,o,c,h,p){let m=4*e;return this.int16[m+0]=o,this.int16[m+1]=c,this.int16[m+2]=h,this.int16[m+3]=p,e}}nd.prototype.bytesPerElement=8,ne(nd,"StructArrayLayout4i8");class g1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p){let m=this.length;return this.resize(m+1),this.emplace(m,e,o,c,h,p)}emplace(e,o,c,h,p,m){let y=5*e;return this.int16[y+0]=o,this.int16[y+1]=c,this.int16[y+2]=h,this.int16[y+3]=p,this.int16[y+4]=m,e}}g1.prototype.bytesPerElement=10,ne(g1,"StructArrayLayout5i10");class _1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p,m,y){let v=this.length;return this.resize(v+1),this.emplace(v,e,o,c,h,p,m,y)}emplace(e,o,c,h,p,m,y,v){let C=6*e,T=12*e,E=3*e;return this.int16[C+0]=o,this.int16[C+1]=c,this.uint8[T+4]=h,this.uint8[T+5]=p,this.uint8[T+6]=m,this.uint8[T+7]=y,this.float32[E+2]=v,e}}_1.prototype.bytesPerElement=12,ne(_1,"StructArrayLayout2i4ub1f12");class rd extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,h){let p=this.length;return this.resize(p+1),this.emplace(p,e,o,c,h)}emplace(e,o,c,h,p){let m=4*e;return this.float32[m+0]=o,this.float32[m+1]=c,this.float32[m+2]=h,this.float32[m+3]=p,e}}rd.prototype.bytesPerElement=16,ne(rd,"StructArrayLayout4f16");class od extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c){let h=this.length;return this.resize(h+1),this.emplace(h,e,o,c)}emplace(e,o,c,h){let p=3*e;return this.float32[p+0]=o,this.float32[p+1]=c,this.float32[p+2]=h,e}}od.prototype.bytesPerElement=12,ne(od,"StructArrayLayout3f12");class ad extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p){let m=this.length;return this.resize(m+1),this.emplace(m,e,o,c,h,p)}emplace(e,o,c,h,p,m){let y=6*e,v=3*e;return this.uint16[y+0]=o,this.uint16[y+1]=c,this.uint16[y+2]=h,this.uint16[y+3]=p,this.float32[v+2]=m,e}}ad.prototype.bytesPerElement=12,ne(ad,"StructArrayLayout4ui1f12");class Ey extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,c,h){let p=this.length;return this.resize(p+1),this.emplace(p,e,o,c,h)}emplace(e,o,c,h,p){let m=4*e;return this.uint16[m+0]=o,this.uint16[m+1]=c,this.uint16[m+2]=h,this.uint16[m+3]=p,e}}Ey.prototype.bytesPerElement=8,ne(Ey,"StructArrayLayout4ui8");class Dy extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,o,c,h,p,m)}emplace(e,o,c,h,p,m,y){let v=6*e;return this.int16[v+0]=o,this.int16[v+1]=c,this.int16[v+2]=h,this.int16[v+3]=p,this.int16[v+4]=m,this.int16[v+5]=y,e}}Dy.prototype.bytesPerElement=12,ne(Dy,"StructArrayLayout6i12");class y1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p,m,y,v,C,T,E,D){let O=this.length;return this.resize(O+1),this.emplace(O,e,o,c,h,p,m,y,v,C,T,E,D)}emplace(e,o,c,h,p,m,y,v,C,T,E,D,O){let R=12*e;return this.int16[R+0]=o,this.int16[R+1]=c,this.int16[R+2]=h,this.int16[R+3]=p,this.uint16[R+4]=m,this.uint16[R+5]=y,this.uint16[R+6]=v,this.uint16[R+7]=C,this.int16[R+8]=T,this.int16[R+9]=E,this.int16[R+10]=D,this.int16[R+11]=O,e}}y1.prototype.bytesPerElement=24,ne(y1,"StructArrayLayout4i4ui4i24");class b1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,o,c,h,p,m)}emplace(e,o,c,h,p,m,y){let v=10*e,C=5*e;return this.int16[v+0]=o,this.int16[v+1]=c,this.int16[v+2]=h,this.float32[C+2]=p,this.float32[C+3]=m,this.float32[C+4]=y,e}}b1.prototype.bytesPerElement=20,ne(b1,"StructArrayLayout3i3f20");class v1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint32[1*e+0]=o,e}}v1.prototype.bytesPerElement=4,ne(v1,"StructArrayLayout1ul4");class Zh extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.float32[1*e+0]=o,e}}Zh.prototype.bytesPerElement=4,ne(Zh,"StructArrayLayout1f4");class sd extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,o)}emplace(e,o,c){let h=2*e;return this.uint16[h+0]=o,this.uint16[h+1]=c,e}}sd.prototype.bytesPerElement=4,ne(sd,"StructArrayLayout2ui4");class x1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p,m,y,v,C,T,E,D,O){let R=this.length;return this.resize(R+1),this.emplace(R,e,o,c,h,p,m,y,v,C,T,E,D,O)}emplace(e,o,c,h,p,m,y,v,C,T,E,D,O,R){let z=20*e,N=10*e;return this.int16[z+0]=o,this.int16[z+1]=c,this.int16[z+2]=h,this.int16[z+3]=p,this.int16[z+4]=m,this.float32[N+3]=y,this.float32[N+4]=v,this.float32[N+5]=C,this.float32[N+6]=T,this.int16[z+14]=E,this.uint32[N+8]=D,this.uint16[z+18]=O,this.uint16[z+19]=R,e}}x1.prototype.bytesPerElement=40,ne(x1,"StructArrayLayout5i4f1i1ul2ui40");class ky extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p,m,y){let v=this.length;return this.resize(v+1),this.emplace(v,e,o,c,h,p,m,y)}emplace(e,o,c,h,p,m,y,v){let C=8*e;return this.int16[C+0]=o,this.int16[C+1]=c,this.int16[C+2]=h,this.int16[C+4]=p,this.int16[C+5]=m,this.int16[C+6]=y,this.int16[C+7]=v,e}}ky.prototype.bytesPerElement=16,ne(ky,"StructArrayLayout3i2i2i16");class w1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p){let m=this.length;return this.resize(m+1),this.emplace(m,e,o,c,h,p)}emplace(e,o,c,h,p,m){let y=4*e,v=8*e;return this.float32[y+0]=o,this.float32[y+1]=c,this.float32[y+2]=h,this.int16[v+6]=p,this.int16[v+7]=m,e}}w1.prototype.bytesPerElement=16,ne(w1,"StructArrayLayout2f1f2i16");class C1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,h){let p=this.length;return this.resize(p+1),this.emplace(p,e,o,c,h)}emplace(e,o,c,h,p){let m=12*e,y=3*e;return this.uint8[m+0]=o,this.uint8[m+1]=c,this.float32[y+1]=h,this.float32[y+2]=p,e}}C1.prototype.bytesPerElement=12,ne(C1,"StructArrayLayout2ub2f12");class Ir extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,c){let h=this.length;return this.resize(h+1),this.emplace(h,e,o,c)}emplace(e,o,c,h){let p=3*e;return this.uint16[p+0]=o,this.uint16[p+1]=c,this.uint16[p+2]=h,e}}Ir.prototype.bytesPerElement=6,ne(Ir,"StructArrayLayout3ui6");class S1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p,m,y,v,C,T,E,D,O,R,z,N,W,ee,te,ie,pe){let he=this.length;return this.resize(he+1),this.emplace(he,e,o,c,h,p,m,y,v,C,T,E,D,O,R,z,N,W,ee,te,ie,pe)}emplace(e,o,c,h,p,m,y,v,C,T,E,D,O,R,z,N,W,ee,te,ie,pe,he){let ve=30*e,Ce=15*e,Ae=60*e;return this.int16[ve+0]=o,this.int16[ve+1]=c,this.int16[ve+2]=h,this.float32[Ce+2]=p,this.float32[Ce+3]=m,this.uint16[ve+8]=y,this.uint16[ve+9]=v,this.uint32[Ce+5]=C,this.uint32[Ce+6]=T,this.uint32[Ce+7]=E,this.uint16[ve+16]=D,this.uint16[ve+17]=O,this.uint16[ve+18]=R,this.float32[Ce+10]=z,this.float32[Ce+11]=N,this.uint8[Ae+48]=W,this.uint8[Ae+49]=ee,this.uint8[Ae+50]=te,this.uint32[Ce+13]=ie,this.int16[ve+28]=pe,this.uint8[Ae+58]=he,e}}S1.prototype.bytesPerElement=60,ne(S1,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class M1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p,m,y,v,C,T,E,D,O,R,z,N,W,ee,te,ie,pe,he,ve,Ce,Ae,je,Le,qe,ot,Ge,et,Ue,tt,lt){let nt=this.length;return this.resize(nt+1),this.emplace(nt,e,o,c,h,p,m,y,v,C,T,E,D,O,R,z,N,W,ee,te,ie,pe,he,ve,Ce,Ae,je,Le,qe,ot,Ge,et,Ue,tt,lt)}emplace(e,o,c,h,p,m,y,v,C,T,E,D,O,R,z,N,W,ee,te,ie,pe,he,ve,Ce,Ae,je,Le,qe,ot,Ge,et,Ue,tt,lt,nt){let Ct=22*e,at=44*e,ht=88*e;return this.float32[Ct+0]=o,this.float32[Ct+1]=c,this.int16[at+4]=h,this.int16[at+5]=p,this.int16[at+6]=m,this.int16[at+7]=y,this.int16[at+8]=v,this.int16[at+9]=C,this.int16[at+10]=T,this.int16[at+11]=E,this.int16[at+12]=D,this.uint16[at+13]=O,this.uint16[at+14]=R,this.uint16[at+15]=z,this.uint16[at+16]=N,this.uint16[at+17]=W,this.uint16[at+18]=ee,this.uint16[at+19]=te,this.uint16[at+20]=ie,this.uint16[at+21]=pe,this.uint16[at+22]=he,this.uint16[at+23]=ve,this.uint16[at+24]=Ce,this.uint16[at+25]=Ae,this.uint16[at+26]=je,this.uint16[at+27]=Le,this.uint32[Ct+14]=qe,this.float32[Ct+15]=ot,this.float32[Ct+16]=Ge,this.float32[Ct+17]=et,this.float32[Ct+18]=Ue,this.float32[Ct+19]=tt,this.float32[Ct+20]=lt,this.uint8[ht+84]=nt,e}}M1.prototype.bytesPerElement=88,ne(M1,"StructArrayLayout2f9i15ui1ul6f1ub88");class Xh extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p){let m=this.length;return this.resize(m+1),this.emplace(m,e,o,c,h,p)}emplace(e,o,c,h,p,m){let y=5*e;return this.float32[y+0]=o,this.float32[y+1]=c,this.float32[y+2]=h,this.float32[y+3]=p,this.float32[y+4]=m,e}}Xh.prototype.bytesPerElement=20,ne(Xh,"StructArrayLayout5f20");class T1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p,m,y){let v=this.length;return this.resize(v+1),this.emplace(v,e,o,c,h,p,m,y)}emplace(e,o,c,h,p,m,y,v){let C=7*e;return this.float32[C+0]=o,this.float32[C+1]=c,this.float32[C+2]=h,this.float32[C+3]=p,this.float32[C+4]=m,this.float32[C+5]=y,this.float32[C+6]=v,e}}T1.prototype.bytesPerElement=28,ne(T1,"StructArrayLayout7f28");class Op extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,o)}emplace(e,o,c){let h=2*e;return this.float32[h+0]=o,this.float32[h+1]=c,e}}Op.prototype.bytesPerElement=8,ne(Op,"StructArrayLayout2f8");class I1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,c,h){let p=this.length;return this.resize(p+1),this.emplace(p,e,o,c,h)}emplace(e,o,c,h,p){let m=6*e;return this.uint32[3*e+0]=o,this.uint16[m+2]=c,this.uint16[m+3]=h,this.uint16[m+4]=p,e}}I1.prototype.bytesPerElement=12,ne(I1,"StructArrayLayout1ul3ui12");class bg extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint16[1*e+0]=o,e}}bg.prototype.bytesPerElement=2,ne(bg,"StructArrayLayout1ui2");class E1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p,m,y,v,C,T,E,D,O,R,z,N){let W=this.length;return this.resize(W+1),this.emplace(W,e,o,c,h,p,m,y,v,C,T,E,D,O,R,z,N)}emplace(e,o,c,h,p,m,y,v,C,T,E,D,O,R,z,N,W){let ee=16*e;return this.float32[ee+0]=o,this.float32[ee+1]=c,this.float32[ee+2]=h,this.float32[ee+3]=p,this.float32[ee+4]=m,this.float32[ee+5]=y,this.float32[ee+6]=v,this.float32[ee+7]=C,this.float32[ee+8]=T,this.float32[ee+9]=E,this.float32[ee+10]=D,this.float32[ee+11]=O,this.float32[ee+12]=R,this.float32[ee+13]=z,this.float32[ee+14]=N,this.float32[ee+15]=W,e}}E1.prototype.bytesPerElement=64,ne(E1,"StructArrayLayout16f64");class Ay extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,h,p,m,y){let v=this.length;return this.resize(v+1),this.emplace(v,e,o,c,h,p,m,y)}emplace(e,o,c,h,p,m,y,v){let C=10*e,T=5*e;return this.uint16[C+0]=o,this.uint16[C+1]=c,this.uint16[C+2]=h,this.uint16[C+3]=p,this.float32[T+2]=m,this.float32[T+3]=y,this.float32[T+4]=v,e}}Ay.prototype.bytesPerElement=20,ne(Ay,"StructArrayLayout4ui3f20");class D1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.int16[1*e+0]=o,e}}D1.prototype.bytesPerElement=2,ne(D1,"StructArrayLayout1i2");class k1 extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint8[1*e+0]=o,e}}k1.prototype.bytesPerElement=1,ne(k1,"StructArrayLayout1ub1");class QM extends id{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}QM.prototype.size=40;class A1 extends x1{get(e){return new QM(this,e)}}ne(A1,"CollisionBoxArray");class JM extends id{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}JM.prototype.size=60;class eT extends S1{get(e){return new JM(this,e)}}ne(eT,"PlacedSymbolArray");class tT extends id{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}tT.prototype.size=88;class iT extends M1{get(e){return new tT(this,e)}}ne(iT,"SymbolInstanceArray");class nT extends Zh{getoffsetX(e){return this.float32[1*e+0]}}ne(nT,"GlyphOffsetArray");class rT extends ms{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ne(rT,"SymbolLineVertexArray");class oT extends id{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}oT.prototype.size=12;class aT extends I1{get(e){return new oT(this,e)}}ne(aT,"FeatureIndexArray");class sT extends sd{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ne(sT,"FillExtrusionCentroidArray");let WL=Ji([{name:"a_pos",components:2,type:"Int16"}],4),GL=Ji([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Rn{constructor(e=[]){this.segments=e}_prepareSegment(e,o,c,h){let p=this.segments[this.segments.length-1];return e>Rn.MAX_VERTEX_ARRAY_LENGTH&&Qn(`Max vertices per segment is ${Rn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Rn.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:o,primitiveOffset:c,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}prepareSegment(e,o,c,h){return this._prepareSegment(e,o.length,c.length,h)}get(){return this.segments}destroy(){for(let e of this.segments)for(let o in e.vaos)e.vaos[o].destroy()}static simpleSegment(e,o,c,h){return new Rn([{vertexOffset:e,primitiveOffset:o,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}function lT(i,e){return 256*(i=yi(Math.floor(i),0,255))+yi(Math.floor(e),0,255)}Rn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ne(Rn,"SegmentVector");let $L=Ji([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),qL=Ji([{name:"a_dash",components:4,type:"Uint16"}]);class vg{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,o,c,h){this.ids.push(cT(e)),this.positions.push(o,c,h)}eachPosition(e,o){let c=cT(e),h=0,p=this.ids.length-1;for(;h<p;){let m=h+p>>1;this.ids[m]>=c?p=m:h=m+1}for(;this.ids[h]===c;)o(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,o){let c=new Float64Array(e.ids),h=new Uint32Array(e.positions);return P1(c,h,0,c.length-1),o&&(o.add(c.buffer),o.add(h.buffer)),{ids:c,positions:h}}static deserialize(e){let o=new vg,c;o.ids=e.ids,o.positions=e.positions;for(let h of o.ids)h!==c&&o.uniqueIds.push(h),c=h;return o.indexed=!0,o}}function cT(i){let e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:jc(String(i))}function P1(i,e,o,c){for(;o<c;){let h=i[o+c>>1],p=o-1,m=c+1;for(;;){do p++;while(i[p]<h);do m--;while(i[m]>h);if(p>=m)break;Py(i,p,m),Py(e,3*p,3*m),Py(e,3*p+1,3*m+1),Py(e,3*p+2,3*m+2)}m-o<c-m?(P1(i,e,o,m),o=m+1):(P1(i,e,m+1,c),c=m)}}function Py(i,e,o){let c=i[e];i[e]=i[o],i[o]=c}ne(vg,"FeaturePositionMap");class Vl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,o),this.initialized=!0),!!this.location}set(e,o,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Oy extends Vl{constructor(e){super(e),this.current=0}set(e,o,c){this.fetchUniformLocation(e,o)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class ko extends Vl{constructor(e){super(e),this.current=0}set(e,o,c){this.fetchUniformLocation(e,o)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class jl extends Vl{constructor(e){super(e),this.current=[0,0]}set(e,o,c){this.fetchUniformLocation(e,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class O1 extends Vl{constructor(e){super(e),this.current=[0,0,0]}set(e,o,c){this.fetchUniformLocation(e,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class R1 extends Vl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,o,c){this.fetchUniformLocation(e,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class dT extends Vl{constructor(e){super(e),this.current=Wi.transparent.toRenderColor(null)}set(e,o,c){this.fetchUniformLocation(e,o)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}let YL=new Float32Array(16);class xg extends Vl{constructor(e){super(e),this.current=YL}set(e,o,c){if(this.fetchUniformLocation(e,o)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let h=1;h<16;h++)if(c[h]!==this.current[h]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}let ZL=new Float32Array(9),XL=new Float32Array(4);class F1 extends Vl{constructor(e){super(e),this.current=XL}set(e,o,c){if(this.fetchUniformLocation(e,o)){for(let h=0;h<4;h++)if(c[h]!==this.current[h]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function L1(i){return[lT(255*i.r,255*i.g),lT(255*i.b,255*i.a)]}class wg{constructor(e,o,c,h){this.value=e,this.uniformNames=o.map(p=>`u_${p}`),this.type=c,this.context=h}setUniform(e,o,c,h,p){let m=h.constantOr(this.value);o.set(e,p,m instanceof Wi?m.toRenderColor(this.context.lut):m)}getBinding(e,o){return this.type==="color"?new dT(e):new ko(e)}}class Rp{constructor(e,o){this.uniformNames=o.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,o,c,h,p){let m=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;m&&o.set(e,p,m)}getBinding(e,o){return o==="u_pattern"||o==="u_dash"?new R1(e):new ko(e)}}class Ul{constructor(e,o,c,h){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=o.map(p=>({name:`a_${p}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,o,c,h,p,m,y){let v=this.paintVertexArray.length,C=this.expression.evaluate(new ti(0,{brightness:m}),o,{},p,h,y);this.paintVertexArray.resize(e),this._setPaintValue(v,e,C,this.context)}updatePaintArray(e,o,c,h,p,m,y){let v=this.expression.evaluate({zoom:0,brightness:y},c,h,void 0,p);this._setPaintValue(e,o,v,this.context)}_setPaintValue(e,o,c,h){if(this.type==="color"){let p=L1(c.toRenderColor(h.lut));for(let m=e;m<o;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=e;p<o;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fs{constructor(e,o,c,h,p,m){this.expression=e,this.uniformNames=o.map(y=>`u_${y}_t`),this.type=c,this.useIntegerZoom=h,this.context=p,this.maxValue=0,this.paintVertexAttributes=o.map(y=>({name:`a_${y}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,o,c,h,p,m,y){let v=this.expression.evaluate(new ti(this.context.zoom,{brightness:m}),o,{},p,h,y),C=this.expression.evaluate(new ti(this.context.zoom+1,{brightness:m}),o,{},p,h,y),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,v,C,this.context)}updatePaintArray(e,o,c,h,p,m,y){let v=this.expression.evaluate({zoom:this.context.zoom,brightness:y},c,h,void 0,p),C=this.expression.evaluate({zoom:this.context.zoom+1,brightness:y},c,h,void 0,p);this._setPaintValue(e,o,v,C,this.context)}_setPaintValue(e,o,c,h,p){if(this.type==="color"){let m=L1(c.toRenderColor(p.lut)),y=L1(c.toRenderColor(p.lut));for(let v=e;v<o;v++)this.paintVertexArray.emplace(v,m[0],m[1],y[0],y[1])}else{for(let m=e;m<o;m++)this.paintVertexArray.emplace(m,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,o,c,h,p){let m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,y=yi(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);o.set(e,p,y)}getBinding(e,o){return new ko(e)}}class ld{constructor(e,o,c,h,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(c==="array"?qL:$L).members;for(let m=0;m<o.length;++m);this.paintVertexArray=new h}populatePaintArray(e,o,c,h){let p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,o.patterns&&o.patterns[this.layerId],c)}updatePaintArray(e,o,c,h,p,m,y){this._setPaintValues(e,o,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(e,o,c,h){if(!h||!c)return;let p=h[c];if(!p)return;let{tl:m,br:y,pixelRatio:v}=p;for(let C=e;C<o;C++)this.paintVertexArray.emplace(C,m[0],m[1],y[0],y[1],v)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Kh{constructor(e,o,c=()=>!0){this.binders={},this._buffers=[],this.context=o;let h=[];for(let p in e.paint._values){let m=e.paint.get(p);if(!c(p)||!(m instanceof Mn&&kp(m.property.specification)))continue;let y=QL(p,e.type),v=m.value,C=m.property.specification.type,T=!!m.property.useIntegerZoom,E=p==="line-dasharray"||p.endsWith("pattern"),D=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||D)if(v.kind==="source"||D||E){let O=hT(p,C,"source");this.binders[p]=E?new ld(v,y,C,O,e.id):new Ul(v,y,C,O),h.push(`/a_${p}`)}else{let O=hT(p,C,"composite");this.binders[p]=new fs(v,y,C,T,o,O),h.push(`/z_${p}`)}else this.binders[p]=E?new Rp(v.value,y):new wg(v.value,y,C,o),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){let o=this.binders[e];return o instanceof Ul||o instanceof fs?o.maxValue:0}populatePaintArrays(e,o,c,h,p,m,y){for(let v in this.binders){let C=this.binders[v];C.context=this.context,(C instanceof Ul||C instanceof fs||C instanceof ld)&&C.populatePaintArray(e,o,c,h,p,m,y)}}setConstantPatternPositions(e){for(let o in this.binders){let c=this.binders[o];c instanceof Rp&&c.setConstantPatternPositions(e)}}updatePaintArrays(e,o,c,h,p,m,y,v){let C=!1,T=Object.keys(e),E=T.length!==0,D=E?T:o.uniqueIds;this.context.lut=p.lut;for(let O in this.binders){let R=this.binders[O];if(R.context=this.context,(R instanceof Ul||R instanceof fs||R instanceof ld)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){let z=p.paint.get(O);R.expression=z.value;for(let N of D){let W=e[N.toString()];o.eachPosition(N,(ee,te,ie)=>{let pe=h.feature(ee);R.updatePaintArray(te,ie,pe,W,m,y,v)})}if(!E)for(let N of c.uniqueIds){let W=e[N.toString()];c.eachPosition(N,(ee,te,ie)=>{let pe=h.feature(ee);R.updatePaintArray(te,ie,pe,W,m,y,v)})}C=!0}}return C}defines(){let e=[];for(let o in this.binders){let c=this.binders[o];(c instanceof wg||c instanceof Rp)&&e.push(...c.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){let e=[];for(let o in this.binders){let c=this.binders[o];if(c instanceof Ul||c instanceof fs||c instanceof ld)for(let h=0;h<c.paintVertexAttributes.length;h++)e.push(c.paintVertexAttributes[h].name)}return e}getBinderUniforms(){let e=[];for(let o in this.binders){let c=this.binders[o];if(c instanceof wg||c instanceof Rp||c instanceof fs)for(let h of c.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let o=[];for(let c in this.binders){let h=this.binders[c];if(h instanceof wg||h instanceof Rp||h instanceof fs)for(let p of h.uniformNames)o.push({name:p,property:c,binding:h.getBinding(e,p)})}return o}setUniforms(e,o,c,h,p){for(let{name:m,property:y,binding:v}of c)this.binders[y].setUniform(e,v,p,h.get(y),m)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let o=this.binders[e];(o instanceof Ul||o instanceof fs||o instanceof ld)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(let o in this.binders){let c=this.binders[o];(c instanceof Ul||c instanceof fs||c instanceof ld)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let o=this.binders[e];(o instanceof Ul||o instanceof fs||o instanceof ld)&&o.destroy()}}}class cd{constructor(e,o,c=()=>!0){this.programConfigurations={};for(let h of e)this.programConfigurations[h.id]=new Kh(h,o,c);this.needsUpload=!1,this._featureMap=new vg,this._featureMapWithoutIds=new vg,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,o,c,h,p,m,y,v){for(let C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(e,o,h,p,m,y,v);o.id!==void 0?this._featureMap.add(o.id,c,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,o,c,h,p,m){for(let y of c)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,o,y,h,p,m||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let o in this.programConfigurations)this.programConfigurations[o].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let KL={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function QL(i,e){return KL[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}let JL={"line-pattern":{source:ad,composite:ad},"fill-pattern":{source:ad,composite:ad},"fill-extrusion-pattern":{source:ad,composite:ad},"line-dasharray":{source:Ey,composite:Ey}},e3={color:{source:Op,composite:rd},number:{source:Zh,composite:Op}};function hT(i,e,o){let c=JL[i];return c&&c[o]||e3[e][o]}ne(wg,"ConstantBinder"),ne(Rp,"PatternConstantBinder"),ne(Ul,"SourceExpressionBinder"),ne(ld,"PatternCompositeBinder"),ne(fs,"CompositeExpressionBinder"),ne(Kh,"ProgramConfiguration",{omit:["_buffers"]}),ne(cd,"ProgramConfigurationSet");let Ao=pt/Math.PI/2,z1=5,uT=6,t3=16383,Fp=64,B1=[Fp,32,16],$a=-Ao,qa=Ao;function Lp(i,e,o,c=Ao){return o=Li(o),[i*Math.sin(o)*c,-e*c,i*Math.cos(o)*c]}function Qh(i,e,o){return Lp(Math.cos(Li(i)),Math.sin(Li(i)),e,o)}let zp=63710088e-1,N1=2*Math.PI*zp;class Hi{constructor(e,o){if(isNaN(e)||isNaN(o))throw new Error(`Invalid LngLat object: (${e}, ${o})`);if(this.lng=+e,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Hi(Sl(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let o=Math.PI/180,c=this.lat*o,h=e.lat*o,p=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((e.lng-this.lng)*o);return zp*Math.acos(Math.min(p,1))}toBounds(e=0){let o=360*e/40075017,c=o/Math.cos(Math.PI/180*this.lat);return new dd({lng:this.lng-c,lat:this.lat-o},{lng:this.lng+c,lat:this.lat+o})}toEcef(e){return Qh(this.lat,this.lng,Ao+e*Ao/zp)}static convert(e){if(e instanceof Hi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Hi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Hi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class dd{constructor(e,o){if(e)if(o)this.setSouthWest(e).setNorthEast(o);else if(e.length===4){let c=e;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{let c=e;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(e){return this._ne=e instanceof Hi?new Hi(e.lng,e.lat):Hi.convert(e),this}setSouthWest(e){return this._sw=e instanceof Hi?new Hi(e.lng,e.lat):Hi.convert(e),this}extend(e){let o=this._sw,c=this._ne,h,p;if(e instanceof Hi)h=e,p=e;else{if(!(e instanceof dd))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(dd.convert(e)):this.extend(Hi.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Hi.convert(e)):this;if(h=e._sw,p=e._ne,!h||!p)return this}return o||c?(o.lng=Math.min(h.lng,o.lng),o.lat=Math.min(h.lat,o.lat),c.lng=Math.max(p.lng,c.lng),c.lat=Math.max(p.lat,c.lat)):(this._sw=new Hi(h.lng,h.lat),this._ne=new Hi(p.lng,p.lat)),this}getCenter(){return new Hi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Hi(this.getWest(),this.getNorth())}getSouthEast(){return new Hi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:o,lat:c}=Hi.convert(e),h=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&h}static convert(e){return!e||e instanceof dd?e:new dd(e)}}var pT={};(function(i,e){(function(o){function c(p,m,y){var v=h(256*p,256*(m=Math.pow(2,y)-m-1),y),C=h(256*(p+1),256*(m+1),y);return v[0]+","+v[1]+","+C[0]+","+C[1]}function h(p,m,y){var v=2*Math.PI*6378137/256/Math.pow(2,y);return[p*v-2*Math.PI*6378137/2,m*v-2*Math.PI*6378137/2]}o.getURL=function(p,m,y,v,C,T){return T=T||{},p+"?"+["bbox="+c(y,v,C),"format="+(T.format||"image/png"),"service="+(T.service||"WMS"),"version="+(T.version||"1.1.1"),"request="+(T.request||"GetMap"),"srs="+(T.srs||"EPSG:3857"),"width="+(T.width||256),"height="+(T.height||256),"layers="+m].join("&")},o.getTileBBox=c,o.getMercCoords=h,Object.defineProperty(o,"__esModule",{value:!0})})(e)})(0,pT);var i3=pT;class Jh{constructor(e,o,c){this.z=e,this.x=o,this.y=c,this.key=Cg(0,e,e,o,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,o){let c=i3.getTileBBox(this.x,this.y,this.z),h=function(p,m,y){let v,C="";for(let T=p;T>0;T--)v=1<<T-1,C+=(m&v?1:0)+(y&v?2:0);return C}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class mT{constructor(e,o){this.wrap=e,this.canonical=o,this.key=Cg(e,o.z,o.z,o.x,o.y)}}class mr{constructor(e,o,c,h,p){this.overscaledZ=e,this.wrap=o,this.canonical=new Jh(c,+h,+p),this.key=o===0&&e===c?this.canonical.key:Cg(o,e,c,h,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let o=this.canonical.z-e;return e>this.canonical.z?new mr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new mr(e,this.wrap,e,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(e,o=!0){if(this.overscaledZ===e&&o)return this.key;if(e>this.canonical.z)return Cg(this.wrap*+o,e,this.canonical.z,this.canonical.x,this.canonical.y);{let c=this.canonical.z-e;return Cg(this.wrap*+o,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let o=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>o&&e.canonical.y===this.canonical.y>>o}children(e){if(this.overscaledZ>=e)return[new mr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let o=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new mr(o,this.wrap,o,c,h),new mr(o,this.wrap,o,c+1,h),new mr(o,this.wrap,o,c,h+1),new mr(o,this.wrap,o,c+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new mr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new mr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new mT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Cg(i,e,o,c,h){let p=1<<Math.min(o,22),m=p*(h%p)+c%p;return i&&o<22&&(m+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-o)))),16*(32*m+o)+(e-o)}let n3=[i=>{let e=i.canonical.x-1,o=i.wrap;return e<0&&(e=(1<<i.canonical.z)-1,o--),new mr(i.overscaledZ,o,i.canonical.z,e,i.canonical.y)},i=>{let e=i.canonical.x+1,o=i.wrap;return e===1<<i.canonical.z&&(e=0,o++),new mr(i.overscaledZ,o,i.canonical.z,e,i.canonical.y)},i=>new mr(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,(i.canonical.y===0?1<<i.canonical.z:i.canonical.y)-1),i=>new mr(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y===(1<<i.canonical.z)-1?0:i.canonical.y+1)];ne(Jh,"CanonicalTileID"),ne(mr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let r3=0,o3=25.5;function V1(i){return N1*Math.cos(i*Math.PI/180)}function Ys(i){return(180+i)/360}function Zs(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Po(i,e){return i/V1(e)}function Wo(i){return 360*i-180}function zr(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function fT(i,e){return i*V1(zr(e))}let er=85.051129;function gT(i){return Math.cos(Li(yi(i,-er,er)))}function eu(i,e){let o=yi(e,r3,o3),c=Math.pow(2,o);return gT(i)*N1/(512*c)}function _T(i){return 1/Math.cos(i*Math.PI/180)}function Ry(i,e=0){let o=Math.exp(Math.PI*(1-(i.y+e/pt)/(1<<i.z)*2));return 80150034*o/(o*o+1)/pt/(1<<i.z)}class no{constructor(e,o,c=0){this.x=+e,this.y=+o,this.z=+c}static fromLngLat(e,o=0){let c=Hi.convert(e);return new no(Ys(c.lng),Zs(c.lat),Po(o,c.lat))}toLngLat(){return new Hi(Wo(this.x),zr(this.y))}toAltitude(){return fT(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/N1*_T(zr(this.y))}}function j1(i,e,o,c,h,p,m,y,v){let C=(e+c)/2,T=(o+h)/2,E=new vt(C,T);y(E),function(D,O,R,z,N,W){let ee=R-N,te=z-W;return Math.abs((z-O)*ee-(R-D)*te)/Math.hypot(ee,te)}(E.x,E.y,p.x,p.y,m.x,m.y)>=v?(j1(i,e,o,C,T,p,E,y,v),j1(i,C,T,c,h,E,m,y,v)):i.push(m)}function yT(i,e,o){let c=i[0],h=c.x,p=c.y;e(c);let m=[c];for(let y=1;y<i.length;y++){let v=i[y],{x:C,y:T}=v;e(v),j1(m,h,p,C,T,c,v,e,o),h=C,p=T,c=v}return m}function U1(i,e,o,c){if(c(e,o)){let h=e.add(o)._mult(.5);U1(i,e,h,c),U1(i,h,o,c)}else i.push(o)}function a3(i,e){let o=i[0],c=[o];for(let h=1;h<i.length;h++){let p=i[h];U1(c,o,p,e),o=p}return c}let H1=Math.pow(2,14)-1,bT=-H1-1;function s3(i,e){let o=Math.round(i.x*e),c=Math.round(i.y*e);return i.x=yi(o,bT,H1),i.y=yi(c,bT,H1),(o<i.x||o>i.x+1||c<i.y||c>i.y+1)&&Qn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function gs(i,e,o){let c=i.loadGeometry(),h=i.extent,p=pt/h;if(e&&o&&o.projection.isReprojectedInTileSpace){let m=1<<e.z,{scale:y,x:v,y:C,projection:T}=o,E=D=>{let O=Wo((e.x+D.x/h)/m),R=zr((e.y+D.y/h)/m),z=T.project(O,R);D.x=(z.x*y-v)*h,D.y=(z.y*y-C)*h};for(let D=0;D<c.length;D++)if(i.type!==1)c[D]=yT(c[D],E,1);else{let O=[];for(let R of c[D])R.x<0||R.x>=h||R.y<0||R.y>=h||(E(R),O.push(R));c[D]=O}}for(let m of c)for(let y of m)s3(y,p);return c}function Hl(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?gs(i):[]}}function Fy(i,e,o,c,h){i.emplaceBack(2*e+(c+1)/2,2*o+(h+1)/2)}function Ly(i,e,o){i.emplaceBack(e.x,e.y,e.z,o[0]*16384,o[1]*16384,o[2]*16384)}class W1{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ms,this.indexArray=new Ir,this.segments=new Rn,this.programConfigurations=new cd(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}updateFootprints(e,o){}populate(e,o,c,h){let p=this.layers[0],m=[],y=null;p.type==="circle"&&(y=p.layout.get("circle-sort-key"));for(let{feature:C,id:T,index:E,sourceLayerIndex:D}of e){let O=this.layers[0]._featureFilter.needGeometry,R=Hl(C,O);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),R,c))continue;let z=y?y.evaluate(R,{},c):void 0,N={id:T,properties:C.properties,type:C.type,sourceLayerIndex:D,index:E,geometry:O?R.geometry:gs(C,c,h),patterns:{},sortKey:z};m.push(N)}y&&m.sort((C,T)=>C.sortKey-T.sortKey);let v=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Dy,v=h.projection);for(let C of m){let{geometry:T,index:E,sourceLayerIndex:D}=C,O=e[E].feature;this.addFeature(C,T,E,o.availableImages,c,v,o.brightness),o.featureIndex.insert(O,T,E,D,this.index)}}update(e,o,c,h,p){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,o,m?this.stateDependentLayers:this.layers,c,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,WL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,GL.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,o,c,h,p,m,y){for(let v of o)for(let C of v){let T=C.x,E=C.y;if(T<0||T>=pt||E<0||E>=pt)continue;if(m){let R=m.projectTilePoint(T,E,p),z=m.upVector(p,T,E),N=this.globeExtVertexArray;Ly(N,R,z),Ly(N,R,z),Ly(N,R,z),Ly(N,R,z)}let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),O=D.vertexLength;Fy(this.layoutVertexArray,T,E,-1,-1),Fy(this.layoutVertexArray,T,E,1,-1),Fy(this.layoutVertexArray,T,E,1,1),Fy(this.layoutVertexArray,T,E,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},h,p,y)}}function G1(i,e){for(let o=0;o<i.length;o++)if(hd(e,i[o]))return!0;for(let o=0;o<e.length;o++)if(hd(i,e[o]))return!0;return!!$1(i,e)}function l3(i,e,o){return!!hd(i,e)||!!q1(e,i,o)}function vT(i,e){if(i.length===1)return wT(e,i[0]);for(let o=0;o<e.length;o++){let c=e[o];for(let h=0;h<c.length;h++)if(hd(i,c[h]))return!0}for(let o=0;o<i.length;o++)if(wT(e,i[o]))return!0;for(let o=0;o<e.length;o++)if($1(i,e[o]))return!0;return!1}function c3(i,e,o){if(i.length>1){if($1(i,e))return!0;for(let c=0;c<e.length;c++)if(q1(e[c],i,o))return!0}for(let c=0;c<i.length;c++)if(q1(i[c],e,o))return!0;return!1}function $1(i,e){if(i.length===0||e.length===0)return!1;for(let o=0;o<i.length-1;o++){let c=i[o],h=i[o+1];for(let p=0;p<e.length-1;p++)if(d3(c,h,e[p],e[p+1]))return!0}return!1}function d3(i,e,o,c){return ja(i,o,c)!==ja(e,o,c)&&ja(i,e,o)!==ja(i,e,c)}function q1(i,e,o){let c=o*o;if(e.length===1)return i.distSqr(e[0])<c;for(let h=1;h<e.length;h++)if(xT(i,e[h-1],e[h])<c)return!0;return!1}function xT(i,e,o){let c=e.distSqr(o);if(c===0)return i.distSqr(e);let h=((i.x-e.x)*(o.x-e.x)+(i.y-e.y)*(o.y-e.y))/c;return i.distSqr(h<0?e:h>1?o:o.sub(e)._mult(h)._add(e))}function wT(i,e){let o,c,h,p=!1;for(let m=0;m<i.length;m++){o=i[m];for(let y=0,v=o.length-1;y<o.length;v=y++)c=o[y],h=o[v],c.y>e.y!=h.y>e.y&&e.x<(h.x-c.x)*(e.y-c.y)/(h.y-c.y)+c.x&&(p=!p)}return p}function hd(i,e){let o=!1;for(let c=0,h=i.length-1;c<i.length;h=c++){let p=i[c],m=i[h];p.y>e.y!=m.y>e.y&&e.x<(m.x-p.x)*(e.y-p.y)/(m.y-p.y)+p.x&&(o=!o)}return o}function CT(i,e,o,c,h){for(let m of i)if(e<=m.x&&o<=m.y&&c>=m.x&&h>=m.y)return!0;let p=[new vt(e,o),new vt(e,h),new vt(c,h),new vt(c,o)];if(i.length>2){for(let m of p)if(hd(i,m))return!0}for(let m=0;m<i.length-1;m++)if(h3(i[m],i[m+1],p))return!0;return!1}function h3(i,e,o){let c=o[0],h=o[2];if(i.x<c.x&&e.x<c.x||i.x>h.x&&e.x>h.x||i.y<c.y&&e.y<c.y||i.y>h.y&&e.y>h.y)return!1;let p=ja(i,e,o[0]);return p!==ja(i,e,o[1])||p!==ja(i,e,o[2])||p!==ja(i,e,o[3])}function Bp(i,e,o,c,h,p){let m=e.y-i.y,y=i.x-e.x;if(p=p||0){let v=m*m+y*y;if(v===0)return!0;let C=Math.sqrt(v);m/=C,y/=C}return!((o.x-i.x)*m+(o.y-i.y)*y-p<0||(c.x-i.x)*m+(c.y-i.y)*y-p<0||(h.x-i.x)*m+(h.y-i.y)*y-p<0)}function Y1(i,e,o,c,h,p,m){return!(Bp(i,e,c,h,p,m)||Bp(e,o,c,h,p,m)||Bp(o,i,c,h,p,m)||Bp(c,h,i,e,o,m)||Bp(h,p,i,e,o,m)||Bp(p,c,i,e,o,m))}function Np(i,e,o){let c=e.paint.get(i).value;return c.kind==="constant"?c.value:o.programConfigurations.get(e.id).getMaxValue(i)}function zy(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function ST(i,e,o,c,h){if(!e[0]&&!e[1])return i;let p=vt.convert(e)._mult(h);o==="viewport"&&p._rotate(-c);let m=[];for(let y=0;y<i.length;y++)m.push(i[y].sub(p));return m}function MT(i,e,o,c){let h=vt.convert(i)._mult(c);return e==="viewport"&&h._rotate(-o),h}ne(W1,"CircleBucket",{omit:["layers"]});let u3=new Qi({"circle-sort-key":new wt(Pe.layout_circle["circle-sort-key"]),visibility:new Qe(Pe.layout_circle.visibility)});var p3={paint:new Qi({"circle-radius":new wt(Pe.paint_circle["circle-radius"]),"circle-color":new wt(Pe.paint_circle["circle-color"]),"circle-blur":new wt(Pe.paint_circle["circle-blur"]),"circle-opacity":new wt(Pe.paint_circle["circle-opacity"]),"circle-translate":new Qe(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Qe(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qe(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qe(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wt(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wt(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wt(Pe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Qe(Pe.paint_circle["circle-emissive-strength"])}),layout:u3};class Z1{constructor(e,o){this.pos=e,this.dir=o}intersectsPlane(e,o,c){let h=t._.dot(o,this.dir);if(Math.abs(h)<1e-6)return!1;let p=((e[0]-this.pos[0])*o[0]+(e[1]-this.pos[1])*o[1]+(e[2]-this.pos[2])*o[2])/h;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,c[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,o,c){if(t._.equals(this.pos,e)||o===0)return c[0]=c[1]=c[2]=0,!1;let[h,p,m]=this.dir,y=this.pos[0]-e[0],v=this.pos[1]-e[1],C=this.pos[2]-e[2],T=h*h+p*p+m*m,E=2*(y*h+v*p+C*m),D=E*E-4*T*(y*y+v*v+C*C-o*o);if(D<0){let O=Math.max(-E/2,0),R=y+h*O,z=v+p*O,N=C+m*O,W=Math.hypot(R,z,N);return c[0]=R*o/W,c[1]=z*o/W,c[2]=N*o/W,!1}{let O=(-E-Math.sqrt(D))/(2*T);if(O<0){let R=Math.hypot(y,v,C);return c[0]=y*o/R,c[1]=v*o/R,c[2]=C*o/R,!1}return c[0]=y+h*O,c[1]=v+p*O,c[2]=C+m*O,!0}}}class X1{constructor(e,o,c,h,p){this.TL=e,this.TR=o,this.BR=c,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(e,o,c){let h=[-1,1,1],p=[1,1,1],m=[1,-1,1],y=[-1,-1,1],v=t._.transformMat4(h,h,e),C=t._.transformMat4(p,p,e),T=t._.transformMat4(m,m,e),E=t._.transformMat4(y,y,e);return new X1(v,C,T,E,o/c)}}function Sg(i,e,o){let c=1/0,h=-1/0,p=[];for(let m of i){t._.sub(p,m,e);let y=t._.dot(p,o);c=Math.min(c,y),h=Math.max(h,y)}return[c,h]}function TT(i,e){let o=!0;for(let c=0;c<i.planes.length;c++){let h=i.planes[c],p=0;for(let m=0;m<e.length;m++)p+=t._.dot(h,e[m])+h[3]>=0;if(p===0)return 0;p!==e.length&&(o=!1)}return o?2:1}function IT(i,e){for(let o of i.projections){let c=Sg(e,i.points[0],o.axis);if(o.projection[1]<c[0]||o.projection[0]>c[1])return 0}return 1}function ET(i,e){let o=0,c=[0,0,0,0];for(let h=0;h<i.length;h++)c[0]=i[h][0],c[1]=i[h][1],c[2]=i[h][2],c[3]=1,t.aA.dot(c,e)>=0&&o++;return o}class K1{constructor(e,o){this.points=e||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=Fn.fromPoints(this.points),this.projections=[],this.frustumEdges=[t._.sub([],this.points[2],this.points[3]),t._.sub([],this.points[0],this.points[3]),t._.sub([],this.points[4],this.points[0]),t._.sub([],this.points[5],this.points[1]),t._.sub([],this.points[6],this.points[2]),t._.sub([],this.points[7],this.points[3])];for(let c of this.frustumEdges){let h=[0,-c[2],c[1]],p=[c[2],0,-c[0]];this.projections.push({axis:h,projection:Sg(this.points,this.points[0],h)}),this.projections.push({axis:p,projection:Sg(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,o,c,h){let p=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{let T=t.aA.transformMat4([],C,e),E=1/T[3]/o*p;return t.aA.mul(T,T,[E,E,h?1/T[3]:E,E])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{let T=t._.sub([],m[C[0]],m[C[1]]),E=t._.sub([],m[C[2]],m[C[1]]),D=t._.normalize([],t._.cross([],T,E)),O=-t._.dot(D,m[C[1]]);return D.concat(O)}),v=[];for(let C=0;C<m.length;C++)v.push([m[C][0],m[C][1],m[C][2]]);return new K1(v,y)}intersectsPrecise(e,o,c){for(let h=0;h<o.length;h++)if(!ET(e,o[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!ET(e,this.planes[h]))return 0;for(let h of c)for(let p of this.frustumEdges){let m=t._.cross([],h,p),y=t._.length(m);if(y===0)continue;t._.scale(m,m,1/y);let v=Sg(this.points,this.points[0],m),C=Sg(e,this.points[0],m);if(v[0]>C[1]||C[0]>v[1])return 0}return 1}}class Fn{static fromPoints(e){let o=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(let h of e)t._.min(o,o,h),t._.max(c,c,h);return new Fn(o,c)}static fromTileIdAndHeight(e,o,c){let h=1<<e.canonical.z,p=e.canonical.x,m=e.canonical.y;return new Fn([p/h,m/h,o],[(p+1)/h,(m+1)/h,c])}static applyTransform(e,o){let c=e.getCorners();for(let h=0;h<c.length;++h)t._.transformMat4(c[h],c[h],o);return Fn.fromPoints(c)}static projectAabbCorners(e,o){let c=e.getCorners();for(let h=0;h<c.length;++h)t._.transformMat4(c[h],c[h],o);return c}constructor(e,o){this.min=e,this.max=o,this.center=t._.scale([],t._.add([],this.min,this.max),.5)}quadrant(e){let o=[e%2==0,e<2],c=t._.clone(this.min),h=t._.clone(this.max);for(let p=0;p<o.length;p++)c[p]=o[p]?this.min[p]:this.center[p],h[p]=o[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new Fn(c,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,o=this.max;return[[e[0],e[1],e[2]],[o[0],e[1],e[2]],[o[0],o[1],e[2]],[e[0],o[1],e[2]],[e[0],e[1],o[2]],[o[0],e[1],o[2]],[o[0],o[1],o[2]],[e[0],o[1],o[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?TT(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?TT(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,o){return o||this.intersects(e)?IT(e,this.getCorners()):0}intersectsPreciseFlat(e,o){return o||this.intersectsFlat(e)?IT(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let o=0;o<3;++o)if(this.min[o]>e.max[o]||e.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],e.min[o]),this.max[o]=Math.max(this.max[o],e.max[o])}encapsulatePoint(e){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],e[o]),this.max[o]=Math.max(this.max[o],e[o])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ne(Fn,"Aabb");let m3=Ji([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:By}=m3,DT=Ji([{name:"a_pos_3",components:3,type:"Int16"}]);var Mg=Ji([{name:"a_pos",type:"Int16",components:2}]);function Ny(i){return i*Ao/zp}let f3=[new Fn([$a,$a,$a],[qa,qa,qa]),new Fn([$a,$a,$a],[0,0,qa]),new Fn([0,$a,$a],[qa,0,qa]),new Fn([$a,0,$a],[0,qa,qa]),new Fn([0,0,$a],[qa,qa,qa])];function kT(i,e,o,c=!0){let h=t._.scale([],i._camera.position,i.worldSize),p=[e,o,1,1];t.aA.transformMat4(p,p,i.pixelMatrixInverse),t.aA.scale(p,p,1/p[3]);let m=t._.sub([],p,h),y=t._.normalize([],m),v=i.globeMatrix,C=[v[12],v[13],v[14]],T=t._.sub([],C,h),E=t._.length(T),D=t._.normalize([],T),O=i.worldSize/(2*Math.PI),R=t._.dot(D,y),z=Math.asin(O/E);if(z<Math.acos(R)){if(!c)return null;let Le=[],qe=[];t._.scale(Le,y,E/R),t._.normalize(qe,t._.sub(qe,Le,T)),t._.normalize(y,t._.add(y,T,t._.scale(y,qe,Math.tan(z)*E)))}let N=[];new Z1(h,y).closestPointOnSphere(C,O,N);let W=t._.normalize([],bh(v,0)),ee=t._.normalize([],bh(v,1)),te=t._.normalize([],bh(v,2)),ie=t._.dot(W,N),pe=t._.dot(ee,N),he=t._.dot(te,N),ve=Yr(Math.asin(-pe/O)),Ce=Yr(Math.atan2(ie,he));Ce=i.center.lng+function(Le,qe){let ot=(qe-Le+180)%360-180;return ot<-180?ot+360:ot}(i.center.lng,Ce);let Ae=Ys(Ce),je=yi(Zs(ve),0,1);return new no(Ae,je)}class g3{constructor(e,o,c){this.a=t._.sub([],e,c),this.b=t._.sub([],o,c),this.center=c;let h=t._.normalize([],this.a),p=t._.normalize([],this.b);this.angle=Math.acos(t._.dot(h,p))}}function Q1(i,e){if(i.angle===0)return null;let o;return o=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),o<0||o>1?null:function(c,h,p,m){let y=Math.sin(p);return c*(Math.sin((1-m)*p)/y)+h*(Math.sin(m*p)/y)}(i.a[e],i.b[e],i.angle,yi(o,0,1))+i.center[e]}function Xs(i){if(i.z<=1)return f3[i.z+2*i.y+i.x];let e=J1(Vy(i));return Fn.fromPoints(e)}function Wl(i,e,o){return t._.scale(i,i,1-o),t._.scaleAndAdd(i,i,e,o)}function AT(i,e){let o=Gl(e.zoom);if(o===0)return Xs(i);let c=Vy(i),h=J1(c),p=Ys(c.getWest())*e.worldSize,m=Ys(c.getEast())*e.worldSize,y=Zs(c.getNorth())*e.worldSize,v=Zs(c.getSouth())*e.worldSize,C=[p,y,0],T=[m,y,0],E=[p,v,0],D=[m,v,0],O=t.ad.invert([],e.globeMatrix);return t._.transformMat4(C,C,O),t._.transformMat4(T,T,O),t._.transformMat4(E,E,O),t._.transformMat4(D,D,O),h[0]=Wl(h[0],E,o),h[1]=Wl(h[1],D,o),h[2]=Wl(h[2],T,o),h[3]=Wl(h[3],C,o),Fn.fromPoints(h)}function PT(i,e,o){for(let c of i)t._.transformMat4(c,c,e),t._.scale(c,c,o)}function OT(i,e,o,c){let h=e/i.worldSize,p=i.globeMatrix;if(o.z<=1){let Ae=Xs(o).getCorners();return PT(Ae,p,h),Fn.fromPoints(Ae)}let m=Vy(o,c),y=J1(m,Ao+Ny(i._tileCoverLift));PT(y,p,h);let v=Number.MAX_VALUE,C=[-v,-v,-v],T=[v,v,v];if(m.contains(i.center)){for(let Le of y)t._.min(T,T,Le),t._.max(C,C,Le);C[2]=0;let Ae=i.point,je=[Ae.x*h,Ae.y*h,0];return t._.min(T,T,je),t._.max(C,C,je),new Fn(T,C)}if(i._tileCoverLift>0){for(let Ae of y)t._.min(T,T,Ae),t._.max(C,C,Ae);return new Fn(T,C)}let E=[p[12]*h,p[13]*h,p[14]*h],D=m.getCenter(),O=yi(i.center.lat,-er,er),R=yi(D.lat,-er,er),z=Ys(i.center.lng),N=Zs(O),W=z-Ys(D.lng),ee=N-Zs(R);W>.5?W-=1:W<-.5&&(W+=1);let te=0;if(Math.abs(W)>Math.abs(ee))te=W>=0?1:3;else{te=ee>=0?0:2;let Ae=[p[4]*h,p[5]*h,p[6]*h],je=-Math.sin(Li(ee>=0?m.getSouth():m.getNorth()))*Ao;t._.scaleAndAdd(E,E,Ae,je)}let ie=y[te],pe=y[(te+1)%4],he=new g3(ie,pe,E),ve=[Q1(he,0)||ie[0],Q1(he,1)||ie[1],Q1(he,2)||ie[2]],Ce=Gl(i.zoom);if(Ce>0){let Ae=function({x:Le,y:qe,z:ot},Ge,et,Ue,tt){let lt=1/(1<<ot),nt=Le*lt,Ct=nt+lt,at=qe*lt,ht=at+lt,Ut=0,Bt=(nt+Ct)/2-Ue;return Bt>.5?Ut=-1:Bt<-.5&&(Ut=1),nt=((nt+Ut)*Ge-(Ue*=Ge))*et+Ue,Ct=((Ct+Ut)*Ge-Ue)*et+Ue,at=(at*Ge-(tt*=Ge))*et+tt,ht=(ht*Ge-tt)*et+tt,[[nt,ht,0],[Ct,ht,0],[Ct,at,0],[nt,at,0]]}(o,e,i._pixelsPerMercatorPixel,z,N);for(let Le=0;Le<y.length;Le++)Wl(y[Le],Ae[Le],Ce);let je=t._.add([],Ae[te],Ae[(te+1)%4]);t._.scale(je,je,.5),Wl(ve,je,Ce)}for(let Ae of y)t._.min(T,T,Ae),t._.max(C,C,Ae);return T[2]=Math.min(ie[2],pe[2]),t._.min(T,T,ve),t._.max(C,C,ve),new Fn(T,C)}function Vy({x:i,y:e,z:o},c=!1){let h=1/(1<<o),p=new Hi(Wo(i*h),e===(1<<o)-1&&c?-90:zr((e+1)*h)),m=new Hi(Wo((i+1)*h),e===0&&c?90:zr(e*h));return new dd(p,m)}function J1(i,e=Ao){let o=Li(i.getNorth()),c=Li(i.getSouth()),h=Math.cos(o),p=Math.cos(c),m=Math.sin(o),y=Math.sin(c),v=i.getWest(),C=i.getEast();return[Lp(p,y,v,e),Lp(p,y,C,e),Lp(h,m,C,e),Lp(h,m,v,e)]}function Tg(i,e,o,c){let h=1<<o.z,p=(i/pt+o.x)/h;return Qh(zr((e/pt+o.y)/h),Wo(p),c)}function jy({min:i,max:e}){return t3/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}let RT=new Float64Array(16);function Ig(i){let e=jy(i),o=t.ad.fromScaling(RT,[e,e,e]);return t.ad.translate(o,o,t._.negate([],i.min))}function ew(i){let e=t.ad.fromTranslation(RT,i.min),o=1/jy(i);return t.ad.scale(e,e,[o,o,o])}function tw(i){let e=pt/(2*Math.PI);return i/(2*Math.PI)/e}function FT(i,e){return pt/(512*Math.pow(2,i))*jy(Xs(e))}function LT(i,e,o,c,h){let p=tw(o),m=[i,e,-o/(2*Math.PI)],y=t.ad.identity(new Float64Array(16));return t.ad.translate(y,y,m),t.ad.scale(y,y,[p,p,p]),t.ad.rotateX(y,y,Li(-h)),t.ad.rotateY(y,y,Li(-c)),y}function Gl(i){return Cl(z1,uT,i)}function zT(i,e){let o=Qh(e.lat,e.lng),c=function(p){let m=Qh(p._center.lat,p._center.lng),y=t._.fromValues(0,1,0),v=t._.cross([],y,m),C=t.ad.fromRotation([],-p.angle,m);v=t._.transformMat4(v,v,C),t.ad.fromRotation(C,-p._pitch,v);let T=t._.normalize([],m);return t._.scale(T,T,Ny(p.cameraToCenterDistance/p.pixelsPerMeter)),t._.transformMat4(T,T,C),t._.add([],m,T)}(i),h=t._.subtract([],c,o);return t._.angle(h,o)}function iw(i,e){return zT(i,e)>Math.PI/2*1.01}let BT=Li(85),_3=Math.cos(BT),y3=Math.sin(BT),b3=t.ad.create(),NT=i=>{let e=[];return i.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),i.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function VT(i,e,o,c,h,p,m,y,v){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(v*=i.pixelToTileUnitsFactor);let C=i.tileID.canonical,T=o.projection.upVectorScale(C,o.center.lat,o.worldSize).metersToTile;for(let E of e)for(let D of E){let O=D.add(y),R=h&&o.elevation?o.elevation.exaggeration()*h.getElevationAt(O.x,O.y,!0):0,z=o.projection.projectTilePoint(O.x,O.y,C);if(R>0){let te=o.projection.upVector(C,O.x,O.y);z.x+=te[0]*T*R,z.y+=te[1]*T*R,z.z+=te[2]*T*R}let N=p?O:v3(z.x,z.y,z.z,c),W=p?i.tilespaceRays.map(te=>w3(te,R)):i.queryGeometry.screenGeometry,ee=t.aA.transformMat4([],[z.x,z.y,z.z,1],c);if(!m&&p?v*=ee[3]/o.cameraToCenterDistance:m&&!p&&(v*=o.cameraToCenterDistance/ee[3]),p){let te=zr((D.y/pt+C.y)/(1<<C.z));v/=o.projection.pixelsPerMeter(te,1)/Po(1,te)}if(l3(W,N,v))return!0}return!1}function v3(i,e,o,c){let h=t.aA.transformMat4([],[i,e,o,1],c);return new vt(h[0]/h[3],h[1]/h[3])}let jT=t._.fromValues(0,0,0),x3=t._.fromValues(0,0,1);function w3(i,e){let o=t._.create();return jT[2]=e,i.intersectsPlane(jT,x3,o),new vt(o[0],o[1])}class UT extends W1{}function HT(i,{width:e,height:o},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*o*c)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*o*c);return i.width=e,i.height=o,i.data=h,i}function WT(i,e,o){let{width:c,height:h}=e;c===i.width&&h===i.height||(nw(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,c),height:Math.min(i.height,h)},o,null),i.width=c,i.height=h,i.data=e.data)}function nw(i,e,o,c,h,p,m,y){if(h.width===0||h.height===0)return e;if(h.width>i.width||h.height>i.height||o.x>i.width-h.width||o.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||c.x>e.width-h.width||c.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");let v=i.data,C=e.data,T=p===4&&y;for(let E=0;E<h.height;E++){let D=((o.y+E)*i.width+o.x)*p,O=((c.y+E)*e.width+c.x)*p;if(T)for(let R=0;R<h.width;R++){let z=D+R*p+3,N=O+R*p;C[N+0]=255,C[N+1]=255,C[N+2]=255,C[N+3]=v[z]}else if(m)for(let R=0;R<h.width;R++){let z=D+R*p,N=O+R*p,W=v[z+3],ee=new Wi(v[z+0]/255*W,v[z+1]/255*W,v[z+2]/255*W,W).toRenderColor(m).toArray();C[N+0]=ee[0],C[N+1]=ee[1],C[N+2]=ee[2],C[N+3]=ee[3]}else for(let R=0;R<h.width*p;R++)C[O+R]=v[D+R]}return e}ne(UT,"HeatmapBucket",{omit:["layers"]});class ud{constructor(e,o){HT(this,e,1,o)}resize(e){WT(this,new ud(e),1)}clone(){return new ud({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,c,h,p){nw(e,o,c,h,p,1,null)}}class Ta{constructor(e,o){HT(this,e,4,o)}resize(e){WT(this,new Ta(e),4)}replace(e,o){o?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ta({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,c,h,p,m,y){nw(e,o,c,h,p,4,m,y)}}class GT{constructor(e,o){this.width=e.width,this.height=e.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}ne(ud,"AlphaImage"),ne(Ta,"RGBAImage");let C3=new Qi({visibility:new Qe(Pe.layout_heatmap.visibility)});var S3={paint:new Qi({"heatmap-radius":new wt(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wt(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qe(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new On(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qe(Pe.paint_heatmap["heatmap-opacity"])}),layout:C3};function Eg(i){let e={},o=i.resolution||256,c=i.clips?i.clips.length:1,h=i.image||new Ta({width:o,height:c}),p=(m,y,v)=>{e[i.evaluationKey]=v;let C=i.expression.evaluate(e);C&&(h.data[m+y+0]=Math.floor(255*C.r/C.a),h.data[m+y+1]=Math.floor(255*C.g/C.a),h.data[m+y+2]=Math.floor(255*C.b/C.a),h.data[m+y+3]=Math.floor(255*C.a))};if(i.clips)for(let m=0,y=0;m<c;++m,y+=4*o)for(let v=0,C=0;v<o;v++,C+=4){let T=v/(o-1),{start:E,end:D}=i.clips[m];p(y,C,E*(1-T)+D*T)}else for(let m=0,y=0;m<o;m++,y+=4)p(0,y,m/(o-1));return h}let M3=new Qi({visibility:new Qe(Pe.layout_hillshade.visibility)});var T3={paint:new Qi({"hillshade-illumination-direction":new Qe(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qe(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qe(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qe(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qe(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qe(Pe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Qe(Pe.paint_hillshade["hillshade-emissive-strength"])}),layout:M3};let I3=Ji([{name:"a_pos",components:2,type:"Int16"}],4),{members:E3}=I3;function Dg(i,e,o=2){let c=e&&e.length,h=c?e[0]*o:i.length,p=$T(i,0,h,o,!0),m=[];if(!p||p.next===p.prev)return m;let y,v,C;if(c&&(p=function(T,E,D,O){let R=[];for(let z=0,N=E.length;z<N;z++){let W=$T(T,E[z]*O,z<N-1?E[z+1]*O:T.length,O,!1);W===W.next&&(W.steiner=!0),R.push(L3(W))}R.sort(O3);for(let z=0;z<R.length;z++)D=R3(R[z],D);return D}(i,e,p,o)),i.length>80*o){y=1/0,v=1/0;let T=-1/0,E=-1/0;for(let D=o;D<h;D+=o){let O=i[D],R=i[D+1];O<y&&(y=O),R<v&&(v=R),O>T&&(T=O),R>E&&(E=R)}C=Math.max(T-y,E-v),C=C!==0?32767/C:0}return kg(p,m,o,y,v,C,0),m}function $T(i,e,o,c,h){let p;if(h===function(m,y,v,C){let T=0;for(let E=y,D=v-C;E<v;E+=C)T+=(m[D]-m[E])*(m[E+1]+m[D+1]),D=E;return T}(i,e,o,c)>0)for(let m=e;m<o;m+=c)p=ZT(m/c|0,i[m],i[m+1],p);else for(let m=o-c;m>=e;m-=c)p=ZT(m/c|0,i[m],i[m+1],p);return p&&Uy(p,p.next)&&(Pg(p),p=p.next),p}function tu(i,e){if(!i)return i;e||(e=i);let o,c=i;do if(o=!1,c.steiner||!Uy(c,c.next)&&fr(c.prev,c,c.next)!==0)c=c.next;else{if(Pg(c),c=e=c.prev,c===c.next)break;o=!0}while(o||c!==e);return e}function kg(i,e,o,c,h,p,m){if(!i)return;!m&&p&&function(v,C,T,E){let D=v;do D.z===0&&(D.z=rw(D.x,D.y,C,T,E)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==v);D.prevZ.nextZ=null,D.prevZ=null,function(O){let R,z=1;do{let N,W=O;O=null;let ee=null;for(R=0;W;){R++;let te=W,ie=0;for(let he=0;he<z&&(ie++,te=te.nextZ,te);he++);let pe=z;for(;ie>0||pe>0&&te;)ie!==0&&(pe===0||!te||W.z<=te.z)?(N=W,W=W.nextZ,ie--):(N=te,te=te.nextZ,pe--),ee?ee.nextZ=N:O=N,N.prevZ=ee,ee=N;W=te}ee.nextZ=null,z*=2}while(R>1)}(D)}(i,c,h,p);let y=i;for(;i.prev!==i.next;){let v=i.prev,C=i.next;if(p?k3(i,c,h,p):D3(i))e.push(v.i,i.i,C.i),Pg(i),i=C.next,y=C.next;else if((i=C)===y){m?m===1?kg(i=A3(tu(i),e),e,o,c,h,p,2):m===2&&P3(i,e,o,c,h,p):kg(tu(i),e,o,c,h,p,1);break}}}function D3(i){let e=i.prev,o=i,c=i.next;if(fr(e,o,c)>=0)return!1;let h=e.x,p=o.x,m=c.x,y=e.y,v=o.y,C=c.y,T=h<p?h<m?h:m:p<m?p:m,E=y<v?y<C?y:C:v<C?v:C,D=h>p?h>m?h:m:p>m?p:m,O=y>v?y>C?y:C:v>C?v:C,R=c.next;for(;R!==e;){if(R.x>=T&&R.x<=D&&R.y>=E&&R.y<=O&&Vp(h,y,p,v,m,C,R.x,R.y)&&fr(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function k3(i,e,o,c){let h=i.prev,p=i,m=i.next;if(fr(h,p,m)>=0)return!1;let y=h.x,v=p.x,C=m.x,T=h.y,E=p.y,D=m.y,O=y<v?y<C?y:C:v<C?v:C,R=T<E?T<D?T:D:E<D?E:D,z=y>v?y>C?y:C:v>C?v:C,N=T>E?T>D?T:D:E>D?E:D,W=rw(O,R,e,o,c),ee=rw(z,N,e,o,c),te=i.prevZ,ie=i.nextZ;for(;te&&te.z>=W&&ie&&ie.z<=ee;){if(te.x>=O&&te.x<=z&&te.y>=R&&te.y<=N&&te!==h&&te!==m&&Vp(y,T,v,E,C,D,te.x,te.y)&&fr(te.prev,te,te.next)>=0||(te=te.prevZ,ie.x>=O&&ie.x<=z&&ie.y>=R&&ie.y<=N&&ie!==h&&ie!==m&&Vp(y,T,v,E,C,D,ie.x,ie.y)&&fr(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;te&&te.z>=W;){if(te.x>=O&&te.x<=z&&te.y>=R&&te.y<=N&&te!==h&&te!==m&&Vp(y,T,v,E,C,D,te.x,te.y)&&fr(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;ie&&ie.z<=ee;){if(ie.x>=O&&ie.x<=z&&ie.y>=R&&ie.y<=N&&ie!==h&&ie!==m&&Vp(y,T,v,E,C,D,ie.x,ie.y)&&fr(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function A3(i,e){let o=i;do{let c=o.prev,h=o.next.next;!Uy(c,h)&&qT(c,o,o.next,h)&&Ag(c,h)&&Ag(h,c)&&(e.push(c.i,o.i,h.i),Pg(o),Pg(o.next),o=i=h),o=o.next}while(o!==i);return tu(o)}function P3(i,e,o,c,h,p){let m=i;do{let y=m.next.next;for(;y!==m.prev;){if(m.i!==y.i&&z3(m,y)){let v=YT(m,y);return m=tu(m,m.next),v=tu(v,v.next),kg(m,e,o,c,h,p,0),void kg(v,e,o,c,h,p,0)}y=y.next}m=m.next}while(m!==i)}function O3(i,e){return i.x-e.x}function R3(i,e){let o=function(h,p){let m=p,y=h.x,v=h.y,C,T=-1/0;do{if(v<=m.y&&v>=m.next.y&&m.next.y!==m.y){let z=m.x+(v-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(z<=y&&z>T&&(T=z,C=m.x<m.next.x?m:m.next,z===y))return C}m=m.next}while(m!==p);if(!C)return null;let E=C,D=C.x,O=C.y,R=1/0;m=C;do{if(y>=m.x&&m.x>=D&&y!==m.x&&Vp(v<O?y:T,v,D,O,v<O?T:y,v,m.x,m.y)){let z=Math.abs(v-m.y)/(y-m.x);Ag(m,h)&&(z<R||z===R&&(m.x>C.x||m.x===C.x&&F3(C,m)))&&(C=m,R=z)}m=m.next}while(m!==E);return C}(i,e);if(!o)return e;let c=YT(o,i);return tu(c,c.next),tu(o,o.next)}function F3(i,e){return fr(i.prev,i,e.prev)<0&&fr(e.next,i,i.next)<0}function rw(i,e,o,c,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-o)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function L3(i){let e=i,o=i;do(e.x<o.x||e.x===o.x&&e.y<o.y)&&(o=e),e=e.next;while(e!==i);return o}function Vp(i,e,o,c,h,p,m,y){return(h-m)*(e-y)>=(i-m)*(p-y)&&(i-m)*(c-y)>=(o-m)*(e-y)&&(o-m)*(p-y)>=(h-m)*(c-y)}function z3(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(o,c){let h=o;do{if(h.i!==o.i&&h.next.i!==o.i&&h.i!==c.i&&h.next.i!==c.i&&qT(h,h.next,o,c))return!0;h=h.next}while(h!==o);return!1}(i,e)&&(Ag(i,e)&&Ag(e,i)&&function(o,c){let h=o,p=!1,m=(o.x+c.x)/2,y=(o.y+c.y)/2;do h.y>y!=h.next.y>y&&h.next.y!==h.y&&m<(h.next.x-h.x)*(y-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==o);return p}(i,e)&&(fr(i.prev,i,e.prev)||fr(i,e.prev,e))||Uy(i,e)&&fr(i.prev,i,i.next)>0&&fr(e.prev,e,e.next)>0)}function fr(i,e,o){return(e.y-i.y)*(o.x-e.x)-(e.x-i.x)*(o.y-e.y)}function Uy(i,e){return i.x===e.x&&i.y===e.y}function qT(i,e,o,c){let h=Wy(fr(i,e,o)),p=Wy(fr(i,e,c)),m=Wy(fr(o,c,i)),y=Wy(fr(o,c,e));return h!==p&&m!==y||!(h!==0||!Hy(i,o,e))||!(p!==0||!Hy(i,c,e))||!(m!==0||!Hy(o,i,c))||!(y!==0||!Hy(o,e,c))}function Hy(i,e,o){return e.x<=Math.max(i.x,o.x)&&e.x>=Math.min(i.x,o.x)&&e.y<=Math.max(i.y,o.y)&&e.y>=Math.min(i.y,o.y)}function Wy(i){return i>0?1:i<0?-1:0}function Ag(i,e){return fr(i.prev,i,i.next)<0?fr(i,e,i.next)>=0&&fr(i,i.prev,e)>=0:fr(i,e,i.prev)<0||fr(i,i.next,e)<0}function YT(i,e){let o=ow(i.i,i.x,i.y),c=ow(e.i,e.x,e.y),h=i.next,p=e.prev;return i.next=e,e.prev=i,o.next=h,h.prev=o,c.next=o,o.prev=c,p.next=c,c.prev=p,c}function ZT(i,e,o,c){let h=ow(i,e,o);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function Pg(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ow(i,e,o){return{i,x:e,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Gy(i,e){let o=i.length;if(o<=1)return[i];let c=[],h,p;for(let m=0;m<o;m++){let y=eo(i[m]);y!==0&&(i[m].area=Math.abs(y),p===void 0&&(p=y<0),p===y<0?(h&&c.push(h),h=[i[m]]):h.push(i[m]))}if(h&&c.push(h),e>1)for(let m=0;m<c.length;m++)c[m].length<=e||(n1(c[m],e,1,c[m].length-1,B3),c[m]=c[m].slice(0,e));return c}function B3(i,e){return e.area-i.area}function aw(i,e,o){let c=o.patternDependencies,h=!1;for(let p of e){let m=p.paint.get(`${i}-pattern`);m.isConstant()||(h=!0);let y=m.constantOr(null);y&&(h=!0,c[y]=!0)}return h}function sw(i,e,o,c,h){let p=h.patternDependencies;for(let m of e){let y=m.paint.get(`${i}-pattern`).value;if(y.kind!=="constant"){let v=y.evaluate({zoom:c},o,{},h.availableImages);v=v&&v.name?v.name:v,p[v]=!0,o.patterns[m.id]=v}}return o}class $y{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ms,this.indexArray=new Ir,this.indexArray2=new sd,this.programConfigurations=new cd(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Rn,this.segments2=new Rn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=e.projection}updateFootprints(e,o){}populate(e,o,c,h){this.hasPattern=aw("fill",this.layers,o);let p=this.layers[0].layout.get("fill-sort-key"),m=[];for(let{feature:y,id:v,index:C,sourceLayerIndex:T}of e){let E=this.layers[0]._featureFilter.needGeometry,D=Hl(y,E);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),D,c))continue;let O=p?p.evaluate(D,{},c,o.availableImages):void 0,R={id:v,properties:y.properties,type:y.type,sourceLayerIndex:T,index:C,geometry:E?D.geometry:gs(y,c,h),patterns:{},sortKey:O};m.push(R)}p&&m.sort((y,v)=>y.sortKey-v.sortKey);for(let y of m){let{geometry:v,index:C,sourceLayerIndex:T}=y;if(this.hasPattern){let E=sw("fill",this.layers,y,this.zoom,o);this.patternFeatures.push(E)}else this.addFeature(y,v,C,c,{},o.availableImages,o.brightness);o.featureIndex.insert(e[C].feature,v,C,T,this.index)}}update(e,o,c,h,p){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,o,m?this.stateDependentLayers:this.layers,c,h,p)}addFeatures(e,o,c,h,p,m){for(let y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,o,c,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,E3),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,o,c,h,p,m=[],y){for(let v of Gy(o,500)){let C=0;for(let z of v)C+=z.length;let T=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),E=T.vertexLength,D=[],O=[];for(let z of v){if(z.length===0)continue;z!==v[0]&&O.push(D.length/2);let N=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),W=N.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(W+z.length-1,W),D.push(z[0].x),D.push(z[0].y);for(let ee=1;ee<z.length;ee++)this.layoutVertexArray.emplaceBack(z[ee].x,z[ee].y),this.indexArray2.emplaceBack(W+ee-1,W+ee),D.push(z[ee].x),D.push(z[ee].y);N.vertexLength+=z.length,N.primitiveLength+=z.length}let R=Dg(D,O);for(let z=0;z<R.length;z+=3)this.indexArray.emplaceBack(E+R[z],E+R[z+1],E+R[z+2]);T.vertexLength+=C,T.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,p,m,h,y)}}ne($y,"FillBucket",{omit:["layers","patternFeatures"]});let N3=new Qi({"fill-sort-key":new wt(Pe.layout_fill["fill-sort-key"]),visibility:new Qe(Pe.layout_fill.visibility)});var V3={paint:new Qi({"fill-antialias":new Qe(Pe.paint_fill["fill-antialias"]),"fill-opacity":new wt(Pe.paint_fill["fill-opacity"]),"fill-color":new wt(Pe.paint_fill["fill-color"]),"fill-outline-color":new wt(Pe.paint_fill["fill-outline-color"]),"fill-translate":new Qe(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Qe(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new wt(Pe.paint_fill["fill-pattern"]),"fill-emissive-strength":new Qe(Pe.paint_fill["fill-emissive-strength"])}),layout:N3};class lw{constructor(e,o,c,h){if(this.triangleCount=o.length/3,this.min=new vt(0,0),this.max=new vt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[p,m]=[e[0].clone(),e[0].clone()];for(let E=1;E<e.length;++E){let D=e[E];p.x=Math.min(p.x,D.x),p.y=Math.min(p.y,D.y),m.x=Math.max(m.x,D.x),m.y=Math.max(m.y,D.y)}if(h){let E=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/h);c=Math.max(c,E)}if(c===0)return;this.min=p,this.max=m;let y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);let v=Math.max(y.x,y.y)/c;this.cellsX=Math.max(1,Math.ceil(y.x/v)),this.cellsY=Math.max(1,Math.ceil(y.y/v)),this.xScale=1/v,this.yScale=1/v;let C=[];for(let E=0;E<this.triangleCount;E++){let D=e[o[3*E+0]].sub(this.min),O=e[o[3*E+1]].sub(this.min),R=e[o[3*E+2]].sub(this.min),z=Ks(Math.floor(Math.min(D.x,O.x,R.x)),this.xScale,this.cellsX),N=Ks(Math.floor(Math.max(D.x,O.x,R.x)),this.xScale,this.cellsX),W=Ks(Math.floor(Math.min(D.y,O.y,R.y)),this.yScale,this.cellsY),ee=Ks(Math.floor(Math.max(D.y,O.y,R.y)),this.yScale,this.cellsY),te=new vt(0,0),ie=new vt(0,0),pe=new vt(0,0),he=new vt(0,0);for(let ve=W;ve<=ee;++ve){te.y=ie.y=ve*v,pe.y=he.y=(ve+1)*v;for(let Ce=z;Ce<=N;++Ce)te.x=pe.x=Ce*v,ie.x=he.x=(Ce+1)*v,(Y1(D,O,R,te,ie,he)||Y1(D,O,R,te,he,pe))&&C.push({cellIdx:ve*this.cellsX+Ce,triIdx:E})}}if(C.length===0)return;C.sort((E,D)=>E.cellIdx-D.cellIdx||E.triIdx-D.triIdx);let T=0;for(;T<C.length;){let E=C[T].cellIdx,D={start:this.payload.length,len:0};for(;T<C.length&&C[T].cellIdx===E;)++D.len,this.payload.push(C[T++].triIdx);this.cells[E]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let c=Ks(e.x-this.min.x,this.xScale,this.cellsX),h=Ks(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[h*this.cellsX+c];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){let y=this.payload[p.start+m],v=Math.floor(y/8),C=1<<y%8;if(!(this.lookup[v]&C)&&(this.lookup[v]|=C,o.push(y),o.length===this.triangleCount))return}}}query(e,o,c){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>o.x||e.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();let h=Ks(e.x-this.min.x,this.xScale,this.cellsX),p=Ks(o.x-this.min.x,this.xScale,this.cellsX),m=Ks(e.y-this.min.y,this.yScale,this.cellsY),y=Ks(o.y-this.min.y,this.yScale,this.cellsY);for(let v=m;v<=y;v++)for(let C=h;C<=p;C++){let T=this.cells[v*this.cellsX+C];if(T)for(let E=0;E<T.len;E++){let D=this.payload[T.start+E],O=Math.floor(D/8),R=1<<D%8;if(!(this.lookup[O]&R)&&(this.lookup[O]|=R,c.push(D),c.length===this.triangleCount))return}}}}function Ks(i,e,o){return Math.max(0,Math.min(o-1,Math.floor(i*e)))}ne(lw,"TriangleGridIndex");class XT{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[]}updateFootprints(e,o){for(let c of this.footprints)o.push({footprint:c,id:e})}populate(e,o,c,h){let p=[];for(let{feature:m,id:y,index:v,sourceLayerIndex:C}of e){let T=this.layers[0]._featureFilter.needGeometry,E=Hl(m,T);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),E,c))continue;let D={id:y,properties:m.properties,type:m.type,sourceLayerIndex:C,index:v,geometry:T?E.geometry:gs(m,c,h),patterns:{}};p.push(D)}for(let m of p){let{geometry:y,index:v,sourceLayerIndex:C}=m;this.addFeature(m,y,v,c,{},o.availableImages,o.brightness),o.featureIndex.insert(e[v].feature,y,v,C,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,o,c,h,p){}destroy(){}addFeature(e,o,c,h,p,m=[],y){for(let v of Gy(o,2)){let C=[],T=[],E=[],D=new vt(1/0,1/0),O=new vt(-1/0,-1/0);for(let N of v)if(N.length!==0){N!==v[0]&&E.push(T.length/2);for(let W=0;W<N.length;W++)T.push(N[W].x),T.push(N[W].y),C.push(N[W]),D.x=Math.min(D.x,N[W].x),D.y=Math.min(D.y,N[W].y),O.x=Math.max(O.x,N[W].x),O.y=Math.max(O.y,N[W].y)}let R=Dg(T,E),z=new lw(C,R,8,256);this.footprints.push({vertices:C,indices:R,grid:z,min:D,max:O})}}}ne(XT,"ClipBucket",{omit:["layers"]});let j3=new Qi({"clip-layer-types":new Qe(Pe.layout_clip["clip-layer-types"])});var U3={paint:new Qi({}),layout:j3};let H3=Ji([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),W3=Ji([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),G3=Ji([{name:"a_centroid_pos",components:2,type:"Uint16"}]),$3=Ji([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),q3=Ji([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Y3}=H3;var qy={},Z3=Yu,KT=jp;function jp(i,e,o,c,h){this.properties={},this.extent=o,this.type=0,this._pbf=i,this._geometry=-1,this._keys=c,this._values=h,i.readFields(X3,this,e)}function X3(i,e,o){i==1?e.id=o.readVarint():i==2?function(c,h){for(var p=c.readVarint()+c.pos;c.pos<p;){var m=h._keys[c.readVarint()],y=h._values[c.readVarint()];h.properties[m]=y}}(o,e):i==3?e.type=o.readVarint():i==4&&(e._geometry=o.pos)}function K3(i){for(var e,o,c=0,h=0,p=i.length,m=p-1;h<p;m=h++)c+=((o=i[m]).x-(e=i[h]).x)*(e.y+o.y);return c}jp.types=["Unknown","Point","LineString","Polygon"],jp.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,o=i.readVarint()+i.pos,c=1,h=0,p=0,m=0,y=[];i.pos<o;){if(h<=0){var v=i.readVarint();c=7&v,h=v>>3}if(h--,c===1||c===2)p+=i.readSVarint(),m+=i.readSVarint(),c===1&&(e&&y.push(e),e=[]),e.push(new Z3(p,m));else{if(c!==7)throw new Error("unknown command "+c);e&&e.push(e[0].clone())}}return e&&y.push(e),y},jp.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,o=1,c=0,h=0,p=0,m=1/0,y=-1/0,v=1/0,C=-1/0;i.pos<e;){if(c<=0){var T=i.readVarint();o=7&T,c=T>>3}if(c--,o===1||o===2)(h+=i.readSVarint())<m&&(m=h),h>y&&(y=h),(p+=i.readSVarint())<v&&(v=p),p>C&&(C=p);else if(o!==7)throw new Error("unknown command "+o)}return[m,v,y,C]},jp.prototype.toGeoJSON=function(i,e,o){var c,h,p=this.extent*Math.pow(2,o),m=this.extent*i,y=this.extent*e,v=this.loadGeometry(),C=jp.types[this.type];function T(O){for(var R=0;R<O.length;R++){var z=O[R];O[R]=[360*(z.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(z.y+y)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(c=0;c<v.length;c++)E[c]=v[c][0];T(v=E);break;case 2:for(c=0;c<v.length;c++)T(v[c]);break;case 3:for(v=function(O){var R=O.length;if(R<=1)return[O];for(var z,N,W=[],ee=0;ee<R;ee++){var te=K3(O[ee]);te!==0&&(N===void 0&&(N=te<0),N===te<0?(z&&W.push(z),z=[O[ee]]):z.push(O[ee]))}return z&&W.push(z),W}(v),c=0;c<v.length;c++)for(h=0;h<v[c].length;h++)T(v[c][h])}v.length===1?v=v[0]:C="Multi"+C;var D={type:"Feature",geometry:{type:C,coordinates:v},properties:this.properties};return"id"in this&&(D.id=this.id),D};var Q3=KT,QT=JT;function JT(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(J3,this,e),this.length=this._features.length}function J3(i,e,o){i===15?e.version=o.readVarint():i===1?e.name=o.readString():i===5?e.extent=o.readVarint():i===2?e._features.push(o.pos):i===3?e._keys.push(o.readString()):i===4&&e._values.push(function(c){for(var h=null,p=c.readVarint()+c.pos;c.pos<p;){var m=c.readVarint()>>3;h=m===1?c.readString():m===2?c.readFloat():m===3?c.readDouble():m===4?c.readVarint64():m===5?c.readVarint():m===6?c.readSVarint():m===7?c.readBoolean():null}return h}(o))}JT.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Q3(this._pbf,e,this.extent,this._keys,this._values)};var ez=QT;function tz(i,e,o){if(i===3){var c=new ez(o,o.readVarint()+o.pos);c.length&&(e[c.name]=c)}}var cw=qy.VectorTile=function(i,e){this.layers=i.readFields(tz,{},e)},Yy=qy.VectorTileFeature=KT;qy.VectorTileLayer=QT;class iu extends vt{constructor(e,o,c){super(e,o),this.z=c}}class eI extends iu{constructor(e,o,c,h){super(e,o,c),this.w=h}}function Zy(i,e,o,c){let h=[],p=c===0?(m,y,v,C,T,E)=>{m.push(new vt(E,v+(E-y)/(C-y)*(T-v)))}:(m,y,v,C,T,E)=>{m.push(new vt(y+(E-v)/(T-v)*(C-y),E))};for(let m of i){let y=[];for(let v of m){if(v.length<=2)continue;let C=[];for(let D=0;D<v.length-1;D++){let O=v[D].x,R=v[D].y,z=v[D+1].x,N=v[D+1].y,W=c===0?O:R,ee=c===0?z:N;W<e?ee>e&&p(C,O,R,z,N,e):W>o?ee<o&&p(C,O,R,z,N,o):C.push(v[D]),ee<e&&W>=e&&p(C,O,R,z,N,e),ee>o&&W<=o&&p(C,O,R,z,N,o)}let T=v[v.length-1],E=c===0?T.x:T.y;E>=e&&E<=o&&C.push(T),C.length&&(T=C[C.length-1],C[0].x===T.x&&C[0].y===T.y||C.push(C[0]),y.push(C))}y.length&&h.push(y)}return h}function tI(i,e,o,c){let h=o==="x"?"y":"x",p=(c-i[o])/(e[o]-i[o]);i[h]=i[h]+(e[h]-i[h])*p,i[o]=c,i.hasOwnProperty("z")&&(i.z=Gt(i.z,e.z,p)),i.hasOwnProperty("w")&&(i.w=Gt(i.w,e.w,p))}function iI(i,e,o,c){let h=o,p=c;for(let m of["x","y"]){let y=i,v=e;y[m]>=v[m]&&(y=e,v=i),y[m]<h&&v[m]>h&&tI(y,v,m,h),y[m]<p&&v[m]>p&&tI(v,y,m,p)}}function Xy(i,e){return i.x-e.x||i.y-e.y}function nI(i,e){return Xy(i.min,e.min)===0&&Xy(i.max,e.max)===0}function dw(i,e){return!(i.min.x>e.max.x||i.max.x<e.min.x||i.min.y>e.max.y||i.max.y<e.min.y)}function hw(i,e){if(i.length!==e.length)return!1;for(let o=0;o<i.length;o++)if(i[o].sourceId!==e[o].sourceId||!nI(i[o],e[o])||i[o].order!==e[o].order||i[o].clipMask!==e[o].clipMask)return!1;return!0}function rI(i,e,o){let c=1/pt,h=1/(1<<o.canonical.z),p=(e.x*c+o.canonical.x)*h+o.wrap,m=(e.y*c+o.canonical.y)*h;return{min:new vt((i.x*c+o.canonical.x)*h+o.wrap,(i.y*c+o.canonical.y)*h),max:new vt(p,m)}}function iz(i,e,o){let c=1<<o.canonical.z,h=((e.x-o.wrap)*c-o.canonical.x)*pt,p=(e.y*c-o.canonical.y)*pt;return{min:new vt(((i.x-o.wrap)*c-o.canonical.x)*pt,(i.y*c-o.canonical.y)*pt),max:new vt(h,p)}}function oI(i,e,o,c,h,p,m){let y=i.indices,v=i.vertices,C=[];for(let T=c;T<c+h;T+=3){let E=e[o[T+0]+p],D=e[o[T+1]+p],O=e[o[T+2]+p],R=Math.min(E.x,D.x,O.x),z=Math.max(E.x,D.x,O.x),N=Math.min(E.y,D.y,O.y),W=Math.max(E.y,D.y,O.y);C.length=0,i.grid.query(new vt(R,N),new vt(z,W),C);for(let ee=0;ee<C.length;ee++){let te=C[ee];if(Y1(v[y[3*te+0]],v[y[3*te+1]],v[y[3*te+2]],E,D,O,m))return!0}}return!1}function aI(i,e,o,c){if(!i||!o)return!1;let h=i.vertices;if(!e.canonical.equals(c.canonical)||e.wrap!==c.wrap){if(o.vertices.length<i.vertices.length)return aI(o,c,i,e);let p=e.canonical,m=c.canonical,y=Math.pow(2,m.z-p.z);h=i.vertices.map(v=>new vt((v.x+p.x*pt)*y-m.x*pt,(v.y+p.y*pt)*y-m.y*pt))}return oI(o,h,i.indices,0,i.indices.length,0,0)}function sI(i,e,o,c){let h=Math.pow(2,c.z-o.z);return new vt((i+o.x*pt)*h-c.x*pt,(e+o.y*pt)*h-c.y*pt)}function lI(i,e){let o=[];e.footprint.grid.queryPoint(i,o);let c=e.footprint.indices,h=e.footprint.vertices;for(let p=0;p<o.length;p++){let m=o[p];if(hd([h[c[3*m+0]],h[c[3*m+1]],h[c[3*m+2]]],i))return!0}return!1}class cI{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,o){let c=this.toIdx(e,o);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,o){return this.leaves[this.toIdx(e,o)]}toIdx(e,o){return o*this.size+e}}function dI(i,e,o,c){let h=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(o[m]<i[m]||o[m]>e[m])return null}else{let y=1/c[m],v=(i[m]-o[m])*y,C=(e[m]-o[m])*y;if(v>C){let T=v;v=C,C=T}if(v>h&&(h=v),C<p&&(p=C),h>p)return null}return h}function hI(i,e,o,c,h,p,m,y,v,C,T){let E=c-i,D=h-e,O=p-o,R=m-i,z=y-e,N=v-o,W=T[1]*N-T[2]*z,ee=T[2]*R-T[0]*N,te=T[0]*z-T[1]*R,ie=E*W+D*ee+O*te;if(Math.abs(ie)<1e-15)return null;let pe=1/ie,he=C[0]-i,ve=C[1]-e,Ce=C[2]-o,Ae=(he*W+ve*ee+Ce*te)*pe;if(Ae<0||Ae>1)return null;let je=ve*O-Ce*D,Le=Ce*E-he*O,qe=he*D-ve*E,ot=(T[0]*je+T[1]*Le+T[2]*qe)*pe;return ot<0||Ae+ot>1?null:(R*je+z*Le+N*qe)*pe}function uI(i,e,o){return(i-e)/(o-e)}function pI(i,e,o,c,h,p,m,y,v){let C=1<<o,T=p-c,E=m-h,D=(i+1)/C*T+c,O=(e+0)/C*E+h,R=(e+1)/C*E+h;y[0]=(i+0)/C*T+c,y[1]=O,v[0]=D,v[1]=R}class mI{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let o=function(p){let m=Math.ceil(Math.log2(p.dim/8)),y=[],v=Math.ceil(Math.pow(2,m)),C=1/v,T=(O,R,z,N,W)=>{let ee=N?1:0,te=(O+1)*z-ee,ie=R*z,pe=(R+1)*z-ee;W[0]=O*z,W[1]=ie,W[2]=te,W[3]=pe},E=new cI(v),D=[];for(let O=0;O<v*v;O++){T(O%v,Math.floor(O/v),C,!1,D);let R=pd(D[0],D[1],p),z=pd(D[2],D[1],p),N=pd(D[2],D[3],p),W=pd(D[0],D[3],p);E.minimums.push(Math.min(R,z,N,W)),E.maximums.push(Math.max(R,z,N,W)),E.leaves.push(1)}for(y.push(E),v/=2;v>=1;v/=2){let O=y[y.length-1];E=new cI(v);for(let R=0;R<v*v;R++){T(R%v,Math.floor(R/v),2,!0,D);let z=O.getElevation(D[0],D[1]),N=O.getElevation(D[2],D[1]),W=O.getElevation(D[2],D[3]),ee=O.getElevation(D[0],D[3]),te=O.isLeaf(D[0],D[1]),ie=O.isLeaf(D[2],D[1]),pe=O.isLeaf(D[2],D[3]),he=O.isLeaf(D[0],D[3]),ve=Math.min(z.min,N.min,W.min,ee.min),Ce=Math.max(z.max,N.max,W.max,ee.max),Ae=te&&ie&&pe&&he;E.maximums.push(Ce),E.minimums.push(ve),E.leaves.push(Ce-ve<=5&&Ae?1:0)}y.push(E)}return y}(this.dem),c=o.length-1,h=o[c];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(o,0,0,c,0)}raycastRoot(e,o,c,h,p,m,y=1){return dI([e,o,-100],[c,h,this.maximums[0]*y],p,m)}raycast(e,o,c,h,p,m,y=1){if(!this.nodeCount)return null;let v=this.raycastRoot(e,o,c,h,p,m,y);if(v==null)return null;let C=[],T=[],E=[],D=[],O=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;O.length>0;){let{idx:R,t:z,nodex:N,nodey:W,depth:ee}=O.pop();if(this.leaves[R]){pI(N,W,ee,e,o,c,h,E,D);let ie=1<<ee,pe=(N+0)/ie,he=(N+1)/ie,ve=(W+0)/ie,Ce=(W+1)/ie,Ae=pd(pe,ve,this.dem)*y,je=pd(he,ve,this.dem)*y,Le=pd(he,Ce,this.dem)*y,qe=pd(pe,Ce,this.dem)*y,ot=hI(E[0],E[1],Ae,D[0],E[1],je,D[0],D[1],Le,p,m),Ge=hI(D[0],D[1],Le,E[0],D[1],qe,E[0],E[1],Ae,p,m),et=Math.min(ot!==null?ot:Number.MAX_VALUE,Ge!==null?Ge:Number.MAX_VALUE);if(et!==Number.MAX_VALUE)return et;{let Ue=t._.scaleAndAdd([],p,m,z);if(fI(Ae,je,qe,Le,uI(Ue[0],E[0],D[0]),uI(Ue[1],E[1],D[1]))>=Ue[2])return z}continue}let te=0;for(let ie=0;ie<this._siblingOffset.length;ie++){pI((N<<1)+this._siblingOffset[ie][0],(W<<1)+this._siblingOffset[ie][1],ee+1,e,o,c,h,E,D),E[2]=-100,D[2]=this.maximums[this.childOffsets[R]+ie]*y;let pe=dI(E,D,p,m);if(pe!=null){let he=pe;C[ie]=he;let ve=!1;for(let Ce=0;Ce<te&&!ve;Ce++)he>=C[T[Ce]]&&(T.splice(Ce,0,ie),ve=!0);ve||(T[te]=ie),te++}}for(let ie=0;ie<te;ie++){let pe=T[ie];O.push({idx:this.childOffsets[R]+pe,t:C[pe],nodex:(N<<1)+this._siblingOffset[pe][0],nodey:(W<<1)+this._siblingOffset[pe][1],depth:ee+1})}}return null}_addNode(e,o,c){return this.minimums.push(e),this.maximums.push(o),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,o,c,h,p){if(e[h].isLeaf(o,c)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);let m=h-1,y=e[m],v=0,C=0;for(let T=0;T<this._siblingOffset.length;T++){let E=2*o+this._siblingOffset[T][0],D=2*c+this._siblingOffset[T][1],O=y.getElevation(E,D),R=y.isLeaf(E,D),z=this._addNode(O.min,O.max,R);R&&(v|=1<<T),C||(C=z)}for(let T=0;T<this._siblingOffset.length;T++)v&1<<T||this._construct(e,2*o+this._siblingOffset[T][0],2*c+this._siblingOffset[T][1],m,C+T)}}function fI(i,e,o,c,h,p){return Gt(Gt(i,o,p),Gt(e,c,p),h)}function pd(i,e,o){let c=o.dim,h=yi(i*c-.5,0,c-1),p=yi(e*c-.5,0,c-1),m=Math.floor(h),y=Math.floor(p),v=Math.min(m+1,c-1),C=Math.min(y+1,c-1);return fI(o.get(m,y),o.get(v,y),o.get(m,C),o.get(v,C),h-m,p-y)}let nz={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function rz(i,e,o){return(256*i*256+256*e+o)/10-1e4}function oz(i,e,o){return 256*i+e+o/256-32768}class Ky{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,o,c,h=!1){if(this.uid=e,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return Qn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;let p=this.dim=o.height-2,m=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let v=0;v<p;v++)m[this._idx(-1,v)]=m[this._idx(0,v)],m[this._idx(p,v)]=m[this._idx(p-1,v)],m[this._idx(v,-1)]=m[this._idx(v,0)],m[this._idx(v,p)]=m[this._idx(v,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}let y=c==="terrarium"?oz:rz;for(let v=0;v<m.length;++v){let C=4*v;this.floatView[v]=y(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}this._timestamp=Rr.now()}_buildQuadTree(){this._tree=new mI(this)}get(e,o,c=!1){c&&(e=yi(e,-1,this.dim),o=yi(o,-1,this.dim));let h=this._idx(e,o);return this.floatView[h]}set(e,o,c){let h=this._idx(e,o),p=this.floatView[h];return this.floatView[h]=c,c-p}static getUnpackVector(e){return nz[e]}_idx(e,o){if(e<-1||e>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(e+1)}static pack(e,o){let c=[0,0,0,0],h=Ky.getUnpackVector(o),p=Math.floor((e+h[3])/h[2]);return c[2]=p%256,p=Math.floor(p/256),c[1]=p%256,p=Math.floor(p/256),c[0]=p,c}getPixels(){return new GT({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,o,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=o*this.dim,p=o*this.dim+this.dim,m=c*this.dim,y=c*this.dim+this.dim;switch(o){case-1:h=p-1;break;case 1:p=h+1}switch(c){case-1:m=y-1;break;case 1:y=m+1}let v=-o*this.dim,C=-c*this.dim;for(let T=m;T<y;T++)for(let E=h;E<p;E++){let D=4*this._idx(E,T),O=4*this._idx(E+v,T+C);this.pixels[D+0]=e.pixels[O+0],this.pixels[D+1]=e.pixels[O+1],this.pixels[D+2]=e.pixels[O+2],this.pixels[D+3]=e.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ne(Ky,"DEMData"),ne(mI,"DemMinMaxQuadTree",{omit:["dem"]});class Up{constructor(e,o,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=o,this._offset=c}static create(e,o,c){let h=c||e.findDEMTileFor(o);if(!h||!h.dem)return;let p=h.dem,m=h.tileID,y=1<<o.canonical.z-m.canonical.z;return new Up(h,p.dim/pt/y,[(o.canonical.x/y-m.canonical.x)*p.dim,(o.canonical.y/y-m.canonical.y)*p.dim])}tileCoordToPixel(e,o){let c=o*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(c);return new vt(h,p)}getElevationAt(e,o,c,h){let p=e*this._scale+this._offset[0],m=o*this._scale+this._offset[1],y=Math.floor(p),v=Math.floor(m),C=this._dem;return h=!!h,c?Gt(Gt(C.get(y,v,h),C.get(y,v+1,h),m-v),Gt(C.get(y+1,v,h),C.get(y+1,v+1,h),m-v),p-y):C.get(y,v,h)}getElevationAtPixel(e,o,c){return this._dem.get(e,o,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Po(1,e)*this._dem.stride}}let gI={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},az=Yy.types,sz=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],lz=["fill-extrusion-flood-light-ground-radius"],cz=Math.pow(2,13),dz=Math.pow(2,15)-1,_I=new vt(0,1),md=2147483648;function Og(i,e,o,c,h,p,m,y){i.emplaceBack((e<<1)+m,(o<<1)+p,(Math.floor(c*cz)<<1)+h,Math.round(y))}function Qy(i,e,o,c,h,p){i.emplaceBack(e.x,e.y,(o.x<<1)+c,(o.y<<1)+h,p)}function Rg(i,e,o){i.emplaceBack(e.x,e.y,e.z,o[0]*16384,o[1]*16384,o[2]*16384)}class yI{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class bI{constructor(){this.centroidXY=new vt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new vt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new vt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new vt(this.max.x-this.min.x,this.max.y-this.min.y)}}class vI{constructor(){this.acc=new vt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,o){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=o.x,e.min.y=e.max.y=o.y)}appendEdge(e,o,c){this.accCount++,this.acc._add(o);let h=!!this.borders;o.x<e.min.x?(e.min.x=o.x,h=!0):o.x>e.max.x&&(e.max.x=o.x,h=!0),o.y<e.min.y?(e.min.y=o.y,h=!0):o.y>e.max.y&&(e.max.y=o.y,h=!0),((o.x===0||o.x===pt)&&o.x===c.x)!=((o.y===0||o.y===pt)&&o.y===c.y)&&this.processBorderOverlap(o,c),h&&this.checkBorderIntersection(o,c)}checkBorderIntersection(e,o){o.x<0!=e.x<0&&this.addBorderIntersection(0,Gt(o.y,e.y,(0-o.x)/(e.x-o.x))),o.x>pt!=e.x>pt&&this.addBorderIntersection(1,Gt(o.y,e.y,(pt-o.x)/(e.x-o.x))),o.y<0!=e.y<0&&this.addBorderIntersection(2,Gt(o.x,e.x,(0-o.y)/(e.y-o.y))),o.y>pt!=e.y>pt&&this.addBorderIntersection(3,Gt(o.x,e.x,(pt-o.y)/(e.y-o.y)))}addBorderIntersection(e,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let c=this.borders[e];o<c[0]&&(c[0]=o),o>c[1]&&(c[1]=o)}processBorderOverlap(e,o){if(e.x===o.x){if(e.y===o.y)return;let c=e.x===0?0:1;this.addBorderIntersection(c,o.y),this.addBorderIntersection(c,e.y)}else{let c=e.y===0?2:3;this.addBorderIntersection(c,o.x),this.addBorderIntersection(c,e.x)}}centroid(){return this.accCount===0?new vt(0,0):new vt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,o)=>e+ +(o[0]!==Number.MAX_VALUE),0):0}}function xI(i,e){let o=i.add(e)._unit(),c=yi(i.x*o.x+i.y*o.y,-1,1);var h,p,m;return h=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(h)))/4*dz*((p=i).x*(m=e).y-p.y*m.x<0?-1:1)}let hz=[i=>i.x<0,i=>i.x>pt,i=>i.y<0,i=>i.y>pt];function uz(i,e,o,c){let h=[4];if(c===0)return h;o._mult(c);let p=i.sub(o),m=e.sub(o),y=[i,e,p,m];for(let v=0;v<4;v++)for(let C of y)if(hz[v](C)){h.push(v);break}return h}class wI{constructor(e){this.vertexArray=new g1,this.indexArray=new Ir,this.programConfigurations=new cd(e.layers,{zoom:e.zoom,lut:e.lut},o=>lz.includes(o)),this._segments=new Rn,this.hiddenByLandmarkVertexArray=new k1,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Rn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,o,c,h=!1){let p=e.length;if(p>2){let m=Math.max(0,this._segments.get().length-1),y=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length),v;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{let C=e[0],T=e[1];v=xI(C.sub(e[p-1])._perp()._unit(),T.sub(C)._perp()._unit())}for(let C=0;C<p;C++){let T=C===p-1?0:C+1,E=e[C],D=e[T],O=e[T===p-1?0:T+1],R=D.sub(E)._perp()._unit(),z=xI(R,O.sub(D)._perp()._unit()),N=v,W=z;if(uw(E,D,o)||h&&MI(E,o)&&MI(D,o)){v=z;continue}let ee=y.vertexLength;Qy(this.vertexArray,E,D,1,1,N),Qy(this.vertexArray,E,D,1,0,N),Qy(this.vertexArray,E,D,0,1,W),Qy(this.vertexArray,E,D,0,0,W),y.vertexLength+=4;let te=uz(E,D,R,c);for(let ie of te)this._segmentToGroundQuads[m].push({id:ee,region:ie}),this._segmentToRegionTriCounts[m][ie]+=2,y.primitiveLength+=2;v=z}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),o=e.length;for(let c=0;c<o;c++)this._segmentToGroundQuads[c].sort((h,p)=>h.region-p.region);for(let c=0;c<o;c++){let h=this._segmentToGroundQuads[c],p=e[c],m=this._segmentToRegionTriCounts[c];m.reduce((v,C)=>v+C,0);let y=0;for(let v=0;v<=4;v++){let C=m[v];if(C!==0){let T=this.regionSegments[v];T||(T=this.regionSegments[v]=new Rn);let E={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+y,vertexLength:p.vertexLength,primitiveLength:C};T.get().push(E)}y+=C}for(let v=0;v<h.length;v++){let C=h[v].id;this.indexArray.emplaceBack(C,C+1,C+3),this.indexArray.emplaceBack(C,C+3,C+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,o,c,h,p,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,o,c,h,p,m)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,W3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,o,c,h,p,m){this.hasData()&&this.programConfigurations.updatePaintArrays(e,o,c,h,p,m)}updateHiddenByLandmark(e){if(!this.hasData())return;let o=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let c=e.flags&md?1:0;for(let h=e.groundVertexArrayOffset;h<o;++h)this.hiddenByLandmarkVertexArray.emplace(h,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,$3.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let o=this.regionSegments[e];o&&o.destroy()}}}}class Jy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ir,this.footprintVertices=new ms,this.footprintSegments=[],this.layoutVertexArray=new nd,this.centroidVertexArray=new sT,this.indexArray=new Ir,this.programConfigurations=new cd(e.layers,{zoom:e.zoom,lut:e.lut},o=>sz.includes(o)),this.segments=new Rn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new wI(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,o){}populate(e,o,c,h){this.features=[],this.hasPattern=aw("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Ry(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:p,id:m,index:y,sourceLayerIndex:v}of e){let C=this.layers[0]._featureFilter.needGeometry,T=Hl(p,C);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),T,c))continue;let E={id:m,sourceLayerIndex:v,index:y,geometry:C?T.geometry:gs(p,c,h),properties:p.properties,type:p.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(sw("fill-extrusion",this.layers,E,this.zoom,o)):this.addFeature(E,E.geometry,y,c,{},o.availableImages,h,o.brightness),o.featureIndex.insert(p,E.geometry,y,v,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,o,c,h,p,m){for(let y of this.features){let{geometry:v}=y;this.addFeature(y,v,y.index,o,c,h,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,o,c,h,p){let m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;let y=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,o,y,c,h,p),this.groundEffect.update(e,o,y,c,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Y3),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,q3.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,G3.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,o,c,h,p,m,y,v){let C=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,T=[new vt(0,0),new vt(pt,pt)],E=y.projection,D=E.name==="globe",O=az[e.type]==="Polygon",R=new vI;R.centroidDataIndex=this.centroidData.length;let z=new bI,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},h)<=0,W=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},h);z.height=W,z.vertexArrayOffset=this.layoutVertexArray.length,z.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Dy);let ee=Gy(o,500);for(let Ce=ee.length-1;Ce>=0;Ce--){let Ae=ee[Ce];(Ae.length===0||(te=Ae[0]).every(je=>je.x<=0)||te.every(je=>je.x>=pt)||te.every(je=>je.y<=0)||te.every(je=>je.y>=pt))&&ee.splice(Ce,1)}var te;let ie;if(D)ie=DI(ee,T,h);else{ie=[];for(let Ce of ee)ie.push({polygon:Ce,bounds:T})}let pe=O?this.edgeRadius:0,he=pe>0&&this.zoom<17,ve=(Ce,Ae)=>{if(Ce.length===0)return!1;let je=Ce[Ce.length-1];return Ae.x===je.x&&Ae.y===je.y};for(let{polygon:Ce,bounds:Ae}of ie){let je=0,Le=0;for(let et of Ce)O&&!et[0].equals(et[et.length-1])&&et.push(et[0]),Le+=O?et.length-1:et.length;let qe=this.segments.prepareSegment((O?5:4)*Le,this.layoutVertexArray,this.indexArray);z.footprintSegIdx<0&&(z.footprintSegIdx=this.footprintSegments.length),z.polygonSegIdx<0&&(z.polygonSegIdx=this.polygonSegments.length);let ot={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ge=new yI;if(Ge.vertexOffset=this.footprintVertices.length,Ge.indexOffset=3*this.footprintIndices.length,Ge.ringIndices=[],O){let et=[],Ue=[];je=qe.vertexLength;for(let lt=0;lt<Ce.length;lt++){let nt=Ce[lt];nt.length&&lt!==0&&Ue.push(et.length/2);let Ct=[],at,ht;at=nt[1].sub(nt[0])._perp()._unit(),Ge.ringIndices.push(nt.length-1);for(let Ut=1;Ut<nt.length;Ut++){let Bt=nt[Ut],Rt=nt[Ut===nt.length-1?1:Ut+1],ct=Bt.clone();if(pe){ht=Rt.sub(Bt)._perp()._unit();let Ht=at.add(ht)._unit(),ui=pe*Math.min(4,1/(at.x*Ht.x+at.y*Ht.y));ct.x+=ui*Ht.x,ct.y+=ui*Ht.y,ct.x=Math.round(ct.x),ct.y=Math.round(ct.y),at=ht}!N||pe!==0&&!he||ve(Ct,ct)||Ct.push(ct),Og(this.layoutVertexArray,ct.x,ct.y,0,0,1,1,0),qe.vertexLength++,this.footprintVertices.emplaceBack(Bt.x,Bt.y),et.push(Bt.x,Bt.y),D&&Rg(this.layoutVertexExtArray,E.projectTilePoint(ct.x,ct.y,h),E.upVector(h,ct.x,ct.y))}N&&(pe===0||he)&&(Ct.length!==0&&ve(Ct,Ct[0])&&Ct.pop(),this.groundEffect.addData(Ct,Ae,C))}let tt=Dg(et,Ue);for(let lt=0;lt<tt.length;lt+=3)this.footprintIndices.emplaceBack(Ge.vertexOffset+tt[lt+0],Ge.vertexOffset+tt[lt+1],Ge.vertexOffset+tt[lt+2]),this.indexArray.emplaceBack(je+tt[lt],je+tt[lt+2],je+tt[lt+1]),qe.primitiveLength++;Ge.indexCount+=tt.length,Ge.vertexCount+=this.footprintVertices.length-Ge.vertexOffset}for(let et=0;et<Ce.length;et++){let Ue=Ce[et];R.startRing(z,Ue[0]);let tt=Ue.length>4&&TI(Ue[Ue.length-2],Ue[0],Ue[1]),lt=pe?pz(Ue[Ue.length-2],Ue[0],Ue[1],pe):0,nt=[],Ct,at,ht;at=Ue[1].sub(Ue[0])._perp()._unit();let Ut=!0;for(let Bt=1,Rt=0;Bt<Ue.length;Bt++){let ct=Ue[Bt-1],Ht=Ue[Bt],ui=Ue[Bt===Ue.length-1?1:Bt+1];if(R.appendEdge(z,Ht,ct),uw(Ht,ct,Ae)){pe&&(at=ui.sub(Ht)._perp()._unit(),Ut=!Ut);continue}let Kt=Ht.sub(ct)._perp(),fi=Kt.x/(Math.abs(Kt.x)+Math.abs(Kt.y)),pi=Kt.y>0?1:0,wi=ct.dist(Ht);if(Rt+wi>32768&&(Rt=0),pe){ht=ui.sub(Ht)._perp()._unit();let qi=SI(ct,Ht,ui,CI(at,ht),pe);isNaN(qi)&&(qi=0);let Bi=Ht.sub(ct)._unit();ct=ct.add(Bi.mult(lt))._round(),Ht=Ht.add(Bi.mult(-qi))._round(),lt=qi,at=ht,N&&this.zoom>=17&&(ve(nt,ct)||nt.push(ct),ve(nt,Ht)||nt.push(Ht))}let qt=qe.vertexLength,un=Ue.length>4&&TI(ct,Ht,ui),cn=II(Rt,tt,Ut);if(Og(this.layoutVertexArray,ct.x,ct.y,fi,pi,0,0,cn),Og(this.layoutVertexArray,ct.x,ct.y,fi,pi,0,1,cn),Rt+=wi,cn=II(Rt,un,!Ut),tt=un,Og(this.layoutVertexArray,Ht.x,Ht.y,fi,pi,0,0,cn),Og(this.layoutVertexArray,Ht.x,Ht.y,fi,pi,0,1,cn),qe.vertexLength+=4,this.indexArray.emplaceBack(qt+0,qt+1,qt+2),this.indexArray.emplaceBack(qt+1,qt+3,qt+2),qe.primitiveLength+=2,pe){let qi=je+(Bt===1?Ue.length-2:Bt-2),Bi=Bt===1?je:qi+1;if(this.indexArray.emplaceBack(qt+1,qi,qt+3),this.indexArray.emplaceBack(qi,Bi,qt+3),qe.primitiveLength+=2,Ct===void 0&&(Ct=qt),!uw(ui,Ue[Bt],Ae)){let Yi=Bt===Ue.length-1?Ct:qe.vertexLength;this.indexArray.emplaceBack(qt+2,qt+3,Yi),this.indexArray.emplaceBack(qt+3,Yi+1,Yi),this.indexArray.emplaceBack(qt+3,Bi,Yi+1),qe.primitiveLength+=3}Ut=!Ut}if(D){let qi=this.layoutVertexExtArray,Bi=E.projectTilePoint(ct.x,ct.y,h),Yi=E.projectTilePoint(Ht.x,Ht.y,h),wn=E.upVector(h,ct.x,ct.y),yn=E.upVector(h,Ht.x,Ht.y);Rg(qi,Bi,wn),Rg(qi,Bi,wn),Rg(qi,Yi,yn),Rg(qi,Yi,yn)}}O&&(je+=Ue.length-1),N&&pe&&this.zoom>=17&&(nt.length!==0&&ve(nt,nt[0])&&nt.pop(),this.groundEffect.addData(nt,Ae,C,pe>0))}this.footprintSegments.push(Ge),ot.triangleCount=this.indexArray.length-ot.triangleArrayOffset,this.polygonSegments.push(ot),++z.footprintSegLen,++z.polygonSegLen}if(z.vertexCount=this.layoutVertexArray.length-z.vertexArrayOffset,z.groundVertexCount=this.groundEffect.vertexArray.length-z.groundVertexArrayOffset,z.vertexCount!==0){if(z.centroidXY=R.borders?_I:this.encodeCentroid(R,z),this.centroidData.push(z),R.borders){this.featuresOnBorder.push(R);let Ce=this.featuresOnBorder.length-1;for(let Ae=0;Ae<R.borders.length;Ae++)R.borders[Ae][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ae].push(Ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,p,m,h,v),this.groundEffect.addPaintPropertiesData(e,c,p,m,h,v),this.maxHeight=Math.max(this.maxHeight,W)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((o,c)=>this.featuresOnBorder[o].borders[e][0]-this.featuresOnBorder[c].borders[e][0])}splitToSubtiles(){let e=[];for(let y=0;y<this.centroidData.length;y++){let v=this.centroidData[y],C=+(v.min.y+v.max.y>pt),T=2*C+(+(v.min.x+v.max.x>pt)^C);for(let E=0;E<v.polygonSegLen;E++){let D=v.polygonSegIdx+E;e.push({centroidIdx:y,subtile:T,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}let o=new Ir;e.sort((y,v)=>y.triangleSegmentIdx===v.triangleSegmentIdx?y.subtile-v.subtile:y.triangleSegmentIdx-v.triangleSegmentIdx);let c=0,h=0,p=0;for(let y of e){if(y.triangleSegmentIdx!==c)break;p++}let m=e.length;for(;h!==e.length;){c=e[h].triangleSegmentIdx;let y=0,v=h,C=h;for(let T=v;T<p&&e[T].subtile===y;T++)C++;for(;v!==p;){let T=e[v];y=T.subtile;let E=this.centroidData[T.centroidIdx].min.clone(),D=this.centroidData[T.centroidIdx].max.clone(),O={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=v;R<C;R++){let z=e[R],N=this.polygonSegments[z.polygonSegmentIdx],W=this.centroidData[z.centroidIdx].min,ee=this.centroidData[z.centroidIdx].max,te=this.indexArray.uint16;for(let ie=N.triangleArrayOffset;ie<N.triangleArrayOffset+N.triangleCount;ie++)o.emplaceBack(te[3*ie],te[3*ie+1],te[3*ie+2]);O.primitiveLength+=N.triangleCount,E.x=Math.min(E.x,W.x),E.y=Math.min(E.y,W.y),D.x=Math.max(D.x,ee.x),D.y=Math.max(D.y,ee.y)}O.primitiveLength>0&&this.triangleSubSegments.push({segment:O,min:E,max:D}),v=C;for(let R=v;R<p&&e[R].subtile===e[v].subtile;R++)C++}h=p;for(let T=h;T<m&&e[T].triangleSegmentIdx===e[h].triangleSegmentIdx;T++)p++}o._trim(),this.indexArray=o}getVisibleSegments(e,o,c){let h=0,p=0,m=1<<e.canonical.z;if(o){let z=o.getMinMaxForTile(e);z&&(h=z.min,p=z.max)}p+=this.maxHeight;let y=e.toUnwrapped(),v,C=[y.canonical.x/m+y.wrap,y.canonical.y/m],T=[(y.canonical.x+1)/m+y.wrap,(y.canonical.y+1)/m],E=new Rn,D=(z,N,W)=>[z[0]*(1-W[0])+N[0]*W[0],z[1]*(1-W[1])+N[1]*W[1]],O=[],R=[];for(let z of this.triangleSubSegments){O[0]=z.min.x/pt,O[1]=z.min.y/pt,R[0]=z.max.x/pt,R[1]=z.max.y/pt;let N=D(C,T,O),W=D(C,T,R);if(new Fn([N[0],N[1],h],[W[0],W[1],p]).intersectsPrecise(c)===0){v&&(E.segments.push(v),v=void 0);continue}let ee=z.segment;v&&v.vertexOffset!==ee.vertexOffset&&(E.segments.push(v),v=void 0),v?(v.vertexLength+=ee.vertexLength,v.primitiveLength+=ee.primitiveLength):v={vertexOffset:ee.vertexOffset,primitiveLength:ee.primitiveLength,vertexLength:ee.vertexLength,primitiveOffset:ee.primitiveOffset,sortKey:void 0,vaos:{}}}return v&&E.segments.push(v),E}encodeCentroid(e,o){let c=e.centroid(),h=o.span(),p=Math.min(7,Math.round(h.x*this.tileToMeter/10)),m=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new vt(yi(c.x,1,pt-1)<<3|p,yi(c.y,1,pt-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new vt(0,0);let o=e.borders,c=Number.MAX_VALUE;if(o[0][0]!==c||o[1][0]!==c){let h=o[0][0]!==c?0:1;return new vt(6|(o[0][0]!==c?0:65528),(o[h][0]+o[h][1])/2<<3|6)}{let h=o[2][0]!==c?2:3;return new vt((o[h][0]+o[h][1])/2<<3|6,6|(o[2][0]!==c?0:65528))}}showCentroid(e){let o=this.centroidData[e.centroidDataIndex];o.flags&=md,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let o=e.vertexArrayOffset,c=e.vertexCount+e.vertexArrayOffset,h=e.flags&md?_I:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==h.y||p!==h.x){for(let m=o;m<c;++m)this.centroidVertexArray.emplace(m,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,o,c){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;let h=o.getReplacementRegionsForTile(e.toUnwrapped());if(hw(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let m of this.centroidData)m.flags&=2147483647;let p=[];for(let m of this.activeReplacements){if(m.order<c)continue;let y=Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z);for(let v of this.centroidData)if(!(v.flags&md||m.min.x>v.max.x||v.min.x>m.max.x||m.min.y>v.max.y||v.min.y>m.max.y))for(let C=0;C<v.footprintSegLen;C++){let T=this.footprintSegments[v.footprintSegIdx+C];if(p.length=0,mz(this.footprintVertices,T.vertexOffset,T.vertexCount,m.footprintTileId.canonical,e.canonical,p),oI(m.footprint,p,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-y)){v.flags|=md;break}}}for(let m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,o,c){let h=!1;for(let p=0;p<c.footprintSegLen;p++){let m=this.footprintSegments[c.footprintSegIdx+p],y=0;for(let v of m.ringIndices){for(let C=y,T=v+y-1;C<v+y;T=C++){let E=this.footprintVertices.int16[2*(C+m.vertexOffset)+0],D=this.footprintVertices.int16[2*(C+m.vertexOffset)+1],O=this.footprintVertices.int16[2*(T+m.vertexOffset)+1];D>o!=O>o&&e<(this.footprintVertices.int16[2*(T+m.vertexOffset)+0]-E)*(o-D)/(O-D)+E&&(h=!h)}y=v}}return h}getHeightAtTileCoord(e,o){let c=Number.NEGATIVE_INFINITY,h=!0,p=4*(e+pt)*pt+(o+pt);if(this.partLookup.hasOwnProperty(p)){let m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&md)}:void 0}for(let m of this.centroidData)e>m.max.x||m.min.x>e||o>m.max.y||m.min.y>o||this.footprintContainsPoint(e,o,m)&&m&&m.height>c&&(c=m.height,this.partLookup[p]=m,h=!!(m.flags&md));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:h};this.partLookup[p]=void 0}}function CI(i,e){let o=i.add(e)._unit();return i.x*o.x+i.y*o.y}function pz(i,e,o,c){let h=e.sub(i)._perp()._unit(),p=o.sub(e)._perp()._unit();return SI(i,e,o,CI(h,p),c)}function SI(i,e,o,c,h){let p=Math.sqrt(1-c*c);return Math.min(i.dist(e)/3,e.dist(o)/3,h*p/c)}function uw(i,e,o){return i.x<o[0].x&&e.x<o[0].x||i.x>o[1].x&&e.x>o[1].x||i.y<o[0].y&&e.y<o[0].y||i.y>o[1].y&&e.y>o[1].y}function MI(i,e){return i.x<e[0].x||i.x>e[1].x||i.y<e[0].y||i.y>e[1].y}function TI(i,e,o){if(i.x<0||i.x>=pt||e.x<0||e.x>=pt||o.x<0||o.x>=pt)return!1;let c=o.sub(e),h=c.perp(),p=i.sub(e);return(c.x*p.x+c.y*p.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function II(i,e,o){let c=e?2|i:-3&i;return o?1|c:-2&c}function EI(){let i=Math.PI/32,e=Math.tan(i),o=zp;return o*Math.sqrt(1+2*e*e)-o}function DI(i,e,o){let c=1<<o.z,h=Wo(o.x/c),p=Wo((o.x+1)/c),m=zr(o.y/c),y=zr((o.y+1)/c);return function(v,C,T,E,D=0,O){let R=[];if(!v.length||!T||!E)return R;let z=(he,ve)=>{for(let Ce of he)R.push({polygon:Ce,bounds:ve})},N=Math.ceil(Math.log2(T)),W=Math.ceil(Math.log2(E)),ee=N-W,te=[];for(let he=0;he<Math.abs(ee);he++)te.push(ee>0?0:1);for(let he=0;he<Math.min(N,W);he++)te.push(0),te.push(1);let ie=v;if(ie=Zy(ie,C[0].y-D,C[1].y+D,1),ie=Zy(ie,C[0].x-D,C[1].x+D,0),!ie.length)return R;let pe=[];for(te.length?pe.push({polygons:ie,bounds:C,depth:0}):z(ie,C);pe.length;){let he=pe.pop(),ve=he.depth,Ce=te[ve],Ae=he.bounds[0],je=he.bounds[1],Le=Ce===0?Ae.x:Ae.y,qe=Ce===0?je.x:je.y,ot=O?O(Ce,Le,qe):.5*(Le+qe),Ge=Zy(he.polygons,Le-D,ot+D,Ce),et=Zy(he.polygons,ot-D,qe+D,Ce);if(Ge.length){let Ue=[Ae,new vt(Ce===0?ot:je.x,Ce===1?ot:je.y)];te.length>ve+1?pe.push({polygons:Ge,bounds:Ue,depth:ve+1}):z(Ge,Ue)}if(et.length){let Ue=[new vt(Ce===0?ot:Ae.x,Ce===1?ot:Ae.y),je];te.length>ve+1?pe.push({polygons:et,bounds:Ue,depth:ve+1}):z(et,Ue)}}return R}(i,e,Math.ceil((p-h)/11.25),Math.ceil((m-y)/11.25),1,(v,C,T)=>{if(v===0)return .5*(C+T);{let E=zr((o.y+C/pt)/c);return(Zs(.5*(zr((o.y+T/pt)/c)+E))*c-o.y)*pt}})}function mz(i,e,o,c,h,p){let m=Math.pow(2,c.z-h.z);for(let y=0;y<o;y++){let v=i.int16[2*(y+e)+0],C=i.int16[2*(y+e)+1];v=(v+h.x*pt)*m-c.x*pt,C=(C+h.y*pt)*m-c.y*pt,p.push(new vt(v,C))}}ne(Jy,"FillExtrusionBucket",{omit:["layers","features"]}),ne(bI,"PartData"),ne(yI,"FootprintSegment"),ne(vI,"BorderCentroidData"),ne(wI,"GroundEffect");let fz=new Qi({visibility:new Qe(Pe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Qe(Pe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var gz={paint:new Qi({"fill-extrusion-opacity":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Qe(Pe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:fz};function Fg(i,e){return i.x*e.x+i.y*e.y}function kI(i,e){if(i.length===1){let o=0,c=e[o++],h;for(;!h||c.equals(h);)if(h=e[o++],!h)return 1/0;for(;o<e.length;o++){let p=e[o],m=i[0],y=h.sub(c),v=p.sub(c),C=m.sub(c),T=Fg(y,y),E=Fg(y,v),D=Fg(v,v),O=Fg(C,y),R=Fg(C,v),z=T*D-E*E,N=(D*O-E*R)/z,W=(T*R-E*O)/z,ee=c.z*(1-N-W)+h.z*N+p.z*W;if(isFinite(ee))return ee}return 1/0}{let o=1/0;for(let c of e)o=Math.min(o,c.z);return o}}function AI(i,e,o,c,h,p,m,y){let v=m*h.getElevationAt(i,e,!0,!0),C=p[0]!==0,T=C?p[1]===0?m*(p[0]/7-450):m*function(E,D,O){let R=Math.floor(D[0]/8),z=Math.floor(D[1]/8),N=10*(D[0]-8*R),W=10*(D[1]-8*z),ee=E.getElevationAt(R,z,!0,!0),te=E.getMeterToDEM(O),ie=Math.floor(.5*(N*te-1)),pe=Math.floor(.5*(W*te-1)),he=E.tileCoordToPixel(R,z),ve=2*ie+1,Ce=2*pe+1,Ae=function(et,Ue,tt,lt,nt){return[et.getElevationAtPixel(Ue,tt,!0),et.getElevationAtPixel(Ue+nt,tt,!0),et.getElevationAtPixel(Ue,tt+nt,!0),et.getElevationAtPixel(Ue+lt,tt+nt,!0)]}(E,he.x-ie,he.y-pe,ve,Ce),je=Math.abs(Ae[0]-Ae[1]),Le=Math.abs(Ae[2]-Ae[3]),qe=Math.abs(Ae[0]-Ae[2])+Math.abs(Ae[1]-Ae[3]),ot=Math.min(.25,.5*te*(je+Le)/ve),Ge=Math.min(.25,.5*te*qe/Ce);return ee+Math.max(ot*N,Ge*W)}(h,p,y):v;return{base:v+(o===0)?-1:o,top:C?Math.max(T+c,v+o+2):v+c}}let _z=Ji([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:yz}=_z,bz=Ji([{name:"a_packed",components:4,type:"Float32"}]),{members:vz}=bz,xz=Ji([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:wz}=xz,Cz=Ji([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sz=Ji([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Mz=Ji([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ji([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let pw=Ji([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),PI=Ji([{name:"a_z_offset",components:1,type:"Float32"}],4),Tz=Ji([{name:"a_texb",components:2,type:"Uint16"}]),Iz=Ji([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ez=Ji([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Ji([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let OI=Ji([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Dz=Ji([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ji([{name:"triangle",components:3,type:"Uint16"}]),Ji([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ji([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),Ji([{type:"Float32",name:"offsetX"}]),Ji([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class RI{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.image=new ud({width:e,height:o}),this.positions={},this.uploaded=!1}getDash(e,o){let c=this.getKey(e,o);return this.positions[c]}trim(){let e=this.width,o=this.height=wf(this.nextRow);this.image.resize({width:e,height:o})}getKey(e,o){return e.join(",")+o}getDashRanges(e,o,c){let h=[],p=e.length%2==1?-e[e.length-1]*c:0,m=e[0]*c,y=!0;h.push({left:p,right:m,isDash:y,zeroLength:e[0]===0});let v=e[0];for(let C=1;C<e.length;C++){y=!y;let T=e[C];p=v*c,v+=T,m=v*c,h.push({left:p,right:m,isDash:y,zeroLength:T===0})}return h}addRoundDash(e,o,c){let h=o/2;for(let p=-c;p<=c;p++){let m=this.width*(this.nextRow+c+p),y=0,v=e[y];for(let C=0;C<this.width;C++){C/v.right>1&&(v=e[++y]);let T=Math.abs(C-v.left),E=Math.abs(C-v.right),D=Math.min(T,E),O,R=p/c*(h+1);if(v.isDash){let z=h-Math.abs(R);O=Math.sqrt(D*D+z*z)}else O=h-Math.sqrt(D*D+R*R);this.image.data[m+C]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e,o){for(let v=e.length-1;v>=0;--v){let C=e[v],T=e[v+1];C.zeroLength?e.splice(v,1):T&&T.isDash===C.isDash&&(T.left=C.left,e.splice(v,1))}let c=e[0],h=e[e.length-1];c.isDash===h.isDash&&(c.left=h.left-this.width,h.right=c.right+this.width);let p=this.width*this.nextRow,m=0,y=e[m];for(let v=0;v<this.width;v++){v/y.right>1&&(y=e[++m]);let C=Math.abs(v-y.left),T=Math.abs(v-y.right),E=Math.min(C,T);this.image.data[p+v]=Math.max(0,Math.min(255,(y.isDash?E:-E)+o+128))}}addDash(e,o){let c=this.getKey(e,o);if(this.positions[c])return this.positions[c];let h=o==="round",p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return Qn("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let T=0;T<e.length;T++)e[T]<0&&(Qn("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),y+=e[T];if(y!==0){let T=this.width/y,E=this.getDashRanges(e,this.width,T);h?this.addRoundDash(E,T,p):this.addRegularDash(E,o==="square"?.5*T:0)}let v=this.nextRow+p;this.nextRow+=m;let C={tl:[v,p],br:[y,0]};return this.positions[c]=C,C}}ne(RI,"LineAtlas");let kz=Yy.types,Az=Math.cos(Math.PI/180*37.5),Pz=Math.cos(Math.PI/180*5);class eb{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new _1,this.layoutVertexArray2=new rd,this.patternVertexArray=new od,this.indexArray=new Ir,this.programConfigurations=new cd(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Rn,this.maxLineLength=0,this.zOffsetVertexArray=new Zh,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:pt/64}updateFootprints(e,o){}populate(e,o,c,h){this.hasPattern=aw("line",this.layers,o);let p=this.layers[0].layout.get("line-sort-key"),m=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!m.isConstant()||!!m.constantOr(0);let y=[];for(let{feature:E,id:D,index:O,sourceLayerIndex:R}of e){let z=this.layers[0]._featureFilter.needGeometry,N=Hl(E,z);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),N,c))continue;let W=p?p.evaluate(N,{},c):void 0,ee={id:D,properties:E.properties,type:E.type,sourceLayerIndex:R,index:O,geometry:z?N.geometry:gs(E,c,h),patterns:{},sortKey:W};y.push(ee)}p&&y.sort((E,D)=>E.sortKey-D.sortKey);let{lineAtlas:v,featureIndex:C}=o,T=this.addConstantDashes(v);for(let E of y){let{geometry:D,index:O,sourceLayerIndex:R}=E;if(T&&this.addFeatureDashes(E,v),this.hasPattern){let z=sw("line",this.layers,E,this.zoom,o);this.patternFeatures.push(z)}else this.addFeature(E,D,O,c,v.positions,o.availableImages,o.brightness);C.insert(e[O].feature,D,O,R,this.index)}}addConstantDashes(e){let o=!1;for(let c of this.layers){let h=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")o=!0;else{let m=p.value,y=h.value;if(!y)continue;e.addDash(y,m)}}return o}addFeatureDashes(e,o){let c=this.zoom;for(let h of this.layers){let p=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let y,v;if(p.kind==="constant"){if(y=p.value,!y)continue}else y=p.evaluate({zoom:c},e);v=m.kind==="constant"?m.value:m.evaluate({zoom:c},e),o.addDash(y,v),e.patterns[h.id]=o.getKey(y,v)}}update(e,o,c,h,p){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,o,m?this.stateDependentLayers:this.layers,c,h,p)}addFeatures(e,o,c,h,p,m){for(let y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,o,c,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,vz)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,wz)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,PI.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yz),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,o,c,h,p,m,y){let v=this.layers[0].layout,C=v.get("line-join").evaluate(e,{}),T=v.get("line-cap").evaluate(e,{}),E=v.get("line-miter-limit"),D=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let O of o)this.addLine(O,e,h,C,T,E,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,p,m,h,y)}addLine(e,o,c,h,p,m,y){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let v={zoom:this.zoom,lineProgress:void 0},C=this.layers[0].layout,T=h==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<e.length-1;he++)this.totalDistance+=e[he].dist(e[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let E=kz[o.type]==="Polygon",D=e.length;for(;D>=2&&e[D-1].equals(e[D-2]);)D--;let O=0;for(;O<D-1&&e[O].equals(e[O+1]);)O++;if(D<(E?3:2))return;h==="bevel"&&(m=1.05);let R=this.overscaling<=16?15*pt/(512*this.overscaling):0,z=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),N,W,ee,te,ie,pe;this.e1=this.e2=-1,E&&(N=e[D-2],ie=e[O].sub(N)._unit()._perp());for(let he=O;he<D;he++){if(ee=he===D-1?E?e[O+1]:void 0:e[he+1],ee&&e[he].equals(ee))continue;if(ie&&(te=ie),N&&(W=N),N=e[he],this.hasZOffset){let Ue=C.get("line-z-offset").value;if(Ue.kind==="constant")pe=Ue.value;else{if(this.lineClips){let tt=this.totalDistance/(this.lineClips.end-this.lineClips.start);v.lineProgress=(tt*this.lineClips.start+this.distance+(W?W.dist(N):0))/tt}else Qn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),v.lineProgress=0;pe=Ue.evaluate(v,o)}pe=pe||0}ie=ee?ee.sub(N)._unit()._perp():te,te=te||ie;let ve=W&&ee,Ce=ve?h:E||T?"butt":p,Ae=te.x*ie.x+te.y*ie.y;if(T){let Ue=function(tt){if(tt.patternJoinNone){let lt=tt.segmentPoints.length/2,nt=tt.lineSoFar-tt.segmentStart;for(let Ct=0;Ct<lt;++Ct){let at=tt.segmentPoints[2*Ct+1],ht=Math.round(tt.segmentPoints[2*Ct])+.5+.25*at;tt.patternVertexArray.emplaceBack(ht,nt,tt.segmentStart),tt.patternVertexArray.emplaceBack(ht,nt,tt.segmentStart)}tt.segmentPoints.length=0}tt.e1=tt.e2=-1};if(ve&&Ae<Pz){this.updateDistance(W,N),this.addCurrentVertex(N,te,1,1,z,pe),Ue(this),this.addCurrentVertex(N,ie,-1,-1,z,pe);continue}if(W){if(!ee){this.updateDistance(W,N),this.addCurrentVertex(N,te,1,1,z,pe),Ue(this);continue}Ce="miter"}}let je=te.add(ie);je.x===0&&je.y===0||je._unit();let Le=je.x*ie.x+je.y*ie.y,qe=Le!==0?1/Le:1/0,ot=2*Math.sqrt(2-2*Le),Ge=Le<Az&&W&&ee,et=te.x*ie.y-te.y*ie.x>0;if(Ge&&he>O){let Ue=N.dist(W);if(Ue>2*R){let tt=N.sub(N.sub(W)._mult(R/Ue)._round());this.updateDistance(W,tt),this.addCurrentVertex(tt,te,0,0,z,pe),W=tt}}if(ve&&Ce==="round"&&(qe<y?Ce="miter":qe<=2&&(Ce="fakeround")),Ce==="miter"&&qe>m&&(Ce="bevel"),Ce==="bevel"&&(qe>2&&(Ce="flipbevel"),qe<m&&(Ce="miter")),W&&this.updateDistance(W,N),Ce==="miter")je._mult(qe),this.addCurrentVertex(N,je,0,0,z,pe);else if(Ce==="flipbevel"){if(qe>100)je=ie.mult(-1);else{let Ue=qe*te.add(ie).mag()/te.sub(ie).mag();je._perp()._mult(Ue*(et?-1:1))}this.addCurrentVertex(N,je,0,0,z,pe),this.addCurrentVertex(N,je.mult(-1),0,0,z,pe)}else if(Ce==="bevel"||Ce==="fakeround"){let Ue=-Math.sqrt(qe*qe-1),tt=et?Ue:0,lt=et?0:Ue;if(W&&this.addCurrentVertex(N,te,tt,lt,z,pe),Ce==="fakeround"){let nt=Math.round(180*ot/Math.PI/20);for(let Ct=1;Ct<nt;Ct++){let at=Ct/nt;if(at!==.5){let Ut=at-.5;at+=at*Ut*(at-1)*((1.0904+Ae*(Ae*(3.55645-1.43519*Ae)-3.2452))*Ut*Ut+(.848013+Ae*(.215638*Ae-1.06021)))}let ht=ie.sub(te)._mult(at)._add(te)._unit()._mult(et?-1:1);this.addHalfVertex(N,ht.x,ht.y,!1,et,0,z,pe)}}ee&&this.addCurrentVertex(N,ie,-tt,-lt,z,pe)}else Ce==="butt"?this.addCurrentVertex(N,je,0,0,z,pe):Ce==="square"?(W||this.addCurrentVertex(N,je,-1,-1,z,pe),this.addCurrentVertex(N,je,0,0,z,pe),W&&this.addCurrentVertex(N,je,1,1,z,pe)):Ce==="round"&&(W&&(this.addCurrentVertex(N,te,0,0,z,pe),this.addCurrentVertex(N,te,1,1,z,pe,!0)),ee&&(this.addCurrentVertex(N,ie,-1,-1,z,pe,!0),this.addCurrentVertex(N,ie,0,0,z,pe)));if(Ge&&he<D-1){let Ue=N.dist(ee);if(Ue>2*R){let tt=N.add(ee.sub(N)._mult(R/Ue)._round());this.updateDistance(N,tt),this.addCurrentVertex(tt,ie,0,0,z,pe),N=tt}}}}addVerticesTo(e,o,c,h,p,m,y,v,C,T){let E=(o.w-e.w)/this.tessellationStep|0;if(E>1){this.lineSoFar=e.w;let D=(o.x-e.x)/E,O=(o.y-e.y)/E,R=(o.z-e.z)/E,z=(o.w-e.w)/E;for(let N=1;N<E;++N)e.x+=D,e.y+=O,e.z+=R,this.lineSoFar+=z,this.addHalfVertex(e,c,h,T,!1,y,C,e.z),this.addHalfVertex(e,p,m,T,!0,-v,C,e.z)}this.lineSoFar=o.w,this.addHalfVertex(o,c,h,T,!1,y,C,o.z),this.addHalfVertex(o,p,m,T,!0,-v,C,o.z)}addCurrentVertex(e,o,c,h,p,m,y=!1){let v=o.x+o.y*c,C=o.y-o.x*c,T=o.y*h-o.x,E=-o.y-o.x*h;if(m!=null){let O=pt+10,R=m,z=new eI(e.x,e.y,R,this.lineSoFar),N=FI(e,-10,O),W=this.lineSoFar;if(this.currentVertex)if(N){let ee=this.currentVertexIsOutside,te=this.currentVertex,ie=new eI(e.x,e.y,R,this.lineSoFar);iI(te,ie,-10,O),FI(ie,-10,O)||(ee&&(this.e1=this.e2=-1,this.lineSoFar=te.w,this.addHalfVertex(te,v,C,y,!1,c,p,te.z),this.addHalfVertex(te,T,E,y,!0,-h,p,te.z)),this.addVerticesTo(te,ie,v,C,T,E,c,h,p,y))}else{let ee=this.currentVertex;this.currentVertexIsOutside&&(iI(ee,z,-10,O),this.e1=this.e2=-1,this.lineSoFar=ee.w,this.addHalfVertex(ee,v,C,y,!1,c,p,ee.z),this.addHalfVertex(ee,T,E,y,!0,-h,p,ee.z)),this.addVerticesTo(ee,z,v,C,T,E,c,h,p,y)}else N||(this.addHalfVertex(e,v,C,y,!1,c,p,m),this.addHalfVertex(e,T,E,y,!0,-h,p,m));this.currentVertex=z,this.currentVertexIsOutside=N,this.lineSoFar=W}else this.addHalfVertex(e,v,C,y,!1,c,p,m),this.addHalfVertex(e,T,E,y,!0,-h,p,m)}addHalfVertex({x:e,y:o},c,h,p,m,y,v,C){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,y)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(o<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let T=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),v.primitiveLength++),m?this.e2=T:this.e1=T,C!=null&&this.zOffsetVertexArray.emplaceBack(C)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,o){this.distance+=e.dist(o),this.updateScaledDistance()}}function FI(i,e,o){return i.x<e||i.x>o||i.y<e||i.y>o}ne(eb,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let Oz=new Qi({"line-cap":new wt(Pe.layout_line["line-cap"]),"line-join":new wt(Pe.layout_line["line-join"]),"line-miter-limit":new Qe(Pe.layout_line["line-miter-limit"]),"line-round-limit":new Qe(Pe.layout_line["line-round-limit"]),"line-sort-key":new wt(Pe.layout_line["line-sort-key"]),"line-z-offset":new wt(Pe.layout_line["line-z-offset"]),visibility:new Qe(Pe.layout_line.visibility)});var tb={paint:new Qi({"line-opacity":new wt(Pe.paint_line["line-opacity"]),"line-color":new wt(Pe.paint_line["line-color"]),"line-translate":new Qe(Pe.paint_line["line-translate"]),"line-translate-anchor":new Qe(Pe.paint_line["line-translate-anchor"]),"line-width":new wt(Pe.paint_line["line-width"]),"line-gap-width":new wt(Pe.paint_line["line-gap-width"]),"line-offset":new wt(Pe.paint_line["line-offset"]),"line-blur":new wt(Pe.paint_line["line-blur"]),"line-dasharray":new wt(Pe.paint_line["line-dasharray"]),"line-pattern":new wt(Pe.paint_line["line-pattern"]),"line-gradient":new On(Pe.paint_line["line-gradient"]),"line-trim-offset":new Qe(Pe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Qe(Pe.paint_line["line-trim-fade-range"]),"line-trim-color":new Qe(Pe.paint_line["line-trim-color"]),"line-emissive-strength":new Qe(Pe.paint_line["line-emissive-strength"]),"line-border-width":new wt(Pe.paint_line["line-border-width"]),"line-border-color":new wt(Pe.paint_line["line-border-color"]),"line-occlusion-opacity":new Qe(Pe.paint_line["line-occlusion-opacity"])}),layout:Oz};function LI(i,e,o){return e*(pt/(i.tileSize*Math.pow(2,o-i.tileID.overscaledZ)))}function zI(i,e){return 1/LI(i,1,e.tileZoom)}function BI(i,e,o,c){return i.translatePosMatrix(c||e.tileID.projMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}let NI=i=>{let e=[];VI(i)&&e.push("RENDER_LINE_DASH"),i.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let o=i.paint.get("line-trim-offset");o[0]===0&&o[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),i.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let c=i.layout.get("line-join").constantOr("miter")==="none",h=!!i.paint.get("line-pattern").constantOr(1);return c&&h&&e.push("LINE_JOIN_NONE"),e};function VI(i){let e=i.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class jI{constructor(e){this._stringToNumber={},this._numberToString=[];for(let o=0;o<e.length;o++){let c=e[o];this._stringToNumber[c]=o,this._numberToString[o]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var Rz={read:function(i,e,o,c,h){var p,m,y=8*h-c-1,v=(1<<y)-1,C=v>>1,T=-7,E=o?h-1:0,D=o?-1:1,O=i[e+E];for(E+=D,p=O&(1<<-T)-1,O>>=-T,T+=y;T>0;p=256*p+i[e+E],E+=D,T-=8);for(m=p&(1<<-T)-1,p>>=-T,T+=c;T>0;m=256*m+i[e+E],E+=D,T-=8);if(p===0)p=1-C;else{if(p===v)return m?NaN:1/0*(O?-1:1);m+=Math.pow(2,c),p-=C}return(O?-1:1)*m*Math.pow(2,p-c)},write:function(i,e,o,c,h,p){var m,y,v,C=8*p-h-1,T=(1<<C)-1,E=T>>1,D=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=c?0:p-1,R=c?1:-1,z=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,m=T):(m=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-m))<1&&(m--,v*=2),(e+=m+E>=1?D/v:D*Math.pow(2,1-E))*v>=2&&(m++,v/=2),m+E>=T?(y=0,m=T):m+E>=1?(y=(e*v-1)*Math.pow(2,h),m+=E):(y=e*Math.pow(2,E-1)*Math.pow(2,h),m=0));h>=8;i[o+O]=255&y,O+=R,y/=256,h-=8);for(m=m<<h|y,C+=h;C>0;i[o+O]=255&m,O+=R,m/=256,C-=8);i[o+O-R]|=128*z}},UI=An,ib=Rz;function An(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}An.Varint=0,An.Fixed64=1,An.Bytes=2,An.Fixed32=5;var mw=4294967296,HI=1/mw,WI=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function $l(i){return i.type===An.Bytes?i.readVarint()+i.pos:i.pos+1}function Hp(i,e,o){return o?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function GI(i,e,o){var c=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));o.realloc(c);for(var h=o.pos-1;h>=i;h--)o.buf[h+c]=o.buf[h]}function Fz(i,e){for(var o=0;o<i.length;o++)e.writeVarint(i[o])}function Lz(i,e){for(var o=0;o<i.length;o++)e.writeSVarint(i[o])}function zz(i,e){for(var o=0;o<i.length;o++)e.writeFloat(i[o])}function Bz(i,e){for(var o=0;o<i.length;o++)e.writeDouble(i[o])}function Nz(i,e){for(var o=0;o<i.length;o++)e.writeBoolean(i[o])}function Vz(i,e){for(var o=0;o<i.length;o++)e.writeFixed32(i[o])}function jz(i,e){for(var o=0;o<i.length;o++)e.writeSFixed32(i[o])}function Uz(i,e){for(var o=0;o<i.length;o++)e.writeFixed64(i[o])}function Hz(i,e){for(var o=0;o<i.length;o++)e.writeSFixed64(i[o])}function nb(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Wp(i,e,o){i[o]=e,i[o+1]=e>>>8,i[o+2]=e>>>16,i[o+3]=e>>>24}function $I(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}An.prototype={destroy:function(){this.buf=null},readFields:function(i,e,o){for(o=o||this.length;this.pos<o;){var c=this.readVarint(),h=c>>3,p=this.pos;this.type=7&c,i(h,e,this),this.pos===p&&this.skip(c)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=nb(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=$I(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=nb(this.buf,this.pos)+nb(this.buf,this.pos+4)*mw;return this.pos+=8,i},readSFixed64:function(){var i=nb(this.buf,this.pos)+$I(this.buf,this.pos+4)*mw;return this.pos+=8,i},readFloat:function(){var i=ib.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=ib.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,o,c=this.buf;return e=127&(o=c[this.pos++]),o<128?e:(e|=(127&(o=c[this.pos++]))<<7,o<128?e:(e|=(127&(o=c[this.pos++]))<<14,o<128?e:(e|=(127&(o=c[this.pos++]))<<21,o<128?e:function(h,p,m){var y,v,C=m.buf;if(y=(112&(v=C[m.pos++]))>>4,v<128||(y|=(127&(v=C[m.pos++]))<<3,v<128)||(y|=(127&(v=C[m.pos++]))<<10,v<128)||(y|=(127&(v=C[m.pos++]))<<17,v<128)||(y|=(127&(v=C[m.pos++]))<<24,v<128)||(y|=(1&(v=C[m.pos++]))<<31,v<128))return Hp(h,y,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(o=c[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&WI?function(o,c,h){return WI.decode(o.subarray(c,h))}(this.buf,e,i):function(o,c,h){for(var p="",m=c;m<h;){var y,v,C,T=o[m],E=null,D=T>239?4:T>223?3:T>191?2:1;if(m+D>h)break;D===1?T<128&&(E=T):D===2?(192&(y=o[m+1]))==128&&(E=(31&T)<<6|63&y)<=127&&(E=null):D===3?(v=o[m+2],(192&(y=o[m+1]))==128&&(192&v)==128&&((E=(15&T)<<12|(63&y)<<6|63&v)<=2047||E>=55296&&E<=57343)&&(E=null)):D===4&&(v=o[m+2],C=o[m+3],(192&(y=o[m+1]))==128&&(192&v)==128&&(192&C)==128&&((E=(15&T)<<18|(63&y)<<12|(63&v)<<6|63&C)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,D=1):E>65535&&(E-=65536,p+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),p+=String.fromCharCode(E),m+=D}return p}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==An.Bytes)return i.push(this.readVarint(e));var o=$l(this);for(i=i||[];this.pos<o;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==An.Bytes)return i.push(this.readSVarint());var e=$l(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==An.Bytes)return i.push(this.readBoolean());var e=$l(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==An.Bytes)return i.push(this.readFloat());var e=$l(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==An.Bytes)return i.push(this.readDouble());var e=$l(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==An.Bytes)return i.push(this.readFixed32());var e=$l(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==An.Bytes)return i.push(this.readSFixed32());var e=$l(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==An.Bytes)return i.push(this.readFixed64());var e=$l(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==An.Bytes)return i.push(this.readSFixed64());var e=$l(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===An.Varint)for(;this.buf[this.pos++]>127;);else if(e===An.Bytes)this.pos=this.readVarint()+this.pos;else if(e===An.Fixed32)this.pos+=4;else{if(e!==An.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var o=new Uint8Array(e);o.set(this.buf),this.buf=o,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Wp(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Wp(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Wp(this.buf,-1&i,this.pos),Wp(this.buf,Math.floor(i*HI),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Wp(this.buf,-1&i,this.pos),Wp(this.buf,Math.floor(i*HI),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,o){var c,h;if(e>=0?(c=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(c=~(-e%4294967296))?c=c+1|0:(c=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(p,m,y){y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,y.buf[y.pos]=127&(p>>>=7)}(c,0,o),function(p,m){var y=(7&p)<<4;m.buf[m.pos++]|=y|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(h,o)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(c,h,p){for(var m,y,v=0;v<h.length;v++){if((m=h.charCodeAt(v))>55295&&m<57344){if(!y){m>56319||v+1===h.length?(c[p++]=239,c[p++]=191,c[p++]=189):y=m;continue}if(m<56320){c[p++]=239,c[p++]=191,c[p++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(c[p++]=239,c[p++]=191,c[p++]=189,y=null);m<128?c[p++]=m:(m<2048?c[p++]=m>>6|192:(m<65536?c[p++]=m>>12|224:(c[p++]=m>>18|240,c[p++]=m>>12&63|128),c[p++]=m>>6&63|128),c[p++]=63&m|128)}return p}(this.buf,i,this.pos);var o=this.pos-e;o>=128&&GI(e,o,this),this.pos=e-1,this.writeVarint(o),this.pos+=o},writeFloat:function(i){this.realloc(4),ib.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),ib.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var o=0;o<e;o++)this.buf[this.pos++]=i[o]},writeRawMessage:function(i,e){this.pos++;var o=this.pos;i(e,this);var c=this.pos-o;c>=128&&GI(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeMessage:function(i,e,o){this.writeTag(i,An.Bytes),this.writeRawMessage(e,o)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Fz,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Lz,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Nz,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,zz,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Bz,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Vz,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,jz,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Uz,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Hz,e)},writeBytesField:function(i,e){this.writeTag(i,An.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,An.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,An.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,An.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,An.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,An.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,An.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,An.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,An.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,An.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Gp=He(UI);let Wz=["id","tile","layer","source","sourceLayer","state"];class qI{constructor(e,o,c,h,p){this.type="Feature",this._vectorTileFeature=e,this._z=o,this._x=c,this._y=h,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let o of Wz)this[o]!==void 0&&(e[o]=this[o]);return e}}class Gz{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,c){let h=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},Zr(this.stateChanges[e][h],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(let p in this.state[e])p!==h&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(let p in this.state[e][h])c[p]||(this.deletedStates[e][h][p]=null)}else for(let p in c)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][p]===null&&delete this.deletedStates[e][h][p]}removeFeatureState(e,o,c){if(this.deletedStates[e]===null)return;let h=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&o!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][c]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(c in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][c]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,o){let c=String(o),h=Zr({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let p=this.deletedStates[e][o];if(p===null)return{};for(let m in p)delete h[m]}return h}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){let c={};for(let h in this.stateChanges){this.state[h]=this.state[h]||{};let p={};for(let m in this.stateChanges[h])this.state[h][m]||(this.state[h][m]={}),Zr(this.state[h][m],this.stateChanges[h][m]),p[m]=this.state[h][m];c[h]=p}for(let h in this.deletedStates){this.state[h]=this.state[h]||{};let p={};if(this.deletedStates[h]===null)for(let m in this.state[h])p[m]={},this.state[h][m]={};else for(let m in this.deletedStates[h]){if(this.deletedStates[h][m]===null)this.state[h][m]={};else if(this.state[h][m])for(let y of Object.keys(this.deletedStates[h][m]))delete this.state[h][m][y];p[m]=this.state[h][m]}c[h]=c[h]||{},Zr(c[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(let h in e)e[h].setFeatureState(c,o)}}class YI{constructor(e,o){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new fe(pt,16,0),this.featureIndexArray=new aT,this.promoteId=o,this.is3DTile=!1}insert(e,o,c,h,p,m=0,y=0){let v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,p,m);let C=this.grid;for(let T=0;T<o.length;T++){let E=o[T],D=[1/0,1/0,-1/0,-1/0];for(let O=0;O<E.length;O++){let R=E[O];D[0]=Math.min(D[0],R.x),D[1]=Math.min(D[1],R.y),D[2]=Math.max(D[2],R.x),D[3]=Math.max(D[3],R.y)}y!==0&&(D[0]-=y,D[1]-=y,D[2]+=y,D[3]+=y),D[0]<pt&&D[1]<pt&&D[2]>=0&&D[3]>=0&&C.insert(v,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new cw(new Gp(this.rawTileData)).layers,this.sourceLayerCoder=new jI(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,o,c,h){this.loadVTLayers();let p=e.params||{},m=xr(p.filter),y=e.tileResult,v=e.transform,C=y.bufferedTilespaceBounds,T=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(R,z,N,W)=>CT(y.bufferedTilespaceGeometry,R,z,N,W));T.sort($z);let E=null;v.elevation&&T.length>0&&(E=Up.create(v.elevation,this.tileID));let D={},O;for(let R=0;R<T.length;R++){let z=T[R];if(z===O)continue;O=z;let N=this.featureIndexArray.get(z),W=null;if(this.is3DTile){let ee=this.bucketLayerIDs[0][0],te=o[ee];if(te.type!=="model")continue;let{queryFeature:ie,intersectionZ:pe}=te.queryIntersectsMatchingFeature(y,N.featureIndex,m,v);ie&&this.appendToResult(D,ee,N.featureIndex,ie,pe)}else this.loadMatchingFeature(D,N,m,p.layers,p.availableImages,o,c,h,(ee,te,ie,pe=0)=>(W||(W=gs(ee,this.tileID.canonical,e.tileTransform)),te.queryIntersectsFeature(y,ee,ie,W,this.z,e.transform,e.pixelPosMatrix,E,pe)))}return D}loadMatchingFeature(e,o,c,h,p,m,y,v,C){let{featureIndex:T,bucketIndex:E,sourceLayerIndex:D,layoutVertexArrayOffset:O}=o,R=this.bucketLayerIDs[E];if(h&&!function(ee,te){for(let ie=0;ie<ee.length;ie++)if(te.indexOf(ee[ie])>=0)return!0;return!1}(h,R))return;let z=this.sourceLayerCoder.decode(D),N=this.vtLayers[z].feature(T);if(c.needGeometry){let ee=Hl(N,!0);if(!c.filter(new ti(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!c.filter(new ti(this.tileID.overscaledZ),N))return;let W=this.getId(N,z);for(let ee=0;ee<R.length;ee++){let te=R[ee];if(h&&h.indexOf(te)<0)continue;let ie=m[te];if(!ie)continue;let pe={};W!==void 0&&v&&(pe=v.getState(ie.sourceLayer||"_geojsonTileLayer",W));let he=!C||C(N,ie,pe,O);if(!he)continue;let ve=new qI(N,this.z,this.x,this.y,W),Ce=Zr({},y[te]);Ce.paint=ZI(Ce.paint,ie.paint,N,pe,p),Ce.layout=ZI(Ce.layout,ie.layout,N,pe,p),ve.layer=Ce,this.appendToResult(e,te,T,ve,he)}}appendToResult(e,o,c,h,p){let m=e[o];m===void 0&&(m=e[o]=[]),m.push({featureIndex:c,feature:h,intersectionZ:p})}lookupSymbolFeatures(e,o,c,h,p,m,y,v){let C={};this.loadVTLayers();let T=xr(p);for(let E of e)this.loadMatchingFeature(C,{bucketIndex:c,sourceLayerIndex:h,featureIndex:E,layoutVertexArrayOffset:0},T,m,y,v,o);return C}loadFeature(e){let{featureIndex:o,sourceLayerIndex:c}=e;this.loadVTLayers();let h=this.sourceLayerCoder.decode(c),p=this.vtFeatures[h];if(p[o])return p[o];let m=this.vtLayers[h].feature(o);return p[o]=m,m}hasLayer(e){for(let o of this.bucketLayerIDs)for(let c of o)if(e===c)return!0;return!1}getId(e,o){let c=e.id;if(this.promoteId){let h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];h!=null&&(c=e.properties[h]),typeof c=="boolean"&&(c=Number(c))}return c}}function ZI(i,e,o,c,h){return Rc(i,(p,m)=>{let y=e instanceof ln?e.get(m):null;return y&&y.evaluate?y.evaluate(o,c,h):y})}function $z(i,e){return e-i}ne(YI,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Kr=24;let _s=128;function fw(i,e){let{expression:o}=e;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new ti(i+1))};if(o.kind==="source")return{kind:"source"};{let{zoomStops:c,interpolationType:h}=o,p=0;for(;p<c.length&&c[p]<=i;)p++;p=Math.max(0,p-1);let m=p;for(;m<c.length&&c[m]<i+1;)m++;m=Math.min(c.length-1,m);let y=c[p],v=c[m];return o.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:v,interpolationType:h}:{kind:"camera",minZoom:y,maxZoom:v,minSize:o.evaluate(new ti(y)),maxSize:o.evaluate(new ti(v)),interpolationType:h}}}function rb(i,{uSize:e,uSizeT:o},{lowerSize:c,upperSize:h}){return i.kind==="source"?c/_s:i.kind==="composite"?Gt(c/_s,h/_s,o):e}function $p(i,e){let o=0,c=0;if(i.kind==="constant")c=i.layoutSize;else if(i.kind!=="source"){let{interpolationType:h,minZoom:p,maxZoom:m}=i,y=h?yi(jo.interpolationFactor(h,e,p,m),0,1):0;i.kind==="camera"?c=Gt(i.minSize,i.maxSize,y):o=y}return{uSizeT:o,uSize:c}}var qz=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:_s,evaluateSizeForFeature:rb,evaluateSizeForZoom:$p,getSizeData:fw});function Yz(i,e,o){return i.sections.forEach(c=>{c.text=function(h,p,m){let y=p.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?h=h.toLocaleUpperCase():y==="lowercase"&&(h=h.toLocaleLowerCase()),an.applyArabicShaping&&(h=an.applyArabicShaping(h)),h}(c.text,e,o)}),i}let Lg={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function Zz(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function Xz(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}let gw=3;function Kz(i,e,o){e.glyphs=[],i===1&&o.readMessage(Qz,e)}function Qz(i,e,o){if(i===3){let{id:c,bitmap:h,width:p,height:m,left:y,top:v,advance:C}=o.readMessage(Jz,{});e.glyphs.push({id:c,bitmap:new ud({width:p+2*gw,height:m+2*gw},h),metrics:{width:p,height:m,left:y,top:v,advance:C}})}else i===4?e.ascender=o.readSVarint():i===5&&(e.descender=o.readSVarint())}function Jz(i,e,o){i===1?e.id=o.readVarint():i===2?e.bitmap=o.readBytes():i===3?e.width=o.readVarint():i===4?e.height=o.readVarint():i===5?e.left=o.readSVarint():i===6?e.top=o.readSVarint():i===7&&(e.advance=o.readVarint())}let XI=gw,Ia={horizontal:1,vertical:2,horizontalOnly:3};class zg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,o){let c=new zg;return c.scale=e||1,c.fontStack=o,c}static forImage(e){let o=new zg;return o.imageName=e,o}}class qp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,o){let c=new qp;for(let h=0;h<e.sections.length;h++){let p=e.sections[h];p.image?c.addImageSection(p):c.addTextSection(p,o)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(o,c){let h="";for(let p=0;p<o.length;p++){let m=o.charCodeAt(p+1)||null,y=o.charCodeAt(p-1)||null;h+=!c&&(m&&Xe(m)&&!Lg[o[p+1]]||y&&Xe(y)&&!Lg[o[p-1]])||!Lg[o[p]]?o[p]:Lg[o[p]]}return h}(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&ob[this.text.charCodeAt(c)];c++)e++;let o=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&ob[this.text.charCodeAt(c)];c--)o--;this.text=this.text.substring(e,o),this.sectionIndex=this.sectionIndex.slice(e,o)}substring(e,o){let c=new qp;return c.text=this.text.substring(e,o),c.sectionIndex=this.sectionIndex.slice(e,o),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,o)=>Math.max(e,this.sections[o].scale),0)}addTextSection(e,o){this.text+=e.text,this.sections.push(zg.forText(e.scale,e.fontStack||o));let c=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(c)}addImageSection(e){let o=e.image?e.image.namePrimary:"";if(o.length===0)return void Qn("Can't add FormattedSection with an empty image.");let c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(zg.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Qn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _w(i,e,o,c,h,p,m,y,v,C,T,E,D,O,R){let z=qp.fromFeature(i,h);E===Ia.vertical&&z.verticalizePunctuation(D);let N=[],W=function(he,ve,Ce,Ae,je,Le){if(!he)return[];let qe=[],ot=function(tt,lt,nt,Ct,at,ht){let Ut=0;for(let Bt=0;Bt<tt.length();Bt++){let Rt=tt.getSection(Bt);Ut+=KI(tt.getCodePoint(Bt),Rt,Ct,at,lt,ht)}return Ut/Math.max(1,Math.ceil(Ut/nt))}(he,ve,Ce,Ae,je,Le),Ge=he.text.indexOf("\u200B")>=0,et=0;for(let tt=0;tt<he.length();tt++){let lt=he.getSection(tt),nt=he.getCodePoint(tt);if(ob[nt]||(et+=KI(nt,lt,Ae,je,ve,Le)),tt<he.length()-1){let Ct=!((Ue=nt)<11904||!(ue["Bopomofo Extended"](Ue)||ue.Bopomofo(Ue)||ue["CJK Compatibility Forms"](Ue)||ue["CJK Compatibility Ideographs"](Ue)||ue["CJK Compatibility"](Ue)||ue["CJK Radicals Supplement"](Ue)||ue["CJK Strokes"](Ue)||ue["CJK Symbols and Punctuation"](Ue)||ue["CJK Unified Ideographs Extension A"](Ue)||ue["CJK Unified Ideographs"](Ue)||ue["Enclosed CJK Letters and Months"](Ue)||ue["Halfwidth and Fullwidth Forms"](Ue)||ue.Hiragana(Ue)||ue["Ideographic Description Characters"](Ue)||ue["Kangxi Radicals"](Ue)||ue["Katakana Phonetic Extensions"](Ue)||ue.Katakana(Ue)||ue["Vertical Forms"](Ue)||ue["Yi Radicals"](Ue)||ue["Yi Syllables"](Ue)));(e5[nt]||Ct||lt.imageName)&&qe.push(JI(tt+1,et,ot,qe,t5(nt,he.getCodePoint(tt+1),Ct&&Ge),!1))}}var Ue;return eE(JI(he.length(),et,ot,qe,0,!0))}(z,C,p,e,c,O),{processBidirectionalText:ee,processStyledBidirectionalText:te}=an;if(ee&&z.sections.length===1){let he=ee(z.toString(),W);for(let ve of he){let Ce=new qp;Ce.text=ve,Ce.sections=z.sections;for(let Ae=0;Ae<ve.length;Ae++)Ce.sectionIndex.push(0);N.push(Ce)}}else if(te){let he=te(z.text,z.sectionIndex,W);for(let ve of he){let Ce=new qp;Ce.text=ve[0],Ce.sectionIndex=ve[1],Ce.sections=z.sections,N.push(Ce)}}else N=function(he,ve){let Ce=[],Ae=he.text,je=0;for(let Le of ve)Ce.push(he.substring(je,Le)),je=Le;return je<Ae.length&&Ce.push(he.substring(je,Ae.length)),Ce}(z,W);let ie=[],pe={positionedLines:ie,text:z.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,ve,Ce,Ae,je,Le,qe,ot,Ge,et,Ue,tt){let lt=0,nt=0,Ct=0,at=ot==="right"?1:ot==="left"?0:.5,ht=!1;for(let ui of je){let Kt=ui.getSections();for(let fi of Kt){if(fi.imageName)continue;let pi=ve[fi.fontStack];if(pi&&(ht=pi.ascender!==void 0&&pi.descender!==void 0,!ht))break}if(!ht)break}let Ut=0;for(let ui of je){ui.trim();let Kt=ui.getMaxScale(),fi=(Kt-1)*Kr,pi={positionedGlyphs:[],lineOffset:0};he.positionedLines[Ut]=pi;let wi=pi.positionedGlyphs,qt=0;if(!ui.length()){nt+=Le,++Ut;continue}let un=0,cn=0;for(let Bi=0;Bi<ui.length();Bi++){let Yi=ui.getSection(Bi),wn=ui.getSectionIndex(Bi),yn=ui.getCodePoint(Bi),jn=Yi.scale,Ln=null,ro=null,Gn=null,Pn=Kr,hr=0,Br=!(Ge===Ia.horizontal||!Ue&&!Je(yn)||Ue&&(ob[yn]||(Bt=yn,ue.Arabic(Bt)||ue["Arabic Supplement"](Bt)||ue["Arabic Extended-A"](Bt)||ue["Arabic Presentation Forms-A"](Bt)||ue["Arabic Presentation Forms-B"](Bt))));if(Yi.imageName){let Nr=Ae[Yi.imageName];if(!Nr)continue;Gn=Yi.imageName,he.iconsInText=he.iconsInText||!0,ro=Nr.paddedRect;let vn=Nr.displaySize;jn=jn*Kr/tt,Ln={width:vn[0],height:vn[1],left:0,top:-XI,advance:Br?vn[1]:vn[0],localGlyph:!1},hr=ht?-Ln.height*jn:Kt*Kr-17-vn[1]*jn,Pn=Ln.advance;let Oo=(Br?vn[0]:vn[1])*jn-Kr*Kt;Oo>0&&Oo>qt&&(qt=Oo)}else{let Nr=Ce[Yi.fontStack];if(!Nr)continue;Nr[yn]&&(ro=Nr[yn]);let vn=ve[Yi.fontStack];if(!vn)continue;let Oo=vn.glyphs[yn];if(!Oo)continue;if(Ln=Oo.metrics,Pn=yn!==8203?Kr:0,ht){let Yl=vn.ascender!==void 0?Math.abs(vn.ascender):0,Xa=vn.descender!==void 0?Math.abs(vn.descender):0,Ss=(Yl+Xa)*jn;un<Ss&&(un=Ss,cn=(Yl-Xa)/2*jn),hr=-Yl*jn}else hr=(Kt-jn)*Kr-17}Br?(he.verticalizable=!0,wi.push({glyph:yn,imageName:Gn,x:lt,y:nt+hr,vertical:Br,scale:jn,localGlyph:Ln.localGlyph,fontStack:Yi.fontStack,sectionIndex:wn,metrics:Ln,rect:ro}),lt+=Pn*jn+et):(wi.push({glyph:yn,imageName:Gn,x:lt,y:nt+hr,vertical:Br,scale:jn,localGlyph:Ln.localGlyph,fontStack:Yi.fontStack,sectionIndex:wn,metrics:Ln,rect:ro}),lt+=Ln.advance*jn+et)}wi.length!==0&&(Ct=Math.max(lt-et,Ct),ht?tE(wi,at,qt,cn,Le*Kt/2):tE(wi,at,qt,0,Le/2)),lt=0;let qi=Le*Kt+qt;pi.lineOffset=Math.max(qt,fi),nt+=qi,++Ut}var Bt;let Rt=nt,{horizontalAlign:ct,verticalAlign:Ht}=yw(qe);(function(ui,Kt,fi,pi,wi,qt){let un=(Kt-fi)*wi,cn=-qt*pi;for(let qi of ui)for(let Bi of qi.positionedGlyphs)Bi.x+=un,Bi.y+=cn})(he.positionedLines,at,ct,Ht,Ct,Rt),he.top+=-Ht*Rt,he.bottom=he.top+Rt,he.left+=-ct*Ct,he.right=he.left+Ct,he.hasBaseline=ht}(pe,e,o,c,N,m,y,v,E,C,D,R),!function(he){for(let ve of he)if(ve.positionedGlyphs.length!==0)return!1;return!0}(ie)&&pe}let ob={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},e5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function KI(i,e,o,c,h,p){if(e.imageName){let m=c[e.imageName];return m?m.displaySize[0]*e.scale*Kr/p+h:0}{let m=o[e.fontStack],y=m&&m.glyphs[i];return y?y.metrics.advance*e.scale+h:0}}function QI(i,e,o,c){let h=Math.pow(i-e,2);return c?i<e?h/2:2*h:h+Math.abs(o)*o}function t5(i,e,o){let c=0;return i===10&&(c-=1e4),o&&(c+=150),i!==40&&i!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function JI(i,e,o,c,h,p){let m=null,y=QI(e,o,h,p);for(let v of c){let C=QI(e-v.x,o,h,p)+v.badness;C<=y&&(m=v,y=C)}return{index:i,x:e,priorBreak:m,badness:y}}function eE(i){return i?eE(i.priorBreak).concat(i.index):[]}function yw(i){let e=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:e,verticalAlign:o}}function tE(i,e,o,c,h){if(!(e||o||c||h))return;let p=i.length-1,m=i[p],y=(m.x+m.metrics.advance*m.scale)*e;for(let v=0;v<=p;v++)i[v].x-=y,i[v].y+=o+c+h}function i5(i,e,o,c){let{horizontalAlign:h,verticalAlign:p}=yw(c),m=o[0]-i.displaySize[0]*h,y=o[1]-i.displaySize[1]*p;return{imagePrimary:i,imageSecondary:e,top:y,bottom:y+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function iE(i,e,o,c,h,p){let m=i.imagePrimary,y;if(m.content){let N=m.content,W=m.pixelRatio||1;y=[N[0]/W,N[1]/W,m.displaySize[0]-N[2]/W,m.displaySize[1]-N[3]/W]}let v=e.left*p,C=e.right*p,T,E,D,O;o==="width"||o==="both"?(O=h[0]+v-c[3],E=h[0]+C+c[1]):(O=h[0]+(v+C-m.displaySize[0])/2,E=O+m.displaySize[0]);let R=e.top*p,z=e.bottom*p;return o==="height"||o==="both"?(T=h[1]+R-c[0],D=h[1]+z+c[2]):(T=h[1]+(R+z-m.displaySize[1])/2,D=T+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:T,right:E,bottom:D,left:O,collisionPadding:y}}class ql extends vt{constructor(e,o,c,h,p){super(e,o),this.angle=h,this.z=c,p!==void 0&&(this.segment=p)}clone(){return new ql(this.x,this.y,this.z,this.angle,this.segment)}}function nE(i,e,o,c,h){if(e.segment===void 0)return!0;let p=e,m=e.segment+1,y=0;for(;y>-o/2;){if(m--,m<0)return!1;y-=i[m].dist(p),p=i[m]}y+=i[m].dist(i[m+1]),m++;let v=[],C=0;for(;y<o/2;){let T=i[m],E=i[m+1];if(!E)return!1;let D=i[m-1].angleTo(T)-T.angleTo(E);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:y,angleDelta:D}),C+=D;y-v[0].distance>c;)C-=v.shift().angleDelta;if(C>h)return!1;m++,y+=T.dist(E)}return!0}function rE(i){let e=0;for(let o=0;o<i.length-1;o++)e+=i[o].dist(i[o+1]);return e}function oE(i,e,o){return i?.6*e*o:0}function aE(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function n5(i,e,o,c,h,p){let m=oE(o,h,p),y=aE(o,c)*p,v=0,C=rE(i)/2;for(let T=0;T<i.length-1;T++){let E=i[T],D=i[T+1],O=E.dist(D);if(v+O>C){let R=(C-v)/O,z=Gt(E.x,D.x,R),N=Gt(E.y,D.y,R),W=new ql(z,N,0,D.angleTo(E),T);return!m||nE(i,W,y,m,e)?W:void 0}v+=O}}function r5(i,e,o,c,h,p,m,y,v){let C=oE(c,p,m),T=aE(c,h),E=T*m,D=i[0].x===0||i[0].x===v||i[0].y===0||i[0].y===v;return e-E<e/4&&(e=E+e/4),sE(i,D?e/2*y%e:(T/2+2*p)*m*y%e,e,C,o,E,D,!1,v)}function sE(i,e,o,c,h,p,m,y,v){let C=p/2,T=rE(i),E=0,D=e-o,O=[];for(let R=0;R<i.length-1;R++){let z=i[R],N=i[R+1],W=z.dist(N),ee=N.angleTo(z);for(;D+o<E+W;){D+=o;let te=(D-E)/W,ie=Gt(z.x,N.x,te),pe=Gt(z.y,N.y,te);if(ie>=0&&ie<v&&pe>=0&&pe<v&&D-C>=0&&D+C<=T){let he=new ql(ie,pe,0,ee,R);c&&!nE(i,he,p,c,h)||O.push(he)}}E+=W}return y||O.length||m||(O=sE(i,E/2,o,c,h,p,m,!0,v)),O}function lE(i,e,o,c,h){let p=[];for(let m=0;m<i.length;m++){let y=i[m],v;for(let C=0;C<y.length-1;C++){let T=y[C],E=y[C+1];T.x<e&&E.x<e||(T.x<e?T=new vt(e,T.y+(e-T.x)/(E.x-T.x)*(E.y-T.y))._round():E.x<e&&(E=new vt(e,T.y+(e-T.x)/(E.x-T.x)*(E.y-T.y))._round()),T.y<o&&E.y<o||(T.y<o?T=new vt(T.x+(o-T.y)/(E.y-T.y)*(E.x-T.x),o)._round():E.y<o&&(E=new vt(T.x+(o-T.y)/(E.y-T.y)*(E.x-T.x),o)._round()),T.x>=c&&E.x>=c||(T.x>=c?T=new vt(c,T.y+(c-T.x)/(E.x-T.x)*(E.y-T.y))._round():E.x>=c&&(E=new vt(c,T.y+(c-T.x)/(E.x-T.x)*(E.y-T.y))._round()),T.y>=h&&E.y>=h||(T.y>=h?T=new vt(T.x+(h-T.y)/(E.y-T.y)*(E.x-T.x),h)._round():E.y>=h&&(E=new vt(T.x+(h-T.y)/(E.y-T.y)*(E.x-T.x),h)._round()),v&&T.equals(v[v.length-1])||(v=[T],p.push(v)),v.push(E)))))}}return p}function cE(i){let e=0,o=0;for(let m of i)e+=m.w*m.h,o=Math.max(o,m.w);i.sort((m,y)=>y.h-m.h);let c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),o),h:1/0}],h=0,p=0;for(let m of i)for(let y=c.length-1;y>=0;y--){let v=c[y];if(!(m.w>v.w||m.h>v.h)){if(m.x=v.x,m.y=v.y,p=Math.max(p,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===v.w&&m.h===v.h){let C=c.pop();y<c.length&&(c[y]=C)}else m.h===v.h?(v.x+=m.w,v.w-=m.w):m.w===v.w?(v.y+=m.h,v.h-=m.h):(c.push({x:v.x+m.w,y:v.y,w:v.w-m.w,h:m.h}),v.y+=m.h,v.h-=m.h);break}}return{w:h,h:p,fill:e/(h*p)||0}}ne(ql,"Anchor");let ia=1;class bw{constructor(e,{pixelRatio:o,version:c,stretchX:h,stretchY:p,content:m}){this.paddedRect=e,this.pixelRatio=o,this.stretchX=h,this.stretchY=p,this.content=m,this.version=c}get tl(){return[this.paddedRect.x+ia,this.paddedRect.y+ia]}get br(){return[this.paddedRect.x+this.paddedRect.w-ia,this.paddedRect.y+this.paddedRect.h-ia]}get displaySize(){return[(this.paddedRect.w-2*ia)/this.pixelRatio,(this.paddedRect.h-2*ia)/this.pixelRatio]}}class dE{constructor(e,o,c){let h={},p={};this.haveRenderCallbacks=[];let m=[];this.addImages(e,h,m),this.addImages(o,p,m);let{w:y,h:v}=cE(m),C=new Ta({width:y||1,height:v||1});for(let T in e){let E=e[T],D=h[T].paddedRect;Ta.copy(E.data,C,{x:0,y:0},{x:D.x+ia,y:D.y+ia},E.data,c,E.sdf)}for(let T in o){let E=o[T],D=p[T].paddedRect,O=D.x+ia,R=D.y+ia,z=E.data.width,N=E.data.height;Ta.copy(E.data,C,{x:0,y:0},{x:O,y:R},E.data,c),Ta.copy(E.data,C,{x:0,y:N-1},{x:O,y:R-1},{width:z,height:1},c),Ta.copy(E.data,C,{x:0,y:0},{x:O,y:R+N},{width:z,height:1},c),Ta.copy(E.data,C,{x:z-1,y:0},{x:O-1,y:R},{width:1,height:N},c),Ta.copy(E.data,C,{x:0,y:0},{x:O+z,y:R},{width:1,height:N},c)}this.image=C,this.iconPositions=h,this.patternPositions=p}addImages(e,o,c){for(let h in e){let p=e[h],m={x:0,y:0,w:p.data.width+2*ia,h:p.data.height+2*ia};c.push(m),o[h]=new bw(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,o,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>e.hasImage(h,c)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(let h in e.getUpdatedImages(c))this.patchUpdatedImage(this.iconPositions[h],e.getImage(h,c),o),this.patchUpdatedImage(this.patternPositions[h],e.getImage(h,c),o)}patchUpdatedImage(e,o,c){if(!e||!o||e.version===o.version)return;e.version=o.version;let[h,p]=e.tl,m=!!Object.keys(this.patternPositions).length;c.update(o.data,{useMipmap:m},{x:h,y:p})}}ne(bw,"ImagePosition"),ne(dE,"ImageAtlas");let Bg=1e20;function hE(i,e,o,c,h,p,m,y,v){for(let C=e;C<e+c;C++)uE(i,o*p+C,p,h,m,y,v);for(let C=o;C<o+h;C++)uE(i,C*p+e,1,c,m,y,v)}function uE(i,e,o,c,h,p,m){p[0]=0,m[0]=-Bg,m[1]=Bg,h[0]=i[e];for(let y=1,v=0,C=0;y<c;y++){h[y]=i[e+y*o];let T=y*y;do{let E=p[v];C=(h[y]-h[E]+T-E*E)/(y-E)/2}while(C<=m[v]&&--v>-1);v++,p[v]=y,m[v]=C,m[v+1]=Bg}for(let y=0,v=0;y<c;y++){for(;m[v+1]<y;)v++;let C=p[v],T=y-C;i[e+y*o]=h[C]+T*T}}let ys=2,vw={none:0,ideographs:1,all:2};class Yp{constructor(e,o,c){this.requestManager=e,this.localGlyphMode=o,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,o){this.urls[o]=e}getGlyphs(e,o,c){let h=[],p=this.urls[o]||M.GLYPHS_URL;for(let m in e)for(let y of e[m])h.push({stack:m,id:y});Oc(h,({stack:m,id:y},v)=>{let C=this.entries[m];C||(C=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=C.glyphs[y];if(T!==void 0)return void v(null,{stack:m,id:y,glyph:T});if(T=this._tinySDF(C,m,y),T)return C.glyphs[y]=T,void v(null,{stack:m,id:y,glyph:T});let E=Math.floor(y/256);if(256*E>65535)return void v(new Error("glyphs > 65535 not supported"));if(C.ranges[E])return void v(null,{stack:m,id:y,glyph:T});let D=C.requests[E];D||(D=C.requests[E]=[],Yp.loadGlyphRange(m,E,p,this.requestManager,(O,R)=>{if(R){C.ascender=R.ascender,C.descender=R.descender;for(let z in R.glyphs)this._doesCharSupportLocalGlyph(+z)||(C.glyphs[+z]=R.glyphs[+z]);C.ranges[E]=!0}for(let z of D)z(O,R);delete C.requests[E]})),D.push((O,R)=>{O?v(O):R&&v(null,{stack:m,id:y,glyph:R.glyphs[y]||null})})},(m,y)=>{if(m)c(m);else if(y){let v={};for(let{stack:C,id:T,glyph:E}of y)v[C]===void 0&&(v[C]={}),v[C].glyphs===void 0&&(v[C].glyphs={}),v[C].glyphs[T]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},v[C].ascender=this.entries[C].ascender,v[C].descender=this.entries[C].descender;c(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==vw.none&&(this.localGlyphMode===vw.all?!!this.localFontFamily:!!this.localFontFamily&&(ue["CJK Unified Ideographs"](e)||ue["Hangul Syllables"](e)||ue.Hiragana(e)||ue.Katakana(e)||ue["CJK Symbols and Punctuation"](e)||ue["CJK Unified Ideographs Extension A"](e)||ue["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,o,c){let h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(c))return;let p=e.tinySDF;if(!p){let z="400";/bold/i.test(o)?z="900":/medium/i.test(o)?z="500":/light/i.test(o)&&(z="200"),p=e.tinySDF=new Yp.TinySDF({fontFamily:h,fontWeight:z,fontSize:24*ys,buffer:3*ys,radius:8*ys}),p.fontWeight=z}if(this.localGlyphs[p.fontWeight][c])return this.localGlyphs[p.fontWeight][c];let m=String.fromCodePoint(c),{data:y,width:v,height:C,glyphWidth:T,glyphHeight:E,glyphLeft:D,glyphTop:O,glyphAdvance:R}=p.draw(m);return this.localGlyphs[p.fontWeight][c]={id:c,bitmap:new ud({width:v,height:C},y),metrics:{width:T/ys,height:E/ys,left:D/ys,top:O/ys-27,advance:R/ys,localGlyph:!0}}}}Yp.loadGlyphRange=function(i,e,o,c,h){let p=256*e,m=p+255,y=c.transformRequest(c.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",`${p}-${m}`),ap.Glyphs);Il(y,(v,C)=>{if(v)h(v);else if(C){let T={},E=function(D){return new Gp(D).readFields(Kz,{})}(C);for(let D of E.glyphs)T[D.id]=D;h(null,{glyphs:T,ascender:E.ascender,descender:E.descender})}})},Yp.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:o=8,cutoff:c=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=o;let y=this.size=i+4*e,v=this._createCanvas(y),C=this.ctx=v.getContext("2d",{willReadFrequently:!0});C.font=`${m} ${p} ${i}px ${h}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(i){let e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){let{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:c,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(i),m=Math.ceil(o),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),v=Math.min(this.size-this.buffer,m+Math.ceil(c)),C=y+2*this.buffer,T=v+2*this.buffer,E=Math.max(C*T,0),D=new Uint8ClampedArray(E),O={data:D,width:C,height:T,glyphWidth:y,glyphHeight:v,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(y===0||v===0)return O;let{ctx:R,buffer:z,gridInner:N,gridOuter:W}=this;R.clearRect(z,z,y,v),R.fillText(i,z,z+m);let ee=R.getImageData(z,z,y,v);W.fill(Bg,0,E),N.fill(0,0,E);for(let te=0;te<v;te++)for(let ie=0;ie<y;ie++){let pe=ee.data[4*(te*y+ie)+3]/255;if(pe===0)continue;let he=(te+z)*C+ie+z;if(pe===1)W[he]=0,N[he]=Bg;else{let ve=.5-pe;W[he]=ve>0?ve*ve:0,N[he]=ve<0?ve*ve:0}}hE(W,0,0,C,T,C,this.f,this.v,this.z),hE(N,z,z,y,v,C,this.f,this.v,this.z);for(let te=0;te<E;te++){let ie=Math.sqrt(W[te])-Math.sqrt(N[te]);D[te]=Math.round(255-255*(ie/this.radius+this.cutoff))}return O}};let fd=ia;function pE(i,e,o,c){let h=[],p=i.imagePrimary,m=p.pixelRatio,y=p.paddedRect.w-2*fd,v=p.paddedRect.h-2*fd,C=i.right-i.left,T=i.bottom-i.top,E=p.stretchX||[[0,y]],D=p.stretchY||[[0,v]],O=(Le,qe)=>Le+qe[1]-qe[0],R=E.reduce(O,0),z=D.reduce(O,0),N=y-R,W=v-z,ee=0,te=R,ie=0,pe=z,he=0,ve=N,Ce=0,Ae=W;if(p.content&&c){let Le=p.content;ee=ab(E,0,Le[0]),ie=ab(D,0,Le[1]),te=ab(E,Le[0],Le[2]),pe=ab(D,Le[1],Le[3]),he=Le[0]-ee,Ce=Le[1]-ie,ve=Le[2]-Le[0]-te,Ae=Le[3]-Le[1]-pe}let je=(Le,qe,ot,Ge)=>{let et=sb(Le.stretch-ee,te,C,i.left),Ue=lb(Le.fixed-he,ve,Le.stretch,R),tt=sb(qe.stretch-ie,pe,T,i.top),lt=lb(qe.fixed-Ce,Ae,qe.stretch,z),nt=sb(ot.stretch-ee,te,C,i.left),Ct=lb(ot.fixed-he,ve,ot.stretch,R),at=sb(Ge.stretch-ie,pe,T,i.top),ht=lb(Ge.fixed-Ce,Ae,Ge.stretch,z),Ut=new vt(et,tt),Bt=new vt(nt,tt),Rt=new vt(nt,at),ct=new vt(et,at),Ht=new vt(Ue/m,lt/m),ui=new vt(Ct/m,ht/m),Kt=e*Math.PI/180;if(Kt){let cn=Math.sin(Kt),qi=Math.cos(Kt),Bi=[qi,-cn,cn,qi];Ut._matMult(Bi),Bt._matMult(Bi),ct._matMult(Bi),Rt._matMult(Bi)}let fi=Le.stretch+Le.fixed,pi=ot.stretch+ot.fixed,wi=qe.stretch+qe.fixed,qt=Ge.stretch+Ge.fixed,un=i.imageSecondary;return{tl:Ut,tr:Bt,bl:ct,br:Rt,texPrimary:{x:p.paddedRect.x+fd+fi,y:p.paddedRect.y+fd+wi,w:pi-fi,h:qt-wi},texSecondary:un?{x:un.paddedRect.x+fd+fi,y:un.paddedRect.y+fd+wi,w:pi-fi,h:qt-wi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ht,pixelOffsetBR:ui,minFontScaleX:ve/m/C,minFontScaleY:Ae/m/T,isSDF:o}};if(c&&(p.stretchX||p.stretchY)){let Le=mE(E,N,R),qe=mE(D,W,z);for(let ot=0;ot<Le.length-1;ot++){let Ge=Le[ot],et=Le[ot+1];for(let Ue=0;Ue<qe.length-1;Ue++)h.push(je(Ge,qe[Ue],et,qe[Ue+1]))}}else h.push(je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:v+1}));return h}function ab(i,e,o){let c=0;for(let h of i)c+=Math.max(e,Math.min(o,h[1]))-Math.max(e,Math.min(o,h[0]));return c}function mE(i,e,o){let c=[{fixed:-fd,stretch:0}];for(let[h,p]of i){let m=c[c.length-1];c.push({fixed:h-m.stretch,stretch:m.stretch}),c.push({fixed:h-m.stretch,stretch:m.stretch+(p-h)})}return c.push({fixed:e+fd,stretch:o}),c}function sb(i,e,o,c){return i/e*o+c}function lb(i,e,o,c){return i-e*o/c}function o5(i,e,o,c){let h=e+i.positionedLines[c].lineOffset;return c===0?o+h/2:o+(h+(e+i.positionedLines[c-1].lineOffset))/2}function a5(i,e=1,o=!1){let c=1/0,h=1/0,p=-1/0,m=-1/0,y=i[0];for(let O=0;O<y.length;O++){let R=y[O];(!O||R.x<c)&&(c=R.x),(!O||R.y<h)&&(h=R.y),(!O||R.x>p)&&(p=R.x),(!O||R.y>m)&&(m=R.y)}let v=Math.min(p-c,m-h),C=v/2,T=new Kf([],s5);if(v===0)return new vt(c,h);for(let O=c;O<p;O+=v)for(let R=h;R<m;R+=v)T.push(new Zp(O+C,R+C,C,i));let E=function(O){let R=0,z=0,N=0,W=O[0];for(let ee=0,te=W.length,ie=te-1;ee<te;ie=ee++){let pe=W[ee],he=W[ie],ve=pe.x*he.y-he.x*pe.y;z+=(pe.x+he.x)*ve,N+=(pe.y+he.y)*ve,R+=3*ve}return new Zp(z/R,N/R,0,O)}(i),D=T.length;for(;T.length;){let O=T.pop();(O.d>E.d||!E.d)&&(E=O,o&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,D)),O.max-E.d<=e||(C=O.h/2,T.push(new Zp(O.p.x-C,O.p.y-C,C,i)),T.push(new Zp(O.p.x+C,O.p.y-C,C,i)),T.push(new Zp(O.p.x-C,O.p.y+C,C,i)),T.push(new Zp(O.p.x+C,O.p.y+C,C,i)),D+=4)}return o&&(console.log(`num probes: ${D}`),console.log(`best distance: ${E.d}`)),E.p}function s5(i,e){return e.max-i.max}class Zp{constructor(e,o,c,h){this.p=new vt(e,o),this.h=c,this.d=function(p,m){let y=!1,v=1/0;for(let C=0;C<m.length;C++){let T=m[C];for(let E=0,D=T.length,O=D-1;E<D;O=E++){let R=T[E],z=T[O];R.y>p.y!=z.y>p.y&&p.x<(z.x-R.x)*(p.y-R.y)/(z.y-R.y)+R.x&&(y=!y),v=Math.min(v,xT(p,R,z))}}return(y?1:-1)*Math.sqrt(v)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}let xw=Number.POSITIVE_INFINITY,l5=Math.sqrt(2);function fE(i,[e,o]){let c=0,h=0;if(o===xw){e<0&&(e=0);let p=e/l5;switch(i){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(i){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=e;break;case"right":c=-e}}else{switch(e=Math.abs(e),o=Math.abs(o),i){case"top-right":case"top-left":case"top":h=o-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-o}switch(i){case"top-right":case"bottom-right":case"right":c=-e;break;case"top-left":case"bottom-left":case"left":c=e}}return[c,h]}function ww(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function c5(i,e,o,c,h,p,m,y,v,C,T,E,D,O,R){let z=p.textMaxSize.evaluate(e,{},E);z===void 0&&(z=m);let N=i.layers[0].layout,W=N.get("icon-offset").evaluate(e,{},E),ee=_E(o.horizontal)||o.vertical,te=D.name==="globe",ie=Kr,pe=m/ie,he=i.tilePixelRatio*z/ie,ve=(et=i.overscaling,i.zoom>18&&et>2&&(et>>=1),Math.max(pt/(512*et),1)*N.get("symbol-spacing")),Ce=N.get("text-padding")*i.tilePixelRatio,Ae=N.get("icon-padding")*i.tilePixelRatio,je=Li(N.get("text-max-angle")),Le=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",qe=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",ot=N.get("symbol-placement"),Ge=ve/2;var et;let Ue=N.get("icon-text-fit").evaluate(e,{},E),tt=N.get("icon-text-fit-padding").evaluate(e,{},E),lt=Ue!=="none",nt;i.hasAnyIconTextFit===!1&&lt&&(i.hasAnyIconTextFit=!0),c&&lt&&(i.allowVerticalPlacement&&o.vertical&&(nt=iE(c,o.vertical,Ue,tt,W,pe)),ee&&(c=iE(c,ee,Ue,tt,W,pe)));let Ct=(at,ht,Ut)=>{if(ht.x<0||ht.x>=pt||ht.y<0||ht.y>=pt)return;let Bt=null;if(te){let{x:Rt,y:ct,z:Ht}=D.projectTilePoint(ht.x,ht.y,Ut);Bt={anchor:new ql(Rt,ct,Ht,0,void 0),up:D.upVector(Ut,ht.x,ht.y)}}(function(Rt,ct,Ht,ui,Kt,fi,pi,wi,qt,un,cn,qi,Bi,Yi,wn,yn,jn,Ln,ro,Gn,Pn,hr,Br,Nr,vn,Oo,Yl){let Xa=Rt.addToLineVertexArray(ct,ui),Ss,wd,Cd,lu,yD,bD,vD,xD=0,wD=0,CD=0,SD=0,Kw=-1,Qw=-1,el={},MD=jc(""),cu=Ht?Ht.anchor:ct,Jw=qt.layout.get("icon-text-fit").evaluate(Pn,{},vn)!=="none",eC=0,tC=0;if(qt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[eC,tC]=qt.layout.get("text-offset").evaluate(Pn,{},vn).map(ra=>ra*Kr):(eC=qt.layout.get("text-radial-offset").evaluate(Pn,{},vn)*Kr,tC=xw),Rt.allowVerticalPlacement&&Kt.vertical){let ra=Kt.vertical;if(wn)bD=Cw(ra),wi&&(vD=Cw(wi));else{let oa=qt.layout.get("text-rotate").evaluate(Pn,{},vn)+90;Cd=cb(un,cu,ct,cn,qi,Bi,ra,Yi,oa,yn),wi&&(lu=cb(un,cu,ct,cn,qi,Bi,wi,Ln,oa))}}if(fi){let ra=qt.layout.get("icon-rotate").evaluate(Pn,{},vn),oa=pE(fi,ra,Br,Jw),rm=wi?pE(wi,ra,Br,Jw):void 0;wd=cb(un,cu,ct,cn,qi,Bi,fi,Ln,ra),xD=4*oa.length;let TD=Rt.iconSizeData,du=null;TD.kind==="source"?(du=[_s*qt.layout.get("icon-size").evaluate(Pn,{},vn)],du[0]>gd&&Qn(`${Rt.layerIds[0]}: Value for "icon-size" is >= ${Ng}. Reduce your "icon-size".`)):TD.kind==="composite"&&(du=[_s*hr.compositeIconSizes[0].evaluate(Pn,{},vn),_s*hr.compositeIconSizes[1].evaluate(Pn,{},vn)],(du[0]>gd||du[1]>gd)&&Qn(`${Rt.layerIds[0]}: Value for "icon-size" is >= ${Ng}. Reduce your "icon-size".`)),Rt.addSymbols(Rt.icon,oa,du,Gn,ro,Pn,!1,Ht,ct,Xa.lineStartIndex,Xa.lineLength,-1,Nr,vn,Oo,Yl),Kw=Rt.icon.placedSymbolArray.length-1,rm&&(wD=4*rm.length,Rt.addSymbols(Rt.icon,rm,du,Gn,ro,Pn,Ia.vertical,Ht,ct,Xa.lineStartIndex,Xa.lineLength,-1,Nr,vn,Oo,Yl),Qw=Rt.icon.placedSymbolArray.length-1)}for(let ra in Kt.horizontal){let oa=Kt.horizontal[ra];Ss||(MD=jc(oa.text),wn?yD=Cw(oa):Ss=cb(un,cu,ct,cn,qi,Bi,oa,Yi,qt.layout.get("text-rotate").evaluate(Pn,{},vn),yn));let rm=oa.positionedLines.length===1;if(CD+=gE(Rt,Ht,ct,oa,pi,qt,wn,Pn,yn,Xa,Kt.vertical?Ia.horizontal:Ia.horizontalOnly,rm?Object.keys(Kt.horizontal):[ra],el,Kw,hr,Nr,vn,Oo),rm)break}Kt.vertical&&(SD+=gE(Rt,Ht,ct,Kt.vertical,pi,qt,wn,Pn,yn,Xa,Ia.vertical,["vertical"],el,Qw,hr,Nr,vn,Oo));let Sd=-1,iC=(ra,oa)=>ra?Math.max(ra,oa):oa;Sd=iC(yD,Sd),Sd=iC(bD,Sd),Sd=iC(vD,Sd);let EB=Sd>-1?1:0;Rt.glyphOffsetArray.length>=65535&&Qn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pn.sortKey!==void 0&&Rt.addToSortKeyRanges(Rt.symbolInstances.length,Pn.sortKey),Rt.symbolInstances.emplaceBack(ct.x,ct.y,cu.x,cu.y,cu.z,el.right>=0?el.right:-1,el.center>=0?el.center:-1,el.left>=0?el.left:-1,el.vertical>=0?el.vertical:-1,Kw,Qw,MD,Ss!==void 0?Ss:Rt.collisionBoxArray.length,Ss!==void 0?Ss+1:Rt.collisionBoxArray.length,Cd!==void 0?Cd:Rt.collisionBoxArray.length,Cd!==void 0?Cd+1:Rt.collisionBoxArray.length,wd!==void 0?wd:Rt.collisionBoxArray.length,wd!==void 0?wd+1:Rt.collisionBoxArray.length,lu||Rt.collisionBoxArray.length,lu?lu+1:Rt.collisionBoxArray.length,cn,CD,SD,xD,wD,EB,0,eC,tC,Sd,0,1,1,Jw?1:0)})(i,ht,Bt,at,o,c,h,nt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Ce,Le,v,0,Ae,qe,W,e,p,C,T,E,O,R)};if(ot==="line")for(let at of lE(e.geometry,0,0,pt,pt)){let ht=r5(at,ve,je,o.vertical||ee,c,ie,he,i.overscaling,pt);for(let Ut of ht)ee&&d5(i,ee.text,Ge,Ut)||Ct(at,Ut,E)}else if(ot==="line-center"){for(let at of e.geometry)if(at.length>1){let ht=n5(at,je,o.vertical||ee,c,ie,he);ht&&Ct(at,ht,E)}}else if(e.type==="Polygon")for(let at of Gy(e.geometry,0)){let ht=a5(at,16);Ct(at[0],new ql(ht.x,ht.y,0,0,void 0),E)}else if(e.type==="LineString")for(let at of e.geometry)Ct(at,new ql(at[0].x,at[0].y,0,0,void 0),E);else if(e.type==="Point")for(let at of e.geometry)for(let ht of at)Ct([ht],new ql(ht.x,ht.y,0,0,void 0),E)}let Ng=255,gd=Ng*_s;function gE(i,e,o,c,h,p,m,y,v,C,T,E,D,O,R,z,N,W){let ee=function(pe,he,ve,Ce,Ae,je,Le,qe){let ot=[];if(he.positionedLines.length===0)return ot;let Ge=Ce.layout.get("text-rotate").evaluate(je,{})*Math.PI/180,et=function(Ct){let at=Ct[0],ht=Ct[1],Ut=at*ht;return Ut>0?[at,-ht]:Ut<0?[-at,ht]:at===0?[ht,at]:[ht,-at]}(ve),Ue=Math.abs(he.top-he.bottom);for(let Ct of he.positionedLines)Ue-=Ct.lineOffset;let tt=he.positionedLines.length,lt=Ue/tt,nt=he.top-ve[1];for(let Ct=0;Ct<tt;++Ct){let at=he.positionedLines[Ct];nt=o5(he,lt,nt,Ct);for(let ht of at.positionedGlyphs){if(!ht.rect)continue;let Ut=ht.rect||{},Bt=XI+1,Rt=!0,ct=1,Ht=0;if(ht.imageName){let Gn=Le[ht.imageName];if(!Gn)continue;if(Gn.sdf){Qn("SDF images are not supported in formatted text and will be ignored.");continue}Rt=!1,ct=Gn.pixelRatio,Bt=ia/ct}let ui=(Ae||qe)&&ht.vertical,Kt=ht.metrics.advance*ht.scale/2,fi=ht.metrics,pi=ht.rect;if(pi===null)continue;qe&&he.verticalizable&&(Ht=ht.imageName?Kt-ht.metrics.width*ht.scale/2:0);let wi=Ae?[ht.x+Kt,ht.y]:[0,0],qt=[0,0],un=[0,0],cn=!1;Ae||(ui?(un=[ht.x+Kt+et[0],ht.y+et[1]-Ht],cn=!0):qt=[ht.x+Kt+ve[0],ht.y+ve[1]-Ht]);let qi=pi.w*ht.scale/(ct*(ht.localGlyph?ys:1)),Bi=pi.h*ht.scale/(ct*(ht.localGlyph?ys:1)),Yi,wn,yn,jn;if(ui){let Gn=ht.y-nt,Pn=new vt(-Kt,Kt-Gn),hr=-Math.PI/2,Br=new vt(...un);Yi=new vt(-Kt+qt[0],qt[1]),Yi._rotateAround(hr,Pn)._add(Br),Yi.x+=-Gn+Kt,Yi.y-=(fi.left-Bt)*ht.scale;let Nr=ht.imageName?fi.advance*ht.scale:Kr*ht.scale,vn=String.fromCodePoint(ht.glyph);Zz(vn)?Yi.x+=(1-Bt)*ht.scale:Xz(vn)?Yi.x+=Nr-fi.height*ht.scale+(-Bt-1)*ht.scale:Yi.x+=ht.imageName||fi.width+2*Bt===pi.w&&fi.height+2*Bt===pi.h?(Nr-Bi)/2:(Nr-(fi.height+2*Bt)*ht.scale)/2,wn=new vt(Yi.x,Yi.y-qi),yn=new vt(Yi.x+Bi,Yi.y),jn=new vt(Yi.x+Bi,Yi.y-qi)}else{let Gn=(fi.left-Bt)*ht.scale-Kt+qt[0],Pn=(-fi.top-Bt)*ht.scale+qt[1],hr=Gn+qi,Br=Pn+Bi;Yi=new vt(Gn,Pn),wn=new vt(hr,Pn),yn=new vt(Gn,Br),jn=new vt(hr,Br)}if(Ge){let Gn;Gn=Ae?new vt(0,0):cn?new vt(et[0],et[1]):new vt(ve[0],ve[1]),Yi._rotateAround(Ge,Gn),wn._rotateAround(Ge,Gn),yn._rotateAround(Ge,Gn),jn._rotateAround(Ge,Gn)}let Ln=new vt(0,0),ro=new vt(0,0);ot.push({tl:Yi,tr:wn,bl:yn,br:jn,texPrimary:Ut,texSecondary:void 0,writingMode:he.writingMode,glyphOffset:wi,sectionIndex:ht.sectionIndex,isSDF:Rt,pixelOffsetTL:Ln,pixelOffsetBR:ro,minFontScaleX:0,minFontScaleY:0})}}return ot}(0,c,v,p,m,y,h,i.allowVerticalPlacement),te=i.textSizeData,ie=null;te.kind==="source"?(ie=[_s*p.layout.get("text-size").evaluate(y,{},N)],ie[0]>gd&&Qn(`${i.layerIds[0]}: Value for "text-size" is >= ${Ng}. Reduce your "text-size".`)):te.kind==="composite"&&(ie=[_s*R.compositeTextSizes[0].evaluate(y,{},N),_s*R.compositeTextSizes[1].evaluate(y,{},N)],(ie[0]>gd||ie[1]>gd)&&Qn(`${i.layerIds[0]}: Value for "text-size" is >= ${Ng}. Reduce your "text-size".`)),i.addSymbols(i.text,ee,ie,v,m,y,T,e,o,C.lineStartIndex,C.lineLength,O,z,N,W,!1);for(let pe of E)D[pe]=i.text.placedSymbolArray.length-1;return 4*ee.length}function _E(i){for(let e in i)return i[e];return null}function cb(i,e,o,c,h,p,m,y,v,C){let T=m.top,E=m.bottom,D=m.left,O=m.right,R=m.collisionPadding;if(R&&(D-=R[0],T-=R[1],O+=R[2],E+=R[3]),v){let z=new vt(D,T),N=new vt(O,T),W=new vt(D,E),ee=new vt(O,E),te=Li(v),ie=new vt(0,0);C&&(ie=new vt(C[0],C[1])),z._rotateAround(te,ie),N._rotateAround(te,ie),W._rotateAround(te,ie),ee._rotateAround(te,ie),D=Math.min(z.x,N.x,W.x,ee.x),O=Math.max(z.x,N.x,W.x,ee.x),T=Math.min(z.y,N.y,W.y,ee.y),E=Math.max(z.y,N.y,W.y,ee.y)}return i.emplaceBack(e.x,e.y,e.z,o.x,o.y,D,T,O,E,y,c,h,p),i.length-1}function Cw(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);let e=i.bottom-i.top;return e>0?Math.max(10,e):null}function d5(i,e,o,c){let h=i.compareText;if(e in h){let p=h[e];for(let m=p.length-1;m>=0;m--)if(c.dist(p[m])<o)return!0}else h[e]=[];return h[e].push(c),!1}function yE(i,e){let o=i.fovAboveCenter,c=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,h=(i._camera.position[2]*i.worldSize-c)/Math.cos(i._pitch),p=Math.sin(o)*h/Math.sin(Math.max(Math.PI/2-i._pitch-o,.01)),m=Math.sin(i._pitch)*p+h;return Math.min(1.01*m,h*(1/i._horizonShift))}function nu(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};let o=Math.pow(2,-i.z),c=i.x*o,h=(i.x+1)*o,p=i.y*o,m=(i.y+1)*o,y=Wo(c),v=Wo(h),C=zr(p),T=zr(m),E=e.project(y,C),D=e.project(v,C),O=e.project(v,T),R=e.project(y,T),z=Math.min(E.x,D.x,O.x,R.x),N=Math.min(E.y,D.y,O.y,R.y),W=Math.max(E.x,D.x,O.x,R.x),ee=Math.max(E.y,D.y,O.y,R.y),te=o/16;function ie(he,ve,Ce,Ae,je,Le){let qe=(Ce+je)/2,ot=(Ae+Le)/2,Ge=e.project(Wo(qe),zr(ot)),et=Math.max(0,z-Ge.x,N-Ge.y,Ge.x-W,Ge.y-ee);z=Math.min(z,Ge.x),W=Math.max(W,Ge.x),N=Math.min(N,Ge.y),ee=Math.max(ee,Ge.y),et>te&&(ie(he,Ge,Ce,Ae,qe,ot),ie(Ge,ve,qe,ot,je,Le))}ie(E,D,c,p,h,p),ie(D,O,h,p,h,m),ie(O,R,h,m,c,m),ie(R,E,c,m,c,p),z-=te,N-=te,W+=te,ee+=te;let pe=1/Math.max(W-z,ee-N);return{scale:pe,x:z*pe,y:N*pe,x2:W*pe,y2:ee*pe,projection:e}}function bE(i,{x:e,y:o},c=0){return new vt(((e-c)*i.scale-i.x)*pt,(o*i.scale-i.y)*pt)}let h5=t.ad.identity(new Float32Array(16));class _d{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,o){return{x:0,y:0,z:0}}unproject(e,o){return new Hi(0,0)}projectTilePoint(e,o,c){return{x:e,y:o,z:0}}locationPoint(e,o,c=!0){return e._coordinatePoint(e.locationCoordinate(o),c)}pixelsPerMeter(e,o){return Po(1,e)*o}pixelSpaceConversion(e,o,c){return 1}farthestPixelDistance(e){return yE(e,e.pixelsPerMeter)}pointCoordinate(e,o,c,h){let p=e.horizonLineFromTop(!1),m=new vt(o,Math.max(p,c));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,h))}pointCoordinate3D(e,o,c){let h=new vt(o,c);if(e.elevation)return e.elevation.pointCoordinate(h);{let p=this.pointCoordinate(e,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,o){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,o.x,o.y);let c=e.horizonLineFromTop();return o.y<c}createInversionMatrix(e,o){return h5}createTileMatrix(e,o,c){let h,p,m,y=c.canonical,v=t.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let C=nu(y,this);h=1,p=C.x+c.wrap*C.scale,m=C.y,t.ad.scale(v,v,[h/C.scale,h/C.scale,e.pixelsPerMeter/o])}else h=o/e.zoomScale(y.z),p=(y.x+Math.pow(2,y.z)*c.wrap)*h,m=y.y*h;return t.ad.translate(v,v,[p,m,0]),t.ad.scale(v,v,[h/pt,h/pt,1]),v}upVector(e,o,c){return[0,0,1]}upVectorScale(e,o,c){return{metersToTile:1}}}class u5 extends _d{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[o,c]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(Li(o));this.n=(h+Math.sin(Li(c)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,o){let{n:c,c:h,r0:p}=this,m=Li(e-this.center[0]),y=Li(o),v=Math.sqrt(h-2*c*Math.sin(y))/c;return{x:v*Math.sin(m*c),y:v*Math.cos(m*c)-p,z:0}}unproject(e,o){let{n:c,c:h,r0:p}=this,m=p+o,y=Math.atan2(e,Math.abs(m))*Math.sign(m);m*c<0&&(y-=Math.PI*Math.sign(e)*Math.sign(m));let v=Li(this.center[0])*c;y=Sl(y,-Math.PI-v,Math.PI-v);let C=yi(Yr(y/c)+this.center[0],-180,180),T=Math.asin(yi((h-(e*e+m*m)*c*c)/(2*c),-1,1)),E=yi(Yr(T),-er,er);return new Hi(C,E)}}let Vg=1.340264,jg=-.081106,Ug=893e-6,Hg=.003796,db=Math.sqrt(3)/2;class p5 extends _d{project(e,o){o=o/180*Math.PI,e=e/180*Math.PI;let c=Math.asin(db*Math.sin(o)),h=c*c,p=h*h*h;return{x:.5*(e*Math.cos(c)/(db*(Vg+3*jg*h+p*(7*Ug+9*Hg*h)))/Math.PI+.5),y:1-.5*(c*(Vg+jg*h+p*(Ug+Hg*h))/Math.PI+1),z:0}}unproject(e,o){e=(2*e-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,h=c*c,p=h*h*h;for(let T,E,D,O=0;O<12&&(E=c*(Vg+jg*h+p*(Ug+Hg*h))-o,D=Vg+3*jg*h+p*(7*Ug+9*Hg*h),T=E/D,c=yi(c-T,-Math.PI/3,Math.PI/3),h=c*c,p=h*h*h,!(Math.abs(T)<1e-12));++O);let m=db*e*(Vg+3*jg*h+p*(7*Ug+9*Hg*h))/Math.cos(c),y=Math.asin(Math.sin(c)/db),v=yi(180*m/Math.PI,-180,180),C=yi(180*y/Math.PI,-er,er);return new Hi(v,C)}}class m5 extends _d{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,o){return{x:.5+e/360,y:.5-o/360,z:0}}unproject(e,o){let c=360*(e-.5),h=yi(360*(.5-o),-er,er);return new Hi(c,h)}}let Xp=Math.PI/2;function hb(i){return Math.tan((Xp+i)/2)}class f5 extends _d{constructor(e){super(e),this.center=e.center||[0,30];let[o,c]=this.parallels=e.parallels||[30,30],h=Li(o),p=Li(c);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);let m=Math.cos(h),y=hb(h);this.n=h===p?Math.sin(h):Math.log(m/Math.cos(p))/Math.log(hb(p)/y),this.f=m*Math.pow(hb(h),this.n)/this.n}project(e,o){o=Li(o),this.southernCenter&&(o=-o),e=Li(e-this.center[0]);let c=1e-6,{n:h,f:p}=this;p>0?o<-Xp+c&&(o=-Xp+c):o>Xp-c&&(o=Xp-c);let m=p/Math.pow(hb(o),h),y=m*Math.sin(h*e),v=p-m*Math.cos(h*e);return y=.5*(y/Math.PI+.5),v=.5*(v/Math.PI+.5),{x:y,y:this.southernCenter?v:1-v,z:0}}unproject(e,o){e=(2*e-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;let{n:c,f:h}=this,p=h-o,m=Math.sign(p),y=Math.sign(c)*Math.sqrt(e*e+p*p),v=Math.atan2(e,Math.abs(p))*m;p*c<0&&(v-=Math.PI*Math.sign(e)*m);let C=yi(Yr(v/c)+this.center[0],-180,180),T=yi(Yr(2*Math.atan(Math.pow(h/y,1/c))-Xp),-er,er);return new Hi(C,this.southernCenter?-T:T)}}class vE extends _d{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,o){return{x:Ys(e),y:Zs(o),z:0}}unproject(e,o){let c=Wo(e),h=zr(o);return new Hi(c,h)}}let xE=Li(er);class g5 extends _d{project(e,o){let c=(o=Li(o))*o,h=c*c;return{x:.5*((e=Li(e))*(.8707-.131979*c+h*(h*(.003971*c-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+c*(.015085+h*(.028874*c-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,o){e=(2*e-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,h=25,p=0,m=c*c;do{m=c*c;let C=m*m;p=(c*(1.007226+m*(.015085+C*(.028874*m-.044475-.005916*C)))-o)/(1.007226+m*(.045255+C*(.259866*m-.311325-.005916*11*C))),c=yi(c-p,-xE,xE)}while(Math.abs(p)>1e-6&&--h>0);m=c*c;let y=yi(Yr(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),v=Yr(c);return new Hi(y,v)}}let wE=Li(er);class _5 extends _d{project(e,o){o=Li(o),e=Li(e);let c=Math.cos(o),h=2/Math.PI,p=Math.acos(c*Math.cos(e/2)),m=Math.sin(p)/p,y=.5*(e*h+2*c*Math.sin(e/2)/m)||0,v=.5*(o+Math.sin(o)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,o){let c=e=(2*e-.5)*Math.PI,h=o=(2*(1-o)-1)*Math.PI,p=25,m=1e-6,y=0,v=0;do{let C=Math.cos(h),T=Math.sin(h),E=2*T*C,D=T*T,O=C*C,R=Math.cos(c/2),z=Math.sin(c/2),N=2*R*z,W=z*z,ee=1-O*R*R,te=ee?1/ee:0,ie=ee?Math.acos(C*R)*Math.sqrt(1/ee):0,pe=.5*(2*ie*C*z+2*c/Math.PI)-e,he=.5*(ie*T+h)-o,ve=.5*te*(O*W+ie*C*R*D)+1/Math.PI,Ce=te*(N*E/4-ie*T*z),Ae=.125*te*(E*z-ie*T*O*N),je=.5*te*(D*R+ie*W*C)+.5,Le=Ce*Ae-je*ve;y=(he*Ce-pe*je)/Le,v=(pe*Ae-he*ve)/Le,c=yi(c-y,-Math.PI,Math.PI),h=yi(h-v,-wE,wE)}while((Math.abs(y)>m||Math.abs(v)>m)&&--p>0);return new Hi(Yr(c),Yr(h))}}class CE extends _d{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Li(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,o){let{scale:c,cosPhi:h}=this;return{x:Li(e)*h*c+.5,y:-Math.sin(Li(o))/h*c+.5,z:0}}unproject(e,o){let{scale:c,cosPhi:h}=this,p=-(o-.5)/c,m=yi(Yr((e-.5)/c)/h,-180,180),y=Math.asin(yi(p*h,-1,1)),v=yi(Yr(y),-er,er);return new Hi(m,v)}}class y5 extends vE{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,o,c){let h=Tg(e,o,c),p=Ig(Xs(c));return t._.transformMat4(h,h,p),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,o){let c=Qh(o.lat,o.lng),h=t._.normalize([],c),p=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(o),e._centerAltitude):e._centerAltitude,m=Po(1,0)*pt*p;t._.scaleAndAdd(c,c,h,m);let y=t.ad.identity(new Float64Array(16));return t.ad.multiply(y,e.pixelMatrix,e.globeMatrix),t._.transformMat4(c,c,y),new vt(c[0],c[1])}pixelsPerMeter(e,o){return Po(1,0)*o}pixelSpaceConversion(e,o,c){let h=Po(1,e)*o,p=Gt(Po(1,45)*o,h,c);return this.pixelsPerMeter(e,o)/p}createTileMatrix(e,o,c){let h=ew(Xs(c.canonical));return t.ad.multiply(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,o){let{center:c}=e,h=Ig(Xs(o));return t.ad.rotateY(h,h,Li(c.lng)),t.ad.rotateX(h,h,Li(c.lat)),t.ad.scale(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,o,c,h){return kT(e,o,c,!0)||new no(0,0)}pointCoordinate3D(e,o,c){let h=this.pointCoordinate(e,o,c,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,o){return!kT(e,o.x,o.y,!1)}farthestPixelDistance(e){let o=function(h,p){let m=h.cameraToCenterDistance,y=h._centerAltitude*p,v=h._camera,C=h._camera.forward(),T=t._.add([],t._.scale([],C,-m),[0,0,y]),E=h.worldSize/(2*Math.PI),D=[0,0,-E],O=h.width/h.height,R=Math.tan(h.fovAboveCenter),z=t._.scale([],v.up(),R),N=t._.scale([],v.right(),R*O),W=t._.normalize([],t._.add([],t._.add([],C,z),N)),ee=[],te;if(new Z1(T,W).closestPointOnSphere(D,E,ee)){let ie=t._.add([],ee,D),pe=t._.sub([],ie,T);te=Math.cos(h.fovAboveCenter)*t._.length(pe)}else{let ie=t._.sub([],T,D),pe=t._.sub([],D,T);t._.normalize(pe,pe);let he=t._.length(ie)-E;te=Math.sqrt(he*(he+2*E));let ve=Math.acos(te/(E+he))-Math.acos(t._.dot(C,pe));te*=Math.cos(ve)}return 1.01*te}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),c=Gl(e.zoom);if(c>0){let h=yE(e,Po(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Gt(o,h+p*(1-Math.cos(m)),Math.pow(c,10))}return o}upVector(e,o,c){return Tg(o,c,e,1)}upVectorScale(e){return{metersToTile:Ny(jy(Xs(e)))}}}function SE(i){let e=i.parallels,o=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new vE(i);case"equirectangular":return new m5(i);case"naturalEarth":return new g5(i);case"equalEarth":return new p5(i);case"winkelTripel":return new _5(i);case"albers":return o?new CE(i):new u5(i);case"lambertConformalConic":return o?new CE(i):new f5(i);case"globe":return new y5(i)}throw new Error(`Invalid projection name: ${i.name}`)}let b5=(()=>{class i{constructor(o,c,h,p){this.id=i.uniqueIdxCounter,i.uniqueIdxCounter++,this.context=o;let m=o.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||p||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=i.uniqueIdxCounter,i.uniqueIdxCounter++;let c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return i.uniqueIdxCounter=0,i})();class Kp{constructor(e,o,c){this.func=e,this.mask=o,this.range=c}}Kp.ReadOnly=!1,Kp.ReadWrite=!0,Kp.disabled=new Kp(519,Kp.ReadOnly,[0,1]);let Sw=7680;class Mw{constructor(e,o,c,h,p,m){this.test=e,this.ref=o,this.mask=c,this.fail=h,this.depthFail=p,this.pass=m}}Mw.disabled=new Mw({func:519,mask:0},0,0,Sw,Sw,Sw);let Wg=771;class na{constructor(e,o,c,h){this.blendFunction=e,this.blendColor=o,this.mask=c,this.blendEquation=h}}na.Replace=[1,0,1,0],na.disabled=new na(na.Replace,Wi.transparent,[!1,!1,!1,!1]),na.unblended=new na(na.Replace,Wi.transparent,[!0,!0,!0,!0]),na.alphaBlended=new na([1,Wg,1,Wg],Wi.transparent,[!0,!0,!0,!0]),na.alphaBlendedNonPremultiplied=new na([770,Wg,770,Wg],Wi.transparent,[!0,!0,!0,!0]),na.multiply=new na([774,0,774,0],Wi.transparent,[!0,!0,!0,!0]);let Tw=1029,Iw=2305;class bs{constructor(e,o,c){this.enable=e,this.mode=o,this.frontFace=c}}bs.disabled=new bs(!1,Tw,Iw),bs.backCCW=new bs(!0,Tw,Iw),bs.backCW=new bs(!0,Tw,2304),bs.frontCW=new bs(!0,1028,2304),bs.frontCCW=new bs(!0,1028,Iw);let v5=Yy.types,x5=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ub(i,e,o,c,h,p,m,y,v,C,T,E,D){let O=y?Math.min(gd,Math.round(y[0])):0,R=y?Math.min(gd,Math.round(y[1])):0;i.emplaceBack(e,o,Math.round(32*c),Math.round(32*h),p,m,(O<<1)+(v?1:0),R,16*C,16*T,256*E,256*D)}function pb(i,e,o){i.emplaceBack(e,o)}function mb(i,e,o,c,h,p,m){i.emplaceBack(e,o,c,h,p,m)}function fb(i,e,o,c,h){i.emplaceBack(e,o,c,h),i.emplaceBack(e,o,c,h),i.emplaceBack(e,o,c,h),i.emplaceBack(e,o,c,h)}function w5(i){for(let e of i.sections)if(Ze(e.text))return!0;return!1}class Ew{constructor(e){this.layoutVertexArray=new y1,this.indexArray=new Ir,this.programConfigurations=e,this.segments=new Rn,this.dynamicLayoutVertexArray=new rd,this.opacityVertexArray=new v1,this.occlusionQueryOpacityVertexArray=new Zh,this.placedSymbolArray=new eT,this.iconTransitioningVertexArray=new sd,this.globeExtVertexArray=new b1,this.zOffsetVertexArray=new Zh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,o,c,h,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Mz.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,x5,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,pw.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Tz.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Sz.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,PI.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ne(Ew,"SymbolBuffers");class Dw{constructor(e,o,c){this.layoutVertexArray=new e,this.layoutAttributes=o,this.indexArray=new c,this.segments=new Rn,this.collisionVertexArray=new C1,this.collisionVertexArrayExt=new rd}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Iz.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Ez.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ne(Dw,"CollisionBuffers");class Qp{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=t.ad.identity([]),this.placementViewportMatrix=t.ad.identity([]);let o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fw(this.zoom,o["text-size"]),this.iconSizeData=fw(this.zoom,o["icon-size"]);let c=this.layers[0].layout,h=c.get("symbol-sort-key"),p=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>Ia[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=c.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Ew(new cd(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new Ew(new cd(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new nT,this.lineVertexArray=new rT,this.symbolInstances=new iT}calculateGlyphDependencies(e,o,c,h,p){for(let m=0;m<e.length;m++){let y=e.codePointAt(m);if(y===void 0)break;if(o[y]=!0,h&&p&&y<=65535){let v=Lg[e.charAt(m)];v&&(o[v.charCodeAt(0)]=!0)}}}updateFootprints(e,o){}updateReplacement(e,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;let c=o.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!hw(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(e,o,c,h){let p=this.layers[0],m=p.layout,y=this.projection.name==="globe",v=m.get("text-font"),C=m.get("text-field"),T=m.get("icon-image"),E=(C.value.kind!=="constant"||C.value.value instanceof Xr&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),D=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,O=m.get("symbol-sort-key");if(this.features=[],!E&&!D)return;let R=o.iconDependencies,z=o.glyphDependencies,N=o.availableImages,W=new ti(this.zoom);for(let{feature:ee,id:te,index:ie,sourceLayerIndex:pe}of e){let he=p._featureFilter.needGeometry,ve=Hl(ee,he);if(!p._featureFilter.filter(W,ve,c))continue;if(he||(ve.geometry=gs(ee,c,h)),y&&ee.type!==1&&c.z<=5){let Le=ve.geometry,qe=.98078528056,ot=(Ge,et)=>{let Ue=Tg(Ge.x,Ge.y,c,1),tt=Tg(et.x,et.y,c,1);return t._.dot(Ue,tt)<qe};for(let Ge=0;Ge<Le.length;Ge++)Le[Ge]=a3(Le[Ge],ot)}let Ce,Ae;if(E){let Le=p.getValueAndResolveTokens("text-field",ve,c,N),qe=Xr.factory(Le);w5(qe)&&(this.hasRTLText=!0),(!this.hasRTLText||xi()==="unavailable"||this.hasRTLText&&an.isParsed())&&(Ce=Yz(qe,p,ve))}if(D){let Le=p.getValueAndResolveTokens("icon-image",ve,c,N);Ae=Le instanceof _o?Le:_o.fromString(Le)}if(!Ce&&!Ae)continue;let je=this.sortFeaturesByKey?O.evaluate(ve,{},c):void 0;if(this.features.push({id:te,text:Ce,icon:Ae,index:ie,sourceLayerIndex:pe,geometry:ve.geometry,properties:ee.properties,type:v5[ee.type],sortKey:je}),Ae&&(R[Ae.namePrimary]=!0,Ae.nameSecondary&&(R[Ae.nameSecondary]=!0)),Ce){let Le=v.evaluate(ve,{},c).join(","),qe=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ia.vertical)>=0;for(let ot of Ce.sections)if(ot.image)R[ot.image.namePrimary]=!0;else{let Ge=Re(Ce.toString()),et=ot.fontStack||Le,Ue=z[et]=z[et]||{};this.calculateGlyphDependencies(ot.text,Ue,qe,this.allowVerticalPlacement,Ge)}}}m.get("symbol-placement")==="line"&&(this.features=function(ee){let te={},ie={},pe=[],he=0;function ve(Le){pe.push(ee[Le]),he++}function Ce(Le,qe,ot){let Ge=ie[Le];return delete ie[Le],ie[qe]=Ge,pe[Ge].geometry[0].pop(),pe[Ge].geometry[0]=pe[Ge].geometry[0].concat(ot[0]),Ge}function Ae(Le,qe,ot){let Ge=te[qe];return delete te[qe],te[Le]=Ge,pe[Ge].geometry[0].shift(),pe[Ge].geometry[0]=ot[0].concat(pe[Ge].geometry[0]),Ge}function je(Le,qe,ot){let Ge=ot?qe[0][qe[0].length-1]:qe[0][0];return`${Le}:${Ge.x}:${Ge.y}`}for(let Le=0;Le<ee.length;Le++){let qe=ee[Le],ot=qe.geometry,Ge=qe.text?qe.text.toString():null;if(!Ge){ve(Le);continue}let et=je(Ge,ot),Ue=je(Ge,ot,!0);if(et in ie&&Ue in te&&ie[et]!==te[Ue]){let tt=Ae(et,Ue,ot),lt=Ce(et,Ue,pe[tt].geometry);delete te[et],delete ie[Ue],ie[je(Ge,pe[lt].geometry,!0)]=lt,pe[tt].geometry=null}else et in ie?Ce(et,Ue,ot):Ue in te?Ae(et,Ue,ot):(ve(Le),te[et]=he-1,ie[Ue]=he-1)}return pe.filter(Le=>Le.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,te)=>ee.sortKey-te.sortKey)}update(e,o,c,h,p){let m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;let y=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,o,y,c,h,p),this.icon.programConfigurations.updatePaintArrays(e,o,y,c,h,p)}updateOcclusionOpacities(e,o,c){if(!o.useOcclusionQueries)return!1;let h=this;if(h.projection.name==="globe")return!1;let p=!1;h.hasTextData()&&(p=p||h.text.occlusionQueryOpacityVertexArray.length!==0),h.hasIconData()&&(p=p||h.icon.occlusionQueryOpacityVertexArray.length!==0);let m=h.layers[0].paint,y=m.get("icon-occlusion-opacity").constantOr(0),v=m.get("text-occlusion-opacity").constantOr(0);if(!h.layers[0].hasInitialOcclusionOpacityProperties||y===1&&v===1)return!1;let C=!p;for(let O=0;O<h.symbolInstances.length;O++){let R=h.symbolInstances.get(O),z=R.occlusionOpacity;R.occlusionOpacity+=(R.occlusionState>.5?1:-1)*o.fadeSpeed*c*.001,R.occlusionOpacity=yi(R.occlusionOpacity,0,1),C=C||R.occlusionOpacity!==z}if(!C)return!1;let T=0,E=0,D=(O,R,z,N)=>{let W=0,ee=0;z?(W=E,E+=N,ee=E):(W=T,T+=N,ee=T),ee>R.occlusionQueryOpacityVertexArray.length&&R.occlusionQueryOpacityVertexArray.resize(ee);let te=O.occlusionOpacity;for(let ie=0;ie<N;ie++)R.occlusionQueryOpacityVertexArray.emplace(ie+W,te)};for(let O=0;O<h.symbolInstances.length;O++){let R=h.symbolInstances.get(O),{numHorizontalGlyphVertices:z,numVerticalGlyphVertices:N,numIconVertices:W}=R,ee=W>0;if((z>0||N>0)&&(D(R,h.text,!1,z),D(R,h.text,!1,N)),ee){let{placedIconSymbolIndex:te,verticalPlacedIconSymbolIndex:ie}=R;te>=0&&D(R,h.icon,!0,W),ie>=0&&D(R,h.icon,!0,R.numVerticalIconVertices)}}return h.hasTextData()&&h.text.occlusionQueryOpacityVertexBuffer&&(h.text.occlusionQueryOpacityVertexBuffer.length<h.text.occlusionQueryOpacityVertexArray.length?h.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(h.text.occlusionQueryOpacityVertexArray,pw.members,!0):h.text.occlusionQueryOpacityVertexBuffer.updateData(h.text.occlusionQueryOpacityVertexArray)),h.hasIconData()&&h.icon.occlusionQueryOpacityVertexBuffer&&(h.icon.occlusionQueryOpacityVertexBuffer.length<h.icon.occlusionQueryOpacityVertexArray.length?h.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(h.icon.occlusionQueryOpacityVertexArray,pw.members,!0):h.icon.occlusionQueryOpacityVertexBuffer.updateData(h.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(p,m,y)=>{c+=m,c>p.length&&p.resize(c);for(let v=-m;v<0;v++)p.emplace(v+c,y)},o=(p,m,y)=>{h+=m,h>p.length&&p.resize(h);for(let v=-m;v<0;v++)p.emplace(v+h,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,h=0;for(let p=0;p<this.symbolInstances.length;p++){let m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:v,numIconVertices:C}=m,T=m.zOffset,E=C>0;if((y>0||v>0)&&(e(this.text.zOffsetVertexArray,y,T),e(this.text.zOffsetVertexArray,v,T)),E){let{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:O}=m;D>=0&&o(this.icon.zOffsetVertexArray,C,T),O>=0&&o(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=SE(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,o){let c=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:h,y:p}of o)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,o,c,h,p,m,y,v,C,T,E,D,O,R,z,N){let W=e.indexArray,ee=e.layoutVertexArray,te=e.globeExtVertexArray,ie=e.segments.prepareSegment(4*o.length,ee,W,this.canOverlap?m.sortKey:void 0),pe=this.glyphOffsetArray.length,he=ie.vertexLength,ve=this.allowVerticalPlacement&&y===Ia.vertical?Math.PI/2:0,Ce=m.text&&m.text.sections;for(let je=0;je<o.length;je++){let{tl:Le,tr:qe,bl:ot,br:Ge,texPrimary:et,texSecondary:Ue,pixelOffsetTL:tt,pixelOffsetBR:lt,minFontScaleX:nt,minFontScaleY:Ct,glyphOffset:at,isSDF:ht,sectionIndex:Ut}=o[je],Bt=ie.vertexLength,Rt=at[1];if(ub(ee,C.x,C.y,Le.x,Rt+Le.y,et.x,et.y,c,ht,tt.x,tt.y,nt,Ct),ub(ee,C.x,C.y,qe.x,Rt+qe.y,et.x+et.w,et.y,c,ht,lt.x,tt.y,nt,Ct),ub(ee,C.x,C.y,ot.x,Rt+ot.y,et.x,et.y+et.h,c,ht,tt.x,lt.y,nt,Ct),ub(ee,C.x,C.y,Ge.x,Rt+Ge.y,et.x+et.w,et.y+et.h,c,ht,lt.x,lt.y,nt,Ct),v){let{x:ct,y:Ht,z:ui}=v.anchor,[Kt,fi,pi]=v.up;mb(te,ct,Ht,ui,Kt,fi,pi),mb(te,ct,Ht,ui,Kt,fi,pi),mb(te,ct,Ht,ui,Kt,fi,pi),mb(te,ct,Ht,ui,Kt,fi,pi),fb(e.dynamicLayoutVertexArray,ct,Ht,ui,ve)}else fb(e.dynamicLayoutVertexArray,C.x,C.y,C.z,ve);if(N){let ct=Ue||et;pb(e.iconTransitioningVertexArray,ct.x,ct.y),pb(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y),pb(e.iconTransitioningVertexArray,ct.x,ct.y+ct.h),pb(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y+ct.h)}W.emplaceBack(Bt,Bt+1,Bt+2),W.emplaceBack(Bt+1,Bt+2,Bt+3),ie.vertexLength+=4,ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(at[0]),je!==o.length-1&&Ut===o[je+1].sectionIndex||e.programConfigurations.populatePaintArrays(ee.length,m,m.index,{},O,R,z,Ce&&Ce[Ut])}let Ae=v?v.anchor:C;e.placedSymbolArray.emplaceBack(Ae.x,Ae.y,Ae.z,C.x,C.y,pe,this.glyphOffsetArray.length-pe,he,T,E,C.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],y,0,!1,0,D,0)}_commitLayoutVertex(e,o,c,h,p,m,y){e.emplaceBack(o,c,h,p,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,o,c,h,p,m,y){let v=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),C=v.vertexLength,T=y.tileAnchorX,E=y.tileAnchorY;for(let O=0;O<4;O++)c.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,o,e.padding,y.zOffset),this._commitLayoutVertex(c.layoutVertexArray,h,p,m,T,E,new vt(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,p,m,T,E,new vt(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,p,m,T,E,new vt(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,h,p,m,T,E,new vt(e.x1,e.y2)),v.vertexLength+=4;let D=c.indexArray;D.emplaceBack(C,C+1),D.emplaceBack(C+1,C+2),D.emplaceBack(C+2,C+3),D.emplaceBack(C+3,C),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,o,c,h,p,m){for(let y=h;y<p;y++){let v=c.get(y),C=this.getSymbolInstanceTextSize(e,m,o,y);this._addCollisionDebugVertices(v,C,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,o,c,h,p,m){for(let y=h;y<p;y++){let v=c.get(y),C=this.getSymbolInstanceIconSize(e,o,m.placedIconSymbolIndex);this._addCollisionDebugVertices(v,C,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Dw(ky,OI.members,sd),this.iconCollisionBox=new Dw(ky,OI.members,sd);let c=$p(this.iconSizeData,e),h=$p(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){let m=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,e,o,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(h,e,o,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(c,e,o,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(c,e,o,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,o,c,h){let p=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:h),m=rb(this.textSizeData,e,p)/Kr;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,o,c){let h=this.icon.placedSymbolArray.get(c),p=rb(this.iconSizeData,e,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,o,c,h){e.emplaceBack(o,-c,-c,h),e.emplaceBack(o,c,-c,h),e.emplaceBack(o,c,c,h),e.emplaceBack(o,-c,c,h)}_updateTextDebugCollisionBoxes(e,o,c,h,p,m){for(let y=h;y<p;y++){let v=c.get(y),C=this.getSymbolInstanceTextSize(e,m,o,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,v.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,o,c,h,p,m){for(let y=h;y<p;y++){let v=c.get(y),C=this.getSymbolInstanceIconSize(e,o,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,v.padding,m.zOffset)}}updateCollisionDebugBuffers(e,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let c=$p(this.iconSizeData,e),h=$p(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){let m=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,e,o,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(h,e,o,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(c,e,o,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(c,e,o,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,o,c,h,p,m,y,v,C){let T={};if(o<c){let{x1:E,y1:D,x2:O,y2:R,padding:z,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ie,featureIndex:pe}=e.get(o);T.textBox={x1:E,y1:D,x2:O,y2:R,padding:z,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ie},T.textFeatureIndex=pe}if(h<p){let{x1:E,y1:D,x2:O,y2:R,padding:z,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ie,featureIndex:pe}=e.get(h);T.verticalTextBox={x1:E,y1:D,x2:O,y2:R,padding:z,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ie},T.verticalTextFeatureIndex=pe}if(m<y){let{x1:E,y1:D,x2:O,y2:R,padding:z,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ie,featureIndex:pe}=e.get(m);T.iconBox={x1:E,y1:D,x2:O,y2:R,padding:z,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ie},T.iconFeatureIndex=pe}if(v<C){let{x1:E,y1:D,x2:O,y2:R,padding:z,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ie,featureIndex:pe}=e.get(v);T.verticalIconBox={x1:E,y1:D,x2:O,y2:R,padding:z,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ie},T.verticalIconFeatureIndex=pe}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){let c=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,o){let c=e.placedSymbolArray.get(o),h=c.vertexStartIndex+4*c.numGlyphs;for(let p=c.vertexStartIndex;p<h;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let o=Math.sin(e),c=Math.cos(e),h=[],p=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);let v=this.symbolInstances.get(y);h.push(0|Math.round(o*v.tileAnchorX+c*v.tileAnchorY)),p.push(v.featureIndex)}return m.sort((y,v)=>h[y]-h[v]||p[v]-p[y]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,o){let c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===o?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let o of this.symbolInstanceIndexes){let c=this.symbolInstances.get(o);this.featureSortOrder.push(c.featureIndex);let{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:C}=c;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ne(Qp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Qp.addDynamicAttributes=fb;class Ya{constructor(e,o,c,h){this.context=e,this.format=c,this.texture=e.gl.createTexture(),this.update(o,h)}update(e,o,c){let{width:h,height:p}=e,{context:m}=this,{gl:y}=m;if(y.bindTexture(y.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!o||o.premultiply!==!1)),c||this.size&&this.size[0]===h&&this.size[1]===p){let{x:v,y:C}=c||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)y.texSubImage2D(y.TEXTURE_2D,0,v,C,y.RGBA,y.UNSIGNED_BYTE,e);else{let T=this.format,E=y.UNSIGNED_BYTE;this.format===y.R32F&&(T=y.RED,E=y.FLOAT),y.texSubImage2D(y.TEXTURE_2D,0,v,C,h,p,T,E,e.data)}}else if(this.size=[h,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let v=this.format;this.format===y.R8&&(v=y.RED),y.texImage2D(y.TEXTURE_2D,0,this.format,v,y.UNSIGNED_BYTE,e)}else{let v=this.format,C=this.format,T=y.UNSIGNED_BYTE;this.format===y.DEPTH_COMPONENT&&(v=y.DEPTH_COMPONENT16,T=y.UNSIGNED_SHORT),this.format===y.R8&&(C=y.RED),this.format===y.R32F&&(T=y.FLOAT,C=y.RED),y.texImage2D(y.TEXTURE_2D,0,v,h,p,0,C,T,e.data)}this.useMipmap=!!(o&&o.useMipmap),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,o,c=!1){let{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!c?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(e,o,c,h){let{context:p}=this,{gl:m}=p;m.bindTexture(m.TEXTURE_2D,this.texture),o!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),this.magFilter=o),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),this.wrapS=c),h!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class gb{constructor(e,o){this.context=e,this.texture=o}bind(e,o){let{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}}let Za=32,Qs=33,yd=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,o=0,c=0,h=0,p=0,m=0,y=0;for(1&e?h=p=m=Za:o=c=y=Za;(e>>=1)>1;){let C=o+h>>1,T=c+p>>1;1&e?(h=o,p=c,o=m,c=y):(o=h,c=p,h=m,p=y),m=C,y=T}let v=4*i;yd[v+0]=o,yd[v+1]=c,yd[v+2]=h,yd[v+3]=p}let Js=new Uint16Array(2178),bd=new Uint8Array(1089),_b=new Uint16Array(1089);function ME(i){return i===0?-.03125:i===32?.03125:0}var yb=Ji([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),C5=Ji([{name:"a_index",type:"Int16",components:1}]);let TE={type:2,extent:pt,loadGeometry:()=>[[new vt(0,0),new vt(pt+1,0),new vt(pt+1,pt+1),new vt(0,pt+1),new vt(0,0)]]};class bb{constructor(e,o,c,h,p){this.tileID=e,this.uid=Zu(),this.uses=0,this.tileSize=o,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,h&&h.style&&(this._lastUpdatedBrightness=h.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){let o=e+this.timeAdded;o<Rr.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=nu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,o,c){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,p){let m={};if(!p)return m;for(let y of h){let v=y.layerIds.map(C=>p.getLayer(C)).filter(Boolean);if(v.length!==0){y.layers=v,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(C=>v.filter(T=>T.id===C)[0]));for(let C of v)m[C.fqid]=y}}return m}(e.buckets,o.style),this.hasSymbolBuckets=!1;for(let h in this.buckets){let p=this.buckets[h];if(p instanceof Qp){if(this.hasSymbolBuckets=!0,!c)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let h in this.buckets){let p=this.buckets[h];if(p instanceof Qp&&p.hasRTLText){this.hasRTLText=!0,an.isLoading()||an.isLoaded()||xi()!=="deferred"||zi();break}}this.queryPadding=0;for(let h in this.buckets){let p=this.buckets[h],m=o.style.getOwnLayer(h);if(!m)continue;let y=m.queryRadius(p);this.queryPadding=Math.max(this.queryPadding,y)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new A1}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let h in this.buckets){let p=this.buckets[h];p.uploadPending()&&p.upload(e)}let o=e.gl,c=this.imageAtlas;if(c&&!c.uploaded){let h=!!Object.keys(c.patternPositions).length;this.imageAtlasTexture=new Ya(e,c.image,o.RGBA,{useMipmap:h}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ya(e,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ya(e,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(e,o,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,c),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let h=o.style.getBrightness();(this._lastUpdatedBrightness||h)&&(this._lastUpdatedBrightness&&h&&Math.abs(this._lastUpdatedBrightness-h)<.001||(this._lastUpdatedBrightness=h,this.updateBuckets(void 0,o)))}queryRenderedFeatures(e,o,c,h,p,m,y,v){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:y,transform:m,params:p,tileTransform:this.tileTransform},e,o,c):{}}querySourceFeatures(e,o){let c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;let h=c.loadVTLayers(),p=o?o.sourceLayer:"",m=h._geojsonTileLayer||h[p];if(!m)return;let y=xr(o&&o.filter),{z:v,x:C,y:T}=this.tileID.canonical,E={z:v,x:C,y:T};for(let D=0;D<m.length;D++){let O=m.feature(D);if(y.needGeometry){let N=Hl(O,!0);if(!y.filter(new ti(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!y.filter(new ti(this.tileID.overscaledZ),O))continue;let R=c.getId(O,p),z=new qI(O,v,C,T,R);z.tile=E,e.push(z)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let o=this.expirationTime;if(e.cacheControl){let c=Mf(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let c=Date.now(),h=!1;if(this.expirationTime>c)h=!1;else if(o)if(this.expirationTime<o)h=!0;else{let p=this.expirationTime-o;p?this.expirationTime=c+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&o&&this.updateBuckets(e,o)}updateBuckets(e,o){if(!this.latestFeatureIndex)return;let c=this.latestFeatureIndex.loadVTLayers(),h=o.style.listImages(),p=o.style.getBrightness();for(let m in this.buckets){if(!o.style.hasLayer(m))continue;let y=this.buckets[m],v=y.layers[0].sourceLayer||"_geojsonTileLayer",C=c[v],T={};if(e&&(T=e[v],!C||!T||Object.keys(T).length===0))continue;if(y.update(T,C,h,this.imageAtlas&&this.imageAtlas.patternPositions||{},p),y instanceof eb||y instanceof $y){let D=o.style.getOwnSourceCache(y.layers[0].source);o._terrain&&o._terrain.enabled&&D&&y.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(D.id,this.tileID)}let E=o&&o.style&&o.style.getOwnLayer(m);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Rr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Rr.now()+e}setTexture(e,o){let c=o.context,h=c.gl;this.texture=this.texture||o.getTileTexture(e.width),this.texture&&this.texture instanceof Ya?this.texture.update(e,{useMipmap:!0}):(this.texture=new Ya(c,e,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(e,o){let c={};for(let h of o)c[h]=!0;this.dependencies[e]=c}hasDependency(e,o){for(let c of e){let h=this.dependencies[c];if(h){for(let p of o)if(h[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;let c=gs(TE,this.tileID.canonical,this.tileTransform)[0],h=new ms,p=new bg;for(let m=0;m<c.length;m++){let{x:y,y:v}=c[m];h.emplaceBack(y,v),p.emplaceBack(m)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(h,Mg.members),this._tileDebugSegments=Rn.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(e,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;let c=gs(TE,this.tileID.canonical,this.tileTransform)[0],h,p;if(this.isRaster){let m=function(y,v){let C=nu(y,v),T=Math.pow(2,y.z);for(let N=0;N<Qs;N++)for(let W=0;W<Qs;W++){let ee=Wo((y.x+(W+ME(W))/Za)/T),te=zr((y.y+(N+ME(N))/Za)/T),ie=v.project(ee,te),pe=N*Qs+W;Js[2*pe+0]=Math.round((ie.x*C.scale-C.x)*pt),Js[2*pe+1]=Math.round((ie.y*C.scale-C.y)*pt)}bd.fill(0),_b.fill(0);for(let N=2045;N>=0;N--){let W=4*N,ee=yd[W+0],te=yd[W+1],ie=yd[W+2],pe=yd[W+3],he=ee+ie>>1,ve=te+pe>>1,Ce=he+ve-te,Ae=ve+ee-he,je=te*Qs+ee,Le=pe*Qs+ie,qe=ve*Qs+he,ot=Math.hypot((Js[2*je+0]+Js[2*Le+0])/2-Js[2*qe+0],(Js[2*je+1]+Js[2*Le+1])/2-Js[2*qe+1])>=16;bd[qe]=bd[qe]||(ot?1:0),N<1022&&(bd[qe]=bd[qe]||bd[(te+Ae>>1)*Qs+(ee+Ce>>1)]||bd[(pe+Ae>>1)*Qs+(ie+Ce>>1)])}let E=new nd,D=new Ir,O=0;function R(N,W){let ee=W*Qs+N;return _b[ee]===0&&(E.emplaceBack(Js[2*ee+0],Js[2*ee+1],N*pt/Za,W*pt/Za),_b[ee]=++O),_b[ee]-1}function z(N,W,ee,te,ie,pe){let he=N+ee>>1,ve=W+te>>1;if(Math.abs(N-ie)+Math.abs(W-pe)>1&&bd[ve*Qs+he])z(ie,pe,N,W,he,ve),z(ee,te,ie,pe,he,ve);else{let Ce=R(N,W),Ae=R(ee,te),je=R(ie,pe);D.emplaceBack(Ce,Ae,je)}}return z(0,0,Za,Za,Za,0),z(Za,Za,0,0,0,Za),{vertices:E,indices:D}}(this.tileID.canonical,o);h=m.vertices,p=m.indices}else{h=new nd,p=new Ir;for(let{x:y,y:v}of c)h.emplaceBack(y,v,0,0);let m=Dg(h.int16,void 0,4);for(let y=0;y<m.length;y+=3)p.emplaceBack(m[y],m[y+1],m[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,yb.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=Rn.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(e,o){let c=o.projection;if(!c||c.name!=="globe"||o.freezeTileCoverage)return;let h=this.tileID.canonical,p=Ig(AT(h,o)),m=Gl(o.zoom),y;m>0&&(y=t.ad.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,h,o,p,y,m),this._makeGlobeTileDebugTextBuffer(e,h,o,p,y,m)}_globePoint(e,o,c,h,p,m,y){let v=Tg(e,o,c);if(m){let C=1<<c.z,T=Ys(h.center.lng),E=Zs(h.center.lat),D=(c.x+.5)/C-T,O=0;D>.5?O=-1:D<-.5&&(O=1);let R=(e/pt+c.x)/C+O,z=(o/pt+c.y)/C;R=(R-T)*h._pixelsPerMercatorPixel+T,z=(z-E)*h._pixelsPerMercatorPixel+E;let N=[R*h.worldSize,z*h.worldSize,0];t._.transformMat4(N,N,m),v=Wl(v,N,y)}return t._.transformMat4(v,v,p)}_makeGlobeTileDebugBorderBuffer(e,o,c,h,p,m){let y=new ms,v=new bg,C=new Iy,T=(D,O,R,z,N)=>{let W=(R-D)/(N-1),ee=(z-O)/(N-1),te=y.length;for(let ie=0;ie<N;ie++){let pe=D+ie*W,he=O+ie*ee;y.emplaceBack(pe,he);let ve=this._globePoint(pe,he,o,c,h,p,m);C.emplaceBack(ve[0],ve[1],ve[2]),v.emplaceBack(te+ie)}},E=pt;T(0,0,E,0,16),T(E,0,E,E,16),T(E,E,0,E,16),T(0,E,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(v),this._tileDebugBuffer=e.createVertexBuffer(y,Mg.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(C,DT.members),this._tileDebugSegments=Rn.simpleSegment(0,0,y.length,v.length)}_makeGlobeTileDebugTextBuffer(e,o,c,h,p,m){let y=pt/4,v=new ms,C=new Ir,T=new Iy,E=25;C.reserve(32),v.reserve(E),T.reserve(E);let D=(O,R)=>E*O+R;for(let O=0;O<E;O++){let R=O*y;for(let z=0;z<E;z++){let N=z*y;v.emplaceBack(N,R);let W=this._globePoint(N,R,o,c,h,p,m);T.emplaceBack(W[0],W[1],W[2])}}for(let O=0;O<4;O++)for(let R=0;R<4;R++){let z=D(O,R),N=D(O,R+1),W=D(O+1,R),ee=D(O+1,R+1);C.emplaceBack(z,N,W),C.emplaceBack(W,N,ee)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(C),this._tileDebugTextBuffer=e.createVertexBuffer(v,Mg.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(T,DT.members),this._tileDebugTextSegments=Rn.simpleSegment(0,0,E,32)}destroy(e=!1){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Ya&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let ci={read:function(i,e){return i.readFields(ci._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(i,e,o){i===1?e.header_length=o.readFixed32():i===2?e.x=o.readVarint():i===3?e.y=o.readVarint():i===4?e.z=o.readVarint():i===5&&e.layers.push(ci.Layer.read(o,o.readVarint()+o.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};ci.Filter.read=function(i,e){return i.readFields(ci.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},ci.Filter._readField=function(i,e,o){i===1?(e.delta_filter=ci.Filter.Delta.read(o,o.readVarint()+o.pos),e.filter="delta_filter"):i===2?(e.zigzag_filter=ci.Filter.Zigzag.read(o,o.readVarint()+o.pos),e.filter="zigzag_filter"):i===3?(e.bitshuffle_filter=ci.Filter.BitShuffle.read(o,o.readVarint()+o.pos),e.filter="bitshuffle_filter"):i===4&&(e.byteshuffle_filter=ci.Filter.ByteShuffle.read(o,o.readVarint()+o.pos),e.filter="byteshuffle_filter")},ci.Filter.Delta={},ci.Filter.Delta.read=function(i,e){return i.readFields(ci.Filter.Delta._readField,{block_size:0},e)},ci.Filter.Delta._readField=function(i,e,o){i===1&&(e.block_size=o.readVarint())},ci.Filter.Zigzag={},ci.Filter.Zigzag.read=function(i,e){return i.readFields(ci.Filter.Zigzag._readField,{},e)},ci.Filter.Zigzag._readField=function(i,e,o){},ci.Filter.BitShuffle={},ci.Filter.BitShuffle.read=function(i,e){return i.readFields(ci.Filter.BitShuffle._readField,{},e)},ci.Filter.BitShuffle._readField=function(i,e,o){},ci.Filter.ByteShuffle={},ci.Filter.ByteShuffle.read=function(i,e){return i.readFields(ci.Filter.ByteShuffle._readField,{},e)},ci.Filter.ByteShuffle._readField=function(i,e,o){},ci.Codec={},ci.Codec.read=function(i,e){return i.readFields(ci.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},ci.Codec._readField=function(i,e,o){i===1?(e.gzip_data=ci.Codec.GzipData.read(o,o.readVarint()+o.pos),e.codec="gzip_data"):i===2?(e.jpeg_image=ci.Codec.JpegImage.read(o,o.readVarint()+o.pos),e.codec="jpeg_image"):i===3?(e.webp_image=ci.Codec.WebpImage.read(o,o.readVarint()+o.pos),e.codec="webp_image"):i===4&&(e.png_image=ci.Codec.PngImage.read(o,o.readVarint()+o.pos),e.codec="png_image")},ci.Codec.GzipData={},ci.Codec.GzipData.read=function(i,e){return i.readFields(ci.Codec.GzipData._readField,{},e)},ci.Codec.GzipData._readField=function(i,e,o){},ci.Codec.JpegImage={},ci.Codec.JpegImage.read=function(i,e){return i.readFields(ci.Codec.JpegImage._readField,{},e)},ci.Codec.JpegImage._readField=function(i,e,o){},ci.Codec.WebpImage={},ci.Codec.WebpImage.read=function(i,e){return i.readFields(ci.Codec.WebpImage._readField,{},e)},ci.Codec.WebpImage._readField=function(i,e,o){},ci.Codec.PngImage={},ci.Codec.PngImage.read=function(i,e){return i.readFields(ci.Codec.PngImage._readField,{},e)},ci.Codec.PngImage._readField=function(i,e,o){},ci.DataIndexEntry={},ci.DataIndexEntry.read=function(i,e){return i.readFields(ci.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},ci.DataIndexEntry._readField=function(i,e,o){i===1?e.first_byte=o.readFixed64():i===2?e.last_byte=o.readFixed64():i===3?e.filters.push(ci.Filter.read(o,o.readVarint()+o.pos)):i===4?e.codec=ci.Codec.read(o,o.readVarint()+o.pos):i===5?e.offset=o.readFloat():i===6?e.scale=o.readFloat():i===7&&e.bands.push(o.readString())},ci.Layer={},ci.Layer.read=function(i,e){return i.readFields(ci.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},ci.Layer._readField=function(i,e,o){i===1?e.version=o.readVarint():i===2?e.name=o.readString():i===3?e.units=o.readString():i===4?e.tilesize=o.readVarint():i===5?e.buffer=o.readVarint():i===6?e.pixel_format=o.readVarint():i===7&&e.data_index.push(ci.DataIndexEntry.read(o,o.readVarint()+o.pos))};let vs={read:function(i,e){return i.readFields(vs._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(i,e,o){i===2?(e.uint32_values=vs.Uint32Values.read(o,o.readVarint()+o.pos),e.values="uint32_values"):i===3&&(e.fixed32_values=vs.Fixed32Values.read(o,o.readVarint()+o.pos),e.values="fixed32_values")},Uint32Values:{}};vs.Uint32Values.read=function(i,e){return i.readFields(vs.Uint32Values._readField,{values:[]},e)},vs.Uint32Values._readField=function(i,e,o){i===1&&(e.readValuesInto=function(c){if(c.type!==2)throw new Error(`Unsupported pbf type "${c.type}"`);let h=function(m){return m.type===2?m.readVarint()+m.pos:m.pos+1}(c),p=c.pos;return c.pos=h,function(m){c.pos=p;let y=0;for(;c.pos<h;){let v=c.readVarint();m[y++]=v}return m}}(o))},vs.Fixed32Values={},vs.Fixed32Values.read=function(i,e){return i.readFields(vs.Fixed32Values._readField,{values:[]},e)},vs.Fixed32Values._readField=function(i,e,o){throw new Error("Not implemented")};class S5{constructor(e=0,o=0,c=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=c,this.size=0,this.ttl=o}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let o=this.items[e];delete this.items[e],this.size--,o.prev!==null&&(o.prev.next=o.next),o.next!==null&&(o.next.prev=o.prev),this.first===o&&(this.first=o.next),this.last===o&&(this.last=o.prev)}return this}entries(e=this.keys()){return e.map(o=>[o,this.get(o)])}evict(e=!1){if(e||this.size>0){let o=this.first;delete this.items[o.key],--this.size==0?(this.first=null,this.last=null):(this.first=o.next,this.first.prev=null)}return this}expiresAt(e){let o;return this.has(e)&&(o=this.items[e].expiry),o}get(e){let o;if(this.has(e)){let c=this.items[e];this.ttl>0&&c.expiry<=Date.now()?this.delete(e):(o=c.value,this.set(e,o,!0))}return o}has(e){return e in this.items}keys(){let e=[],o=this.first;for(;o!==null;)e.push(o.key),o=o.next;return e}set(e,o,c=!1,h=this.resetTtl){let p;if(c||this.has(e)){if(p=this.items[e],p.value=o,c===!1&&h&&(p.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==p){let m=this.last,y=p.next,v=p.prev;this.first===p&&(this.first=p.next),p.next=null,p.prev=this.last,m.next=p,v!==null&&(v.next=y),y!==null&&(y.prev=v)}}else this.max>0&&this.size===this.max&&this.evict(!0),p=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:o},++this.size==1?this.first=p:this.last.next=p;return this.last=p,this}values(e=this.keys()){return e.map(o=>this.get(o))}}function M5(i,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let o=e[3];for(let c=2;c>=1;c--){let h=c===1?1:0,p=c===2?1:0;for(let m=0;m<e[0];m++){let y=e[1]*m;for(let v=h;v<e[1];v++){let C=e[2]*(v+y);for(let T=p;T<e[2];T++){let E=e[3]*(T+C);for(let D=0;D<e[3];D++){let O=E+D;i[O]+=i[O-o]}}}}o*=e[c]}return i}function T5(i){for(let e=0,o=i.length;e<o;e++)i[e]=i[e]>>>1^-(1&i[e]);return i}function I5(i,e){switch(e){case"uint32":return i;case"uint16":for(let o=0;o<i.length;o+=2){let c=i[o],h=i[o+1];i[o]=(240&c)>>4|(61440&c)>>8|(240&h)<<4|61440&h,i[o+1]=15&c|(3840&c)>>4|(15&h)<<8|(3840&h)<<4}return i;case"uint8":for(let o=0;o<i.length;o+=4){let c=i[o],h=i[o+1],p=i[o+2],m=i[o+3];i[o+0]=(192&c)>>6|(192&h)>>4|(192&p)>>2|192&m,i[o+1]=(48&c)>>4|(48&h)>>2|48&p|(48&m)<<2,i[o+2]=(12&c)>>2|12&h|(12&p)<<2|(12&m)<<4,i[o+3]=3&c|(3&h)<<2|(3&p)<<4|(3&m)<<6}return i;default:throw new Error(`Invalid pixel format, "${e}"`)}}class vd extends Error{constructor(e){super(e),this.name="MRTError"}}var Ea=Uint8Array,Jp=Uint16Array,E5=Int32Array,IE=new Ea([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),EE=new Ea([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),D5=new Ea([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DE=function(i,e){for(var o=new Jp(31),c=0;c<31;++c)o[c]=e+=1<<i[c-1];var h=new E5(o[30]);for(c=1;c<30;++c)for(var p=o[c];p<o[c+1];++p)h[p]=p-o[c]<<5|c;return{b:o,r:h}},kE=DE(IE,2),AE=kE.b,k5=kE.r;AE[28]=258,k5[258]=28;for(var A5=DE(EE,0).b,kw=new Jp(32768),or=0;or<32768;++or){var em=(43690&or)>>1|(21845&or)<<1;kw[or]=((65280&(em=(61680&(em=(52428&em)>>2|(13107&em)<<2))>>4|(3855&em)<<4))>>8|(255&em)<<8)>>1}var Gg=function(i,e,o){for(var c=i.length,h=0,p=new Jp(e);h<c;++h)i[h]&&++p[i[h]-1];var m,y=new Jp(e);for(h=1;h<e;++h)y[h]=y[h-1]+p[h-1]<<1;if(o){m=new Jp(1<<e);var v=15-e;for(h=0;h<c;++h)if(i[h])for(var C=h<<4|i[h],T=e-i[h],E=y[i[h]-1]++<<T,D=E|(1<<T)-1;E<=D;++E)m[kw[E]>>v]=C}else for(m=new Jp(c),h=0;h<c;++h)i[h]&&(m[h]=kw[y[i[h]-1]++]>>15-i[h]);return m},$g=new Ea(288);for(or=0;or<144;++or)$g[or]=8;for(or=144;or<256;++or)$g[or]=9;for(or=256;or<280;++or)$g[or]=7;for(or=280;or<288;++or)$g[or]=8;var PE=new Ea(32);for(or=0;or<32;++or)PE[or]=5;var P5=Gg($g,9,1),O5=Gg(PE,5,1),Aw=function(i){for(var e=i[0],o=1;o<i.length;++o)i[o]>e&&(e=i[o]);return e},xs=function(i,e,o){var c=e/8|0;return(i[c]|i[c+1]<<8)>>(7&e)&o},Pw=function(i,e){var o=e/8|0;return(i[o]|i[o+1]<<8|i[o+2]<<16)>>(7&e)},R5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ws=function(i,e,o){var c=new Error(e||R5[i]);if(c.code=i,Error.captureStackTrace&&Error.captureStackTrace(c,ws),!o)throw c;return c},F5=new Ea(0),L5=typeof TextDecoder<"u"&&new TextDecoder;try{L5.decode(F5,{stream:!0})}catch{}let z5={gzip_data:"gzip"},B5={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},N5={uint32:1,uint16:2,uint8:4},V5={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class Ow{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let o=new Uint8Array(e),c=new DataView(e);if(o[0]!==13)throw new vd("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(e){let o=new Uint8Array(e),c=this.getHeaderLength(e);if(o.length<c)throw new vd(`Expected header with length >= ${c} but got buffer of length ${o.length}`);let h=new Gp(o.subarray(0,c)),p=ci.read(h);if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new vd(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(let m of p.layers)this.layers[m.name]=new j5(m,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let o=[],c=this.getLayer(e.layerName);for(let h=0;h<c.dataIndex.length;h++){let p=c.dataIndex[h],m=p.first_byte-e.firstByte,y=p.last_byte+1-e.firstByte;if(h<e.firstBlock||h>e.lastBlock||c._blocksInProgress.has(h))continue;let v={layerName:c.name,firstByte:m,lastByte:y,pixelFormat:c.pixelFormat,blockIndex:h,blockShape:[p.bands.length].concat(c.bandShape),buffer:c.buffer,codec:p.codec.codec,filters:p.filters.map(C=>C.filter)};c._blocksInProgress.add(h),o.push(v)}return new OE(o,()=>{o.forEach(h=>c._blocksInProgress.delete(h.blockIndex))},(h,p)=>{if(o.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),h)throw h;p.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class j5{constructor({version:e,name:o,units:c,tilesize:h,pixel_format:p,buffer:m,data_index:y},v){if(this.version=e,this.version!==1)throw new vd(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=o,this.units=c,this.tileSize=h,this.buffer=m,this.pixelFormat=B5[p],this.dataIndex=y,this.bandShape=[h+2*m,h+2*m,N5[this.pixelFormat]],this._decodedBlocks=function(C=1e3,T=0,E=!1){if(isNaN(C)||C<0)throw new TypeError("Invalid max value");if(isNaN(T)||T<0)throw new TypeError("Invalid ttl value");if(typeof E!="boolean")throw new TypeError("Invalid resetTtl value");return new S5(C,T,E)}(v?v.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let o=e.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.set(o,e.data)}getBlockForBand(e){let o=0;switch(typeof e){case"string":for(let[c,h]of this.dataIndex.entries()){for(let[p,m]of h.bands.entries())if(m===e)return{bandIndex:o+p,blockIndex:c,blockBandIndex:p};o+=h.bands.length}break;case"number":for(let[c,h]of this.dataIndex.entries()){if(e>=o&&e<o+h.bands.length)return{bandIndex:e,blockIndex:c,blockBandIndex:e-o};o+=h.bands.length}break;default:throw new vd(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new vd(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let o=1/0,c=-1/0,h=1/0,p=-1/0;for(let m of e){let{blockIndex:y}=this.getBlockForBand(m);if(y<0)throw new vd(`Invalid band: ${JSON.stringify(m)}`);let v=this.dataIndex[y];h=Math.min(h,y),p=Math.max(p,y),o=Math.min(o,v.first_byte),c=Math.max(c,v.last_byte)}return{layerName:this.name,firstByte:o,lastByte:c,firstBlock:h,lastBlock:p}}hasBand(e){let{blockIndex:o}=this.getBlockForBand(e);return o>=0}hasDataForBand(e){let{blockIndex:o}=this.getBlockForBand(e);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(e){let{blockIndex:o,blockBandIndex:c}=this.getBlockForBand(e),h=this._decodedBlocks.get(o.toString());if(!h)throw new vd(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let p=this.dataIndex[o],m=this.bandShape.reduce((C,T)=>C*T,1),y=c*m,v=h.subarray(y,y+m);return{data:v,bytes:new Uint8Array(v.buffer).subarray(v.byteOffset,v.byteOffset+v.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:p.offset,scale:p.scale}}}class OE{constructor(e,o,c){this.tasks=e,this._onCancel=o,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,o){this._finalized||(this._onComplete(e,o),this._finalized=!0)}}Ow.performDecoding=function(i,e){return Promise.all(e.tasks.map(o=>{let{layerName:c,firstByte:h,lastByte:p,pixelFormat:m,blockShape:y,blockIndex:v,filters:C,codec:T}=o,E=new Uint8Array(i).subarray(h,p+1),D=new Uint32Array(y[0]*y[1]*y[2]),O;if(T!=="gzip_data")throw new Error(`Unhandled codec: ${T}`);return O=function(R,z){if(!globalThis.DecompressionStream&&z==="gzip_data")return Promise.resolve(((te=function(he){he[0]==31&&he[1]==139&&he[2]==8||ws(6,"invalid gzip data");var ve=he[3],Ce=10;4&ve&&(Ce+=2+(he[10]|he[11]<<8));for(var Ae=(ve>>3&1)+(ve>>4&1);Ae>0;Ae-=!he[Ce++]);return Ce+(2&ve)}(ee=R))+8>ee.length&&ws(6,"invalid gzip data"),function(he,ve,Ce,Ae){var je=he.length;if(!je||ve.f&&!ve.l)return Ce||new Ea(0);var Le=!Ce,qe=Le||ve.i!=2,ot=ve.i;Le&&(Ce=new Ea(3*je));var Ge,et,Ue=function(wd){var Cd=Ce.length;if(wd>Cd){var lu=new Ea(Math.max(2*Cd,wd));lu.set(Ce),Ce=lu}},tt=ve.f||0,lt=ve.p||0,nt=ve.b||0,Ct=ve.l,at=ve.d,ht=ve.m,Ut=ve.n,Bt=8*je;do{if(!Ct){tt=xs(he,lt,1);var Rt=xs(he,lt+1,3);if(lt+=3,!Rt){var ct=he[(Bi=4+((lt+7)/8|0))-4]|he[Bi-3]<<8,Ht=Bi+ct;if(Ht>je){ot&&ws(0);break}qe&&Ue(nt+ct),Ce.set(he.subarray(Bi,Ht),nt),ve.b=nt+=ct,ve.p=lt=8*Ht,ve.f=tt;continue}if(Rt==1)Ct=P5,at=O5,ht=9,Ut=5;else if(Rt==2){var ui=xs(he,lt,31)+257,Kt=xs(he,lt+10,15)+4,fi=ui+xs(he,lt+5,31)+1;lt+=14;for(var pi=new Ea(fi),wi=new Ea(19),qt=0;qt<Kt;++qt)wi[D5[qt]]=xs(he,lt+3*qt,7);lt+=3*Kt;var un=Aw(wi),cn=(1<<un)-1,qi=Gg(wi,un,1);for(qt=0;qt<fi;){var Bi,Yi=qi[xs(he,lt,cn)];if(lt+=15&Yi,(Bi=Yi>>4)<16)pi[qt++]=Bi;else{var wn=0,yn=0;for(Bi==16?(yn=3+xs(he,lt,3),lt+=2,wn=pi[qt-1]):Bi==17?(yn=3+xs(he,lt,7),lt+=3):Bi==18&&(yn=11+xs(he,lt,127),lt+=7);yn--;)pi[qt++]=wn}}var jn=pi.subarray(0,ui),Ln=pi.subarray(ui);ht=Aw(jn),Ut=Aw(Ln),Ct=Gg(jn,ht,1),at=Gg(Ln,Ut,1)}else ws(1);if(lt>Bt){ot&&ws(0);break}}qe&&Ue(nt+131072);for(var ro=(1<<ht)-1,Gn=(1<<Ut)-1,Pn=lt;;Pn=lt){var hr=(wn=Ct[Pw(he,lt)&ro])>>4;if((lt+=15&wn)>Bt){ot&&ws(0);break}if(wn||ws(2),hr<256)Ce[nt++]=hr;else{if(hr==256){Pn=lt,Ct=null;break}var Br=hr-254;hr>264&&(Br=xs(he,lt,(1<<(Oo=IE[qt=hr-257]))-1)+AE[qt],lt+=Oo);var Nr=at[Pw(he,lt)&Gn],vn=Nr>>4;if(Nr||ws(3),lt+=15&Nr,Ln=A5[vn],vn>3){var Oo=EE[vn];Ln+=Pw(he,lt)&(1<<Oo)-1,lt+=Oo}if(lt>Bt){ot&&ws(0);break}qe&&Ue(nt+131072);var Yl=nt+Br;if(nt<Ln){var Xa=0-Ln,Ss=Math.min(Ln,Yl);for(Xa+nt<0&&ws(3);nt<Ss;++nt)Ce[nt]=(void 0)[Xa+nt]}for(;nt<Yl;++nt)Ce[nt]=Ce[nt-Ln]}}ve.l=Ct,ve.p=Pn,ve.b=nt,ve.f=tt,Ct&&(tt=1,ve.m=ht,ve.d=at,ve.n=Ut)}while(!tt);return nt!=Ce.length&&Le?(Ge=Ce,((et=nt)==null||et>Ge.length)&&(et=Ge.length),new Ea(Ge.subarray(0,et))):Ce.subarray(0,nt)}(ee.subarray(te,-8),{i:2},new Ea(((N=ee)[(W=N.length)-4]|N[W-3]<<8|N[W-2]<<16|N[W-1]<<24)>>>0))));var N,W,ee,te;let ie=z5[z];if(!ie)throw new Error(`Unhandled codec: ${z}`);let pe=new globalThis.DecompressionStream(ie);return new Response(new Blob([R]).stream().pipeThrough(pe)).arrayBuffer().then(he=>new Uint8Array(he))}(E,T).then(R=>{let z=vs.read(new Gp(R));if(z.values==="uint32_values")return z.uint32_values.readValuesInto(D),new V5[m](D.buffer);throw new Error(`Unhandled numeric data "${z.values}"`)}),O.then(R=>{for(let z=C.length-1;z>=0;z--)switch(C[z]){case"delta_filter":M5(R,y);break;case"zigzag_filter":T5(R);break;case"bitshuffle_filter":I5(R,m);break;default:throw new Error(`Unhandled filter "${C[z]}"`)}return{layerName:c,blockIndex:v,data:R}}).catch(R=>{throw R})}))};class RE extends bb{constructor(e,o,c,h,p){super(e,o,c,h,p),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,o){let c=o.context,h=c.gl;this.texture=this.texture||o.getTileTexture(e.width),this.texture&&this.texture instanceof Ya?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new Ya(c,e,h.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,o){let c=this._mrt=new Ow(30),h=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=Il(h,(p,m,y,v)=>{if(p)o(p);else try{let C=c.getHeaderLength(m);if(C>e)return void(this.request=this.fetchHeader(C,o));c.parseHeader(m),this._isHeaderLoaded=!0;let T=0;for(let E of Object.values(c.layers))T=Math.max(T,E.dataIndex[E.dataIndex.length-1].last_byte);m.byteLength>=T&&(this.entireBuffer=m),o(null,this.entireBuffer||m,y,v)}catch(C){o(C)}}),this.request}fetchBand(e,o,c){let h=this._mrt;if(!this._isHeaderLoaded||!h)return void c(new Error("Tile header is not ready"));let p=this.actor;if(!p)return void c(new Error("Can't fetch tile band without an actor"));let m,y=(E,D)=>{m.complete(E,D),E?c(E):(this.updateTextureDescriptor(e,o),c(null,this.textureDescriptor&&this.textureDescriptor.img))},v=(E,D)=>{if(E)return c(E);let O=p.send("decodeRasterArray",{buffer:D,task:m},y,void 0,!0);this._workQueue.push(()=>{O&&O.cancel(),m.cancel()})},C=h.getLayer(e);if(!C)return void c(new Error(`Unknown sourceLayer "${e}"`));if(C.hasDataForBand(o))return this.updateTextureDescriptor(e,o),void c(null,this.textureDescriptor?this.textureDescriptor.img:null);let T=C.getDataRange([o]);if(m=h.createDecodingTask(T),!m||m.tasks.length)if(this.flushQueues(),this.entireBuffer)v(null,this.entireBuffer.slice(T.firstByte,T.lastByte+1));else{let E=Object.assign({},this.requestParams,{headers:{Range:`bytes=${T.firstByte}-${T.lastByte}`}}),D=Il(E,v);this._fetchQueue.push(()=>{D.cancel(),m.cancel()})}else c(null)}updateNeeded(e,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,o){if(!this._mrt)return;let c=this._mrt.getLayer(e);if(!c||!c.hasBand(o)||!c.hasDataForBand(o))return;let{bytes:h,tileSize:p,buffer:m,offset:y,scale:v}=c.getBandView(o),C=p+2*m,T={data:h,width:C,height:C},E=this.texture;E&&E instanceof Ya&&E.update(T,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:o,img:T,buffer:m,offset:y,tileSize:p,format:c.pixelFormat,mix:[v,256*v,65536*v,16777216*v]}}}class U5{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(let e in this.data)for(let o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,c){let h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);let p={value:o,timeout:void 0};if(c!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},c)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){let m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){let o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;let c=e.wrapped().key,h=o===void 0?0:this.data[c].indexOf(o),p=this.data[c][h];return this.data[c].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(p.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){let o=[];for(let c in this.data)for(let h of this.data[c])e(h.value)||o.push(h);for(let c of o)this.remove(c.value.tileID,c)}}class ru extends Dl{constructor(e,o,c){super(),this.id=e,this._onlySymbols=c,o.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new U5(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Gz,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let o=this._tiles[e];if(o.state!=="errored"&&(o.state!=="loaded"||!o.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,o){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,o)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let o in this._tiles){let c=this._tiles[o];c.upload(e),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Jo(this._tiles).map(e=>e.tileID).sort(FE).map(e=>e.key)}getRenderableIds(e,o){let c=[];for(let h in this._tiles)this._isIdRenderable(+h,e,o)&&c.push(this._tiles[h]);return e?c.sort((h,p)=>{let m=h.tileID,y=p.tileID,v=new vt(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),C=new vt(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-y.overscaledZ||C.y-v.y||C.x-v.x}).map(h=>h.tileID.key):c.map(h=>h.tileID).sort(FE).map(h=>h.key)}hasRenderableParent(e){let o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o,c){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())&&(c||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,o){let c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=o),this._loadTile(c,this._tileLoaded.bind(this,c,e,o)))}_tileLoaded(e,o,c,h){if(h)if(e.state="errored",h.status!==404)this._source.fire(new hp(h,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new fo("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Rr.now(),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new fo("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let o=this.getRenderableIds();for(let h=0;h<o.length;h++){let p=o[h];if(e.neighboringTiles&&e.neighboringTiles[p]){let m=this.getTileByID(p);c(e,m),c(m,e)}}function c(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let m=p.tileID.canonical.x-h.tileID.canonical.x,y=p.tileID.canonical.y-h.tileID.canonical.y,v=Math.pow(2,h.tileID.canonical.z),C=p.tileID.key;m===0&&y===0||Math.abs(y)>1||(Math.abs(m)>1&&(Math.abs(m+v)===1?m+=v:Math.abs(m-v)===1&&(m-=v)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,m,y),h.neighboringTiles&&h.neighboringTiles[C]&&(h.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,c,h){for(let p in this._tiles){let m=this._tiles[p];if(h[p]||!m.hasData()||m.tileID.overscaledZ<=o||m.tileID.overscaledZ>c)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>o+1;){let C=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[C.key],m&&m.hasData()&&(y=C)}let v=y;for(;v.overscaledZ>o;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){h[y.key]=y;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){let c=this._loadedParentTiles[e.key];return c&&c.tileID.overscaledZ>=o?c:null}for(let c=e.overscaledZ-1;c>=o;c--){let h=e.scaledTo(c),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(e){let o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,o){o=o||this._source.tileSize;let c=Math.ceil(e.width/o)+1,h=Math.ceil(e.height/o)+1,p=Math.floor(c*h*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(e){let o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){let c={};for(let h in this._tiles){let p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+o),c[p.tileID.key]=p}this._tiles=c;for(let h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(let h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,o,c,h){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let p;if(this.updateCacheSize(e,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)p=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new mr(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y));else if(this.tileCoverLift!==0){let v=e.clone();v.tileCoverLift=this.tileCoverLift,p=v.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(p.push(new mr(1,0,1,0,0)),p.push(new mr(1,0,1,1,0)),p.push(new mr(1,0,1,0,1)),p.push(new mr(1,0,1,1,1)))}else if(p=e.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let v=this._source.hasTile.bind(this._source);p=p.filter(C=>v(C))}}else p=[];if(p.length>0&&this.castsShadows&&h&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Rw(this._source.type)){let v=e.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),C=Math.min(v,this._source.maxzoom),T=e.extendTileCoverForShadows(p,h,C);for(let E of T)this._shadowCasterTiles[E.key]=!0,p.push(E)}let m=this._updateRetainedTiles(p);if(Rw(this._source.type)&&p.length!==0){let v={},C={},T=Object.keys(m);for(let D of T){let O=m[D],R=this._tiles[D];if(!R||R.fadeEndTime&&R.fadeEndTime<=Rr.now())continue;let z=this.findLoadedParent(O,Math.max(O.overscaledZ-ru.maxOverzooming,this._source.minzoom));z&&(this._addTile(z.tileID),v[z.tileID.key]=z.tileID),C[D]=O}let E=p[p.length-1].overscaledZ;for(let D in this._tiles){let O=this._tiles[D];if(m[D]||!O.hasData())continue;let R=O.tileID;for(;R.overscaledZ>E;){R=R.scaledTo(R.overscaledZ-1);let z=this._tiles[R.key];if(z&&z.hasData()&&C[R.key]){m[D]=O.tileID;break}}}for(let D in v)m[D]||(this._coveredTiles[D]=!0,m[D]=v[D])}for(let v in m)this._tiles[v].clearFadeHold();let y=function(v,C){let T=[];for(let E in v)E in C||T.push(E);return T}(this._tiles,m);for(let v of y){let C=this._tiles[v];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let o={};if(e.length===0)return o;let c={},h=e.reduce((C,T)=>Math.min(C,T.overscaledZ),1/0),p=e[0].overscaledZ,m=Math.max(p-ru.maxOverzooming,this._source.minzoom),y=Math.max(p+ru.maxUnderzooming,this._source.minzoom),v={};for(let C of e){let T=this._addTile(C);o[C.key]=C,T.hasData()||h<this._source.maxzoom&&(v[C.key]=C)}this._retainLoadedChildren(v,h,y,o);for(let C of e){let T=this._tiles[C.key];if(T.hasData())continue;if(C.canonical.z>=this._source.maxzoom){let D=C.children(this._source.maxzoom)[0],O=this.getTile(D);if(O&&O.hasData()){o[D.key]=D;continue}}else{let D=C.children(this._source.maxzoom);if(o[D[0].key]&&o[D[1].key]&&o[D[2].key]&&o[D[3].key])continue}let E=T.wasRequested();for(let D=C.overscaledZ-1;D>=m;--D){let O=C.scaledTo(D);if(c[O.key]||(c[O.key]=!0,T=this.getTile(O),!T&&E&&(T=this._addTile(O)),T&&(o[O.key]=O,E=T.wasRequested(),T.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let o=[],c,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){c=this._loadedParentTiles[h.key];break}o.push(h.key);let p=h.scaledTo(h.overscaledZ-1);if(c=this._getLoadedTile(p),c)break;h=p}for(let p of o)this._loadedParentTiles[p]=c}}_addTile(e){let o=this._tiles[e.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));let c=!!o;if(!c){let h=this.map?this.map.painter:null,p=this._source.tileSize*e.overscaleFactor();o=this._source.type==="raster-array"?new RE(e,p,this.transform.tileZoom,h,this._isRaster):new bb(e,p,this.transform.tileZoom,h,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,e.key,o.state))}return o?(o.uses++,this._tiles[e.key]=o,c||this._source.fire(new fo("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let c=o.getExpiryTimeout();c&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},c))}_removeTile(e){let o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,o,c){let h=[],p=this.transform;if(!p)return h;let m=p.projection.name==="globe",y=Ys(p.center.lng);for(let v in this._tiles){let C=this._tiles[v];if(c&&C.clearQueryDebugViz(),C.holdingForFade())continue;let T;if(m){let E=C.tileID.canonical;if(E.z===0){let D=[Math.abs(yi(y,...qg(E,-1))-y),Math.abs(yi(y,...qg(E,1))-y)];T=[0,2*D.indexOf(Math.min(...D))-1]}else{let D=[Math.abs(yi(y,...qg(E,-1))-y),Math.abs(yi(y,...qg(E,0))-y),Math.abs(yi(y,...qg(E,1))-y)];T=[D.indexOf(Math.min(...D))-1]}}else T=[0];for(let E of T){let D=e.containsTile(C,p,o,E);D&&h.push(D)}}return h}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,o){let c=this.getRenderableIds(e,o).map(p=>this._tiles[p].tileID),h=this.transform.projection.name==="globe";for(let p of c)p.projMatrix=this.transform.calculateProjMatrix(p.toUnwrapped()),p.expandedProjMatrix=h?this.transform.calculateProjMatrix(p.toUnwrapped(),!1,!0):p.projMatrix;return c}sortCoordinatesByDistance(e){let o=e.slice(),c=this.transform._camera.position,h=this.transform._camera.forward(),p={};for(let m of o){let y=1/(1<<m.canonical.z);p[m.key]=((m.canonical.x+.5)*y+m.wrap-c[0])*h[0]+((m.canonical.y+.5)*y-c[1])*h[1]-c[2]*h[2]}return o.sort((m,y)=>p[m.key]-p[y.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(Rw(this._source.type))for(let e in this._tiles){let o=this._tiles[e];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=Rr.now())return!0}return!1}setFeatureState(e,o,c){this._state.updateState(e=e||"_geojsonTileLayer",o,c)}removeFeatureState(e,o,c){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,c)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,c){let h=this._tiles[e];h&&h.setDependencies(o,c)}reloadTilesForDependencies(e,o){for(let c in this._tiles)this._tiles[c].hasDependency(e,o)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(e,o))}_preloadTiles(e,o){if(!this._sourceLoaded){let y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,o))};return void this._source.on("data",y)}let c=new Map,h=Array.isArray(e)?e:[e],p=this.map.painter.terrain,m=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(let y of h){let v=y.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let C of v)c.set(C.key,C);this.usedForTerrain&&y.updateElevation(!1)}Oc(Array.from(c.values()),(y,v)=>{let C=new bb(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(C,T=>{this._source.type==="raster-dem"&&C.dem&&this._backfillDEM(C),v(T,C)})},o)}}function FE(i,e){let o=Math.abs(2*i.wrap)-+(i.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||c-o||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function Rw(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function qg(i,e){let o=1<<i.z;return[i.x/o+e,(i.x+1)/o+e]}ru.maxOverzooming=10,ru.maxUnderzooming=3;let LE=new class extends wt{possiblyEvaluate(i,e){return e=new ti(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,o,c){return e=Zr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,o,c)}}(tb.paint.properties["line-width"].specification);function zE(i,e){return e>0?e+2*i:i}LE.useIntegerZoom=!0;let H5=new Qi({"symbol-placement":new Qe(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Qe(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qe(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wt(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qe(Pe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Qe(Pe.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Qe(Pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Qe(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qe(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qe(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new wt(Pe.layout_symbol["icon-size"]),"icon-text-fit":new wt(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wt(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new wt(Pe.layout_symbol["icon-image"]),"icon-rotate":new wt(Pe.layout_symbol["icon-rotate"]),"icon-padding":new Qe(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Qe(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new wt(Pe.layout_symbol["icon-offset"]),"icon-anchor":new wt(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qe(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qe(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qe(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new wt(Pe.layout_symbol["text-field"]),"text-font":new wt(Pe.layout_symbol["text-font"]),"text-size":new wt(Pe.layout_symbol["text-size"]),"text-max-width":new wt(Pe.layout_symbol["text-max-width"]),"text-line-height":new wt(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new wt(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new wt(Pe.layout_symbol["text-justify"]),"text-radial-offset":new wt(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qe(Pe.layout_symbol["text-variable-anchor"]),"text-anchor":new wt(Pe.layout_symbol["text-anchor"]),"text-max-angle":new Qe(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Qe(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new wt(Pe.layout_symbol["text-rotate"]),"text-padding":new Qe(Pe.layout_symbol["text-padding"]),"text-keep-upright":new Qe(Pe.layout_symbol["text-keep-upright"]),"text-transform":new wt(Pe.layout_symbol["text-transform"]),"text-offset":new wt(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new Qe(Pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Qe(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new Qe(Pe.layout_symbol["text-optional"]),visibility:new Qe(Pe.layout_symbol.visibility)});var Fw={paint:new Qi({"icon-opacity":new wt(Pe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new wt(Pe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new wt(Pe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new wt(Pe.paint_symbol["text-emissive-strength"]),"icon-color":new wt(Pe.paint_symbol["icon-color"]),"icon-halo-color":new wt(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new wt(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wt(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Qe(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qe(Pe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new wt(Pe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new wt(Pe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new wt(Pe.paint_symbol["text-occlusion-opacity"]),"text-color":new wt(Pe.paint_symbol["text-color"],{runtimeType:go,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new wt(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new wt(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new wt(Pe.paint_symbol["text-halo-blur"]),"text-translate":new Qe(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new Qe(Pe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Qe(Pe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Qe(Pe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Qe(Pe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Qe(Pe.paint_symbol["icon-color-brightness-max"])}),layout:H5};class BE{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Hc,this.defaultValue=e}evaluate(e){if(e.formattedSection){let o=this.defaultValue.property.overrides;if(o&&o.hasOverride(e.formattedSection))return o.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ne(BE,"FormatSectionOverride",{omit:["defaultValue"]});class vb extends pr{constructor(e,o,c,h){super(e,Fw,o,c,h),this._colorAdjustmentMatrix=t.ad.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,o){super.recalculate(e,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let c=this.layout.get("text-writing-mode");if(c){let h=[];for(let p of c)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,o,c,h){return this._saturation===e&&this._contrast===o&&this._brightnessMin===c&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(p,m,y,v){p=tp(p),m=ep(m);let C=t.ad.create(),T=p/3,E=1-2*T,D=[E,T,T,0,T,E,T,0,T,T,E,0,0,0,0,1],O=.5-.5*m,R=v-y;return t.ad.multiply(C,[R,0,0,0,0,R,0,0,0,0,R,0,y,y,y,1],[m,0,0,0,0,m,0,0,0,0,m,0,O,O,O,1]),t.ad.multiply(C,C,D),C}(e,o,c,h),this._saturation=e,this._contrast=o,this._brightnessMin=c,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,o,c,h){let p=this.layout.get(e).evaluate(o,{},c,h),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||B(m.value)||!p?p:function(y,v){return v.replace(/{([^{}]+)}/g,(C,T)=>T in y?String(y[T]):"")}(o.properties,p)}createBucket(e){return new Qp(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of Fw.paint.overridableProperties){if(!vb.hasPaintOverride(this.layout,e))continue;let o=this.paint.get(e),c=new BE(o),h=new F(c,o.property.specification,this.scope,this.options),p=null;p=o.value.kind==="constant"||o.value.kind==="source"?new H("source",h):new q("composite",h,o.value.zoomStops,o.value._interpolationType),this.paint._values[e]=new Mn(o.property,p,o.parameters)}}_handleOverridablePaintPropertyUpdate(e,o,c){return!(!this.layout||o.isDataDriven()||c.isDataDriven())&&vb.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,o){let c=e.get("text-field"),h=Fw.paint.properties[o],p=!1,m=y=>{for(let v of y)if(h.overrides&&h.overrides.hasOverride(v))return void(p=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Xr)m(c.value.value.sections);else if(c.value.kind==="source"){let y=C=>{p||(C instanceof ds&&dr(C.value)===Gc?m(C.value.sections):C instanceof Ah?m(C.sections):C.eachChild(y))},v=c.value;v._styleExpression&&y(v._styleExpression.expression)}return p}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,o=this.paint.get("text-opacity").constantOr(1)!==0,c=[];return e&&c.push("symbolIcon"),o&&c.push("symbolSDF"),c}getDefaultProgramParams(e,o,c){return{config:new Kh(this,{zoom:o,lut:c}),overrideFog:!1}}}let W5=new Qi({visibility:new Qe(Pe.layout_background.visibility)});var G5={paint:new Qi({"background-color":new Qe(Pe.paint_background["background-color"]),"background-pattern":new Qe(Pe.paint_background["background-pattern"]),"background-opacity":new Qe(Pe.paint_background["background-opacity"]),"background-emissive-strength":new Qe(Pe.paint_background["background-emissive-strength"])}),layout:W5};let $5=new Qi({visibility:new Qe(Pe.layout_raster.visibility)});var q5={paint:new Qi({"raster-opacity":new Qe(Pe.paint_raster["raster-opacity"]),"raster-color":new On(Pe.paint_raster["raster-color"]),"raster-color-mix":new Qe(Pe.paint_raster["raster-color-mix"]),"raster-color-range":new Qe(Pe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Qe(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qe(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qe(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Qe(Pe.paint_raster["raster-saturation"]),"raster-contrast":new Qe(Pe.paint_raster["raster-contrast"]),"raster-resampling":new Qe(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Qe(Pe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Qe(Pe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Qe(Pe.paint_raster["raster-array-band"]),"raster-elevation":new Qe(Pe.paint_raster["raster-elevation"])}),layout:$5};function xb(i,e,o,c,h,p,m,y){let v=[i,e,1,o,c,1,h,p,1],C=[m,y,1],T=t.bC.adjoint([],v),[E,D,O]=t._.transformMat3(C,C,T);return t.bC.multiply(v,v,[E,0,0,0,D,0,0,0,O])}function NE(i,e,o,c,h,p,m,y){let v=function(C,T,E,D,O,R,z,N){let W=xb(0,0,1,0,1,1,0,1),ee=xb(C,T,E,D,O,R,z,N),te=t.bC.adjoint([],W);return t.bC.multiply(ee,ee,te)}(i,e,o,c,h,p,m,y);return[v[2]/v[8]/pt,v[5]/v[8]/pt]}function wb(i){return[i[0],Math.min(Math.max(i[1],-er),er)]}class VE extends Dl{constructor(e,o,c,h){super(),this.id=e,this.dispatcher=c,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=o,this._dirty=!1}load(e,o){if(this._loaded=o||!1,this.fire(new fo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Bs(this.map._requestManager.transformRequest(this.url,ap.Image),(c,h)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new hp(c)):h&&(this.image=h instanceof HTMLImageElement?Rr.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new gb(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new fo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof gb||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=e[0][1],c=e[0][1];for(let p of e)p[1]>c&&(c=p[1]),p[1]<o&&(o=p[1]);let h=(c+o)/2;if(h>er?this.onNorthPole=!0:h<-er&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let p=e.map(no.fromLngLat);this.tileID=function(m){let y=1/0,v=1/0,C=-1/0,T=-1/0;for(let z of m)y=Math.min(y,z.x),v=Math.min(v,z.y),C=Math.max(C,z.x),T=Math.max(T,z.y);let E=Math.max(C-y,T-v),D=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),O=Math.pow(2,D),R=Math.floor((y+C)/2*O);return R>1&&(R-=1),new Jh(D,R,Math.floor((v+T)/2*O))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new fo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let N in this.tiles){let W=this.tiles[N];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let o=nu(new Jh(0,0,0),this.map.transform.projection),c=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){let W=N[1].x-N[0].x,ee=N[1].y-N[0].y,te=N[2].x-N[1].x,ie=N[2].y-N[1].y,pe=N[3].x-N[2].x,he=N[3].y-N[2].y,ve=N[0].x-N[3].x,Ce=N[0].y-N[3].y,Ae=W*ie-te*ee,je=te*he-pe*ie,Le=pe*Ce-ve*he,qe=ve*ee-W*Ce;return Ae>0&&je>0&&Le>0&&qe>0||Ae<0&&je<0&&Le<0&&qe<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let h=nu(this.tileID,this.map.transform.projection),[p,m,y,v]=this.coordinates.map(N=>{let W=h.projection.project(N[0],N[1]);return bE(h,W)._round()});this.perspectiveTransform=NE(p.x,p.y,m.x,m.y,y.x,y.y,v.x,v.y);let C=this._boundsArray=new nd;C.emplaceBack(p.x,p.y,0,0),C.emplaceBack(m.x,m.y,pt,0),C.emplaceBack(v.x,v.y,0,pt),C.emplaceBack(y.x,y.y,pt,pt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(C,yb.members),this.boundsSegments=Rn.simpleSegment(0,0,4,2);let T=[],E=function(N){return[wb(N[0]),wb(N[1]),wb(N[2]),wb(N[3])]}(this.coordinates),[D,O,R,z]=function(N){let W=N[0][0],ee=W,te=N[0][1],ie=te;for(let pe=1;pe<N.length;pe++)N[pe][0]<W?W=N[pe][0]:N[pe][0]>ee&&(ee=N[pe][0]),N[pe][1]<te?te=N[pe][1]:N[pe][1]>ie&&(ie=N[pe][1]);return[W,te,ee-W,ie-te]}(E);{let N=new nd,[W,ee,te,ie]=function(Ue){let tt=Ue[0].x,lt=tt,nt=Ue[0].y,Ct=nt;for(let at=1;at<Ue.length;at++)Ue[at].x<tt?tt=Ue[at].x:Ue[at].x>lt&&(lt=Ue[at].x),Ue[at].y<nt?nt=Ue[at].y:Ue[at].y>Ct&&(Ct=Ue[at].y);return[tt,nt,lt-tt,Ct-nt]}(c),pe=Ue=>[(Ue.x-W)/te,(Ue.y-ee)/ie],[he,ve,Ce,Ae]=c.map(pe),je=function(Ue,tt,lt,nt,Ct,at,ht,Ut){let Bt=xb(0,0,1,0,1,1,0,1),Rt=xb(Ue,tt,lt,nt,Ct,at,ht,Ut),ct=t.bC.adjoint([],Rt);return t.bC.multiply(Bt,Bt,ct)}(he[0],he[1],ve[0],ve[1],Ce[0],Ce[1],Ae[0],Ae[1]);this.elevatedGlobePerspectiveTransform=NE(he[0],he[1],ve[0],ve[1],Ce[0],Ce[1],Ae[0],Ae[1]);let Le=(Ue,tt)=>{T.push(Ue.lng);let lt=Math.round((Ue.lng-D)/R*pt),nt=Math.round((Ue.lat-O)/z*pt),Ct=pe(tt),at=t._.transformMat3([],[Ct[0],Ct[1],1],je),ht=Math.round(at[0]/at[2]*pt),Ut=Math.round(at[1]/at[2]*pt);N.emplaceBack(lt,nt,ht,Ut)},qe=c[3].x-c[0].x,ot=c[3].y-c[0].y,Ge=c[2].x-c[1].x,et=c[2].y-c[1].y;for(let Ue=0;Ue<65;Ue++){let tt=Ue/64,lt=[c[0].x+tt*qe,c[0].y+tt*ot],nt=[c[1].x+tt*Ge,c[1].y+tt*et],Ct=nt[0]-lt[0],at=nt[1]-lt[1];for(let ht=0;ht<65;ht++){let Ut=ht/64,Bt={x:lt[0]+Ct*Ut,y:lt[1]+at*Ut,z:0};Le(o.projection.unproject(Bt.x,Bt.y),Bt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(N,yb.members)}{this.maxLongitudeTriangleSize=0;let N=[],W=new Ir,ee=(te,ie,pe)=>{W.emplaceBack(te,ie,pe);let he=T[te],ve=T[ie],Ce=T[pe],Ae=Math.min(Math.min(he,ve),Ce),je=Math.max(Math.max(he,ve),Ce)-Ae;je>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=je),N.push(Ae+je/2)};for(let te=0;te<64;te++)for(let ie=0;ie<64;ie++){let pe=65*te+ie,he=pe+1,ve=pe+65,Ce=ve+1;ee(pe,ve,he),ee(he,ve,Ce)}[N,W]=function(te,ie){let pe=Array.from({length:te.length},(Ce,Ae)=>Ae);pe.sort((Ce,Ae)=>te[Ce]-te[Ae]);let he=[],ve=new Ir;for(let Ce=0;Ce<pe.length;Ce++){let Ae=pe[Ce];he.push(te[Ae]);let je=3*Ae,Le=je+1;ve.emplaceBack(ie.uint16[je],ie.uint16[Le],ie.uint16[Le+1])}return[he,ve]}(N,W),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(W)}this.elevatedGlobeSegments=Rn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/pt,0,z/pt,0,0,O,D,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let o=this.map.painter.context,c=o.gl;!this._dirty||this.texture instanceof gb||(this.texture?this.texture.update(this.image):(this.texture=new Ya(o,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(o)}loadTile(e,o){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},o(null)):(e.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;let c=this.elevatedGlobeTrianglesCenterLongitudes,h=(p=e+180)+360*Math.round((c[0]-p)/360);var p;let m=new Rn,y=(E,D)=>{m.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:o.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},v=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-h)<=v){let E=z0(c,0,c.length,h+v);return E===c.length||y(E,If(c,E+1,c.length,h+360-v)-E),m}h<c[0]&&(h+=360);let C=If(c,0,c.length,h-v);if(C===c.length)return y(0,c.length),m;y(0,C-0);let T=z0(c,C+1,c.length,h+v);return T!==c.length&&y(T,c.length-T),m}}let Y5=(Math.pow(256,2)-1)/16907520;class jE extends pr{constructor(e,o,c,h){super(e,q5,o,c,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof VE&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let o=this._transitionablePaint._values["raster-color"].value.expression,[c,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(h)||c===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=Eg({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,h])}}let Z5=new Qi({visibility:new Qe(Pe["layout_raster-particle"].visibility)});var X5={paint:new Qi({"raster-particle-array-band":new Qe(Pe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Qe(Pe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new On(Pe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Qe(Pe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Qe(Pe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Qe(Pe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Qe(Pe["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:Z5};class UE extends pr{constructor(e,o,c,h){super(e,X5,o,c,h),this._updateColorRamp(),this.lastInvalidatedAt=Rr.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Eg({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Rr.now()}}class K5 extends pr{constructor(e,o){super(e,{},o,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let Q5=new Qi({visibility:new Qe(Pe.layout_sky.visibility)});var J5={paint:new Qi({"sky-type":new Qe(Pe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Qe(Pe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Qe(Pe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Qe(Pe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Qe(Pe.paint_sky["sky-gradient-radius"]),"sky-gradient":new On(Pe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Qe(Pe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Qe(Pe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Qe(Pe.paint_sky["sky-opacity"])}),layout:Q5};function Lw(i,e,o){let c=[0,0,1],h=t.av.identity([]);return t.av.rotateY(h,h,o?-Li(i)+Math.PI:Li(i)),t.av.rotateX(h,h,-Li(e)),t._.transformQuat(c,c,h),t._.normalize(c,c)}var eB={paint:new Qi({})};function HE(i,e){let o=Cb(i.projection,i.zoom,i.width,i.height),c=function(p,m,y,v,C){let T=new Hi(y.lng-180*xd,y.lat),E=new Hi(y.lng+180*xd,y.lat),D=p.project(T.lng,T.lat),O=p.project(E.lng,E.lat),R=-Math.atan2(O.y-D.y,O.x-D.x),z=no.fromLngLat(y);z.y=yi(z.y,-1+xd,1-xd);let N=z.toLngLat(),W=p.project(N.lng,N.lat),ee=no.fromLngLat(N);ee.x+=xd;let te=ee.toLngLat(),ie=p.project(te.lng,te.lat),pe=$E(ie.x-W.x,ie.y-W.y,R),he=no.fromLngLat(N);he.y+=xd;let ve=he.toLngLat(),Ce=p.project(ve.lng,ve.lat),Ae=$E(Ce.x-W.x,Ce.y-W.y,R),je=Math.abs(pe.x)/Math.abs(Ae.y),Le=t.ad.identity([]);t.ad.rotateZ(Le,Le,-R*(1-(C?0:v)));let qe=t.ad.identity([]);return t.ad.scale(qe,qe,[1,1-(1-je)*v,1]),qe[4]=-Ae.x/Ae.y*v,t.ad.rotateZ(qe,qe,R),t.ad.multiply(qe,Le,qe),qe}(i.projection,0,i.center,o,e),h=WE(i);return t.ad.scale(c,c,[h,h,1]),c}function WE(i){let e=i.projection,o=Cb(i.projection,i.zoom,i.width,i.height),c=GE(e,i.center),h=GE(e,Hi.convert(e.center));return Math.pow(2,c*o+(1-o)*h)}function Cb(i,e,o,c,h=1/0){let p=i.range;if(!p)return 0;let m=Math.min(h,Math.max(o,c)),y=Math.log(m/1024)/Math.LN2;return Cl(p[0]+y,p[1]+y,e)}let xd=1/4e4;function GE(i,e){let o=yi(e.lat,-er,er),c=new Hi(e.lng-180*xd,o),h=new Hi(e.lng+180*xd,o),p=i.project(c.lng,o),m=i.project(h.lng,o),y=no.fromLngLat(c),v=no.fromLngLat(h),C=m.x-p.x,T=m.y-p.y,E=v.x-y.x,D=v.y-y.y,O=Math.sqrt((E*E+D*D)/(C*C+T*T));return Math.log(O)/Math.LN2}function $E(i,e,o){let c=Math.cos(o),h=Math.sin(o);return{x:i*c-e*h,y:i*h+e*c}}function qE(i,e,o){t.ad.identity(i),t.ad.rotateZ(i,i,Li(e[2])),t.ad.rotateX(i,i,Li(e[0])),t.ad.rotateY(i,i,Li(e[1])),t.ad.scale(i,i,o),t.ad.multiply(i,i,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Sb(i,e,o,c,h,p,m,y){let v=[o[0]-e[0],o[1]-e[1],0],C=[c[0]-e[0],c[1]-e[1],0];if(t._.length(v)<1e-12||t._.length(C)<1e-12)return t.av.identity(i);let T=t._.cross([],v,C);t._.normalize(T,T),t._.subtract(C,c,e),v[2]=(p-h)*y,C[2]=(m-h)*y;let E=v;return t._.cross(E,v,C),t._.normalize(E,E),t.av.rotationTo(i,T,E)}function zw(i,e,o=!1){let c=Gl(e.zoom),h=function(p,m,y){let v=m.worldSize,C=[p[12],p[13],p[14]],T=zr(C[1]/v),E=Wo(C[0]/v),D=t.ad.identity([]),O=Po(1,T)*v,R=Po(1,0)*v*eu(T,m.zoom),z=1/tw(v),N=R*z;if(y){let ie=Cb(m.projection,m.zoom,m.width,m.height,1024);N=z*m.projection.pixelSpaceConversion(m.center.lat,v,ie)}let W=Qh(T,E);t._.add(W,W,t._.scale([],t._.normalize([],W),O*N*C[2]));let ee=function(ie){let pe=[ie[0],ie[1],ie[2]],he=[0,1,0],ve=t._.cross([],he,pe);return t._.cross(he,pe,ve),t._.squaredLength(he)===0&&(he=[0,1,0],t._.cross(ve,pe,he)),t._.normalize(ve,ve),t._.normalize(he,he),t._.normalize(pe,pe),[ve[0],ve[1],ve[2],0,he[0],he[1],he[2],0,pe[0],pe[1],pe[2],0,ie[0],ie[1],ie[2],1]}(W);t.ad.scale(D,D,[N,N,N*O]),t.ad.translate(D,D,[-C[0],-C[1],-C[2]]);let te=t.ad.multiply([],m.globeMatrix,ee);return t.ad.multiply(te,te,D),t.ad.multiply(te,te,p),te}(i,e,o);if(c>0){let p=function(m,y){let v=y.worldSize,C=Po(1,0)*v*eu(y.center.lat,y.zoom)/tw(v),T=Po(1,y.center.lat)*v,E=t.ad.identity([]);return t.ad.rotateY(E,E,Li(y.center.lng)),t.ad.rotateX(E,E,Li(y.center.lat)),t.ad.translate(E,E,[0,0,Ao]),t.ad.scale(E,E,[C,C,C*T]),t.ad.translate(E,E,[y.point.x-.5*v,y.point.y-.5*v,0]),t.ad.multiply(E,E,m),t.ad.multiply(E,y.globeMatrix,E)}(i,e);return function(m,y,v){let C=(R,z,N)=>{let W=t._.length(R),ee=t._.length(z),te=Wl(R,z,N);return t._.scale(te,te,1/t._.length(te)*Gt(W,ee,N))},T=C([m[0],m[1],m[2]],[y[0],y[1],y[2]],v),E=C([m[4],m[5],m[6]],[y[4],y[5],y[6]],v),D=C([m[8],m[9],m[10]],[y[8],y[9],y[10]],v),O=Wl([m[12],m[13],m[14]],[y[12],y[13],y[14]],v);return[T[0],T[1],T[2],0,E[0],E[1],E[2],0,D[0],D[1],D[2],0,O[0],O[1],O[2],1]}(h,p,c)}return h}function YE(i,e,o,c){let h=Fn.projectAabbCorners(c,o),p=Number.MAX_VALUE,m=-1;for(let C=0;C<h.length;++C){let T=h[C];T[0]=(.5*T[0]+.5)*e.width,T[1]=(.5-.5*T[1])*e.height,T[2]<p&&(m=C,p=T[2])}let y=C=>new vt(h[C][0],h[C][1]),v;switch(m){case 0:case 6:v=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:v=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:v=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:v=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(G1(i,v))return p}let tB=Ji([{name:"a_pos_3f",components:3,type:"Float32"}]),iB=Ji([{name:"a_color_3f",components:3,type:"Float32"}]),nB=Ji([{name:"a_color_4f",components:4,type:"Float32"}]),rB=Ji([{name:"a_uv_2f",components:2,type:"Float32"}]),oB=Ji([{name:"a_normal_3f",components:3,type:"Float32"}]),aB=Ji([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),sB=Ji([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Mb{constructor(e,o,c,h){this.message=(e?`${e}: `:"")+c,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)}}function ZE(i,e){let o=i.indexOf("://")===-1;try{return new URL(i,o&&e?"http://example.com":void 0),!0}catch{return!1}}class XE{constructor(e,o){this.feature=e,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class KE{constructor(){this.instancedDataArray=new E1,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Bw{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,o){}populate(e,o,c,h){this.tileToMeter=Ry(c);let p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:m,id:y,index:v,sourceLayerIndex:C}of e){let T=y??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),E=Hl(m,p);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),E,c))continue;let D={id:T,sourceLayerIndex:C,index:v,geometry:p?E.geometry:gs(m,c,h),properties:m.properties,type:m.type,patterns:{}},O=this.addFeature(D,D.geometry,E);O&&o.featureIndex.insert(m,D.geometry,v,C,this.index,this.instancesPerModel[O].instancedDataArray.length,pt/32)}this.lookup=null}update(e,o,c,h){for(let p in this.instancesPerModel){let m=this.instancesPerModel[p];for(let y in e)m.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(m.features[m.idToFeaturesIndex[y]],e[y],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let o in this.instancesPerModel){let c=this.instancesPerModel[o];for(let h of c.features){let p=this.layers[0],m=h.feature,y=this.canonical,v=p.paint.get("model-rotation").evaluate(m,{},y),C=p.paint.get("model-scale").evaluate(m,{},y),T=p.paint.get("model-translation").evaluate(m,{},y);t._.exactEquals(h.rotation,v)&&t._.exactEquals(h.scale,C)&&t._.exactEquals(h.translation,T)||(this.evaluate(h,h.featureStates,c,!0),e=!0)}}return e}updateReplacement(e,o,c){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;let h=o.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(hw(this.activeReplacements,h))return!1;this.activeReplacements=h;let p=!1;for(let m in this.instancesPerModel){let y=this.instancesPerModel[m],v=y.instancedDataArray;for(let C of y.features){let T=C.instancedDataOffset,E=C.instancedDataCount;for(let D=0;D<E;D++){let O=16*(D+T),R=v.float32[O+0];R=R>pt?R-pt:R;let z=Math.floor(R),N=v.float32[O+1],W=!1;for(let ee of this.activeReplacements)if(!(ee.order<c||ee.order===1/0)&&ee.clipMask&gI.Model&&!(ee.min.x>z||z>ee.max.x||ee.min.y>N||N>ee.max.y)&&(W=lI(sI(z,N,e.canonical,ee.footprintTileId.canonical),ee),W))break;v.float32[O]=W?R+pt:R,p=p||W}}}return p}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let o in this.instancesPerModel){let c=this.instancesPerModel[o];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=e.createVertexBuffer(c.instancedDataArray,aB.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let o in this.instancesPerModel){let c=this.instancesPerModel[o];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let o of this.modelUris)e.removeModel(o,"")}addFeature(e,o,c){let h=this.layers[0],p=h.layout.get("model-id").evaluate(c,{},this.canonical);if(!p)return Qn(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),p;ZE(p,!1)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new KE);let m=this.instancesPerModel[p],y=m.instancedDataArray,v=new XE(c,y.length);for(let C of o)for(let T of C){if(T.x<0||T.x>=pt||T.y<0||T.y>=pt)continue;let E=(this.lookupDim-1)/pt,D=this.lookupDim*(T.y*E|0)+T.x*E|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;let O=y.length;y.resize(O+1),m.instancesEvaluatedElevation.push(0),y.float32[16*O]=T.x,y.float32[16*O+1]=T.y}return v.instancedDataCount=m.instancedDataArray.length-v.instancedDataOffset,v.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(v),this.evaluate(v,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(e,o,c,h){let p=this.layers[0],m=e.feature,y=this.canonical,v=e.rotation=p.paint.get("model-rotation").evaluate(m,o,y),C=e.scale=p.paint.get("model-scale").evaluate(m,o,y),T=e.translation=p.paint.get("model-translation").evaluate(m,o,y),E=p.paint.get("model-color").evaluate(m,o,y);E.a=p.paint.get("model-color-mix-intensity").evaluate(m,o,y);let D=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]),this.maxScale=Math.max(Math.max(this.maxScale,C[0]),Math.max(C[1],C[2])),qE(D,v,C);let O=Math.round(100*E.a)+E.b/1.05;for(let R=0;R<e.instancedDataCount;++R){let z=e.instancedDataOffset+R,N=16*z,W=c.instancedDataArray.float32,ee=0;h&&(ee=W[N+6]-c.instancesEvaluatedElevation[z]);let te=0|W[N+1];W[N]=(0|W[N])+E.r/1.05,W[N+1]=te+E.g/1.05,W[N+2]=O,W[N+3]=1/(y.z>10?this.tileToMeter:Ry(y,te)),W[N+4]=T[0],W[N+5]=T[1],W[N+6]=T[2]+ee,W[N+7]=D[0],W[N+8]=D[1],W[N+9]=D[2],W[N+10]=D[4],W[N+11]=D[5],W[N+12]=D[6],W[N+13]=D[8],W[N+14]=D[9],W[N+15]=D[10],c.instancesEvaluatedElevation[z]=T[2]}}}ne(Bw,"ModelBucket",{omit:["layers"]}),ne(KE,"PerModelAttributes"),ne(XE,"ModelFeature");let lB=new Qi({visibility:new Qe(Pe.layout_model.visibility),"model-id":new wt(Pe.layout_model["model-id"])});var cB={paint:new Qi({"model-opacity":new Qe(Pe.paint_model["model-opacity"]),"model-rotation":new wt(Pe.paint_model["model-rotation"]),"model-scale":new wt(Pe.paint_model["model-scale"]),"model-translation":new wt(Pe.paint_model["model-translation"]),"model-color":new wt(Pe.paint_model["model-color"]),"model-color-mix-intensity":new wt(Pe.paint_model["model-color-mix-intensity"]),"model-type":new Qe(Pe.paint_model["model-type"]),"model-cast-shadows":new Qe(Pe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Qe(Pe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Qe(Pe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new wt(Pe.paint_model["model-emissive-strength"]),"model-roughness":new wt(Pe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new wt(Pe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Qe(Pe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Qe(Pe.paint_model["model-front-cutoff"])}),layout:lB};let ou=64,tm={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function QE(i,e,o,c,h,p,m,y,v,C=!1){let T=o.zoom,E=o.project(c),D=eu(c.lat,T),O=1/D;t.ad.identity(i),t.ad.translate(i,i,[E.x+m[0]*O,E.y+m[1]*O,m[2]]);let R=1,z=1,N=o.worldSize;if(C){if(o.projection.name==="mercator"){let ie=0;o.elevation&&(ie=o.elevation.getAtPointOrZero(new no(E.x/N,E.y/N),0));let pe=t.aA.transformMat4([],[E.x,E.y,ie,1],o.projMatrix)[3]/o.cameraToCenterDistance;R=pe,z=pe*eu(o.center.lat,T)}else if(o.projection.name==="globe"){let ie=zw(i,o),pe=t.ad.multiply([],o.projMatrix,ie),he=[0,0,0,1];t.aA.transformMat4(he,he,pe);let ve=he[3]/o.cameraToCenterDistance,Ce=Gl(T),Ae=o.projection.pixelsPerMeter(c.lat,N)*eu(c.lat,T),je=o.projection.pixelsPerMeter(o.center.lat,N)*eu(o.center.lat,T);R=ve/Gt(Ae,gT(o.center.lat),Ce),z=ve*D/Ae,R*=je,z*=je}}else R=O;t.ad.scale(i,i,[R,R,z]);let W=[...i],ee=e.orientation,te=[];if(qE(te,[ee[0]+h[0],ee[1]+h[1],ee[2]+h[2]],p),t.ad.multiply(i,W,te),y&&o.elevation){let ie=0,pe=[];if(v&&o.elevation){ie=function(Ce,Ae,je,Le,qe){let ot=Ae.elevation;if(!ot)return 0;let Ge=Fn.projectAabbCorners(je,Le),et=Po(1,qe.lat)*Ae.worldSize,Ue=function(Ht,ui){let Kt=[0,0,1],fi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let pi of fi){let wi=Ht[pi.corners[0]],qt=Ht[pi.corners[1]],un=Ht[pi.corners[2]],cn=[qt[0]-wi[0],qt[1]-wi[1],ui*(qt[2]-wi[2])],qi=t._.cross(cn,cn,[un[0]-wi[0],un[1]-wi[1],ui*(un[2]-wi[2])]);t._.normalize(qi,qi),pi.dotProductWithUp=t._.dot(qi,Kt)}return fi.sort((pi,wi)=>pi.dotProductWithUp-wi.dotProductWithUp),fi[0].corners}(Ge,et),tt=Ge[Ue[0]],lt=Ge[Ue[1]],nt=Ge[Ue[2]],Ct=Ge[Ue[3]],at=ot.getAtPointOrZero(new no(tt[0]/Ae.worldSize,tt[1]/Ae.worldSize),0),ht=ot.getAtPointOrZero(new no(lt[0]/Ae.worldSize,lt[1]/Ae.worldSize),0),Ut=ot.getAtPointOrZero(new no(nt[0]/Ae.worldSize,nt[1]/Ae.worldSize),0),Bt=ot.getAtPointOrZero(new no(Ct[0]/Ae.worldSize,Ct[1]/Ae.worldSize),0),Rt=(at+Bt)/2,ct=(ht+Ut)/2;return Rt>ct?ht<Ut?Sb(Ce,lt,Ct,tt,ht,Bt,at,et):Sb(Ce,nt,tt,Ct,Ut,at,Bt,et):at<Bt?Sb(Ce,tt,lt,nt,at,ht,Ut,et):Sb(Ce,Ct,nt,lt,Bt,Ut,ht,et),Math.max(Rt,ct)}(pe,o,e.aabb,i,c);let he=t.ad.fromQuat([],pe),ve=t.ad.multiply([],he,te);t.ad.multiply(i,W,ve)}else ie=o.elevation.getAtPointOrZero(new no(E.x/N,E.y/N),0);ie!==0&&(i[14]+=ie)}}function Yg(i,e,o=!1){i.uploaded||(i.gfxTexture=new Ya(e,i.image,o?e.gl.R8:e.gl.RGBA,{useMipmap:i.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),i.uploaded=!0,i.image=null)}function dB(i,e,o){i.indexBuffer=e.createIndexBuffer(i.indexArray,!1,!0),i.vertexBuffer=e.createVertexBuffer(i.vertexArray,tB.members,!1,!0),i.normalArray&&(i.normalBuffer=e.createVertexBuffer(i.normalArray,oB.members,!1,!0)),i.texcoordArray&&(i.texcoordBuffer=e.createVertexBuffer(i.texcoordArray,rB.members,!1,!0)),i.colorArray&&(i.colorBuffer=e.createVertexBuffer(i.colorArray,(i.colorArray.bytesPerElement===12?iB:nB).members,!1,!0)),i.featureArray&&(i.pbrBuffer=e.createVertexBuffer(i.featureArray,sB.members,!0)),i.segments=Rn.simpleSegment(0,0,i.vertexArray.length,i.indexArray.length);let c=i.material;c.pbrMetallicRoughness.baseColorTexture&&Yg(c.pbrMetallicRoughness.baseColorTexture,e),c.pbrMetallicRoughness.metallicRoughnessTexture&&Yg(c.pbrMetallicRoughness.metallicRoughnessTexture,e),c.normalTexture&&Yg(c.normalTexture,e),c.occlusionTexture&&Yg(c.occlusionTexture,e,o),c.emissionTexture&&Yg(c.emissionTexture,e)}function Nw(i,e,o){if(i.meshes)for(let c of i.meshes)dB(c,e,o);if(i.children)for(let c of i.children)Nw(c,e,o)}function Tb(i){if(i.meshes)for(let e of i.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(i.children)for(let e of i.children)Tb(e)}function Vw(i){if(i.meshes)for(let o of i.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((e=o.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(i.children)for(let o of i.children)Vw(o)}class hB{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class uB{constructor(){this.tasks={},this.taskQueue=[],Ku(["process"],this),this.invoker=new hB(this.process),this.nextId=0}add(e,o){let c=this.nextId++,h=function({type:p,isSymbolTile:m,zoom:y}){return y=y||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-y:p==="maybePrepare"&&m?400-y:500:200-y:100-y}(o);if(h===0){try{e()}finally{}return null}return this.tasks[c]={fn:e,metadata:o,priority:h,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let o=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let e=null,o=1/0;for(let h=0;h<this.taskQueue.length;h++){let p=this.tasks[this.taskQueue[h]];p.priority<o&&(o=p.priority,e=h)}if(e===null)return null;let c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}class JE{constructor(e,o,c){this.target=e,this.parent=o,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Ku(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new uB}send(e,o,c,h,p=!1,m){let y=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[y]=c);let v=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!c,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:we(o,v)},v),{cancel:()=>{c&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){let o=e.data,c=o.id;if(c&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){let h=this.cancelCallbacks[c];delete this.cancelCallbacks[c],h&&h.cancel()}else if(o.mustQueue||Or()){let h=this.callbacks[c],p=this.scheduler.add(()=>this.processTask(c,o),h&&h.metadata||{type:"message"});p&&(this.cancelCallbacks[c]=p)}else this.processTask(c,o)}processTask(e,o){if(delete this.cancelCallbacks[e],o.type==="<response>"){let c=this.callbacks[e];delete this.callbacks[e],c&&(o.error?c(Oe(o.error)):c(null,Oe(o.data)))}else{let c=new Set,h=o.hasCallback?(m,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?we(m):null,data:we(y,c)},c)}:m=>{},p=Oe(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,p,h);else if(this.parent.getWorkerSource){let m=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,m[0],p.source,p.scope)[m[1]](p,h)}else h(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let jw=(()=>{class i{constructor(o,c){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=Zu();let h=this.workerPool.acquire(this.id);for(let p=0;p<h.length;p++){let m=new i.Actor(h[p],c,this.id);m.name=`Worker ${p}`,this.actors.push(m)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,c,h){Oc(this.actors,(p,m)=>{p.send(o,c,m)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}return i.Actor=JE,i})();var Zg={workerUrl:"",workerClass:null,workerParams:void 0};function pB(){return Zg.workerClass!=null?new Zg.workerClass:new self.Worker(Zg.workerUrl,Zg.workerParams)}let Uw="mapboxgl_preloaded_worker_pool";class Xg{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Xg.workerCount;)this.workers.push(new pB);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Uw]}numActive(){return Object.keys(this.active).length}}let Kg;function Ib(){return Kg||(Kg=new Xg),Kg}Xg.workerCount=2;let Eb,Hw,Cs,im,Ww,nm=null;function eD(){return Or()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Hw||M.DRACO_URL}function tD(){if(Or()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(im)return im;let i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return im=WebAssembly.validate(i)?M.MESHOPT_SIMD_URL:M.MESHOPT_URL,im}let Db={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},mB={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Qg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function iD(i,e,o){let c=o.json.bufferViews.length,h=o.buffers.length;e.bufferView=c,o.json.bufferViews[c]={buffer:h,byteLength:i.byteLength},o.buffers[h]=i}let Gw="KHR_draco_mesh_compression";function fB(i,e){let o=i.extensions&&i.extensions[Gw];if(!o)return;let c=new Cs.Decoder,h=aD(e,o.bufferView),p=new Cs.Mesh;if(!c.DecodeArrayToMesh(h,h.byteLength,p))throw new Error("Failed to decode Draco mesh");let m=e.json.accessors[i.indices],y=Db[m.componentType],v=m.count*y.BYTES_PER_ELEMENT,C=Cs._malloc(v);y===Uint16Array?c.GetTrianglesUInt16Array(p,v,C):c.GetTrianglesUInt32Array(p,v,C),iD(Cs.memory.buffer.slice(C,C+v),m,e),Cs._free(C);for(let T of Object.keys(o.attributes)){let E=c.GetAttributeByUniqueId(p,o.attributes[T]),D=e.json.accessors[i.attributes[T]],O=mB[D.componentType],R=D.count*Qg[D.type]*Db[D.componentType].BYTES_PER_ELEMENT,z=Cs._malloc(R);c.GetAttributeDataArrayForAllPoints(p,E,Cs[O],R,z),iD(Cs.memory.buffer.slice(z,z+R),D,e),Cs._free(z)}c.destroy(),p.destroy(),delete i.extensions[Gw]}let kb="EXT_meshopt_compression";function gB(i,e){if(!i.extensions||!i.extensions[kb])return;let o=i.extensions[kb],c=new Uint8Array(e.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),h=new Uint8Array(o.count*o.byteStride);Ww.decodeGltfBuffer(h,o.count,o.byteStride,c,o.mode,o.filter),i.buffer=e.buffers.length,i.byteOffset=0,e.buffers[i.buffer]=h.buffer,delete i.extensions[kb]}let nD=1179937895,rD=new TextDecoder("utf8");function oD(i,e){return new URL(i,e).href}function _B(i,e,o,c){return fetch(oD(i.uri,c)).then(h=>h.arrayBuffer()).then(h=>{e.buffers[o]=h})}function aD(i,e){let o=i.json.bufferViews[e];return new Uint8Array(i.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function yB(i,e,o,c){if(i.uri){let h=oD(i.uri,c);return fetch(h).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{e.images[o]=p})}if(i.bufferView!==void 0){let h=aD(e,i.bufferView),p=new Blob([h],{type:i.mimeType});return createImageBitmap(p).then(m=>{e.images[o]=m})}}function sD(i,e=0,o){let c={json:null,images:[],buffers:[]};if(new Uint32Array(i,e,1)[0]===nD){let T=new Uint32Array(i,e),E=2,D=(T[E++]>>2)-3,O=T[E++]>>2;if(E++,c.json=JSON.parse(rD.decode(T.subarray(E,E+O))),E+=O,E<D){let R=T[E++];E++;let z=e+(E<<2);c.buffers[0]=i.slice(z,z+R)}}else c.json=JSON.parse(rD.decode(new Uint8Array(i,e)));let{buffers:h,images:p,meshes:m,extensionsUsed:y,bufferViews:v}=c.json,C=Promise.resolve();if(h){let T=[];for(let E=0;E<h.length;E++){let D=h[E];D.uri?T.push(_B(D,c,E,o)):c.buffers[E]||(c.buffers[E]=null)}C=Promise.all(T)}return C.then(()=>{let T=[],E=y&&y.includes(Gw),D=y&&y.includes(kb);if(E&&T.push(function(){if(!Cs)return Eb||(Eb=function(O){let R,z=null;function N(){R=new Uint8Array(z.buffer)}function W(){throw new Error("Unexpected Draco error.")}let ee={a:{a:W,d:function(te,ie,pe){return R.copyWithin(te,ie,ie+pe)},c:function(te){let ie=R.length,pe=Math.max(te>>>0,Math.ceil(1.2*ie)),he=Math.ceil((pe-ie)/65536);try{return z.grow(he),N(),!0}catch{return!1}},b:W}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(O,ee):O.then(te=>te.arrayBuffer()).then(te=>WebAssembly.instantiate(te,ee))).then(te=>{let{Rb:ie,Qb:pe,P:he,T:ve,X:Ce,Ja:Ae,La:je,Qa:Le,Va:qe,Wa:ot,eb:Ge,jb:et,f:Ue,e:tt,yb:lt,zb:nt,Ab:Ct,Bb:at,Db:ht,Gb:Ut}=te.instance.exports;z=tt;let Bt=(()=>{let Rt=0,ct=0,Ht=0,ui=0;return Kt=>{Ht&&(ie(ui),ie(Rt),ct+=Ht,Ht=Rt=0),Rt||(ct+=128,Rt=pe(ct));let fi=Kt.length+7&-8,pi=Rt;fi>=ct&&(Ht=fi,pi=ui=pe(fi));for(let wi=0;wi<Kt.length;wi++)R[pi+wi]=Kt[wi];return pi}})();return N(),Ue(),{memory:tt,_free:ie,_malloc:pe,Mesh:class{constructor(){this.ptr=he()}destroy(){ve(this.ptr)}},Decoder:class{constructor(){this.ptr=Ae()}destroy(){et(this.ptr)}DecodeArrayToMesh(Rt,ct,Ht){let ui=Bt(Rt),Kt=je(this.ptr,ui,ct,Ht.ptr);return!!Ce(Kt)}GetAttributeByUniqueId(Rt,ct){return{ptr:Le(this.ptr,Rt.ptr,ct)}}GetTrianglesUInt16Array(Rt,ct,Ht){qe(this.ptr,Rt.ptr,ct,Ht)}GetTrianglesUInt32Array(Rt,ct,Ht){ot(this.ptr,Rt.ptr,ct,Ht)}GetAttributeDataArrayForAllPoints(Rt,ct,Ht,ui,Kt){Ge(this.ptr,Rt.ptr,ct.ptr,Ht,ui,Kt)}},DT_INT8:lt(),DT_UINT8:nt(),DT_INT16:Ct(),DT_UINT16:at(),DT_UINT32:ht(),DT_FLOAT32:Ut()}})}(fetch(eD())),Eb.then(O=>{Cs=O,Eb=void 0}))}()),D&&T.push(function(){if(Ww)return;let O=function(R){let z,N=WebAssembly.instantiateStreaming(R,{}).then(te=>{z=te.instance,z.exports.__wasm_call_ctors()}),W={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ee={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:N,supported:!0,decodeGltfBuffer(te,ie,pe,he,ve,Ce){(function(Ae,je,Le,qe,ot,Ge,et){let Ue=Ae.exports.sbrk,tt=qe+3&-4,lt=Ue(tt*ot),nt=Ue(Ge.length),Ct=new Uint8Array(Ae.exports.memory.buffer);Ct.set(Ge,nt);let at=je(lt,qe,ot,nt,Ge.length);if(at===0&&et&&et(lt,tt,ot),Le.set(Ct.subarray(lt,lt+qe*ot)),Ue(lt-Ue(0)),at!==0)throw new Error(`Malformed buffer data: ${at}`)})(z,z.exports[ee[ve]],te,ie,pe,he,z.exports[W[Ce]])}}}(fetch(tD()));return O.ready.then(()=>{Ww=O})}()),p)for(let O=0;O<p.length;O++)T.push(yB(p[O],c,O,o));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(E&&m)for(let{primitives:O}of m)for(let R of O)fB(R,c);if(D&&m&&v)for(let O of v)gB(O,c);return c})})}function au(i,e){let o=i.json.bufferViews[e.bufferView],c=Db[e.componentType];return new c(i.buffers[o.buffer],(e.byteOffset||0)+(o.byteOffset||0),e.count*(o.byteStride&&o.byteStride!==Qg[e.type]*c.BYTES_PER_ELEMENT?o.byteStride/c.BYTES_PER_ELEMENT:Qg[e.type]))}function $w(i,e,o,c){let h=Db[e.componentType],p=function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),m=i.json.bufferViews[e.bufferView],y=m.byteStride?m.byteStride/h.BYTES_PER_ELEMENT:Qg[e.type],v=o.float32,C=v.length/o.capacity;for(let T=0,E=0;T<e.count*y;T+=y,E+=C)for(let D=0;D<C;D++)v[E+D]=c[T+D]*p;o._trim()}function bB(i,e,o){let c=i.indices,h=i.attributes,p={};p.indexArray=new Ir;let m=e.json.accessors[c],y=m.count/3;p.indexArray.reserve(y);let v=au(e,m);for(let D=0;D<y;D++)p.indexArray.emplaceBack(v[3*D],v[3*D+1],v[3*D+2]);p.indexArray._trim(),p.vertexArray=new od;let C=e.json.accessors[h.POSITION];p.vertexArray.reserve(C.count);let T=au(e,C);for(let D=0;D<C.count;D++)p.vertexArray.emplaceBack(T[3*D],T[3*D+1],T[3*D+2]);if(p.vertexArray._trim(),p.aabb=new Fn(C.min,C.max),p.centroid=function(D,O){let R=[0,0,0],z=D.length;if(z>0){for(let N=0;N<z;N++){let W=3*D[N];R[0]+=O[W],R[1]+=O[W+1],R[2]+=O[W+2]}R[0]/=z,R[1]/=z,R[2]/=z}return R}(v,T),h.COLOR_0!==void 0){let D=e.json.accessors[h.COLOR_0],O=Qg[D.type],R=au(e,D);p.colorArray=O===3?new od:new rd,p.colorArray.resize(D.count),$w(e,D,p.colorArray,R)}if(h.NORMAL!==void 0){p.normalArray=new od;let D=e.json.accessors[h.NORMAL];p.normalArray.resize(D.count);let O=au(e,D);$w(e,D,p.normalArray,O)}if(h.TEXCOORD_0!==void 0&&o.length>0){p.texcoordArray=new Op;let D=e.json.accessors[h.TEXCOORD_0];p.texcoordArray.resize(D.count);let O=au(e,D);$w(e,D,p.texcoordArray,O)}if(h._FEATURE_ID_RGBA4444!==void 0){let D=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=au(e,D))}h._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(au(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));let E=i.material;return p.material=function(D,O){let{emissiveFactor:R=[0,0,0],alphaMode:z="OPAQUE",alphaCutoff:N=.5,normalTexture:W,occlusionTexture:ee,emissiveTexture:te,doubleSided:ie}=D,{baseColorFactor:pe=[1,1,1,1],metallicFactor:he=1,roughnessFactor:ve=1,baseColorTexture:Ce,metallicRoughnessTexture:Ae}=D.pbrMetallicRoughness||{},je=ee?O[ee.index]:void 0;if(ee&&ee.extensions&&ee.extensions.KHR_texture_transform&&je){let Le=ee.extensions.KHR_texture_transform;je.offsetScale=[Le.offset[0],Le.offset[1],Le.scale[0],Le.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Wi(...pe),metallicFactor:he,roughnessFactor:ve,baseColorTexture:Ce?O[Ce.index]:void 0,metallicRoughnessTexture:Ae?O[Ae.index]:void 0},doubleSided:ie,emissiveFactor:R,alphaMode:z,alphaCutoff:N,normalTexture:W?O[W.index]:void 0,occlusionTexture:je,emissionTexture:te?O[te.index]:void 0,defined:D.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},o),p}function lD(i,e,o){let{matrix:c,rotation:h,translation:p,scale:m,mesh:y,extras:v,children:C}=i,T={};if(T.matrix=c||t.ad.fromRotationTranslationScale([],h||[0,0,0,1],p||[0,0,0],m||[1,1,1]),y!==void 0){T.meshes=o[y];let E=T.anchor=[0,0];for(let D of T.meshes){let{min:O,max:R}=D.aabb;E[0]+=O[0]+R[0],E[1]+=O[1]+R[1]}E[0]=Math.floor(E[0]/T.meshes.length/2),E[1]=Math.floor(E[1]/T.meshes.length/2)}if(v&&(v.id&&(T.id=v.id),v.lights&&(T.lights=function(E){if(!E.length)return[];let D=function(W){let ee=atob(W),te=new Uint8Array(ee.length);for(let ie=0;ie<ee.length;ie++)te[ie]=ee.codePointAt(ie);return te}(E),O=[],R=D.length/24,z=new Uint16Array(D.buffer),N=new Float32Array(D.buffer);for(let W=0;W<R;W++){let ee=z[2*W*6]/30,te=z[2*W*6+1]/30,ie=z[2*W*6+10]/100,pe=N[6*W+1],he=N[6*W+2],ve=N[6*W+3],Ce=N[6*W+4],Ae=ve-pe,je=Ce-he,Le=Math.hypot(Ae,je);O.push({pos:[pe+.5*Ae,he+.5*je,te],normal:[je/Le,-Ae/Le,0],width:Le,height:ee,depth:ie,points:[pe,he,ve,Ce]})}return O}(v.lights))),C){let E=[];for(let D of C)E.push(lD(e.json.nodes[D],e,o));T.children=E}return T}function vB(i){if(i.vertices.length===0||i.indices.length===0)return null;let e=new lw(i.vertices,i.indices,8,256),[o,c]=[e.min.clone(),e.max.clone()];return{vertices:i.vertices,indices:i.indices,grid:e,min:o,max:c}}function xB(i){if(!i.extras||!i.extras.ground)return null;let e=i.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let o=e[0];if(!o||!Array.isArray(o)||o.length===0)return null;let c=[];for(let m of o){if(!Array.isArray(m)||m.length!==2)continue;let y=m[0],v=m[1];typeof y=="number"&&typeof v=="number"&&c.push(new vt(y,v))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let h=0;for(let m=0;m<c.length;m++){let y=c[m],v=c[(m+1)%c.length],C=c[(m+2)%c.length];h+=(y.x-v.x)*(C.y-v.y)-(C.x-v.x)*(y.y-v.y)}h>0&&c.reverse();let p=Dg(c.flatMap(m=>[m.x,m.y]),[]);return p.length===0?null:{vertices:c,indices:p}}function wB(i,e){let o=[],c=[],h=0,p=[];for(let m of i){h=o.length;let y=m.vertexArray.float32,v=m.indexArray.uint16;for(let C=0;C<m.vertexArray.length;C++)p[0]=y[3*C+0],p[1]=y[3*C+1],p[2]=y[3*C+2],t._.transformMat4(p,p,e),o.push(new vt(p[0],p[1]));for(let C=0;C<3*m.indexArray.length;C++)c.push(v[C]+h)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){let y=o[c[m+0]],v=o[c[m+1]],C=o[c[m+2]];(y.x-v.x)*(C.y-v.y)-(C.x-v.x)*(y.y-v.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:o,indices:c}}function cD(i){let e=function(v,C){let T=[],E=WebGL2RenderingContext;if(v.json.textures)for(let D of v.json.textures){let O={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};D.sampler!==void 0&&Object.assign(O,v.json.samplers[D.sampler]),T.push({image:C[D.source],sampler:O,uploaded:!1})}return T}(i,i.images),o=function(v,C){let T=[];for(let E of v.json.meshes){let D=[];for(let O of E.primitives)D.push(bB(O,v,C));T.push(D)}return T}(i,e),{scenes:c,scene:h,nodes:p}=i.json,m=c?c[h||0].nodes:p,y=[];for(let v of m)y.push(lD(p[v],i,o));return function(v,C,T){let E={},D=new Set;for(let O=0;O<v.length;O++){let R=T[C[O]];if(!R.extras)continue;let z=R.extras["mapbox:footprint:version"],N=R.extras["mapbox:footprint:id"];(z||N)&&D.add(O),z==="1.0.0"&&N&&(E[N]=O)}for(let O=0;O<v.length;O++){if(D.has(O))continue;let R=v[O],z=T[C[O]];if(!z.extras)continue;let N=null;R.id in E&&(N=wB(v[E[R.id]].meshes,R.matrix)),N||(N=xB(z)),N&&(R.footprint=vB(N))}if(D.size>0){let O=Array.from(D.values()).sort((R,z)=>R-z);for(let R=O.length-1;R>=0;R--)v.splice(O[R],1)}}(y,m,i.json.nodes),y}function CB(i){i.heightmap=new Float32Array(4096),i.heightmap.fill(-1);let e=i.vertexArray.float32,o=i.aabb.min[0]-1,c=i.aabb.min[1]-1,h=ou/(i.aabb.max[0]-o+2),p=ou/(i.aabb.max[1]-c+2);for(let m=0;m<e.length;m+=3){let y=e[m+2],v=(e[m+0]-o)*h|0,C=(e[m+1]-c)*p|0;y>i.heightmap[C*ou+v]&&(i.heightmap[C*ou+v]=y)}}function SB(i,e){let o={};o.indexArray=new Ir,o.indexArray.reserve(4*i.length),o.vertexArray=new od,o.vertexArray.reserve(10*i.length),o.colorArray=new rd,o.vertexArray.reserve(10*i.length);let c=0;for(let m of i){let y=Math.min(10,Math.max(4,1.3*m.height))*e,v=[-m.normal[1],m.normal[0],0],C=Math.min(.29,.1*m.width/m.depth),T=m.width-2*m.depth*e*(C+.01),E=t._.scaleAndAdd([],m.pos,v,T/2),D=t._.scaleAndAdd([],m.pos,v,-T/2),O=[E[0],E[1],E[2]+m.height],R=[D[0],D[1],D[2]+m.height],z=t._.scaleAndAdd([],m.normal,v,C);t._.scale(z,z,y);let N=t._.scaleAndAdd([],m.normal,v,-C);t._.scale(N,N,y),t._.add(z,E,z),t._.add(N,D,N),E[2]+=.1,D[2]+=.1,o.vertexArray.emplaceBack(z[0],z[1],z[2]),o.vertexArray.emplaceBack(N[0],N[1],N[2]),o.vertexArray.emplaceBack(E[0],E[1],E[2]),o.vertexArray.emplaceBack(D[0],D[1],D[2]),o.vertexArray.emplaceBack(O[0],O[1],O[2]),o.vertexArray.emplaceBack(R[0],R[1],R[2]),o.vertexArray.emplaceBack(E[0],E[1],E[2]),o.vertexArray.emplaceBack(D[0],D[1],D[2]),o.vertexArray.emplaceBack(z[0],z[1],z[2]),o.vertexArray.emplaceBack(N[0],N[1],N[2]);let W=T/y/2;o.colorArray.emplaceBack(-W-C,-1,W,.8),o.colorArray.emplaceBack(W+C,-1,W,.8),o.colorArray.emplaceBack(-W,0,W,1.3),o.colorArray.emplaceBack(W,0,W,1.3),o.colorArray.emplaceBack(W+C,-.8,W,.7),o.colorArray.emplaceBack(W+C,-.8,W,.7),o.colorArray.emplaceBack(0,0,W,1.3),o.colorArray.emplaceBack(0,0,W,1.3),o.colorArray.emplaceBack(W+C,-1.2,W,.8),o.colorArray.emplaceBack(W+C,-1.2,W,.8),o.indexArray.emplaceBack(6+c,4+c,8+c),o.indexArray.emplaceBack(7+c,9+c,5+c),o.indexArray.emplaceBack(0+c,1+c,2+c),o.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}let h={defined:!0,emissiveFactor:[0,0,0]},p={};return p.baseColorFactor=Wi.white,h.pbrMetallicRoughness=p,o.material=h,o.aabb=new Fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}let qw=new Float32Array(262144),su=new Uint8Array(262144);function dD(i){let e=0;if(i.meshes)for(let o of i.meshes)e=Math.max(e,o.aabb.max[2]);if(i.children)for(let o of i.children)e=Math.max(e,dD(o));return e}function hD(i,e,o){if(i.meshes)for(let c of i.meshes)c.aabb.min[0]!==1/0&&o.insert(e,c.aabb.min[0],c.aabb.min[1],c.aabb.max[0],c.aabb.max[1]);if(i.children)for(let c of i.children)hD(c,e,o)}let uD=["","wall","door","roof","window","lamp","logo"];class pD{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:dD(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,o=new Fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let c of this.node.meshes)this.node.lightMeshIndex!==e&&(c.transformedAabb=Fn.applyTransform(c.aabb,this.node.matrix),o.encapsulate(c.transformedAabb)),e++;this.aabb=o}return this.aabb}}class Ab{constructor(e,o,c,h,p,m){this.id=o,this.modelTraits|=tm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=tm.HasMapboxMeshFeatures),h&&(this.modelTraits|=tm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let y of e)this.nodesInfo.push(new pD(y)),hD(y,m.featureIndexArray.length,m.grid),m.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,m.bucketLayerIDs.length-1,0)}updateFootprints(e,o){for(let c of this.getNodesInfo()){let h=c.node;h.footprint&&o.push({footprint:h.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let o=this.getNodesInfo();for(let c of o){let h=c.node;this.uploaded?this.updatePbrBuffer(h):Nw(h,e,!0)}for(let c of o)Tb(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let o=!1;if(!e.meshes)return o;for(let c of e.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),o=!0);return o}needsReEvaluation(e,o,c){let h=e.transform.projectionOptions,p=e.style.getBrightness(),m=this.brightness!==p;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||Jg(c.paint.get("model-color").value,m)||Jg(c.paint.get("model-color-mix-intensity").value,m)||Jg(c.paint.get("model-roughness").value,m)||Jg(c.paint.get("model-emissive-strength").value,m)||Jg(c.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=h,this.brightness=p,!0)}evaluateScale(e,o){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let c=this.getNodesInfo(),h=this.id.canonical;for(let p of c){let m=p.feature;p.evaluatedScale=o.paint.get("model-scale").evaluate(m,{},h)}}evaluate(e){let o=this.getNodesInfo();for(let c of o){if(!c.node.meshes)continue;let h=c.feature,p=c.node.meshes&&c.node.meshes[0].featureData,m=c.evaluatedColor[2],y=c.evaluatedRMEA[2],v=this.id.canonical;if(c.hasTranslucentParts=!1,p){for(let C=0;C<uD.length;C++){let T=uD[C];T.length&&(h.properties.part=T);let E=e.paint.get("model-color").evaluate(h,{},v).toRenderColor(null),D=e.paint.get("model-color-mix-intensity").evaluate(h,{},v);c.evaluatedColor[C]=[E.r,E.g,E.b,D],c.evaluatedRMEA[C][0]=e.paint.get("model-roughness").evaluate(h,{},v),c.evaluatedRMEA[C][2]=e.paint.get("model-emissive-strength").evaluate(h,{},v),c.evaluatedRMEA[C][3]=E.a,c.emissionHeightBasedParams[C]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},v),!c.hasTranslucentParts&&E.a<1&&(c.hasTranslucentParts=!0)}delete h.properties.part,TB(c,m!==c.evaluatedColor[2]||y!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(h,{},v);c.evaluatedScale=e.paint.get("model-scale").evaluate(h,{},v),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,o,c,h){let p=e.findDEMTileFor(c);if(p&&(p.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;let m=Up.create(e,c,p);if(!m)return;this.modelTraits&tm.HasMapboxMeshFeatures&&this.updateDEM(e,m,c,h);for(let y of this.getNodesInfo()){let v=y.node;if(!v.footprint||!v.footprint.vertices||!v.footprint.vertices.length)continue;let C=v.footprint.vertices,T=m.getElevationAt(C[0].x,C[0].y,!0,!0);for(let E=1;E<C.length;E++)T=Math.min(T,m.getElevationAt(C[E].x,C[E].y,!0,!0));v.elevation=T}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=o}}updateDEM(e,o,c,h){let p=o._dem._modifiedForSources[h];if(p===void 0&&(o._dem._modifiedForSources[h]=[],p=o._dem._modifiedForSources[h]),p.includes(c.canonical))return;let m=o._dem.dim;p.push(c.canonical);let y=!1;for(let v of this.getNodesInfo()){let C=v.node;if(!C.footprint||!C.footprint.grid)continue;let T=C.footprint.grid,E=o.tileCoordToPixel(T.min.x,T.min.y),D=o.tileCoordToPixel(T.max.x,T.max.y),O=Math.min(Math.min(m-D.y,E.x),Math.min(E.y,m-D.x));if(O<0)continue;let R=yi(O,2,5),z=Math.max(0,E.x-R),N=Math.max(0,E.y-R),W=Math.min(D.x+R,m-1),ee=Math.min(D.y+R,m-1);for(let he=N;he<=ee;++he)for(let ve=z;ve<=W;++ve)su[he*m+ve]=255;let te=0,ie=0;for(let he=0;he<T.cellsY;++he)for(let ve=0;ve<T.cellsX;++ve){if(!T.cells[he*T.cellsX+ve])continue;let Ce=o.tileCoordToPixel(T.min.x+ve/T.xScale,T.min.y+he/T.yScale),Ae=o.tileCoordToPixel(T.min.x+(ve+1)/T.xScale,T.min.y+(he+1)/T.yScale);for(let je=Ce.y;je<=Math.min(Ae.y+1,m-1);++je)for(let Le=Ce.x;Le<=Math.min(Ae.x+1,m-1);++Le)su[je*m+Le]===255&&(su[je*m+Le]=0,te+=o.getElevationAtPixel(Le,je),ie++)}let pe=te/ie;z=Math.max(1,E.x-R),N=Math.max(1,E.y-R),W=Math.min(D.x+R,m-2),ee=Math.min(D.y+R,m-2),y=!0;for(let he=N;he<=ee;++he)for(let ve=z;ve<=W;++ve)su[he*m+ve]===0&&(qw[he*m+ve]=o._dem.set(ve,he,pe));for(let he=1;he<R;++he){z=Math.max(1,E.x-he),N=Math.max(1,E.y-he),W=Math.min(D.x+he,m-2),ee=Math.min(D.y+he,m-2);for(let ve=N;ve<=ee;++ve)for(let Ce=z;Ce<=W;++Ce){let Ae=ve*m+Ce;if(su[Ae]===255){let je=0,Le=0,qe=-1,ot=-1;for(let Ge=-1;Ge<=1;++Ge)for(let et=-1;et<=1;++et){let Ue=(ve+Ge)*m+Ce+et;if(su[Ue]>=he)continue;let tt=qw[Ue],lt=Math.abs(tt);lt>Le&&(je=tt,Le=lt,qe=et,ot=Ge)}if(Le>.1){let Ge=1-(he+.5*Math.abs(qe*ot))/R,et=o._dem.get(Ce,ve)+je*Ge,Ue=o._dem.get(Ce+qe,ve+ot),tt=o._dem.get(Ce-qe,ve-ot,!0);(et-Ue)*(et-tt)>0&&(et=(Ue+tt)/2),qw[Ae]=o._dem.set(Ce,ve,et),su[Ae]=he}}}}}y&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=Rr.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let o of e)Tb(o.node),Vw(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;let c=o.getReplacementRegionsForTile(e.toUnwrapped()),h=this.getNodesInfo();for(let p=0;p<this.nodesInfo.length;p++){let m=h[p].node;h[p].hiddenByReplacement=!!m.footprint&&!c.find(y=>y.footprint===m.footprint)}}getHeightAtTileCoord(e,o){let c=this.getNodesInfo(),h=[],p=[0,0,0],m=t.ad.identity([]);for(let y=0;y<this.nodesInfo.length;y++){let v=c[y],C=v.node.meshes[0],T=C.transformedAabb;if(e<T.min[0]||o<T.min[1]||e>T.max[0]||o>T.max[1])continue;if(v.node.hidden===!0)return{height:0,maxHeight:v.feature.properties.height,hidden:!1,verticalScale:v.evaluatedScale[2]};t.ad.invert(m,v.node.matrix),p[0]=e,p[1]=o,t._.transformMat4(p,p,m);let E=(p[0]-C.aabb.min[0])/(C.aabb.max[0]-C.aabb.min[0])*ou|0,D=Math.min(63,(p[1]-C.aabb.min[1])/(C.aabb.max[1]-C.aabb.min[1])*ou|0)*ou+Math.min(63,E),O=C.heightmap[D];if(!(O<0&&v.node.footprint))return v.hiddenByReplacement?void 0:{height:O,maxHeight:v.feature.properties.height,hidden:!1,verticalScale:v.evaluatedScale[2]};if(v.node.footprint.grid.query(new vt(e,o),new vt(e,o),h),h.length>0)return{height:void 0,maxHeight:v.feature.properties.height,hidden:v.hiddenByReplacement,verticalScale:v.evaluatedScale[2]}}}}function Jg(i,e){return!i.isLightConstant&&e}function MB(i,e,o,c,h,p,m,y){let v=(61440&e|(61440&e)>>4)>>8,C=(3840&e|(3840&e)>>4)>>4,T=240&e|(240&e)>>4;o[3]>0&&(v=Gt(v,255*o[0],o[3]),C=Gt(C,255*o[1],o[3]),T=Gt(T,255*o[2],o[3]));let E=v<<8|C,D=T<<8|Math.floor(255*c[3]),O=function(he){let ve=yi(he,0,2);return Math.min(Math.round(.5*ve*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],R=yi(h[0],0,1),z=yi(h[1],0,1),N=yi(h[2],0,1),W=yi(h[3],0,1),ee,te,ie,pe;if(R!==z&&m!==p&&z!==R){let he=m-p;te=1/(he*(z-R)),ie=-(p+he*R)/(he*(z-R));let ve=yi(h[4],-1,1);pe=Math.pow(10,ve),ee=255*N<<8|255*W}else ee=65535,te=0,ie=1,pe=1;if(i.emplaceBack(E,D,O,ee,te,ie,pe),y){let he=y.length;y.clear();for(let ve=0;ve<he;ve++)y.emplaceBack(E,D,O,ee,te,ie,pe)}}function TB(i,e,o){let c=i.node,h=0,p=o&tm.HasMeshoptCompression;for(let m of c.meshes){if(c.lights&&c.lightMeshIndex===h||!m.featureData)continue;m.featureArray=new Ay,m.featureArray.reserve(m.featureData.length);let y=e;for(let v of m.featureData){let C=p?65535&v:v>>16&65535,T=p?v>>16&65535:65535&v,E=(15&T)<8?15&T:0,D=i.evaluatedRMEA[E],O=i.evaluatedColor[E],R=i.emissionHeightBasedParams[E],z;if(y&&E===2&&c.lights&&(z=new Ay,z.resize(10*c.lights.length)),MB(m.featureArray,C,O,D,R,m.aabb.min[2],m.aabb.max[2],z),z&&y){y=!1;let N=c.meshes[c.lightMeshIndex];N.featureArray=z,N.featureArray._trim()}}m.featureArray._trim(),h++}}function mD(i,e,o,c){let h=1<<i.z;e.lat=zr((c/pt+i.y)/h),e.lng=Wo((o/pt+i.x)/h)}ne(Ab,"Tiled3dModelBucket",{omit:["layers"]}),ne(pD,"Tiled3dModelFeature");let IB={circle:class extends pr{constructor(i,e,o,c){super(i,p3,e,o,c)}createBucket(i){return new W1(i)}queryRadius(i){let e=i;return Np("circle-radius",this,e)+Np("circle-stroke-width",this,e)+zy(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,o,c,h,p,m,y){let v=MT(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(e,o)+this.paint.get("circle-stroke-width").evaluate(e,o);return VT(i,c,p,m,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,C)}getProgramIds(){return["circle"]}getDefaultProgramParams(i,e,o){let c=NT(this);return{config:new Kh(this,{zoom:e,lut:o}),defines:c,overrideFog:!1}}},heatmap:class extends pr{createBucket(i){return new UT(i)}constructor(i,e,o,c){super(i,S3,e,o,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Eg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Np("heatmap-radius",this,i)}queryIntersectsFeature(i,e,o,c,h,p,m,y){let v=this.paint.get("heatmap-radius").evaluate(e,o);return VT(i,c,p,m,y,!0,!0,new vt(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(i,e,o){return i==="heatmap"?{config:new Kh(this,{zoom:e,lut:o}),overrideFog:!1}:{}}},hillshade:class extends pr{constructor(i,e,o,c){super(i,T3,e,o,c)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(i,e,o){return{overrideFog:!1}}},fill:class extends pr{constructor(i,e,o,c){super(i,V3,e,o,c)}getProgramIds(){let i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),o=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(i,e,o){return{config:new Kh(this,{zoom:e,lut:o}),overrideFog:!1}}recalculate(i,e){super.recalculate(i,e);let o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new $y(i)}queryRadius(){return zy(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,o,c,h,p){return!i.queryGeometry.isAboveHorizon&&vT(ST(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends pr{constructor(i,e,o,c){super(i,gz,e,o,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new Jy(i)}queryRadius(){return zy(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(i,e,o,c,h,p,m,y,v){let C=MT(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,o),E=this.paint.get("fill-extrusion-base").evaluate(e,o),D=[0,0],O=y&&p.elevation,R=p.elevation?p.elevation.exaggeration():1,z=i.tile.getBucket(this);if(O&&z instanceof Jy){let ie=z.centroidVertexArray,pe=v+1;pe<ie.length&&(D[0]=ie.geta_centroid_pos0(pe),D[1]=ie.geta_centroid_pos1(pe))}if(D[0]===0&&D[1]===1)return!1;p.projection.name==="globe"&&(c=DI([c],[new vt(0,0),new vt(pt,pt)],i.tileID.canonical).map(ie=>ie.polygon).flat());let N=O?y:null,[W,ee]=function(ie,pe,he,ve,Ce,Ae,je,Le,qe,ot,Ge){return ie.projection.name==="globe"?function(et,Ue,tt,lt,nt,Ct,at,ht,Ut,Bt,Rt){let ct=[],Ht=[],ui=et.projection.upVectorScale(Rt,et.center.lat,et.worldSize).metersToTile,Kt=[0,0,0,1],fi=[0,0,0,1],pi=(qt,un,cn,qi)=>{qt[0]=un,qt[1]=cn,qt[2]=qi,qt[3]=1},wi=EI();tt>0&&(tt+=wi),lt+=wi;for(let qt of Ue){let un=[],cn=[];for(let qi of qt){let Bi=qi.x+nt.x,Yi=qi.y+nt.y,wn=et.projection.projectTilePoint(Bi,Yi,Rt),yn=et.projection.upVector(Rt,qi.x,qi.y),jn=tt,Ln=lt;if(at){let ro=AI(Bi,Yi,tt,lt,at,ht,Ut,Bt);jn+=ro.base,Ln+=ro.top}tt!==0?pi(Kt,wn.x+yn[0]*ui*jn,wn.y+yn[1]*ui*jn,wn.z+yn[2]*ui*jn):pi(Kt,wn.x,wn.y,wn.z),pi(fi,wn.x+yn[0]*ui*Ln,wn.y+yn[1]*ui*Ln,wn.z+yn[2]*ui*Ln),t._.transformMat4(Kt,Kt,Ct),t._.transformMat4(fi,fi,Ct),un.push(new iu(Kt[0],Kt[1],Kt[2])),cn.push(new iu(fi[0],fi[1],fi[2]))}ct.push(un),Ht.push(cn)}return[ct,Ht]}(ie,pe,he,ve,Ce,Ae,je,Le,qe,ot,Ge):je?function(et,Ue,tt,lt,nt,Ct,at,ht,Ut){let Bt=[],Rt=[],ct=[0,0,0,1];for(let Ht of et){let ui=[],Kt=[];for(let fi of Ht){let pi=fi.x+lt.x,wi=fi.y+lt.y,qt=AI(pi,wi,Ue,tt,Ct,at,ht,Ut);ct[0]=pi,ct[1]=wi,ct[2]=qt.base,ct[3]=1,t.aA.transformMat4(ct,ct,nt),ct[3]=Math.max(ct[3],1e-5);let un=new iu(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);ct[0]=pi,ct[1]=wi,ct[2]=qt.top,ct[3]=1,t.aA.transformMat4(ct,ct,nt),ct[3]=Math.max(ct[3],1e-5);let cn=new iu(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);ui.push(un),Kt.push(cn)}Bt.push(ui),Rt.push(Kt)}return[Bt,Rt]}(pe,he,ve,Ce,Ae,je,Le,qe,ot):function(et,Ue,tt,lt,nt){let Ct=[],at=[],ht=nt[8]*Ue,Ut=nt[9]*Ue,Bt=nt[10]*Ue,Rt=nt[11]*Ue,ct=nt[8]*tt,Ht=nt[9]*tt,ui=nt[10]*tt,Kt=nt[11]*tt;for(let fi of et){let pi=[],wi=[];for(let qt of fi){let un=qt.x+lt.x,cn=qt.y+lt.y,qi=nt[0]*un+nt[4]*cn+nt[12],Bi=nt[1]*un+nt[5]*cn+nt[13],Yi=nt[2]*un+nt[6]*cn+nt[14],wn=nt[3]*un+nt[7]*cn+nt[15],yn=qi+ht,jn=Bi+Ut,Ln=Yi+Bt,ro=Math.max(wn+Rt,1e-5),Gn=qi+ct,Pn=Bi+Ht,hr=Yi+ui,Br=Math.max(wn+Kt,1e-5);pi.push(new iu(yn/ro,jn/ro,Ln/ro)),wi.push(new iu(Gn/Br,Pn/Br,hr/Br))}Ct.push(pi),at.push(wi)}return[Ct,at]}(pe,he,ve,Ce,Ae)}(p,c,E,T,C,m,N,D,R,p.center.lat,i.tileID.canonical),te=i.queryGeometry;return function(ie,pe,he){let ve=1/0;vT(he,pe)&&(ve=kI(he,pe[0]));for(let Ce=0;Ce<pe.length;Ce++){let Ae=pe[Ce],je=ie[Ce];for(let Le=0;Le<Ae.length-1;Le++){let qe=Ae[Le],ot=[qe,Ae[Le+1],je[Le+1],je[Le],qe];G1(he,ot)&&(ve=Math.min(ve,kI(he,ot)))}}return ve!==1/0&&ve}(W,ee,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends pr{constructor(i,e,o,c){super(i,tb,e,o,c),tb.layout&&(this.layout=new ln(tb.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Wh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=LE.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new eb(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(i,e,o){let c=NI(this);return{config:new Kh(this,{zoom:e,lut:o}),defines:c,overrideFog:!1}}queryRadius(i){let e=i,o=zE(Np("line-width",this,e),Np("line-gap-width",this,e)),c=Np("line-offset",this,e);return o/2+Math.abs(c)+zy(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,o,c,h,p){if(i.queryGeometry.isAboveHorizon)return!1;let m=ST(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),y=i.pixelToTileUnitsFactor/2*zE(this.paint.get("line-width").evaluate(e,o),this.paint.get("line-gap-width").evaluate(e,o)),v=this.paint.get("line-offset").evaluate(e,o);return v&&(c=function(C,T){let E=[],D=new vt(0,0);for(let O=0;O<C.length;O++){let R=C[O],z=[];for(let N=0;N<R.length;N++){let W=R[N],ee=R[N+1],te=N===0?D:W.sub(R[N-1])._unit()._perp(),ie=N===R.length-1?D:ee.sub(W)._unit()._perp(),pe=te._add(ie)._unit();pe._mult(1/(pe.x*ie.x+pe.y*ie.y)),z.push(pe._mult(T)._add(W))}E.push(z)}return E}(c,v*i.pixelToTileUnitsFactor)),function(C,T,E){for(let D=0;D<T.length;D++){let O=T[D];if(C.length>=3){for(let R=0;R<O.length;R++)if(hd(C,O[R]))return!0}if(c3(C,O,E))return!0}return!1}(m,c,y)}isTileClipped(){return!0}isDraped(i){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:vb,background:class extends pr{constructor(i,e,o,c){super(i,G5,e,o,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(i,e,o){return{overrideFog:!1}}},raster:jE,"raster-particle":UE,sky:class extends pr{constructor(i,e,o,c){super(i,J5,e,o,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Eg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){let c=this.paint.get("sky-atmosphere-sun"),h=!c,p=i.style.light,m=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&Qn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Lw(m.azimuthal,90-m.polar,e):Lw(c[0],90-c[1],e)}let o=this.paint.get("sky-gradient-center");return Lw(o[0],90-o[1],e)}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}},slot:class extends pr{constructor(i,e,o,c){super(i,eB,e,null)}},model:class extends pr{constructor(i,e,o,c){super(i,cB,e,o,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new Bw(i)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(i){return i instanceof Ab?pt-1:0}queryIntersectsFeature(i,e,o,c,h,p){if(!this.modelManager)return!1;let m=this.modelManager,y=i.tile.getBucket(this);if(!(y&&y instanceof Bw))return!1;let v=y;for(let C in v.instancesPerModel){let T=v.instancesPerModel[C],E=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(E)){let D=T.features[T.idToFeaturesIndex[E]],O=m.getModel(C,this.scope);if(!O)return!1;let R=t.ad.create(),z=new Hi(0,0),N=v.canonical,W=Number.MAX_VALUE;for(let ee=0;ee<D.instancedDataCount;++ee){let te=16*(D.instancedDataOffset+ee),ie=T.instancedDataArray.float32,pe=[ie[te+4],ie[te+5],ie[te+6]];mD(N,z,ie[te],0|ie[te+1]),QE(R,O,p,z,D.rotation,D.scale,pe,!1,!1,!1),p.projection.name==="globe"&&(R=zw(R,p));let he=t.ad.multiply([],p.projMatrix,R),ve=i.queryGeometry,Ce=YE(ve.isPointQuery()?ve.screenBounds:ve.screenGeometry,p,he,O.aabb);Ce!=null&&(W=Math.min(Ce,W))}return W!==Number.MAX_VALUE&&W}}return!1}_handleOverridablePaintPropertyUpdate(i,e,o){return!(!this.layout||e.isDataDriven()||o.isDataDriven()||i!=="model-color"&&i!=="model-color-mix-intensity"&&i!=="model-rotation"&&i!=="model-scale"&&i!=="model-translation"&&i!=="model-emissive-strength")}_isPropertyZoomDependent(i){let e=this._transitionablePaint._values[i];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof q}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(i,e,o,c){let h=i.tile,p=h.getBucket(this),m=null,y=Number.MAX_VALUE;if(!(p&&p instanceof Ab))return{queryFeature:m,intersectionZ:y};let v=p.getNodesInfo()[e];if(v.hiddenByReplacement||!v.node.meshes||!o.filter(new ti(h.tileID.overscaledZ),v.feature,h.tileID.canonical))return{queryFeature:m,intersectionZ:y};let C=v.node,T=c.calculatePosMatrix(h.tileID.toUnwrapped(),c.worldSize),E=v.evaluatedScale,D=0;c.elevation&&C.elevation&&(D=C.elevation*c.elevation.exaggeration()),t.ad.translate(T,T,[(C.anchor?C.anchor[0]:0)*(E[0]-1),(C.anchor?C.anchor[1]:0)*(E[1]-1),D]),t.ad.scale(T,T,E),t.ad.multiply(T,T,C.matrix);let O=i.queryGeometry,R=O.isPointQuery()?O.screenBounds:O.screenGeometry,z=function(W){let ee=t.ad.multiply([],T,W.matrix),te=t.ad.multiply(ee,c.expandedFarZProjMatrix,ee);for(let ie=0;ie<W.meshes.length;++ie){let pe=W.meshes[ie];if(ie===W.lightMeshIndex)continue;let he=YE(R,c,te,pe.aabb);he!=null&&(y=Math.min(he,y))}if(W.children)for(let ie of W.children)z(ie)};if(z(C),y===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:y};let N=new Hi(0,0);return mD(h.tileID.canonical,N,v.node.anchor[0],v.node.anchor[1]),m={type:"Feature",geometry:{type:"Point",coordinates:[N.lng,N.lat]},properties:v.feature.properties,id:v.feature.id,state:{},layer:this.serialize()},{queryFeature:m,intersectionZ:y}}},clip:class extends pr{constructor(i,e,o,c){super(i,U3,e,o,c)}recalculate(i,e){super.recalculate(i,e)}createBucket(i){return new XT(i)}isTileClipped(){return!0}is3D(){return!0}}};ne(OE,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let fD=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yw{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[o,c]=new Uint8Array(e,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");let h=c>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);let p=fD[15&c];if(!p)throw new Error("Unrecognized array type.");let[m]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Yw(y,m,p,e)}constructor(e,o=64,c=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let p=fD.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-y%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${c}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=e)}add(e,o){let c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=o,c}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Zw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,o,c,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:p,coords:m,nodeSize:y}=this,v=[0,p.length-1,0],C=[];for(;v.length;){let T=v.pop()||0,E=v.pop()||0,D=v.pop()||0;if(E-D<=y){for(let N=D;N<=E;N++){let W=m[2*N],ee=m[2*N+1];W>=e&&W<=c&&ee>=o&&ee<=h&&C.push(p[N])}continue}let O=D+E>>1,R=m[2*O],z=m[2*O+1];R>=e&&R<=c&&z>=o&&z<=h&&C.push(p[O]),(T===0?e<=R:o<=z)&&(v.push(D),v.push(O-1),v.push(1-T)),(T===0?c>=R:h>=z)&&(v.push(O+1),v.push(E),v.push(1-T))}return C}within(e,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:h,coords:p,nodeSize:m}=this,y=[0,h.length-1,0],v=[],C=c*c;for(;y.length;){let T=y.pop()||0,E=y.pop()||0,D=y.pop()||0;if(E-D<=m){for(let N=D;N<=E;N++)_D(p[2*N],p[2*N+1],e,o)<=C&&v.push(h[N]);continue}let O=D+E>>1,R=p[2*O],z=p[2*O+1];_D(R,z,e,o)<=C&&v.push(h[O]),(T===0?e-c<=R:o-c<=z)&&(y.push(D),y.push(O-1),y.push(1-T)),(T===0?e+c>=R:o+c>=z)&&(y.push(O+1),y.push(E),y.push(1-T))}return v}}function Zw(i,e,o,c,h,p){if(h-c<=o)return;let m=c+h>>1;gD(i,e,m,c,h,p),Zw(i,e,o,c,m-1,1-p),Zw(i,e,o,m+1,h,1-p)}function gD(i,e,o,c,h,p){for(;h>c;){if(h-c>600){let C=h-c+1,T=o-c+1,E=Math.log(C),D=.5*Math.exp(2*E/3),O=.5*Math.sqrt(E*D*(C-D)/C)*(T-C/2<0?-1:1);gD(i,e,o,Math.max(c,Math.floor(o-T*D/C+O)),Math.min(h,Math.floor(o+(C-T)*D/C+O)),p)}let m=e[2*o+p],y=c,v=h;for(e_(i,e,c,o),e[2*h+p]>m&&e_(i,e,c,h);y<v;){for(e_(i,e,y,v),y++,v--;e[2*y+p]<m;)y++;for(;e[2*v+p]>m;)v--}e[2*c+p]===m?e_(i,e,c,v):(v++,e_(i,e,v,h)),v<=o&&(c=v+1),o<=v&&(h=v-1)}}function e_(i,e,o,c){Xw(i,o,c),Xw(e,2*o,2*c),Xw(e,2*o+1,2*c+1)}function Xw(i,e,o){let c=i[e];i[e]=i[o],i[o]=c}function _D(i,e,o,c){let h=i-o,p=e-c;return h*h+p*p}t.$=Cl,t.A=jh,t.B=Gs,t.C=Wi,t.D=to,t.E=Dl,t.G=io,t.H=u,t.I=b5,t.J=f1,t.K=function(i){let e=i.value,o=[];if(!e)return o;let c=Al(e);return c!=="string"?(o=o.concat([new Mb(i.key,e,`string expected, "${c}" found`)]),o):(ZE(e,!0)||(o=o.concat([new Mb(i.key,e,`invalid url "${e}"`)])),o)},t.L=Pe,t.M=class{constructor(i,e,o,c){this.id=i,this.position=e!=null?new Hi(e[0],e[1]):new Hi(0,0),this.orientation=o??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new Fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,e){if(t.ad.multiply(i.matrix,e,i.matrix),i.meshes)for(let o of i.meshes){let c=Fn.applyTransform(o.aabb,i.matrix);this.aabb.encapsulate(c)}if(i.children)for(let o of i.children)this._applyTransformations(o,i.matrix)}computeBoundsAndApplyParent(){let i=t.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,i)}computeModelMatrix(i,e,o,c,h,p,m=!1){QE(this.matrix,this,i.transform,this.position,e,o,c,h,p,m)}upload(i){if(!this.uploaded){for(let e of this.nodes)Nw(e,i);for(let e of this.nodes)Tb(e);this.uploaded=!0}}destroy(){for(let i of this.nodes)Vw(i)}},t.N=Qi,t.O=Qe,t.P=vt,t.Q=class{constructor(i){this.specification=i}possiblyEvaluate(i,e){return ss(i.expression.evaluate(e))}interpolate(i,e,o){return{x:Gt(i.x,e.x,o),y:Gt(i.y,e.y,o),z:Gt(i.z,e.z,o),azimuthal:Gt(i.azimuthal,e.azimuthal,o),polar:Gt(i.polar,e.polar,o)}}},t.R=ap,t.S=D1,t.T=Ya,t.U=tn,t.V=Mb,t.W=Zr,t.X=ti,t.Y=no,t.Z=q,t.a=na,t.a$=function(i){let{x:e,y:o}=i.point,{lng:c,lat:h}=i._center;return LT(e,o,i.worldSize,c,h)},t.a0=ln,t.a1=Gl,t.a2=Gt,t.a3=pt,t.a4=Z0,t.a5=class{constructor(i){this.specification=i}possiblyEvaluate(i,e){return function([o,c]){let h=ss([1,o,c]);return{x:h.x,y:h.y,z:h.z}}(i.expression.evaluate(e))}interpolate(i,e,o){return{x:Gt(i.x,e.x,o),y:Gt(i.y,e.y,o),z:Gt(i.z,e.z,o)}}},t.a6=xg,t.a7=Oy,t.a8=jl,t.a9=dT,t.aB=function(i,e){let{x:o,y:c}=i.point,h=LT(o,c,i.worldSize/i._pixelsPerMercatorPixel,0,0);return t.ad.multiply(h,h,ew(Xs(e)))},t.aD=$p,t.aE=Ia,t.aF=rb,t.aG=function(i,e,o,c,h){let p=5*e+2;i.float32[p+0]=o,i.float32[p+1]=c,i.float32[p+2]=h},t.aH=fb,t.aI=Hi,t.aJ=SE,t.aK=mT,t.aL=mr,t.aM=K1,t.aN=WE,t.aO=Jh,t.aP=OT,t.aQ=function(i,e,o,c,h,p,m,y,v){if(v.name==="globe")return OT(i,e,new Jh(o,c,h),!1);let C=nu({z:o,x:c,y:h},v);return new Fn([(p+C.x/C.scale)*e,e*(C.y/C.scale),m],[(p+C.x2/C.scale)*e,e*(C.y2/C.scale),y])},t.aR=function(i,e,o){let c=0;for(let h=0;h<2;++h)i[h]>0&&(c+=(i[h]-0)*(i[h]-0)),e[h]<0&&(c+=(0-e[h])*(0-e[h]));return c},t.aS=er,t.aT=Z1,t.aU=uT,t.aV=function(i){let e=t.ad.identity(new Float64Array(16));t.ad.multiply(e,i.pixelMatrix,i.globeMatrix);let o=[0,$a,0],c=[0,qa,0];return t._.transformMat4(o,o,e),t._.transformMat4(c,c,e),[o[0]>0&&o[0]<=i.width&&o[1]>0&&o[1]<=i.height&&!iw(i,new Hi(i.center.lat,90)),c[0]>0&&c[0]<=i.width&&c[1]>0&&c[1]<=i.height&&!iw(i,new Hi(i.center.lat,-90))]},t.aW=function(i,e){let{scale:o}=i.tileTransform,c=o*pt/(i.tileSize*Math.pow(2,e.zoom-i.tileID.overscaledZ+i.tileID.canonical.z));return t.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[c,c])},t.aX=Cb,t.aY=HE,t.aZ=function(i){let e=HE(i,!0);return t.aC.invert([],[e[0],e[1],e[4],e[5]])},t.a_=X1,t.aa=ko,t.ab=Li,t.ac=function(i,e,o){let c=Math.sqrt(i*i+e*e+o*o),h=c>0?Math.acos(o/c)*mh:0,p=i!==0||e!==0?Math.atan2(-e,-i)*mh+90:0;return p<0&&(p+=360),[c,p,h]},t.ae=Kp,t.af=bs,t.ag=Mw,t.ah=function(i,e){let o={};for(let c=0;c<e.length;c++){let h=e[c];h in i&&(o[h]=i[h])}return o},t.ai=dd,t.aj=Ys,t.ak=Zs,t.al=Ap,t.am=function(i){rp++,rp>kf&&(i.getActor().send("enforceCacheSizeLimit",Df),rp=0)},t.an=Bf,t.ao=class{constructor(i){this.entries={},this.scheduler=i}request(i,e,o,c){let h=this.entries[i]=this.entries[i]||{callbacks:[]};if(h.result){let[p,m]=h.result;return this.scheduler?this.scheduler.add(()=>{c(p,m)},e):c(p,m),()=>{}}return h.callbacks.push(c),h.cancel||(h.cancel=o((p,m)=>{h.result=[p,m];for(let y of h.callbacks)this.scheduler?this.scheduler.add(()=>{y(p,m)},e):y(p,m);setTimeout(()=>delete this.entries[i],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==c),h.callbacks.length||(h.cancel(),delete this.entries[i]))}}},t.ap=function(i,e,o){let c=JSON.stringify(i.request);return i.data&&(this.deduped.entries[c]={result:[null,i.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{let p=Il(i.request,(m,y,v,C)=>{m?h(m):y&&h(null,{vectorTile:o?void 0:new cw(new Gp(y)),rawData:y,cacheControl:v,expires:C})});return()=>{p.cancel(),h()}},e)},t.aq=O1,t.ar=class extends Vl{constructor(i){super(i),this.current=ZL}set(i,e,o){if(this.fetchUniformLocation(i,e)){for(let c=0;c<9;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},t.as=R1,t.at=yi,t.au=Sl,t.aw=bh,t.ax=Po,t.ay=zr,t.az=function(i,e,o){i[4*e+0]=o[0],i[4*e+1]=o[1],i[4*e+2]=o[2],i[4*e+3]=o[3]},t.b=Rn,t.b$=md,t.b0=Yr,t.b1=z1,t.b2=function(i){let e=Math.round((i+45+360)%360/90)%4;return L0[e]},t.b3=45,t.b4=V1,t.b5=Ry,t.b6=Fn,t.b7=ss,t.b8=function(i){return[Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)]},t.b9=xf,t.bA=function(i,e){return[Math.pow(i[0],2.2)*e,Math.pow(i[1],2.2)*e,Math.pow(i[2],2.2)*e]},t.bB=LI,t.bD=FT,t.bE=tp,t.bF=ep,t.bG=256,t.bH=function(i,e){let o=[0,0,0],c=Ig(Xs(e.canonical));return t._.transformMat4(o,o,c),t._.transformMat4(o,o,i),o},t.bI=i=>({u_camera_to_center_distance:new ko(i),u_extrude_scale:new F1(i),u_device_pixel_ratio:new ko(i),u_matrix:new xg(i),u_inv_rot_matrix:new xg(i),u_merc_center:new jl(i),u_tile_id:new O1(i),u_zoom_transition:new ko(i),u_up_dir:new O1(i),u_emissive_strength:new ko(i)}),t.bJ=i=>({u_matrix:new xg(i),u_pixels_to_tile_units:new F1(i),u_device_pixel_ratio:new ko(i),u_units_to_pixels:new jl(i),u_dash_image:new Oy(i),u_gradient_image:new Oy(i),u_image_height:new ko(i),u_texsize:new jl(i),u_tile_units_to_pixels:new ko(i),u_alpha_discard_threshold:new ko(i),u_trim_offset:new jl(i),u_trim_fade_range:new jl(i),u_trim_color:new R1(i),u_emissive_strength:new ko(i)}),t.bK=i=>({u_matrix:new xg(i),u_texsize:new jl(i),u_pixels_to_tile_units:new F1(i),u_device_pixel_ratio:new ko(i),u_image:new Oy(i),u_units_to_pixels:new jl(i),u_tile_units_to_pixels:new ko(i),u_alpha_discard_threshold:new ko(i),u_trim_offset:new jl(i)}),t.bL=w1,t.bM=Dz,t.bN=Kr,t.bO=qz,t.bP=fE,t.bQ=yw,t.bR=NT,t.bS=(i,e,o,c,h,p)=>{let m=i.transform,y=m.projection.name==="globe",v;if(p.paint.get("circle-pitch-alignment")==="map")if(y){let T=FT(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;v=Float32Array.from([T,0,0,T])}else v=m.calculatePixelsToTileUnitsMatrix(o);else v=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);let C={u_camera_to_center_distance:i.transform.getCameraToCenterDistance(m.projection),u_matrix:i.translatePosMatrix(e.projMatrix,o,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Rr.devicePixelRatio,u_extrude_scale:v,u_inv_rot_matrix:b3,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(y){C.u_inv_rot_matrix=c,C.u_merc_center=h,C.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],C.u_zoom_transition=Gl(m.zoom);let T=h[0]*pt,E=h[1]*pt;C.u_up_dir=m.projection.upVector(new Jh(0,0,0),T,E)}return C},t.bT=NI,t.bU=(i,e,o,c,h,p)=>{let m=i.transform;return{u_matrix:BI(i,e,o,c),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:zI(e,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:p}},t.bV=(i,e,o,c,h,p,m)=>{let y=i.transform,v=y.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:BI(i,e,o,c),u_pixels_to_tile_units:v,u_device_pixel_ratio:p,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:VI(o)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:zI(e,i.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength")}},t.bW=wf,t.bX=Eg,t.bY=EI,t.bZ=n3,t.b_=Jy,t.ba=function(i,e,o){let c=Gl(o.zoom),h=i.style.map._antialias,p=e.options.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return c===0&&!h&&!p},t.bb=function(i){let e=i.pixelsPerMeter,o=e/Po(1,i.center.lat),c=t.ad.identity(new Float64Array(16));return t.ad.translate(c,c,[i.point.x,i.point.y,0]),t.ad.scale(c,c,[o,o,e]),Float32Array.from(c)},t.bc=Vy,t.bd=function(i){let e=er-5;i=yi(i,-e,e)/e*90;let o=Math.pow(Math.abs(Math.sin(Li(i))),3);return Math.round(o*(B1.length-1))},t.be=function(i,e,o,c){let h=e.getNorth(),p=e.getSouth(),m=e.getWest(),y=e.getEast(),v=1<<i.z,C=y-m,T=h-p,E=C/Fp,D=-T/B1[o],O=[0,E,0,D,0,0,h,m,0];if(i.z>0){let R=180/c;t.bC.multiply(O,O,[R/C+1,0,0,0,R/T+1,0,-.5*R/E,.5*R/D,1])}return O[2]=v,O[5]=i.x,O[8]=i.y,O},t.bf=Ig,t.bg=Xs,t.bh=function(i,e,o){let c=t.ad.identity(new Float64Array(16)),h=(e/(1<<i)-.5)*Math.PI*2;return t.ad.rotateY(c,o.globeMatrix,h),Float32Array.from(c)},t.bi=Lc,t.bj=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},t.bk=jE,t.bl=UE,t.bm=VE,t.bn=function(i,e){let o=document.createElement("video");o.muted=!0,o.onloadstart=function(){e(null,o)};for(let c=0;c<i.length;c++){let h=document.createElement("source");j0(i[c])||(o.crossOrigin="Anonymous"),h.src=i[c],o.appendChild(h)}return{cancel:()=>{}}},t.bo=gb,t.bp=Ku,t.bq=class{isDataAvailableAtPoint(i){let e=this._source();if(this.isUsingMockSource()||!e||i.y<0||i.y>1)return!1;let o=e.getSource().maxzoom,c=1<<o,h=Math.floor(i.x),p=Math.floor((i.x-h)*c),m=Math.floor(i.y*c),y=this.findDEMTileFor(new mr(o,h,o,p,m));return!(!y||!y.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,o=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let c=this._source();if(!c||i.y<0||i.y>1)return e;let h=c.getSource().maxzoom,p=1<<h,m=Math.floor(i.x),y=i.x-m,v=new mr(h,m,h,Math.floor(y*p),Math.floor(i.y*p)),C=this.findDEMTileFor(v);if(!C||!C.dem)return e;let T=C.dem,E=1<<C.tileID.canonical.z,D=(y*E-C.tileID.canonical.x)*T.dim,O=(i.y*E-C.tileID.canonical.y)*T.dim,R=Math.floor(D),z=Math.floor(O);return(o?this.exaggeration():1)*Gt(Gt(T.get(R,z),T.get(R,z+1),O-z),Gt(T.get(R+1,z),T.get(R+1,z+1),O-z),D-R)}getAtTileOffset(i,e,o){let c=1<<i.canonical.z;return this.getAtPointOrZero(new no(i.wrap+(i.canonical.x+e/pt)/c,(i.canonical.y+o/pt)/c))}getAtTileOffsetFunc(i,e,o,c){return h=>{let p=this.getAtTileOffset(i,h.x,h.y),m=c.upVector(i.canonical,h.x,h.y),y=c.upVectorScale(i.canonical,e,o).metersToTile;return t._.scale(m,m,p*y),m}}getForTilePoints(i,e,o,c){if(this.isUsingMockSource())return!1;let h=Up.create(this,i,c);return!!h&&(e.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],o)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(i);if(!e||!e.dem)return null;let o=e.dem.tree,c=e.tileID,h=1<<i.canonical.z-c.canonical.z,p=i.canonical.x/h-c.canonical.x,m=i.canonical.y/h-c.canonical.y,y=0;for(let v=0;v<i.canonical.z-c.canonical.z&&!o.leaves[y];v++){p*=2,m*=2;let C=2*Math.floor(m)+Math.floor(p);y=o.childOffsets[y]+C,p%=1,m%=1}return{min:this.exaggeration()*o.minimums[y],max:this.exaggeration()*o.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,o){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let i=this.visibleDemTiles;if(i.length===0)return null;let e=!1,o=Number.MAX_VALUE,c=Number.MIN_VALUE;for(let h of i){let p=this.getMinMaxForTile(h.tileID);p&&(o=Math.min(o,p.min),c=Math.max(c,p.max),e=!0)}return e?{min:o,max:c}:null}},t.br=Mg,t.bs=Ny,t.bt=ms,t.bu=Ir,t.bv=ru,t.bw=jw,t.bx=Ib,t.by=bb,t.bz=GT,t.c=cD,t.c$=xh,t.c0=450,t.c1=7,t.c2=Y5,t.c3=RE,t.c4=256,t.c5=AT,t.c6=ew,t.c7=Ji,t.c8=od,t.c9=Xh,t.cA=function(i){let e=1/0,o=1/0,c=-1/0,h=-1/0;for(let p of i)e=Math.min(e,p.x),o=Math.min(o,p.y),c=Math.max(c,p.x),h=Math.max(h,p.y);return{min:new vt(e,o),max:new vt(c,h)}},t.cB=hd,t.cC=yT,t.cD=Ao,t.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.cF=lE,t.cG=G1,t.cH=sI,t.cI=lI,t.cJ=ww,t.cK=Yw,t.cL=function(i){return i({pluginStatus:it,pluginURL:$e}),ai.on("pluginStateChange",i),i},t.cM=Yp,t.cN=vw,t.cO=sp,t.cP=Pt,t.cQ=L,t.cR=Ef,t.cS=jc,t.cT=Va,t.cU=function(i){let e=i.indexOf(td);return e>=0?i.slice(0,e):i},t.cV=function(i){return i.indexOf(td)>=0},t.cW=function(i){let e=i.indexOf(td);return e>=0?i.slice(e+1):""},t.cX=function(i){let e=[],o=i.id;return o===void 0&&e.push({message:`layers.${o}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${o}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),e},t.cY=function(i,e,o,c){return i.type==="custom"?new K5(i,e):new IB[i.type](i,e,o,c)},t.cZ=Ml,t.c_=ai,t.ca=1,t.cb=Wg,t.cc=0,t.cd=T1,t.ce=function(i,e,o,c,h){return yi((i-e)/(o-e)*(h-c)+c,c,h)},t.cf=xy,t.cg=eu,t.ch=class{constructor(i,e,o,c){this.context=i,this.format=c,this.size=o,this.texture=i.gl.createTexture();let[h,p,m]=this.size,{gl:y}=i;y.bindTexture(y.TEXTURE_3D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(!1);let v=this.format,C=y.UNSIGNED_BYTE;this.format===y.DEPTH_COMPONENT&&(v=y.DEPTH_COMPONENT16,C=y.UNSIGNED_SHORT),this.format===y.R8&&(c=y.RED),this.format===y.R32F&&(C=y.FLOAT,c=y.RED),y.texImage3D(y.TEXTURE_3D,0,v,h,p,m,0,c,C,e.data)}bind(i,e){let{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_3D,this.texture),i!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,i),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,i),this.minFilter=i),e!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,e),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}},t.ci=zw,t.cj=[1,1,1],t.ck=Up,t.cl=tm,t.cm=sd,t.cn=Op,t.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new vt(1/0,1/0),max:new vt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(i,e=!1){let o=rI(new vt(0,0),new vt(pt,pt),i),c=[];if(e&&!dw(o,this._globalClipBounds))return c;for(let h of this._activeRegions){if(h.hiddenByOverlap||!dw(o,h))continue;let p=iz(h.min,h.max,i);c.push({min:p.min,max:p.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask})}return c}setSources(i){this._setSources(i.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let o=[];for(let c of e.cache.getVisibleCoordinates()){let h=e.cache.getTile(c).buckets[e.layer];h&&h.updateFootprints(c.toUnwrapped(),o)}return o},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(i){let e=i.getFootprints();if(e.length===0)return;let o=i.getOrder(),c=i.getClipMask();for(let h of e){if(!h.footprint)continue;let p=rI(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:p.min,max:p.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:o,clipMask:c})}this._sourceIds.push(i.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,o)=>e.priority-o.priority||Xy(e.min,o.min)||Xy(e.max,o.max));let i=this._activeRegions.length!==this._prevRegions.length;if(!i){let e=0;for(;!i&&e!==this._activeRegions.length;){let o=this._activeRegions[e],c=this._prevRegions[e];i=o.priority!==c.priority||!nI(o,c)||o.order!==c.order||o.clipMask!==c.clipMask,++e}}if(i){++this._updateTime;for(let o of this._activeRegions)o.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));let e=o=>{let c=this._activeRegions;if(o>=c.length)return o;let h=c[o].priority;for(;o<c.length&&c[o].priority===h;)++o;return o};if(this._sourceIds.length>1){let o=0,c=e(o);for(;o!==c;){let h=o,p=o;for(;h!==c;){let m=this._activeRegions[h];m.hiddenByOverlap=!1;for(let y=0;y<p;y++){let v=this._activeRegions[y];if(!v.hiddenByOverlap&&m.order===1/0&&dw(m,v)&&(m.hiddenByOverlap=aI(m.footprint,m.tileId,v.footprint,v.tileId),m.hiddenByOverlap))break}++h}o=c,c=e(o)}}}}_setSources(i){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=i.length-1;e>=0;e--)this._addSource(i[e]);this._computeReplacement()}},t.cp=nd,t.cq=yb,t.cr=bg,t.cs=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let i of this._poleSegments)i.destroy();for(let i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy()}_fillGridMeshWithLods(i,e){let o=new ms,c=new Ir,h=[],p=i+1+2,m=e[0]+1,y=e[0]+1+(1+e.length),v=(C,T,E)=>{let D=C===p-1?C-2:C===0?C:C-1;return D+=E?24575:0,[D,T]};for(let C=0;C<p;++C)o.emplaceBack(...v(C,0,!0));for(let C=0;C<m;++C)for(let T=0;T<p;++T)o.emplaceBack(...v(T,C,(T===0||T===p-1)&&!0));for(let C=0;C<e.length;++C){let T=e[C];for(let E=0;E<p;++E)o.emplaceBack(...v(E,T,!0))}for(let C=0;C<e.length;++C){let T=c.length,E=e[C]+1+2,D=new Ir;for(let z=0;z<E-1;z++){let N=z===E-2,W=N?p*(y-e.length+C-z):p;for(let ee=0;ee<p-1;ee++){let te=z*p+ee;z===0||N||ee===0||ee===p-2?(D.emplaceBack(te+1,te,te+W),D.emplaceBack(te+W,te+W+1,te+1)):(c.emplaceBack(te+1,te,te+W),c.emplaceBack(te+W,te+W+1,te+1))}}let O=Rn.simpleSegment(0,T,o.length,c.length-T);for(let z=0;z<D.uint16.length;z+=3)c.emplaceBack(D.uint16[z],D.uint16[z+1],D.uint16[z+2]);let R=Rn.simpleSegment(0,T,o.length,c.length-T);h.push({withoutSkirts:O,withSkirts:R})}return{vertices:o,indices:c,segments:h}}_createGrid(i){let e=this._fillGridMeshWithLods(Fp,B1);this._gridSegments=e.segments,this._gridBuffer=i.createVertexBuffer(e.vertices,Mg.members),this._gridIndexBuffer=i.createIndexBuffer(e.indices,!0)}_createPoles(i){let e=new Ir;for(let m=0;m<=Fp;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);let o=new Xh,c=new Xh,h=new Xh,p=new Xh;this._poleSegments=[];for(let m=0,y=0;m<z1;m++){let v=360/(1<<m);o.emplaceBack(0,-Ao,0,.5,0),c.emplaceBack(0,-Ao,0,.5,1),h.emplaceBack(0,-Ao,0,.5,.5),p.emplaceBack(0,-Ao,0,.5,.5);for(let C=0;C<=Fp;C++){let T=C/Fp,E=0,D=Gt(0,v,T),[O,R,z]=Lp(_3,y3,D,Ao);o.emplaceBack(O,R,z,T,E),c.emplaceBack(O,R,z,T,1-E);let N=Li(D);T=.5+.5*Math.sin(N),E=.5+.5*Math.cos(N),h.emplaceBack(O,R,z,T,E),p.emplaceBack(O,R,z,T,1-E)}this._poleSegments.push(Rn.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(o,By,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(c,By,!1),this._texturedPoleNorthVertexBuffer=i.createVertexBuffer(h,By,!1),this._texturedPoleSouthVertexBuffer=i.createVertexBuffer(p,By,!1)}getGridBuffers(i,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}},t.ct=function(i){return Th.has(i)},t.cu=gI,t.cv=function(i,e,o=0,c=!0){let h=new vt(o,o),p=i.sub(h),m=e.add(h),y=[p,new vt(m.x,p.y),m,new vt(p.x,m.y)];return c&&y.push(p.clone()),y},t.cw=function(i,e){let o=[];for(let c=0;c<i.length;c++){let h=Sl(c-1,-1,i.length-1),p=Sl(c+1,-1,i.length-1),m=i[c],y=i[p],v=i[h].sub(m).unit(),C=y.sub(m).unit(),T=C.angleWithSep(v.x,v.y),E=v.add(C).unit().mult(-1*e/Math.sin(T/2));o.push(m.add(E))}return o},t.cx=bE,t.cy=CT,t.cz=function(i,e,o=0){return t._.fromValues(((e.x-o)*i.scale-i.x)*pt,(e.y*i.scale-i.y)*pt,fT(e.z,e.y))},t.d=hp,t.d$=Yu,t.d0=fh,t.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},t.d2=Pc,t.d3=_T,t.d4=Qh,t.d5=function([i,e,o]){let c=Math.hypot(i,e,o),h=Math.atan2(i,o),p=.5*Math.PI-Math.acos(-e/c);return new Hi(Yr(h),Yr(p))},t.d6=Wo,t.d7=zp,t.d8=M,t.d9=iw,t.dA=function(i){let e=N0();if(!e)return;let o=e.delete(B0);i&&o.catch(i).then(()=>i())},t.dB=Zg,t.dC=eD,t.dD=function(i){Hw=Rr.resolveURL(i),nm||(nm=new jw(Ib(),new Dl)),nm.broadcast("setDracoUrl",Hw)},t.dE=tD,t.dF=function(i){im=Rr.resolveURL(i),nm||(nm=new jw(Ib(),new Dl)),nm.broadcast("setMeshoptUrl",im)},t.dG=Jo,t.dH=ne,t.dI=ud,t.dJ=ys,t.dK=nu,t.dL=A1,t.dM=jI,t.dN=YI,t.dO=RI,t.dP=Rc,t.dQ=dE,t.dR=Qp,t.dS=function(i,e,o,c,h,p,m,y,v,C,T){i.createArrays(),i.tilePixelRatio=pt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;let E=i.layers[0].layout,D=i.layers[0]._unevaluatedLayout._values,O={};if(i.textSizeData.kind==="composite"){let{minZoom:W,maxZoom:ee}=i.textSizeData;O.compositeTextSizes=[D["text-size"].possiblyEvaluate(new ti(W),y),D["text-size"].possiblyEvaluate(new ti(ee),y)]}if(i.iconSizeData.kind==="composite"){let{minZoom:W,maxZoom:ee}=i.iconSizeData;O.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new ti(W),y),D["icon-size"].possiblyEvaluate(new ti(ee),y)]}O.layoutTextSize=D["text-size"].possiblyEvaluate(new ti(v+1),y),O.layoutIconSize=D["icon-size"].possiblyEvaluate(new ti(v+1),y),O.textMaxSize=D["text-size"].possiblyEvaluate(new ti(18),y);let R=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",z=E.get("text-size"),N=!1;for(let W of i.features)if(W.icon&&W.icon.nameSecondary){N=!0;break}for(let W of i.features){let ee=E.get("text-font").evaluate(W,{},y).join(","),te=z.evaluate(W,{},y),ie=O.layoutTextSize.evaluate(W,{},y),pe=(O.layoutIconSize.evaluate(W,{},y),{horizontal:{},vertical:void 0}),he=W.text,ve,Ce=[0,0];if(he){let Le=he.toString(),qe=E.get("text-letter-spacing").evaluate(W,{},y)*Kr,ot=E.get("text-line-height").evaluate(W,{},y)*Kr,Ge=ze(Le)?qe:0,et=E.get("text-anchor").evaluate(W,{},y),Ue=E.get("text-variable-anchor");if(!Ue){let at=E.get("text-radial-offset").evaluate(W,{},y);Ce=at?fE(et,[at*Kr,xw]):E.get("text-offset").evaluate(W,{},y).map(ht=>ht*Kr)}let tt=R?"center":E.get("text-justify").evaluate(W,{},y),lt=E.get("symbol-placement")==="point",nt=lt?E.get("text-max-width").evaluate(W,{},y)*Kr:1/0,Ct=at=>{i.allowVerticalPlacement&&Re(Le)&&(pe.vertical=_w(he,e,o,h,ee,nt,ot,et,at,Ge,Ce,Ia.vertical,!0,ie,te))};if(!R&&Ue){let at=tt==="auto"?Ue.map(Ut=>ww(Ut)):[tt],ht=!1;for(let Ut=0;Ut<at.length;Ut++){let Bt=at[Ut];if(!pe.horizontal[Bt])if(ht)pe.horizontal[Bt]=pe.horizontal[0];else{let Rt=_w(he,e,o,h,ee,nt,ot,"center",Bt,Ge,Ce,Ia.horizontal,!1,ie,te);Rt&&(pe.horizontal[Bt]=Rt,ht=Rt.positionedLines.length===1)}}Ct("left")}else{if(tt==="auto"&&(tt=ww(et)),lt||E.get("text-writing-mode").indexOf("horizontal")>=0||!Re(Le)){let at=_w(he,e,o,h,ee,nt,ot,et,tt,Ge,Ce,Ia.horizontal,!1,ie,te);at&&(pe.horizontal[tt]=at)}Ct(lt?"left":tt)}}let Ae=!1;if(W.icon&&W.icon.namePrimary){let Le=c[W.icon.namePrimary];Le&&(ve=i5(h[W.icon.namePrimary],W.icon.nameSecondary?h[W.icon.nameSecondary]:void 0,E.get("icon-offset").evaluate(W,{},y),E.get("icon-anchor").evaluate(W,{},y)),Ae=Le.sdf,i.sdfIcons===void 0?i.sdfIcons=Le.sdf:i.sdfIcons!==Le.sdf&&Qn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Le.pixelRatio!==i.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}let je=_E(pe.horizontal)||pe.vertical;i.iconsInText||(i.iconsInText=!!je&&je.iconsInText),(je||ve)&&c5(i,W,pe,ve,c,O,ie,0,Ce,Ae,m,y,C,T,N)}p&&i.generateCollisionDebugBuffers(v,i.collisionBoxArray)},t.dT=eb,t.dU=$y,t.dV=cw,t.dW=Gp,t.dX=Ky,t.dY=Ow,t.dZ=Yy,t.d_=qy,t.da=zT,t.db=function(i){let e=[0,0,0],o=t.ad.identity(new Float64Array(16));return t.ad.multiply(o,i.pixelMatrix,i.globeMatrix),t._.transformMat4(e,e,o),new vt(e[0],e[1])},t.dc=Me,t.dd=be,t.de=function(i){let e=i.navigator?i.navigator.userAgent:null;return!!function(o){if(Ju==null){let c=o.navigator?o.navigator.userAgent:null;Ju=!!o.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Ju}(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.df=Zu,t.dg=class{constructor(i,e,o){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){let i=function(){let e="";for(let o=0;o<10;o++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Lf,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!L(i))return i;let o=ba(i);return o.params.push(`sdk=js-${g}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!L(i))return i;let o=ba(i);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||e)}normalizeModelURL(i,e){if(!L(i))return i;let o=ba(i);return o.path=`/models/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||e)}normalizeSourceURL(i,e,o,c){if(!L(i))return i;let h=ba(i);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),o&&h.params.push(`language=${o}`),c&&h.params.push(`worldview=${c}`),this._makeAPIURL(h,this._customAccessToken||e)}normalizeSpriteURL(i,e,o,c){let h=ba(i);return L(i)?(h.path=`/styles/v1${h.path}/sprite${e}${o}`,this._makeAPIURL(h,this._customAccessToken||c)):(h.path+=`${e}${o}`,Nc(h))}normalizeTileURL(i,e,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!L(i))return i;let c=ba(i);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||o&&c.authority!=="raster"&&o===512?"@2x":""}${op.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${M.RASTER_URL_PREFIX}${c.path}`:c.authority==="rasterarrays"?c.path=`/${M.RASTERARRAYS_URL_PREFIX}${c.path}`:c.authority==="3dtiles"?c.path=`/${M.TILES3D_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${M.TILE_URL_VERSION}${c.path}`);let h=this._customAccessToken||function(p){for(let m of p){let y=m.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(c.params)||M.ACCESS_TOKEN;return M.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,h)}canonicalizeTileURL(i,e){let o=ba(i);if(!o.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!o.path.match(/\.[\w]+$/))return i;let c="mapbox://";o.path.match(/^\/raster\/v1\//)?c+=`raster/${o.path.replace(`/${M.RASTER_URL_PREFIX}/`,"")}`:o.path.match(/^\/rasterarrays\/v1\//)?c+=`rasterarrays/${o.path.replace(`/${M.RASTERARRAYS_URL_PREFIX}/`,"")}`:c+=`tiles/${o.path.replace(`/${M.TILE_URL_VERSION}/`,"")}`;let h=o.params;return e&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(c+=`?${h.join("&")}`),c}canonicalizeTileset(i,e){let o=!!e&&L(e),c=[];for(let h of i.tiles||[])k(h)?c.push(this.canonicalizeTileURL(h,o)):c.push(h);return c}_makeAPIURL(i,e){let o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=ba(M.API_URL);if(i.protocol=c.protocol,i.authority=c.authority,i.protocol==="http"){let h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if(c.path!=="/"&&(i.path=`${c.path}${i.path}`),!M.REQUIRE_ACCESS_TOKEN)return Nc(i);if(e=e||M.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return i.params=i.params.filter(h=>h.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),Nc(i)}},t.dh=function(i,e){e?Th.add(i):Th.delete(i)},t.di=op,t.dj=Qx,t.dk=dp,t.dl=zf,t.dm=W0,t.dn=Kx,t.dp=function(i){Th.delete(i)},t.dq=Vc,t.dr=Mh,t.ds=Oc,t.dt=g,t.du=function(i,e){Df=i,kf=e},t.dv=function(i,e,o=!1){if(it===mt||it===_t||it===St)throw new Error("setRTLTextPlugin cannot be called multiple times.");$e=Rr.resolveURL(i),it=mt,yt=e,hi(),o||zi()},t.dw=xi,t.dx=function(){Ib().acquire(Uw)},t.dy=function(){let i=Kg;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(Uw),Kg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.dz=Xg,t.e=Rr,t.e0=UI,t.e1=He,t.e2=Il,t.e3=function(i){let e=0;if(new Uint32Array(i,0,1)[0]!==nD){let o=new Uint32Array(i,0,7),[,,c,h,p,m]=o;e=o.byteLength+h+p+m+p,(c!==i.byteLength||e>=i.byteLength)&&Qn("Invalid b3dm header information.")}return sD(i,e)},t.e4=function(i,e){let o=cD(i);for(let c of o){for(let h of c.meshes)CB(h);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(SB(c.lights,e)))}return o},t.e5=Ab,t.e6=JE,t.e7=an,t.e8=function(i){vh(),cs&&cs.then(e=>{e.keys().then(o=>{for(let c=0;c<o.length-i;c++)e.delete(o[c])})})},t.f=fo,t.g=function(i,e){return xh(Zr(i,{type:"json"}),e)},t.h=Bs,t.i=Ta,t.j=cE,t.k=bw,t.l=function(i){return fetch(i).then(e=>e.arrayBuffer()).then(e=>sD(e,0,i))},t.m=class extends Mb{},t.n=Al,t.o=Uf,t.p=C5,t.q=kp,t.r=f,t.s=l,t.t=B,t.u=Uo,t.v=Lr,t.w=Qn,t.x=Z,t.y=U,t.z=vp}),r(["./shared"],function(t){function g(Se){let $=Se?Se.url.toString():void 0;return $?performance.getEntriesByName($):[]}function b(Se){if(typeof Se=="number"||typeof Se=="boolean"||typeof Se=="string"||Se==null)return JSON.stringify(Se);if(Array.isArray(Se)){let Q="[";for(let de of Se)Q+=`${b(de)},`;return`${Q}]`}let $="{";for(let Q of Object.keys(Se).sort())$+=`${Q}:${b(Se[Q])},`;return`${$}}`}function M(Se){let $="";for(let Q of t.cE)$+=`/${b(Se[Q])}`;return $}class k{constructor($){this.keyCache={},this._layers={},this._layerConfigs={},$&&this.replace($)}replace($,Q){this._layerConfigs={},this._layers={},this.update($,[],Q)}update($,Q,de){this._options=de;for(let ye of $)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=t.cY(ye,this.scope,null,this._options)).compileFilter(),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(let ye of Q)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};let _e=function(ye,ke){let Be={};for(let Ve=0;Ve<ye.length;Ve++){let ut=ke&&ke[ye[Ve].id]||M(ye[Ve]);ke&&(ke[ye[Ve].id]=ut);let st=Be[ut];st||(st=Be[ut]=[]),st.push(ye[Ve])}let Ie=[];for(let Ve in Be)Ie.push(Be[Ve]);return Ie}(t.dG(this._layerConfigs),this.keyCache);for(let ye of _e){let ke=ye.map(Lt=>this._layers[Lt.id]),Be=ke[0];if(Be.visibility==="none")continue;let Ie=Be.source||"",Ve=this.familiesBySource[Ie];Ve||(Ve=this.familiesBySource[Ie]={});let ut=Be.sourceLayer||"_geojsonTileLayer",st=Ve[ut];st||(st=Ve[ut]=[]),st.push(ke)}}}let L=1*t.dJ;class G{constructor($){let Q={},de=[];for(let Be in $){let Ie=$[Be],Ve=Q[Be]={};for(let ut in Ie.glyphs){let st=Ie.glyphs[+ut];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;let Lt=st.metrics.localGlyph?L:1,Yt={x:0,y:0,w:st.bitmap.width+2*Lt,h:st.bitmap.height+2*Lt};de.push(Yt),Ve[ut]=Yt}}let{w:_e,h:ye}=t.j(de),ke=new t.dI({width:_e||1,height:ye||1});for(let Be in $){let Ie=$[Be];for(let Ve in Ie.glyphs){let ut=Ie.glyphs[+Ve];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;let st=Q[Be][Ve],Lt=ut.metrics.localGlyph?L:1;t.dI.copy(ut.bitmap,ke,{x:0,y:0},{x:st.x+Lt,y:st.y+Lt},ut.bitmap)}}this.image=ke,this.positions=Q}}t.dH(G,"GlyphAtlas");class J{constructor($){this.tileID=new t.aL($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.lut=$.lut,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.scope=$.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.promoteId=$.promoteId,this.isSymbolTile=$.isSymbolTile,this.tileTransform=t.dK($.tileID.canonical,$.projection),this.projection=$.projection,this.brightness=$.brightness,this.extraShadowCaster=!!$.extraShadowCaster,this.tessellationStep=$.tessellationStep}parse($,Q,de,_e,ye){this.status="parsing",this.data=$,this.collisionBoxArray=new t.dL;let ke=new t.dM(Object.keys($.layers).sort()),Be=new t.dN(this.tileID,this.promoteId);Be.bucketLayerIDs=[];let Ie={},Ve=new t.dO(256,256),ut={featureIndex:Be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ve,availableImages:de,brightness:this.brightness},st=Q.familiesBySource[this.source];for(let Ot in st){let En=$.layers[Ot];if(!En)continue;let on=!1,Vi=!1,Kn=!1;for(let $r of st[Ot])$r[0].type==="symbol"?on=!0:Vi=!0,$r[0].is3D()&&$r[0].type!=="model"&&(Kn=!0);if(this.extraShadowCaster&&!Kn||this.isSymbolTile===!0&&!on||this.isSymbolTile===!1&&!Vi)continue;En.version===1&&t.w(`Vector tile source "${this.source}" layer "${Ot}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Dn=ke.encode(Ot),cr=[];for(let $r=0;$r<En.length;$r++){let qr=En.feature($r),xl=Be.getId(qr,Ot);cr.push({feature:qr,id:xl,index:$r,sourceLayerIndex:Dn})}for(let $r of st[Ot]){let qr=$r[0];(!this.extraShadowCaster||qr.is3D()&&qr.type!=="model")&&(this.isSymbolTile!==void 0&&qr.type==="symbol"!==this.isSymbolTile||qr.minzoom&&this.zoom<Math.floor(qr.minzoom)||qr.maxzoom&&this.zoom>=qr.maxzoom||qr.visibility!=="none"&&(oe($r,this.zoom,ut.brightness,de),(Ie[qr.id]=qr.createBucket({index:Be.bucketLayerIDs.length,layers:$r,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Dn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(cr,ut,this.tileID.canonical,this.tileTransform),Be.bucketLayerIDs.push($r.map(xl=>xl.id))))}}let Lt,Yt,_i,vi;Ve.trim();let li={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Fi=()=>{if(Lt)return this.status="done",ye(Lt);if(this.extraShadowCaster)this.status="done",ye(null,{buckets:t.dG(Ie).filter(Ot=>!Ot.isEmpty()),featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ut.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Yt&&_i&&vi){let Ot=new G(Yt),En=new t.dQ(_i,vi,this.lut);for(let on in Ie){let Vi=Ie[on];Vi instanceof t.dR?(oe(Vi.layers,this.zoom,ut.brightness,de),t.dS(Vi,Yt,Ot.positions,_i,En.iconPositions,this.showCollisionBoxes,de,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Vi.hasPattern&&(Vi instanceof t.dT||Vi instanceof t.dU||Vi instanceof t.b_)&&(oe(Vi.layers,this.zoom,ut.brightness,de),Vi.addFeatures(ut,this.tileID.canonical,En.patternPositions,de,this.tileTransform,this.brightness))}this.status="done",ye(null,{buckets:t.dG(Ie).filter(on=>!on.isEmpty()),featureIndex:Be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ot.image,lineAtlas:Ve,imageAtlas:En,brightness:ut.brightness})}};if(!this.extraShadowCaster){let Ot=t.dP(ut.glyphDependencies,Vi=>Object.keys(Vi).map(Number));Object.keys(Ot).length?_e.send("getGlyphs",{uid:this.uid,stacks:Ot,scope:this.scope},(Vi,Kn)=>{Lt||(Lt=Vi,Yt=Kn,Fi())},void 0,!1,li):Yt={};let En=Object.keys(ut.iconDependencies);En.length?_e.send("getImages",{icons:En,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Vi,Kn)=>{Lt||(Lt=Vi,_i=Kn,Fi())},void 0,!1,li):_i={};let on=Object.keys(ut.patternDependencies);on.length?_e.send("getImages",{icons:on,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Vi,Kn)=>{Lt||(Lt=Vi,vi=Kn,Fi())},void 0,!1,li):vi={}}Fi()}}function oe(Se,$,Q,de){let _e=new t.X($,{brightness:Q});for(let ye of Se)ye.recalculate(_e,de)}class be extends t.E{constructor($,Q,de,_e,ye,ke){super(),this.actor=$,this.layerIndex=Q,this.availableImages=de,this.loadVectorData=ye||t.ap,this.loading={},this.loaded={},this.deduped=new t.ao($.scheduler),this.isSpriteLoaded=_e,this.scheduler=$.scheduler,this.brightness=ke}loadTile($,Q){let de=$.uid,_e=$&&$.request,ye=_e&&_e.collectResourceTiming,ke=this.loading[de]=new J($);ke.abort=this.loadVectorData($,(Be,Ie)=>{let Ve=!this.loading[de];if(delete this.loading[de],Ve||Be||!Ie)return ke.status="done",Ve||(this.loaded[de]=ke),Q(Be);let ut=Ie.rawData,st={};Ie.expires&&(st.expires=Ie.expires),Ie.cacheControl&&(st.cacheControl=Ie.cacheControl),ke.vectorTile=Ie.vectorTile||new t.dV(new t.dW(ut));let Lt=()=>{ke.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.actor,(Yt,_i)=>{if(Yt||!_i)return Q(Yt);let vi={};if(ye){let li=g(_e);li.length>0&&(vi.resourceTiming=JSON.parse(JSON.stringify(li)))}Q(null,t.W({rawTileData:ut.slice(0)},_i,st,vi))})};this.isSpriteLoaded?Lt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Lt,{type:"parseTile",isSymbolTile:$.isSymbolTile,zoom:$.tileZoom}):Lt()}),this.loaded=this.loaded||{},this.loaded[de]=ke})}reloadTile($,Q){let de=this.loaded,_e=$.uid;if(de&&de[_e]){let ye=de[_e];ye.showCollisionBoxes=$.showCollisionBoxes,ye.projection=$.projection,ye.brightness=$.brightness,ye.tileTransform=t.dK($.tileID.canonical,$.projection),ye.extraShadowCaster=$.extraShadowCaster,ye.lut=$.lut;let ke=(Be,Ie)=>{let Ve=ye.reloadCallback;Ve&&(delete ye.reloadCallback,ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,Ve)),Q(Be,Ie)};ye.status==="parsing"?ye.reloadCallback=ke:ye.status==="done"&&(ye.vectorTile?ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,ke):ke())}else Q(null,void 0)}abortTile($,Q){let de=$.uid,_e=this.loading[de];_e&&(_e.abort&&_e.abort(),delete this.loading[de]),Q()}removeTile($,Q){let de=this.loaded,_e=$.uid;de&&de[_e]&&delete de[_e],Q()}}class Me{loadTile($,Q){let{uid:de,encoding:_e,rawImageData:ye,padding:ke}=$,Be=ImageBitmap&&ye instanceof ImageBitmap?this.getImageData(ye,ke):ye;Q(null,new t.dX(de,Be,_e,ke<1))}getImageData($,Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);let de=this.offscreenCanvasContext.getImageData(-Q,-Q,$.width+2*Q,$.height+2*Q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}class Te{decodeRasterArray({task:$,buffer:Q},de){t.dY.performDecoding(Q,$).then(_e=>{de(null,_e)},_e=>{de(_e)})}}let He=t.dZ.prototype.toGeoJSON,We=class{constructor(Se){this._feature=Se,this.extent=t.a3,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){let Se=[];for(let $ of this._feature.geometry)Se.push([new t.P($[0],$[1])]);return Se}{let Se=[];for(let $ of this._feature.geometry){let Q=[];for(let de of $)Q.push(new t.P(de[0],de[1]));Se.push(Q)}return Se}}toGeoJSON(Se,$,Q){return He.call(this,Se,$,Q)}},dt=class{constructor(Se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.a3,this.length=Se.length,this._features=Se}feature(Se){return new We(this._features[Se])}},bt=64/4096;class ft{constructor(){this.features=new Map}clear(){this.features.clear()}load($=[],Q){for(let de of $){let _e=de.id;if(_e==null)continue;let ye=this.features.get(_e);ye&&this.updateCache(ye,Q),de.geometry?(ye=Wt(de),this.updateCache(ye,Q),this.features.set(_e,ye)):this.features.delete(_e),this.updateCache(ye,Q)}}updateCache($,Q){for(let{canonical:de,uid:_e}of Object.values(Q)){let{z:ye,x:ke,y:Be}=de;It($,Math.pow(2,ye),ke,Be)&&delete Q[_e]}}getTile($,Q,de){let _e=Math.pow(2,$),ye=[];for(let ke of this.features.values())It(ke,_e,Q,de)&&ye.push(Oi(ke,_e,Q,de));return{features:ye}}getFeatures(){return[...this.features.values()]}}function It({minX:Se,minY:$,maxX:Q,maxY:de},_e,ye,ke){return Se<(ye+1+bt)/_e&&$<(ke+1+bt)/_e&&Q>(ye-bt)/_e&&de>(ke-bt)/_e}function Wt(Se){let{id:$,geometry:Q,properties:de}=Se;if(!Q)return;if(Q.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:_e,coordinates:ye}=Q,ke={id:$,type:1,geometry:[],tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Be=ke.geometry;if(_e==="Point")xt(ye,Be,ke);else if(_e==="MultiPoint")for(let Ie of ye)xt(Ie,Be,ke);else if(_e==="LineString")ke.type=2,Xt(ye,Be,ke);else if(_e==="MultiLineString")ke.type=2,Vt(ye,Be,ke);else if(_e==="Polygon")ke.type=3,Vt(ye,Be,ke,!0);else{if(_e!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ke.type=3;for(let Ie of ye)Vt(Ie,Be,ke,!0)}return ke}function xt([Se,$],Q,de){let _e=t.aj(Se),ye=t.ak($);ye=ye<0?0:ye>1?1:ye,Q.push(_e,ye),de.minX=Math.min(de.minX,_e),de.minY=Math.min(de.minY,ye),de.maxX=Math.max(de.maxX,_e),de.maxY=Math.max(de.maxY,ye)}function Xt(Se,$,Q,de=!1,_e=!1){let ye=[];for(let ke of Se)xt(ke,ye,Q);$.push(ye),de&&function(ke,Be){let Ie=0;for(let Ve=0,ut=ke.length,st=ut-2;Ve<ut;st=Ve,Ve+=2)Ie+=(ke[Ve]-ke[st])*(ke[Ve+1]+ke[st+1]);if(Ie>0===Be)for(let Ve=0,ut=ke.length;Ve<ut/2;Ve+=2){let st=ke[Ve],Lt=ke[Ve+1];ke[Ve]=ke[ut-2-Ve],ke[Ve+1]=ke[ut-1-Ve],ke[ut-2-Ve]=st,ke[ut-1-Ve]=Lt}}(ye,_e)}function Vt(Se,$,Q,de=!1){for(let _e=0;_e<Se.length;_e++)Xt(Se[_e],$,Q,de,_e===0)}function Oi(Se,$,Q,de){let{id:_e,type:ye,geometry:ke,tags:Be}=Se,Ie=[];if(ye===1)Xi(ke,$,Q,de,Ie);else for(let Ve of ke)Ie.push(Xi(Ve,$,Q,de));return{id:_e,type:ye,geometry:Ie,tags:Be}}function Xi(Se,$,Q,de,_e=[]){for(let ye=0;ye<Se.length;ye+=2)_e.push(lr(Se[ye],Se[ye+1],$,Q,de));return _e}function lr(Se,$,Q,de,_e){return[Math.round(t.a3*(Se*Q-de)),Math.round(t.a3*($*Q-_e))]}var Mi={exports:{}},gn=t.d$,sn=t.d_.VectorTileFeature,Hn=Gr;function Gr(Se,$){this.options=$||{},this.features=Se,this.length=Se.length}function Zn(Se,$){this.id=typeof Se.id=="number"?Se.id:void 0,this.type=Se.type,this.rawGeometry=Se.type===1?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=$||4096}Gr.prototype.feature=function(Se){return new Zn(this.features[Se],this.options.extent)},Zn.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var $=0;$<Se.length;$++){for(var Q=Se[$],de=[],_e=0;_e<Q.length;_e++)de.push(new gn(Q[_e][0],Q[_e][1]));this.geometry.push(de)}return this.geometry},Zn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,$=1/0,Q=-1/0,de=1/0,_e=-1/0,ye=0;ye<Se.length;ye++)for(var ke=Se[ye],Be=0;Be<ke.length;Be++){var Ie=ke[Be];$=Math.min($,Ie.x),Q=Math.max(Q,Ie.x),de=Math.min(de,Ie.y),_e=Math.max(_e,Ie.y)}return[$,de,Q,_e]},Zn.prototype.toGeoJSON=sn.prototype.toGeoJSON;var Ri=t.e0,ga=Hn;function Xn(Se){var $=new Ri;return function(Q,de){for(var _e in Q.layers)de.writeMessage(3,Fa,Q.layers[_e])}(Se,$),$.finish()}function Fa(Se,$){var Q;$.writeVarintField(15,Se.version||1),$.writeStringField(1,Se.name||""),$.writeVarintField(5,Se.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(Q=0;Q<Se.length;Q++)de.feature=Se.feature(Q),$.writeMessage(2,Zo,de);var _e=de.keys;for(Q=0;Q<_e.length;Q++)$.writeStringField(3,_e[Q]);var ye=de.values;for(Q=0;Q<ye.length;Q++)$.writeMessage(4,Vu,ye[Q])}function Zo(Se,$){var Q=Se.feature;Q.id!==void 0&&$.writeVarintField(1,Q.id),$.writeMessage(2,La,Se),$.writeVarintField(3,Q.type),$.writeMessage(4,In,Q)}function La(Se,$){var Q=Se.feature,de=Se.keys,_e=Se.values,ye=Se.keycache,ke=Se.valuecache;for(var Be in Q.properties){var Ie=Q.properties[Be],Ve=ye[Be];if(Ie!==null){Ve===void 0&&(de.push(Be),ye[Be]=Ve=de.length-1),$.writeVarint(Ve);var ut=typeof Ie;ut!=="string"&&ut!=="boolean"&&ut!=="number"&&(Ie=JSON.stringify(Ie));var st=ut+":"+Ie,Lt=ke[st];Lt===void 0&&(_e.push(Ie),ke[st]=Lt=_e.length-1),$.writeVarint(Lt)}}}function $t(Se,$){return($<<3)+(7&Se)}function gc(Se){return Se<<1^Se>>31}function In(Se,$){for(var Q=Se.loadGeometry(),de=Se.type,_e=0,ye=0,ke=Q.length,Be=0;Be<ke;Be++){var Ie=Q[Be],Ve=1;de===1&&(Ve=Ie.length),$.writeVarint($t(1,Ve));for(var ut=de===3?Ie.length-1:Ie.length,st=0;st<ut;st++){st===1&&de!==1&&$.writeVarint($t(2,ut-1));var Lt=Ie[st].x-_e,Yt=Ie[st].y-ye;$.writeVarint(gc(Lt)),$.writeVarint(gc(Yt)),_e+=Lt,ye+=Yt}de===3&&$.writeVarint($t(7,1))}}function Vu(Se,$){var Q=typeof Se;Q==="string"?$.writeStringField(1,Se):Q==="boolean"?$.writeBooleanField(7,Se):Q==="number"&&(Se%1!=0?$.writeDoubleField(3,Se):Se<0?$.writeSVarintField(6,Se):$.writeVarintField(5,Se))}Mi.exports=Xn,Mi.exports.fromVectorTileJs=Xn,Mi.exports.fromGeojsonVt=function(Se,$){$=$||{};var Q={};for(var de in Se)Q[de]=new ga(Se[de].features,$),Q[de].name=de,Q[de].version=$.version,Q[de].extent=$.extent;return Xn({layers:Q})},Mi.exports.GeoJSONWrapper=ga;var ju=t.e1(Mi.exports);let Uu={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},rh=Math.fround||(_c=new Float32Array(1),Se=>(_c[0]=+Se,_c[0]));var _c;let _a=3,ya=5,oh=6;class ei{constructor($){this.options=Object.assign(Object.create(Uu),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){let{log:Q,minZoom:de,maxZoom:_e}=this.options;Q&&console.time("total time");let ye=`prepare ${$.length} points`;Q&&console.time(ye),this.points=$;let ke=[];for(let Ie=0;Ie<$.length;Ie++){let Ve=$[Ie];if(!Ve.geometry)continue;let[ut,st]=Ve.geometry.coordinates,Lt=rh(Eo(ut)),Yt=rh(_l(st));ke.push(Lt,Yt,1/0,Ie,-1,1),this.options.reduce&&ke.push(0)}let Be=this.trees[_e+1]=this._createTree(ke);Q&&console.timeEnd(ye);for(let Ie=_e;Ie>=de;Ie--){let Ve=+Date.now();Be=this.trees[Ie]=this._createTree(this._cluster(Be,Ie)),Q&&console.log("z%d: %d clusters in %dms",Ie,Be.numItems,+Date.now()-Ve)}return Q&&console.timeEnd("total time"),this}getClusters($,Q){let de=(($[0]+180)%360+360)%360-180,_e=Math.max(-90,Math.min(90,$[1])),ye=$[2]===180?180:(($[2]+180)%360+360)%360-180,ke=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)de=-180,ye=180;else if(de>ye){let st=this.getClusters([de,_e,180,ke],Q),Lt=this.getClusters([-180,_e,ye,ke],Q);return st.concat(Lt)}let Be=this.trees[this._limitZoom(Q)],Ie=Be.range(Eo(de),_l(ke),Eo(ye),_l(_e)),Ve=Be.data,ut=[];for(let st of Ie){let Lt=this.stride*st;ut.push(Ve[Lt+ya]>1?ri(Ve,Lt,this.clusterProps):this.points[Ve[Lt+_a]])}return ut}getChildren($){let Q=this._getOriginId($),de=this._getOriginZoom($),_e="No cluster with the specified id.",ye=this.trees[de];if(!ye)throw new Error(_e);let ke=ye.data;if(Q*this.stride>=ke.length)throw new Error(_e);let Be=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Ie=ye.within(ke[Q*this.stride],ke[Q*this.stride+1],Be),Ve=[];for(let ut of Ie){let st=ut*this.stride;ke[st+4]===$&&Ve.push(ke[st+ya]>1?ri(ke,st,this.clusterProps):this.points[ke[st+_a]])}if(Ve.length===0)throw new Error(_e);return Ve}getLeaves($,Q,de){let _e=[];return this._appendLeaves(_e,$,Q=Q||10,de=de||0,0),_e}getTile($,Q,de){let _e=this.trees[this._limitZoom($)],ye=Math.pow(2,$),{extent:ke,radius:Be}=this.options,Ie=Be/ke,Ve=(de-Ie)/ye,ut=(de+1+Ie)/ye,st={features:[]};return this._addTileFeatures(_e.range((Q-Ie)/ye,Ve,(Q+1+Ie)/ye,ut),_e.data,Q,de,ye,st),Q===0&&this._addTileFeatures(_e.range(1-Ie/ye,Ve,1,ut),_e.data,ye,de,ye,st),Q===ye-1&&this._addTileFeatures(_e.range(0,Ve,Ie/ye,ut),_e.data,-1,de,ye,st),st.features.length?st:null}getClusterExpansionZoom($){let Q=this._getOriginZoom($)-1;for(;Q<=this.options.maxZoom;){let de=this.getChildren($);if(Q++,de.length!==1)break;$=de[0].properties.cluster_id}return Q}_appendLeaves($,Q,de,_e,ye){let ke=this.getChildren(Q);for(let Be of ke){let Ie=Be.properties;if(Ie&&Ie.cluster?ye+Ie.point_count<=_e?ye+=Ie.point_count:ye=this._appendLeaves($,Ie.cluster_id,de,_e,ye):ye<_e?ye++:$.push(Be),$.length===de)break}return ye}_createTree($){let Q=new t.cK($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<$.length;de+=this.stride)Q.add($[de],$[de+1]);return Q.finish(),Q.data=$,Q}_addTileFeatures($,Q,de,_e,ye,ke){for(let Be of $){let Ie=Be*this.stride,Ve=Q[Ie+ya]>1,ut,st,Lt;if(Ve)ut=yc(Q,Ie,this.clusterProps),st=Q[Ie],Lt=Q[Ie+1];else{let vi=this.points[Q[Ie+_a]];ut=vi.properties;let[li,Fi]=vi.geometry.coordinates;st=Eo(li),Lt=_l(Fi)}let Yt={type:1,geometry:[[Math.round(this.options.extent*(st*ye-de)),Math.round(this.options.extent*(Lt*ye-_e))]],tags:ut},_i;_i=Ve||this.options.generateId?Q[Ie+_a]:this.points[Q[Ie+_a]].id,_i!==void 0&&(Yt.id=_i),ke.features.push(Yt)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,Q){let{radius:de,extent:_e,reduce:ye,minPoints:ke}=this.options,Be=de/(_e*Math.pow(2,Q)),Ie=$.data,Ve=[],ut=this.stride;for(let st=0;st<Ie.length;st+=ut){if(Ie[st+2]<=Q)continue;Ie[st+2]=Q;let Lt=Ie[st],Yt=Ie[st+1],_i=$.within(Ie[st],Ie[st+1],Be),vi=Ie[st+ya],li=vi;for(let Fi of _i){let Ot=Fi*ut;Ie[Ot+2]>Q&&(li+=Ie[Ot+ya])}if(li>vi&&li>=ke){let Fi,Ot=Lt*vi,En=Yt*vi,on=-1,Vi=(st/ut<<5)+(Q+1)+this.points.length;for(let Kn of _i){let Dn=Kn*ut;if(Ie[Dn+2]<=Q)continue;Ie[Dn+2]=Q;let cr=Ie[Dn+ya];Ot+=Ie[Dn]*cr,En+=Ie[Dn+1]*cr,Ie[Dn+4]=Vi,ye&&(Fi||(Fi=this._map(Ie,st,!0),on=this.clusterProps.length,this.clusterProps.push(Fi)),ye(Fi,this._map(Ie,Dn)))}Ie[st+4]=Vi,Ve.push(Ot/li,En/li,1/0,Vi,-1,li),ye&&Ve.push(on)}else{for(let Fi=0;Fi<ut;Fi++)Ve.push(Ie[st+Fi]);if(li>1)for(let Fi of _i){let Ot=Fi*ut;if(!(Ie[Ot+2]<=Q)){Ie[Ot+2]=Q;for(let En=0;En<ut;En++)Ve.push(Ie[Ot+En])}}}}return Ve}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,Q,de){if($[Q+ya]>1){let ke=this.clusterProps[$[Q+oh]];return de?Object.assign({},ke):ke}let _e=this.points[$[Q+_a]].properties,ye=this.options.map(_e);return de&&ye===_e?Object.assign({},ye):ye}}function ri(Se,$,Q){return{type:"Feature",id:Se[$+_a],properties:yc(Se,$,Q),geometry:{type:"Point",coordinates:[(de=Se[$],360*(de-.5)),bc(Se[$+1])]}};var de}function yc(Se,$,Q){let de=Se[$+ya],_e=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,ye=Se[$+oh],ke=ye===-1?{}:Object.assign({},Q[ye]);return Object.assign(ke,{cluster:!0,cluster_id:Se[$+_a],point_count:de,point_count_abbreviated:_e})}function Eo(Se){return Se/360+.5}function _l(Se){let $=Math.sin(Se*Math.PI/180),Q=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return Q<0?0:Q>1?1:Q}function bc(Se){let $=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function vc(Se,$,Q,de){let _e=de,ye=$+(Q-$>>1),ke,Be=Q-$,Ie=Se[$],Ve=Se[$+1],ut=Se[Q],st=Se[Q+1];for(let Lt=$+3;Lt<Q;Lt+=3){let Yt=ah(Se[Lt],Se[Lt+1],Ie,Ve,ut,st);if(Yt>_e)ke=Lt,_e=Yt;else if(Yt===_e){let _i=Math.abs(Lt-ye);_i<Be&&(ke=Lt,Be=_i)}}_e>de&&(ke-$>3&&vc(Se,$,ke,de),Se[ke+2]=_e,Q-ke>3&&vc(Se,ke,Q,de))}function ah(Se,$,Q,de,_e,ye){let ke=_e-Q,Be=ye-de;if(ke!==0||Be!==0){let Ie=((Se-Q)*ke+($-de)*Be)/(ke*ke+Be*Be);Ie>1?(Q=_e,de=ye):Ie>0&&(Q+=ke*Ie,de+=Be*Ie)}return ke=Se-Q,Be=$-de,ke*ke+Be*Be}function Os(Se,$,Q,de){let _e={id:Se??null,type:$,geometry:Q,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if($==="Point"||$==="MultiPoint"||$==="LineString")yl(_e,Q);else if($==="Polygon")yl(_e,Q[0]);else if($==="MultiLineString")for(let ye of Q)yl(_e,ye);else if($==="MultiPolygon")for(let ye of Q)yl(_e,ye[0]);return _e}function yl(Se,$){for(let Q=0;Q<$.length;Q+=3)Se.minX=Math.min(Se.minX,$[Q]),Se.minY=Math.min(Se.minY,$[Q+1]),Se.maxX=Math.max(Se.maxX,$[Q]),Se.maxY=Math.max(Se.maxY,$[Q+1])}function xc(Se,$,Q,de){if(!$.geometry)return;let _e=$.geometry.coordinates;if(_e&&_e.length===0)return;let ye=$.geometry.type,ke=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2),Be=[],Ie=$.id;if(Q.promoteId?Ie=$.properties[Q.promoteId]:Q.generateId&&(Ie=de||0),ye==="Point")sh(_e,Be);else if(ye==="MultiPoint")for(let Ve of _e)sh(Ve,Be);else if(ye==="LineString")wc(_e,Be,ke,!1);else if(ye==="MultiLineString"){if(Q.lineMetrics){for(let Ve of _e)Be=[],wc(Ve,Be,ke,!1),Se.push(Os(Ie,"LineString",Be,$.properties));return}Cc(_e,Be,ke,!1)}else if(ye==="Polygon")Cc(_e,Be,ke,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(let Ve of $.geometry.geometries)xc(Se,{id:Ie,geometry:Ve,properties:$.properties},Q,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Ve of _e){let ut=[];Cc(Ve,ut,ke,!0),Be.push(ut)}}Se.push(Os(Ie,ye,Be,$.properties))}function sh(Se,$){$.push(Xo(Se[0]),Hu(Se[1]),0)}function wc(Se,$,Q,de){let _e,ye,ke=0;for(let Ie=0;Ie<Se.length;Ie++){let Ve=Xo(Se[Ie][0]),ut=Hu(Se[Ie][1]);$.push(Ve,ut,0),Ie>0&&(ke+=de?(_e*ut-Ve*ye)/2:Math.sqrt(Math.pow(Ve-_e,2)+Math.pow(ut-ye,2))),_e=Ve,ye=ut}let Be=$.length-3;$[2]=1,vc($,0,Be,Q),$[Be+2]=1,$.size=Math.abs(ke),$.start=0,$.end=$.size}function Cc(Se,$,Q,de){for(let _e=0;_e<Se.length;_e++){let ye=[];wc(Se[_e],ye,Q,de),$.push(ye)}}function Xo(Se){return Se/360+.5}function Hu(Se){let $=Math.sin(Se*Math.PI/180),Q=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return Q<0?0:Q>1?1:Q}function oi(Se,$,Q,de,_e,ye,ke,Be){if(de/=$,ye>=(Q/=$)&&ke<de)return Se;if(ke<Q||ye>=de)return null;let Ie=[];for(let Ve of Se){let ut=Ve.geometry,st=Ve.type,Lt=_e===0?Ve.minX:Ve.minY,Yt=_e===0?Ve.maxX:Ve.maxY;if(Lt>=Q&&Yt<de){Ie.push(Ve);continue}if(Yt<Q||Lt>=de)continue;let _i=[];if(st==="Point"||st==="MultiPoint")lh(ut,_i,Q,de,_e);else if(st==="LineString")Wn(ut,_i,Q,de,_e,!1,Be.lineMetrics);else if(st==="MultiLineString")bl(ut,_i,Q,de,_e,!1);else if(st==="Polygon")bl(ut,_i,Q,de,_e,!0);else if(st==="MultiPolygon")for(let vi of ut){let li=[];bl(vi,li,Q,de,_e,!0),li.length&&_i.push(li)}if(_i.length){if(Be.lineMetrics&&st==="LineString"){for(let vi of _i)Ie.push(Os(Ve.id,st,vi,Ve.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(_i.length===1?(st="LineString",_i=_i[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=_i.length===3?"Point":"MultiPoint"),Ie.push(Os(Ve.id,st,_i,Ve.tags))}}return Ie.length?Ie:null}function lh(Se,$,Q,de,_e){for(let ye=0;ye<Se.length;ye+=3){let ke=Se[ye+_e];ke>=Q&&ke<=de&&za($,Se[ye],Se[ye+1],Se[ye+2])}}function Wn(Se,$,Q,de,_e,ye,ke){let Be=Sc(Se),Ie=_e===0?Ba:ch,Ve,ut,st=Se.start;for(let li=0;li<Se.length-3;li+=3){let Fi=Se[li],Ot=Se[li+1],En=Se[li+2],on=Se[li+3],Vi=Se[li+4],Kn=_e===0?Fi:Ot,Dn=_e===0?on:Vi,cr=!1;ke&&(Ve=Math.sqrt(Math.pow(Fi-on,2)+Math.pow(Ot-Vi,2))),Kn<Q?Dn>Q&&(ut=Ie(Be,Fi,Ot,on,Vi,Q),ke&&(Be.start=st+Ve*ut)):Kn>de?Dn<de&&(ut=Ie(Be,Fi,Ot,on,Vi,de),ke&&(Be.start=st+Ve*ut)):za(Be,Fi,Ot,En),Dn<Q&&Kn>=Q&&(ut=Ie(Be,Fi,Ot,on,Vi,Q),cr=!0),Dn>de&&Kn<=de&&(ut=Ie(Be,Fi,Ot,on,Vi,de),cr=!0),!ye&&cr&&(ke&&(Be.end=st+Ve*ut),$.push(Be),Be=Sc(Se)),ke&&(st+=Ve)}let Lt=Se.length-3,Yt=Se[Lt],_i=Se[Lt+1],vi=_e===0?Yt:_i;vi>=Q&&vi<=de&&za(Be,Yt,_i,Se[Lt+2]),Lt=Be.length-3,ye&&Lt>=3&&(Be[Lt]!==Be[0]||Be[Lt+1]!==Be[1])&&za(Be,Be[0],Be[1],Be[2]),Be.length&&$.push(Be)}function Sc(Se){let $=[];return $.size=Se.size,$.start=Se.start,$.end=Se.end,$}function bl(Se,$,Q,de,_e,ye){for(let ke of Se)Wn(ke,$,Q,de,_e,ye,!1)}function za(Se,$,Q,de){Se.push($,Q,de)}function Ba(Se,$,Q,de,_e,ye){let ke=(ye-$)/(de-$);return za(Se,ye,Q+(_e-Q)*ke,1),ke}function ch(Se,$,Q,de,_e,ye){let ke=(ye-Q)/(_e-Q);return za(Se,$+(de-$)*ke,ye,1),ke}function Rs(Se,$){let Q=[];for(let de=0;de<Se.length;de++){let _e=Se[de],ye=_e.type,ke;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")ke=Fs(_e.geometry,$);else if(ye==="MultiLineString"||ye==="Polygon"){ke=[];for(let Be of _e.geometry)ke.push(Fs(Be,$))}else if(ye==="MultiPolygon"){ke=[];for(let Be of _e.geometry){let Ie=[];for(let Ve of Be)Ie.push(Fs(Ve,$));ke.push(Ie)}}Q.push(Os(_e.id,ye,ke,_e.tags))}return Q}function Fs(Se,$){let Q=[];Q.size=Se.size,Se.start!==void 0&&(Q.start=Se.start,Q.end=Se.end);for(let de=0;de<Se.length;de+=3)Q.push(Se[de]+$,Se[de+1],Se[de+2]);return Q}function Mc(Se,$){if(Se.transformed)return Se;let Q=1<<Se.z,de=Se.x,_e=Se.y;for(let ye of Se.features){let ke=ye.geometry,Be=ye.type;if(ye.geometry=[],Be===1)for(let Ie=0;Ie<ke.length;Ie+=2)ye.geometry.push(Tc(ke[Ie],ke[Ie+1],$,Q,de,_e));else for(let Ie=0;Ie<ke.length;Ie++){let Ve=[];for(let ut=0;ut<ke[Ie].length;ut+=2)Ve.push(Tc(ke[Ie][ut],ke[Ie][ut+1],$,Q,de,_e));ye.geometry.push(Ve)}}return Se.transformed=!0,Se}function Tc(Se,$,Q,de,_e,ye){return[Math.round(Q*(Se*de-_e)),Math.round(Q*($*de-ye))]}function Wu(Se,$,Q,de,_e){let ye=$===_e.maxZoom?0:_e.tolerance/((1<<$)*_e.extent),ke={features:[],numPoints:0,numSimplified:0,numFeatures:Se.length,source:null,x:Q,y:de,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Be of Se)Ic(ke,Be,ye,_e);return ke}function Ic(Se,$,Q,de){let _e=$.geometry,ye=$.type,ke=[];if(Se.minX=Math.min(Se.minX,$.minX),Se.minY=Math.min(Se.minY,$.minY),Se.maxX=Math.max(Se.maxX,$.maxX),Se.maxY=Math.max(Se.maxY,$.maxY),ye==="Point"||ye==="MultiPoint")for(let Be=0;Be<_e.length;Be+=3)ke.push(_e[Be],_e[Be+1]),Se.numPoints++,Se.numSimplified++;else if(ye==="LineString")Ko(ke,_e,Se,Q,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let Be=0;Be<_e.length;Be++)Ko(ke,_e[Be],Se,Q,ye==="Polygon",Be===0);else if(ye==="MultiPolygon")for(let Be=0;Be<_e.length;Be++){let Ie=_e[Be];for(let Ve=0;Ve<Ie.length;Ve++)Ko(ke,Ie[Ve],Se,Q,!0,Ve===0)}if(ke.length){let Be=$.tags||null;if(ye==="LineString"&&de.lineMetrics){Be={};for(let Ve in $.tags)Be[Ve]=$.tags[Ve];Be.mapbox_clip_start=_e.start/_e.size,Be.mapbox_clip_end=_e.end/_e.size}let Ie={geometry:ke,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Be};$.id!==null&&(Ie.id=$.id),Se.features.push(Ie)}}function Ko(Se,$,Q,de,_e,ye){let ke=de*de;if(de>0&&$.size<(_e?ke:de))return void(Q.numPoints+=$.length/3);let Be=[];for(let Ie=0;Ie<$.length;Ie+=3)(de===0||$[Ie+2]>ke)&&(Q.numSimplified++,Be.push($[Ie],$[Ie+1])),Q.numPoints++;_e&&function(Ie,Ve){let ut=0;for(let st=0,Lt=Ie.length,Yt=Lt-2;st<Lt;Yt=st,st+=2)ut+=(Ie[st]-Ie[Yt])*(Ie[st+1]+Ie[Yt+1]);if(ut>0===Ve)for(let st=0,Lt=Ie.length;st<Lt/2;st+=2){let Yt=Ie[st],_i=Ie[st+1];Ie[st]=Ie[Lt-2-st],Ie[st+1]=Ie[Lt-1-st],Ie[Lt-2-st]=Yt,Ie[Lt-1-st]=_i}}(Be,ye),Se.push(Be)}let Ls={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Qo{constructor($,Q){let de=(Q=this.options=function(ye,ke){for(let Be in ke)ye[Be]=ke[Be];return ye}(Object.create(Ls),Q)).debug;if(de&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let _e=function(ye,ke){let Be=[];if(ye.type==="FeatureCollection")for(let Ie=0;Ie<ye.features.length;Ie++)xc(Be,ye.features[Ie],ke,Ie);else xc(Be,ye.type==="Feature"?ye:{geometry:ye},ke);return Be}($,Q);this.tiles={},this.tileCoords=[],de&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),_e=function(ye,ke){let Be=ke.buffer/ke.extent,Ie=ye,Ve=oi(ye,1,-1-Be,Be,0,-1,2,ke),ut=oi(ye,1,1-Be,2+Be,0,-1,2,ke);return(Ve||ut)&&(Ie=oi(ye,1,-Be,1+Be,0,-1,2,ke)||[],Ve&&(Ie=Rs(Ve,1).concat(Ie)),ut&&(Ie=Ie.concat(Rs(ut,-1)))),Ie}(_e,Q),_e.length&&this.splitTile(_e,0,0,0),de&&(_e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile($,Q,de,_e,ye,ke,Be){let Ie=[$,Q,de,_e],Ve=this.options,ut=Ve.debug;for(;Ie.length;){_e=Ie.pop(),de=Ie.pop(),Q=Ie.pop(),$=Ie.pop();let st=1<<Q,Lt=Pr(Q,de,_e),Yt=this.tiles[Lt];if(!Yt&&(ut>1&&console.time("creation"),Yt=this.tiles[Lt]=Wu($,Q,de,_e,Ve),this.tileCoords.push({z:Q,x:de,y:_e}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,de,_e,Yt.numFeatures,Yt.numPoints,Yt.numSimplified),console.timeEnd("creation"));let cr=`z${Q}`;this.stats[cr]=(this.stats[cr]||0)+1,this.total++}if(Yt.source=$,ye==null){if(Q===Ve.indexMaxZoom||Yt.numPoints<=Ve.indexMaxPoints)continue}else{if(Q===Ve.maxZoom||Q===ye)continue;if(ye!=null){let cr=ye-Q;if(de!==ke>>cr||_e!==Be>>cr)continue}}if(Yt.source=null,$.length===0)continue;ut>1&&console.time("clipping");let _i=.5*Ve.buffer/Ve.extent,vi=.5-_i,li=.5+_i,Fi=1+_i,Ot=null,En=null,on=null,Vi=null,Kn=oi($,st,de-_i,de+li,0,Yt.minX,Yt.maxX,Ve),Dn=oi($,st,de+vi,de+Fi,0,Yt.minX,Yt.maxX,Ve);$=null,Kn&&(Ot=oi(Kn,st,_e-_i,_e+li,1,Yt.minY,Yt.maxY,Ve),En=oi(Kn,st,_e+vi,_e+Fi,1,Yt.minY,Yt.maxY,Ve),Kn=null),Dn&&(on=oi(Dn,st,_e-_i,_e+li,1,Yt.minY,Yt.maxY,Ve),Vi=oi(Dn,st,_e+vi,_e+Fi,1,Yt.minY,Yt.maxY,Ve),Dn=null),ut>1&&console.timeEnd("clipping"),Ie.push(Ot||[],Q+1,2*de,2*_e),Ie.push(En||[],Q+1,2*de,2*_e+1),Ie.push(on||[],Q+1,2*de+1,2*_e),Ie.push(Vi||[],Q+1,2*de+1,2*_e+1)}}getTile($,Q,de){$=+$,Q=+Q,de=+de;let _e=this.options,{extent:ye,debug:ke}=_e;if($<0||$>24)return null;let Be=1<<$,Ie=Pr($,Q=Q+Be&Be-1,de);if(this.tiles[Ie])return Mc(this.tiles[Ie],ye);ke>1&&console.log("drilling down to z%d-%d-%d",$,Q,de);let Ve,ut=$,st=Q,Lt=de;for(;!Ve&&ut>0;)ut--,st>>=1,Lt>>=1,Ve=this.tiles[Pr(ut,st,Lt)];return Ve&&Ve.source?(ke>1&&(console.log("found parent tile z%d-%d-%d",ut,st,Lt),console.time("drilling down")),this.splitTile(Ve.source,ut,st,Lt,$,Q,de),ke>1&&console.timeEnd("drilling down"),this.tiles[Ie]?Mc(this.tiles[Ie],ye):null):null}}function Pr(Se,$,Q){return 32*((1<<Se)*Q+$)+Se}function Gu(Se,$){let Q=Se.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);let de=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!de)return $(null,null);let _e=new dt(de.features),ye=ju(_e);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),$(null,{vectorTile:_e,rawData:ye.buffer})}class vl extends be{constructor($,Q,de,_e,ye,ke){super($,Q,de,_e,Gu,ke),ye&&(this.loadGeoJSON=ye),this._dynamicIndex=new ft}loadData($,Q){let de=$&&$.request,_e=de&&de.collectResourceTiming;this.loadGeoJSON($,(ye,ke)=>{if(ye||!ke)return Q(ye);if(typeof ke!="object")return Q(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{try{if($.filter){let Ie=t.y($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(Ve=>`${Ve.key}: ${Ve.message}`).join(", "));ke.features=ke.features.filter(Ve=>Ie.value.evaluate({zoom:0},Ve))}$.dynamic?(ke.type==="Feature"&&(ke={type:"FeatureCollection",features:[ke]}),$.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ke.features,this.loaded),$.cluster&&(ke.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=$.cluster?new ei(function({superclusterOptions:Ie,clusterProperties:Ve}){if(!Ve||!Ie)return Ie;let ut={},st={},Lt={accumulated:null,zoom:0},Yt={properties:null},_i=Object.keys(Ve);for(let vi of _i){let[li,Fi]=Ve[vi],Ot=t.y(Fi),En=t.y(typeof li=="string"?[li,["accumulated"],["get",vi]]:li);ut[vi]=Ot.value,st[vi]=En.value}return Ie.map=vi=>{Yt.properties=vi;let li={};for(let Fi of _i)li[Fi]=ut[Fi].evaluate(Lt,Yt);return li},Ie.reduce=(vi,li)=>{Yt.properties=li;for(let Fi of _i)Lt.accumulated=vi[Fi],vi[Fi]=st[Fi].evaluate(Lt,Yt)},Ie}($)).load(ke.features):$.dynamic?this._dynamicIndex:function(Ie,Ve){return new Qo(Ie,Ve)}(ke,$.geojsonVtOptions)}catch(Ie){return Q(Ie)}let Be={};if(_e){let Ie=g(de);Ie&&(Be.resourceTiming={},Be.resourceTiming[$.source]=JSON.parse(JSON.stringify(Ie)))}Q(null,Be)}})}reloadTile($,Q){let de=this.loaded;return de&&de[$.uid]?$.partial?Q(null,void 0):super.reloadTile($,Q):this.loadTile($,Q)}loadGeoJSON($,Q){if($.request)t.g($.request,Q);else{if(typeof $.data!="string")return Q(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return Q(null,JSON.parse($.data))}catch{return Q(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,Q){try{Q(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(de){Q(de)}}getClusterChildren($,Q){try{Q(null,this._geoJSONIndex.getChildren($.clusterId))}catch(de){Q(de)}}getClusterLeaves($,Q){try{Q(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(de){Q(de)}}}class Ec{constructor($,Q){this.tileID=new t.aL($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=$.projection,this.brightness=Q}parse($,Q,de,_e){this.status="parsing";let ye=new t.aL(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),ke={},Be=Q.familiesBySource[de.source],Ie=new t.dN(ye,de.promoteId);return Ie.bucketLayerIDs=[],Ie.is3DTile=!0,t.e3($).then(Ve=>{if(!Ve)return _e(new Error("Could not parse tile"));let ut=t.e4(Ve,1/t.b5(de.tileID.canonical)),st=Ve.json.extensionsUsed&&Ve.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ve.json.asset.extras&&Ve.json.asset.extras.MAPBOX_mesh_features,Lt=Ve.json.extensionsUsed&&Ve.json.extensionsUsed.includes("EXT_meshopt_compression"),Yt=new t.X(this.zoom,{brightness:this.brightness});for(let _i in Be)for(let vi of Be[_i]){let li=vi[0];Ie.bucketLayerIDs.push(vi.map(Ot=>Ot.id)),li.recalculate(Yt,[]);let Fi=new t.e5(ut,ye,st,Lt,this.brightness,Ie);st||(Fi.needsUpload=!0),ke[li.fqid]=Fi,Fi.evaluate(li)}this.status="done",_e(null,{buckets:ke,featureIndex:Ie})}).catch(Ve=>_e(new Error(Ve.message)))}}class dh{constructor($,Q,de,_e,ye,ke){this.actor=$,this.layerIndex=Q,this.brightness=ke,this.loading={},this.loaded={}}loadTile($,Q){let de=$.uid,_e=this.loading[de]=new Ec($,this.brightness);t.e2($.request,(ye,ke)=>{let Be=!this.loading[de];return delete this.loading[de],Be||ye?(_e.status="done",Be||(this.loaded[de]=_e),Q(ye)):ke&&ke.byteLength!==0?void _e.parse(ke,this.layerIndex,$,(Ie,Ve)=>{_e.status="done",this.loaded=this.loaded||{},this.loaded[de]=_e,Ie||!Ve?Q(Ie):Q(null,Ve)}):(_e.status="done",this.loaded[de]=_e,Q())})}reloadTile($,Q){let de=this.loaded,_e=$.uid;if(de&&de[_e]){let ye=de[_e];ye.projection=$.projection,ye.brightness=$.brightness;let ke=(Be,Ie)=>{ye.reloadCallback&&(delete ye.reloadCallback,this.loadTile($,Q)),Q(Be,Ie)};ye.status==="parsing"?ye.reloadCallback=ke:ye.status==="done"&&this.loadTile($,Q)}}abortTile($,Q){let de=$.uid;this.loading[de]&&delete this.loading[de],Q()}removeTile($,Q){let de=this.loaded,_e=$.uid;de&&de[_e]&&delete de[_e],Q()}}class Dc{constructor($){this.self=$,this.actor=new t.e6($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.aJ({name:"mercator"}),this.workerSourceTypes={vector:be,geojson:vl,"batched-model":dh},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Q,de)=>{if(this.workerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.workerSourceTypes[Q]=de},this.self.registerRTLTextPlugin=Q=>{if(t.e7.isParsed())throw new Error("RTL text plugin already registered.");t.e7.applyArabicShaping=Q.applyArabicShaping,t.e7.processBidirectionalText=Q.processBidirectionalText,t.e7.processStyledBidirectionalText=Q.processStyledBidirectionalText}}clearCaches($,Q,de){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],delete this.rasterArrayWorkerSource,de()}checkIfReady($,Q,de){de()}setReferrer($,Q){this.referrer=Q}spriteLoaded($,{scope:Q,isLoaded:de}){if(this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.isSpriteLoaded[$][Q]=de,this.workerSources[$]&&this.workerSources[$][Q])for(let _e in this.workerSources[$][Q]){let ye=this.workerSources[$][Q][_e];for(let ke in ye){let Be=ye[ke];Be instanceof be&&(Be.isSpriteLoaded=de,Be.fire(new t.f("isSpriteLoaded")))}}}setImages($,{scope:Q,images:de},_e){if(this.availableImages[$]||(this.availableImages[$]={}),this.availableImages[$][Q]=de,this.workerSources[$]&&this.workerSources[$][Q]){for(let ye in this.workerSources[$][Q]){let ke=this.workerSources[$][Q][ye];for(let Be in ke)ke[Be].availableImages=de}_e()}else _e()}setProjection($,Q){this.projections[$]=t.aJ(Q)}setBrightness($,Q,de){this.brightness=Q,de()}setLayers($,Q,de){this.getLayerIndex($,Q.scope).replace(Q.layers,Q.options),de()}updateLayers($,Q,de){this.getLayerIndex($,Q.scope).update(Q.layers,Q.removedIds,Q.options),de()}loadTile($,Q,de){Q.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,Q.type,Q.source,Q.scope).loadTile(Q,de)}loadDEMTile($,Q,de){this.getDEMWorkerSource($,Q.source,Q.scope).loadTile(Q,de)}decodeRasterArray($,Q,de){this.getRasterArrayWorkerSource().decodeRasterArray(Q,de)}reloadTile($,Q,de){Q.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,Q.type,Q.source,Q.scope).reloadTile(Q,de)}abortTile($,Q,de){this.getWorkerSource($,Q.type,Q.source,Q.scope).abortTile(Q,de)}removeTile($,Q,de){this.getWorkerSource($,Q.type,Q.source,Q.scope).removeTile(Q,de)}removeSource($,Q,de){if(!(this.workerSources[$]&&this.workerSources[$][Q.scope]&&this.workerSources[$][Q.scope][Q.type]&&this.workerSources[$][Q.scope][Q.type][Q.source]))return;let _e=this.workerSources[$][Q.scope][Q.type][Q.source];delete this.workerSources[$][Q.scope][Q.type][Q.source],_e.removeSource!==void 0?_e.removeSource(Q,de):de()}loadWorkerSource($,Q,de){try{this.self.importScripts(Q.url),de()}catch(_e){de(_e.toString())}}syncRTLPluginState($,Q,de){try{t.e7.setState(Q);let _e=t.e7.getPluginURL();if(t.e7.isLoaded()&&!t.e7.isParsed()&&_e!=null){this.self.importScripts(_e);let ye=t.e7.isParsed();de(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${_e}`),ye)}}catch(_e){de(_e.toString())}}setDracoUrl($,Q){this.dracoUrl=Q}getAvailableImages($,Q){this.availableImages[$]||(this.availableImages[$]={});let de=this.availableImages[$][Q];return de||(de=[]),de}getLayerIndex($,Q){this.layerIndexes[$]||(this.layerIndexes[$]={});let de=this.layerIndexes[$][Q];return de||(de=this.layerIndexes[$][Q]=new k,de.scope=Q),de}getWorkerSource($,Q,de,_e){return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][_e]||(this.workerSources[$][_e]={}),this.workerSources[$][_e][Q]||(this.workerSources[$][_e][Q]={}),this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.workerSources[$][_e][Q][de]||(this.workerSources[$][_e][Q][de]=new this.workerSourceTypes[Q]({send:(ye,ke,Be,Ie,Ve,ut)=>{this.actor.send(ye,ke,Be,$,Ve,ut)},scheduler:this.actor.scheduler},this.getLayerIndex($,_e),this.getAvailableImages($,_e),this.isSpriteLoaded[$][_e],void 0,this.brightness)),this.workerSources[$][_e][Q][de]}getDEMWorkerSource($,Q,de){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][de]||(this.demWorkerSources[$][de]={}),this.demWorkerSources[$][de][Q]||(this.demWorkerSources[$][de][Q]=new Me),this.demWorkerSources[$][de][Q]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Te),this.rasterArrayWorkerSource}enforceCacheSizeLimit($,Q){t.e8(Q)}getWorkerPerformanceMetrics($,Q,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Dc(self)),Dc}),r(["./shared"],function(t){function g(f,l){if(Array.isArray(f)){if(!Array.isArray(l)||f.length!==l.length)return!1;for(let u=0;u<f.length;u++)if(!g(f[u],l[u]))return!1;return!0}if(typeof f=="object"&&f!==null&&l!==null){if(typeof l!="object"||Object.keys(f).length!==Object.keys(l).length)return!1;for(let u in f)if(!g(f[u],l[u]))return!1;return!0}return f===l}var b=M;function M(f){return!function(l){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,w=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(w);try{x=new Worker(S),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(S),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===_.width}()?(k[u=l&&l.failIfMajorPerformanceCaveat]===void 0&&(k[u]=function(_){var x,w=function(S){var I=document.createElement("canvas"),A=Object.create(M.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=S,I.getContext("webgl2",A)}(_);if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),w.getShaderParameter(x,w.COMPILE_STATUS)===!0)}(u)),k[u]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var u}(f)}var k={};function L(f,l,u){let _=document.createElement(f);return l!=null&&(_.className=l),u&&u.appendChild(_),_}function G(f,l,u){let _=document.createElementNS("http://www.w3.org/2000/svg",f);for(let x of Object.keys(l))_.setAttributeNS(null,x,String(l[x]));return u&&u.appendChild(_),_}M.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let J=typeof document<"u"?document.documentElement&&document.documentElement.style:null,oe=J&&J.userSelect!==void 0?"userSelect":"WebkitUserSelect",be;function Me(){J&&oe&&(be=J[oe],J[oe]="none")}function Te(){J&&oe&&(J[oe]=be)}function He(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",He,!0)}function We(){window.addEventListener("click",He,!0),window.setTimeout(()=>{window.removeEventListener("click",He,!0)},0)}function dt(f,l){let u=f.getBoundingClientRect();return It(f,u,l)}function bt(f,l){let u=f.getBoundingClientRect(),_=[];for(let x=0;x<l.length;x++)_.push(It(f,u,l[x]));return _}function ft(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function It(f,l,u){let _=f.offsetWidth===l.width?1:f.offsetWidth/l.width;return new t.P((u.clientX-l.left)*_,(u.clientY-l.top)*_)}class Wt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,u){this._updatedSourceCaches[l]=u,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){let u=l.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(l.id),this.setDirty()}removeLayer(l){let u=l.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][l.id]=l,this._updatedLayers[u].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){let l={};for(let u in this._updatedLayers)l[u]=l[u]||{},l[u].updatedIds=Array.from(this._updatedLayers[u].values());for(let u in this._removedLayers)l[u]=l[u]||{},l[u].removedIds=Object.keys(this._removedLayers[u]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(l){this._updatedImages.add(l),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let xt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xt{constructor(l,u,_,x,w,S){this.length=u.length,this.attributes=_,this.itemSize=u.bytesPerElement,this.dynamicDraw=x,this.instanceCount=S,this.context=l;let I=l.gl;this.buffer=I.createBuffer(),l.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||w||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){let u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,u){for(let _=0;_<this.attributes.length;_++){let x=u.attributes[this.attributes[_].name];x!==void 0&&l.enableVertexAttribArray(x)}}setVertexAttribPointers(l,u,_){for(let x=0;x<this.attributes.length;x++){let w=this.attributes[x],S=u.attributes[w.name];S!==void 0&&l.vertexAttribPointer(S,w.components,l[xt[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(l,u,_){for(let x=0;x<this.attributes.length;x++){let w=u.attributes[this.attributes[x].name];w!==void 0&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(w,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Vt{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Oi extends Vt{getDefault(){return t.C.transparent}set(l){let u=this.current;(l.r!==u.r||l.g!==u.g||l.b!==u.b||l.a!==u.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Xi extends Vt{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class lr extends Vt{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Mi extends Vt{getDefault(){return[!0,!0,!0,!0]}set(l){let u=this.current;(l[0]!==u[0]||l[1]!==u[1]||l[2]!==u[2]||l[3]!==u[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class gn extends Vt{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class sn extends Vt{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Hn extends Vt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){let u=this.current;(l.func!==u.func||l.ref!==u.ref||l.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Gr extends Vt{getDefault(){let l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){let u=this.current;(l[0]!==u[0]||l[1]!==u[1]||l[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Zn extends Vt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let u=this.gl;l?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=l,this.dirty=!1}}class Ri extends Vt{getDefault(){return[0,1]}set(l){let u=this.current;(l[0]!==u[0]||l[1]!==u[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class ga extends Vt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let u=this.gl;l?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=l,this.dirty=!1}}class Xn extends Vt{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Fa extends Vt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let u=this.gl;l?u.enable(u.BLEND):u.disable(u.BLEND),this.current=l,this.dirty=!1}}class Zo extends Vt{getDefault(){let l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){let u=this.current;(l[0]!==u[0]||l[1]!==u[1]||l[2]!==u[2]||l[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class La extends Vt{getDefault(){return t.C.transparent}set(l){let u=this.current;(l.r!==u.r||l.g!==u.g||l.b!==u.b||l.a!==u.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class $t extends Vt{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class gc extends Vt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let u=this.gl;l?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=l,this.dirty=!1}}class In extends Vt{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Vu extends Vt{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let ju=class extends Vt{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Uu extends Vt{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class rh extends Vt{getDefault(){let l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){let u=this.current;(l[0]!==u[0]||l[1]!==u[1]||l[2]!==u[2]||l[3]!==u[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class _c extends Vt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;let u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class _a extends Vt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;let u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class ya extends Vt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;let u=this.gl;u.bindTexture(u.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class oh extends Vt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;let u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ei extends Vt{getDefault(){return null}set(l){let u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ri extends Vt{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class yc extends Vt{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Eo extends Vt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class _l extends Vt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class bc extends Vt{constructor(l,u){super(l),this.context=l,this.parent=u}getDefault(){return null}}class vc extends bc{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class ah extends bc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Os extends bc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class yl extends ah{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class xc{constructor(l,u,_,x,w){this.context=l,this.width=u,this.height=_;let S=this.framebuffer=l.gl.createFramebuffer();x&&(this.colorAttachment=new vc(l,S)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new ah(l,S):new Os(l,S))}destroy(){let l=this.context.gl;if(this.colorAttachment){let u=this.colorAttachment.get();u&&l.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let u=this.depthAttachment.get();u&&l.deleteRenderbuffer(u)}else{let u=this.depthAttachment.get();u&&l.deleteTexture(u)}l.deleteFramebuffer(this.framebuffer)}}class sh{constructor(l,u){this.gl=l,this.clearColor=new Oi(this),this.clearDepth=new Xi(this),this.clearStencil=new lr(this),this.colorMask=new Mi(this),this.depthMask=new gn(this),this.stencilMask=new sn(this),this.stencilFunc=new Hn(this),this.stencilOp=new Gr(this),this.stencilTest=new Zn(this),this.depthRange=new Ri(this),this.depthTest=new ga(this),this.depthFunc=new Xn(this),this.blend=new Fa(this),this.blendFunc=new Zo(this),this.blendColor=new La(this),this.blendEquation=new $t(this),this.cullFace=new gc(this),this.cullFaceSide=new In(this),this.frontFace=new Vu(this),this.program=new ju(this),this.activeTexture=new Uu(this),this.viewport=new rh(this),this.bindFramebuffer=new _c(this),this.bindRenderbuffer=new _a(this),this.bindTexture=new ya(this),this.bindVertexBuffer=new oh(this),this.bindElementBuffer=new ei(this),this.bindVertexArrayOES=new ri(this),this.pixelStoreUnpack=new yc(this),this.pixelStoreUnpackPremultiplyAlpha=new Eo(this),this.pixelStoreUnpackFlipY=new _l(this),this.options=u?kt({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),this.maxPointSize=l.getParameter(l.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,u,_){return new t.I(this,l,u,_)}createVertexBuffer(l,u,_,x,w){return new Xt(this,l,u,_,x,w)}createRenderbuffer(l,u,_){let x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,l,u,_),this.bindRenderbuffer.set(null),w}createFramebuffer(l,u,_,x){return new xc(this,l,u,_,x)}clear({color:l,depth:u,stencil:_,colorMask:x}){let w=this.gl,S=0;l&&(S|=w.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set(x||[!0,!0,!0,!0])),u!==void 0&&(S|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),_!==void 0&&(S|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),w.clear(S)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){g(l.blendFunction,t.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class wc{constructor(l){this._gl=l.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let l=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,l}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class Cc{constructor(l){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,l.registerParameter(this,["Symbols"],"useOcclusionQueries"),l.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),l.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),l.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),l.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),l.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class Xo{constructor(l,u,_,x){let w={width:_[0],height:_[1],data:null},S=l.gl;this.targetColorTexture=new t.T(l,w,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new t.T(l,w,S.RGBA,{useMipmap:!1}),this.context=l,this.updateParticleTexture(u,x),this.lastInvalidatedAt=0}updateParticleTexture(l,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let _=this.context.gl,x=u.width*u.height;this.particleTexture0=new t.T(this.context,u,_.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new t.T(this.context,u,_.RGBA,{premultiply:!1,useMipmap:!1});let w=new t.S;w.reserve(x);for(let S=0;S<x;S++)w.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(w,t.p.members,!0),this.particleSegment=t.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(l){return!(this.lastInvalidatedAt<l&&(this.lastInvalidatedAt=t.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class Hu extends t.E{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.numModelsLoading={}}loadModel(l,u){return t.l(this.requestManager.transformRequest(u,t.R.Model).url).then(_=>{if(!_)return;let x=t.c(_),w=new t.M(l,void 0,void 0,x);return w.computeBoundsAndApplyParent(),w}).catch(_=>{if(_&&_.status===404)return null;this.fire(new t.d(new Error(`Could not load model ${l} from ${u}: ${_.message}`)))})}load(l,u){this.models[u]||(this.models[u]={});let _=Object.keys(l);this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+_.length;let x=[];for(let w of _)x.push(this.loadModel(w,l[w]));Promise.allSettled(x).then(w=>{for(let S=0;S<w.length;S++){let{status:I,value:A}=w[S];I==="fulfilled"&&A&&(this.models[u][_[S]]={model:A,numReferences:1})}this.numModelsLoading[u]-=_.length,this.fire(new t.f("data",{dataType:"style"}))}).catch(w=>{this.fire(new t.d(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(let l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,u){return!!this.getModel(l,u)}getModel(l,u){return this.models[u]||(this.models[u]={}),this.models[u][l]?this.models[u][l].model:void 0}addModel(l,u,_){this.models[_]||(this.models[_]={}),this.hasModel(l,_)&&this.models[_][l].numReferences++,this.load({[l]:this.requestManager.normalizeModelURL(u)},_)}addModels(l,u){this.models[u]||(this.models[u]={});let _={};for(let x in l)this.models[u][x]={},_[x]=this.requestManager.normalizeModelURL(l[x]);this.load(_,u)}addModelsFromBucket(l,u){this.models[u]||(this.models[u]={});let _={};for(let x of l)this.hasModel(x,u)?this.models[u][x].numReferences++:_[x]=this.requestManager.normalizeModelURL(x);this.load(_,u)}removeModel(l,u){if(this.models[u]&&this.models[u][l]&&(this.models[u][l].numReferences--,this.models[u][l].numReferences===0)){let _=this.models[u][l].model;delete this.models[u][l],_.destroy()}}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,u){this.models[u]||(this.models[u]={});for(let _ in this.models[u])this.models[u][_].model&&this.models[u][_].model.upload(l.context)}}function oi(f){let{userImage:l}=f;return!!(l&&l.render&&l.render())&&(f.data.replace(new Uint8Array(l.data.buffer)),!0)}class lh extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(l){this.images[l]={},this.loaded[l]=!1,this.updatedImages[l]={},this.patterns[l]={},this.callbackDispatchedThisFrame[l]={},this.atlasImage[l]=new t.i({width:1,height:1})}isLoaded(){for(let l in this.loaded)if(!this.loaded[l])return!1;return!0}setLoaded(l,u){if(this.loaded[u]!==l&&(this.loaded[u]=l,l)){for(let{ids:_,callback:x}of this.requestors)this._notify(_,u,x);this.requestors=[]}}hasImage(l,u){return!!this.getImage(l,u)}getImage(l,u){return this.images[u][l]}addImage(l,u,_){this._validate(l,_)&&(this.images[u][l]=_)}_validate(l,u){let _=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new t.d(new Error(`Image "${l}" has invalid "stretchX" value`))),_=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new t.d(new Error(`Image "${l}" has invalid "stretchY" value`))),_=!1),this._validateContent(u.content,u)||(this.fire(new t.d(new Error(`Image "${l}" has invalid "content" value`))),_=!1),_}_validateStretch(l,u){if(!l)return!0;let _=0;for(let x of l){if(x[0]<_||x[1]<x[0]||u<x[1])return!1;_=x[1]}return!0}_validateContent(l,u){return!(l&&(l.length!==4||l[0]<0||u.data.width<l[0]||l[1]<0||u.data.height<l[1]||l[2]<0||u.data.width<l[2]||l[3]<0||u.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,u,_){_.version=this.images[u][l].version+1,this.images[u][l]=_,this.updatedImages[u][l]=!0}removeImage(l,u){let _=this.images[u][l];delete this.images[u][l],delete this.patterns[u][l],_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(l){return Object.keys(this.images[l])}getImages(l,u,_){let x=!0,w=!!this.loaded[u];if(!w)for(let S of l)this.images[u][S]||(x=!1);w||x?this._notify(l,u,_):this.requestors.push({ids:l,scope:u,callback:_})}getUpdatedImages(l){return this.updatedImages[l]}_notify(l,u,_){let x={};for(let w of l){this.images[u][w]||this.fire(new t.f("styleimagemissing",{id:w}));let S=this.images[u][w];S?x[w]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:t.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}_(null,x)}getPixelSize(l){let{width:u,height:_}=this.atlasImage[l];return{width:u,height:_}}getPattern(l,u,_){let x=this.patterns[u][l],w=this.getImage(l,u);if(!w)return null;if(x&&x.position.version===w.version)return x.position;if(x)x.position.version=w.version;else{let S={w:w.data.width+2,h:w.data.height+2,x:0,y:0},I=new t.k(S,w);this.patterns[u][l]={bin:S,position:I}}return this._updatePatternAtlas(u,_),this.patterns[u][l].position}bind(l,u){let _=l.gl,x=this.atlasTexture[u];x?this.dirty&&(x.update(this.atlasImage[u]),this.dirty=!1):(x=new t.T(l,this.atlasImage[u],_.RGBA),this.atlasTexture[u]=x),x.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(l,u){let _=[];for(let I in this.patterns[l])_.push(this.patterns[l][I].bin);let{w:x,h:w}=t.j(_),S=this.atlasImage[l];S.resize({width:x||1,height:w||1});for(let I in this.patterns[l]){let{bin:A}=this.patterns[l][I],P=A.x+1,F=A.y+1,B=this.images[l][I].data,U=B.width,H=B.height;t.i.copy(B,S,{x:0,y:0},{x:P,y:F},{width:U,height:H},u),t.i.copy(B,S,{x:0,y:H-1},{x:P,y:F-1},{width:U,height:1},u),t.i.copy(B,S,{x:0,y:0},{x:P,y:F+H},{width:U,height:1},u),t.i.copy(B,S,{x:U-1,y:0},{x:P-1,y:F},{width:1,height:H},u),t.i.copy(B,S,{x:0,y:0},{x:P+U,y:F},{width:1,height:H},u)}this.dirty=!0}beginFrame(){for(let l in this.images)this.callbackDispatchedThisFrame[l]={}}dispatchRenderCallbacks(l,u){for(let _ of l){if(this.callbackDispatchedThisFrame[u][_])continue;this.callbackDispatchedThisFrame[u][_]=!0;let x=this.images[u][_];oi(x)&&this.updateImage(_,u,x)}}}function Wn(f){let l=f.key,u=f.value,_=f.valueSpec||{},x=f.objectElementValidators||{},w=f.style,S=f.styleSpec,I=[],A=t.n(u);if(A!=="object")return[new t.V(l,u,`object expected, ${A} found`)];for(let P in u){let F=P.split(".")[0],B;x[F]?B=x[F]:_[F]?B=$:x["*"]?B=x["*"]:_["*"]&&(B=$),B?I=I.concat(B({key:(l&&`${l}.`)+P,value:u[P],valueSpec:_[F]||_["*"],style:w,styleSpec:S,object:u,objectKey:P},u)):I.push(new t.m(l,u[P],`unknown property "${P}"`))}for(let P in _)x[P]||_[P].required&&_[P].default===void 0&&u[P]===void 0&&I.push(new t.V(l,u,`missing required property "${P}"`));return I}function Sc(f){let l=f.value,u=f.valueSpec,_=f.style,x=f.styleSpec,w=f.key,S=f.arrayElementValidator||$;if(t.n(l)!=="array")return[new t.V(w,l,`array expected, ${t.n(l)} found`)];if(u.length&&l.length!==u.length)return[new t.V(w,l,`array length ${u.length} expected, length ${l.length} found`)];if(u["min-length"]&&l.length<u["min-length"])return[new t.V(w,l,`array length at least ${u["min-length"]} expected, length ${l.length} found`)];let I={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};x.$version<7&&(I.function=u.function),t.n(u.value)==="object"&&(I=u.value);let A=[];for(let P=0;P<l.length;P++)A=A.concat(S({array:l,arrayIndex:P,value:l[P],valueSpec:I,style:_,styleSpec:x,key:`${w}[${P}]`},!0));return A}function bl(f){let l=f.key,u=f.value,_=f.valueSpec,x=t.n(u);if(x==="number"&&u!=u&&(x="NaN"),x!=="number")return[new t.V(l,u,`number expected, ${x} found`)];if("minimum"in _){let w=_.minimum;if(t.n(_.minimum)==="array"&&(w=_.minimum[f.arrayIndex]),u<w)return[new t.V(l,u,`${u} is less than the minimum value ${w}`)]}if("maximum"in _){let w=_.maximum;if(t.n(_.maximum)==="array"&&(w=_.maximum[f.arrayIndex]),u>w)return[new t.V(l,u,`${u} is greater than the maximum value ${w}`)]}return[]}function za(f){let l=f.valueSpec,u=t.u(f.value.type),_,x,w,S={},I=u!=="categorical"&&f.value.property===void 0,A=!I,P=t.n(f.value.stops)==="array"&&t.n(f.value.stops[0])==="array"&&t.n(f.value.stops[0][0])==="object",F=Wn({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(H){if(u==="identity")return[new t.V(H.key,H.value,'identity function may not have a "stops" property')];let q=[],Z=H.value;return q=q.concat(Sc({key:H.key,value:Z,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:B})),t.n(Z)==="array"&&Z.length===0&&q.push(new t.V(H.key,Z,"array must have at least one stop")),q},default:function(H){return $({key:H.key,value:H.value,valueSpec:l,style:H.style,styleSpec:H.styleSpec})}}});return u==="identity"&&I&&F.push(new t.V(f.key,f.value,'missing required property "property"')),u==="identity"||f.value.stops||F.push(new t.V(f.key,f.value,'missing required property "stops"')),u==="exponential"&&f.valueSpec.expression&&!t.s(f.valueSpec)&&F.push(new t.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(A&&!t.q(f.valueSpec)?F.push(new t.V(f.key,f.value,"property functions not supported")):I&&!t.r(f.valueSpec)&&F.push(new t.V(f.key,f.value,"zoom functions not supported"))),u!=="categorical"&&!P||f.value.property!==void 0||F.push(new t.V(f.key,f.value,'"property" property is required')),F;function B(H){let q=[],Z=H.value,X=H.key;if(t.n(Z)!=="array")return[new t.V(X,Z,`array expected, ${t.n(Z)} found`)];if(Z.length!==2)return[new t.V(X,Z,`array length 2 expected, length ${Z.length} found`)];if(P){if(t.n(Z[0])!=="object")return[new t.V(X,Z,`object expected, ${t.n(Z[0])} found`)];if(Z[0].zoom===void 0)return[new t.V(X,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new t.V(X,Z,"object stop key must have value")];let K=t.u(Z[0].zoom);if(typeof K!="number")return[new t.V(X,Z[0].zoom,"stop zoom values must be numbers")];if(w&&w>K)return[new t.V(X,Z[0].zoom,"stop zoom values must appear in ascending order")];K!==w&&(w=K,x=void 0,S={}),q=q.concat(Wn({key:`${X}[0]`,value:Z[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:bl,value:U}}))}else q=q.concat(U({key:`${X}[0]`,value:Z[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},Z));return t.t(t.v(Z[1]))?q.concat([new t.V(`${X}[1]`,Z[1],"expressions are not allowed in function stops.")]):q.concat($({key:`${X}[1]`,value:Z[1],valueSpec:l,style:H.style,styleSpec:H.styleSpec}))}function U(H,q){let Z=t.n(H.value),X=t.u(H.value),K=H.value!==null?H.value:q;if(_){if(Z!==_)return[new t.V(H.key,K,`${Z} stop domain type must match previous stop domain type ${_}`)]}else _=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new t.V(H.key,K,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&u!=="categorical"){let re=`number expected, ${Z} found`;return t.q(l)&&u===void 0&&(re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new t.V(H.key,K,re)]}return u!=="categorical"||Z!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?u!=="categorical"&&Z==="number"&&typeof X=="number"&&typeof x=="number"&&x!==void 0&&X<x?[new t.V(H.key,K,"stop domain values must appear in ascending order")]:(x=X,u==="categorical"&&X in S?[new t.V(H.key,K,"stop domain values must be unique")]:(S[X]=!0,[])):[new t.V(H.key,K,`integer expected, found ${String(X)}`)]}}function Ba(f){let l=(f.expressionContext==="property"?t.x:t.y)(t.v(f.value),f.valueSpec);if(l.result==="error")return l.value.map(_=>new t.V(`${f.key}${_.key}`,f.value,_.message));let u=l.value.expression||l.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!u.outputDefined())return[new t.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!t.z(u))return[new t.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return ch(u,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!t.A(u,["zoom","feature-state"]))return[new t.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!t.B(u))return[new t.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ch(f,l){let u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(let x of l.valueSpec.expression.parameters)u.delete(x);if(u.size===0)return[];let _=[];return f instanceof t.D&&u.has(f.name)?[new t.V(l.key,l.value,`["${f.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(f.eachChild(x=>{_.push(...ch(x,l))}),_)}function Rs(f){let l=f.key,u=f.value,_=f.valueSpec,x=[];return Array.isArray(_.values)?_.values.indexOf(t.u(u))===-1&&x.push(new t.V(l,u,`expected one of [${_.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(_.values).indexOf(t.u(u))===-1&&x.push(new t.V(l,u,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(u)} found`)),x}function Fs(f){return t.G(t.v(f.value))?Ba(t.o({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Mc(f)}function Mc(f){let l=f.value,u=f.key;if(t.n(l)!=="array")return[new t.V(u,l,`array expected, ${t.n(l)} found`)];let _=f.styleSpec,x,w=[];if(l.length<1)return[new t.V(u,l,"filter array must have at least 1 element")];switch(w=w.concat(Rs({key:`${u}[0]`,value:l[0],valueSpec:_.filter_operator,style:f.style,styleSpec:f.styleSpec})),t.u(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&t.u(l[1])==="$type"&&w.push(new t.V(u,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&w.push(new t.V(u,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(x=t.n(l[1]),x!=="string"&&w.push(new t.V(`${u}[1]`,l[1],`string expected, ${x} found`)));for(let S=2;S<l.length;S++)x=t.n(l[S]),t.u(l[1])==="$type"?w=w.concat(Rs({key:`${u}[${S}]`,value:l[S],valueSpec:_.geometry_type,style:f.style,styleSpec:f.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&w.push(new t.V(`${u}[${S}]`,l[S],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let S=1;S<l.length;S++)w=w.concat(Mc({key:`${u}[${S}]`,value:l[S],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":x=t.n(l[1]),l.length!==2?w.push(new t.V(u,l,`filter array for "${l[0]}" operator must have 2 elements`)):x!=="string"&&w.push(new t.V(`${u}[1]`,l[1],`string expected, ${x} found`))}return w}function Tc(f,l){let u=f.key,_=f.style,x=f.layer,w=f.styleSpec,S=f.value,I=f.objectKey,A=w[`${l}_${f.layerType}`];if(!A)return[];let P=I.match(/^(.*)-transition$/);if(l==="paint"&&P&&A[P[1]]&&A[P[1]].transition)return $({key:u,value:S,valueSpec:w.transition,style:_,styleSpec:w});let F=f.valueSpec||A[I];if(!F)return[new t.m(u,S,`unknown property "${I}"`)];let B;if(t.n(S)==="string"&&t.q(F)&&!F.tokens&&(B=/^{([^}]+)}$/.exec(S))){let H=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new t.V(u,S,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${H}.`)]}let U=[];if(f.layerType==="symbol")I!=="text-field"||!_||_.glyphs||_.imports||U.push(new t.V(u,S,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&t.H(t.v(S))&&t.u(S.type)==="identity"&&U.push(new t.V(u,S,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&l==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&t.q(F)&&(t.J(F)||t.r(F))){let H=t.x(t.v(S),F),q=H.value.expression||H.value._styleExpression.expression;q&&!t.A(q,["measure-light"])&&(I==="model-emissive-strength"&&t.B(q)&&t.z(q)||U.push(new t.V(u,S,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat($({key:f.key,value:S,valueSpec:F,style:_,styleSpec:w,expressionContext:"property",propertyType:l,propertyKey:I}))}function Wu(f){return Tc(f,"paint")}function Ic(f){return Tc(f,"layout")}function Ko(f){let l=[],u=f.value,_=f.key,x=f.style,w=f.styleSpec;u.type||u.ref||l.push(new t.V(_,u,'either "type" or "ref" is required'));let S=t.u(u.type),I=t.u(u.ref);if(u.id){let A=t.u(u.id);for(let P=0;P<f.arrayIndex;P++){let F=x.layers[P];t.u(F.id)===A&&l.push(new t.V(_,u.id,`duplicate layer id "${u.id}", previously used at line ${F.id.__line__}`))}}if("ref"in u){let A;["type","source","source-layer","filter","layout"].forEach(P=>{P in u&&l.push(new t.V(_,u[P],`"${P}" is prohibited for ref layers`))}),x.layers.forEach(P=>{t.u(P.id)===I&&(A=P)}),A?A.ref?l.push(new t.V(_,u.ref,"ref cannot reference another ref layer")):S=t.u(A.type):typeof I=="string"&&l.push(new t.V(_,u.ref,`ref layer "${I}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(u.source){let A=x.sources&&x.sources[u.source],P=A&&t.u(A.type);A?P==="vector"&&S==="raster"?l.push(new t.V(_,u.source,`layer "${u.id}" requires a raster source`)):P==="raster"&&S!=="raster"?l.push(new t.V(_,u.source,`layer "${u.id}" requires a vector source`)):P!=="vector"||u["source-layer"]?P==="raster-dem"&&S!=="hillshade"?l.push(new t.V(_,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||P==="geojson"&&A.lineMetrics?S==="raster-particle"&&P!=="raster-array"&&l.push(new t.V(_,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):l.push(new t.V(_,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new t.V(_,u.source,"raster-array source can only be used with layer type 'raster'.")):l.push(new t.V(_,u,`layer "${u.id}" must specify a "source-layer"`)):l.push(new t.V(_,u.source,`source "${u.source}" not found`))}else l.push(new t.V(_,u,'missing required property "source"'));return l=l.concat(Wn({key:_,value:u,valueSpec:w.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$({key:`${_}.type`,value:u.type,valueSpec:w.layer.type,style:f.style,styleSpec:f.styleSpec,object:u,objectKey:"type"}),filter:A=>Fs(t.o({layerType:S},A)),layout:A=>Wn({layer:u,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":P=>Ic(t.o({layerType:S},P))}}),paint:A=>Wn({layer:u,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":P=>Wu(t.o({layerType:S,layer:u},P))}})}})),l}function Ls(f){let l=f.value,u=f.key,_=t.n(l);return _!=="string"?[new t.V(u,l,`string expected, ${_} found`)]:[]}let Qo={promoteId:function({key:f,value:l}){if(t.n(l)==="string")return Ls({key:f,value:l});{let u=[];for(let _ in l)u.push(...Ls({key:`${f}.${_}`,value:l[_]}));return u}}};function Pr(f){let l=f.value,u=f.key,_=f.styleSpec,x=f.style;if(!l.type)return[new t.V(u,l,'"type" is required')];let w=t.u(l.type),S=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(l.url||l.tiles||S.push(new t.m(u,l,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(Wn({key:u,value:l,valueSpec:_[`source_${w.replace("-","_")}`],style:f.style,styleSpec:_,objectElementValidators:Qo})),S;case"geojson":if(S=Wn({key:u,value:l,valueSpec:_.source_geojson,style:x,styleSpec:_,objectElementValidators:Qo}),l.cluster)for(let I in l.clusterProperties){let[A,P]=l.clusterProperties[I],F=typeof A=="string"?[A,["accumulated"],["get",I]]:A;S.push(...Ba({key:`${u}.${I}.map`,value:P,expressionContext:"cluster-map"})),S.push(...Ba({key:`${u}.${I}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return S;case"video":return Wn({key:u,value:l,valueSpec:_.source_video,style:x,styleSpec:_});case"image":return Wn({key:u,value:l,valueSpec:_.source_image,style:x,styleSpec:_});case"canvas":return[new t.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Rs({key:`${u}.type`,value:l.type,valueSpec:{values:Gu(_)},style:x,styleSpec:_})}}function Gu(f){return f.source.reduce((l,u)=>{let _=f[u];return _.type.type==="enum"&&(l=l.concat(Object.keys(_.type.values))),l},[])}function vl(f){let l=f.value,u=f.styleSpec,_=u.light,x=f.style,w=[],S=t.n(l);if(l===void 0)return w;if(S!=="object")return w=w.concat([new t.V("light",l,`object expected, ${S} found`)]),w;for(let I in l){let A=I.match(/^(.*)-transition$/);w=w.concat(A&&_[A[1]]&&_[A[1]].transition?$({key:I,value:l[I],valueSpec:u.transition,style:x,styleSpec:u}):_[I]?$({key:I,value:l[I],valueSpec:_[I],style:x,styleSpec:u}):[new t.V(I,l[I],`unknown property "${I}"`)])}return w}function Ec(f){let l=f.value,u=[];if(!l)return u;let _=t.n(l);if(_!=="object")return u=u.concat([new t.V("light-3d",l,`object expected, ${_} found`)]),u;let x=f.styleSpec,w=x["light-3d"],S=f.key,I=f.style,A=f.style.lights;for(let B of["type","id"])if(!(B in l))return u=u.concat([new t.V("light-3d",l,`missing property ${B} on light`)]),u;if(l.type&&A)for(let B=0;B<f.arrayIndex;B++){let U=t.u(l.type),H=A[B];t.u(H.type)===U&&u.push(new t.V(S,l.id,`duplicate light type "${l.type}", previously defined at line ${H.id.__line__}`))}let P=`properties_light_${l.type}`;if(!(P in x))return u=u.concat([new t.V("light-3d",l,`Invalid light type ${l.type}`)]),u;let F=x[P];for(let B in l)if(B==="properties"){let U=l[B],H=t.n(U);if(H!=="object")return u=u.concat([new t.V("properties",U,`object expected, ${H} found`)]),u;for(let q in U)u=u.concat(F[q]?$({key:q,value:U[q],valueSpec:F[q],style:I,styleSpec:x}):[new t.m(f.key,U[q],`unknown property "${q}"`)])}else{let U=B.match(/^(.*)-transition$/);u=u.concat(U&&w[U[1]]&&w[U[1]].transition?$({key:B,value:l[B],valueSpec:x.transition,style:I,styleSpec:x}):w[B]?$({key:B,value:l[B],valueSpec:w[B],style:I,styleSpec:x}):[new t.m(B,l[B],`unknown property "${B}"`)])}return u}function dh(f){let l=f.value,u=f.key,_=f.style,x=f.styleSpec,w=x.terrain,S=[],I=t.n(l);if(l===void 0||I==="null")return S;if(I!=="object")return S=S.concat([new t.V("terrain",l,`object expected, ${I} found`)]),S;for(let A in l){let P=A.match(/^(.*)-transition$/);S=S.concat(P&&w[P[1]]&&w[P[1]].transition?$({key:A,value:l[A],valueSpec:x.transition,style:_,styleSpec:x}):w[A]?$({key:A,value:l[A],valueSpec:w[A],style:_,styleSpec:x}):[new t.m(A,l[A],`unknown property "${A}"`)])}if(l.source){let A=_.sources&&_.sources[l.source],P=A&&t.u(A.type);A?P!=="raster-dem"&&S.push(new t.V(u,l.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):S.push(new t.V(u,l.source,`source "${l.source}" not found`))}else S.push(new t.V(u,l,'terrain is missing required property "source"'));return S}function Dc(f){let l=f.value,u=f.style,_=f.styleSpec,x=_.fog,w=[],S=t.n(l);if(l===void 0)return w;if(S!=="object")return w=w.concat([new t.V("fog",l,`object expected, ${S} found`)]),w;for(let I in l){let A=I.match(/^(.*)-transition$/);w=w.concat(A&&x[A[1]]&&x[A[1]].transition?$({key:I,value:l[I],valueSpec:_.transition,style:u,styleSpec:_}):x[I]?$({key:I,value:l[I],valueSpec:x[I],style:u,styleSpec:_}):[new t.m(I,l[I],`unknown property "${I}"`)])}return w}let Se={"*":()=>[],array:Sc,boolean:function(f){let l=f.value,u=f.key,_=t.n(l);return _!=="boolean"?[new t.V(u,l,`boolean expected, ${_} found`)]:[]},number:bl,color:function(f){let l=f.key,u=f.value,_=t.n(u);return _!=="string"?[new t.V(l,u,`color expected, ${_} found`)]:t.F(u)===null?[new t.V(l,u,`color expected, "${u}" found`)]:[]},enum:Rs,filter:Fs,function:za,layer:Ko,object:Wn,source:Pr,model:t.K,light:vl,"light-3d":Ec,terrain:dh,fog:Dc,string:Ls,formatted:function(f){return Ls(f).length===0?[]:Ba(f)},resolvedImage:function(f){return Ls(f).length===0?[]:Ba(f)},projection:function(f){let l=f.value,u=f.styleSpec,_=u.projection,x=f.style,w=[],S=t.n(l);if(S==="object")for(let I in l)w=w.concat($({key:I,value:l[I],valueSpec:_[I],style:x,styleSpec:u}));else S!=="string"&&(w=w.concat([new t.V("projection",l,`object or string expected, ${S} found`)]));return w},import:function(f){let{value:l,styleSpec:u}=f,S=l,{data:_}=S,x=nC(S,["data"]);Object.defineProperty(x,"__line__",{value:l.__line__,enumerable:!1});let w=Wn(t.o({},f,{value:x,valueSpec:u.import}));return t.u(x.id)===""&&w.push(new t.V(`${f.key}.id`,x,"import id can't be an empty string")),_&&(w=w.concat(de(_,u,{key:`${f.key}.data`}))),w}};function $(f,l=!1){let u=f.value,_=f.valueSpec,x=f.styleSpec;if(_.expression&&t.H(t.u(u)))return za(f);if(_.expression&&t.t(t.v(u)))return Ba(f);if(_.type&&Se[_.type]){let w=Se[_.type](f);return l===!0&&w.length>0&&t.n(f.value)==="array"?Ba(f):w}return Wn(t.o({},f,{valueSpec:_.type?x[_.type]:_}))}function Q(f){let l=f.value,u=f.key,_=Ls(f);return _.length||(l.indexOf("{fontstack}")===-1&&_.push(new t.V(u,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&_.push(new t.V(u,l,'"glyphs" url must include a "{range}" token'))),_}function de(f,l=t.L,u={}){return $({key:u.key||"",value:f,valueSpec:l.$root,styleSpec:l,style:f,objectElementValidators:{glyphs:Q,"*":()=>[]}})}function _e(f,l=t.L){return vi(de(f,l))}let ye=f=>vi(Pr(f)),ke=f=>vi(vl(f)),Be=f=>vi(Ec(f)),Ie=f=>vi(dh(f)),Ve=f=>vi(Dc(f)),ut=f=>vi(Ko(f)),st=f=>vi(Fs(f)),Lt=f=>vi(Wu(f)),Yt=f=>vi(Ic(f)),_i=f=>vi(t.K(f));function vi(f){return f.slice().sort((l,u)=>l.line&&u.line?l.line-u.line:0)}function li(f,l){let u=!1;if(l&&l.length)for(let _ of l)_ instanceof t.m?t.w(_.message):(f.fire(new t.d(new Error(_.message))),u=!0);return u}let Fi=new t.N({anchor:new t.O(t.L.light.anchor),position:new t.Q(t.L.light.position),color:new t.O(t.L.light.color),intensity:new t.O(t.L.light.intensity)});class Ot extends t.E{constructor(l,u="flat"){super(),this._transitionable=new t.U(Fi),this.setLight(l,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,u,_={}){this._validate(ke,l,_)||(this._transitionable.setTransitionOrValue(l),this.id=u)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,u,_){return(!_||_.validate!==!1)&&li(this,l.call(_e,t.W({value:u,style:{glyphs:!0,sprite:!0},styleSpec:t.L})))}}let En=new t.N({source:new t.O(t.L.terrain.source),exaggeration:new t.O(t.L.terrain.exaggeration)}),on=class extends t.E{constructor(f,l,u,_){super(),this.scope=u,this._transitionable=new t.U(En,u,_),this._transitionable.setTransitionOrValue(f,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(f,l){this._transitionable.setTransitionOrValue(f,l)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new t.X(f)).get("exaggeration")}isZoomDependent(){let f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof t.Z}},Vi=45,Kn=65,Dn=.05;function cr(f,l,u,_){let x=t.$(Vi,Kn,u),[w,S]=$r(f,_),I=1-Math.min(1,Math.exp((l-w)/(S-w)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*x*f.alpha}function $r(f,l){let u=.5/Math.tan(.5*l);return[f.range[0]+u,f.range[1]+u]}function qr(f,l,u,_,x){let w=t._.transformMat4([],[l,u,_],x.mercatorFogMatrix);return cr(f,t._.length(w),x.pitch,x._fov)}function xl(f,l,u,_,x,w,S){let I=[[u,_,0],[x,_,0],[x,w,0],[u,w,0]],A=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let F of I){let B=t._.transformMat4([],F,l),U=t._.length(B);A=Math.min(A,U),P=Math.max(P,U)}return[cr(f,A,S.pitch,S._fov),cr(f,P,S.pitch,S._fov)]}let lf=new t.N({range:new t.O(t.L.fog.range),color:new t.O(t.L.fog.color),"high-color":new t.O(t.L.fog["high-color"]),"space-color":new t.O(t.L.fog["space-color"]),"horizon-blend":new t.O(t.L.fog["horizon-blend"]),"star-intensity":new t.O(t.L.fog["star-intensity"]),"vertical-range":new t.O(t.L.fog["vertical-range"])});class k0 extends t.E{constructor(l,u,_,x){super(),this._transitionable=new t.U(lf,_,new Map(x)),this.set(l,x),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new t.a0(lf),this.scope=_}get state(){let l=this._transform,u=l.projection.name==="globe",_=t.a1(l.zoom),x=this.properties.get("range"),w=[.5,3];return{range:u?[t.a2(w[0],x[0],_),t.a2(w[1],x[1],_)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,u,_={}){if(this._validate(Ve,l,_))return;let x=t.W({},l);for(let w of Object.keys(t.L.fog))x[w]===void 0&&(x[w]=t.L.fog[w].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;let u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:t.$(Vi,Kn,l))*u.a}getOpacityAtLatLng(l,u){return this._transform.projection.supportsFog?function(_,x,w){let S=t.Y.fromLngLat(x),I=w.elevation?w.elevation.getAtPointOrZero(S):0;return qr(_,S.x,S.y,I,w)}(this.state,l,u):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];let u=this._transform.calculateFogTileMatrix(l.toUnwrapped());return xl(this.state,u,0,0,t.a3,t.a3,this._transform)}getOpacityForBounds(l,u,_,x,w){return this._transform.projection.supportsFog?xl(this.state,l,u,_,x,w,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?$r(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;let u=[4,5,6,7];for(let _ of u){let x=l.points[_],w;if(x[2]>=0)w=x;else{let S=l.points[_-4];w=t.a4(S,x,S[2]/(S[2]-x[2]))}if(qr(this.state,w[0],w[1],0,this._transform)>=Dn)return!0}return!1}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,u,_){return(!_||_.validate!==!1)&&li(this,l.call(_e,t.W({value:u,style:{glyphs:!0,sprite:!0},styleSpec:t.L})))}}class hh extends t.E{constructor(l,u,_,x){super(),this.scope=_,this._options=l,this.properties=new t.a0(u),this._transitionable=new t.U(u,_,new Map(x)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,u){this._options=l,this._transitionable.setTransitionOrValue(l.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let mi=new t.N({color:new t.O(t.L.properties_light_ambient.color),intensity:new t.O(t.L.properties_light_ambient.intensity)}),cf=new t.N({direction:new t.a5(t.L.properties_light_directional.direction),color:new t.O(t.L.properties_light_directional.color),intensity:new t.O(t.L.properties_light_directional.intensity),"cast-shadows":new t.O(t.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new t.O(t.L.properties_light_directional["shadow-intensity"])});var zs=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,df=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,hf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,uf="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",pf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,mf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ff=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,gf=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,_f=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,yf=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,A0=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let kc=[];Ac(zs,kc),Ac(hf,kc),Ac(df,kc);let $u={"_prelude_fog.vertex.glsl":mf,"_prelude_terrain.vertex.glsl":pf,"_prelude_shadow.vertex.glsl":yf,"_prelude_fog.fragment.glsl":ff,"_prelude_shadow.fragment.glsl":A0,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":gf,"_prelude_raster_particle.glsl":_f},qu={};Di("",pf),Di(ff,mf),Di(A0,yf),Di(gf,""),Di(_f,"");let P0=Di(df,hf),O0=zs;var R0={background:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Di("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Di(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Di("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Di("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Di("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Di(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Di(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Di(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Di(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Di("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Di("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Di(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Di(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:Di(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Di(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Di("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Di(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,uf),skyboxGradient:Di(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,uf),skyboxCapture:Di(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Di(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Di(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Di(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Di("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ac(f,l){let u=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of u)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let x=_.split(" ");for(let w of x)l.includes(w)||l.push(w)}}function Di(f,l){let u=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,x=l.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(P=>{let F=P.split(" ");return F[F.length-1]}),x=[...new Set(x)]);let w={},S=[],I=[];if(f=f.replace(u,(P,F)=>(I.push(F),"")),(l=l.replace(u,(P,F)=>(S.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...kc];Ac(f,A),Ac(l,A);for(let P of[...S,...I])$u[P]||console.error(`Undefined include: ${P}`),qu[P]||(qu[P]=[],Ac($u[P],qu[P])),A=[...A,...qu[P]];return{fragmentSource:f=f.replace(_,(P,F,B,U,H)=>(w[H]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${B} ${U} ${H};
#else
uniform ${B} ${U} u_${H};
#endif
`:F==="initialize"?`
#ifdef HAS_UNIFORM_u_${H}
    ${B} ${U} ${H} = u_${H};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${B} ${U} ${H};
#endif
`:F==="initialize-attribute"?"":void 0)),vertexSource:l=l.replace(_,(P,F,B,U,H)=>{let q=U==="float"?"vec2":U,Z=H.match(/color/)?"color":q;return F==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${H}
in ${B} ${U} a_${H};
#endif
`:w[H]?F==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${B} ${q} a_${H};
out ${B} ${U} ${H};
#else
uniform ${B} ${U} u_${H};
#endif
`:F==="initialize"?Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${B} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${Z}(a_${H}, u_${H}_t);
#else
    ${B} ${U} ${H} = u_${H};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${B} ${U} a_${H};
    out ${B} ${U} ${H};
#endif
`:F==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${H} = a_${H};
#endif
`:void 0:F==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${B} ${q} a_${H};
#else
uniform ${B} ${U} u_${H};
#endif
`:F==="define-instanced"?Z==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${H}0;
in vec4 a_${H}1;
in vec4 a_${H}2;
in vec4 a_${H}3;
#else
uniform ${B} ${U} u_${H};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${B} ${q} a_${H};
#else
uniform ${B} ${U} u_${H};
#endif
`:F==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${B} ${U} ${H} = a_${H};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${B} ${U} ${H} = a_${H};
#else
    ${B} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${B} ${U} ${H} = unpack_mix_${Z}(a_${H}, u_${H}_t);
#else
    ${B} ${U} ${H} = u_${H};
#endif
`}),staticAttributes:x,usedDefines:A,vertexIncludes:S,fragmentIncludes:I}}class $x{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,u,_,x,w,S,I,A){this.context=l;let P=this.boundPaintVertexBuffers.length!==x.length;for(let B=0;!P&&B<x.length;B++)this.boundPaintVertexBuffers[B]!==x[B]&&(P=!0);let F=this.boundDynamicVertexBuffers.length!==I.length;for(let B=0;!F&&B<I.length;B++)this.boundDynamicVertexBuffers[B]!==I[B]&&(F=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==_||P||F||this.boundIndexBuffer!==w||this.boundVertexOffset!==S)this.freshBind(u,_,x,w,S,I,A);else{l.bindVertexArrayOES.set(this.vao);for(let B of I)B&&(B.bind(),A&&B.instanceCount&&B.setVertexAttribDivisor(l.gl,u,A));w&&w.dynamicDraw&&w.bind()}}freshBind(l,u,_,x,w,S,I){let A=l.numAttributes,P=this.context,F=P.gl;this.vao&&this.destroy(),this.vao=P.gl.createVertexArray(),P.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=S,u.enableAttributes(F,l),u.bind(),u.setVertexAttribPointers(F,l,w);for(let B of _)B.enableAttributes(F,l),B.bind(),B.setVertexAttribPointers(F,l,w);for(let B of S)B&&(B.enableAttributes(F,l),B.bind(),B.setVertexAttribPointers(F,l,w),I&&B.instanceCount&&B.setVertexAttribDivisor(F,l,I));x&&x.bind(),P.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function qx(f,l){let u=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new t.Y(0,_/u).toLngLat().lat,new t.Y(0,(_+1)/u).toLngLat().lat]}function Yx(f,l,u,_,x,w,S){let I=f.context,A=I.gl,P=u.hillshadeFBO;if(!P)return;f.prepareDrawTile();let F=f.isTileAffectedByFog(l),B=f.getOrCreateProgram("hillshade",{overrideFog:F});I.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,P.colorAttachment.get());let U=((X,K,re,ae)=>{let se=re.paint.get("hillshade-shadow-color"),fe=re.paint.get("hillshade-highlight-color"),me=re.paint.get("hillshade-accent-color"),ne=re.paint.get("hillshade-emissive-strength"),le=t.ab(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")le-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){let we=X.style.directionalLight.properties.get("direction"),Oe=t.ac(we.x,we.y,we.z);le=t.ab(Oe[1])}let ce=!X.options.moving;return{u_matrix:ae||X.transform.calculateProjMatrix(K.tileID.toUnwrapped(),ce),u_image:0,u_latrange:qx(0,K.tileID),u_light:[re.paint.get("hillshade-exaggeration"),le],u_shadow:se.toRenderColor(re.lut),u_highlight:fe.toRenderColor(re.lut),u_emissive_strength:ne,u_accent:me.toRenderColor(re.lut)}})(f,u,_,f.terrain?l.projMatrix:null);f.uploadCommonUniforms(I,B,l.toUnwrapped());let{tileBoundsBuffer:H,tileBoundsIndexBuffer:q,tileBoundsSegments:Z}=f.getTileBoundsBuffers(u);B.draw(f,A.TRIANGLES,x,w,S,t.af.disabled,U,_.id,H,q,Z)}function bf(f,l,u){if(!l.needsDEMTextureUpload)return;let _=f.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||f.getTileTexture(u.stride);let w=u.getPixels();l.demTexture?l.demTexture.update(w,{premultiply:!1}):l.demTexture=new t.T(_,w,x.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function Na(f,l,u){let _=f.context,x=_.gl;if(!l.dem)return;let w=l.dem;if(_.activeTexture.set(x.TEXTURE1),bf(f,l,w),!l.demTexture)return;l.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);let S=w.dim;_.activeTexture.set(x.TEXTURE0);let I=l.hillshadeFBO;if(!I){let U=new t.T(_,{width:S,height:S,data:null},x.RGBA);U.bind(x.LINEAR,x.CLAMP_TO_EDGE),I=l.hillshadeFBO=_.createFramebuffer(S,S,!0,"renderbuffer"),I.colorAttachment.set(U.texture)}_.bindFramebuffer.set(I.framebuffer),_.viewport.set([0,0,S,S]);let{tileBoundsBuffer:A,tileBoundsIndexBuffer:P,tileBoundsSegments:F}=f.getMercatorTileBoundsBuffers(),B=[];f.linearFloatFilteringSupported()&&B.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:B}).draw(f,x.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.disabled,((U,H)=>{let q=H.stride,Z=t.ad.create();return t.ad.ortho(Z,0,t.a3,-t.a3,0,0,1),t.ad.translate(Z,Z,[0,-t.a3,0]),{u_matrix:Z,u_image:1,u_dimension:[q,q],u_zoom:U.overscaledZ}})(l.tileID,w),u.id,A,P,F),l.needsHillshadePrepare=!1}function vf(f,l,u,_,x){let w=function(S,I){if(S)return x(S);if(I){if(f.url&&I.tiles&&f.tiles&&delete f.tiles,I.variants){if(!Array.isArray(I.variants))return x(new Error("variants must be an array"));for(let P of I.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return x(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){I=t.W(I,P);break}}}let A=t.ah(t.W(I,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(A.vectorLayers=I.vector_layers,A.vectorLayerIds=A.vectorLayers.map(P=>P.id)),I.raster_layers&&(A.rasterLayers=I.raster_layers,A.rasterLayerIds=A.rasterLayers.map(P=>P.id)),A.tiles=l.canonicalizeTileset(A,f.url),x(null,A)}};return f.url?t.g(l.transformRequest(l.normalizeSourceURL(f.url,null,u,_),t.R.Source),w):t.e.frame(()=>w(null,f))}class uh{constructor(l,u,_){this.bounds=t.ai.convert(this.validateBounds(l)),this.minzoom=u||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){let u=Math.pow(2,l.z),_=Math.floor(t.aj(this.bounds.getWest())*u),x=Math.floor(t.ak(this.bounds.getNorth())*u),w=Math.ceil(t.aj(this.bounds.getEast())*u),S=Math.ceil(t.ak(this.bounds.getSouth())*u);return l.x>=_&&l.x<w&&l.y>=x&&l.y<S}}class ph extends t.E{constructor(l,u,_,x){super(),this.id=l,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.W({type:"raster"},u),t.W(this,t.ah(u,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"})),this._tileJSONRequest=vf(this._options,this.map._requestManager,null,null,(u,_)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new t.d(u)):_&&(t.W(this,_),_.bounds&&(this.tileBounds=new uh(_.bounds,this.minzoom,this.maxzoom)),t.an(_.tiles),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),l&&l(u)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();let l=t.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return t.W({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,u){let _=t.e.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);l.request=t.h(this.map._requestManager.transformRequest(x,t.R.Tile),(w,S,I,A)=>(delete l.request,l.aborted?(l.state="unloaded",u(null)):w?(l.state="errored",u(w)):S?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:I,expires:A}),l.setTexture(S,this.map.painter),l.state="loaded",t.am(this.dispatcher),void u(null)):u(null)))}abortTile(l,u){l.request&&(l.request.cancel(),delete l.request),u&&u()}unloadTile(l,u){l.texture&&l.texture instanceof t.T?(l.destroy(!0),l.texture&&l.texture instanceof t.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Yu extends t.E{constructor(l,u,_,x){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.W(this,t.ah(u,["url","scheme","tileSize","promoteId"])),this._options=t.W({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new t.ao}load(l){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"}));let u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=vf(this._options,this.map._requestManager,u,_,(x,w)=>{this._tileJSONRequest=null,this._loaded=!0,x?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new t.d(x))):w&&(t.W(this,w),w.bounds&&(this.tileBounds=new uh(w.bounds,this.minzoom,this.maxzoom)),t.an(w.tiles,this.map._requestManager._customAccessToken),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),l&&l(x)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();let l=t.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return t.W({},this._options)}loadTile(l,u){let _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),x=this.map._requestManager.transformRequest(_,t.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,S={request:x,data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,lut:w?{image:w.image.clone()}:null,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:t.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=u:l.request=l.actor.send("reloadTile",S,I.bind(this));else if(l.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",S,I.bind(this),void 0,!0);else{let A=t.ap.call({deduped:this._deduped},S,(P,F)=>{P||!F?I.call(this,P):(S.data={cacheControl:F.cacheControl,expires:F.expires,rawData:F.rawData.slice(0)},l.actor&&l.actor.send("loadTile",S,I.bind(this),void 0,!0))},!0);l.request={cancel:A}}function I(A,P){return delete l.request,l.aborted?u(null):A&&A.status!==404?u(A):(P&&P.resourceTiming&&(l.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&l.setExpiryData(P),l.loadVectorData(P,this.map.painter),t.am(this.dispatcher),u(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l,u){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let wl=f=>({u_matrix:new t.a6(f),u_image0:new t.a7(f),u_skirt_height:new t.aa(f),u_ground_shadow_factor:new t.aq(f)}),vt=(f,l,u)=>({u_matrix:f,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:u}),F0=(f,l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:u,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:S,u_frustum_tr:I,u_frustum_br:A,u_frustum_bl:P,u_globe_pos:F,u_globe_radius:B,u_viewport:U,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:H,u_far_z_cutoff:q});class mh{constructor(l=0,u=0,_=0,x=0){if(isNaN(l)||l<0||isNaN(u)||u<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=u,this.left=_,this.right=x}interpolate(l,u,_){return u.top!=null&&l.top!=null&&(this.top=t.a2(l.top,u.top,_)),u.bottom!=null&&l.bottom!=null&&(this.bottom=t.a2(l.bottom,u.bottom,_)),u.left!=null&&l.left!=null&&(this.left=t.a2(l.left,u.left,_)),u.right!=null&&l.right!=null&&(this.right=t.a2(l.right,u.right,_)),this}getCenter(l,u){let _=t.at((this.left+l-this.right)/2,0,l),x=t.at((this.top+u-this.bottom)/2,0,u);return new t.P(_,x)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new mh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Li(f,l){let u=t.aw(f,3);t.ad.fromQuat(f,l),t.az(f,3,u)}function Yr(f,l){let u=t.av.identity([]);return t.av.rotateZ(u,u,-l),t.av.rotateX(u,u,-f),u}function L0(f,l){let u=[f[0],f[1],0],_=[l[0],l[1],0];if(t._.length(u)>=1e-15){let S=t._.normalize([],u);t._.scale(_,S,t._.dot(_,S)),l[0]=_[0],l[1]=_[1]}let x=t._.cross([],l,f);if(t._.len(x)<1e-15)return null;let w=Math.atan2(-x[1],x[0]);return Yr(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),w)}class xf{constructor(l,u){this.position=l,this.orientation=u}get position(){return this._position}set position(l){if(l){let u=l instanceof t.Y?l:new t.Y(l[0],l[1],l[2]);this._renderWorldCopies&&(u.x=t.au(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(l,u){if(this.orientation=null,!this.position)return;let _=this.position,x=this._elevation?this._elevation.getAtPointOrZero(t.Y.fromLngLat(l)):0,w=t.Y.fromLngLat(l,x),S=[w.x-_.x,w.y-_.y,w.z-_.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=L0(S,u)}setPitchBearing(l,u){this.orientation=Yr(t.ab(l),t.ab(-u))}}class fh{constructor(l,u){this._transform=t.ad.identity([]),this.orientation=u,this.position=l}get mercatorPosition(){let l=this.position;return new t.Y(l[0],l[1],l[2])}get position(){let l=t.aw(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var u;l&&t.az(this._transform,3,[(u=l)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||t.av.identity([]),l&&Li(this._transform,this._orientation)}getPitchBearing(){let l=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,u){this._orientation=Yr(l,u),Li(this._transform,this._orientation)}forward(){let l=t.aw(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){let l=t.aw(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){let l=t.aw(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,u){let _=new Float64Array(16);return t.ad.invert(_,this.getWorldToCamera(l,u)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,u,_){let x=this.position;t._.scale(x,x,-l);let w=new Float64Array(16);return t.ad.fromScaling(w,[_,_,_]),t.ad.translate(w,w,x),w[10]*=u,w}getWorldToCamera(l,u){let _=new Float64Array(16),x=new Float64Array(4),w=this.position;return t.av.conjugate(x,this._orientation),t._.scale(w,w,-l),t.ad.fromQuat(_,x),t.ad.translate(_,_,w),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=u,_[9]*=u,_[10]*=u,_[11]*=u,_}getCameraToClipPerspective(l,u,_,x){let w=new Float64Array(16);return t.ad.perspective(w,l,u,_,x),w}getCameraToClipOrthographic(l,u,_,x,w,S){let I=new Float64Array(16);return t.ad.ortho(I,l,u,_,x,w,S),I}getDistanceToElevation(l,u=!1){let _=l===0?0:t.ax(l,u?t.ay(this.position[1]):this.position[1]),x=this.forward();return(_-this.position[2])/x[2]}clone(){return new fh([...this.position],[...this.orientation])}}let Pc={unknown:0,flipRequired:1,flipNotRequired:2},yi=Math.tan(85*Math.PI/180);function Cl(f,l,u,_,x,w,S){let I=t.ad.create();if(u)if(w.name==="globe"){let A=t.aB(x,l);t.ad.multiply(I,I,A)}else{let A=t.aC.invert([],S);I[0]=A[0],I[1]=A[1],I[4]=A[2],I[5]=A[3],_||t.ad.rotateZ(I,I,x.angle)}else t.ad.multiply(I,x.labelPlaneMatrix,f);return I}function Sl(f,l,u,_,x,w,S){let I=Cl(f,l,u,_,x,w,S);return w.name==="globe"&&u||(I[2]=I[6]=I[10]=I[14]=0),I}function Oc(f,l,u,_,x,w,S){if(u){if(w.name==="globe"){let I=Cl(f,l,u,_,x,w,S);return t.ad.invert(I,I),t.ad.multiply(I,f,I),I}{let I=t.ad.clone(f),A=t.ad.identity([]);return A[0]=S[0],A[1]=S[1],A[4]=S[2],A[5]=S[3],t.ad.multiply(I,I,A),_||t.ad.rotateZ(I,I,-x.angle),I}}return x.glCoordMatrix}function Jo(f,l,u,_){let x=[f,l,u,1];u?t.aA.transformMat4(x,x,_):Va(x,x,_);let w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function Zr(f,l){return Math.min(.5+f/l*.5,1.5)}function Zx(f,l){let u=f[0]/f[3],_=f[1]/f[3];return u>=-l[0]&&u<=l[0]&&_>=-l[1]&&_<=l[1]}function Zu(f,l,u,_,x,w,S,I,A,P){let F=u.transform,B=_?f.textSizeData:f.iconSizeData,U=t.aD(B,u.transform.zoom),H=F.projection.name==="globe",q=[256/u.width*2+1,256/u.height*2+1],Z=_?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Z.clear();let X=null;H&&(X=_?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);let K=f.lineVertexArray,re=_?f.text.placedSymbolArray:f.icon.placedSymbolArray,ae=u.transform.width/u.transform.height,se,fe=!1;for(let me=0;me<re.length;me++){let ne=re.get(me),{numGlyphs:le,writingMode:ce}=ne;if(ce!==t.aE.vertical||fe||se===t.aE.horizontal||(fe=!0),se=ce,(ne.hidden||ce===t.aE.vertical)&&!fe){Ml(le,Z);continue}fe=!1;let we=new t.P(ne.tileAnchorX,ne.tileAnchorY),{x:Oe,y:ue,z:Re}=F.projection.projectTilePoint(we.x,we.y,P.canonical);if(A){let[St,yt,it]=A(we);Oe+=St,ue+=yt,Re+=it}let ze=[Oe,ue,Re,1];if(t.aA.transformMat4(ze,ze,l),!Zx(ze,q)){Ml(le,Z);continue}let Ke=ze[3],Je=Zr(u.transform.getCameraToCenterDistance(F.projection),Ke),Xe=t.aF(B,U,ne),De=S?Xe/Je:Xe*Je,Ne=Jo(Oe,ue,Re,x);if(Ne[3]<=0){Ml(le,Z);continue}let Ze={},mt=S?null:A,_t=Cf(ne,De,!1,I,l,x,w,f.glyphOffsetArray,K,Z,X,Ne,we,Ze,ae,mt,F.projection,P,S);fe=_t.useVertical,mt&&_t.needsFlipping&&(Ze={}),(_t.notEnoughRoom||fe||_t.needsFlipping&&Cf(ne,De,!0,I,l,x,w,f.glyphOffsetArray,K,Z,X,Ne,we,Ze,ae,mt,F.projection,P,S).notEnoughRoom)&&Ml(le,Z)}_?(f.text.dynamicLayoutVertexBuffer.updateData(Z),X&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(X)):(f.icon.dynamicLayoutVertexBuffer.updateData(Z),X&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(X))}function Xu(f,l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z){let{lineStartIndex:X,glyphStartIndex:K,segment:re}=I,ae=K+I.numGlyphs,se=X+I.lineLength,fe=l.getoffsetX(K),me=l.getoffsetX(ae-1),ne=Rc(f*fe,u,_,x,w,S,re,X,se,A,P,F,B,U,!0,H,q,Z);if(!ne)return null;let le=Rc(f*me,u,_,x,w,S,re,X,se,A,P,F,B,U,!0,H,q,Z);return le?{first:ne,last:le}:null}function wf(f,l,u,_){return f===t.aE.horizontal&&Math.abs(_)>Math.abs(u)?{useVertical:!0}:f===t.aE.vertical?_>0?{needsFlipping:!0}:null:l!==Pc.unknown&&function(x,w){return x===0||Math.abs(w/x)>yi}(u,_)?l===Pc.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function Cf(f,l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z,X,K,re){let ae=l/24,se=f.lineOffsetX*ae,fe=f.lineOffsetY*ae,{lineStartIndex:me,glyphStartIndex:ne,numGlyphs:le,segment:ce,writingMode:we,flipState:Oe}=f,ue=me+f.lineLength,Re=ze=>{if(F){let[De,Ne,Ze]=ze.up,mt=P.length;t.aG(F,mt+0,De,Ne,Ze),t.aG(F,mt+1,De,Ne,Ze),t.aG(F,mt+2,De,Ne,Ze),t.aG(F,mt+3,De,Ne,Ze)}let[Ke,Je,Xe]=ze.point;t.aH(P,Ke,Je,Xe,ze.angle)};if(le>1){let ze=Xu(ae,I,se,fe,u,B,U,f,A,w,H,Z,!1,X,K,re);if(!ze)return{notEnoughRoom:!0};if(_&&!u){let[Ke,Je,Xe]=ze.first.point,[De,Ne,Ze]=ze.last.point;[Ke,Je]=Jo(Ke,Je,Xe,S),[De,Ne]=Jo(De,Ne,Ze,S);let mt=wf(we,Oe,(De-Ke)*q,Ne-Je);if(f.flipState=mt&&mt.needsFlipping?Pc.flipRequired:Pc.flipNotRequired,mt)return mt}Re(ze.first);for(let Ke=ne+1;Ke<ne+le-1;Ke++){let Je=Rc(ae*I.getoffsetX(Ke),se,fe,u,B,U,ce,me,ue,A,w,H,Z,!1,!1,X,K,re);if(!Je)return P.length-=4*(Ke-ne),{notEnoughRoom:!0};Re(Je)}Re(ze.last)}else{if(_&&!u){let Ke=Jo(U.x,U.y,0,x),Je=me+ce+1,Xe=new t.P(A.getx(Je),A.gety(Je)),De=Jo(Xe.x,Xe.y,0,x),Ne=De[3]>0?De:gh(U,Xe,Ke,1,x,void 0,X,K.canonical),Ze=wf(we,Oe,(Ne[0]-Ke[0])*q,Ne[1]-Ke[1]);if(f.flipState=Ze&&Ze.needsFlipping?Pc.flipRequired:Pc.flipNotRequired,Ze)return Ze}let ze=Rc(ae*I.getoffsetX(ne),se,fe,u,B,U,ce,me,ue,A,w,H,Z,!1,!1,X,K,re);if(!ze)return{notEnoughRoom:!0};Re(ze)}return{}}function Ku(f,l,u,_,x){let{x:w,y:S,z:I}=_.projectTilePoint(f.x,f.y,l);if(!x)return Jo(w,S,I,u);let[A,P,F]=x(f);return Jo(w+A,S+P,I+F,u)}function gh(f,l,u,_,x,w,S,I){let A=Ku(f.sub(l)._unit()._add(f),I,x,S,w);return t._.sub(A,u,A),t._.normalize(A,A),t._.scaleAndAdd(A,u,A,_)}function Rc(f,l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z,X,K){let re=_?f-l:f+l,ae=re>0?1:-1,se=0;_&&(ae*=-1,se=Math.PI),ae<0&&(se+=Math.PI);let fe=I+S+(ae>0?0:1)|0,me=x,ne=x,le=0,ce=0,we=Math.abs(re),Oe=[],ue=[],Re=w,ze=Re,Ke=()=>gh(ze,Re,ne,we-le+1,F,U,Z,X.canonical);for(;le+ce<=we;){if(fe+=ae,fe<I||fe>=A)return null;if(ne=me,ze=Re,Oe.push(ne),H&&ue.push(ze),Re=new t.P(P.getx(fe),P.gety(fe)),me=B[fe],!me){let yt=Ku(Re,X.canonical,F,Z,U);me=yt[3]>0?B[fe]=yt:Ke()}le+=ce,ce=t._.distance(ne,me)}q&&U&&(B[fe]&&(me=Ke(),ce=t._.distance(ne,me)),B[fe]=me);let Je=(we-le)/ce,Xe=Re.sub(ze)._mult(Je)._add(ze),De=t._.sub([],me,ne),Ne=t._.scaleAndAdd([],ne,De,Je),Ze=[0,0,1],mt=De[0],_t=De[1];if(K&&(Ze=Z.upVector(X.canonical,Xe.x,Xe.y),Ze[0]!==0||Ze[1]!==0||Ze[2]!==1)){let yt=[Ze[2],0,-Ze[0]],it=t._.cross([],Ze,yt);t._.normalize(yt,yt),t._.normalize(it,it),mt=t._.dot(De,yt),_t=t._.dot(De,it)}if(u){let yt=t._.cross([],Ze,De);t._.normalize(yt,yt),t._.scaleAndAdd(Ne,Ne,yt,u*ae)}let St=se+Math.atan2(_t,mt);return Oe.push(Ne),H&&ue.push(Xe),{point:Ne,angle:St,path:Oe,tilePath:ue,up:Ze}}function Ml(f,l){let u=l.length,_=u+4*f;l.resize(_),l.float32.fill(-1/0,4*u,4*_)}function Va(f,l,u){let _=l[0],x=l[1];return f[0]=u[0]*_+u[4]*x+u[12],f[1]=u[1]*_+u[5]*x+u[13],f[3]=u[3]*_+u[7]*x+u[15],f}let Sf=(f,l,u)=>(1-u)*f+u*l,Qn=f=>f*f*f*f*f;class ja{constructor(l,u,_,x,w,S,I){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=l||0,this._maxZoom=u||22,this._minPitch=_??0,this._maxPitch=x??60,this.setProjection(S),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new t.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new mh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new fh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let l=new ja(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(l,u=!1){let _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(l||_)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return t.ah(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};let u=this.projection?this.getProjection():void 0;this.projection=t.aJ(this.projectionOptions);let _=!g(u,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){let l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.aJ({name:"mercator"});let u=l!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){let l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return t.au(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){let u=-l*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=t.aC.create(),t.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){let u=t.at(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=t.ab(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){let u=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(l){this._tileCoverLift!==l&&(this._tileCoverLift=l)}_updateCameraOnTerrain(){let l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let _=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let l=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop(),x=0,w=0;for(let S=0;S<u.length;S++){let I=new t.P(u[S][0]*this.width,_+u[S][1]*(this.height-_)),A=l.pointCoordinate(I);if(!A)continue;let P=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);x+=A[3]*P,w+=P}return w===0?NaN:x/w}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let l=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*u,x=this._mercatorZfromZoom(l),w=this._mercatorZfromZoom(this._maxZoom),S=Math.max(x-_,w);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){let u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude())),_;_=l.z<this._camera.position[2]?[u.x,u.y,u.z]:[l.x,l.y,l.z];let x=t._.length(t._.sub([],this._camera.position,_));return t.at(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let u=!1;if(l.orientation&&!t.av.exactEquals(l.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(l.orientation)),l.position){let _=[l.position.x,l.position.y,l.position.z];t._.exactEquals(_,this._camera.position)||(this._setCameraPosition(_),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let l=this._camera.position,u=new xf;return u.position=new t.Y(l[0],l[1],l[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(l){if(!t.av.length(l))return!1;t.av.normalize(l,l);let u=t._.transformQuat([],[0,0,-1],l),_=t._.transformQuat([],[0,-1,0],l);if(_[2]<0)return!1;let x=L0(u,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(l){let u=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;l[2]=t.at(l[2],x/_,x/u),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,u,_){this._unmodified=!1,this._edgeInsets.interpolate(l,u,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){let u=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(l){let u=[new t.aK(0,l)];if(this.renderWorldCopies){let _=this.pointCoordinate(new t.P(0,0)),x=this.pointCoordinate(new t.P(this.width,0)),w=this.pointCoordinate(new t.P(this.width,this.height)),S=this.pointCoordinate(new t.P(0,this.height)),I=Math.floor(Math.min(_.x,x.x,w.x,S.x)),A=Math.floor(Math.max(_.x,x.x,w.x,S.x)),P=1;for(let F=I-P;F<=A+P;F++)F!==0&&u.push(new t.aK(F,l))}return u}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(l,u,_){let x=[];if(u[0]===0&&u[1]===0)return x;for(let S of l){let I=S.canonical,A=S.overscaledZ,P=S.wrap,F=1<<I.z,B=I.x+1<F,U=I.x>0,H=I.y+1<F,q=I.y>0,Z=S.wrap-(U?0:1),X=S.wrap+(B?0:1),K=U?I.x-1:F-1,re=B?I.x+1:0;u[0]<0?(x.push(new t.aL(A,X,I.z,re,I.y)),u[1]<0&&H&&(x.push(new t.aL(A,P,I.z,I.x,I.y+1)),x.push(new t.aL(A,X,I.z,re,I.y+1))),u[1]>0&&q&&(x.push(new t.aL(A,P,I.z,I.x,I.y-1)),x.push(new t.aL(A,X,I.z,re,I.y-1)))):u[0]>0?(x.push(new t.aL(A,Z,I.z,K,I.y)),u[1]<0&&H&&(x.push(new t.aL(A,P,I.z,I.x,I.y+1)),x.push(new t.aL(A,Z,I.z,K,I.y+1))),u[1]>0&&q&&(x.push(new t.aL(A,P,I.z,I.x,I.y-1)),x.push(new t.aL(A,Z,I.z,K,I.y-1)))):u[1]<0&&H?x.push(new t.aL(A,P,I.z,I.x,I.y+1)):q&&x.push(new t.aL(A,P,I.z,I.x,I.y-1))}if(x.length>1){x.sort((A,P)=>A.overscaledZ-P.overscaledZ||A.wrap-P.wrap||A.canonical.z-P.canonical.z||A.canonical.x-P.canonical.x||A.canonical.y-P.canonical.y);let S=0,I=0;for(;I<x.length;)x[I].equals(x[S])?++I:x[++S]=x[I++];x.length=S+1}let w=[];for(let S of x)x.some(I=>S.isChildOf(I))||w.push(S);return x=w.filter(S=>!l.some(I=>!!(S.overscaledZ<_&&I.isChildOf(S))||S.equals(I)||S.isChildOf(I))),x}coveringTiles(l){let u=this.coveringZoomLevel(l),_=u,x=this.elevation&&this.elevation.exaggeration(),w=x&&!l.isTerrainDEM,S=this.projection.name==="mercator";if(l.minzoom!==void 0&&u<l.minzoom)return[];l.maxzoom!==void 0&&u>l.maxzoom&&(u=l.maxzoom);let I=this.locationCoordinate(this.center),A=this.center.lat,P=1<<u,F=[P*I.x,P*I.y,0],B=this.projection.name==="globe",U=!B,H=t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,U),q=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=P*t.ax(1,this.center.lat),X=this._camera.position[2]/t.ax(1,this.center.lat),K=[P*q.x,P*q.y,X*(U?1:Z)],re=B||x,ae=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),se=this.isLODDisabled(!0)?u:0,fe;if(this._elevation&&l.isTerrainDEM)fe=1e4*this._elevation.exaggeration();else if(this._elevation){let De=this._elevation.getMinMaxForVisibleTiles();fe=De?De.max:this._centerAltitude}else fe=this._centerAltitude;let me=l.isTerrainDEM?-fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=this.projection.isReprojectedInTileSpace?t.aN(this):1,le=De=>{let Ze=new t.Y(De.x+25e-6,De.y,De.z),mt=new t.Y(De.x,De.y+25e-6,De.z),_t=De.toLngLat(),St=Ze.toLngLat(),yt=mt.toLngLat(),it=this.locationCoordinate(_t),$e=this.locationCoordinate(St),Pt=this.locationCoordinate(yt),hi=Math.hypot($e.x-it.x,$e.y-it.y),ai=Math.hypot(Pt.x-it.x,Pt.y-it.y);return Math.sqrt(hi*ai)*ne/25e-6},ce=De=>{let Ne=fe,Ze=me;return{aabb:t.aQ(this,P,0,0,0,De,Ze,Ne,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:Ne,wrap:De,fullyVisible:!1}},we=[],Oe=[],ue=u,Re=l.reparseOverscaled?_:u,ze=De=>De*De,Ke=ze((X-this._centerAltitude)*Z),Je=De=>{if(!this._elevation||!De.tileID||!S)return;let Ne=this._elevation.getMinMaxForTile(De.tileID),Ze=De.aabb;Ne?(Ze.min[2]=Ne.min,Ze.max[2]=Ne.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(De.shouldSplit=Xe(De),De.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},Xe=De=>{if(De.zoom<se)return!0;if(De.zoom===ue)return!1;if(De.shouldSplit!=null)return De.shouldSplit;let Ne=De.aabb.distanceX(K),Ze=De.aabb.distanceY(K),mt=Ke,_t=1;if(B){mt=ze(De.aabb.distanceZ(K));let it=Math.pow(2,De.zoom),$e=t.ay((De.y+1)/it),Pt=t.ay(De.y/it),hi=Math.min(Math.max(A,$e),Pt),ai=t.b4(hi)/t.b4(A);if(_t=hi===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ai/this._mercatorScaleRatio),this.zoom<=t.b1&&De.zoom===ue-1&&ai>=.9)return!0}else if(w&&(mt=ze(De.aabb.distanceZ(K)*Z)),this.projection.isReprojectedInTileSpace&&_<=5){let it=Math.pow(2,De.zoom),$e=le(new t.Y((De.x+.5)/it,(De.y+.5)/it));_t=$e>.85?1:$e}let St=Ne*Ne+Ze*Ze+mt,yt=ze((1<<ue-De.zoom)*ae*_t*((it,$e)=>{if($e*ze(.707)<it)return 1;let Pt=Math.sqrt($e/it);return Pt/(1.4144271570014144+(Math.pow(1.1,Pt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(mt,Ke),St));return St<yt};if(this.renderWorldCopies)for(let De=1;De<=3;De++)we.push(ce(-De)),we.push(ce(De));for(we.push(ce(0));we.length>0;){let De=we.pop(),Ne=De.x,Ze=De.y,mt=De.fullyVisible,_t=()=>this.projection.name==="globe"&&(De.y===0||De.y===(1<<De.zoom)-1);if(!mt){let St=re?De.aabb.intersects(H):De.aabb.intersectsFlat(H);if(St===0&&_t()){let yt=new t.aO(De.zoom,Ne,Ze);St=t.aP(this,P,yt,!0).intersects(H)}if(St===0)continue;mt=St===2}if(De.zoom!==ue&&Xe(De))for(let St=0;St<4;St++){let yt=(Ne<<1)+St%2,it=(Ze<<1)+(St>>1),$e={aabb:S?De.aabb.quadrant(St):t.aQ(this,P,De.zoom+1,yt,it,De.wrap,De.minZ,De.maxZ,this.projection),zoom:De.zoom+1,x:yt,y:it,wrap:De.wrap,fullyVisible:mt,tileID:void 0,shouldSplit:void 0,minZ:De.minZ,maxZ:De.maxZ};w&&!B&&($e.tileID=new t.aL(De.zoom+1===ue?Re:De.zoom+1,De.wrap,De.zoom+1,yt,it),Je($e)),we.push($e)}else{let St=De.zoom===ue?Re:De.zoom;if(l.minzoom&&l.minzoom>St)continue;if(!mt){let Pt=re?De.aabb.intersectsPrecise(H):De.aabb.intersectsPreciseFlat(H);if(Pt===0&&_t()){let hi=new t.aO(De.zoom,Ne,Ze);Pt=t.aP(this,P,hi,!0).intersectsPrecise(H)}if(Pt===0)continue}let yt=F[0]-(.5+Ne+(De.wrap<<De.zoom))*(1<<u-De.zoom),it=F[1]-.5-Ze,$e=De.tileID?De.tileID:new t.aL(St,De.wrap,De.zoom,Ne,Ze);Oe.push({tileID:$e,distanceSq:yt*yt+it*it})}}if(this.fogCullDistSq){let De=this.fogCullDistSq,Ne=this.horizonLineFromTop();Oe=Oe.filter(Ze=>{let mt=[0,0,0,1],_t=[t.a3,t.a3,0,1],St=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());t.aA.transformMat4(mt,mt,St),t.aA.transformMat4(_t,_t,St);let yt=t.aA.min([],mt,_t),it=t.aA.max([],mt,_t),$e=t.aR(yt,it);if($e===0)return!0;let Pt=!1,hi=this._elevation;if(hi&&$e>De&&Ne!==0){let ai=this.calculateProjMatrix(Ze.tileID.toUnwrapped()),xi;l.isTerrainDEM||(xi=hi.getMinMaxForTile(Ze.tileID)),xi||(xi={min:me,max:fe});let zi=t.b2(this.rotation),an=[zi[0]*t.a3,zi[1]*t.a3,xi.max];t._.transformMat4(an,an,ai),Pt=(1-an[1])*this.height*.5<Ne}return $e<De||Pt})}return Oe.sort((De,Ne)=>De.distanceSq-Ne.distanceSq).map(De=>De.tileID)}resize(l,u){this.width=l,this.height=u,this.pixelsToGLUnits=[2/l,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){let u=t.at(l.lat,-t.aS,t.aS),_=this.projection.project(l.lng,u);return new t.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,u){let _,x,w=this.centerPoint;if(this.projection.name==="globe"){let I=this.worldSize;_=(u.x-w.x)/I,x=(u.y-w.y)/I}else{let I=this.pointCoordinate(u),A=this.pointCoordinate(w);_=I.x-A.x,x=I.y-A.y}let S=this.locationCoordinate(l);this.setLocation(new t.Y(S.x-_,S.y-x))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,u){let _=u?t.ax(u,l.lat):void 0,x=this.projection.project(l.lng,l.lat);return new t.Y(x.x,x.y,_)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,u){let _=u??this._centerAltitude,x=[l.x,l.y,0,1],w=[l.x,l.y,1,1];t.aA.transformMat4(x,x,this.pixelMatrixInverse),t.aA.transformMat4(w,w,this.pixelMatrixInverse);let S=w[3];t.aA.scale(x,x,1/x[3]),t.aA.scale(w,w,1/S);let I=x[2],A=w[2];return{p0:x,p1:w,t:I===A?0:(_-I)/(A-I)}}screenPointToMercatorRay(l){let u=[l.x,l.y,0,1],_=[l.x,l.y,1,1];return t.aA.transformMat4(u,u,this.pixelMatrixInverse),t.aA.transformMat4(_,_,this.pixelMatrixInverse),t.aA.scale(u,u,1/u[3]),t.aA.scale(_,_,1/_[3]),u[2]=t.ax(u[2],this._center.lat)*this.worldSize,_[2]=t.ax(_[2],this._center.lat)*this.worldSize,t.aA.scale(u,u,1/this.worldSize),t.aA.scale(_,_,1/this.worldSize),new t.aT([u[0],u[1],u[2]],t._.normalize([],t._.sub([],_,u)))}rayIntersectionCoordinate(l){let{p0:u,p1:_,t:x}=l,w=t.ax(u[2],this._center.lat),S=t.ax(_[2],this._center.lat);return new t.Y(t.a2(u[0],_[0],x)/this.worldSize,t.a2(u[1],_[1],x)/this.worldSize,t.a2(w,S,x))}pointCoordinate(l,u=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,u)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let u=this.projection.pointCoordinate3D(this,l.x,l.y);if(u)return new t.Y(u[0],u[1],u[2]);let _=0,x=this.horizonLineFromTop();if(l.y>x)return this.pointCoordinate(l);let w=.02*x,S=l.clone();for(let I=0;I<10&&x-_>w;I++){S.y=t.a2(_,x,.66);let A=this.projection.pointCoordinate3D(this,S.x,S.y);A?(x=S.y,u=A):_=S.y}return u?new t.Y(u[0],u[1],u[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=t.aU)return!this.isPointAboveHorizon(l);let u=this.pointCoordinate(l);return u.y>=0&&u.y<=1}_coordinatePoint(l,u){let _=u&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,x=[l.x*this.worldSize,l.y*this.worldSize,_+l.toAltitude(),1];return t.aA.transformMat4(x,x,this.pixelMatrix),x[3]>0?new t.P(x[0]/x[3],x[1]/x[3]):new t.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:l,left:u}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new t.P(u,l)),S=this.pointLocation3D(new t.P(x,l)),I=this.pointLocation3D(new t.P(x,_)),A=this.pointLocation3D(new t.P(u,_)),P=Math.min(w.lng,S.lng,I.lng,A.lng),F=Math.max(w.lng,S.lng,I.lng,A.lng),B=Math.min(w.lat,S.lat,I.lat,A.lat),U=Math.max(w.lat,S.lat,I.lat,A.lat),H=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,Z=(X,K,re,ae,se)=>{let fe=(X+re)/2,me=(K+ae)/2,ne=new t.P(fe,me),{lng:le,lat:ce}=this.pointLocation3D(ne),we=Math.max(0,P-le,B-ce,le-F,ce-U);P=Math.min(P,le),F=Math.max(F,le),B=Math.min(B,ce),U=Math.max(U,ce),(se<q||we>H)&&(Z(X,K,fe,me,se+1),Z(fe,me,re,ae,se+1))};if(Z(u,l,x,l,1),Z(x,l,x,_,1),Z(x,_,u,_,1),Z(u,_,u,l,1),this.projection.name==="globe"){let[X,K]=t.aV(this);X?(U=90,F=180,P=-180):K&&(B=-90,F=180,P=-180)}return new t.ai(new t.aI(P,B),new t.aI(F,U))}_getBoundsRectangular(l,u){let{top:_,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,I=new t.P(x,_),A=new t.P(S,_),P=new t.P(S,w),F=new t.P(x,w),B=this.pointCoordinate(I,l),U=this.pointCoordinate(A,l),H=this.pointCoordinate(P,u),q=this.pointCoordinate(F,u),Z=(X,K)=>(K.y-X.y)/(K.x-X.x);return B.y>1&&U.y>=0?B=new t.Y((1-q.y)/Z(q,B)+q.x,1):B.y<0&&U.y<=1&&(B=new t.Y(-q.y/Z(q,B)+q.x,0)),U.y>1&&B.y>=0?U=new t.Y((1-H.y)/Z(H,U)+H.x,1):U.y<0&&B.y<=1&&(U=new t.Y(-H.y/Z(H,U)+H.x,0)),new t.ai().extend(this.coordinateLocation(B)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(H))}_getBoundsRectangularTerrain(){let l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);let u=l.visibleDemTiles.reduce((_,x)=>{if(x.dem){let w=x.dem.tree;_.min=Math.min(_.min,w.minimums[0]),_.max=Math.max(_.max,w.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*l.exaggeration(),u.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){let u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-u*(1-this._horizonShift);return l?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-t.aS,this.maxLat=t.aS,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.aj(this.minLng)*this.tileSize,this.worldMaxX=t.aj(this.maxLng)*this.tileSize,this.worldMinY=t.ak(this.maxLat)*this.tileSize,this.worldMaxY=t.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,u){return this.projection.createTileMatrix(this,u,l)}calculateDistanceTileData(l){let u=l.key,_=this._distanceTileDataCache;if(_[u])return _[u];let x=l.canonical,w=1/this.height,S=this.cameraWorldSize,I=S/this.zoomScale(x.z),A=(x.x+Math.pow(2,x.z)*l.wrap)*I,P=x.y*I,F=this.point;F.x*=S/this.worldSize,F.y*=S/this.worldSize;let B=this.angle,U=Math.sin(-B),H=-Math.cos(-B);return _[u]={bearing:[U,H],center:[(F.x-A)*w,(F.y-P)*w],scale:I/t.a3*w},_[u]}calculateFogTileMatrix(l){let u=l.key,_=this._fogTileMatrixCache;if(_[u])return _[u];let x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return t.ad.multiply(x,this.worldToFogMatrix,x),_[u]=new Float32Array(x),_[u]}calculateProjMatrix(l,u=!1,_=!1){let x=l.key,w;if(w=_?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,w[x])return w[x];let S=this.calculatePosMatrix(l,this.worldSize),I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,t.ad.multiply(S,I,S),w[x]=new Float32Array(S),w[x]}calculatePixelsToTileUnitsMatrix(l){let u=l.tileID.key,_=this._pixelsToTileUnitsCache;if(_[u])return _[u];let x=t.aW(l,this);return _[u]=x,_[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let l=1/this.worldSize,u=t.ad.fromScaling([],[l,l,l]);return t.ad.multiply(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let l=this._elevation;this._updateCameraState();let u=t.ax(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(u),x=this._camera.forward(),w=t.ax(1,this._center.lat);_[2]/=w,x[2]/=w,t._.normalize(x,x);let S=l.raycast(_,x,l.exaggeration());if(S){let I=t._.scaleAndAdd([],_,x,S),A=new t.Y(I[0],I[1],t.ax(I[2],t.ay(I[1]))),P=(A.z+t._.length([A.x-_[0],A.y-_[1],A.z-_[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;let u=this._elevation,_=t.ax(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(_),w=u.getAtPointOrZero(new t.Y(...x)),S=this.pixelsPerMeter/this.worldSize*w,I=this._minimumHeightOverTerrain(),A=x[2]-S;if(A<=I)if(A<0||l){let P=this.locationCoordinate(this._center,this._centerAltitude),F=[x[0],x[1],P.z-x[2]],B=t._.length(F);F[2]-=(I-A)/this._pixelsPerMercatorPixel;let U=t._.length(F);if(U===0)return;t._.scale(F,F,B/U*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],P.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){let U=this.center;return U.lat=t.at(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(U.lng=t.at(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}let u=this._unmodified,{x:_,y:x}=this.point,w=0,S=_,I=x,A=this.width/2,P=this.height/2,F=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(x-P<F&&(I=F+P),x+P>B&&(I=B-P),B-F<this.height&&(w=Math.max(w,this.height/(B-F)),I=(B+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let U=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,q=this.worldSize/2-(U+H)/2;S=(_+q+this.worldSize)%this.worldSize-q,S-A<U&&(S=U+A),S+A>H&&(S=H-A),H-U<this.width&&(w=Math.max(w,this.width/(H-U)),S=(H+U)/2)}S===_&&I===x||(this.center=this.unproject(new t.P(S,I))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let l=this.centerOffset,u=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=t.ax(1,this.center.lat)/t.ax(1,t.b3));let x=t.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let w=this.projection.zAxisUnit==="meters"?_:1,S=this._camera.getWorldToCamera(this.worldSize,w),I,A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-l.x/this.width,A[9]=2*l.y/this.height,this.isOrthographic){let ce=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),we=ce*this.aspect,Oe=-we,ue=-ce;we-=l.x,Oe-=l.x,ce+=l.y,ue+=l.y,I=this._camera.getCameraToClipOrthographic(Oe,we,ue,ce,this._nearZ,this._farZ),((Re,ze,Ke,Je)=>{for(let Xe=0;Xe<16;Xe++)Re[Xe]=Sf(ze[Xe],Ke[Xe],Je)})(I,I,A,Qn(this.pitch>=15?1:this.pitch/15))}else I=A;let P=t.ad.mul([],A,S),F=t.ad.mul([],I,S);if(this.projection.isReprojectedInTileSpace){let ce=this.locationCoordinate(this.center),we=t.ad.identity([]);t.ad.translate(we,we,[ce.x*this.worldSize,ce.y*this.worldSize,0]),t.ad.multiply(we,we,t.aY(this)),t.ad.translate(we,we,[-ce.x*this.worldSize,-ce.y*this.worldSize,0]),t.ad.multiply(F,F,we),t.ad.multiply(P,P,we),this.inverseAdjustmentMatrix=t.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=t.ad.scale([],F,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=F,this.invProjMatrix=t.ad.invert(new Float64Array(16),this.projMatrix),u){let ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ce[8]=2*-l.x/this.width,ce[9]=2*l.y/this.height,this.expandedFarZProjMatrix=t.ad.mul([],ce,S)}else this.expandedFarZProjMatrix=this.projMatrix;let B=t.ad.invert([],I);this.frustumCorners=t.a_.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height),this.cameraFrustum=t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);let U=new Float32Array(16);t.ad.identity(U),t.ad.scale(U,U,[1,-1,1]),t.ad.rotateX(U,U,this._pitch),t.ad.rotateZ(U,U,this.angle);let H=t.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=t.ad.clone(H);let q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-l.x/this.width,H[9]=2*(l.y+q)/this.height,this.skyboxMatrix=t.ad.multiply(U,H,U);let Z=this.point,X=Z.x,K=Z.y,re=this.width%2/2,ae=this.height%2/2,se=Math.cos(this.angle),fe=Math.sin(this.angle),me=X-Math.round(X)+se*re+fe*ae,ne=K-Math.round(K)+se*ae+fe*re,le=new Float64Array(F);if(t.ad.translate(le,le,[me>.5?me-1:me,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=le,F=t.ad.create(),t.ad.scale(F,F,[this.width/2,-this.height/2,1]),t.ad.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=t.ad.create(),t.ad.scale(F,F,[1,-1,1]),t.ad.translate(F,F,[-1,-1,0]),t.ad.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=t.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},F=t.ad.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=t.a$(this);let ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t._.transformMat4(ce,ce,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let l=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[l,l,u];t._.scale(w,w,x),t._.scale(_,_,-1),t._.multiply(_,_,w);let S=t.ad.create();t.ad.translate(S,S,_),t.ad.scale(S,S,w),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,u,x)}_computeCameraPosition(l){let u=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-l/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*w,x.y/this.worldSize-_[1]*w,l/this.worldSize*this._centerAltitude-_[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){let u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],x=l[2],w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((u-_)/x,1)),this._camera.position=t._.scaleAndAdd([],this._camera.position,l,w),this._updateStateFromCamera()}_updateStateFromCamera(){let l=this._camera.position,u=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),w=t.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.ab(this._maxPitch)),I=Math.max((l[2]-w)/Math.cos(_),S),A=this._zoomFromMercatorZ(I);t._.scaleAndAdd(l,l,u,I),this._pitch=t.at(_,t.ab(this.minPitch),t.ab(this.maxPitch)),this.angle=t.au(x,-Math.PI,Math.PI),this._setZoom(t.at(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.Y(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){let l=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let u=0,_=t.aU,x=0,w=1/0;for(;_-u>1e-6&&_>u;){let S=u+.5*(_-u),I=this.tileSize*Math.pow(2,S),A=this.getCameraToCenterDistance(this.projection,S,I),P=this.scaleZoom(A/(l*this.tileSize)),F=Math.abs(S-P);F<w&&(w=F,x=S),S<P?u=S:_=S}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,u){let _=Math.min(l.x,u.x),x=Math.max(l.x,u.x),w=Math.min(l.y,u.y),S=Math.max(l.y,u.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let I=[new t.P(_,w),new t.P(x,S),new t.P(_,S),new t.P(x,w)],A=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(let F of I){let B=this.pointRayIntersection(F);if(B.t<0)return!0;let U=this.rayIntersectionCoordinate(B);if(U.x<A||U.y<0||U.x>P||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.P(0,0),new t.P(this.width,this.height))}zoomDeltaToMovement(l,u){let _=t._.length(t._.sub([],this._camera.position,l)),x=this._zoomFromMercatorZ(_)+u;return _-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){let l=function([u,_,x],w){let S=[u,_,x,1];t.aA.transformMat4(S,S,w);let I=S[3]=Math.max(S[3],1e-6);return S[0]/=I,S[1]/=I,S[2]/=I,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.P(l[0],l[1])}{let l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,l))}}getCameraToCenterDistance(l,u=this.zoom,_=this.worldSize){let x=t.aX(l,u,this.width,this.height,1024),w=l.pixelSpaceConversion(this.center.lat,_,x),S=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(S=Sf(1,S,Qn(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){let l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&t.ad.multiply(l,l,this.globeMatrix),l}getFrustum(l){return t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.zAxisUnit==="meters")}}let eo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},ss=(f,l)=>{if(l>0&&f.terrain&&t.w("Cutoff is currently disabled on terrain"),l<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let u=f.transform,_=Math.max(Math.abs(u._zoom-(f.minCutoffZoom-1)),1),x=u.isLODDisabled(!1)?t.$(60,45,u.pitch):t.$(30,15,u.pitch),w=u._farZ-u._nearZ,S=l*u.height,I=((1-(A=x))*u.cameraToCenterDistance+A*(u._farZ+S))*_;var A;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(I-u._nearZ)/w,(I-S-u._nearZ)/w]}}},Or={cascadeCount:2,shadowMapResolution:2048};class Mf{constructor(l,u){this.aabb=l,this.lastCascade=u}}class Tf{add(l,u){let _=this.receivers[l.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],u.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],u.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],u.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],u.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],u.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],u.max[2])):this.receivers[l.key]=new Mf(u,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,u,_){let x=t.b6.fromPoints(l.points),w=0;for(let S in this.receivers){let I=this.receivers[S];if(!I||!x.intersectsAabb(I.aabb))continue;I.aabb.min=x.closestPoint(I.aabb.min),I.aabb.max=x.closestPoint(I.aabb.max);let A=I.aabb.getCorners();for(let P=0;P<_.length;P++){let F=!0;for(let B of A){let U=[B[0]*u,B[1]*u,B[2]];if(t._.transformMat4(U,U,_[P].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){F=!1;break}}if(I.lastCascade=P,w=Math.max(w,P),F)break}}return w+1}}class Qu{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Tf,this._depthMode=new t.ae(l.context.gl.LEQUAL,t.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,l.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),l.tp.registerParameter(Or,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(Or,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),l.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,u){let _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;let x=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||x<=0||(this._shadowLayerCount=_.style.order.reduce((q,Z)=>{let X=_.style._mergedLayers[Z];return q+(X.hasShadowPass()&&!X.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let w=_.context,S=Or.shadowMapResolution,I=Or.shadowMapResolution;if(this._cascades.length===0||Or.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<Or.cascadeCount;++q){let Z=_._shadowMapDebug,X=w.gl,K=w.createFramebuffer(S,I,Z,"texture"),re=new t.T(w,{width:S,height:I,data:null},X.DEPTH_COMPONENT);if(K.depthAttachment.set(re.texture),Z){let ae=new t.T(w,{width:S,height:I,data:null},X.RGBA);K.colorAttachment.set(ae.texture)}this._cascades.push({framebuffer:K,texture:re,matrix:[],far:0,boundingSphereRadius:0,frustum:new t.aM,scale:0})}}this.shadowDirection=_h(u);let A=0;if(l.elevation){let q=l.elevation,Z=[1e4,-1e4];q.visibleDemTiles.filter(X=>X.dem).forEach(X=>{let K=X.dem.tree;Z[0]=Math.min(Z[0],K.minimums[0]),Z[1]=Math.max(Z[1],K.maximums[0])}),Z[0]!==1e4&&(A=(Z[1]-Z[0])*q.exaggeration())}let P=1.5*l.cameraToCenterDistance,F=3*P,B=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){let Z=this._cascades[q],X=l.height/50,K=1;Or.cascadeCount===1?K=F:q===0?K=P:(X=P,K=F);let[re,ae]=yh(l,this.shadowDirection,X,K,Or.shadowMapResolution,A);Z.scale=l.scale,Z.matrix=re,Z.boundingSphereRadius=ae,t.ad.invert(B,Z.matrix),Z.frustum=t.aM.fromInvProjectionMatrix(B,1,0,!0),Z.far=K}let U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Or.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Or.shadowMapResolution,this._uniformValues.u_shadowmap_0=eo.ShadowMap0,this._uniformValues.u_shadowmap_1=eo.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let H=_.transform.elevation;for(let q of this._groundShadowTiles){let Z={min:0,max:0};if(H){let X=H.getMinMaxForTile(q);X&&(Z=X)}this.addShadowReceiver(q.toUnwrapped(),Z.min,Z.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(l){this._enabled=l}drawShadowPass(l,u){if(!this.enabled)return;let _=this.painter,x=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),x.viewport.set([0,0,Or.shadowMapResolution,Or.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){_.currentShadowCascade=w,x.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),x.clear({color:t.C.white,depth:1});for(let S of l.order){let I=l._mergedLayers[S];if(!I.hasShadowPass()||I.isHidden(_.transform.zoom))continue;let A=l.getLayerSourceCache(I),P=A?u[A.id]:void 0;(I.type==="model"||P&&P.length)&&_.renderLayer(_,A,I,P)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let l=this.painter,u=l.style,_=l.context,x=u.directionalLight,w=u.ambientLight;if(!x||!w)return;let S=[],I=ss(l,l.longestCutoffRange);I.shouldRenderCutoff&&S.push("RENDER_CUTOFF");let A=ls(u,x,w),P=new t.ae(_.gl.LEQUAL,t.ae.ReadOnly,l.depthRangeFor3D);for(let F of this._groundShadowTiles){let B=F.toUnwrapped(),U=l.isTileAffectedByFog(F),H=l.getOrCreateProgram("groundShadow",{defines:S,overrideFog:U});this.setupShadows(B,H),l.uploadCommonUniforms(_,H,B,null,I);let q={u_matrix:l.transform.calculateProjMatrix(B),u_ground_shadow_factor:A};H.draw(l,_.gl.TRIANGLES,P,t.ag.disabled,t.a.multiply,t.af.disabled,q,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,{},l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?t.a.unblended:t.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){let u=this.painter.transform,_=u.calculatePosMatrix(l,u.worldSize);return t.ad.multiply(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(l){return t.ad.multiply(l,this._cascades[this.painter.currentShadowCascade].matrix,l),Float32Array.from(l)}setupShadows(l,u,_,x=0){if(!this.enabled)return;let w=this.painter.transform,S=this.painter.context,I=S.gl,A=this._uniformValues,P=new Float64Array(16),F=w.calculatePosMatrix(l,w.worldSize);for(let B=0;B<this._cascades.length;B++)t.ad.multiply(P,this._cascades[B].matrix,F),A[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),S.activeTexture.set(I.TEXTURE0+eo.ShadowMap0+B),this._cascades[B].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!_,this.useNormalOffset){let B=t.b5(l.canonical),U=2/w.tileSize*t.a3/Or.shadowMapResolution,H=U*this._cascades[0].boundingSphereRadius,q=U*this._cascades[this._cascades.length-1].boundingSphereRadius,Z=(_==="vector-tile"?1:3)/Math.pow(2,x-l.canonical.z-(1-w.zoom+Math.floor(w.zoom)));A.u_shadow_normal_offset=[B,H*Z,q*Z],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(S,A)}setupShadowsFromMatrix(l,u,_=!1){if(!this.enabled)return;let x=this.painter.context,w=x.gl,S=this._uniformValues,I=new Float64Array(16);for(let A=0;A<Or.cascadeCount;A++)t.ad.multiply(I,this._cascades[A].matrix,l),S[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),x.activeTexture.set(w.TEXTURE0+eo.ShadowMap0+A),this._cascades[A].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);this.useNormalOffset=_,_?(S.u_shadow_normal_offset=[1,5,5],S.u_shadow_bias=[6e-5,.0012,.012]):S.u_shadow_bias=[36e-5,.0012,.012],u.setShadowUniformValues(x,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,u,_,x){if(x[2]>=0)return{};let w=function(A,P,F){let B=F/(1<<A.canonical.z);return new t.b6([A.canonical.x*B+A.wrap*F,A.canonical.y*B+A.wrap*F,0],[(A.canonical.x+1)*B+A.wrap*F,(A.canonical.y+1)*B+A.wrap*F,P])}(l,u,_).getCorners(),S=u/-x[2];x[0]<0?(t._.add(w[0],w[0],[x[0]*S,0,0]),t._.add(w[3],w[3],[x[0]*S,0,0])):x[0]>0&&(t._.add(w[1],w[1],[x[0]*S,0,0]),t._.add(w[2],w[2],[x[0]*S,0,0])),x[1]<0?(t._.add(w[0],w[0],[0,x[1]*S,0]),t._.add(w[1],w[1],[0,x[1]*S,0])):x[1]>0&&(t._.add(w[2],w[2],[0,x[1]*S,0]),t._.add(w[3],w[3],[0,x[1]*S,0]));let I={};return I.vertices=w,I.planes=[Fc(w[1],w[0],w[4]),Fc(w[2],w[1],w[5]),Fc(w[3],w[2],w[6]),Fc(w[0],w[3],w[7])],I}addShadowReceiver(l,u,_){this._receivers.add(l,t.b6.fromTileIdAndHeight(l,u,_))}getMaxCascadeForTile(l){let u=this._receivers.get(l);return u&&u.lastCascade?u.lastCascade:0}}function Fc(f,l,u){let _=t._.sub([],u,l),x=t._.sub([],f,l),w=t._.cross([],_,x),S=t._.length(w);return S===0?[0,0,1,0]:(t._.scale(w,w,1/S),[w[0],w[1],w[2],-t._.dot(w,l)])}function _h(f){let l=f.properties.get("direction"),u=t.ac(l.x,l.y,l.z);u[2]=t.at(u[2],0,75);let _=t.b7([u[0],u[1],u[2]]);return t._.fromValues(_.x,_.y,_.z)}function ls(f,l,u){let _=l.properties.get("color"),x=l.properties.get("intensity"),w=l.properties.get("direction"),S=[w.x,w.y,w.z],I=u.properties.get("color"),A=u.properties.get("intensity"),P=Math.max(t._.dot([0,0,1],S),0),F=[0,0,0];t._.scale(F,I.toRenderColor(f.getLut(l.scope)).toArray01Linear().slice(0,3),A);let B=[0,0,0];return t._.scale(B,_.toRenderColor(f.getLut(u.scope)).toArray01Linear().slice(0,3),P*x),t.b8([F[0]>0?F[0]/(F[0]+B[0]):0,F[1]>0?F[1]/(F[1]+B[1]):0,F[2]>0?F[2]/(F[2]+B[2]):0])}function yh(f,l,u,_,x,w){let S=f.zoom,I=f.scale,A=f.worldSize,P=1/A,F=f.aspect,B=Math.sqrt(1+F*F)*Math.tan(.5*f.fovX),U=B*B,H=_-u,q=_+u,Z,X;U>H/q?(Z=_,X=_*B):(Z=.5*q*(1+U),X=.5*Math.sqrt(H*H+2*(_*_+u*u)*U+q*q*U*U));let K=f.projection.pixelsPerMeter(f.center.lat,A),re=f._camera.getCameraToWorldMercator(),ae=[0,0,-Z*P];t._.transformMat4(ae,ae,re);let se=X*P,fe=f._edgeInsets;if(!(fe.left===0&&fe.top===0&&fe.right===0&&fe.bottom===0||fe.left===fe.right&&fe.top===fe.bottom)){let mt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?K:1),_t=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,u,_);_t[8]=2*-f.centerOffset.x/f.width,_t[9]=2*f.centerOffset.y/f.height;let St=new Float64Array(16);t.ad.mul(St,_t,mt);let yt=new Float64Array(16);t.ad.invert(yt,St);let it=t.aM.fromInvProjectionMatrix(yt,A,S,!0);for(let $e of it.points){let Pt=((me=$e)[0]/=I,me[1]/=I,me[2]=t.ax(me[2],f._center.lat),me);se=Math.max(se,t._.len(t._.subtract([],ae,Pt)))}}var me;se*=x/(x-1);let ne=Math.acos(l[2]),le=Math.atan2(-l[0],-l[1]),ce=new fh;ce.position=ae,ce.setPitchBearing(ne,le);let we=ce.getWorldToCamera(A,K),Oe=se*A,ue=Math.min(f._mercatorZfromZoom(17)*A*-2,-2*Oe),Re=ce.getCameraToClipOrthographic(-Oe,Oe,-Oe,Oe,ue,(Oe+w*K)/l[2]),ze=new Float64Array(16);t.ad.multiply(ze,Re,we);let Ke=t._.fromValues(Math.floor(1e6*ae[0])/1e6*A,Math.floor(1e6*ae[1])/1e6*A,0),Je=.5*x,Xe=[0,0,0];t._.transformMat4(Xe,Ke,ze),t._.scale(Xe,Xe,Je);let De=[Math.floor(Xe[0]),Math.floor(Xe[1]),Math.floor(Xe[2])],Ne=[0,0,0];t._.sub(Ne,Xe,De),t._.scale(Ne,Ne,-1/Je);let Ze=new Float64Array(16);return t.ad.identity(Ze),t.ad.translate(Ze,Ze,Ne),t.ad.multiply(ze,Ze,ze),[ze,Oe]}function Ju(f,l){return f!=null&&l!=null&&!(!f.hasData()||!l.hasData())&&f.demTexture!=null&&l.demTexture!=null&&f.tileID.key!==l.tileID.key}let Tl=new class{constructor(){this.operations={}}newMorphing(f,l,u,_,x){if(f in this.operations){let w=this.operations[f];w.to.tileID.key!==u.tileID.key&&(w.queued=u)}else this.operations[f]={startTime:_,phase:0,duration:x,from:l,to:u,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;let l=this.operations[f];return{from:l.from,to:l.to,phase:l.phase}}update(f){for(let l in this.operations){let u=this.operations[l];for(u.phase=(f-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,f)){delete this.operations[l];break}}}_nextOp(f,l){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=l,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},bh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function If(f,l,u){if(l===0)return 0;let _=l<1&&u===514?.25/l:1;return 6*Math.pow(1.5,22-f)*Math.max(l,1)*_}function z0(f,l){let u=1<<f.z;return!l&&(f.x===0||f.x===u-1)||f.y===0||f.y===u-1}let ep=f=>({u_matrix:f});function tp(f,l,u,_,x){if(x>0){let w=t.e.now(),S=(w-f.timeAdded)/x,I=l?(w-l.timeAdded)/x:-1,A=u.getSource(),P=_.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!l||Math.abs(l.tileID.overscaledZ-P)>Math.abs(f.tileID.overscaledZ-P),B=F&&f.refreshedUponExpiration?1:t.at(F?S:1-I,0,1);return f.refreshedUponExpiration&&S>=1&&(f.refreshedUponExpiration=!1),l?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class Lc extends ph{constructor(l,u,_,x){super(l,u,_,x),this.type="raster-array",this.maxzoom=22,this._options=t.W({type:"raster-array"},u)}triggerRepaint(l){let u=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);u&&u.enabled&&_&&u._clearRenderCacheForTile(_.id,l.tileID),this.map.triggerRepaint()}loadTile(l,u){let _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(_,t.R.Tile);l.requestParams=x,l.actor||(l.actor=this.dispatcher.getActor()),l.request=l.fetchHeader(void 0,(w,S,I,A)=>{if(delete l.request,l.aborted)return l.state="unloaded",u(null);if(w)return w.code===20?void 0:(l.state="errored",u(w));this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:I,expires:A}),l.state="empty",u(null)})}unloadTile(l,u){let _=l.texture;_&&_ instanceof t.T?(l.destroy(!0),this.map.painter.saveTileTexture(_)):(l.destroy(),l.flushQueues(),l._isHeaderLoaded=!1,delete l._mrt,delete l.textureDescriptor),l.fbo&&(l.fbo.destroy(),delete l.fbo),delete l.request,delete l.requestParams,delete l.neighboringTiles,l.state="unloaded"}prepareTile(l,u,_){l._isHeaderLoaded&&(l.state!=="empty"&&(l.state="reloading"),l.fetchBand(u,_,(x,w)=>{if(x)return l.state="errored",this.fire(new t.d(x)),void this.triggerRepaint(l);w&&(l.setTexture(w,this.map.painter),l.state="loaded",this.triggerRepaint(l))}))}getInitialBand(l){if(!this.rasterLayers)return 0;let u=this.rasterLayers.find(({id:w})=>w===l),_=u&&u.fields,x=_&&_.bands&&_.bands;return x?x[0]:0}getTextureDescriptor(l,u,_){if(!l)return;let x=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let w=null;u instanceof t.bk?w=u.paint.get("raster-array-band"):u instanceof t.bl&&(w=u.paint.get("raster-particle-array-band"));let S=w||this.getInitialBand(x);if(S!=null)if(l.textureDescriptor){if(!l.updateNeeded(x,S)||_)return Object.assign({},l.textureDescriptor,{texture:l.texture})}else this.prepareTile(l,x,S)}}let Rr={vector:Yu,raster:ph,"raster-dem":class extends ph{constructor(f,l,u,_){super(f,l,u,_),this.type="raster-dem",this.maxzoom=22,this._options=t.W({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(f,l){let u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,w){x&&(f.state="errored",l(x)),w&&(f.dem=w,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",l(null))}f.request=t.h(this.map._requestManager.transformRequest(u,t.R.Tile),(function(x,w,S,I){if(delete f.request,f.aborted)f.state="unloaded",l(null);else if(x)f.state="errored",l(x);else if(w){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:S,expires:I});let A=ImageBitmap&&w instanceof ImageBitmap&&t.bi(),P=1-(w.width-t.bj(w.width))/2;P<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));let F=A?w:t.e.getImageData(w,P),B={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:P};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",B,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){let l=f.canonical,u=Math.pow(2,l.z),_=(l.x-1+u)%u,x=l.x===0?f.wrap-1:f.wrap,w=(l.x+1+u)%u,S=l.x+1===u?f.wrap+1:f.wrap,I={};return I[new t.aL(f.overscaledZ,x,l.z,_,l.y).key]={backfilled:!1},I[new t.aL(f.overscaledZ,S,l.z,w,l.y).key]={backfilled:!1},l.y>0&&(I[new t.aL(f.overscaledZ,x,l.z,_,l.y-1).key]={backfilled:!1},I[new t.aL(f.overscaledZ,f.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},I[new t.aL(f.overscaledZ,S,l.z,w,l.y-1).key]={backfilled:!1}),l.y+1<u&&(I[new t.aL(f.overscaledZ,x,l.z,_,l.y+1).key]={backfilled:!1},I[new t.aL(f.overscaledZ,f.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},I[new t.aL(f.overscaledZ,S,l.z,w,l.y+1).key]={backfilled:!1}),I}},"raster-array":Lc,geojson:class extends t.E{constructor(f,l,u,_){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(_),this._data=l.data,this._options=t.W({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.minzoom!==void 0&&(this.minzoom=l.minzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;let x=t.a3/this.tileSize;this.workerOptions=t.W({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*x,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*x,extent:t.a3,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:t.a3,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*x,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter,dynamic:l.dynamic},l.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){return this._options.dynamic?typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection")?this.fire(new t.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...f.features):this._data=f,this._updateWorkerData(!0),this):this.fire(new t.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(f,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},l),this}getClusterChildren(f,l){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},l),this}getClusterLeaves(f,l,u,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:l,offset:u},_),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.f("dataloading",{dataType:"source"})),this._loaded=!1;let l=t.W({append:f},this.workerOptions);l.scope=this.scope;let u=this._data;typeof u=="string"?(l.request=this.map._requestManager.transformRequest(t.e.resolveURL(u),t.R.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(_,x)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new t.d(_));else{let w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(w.resourceTiming=x.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new t.f("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,l){let u=f.actor?"reloadTile":"loadTile";f.actor=this.actor;let _=this.map.style?this.map.style.getLut(this.scope):null,x=this._partialReload,w={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_?{image:_.image.clone()}:null,scope:this.scope,pixelRatio:t.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:x};f.request=this.actor.send(u,w,(S,I)=>x&&!I?(f.state="loaded",l(null)):(delete f.request,f.destroy(),f.aborted?l(null):S?l(S):(f.loadVectorData(I,this.map.painter,u==="reloadTile"),l(null))),void 0,u==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,l){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends t.bm{constructor(f,l,u,_){super(f,l,u,_),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;let f=this.options;this.urls=[];for(let l of f.urls)this.urls.push(this.map._requestManager.transformRequest(l,t.R.Source).url);t.bn(this.urls,(l,u)=>{this._loaded=!0,l?this.fire(new t.d(l)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){let l=this.video.seekable;f<l.start(0)||f>l.end(0)?this.fire(new t.d(new t.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let f=this.map.painter.context,l=f.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(f,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:t.bm,model:class extends t.E{constructor(f,l,u,_){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=l}load(){let f=[];for(let l in this._options.models){let u=this._options.models[l],_=t.l(this.map._requestManager.transformRequest(u.uri,t.R.Model).url).then(x=>{if(!x)return;let w=t.c(x),S=new t.M(l,u.position,u.orientation,w);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(x=>{this.fire(new t.d(new Error(`Could not load model ${l} from ${u.uri}: ${x.message}`)))});f.push(_)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this.fire(new t.d(new Error(`Could not load models: ${l.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,l){}serialize(){return{type:"model"}}},"batched-model":class extends t.E{constructor(f,l,u,_){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"}));let l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=vf(this._options,this.map._requestManager,l,u,(_,x)=>{this._tileJSONRequest=null,this._loaded=!0,_?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new t.d(_))):x&&(t.W(this,x),x.bounds&&(this.tileBounds=new uh(x.bounds,this.minzoom,this.maxzoom)),t.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),f&&f(_)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,l){let u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(u,t.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=l;else{if(f.buckets){let w=Object.values(f.buckets);for(let S of w)S.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",_,x.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",_,x.bind(this),void 0,!0);function x(w,S){return f.aborted?l(null):w&&w.status!==404?l(w):(S&&(S.resourceTiming&&(f.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&f.setExpiryData(S),f.buckets=kt(kt({},f.buckets),S.buckets),S.featureIndex&&(f.latestFeatureIndex=S.featureIndex)),f.state="loaded",void l(null))}}serialize(){return t.W({},this._options)}},canvas:class extends t.bm{constructor(f,l,u,_){super(f,l,u,_),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(w=>typeof w!="number"))||this.fire(new t.d(new t.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.d(new t.V(`sources.${f}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new t.d(new t.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new t.d(new t.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.d(new t.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let l=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof t.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends t.E{constructor(f,l,u,_){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=l,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new uh(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),t.W(this,t.ah(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){let{x:l,y:u,z:_}=f.canonical;return this._implementation.hasTile({x:l,y:u,z:_})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,l){let{x:u,y:_,z:x}=f.tileID.canonical,w=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:u,y:_,z:x},{signal:w.signal})).then((function(S){return delete f.request,f.aborted?(f.state="unloaded",l(null)):S===void 0?(f.state="errored",l(null)):S===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",l(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(S)?(this.loadTileData(f,S),f.state="loaded",void l(null)):(f.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(f.state="errored",l(S))}),f.request.cancel=()=>w.abort()}loadTileData(f,l){f.setTexture(l,this._map.painter)}unloadTile(f,l){if(f.texture&&f.texture instanceof t.T?(f.destroy(!0),f.texture&&f.texture instanceof t.T&&this._map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){let{x:u,y:_,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:u,y:_,z:x})}l&&l()}abortTile(f,l){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),l&&l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){let f=t.al(this.id,this.scope);this._map.style.clearSource(f)}_update(){this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))}}},ip=function(f,l,u,_){let x=new Rr[l.type](f,l,u,_);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return t.bp(["load","abort","unload","serialize","prepare"],x),x};class Ef extends t.bv{constructor(l){let u={type:"raster-dem",maxzoom:l.transform.maxZoom},_=new t.bw(t.bx(),null),x=ip("mock-dem",u,_,l.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,u){l.state="loaded",u(null)}}class B0 extends t.bv{constructor(l){let u=ip("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new t.bw(t.bx(),null),l.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,u,_){if(l.freezeTileCoverage)return;this.transform=l;let x=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,S)=>{if(w[S.key]="",!this._tiles[S.key]){let I=new t.by(S,this._source.tileSize*S.overscaleFactor(),l.tileZoom);I.state="loaded",this._tiles[S.key]=I}return w},{});for(let w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(l){let u=this.proxyCachedFBO[l];if(u!==void 0){let _=Object.values(u);this.renderCachePool.push(..._),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Df extends t.aL{constructor(l,u,_){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=u,this.projMatrix=_}}class kf extends t.bq{constructor(l,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[_,x,w]=function(A){let P=new t.bt,F=new t.bu,B=131;P.reserve(17161),F.reserve(33800);let U=t.a3/128,H=t.a3+U/2,q=H+U;for(let X=-U;X<q;X+=U)for(let K=-U;K<q;K+=U){let re=K<0||K>H||X<0||X>H?24575:0,ae=t.at(Math.round(K),0,t.a3),se=t.at(Math.round(X),0,t.a3);P.emplaceBack(ae+re,se)}let Z=(X,K)=>{let re=K*B+X;F.emplaceBack(re+1,re,re+B),F.emplaceBack(re+B,re+B+1,re+1)};for(let X=1;X<129;X++)for(let K=1;K<129;K++)Z(K,X);return[0,129].forEach(X=>{for(let K=0;K<130;K++)Z(K,X),Z(X,K)}),[P,F,32768]}(),S=l.context;this.gridBuffer=S.createVertexBuffer(_,t.br.members),this.gridIndexBuffer=S.createIndexBuffer(x),this.gridSegments=t.b.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=t.b.simpleSegment(0,0,_.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new B0(u.map),this.orthoMatrix=t.ad.create(),t.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,t.a3,0,t.a3,0,1);let I=S.gl;this._overlapStencilMode=new t.ag({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ef(u.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,u,_){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);let x=l.terrain.properties,w=l.terrain.drapeRenderMode===0,S=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=t.e.now();let I=l.terrain&&l.terrain.scope,A=x.get("source"),P=w?this._mockSourceCache:l.getSourceCache(A,I);if(!P)return void t.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=P,this._exaggeration=S?this.calculateExaggeration(u):x.get("exaggeration"),!u.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;let F=()=>{this.sourceCache.used&&t.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let B=this.getScaledDemTileSize();this.sourceCache.update(u,B,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),u.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(l){let u=this._previousCameraAltitude,_=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=_;let x=u!=null?_-u:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;let w=l.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(w);let I=w-this._previousZoom,A=this._previousUpdateTimestamp,P=w;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(w-P)>.5&&(I=.5*(w-P+I)),I*x<0&&(P+=I)),this._evaluationZoom=P;let F=S.getExaggeration(P),B=F===S.getExaggeration(Math.max(0,P-.1));if(B&&Math.abs(F-this._exaggeration)<.01)return F;let U=Math.min(.1,.00375*(this._updateTimestamp-A));return(B||F<.1||Math.abs(I)<1e-4)&&(U=Math.min(.2,4*U)),t.a2(this._exaggeration,F,U)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let u=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(t.Y.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let x=this.proxyCoords=u.getIds().map(A=>{let P=u.getTileByID(A).tileID;return P.projMatrix=_.calculateProjMatrix(P.toUnwrapped()),P});(function(A,P){let F=P.transform.pointCoordinate(P.transform.getCameraPoint()),B=new t.P(F.x,F.y);A.sort((U,H)=>{if(H.overscaledZ-U.overscaledZ)return H.overscaledZ-U.overscaledZ;let q=new t.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Z=new t.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),X=B.mult(1<<U.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(q)-X.distSqr(Z)})})(x,this.painter);let w=this.proxyToSource||{};this.proxyToSource={},x.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};let S=this._style._mergedSourceCaches;for(let A in S){let P=S[A];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,l[A],w),P.usedForTerrain))continue;let F=l[A];P.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[u.id]=x.map(A=>new Df(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;let I={};this._visibleDemTiles=[];for(let A of this.proxyCoords){let P=this.terrainTileForTile[A.key];if(!P)continue;let F=P.tileID.key;F in I||(this._visibleDemTiles.push(P),I[F]=F)}}_assignTerrainTiles(l){this._initializing||l.forEach(u=>{if(this.terrainTileForTile[u.key])return;let _=this._findTileCoveringTileID(u,this.sourceCache);_&&(this.terrainTileForTile[u.key]=_)})}_prepareDEMTextures(){let l=this.painter.context,u=l.gl;for(let _ in this.terrainTileForTile){let x=this.terrainTileForTile[_],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(l.activeTexture.set(u.TEXTURE1),bf(this.painter,x,w))}}_prepareDemTileUniforms(l,u,_,x){if(!u||u.demTexture==null)return!1;let w=l.tileID.canonical,S=Math.pow(2,u.tileID.canonical.z-w.z),I=x||"";return _[`u_dem_tl${I}`]=[w.x*S%1,w.y*S%1],_[`u_dem_scale${I}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let l=this.painter.context,u=l.gl;if(!this._emptyDepthBufferTexture){let _=new t.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.T(l,_,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let l=0,u=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;let w=x.dem.tree.minimums[0];return w>0&&l++,_+w},0);return l?u/l:0}_updateEmptyDEMTexture(){let l=this.painter.context,u=l.gl;l.activeTexture.set(u.TEXTURE2);let _=this._getLoadedAreaMinimum(),[x,w]=(()=>{let I=new t.bz({width:1,height:1},new Float32Array([_]));return[u.R32F,I]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(w,{premultiply:!1}):S=this._emptyDEMTexture=new t.T(l,w,x,{premultiply:!1}),S}setupElevationDraw(l,u,_){let x=this.painter.context,w=x.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};S.u_exaggeration=this.exaggeration();let I=null,A=null,P=1;if(_&&_.morphing&&this._useVertexMorphing){let H=_.morphing.srcDemTile,q=_.morphing.dstDemTile;P=_.morphing.phase,H&&q&&(this._prepareDemTileUniforms(l,H,S,"_prev")&&(A=H),this._prepareDemTileUniforms(l,q,S)&&(I=q))}let F=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST,B=null;var U;if(this.enabled?A&&I?(B=I.demTexture,x.activeTexture.set(w.TEXTURE4),A.demTexture.bind(F(A),w.CLAMP_TO_EDGE),S.u_dem_lerp=P):(I=this.terrainTileForTile[l.tileID.key],B=this._prepareDemTileUniforms(l,I,S)?I.demTexture:this.emptyDEMTexture):B=this.emptyDEMTexture,x.activeTexture.set(w.TEXTURE2),B&&(S.u_dem_size=(U=B).size[0]===1?1:U.size[0]-2,B.bind(F(I),w.CLAMP_TO_EDGE)),x.activeTexture.set(w.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&I){let H=(1<<I.tileID.canonical.z)*t.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=H}if(_&&_.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),u.setTerrainUniformValues(x,S),this.painter.transform.projection.name==="globe"){let H=this.globeUniformValues(this.painter.transform,l.tileID.canonical,_&&_.useDenormalizedUpVectorScale);u.setGlobeUniformValues(x,H)}}globeUniformValues(l,u,_){let x=l.projection;return{u_tile_tl_up:x.upVector(u,0,0),u_tile_tr_up:x.upVector(u,t.a3,0),u_tile_br_up:x.upVector(u,t.a3,t.a3),u_tile_bl_up:x.upVector(u,0,t.a3),u_tile_up_scale:_?t.bs(1):x.upVectorScale(u,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){let u=this.painter,_=this.painter.context;l.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,S,I,A){if(x.transform.projection.name==="globe")(function(P,F,B,U,H){let q=P.context,Z=q.gl,X,K,re=P.transform,ae=t.ba(P,q,re),se=(Re,ze)=>{if(K===ze)return;let Ke=[bh[ze],"PROJECTION_GLOBE_VIEW"];ae&&Ke.push("CUSTOM_ANTIALIASING");let Je=P.isTileAffectedByFog(Re);X=P.getOrCreateProgram("globeRaster",{defines:Ke,overrideFog:Je}),K=ze},fe=P.colorModeForRenderPass(),me=new t.ae(Z.LEQUAL,t.ae.ReadWrite,P.depthRangeFor3D);Tl.update(H);let ne=t.bb(re),le=[t.aj(re.center.lng),t.ak(re.center.lat)],ce=P.globeSharedBuffers,we=[re.width*t.e.devicePixelRatio,re.height*t.e.devicePixelRatio],Oe=Float32Array.from(re.globeMatrix),ue={useDenormalizedUpVectorScale:!0};{let Re=P.transform,ze=If(Re.zoom,F.exaggeration(),F.sourceCache._source.tileSize);K=-1;let Ke=Z.TRIANGLES;for(let Je of U){let Xe=B.getTile(Je),De=t.ag.disabled,Ne=F.prevTerrainTileForTile[Je.key],Ze=F.terrainTileForTile[Je.key];Ju(Ne,Ze)&&Tl.newMorphing(Je.key,Ne,Ze,H,250),q.activeTexture.set(Z.TEXTURE0),Xe.texture&&Xe.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let mt=Tl.getMorphValuesForProxy(Je.key),_t=mt?1:0;mt&&t.o(ue,{morphing:{srcDemTile:mt.from,dstDemTile:mt.to,phase:t.b9(mt.phase)}});let St=t.bc(Je.canonical),yt=t.bd(St.getCenter().lat),it=t.be(Je.canonical,St,yt,Re.worldSize/Re._pixelsPerMercatorPixel),$e=t.bf(t.bg(Je.canonical)),Pt=F0(Re.expandedFarZProjMatrix,Oe,ne,$e,t.a1(Re.zoom),le,Re.frustumCorners.TL,Re.frustumCorners.TR,Re.frustumCorners.BR,Re.frustumCorners.BL,Re.globeCenterInViewSpace,Re.globeRadius,we,ze,Re._farZ,it);if(se(Je,_t),X&&(F.setupElevationDraw(Xe,X,ue),P.uploadCommonUniforms(q,X,Je.toUnwrapped()),ce)){let[hi,ai,xi]=ce.getGridBuffers(yt,ze!==0);X.draw(P,Ke,me,De,fe,t.af.backCCW,Pt,"globe_raster",hi,ai,xi)}}}if(ce&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){let Re=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ae&&Re.push("CUSTOM_ANTIALIASING"),X=P.getOrCreateProgram("globeRaster",{defines:Re});for(let ze of U){let{x:Ke,y:Je,z:Xe}=ze.canonical,De=Je===0,Ne=Je===(1<<Xe)-1,[Ze,mt,_t,St]=ce.getPoleBuffers(Xe,!1);if(St&&(De||Ne)){let yt=B.getTile(ze);q.activeTexture.set(Z.TEXTURE0),yt.texture&&yt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let it=t.bh(Xe,Ke,re),$e=t.bf(t.bg(ze.canonical)),Pt=(hi,ai)=>hi.draw(P,Z.TRIANGLES,me,t.ag.disabled,fe,t.af.disabled,F0(re.expandedFarZProjMatrix,it,it,$e,0,le,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,we,0,re._farZ),"globe_pole_raster",ai,_t,St);F.setupElevationDraw(yt,X,ue),P.uploadCommonUniforms(q,X,ze.toUnwrapped()),De&&P.renderDefaultNorthPole&&Pt(X,Ze),Ne&&P.renderDefaultSouthPole&&(it=t.ad.scale(t.ad.create(),it,[1,-1,1]),Pt(X,mt))}}}})(x,w,S,I,A);else{let P=x.context,F=P.gl,B,U,H=x.shadowRenderer,q=ss(x,x.longestCutoffRange),Z=fe=>{if(U===fe)return;let me=[];me.push(bh[fe]),q.shouldRenderCutoff&&me.push("RENDER_CUTOFF"),B=x.getOrCreateProgram("terrainRaster",{defines:me}),U=fe},X=x.colorModeForRenderPass(),K=new t.ae(F.LEQUAL,t.ae.ReadWrite,x.depthRangeFor3D);Tl.update(A);let re=x.transform,ae=If(re.zoom,w.exaggeration(),w.sourceCache._source.tileSize),se=[0,0,0];if(H){let fe=x.style.directionalLight,me=x.style.ambientLight;fe&&me&&(se=ls(x.style,fe,me))}{U=-1;let fe=F.TRIANGLES,[me,ne]=[w.gridIndexBuffer,w.gridSegments];for(let le of I){let ce=S.getTile(le),we=t.ag.disabled,Oe=w.prevTerrainTileForTile[le.key],ue=w.terrainTileForTile[le.key];Ju(Oe,ue)&&Tl.newMorphing(le.key,Oe,ue,A,250),P.activeTexture.set(F.TEXTURE0),ce.texture&&ce.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);let Re=Tl.getMorphValuesForProxy(le.key),ze=Re?1:0,Ke;Re&&(Ke={morphing:{srcDemTile:Re.from,dstDemTile:Re.to,phase:t.b9(Re.phase)}});let Je=vt(le.projMatrix,z0(le.canonical,re.renderWorldCopies)?ae/10:ae,se);if(Z(ze),!B)continue;w.setupElevationDraw(ce,B,Ke);let Xe=le.toUnwrapped();H&&H.setupShadows(Xe,B),x.uploadCommonUniforms(P,B,Xe,null,q),B.draw(x,fe,K,we,X,t.af.backCCW,Je,"terrain_raster",w.gridBuffer,me,ne)}}}}(u,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;let u=this.painter,_=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],S=this._drapedRenderBatches.shift(),I=u.style.order,A=[],P=0;for(let F of w){let B=x.getTileByID(F.proxyTileKey),U=x.proxyCachedFBO[F.key]?x.proxyCachedFBO[F.key][l]:void 0,H=U!==void 0?x.renderCache[U]:this.pool[P++],q=U!==void 0;if(B.texture=H.tex,q&&!H.dirty){A.push(B.tileID);continue}let Z;_.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(_.clear({color:t.C.transparent,stencil:0}),H.dirty=!1);for(let X=S.start;X<=S.end;++X){let K=u.style._mergedLayers[I[X]];if(K.isHidden(u.transform.zoom))continue;let re=u.style.getLayerSourceCache(K),ae=re?this.proxyToSource[F.key][re.id]:[F];if(!ae)continue;let se=ae;_.viewport.set([0,0,H.fb.width,H.fb.height]),Z!==(re?re.id:null)&&(this._setupStencil(H,ae,K,re),Z=re?re.id:null),u.renderLayer(u,re,K,se)}if(this._drapedRenderBatches.length===0)for(let X of this._pendingGroundEffectLayers){let K=u.style._mergedLayers[I[X]];if(K.isHidden(u.transform.zoom))continue;let re=u.style.getLayerSourceCache(K),ae=re?this.proxyToSource[F.key][re.id]:[F];if(!ae)continue;let se=ae;_.viewport.set([0,0,H.fb.width,H.fb.height]),Z!==(re?re.id:null)&&(this._setupStencil(H,ae,K,re),Z=re?re.id:null),u.renderLayer(u,re,K,se)}this.renderedToTile?(H.dirty=!0,A.push(B.tileID)):q||--P,P===5&&(P=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,u.width,u.height]),S.end+1}postRender(){}isLayerOrderingCorrect(l){let u=l.order.length,_=-1,x=u;for(let w=0;w<u;++w)this._style.isLayerDraped(l._mergedLayers[l.order[w]])?_=Math.max(_,w):x=Math.min(x,w);return x>_}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{l=Math.min(l,u.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,u,_){if(!this._visibleDemTiles)return null;let x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{let S=w.tileID,I=1<<S.overscaledZ,{x:A,y:P}=S.canonical,F=A/I,B=(A+1)/I,U=P/I,H=(P+1)/I;return{minx:F,miny:U,maxx:B,maxy:H,t:w.dem.tree.raycastRoot(F,U,B,H,l,u,_),tile:w}});x.sort((w,S)=>(w.t!==null?w.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(let w of x){if(w.t==null)return null;let S=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,l,u,_);if(S!=null)return S}return null}_createFBO(){let l=this.painter.context,u=l.gl,_=this.drapeBufferSize;l.activeTexture.set(u.TEXTURE0);let x=new t.T(l,{width:_[0],height:_[1],data:null},u.RGBA);x.bind(u.LINEAR,u.CLAMP_TO_EDGE);let w=l.createFramebuffer(_[0],_[1],!0,null);return w.colorAttachment.set(x.texture),w.depthAttachment=new yl(l,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{let u=this._style._mergedLayers[l],_=u.isHidden(this.painter.transform.zoom);return u.type==="custom"?!_&&u.shouldRedrape():!_&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(let _ of this._style.getSources())if(_ instanceof Yu){l=!0;break}if(!l)return;let u={};for(let _=0;_<this._style.order.length;++_){let x=this._style._mergedLayers[this._style.order[_]],w=this._style.getLayerSourceCache(x);if(w&&!u[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof t.Z){u[w.id]=!0;for(let S of this.proxyCoords){let I=this.proxyToSource[S.key][w.id];if(I)for(let A of I)this._clearRenderCacheForTile(w.id,A)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(let _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof ph){l=!0;break}if(!l)return;let u={};for(let _=0;_<this._style.order.length;++_){let x=this._style._mergedLayers[this._style.order[_]],w=this._style.getLayerSourceCache(x);if(!w||u[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;let S=x.paint.get("raster-fade-duration");for(let I of this.proxyCoords){let A=this.proxyToSource[I.key][w.id];if(A)for(let P of A){let F=tp(w.getTile(P),w.findLoadedParent(P,0),w,this.painter.transform,S);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(w.id,P)}}}}_setupDrapedRenderBatches(){let l=this._style.order,u=l.length;if(u===0)return;let _=[];this._pendingGroundEffectLayers=[];let x,w=0,S=this._style._mergedLayers[l[w]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++w<u;)S=this._style._mergedLayers[l[w]];for(;w<u;++w){let I=this._style._mergedLayers[l[w]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?x===void 0&&(x=w):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),x!==void 0&&(_.push({start:x,end:w-1}),x=void 0)))}if(x!==void 0&&_.push({start:x,end:w-1}),_.length!==0){let I=_[_.length-1];this._pendingGroundEffectLayers.every(A=>A>I.end)||t.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(l){let u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){let S=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let I=0;I<S.length;++I){let A=Object.values(S[I]);u.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();let _=this.proxyCoords,x=this._tilesDirty;for(let S=_.length-1;S>=0;S--){let I=_[S];if(u.getTileByID(I.key),u.proxyCachedFBO[I.key]!==void 0){let A=l[I.key],P=this.proxyToSource[I.key],F=0;for(let B in P){let U=P[B],H=A[B];if(!H||H.length!==U.length||U.some((q,Z)=>q!==H[Z]||x[B]&&x[B].hasOwnProperty(q.key))){F=-1;break}++F}for(let B in u.proxyCachedFBO[I.key])u.renderCache[u.proxyCachedFBO[I.key][B]].dirty=F<0||F!==Object.values(A).length}}let w=[...this._drapedRenderBatches];w.sort((S,I)=>I.end-I.start-(S.end-S.start));for(let S of w)for(let I of _){if(u.proxyCachedFBO[I.key])continue;let A=u.renderCachePool.pop();A===void 0&&u.renderCache.length<50&&(A=u.renderCache.length,u.renderCache.push(this._createFBO())),A!==void 0&&(u.proxyCachedFBO[I.key]={},u.proxyCachedFBO[I.key][S.start]=A,u.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(l,u,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let w=this.painter.context,S=w.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let I;if(_.isTileClipped())I=u.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):t.ag.disabled}_renderTileClippingMasks(l,u){let _=this.painter,x=this.painter.context,w=x.gl;_._tileClippingMaskIDs={},x.setColorMode(t.a.disabled),x.setDepthMode(t.ae.disabled);let S=_.getOrCreateProgram("clippingMask");for(let I of l){let A=_._tileClippingMaskIDs[I.key]=--u;S.draw(_,w.TRIANGLES,t.ae.disabled,new t.ag({func:w.ALWAYS,mask:0},A,255,w.KEEP,w.KEEP,w.REPLACE),t.a.disabled,t.af.disabled,ep(I.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(l){let u=this.painter.transform;if(l.x<0||l.x>u.width||l.y<0||l.y>u.height)return null;let _=[l.x,l.y,1,1];t.aA.transformMat4(_,_,u.pixelMatrixInverse),t.aA.scale(_,_,1/_[3]),_[0]/=u.worldSize,_[1]/=u.worldSize;let x=u._camera.position,w=t.ax(1,u.center.lat),S=[x[0],x[1],x[2]/w,0],I=t._.subtract([],_.slice(0,3),S);t._.normalize(I,I);let A=this.raycast(S,I,this._exaggeration);return A!==null&&A?(t._.scaleAndAdd(S,S,I,A),S[3]=S[2],S[2]*=w,S):null}drawDepth(){let l=this.painter,u=l.context,_=this.proxySourceCache,x=Math.ceil(l.width),w=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let S=u.gl,I=u.createFramebuffer(x,w,!0,"renderbuffer");u.activeTexture.set(S.TEXTURE0);let A=new t.T(u,{width:x,height:w,data:null},S.RGBA);A.bind(S.NEAREST,S.CLAMP_TO_EDGE),I.colorAttachment.set(A.texture);let P=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,x,w);I.depthAttachment.set(P),this._depthFBO=I,this._depthTexture=A}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,x,w]),function(S,I,A,P){if(S.transform.projection.name==="globe")return;let F=S.context,B=F.gl;F.clear({depth:1});let U=S.getOrCreateProgram("terrainDepth"),H=new t.ae(B.LESS,t.ae.ReadWrite,S.depthRangeFor3D);for(let q of P){let Z=A.getTile(q),X=vt(q.projMatrix,0,[0,0,0]);I.setupElevationDraw(Z,U),U.draw(S,B.TRIANGLES,H,t.ag.disabled,t.a.unblended,t.af.backCCW,X,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(l,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,u,_){if(l.getSource()instanceof t.bm)return this._setupProxiedCoordsForImageSource(l,u,_);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};let x=this.proxiedCoords[l.id]=[],w=this.proxyCoords;for(let A=0;A<w.length;A++){let P=w[A],F=this._findTileCoveringTileID(P,l);if(F){let B=this._createProxiedId(P,F,_[P.key]&&_[P.key][l.id]);x.push(B),this.proxyToSource[P.key][l.id]=[B]}}let S=!1,I=new Set;for(let A=0;A<u.length;A++){let P=l.getTile(u[A]);if(!P||!P.hasData())continue;let F=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==P.tileID.canonical.z){let B=this.proxyToSource[F.tileID.key][l.id],U=this._createProxiedId(F.tileID,P,_[F.tileID.key]&&_[F.tileID.key][l.id]);B?B.splice(B.length-1,0,U):this.proxyToSource[F.tileID.key][l.id]=[U];let H=this.proxyToSource[F.tileID.key][l.id];I.has(H)||I.add(H),x.push(U),S=!0}}if(this._sourceTilesOverlap[l.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(let A of I)A.sort((P,F)=>F.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(l,u,_){if(!l.getSource().loaded())return;let x=this.proxiedCoords[l.id]=[],w=this.proxyCoords,S=l.getSource(),I=S.tileID;if(!I)return;let A=new t.P(I.x,I.y)._div(1<<I.z),P=S.coordinates.map(t.Y.fromLngLat).reduce((B,U)=>(B.min.x=Math.min(B.min.x,U.x-A.x),B.min.y=Math.min(B.min.y,U.y-A.y),B.max.x=Math.max(B.max.x,U.x-A.x),B.max.y=Math.max(B.max.y,U.y-A.y),B),{min:new t.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(B,U)=>{let H=B.wrap+B.canonical.x/(1<<B.canonical.z),q=B.canonical.y/(1<<B.canonical.z),Z=t.a3/(1<<B.canonical.z),X=U.wrap+U.canonical.x/(1<<U.canonical.z),K=U.canonical.y/(1<<U.canonical.z);return H+Z<X+P.min.x||H>X+P.max.x||q+Z<K+P.min.y||q>K+P.max.y};for(let B=0;B<w.length;B++){let U=w[B];for(let H=0;H<u.length;H++){let q=l.getTile(u[H]);if(!q||!q.hasData()||F(U,q.tileID))continue;let Z=this._createProxiedId(U,q,_[U.key]&&_[U.key][l.id]),X=this.proxyToSource[U.key][l.id];X?X.push(Z):this.proxyToSource[U.key][l.id]=[Z],x.push(Z)}}}_createProxiedId(l,u,_){let x=this.orthoMatrix;if(_){let w=_.find(S=>S.key===u.tileID.key);if(w)return w}if(u.tileID.key!==l.key){let w=l.canonical.z-u.tileID.canonical.z,S,I,A;x=t.ad.create();let P=u.tileID.wrap-l.wrap<<l.overscaledZ;w>0?(S=t.a3>>w,I=S*((u.tileID.canonical.x<<w)-l.canonical.x+P),A=S*((u.tileID.canonical.y<<w)-l.canonical.y)):(S=t.a3<<-w,I=t.a3*(u.tileID.canonical.x-(l.canonical.x+P<<-w)),A=t.a3*(u.tileID.canonical.y-(l.canonical.y<<-w))),t.ad.ortho(x,0,S,0,S,0,1),t.ad.translate(x,x,[I,A,0])}return new Df(u.tileID,l.key,x)}_findTileCoveringTileID(l,u){let _=u.getTile(l);if(_&&_.hasData())return _;let x=this._findCoveringTileCache[u.id],w=x[l.key];if(_=w?u.getTileByID(w):null,_&&_.hasData()||w===null)return _;let S=_?_.tileID:l,I=S.overscaledZ,A=u.getSource().minzoom,P=[];if(!w){let B=u.getSource().maxzoom;if(l.canonical.z>=B){let U=l.canonical.z-B;u.getSource().reparseOverscaled?(I=Math.max(l.canonical.z+2,u.transform.tileZoom),S=new t.aL(I,l.wrap,B,l.canonical.x>>U,l.canonical.y>>U)):U!==0&&(I=B,S=new t.aL(I,l.wrap,B,l.canonical.x>>U,l.canonical.y>>U))}S.key!==l.key&&(P.push(S.key),_=u.getTile(S))}let F=B=>{P.forEach(U=>{x[U]=B}),P.length=0};for(I-=1;I>=A&&(!_||!_.hasData());I--){_&&F(_.tileID.key);let B=S.calculateScaledKey(I);if(_=u.getTileByID(B),_&&_.hasData())break;let U=x[B];if(U===null)break;U===void 0?P.push(B):_=u.getTileByID(U)}return F(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,u){let _=this._tilesDirty[l];_||(_=this._tilesDirty[l]={}),_[u.key]=!0}}function cs(f,l,u){let _=function(I,A,P){let F=t._.dot(A,I),B=t._.dot(P,[.2126,.7152,.0722]),U=(q,Z,X)=>(1-X)*q+X*Z,H=U(1-.3*Math.min(B,1),1,Math.min(F+1,1));return U(.92,1,Math.asin(t.at(A[2],-1,1))/Math.PI+.5)*H}(f,[0,0,1],l),x=[0,0,0];t._.scale(x,u.slice(0,3),_);let w=[0,0,0];t._.scale(w,l.slice(0,3),f[2]);let S=[0,0,0];return t._.add(S,x,w),t.b8(S)}let np=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],N0=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class vh{static cacheKey(l,u,_,x){let w=`${u}${x?x.cacheKey:""}`;for(let S of _)l.usedDefines.includes(S)&&(w+=`/${S}`);return w}constructor(l,u,_,x,w,S){let I=l.gl;this.program=I.createProgram(),this.configuration=x,this.name=u,this.fixedDefines=[...S];let A=x?x.getBinderAttributes():[],P=(_.staticAttributes||[]).concat(A),F=x?x.defines():[];F=F.concat(S.map(X=>`#define ${X}`));let B=`#version 300 es
`,U=B+F.concat("precision mediump float;",O0,P0.fragmentSource).join(`
`);for(let X of _.fragmentIncludes)U+=`
${$u[X]}`;U+=`
${_.fragmentSource}`;let H=B+F.concat("precision highp float;",O0,P0.vertexSource).join(`
`);for(let X of _.vertexIncludes)H+=`
${$u[X]}`;H+=`
${_.vertexSource}`;let q=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(q,U),I.compileShader(q),I.attachShader(this.program,q);let Z=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(Z,H),I.compileShader(Z),I.attachShader(this.program,Z),this.attributes={},this.numAttributes=P.length;for(let X=0;X<this.numAttributes;X++)if(P[X]){let K=P[X].startsWith("a_")?P[X]:`a_${P[X]}`;I.bindAttribLocation(this.program,X,K),this.attributes[K]=X}I.linkProgram(this.program),I.deleteShader(Z),I.deleteShader(q),this.fixedUniforms=w(l),this.binderUniforms=x?x.getUniforms(l):[],S.includes("TERRAIN")&&(this.terrainUniforms=(X=>({u_dem:new t.a7(X),u_dem_prev:new t.a7(X),u_dem_tl:new t.a8(X),u_dem_scale:new t.aa(X),u_dem_tl_prev:new t.a8(X),u_dem_scale_prev:new t.aa(X),u_dem_size:new t.aa(X),u_dem_lerp:new t.aa(X),u_exaggeration:new t.aa(X),u_depth:new t.a7(X),u_depth_size_inv:new t.a8(X),u_meter_to_dem:new t.aa(X),u_label_plane_matrix_inv:new t.a6(X)}))(l)),S.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new t.aq(X),u_tile_tr_up:new t.aq(X),u_tile_br_up:new t.aq(X),u_tile_bl_up:new t.aq(X),u_tile_up_scale:new t.aa(X)}))(l)),S.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new t.a6(X),u_fog_range:new t.a8(X),u_fog_color:new t.as(X),u_fog_horizon_blend:new t.aa(X),u_fog_vertical_limit:new t.a8(X),u_fog_temporal_offset:new t.aa(X),u_frustum_tl:new t.aq(X),u_frustum_tr:new t.aq(X),u_frustum_br:new t.aq(X),u_frustum_bl:new t.aq(X),u_globe_pos:new t.aq(X),u_globe_radius:new t.aa(X),u_globe_transition:new t.aa(X),u_is_globe:new t.a7(X),u_viewport:new t.a8(X)}))(l)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new t.as(X)}))(l)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new t.aq(X),u_lighting_directional_dir:new t.aq(X),u_lighting_directional_color:new t.aq(X),u_ground_radiance:new t.aq(X)}))(l)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new t.a6(X),u_light_matrix_1:new t.a6(X),u_fade_range:new t.a8(X),u_shadow_normal_offset:new t.aq(X),u_shadow_intensity:new t.aa(X),u_shadow_texel_size:new t.aa(X),u_shadow_map_resolution:new t.aa(X),u_shadow_direction:new t.aq(X),u_shadow_bias:new t.aq(X),u_shadowmap_0:new t.a7(X),u_shadowmap_1:new t.a7(X)}))(l))}}setTerrainUniformValues(l,u){if(!this.terrainUniforms)return;let _=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(let x in u)_[x]&&_[x].set(this.program,x,u[x])}}setGlobeUniformValues(l,u){if(!this.globeUniforms)return;let _=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(let x in u)_[x]&&_[x].set(this.program,x,u[x])}}setFogUniformValues(l,u){if(!this.fogUniforms)return;let _=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(let x in u)_[x].set(this.program,x,u[x])}}setCutoffUniformValues(l,u){if(!this.cutoffUniforms)return;let _=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(let x in u)_[x].set(this.program,x,u[x])}}setLightsUniformValues(l,u){if(!this.lightsUniforms)return;let _=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(let x in u)_[x].set(this.program,x,u[x])}}setShadowUniformValues(l,u){if(this.failedToCreate||!this.shadowUniforms)return;let _=this.shadowUniforms;l.program.set(this.program);for(let x in u)_[x].set(this.program,x,u[x])}_drawDebugWireframe(l,u,_,x,w,S,I,A,P,F){let B=l.options.wireframe;if(B.terrain===!1&&B.layers2D===!1&&B.layers3D===!1)return;let U=l.context;if(!(!(!B.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!B.layers2D||l._terrain&&l._terrain.renderingToTexture||!np.includes(this.name))||!(!B.layers3D||!N0.includes(this.name))))return;let H=U.gl,q=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,w,U);if(!q)return;let Z=[...this.fixedDefines];Z.push("DEBUG_WIREFRAME");let X=l.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});U.program.set(X.program);let K=(se,fe,me)=>{if(fe[se]&&me[se])for(let ne in fe[se])me[se][ne]&&me[se][ne].set(me.program,ne,fe[se][ne].current)};P&&P.setUniforms(X.program,U,X.binderUniforms,I,{zoom:A}),K("fixedUniforms",this,X),K("terrainUniforms",this,X),K("globeUniforms",this,X),K("fogUniforms",this,X),K("lightsUniforms",this,X),K("shadowUniforms",this,X),q.bind(),U.setColorMode(new t.a([H.ONE,H.ONE_MINUS_SRC_ALPHA,H.ZERO,H.ONE],t.C.transparent,[!0,!0,!0,!1])),U.setDepthMode(new t.ae(u.func===H.LESS?H.LEQUAL:u.func,t.ae.ReadOnly,u.range)),U.setStencilMode(t.ag.disabled);let re=3*S.primitiveLength*2,ae=3*S.primitiveOffset*2*2;F&&F>1?H.drawElementsInstanced(H.LINES,re,H.UNSIGNED_SHORT,ae,F):H.drawElements(H.LINES,re,H.UNSIGNED_SHORT,ae),w.bind(),U.program.set(this.program),U.setDepthMode(u),U.setStencilMode(_),U.setColorMode(x)}draw(l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z,X){let K=l.context,re=K.gl;if(this.failedToCreate)return;K.program.set(this.program),K.setDepthMode(_),K.setStencilMode(x),K.setColorMode(w),K.setCullFace(S);for(let fe of Object.keys(this.fixedUniforms))this.fixedUniforms[fe].set(this.program,fe,I[fe]);q&&q.setUniforms(this.program,K,this.binderUniforms,U,{zoom:H});let ae={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[u],se=X&&X>0?1:void 0;for(let fe of B.get()){let me=fe.vaos||(fe.vaos={});(me[A]||(me[A]=new $x)).bind(K,this,P,q?q.getPaintVertexBuffers():[],F,fe.vertexOffset,Z||[],se),X&&X>1?re.drawElementsInstanced(u,fe.primitiveLength*ae,re.UNSIGNED_SHORT,fe.primitiveOffset*ae*2,X):F?re.drawElements(u,fe.primitiveLength*ae,re.UNSIGNED_SHORT,fe.primitiveOffset*ae*2):re.drawArrays(u,fe.vertexOffset,fe.vertexLength),u===re.TRIANGLES&&F&&this._drawDebugWireframe(l,_,x,w,F,fe,U,H,q,X)}}}function rp(f,l){let u=Math.pow(2,l.tileID.overscaledZ),_=l.tileSize*Math.pow(2,f.transform.tileZoom)/u,x=_*(l.tileID.canonical.x+l.tileID.wrap*u),w=_*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/t.bB(l,1,f.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}let op=t.ad.create(),zc=(f,l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z)=>{let X=l.style.light,K=X.properties.get("position"),re=[K.x,K.y,K.z],ae=t.bC.create();X.properties.get("anchor")==="viewport"&&(t.bC.fromRotation(ae,-l.transform.angle),t._.transformMat3(re,re,ae));let se=X.properties.get("color"),fe=l.transform,me={u_matrix:f,u_lightpos:re,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[se.r,se.g,se.b],u_vertical_gradient:+u,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:op,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:w,u_flood_light_color:B,u_vertical_scale:U,u_flood_light_intensity:H,u_ground_shadow_factor:q,u_emissive_strength:Z};return fe.projection.name==="globe"&&(me.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],me.u_zoom_transition=A,me.u_inv_rot_matrix=F,me.u_merc_center=P,me.u_up_dir=fe.projection.upVector(new t.aO(0,0,0),P[0]*t.a3,P[1]*t.a3),me.u_height_lift=I),me},Bc=(f,l,u)=>({u_matrix:f,u_edge_radius:l,u_vertical_scale:u}),Af=(f,l,u,_,x,w,S,I,A,P,F,B,U,H)=>{let q=zc(f,l,u,_,x,w,S,A,P,F,B,U,H,1,[0,0,0],0),Z={u_height_factor:-Math.pow(2,S.overscaledZ)/I.tileSize/8};return t.W(q,rp(l,I),Z)},Pf=(f,l)=>({u_matrix:f,u_emissive_strength:l}),Of=(f,l,u,_)=>t.W(Pf(f,l),rp(u,_)),V0=(f,l,u)=>({u_matrix:f,u_world:u,u_emissive_strength:l}),ap=(f,l,u,_,x)=>t.W(Of(f,l,u,_),{u_world:x}),Rf=(f,l,u,_)=>{let x=t.a3/u.tileSize;return{u_matrix:f,u_camera_to_center_distance:l.getCameraToCenterDistance(_),u_extrude_scale:[l.pixelsToGLUnits[0]/x,l.pixelsToGLUnits[1]/x]}},sp=(f,l,u=1)=>({u_matrix:f,u_color:l.toRenderColor(null),u_overlay:0,u_overlay_scale:u}),xh=t.ad.create(),Il=(f,l,u,_,x,w,S)=>{let I=f.transform,A=I.projection.name==="globe",P=A?t.bD(I.zoom,l.canonical)*I._pixelsPerMercatorPixel:t.bB(u,1,w),F={u_matrix:l.projMatrix,u_extrude_scale:P,u_intensity:S,u_inv_rot_matrix:xh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){F.u_inv_rot_matrix=_,F.u_merc_center=x,F.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],F.u_zoom_transition=t.a1(I.zoom);let B=x[0]*t.a3,U=x[1]*t.a3;F.u_up_dir=I.projection.upVector(new t.aO(0,0,0),B,U)}return F};function j0(f,[l,u,_,x],[w,S]){if(w===S)return[0,0,0,0];let I=255*(f-1)/(f*(S-w));return[l*I,u*I,_*I,x*I]}function Ff(f,l,[u,_]){return u===_?0:.5/f+(l-u)*(f-1)/(f*(_-u))}let wh=(f,l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z,X,K,re,ae,se)=>({u_matrix:f,u_normalize_matrix:l,u_globe_matrix:u,u_merc_matrix:_,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:P,u_fade_t:F.mix,u_opacity:F.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:t.bE(B.paint.get("raster-saturation")),u_contrast_factor:t.bF(B.paint.get("raster-contrast")),u_spin_weights:Ch(B.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:H,u_zoom_transition:S,u_merc_center:I,u_cutoff_params:A,u_colorization_mix:j0(t.bG,Z,K),u_colorization_offset:Ff(t.bG,X,K),u_color_ramp:q,u_texture_offset:[ae/(re+2*ae),re/(re+2*ae)],u_texture_res:[re+2*ae,re+2*ae],u_emissive_strength:se});function Ch(f){f*=Math.PI/180;let l=Math.sin(f),u=Math.cos(f);return[(2*u+1)/3,(-Math.sqrt(3)*l-u+1)/3,(Math.sqrt(3)*l-u+1)/3]}let Bs=.15,Lf=(f,l,u,_,x,w,S,I,A,P,F,B)=>({u_matrix:f,u_normalize_matrix:l,u_globe_matrix:u,u_merc_matrix:_,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:P,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:B,u_zoom_transition:S,u_merc_center:I,u_cutoff_params:A}),zf=(f,l,u,_,x,w,S,I,A,P)=>({u_particle_texture:f,u_particle_texture_side_len:l,u_tile_offset:u,u_velocity:_,u_color_ramp:w,u_velocity_res:x,u_max_speed:S,u_uv_offset:I,u_data_scale:A,u_data_offset:P,u_particle_pos_scale:1.3,u_particle_pos_offset:[Bs,Bs]}),Xx=(f,l,u,_,x,w,S,I,A,P)=>({u_particle_texture:f,u_particle_texture_side_len:l,u_velocity:u,u_velocity_res:_,u_max_speed:x,u_speed_factor:w,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:A,u_data_offset:P,u_particle_pos_scale:1.3,u_particle_pos_offset:[Bs,Bs]}),ba=t.ad.create(),Nc=(f,l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z,X,K)=>{let re=x.transform,ae={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:re.getCameraToCenterDistance(Z),u_rotate_symbol:+u,u_aspect_ratio:re.width/re.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+A,u_pitch_with_map:+_,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ba,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ba,u_up_vector:[0,-1,0],u_color_adj_mat:X,u_icon_transition:K||0};return Z.name==="globe"&&(ae.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],ae.u_zoom_transition=B,ae.u_inv_rot_matrix=H,ae.u_merc_center=U,ae.u_camera_forward=re._camera.forward(),ae.u_ecef_origin=t.bH(re.globeMatrix,F.toUnwrapped()),ae.u_tile_matrix=Float32Array.from(re.globeMatrix),ae.u_up_vector=q),ae},lp=(f,l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z,X)=>t.W(Nc(f,l,u,_,x,w,S,I,A,P,B,U,H,q,Z,X),{u_gamma_scale:_?x.transform.getCameraToCenterDistance(X)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:t.e.devicePixelRatio,u_is_halo:+F,undefined:void 0}),U0=(f,l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z)=>t.W(lp(f,l,u,_,x,w,S,I,!0,A,!0,F,B,U,H,q,Z),{u_texsize_icon:P,u_texture_icon:1}),Sh=(f,l,u,_)=>({u_matrix:f,u_emissive_strength:l,u_opacity:u,u_color:_}),H0=(f,l,u,_,x,w,S,I)=>t.W(function(A,P,F,B,U){let{width:H,height:q}=B.imageManager.getPixelSize(P),Z=Math.pow(2,U.tileID.overscaledZ),X=U.tileSize*Math.pow(2,B.transform.tileZoom)/Z,K=X*(U.tileID.canonical.x+U.tileID.wrap*Z),re=X*U.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[H,q],u_pattern_size:F.displaySize,u_tile_units_to_pixels:1/t.bB(U,1,B.transform.tileZoom),u_pixel_coord_upper:[K>>16,re>>16],u_pixel_coord_lower:[65535&K,65535&re]}}(0,w,S,_,I),{u_matrix:f,u_emissive_strength:l,u_opacity:u}),Bf=new Float32Array(t.ad.identity([])),Mh=(f,l,u,_,x,w,S,I,A,P,F,B,U,H=[0,0,0],q)=>{let Z=x.style.light,X=Z.properties.get("position"),K=[-X.x,-X.y,X.z],re=t.bC.create();Z.properties.get("anchor")==="viewport"&&(t.bC.fromRotation(re,-x.transform.angle),t._.transformMat3(K,K,re));let ae=F.alphaMode==="MASK",se=Z.properties.get("color").toRenderColor(null),fe=U.paint.get("model-ambient-occlusion-intensity"),me=U.paint.get("model-color").constantOr(t.C.white).toRenderColor(null),ne=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:l,u_normal_matrix:u,u_node_matrix:_||Bf,u_lightpos:K,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[se.r,se.g,se.b],u_camera_pos:H,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+ae,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:A,u_roughnessFactor:P,u_baseColorTexture:eo.BaseColor,u_metallicRoughnessTexture:eo.MetallicRoughness,u_normalTexture:eo.Normal,u_occlusionTexture:eo.Occlusion,u_emissionTexture:eo.Emission,u_lutTexture:eo.LUT,u_color_mix:[me.r,me.g,me.b,ne],u_aoIntensity:fe,u_emissive_strength:B,u_occlusionTextureTransform:q||[0,0,0,0]}},W0=(f,l=Bf,u=Bf)=>({u_matrix:f,u_instance:l,u_node_matrix:u}),G0=(f,l,u,_,x)=>({u_matrix:Float32Array.from(f),u_anchorPos:l,u_screenSizePx:u,u_occluderSizePx:_,u_color:x}),Kx={fillExtrusion:f=>({u_matrix:new t.a6(f),u_lightpos:new t.aq(f),u_lightintensity:new t.aa(f),u_lightcolor:new t.aq(f),u_vertical_gradient:new t.aa(f),u_opacity:new t.aa(f),u_edge_radius:new t.aa(f),u_ao:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_up_dir:new t.aq(f),u_height_lift:new t.aa(f),u_flood_light_color:new t.aq(f),u_vertical_scale:new t.aa(f),u_flood_light_intensity:new t.aa(f),u_ground_shadow_factor:new t.aq(f),u_emissive_strength:new t.aa(f)}),fillExtrusionDepth:f=>({u_matrix:new t.a6(f),u_edge_radius:new t.aa(f),u_vertical_scale:new t.aa(f)}),fillExtrusionPattern:f=>({u_matrix:new t.a6(f),u_lightpos:new t.aq(f),u_lightintensity:new t.aa(f),u_lightcolor:new t.aq(f),u_vertical_gradient:new t.aa(f),u_height_factor:new t.aa(f),u_edge_radius:new t.aa(f),u_ao:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_up_dir:new t.aq(f),u_height_lift:new t.aa(f),u_image:new t.a7(f),u_texsize:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f),u_opacity:new t.aa(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new t.a6(f),u_opacity:new t.aa(f),u_ao_pass:new t.aa(f),u_meter_to_tile:new t.aa(f),u_ao:new t.a8(f),u_flood_light_intensity:new t.aa(f),u_flood_light_color:new t.aq(f),u_attenuation:new t.aa(f),u_edge_radius:new t.aa(f),u_fb:new t.a7(f),u_fb_size:new t.aa(f)}),fill:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f)}),fillPattern:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_image:new t.a7(f),u_texsize:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f)}),fillOutline:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_world:new t.a8(f)}),fillOutlinePattern:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_world:new t.a8(f),u_image:new t.a7(f),u_texsize:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f)}),circle:t.bI,collisionBox:f=>({u_matrix:new t.a6(f),u_camera_to_center_distance:new t.aa(f),u_extrude_scale:new t.a8(f)}),collisionCircle:f=>({u_matrix:new t.a6(f),u_inv_matrix:new t.a6(f),u_camera_to_center_distance:new t.aa(f),u_viewport_size:new t.a8(f)}),debug:f=>({u_color:new t.a9(f),u_matrix:new t.a6(f),u_overlay:new t.a7(f),u_overlay_scale:new t.aa(f)}),clippingMask:f=>({u_matrix:new t.a6(f)}),heatmap:f=>({u_extrude_scale:new t.aa(f),u_intensity:new t.aa(f),u_matrix:new t.a6(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_up_dir:new t.aq(f)}),heatmapTexture:f=>({u_image:new t.a7(f),u_color_ramp:new t.a7(f),u_opacity:new t.aa(f)}),hillshade:f=>({u_matrix:new t.a6(f),u_image:new t.a7(f),u_latrange:new t.a8(f),u_light:new t.a8(f),u_shadow:new t.a9(f),u_highlight:new t.a9(f),u_emissive_strength:new t.aa(f),u_accent:new t.a9(f)}),hillshadePrepare:f=>({u_matrix:new t.a6(f),u_image:new t.a7(f),u_dimension:new t.a8(f),u_zoom:new t.aa(f)}),line:t.bJ,linePattern:t.bK,raster:f=>({u_matrix:new t.a6(f),u_normalize_matrix:new t.a6(f),u_globe_matrix:new t.a6(f),u_merc_matrix:new t.a6(f),u_grid_matrix:new t.ar(f),u_tl_parent:new t.a8(f),u_scale_parent:new t.aa(f),u_fade_t:new t.aa(f),u_opacity:new t.aa(f),u_image0:new t.a7(f),u_image1:new t.a7(f),u_brightness_low:new t.aa(f),u_brightness_high:new t.aa(f),u_saturation_factor:new t.aa(f),u_contrast_factor:new t.aa(f),u_spin_weights:new t.aq(f),u_perspective_transform:new t.a8(f),u_raster_elevation:new t.aa(f),u_zoom_transition:new t.aa(f),u_merc_center:new t.a8(f),u_cutoff_params:new t.as(f),u_colorization_mix:new t.as(f),u_colorization_offset:new t.aa(f),u_color_ramp:new t.a7(f),u_texture_offset:new t.a8(f),u_texture_res:new t.a8(f),u_emissive_strength:new t.aa(f)}),rasterParticle:f=>({u_matrix:new t.a6(f),u_normalize_matrix:new t.a6(f),u_globe_matrix:new t.a6(f),u_merc_matrix:new t.a6(f),u_grid_matrix:new t.ar(f),u_tl_parent:new t.a8(f),u_scale_parent:new t.aa(f),u_fade_t:new t.aa(f),u_opacity:new t.aa(f),u_image0:new t.a7(f),u_image1:new t.a7(f),u_raster_elevation:new t.aa(f),u_zoom_transition:new t.aa(f),u_merc_center:new t.a8(f),u_cutoff_params:new t.as(f)}),rasterParticleTexture:f=>({u_texture:new t.a7(f),u_opacity:new t.aa(f)}),rasterParticleDraw:f=>({u_particle_texture:new t.a7(f),u_particle_texture_side_len:new t.aa(f),u_tile_offset:new t.a8(f),u_velocity:new t.a7(f),u_color_ramp:new t.a7(f),u_velocity_res:new t.a8(f),u_max_speed:new t.aa(f),u_uv_offset:new t.a8(f),u_data_scale:new t.as(f),u_data_offset:new t.aa(f),u_particle_pos_scale:new t.aa(f),u_particle_pos_offset:new t.a8(f)}),rasterParticleUpdate:f=>({u_particle_texture:new t.a7(f),u_particle_texture_side_len:new t.aa(f),u_velocity:new t.a7(f),u_velocity_res:new t.a8(f),u_max_speed:new t.aa(f),u_speed_factor:new t.aa(f),u_reset_rate:new t.aa(f),u_rand_seed:new t.aa(f),u_uv_offset:new t.a8(f),u_data_scale:new t.as(f),u_data_offset:new t.aa(f),u_particle_pos_scale:new t.aa(f),u_particle_pos_offset:new t.a8(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new t.a7(f),u_is_size_feature_constant:new t.a7(f),u_size_t:new t.aa(f),u_size:new t.aa(f),u_camera_to_center_distance:new t.aa(f),u_rotate_symbol:new t.a7(f),u_aspect_ratio:new t.aa(f),u_fade_change:new t.aa(f),u_matrix:new t.a6(f),u_label_plane_matrix:new t.a6(f),u_coord_matrix:new t.a6(f),u_is_text:new t.a7(f),u_pitch_with_map:new t.a7(f),u_texsize:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_camera_forward:new t.aq(f),u_tile_matrix:new t.a6(f),u_up_vector:new t.aq(f),u_ecef_origin:new t.aq(f),u_texture:new t.a7(f),u_icon_transition:new t.aa(f),u_color_adj_mat:new t.a6(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new t.a7(f),u_is_size_feature_constant:new t.a7(f),u_size_t:new t.aa(f),u_size:new t.aa(f),u_camera_to_center_distance:new t.aa(f),u_rotate_symbol:new t.a7(f),u_aspect_ratio:new t.aa(f),u_fade_change:new t.aa(f),u_matrix:new t.a6(f),u_label_plane_matrix:new t.a6(f),u_coord_matrix:new t.a6(f),u_is_text:new t.a7(f),u_pitch_with_map:new t.a7(f),u_texsize:new t.a8(f),u_texture:new t.a7(f),u_gamma_scale:new t.aa(f),u_device_pixel_ratio:new t.aa(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_camera_forward:new t.aq(f),u_tile_matrix:new t.a6(f),u_up_vector:new t.aq(f),u_ecef_origin:new t.aq(f),u_is_halo:new t.a7(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new t.a7(f),u_is_size_feature_constant:new t.a7(f),u_size_t:new t.aa(f),u_size:new t.aa(f),u_camera_to_center_distance:new t.aa(f),u_rotate_symbol:new t.a7(f),u_aspect_ratio:new t.aa(f),u_fade_change:new t.aa(f),u_matrix:new t.a6(f),u_label_plane_matrix:new t.a6(f),u_coord_matrix:new t.a6(f),u_is_text:new t.a7(f),u_pitch_with_map:new t.a7(f),u_texsize:new t.a8(f),u_texsize_icon:new t.a8(f),u_texture:new t.a7(f),u_texture_icon:new t.a7(f),u_gamma_scale:new t.aa(f),u_device_pixel_ratio:new t.aa(f),u_is_halo:new t.a7(f)}),background:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_opacity:new t.aa(f),u_color:new t.a9(f)}),backgroundPattern:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_opacity:new t.aa(f),u_image:new t.a7(f),u_pattern_tl:new t.a8(f),u_pattern_br:new t.a8(f),u_texsize:new t.a8(f),u_pattern_size:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f)}),terrainRaster:wl,terrainDepth:wl,skybox:f=>({u_matrix:new t.a6(f),u_sun_direction:new t.aq(f),u_cubemap:new t.a7(f),u_opacity:new t.aa(f),u_temporal_offset:new t.aa(f)}),skyboxGradient:f=>({u_matrix:new t.a6(f),u_color_ramp:new t.a7(f),u_center_direction:new t.aq(f),u_radius:new t.aa(f),u_opacity:new t.aa(f),u_temporal_offset:new t.aa(f)}),skyboxCapture:f=>({u_matrix_3f:new t.ar(f),u_sun_direction:new t.aq(f),u_sun_intensity:new t.aa(f),u_color_tint_r:new t.as(f),u_color_tint_m:new t.as(f),u_luminance:new t.aa(f)}),globeRaster:f=>({u_proj_matrix:new t.a6(f),u_globe_matrix:new t.a6(f),u_normalize_matrix:new t.a6(f),u_merc_matrix:new t.a6(f),u_zoom_transition:new t.aa(f),u_merc_center:new t.a8(f),u_image0:new t.a7(f),u_grid_matrix:new t.ar(f),u_skirt_height:new t.aa(f),u_far_z_cutoff:new t.aa(f),u_frustum_tl:new t.aq(f),u_frustum_tr:new t.aq(f),u_frustum_br:new t.aq(f),u_frustum_bl:new t.aq(f),u_globe_pos:new t.aq(f),u_globe_radius:new t.aa(f),u_viewport:new t.a8(f)}),globeAtmosphere:f=>({u_frustum_tl:new t.aq(f),u_frustum_tr:new t.aq(f),u_frustum_br:new t.aq(f),u_frustum_bl:new t.aq(f),u_horizon:new t.aa(f),u_transition:new t.aa(f),u_fadeout_range:new t.aa(f),u_color:new t.as(f),u_high_color:new t.as(f),u_space_color:new t.as(f),u_temporal_offset:new t.aa(f),u_horizon_angle:new t.aa(f)}),model:f=>({u_matrix:new t.a6(f),u_lighting_matrix:new t.a6(f),u_normal_matrix:new t.a6(f),u_node_matrix:new t.a6(f),u_lightpos:new t.aq(f),u_lightintensity:new t.aa(f),u_lightcolor:new t.aq(f),u_camera_pos:new t.aq(f),u_opacity:new t.aa(f),u_baseColorFactor:new t.as(f),u_emissiveFactor:new t.as(f),u_metallicFactor:new t.aa(f),u_roughnessFactor:new t.aa(f),u_baseTextureIsAlpha:new t.a7(f),u_alphaMask:new t.a7(f),u_alphaCutoff:new t.aa(f),u_baseColorTexture:new t.a7(f),u_metallicRoughnessTexture:new t.a7(f),u_normalTexture:new t.a7(f),u_occlusionTexture:new t.a7(f),u_emissionTexture:new t.a7(f),u_lutTexture:new t.a7(f),u_color_mix:new t.as(f),u_aoIntensity:new t.aa(f),u_emissive_strength:new t.aa(f),u_occlusionTextureTransform:new t.as(f)}),modelDepth:f=>({u_matrix:new t.a6(f),u_instance:new t.a6(f),u_node_matrix:new t.a6(f)}),groundShadow:f=>({u_matrix:new t.a6(f),u_ground_shadow_factor:new t.aq(f)}),stars:f=>({u_matrix:new t.a6(f),u_up:new t.aq(f),u_right:new t.aq(f),u_intensity_multiplier:new t.aa(f)}),occlusion:f=>({u_matrix:new t.a6(f),u_anchorPos:new t.aq(f),u_screenSizePx:new t.a8(f),u_occluderSizePx:new t.a8(f),u_color:new t.as(f)})};function cp(f,l,u){let _=l.createTileMatrix(f,f.worldSize,u.toUnwrapped());return t.ad.multiply(new Float32Array(16),f.projMatrix,_)}function Qx(f,l,u){if(l.projection.name===u.projection.name)return f.projMatrix;let _=u.clone();return _.setProjection(l.projection),cp(_,l.getProjection(),f)}function Vc(f,l,u){return l.name===u.projection.name?f.projMatrix:cp(u,l,f)}let dp;function Th(f,l,u,_,x,w,S){let I=f.context,A=I.gl,P=f.transform,F=f.getOrCreateProgram("collisionBox"),B=[],U=0,H=0;for(let se=0;se<_.length;se++){let fe=_[se],me=l.getTile(fe),ne=me.getBucket(u);if(!ne)continue;let le=Qx(fe,ne,P),ce=le;x[0]===0&&x[1]===0||(ce=f.translatePosMatrix(le,me,x,w));let we=S?ne.textCollisionBox:ne.iconCollisionBox,Oe=ne.collisionCircleArray;if(Oe.length>0){let ue=t.ad.create(),Re=ce;t.ad.mul(ue,ne.placementInvProjMatrix,P.glCoordMatrix),t.ad.mul(ue,ue,ne.placementViewportMatrix),B.push({circleArray:Oe,circleOffset:H,transform:Re,invTransform:ue,projection:ne.getProjection()}),U+=Oe.length/4,H=U}we&&(f.terrain&&f.terrain.setupElevationDraw(me,F),F.draw(f,A.LINES,t.ae.disabled,t.ag.disabled,f.colorModeForRenderPass(),t.af.disabled,Rf(ce,P,me,ne.getProjection()),u.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,P.zoom,null,[we.collisionVertexBuffer,we.collisionVertexBufferExt]))}if(!S||!B.length)return;let q=f.getOrCreateProgram("collisionCircle"),Z=new t.bL;Z.resize(4*U),Z._trim();let X=0;for(let se of B)for(let fe=0;fe<se.circleArray.length/4;fe++){let me=4*fe,ne=se.circleArray[me+0],le=se.circleArray[me+1],ce=se.circleArray[me+2],we=se.circleArray[me+3];Z.emplace(X++,ne,le,ce,we,0),Z.emplace(X++,ne,le,ce,we,1),Z.emplace(X++,ne,le,ce,we,2),Z.emplace(X++,ne,le,ce,we,3)}(!dp||dp.length<2*U)&&(dp=function(se){let fe=2*se,me=new t.bu;me.resize(fe),me._trim();for(let ne=0;ne<fe;ne++){let le=6*ne;me.uint16[le+0]=4*ne+0,me.uint16[le+1]=4*ne+1,me.uint16[le+2]=4*ne+2,me.uint16[le+3]=4*ne+2,me.uint16[le+4]=4*ne+3,me.uint16[le+5]=4*ne+0}return me}(U));let K=I.createIndexBuffer(dp,!0),re=I.createVertexBuffer(Z,t.bM.members,!0);for(let se of B){let fe={u_matrix:se.transform,u_inv_matrix:se.invTransform,u_camera_to_center_distance:(ae=P).getCameraToCenterDistance(se.projection),u_viewport_size:[ae.width,ae.height]};q.draw(f,A.TRIANGLES,t.ae.disabled,t.ag.disabled,f.colorModeForRenderPass(),t.af.disabled,fe,u.id,re,K,t.b.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,P.zoom)}var ae;re.destroy(),K.destroy()}let El=t.ad.create();function $0(f){let l=f._camera.getWorldToCamera(f.worldSize,1),u=t.ad.multiply([],l,f.globeMatrix);t.ad.invert(u,u);let _=[0,0,0],x=[0,1,0,0];return t.aA.transformMat4(x,x,u),_[0]=x[0],_[1]=x[1],_[2]=x[2],t._.normalize(_,_),_}function Jx({width:f,height:l,anchor:u,textOffset:_,textScale:x},w){let{horizontalAlign:S,verticalAlign:I}=t.bQ(u),A=-(S-.5)*f,P=-(I-.5)*l,F=t.bP(u,_);return new t.P((A/x+F[0])*w,(P/x+F[1])*w)}function q0(f,l,u,_,x,w,S,I,A,P,F){let B=f.text.placedSymbolArray,U=f.text.dynamicLayoutVertexArray,H=f.icon.dynamicLayoutVertexArray,q={},Z=f.getProjection(),X=Vc(I,Z,w),K=w.elevation,re=Z.upVectorScale(I.canonical,w.center.lat,w.worldSize).metersToTile;U.clear();for(let ae=0;ae<B.length;ae++){let se=B.get(ae),{tileAnchorX:fe,tileAnchorY:me,numGlyphs:ne}=se,le=se.hidden||!se.crossTileID||f.allowVerticalPlacement&&!se.placedOrientation?null:_[se.crossTileID];if(le){let ce=0,we=0,Oe=0;if(K){let Ze=K?K.getAtTileOffset(I,fe,me):0,[mt,_t,St]=Z.upVector(I.canonical,fe,me);ce=Ze*mt*re,we=Ze*_t*re,Oe=Ze*St*re}let[ue,Re,ze,Ke]=Jo(se.projectedAnchorX+ce,se.projectedAnchorY+we,se.projectedAnchorZ+Oe,u?X:S),Je=Zr(w.getCameraToCenterDistance(Z),Ke),Xe=x.evaluateSizeForFeature(f.textSizeData,P,se)*Je/t.bN;u&&(Xe*=f.tilePixelRatio/A);let De=Jx(le,Xe);u?({x:ue,y:Re,z:ze}=Z.projectTilePoint(fe+De.x,me+De.y,I.canonical),[ue,Re,ze]=Jo(ue+ce,Re+we,ze+Oe,S)):(l&&De._rotate(-w.angle),ue+=De.x,Re+=De.y,ze=0);let Ne=f.allowVerticalPlacement&&se.placedOrientation===t.aE.vertical?Math.PI/2:0;for(let Ze=0;Ze<ne;Ze++)t.aH(U,ue,Re,ze,Ne);F&&se.associatedIconIndex>=0&&(q[se.associatedIconIndex]={x:ue,y:Re,z:ze,angle:Ne})}else Ml(ne,U)}if(F){H.clear();let ae=f.icon.placedSymbolArray;for(let se=0;se<ae.length;se++){let fe=ae.get(se),{numGlyphs:me}=fe,ne=q[se];if(fe.hidden||!ne)Ml(me,H);else{let{x:le,y:ce,z:we,angle:Oe}=ne;for(let ue=0;ue<me;ue++)t.aH(H,le,ce,we,Oe)}}f.icon.dynamicLayoutVertexBuffer.updateData(H)}f.text.dynamicLayoutVertexBuffer.updateData(U)}function Nf(f,l,u,_,x,w,S={}){let I=u.paint.get("icon-translate"),A=u.paint.get("text-translate"),P=u.paint.get("icon-translate-anchor"),F=u.paint.get("text-translate-anchor"),B=u.layout.get("icon-rotation-alignment"),U=u.layout.get("text-rotation-alignment"),H=u.layout.get("icon-pitch-alignment"),q=u.layout.get("text-pitch-alignment"),Z=u.layout.get("icon-keep-upright"),X=u.layout.get("text-keep-upright"),K=u.paint.get("icon-color-saturation"),re=u.paint.get("icon-color-contrast"),ae=u.paint.get("icon-color-brightness-min"),se=u.paint.get("icon-color-brightness-max"),fe=u.paint.get("icon-occlusion-opacity").constantOr(0),me=u.paint.get("text-occlusion-opacity").constantOr(0),ne=f.context,le=ne.gl,ce=f.transform,we=B==="map",Oe=U==="map",ue=H==="map",Re=q==="map",ze=fe!==1,Ke=me!==1,Je=u.layout.get("symbol-sort-key").constantOr(1)!==void 0,Xe=!1,De=f.depthModeForSublayer(0,t.ae.ReadOnly),Ne=[t.aj(ce.center.lng),t.ak(ce.center.lat)],Ze=u.layout.get("text-variable-anchor"),mt=ce.projection.name==="globe",_t=[],St=[0,-1,0];for(let yt of _){let it=l.getTile(yt),$e=it.getBucket(u);if(!$e||$e.projection.name==="mercator"&&mt||$e.fullyClipped)continue;let Pt=$e.projection.name==="globe",hi=Pt?t.a1(ce.zoom):0,ai=Vc(yt,$e.getProjection(),ce),xi=ce.calculatePixelsToTileUnitsMatrix(it),zi=Ze&&$e.hasTextData(),an=$e.hasIconTextFit()&&zi&&$e.hasIconData(),ti=$e.getProjection().createInversionMatrix(ce,yt.canonical),Ki=()=>{let Qe=we&&u.layout.get("symbol-placement")!=="point",wt=[];u.hasInitialOcclusionOpacityProperties&&ze&&f.symbolParams.useOcclusionQueries&&!Pt&&!mt&&wt.push("OCCLUSION_QUERIES"),u.hasInitialOcclusionOpacityProperties||wt.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH");let On=Qe||an,Qi=u.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&ue&&wt.push("PITCH_WITH_MAP_TERRAIN"),Pt&&(wt.push("PROJECTION_GLOBE_VIEW"),On&&wt.push("PROJECTED_POS_ON_VIEWPORT")),Qi>0&&wt.push("ICON_TRANSITION"),$e.icon.zOffsetVertexBuffer&&wt.push("Z_OFFSET"),K===0&&re===0&&ae===0&&se===1||wt.push("COLOR_ADJUSTMENT");let Pe=$e.icon.programConfigurations.get(u.id),Uo=f.getOrCreateProgram($e.sdfIcons?"symbolSDF":"symbolIcon",{config:Pe,defines:wt}),Lr,io=it.imageAtlasTexture?it.imageAtlasTexture.size:[0,0],xr=$e.iconSizeData,bo=t.aD(xr,ce.zoom),Ma=ue||ce.pitch!==0,Ho=Cl(ai,it.tileID.canonical,ue,we,ce,$e.getProjection(),xi),$s=Oc(ai,it.tileID.canonical,ue,we,ce,$e.getProjection(),xi),qs=f.translatePosMatrix($s,it,I,P,!0),us=f.translatePosMatrix(ai,it,I,P),Ga=On?El:Ho,ps=we&&!ue&&!Qe,Jc=St;!mt&&!ce.mercatorFromTransition||we||(Jc=$0(ce));let ed=Pt?Jc:St;if($e.sdfIcons&&!$e.iconsInText)Lr=lp(xr.kind,bo,ps,ue,f,us,Ga,qs,!1,io,!0,yt,hi,Ne,ti,ed,$e.getProjection());else{let pr=u.getColorAdjustmentMatrix(K,re,ae,se);Lr=Nc(xr.kind,bo,ps,ue,f,us,Ga,qs,!1,io,yt,hi,Ne,ti,ed,$e.getProjection(),pr,Qi)}let Nl=it.imageAtlasTexture?it.imageAtlasTexture:null,td=u.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear,Ap=$e.sdfIcons||f.options.rotating||f.options.zooming||td||Ma?le.LINEAR:le.NEAREST,Pp=$e.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,_g=f.terrain&&ue&&Qe?t.ad.invert(t.ad.create(),Ho):El;if(Qe&&$e.icon){let pr=ce.elevation,yg=pr?pr.getAtTileOffsetFunc(yt,ce.center.lat,ce.worldSize,$e.getProjection()):null,id=Sl(ai,it.tileID.canonical,ue,we,ce,$e.getProjection(),xi);Zu($e,ai,f,!1,id,$s,ue,Z,yg,yt)}return{program:Uo,buffers:$e.icon,uniformValues:Lr,atlasTexture:Nl,atlasTextureIcon:null,atlasInterpolation:Ap,atlasInterpolationIcon:null,isSDF:$e.sdfIcons,hasHalo:Pp,tile:it,labelPlaneMatrixInv:_g}},_n=()=>{let Qe=Oe&&u.layout.get("symbol-placement")!=="point",wt=[],On=Qe||Ze||an;u.hasInitialOcclusionOpacityProperties&&Ke&&f.symbolParams.useOcclusionQueries&&!Pt&&!mt&&wt.push("OCCLUSION_QUERIES"),u.hasInitialOcclusionOpacityProperties||wt.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH"),f.terrainRenderModeElevated()&&Re&&wt.push("PITCH_WITH_MAP_TERRAIN"),Pt&&(wt.push("PROJECTION_GLOBE_VIEW"),On&&wt.push("PROJECTED_POS_ON_VIEWPORT")),$e.text.zOffsetVertexBuffer&&wt.push("Z_OFFSET");let Qi=$e.text.programConfigurations.get(u.id),Pe=f.getOrCreateProgram($e.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Qi,defines:wt}),Uo,Lr=[0,0],io=null,xr=$e.textSizeData;$e.iconsInText&&(Lr=it.imageAtlasTexture?it.imageAtlasTexture.size:[0,0],io=it.imageAtlasTexture?it.imageAtlasTexture:null,Uo=Re||ce.pitch!==0||f.options.rotating||f.options.zooming||xr.kind==="composite"||xr.kind==="camera"?le.LINEAR:le.NEAREST);let bo=it.glyphAtlasTexture?it.glyphAtlasTexture.size:[0,0],Ma=t.aD(xr,ce.zoom),Ho=Cl(ai,it.tileID.canonical,Re,Oe,ce,$e.getProjection(),xi),$s=Oc(ai,it.tileID.canonical,Re,Oe,ce,$e.getProjection(),xi),qs=f.translatePosMatrix($s,it,A,F,!0),us=f.translatePosMatrix(ai,it,A,F),Ga=On?El:Ho,ps=Oe&&!Re&&!Qe,Jc=St;!mt&&!ce.mercatorFromTransition||Oe||(Jc=$0(ce));let ed=Pt?Jc:St,Nl;Nl=$e.iconsInText?U0(xr.kind,Ma,ps,Re,f,us,Ga,qs,bo,Lr,yt,hi,Ne,ti,ed,$e.getProjection()):lp(xr.kind,Ma,ps,Re,f,us,Ga,qs,!0,bo,!0,yt,hi,Ne,ti,ed,$e.getProjection());let td=it.glyphAtlasTexture?it.glyphAtlasTexture:null,Ap=le.LINEAR,Pp=u.paint.get("text-halo-width").constantOr(1)!==0,_g=f.terrain&&Re&&Qe?t.ad.invert(t.ad.create(),Ho):El;if(Qe&&$e.text){let pr=ce.elevation,yg=pr?pr.getAtTileOffsetFunc(yt,ce.center.lat,ce.worldSize,$e.getProjection()):null,id=Sl(ai,it.tileID.canonical,Re,Oe,ce,$e.getProjection(),xi);Zu($e,ai,f,!0,id,$s,Re,X,yg,yt)}return{program:Pe,buffers:$e.text,uniformValues:Nl,atlasTexture:td,atlasTextureIcon:io,atlasInterpolation:Ap,atlasInterpolationIcon:Uo,isSDF:!0,hasHalo:Pp,tile:it,labelPlaneMatrixInv:_g}},tn=$e.icon.segments.get().length,Ti=$e.text.segments.get().length,si=tn&&!S.onlyText?Ki():null,xn=Ti&&!S.onlyIcons?_n():null,Mn=u.paint.get("icon-opacity").constantOr(1),ln=u.paint.get("text-opacity").constantOr(1);if(Je&&$e.canOverlap){Xe=!0;let Qe=Mn&&!S.onlyText?$e.icon.segments.get():[],wt=ln&&!S.onlyIcons?$e.text.segments.get():[];for(let On of Qe)_t.push({segments:new t.b([On]),sortKey:On.sortKey,state:si});for(let On of wt)_t.push({segments:new t.b([On]),sortKey:On.sortKey,state:xn})}else S.onlyText||_t.push({segments:Mn?$e.icon.segments:new t.b([]),sortKey:0,state:si}),S.onlyIcons||_t.push({segments:ln?$e.text.segments:new t.b([]),sortKey:0,state:xn})}Xe&&_t.sort((yt,it)=>yt.sortKey-it.sortKey);for(let yt of _t){let it=yt.state;if(it)if(f.terrain&&f.terrain.setupElevationDraw(it.tile,it.program,{useDepthForOcclusion:!u.hasInitialOcclusionOpacityProperties&&ce.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:it.labelPlaneMatrixInv}),ne.activeTexture.set(le.TEXTURE0),it.atlasTexture&&it.atlasTexture.bind(it.atlasInterpolation,le.CLAMP_TO_EDGE,!0),it.atlasTextureIcon&&(ne.activeTexture.set(le.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,le.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,it.program),it.hasHalo){let $e=it.uniformValues;$e.u_is_halo=1,jc(it.buffers,yt.segments,u,f,it.program,De,x,w,$e,2),$e.u_is_halo=0}else{if(it.isSDF){let $e=it.uniformValues;it.hasHalo&&($e.u_is_halo=1,jc(it.buffers,yt.segments,u,f,it.program,De,x,w,$e,1)),$e.u_is_halo=0}jc(it.buffers,yt.segments,u,f,it.program,De,x,w,it.uniformValues,1)}}}function jc(f,l,u,_,x,w,S,I,A,P){let F=_.context.gl,B=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];f.occlusionQueryOpacityVertexBuffer.length>0&&B.push(f.occlusionQueryOpacityVertexBuffer),x.draw(_,F.TRIANGLES,w,S,I,t.af.disabled,A,u.id,f.layoutVertexBuffer,f.indexBuffer,l,u.paint,_.transform.zoom,f.programConfigurations.get(u.id),B,P)}function Vf(f,l,u,_,x,w,S){let I=f.context.gl,A=u.paint.get("fill-pattern"),P=A&&A.constantOr(1),F,B,U,H,q;S?(B=P&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=I.LINES):(B=P?"fillPattern":"fill",F=I.TRIANGLES);for(let Z of _){let X=l.getTile(Z);if(P&&!X.patternsLoaded())continue;let K=X.getBucket(u);if(!K)continue;f.prepareDrawTile();let re=K.programConfigurations.get(u.id),ae=f.isTileAffectedByFog(Z),se=f.getOrCreateProgram(B,{config:re,overrideFog:ae});P&&(f.context.activeTexture.set(I.TEXTURE0),X.imageAtlasTexture&&X.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),re.updatePaintBuffers());let fe=A.constantOr(null);if(fe&&X.imageAtlas){let le=X.imageAtlas.patternPositions[fe.toString()];le&&re.setConstantPatternPositions(le)}let me=f.translatePosMatrix(Z.projMatrix,X,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),ne=u.paint.get("fill-emissive-strength");if(S){H=K.indexBuffer2,q=K.segments2;let le=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];U=B==="fillOutlinePattern"&&P?ap(me,ne,f,X,le):V0(me,ne,le)}else H=K.indexBuffer,q=K.segments,U=P?Of(me,ne,f,X):Pf(me,ne);f.uploadCommonUniforms(f.context,se,Z.toUnwrapped()),se.draw(f,F,x,f.stencilModeForClipping(Z),w,t.af.disabled,U,u.id,K.layoutVertexBuffer,H,q,u.paint,f.transform.zoom,re,void 0)}}function Uc(f,l,u,_,x,w,S,I){u.resetLayerRenderingStats(f);let A=f.context,P=A.gl,F=f.transform,B=u.paint.get("fill-extrusion-pattern"),U=B.constantOr(1),H=u.paint.get("fill-extrusion-opacity"),q=f.style.enable3dLights(),Z=u.paint.get(q&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),X=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],K=u.layout.get("fill-extrusion-edge-radius"),re=K>0&&!u.paint.get("fill-extrusion-rounded-roof"),ae=re?0:K,se=F.projection.name==="globe"?t.bY():0,fe=F.projection.name==="globe",me=fe?t.a1(F.zoom):0,ne=[t.aj(F.center.lng),t.ak(F.center.lat)],le=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(u.lut).toArray01().slice(0,3),ce=u.paint.get("fill-extrusion-flood-light-intensity"),we=u.paint.get("fill-extrusion-vertical-scale"),Oe=ss(f,u.paint.get("fill-extrusion-cutoff-fade-range")),ue=u.paint.get("fill-extrusion-emissive-strength"),Re=[],ze;fe&&Re.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&Re.push("FAUX_AO"),re&&Re.push("ZERO_ROOF_RADIUS"),I&&Re.push("HAS_CENTROID"),ce>0&&Re.push("FLOOD_LIGHT"),Oe.shouldRenderCutoff&&Re.push("RENDER_CUTOFF");let Ke=f.renderPass==="shadow",Je=f.shadowRenderer,Xe=Ke&&!!Je;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let De=[0,0,0];if(Je){let mt=f.style.directionalLight,_t=f.style.ambientLight;mt&&_t&&(De=ls(f.style,mt,_t)),ze=Re.concat(["SHADOWS_SINGLE_CASCADE"])}let Ne=Xe?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",Ze=u.getLayerRenderingStats();for(let mt of _){let _t=l.getTile(mt),St=_t.getBucket(u);if(!St||St.projection.name!==F.projection.name)continue;let yt=!1;Je&&(yt=Je.getMaxCascadeForTile(mt.toUnwrapped())===0);let it=f.isTileAffectedByFog(mt),$e=St.programConfigurations.get(u.id),Pt=f.getOrCreateProgram(Ne,{config:$e,defines:yt?ze:Re,overrideFog:it});if(f.terrain&&f.terrain.setupElevationDraw(_t,Pt,{useMeterToDem:!0}),!St.centroidVertexBuffer){let ti=Pt.attributes.a_centroid_pos;ti!==void 0&&P.vertexAttrib2f(ti,0,0)}!Ke&&Je&&Je.setupShadows(_t.tileID.toUnwrapped(),Pt,"vector-tile",_t.tileID.overscaledZ),U&&(f.context.activeTexture.set(P.TEXTURE0),_t.imageAtlasTexture&&_t.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),$e.updatePaintBuffers());let hi=B.constantOr(null);if(hi&&_t.imageAtlas){let ti=_t.imageAtlas.patternPositions[hi.toString()];ti&&$e.setConstantPatternPositions(ti)}let ai=u.paint.get("fill-extrusion-vertical-gradient"),xi;if(Ke&&Je){if(jf(_t.tileID,St,f))continue;let ti=Je.calculateShadowPassMatrixFromTile(_t.tileID.toUnwrapped());xi=Bc(ti,ae,we)}else{let ti=f.translatePosMatrix(mt.expandedProjMatrix,_t,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ki=F.projection.createInversionMatrix(F,mt.canonical);xi=U?Af(ti,f,ai,H,X,ae,mt,_t,se,me,ne,Ki,le,we):zc(ti,f,ai,H,X,ae,mt,se,me,ne,Ki,le,we,ce,De,ue)}f.uploadCommonUniforms(A,Pt,mt.toUnwrapped(),null,Oe);let zi=St.segments;if(F.projection.name==="mercator"&&!Ke&&(zi=St.getVisibleSegments(_t.tileID,f.terrain,f.transform.getFrustum(0)),!zi.get().length))continue;if(Ze)if(Ke)for(let ti of zi.get())Ze.numRenderedVerticesInShadowPass+=ti.primitiveLength;else for(let ti of zi.get())Ze.numRenderedVerticesInTransparentPass+=ti.primitiveLength;let an=[];(f.terrain||I)&&an.push(St.centroidVertexBuffer),fe&&an.push(St.layoutVertexExtBuffer),Pt.draw(f,A.gl.TRIANGLES,x,w,S,t.af.backCCW,xi,u.id,St.layoutVertexBuffer,St.indexBuffer,zi,u.paint,f.transform.zoom,$e,an)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function fo(f,l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z,X,K,re){let ae=f.context,se=ae.gl,fe=f.transform,me=f.transform.zoom,ne=[],le=ss(f,u.paint.get("fill-extrusion-cutoff-fade-range"));P==="clear"?(ne.push("CLEAR_SUBPASS"),re&&(ne.push("CLEAR_FROM_TEXTURE"),ae.activeTexture.set(se.TEXTURE0),re.bind(se.LINEAR,se.CLAMP_TO_EDGE))):P==="sdf"&&ne.push("SDF_SUBPASS"),X&&ne.push("HAS_CENTROID"),le.shouldRenderCutoff&&ne.push("RENDER_CUTOFF");let ce=u.layout.get("fill-extrusion-edge-radius"),we=(Oe,ue,Re,ze,Ke)=>{let Je=ue.programConfigurations.get(u.id),Xe=f.isTileAffectedByFog(Oe),De=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:Je,defines:ne,overrideFog:Xe}),Ne=((mt,_t,St,yt,it,$e,Pt,hi,ai,xi,zi)=>({u_matrix:_t,u_opacity:St,u_ao_pass:yt?1:0,u_meter_to_tile:it,u_ao:$e,u_flood_light_intensity:Pt,u_flood_light_color:hi,u_attenuation:ai,u_edge_radius:xi,u_fb:0,u_fb_size:zi}))(0,ze,F,A,Ke,[B,U*Ke],H,q,Z,me>=17?0:ce*Ke,re?re.size[0]:0),Ze=[];X&&Ze.push(ue.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(ae,De,Oe.toUnwrapped(),null,le),De.draw(f,ae.gl.TRIANGLES,x,w,S,I,Ne,u.id,ue.vertexBuffer,ue.indexBuffer,Re,u.paint,me,Je,Ze)};for(let Oe of _){let ue=l.getTile(Oe),Re=ue.getBucket(u);if(!Re||Re.projection.name!==fe.projection.name||!Re.groundEffect||Re.groundEffect&&!Re.groundEffect.hasData())continue;let ze=Re.groundEffect,Ke=1/Re.tileToMeter;{let Je=f.translatePosMatrix(Oe.projMatrix,ue,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Xe=ze.getDefaultSegment();we(Oe,ze,Xe,Je,Ke)}if(K)for(let Je=0;Je<4;Je++){let Xe=t.bZ[Je](Oe),De=l.getTile(Xe);if(!De)continue;let Ne=De.getBucket(u);if(!Ne||Ne.projection.name!==fe.projection.name||!Ne.groundEffect||Ne.groundEffect&&!Ne.groundEffect.hasData())continue;let Ze=Ne.groundEffect,mt,_t;Je===0?(mt=[-t.a3,0,0],_t=1):Je===1?(mt=[t.a3,0,0],_t=0):Je===2?(mt=[0,-t.a3,0],_t=3):(mt=[0,t.a3,0],_t=2);let St=Ze.regionSegments[_t];if(!St)continue;let yt=new Float32Array(16);t.ad.translate(yt,Oe.projMatrix,mt),we(Oe,Ze,St,f.translatePosMatrix(yt,ue,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ke)}}}function hp(f,l,u,_,x,w,S){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();let I=w?w.findDEMTileFor(u):null;if(!(I&&I.dem||S))return;let A=K=>new t.P(Math.ceil((K+t.c0)*t.c1),0),P=K=>{let re=l.getSource().minzoom,ae=fe=>{let me=l.getTileByID(fe);if(me&&me.hasData())return me.getBucket(x)},se=[0,-1,1];for(let fe of se){if(K.overscaledZ+fe<re)continue;let me=ae(K.calculateScaledKey(K.overscaledZ+fe));if(me)return me}},F=[0,0,0],B=(K,re)=>(F[0]=Math.min(K.min.y,re.min.y),F[1]=Math.max(K.max.y,re.max.y),F[2]=t.a3-re.min.x>K.max.x?re.min.x-t.a3:K.max.x,F),U=(K,re)=>(F[0]=Math.min(K.min.x,re.min.x),F[1]=Math.max(K.max.x,re.max.x),F[2]=t.a3-re.min.y>K.max.y?re.min.y-t.a3:K.max.y,F),H=[(K,re)=>B(K,re),(K,re)=>B(re,K),(K,re)=>U(K,re),(K,re)=>U(re,K)],q=(K,re,ae,se,fe,me,ne)=>{if(!w)return 0;let le=[[me?ae:K,me?K:ae,0],[me?ae:re,me?re:ae,0]],ce=ne<0?t.a3+ne:ne,we=[me?ce:(K+re)/2,me?(K+re)/2:ce,0];return ae===0&&ne<0||ae!==0&&ne>0?w.getForTilePoints(fe,[we],!0,se):le.push(we),w.getForTilePoints(u,le,!0,I),Math.max(le[0][2],le[1][2],we[2])/w.exaggeration()};for(let K=0;K<4;K++){let re=_.borderFeatureIndices[K];if(re.length===0)continue;let ae=t.bZ[K](u),se=P(ae);if(!(se&&se instanceof t.b_)||_.borderDoneWithNeighborZ[K]===se.canonical.z)continue;se.centroidVertexArray.length===0&&se.createCentroidsBuffer();let fe=w?w.findDEMTileFor(ae):null;if(!(fe&&fe.dem||S))continue;let me=(K<2?1:5)-K,ne=se.borderDoneWithNeighborZ[me]!==_.canonical.z,le=se.borderFeatureIndices[me],ce=0;if(_.canonical.z!==se.canonical.z){for(let we of re)_.showCentroid(_.featuresOnBorder[we]);if(ne)for(let we of le)se.showCentroid(se.featuresOnBorder[we]);_.borderDoneWithNeighborZ[K]=se.canonical.z,se.borderDoneWithNeighborZ[me]=_.canonical.z}for(let we of re){let Oe=_.featuresOnBorder[we],ue=_.centroidData[Oe.centroidDataIndex],Re=Oe.borders[K],ze;for(;ce<le.length;){ze=se.featuresOnBorder[le[ce]];let Ke=ze.borders[me];if(Ke[1]>Re[0]+3||Ke[0]>Re[0]-3)break;se.showCentroid(ze),ce++}if(ze&&ce<le.length){let Ke=ce,Je=0;for(;!(ze.borders[me][0]>Re[1]-3)&&(Je++,++ce!==le.length);)ze=se.featuresOnBorder[le[ce]];if(ze=se.featuresOnBorder[le[Ke]],Je>1){let Ne=ze.borders[me];Math.abs(Re[0]-Ne[0])<3&&Math.abs(Re[1]-Ne[1])<3&&(Je=1,ce=Ke+1)}else if(Je===0){_.showCentroid(Oe);continue}let Xe=se.centroidData[ze.centroidDataIndex];S&&Je===1&&(((Z=ue).flags|(X=Xe).flags)&t.b$?(Z.flags|=t.b$,X.flags|=t.b$):(Z.flags&=~t.b$,X.flags&=~t.b$));let De=Oe.intersectsCount()>1||ze.intersectsCount()>1;if(Je>1)ce=Ke,ue.centroidXY=Xe.centroidXY=new t.P(0,0);else if(fe&&fe.dem&&!De){let Ne=H[K](ue,Xe),Ze=K%2?t.a3-1:0,mt=q(Ne[0],Math.min(t.a3-1,Ne[1]),Ze,fe,ae,K<2,Ne[2]);ue.centroidXY=Xe.centroidXY=A(mt)}else De?ue.centroidXY=Xe.centroidXY=new t.P(0,0):(ue.centroidXY=_.encodeBorderCentroid(Oe),Xe.centroidXY=se.encodeBorderCentroid(ze));_.writeCentroidToBuffer(ue),se.writeCentroidToBuffer(Xe)}else _.showCentroid(Oe)}_.borderDoneWithNeighborZ[K]=se.canonical.z,se.borderDoneWithNeighborZ[me]=_.canonical.z}var Z,X;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(f)}let Dl=[1,0,0],Y0=[0,1,0],up=[0,0,1];function jf(f,l,u){let _=u.transform,x=u.shadowRenderer;if(!x)return!0;let w=f.toUnwrapped(),S=_.tileSize*x._cascades[u.currentShadowCascade].scale,I=l.maxHeight;if(_.elevation){let Z=_.elevation.getMinMaxForTile(f);Z&&(I+=Z.max)}let A=[...x.shadowDirection];A[2]=-A[2];let P=x.computeSimplifiedTileShadowVolume(w,I,S,A);if(!P)return!1;let F=[Dl,Y0,up,A,[A[0],0,A[2]],[0,A[1],A[2]]],B=_.projection.name==="globe",U=_.scaleZoom(S),H=t.aM.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,U,!B),q=x.getCurrentCascadeFrustum();return H.intersectsPrecise(P.vertices,P.planes,F)===0||q.intersectsPrecise(P.vertices,P.planes,F)===0}function Ih(f){return[f[0]*t.c2,f[1]*t.c2,f[2]*t.c2,0]}function Eh(f,l,u,_,x,w,S,I,A){let P=_.getSource(),F=u.globeSharedBuffers;if(!F)return;let B,U,H;if(l&&(B=_.getTile(l)),P instanceof t.bm?(U=P.texture,H=t.bh(0,0,u.transform)):B&&l&&(U=B.texture,H=t.bh(l.canonical.z,l.canonical.x,u.transform)),!U||!H)return;f||(H=t.ad.scale(t.ad.create(),H,[1,-1,1]));let q=u.context,Z=q.gl,X=x.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,K=u.colorModeForDrapableLayerRenderPass(w),re=S.defines;re.push("GLOBE_POLES");let ae=new t.ae(Z.LEQUAL,t.ae.ReadWrite,u.depthRangeFor3D),se=Float32Array.from(u.transform.expandedFarZProjMatrix),fe=Float32Array.from(t.bf(t.bg(new t.aO(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),q.activeTexture.set(Z.TEXTURE0),U.bind(X,Z.CLAMP_TO_EDGE),q.activeTexture.set(Z.TEXTURE1),U.bind(X,Z.CLAMP_TO_EDGE),U.useMipmap&&q.extTextureFilterAnisotropic&&u.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);let[me,ne,le,ce]=l?F.getPoleBuffers(l.canonical.z,!1):F.getPoleBuffers(0,!0),we=x.paint.get("raster-elevation"),Oe;f?(Oe=me,u.renderDefaultNorthPole=we!==0):(Oe=ne,u.renderDefaultSouthPole=we!==0);let ue=Ih(S.mix),Re=((Ke,Je,Xe,De,Ne,Ze,mt,_t,St,yt,it,$e,Pt)=>wh(Ke,Je,Xe,new Float32Array(16),new Float32Array(9),[0,0],De,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],_t,2,yt,it,$e,1,0,Pt))(se,fe,H,t.a1(u.transform.zoom),0,x,0,we,0,ue,S.offset,S.range,w),ze=u.getOrCreateProgram("raster",{defines:re});u.uploadCommonUniforms(q,ze,null),ze.draw(u,Z.TRIANGLES,ae,A,K,I,Re,x.id,Oe,le,ce)}function Wi(f){let l=f._nearZ,u=f.projection.farthestPixelDistance(f),_=u-l,x=.2*f.height,w=l+x;return[l,u,(w-x-l)/_,(w-l)/_]}function e1(f,l,u,_){if(f)return l instanceof Lc&&f instanceof t.c3?l.getTextureDescriptor(f,u,!0):{texture:f.texture,mix:Ih(_.mix),offset:_.offset,buffer:0,tileSize:1}}function Gt(f,l,u){if(!f)return null;let _=l.getTextureDescriptor(f,u,!0);if(!_)return null;let{texture:x,mix:w,offset:S,tileSize:I,buffer:A,format:P}=_;if(!x||!P)return null;let F=!1;return P==="uint32"&&(F=!0,w[3]=0,w=j0(t.c4,w,[0,u.paint.get("raster-particle-max-speed")]),S=Ff(t.c4,S,[0,u.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[A/(I+2*A),I/(I+2*A)],tileSize:I,scalarData:F,scale:w,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function Z0(f){let l=f._nearZ,u=f.projection.farthestPixelDistance(f),_=u-l,x=.2*f.height,w=l+x;return[l,u,(w-x-l)/_,(w-l)/_]}let pp=new t.C(1,0,0,1),Uf=new t.C(0,1,0,1),Ua=new t.C(0,0,1,1),Hf=new t.C(1,0,1,1),Hc=new t.C(0,1,1,1);function Dt(f,l,u,_,x,w,S){let I=f.context,A=f.transform,P=I.gl,F=A.projection.name==="globe",B=F?["PROJECTION_GLOBE_VIEW"]:[],U=t.ad.clone(u.projMatrix);if(F&&t.a1(A.zoom)>0){let ue=t.c5(u.canonical,A),Re=t.c6(ue);U=t.ad.multiply(new Float32Array(16),A.globeMatrix,Re),t.ad.multiply(U,A.projMatrix,U)}let H=t.ad.create();H[12]+=2*x/(t.e.devicePixelRatio*A.width),H[13]+=2*w/(t.e.devicePixelRatio*A.height),t.ad.multiply(U,H,U);let q=f.getOrCreateProgram("debug",{defines:B}),Z=l.getTileByID(u.key);f.terrain&&f.terrain.setupElevationDraw(Z,q);let X=t.ae.disabled,K=t.ag.disabled,re=f.colorModeForRenderPass(),ae="$debug";I.activeTexture.set(P.TEXTURE0),f.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),F?Z._makeGlobeTileDebugBuffers(f.context,A):Z._makeDebugTileBoundsBuffers(f.context,A.projection);let se=Z._tileDebugBuffer||f.debugBuffer,fe=Z._tileDebugIndexBuffer||f.debugIndexBuffer,me=Z._tileDebugSegments||f.debugSegments;if(q.draw(f,P.LINE_STRIP,X,K,re,t.af.disabled,sp(U,_),ae,se,fe,me,null,null,null,[Z._globeTileDebugBorderBuffer]),S){let ue=Z.latestRawTileData,Re=Math.floor((ue&&ue.byteLength||0)/1024),ze=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ze+=` => ${u.overscaledZ}`),ze+=` ${Z.state}`,ze+=` ${Re}kb`,function(Ke,Je){Ke.initDebugOverlayCanvas();let Xe=Ke.debugOverlayCanvas,De=Ke.context.gl,Ne=Ke.debugOverlayCanvas.getContext("2d");Ne.clearRect(0,0,Xe.width,Xe.height),Ne.shadowColor="white",Ne.shadowBlur=2,Ne.lineWidth=1.5,Ne.strokeStyle="white",Ne.textBaseline="top",Ne.font="bold 36px Open Sans, sans-serif",Ne.fillText(Je,5,5),Ne.strokeText(Je,5,5),Ke.debugOverlayTexture.update(Xe),Ke.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(f,ze)}let ne=l.getTile(u).tileSize,le=512/Math.min(ne,512)*(u.overscaledZ/A.zoom)*.5,ce=Z._tileDebugTextBuffer||f.debugBuffer,we=Z._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Oe=Z._tileDebugTextSegments||f.debugSegments;q.draw(f,P.TRIANGLES,X,K,t.a.alphaBlended,t.af.disabled,sp(U,t.C.transparent,le),ae,ce,we,Oe,null,null,null,[Z._globeTileDebugTextBuffer])}function Gi(f,l,u,_){go(f,0,l+u/2,f.transform.width,u,_)}function $i(f,l,u,_){go(f,l-u/2,0,u,f.transform.height,_)}function go(f,l,u,_,x,w){let S=f.context,I=S.gl;I.enable(I.SCISSOR_TEST),I.scissor(l*t.e.devicePixelRatio,u*t.e.devicePixelRatio,_*t.e.devicePixelRatio,x*t.e.devicePixelRatio),S.clear({color:w}),I.disable(I.SCISSOR_TEST)}let Wc=t.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ui}=Wc;function va(f,l,u,_){f.emplaceBack(l,u,_)}class Gc{constructor(l){this.vertexArray=new t.c8,this.indices=new t.bu,va(this.vertexArray,-1,-1,1),va(this.vertexArray,1,-1,1),va(this.vertexArray,-1,1,1),va(this.vertexArray,1,1,1),va(this.vertexArray,-1,-1,-1),va(this.vertexArray,1,-1,-1),va(this.vertexArray,-1,1,-1),va(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,Ui),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=t.b.simpleSegment(0,0,36,12)}}function Ha(f,l,u,_,x,w){let S=f.context.gl,I=l.paint.get("sky-atmosphere-color"),A=l.paint.get("sky-atmosphere-halo-color"),P=l.paint.get("sky-atmosphere-sun-intensity"),F=((B,U,H,q,Z)=>({u_matrix_3f:B,u_sun_direction:U,u_sun_intensity:H,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(t.bC.fromMat4(t.bC.create(),_),x,P,I,A);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+w,l.skyboxTexture,0),u.draw(f,S.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.frontCW,F,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}let Do=t.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Jn{constructor(l){let u=new t.c9;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);let _=new t.bu;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(u,Do.members),this.indexBuffer=l.createIndexBuffer(_),this.segments=t.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let t1=t.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Dh{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Wf{constructor(l){this.colorModeAlphaBlendedWriteRGB=new t.a([t.ca,t.cb,t.ca,t.cb],t.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new t.a([t.ca,t.cc,t.ca,t.cc],t.C.transparent,[!1,!1,!1,!0]),this.params=new Dh,this.updateNeeded=!0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),l.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(l){let u=l.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Jn(u);let _=this.params.sizeRange,x=this.params.intensityRange,w=function(F){let B=t.cf(30),U=[];for(let H=0;H<F;++H){let q=2*Math.PI*B(),Z=Math.acos(1-2*B())-.5*Math.PI;U.push(t._.fromValues(Math.cos(Z)*Math.cos(q),Math.cos(Z)*Math.sin(q),Math.sin(Z)))}return U}(this.params.starsCount),S=t.cf(300),I=new t.cd,A=new t.bu,P=0;for(let F=0;F<w.length;++F){let B=t._.scale([],w[F],200),U=Math.max(0,1+.01*_*(1*S()-.5)),H=Math.max(0,1+.01*x*(1*S()-.5));I.emplaceBack(B[0],B[1],B[2],-1,-1,U,H),I.emplaceBack(B[0],B[1],B[2],1,-1,U,H),I.emplaceBack(B[0],B[1],B[2],1,1,U,H),I.emplaceBack(B[0],B[1],B[2],-1,1,U,H),A.emplaceBack(P+0,P+1,P+2),A.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=u.createVertexBuffer(I,t1.members),this.starsIdx=u.createIndexBuffer(A),this.starsSegments=t.b.simpleSegment(0,0,I.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,u){let _=l.context,x=_.gl,w=l.transform,S=new t.ae(x.LEQUAL,t.ae.ReadOnly,[0,1]),I=t.a1(w.zoom),A=l.style.getLut(u.scope),P=u.properties.get("color").toRenderColor(A).toArray01(),F=u.properties.get("high-color").toRenderColor(A).toArray01(),B=u.properties.get("space-color").toRenderColor(A).toArray01PremultipliedAlpha(),U=5e-4,H=t.ce(u.properties.get("horizon-blend"),0,1,U,.25),q=t.ba(l,_,w)&&H===U?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,Z=l.frameCounter/1e3%1,X=t._.length(w.globeCenterInViewSpace),K=Math.sqrt(Math.pow(X,2)-Math.pow(q,2)),re=Math.acos(K/X),ae=se=>{let fe=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];se&&fe.push("ALPHA_PASS");let me=l.getOrCreateProgram("globeAtmosphere",{defines:fe}),ne=((ce,we,Oe,ue,Re,ze,Ke,Je,Xe,De,Ne,Ze)=>({u_frustum_tl:ce,u_frustum_tr:we,u_frustum_br:Oe,u_frustum_bl:ue,u_horizon:Re,u_transition:ze,u_fadeout_range:Ke,u_color:Je,u_high_color:Xe,u_space_color:De,u_temporal_offset:Ne,u_horizon_angle:Ze}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,I,H,P,F,B,Z,re);l.uploadCommonUniforms(_,me);let le=this.atmosphereBuffer;le&&me.draw(l,x.TRIANGLES,S,t.ag.disabled,se?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,t.af.backCW,ne,se?"atmosphere_glow_alpha":"atmosphere_glow",le.vertexBuffer,le.indexBuffer,le.segments)};ae(!1),ae(!0)}drawStars(l,u){let _=t.at(u.properties.get("star-intensity"),0,1);if(_===0)return;let x=l.context,w=x.gl,S=l.transform,I=l.getOrCreateProgram("stars"),A=t.av.identity([]);t.av.rotateX(A,A,-S._pitch),t.av.rotateZ(A,A,-S.angle),t.av.rotateX(A,A,t.ab(S._center.lat)),t.av.rotateY(A,A,-t.ab(S._center.lng));let P=t.ad.fromQuat(new Float32Array(16),A),F=t.ad.multiply([],S.starsProjMatrix,P),B=t.bC.fromMat4([],P),U=t.bC.invert([],B),H=[0,1,0];t._.transformMat3(H,H,U),t._.scale(H,H,this.params.sizeMultiplier);let q=[1,0,0];t._.transformMat3(q,q,U),t._.scale(q,q,this.params.sizeMultiplier);let Z=(X=H,K=q,re=_,{u_matrix:Float32Array.from(F),u_up:X,u_right:K,u_intensity_multiplier:re});var X,K,re;l.uploadCommonUniforms(x,I),this.starsVx&&this.starsIdx&&I.draw(l,w.TRIANGLES,t.ae.disabled,t.ag.disabled,this.colorModeAlphaBlendedWriteRGB,t.af.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function $c(f,l){let u=[...f],_=l.cameraWorldSizeForFog/l.worldSize,x=t.ad.identity([]);return t.ad.scale(x,x,[_,_,1]),t.ad.multiply(u,x,u),t.ad.multiply(u,l.worldToFogMatrix,u),u}function kh(f,l,u,_,x){let w=u.material,S=_.context,{baseColorTexture:I,metallicRoughnessTexture:A}=w.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:F,emissionTexture:B}=w;function U(H,q,Z){if(H&&(f.push(q),S.activeTexture.set(S.gl.TEXTURE0+Z),H.gfxTexture)){let{minFilter:X,magFilter:K,wrapS:re,wrapT:ae}=H.sampler;H.gfxTexture.bindExtraParam(X,K,re,ae)}}U(I,"HAS_TEXTURE_u_baseColorTexture",eo.BaseColor),U(A,"HAS_TEXTURE_u_metallicRoughnessTexture",eo.MetallicRoughness),U(P,"HAS_TEXTURE_u_normalTexture",eo.Normal),U(F,"HAS_TEXTURE_u_occlusionTexture",eo.Occlusion),U(B,"HAS_TEXTURE_u_emissionTexture",eo.Emission),x&&(x.texture||(x.texture=new t.ch(_.context,x.image,[x.image.height,x.image.height,x.image.height],S.gl.RGBA)),S.activeTexture.set(S.gl.TEXTURE0+eo.LUT),x.texture&&x.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(u.texcoordBuffer)),u.colorBuffer&&(f.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(u.colorBuffer)),u.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(u.normalBuffer)),u.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(u.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES")}function kl(f,l,u,_,x,w){let S=u.paint.get("model-opacity"),I=l.context,A=new t.ae(l.context.gl.LEQUAL,t.ae.ReadWrite,l.depthRangeFor3D),P=l.transform,F=f.mesh,B=F.material,U=B.pbrMetallicRoughness,H=l.style.fog,q;q=l.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:t.ad.multiply([],_.zScaleMatrix,f.nodeModelMatrix),t.ad.multiply(q,_.negCameraPosMatrix,q);let Z=t.ad.invert([],q);t.ad.transpose(Z,Z);let X=u.paint.get("model-emissive-strength").constantOr(0),K=Mh(new Float32Array(f.worldViewProjection),new Float32Array(q),new Float32Array(Z),null,l,S,U.baseColorFactor.toRenderColor(null),B.emissiveFactor,U.metallicFactor,U.roughnessFactor,B,X,u),re={defines:[]},ae=[];kh(re.defines,ae,F,l,u.lut);let se=l.shadowRenderer;se&&(se.useNormalOffset=!1);let fe=null;if(H){let le=$c(f.nodeModelMatrix,l.transform);if(fe=new Float32Array(le),P.projection.name!=="globe"){let ce=F.aabb.min,we=F.aabb.max,[Oe,ue]=H.getOpacityForBounds(le,ce[0],ce[1],we[0],we[1]);re.overrideFog=Oe>=Dn||ue>=Dn}}let me=ss(l,u.paint.get("model-cutoff-fade-range"));me.shouldRenderCutoff&&re.defines.push("RENDER_CUTOFF");let ne=l.getOrCreateProgram("model",re);l.uploadCommonUniforms(I,ne,null,fe,me),l.renderPass!=="shadow"&&se&&se.setupShadowsFromMatrix(f.nodeModelMatrix,ne),ne.draw(l,I.gl.TRIANGLES,A,x,w,F.material.doubleSided?t.af.disabled:t.af.backCCW,K,u.id,F.vertexBuffer,F.indexBuffer,F.segments,u.paint,l.transform.zoom,void 0,ae)}function Xr(f,l,u,_,x,w,S){let I;I=f.projection.name==="globe"?t.ci(u,f):[...u],t.ad.multiply(I,I,l.matrix);let A=t.ad.multiply([],_,I);if(l.meshes)for(let P of l.meshes){if(P.material.alphaMode!=="BLEND"){S.push({mesh:P,depth:0,modelIndex:x,worldViewProjection:A,nodeModelMatrix:I});continue}let F=t._.transformMat4([],P.centroid,A);F[2]>0&&w.push({mesh:P,depth:F[2],modelIndex:x,worldViewProjection:A,nodeModelMatrix:I})}if(l.children)for(let P of l.children)Xr(f,P,u,_,x,w,S)}function _o(f,l,u,_){let x=u.shadowRenderer;if(!x)return;let w=x.getShadowPassDepthMode(),S=x.getShadowPassColorMode(),I=x.calculateShadowPassMatrixFromMatrix(l),A=W0(I);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,w,t.ag.disabled,S,t.af.backCCW,A,_.id,f.vertexBuffer,f.indexBuffer,f.segments,_.paint,u.transform.zoom,void 0,void 0)}function X0(f,l,u){let _=l.updateZoomBasedPaintProperties(),x=function(w,S,I){let A,P,F,B=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&B>0){let U=w.terrain,H=U.findDEMTileFor(I);H&&H.dem?A=t.ck.create(U,I,H):B=0}if(B===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),B===S.validForExaggeration&&(B===0||A&&A._demTile&&A._demTile.tileID===S.validForDEMTile.id&&A._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(let U in S.instancesPerModel){let H=S.instancesPerModel[U];for(let q=0;q<H.instancedDataArray.length;++q){let Z=(A?B*A.getElevationAt(0|H.instancedDataArray.float32[16*q],0|H.instancedDataArray.float32[16*q+1],!0,!0):0)+H.instancesEvaluatedElevation[q];H.instancedDataArray.float32[16*q+6]=Z,P=P?Math.min(S.terrainElevationMin,Z):Z,F=F?Math.max(S.terrainElevationMax,Z):Z}}return S.terrainElevationMin=P||0,S.terrainElevationMax=F||0,S.validForExaggeration=B,S.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,l,u);(_||x)&&(l.uploaded=!1,l.upload(f.context))}let yo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new t.b6([0,0,0],[t.a3,t.a3,0])};function dr(f,l){let u=1<<f.canonical.z,_=l.getFreeCameraOptions().position,x=l.elevation,w=f.canonical.x/u,S=(f.canonical.x+1)/u,I=f.canonical.y/u,A=(f.canonical.y+1)/u,P=l._centerAltitude;if(x){let H=x.getMinMaxForTile(f);H&&H.max>P&&(P=H.max)}let F=t.at(_.x,w,S)-_.x,B=t.at(_.y,I,A)-_.y,U=t.ax(P,l.center.lat)-_.z;return l._zoomFromMercatorZ(Math.sqrt(F*F+B*B+U*U))}function ea(f,l,u,_,x,w,S){let I=f.context,A=f.renderPass==="shadow",P=f.shadowRenderer,F=A&&P?P.getShadowPassDepthMode():new t.ae(I.gl.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D),B=f.isTileAffectedByFog(w);if(u.meshes)for(let U of u.meshes){let H=["MODEL_POSITION_ON_GPU"],q=[],Z,X,K;_.instancedDataArray.length>20&&H.push("INSTANCED_ARRAYS");let re=ss(f,l.paint.get("model-cutoff-fade-range"));if(re.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),A&&P)Z=f.getOrCreateProgram("modelDepth",{defines:H}),X=W0(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(u.matrix)),K=P.getShadowPassColorMode();else{kh(H,q,U,f,l.lut),Z=f.getOrCreateProgram("model",{defines:H,overrideFog:B});let se=U.material,fe=se.pbrMetallicRoughness,me=l.paint.get("model-opacity"),ne=l.paint.get("model-emissive-strength").constantOr(0);X=Mh(w.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),null,f,me,fe.baseColorFactor.toRenderColor(null),se.emissiveFactor,fe.metallicFactor,fe.roughnessFactor,se,ne,l,x),P&&(S.shadowUniformsInitialized?Z.setShadowUniformValues(I,P.getShadowUniformValues()):(P.setupShadows(w.toUnwrapped(),Z,"model-tile",w.overscaledZ),S.shadowUniformsInitialized=!0)),K=re.shouldRenderCutoff||me<1||se.alphaMode!=="OPAQUE"?t.a.alphaBlended:t.a.unblended}f.uploadCommonUniforms(I,Z,w.toUnwrapped(),null,re);let ae=U.material.doubleSided?t.af.disabled:t.af.backCCW;if(_.instancedDataArray.length>20)q.push(_.instancedDataBuffer),Z.draw(f,I.gl.TRIANGLES,F,t.ag.disabled,K,ae,X,l.id,U.vertexBuffer,U.indexBuffer,U.segments,l.paint,f.transform.zoom,void 0,q,_.instancedDataArray.length);else{let se=A?"u_instance":"u_normal_matrix";for(let fe=0;fe<_.instancedDataArray.length;++fe)X[se]=new Float32Array(_.instancedDataArray.arrayBuffer,64*fe,16),Z.draw(f,I.gl.TRIANGLES,F,t.ag.disabled,K,ae,X,l.id,U.vertexBuffer,U.indexBuffer,U.segments,l.paint,f.transform.zoom,void 0,q)}}if(u.children)for(let U of u.children)ea(f,l,U,_,x,w,S)}let ds=[1,-1,1];function vr(f,l,u,_){if(!u.modelManager)return!0;let x=u.modelManager;if(!u.shadowRenderer)return!0;let w=u.shadowRenderer,S=l.aabb,I=!0,A=f.maxHeight;if(A===0){let F=0;for(let B in f.instancesPerModel){let U=x.getModel(B,_);U?F=Math.max(F,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):I=!1}A=f.maxScale*F*1.41+f.maxVerticalOffset,I&&(f.maxHeight=A)}S.max[2]=A,S.min[2]+=f.terrainElevationMin,S.max[2]+=f.terrainElevationMax,t._.transformMat4(S.min,S.min,l.tileMatrix),t._.transformMat4(S.max,S.max,l.tileMatrix);let P=S.intersects(w.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=P===2),P===0}function Gf(f,l){let u=f.uniformValues.u_cutoff_params[0],_=f.uniformValues.u_cutoff_params[1],x=f.uniformValues.u_cutoff_params[2],w=f.uniformValues.u_cutoff_params[3];return _===u||w===x?1:t.at(((l-u)/(_-u)-x)/(w-x),0,1)}function xa(f,l,u,_){if(l.pitch<20)return 1;let x=l.getWorldToCameraMatrix(),w=t.ad.multiply([],x,f),S=[...u.min,1],I=t.aA.transformMat4([],S,w),A=I,P=I;S[1]=u.max[1],I=t.aA.transformMat4([],S,w),A=I[1]<A[1]?I:A,P=I[1]>P[1]?I:P,S[0]=u.max[0],I=t.aA.transformMat4([],S,w),A=I[1]<A[1]?I:A,P=I[1]>P[1]?I:P,S[1]=u.min[1],I=t.aA.transformMat4([],S,w),A=I[1]<A[1]?I:A,P=I[1]>P[1]?I:P;let F=t.at(_[0],0,1),B=100*l.pixelsPerMeter*t.at(_[1],0,1),U=t.at(_[2],0,1),H=t._.lerp([],A,P,F),q=Math.tan(.5*l.fovX),Z=-H[2]*q;if(B===0)return H[1]<-Math.abs(Z)?U:1;let X=(-Math.abs(Z)-H[1])/B,K=(ae,se,fe)=>(1-fe)*ae+fe*se,re=t.at(K(1,U,X),U,1);return K(1,re,t.at((l.pitch-20)/20,0,1))}class Ah{}class Ph{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,u,_){{let B=this._storage.get(u.id);if(B)return B.lastUsedFrameIdx=l,B.buf}let x=_.gl,w=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),S=new ArrayBuffer(w),I=new Int16Array(S);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));let A=new t.cm;for(let B=0;B<w/2;B+=3){let U=I[B],H=I[B+1],q=I[B+2];A.emplaceBack(U,H),A.emplaceBack(H,q),A.emplaceBack(q,U)}let P=_.bindVertexArrayOES.current,F=new Ah;return F.buf=new t.I(_,A),F.lastUsedFrameIdx=l,this._storage.set(u.id,F),_.bindVertexArrayOES.set(P),F.buf}update(l){for(let[u,_]of this._storage)l-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(u))}destroy(){for(let[l,u]of this._storage)u.buf.destroy(),this._storage.delete(l)}}let Al=t.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class i1{constructor(l){let u=new t.cn,_=new t.bu;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1),_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),this.segments=t.b.simpleSegment(0,0,u.length,_.length),this.vx=l.createVertexBuffer(u,Al.members),this.idx=l.createIndexBuffer(_)}destroy(){this.vx.destroy(),this.idx.destroy()}}let wa={symbol:function(f,l,u,_,x){if(f.renderPass!=="translucent")return;let w=t.ag.disabled,S=f.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(P,F,B,U,H,q,Z){let X=F.transform,K=H==="map",re=q==="map";for(let ae of P){let se=U.getTile(ae),fe=se.getBucket(B);if(!fe||!fe.text||!fe.text.segments.get().length)continue;let me=t.aD(fe.textSizeData,X.zoom),ne=Vc(ae,fe.getProjection(),X),le=X.calculatePixelsToTileUnitsMatrix(se),ce=Cl(ne,se.tileID.canonical,re,K,X,fe.getProjection(),le),we=fe.hasIconTextFit()&&fe.hasIconData();if(me){let Oe=Math.pow(2,X.zoom-se.tileID.overscaledZ);q0(fe,K,re,Z,t.bO,X,ce,ae,Oe,me,we)}}}(_,f,u,l,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),x);let I=u.paint.get("icon-opacity").constantOr(1)!==0,A=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(I||A)?Nf(f,l,u,_,w,S):(I&&Nf(f,l,u,_,w,S,{onlyIcons:!0}),A&&Nf(f,l,u,_,w,S,{onlyText:!0}),function(P,F,B,U){if(!P.symbolParams.useOcclusionQueries)return;let H=P.context.gl,q=P.transform,Z=B.paint,X=Z.get("icon-occlusion-opacity").constantOr(0),K=Z.get("text-occlusion-opacity").constantOr(0);if(!B.hasInitialOcclusionOpacityProperties||X===1&&K===1)return;let re=q.projection.name==="globe";for(let ae of U){let se=F.getTile(ae),fe=se.getBucket(B);if(!fe||fe.projection.name==="mercator"&&re||fe.fullyClipped)continue;if(fe.projection.name==="globe"){t.w(`Occlusion not supported for globe mode. Layer: ${B.type}`);continue}let me=Vc(ae,fe.getProjection(),q),ne=t.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,P.symbolParams.depthOffset,1),le=t.ad.multiply([],ne,me),ce=P.symbolParams.visualizeOcclusions!=="none"?1:P.symbolParams.occlusionQueryFrameWindow;for(let we=0;we<fe.symbolInstances.length;we++){let Oe=fe.symbolInstances.get(we),ue=P.style.placement.opacities[Oe.crossTileID];if(ue&&ue.isHidden()||(P.frameCounter+we)%ce!=0)continue;let Re=Oe.tileAnchorX,ze=Oe.tileAnchorY,Ke=Oe.zOffset,Je;if(P.symbolParams.visualizeOcclusions==="none"){let mt=fe.queries.get(we);if(mt){if(!mt.isFree()){if(!mt.isResultAvailable())continue;let _t=mt.consumeResult();Oe.occlusionState=_t===0?0:1;continue}Je=mt}else Je=new wc(P.context),fe.queries.set(we,Je)}let Xe=P.getOrCreateProgram("occlusion"),De=P.symbolParams.occluderSize,Ne=G0(le,[Re,ze,Ke],[q.width,q.height],[De,De],P.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);P.terrain&&P.terrain.setupElevationDraw(se,Xe,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),P.symbolParams.visualizeOcclusions==="none"&&Je&&Je.begin();let Ze=new t.ae(P.symbolParams.visualizeOcclusions==="zPass"?P.context.gl.ALWAYS:P.context.gl.LEQUAL,t.ae.ReadOnly,P.depthRangeFor3D);Xe.draw(P,H.TRIANGLES,Ze,t.ag.disabled,P.symbolParams.visualizeOcclusions!=="none"?t.a.alphaBlendedNonPremultiplied:t.a.disabled,t.af.disabled,Ne,"occlusion",P.occlusionBuffers.vx,P.occlusionBuffers.idx,P.occlusionBuffers.segments),P.symbolParams.visualizeOcclusions==="none"&&Je&&Je.end()}}}(f,l,u,_)),l.map.showCollisionBoxes&&(Th(f,l,u,_,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Th(f,l,u,_,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(f,l,u,_){if(f.renderPass!=="translucent")return;let x=u.paint.get("circle-opacity"),w=u.paint.get("circle-stroke-width"),S=u.paint.get("circle-stroke-opacity"),I=u.layout.get("circle-sort-key").constantOr(1)!==void 0,A=u.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(w.constantOr(1)===0||S.constantOr(1)===0))return;let P=f.context,F=P.gl,B=f.transform,U=f.depthModeForSublayer(0,t.ae.ReadOnly),H=t.ag.disabled,q=f.colorModeForDrapableLayerRenderPass(A),Z=B.projection.name==="globe",X=[t.aj(B.center.lng),t.ak(B.center.lat)],K=[];for(let ae=0;ae<_.length;ae++){let se=_[ae],fe=l.getTile(se),me=fe.getBucket(u);if(!me||me.projection.name!==B.projection.name)continue;let ne=me.programConfigurations.get(u.id),le=t.bR(u),ce=f.isTileAffectedByFog(se);Z&&le.push("PROJECTION_GLOBE_VIEW");let we=f.getOrCreateProgram("circle",{config:ne,defines:le,overrideFog:ce}),Oe=me.layoutVertexBuffer,ue=me.globeExtVertexBuffer,Re=me.indexBuffer,ze=B.projection.createInversionMatrix(B,se.canonical),Ke={programConfiguration:ne,program:we,layoutVertexBuffer:Oe,globeExtVertexBuffer:ue,indexBuffer:Re,uniformValues:t.bS(f,se,fe,ze,X,u),tile:fe};if(I){let Je=me.segments.get();for(let Xe of Je)K.push({segments:new t.b([Xe]),sortKey:Xe.sortKey,state:Ke})}else K.push({segments:me.segments,sortKey:0,state:Ke})}I&&K.sort((ae,se)=>ae.sortKey-se.sortKey);let re={useDepthForOcclusion:B.depthOcclusionForSymbolsAndCircles};for(let ae of K){let{programConfiguration:se,program:fe,layoutVertexBuffer:me,globeExtVertexBuffer:ne,indexBuffer:le,uniformValues:ce,tile:we}=ae.state,Oe=ae.segments;f.terrain&&f.terrain.setupElevationDraw(we,fe,re),f.uploadCommonUniforms(P,fe,we.tileID.toUnwrapped()),fe.draw(f,F.TRIANGLES,U,H,q,t.af.disabled,ce,u.id,me,le,Oe,u.paint,B.zoom,se,[ne])}},heatmap:function(f,l,u,_){if(u.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){let x=f.context,w=x.gl,S=t.ag.disabled,I=new t.a([w.ONE,w.ONE,w.ONE,w.ONE],t.C.transparent,[!0,!0,!0,!0]);(function(H,q,Z,X){let K=H.gl,re=q.width*X,ae=q.height*X;H.activeTexture.set(K.TEXTURE1),H.viewport.set([0,0,re,ae]);let se=Z.heatmapFbo;if(!se||se&&(se.width!==re||se.height!==ae)){se&&se.destroy();let fe=K.createTexture();K.bindTexture(K.TEXTURE_2D,fe),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),se=Z.heatmapFbo=H.createFramebuffer(re,ae,!0,null),function(me,ne,le,ce,we,Oe){let ue=me.gl;ue.texImage2D(ue.TEXTURE_2D,0,me.extRenderToTextureHalfFloat?ue.RGBA16F:ue.RGBA,we,Oe,0,ue.RGBA,me.extRenderToTextureHalfFloat?ue.HALF_FLOAT:ue.UNSIGNED_BYTE,null),ce.colorAttachment.set(le)}(H,0,fe,se,re,ae)}else K.bindTexture(K.TEXTURE_2D,se.colorAttachment.get()),H.bindFramebuffer.set(se.framebuffer)})(x,f,u,f.transform.projection.name==="globe"?.5:.25),x.clear({color:t.C.transparent});let A=f.transform,P=A.projection.name==="globe",F=P?["PROJECTION_GLOBE_VIEW"]:[],B=P?t.af.frontCCW:t.af.disabled,U=[t.aj(A.center.lng),t.ak(A.center.lat)];for(let H=0;H<_.length;H++){let q=_[H];if(l.hasRenderableParent(q))continue;let Z=l.getTile(q),X=Z.getBucket(u);if(!X||X.projection.name!==A.projection.name)continue;let K=f.isTileAffectedByFog(q),re=X.programConfigurations.get(u.id),ae=f.getOrCreateProgram("heatmap",{config:re,defines:F,overrideFog:K}),{zoom:se}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Z,ae),f.uploadCommonUniforms(x,ae,q.toUnwrapped());let fe=A.projection.createInversionMatrix(A,q.canonical);ae.draw(f,w.TRIANGLES,t.ae.disabled,S,I,B,Il(f,q,Z,fe,U,se,u.paint.get("heatmap-intensity")),u.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,u.paint,f.transform.zoom,re,P?[X.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(x,w){let S=x.context,I=S.gl,A=w.heatmapFbo;if(!A)return;S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,A.colorAttachment.get()),S.activeTexture.set(I.TEXTURE1);let P=w.colorRampTexture;P||(P=w.colorRampTexture=new t.T(S,w.colorRamp,I.RGBA)),P.bind(I.LINEAR,I.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,I.TRIANGLES,t.ae.disabled,t.ag.disabled,x.colorModeForRenderPass(),t.af.disabled,((F,B,U,H)=>({u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(f,u))},line:function(f,l,u,_){if(f.renderPass!=="translucent")return;let x=u.paint.get("line-opacity"),w=u.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;let S=u.paint.get("line-emissive-strength"),I=u.paint.get("line-occlusion-opacity"),A=f.context,P=A.gl,F=u.layout.get("line-z-offset"),B=!F.isConstant()||!!F.constantOr(0),U=B?new t.ae(f.depthOcclusion?P.GREATER:P.LEQUAL,t.ae.ReadOnly,f.depthRangeFor3D):f.depthModeForSublayer(0,t.ae.ReadOnly),H=f.colorModeForDrapableLayerRenderPass(S),q=f.terrain&&f.terrain.renderingToTexture,Z=q?1:t.e.devicePixelRatio,X=u.paint.get("line-dasharray"),K=X.constantOr(1),re=u.layout.get("line-cap"),ae=X.constantOr(null),se=re.constantOr(null),fe=u.paint.get("line-pattern"),me=fe.constantOr(1),ne=fe.constantOr(null),le=u.paint.get("line-opacity").constantOr(1),ce=!me&&le!==1||f.depthOcclusion&&I>0&&I<1,we=u.paint.get("line-gradient"),Oe=me?"linePattern":"line",ue=t.bT(u),Re;if(q&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(ce=!1),I!==0&&f.depthOcclusion){let Ke=u.paint._values["line-opacity"];Ke&&Ke.value&&Ke.value.kind==="constant"?Re=Ke.value:t.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}if(B&&(f.forceTerrainMode=!0),!B&&I!==0&&f.terrain&&!q)return void t.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let ze=ce&&B?f.stencilModeFor3D():t.ag.disabled;for(let Ke of _){let Je=l.getTile(Ke);if(me&&!Je.patternsLoaded())continue;let Xe=Je.getBucket(u);if(!Xe)continue;f.prepareDrawTile();let De=Xe.programConfigurations.get(u.id),Ne=f.isTileAffectedByFog(Ke),Ze=f.getOrCreateProgram(Oe,{config:De,defines:B?[...ue,"ELEVATED"]:ue,overrideFog:Ne});if(ne&&Je.imageAtlas){let $e=Je.imageAtlas.patternPositions[ne.toString()];$e&&De.setConstantPatternPositions($e)}if(!me&&ae&&se&&Je.lineAtlas){let $e=Je.lineAtlas.getDash(ae,se);$e&&De.setConstantPatternPositions($e)}let[mt,_t]=u.paint.get("line-trim-offset");(se==="round"||se==="square")&&mt!==_t&&(mt===0&&(mt-=1),_t===1&&(_t+=1));let St=q?Ke.projMatrix:null,yt=me?t.bU(f,Je,u,St,Z,[mt,_t]):t.bV(f,Je,u,St,Xe.lineClipsArray.length,Z,[mt,_t]);if(we){let $e=Xe.gradients[u.id],Pt=$e.texture;if(u.gradientVersion!==$e.version){let hi=256;if(u.stepInterpolant){let ai=l.getSource().maxzoom,xi=Ke.canonical.z===ai?Math.ceil(1<<f.transform.maxZoom-Ke.canonical.z):1;hi=t.at(t.bW(Xe.maxLineLength/t.a3*1024*xi),256,A.maxTextureSize)}$e.gradient=t.bX({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:hi,image:$e.gradient||void 0,clips:Xe.lineClipsArray}),$e.texture?$e.texture.update($e.gradient):$e.texture=new t.T(A,$e.gradient,P.RGBA),$e.version=u.gradientVersion,Pt=$e.texture}A.activeTexture.set(P.TEXTURE1),Pt.bind(u.stepInterpolant?P.NEAREST:P.LINEAR,P.CLAMP_TO_EDGE)}K&&(A.activeTexture.set(P.TEXTURE0),Je.lineAtlasTexture&&Je.lineAtlasTexture.bind(P.LINEAR,P.REPEAT),De.updatePaintBuffers()),me&&(A.activeTexture.set(P.TEXTURE0),Je.imageAtlasTexture&&Je.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),De.updatePaintBuffers()),B&&f.terrain.setupElevationDraw(Je,Ze),f.uploadCommonUniforms(A,Ze,Ke.toUnwrapped());let it=$e=>{Re!=null&&(Re.value=le*I),Ze.draw(f,P.TRIANGLES,U,$e,H,t.af.disabled,yt,u.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,u.paint,f.transform.zoom,De,[Xe.layoutVertexBuffer2,Xe.patternVertexBuffer,Xe.zOffsetVertexBuffer]),Re!=null&&(Re.value=le)};if(ce&&!B){let $e=f.stencilModeForClipping(Ke).ref;$e===0&&q&&A.clear({stencil:0});let Pt={func:P.EQUAL,mask:255};yt.u_alpha_discard_threshold=.8,it(new t.ag(Pt,$e,255,P.KEEP,P.KEEP,P.INVERT)),yt.u_alpha_discard_threshold=0,it(new t.ag(Pt,$e,255,P.KEEP,P.KEEP,P.KEEP))}else ce&&B&&(yt.u_alpha_discard_threshold=.001),it(B?ze:f.stencilModeForClipping(Ke))}ce&&(f.resetStencilClippingMasks(),q&&A.clear({stencil:0})),I===0||f.depthOcclusion||q||f.layersWithOcclusionOpacity.push(f.currentLayer),B&&(f.forceTerrainMode=!1)},fill:function(f,l,u,_){let x=u.paint.get("fill-color"),w=u.paint.get("fill-opacity");if(w.constantOr(1)===0)return;let S=u.paint.get("fill-emissive-strength"),I=f.colorModeForDrapableLayerRenderPass(S),A=u.paint.get("fill-pattern"),P=f.opaquePassEnabledForLayer()&&!A.constantOr(1)&&x.constantOr(t.C.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===P){let F=f.depthModeForSublayer(1,f.renderPass==="opaque"?t.ae.ReadWrite:t.ae.ReadOnly);Vf(f,l,u,_,F,I,!1)}if(f.renderPass==="translucent"&&u.paint.get("fill-antialias")){let F=f.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,t.ae.ReadOnly);Vf(f,l,u,_,F,I,!0)}},"fill-extrusion":function(f,l,u,_){let x=u.paint.get("fill-extrusion-opacity"),w=f.context,S=w.gl,I=f.terrain,A=I&&I.renderingToTexture;if(x===0)return;let P=f.conflationActive&&f.style.isLayerClipped(u,l.getSource()),F=f.style.order.indexOf(u.fqid);if(P&&function(B,U,H,q,Z){for(let X of q){let K=U.getTile(X).getBucket(H);K&&(K.updateReplacement(X,B.replacementSource,Z),K.uploadCentroid(B.context))}}(f,l,u,_,F),I||P)for(let B of _){let U=l.getTile(B).getBucket(u);U&&hp(f.context,l,B,U,u,I,P)}if(f.renderPass==="shadow"&&f.shadowRenderer){let B=f.shadowRenderer;if(I&&x<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof t.Z)return;let U=B.getShadowPassDepthMode(),H=B.getShadowPassColorMode();Uc(f,l,u,_,U,t.ag.disabled,H,P)}else if(f.renderPass==="translucent"){let B=!u.paint.get("fill-extrusion-pattern").constantOr(1),U=u.paint.get("fill-extrusion-color").constantOr(t.C.white);if(!A&&U.a!==0){let H=new t.ae(f.context.gl.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D);x===1&&B?Uc(f,l,u,_,H,t.ag.disabled,t.a.unblended,P):(Uc(f,l,u,_,H,t.ag.disabled,t.a.disabled,P),Uc(f,l,u,_,H,f.stencilModeFor3D(),f.colorModeForRenderPass(),P),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&B&&(!I&&f.transform.projection.name!=="globe"||A)){let H=u.paint.get("fill-extrusion-opacity"),q=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=u.paint.get("fill-extrusion-flood-light-intensity"),K=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(u.lut).toArray01().slice(0,3),re=q>0&&Z>0,ae=X>0,se=(me,ne,le)=>(1-le)*me+le*ne,fe=me=>{let ne=f.depthModeForSublayer(1,t.ae.ReadOnly,S.LEQUAL,!0),le=u.paint.get(me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ce=se(.1,3,le),we=f._showOverdrawInspector;if(!we){let Oe=new t.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),ue=new t.a([S.ONE,S.ONE,S.ONE,S.ONE],t.C.transparent,[!1,!1,!1,!0],S.MIN);fo(f,l,u,_,ne,Oe,ue,t.af.disabled,me,"sdf",H,q,Z,X,K,ce,P,!1)}{let Oe=we?t.ag.disabled:new t.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),ue=we?f.colorModeForRenderPass():new t.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],t.C.transparent,[!0,!0,!0,!0]);fo(f,l,u,_,ne,Oe,ue,t.af.disabled,me,"color",H,q,Z,X,K,ce,P,!1)}};if(A){let me=(ne,le,ce)=>{let we=f.depthModeForSublayer(1,t.ae.ReadOnly,S.LEQUAL,!1),Oe=u.paint.get(ne?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ue=se(.1,3,Oe);{let Re=new t.a([S.ONE,S.ONE,S.ONE,S.ONE],t.C.transparent,[!1,!1,!1,!0]);fo(f,l,u,_,we,t.ag.disabled,Re,t.af.disabled,ne,"clear",H,q,Z,X,K,ue,P,le)}{let Re=new t.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),ze=new t.a([S.ONE,S.ONE,S.ONE,S.ONE],t.C.transparent,[!1,!1,!1,!0],S.MIN);fo(f,l,u,_,we,Re,ze,t.af.disabled,ne,"sdf",H,q,Z,X,K,ue,P,le)}{let Re=ne?S.ZERO:S.ONE_MINUS_DST_ALPHA,ze=new t.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Ke=new t.a([Re,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],t.C.transparent,[!0,!0,!0,!0]);fo(f,l,u,_,we,ze,Ke,t.af.disabled,ne,"color",H,q,Z,X,K,ue,P,le)}{let Re=new t.a([S.ONE,S.ONE,S.ONE,ne?S.ZERO:S.ONE],t.C.transparent,[!1,!1,!1,!0],ne?S.FUNC_ADD:S.MAX);fo(f,l,u,_,we,t.ag.disabled,Re,t.af.disabled,ne,"clear",H,q,Z,X,K,ue,P,le,ce)}};if(re||ae){let ne;if(f.prepareDrawTile(),I){let le=I.drapeBufferSize[0],ce=I.drapeBufferSize[1];ne=I.framebufferCopyTexture,ne&&(!ne||ne.size[0]===le&&ne.size[1]===ce)||(ne&&ne.destroy(),ne=I.framebufferCopyTexture=new t.T(w,new t.i({width:le,height:ce}),S.RGBA)),ne.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,le,ce,0)}re&&me(!0,!1,ne),ae&&me(!1,!0,ne)}}else re&&fe(!0),ae&&fe(!1)}}},hillshade:function(f,l,u,_){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;let x=f.context,w=f.terrain&&f.terrain.renderingToTexture,[S,I]=f.renderPass!=="translucent"||w?[{},_]:f.stencilConfigForOverlap(_);for(let A of I){let P=l.getTile(A);if(P.needsHillshadePrepare&&f.renderPass==="offscreen")Na(f,P,u);else if(f.renderPass==="translucent"){let F=f.depthModeForSublayer(0,t.ae.ReadOnly),B=u.paint.get("hillshade-emissive-strength"),U=f.colorModeForDrapableLayerRenderPass(B),H=w&&f.terrain?f.terrain.stencilModeForRTTOverlap(A):S[A.overscaledZ];Yx(f,A,P,u,F,H,U)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,l,u,_,x,w){if(f.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;let S=f.transform.projection.name==="globe",I=u.paint.get("raster-elevation")!==0,A=I&&S;if(f.renderElevatedRasterBackface&&!A)return;let P=f.context,F=P.gl,B=l.getSource(),U=function(me,ne,le,ce){let we=ne.paint.get("raster-color"),Oe=me.type==="raster-array",ue=[],Re=ne.paint.get("raster-resampling"),ze=ne.paint.get("raster-color-mix"),Ke=ne.paint.get("raster-color-range"),Je=[ze[0],ze[1],ze[2],0],Xe=ze[3],De=Re==="nearest"?ce.NEAREST:ce.LINEAR;if(Oe&&(ue.push("RASTER_ARRAY"),we||ue.push("RASTER_COLOR"),Re==="linear"&&ue.push("RASTER_ARRAY_LINEAR"),De=ce.NEAREST,!Ke&&me.rasterLayers)){let Ne=me.rasterLayers.find(({id:Ze})=>Ze===ne.sourceLayer);Ne&&Ne.fields&&Ne.fields.range&&(Ke=Ne.fields.range)}if(Ke=Ke||[0,1],we){ue.push("RASTER_COLOR"),le.activeTexture.set(ce.TEXTURE2),ne.updateColorRamp(Ke);let Ne=ne.colorRampTexture;Ne||(Ne=ne.colorRampTexture=new t.T(le,ne.colorRamp,ce.RGBA)),Ne.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}return{mix:Je,range:Ke,offset:Xe,defines:ue,resampling:De}}(B,u,P,F);if(B instanceof t.bm&&!_.length&&!S)return;let H=u.paint.get("raster-emissive-strength"),q=f.colorModeForDrapableLayerRenderPass(H),Z=f.terrain&&f.terrain.renderingToTexture,X=!f.options.moving,K=u.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(B instanceof t.bm&&!_.length&&(B.onNorthPole||B.onSouthPole)){let me=I?f.stencilModeFor3D():t.ag.disabled;return void Eh(!!B.onNorthPole,null,f,l,u,H,U,t.af.disabled,me)}if(!_.length)return;let[re,ae]=B instanceof t.bm||Z?[{},_]:f.stencilConfigForOverlap(_),se=ae[ae.length-1].overscaledZ;A&&U.defines.push("PROJECTION_GLOBE_VIEW"),I&&U.defines.push("RENDER_CUTOFF");let fe=(me,ne,le)=>{for(let ce of me){let we=ce.toUnwrapped(),Oe=l.getTile(ce);if(Z&&(!Oe||!Oe.hasData()))continue;P.activeTexture.set(F.TEXTURE0);let ue=e1(Oe,B,u,U);if(!ue||!ue.texture)continue;let{texture:Re,mix:ze,offset:Ke,tileSize:Je,buffer:Xe}=ue,De,Ne;Z?(De=t.ae.disabled,Ne=ce.projMatrix):I?(De=new t.ae(F.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D),Ne=S?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(we,X)):(De=f.depthModeForSublayer(ce.overscaledZ-se,u.paint.get("raster-opacity")===1?t.ae.ReadWrite:t.ae.ReadOnly,F.LESS),Ne=f.transform.calculateProjMatrix(we,X));let Ze=f.terrain&&Z?f.terrain.stencilModeForRTTOverlap(ce):re[ce.overscaledZ],mt=w?0:u.paint.get("raster-fade-duration");Oe.registerFadeDuration(mt);let _t=l.findLoadedParent(ce,0),St=tp(Oe,_t,l,f.transform,mt),yt,it;f.terrain&&f.terrain.prepareDrawTile(),P.activeTexture.set(F.TEXTURE0),Re.bind(K,F.CLAMP_TO_EDGE),P.activeTexture.set(F.TEXTURE1),_t?(_t.texture&&_t.texture.bind(K,F.CLAMP_TO_EDGE),yt=Math.pow(2,_t.tileID.overscaledZ-Oe.tileID.overscaledZ),it=[Oe.tileID.canonical.x*yt%1,Oe.tileID.canonical.y*yt%1]):Re.bind(K,F.CLAMP_TO_EDGE),Re.useMipmap&&P.extTextureFilterAnisotropic&&f.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);let $e=f.transform,Pt,hi=I?Wi($e):[0,0,0,0],ai,xi,zi,an,ti,Ki=0;if(A&&B instanceof t.bm&&B.coordinates.length>3)ai=Float32Array.from(t.bf(t.bg(new t.aO(0,0,0)))),xi=Float32Array.from($e.globeMatrix),zi=Float32Array.from(t.bb($e)),an=[t.aj($e.center.lng),t.ak($e.center.lat)],Pt=B.elevatedGlobePerspectiveTransform,ti=B.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){let si=t.bc(ce.canonical);Ki=t.bd(si.getCenter().lat),ai=Float32Array.from(t.bf(t.bg(ce.canonical))),xi=Float32Array.from($e.globeMatrix),zi=Float32Array.from(t.bb($e)),an=[t.aj($e.center.lng),t.ak($e.center.lat)],Pt=[0,0],ti=Float32Array.from(t.be(ce.canonical,si,Ki,$e.worldSize/$e._pixelsPerMercatorPixel))}else Pt=B instanceof t.bm?B.perspectiveTransform:[0,0],ai=new Float32Array(16),xi=new Float32Array(9),zi=new Float32Array(16),an=[0,0],ti=new Float32Array(9);let _n=wh(Ne,ai,xi,zi,ti,it||[0,0],t.a1(f.transform.zoom),an,hi,yt||1,St,u,Pt,I?u.paint.get("raster-elevation"):0,2,ze,Ke,U.range,Je,Xe,H),tn=f.isTileAffectedByFog(ce),Ti=f.getOrCreateProgram("raster",{defines:U.defines,overrideFog:tn});if(f.uploadCommonUniforms(P,Ti,we),B instanceof t.bm){let si=B.elevatedGlobeVertexBuffer,xn=B.elevatedGlobeIndexBuffer;if(Z||!S)B.boundsBuffer&&B.boundsSegments&&Ti.draw(f,F.TRIANGLES,De,t.ag.disabled,q,t.af.disabled,_n,u.id,B.boundsBuffer,f.quadTriangleIndexBuffer,B.boundsSegments);else if(si&&xn){let Mn=$e.zoom<=t.b1?B.elevatedGlobeSegments:B.getSegmentsForLongitude($e.center.lng);Mn&&Ti.draw(f,F.TRIANGLES,De,t.ag.disabled,q,ne,_n,u.id,si,xn,Mn)}}else if(A){De=new t.ae(F.LEQUAL,t.ae.ReadOnly,f.depthRangeFor3D);let si=f.globeSharedBuffers;if(si){let[xn,Mn,ln]=si.getGridBuffers(Ki,!1);Ti.draw(f,F.TRIANGLES,De,le||Ze,f.colorModeForRenderPass(),ne,_n,u.id,xn,Mn,ln)}}else{let{tileBoundsBuffer:si,tileBoundsIndexBuffer:xn,tileBoundsSegments:Mn}=f.getTileBoundsBuffers(Oe);Ti.draw(f,F.TRIANGLES,De,Ze,q,t.af.disabled,_n,u.id,si,xn,Mn)}}if(!(B instanceof t.bm)&&A)for(let ce of me){let we=ce.canonical.y===(1<<ce.canonical.z)-1;ce.canonical.y===0&&Eh(!0,ce,f,l,u,H,U,ne,le||t.ag.disabled),we&&Eh(!1,ce,f,l,u,H,U,ne===t.af.frontCW?t.af.backCW:t.af.frontCW,le||t.ag.disabled)}};A?fe(ae,f.renderElevatedRasterBackface?t.af.backCW:t.af.frontCW,f.stencilModeFor3D()):fe(ae,t.af.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,l,u,_,x,w){f.renderPass==="offscreen"&&function(S,I,A,P){if(!P.length)return;let F=S.context,B=F.gl,U=I.getSource();if(!(U instanceof Lc))return;let H=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count"))),q=A.particlePositionRGBAImage;if(!q||q.width!==H){let ae=function(se){let fe=se*se,me=new Uint8Array(4*fe),ne=function(ce){return ce|=0,ce=Math.imul(2747636419^ce,2654435769),ce=Math.imul(ce^ce>>>16,2654435769),((ce=Math.imul(ce^ce>>>16,2654435769))>>>0)/4294967296},le=1/1.3;for(let ce=0;ce<fe;ce++){let we=le*(ne(2*ce+0)+Bs),Oe=le*(ne(2*ce+1)+Bs),ue=255*we%1,Re=255*Oe%1,ze=ue,Ke=Oe-Re/255,Je=Re;me[4*ce+0]=255*(we-ue/255),me[4*ce+1]=255*ze,me[4*ce+2]=255*Ke,me[4*ce+3]=255*Je}return me}(H);q=A.particlePositionRGBAImage=new t.i({width:H,height:H},ae)}let Z=A.particleFramebuffer;Z?Z.width!==H&&(Z.destroy(),Z=A.particleFramebuffer=F.createFramebuffer(H,H,!0,null)):Z=A.particleFramebuffer=F.createFramebuffer(H,H,!0,null);let X=[];for(let ae of P){let se=I.getTile(ae);if(!(se instanceof t.c3))continue;let fe=Gt(se,U,A);if(!fe)continue;let me=[se.tileSize,se.tileSize],ne=A.tileFramebuffer;ne||(ne=A.tileFramebuffer=F.createFramebuffer(me[0],me[1],!0,null));let le=se.rasterParticleState;le||(le=se.rasterParticleState=new Xo(F,ae,me,q));let ce=le.update(A.lastInvalidatedAt);le.particleTextureDimension!==H&&le.updateParticleTexture(ae,q);let we=le.targetColorTexture;le.targetColorTexture=le.backgroundColorTexture,le.backgroundColorTexture=we;let Oe=le.particleTexture0;le.particleTexture0=le.particleTexture1,le.particleTexture1=Oe,X.push([ae,fe,le,ce])}if(X.length===0)return;let K=t.e.now(),re=A.previousDrawTimestamp?.001*(K-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=K,A.hasColorMap()){F.activeTexture.set(B.TEXTURE0+2);let ae=A.colorRampTexture;ae||(ae=A.colorRampTexture=new t.T(F,A.colorRamp,B.RGBA)),ae.bind(B.LINEAR,B.CLAMP_TO_EDGE)}F.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(ae,se,fe){let me=ae.context,ne=me.gl,le=se.tileFramebuffer;me.activeTexture.set(ne.TEXTURE0);let ce={u_texture:0,u_opacity:1.05*(Oe=se.paint.get("raster-particle-fade-opacity-factor"))/(Oe+.05)},we=ae.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Oe;for(let ue of fe){let[,,Re,ze]=ue;le.colorAttachment.set(Re.targetColorTexture.texture),me.viewport.set([0,0,le.width,le.height]),me.clear({color:t.C.transparent}),ze&&(Re.backgroundColorTexture.bind(ne.NEAREST,ne.CLAMP_TO_EDGE),we.draw(ae,ne.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.alphaBlended,t.af.disabled,ce,se.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments))}}(S,A,X),function(ae,se,fe,me){let ne=ae.context,le=ne.gl,ce=fe.tileFramebuffer,we=ae.transform.projection.name==="globe",Oe=fe.paint.get("raster-particle-max-speed");for(let ue of me){let[Re,ze,Ke]=ue;ne.activeTexture.set(le.TEXTURE0+0),ze.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE),ce.colorAttachment.set(Ke.targetColorTexture.texture);let Je=ae.getOrCreateProgram("rasterParticleDraw",{defines:ze.defines,overrideFog:!1});ne.activeTexture.set(le.TEXTURE0+1);let Xe=ze.scalarData?[]:[0,1,2,3].map(Ze=>t.bZ[Ze](Re));Xe.push(Re);let De=Re.canonical.x,Ne=Re.canonical.y;for(let Ze of Xe){let mt=se.getTile(we?Ze.wrapped():Ze);if(!mt)continue;let _t=mt.rasterParticleState;if(!_t)continue;let St=Ze.canonical.x+(1<<Ze.canonical.z)*(Ze.wrap-Re.wrap),yt=Ze.canonical.y;_t.particleTexture0.bind(le.NEAREST,le.CLAMP_TO_EDGE);let it=zf(1,_t.particleTexture0.size[0],[St-De,yt-Ne],0,ze.texture.size,2,Oe,ze.textureOffset,ze.scale,ze.offset);Je.draw(ae,le.POINTS,t.ae.disabled,t.ag.disabled,t.a.alphaBlended,t.af.disabled,it,fe.id,_t.particleIndexBuffer,void 0,_t.particleSegment)}}}(S,I,A,X),F.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(ae,se,fe,me){let ne=ae.context,le=ne.gl,ce=se.paint.get("raster-particle-max-speed"),we=me*se.paint.get("raster-particle-speed-factor")*.15,Oe=function(Re){return Math.pow(Re,6)}(.01+1*se.paint.get("raster-particle-reset-rate-factor")),ue=se.particleFramebuffer;ne.viewport.set([0,0,ue.width,ue.height]);for(let Re of fe){let[,ze,Ke]=Re;ne.activeTexture.set(le.TEXTURE0+0),ze.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE),ne.activeTexture.set(le.TEXTURE0+1);let Je=Ke.particleTexture0;Je.bind(le.NEAREST,le.CLAMP_TO_EDGE);let Xe=Xx(1,Je.size[0],0,ze.texture.size,ce,we,Oe,ze.textureOffset,ze.scale,ze.offset);ue.colorAttachment.set(Ke.particleTexture1.texture),ne.clear({color:t.C.transparent}),ae.getOrCreateProgram("rasterParticleUpdate",{defines:ze.defines}).draw(ae,le.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.disabled,Xe,se.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments)}}(S,A,X,re)}(f,l,u,_),f.renderPass==="translucent"&&(function(S,I,A,P,F){let B=S.context,U=B.gl,H=!S.options.moving,q=S.transform.projection.name==="globe";if(!P.length)return;let[Z,X]=S.stencilConfigForOverlap(P),K=[];q&&K.push("PROJECTION_GLOBE_VIEW");let re=S.stencilModeFor3D();for(let ae of X){let se=ae.toUnwrapped(),fe=I.getTile(ae);if(!fe.rasterParticleState)continue;let me=fe.rasterParticleState,ne=100;fe.registerFadeDuration(ne);let le=I.findLoadedParent(ae,0),ce=tp(fe,le,I,S.transform,ne),we,Oe;S.terrain&&S.terrain.prepareDrawTile(),B.activeTexture.set(U.TEXTURE0),me.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),B.activeTexture.set(U.TEXTURE1),le&&le.rasterParticleState?(le.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),we=Math.pow(2,le.tileID.overscaledZ-fe.tileID.overscaledZ),Oe=[fe.tileID.canonical.x*we%1,fe.tileID.canonical.y*we%1]):me.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let ue=q?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(se,H),Re=S.transform,ze=Z0(Re),Ke=t.bc(ae.canonical),Je=t.bd(Ke.getCenter().lat),Xe,De,Ne,Ze,mt;q?(Xe=Float32Array.from(t.bf(t.bg(ae.canonical))),De=Float32Array.from(Re.globeMatrix),Ne=Float32Array.from(t.bb(Re)),Ze=[t.aj(Re.center.lng),t.ak(Re.center.lat)],mt=Float32Array.from(t.be(ae.canonical,Ke,Je,Re.worldSize/Re._pixelsPerMercatorPixel))):(Xe=new Float32Array(16),De=new Float32Array(9),Ne=new Float32Array(16),Ze=[0,0],mt=new Float32Array(9));let _t=Lf(ue,Xe,De,Ne,mt,Oe||[0,0],t.a1(S.transform.zoom),Ze,ze,we||1,ce,250),St=S.isTileAffectedByFog(ae),yt=S.getOrCreateProgram("rasterParticle",{defines:K,overrideFog:St});if(S.uploadCommonUniforms(B,yt,se),q){let it=new t.ae(U.LEQUAL,t.ae.ReadWrite,S.depthRangeFor3D),$e=0,Pt=S.globeSharedBuffers;if(Pt){let[hi,ai,xi]=Pt.getGridBuffers(Je,$e!==0);yt.draw(S,U.TRIANGLES,it,re,t.a.alphaBlended,t.af.backCCW,_t,A.id,hi,ai,xi)}}else{let it=S.depthModeForSublayer(0,t.ae.ReadOnly),$e=Z[ae.overscaledZ],{tileBoundsBuffer:Pt,tileBoundsIndexBuffer:hi,tileBoundsSegments:ai}=S.getTileBoundsBuffers(fe);yt.draw(S,U.TRIANGLES,it,$e,t.a.alphaBlended,t.af.disabled,_t,A.id,Pt,hi,ai)}}S.resetStencilClippingMasks()}(f,l,u,_),f.style.map.triggerRepaint())},background:function(f,l,u,_){let x=u.paint.get("background-color"),w=u.paint.get("background-opacity"),S=u.paint.get("background-emissive-strength");if(w===0)return;let I=f.context,A=I.gl,P=f.transform,F=P.tileSize,B=u.paint.get("background-pattern"),U;if(B!==void 0&&(B===null||(U=f.imageManager.getPattern(B.toString(),u.scope,f.style.getLut(u.scope)),!U)))return;let H=!B&&x.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==H)return;let q=t.ag.disabled,Z=f.depthModeForSublayer(0,H==="opaque"?t.ae.ReadWrite:t.ae.ReadOnly),X=f.colorModeForDrapableLayerRenderPass(S),K=B?"backgroundPattern":"background",re,ae=_;ae||(re=f.getBackgroundTiles(),ae=Object.values(re).map(se=>se.tileID)),B&&(I.activeTexture.set(A.TEXTURE0),f.imageManager.bind(f.context,u.scope));for(let se of ae){let fe=f.isTileAffectedByFog(se),me=f.getOrCreateProgram(K,{overrideFog:fe}),ne=se.toUnwrapped(),le=_?se.projMatrix:f.transform.calculateProjMatrix(ne);f.prepareDrawTile();let ce=l?l.getTile(se):re?re[se.key]:new t.by(se,F,P.zoom,f),we=B?H0(le,S,w,f,0,u.scope,U,{tileID:se,tileSize:F}):Sh(le,S,w,x.toRenderColor(u.lut));f.uploadCommonUniforms(I,me,ne);let{tileBoundsBuffer:Oe,tileBoundsIndexBuffer:ue,tileBoundsSegments:Re}=f.getTileBoundsBuffers(ce);me.draw(f,A.TRIANGLES,Z,q,X,t.af.disabled,we,u.id,Oe,ue,Re)}},sky:function(f,l,u){let _=f._atmosphere?t.a1(f.transform.zoom):1,x=u.paint.get("sky-opacity")*_;if(x===0)return;let w=f.context,S=u.paint.get("sky-type"),I=new t.ae(w.gl.LEQUAL,t.ae.ReadOnly,[0,1]),A=f.frameCounter/1e3%1;S==="atmosphere"?f.renderPass==="offscreen"?u.needsSkyboxCapture(f)&&(function(P,F,B,U){let H=P.context,q=H.gl,Z=F.skyboxFbo;if(!Z){Z=F.skyboxFbo=H.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new Gc(H),F.skyboxTexture=H.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,F.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let ae=0;ae<6;++ae)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(Z.framebuffer),H.viewport.set([0,0,32,32]);let X=F.getCenter(P,!0),K=P.getOrCreateProgram("skyboxCapture"),re=new Float64Array(16);t.ad.identity(re),t.ad.rotateY(re,re,.5*-Math.PI),Ha(P,F,K,re,X,0),t.ad.identity(re),t.ad.rotateY(re,re,.5*Math.PI),Ha(P,F,K,re,X,1),t.ad.identity(re),t.ad.rotateX(re,re,.5*-Math.PI),Ha(P,F,K,re,X,2),t.ad.identity(re),t.ad.rotateX(re,re,.5*Math.PI),Ha(P,F,K,re,X,3),t.ad.identity(re),Ha(P,F,K,re,X,4),t.ad.identity(re),t.ad.rotateY(re,re,Math.PI),Ha(P,F,K,re,X,5),H.viewport.set([0,0,P.width,P.height])}(f,u),u.markSkyboxValid(f)):f.renderPass==="sky"&&function(P,F,B,U,H){let q=P.context,Z=q.gl,X=P.transform,K=P.getOrCreateProgram("skybox");q.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,F.skyboxTexture);let re=((ae,se,fe,me,ne)=>({u_matrix:ae,u_sun_direction:se,u_cubemap:0,u_opacity:me,u_temporal_offset:ne}))(X.skyboxMatrix,F.getCenter(P,!1),0,U,H);P.uploadCommonUniforms(q,K),K.draw(P,Z.TRIANGLES,B,t.ag.disabled,P.colorModeForRenderPass(),t.af.backCW,re,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(f,u,I,x,A):S==="gradient"&&f.renderPass==="sky"&&function(P,F,B,U,H){let q=P.context,Z=q.gl,X=P.transform,K=P.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Gc(q)),q.activeTexture.set(Z.TEXTURE0);let re=F.colorRampTexture;re||(re=F.colorRampTexture=new t.T(q,F.colorRamp,Z.RGBA)),re.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let ae=((se,fe,me,ne,le)=>({u_matrix:se,u_color_ramp:0,u_center_direction:fe,u_radius:t.ab(me),u_opacity:ne,u_temporal_offset:le}))(X.skyboxMatrix,F.getCenter(P,!1),F.paint.get("sky-gradient-radius"),U,H);P.uploadCommonUniforms(q,K),K.draw(P,Z.TRIANGLES,B,t.ag.disabled,P.colorModeForRenderPass(),t.af.backCW,ae,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(f,u,I,x,A)},debug:function(f,l,u,_,x,w){for(let S=0;S<u.length;S++)if(x){let P=new t.C(_.r*.8,_.g*.8,_.b*.8,1);Dt(f,l,u[S],_,-1,-1,w),Dt(f,l,u[S],_,-1,1,w),Dt(f,l,u[S],_,1,1,w),Dt(f,l,u[S],_,1,-1,w),Dt(f,l,u[S],P,0,0,w)}else Dt(f,l,u[S],_,0,0,w)},custom:function(f,l,u,_){let x=f.context,w=u.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&u.isDraped(l)){if(f.renderPass==="offscreen"){let S=w.prerender;if(S){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){let I=f.transform.pointMerc;S.call(w,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),t.a1(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else S.call(w,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){let I=w.renderToTile;if(I){let A=_[0].canonical,P=new t.Y(A.x+_[0].wrap*(1<<A.z),A.y,A.z);x.setDepthMode(t.ae.disabled),x.setStencilMode(t.ag.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),I.call(w,x.gl,P),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(t.ag.disabled);let S=w.renderingMode==="3d"?new t.ae(f.context.gl.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,t.ae.ReadOnly);if(x.setDepthMode(S),f.transform.projection.name==="globe"){let I=f.transform.pointMerc;w.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),t.a1(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else w.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else t.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,l,u,_){if(f.renderPass==="opaque")return;let x=u.paint.get("model-opacity");if(x===0)return;let w=u.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!w||f.terrain&&x<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof t.Z))return;let S=f.shadowRenderer,I=u.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,I||(S.enabled=!1));let A=()=>{S&&(S.useNormalOffset=!0,I||(S.enabled=!0))},P=l.getSource();if(f.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(K,re,ae,se,fe){let me=K.transform;if(me.projection.name!=="mercator")return void t.w(`Drawing 3D models for ${me.projection.name} projection is not yet implemented`);let ne=me.getFreeCameraOptions().position;if(!K.modelManager)return;let le=K.modelManager;ae.modelManager=le;let ce=K.shadowRenderer;if(!ae._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let we=ae._unevaluatedLayout._values["model-id"],Oe=kt({},ae.layout.get("model-id").parameters),ue=K.style.order.indexOf(ae.fqid);for(let Re of se){let ze=re.getTile(Re).getBucket(ae);if(!ze||ze.projection.name!==me.projection.name)continue;let Ke=ze.getModelUris();Ke&&!ze.modelsRequested&&(le.addModelsFromBucket(Ke,fe),ze.modelsRequested=!0);let Je=dr(Re,me);Oe.zoom=Je;let Xe=we.possiblyEvaluate(Oe);if(X0(K,ze,Re),yo.shadowUniformsInitialized=!1,yo.useSingleShadowCascade=!!ce&&ce.getMaxCascadeForTile(Re.toUnwrapped())===0,K.renderPass==="shadow"&&ce){if(K.currentShadowCascade===1&&ze.isInsideFirstShadowMapFrustum)continue;let Ze=me.calculatePosMatrix(Re.toUnwrapped(),me.worldSize);if(yo.tileMatrix.set(Ze),yo.shadowTileMatrix=Float32Array.from(ce.calculateShadowPassMatrixFromMatrix(Ze)),yo.aabb.min.fill(0),yo.aabb.max[0]=yo.aabb.max[1]=t.a3,yo.aabb.max[2]=0,vr(ze,yo,K,ae.scope))continue}let De=1<<Re.canonical.z,Ne=[((ne.x-Re.wrap)*De-Re.canonical.x)*t.a3,(ne.y*De-Re.canonical.y)*t.a3,ne.z*De*t.a3];K.conflationActive&&Object.keys(ze.instancesPerModel).length>0&&K.style.isLayerClipped(ae,re.getSource())&&ze.updateReplacement(Re,K.replacementSource,ue)&&(ze.uploaded=!1,ze.upload(K.context));for(let Ze in ze.instancesPerModel){let mt=ze.instancesPerModel[Ze];mt.features.length>0&&(Ze=Xe.evaluate(mt.features[0].feature,{}));let _t=le.getModel(Ze,fe);if(_t&&_t.uploaded)for(let St of _t.nodes)ea(K,ae,St,mt,Ne,Re,yo)}}}(f,l,u,_,P.type==="vector"?u.scope:""),void A();if(!P.loaded())return;if(P.type==="batched-model")return function(K,re,ae,se){ae.resetLayerRenderingStats(K);let fe=K.context,me=K.transform,ne=K.style.fog,le=K.shadowRenderer;if(me.projection.name!=="mercator")return void t.w(`Drawing 3D landmark models for ${me.projection.name} projection is not yet implemented`);let ce=K.transform.getFreeCameraOptions().position,we=t._.scale([],[ce.x,ce.y,ce.z],K.transform.worldSize);t._.negate(we,we);let Oe=t.ad.identity([]),ue=t.cg(me.center.lat,me.zoom),Re=t.ad.fromScaling([],[1,1,1/ue]);t.ad.translate(Oe,Oe,we);let ze=ae.paint.get("model-opacity"),Ke=new t.ae(fe.gl.LEQUAL,t.ae.ReadWrite,K.depthRangeFor3D),Je=new t.ae(fe.gl.LEQUAL,t.ae.ReadOnly,K.depthRangeFor3D),Xe=new t.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),De=K.renderPass==="shadow",Ne=De&&le?le.getCurrentCascadeFrustum():me.getFrustum(me.scaleZoom(me.worldSize)),Ze=ae.paint.get("model-front-cutoff"),mt=Ze[2]<1,_t=ss(K,ae.paint.get("model-cutoff-fade-range")),St=ae.getLayerRenderingStats();(function(yt,it,$e,Pt){let hi=yt.terrain?yt.terrain.exaggeration():0,ai=yt.transform.zoom;for(let xi of Pt){let zi=it.getTile(xi).getBucket($e);zi&&(yt.conflationActive&&zi.updateReplacement(xi,yt.replacementSource),zi.evaluateScale(yt,$e),yt.terrain&&hi>0&&zi.elevationUpdate(yt.terrain,hi,xi,$e.source),zi.needsReEvaluation(yt,ai,$e)&&zi.evaluate($e))}})(K,re,ae,se),function(){let yt,it,$e;mt?(yt=se.length-1,it=-1,$e=-1):(yt=0,it=se.length,$e=1);for(let Pt=yt;Pt!==it;Pt+=$e){let hi=se[Pt],ai=re.getTile(hi).getBucket(ae);if(!ai||!ai.uploaded)continue;let xi=!1;le&&(xi=le.getMaxCascadeForTile(hi.toUnwrapped())===0);let zi=me.calculatePosMatrix(hi.toUnwrapped(),me.worldSize),an=ai.modelTraits,ti=[];for(let Ki of ai.getNodesInfo()){if(Ki.hiddenByReplacement||!Ki.node.meshes)continue;let _n=Ki.node,tn=0;K.terrain&&_n.elevation&&(tn=_n.elevation*K.terrain.exaggeration());let Ti=Ki.evaluatedScale;if(Ti[0]<=1&&Ti[1]<=1&&Ti[2]<=1&&(()=>{let Pe=Ki.aabb;return Xe.min=[...Pe.min],Xe.max=[...Pe.max],Xe.min[2]+=tn,Xe.max[2]+=tn,t._.transformMat4(Xe.min,Xe.min,zi),t._.transformMat4(Xe.max,Xe.max,zi),Xe})().intersects(Ne)===0)continue;let si=[...zi],xn=_n.anchor?_n.anchor[0]:0,Mn=_n.anchor?_n.anchor[1]:0;t.ad.translate(si,si,[xn*(Ti[0]-1),Mn*(Ti[1]-1),tn]),t._.exactEquals(Ti,t.cj)||t.ad.scale(si,si,Ti);let ln=t.ad.multiply([],si,_n.matrix),Qe=t.ad.multiply([],me.expandedFarZProjMatrix,ln),wt=t.ad.multiply([],me.expandedFarZProjMatrix,si),On=t.aA.transformMat4([],[xn,Mn,tn,1],Qe)[2];_n.hidden=!1;let Qi=ze;De||(mt&&(Qi*=xa(si,me,Ki.aabb,Ze)),Qi*=Gf(_t,On)),Qi!==0?ti.push({nodeInfo:Ki,depth:On,opacity:Qi,wvpForNode:Qe,wvpForTile:wt,nodeModelMatrix:ln,tileModelMatrix:si}):_n.hidden=!0}De||ti.sort((Ki,_n)=>!mt||Ki.opacity===1&&_n.opacity===1?Ki.depth<_n.depth?-1:1:Ki.opacity===1?-1:_n.opacity===1?1:Ki.depth>_n.depth?-1:1);for(let Ki of ti){let _n=Ki.nodeInfo,tn=_n.node,Ti=t.ad.multiply([],Re,Ki.tileModelMatrix);t.ad.multiply(Ti,Oe,Ti);let si=t.ad.invert([],Ti);t.ad.transpose(si,si),t.ad.scale(si,si,ds),Ti=t.ad.multiply(Ti,Ti,tn.matrix);let xn=K.renderPass==="light-beam",Mn=an&t.cl.HasMapboxMeshFeatures,ln=Mn?0:_n.evaluatedRMEA[0][2];for(let Qe=0;Qe<tn.meshes.length;++Qe){let wt=tn.meshes[Qe],On=Qe===tn.lightMeshIndex,Qi=Ki.wvpForNode;if(On){if(!xn&&!K.terrain&&K.shadowRenderer){K.currentLayer<K.firstLightBeamLayer&&(K.firstLightBeamLayer=K.currentLayer);continue}Qi=Ki.wvpForTile}else if(xn)continue;let Pe={defines:[]},Uo=[];if(kh(Pe.defines,Uo,wt,K,ae.lut),Mn||Pe.defines.push("DIFFUSE_SHADED"),xi&&Pe.defines.push("SHADOWS_SINGLE_CASCADE"),St&&(De?St.numRenderedVerticesInShadowPass+=wt.vertexArray.length:St.numRenderedVerticesInTransparentPass+=wt.vertexArray.length),De){_o(wt,Ki.nodeModelMatrix,K,ae);continue}let Lr=null;if(ne){let $s=$c(Ki.nodeModelMatrix,K.transform);if(Lr=new Float32Array($s),me.projection.name!=="globe"){let qs=wt.aabb.min,us=wt.aabb.max,[Ga,ps]=ne.getOpacityForBounds($s,qs[0],qs[1],us[0],us[1]);Pe.overrideFog=Ga>=Dn||ps>=Dn}}let io=wt.material,xr;io.occlusionTexture&&io.occlusionTexture.offsetScale&&(xr=io.occlusionTexture.offsetScale,Pe.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!De&&le&&(le.useNormalOffset=!!wt.normalBuffer);let bo=K.getOrCreateProgram("model",Pe);!De&&le&&le.setupShadowsFromMatrix(Ki.tileModelMatrix,bo,le.useNormalOffset),K.uploadCommonUniforms(fe,bo,null,Lr);let Ma=io.pbrMetallicRoughness;Ma.metallicFactor=.9,Ma.roughnessFactor=.5;let Ho=Mh(new Float32Array(Qi),new Float32Array(Ti),new Float32Array(si),new Float32Array(tn.matrix),K,Ki.opacity,Ma.baseColorFactor.toRenderColor(null),io.emissiveFactor,Ma.metallicFactor,Ma.roughnessFactor,io,ln,ae,[0,0,0],xr);!On&&(_n.hasTranslucentParts||Ki.opacity<1)&&bo.draw(K,fe.gl.TRIANGLES,Ke,t.ag.disabled,t.a.disabled,t.af.backCCW,Ho,ae.id,wt.vertexBuffer,wt.indexBuffer,wt.segments,ae.paint,K.transform.zoom,void 0,Uo),bo.draw(K,fe.gl.TRIANGLES,On?Je:Ke,t.ag.disabled,On||Ki.opacity<1||_n.hasTranslucentParts?t.a.alphaBlended:t.a.unblended,t.af.backCCW,Ho,ae.id,wt.vertexBuffer,wt.indexBuffer,wt.segments,ae.paint,K.transform.zoom,void 0,Uo)}}}}()}(f,l,u,_),void A();let F=P.getModels(),B=[],U=f.transform.getFreeCameraOptions().position,H=t._.scale([],[U.x,U.y,U.z],f.transform.worldSize);t._.negate(H,H);let q=[],Z=[],X=0;for(let K of F){let re=u.paint.get("model-rotation").constantOr(null),ae=u.paint.get("model-scale").constantOr(null),se=u.paint.get("model-translation").constantOr(null);K.computeModelMatrix(f,re,ae,se,!0,!0,!1);let fe=t.ad.identity([]),me=t.cg(K.position.lat,f.transform.zoom),ne=t.ad.fromScaling([],[1,1,1/me]);t.ad.translate(fe,fe,H),B.push({zScaleMatrix:ne,negCameraPosMatrix:fe});for(let le of K.nodes)Xr(f.transform,le,K.matrix,f.transform.expandedFarZProjMatrix,X,q,Z);X++}if(q.sort((K,re)=>re.depth-K.depth),f.renderPass!=="shadow"){if(x===1)for(let K of Z)kl(K,f,u,B[K.modelIndex],t.ag.disabled,f.colorModeForRenderPass());else{for(let K of Z)kl(K,f,u,B[K.modelIndex],t.ag.disabled,t.a.disabled);for(let K of Z)kl(K,f,u,B[K.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(let K of q)kl(K,f,u,B[K.modelIndex],t.ag.disabled,f.colorModeForRenderPass());A()}else{for(let K of Z)_o(K.mesh,K.nodeModelMatrix,f,u);for(let K of q)_o(K.mesh,K.nodeModelMatrix,f,u);A()}}},K0={model:function(f,l,u){let _=l.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,_.type==="vector"?f.scope:""));if(_.type==="batched-model")return;let x=_.getModels();for(let w of x)w.upload(u.context)},raster:function(f,l,u){let _=l.getSource();if(!(_ instanceof Lc&&_.loaded()))return;let x=f.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!x)return;let w=f.paint.get("raster-array-band")||_.getInitialBand(x);if(w==null)return;let S=l.getIds().map(I=>l.getTileByID(I));for(let I of S)I.updateNeeded(x,w)&&_.prepareTile(I,x,w)},"raster-particle":function(f,l,u){let _=l.getSource();if(!(_ instanceof Lc&&_.loaded()))return;let x=f.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!x)return;let w=f.paint.get("raster-particle-array-band")||_.getInitialBand(x);if(w==null)return;let S=l.getIds().map(I=>l.getTileByID(I));for(let I of S)I.updateNeeded(x,w)&&_.prepareTile(I,x,w)}};class Q0{constructor(l,u,_,x){this.context=new sh(l,u),this.occlusionBuffers=new i1(this.context),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=t.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let S of w)this._debugParams.enabledLayers[S]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let S of w)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],S);this.symbolParams=new Cc(x),this.setup(),this.numSublayers=t.bv.maxUnderzooming+t.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new t.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Qu(this),this._wireframeDebugCache=new Ph,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(l,u){let _=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new kf(this,l));let x=this._terrain;this.transform.elevation=_?x:null,x.update(l,this.transform,u),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(l){let u=l.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[_,x]=u.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);let w=_+.78*(x-_);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(l){l&&!this._terrain&&(this._terrain=new kf(this,this.style)),this._forceTerrainMode=l}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,u){if(this.width=l*t.e.devicePixelRatio,this.height=u*t.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){let l=this.context,u=new t.bt;u.emplaceBack(0,0),u.emplaceBack(t.a3,0),u.emplaceBack(0,t.a3),u.emplaceBack(t.a3,t.a3),this.tileExtentBuffer=l.createVertexBuffer(u,t.br.members),this.tileExtentSegments=t.b.simpleSegment(0,0,4,2);let _=new t.bt;_.emplaceBack(0,0),_.emplaceBack(t.a3,0),_.emplaceBack(0,t.a3),_.emplaceBack(t.a3,t.a3),this.debugBuffer=l.createVertexBuffer(_,t.br.members),this.debugSegments=t.b.simpleSegment(0,0,4,5);let x=new t.bt;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(x,t.br.members),this.viewportSegments=t.b.simpleSegment(0,0,4,2);let w=new t.cp;w.emplaceBack(0,0,0,0),w.emplaceBack(t.a3,0,t.a3,0),w.emplaceBack(0,t.a3,0,t.a3),w.emplaceBack(t.a3,t.a3,t.a3,t.a3),this.mercatorBoundsBuffer=l.createVertexBuffer(w,t.cq.members),this.mercatorBoundsSegments=t.b.simpleSegment(0,0,4,2);let S=new t.bu;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(S);let I=new t.cr;for(let P of[0,1,3,2,0])I.emplaceBack(P);this.debugIndexBuffer=l.createIndexBuffer(I),this.emptyTexture=new t.T(l,new t.i({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=t.ad.create();let A=this.context.gl;this.stencilClearMode=new t.ag({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,t.ae.disabled,this.stencilClearMode,t.a.disabled,t.af.disabled,ep(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,u,_){if(!u||this.currentStencilSource===u.id||!l.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(let A of _)if(this._tileClippingMaskIDs[A.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=u.id;let x=this.context,w=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(t.a.disabled),x.setDepthMode(t.ae.disabled);let S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let I of _){let A=u.getTile(I),P=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:B,tileBoundsSegments:U}=this.getTileBoundsBuffers(A);S.draw(this,w.TRIANGLES,t.ae.disabled,new t.ag({func:w.ALWAYS,mask:0},P,255,w.KEEP,w.KEEP,w.REPLACE),t.a.disabled,t.af.disabled,ep(I.projMatrix),"$clipping",F,B,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let l=this.nextStencilID++,u=this.context.gl;return new t.ag({func:u.NOTEQUAL,mask:255},l,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);let u=this.context.gl;return new t.ag({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(l){let u=this.context.gl,_=l.sort((S,I)=>I.overscaledZ-S.overscaledZ),x=_[_.length-1].overscaledZ,w=_[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();let S={};for(let I=0;I<w;I++)S[I+x]=new t.ag({func:u.GEQUAL,mask:255},I+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=w,[S,_]}return[{[x]:t.ag.disabled},_]}colorModeForRenderPass(){let l=this.context.gl;return this._showOverdrawInspector?new t.a([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new t.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?t.a.unblended:t.a.alphaBlended}colorModeForDrapableLayerRenderPass(l){let u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new t.a([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new t.C(0,0,0,l===void 0?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,u,_,x=!1){if(this.depthOcclusion)return new t.ae(this.context.gl.GREATER,t.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return t.ae.disabled;let w=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new t.ae(_||this.context.gl.LEQUAL,u,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((l,u)=>l+u/this._fpsHistory.length,0))}render(l,u){let _=t.e.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=l.map.repaint,this.style=l,this.options=u;let x=this.style._mergedLayers,w=this.style.order.filter(le=>{let ce=x[le];return!(ce.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ce.type]}),S=w.map(le=>x[le]),I=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(t.e.now()),this.imageManager.beginFrame();let A=0,P=!1;for(let le in I){let ce=I[le];ce.used&&(ce.prepare(this.context),ce.getSource().usedInConflation&&++A)}let F=!1;for(let le of S)le.isHidden(this.transform.zoom)||(le.type==="clip"&&(F=!0),this.prepareLayer(le));let B={},U={},H={},q={},Z={};for(let le in I){let ce=I[le];B[le]=ce.getVisibleCoordinates(),U[le]=B[le].slice().reverse(),H[le]=ce.getVisibleCoordinates(!0).reverse(),q[le]=ce.getShadowCasterCoordinates(),Z[le]=ce.sortCoordinatesByDistance(B[le])}let X=le=>{let ce=this.style.getLayerSourceCache(le);return ce&&ce.used?ce.getSource():null};if(A||F){let le=[],ce=[],we=0;for(let Oe of S)this.isSourceForClippingOrConflation(Oe,X(Oe))&&(le.push(Oe),ce.push(we)),we++;if(le&&(F||le.length>1)){let Oe=[];for(let ue=0;ue<le.length;ue++){let Re=le[ue],ze=ce[ue],Ke=this.style.getLayerSourceCache(Re);if(!Ke||!Ke.used||!Ke.getSource().usedInConflation&&Re.type!=="clip")continue;let Je=1/0,Xe=t.cu.None;if(Re.type==="clip"){Je=ze;for(let De of Re.layout.get("clip-layer-types"))Xe|=De==="model"?t.cu.Model:De==="symbol"?t.cu.Symbol:t.cu.FillExtrusion}Oe.push({layer:Re.fqid,cache:Ke,order:Je,clipMask:Xe})}this.replacementSource.setSources(Oe),P=!0}}P||this.replacementSource.clear(),this.conflationActive=P,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let le=0;le<S.length;le++){let ce=S[le],we=ce.cutoffRange();if(this.longestCutoffRange=Math.max(we,this.longestCutoffRange),we>0){let Oe=X(ce);Oe&&(this.minCutoffZoom=Math.max(Oe.minzoom,this.minCutoffZoom)),ce.minzoom&&(this.minCutoffZoom=Math.max(ce.minzoom,this.minCutoffZoom))}ce.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=le),this._lastOcclusionLayer=le)}let K=this.style&&this.style.fog;K?(this._fogVisible=K.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=K.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(H),this.opaquePassCutoff=0);let re=this._shadowRenderer;if(re){re.updateShadowParameters(this.transform,this.style.directionalLight);for(let le in I)for(let ce of B[le]){let we={min:0,max:0};this.terrain&&(we=this.terrain.getMinMaxForTile(ce)||we),re.addShadowReceiver(ce.toUnwrapped(),we.min,we.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new t.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Wf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!t.ct(this.context.gl))return;this.renderPass="offscreen";for(let le of S){let ce=l.getLayerSourceCache(le);if(!le.hasOffscreenPass()||le.isHidden(this.transform.zoom))continue;let we=ce?U[ce.id]:void 0;(le.type==="custom"||le.type==="raster"||le.type==="raster-particle"||le.isSky()||we&&we.length)&&this.renderLayer(this,ce,le,we)}this.depthRangeFor3D=[0,1-(S.length+2)*this.numSublayers*this.depthEpsilon];let ae=this.terrain;ae&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&ae.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,q)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let se=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),fe=(()=>{if(u.showOverdrawInspector)return t.C.black;let le=this.style.fog;if(le&&this.transform.projection.supportsFog){let ce=this.style.getLut(le.scope);if(!se){let we=le.properties.get("color").toRenderColor(ce).toArray01();return new t.C(...we)}if(se){let we=le.properties.get("space-color").toRenderColor(ce).toArray01();return new t.C(...we)}}return t.C.transparent})();if(this.context.clear({color:fe,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&se&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){let le=S[this.currentLayer],ce=l.getLayerSourceCache(le);if(le.isSky())continue;let we=ce?(le.is3D()?Z:U)[ce.id]:void 0;this._renderTileClippingMasks(le,ce,we),this.renderLayer(this,ce,le,we)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&se&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||t.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){let le=S[this.currentLayer],ce=l.getLayerSourceCache(le);le.isSky()&&this.renderLayer(this,ce,le,ce?U[ce.id]:void 0)}function me(le,ce){let we;return ce&&(we=(le.type==="symbol"?H:le.is3D()?Z:U)[ce.id]),we}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){let le=S[this.currentLayer];if(le.type==="raster"){let ce=l.getLayerSourceCache(le);this.renderLayer(this,ce,le,me(le,ce))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ne=0;for(re&&(ne=re.getShadowCastingLayerCount());this.currentLayer<w.length;){let le=S[this.currentLayer],ce=l.getLayerSourceCache(le);if(le.isSky())++this.currentLayer;else if(ae&&this.style.isLayerDraped(le)){if(le.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=ae.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(le.is3D()||this.terrain||this._renderTileClippingMasks(le,ce,ce?B[ce.id]:void 0),this.renderLayer(this,ce,le,me(le,ce)),!ae&&re&&ne>0&&le.hasShadowPass()&&--ne==0&&(re.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let we=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=we;this.currentLayer++){let Oe=S[this.currentLayer];if(!Oe.hasLightBeamPass())continue;let ue=l.getLayerSourceCache(Oe);this.renderLayer(this,ue,Oe,ue?U[ue.id]:void 0)}this.currentLayer=we,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let we=this.currentLayer;this.depthOcclusion=!0;for(let Oe of this.layersWithOcclusionOpacity){this.currentLayer=Oe;let ue=S[this.currentLayer],Re=l.getLayerSourceCache(ue),ze=Re?U[Re.id]:void 0;ue.is3D()||this.terrain||this._renderTileClippingMasks(ue,Re,Re?B[Re.id]:void 0),this.renderLayer(this,Re,ue,ze)}this.depthOcclusion=!1,this.currentLayer=we,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let le=null;S.forEach(ce=>{let we=l.getLayerSourceCache(ce);we&&!ce.isHidden(this.transform.zoom)&&we.getVisibleCoordinates().length&&(!le||le.getSource().maxzoom<we.getSource().maxzoom)&&(le=we)}),le&&this.options.showTileBoundaries&&wa.debug(this,le,le.getVisibleCoordinates(),t.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&wa.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new t.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(le){let ce=le.transform.padding;Gi(le,le.transform.height-(ce.top||0),3,pp),Gi(le,ce.bottom||0,3,Uf),$i(le,ce.left||0,3,Ua),$i(le,le.transform.width-(ce.right||0),3,Hf);let we=le.transform.centerPoint;(function(Oe,ue,Re,ze){go(Oe,ue-1,Re-10,2,20,ze),go(Oe,ue-10,Re-1,20,2,ze)})(le,we.x,le.transform.height-we.y,Hc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),P||(this.conflationActive=!1)}prepareLayer(l){this.gpuTimingStart(l);let{unsupportedLayers:u}=this.transform.projection,_=!u||!u.includes(l.type);if(K0[l.type]&&(_||this.terrain&&l.type==="custom")){let x=this.style.getLayerSourceCache(l);K0[l.type](l,x,this)}this.gpuTimingEnd()}renderLayer(l,u,_,x){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||_.type==="raster-particle"||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(_.type)&&(!l.terrain||_.type!=="custom")||_.type==="clip"||wa[_.type](l,u,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;let u=this.context.extTimerQuery,_=this.context.gl,x=this.gpuTimers[l.id];x||(x=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:_.createQuery()}),x.calls++,_.beginQuery(u.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let l=this.context.extTimerQuery,u=this.context.gl,_=u.createQuery();this.deferredRenderGpuTimeQueries.push(_),u.beginQuery(l.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){let l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){let u={};for(let _ in l){let x=l[_],w=this.context.extTimerQuery,S=w.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(x.query),u[_]=S}return u}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;let u=this.context.extTimerQuery,_=this.context.gl,x=0;for(let w of l)x+=u.getQueryParameter(w,_.QUERY_RESULT)/1e6,u.deleteQueryEXT(w);return x}translatePosMatrix(l,u,_,x,w){if(!_[0]&&!_[1])return l;let S=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(S){let P=Math.sin(S),F=Math.cos(S);_=[_[0]*F-_[1]*P,_[0]*P+_[1]*F]}let I=[w?_[0]:t.bB(u,_[0],this.transform.zoom),w?_[1]:t.bB(u,_[1],this.transform.zoom),0],A=new Float32Array(16);return t.ad.translate(A,l,I),A}saveTileTexture(l){let u=l.size[0],_=this._tileTextures[u];_?_.push(l):this._tileTextures[u]=[l]}getTileTexture(l){let u=this._tileTextures[l];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(l,u,_){let x=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,w=[];return this.style&&this.style.enable3dLights()&&(l==="globeRaster"||l==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||w.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?w.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):w.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||x||u!==void 0&&!u||w.push("FOG","FOG_DITHERING"),x&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(l,u){this.cache=this.cache||{};let _=u&&u.defines||[],x=u&&u.config,w=this.currentGlobalDefines(l,u&&u.overrideFog,u&&u.overrideRtt).concat(_),S=vh.cacheKey(R0[l],l,w,x);return this.cache[S]||(this.cache[S]=new vh(this.context,l,R0[l],x,Kx[l],w)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,u){if(this.style.enable3dLights()){let _=this.style.directionalLight,x=this.style.ambientLight;if(_&&x){let w=((S,I,A)=>{let P=S.properties.get("direction"),F=S.properties.get("color").toRenderColor(A.getLut(S.scope)).toArray01(),B=S.properties.get("intensity"),U=I.properties.get("color").toRenderColor(A.getLut(I.scope)).toArray01(),H=I.properties.get("intensity"),q=[P.x,P.y,P.z],Z=t.bA(U,H),X=t.bA(F,B);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:q,u_lighting_directional_color:X,u_ground_radiance:cs(q,X,Z)}})(_,x,this.style);u.setLightsUniformValues(l,w)}}}uploadCommonUniforms(l,u,_,x,w){if(this.uploadCommonLightUniforms(l,u),this.terrain&&this.terrain.renderingToTexture)return;let S=this.style.fog;if(S){let I=S.getOpacity(this.transform.pitch),A=((P,F,B,U,H,q,Z,X,K,re,ae,se)=>{let fe=P.transform,me=F.properties.get("color").toRenderColor(P.style.getLut(F.scope)).toArray01();me[3]=U;let ne=P.frameCounter/1e3%1,[le,ce]=F.properties.get("vertical-range");return{u_fog_matrix:B?fe.calculateFogTileMatrix(B):se||P.identityMat,u_fog_range:F.getFovAdjustedRange(fe._fov),u_fog_color:me,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(le,ce),ce],u_fog_temporal_offset:ne,u_frustum_tl:H,u_frustum_tr:q,u_frustum_br:Z,u_frustum_bl:X,u_globe_pos:K,u_globe_radius:re,u_viewport:ae,u_globe_transition:t.a1(fe.zoom),u_is_globe:+(fe.projection.name==="globe")}})(this,S,_,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.e.devicePixelRatio,this.transform.height*t.e.devicePixelRatio],x);u.setFogUniformValues(l,A)}w&&u.setCutoffUniformValues(l,w.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){let l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){let l=this.context.gl,u=l.createTexture();return l.bindTexture(l.TEXTURE_2D,u),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let l=this._backgroundTiles,u=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(let x of _)u[x.key]=l[x.key]||new t.by(x,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(l,u){return!(!l.is3D()||l.minzoom&&l.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||l.sourceLayer!=="building")&&l.type!=="clip"&&(!u||u.type!=="batched-model"))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[l.key];return u||(this._cachedTileFogOpacities[l.key]=u=this.style.fog.getOpacityForTile(l)),u[0]>=Dn||u[1]>=Dn}}class to{constructor(l,u,_,x){this.screenBounds=l,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(l,u){let _,x;if(l instanceof t.P||typeof l[0]=="number"){let w=t.P.convert(l);_=[w],x=u.isPointAboveHorizon(w)}else{let w=t.P.convert(l[0]),S=t.P.convert(l[1]);_=[w,S],x=t.cv(w,S).every(I=>u.isPointAboveHorizon(I))}return new to(_,u.getCameraPoint(),x,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return t.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){let u=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],x=t.cv(u,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(x[3]=this.cameraPoint)),t.cw(x,l)}bufferedCameraGeometryGlobe(l){let u=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],x=t.cv(u,_,l),w=this.cameraPoint.clone();switch(3*((w.y>u.y)+(w.y>_.y))+((w.x>u.x)+(w.x>_.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(l,u,_,x=0){let w=l.queryPadding/u._pixelsPerMercatorPixel+1,S=_?this._bufferedCameraMercator(w,u):this._bufferedScreenMercator(w,u),I=l.tileID.wrap+(S.unwrapped?x:0),A=S.polygon.map(X=>t.cx(l.tileTransform,X,I));if(!t.cy(A,0,0,t.a3,t.a3))return;I=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);let P=this.screenGeometryMercator.polygon.map(X=>t.cz(l.tileTransform,X,I)),F=P.map(X=>new t.P(X[0],X[1])),B=u.getFreeCameraOptions().position||new t.Y(0,0,0),U=t.cz(l.tileTransform,B,I),H=P.map(X=>{let K=t._.sub(X,X,U);return t._.normalize(K,K),new t.aT(U,K)}),q=t.bB(l,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:H,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(Z=t.cA(A),Z.min.x=t.at(Z.min.x,0,t.a3),Z.min.y=t.at(Z.min.y,0,t.a3),Z.max.x=t.at(Z.max.x,0,t.a3),Z.max.y=t.at(Z.max.y,0,t.a3),Z),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:q};var Z}_bufferedScreenMercator(l,u){let _=qf(l);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let x;return x=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),u):{polygon:this.bufferedScreenGeometry(l).map(w=>u.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(l,u){let _=qf(l);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let x;return x=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),u):{polygon:this.bufferedCameraGeometry(l).map(w=>u.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[_]=x,x}}_projectAndResample(l,u){let _=function(w,S){let I=t.ad.multiply([],S.pixelMatrix,S.globeMatrix),A=[0,-t.cD,0,1],P=[0,t.cD,0,1],F=[0,0,0,1];t.aA.transformMat4(A,A,I),t.aA.transformMat4(P,P,I),t.aA.transformMat4(F,F,I);let B=new t.P(A[0]/A[3],A[1]/A[3]),U=new t.P(P[0]/P[3],P[1]/P[3]),H=t.cB(w,B)&&A[3]<F[3],q=t.cB(w,U)&&P[3]<F[3];if(!H&&!q)return null;let Z=function(ne,le,ce){for(let we=1;we<ne.length;we++){let Oe=Ns(le.pointCoordinate3D(ne[we-1]).x),ue=Ns(le.pointCoordinate3D(ne[we]).x);if(ce<0){if(Oe<ue)return{idx:we,t:-Oe/(ue-1-Oe)}}else if(ue<Oe)return{idx:we,t:(1-Oe)/(ue+1-Oe)}}return null}(w,S,H?-1:1);if(!Z)return null;let{idx:X,t:K}=Z,re=X>1?$f(w.slice(0,X),S):[],ae=X<w.length?$f(w.slice(X),S):[];re=re.map(ne=>new t.P(Ns(ne.x),ne.y)),ae=ae.map(ne=>new t.P(Ns(ne.x),ne.y));let se=[...re];se.length===0&&se.push(ae[ae.length-1]);let fe=t.a2(se[se.length-1].y,(ae.length===0?re[0]:ae[0]).y,K),me;return me=H?[new t.P(0,fe),new t.P(0,0),new t.P(1,0),new t.P(1,fe)]:[new t.P(1,fe),new t.P(1,1),new t.P(0,1),new t.P(0,fe)],se.push(...me),ae.length===0?se.push(re[0]):se.push(...ae),{polygon:se.map(ne=>new t.Y(ne.x,ne.y)),unwrapped:!1}}(l,u);if(_)return _;let x=function(w,S){let I=!1,A=-1/0,P=0;for(let B=0;B<w.length-1;B++)w[B].x>A&&(A=w[B].x,P=B);for(let B=0;B<w.length-1;B++){let U=(P+B)%(w.length-1),H=w[U],q=w[U+1];Math.abs(H.x-q.x)>.5&&(H.x<q.x?(H.x+=1,U===0&&(w[w.length-1].x+=1)):(q.x+=1,U+1===w.length-1&&(w[0].x+=1)),I=!0)}let F=t.aj(S.center.lng);return I&&F<Math.abs(F-1)&&w.forEach(B=>{B.x-=1}),{polygon:w,unwrapped:I}}($f(l,u).map(w=>new t.P(Ns(w.x),w.y)),u);return{polygon:x.polygon.map(w=>new t.Y(w.x,w.y)),unwrapped:x.unwrapped}}}function $f(f,l){return t.cC(f,u=>{let _=l.pointCoordinate3D(u);u.x=_.x,u.y=_.y},1/256)}function Ns(f){return f<0?1+f%1:f%1}function qf(f){return 100*f|0}function n1(f,l){let u=t.ad.identity([]);return t.ad.scale(u,u,[.5*f.width,.5*-f.height,1]),t.ad.translate(u,u,[1,-1,0]),t.ad.multiply(u,u,f.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(u)}function r1(f,l,u,_,x,w,S,I=!1){let A=f.tilesIn(_,S,I);A.sort(qc);let P=[];for(let B of A)P.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(l,u,f._state,B,x,w,n1(f.transform,B.tile.tileID),I)});let F=function(B){let U={},H={};for(let q of B){let Z=q.queryResults,X=q.wrappedTileID,K=H[X]=H[X]||{};for(let re in Z){let ae=Z[re],se=K[re]=K[re]||{},fe=U[re]=U[re]||[];for(let me of ae)se[me.featureIndex]||(se[me.featureIndex]=!0,fe.push(me))}}return U}(P);for(let B in F)F[B].forEach(U=>{let H=U.feature,q=H.layer;q&&q.type!=="background"&&q.type!=="sky"&&q.type!=="slot"&&(H.source=q.source,q["source-layer"]&&(H.sourceLayer=q["source-layer"]),H.state=H.id!==void 0?f.getFeatureState(q["source-layer"],H.id):{})});return F}function Oh(f,l){let u=f.getRenderableIds().map(w=>f.getTileByID(w)),_=[],x={};for(let w=0;w<u.length;w++){let S=u[w],I=S.tileID.canonical.key;x[I]||(x[I]=!0,S.querySourceFeatures(_,l))}return _}function qc(f,l){let u=f.tileID,_=l.tileID;return u.overscaledZ-_.overscaledZ||u.canonical.y-_.canonical.y||u.wrap-_.wrap||u.canonical.x-_.canonical.x}class o1{constructor(l){this.style=l,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let l=!1,u=!1;for(let _ in this.style._mergedLayers){let x=this.style._mergedLayers[_];if(x.type==="fill-extrusion")this.layers.push({layer:x,visible:l,visibilityChanged:u});else if(x.type==="model"){let w=this.style.getLayerSource(x);w&&w.type==="batched-model"&&this.layers.push({layer:x,visible:l,visibilityChanged:u})}}}onNewFrame(l){this.layersGotHidden=!1;for(let u of this.layers){let _=u.layer,x=!1;_.type==="fill-extrusion"?x=!_.isHidden(l)&&_.paint.get("fill-extrusion-opacity")>0:_.type==="model"&&(x=!_.isHidden(l)&&_.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!x&&u.visible,u.visible=x}}updateZOffset(l,u){this.currentBuildingBuckets=[];for(let x of this.layers){let w=x.layer,S=this.style.getLayerSourceCache(w),I=1;w.type==="fill-extrusion"&&(I=x.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let A=S?S.getTile(u):null;if(!A&&S&&u.canonical.z>S.getSource().minzoom){let P=u.scaledTo(Math.min(S.getSource().maxzoom,u.overscaledZ-1));for(;P.overscaledZ>=S.getSource().minzoom&&(A=S.getTile(P),!A&&P.overscaledZ!==0);)P=P.scaledTo(P.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:A?A.getBucket(w):null,tileID:A?A.tileID:u,verticalScale:I})}l.hasAnyZOffset=!1;let _=!1;for(let x=0;x<l.symbolInstances.length;x++){let w=l.symbolInstances.get(x),S=w.zOffset,I=this._getHeightAtTileOffset(u,w.tileAnchorX,w.tileAnchorY);w.zOffset=I!==Number.NEGATIVE_INFINITY?I:S,_||S===w.zOffset||(_=!0),l.hasAnyZOffset||w.zOffset===0||(l.hasAnyZOffset=!0)}_&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,u,_,x){let w=u,S=_;if(l.canonical.z!==x.canonical.z){let I=x.canonical,A=1/(1<<l.canonical.z-I.z);w=(u+l.canonical.x*t.a3)*A-I.x*t.a3|0,S=(_+l.canonical.y*t.a3)*A-I.y*t.a3|0}return{tileX:w,tileY:S}}_getHeightAtTileOffset(l,u,_){let x,w;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;let{bucket:I,tileID:A,verticalScale:P}=this.currentBuildingBuckets[S];if(!I)continue;let{tileX:F,tileY:B}=this._mapCoordToOverlappingTile(l,u,_,A),U=I.getHeightAtTileCoord(F,B);U&&U.height!==void 0&&(U.hidden?x=U.height:w=Math.max(U.height*P,w||0))}if(w!==void 0)return w;for(let S=0;S<this.layers.length;++S){let I=this.layers[S];if(I.layer.type!=="model"||!I.visible)continue;let{bucket:A,tileID:P}=this.currentBuildingBuckets[S];if(!A)continue;let{tileX:F,tileY:B}=this._mapCoordToOverlappingTile(l,u,_,P),U=A.getHeightAtTileCoord(F,B);if(U&&!U.hidden)return U.height===void 0&&x!==void 0?Math.min(U.maxHeight,x)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Yc(f,l){let u={};for(let _ in f)_!=="ref"&&(u[_]=f[_]);return t.cE.forEach(_=>{_ in l&&(u[_]=l[_])}),u}function Yf(f){f=f.slice();let l=Object.create(null);for(let u=0;u<f.length;u++)l[f[u].id]=f[u];for(let u=0;u<f.length;u++)"ref"in f[u]&&(f[u]=Yc(f[u],l[f[u].ref]));return f}let ji={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function hs(f,l,u){u.push({command:ji.addSource,args:[f,l[f]]})}function J0(f,l,u){l.push({command:ji.removeSource,args:[f]}),u[f]=!0}function a1(f,l,u,_){J0(f,u,_),hs(f,l,u)}function s1(f,l,u){let _;for(_ in f[u])if(f[u].hasOwnProperty(_)&&_!=="data"&&!g(f[u][_],l[u][_]))return!1;for(_ in l[u])if(l[u].hasOwnProperty(_)&&_!=="data"&&!g(f[u][_],l[u][_]))return!1;return!0}function Rh(f,l,u,_,x,w){let S;for(S in l=l||{},f=f||{})f.hasOwnProperty(S)&&(g(f[S],l[S])||u.push({command:w,args:[_,S,l[S],x]}));for(S in l)l.hasOwnProperty(S)&&!f.hasOwnProperty(S)&&(g(f[S],l[S])||u.push({command:w,args:[_,S,l[S],x]}))}function mp(f){return f.id}function Zc(f,l){return f[l.id]=l,f}class ey{constructor(l,u){this.reset(l,u)}reset(l,u){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=t.at(l,0,1);let u=1,_=this._distances[u],x=l*this.paddedLength+this.padding;for(;_<x&&u<this._distances.length;)_=this._distances[++u];let w=u-1,S=this._distances[w],I=_-S,A=I>0?(x-S)/I:0;return this.points[w].mult(1-A).add(this.points[u].mult(A))}}class Zf{constructor(l,u,_){let x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(u/_);for(let S=0;S<this.xCellCount*this.yCellCount;S++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=u,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,u,_,x,w){this._forEachCell(u,_,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(u),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(l,u,_,x){this._forEachCell(u-x,_-x,u+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(u),this.circles.push(_),this.circles.push(x)}_insertBoxCell(l,u,_,x,w,S){this.boxCells[w].push(S)}_insertCircleCell(l,u,_,x,w,S){this.circleCells[w].push(S)}_query(l,u,_,x,w,S){if(_<0||l>this.width||x<0||u>this.height)return!w&&[];let I=[];if(l<=0&&u<=0&&this.width<=_&&this.height<=x){if(w)return!0;for(let A=0;A<this.boxKeys.length;A++)I.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){let P=this.circles[3*A],F=this.circles[3*A+1],B=this.circles[3*A+2];I.push({key:this.circleKeys[A],x1:P-B,y1:F-B,x2:P+B,y2:F+B})}return S?I.filter(S):I}return this._forEachCell(l,u,_,x,this._queryCell,I,{hitTest:w,seenUids:{box:{},circle:{}}},S),w?I.length>0:I}_queryCircle(l,u,_,x,w){let S=l-_,I=l+_,A=u-_,P=u+_;if(I<0||S>this.width||P<0||A>this.height)return!x&&[];let F=[];return this._forEachCell(S,A,I,P,this._queryCellCircle,F,{hitTest:x,circle:{x:l,y:u,radius:_},seenUids:{box:{},circle:{}}},w),x?F.length>0:F}query(l,u,_,x,w){return this._query(l,u,_,x,!1,w)}hitTest(l,u,_,x,w){return this._query(l,u,_,x,!0,w)}hitTestCircle(l,u,_,x){return this._queryCircle(l,u,_,!0,x)}_queryCell(l,u,_,x,w,S,I,A){let P=I.seenUids,F=this.boxCells[w];if(F!==null){let U=this.bboxes;for(let H of F)if(!P.box[H]){P.box[H]=!0;let q=4*H;if(l<=U[q+2]&&u<=U[q+3]&&_>=U[q+0]&&x>=U[q+1]&&(!A||A(this.boxKeys[H]))){if(I.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[H],x1:U[q],y1:U[q+1],x2:U[q+2],y2:U[q+3]})}}}let B=this.circleCells[w];if(B!==null){let U=this.circles;for(let H of B)if(!P.circle[H]){P.circle[H]=!0;let q=3*H;if(this._circleAndRectCollide(U[q],U[q+1],U[q+2],l,u,_,x)&&(!A||A(this.circleKeys[H]))){if(I.hitTest)return S.push(!0),!0;{let Z=U[q],X=U[q+1],K=U[q+2];S.push({key:this.circleKeys[H],x1:Z-K,y1:X-K,x2:Z+K,y2:X+K})}}}}}_queryCellCircle(l,u,_,x,w,S,I,A){let P=I.circle,F=I.seenUids,B=this.boxCells[w];if(B!==null){let H=this.bboxes;for(let q of B)if(!F.box[q]){F.box[q]=!0;let Z=4*q;if(this._circleAndRectCollide(P.x,P.y,P.radius,H[Z+0],H[Z+1],H[Z+2],H[Z+3])&&(!A||A(this.boxKeys[q])))return S.push(!0),!0}}let U=this.circleCells[w];if(U!==null){let H=this.circles;for(let q of U)if(!F.circle[q]){F.circle[q]=!0;let Z=3*q;if(this._circlesCollide(H[Z],H[Z+1],H[Z+2],P.x,P.y,P.radius)&&(!A||A(this.circleKeys[q])))return S.push(!0),!0}}}_forEachCell(l,u,_,x,w,S,I,A){let P=this._convertToXCellCoord(l),F=this._convertToYCellCoord(u),B=this._convertToXCellCoord(_),U=this._convertToYCellCoord(x);for(let H=P;H<=B;H++)for(let q=F;q<=U;q++)if(w.call(this,l,u,_,x,this.xCellCount*q+H,S,I,A))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,u,_,x,w,S){let I=x-l,A=w-u,P=_+S;return P*P>I*I+A*A}_circleAndRectCollide(l,u,_,x,w,S,I){let A=(S-x)/2,P=Math.abs(l-(x+A));if(P>A+_)return!1;let F=(I-w)/2,B=Math.abs(u-(w+F));if(B>F+_)return!1;if(P<=A||B<=F)return!0;let U=P-A,H=B-F;return U*U+H*H<=_*_}}let Ca=100;class ty{constructor(l,u,_=new Zf(l.width+200,l.height+200,25),x=new Zf(l.width+200,l.height+200,25)){this.transform=l,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Ca,this.screenBottomBoundary=l.height+Ca,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=u}placeCollisionBox(l,u,_,x,w,S,I,A){let P=_.projectedAnchorX,F=_.projectedAnchorY,B=_.projectedAnchorZ,U=_.elevation,H=_.tileID,q=l.getProjection();if(U&&H){let[me,ne,le]=q.upVector(H.canonical,_.tileAnchorX,_.tileAnchorY),ce=q.upVectorScale(H.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=me*U*ce,F+=ne*U*ce,B+=le*U*ce}let Z=this.projectAndGetPerspectiveRatio(I,P,F,B,_.tileID,q.name==="globe"||!!U||this.transform.pitch>0,q),X=S*Z.perspectiveRatio,K=(_.x1*u+x.x-_.padding)*X+Z.point.x,re=(_.y1*u+x.y-_.padding)*X+Z.point.y,ae=(_.x2*u+x.x+_.padding)*X+Z.point.x,se=(_.y2*u+x.y+_.padding)*X+Z.point.y,fe=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(K,re,ae,se)||!w&&this.grid.hitTest(K,re,ae,se,A)||fe?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[K,re,ae,se],offscreen:this.isOffscreen(K,re,ae,se),occluded:!1}}placeCollisionCircles(l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z){let X=[],K=this.transform.elevation,re=l.getProjection(),ae=K?K.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,re):null,se=new t.P(_.tileAnchorX,_.tileAnchorY),{x:fe,y:me,z:ne}=re.projectTilePoint(se.x,se.y,Z.canonical);if(ae){let[Xe,De,Ne]=ae(se);fe+=Xe,me+=De,ne+=Ne}let le=re.name==="globe",ce=this.projectAndGetPerspectiveRatio(I,fe,me,ne,Z,le||!!K||this.transform.pitch>0,re),{perspectiveRatio:we}=ce,Oe=(B?S/we:S*we)/t.bN,ue=Jo(fe,me,ne,A),Re=ce.signedDistanceFromCamera>0?Xu(Oe,w,_.lineOffsetX*Oe,_.lineOffsetY*Oe,!1,ue,se,_,x,A,{},K&&!B?ae:null,B&&!!K,re,Z,B):null,ze=!1,Ke=!1,Je=!0;if(Re&&!ce.occluded){let Xe=.5*H*we+q,De=new t.P(-100,-100),Ne=new t.P(this.screenRightBoundary,this.screenBottomBoundary),Ze=new ey,{first:mt,last:_t}=Re,St=mt.path.length,yt=[];for(let Pt=St-1;Pt>=1;Pt--)yt.push(mt.path[Pt]);for(let Pt=1;Pt<_t.path.length;Pt++)yt.push(_t.path[Pt]);let it=2.5*Xe;P&&(yt=yt.map(([Pt,hi,ai],xi)=>(ae&&!le&&(ai=ae(xi<St-1?mt.tilePath[St-1-xi]:_t.tilePath[xi-St+2])[2]),Jo(Pt,hi,ai,P))),yt.some(Pt=>Pt[3]<=0)&&(yt=[]));let $e=[];if(yt.length>0){let Pt=1/0,hi=-1/0,ai=1/0,xi=-1/0;for(let zi of yt)Pt=Math.min(Pt,zi[0]),ai=Math.min(ai,zi[1]),hi=Math.max(hi,zi[0]),xi=Math.max(xi,zi[1]);hi>=De.x&&Pt<=Ne.x&&xi>=De.y&&ai<=Ne.y&&($e=[yt.map(zi=>new t.P(zi[0],zi[1]))],(Pt<De.x||hi>Ne.x||ai<De.y||xi>Ne.y)&&($e=t.cF($e,De.x,De.y,Ne.x,Ne.y)))}for(let Pt of $e){Ze.reset(Pt,.25*Xe);let hi=0;hi=Ze.length<=.5*Xe?1:Math.ceil(Ze.paddedLength/it)+1;for(let ai=0;ai<hi;ai++){let xi=ai/Math.max(hi-1,1),zi=Ze.lerp(xi),an=zi.x+Ca,ti=zi.y+Ca;X.push(an,ti,Xe,0);let Ki=an-Xe,_n=ti-Xe,tn=an+Xe,Ti=ti+Xe;if(Je=Je&&this.isOffscreen(Ki,_n,tn,Ti),Ke=Ke||this.isInsideGrid(Ki,_n,tn,Ti),!u&&this.grid.hitTestCircle(an,ti,Xe,U)&&(ze=!0,!F))return{circles:[],offscreen:!1,collisionDetected:ze,occluded:!1}}}}return{circles:!F&&ze||!Ke?[]:X,offscreen:Je,collisionDetected:ze,occluded:ce.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let u=[],_=1/0,x=1/0,w=-1/0,S=-1/0;for(let F of l){let B=new t.P(F.x+Ca,F.y+Ca);_=Math.min(_,B.x),x=Math.min(x,B.y),w=Math.max(w,B.x),S=Math.max(S,B.y),u.push(B)}let I=this.grid.query(_,x,w,S).concat(this.ignoredGrid.query(_,x,w,S)),A={},P={};for(let F of I){let B=F.key;if(A[B.bucketInstanceId]===void 0&&(A[B.bucketInstanceId]={}),A[B.bucketInstanceId][B.featureIndex])continue;let U=[new t.P(F.x1,F.y1),new t.P(F.x2,F.y1),new t.P(F.x2,F.y2),new t.P(F.x1,F.y2)];t.cG(u,U)&&(A[B.bucketInstanceId][B.featureIndex]=!0,P[B.bucketInstanceId]===void 0&&(P[B.bucketInstanceId]=[]),P[B.bucketInstanceId].push(B.featureIndex))}return P}insertCollisionBox(l,u,_,x,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:w},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,u,_,x,w){let S=u?this.ignoredGrid:this.grid,I={bucketInstanceId:_,featureIndex:x,collisionGroupID:w};for(let A=0;A<l.length;A+=4)S.insertCircle(I,l[A],l[A+1],l[A+2])}projectAndGetPerspectiveRatio(l,u,_,x,w,S,I){let A=[u,_,x,1],P=!1;x||this.transform.pitch>0?(t.aA.transformMat4(A,A,l),this.fogState&&w&&I.name!=="globe"&&(P=function(U,H,q,Z,X,K){let re=K.calculateFogTileMatrix(X),ae=[H,q,Z];return t._.transformMat4(ae,ae,re),cr(U,t._.length(ae),K.pitch,K._fov)}(this.fogState,u,_,x,w.toUnwrapped(),this.transform)>.9)):Va(A,A,l);let F=A[3];return{point:new t.P((A[0]/F+1)/2*this.transform.width+Ca,(-A[1]/F+1)/2*this.transform.height+Ca),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/F*.5,1.5),signedDistanceFromCamera:F,occluded:S&&A[2]>F||P}}isOffscreen(l,u,_,x){return _<Ca||l>=this.screenRightBoundary||x<Ca||u>this.screenBottomBoundary}isInsideGrid(l,u,_,x){return _>=0&&l<this.gridRightBoundary&&x>=0&&u<this.gridBottomBoundary}getViewportMatrix(){let l=t.ad.identity([]);return t.ad.translate(l,l,[-100,-100,0]),l}}class Vs{constructor(l,u,_,x){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?u:-u))):x&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class js{constructor(l,u,_,x,w,S=!1){this.text=new Vs(l?l.text:null,u,_,w),this.icon=new Vs(l?l.icon:null,u,x,w),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fp{constructor(l,u,_,x=!1){this.text=l,this.icon=u,this.skipFade=_,this.clipped=x}}class iy{constructor(){this.invProjMatrix=t.ad.create(),this.viewportMatrix=t.ad.create(),this.circles=[]}}class Fh{constructor(l,u,_,x,w){this.bucketInstanceId=l,this.featureIndex=u,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=w}}class Lh{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){let u=++this.maxGroupID;this.collisionGroups[l]={ID:u,predicate:_=>_.collisionGroupID===u}}return this.collisionGroups[l]}}function Xf(f,l,u,_,x){let{horizontalAlign:w,verticalAlign:S}=t.bQ(f),I=-(w-.5)*l,A=-(S-.5)*u,P=t.bP(f,_);return new t.P(I+P[0]*x,A+P[1]*x)}function zh(f,l,u,_,x){let w=new t.P(f,l);return u&&w._rotate(_?x:-x),w}class ta{constructor(l,u,_,x,w,S){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new ty(this.transform,w),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Lh(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,u,_,x){let w=_.getBucket(u),S=_.latestFeatureIndex;if(!w||!S||u.fqid!==w.layerIds[0])return;let I=w.layers[0].layout,A=_.collisionBoxArray,P=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),F=_.tileSize/t.a3,B=_.tileID.toUnwrapped();this.transform.setProjection(w.projection);let U=(H=_.tileID,q=w.getProjection(),Z=this.transform,q.name===this.projection?Z.calculateProjMatrix(H.toUnwrapped()):cp(Z,q,H));var H,q,Z;let X=I.get("text-pitch-alignment")==="map",K=I.get("text-rotation-alignment")==="map";u.compileFilter();let re=u.dynamicFilter(),ae=u.dynamicFilterNeedsFeature(),se=this.transform.calculatePixelsToTileUnitsMatrix(_),fe=Sl(U,_.tileID.canonical,X,K,this.transform,w.getProjection(),se),me=null;if(X){let ce=Oc(U,_.tileID.canonical,X,K,this.transform,w.getProjection(),se);me=t.ad.multiply([],this.transform.labelPlaneMatrix,ce)}let ne=null;re&&_.latestFeatureIndex&&(ne={unwrappedTileID:B,dynamicFilter:re,dynamicFilterNeedsFeature:ae,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new Fh(w.bucketInstanceId,S,w.sourceLayerIndex,w.index,_.tileID);let le={bucket:w,layout:I,posMatrix:U,textLabelPlaneMatrix:fe,labelToScreenMatrix:me,clippingData:ne,scale:P,textPixelRatio:F,holdingForFade:_.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:t.aD(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.aD(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(x)for(let ce of w.sortKeyRanges){let{sortKey:we,symbolInstanceStart:Oe,symbolInstanceEnd:ue}=ce;l.push({sortKey:we,symbolInstanceStart:Oe,symbolInstanceEnd:ue,parameters:le})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:le})}attemptAnchorPlacement(l,u,_,x,w,S,I,A,P,F,B,U,H,q,Z,X,K,re){let{textOffset0:ae,textOffset1:se,crossTileID:fe}=U,me=[ae,se],ne=Xf(l,_,x,me,w),le=this.collisionIndex.placeCollisionBox(q,w,u,zh(ne.x,ne.y,S,I,this.transform.angle),B,A,P,F.predicate);if(X){let ce=q.getSymbolInstanceIconSize(re,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,ce,X,zh(ne.x,ne.y,S,I,this.transform.angle),B,A,P,F.predicate).box.length===0)return}if(le.box.length>0){let ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[fe]&&this.prevPlacement.placements[fe]&&this.prevPlacement.placements[fe].text&&(ce=this.prevPlacement.variableOffsets[fe].anchor),this.variableOffsets[fe]={textOffset:me,width:_,height:x,anchor:l,textScale:w,prevAnchor:ce},this.markUsedJustification(q,l,U,Z),q.allowVerticalPlacement&&(this.markUsedOrientation(q,Z,U),this.placedOrientations[fe]=Z),{shift:ne,placedGlyphBoxes:le}}}placeLayerBucketPart(l,u,_,x){let{bucket:w,layout:S,posMatrix:I,textLabelPlaneMatrix:A,labelToScreenMatrix:P,clippingData:F,textPixelRatio:B,holdingForFade:U,collisionBoxArray:H,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:Z,collisionGroup:X}=l.parameters,K=S.get("text-optional"),re=S.get("icon-optional"),ae=S.get("text-allow-overlap"),se=S.get("icon-allow-overlap"),fe=S.get("text-rotation-alignment")==="map",me=S.get("text-pitch-alignment")==="map",ne=S.get("symbol-z-order")==="viewport-y",le=S.get("symbol-z-elevate");this.transform.setProjection(w.projection);let ce=ae&&(se||!w.hasIconData()||re),we=se&&(ae||!w.hasTextData()||K);!w.collisionArrays&&H&&w.deserializeCollisionBoxes(H),_&&x&&w.updateCollisionDebugBuffers(this.transform.zoom,H);let Oe=(ue,Re,ze)=>{let{crossTileID:Ke,numVerticalGlyphVertices:Je}=ue;if(F){let tn={zoom:this.transform.zoom,pitch:this.transform.pitch},Ti=null;if(F.dynamicFilterNeedsFeature){let si=this.retainedQueryData[w.bucketInstanceId];Ti=F.featureIndex.loadFeature({featureIndex:ue.featureIndex,bucketIndex:si.bucketIndex,sourceLayerIndex:si.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,F.dynamicFilter)(tn,Ti,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new t.P(ue.tileAnchorX,ue.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[Ke]=new fp(!1,!1,!1,!0),void u.add(Ke)}if(u.has(Ke))return;if(U)return void(this.placements[Ke]=new fp(!1,!1,!1));let Xe=!1,De=!1,Ne=!0,Ze=!1,mt=!1,_t=null,St={box:null,offscreen:null,occluded:null},yt={box:null,offscreen:null,occluded:null},it=null,$e=null,Pt=null,hi=0,ai=0,xi=0;ze.textFeatureIndex?hi=ze.textFeatureIndex:ue.useRuntimeCollisionCircles&&(hi=ue.featureIndex),ze.verticalTextFeatureIndex&&(ai=ze.verticalTextFeatureIndex);let zi=tn=>{tn.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;let Ti=this.transform.elevation;tn.elevation=ue.zOffset+(Ti?Ti.getAtTileOffset(tn.tileID,tn.tileAnchorX,tn.tileAnchorY):0)},an=ze.textBox;if(an){zi(an);let tn=si=>{let xn=t.aE.horizontal;if(w.allowVerticalPlacement&&!si&&this.prevPlacement){let Mn=this.prevPlacement.placedOrientations[Ke];Mn&&(this.placedOrientations[Ke]=Mn,xn=Mn,this.markUsedOrientation(w,xn,ue))}return xn},Ti=(si,xn)=>{if(w.allowVerticalPlacement&&Je>0&&ze.verticalTextBox){for(let Mn of w.writingModes)if(Mn===t.aE.vertical?(St=xn(),yt=St):St=si(),St&&St.box&&St.box.length)break}else St=si()};if(S.get("text-variable-anchor")){let si=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ke]){let ln=this.prevPlacement.variableOffsets[Ke];si.indexOf(ln.anchor)>0&&(si=si.filter(Qe=>Qe!==ln.anchor),si.unshift(ln.anchor))}let xn=(ln,Qe,wt)=>{let On=w.getSymbolInstanceTextSize(q,ue,this.transform.zoom,Re),Qi=(ln.x2-ln.x1)*On+2*ln.padding,Pe=(ln.y2-ln.y1)*On+2*ln.padding,Uo=ue.hasIconTextFit&&!se?Qe:null;Uo&&zi(Uo);let Lr={box:[],offscreen:!1,occluded:!1},io=ae?2*si.length:si.length;for(let xr=0;xr<io;++xr){let bo=this.attemptAnchorPlacement(si[xr%si.length],ln,Qi,Pe,On,fe,me,B,I,X,xr>=si.length,ue,Re,w,wt,Uo,q,Z);if(bo&&(Lr=bo.placedGlyphBoxes,Lr&&Lr.box&&Lr.box.length)){Xe=!0,_t=bo.shift;break}}return Lr};Ti(()=>xn(an,ze.iconBox,t.aE.horizontal),()=>{let ln=ze.verticalTextBox;return ln&&zi(ln),w.allowVerticalPlacement&&!(St&&St.box&&St.box.length)&&Je>0&&ln?xn(ln,ze.verticalIconBox,t.aE.vertical):{box:null,offscreen:null,occluded:null}}),St&&(Xe=St.box,Ne=St.offscreen,Ze=St.occluded);let Mn=tn(!(!St||!St.box));if(!Xe&&this.prevPlacement){let ln=this.prevPlacement.variableOffsets[Ke];ln&&(this.variableOffsets[Ke]=ln,this.markUsedJustification(w,ln.anchor,ue,Mn))}}else{let si=(xn,Mn)=>{let ln=w.getSymbolInstanceTextSize(q,ue,this.transform.zoom,Re),Qe=this.collisionIndex.placeCollisionBox(w,ln,xn,new t.P(0,0),ae,B,I,X.predicate);return Qe&&Qe.box&&Qe.box.length&&(this.markUsedOrientation(w,Mn,ue),this.placedOrientations[Ke]=Mn),Qe};Ti(()=>si(an,t.aE.horizontal),()=>{let xn=ze.verticalTextBox;return w.allowVerticalPlacement&&Je>0&&xn?(zi(xn),si(xn,t.aE.vertical)):{box:null,offscreen:null,occluded:null}}),tn(!!(St&&St.box&&St.box.length))}}if(it=St,Xe=it&&it.box&&it.box.length>0,Ne=it&&it.offscreen,Ze=it&&it.occluded,ue.useRuntimeCollisionCircles){let tn=w.text.placedSymbolArray.get(ue.centerJustifiedTextSymbolIndex>=0?ue.centerJustifiedTextSymbolIndex:ue.verticalPlacedTextSymbolIndex),Ti=t.aF(w.textSizeData,q,tn),si=S.get("text-padding");$e=this.collisionIndex.placeCollisionCircles(w,ae,tn,w.lineVertexArray,w.glyphOffsetArray,Ti,I,A,P,_,me,X.predicate,ue.collisionCircleDiameter*Ti/t.bN,si,this.retainedQueryData[w.bucketInstanceId].tileID),Xe=ae||$e.circles.length>0&&!$e.collisionDetected,Ne=Ne&&$e.offscreen,Ze=$e.occluded}if(ze.iconFeatureIndex&&(xi=ze.iconFeatureIndex),ze.iconBox){let tn=Ti=>{zi(Ti);let si=ue.hasIconTextFit&&_t?zh(_t.x,_t.y,fe,me,this.transform.angle):new t.P(0,0),xn=w.getSymbolInstanceIconSize(Z,this.transform.zoom,ue.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,xn,Ti,si,se,B,I,X.predicate)};yt&&yt.box&&yt.box.length&&ze.verticalIconBox?(Pt=tn(ze.verticalIconBox),De=Pt.box.length>0):(Pt=tn(ze.iconBox),De=Pt.box.length>0),Ne=Ne&&Pt.offscreen,mt=Pt.occluded}let ti=K||ue.numHorizontalGlyphVertices===0&&Je===0,Ki=re||ue.numIconVertices===0;if(ti||Ki?Ki?ti||(De=De&&Xe):Xe=De&&Xe:De=Xe=De&&Xe,Xe&&it&&it.box&&this.collisionIndex.insertCollisionBox(it.box,S.get("text-ignore-placement"),w.bucketInstanceId,yt&&yt.box&&ai?ai:hi,X.ID),De&&Pt&&this.collisionIndex.insertCollisionBox(Pt.box,S.get("icon-ignore-placement"),w.bucketInstanceId,xi,X.ID),$e&&(Xe&&this.collisionIndex.insertCollisionCircles($e.circles,S.get("text-ignore-placement"),w.bucketInstanceId,hi,X.ID),_)){let tn=w.bucketInstanceId,Ti=this.collisionCircleArrays[tn];Ti===void 0&&(Ti=this.collisionCircleArrays[tn]=new iy);for(let si=0;si<$e.circles.length;si+=4)Ti.circles.push($e.circles[si+0]),Ti.circles.push($e.circles[si+1]),Ti.circles.push($e.circles[si+2]),Ti.circles.push($e.collisionDetected?1:0)}let _n=w.projection.name!=="globe";ce=ce&&(_n||!Ze),we=we&&(_n||!mt),this.placements[Ke]=new fp(Xe||ce,De||we,Ne||w.justReloaded),u.add(Ke)};if(le&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),ne){let ue=w.getSortedSymbolIndexes(this.transform.angle);for(let Re=ue.length-1;Re>=0;--Re){let ze=ue[Re];Oe(w.symbolInstances.get(ze),ze,w.collisionArrays[ze])}w.hasAnyZOffset&&t.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){let ue=w.getSortedIndexesByZOffset();for(let Re=0;Re<ue.length;++Re){let ze=ue[Re];Oe(w.symbolInstances.get(ze),ze,w.collisionArrays[ze])}}else for(let ue=l.symbolInstanceStart;ue<l.symbolInstanceEnd;ue++)Oe(w.symbolInstances.get(ue),ue,w.collisionArrays[ue]);if(_&&w.bucketInstanceId in this.collisionCircleArrays){let ue=this.collisionCircleArrays[w.bucketInstanceId];t.ad.invert(ue.invProjMatrix,I),ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(l,u,_,x){let{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:A,crossTileID:P}=_,F=t.cJ(u),B=x===t.aE.vertical?A:F==="left"?w:F==="center"?S:F==="right"?I:-1;w>=0&&(l.text.placedSymbolArray.get(w).crossTileID=B>=0&&w!==B?0:P),S>=0&&(l.text.placedSymbolArray.get(S).crossTileID=B>=0&&S!==B?0:P),I>=0&&(l.text.placedSymbolArray.get(I).crossTileID=B>=0&&I!==B?0:P),A>=0&&(l.text.placedSymbolArray.get(A).crossTileID=B>=0&&A!==B?0:P)}markUsedOrientation(l,u,_){let x=u===t.aE.horizontal||u===t.aE.horizontalOnly?u:0,w=u===t.aE.vertical?u:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:P}=_,F=l.text.placedSymbolArray;S>=0&&(F.get(S).placedOrientation=x),I>=0&&(F.get(I).placedOrientation=x),A>=0&&(F.get(A).placedOrientation=x),P>=0&&(F.get(P).placedOrientation=w)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;let u=this.prevPlacement,_=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;let x=u?u.symbolFadeChange(l):1,w=u?u.opacities:{},S=u?u.variableOffsets:{},I=u?u.placedOrientations:{};for(let A in this.placements){let P=this.placements[A],F=w[A];F?(this.opacities[A]=new js(F,x,P.text,P.icon,null,P.clipped),_=_||P.text!==F.text.placed||P.icon!==F.icon.placed):(this.opacities[A]=new js(null,x,P.text,P.icon,P.skipFade,P.clipped),_=_||P.text||P.icon)}for(let A in w){let P=w[A];if(!this.opacities[A]){let F=new js(P,x,!1,!1);F.isHidden()||(this.opacities[A]=F,_=_||P.text.placed||P.icon.placed)}}for(let A in S)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=S[A]);for(let A in I)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=I[A]);_?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:l)}updateLayerOpacities(l,u,_,x){let w=new Set;for(let S of u){let I=S.getBucket(l);I&&S.latestFeatureIndex&&l.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,w,S.collisionBoxArray,_,x,S.tileID),I.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(I,S.tileID),I.updateZOffset()))}}updateBucketOpacities(l,u,_,x,w,S){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();let I=l.layers[0].layout,A=!!l.layers[0].dynamicFilter(),P=new js(null,0,!1,!1,!0),F=I.get("text-allow-overlap"),B=I.get("icon-allow-overlap"),U=I.get("text-variable-anchor"),H=I.get("text-rotation-alignment")==="map",q=I.get("text-pitch-alignment")==="map",Z=new js(null,0,F&&(B||!l.hasIconData()||I.get("icon-optional")),B&&(F||!l.hasTextData()||I.get("text-optional")),!0);!l.collisionArrays&&_&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(_);let X=(re,ae,se)=>{for(let fe=0;fe<ae/4;fe++)re.opacityVertexArray.emplaceBack(se)},K=0;w&&l.updateReplacement(S,w);for(let re=0;re<l.symbolInstances.length;re++){let ae=l.symbolInstances.get(re),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:fe,crossTileID:me,numIconVertices:ne,tileAnchorX:le,tileAnchorY:ce}=ae,we=u.has(me),Oe=this.opacities[me];we?Oe=P:Oe||(Oe=Z,this.opacities[me]=Oe),u.add(me);let ue=se>0||fe>0,Re=ne>0,ze=this.placedOrientations[me],Ke=ze===t.aE.vertical,Je=ze===t.aE.horizontal||ze===t.aE.horizontalOnly;!ue&&!Re||Oe.isHidden()||K++;let Xe=!1;if((ue||Re)&&w)for(let De of l.activeReplacements){if(De.order<x||De.order===1/0||!(De.clipMask&t.cu.Symbol)||De.min.x>le||le>De.max.x||De.min.y>ce||ce>De.max.y)continue;let Ne=t.cH(le,ce,S.canonical,De.footprintTileId.canonical);if(Xe=t.cI(Ne,De),Xe)break}if(ue){let De=Xe?Us:Wa(Oe.text);X(l.text,se,Ke?Us:De),X(l.text,fe,Je?Us:De);let Ne=Oe.text.isHidden(),{leftJustifiedTextSymbolIndex:Ze,centerJustifiedTextSymbolIndex:mt,rightJustifiedTextSymbolIndex:_t,verticalPlacedTextSymbolIndex:St}=ae,yt=l.text.placedSymbolArray,it=Ne||Ke?1:0;Ze>=0&&(yt.get(Ze).hidden=it),mt>=0&&(yt.get(mt).hidden=it),_t>=0&&(yt.get(_t).hidden=it),St>=0&&(yt.get(St).hidden=Ne||Je?1:0);let $e=this.variableOffsets[me];$e&&this.markUsedJustification(l,$e.anchor,ae,ze);let Pt=this.placedOrientations[me];Pt&&(this.markUsedJustification(l,"left",ae,Pt),this.markUsedOrientation(l,Pt,ae))}if(Re){let De=Xe?Us:Wa(Oe.icon),{placedIconSymbolIndex:Ne,verticalPlacedIconSymbolIndex:Ze}=ae,mt=l.icon.placedSymbolArray,_t=Oe.icon.isHidden()?1:0;Ne>=0&&(X(l.icon,ne,Ke?Us:De),mt.get(Ne).hidden=_t),Ze>=0&&(X(l.icon,ae.numVerticalIconVertices,Je?Us:De),mt.get(Ze).hidden=_t)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){let De=l.collisionArrays[re];if(De){let Ne=new t.P(0,0),Ze=!0;if(De.textBox||De.verticalTextBox){if(U){let _t=this.variableOffsets[me];_t?(Ne=Xf(_t.anchor,_t.width,_t.height,_t.textOffset,_t.textScale),H&&Ne._rotate(q?this.transform.angle:-this.transform.angle)):Ze=!1}A&&(Ze=!Oe.clipped),De.textBox&&Bh(l.textCollisionBox.collisionVertexArray,Oe.text.placed,!Ze||Ke,Ne.x,Ne.y),De.verticalTextBox&&Bh(l.textCollisionBox.collisionVertexArray,Oe.text.placed,!Ze||Je,Ne.x,Ne.y)}let mt=Ze&&!!(!Je&&De.verticalIconBox);De.iconBox&&Bh(l.iconCollisionBox.collisionVertexArray,Oe.icon.placed,mt,ae.hasIconTextFit?Ne.x:0,ae.hasIconTextFit?Ne.y:0),De.verticalIconBox&&Bh(l.iconCollisionBox.collisionVertexArray,Oe.icon.placed,!mt,ae.hasIconTextFit?Ne.x:0,ae.hasIconTextFit?Ne.y:0)}}}if(l.fullyClipped=K===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){let re=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=re.invProjMatrix,l.placementViewportMatrix=re.viewportMatrix,l.collisionCircleArray=re.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,u){let _=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function Bh(f,l,u,_,x){f.emplaceBack(l?1:0,u?1:0,_||0,x||0),f.emplaceBack(l?1:0,u?1:0,_||0,x||0),f.emplaceBack(l?1:0,u?1:0,_||0,x||0),f.emplaceBack(l?1:0,u?1:0,_||0,x||0)}let Kf=Math.pow(2,25),pt=Math.pow(2,24),ny=Math.pow(2,17),Qf=Math.pow(2,16),Jf=Math.pow(2,9),ry=Math.pow(2,8),gp=Math.pow(2,1);function Wa(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let l=f.placed?1:0,u=Math.floor(127*f.opacity);return u*Kf+l*pt+u*ny+l*Qf+u*Jf+l*ry+u*gp+l}let Us=0;class Pl{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,u,_,x,w){let S=this._bucketParts;for(;this._currentTileIndex<l.length;)if(u.getBucketParts(S,x,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((I,A)=>I.sortKey-A.sortKey));this._currentPartIndex<S.length;){let I=S[this._currentPartIndex];if(u.placeLayerBucketPart(I,this._seenCrossTileIDs,_,I.symbolInstanceStart===0),this._currentPartIndex++,w())return!0}return!1}}class _p{constructor(l,u,_,x,w,S,I,A,P){this.placement=new ta(l,w,S,I,A,P),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(l,u,_,x){let w=t.e.now(),S=()=>{let I=t.e.now()-w;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){let I=u[l[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=A)&&(!I.maxzoom||I.maxzoom>A)){let P=I,F=P.layout.get("symbol-z-elevate"),B=this._inProgressLayer=this._inProgressLayer||new Pl(P),U=t.al(I.source,I.scope);if(B.continuePlacement(F?x[U]:_[U],this.placement,this._showCollisionBoxes,I,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}let Hs=512/t.a3/2;class l1{constructor(l,u,_){this.tileID=l,this.bucketInstanceId=_,this.index=new t.cK(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let x=l.canonical.x*t.a3,w=l.canonical.y*t.a3;for(let S=0;S<u.length;S++){let{key:I,crossTileID:A,tileAnchorX:P,tileAnchorY:F}=u.get(S),B=Math.floor((x+P)*Hs),U=Math.floor((w+F)*Hs);this.index.add(B,U),this.keys.push(I),this.crossTileIDs.push(A)}this.index.finish()}findMatches(l,u,_){let x=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),w=Hs/Math.pow(2,u.canonical.z-this.tileID.canonical.z),S=u.canonical.x*t.a3,I=u.canonical.y*t.a3;for(let A=0;A<l.length;A++){let P=l.get(A);if(P.crossTileID)continue;let{key:F,tileAnchorX:B,tileAnchorY:U}=P,H=Math.floor((S+B)*w),q=Math.floor((I+U)*w),Z=this.index.range(H-x,q-x,H+x,q+x);for(let X of Z){let K=this.crossTileIDs[X];if(this.keys[X]===F&&!_.has(K)){_.add(K),P.crossTileID=K;break}}}}}class c1{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class eg{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){let u=Math.round((l-this.lng)/360);if(u!==0)for(let _ in this.indexes){let x=this.indexes[_],w={};for(let S in x){let I=x[S];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+u),w[I.tileID.key]=I}this.indexes[_]=w}this.lng=l}addBucket(l,u,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let w=0;w<u.symbolInstances.length;w++)u.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);let x=this.usedCrossTileIDs[l.overscaledZ];for(let w in this.indexes){let S=this.indexes[w];if(Number(w)>l.overscaledZ)for(let I in S){let A=S[I];A.tileID.isChildOf(l)&&A.findMatches(u.symbolInstances,l,x)}else{let I=S[l.scaledTo(Number(w)).key];I&&I.findMatches(u.symbolInstances,l,x)}}for(let w=0;w<u.symbolInstances.length;w++){let S=u.symbolInstances.get(w);S.crossTileID||(S.crossTileID=_.generate(),x.add(S.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new l1(l,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(l,u){for(let _ of u.crossTileIDs)this.usedCrossTileIDs[l].delete(_)}removeStaleBuckets(l){let u=!1;for(let _ in this.indexes){let x=this.indexes[_];for(let w in x)l[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[w]),delete x[w],u=!0)}return u}}class d1{constructor(){this.layerIndexes={},this.crossTileIDs=new c1,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,u,_,x){let w=this.layerIndexes[l.fqid];w===void 0&&(w=this.layerIndexes[l.fqid]=new eg);let S=!1,I={};x.name!=="globe"&&w.handleWrapJump(_);for(let A of u){let P=A.getBucket(l);P&&l.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(A.tileID,P,this.crossTileIDs)&&(S=!0),I[P.bucketInstanceId]=!0)}return w.removeStaleBuckets(I)&&(S=!0),S}pruneUnusedLayers(l){let u={};l.forEach(_=>{u[_]=!0});for(let _ in this.layerIndexes)u[_]||delete this.layerIndexes[_]}}let oy=new t.N({data:new t.O(t.L.colorTheme.data)}),Ws=(f,l)=>li(f,l&&l.filter(u=>u.identifier!=="source.canvas")),tg=t.ah(ji,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),h1=t.ah(ji,["setCenter","setZoom","setBearing","setPitch"]),ay={version:8,layers:[],sources:{}},sy={duration:300,delay:0};class Sa extends t.E{constructor(l,u={}){super(),this.map=l,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=t.W({},sy),this._buildingIndex=new o1(this),this.crossTileSymbolIndex=new d1,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new Wt,this.dispatcher=u.dispatcher?u.dispatcher:new t.bw(t.bx(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new lh,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new t.cM(l._requestManager,u.localFontFamily?t.cN.all:u.localIdeographFontFamily?t.cN.ideographs:t.cN.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new Hu(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",t.cO());let _=this;this._rtlTextPluginCallback=Sa.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,S)=>{if(t.cP(w),S&&S.every(I=>I))for(let I in _._sourceCaches){let A=_._sourceCaches[I],P=A.getSource().type;P!=="vector"&&P!=="geojson"||A.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;let w=this.getOwnSource(x.sourceId);if(w&&w.vectorLayerIds)for(let S in this._layers){let I=this._layers[S];I.source===w.id&&this._validateLayer(I)}})}load(l){return l?(typeof l=="string"?this.loadURL(l):this.loadJSON(l),this):this}_getGlobalId(l){if(!l)return null;if(typeof l=="string"){if(t.cQ(l))return l;let u=t.cR(l);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${t.cS(JSON.stringify(l))}`}_diffStyle(l,u,_){this.globalId=this._getGlobalId(l);let x=(w,S)=>{try{S(null,this.setState(w,_))}catch(I){S(I,!1)}};if(typeof l=="string"){let w=this.map._requestManager.normalizeStyleURL(l),S=this.map._requestManager.transformRequest(w,t.R.Style);t.g(S,(I,A)=>{I?this.fire(new t.d(I)):A&&x(A,u)})}else typeof l=="object"&&x(l,u)}loadURL(l,u={}){this.fire(new t.f("dataloading",{dataType:"style"}));let _=typeof u.validate=="boolean"?u.validate:!t.cQ(l);this.globalId=this._getGlobalId(l),l=this.map._requestManager.normalizeStyleURL(l,u.accessToken),this.resolvedImports.add(l);let x=this.importsCache.get(l);if(x)return this._load(x,_);let w=this.map._requestManager.transformRequest(l,t.R.Style);this._request=t.g(w,(S,I)=>{if(this._request=null,S)this.fire(new t.d(S));else if(I)return this.importsCache.set(l,I),this._load(I,_)})}loadJSON(l,u={}){this.fire(new t.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(l),this._request=t.e.frame(()=>{this._request=null,this._load(l,u.validate!==!1)})}loadEmpty(){this.fire(new t.f("dataloading",{dataType:"style"})),this._load(ay,!1)}_loadImports(l,u,_){if(this.importDepth>=4)return t.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let x=[];for(let w of l){let S=this._createFragmentStyle(w),I=new Promise(F=>{S.once("style.import.load",F),S.once("error",F)}).then(()=>this.mergeAll());if(x.push(I),this.resolvedImports.has(w.url)){S.loadEmpty();continue}let A=w.data||this.importsCache.get(w.url);A?(S.loadJSON(A,{validate:u}),this._isInternalStyle(A)&&(S.globalId=null)):w.url?S.loadURL(w.url,{validate:u}):S.loadEmpty();let P={style:S,id:w.id,config:w.config};if(_){let F=this.fragments.findIndex(({id:B})=>B===_);this.fragments=this.fragments.slice(0,F).concat(P).concat(this.fragments.slice(F))}else this.fragments.push(P)}return Promise.allSettled(x)}getImportGlobalIds(l=this,u=new Set){for(let _ of l.fragments)_.style.globalId&&u.add(_.style.globalId),this.getImportGlobalIds(_.style,u);return[...u.values()]}_createFragmentStyle(l){let u=this.scope?t.al(l.id,this.scope):l.id,_,x=this._initialConfig&&this._initialConfig[u];(l.config||x)&&(_=t.W({},l.config,x));let w=new Sa(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(l){return this.isRootStyle()&&(l.fragment||!!l.schema&&l.fragment!==!1)}_load(l,u){let _=l.schema;if(this._isInternalStyle(l)){let S=t.W({},ay,{imports:[{id:"basemap",data:l,url:""}]});return void this._load(S,u)}if(this.updateConfig(this._config,_),u&&Ws(this,_e(l)))return;this._loaded=!0,this.stylesheet=t.cT(l);let x=()=>{for(let P in l.sources)this.addSource(P,l.sources[P],{validate:!1,isInitialLoad:!0});l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(l.glyphs,this.scope);let S=Yf(this.stylesheet.layers);if(this._order=S.map(P=>P.id),this.stylesheet.light&&t.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let P=this.stylesheet.lights[0];this.light=new Ot(P.properties,P.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ot(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let P of S){let F=t.cY(P,this.scope,this._styleColorTheme.lut,this.options);F.isConfigDependent&&this._configDependentLayers.add(F.fqid),F.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=F,this._serializedLayers[F.id]=F.serialize();let B=this.getOwnLayerSourceCache(F),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&F.canCastShadows()&&U&&(B.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new t.f("data",{dataType:"style"}));let A=this.isRootStyle();l.imports?this._loadImports(l.imports,u).then(()=>{this._reloadImports(),this.fire(new t.f(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new t.f(A?"style.load":"style.import.load")))},w=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=w,w){let S=this._evaluateColorThemeData(w);this._loadColorTheme(S).then(()=>{x()}).catch(I=>{t.w(`Couldn't load color theme from the stylesheet: ${I}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let l,u,_,x,w,S,I,A,P={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(F=>{if(F.stylesheet){if(F.light!=null&&(l=F.light),F.stylesheet.lights)for(let B of F.stylesheet.lights)B.type==="ambient"&&F.ambientLight!=null&&(u=F.ambientLight),B.type==="directional"&&F.directionalLight!=null&&(_=F.directionalLight);x=this._prioritizeTerrain(x,F.terrain,F.stylesheet.terrain),F.stylesheet.fog&&F.fog!=null&&(w=F.fog),F.stylesheet.camera!=null&&(A=F.stylesheet.camera),F.stylesheet.projection!=null&&(S=F.stylesheet.projection),F.stylesheet.transition!=null&&(I=F.stylesheet.transition),P[F.scope]=F._styleColorTheme}}),this.light=l,this.ambientLight=u,this.directionalLight=_,this.fog=w,this._styleColorThemeForScope=P,x===null?delete this.terrain:this.terrain=x,this.camera=A||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=t.W({},sy,I),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(l){let u=_=>{for(let x of _.fragments)u(x.style);l(_)};u(this)}_prioritizeTerrain(l,u,_){let x=l&&l.drapeRenderMode===0;return _===null?u&&u.drapeRenderMode===0?u:x?l:null:u!=null&&(!l||x||u&&u.drapeRenderMode===1)?u:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{l=this._prioritizeTerrain(l,u.terrain,u.stylesheet.terrain)}),l===null?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(l=u.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){let l={},u={},_={};this.forEachFragmentStyle(x=>{for(let w in x._sourceCaches){let S=t.al(w,x.scope);l[S]=x._sourceCaches[w]}for(let w in x._otherSourceCaches){let S=t.al(w,x.scope);u[S]=x._otherSourceCaches[w]}for(let w in x._symbolSourceCaches){let S=t.al(w,x.scope);_[S]=x._symbolSourceCaches[w]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=_}mergeLayers(){let l={},u=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(let I of S._order){let A=S._layers[I];if(A.type==="slot"){let P=t.cU(I);if(l[P])continue;l[P]=[]}A.slot&&l[A.slot]?l[A.slot].push(A):u.push(A)}}),this._mergedOrder=[],this._clipLayerIndices=[];let x=0,w=(S=[])=>{for(let I of S)if(I.type==="slot"){let A=t.cU(I.id);l[A]&&w(l[A]),this._mergedSlots.push(A)}else{let A=t.al(I.id,I.scope);this._mergedOrder.push(A),_[A]=I,I.is3D()&&(this._has3DLayers=!0),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&this._clipLayerIndices.push(x),x++}};w(u),this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=t.W({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(l){return l.data?function(u,_,x){let w=t.W({},_);for(let I of Object.keys(t.L.colorTheme))w[I]===void 0&&(w[I]=t.L.colorTheme[I].default);let S=new t.U(oy,u,new Map(x));return S.setTransitionOrValue(w,x),S.untransitioned().possiblyEvaluate(new t.X(0))}(this.scope,l,this.options).get("data"):null}_loadColorTheme(l){return this._styleColorTheme.lutLoading=!0,new Promise((u,_)=>{let x="data:image/png;base64,";if(l.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();l.startsWith(x)||(l=x+l);let w="mapbox-reserved-lut",S=new Image;S.src=l,S.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},S.onload=()=>{this._styleColorTheme.lutLoading=!1;let{width:I,height:A,data:P}=t.e.getImageData(S);if(A>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(I!==A*A)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(w)&&this.removeImage(w),this.addImage(w,{data:new t.i({width:I,height:A},P),pixelRatio:1,sdf:!1,version:0});let F=this.imageManager.getImage(w,this.scope);F?(this._styleColorTheme.lut={image:F.data,data:l},u()):_(new Error("Missing LUT image."))}})}getLut(l){let u=this._styleColorThemeForScope[l];return u?u.lut:null}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(u,_,x){let w,S,I,A=t.e.devicePixelRatio>1?"@2x":"",P=t.g(_.transformRequest(_.normalizeSpriteURL(u,A,".json"),t.R.SpriteJSON),(U,H)=>{P=null,I||(I=U,w=H,B())}),F=t.h(_.transformRequest(_.normalizeSpriteURL(u,A,".png"),t.R.SpriteImage),(U,H)=>{F=null,I||(I=U,S=H,B())});function B(){if(I)x(I);else if(w&&S){let U=t.e.getImageData(S),H={};for(let q in w){let{width:Z,height:X,x:K,y:re,sdf:ae,pixelRatio:se,stretchX:fe,stretchY:me,content:ne}=w[q],le=new t.i({width:Z,height:X});t.i.copy(U,le,{x:K,y:re},{x:0,y:0},{width:Z,height:X},null),H[q]={data:le,pixelRatio:se,sdf:ae,stretchX:fe,stretchY:me,content:ne}}x(null,H)}}return{cancel(){P&&(P.cancel(),P=null),F&&(F.cancel(),F=null)}}}(l,this.map._requestManager,(u,_)=>{if(this._spriteRequest=null,u)this.fire(new t.d(u));else if(_)for(let x in _)this.imageManager.addImage(x,this.scope,_[x]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.f("data",{dataType:"style"}))})}_validateLayer(l){let u=this.getOwnSource(l.source);if(!u)return;let _=l.sourceLayer;_&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(_)===-1)&&this.fire(new t.d(new Error(`Source layer "${_}" does not exist on source "${u.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,u)=>{let _=this.fragments[u];return _&&_.style&&(l.data=_.style.serialize()),l})}_serializeSources(){let l={};for(let u in this._sourceCaches){let _=this._sourceCaches[u].getSource();l[_.id]||(l[_.id]=_.serialize())}return l}_serializeLayers(l){let u=[];for(let _ of l){let x=this._layers[_];x&&x.type!=="custom"&&u.push(x.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(let l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&l.isDraped(this.getLayerSourceCache(l))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){let u=this.getOwnLayer(l);if(u)return u;this.fire(new t.d(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){let u=this.getOwnSource(l);if(u)return u;this.fire(new t.d(new Error(`The source '${l}' does not exist in the map's style.`)))}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);let u=this.calculateLightsBrightness();l.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u));let _=this._changes.isDirty(),x=!1;if(this._changes.isDirty()){let S=this._changes.getLayerUpdatesByScope();for(let I in S){let{updatedIds:A,removedIds:P}=S[I];(A||P)&&(this._updateWorkerLayers(I,A,P),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._changes.reset()}let w={};for(let S in this._mergedSourceCaches){let I=this._mergedSourceCaches[S];w[S]=I.used,I.used=!1,I.tileCoverLift=0}for(let S of this._mergedOrder){let I=this._mergedLayers[S];if(I.recalculate(l,this._availableImages),!I.isHidden(l.zoom)){let A=this.getLayerSourceCache(I);A&&(A.used=!0,A.tileCoverLift=Math.max(A.tileCoverLift,I.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let A=I.minzoom||0;A<(I.maxzoom||25.5);A++){let P=this.map.painter;if(P){let F=I.getProgramIds();if(!F)continue;for(let B of F){let U=I.getDefaultProgramParams(B,l.zoom,this._styleColorTheme.lut);U&&(P.style=this,this.fog&&(P._fogVisible=!0,U.overrideFog=!0,P.getOrCreateProgram(B,U)),P._fogVisible=!1,U.overrideFog=!1,P.getOrCreateProgram(B,U),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(U.overrideRtt=!0,P.getOrCreateProgram(B,U)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();for(let S in w){let I=this._mergedSourceCaches[S];w[S]!==I.used&&I.getSource().fire(new t.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),_&&this.fire(new t.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let l=this._changes.getUpdatedImages();if(l.length){for(let u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],l);this._changes.resetUpdatedImages()}}_updateWorkerLayers(l,u,_){let x=this.getFragmentStyle(l);x&&this.dispatcher.broadcast("updateLayers",{layers:u?x._serializeLayers(u):[],scope:l,removedIds:_||[],options:x.options})}setState(l,u){if(this._checkLoaded(),Ws(this,_e(l)))return!1;(l=t.cT(l)).layers=Yf(l.layers);let _=function(S,I){if(!S)return[{command:ji.setStyle,args:[I]}];let A=[];try{if(!g(S.version,I.version))return[{command:ji.setStyle,args:[I]}];if(g(S.center,I.center)||A.push({command:ji.setCenter,args:[I.center]}),g(S.zoom,I.zoom)||A.push({command:ji.setZoom,args:[I.zoom]}),g(S.bearing,I.bearing)||A.push({command:ji.setBearing,args:[I.bearing]}),g(S.pitch,I.pitch)||A.push({command:ji.setPitch,args:[I.pitch]}),g(S.sprite,I.sprite)||A.push({command:ji.setSprite,args:[I.sprite]}),g(S.glyphs,I.glyphs)||A.push({command:ji.setGlyphs,args:[I.glyphs]}),g(S.imports,I.imports)||function(H=[],q=[],Z){q=q||[];let X=(H=H||[]).map(mp),K=q.map(mp),re=H.reduce(Zc,{}),ae=q.reduce(Zc,{}),se=X.slice(),fe,me,ne,le;for(fe=0,me=0;fe<X.length;fe++)ne=X[fe],ae.hasOwnProperty(ne)?me++:(Z.push({command:ji.removeImport,args:[ne]}),se.splice(se.indexOf(ne,me),1));for(fe=0,me=0;fe<K.length;fe++)ne=K[K.length-1-fe],se[se.length-1-fe]!==ne&&(re.hasOwnProperty(ne)?(Z.push({command:ji.removeImport,args:[ne]}),se.splice(se.lastIndexOf(ne,se.length-me),1)):me++,le=se[se.length-fe],Z.push({command:ji.addImport,args:[ae[ne],le]}),se.splice(se.length-fe,0,ne));for(let ce of q){let we=re[ce.id];we&&!g(we,ce)&&Z.push({command:ji.updateImport,args:[ce.id,ce]})}}(S.imports,I.imports,A),g(S.transition,I.transition)||A.push({command:ji.setTransition,args:[I.transition]}),g(S.light,I.light)||A.push({command:ji.setLight,args:[I.light]}),g(S.fog,I.fog)||A.push({command:ji.setFog,args:[I.fog]}),g(S.projection,I.projection)||A.push({command:ji.setProjection,args:[I.projection]}),g(S.lights,I.lights)||A.push({command:ji.setLights,args:[I.lights]}),g(S.camera,I.camera)||A.push({command:ji.setCamera,args:[I.camera]}),!g(S["color-theme"],I["color-theme"]))return[{command:ji.setStyle,args:[I]}];let P={},F=[];(function(H,q,Z,X){let K;for(K in q=q||{},H=H||{})H.hasOwnProperty(K)&&(q.hasOwnProperty(K)||J0(K,Z,X));for(K in q){if(!q.hasOwnProperty(K))continue;let re=q[K];H.hasOwnProperty(K)?g(H[K],re)||(H[K].type==="geojson"&&re.type==="geojson"&&s1(H,q,K)?Z.push({command:ji.setGeoJSONSourceData,args:[K,re.data]}):a1(K,q,Z,X)):hs(K,q,Z)}})(S.sources,I.sources,F,P);let B=[];S.layers&&S.layers.forEach(H=>{H.source&&P[H.source]?A.push({command:ji.removeLayer,args:[H.id]}):B.push(H)});let U=S.terrain;U&&P[U.source]&&(A.push({command:ji.setTerrain,args:[void 0]}),U=void 0),A=A.concat(F),g(U,I.terrain)||A.push({command:ji.setTerrain,args:[I.terrain]}),function(H,q,Z){q=q||[];let X=(H=H||[]).map(mp),K=q.map(mp),re=H.reduce(Zc,{}),ae=q.reduce(Zc,{}),se=X.slice(),fe=Object.create(null),me,ne,le,ce,we,Oe,ue;for(me=0,ne=0;me<X.length;me++)le=X[me],ae.hasOwnProperty(le)?ne++:(Z.push({command:ji.removeLayer,args:[le]}),se.splice(se.indexOf(le,ne),1));for(me=0,ne=0;me<K.length;me++)le=K[K.length-1-me],se[se.length-1-me]!==le&&(re.hasOwnProperty(le)?(Z.push({command:ji.removeLayer,args:[le]}),se.splice(se.lastIndexOf(le,se.length-ne),1)):ne++,Oe=se[se.length-me],Z.push({command:ji.addLayer,args:[ae[le],Oe]}),se.splice(se.length-me,0,le),fe[le]=!0);for(me=0;me<K.length;me++)if(le=K[me],ce=re[le],we=ae[le],!fe[le]&&!g(ce,we))if(g(ce.source,we.source)&&g(ce["source-layer"],we["source-layer"])&&g(ce.type,we.type)){for(ue in Rh(ce.layout,we.layout,Z,le,null,ji.setLayoutProperty),Rh(ce.paint,we.paint,Z,le,null,ji.setPaintProperty),g(ce.slot,we.slot)||Z.push({command:ji.setSlot,args:[le,we.slot]}),g(ce.filter,we.filter)||Z.push({command:ji.setFilter,args:[le,we.filter]}),g(ce.minzoom,we.minzoom)&&g(ce.maxzoom,we.maxzoom)||Z.push({command:ji.setLayerZoomRange,args:[le,we.minzoom,we.maxzoom]}),ce)ce.hasOwnProperty(ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&ue!=="slot"&&(ue.indexOf("paint.")===0?Rh(ce[ue],we[ue],Z,le,ue.slice(6),ji.setPaintProperty):g(ce[ue],we[ue])||Z.push({command:ji.setLayerProperty,args:[le,ue,we[ue]]}));for(ue in we)we.hasOwnProperty(ue)&&!ce.hasOwnProperty(ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&ue!=="slot"&&(ue.indexOf("paint.")===0?Rh(ce[ue],we[ue],Z,le,ue.slice(6),ji.setPaintProperty):g(ce[ue],we[ue])||Z.push({command:ji.setLayerProperty,args:[le,ue,we[ue]]}))}else Z.push({command:ji.removeLayer,args:[le]}),Oe=se[se.lastIndexOf(le)+1],Z.push({command:ji.addLayer,args:[we,Oe]})}(B,I.layers,A)}catch(P){console.warn("Unable to compute style diff:",P),A=[{command:ji.setStyle,args:[I]}]}return A}(this.serialize(),l).filter(S=>!(S.command in h1));if(_.length===0)return!1;let x=_.filter(S=>!(S.command in tg));if(x.length>0)throw new Error(`Unimplemented: ${x.map(S=>S.command).join(", ")}.`);let w=[];return _.forEach(S=>{w.push(this[S.command].apply(this,S.args))}),u&&Promise.all(w).then(u),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(l,u){return this.getImage(l)?this.fire(new t.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,this.scope,u),this._afterImageUpdated(l),this)}updateImage(l,u){this.imageManager.updateImage(l,this.scope,u)}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._afterImageUpdated(l),this):this.fire(new t.d(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(l),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new t.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(l,u,_={}){return this._checkLoaded(),this._validate(_i,`models.${l}`,u,null,_)||(this.modelManager.addModel(l,u,this.scope),this._changes.setDirty()),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope),this):this.fire(new t.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,u,_={}){if(this._checkLoaded(),this.getOwnSource(l)!==void 0)throw new Error(`There is already a source with ID "${l}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(ye,`sources.${l}`,u,null,_))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);let x=ip(l,u,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));let w=S=>{let I=(S?"symbol:":"other:")+x.id,A=t.al(I,this.scope),P=this._sourceCaches[I]=new t.bv(A,x,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=P,P.onAdd(this.map)};w(!1),u.type!=="vector"&&u.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();let u=this.getOwnSource(l);if(!u)throw new Error("There is no source with this ID");for(let x in this._layers)if(this._layers[x].source===l)return this.fire(new t.d(new Error(`Source "${l}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new t.d(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));let _=this.getOwnSourceCaches(l);for(let x of _){let w=t.cU(x.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(x.id),x.fire(new t.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,u){this._checkLoaded(),this.getOwnSource(l).setData(u),this._changes.setDirty()}getOwnSource(l){let u=this.getOwnSourceCache(l);return u&&u.getSource()}getOwnSources(){let l=[];for(let u in this._otherSourceCaches){let _=this.getOwnSourceCache(u);_&&l.push(_.getSource())}return l}areTilesLoaded(){let l=this._mergedSourceCaches;for(let u in l){let _=l[u]._tiles;for(let x in _){let w=_[x];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;let u=this._getTransitionParameters();for(let x of l){if(this._validate(Be,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){let w=this.ambientLight;w.set(x),w.updateTransitions(u)}else this.ambientLight=new hh(x,mi,this.scope,this.options);break;case"directional":if(this.directionalLight){let w=this.directionalLight;w.set(x),w.updateTransitions(u)}else this.directionalLight=new hh(x,cf,this.scope,this.options)}}let _=new t.X(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let l=this.directionalLight,u=this.ambientLight;if(!l||!u)return;let _=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),x=l.properties.get("color").toRenderColor(null).toArray01(),w=l.properties.get("intensity"),S=l.properties.get("direction"),I=1-t.ac(S.x,S.y,S.z)[2]/90,A=_(x)*w*I,P=u.properties.get("color").toRenderColor(null).toArray01(),F=u.properties.get("intensity");return(A+_(P)*F)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(!l)return this;if(t.cV(l)){let u=t.cW(l),_=this.fragments.find(({id:w})=>w===u);if(!_)throw new Error(`Style import not found: ${l}`);let x=t.cU(l);return _.style.getFragmentStyle(x)}{let u=this.fragments.find(({id:_})=>_===l);if(!u)throw new Error(`Style import not found: ${l}`);return u.style}}getConfigProperty(l,u){let _=this.getFragmentStyle(l);if(!_)return null;let x=t.al(u,_.scope),w=_.options.get(x),S=w?w.value||w.default:null;return S?S.serialize():null}setConfigProperty(l,u,_){let x=this.getFragmentStyle(l);if(!x)return;let w=x.stylesheet.schema;if(!w||!w[u])return;let S=t.y(_);if(S.result!=="success")return void Ws(this,S.value);let I=S.value.expression,A=t.al(u,x.scope),P=x.options.get(A);if(!P)return;let F,{minValue:B,maxValue:U,stepValue:H,type:q,values:Z}=w[u],X=t.y(w[u].default);X.result==="success"&&(F=X.value.expression),F?(this.options.set(A,Cn(kt({},P),{value:I,default:F,minValue:B,maxValue:U,stepValue:H,type:q,values:Z})),this.updateConfigDependencies()):this.fire(new t.d(new Error(`No schema defined for the config option "${u}" in the "${l}" fragment.`)))}getConfig(l){let u=this.getFragmentStyle(l);if(!u)return null;let _=u.stylesheet.schema;if(!_)return null;let x={};for(let w in _){let S=t.al(w,u.scope),I=u.options.get(S),A=I?I.value||I.default:null;x[w]=A?A.serialize():null}return x}setConfig(l,u){let _=this.getFragmentStyle(l);_&&(_.updateConfig(u,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(l){let u=this.getFragmentStyle(l);return u?u.stylesheet.schema:null}setSchema(l,u){let _=this.getFragmentStyle(l);_&&(_.stylesheet.schema=u,_.updateConfig(_._config,u),this.updateConfigDependencies())}updateConfig(l,u){if(this._config=l,l||u)if(u)for(let _ in u){let x,w,S=t.y(u[_].default);if(S.result==="success"&&(x=S.value.expression),l&&l[_]!==void 0){let U=t.y(l[_]);U.result==="success"&&(w=U.value.expression)}let{minValue:I,maxValue:A,stepValue:P,type:F,values:B}=u[_];if(x){let U=t.al(_,this.scope);this.options.set(U,{default:x,value:w,minValue:I,maxValue:A,stepValue:P,type:F,values:B})}else this.fire(new t.d(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new t.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let l of this._configDependentLayers){let u=this.getLayer(l);u&&(u.possiblyEvaluateVisibility(),this._updateLayer(u))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(l=>{if(l._styleColorTheme.colorTheme){let u=l._evaluateColorThemeData(l._styleColorTheme.colorTheme);(!l._styleColorTheme.lut||l._styleColorTheme.lut&&u!==l._styleColorTheme.lut.data)&&l.setColorTheme(l._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(l,u,_={}){this._checkLoaded();let x=l.id;if(this._layers[x])return void this.fire(new t.d(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(l.type==="custom"){if(Ws(this,t.cX(l)))return;w=t.cY(l,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof l.source=="object"&&(this.addSource(x,l.source),l=t.cT(l),l=t.W(l,{source:x})),this._validate(ut,`layers.${x}`,l,{arrayIndex:-1},_))return;w=t.cY(l,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[w.id]=w.serialize()}w.isConfigDependent&&this._configDependentLayers.add(w.fqid);let S=this._order.length;if(u){let F=this._order.indexOf(u);if(F===-1)return void this.fire(new t.d(new Error(`Layer with id "${u}" does not exist on this map.`)));w.slot===this._layers[u].slot?S=F:t.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,x),this._layerOrderChanged=!0,this._layers[x]=w;let I=this.getOwnLayerSourceCache(w),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&w.canCastShadows()&&A&&(I.castsShadows=!0);let P=this._changes.getRemovedLayer(w);if(P&&w.source&&I&&w.type!=="custom"){this._changes.discardLayerRemoval(w);let F=t.al(w.source,w.scope);P.type!==w.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),I.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(l,u){this._checkLoaded();let _=this._checkLayer(l);if(!_||l===u)return;let x=this._order.indexOf(l);this._order.splice(x,1);let w=this._order.length;if(u){let S=this._order.indexOf(u);if(S===-1)return void this.fire(new t.d(new Error(`Layer with id "${u}" does not exist on this map.`)));_.slot===this._layers[u].slot?w=S:t.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();let u=this._checkLayer(l);if(!u)return;u.setEventedParent(null);let _=this._order.indexOf(l);this._order.splice(_,1),delete this._layers[l],delete this._serializedLayers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);let x=this.getOwnLayerSourceCache(u);if(x&&x.castsShadows){let w=!1;for(let S in this._layers)if(this._layers[S].source===u.source&&this._layers[S].canCastShadows()){w=!0;break}x.castsShadows=w}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(let u in this._layers)if(this._layers[u].type===l)return!0;return!1}setLayerZoomRange(l,u,_){this._checkLoaded();let x=this._checkLayer(l);x&&(x.minzoom===u&&x.maxzoom===_||(u!=null&&(x.minzoom=u),_!=null&&(x.maxzoom=_),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(l,u){this._checkLoaded();let _=this._checkLayer(l);_&&_.slot!==u&&(_.slot=u,this._updateLayer(_))}setFilter(l,u,_={}){this._checkLoaded();let x=this._checkLayer(l);if(x&&!g(x.filter,u))return u==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(st,`layers.${x.id}.filter`,u,{layerType:x.type},_)||(x.filter=t.cT(u),this._updateLayer(x)))}getFilter(l){let u=this._checkLayer(l);if(u)return t.cT(u.filter)}setLayoutProperty(l,u,_,x={}){this._checkLoaded();let w=this._checkLayer(l);if(w&&!g(w.getLayoutProperty(u),_)){if(_!=null&&(!x||x.validate!==!1)&&Ws(w,Yt.call(_e,{key:`layers.${l}.layout.${u}`,layerType:w.type,objectKey:u,value:_,styleSpec:t.L,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(u,_),w.isConfigDependent&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(l,u){let _=this._checkLayer(l);if(_)return _.getLayoutProperty(u)}setPaintProperty(l,u,_,x={}){this._checkLoaded();let w=this._checkLayer(l);if(!w||g(w.getPaintProperty(u),_)||_!=null&&(!x||x.validate!==!1)&&Ws(w,Lt.call(_e,{key:`layers.${l}.paint.${u}`,layerType:w.type,objectKey:u,value:_,styleSpec:t.L})))return;let S=w.setPaintProperty(u,_);w.isConfigDependent&&this._configDependentLayers.add(w.fqid),S&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(l,u){let _=this._checkLayer(l);if(_)return _.getPaintProperty(u)}setFeatureState(l,u){this._checkLoaded();let _=l.source,x=l.sourceLayer,w=this._checkSource(_);if(!w)return;let S=w.type;if(S==="geojson"&&x)return void this.fire(new t.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!x)return void this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new t.d(new Error("The feature id parameter must be provided.")));let I=this.getOwnSourceCaches(_);for(let A of I)A.setFeatureState(x,l.id,u)}removeFeatureState(l,u){this._checkLoaded();let _=l.source,x=this._checkSource(_);if(!x)return;let w=x.type,S=w==="vector"?l.sourceLayer:void 0;if(w==="vector"&&!S)return void this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new t.d(new Error("A feature id is required to remove its specific state property.")));let I=this.getOwnSourceCaches(_);for(let A of I)A.removeFeatureState(S,l.id,u)}getFeatureState(l){this._checkLoaded();let u=l.source,_=l.sourceLayer,x=this._checkSource(u);if(x){if(x.type!=="vector"||_)return l.id===void 0&&this.fire(new t.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(_,l.id);this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=t.W({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return t.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let l=this.getTerrain(),u=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return t.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateLayer(l){this._changes.updateLayer(l);let u=this.getLayerSourceCache(l),_=t.al(l.source,l.scope),x=this._changes.getUpdatedSourceCaches();l.source&&!x[_]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),u.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){let u=I=>this._mergedLayers[I].type==="fill-extrusion"||this._mergedLayers[I].type==="model",_=this.order,x={},w=[];for(let I=_.length-1;I>=0;I--){let A=_[I];if(u(A)){x[A]=I;for(let P of l){let F=P[A];if(F)for(let B of F)w.push(B)}}}w.sort((I,A)=>A.intersectionZ-I.intersectionZ);let S=[];for(let I=_.length-1;I>=0;I--){let A=_[I];if(u(A))for(let P=w.length-1;P>=0;P--){let F=w[P].feature;if(F.layer&&x[F.layer.id]<I)break;S.push(F),w.pop()}else for(let P of l){let F=P[A];if(F)for(let B of F)S.push(B.feature)}}return S}queryRenderedFeatures(l,u,_){u&&u.filter&&this._validate(st,"queryRenderedFeatures.filter",u.filter,null,u),u.scope=this.scope,u.availableImages=this._availableImages,u.serializedLayers=this._serializedLayers;let x={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new t.d(new Error("parameters.layers must be an Array."))),[];for(let P of u.layers){let F=this._mergedLayers[P];if(!F)return this.fire(new t.d(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];x[F.source]=!0}}let w=[],S=u.serializedLayers||{},I=u&&u.layers?u.layers.some(P=>{let F=this.getLayer(P);return F&&F.is3D()}):this.has3DLayers(),A=to.createFromScreenPoints(l,_);for(let P in this._mergedSourceCaches){let F=this._mergedSourceCaches[P].getSource();if(!F||F.scope!==u.scope)continue;let B=this._mergedSourceCaches[P].getSource().id;u.layers&&!x[B]||w.push(r1(this._mergedSourceCaches[P],this._mergedLayers,S,A,u,_,I,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(P,F,B,U,H,q,Z){let X={},K=q.queryRenderedSymbols(U),re=[];for(let ae of Object.keys(K).map(Number))re.push(Z[ae]);re.sort(qc);for(let ae of re){let se=ae.featureIndex.lookupSymbolFeatures(K[ae.bucketInstanceId],F,ae.bucketIndex,ae.sourceLayerIndex,H.filter,H.layers,H.availableImages,P);for(let fe in se){let me=X[fe]=X[fe]||[],ne=se[fe];ne.sort((le,ce)=>{let we=ae.featureSortOrder;if(we){let Oe=we.indexOf(le.featureIndex);return we.indexOf(ce.featureIndex)-Oe}return ce.featureIndex-le.featureIndex});for(let le of ne)me.push(le)}}for(let ae in X)X[ae].forEach(se=>{let fe=se.feature,me=B(P[ae]);if(!me)return;let ne=me.getFeatureState(fe.layer["source-layer"],fe.id);fe.source=fe.layer.source,fe.layer["source-layer"]&&(fe.sourceLayer=fe.layer["source-layer"]),fe.state=ne});return X}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),A.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(l,u){u&&u.filter&&this._validate(st,"querySourceFeatures.filter",u.filter,null,u);let _=this.getOwnSourceCaches(l),x=[];for(let w of _)x=x.concat(Oh(w,u));return x}addSourceType(l,u,_){return Sa.getSourceType(l)?_(new Error(`A source type called "${l}" already exists.`)):(Sa.setSourceType(l,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:u.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,u,_={}){this._checkLoaded();let x=this.light.getLight(),w=!1;for(let I in l)if(!g(l[I],x[I])){w=!0;break}if(!w)return;let S=this._getTransitionParameters();this.light.setLight(l,u,_),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=t.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&t.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(l,u=1){if(this._checkLoaded(),!l)return this.terrainSetForDrapingOnly()&&u!==0||delete this.terrain,l===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=l,x=l.source==null;if(u===1){if(this.disableElevatedTerrain)return;if(typeof _.source=="object"){let I="terrain-dem-src";this.addSource(I,_.source),_=t.cT(_),_=t.W(_,{source:I})}let w=t.W({},_),S={};if(this.terrain&&x){w.source=this.terrain.get().source;let I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(S.style=I.serialize())}if(this._validate(Ie,"terrain",w,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&u!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,u),this.fire(new t.f("data",{dataType:"style"}))}else{let w=this.terrain,S=w.get();for(let I of Object.keys(t.L.terrain))!_.hasOwnProperty(I)&&t.L.terrain[I].default&&(_[I]=t.L.terrain[I].default);for(let I in l)if(!g(l[I],S[I])){w.set(l,this.options),this.stylesheet.terrain=l;let A=this._getTransitionParameters({duration:0});w.updateTransitions(A),this.fire(new t.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){let u=this.fog=new k0(l,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();let _=this._getTransitionParameters({duration:0});u.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let u=this.fog;if(!g(u.get(),l)){u.set(l,this.options),this.stylesheet.fog=u.get();let _=this._getTransitionParameters({duration:0});u.updateTransitions(_)}}else this._createFog(l);this._markersNeedUpdate=!0}setColorTheme(l){this._checkLoaded();let u=()=>{for(let x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(let x in this._sourceCaches)this._sourceCaches[x].clearTiles()};if(this._styleColorTheme.colorTheme=l,!l)return this._styleColorTheme.lut=null,void u();let _=this._evaluateColorThemeData(l);this._loadColorTheme(_).then(()=>{u()}).catch(x=>{t.w(`Couldn't set color theme: ${x}`)})}_getTransitionParameters(l){return{now:t.e.now(),transition:t.W(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;let l=[],u=[];for(let _ in this._mergedLayers)this.isLayerDraped(this._mergedLayers[_])?l.push(_):u.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...u)}_createTerrain(l,u){let _=this.terrain=new on(l,u,this.scope,this.options);u===1&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let x=this._getTransitionParameters({duration:0});_.updateTransitions(x)}_force3DLayerUpdate(){for(let l in this._layers){let u=this._layers[l];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(let l in this._layers){let u=this._layers[l];u.type==="symbol"&&this._updateLayer(u)}}_validate(l,u,_,x,w={}){if(w&&w.validate===!1)return!1;let S=t.W({},this.serialize());return Ws(this,l.call(_e,t.W({key:u,style:S,value:_,styleSpec:t.L},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(let l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(l){let u=this.getSourceCaches(l);for(let _ of u)_.clearTiles()}clearSources(){for(let l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}reloadSource(l){let u=this.getSourceCaches(l);for(let _ of u)_.resume(),_.reload()}reloadSources(){for(let l of this.getSources())l.reload&&l.reload()}updateSources(l){let u;this.directionalLight&&(u=_h(this.directionalLight));for(let _ in this._mergedSourceCaches)this._mergedSourceCaches[_].update(l,void 0,void 0,u)}_generateCollisionBoxes(){for(let l in this._sourceCaches){let u=this._sourceCaches[l];u.resume(),u.reload()}}_updatePlacement(l,u,_,x,w,S,I=!1){let A=!1,P=!1,F={},B={};for(let H of this._mergedOrder){let q=this._mergedLayers[H];if(q.type!=="symbol")continue;let Z=t.al(q.source,q.scope),X=F[Z];if(!X){let re=this.getLayerSourceCache(q);if(!re)continue;let ae=re.getRenderableIds(!0).map(se=>re.getTileByID(se));B[Z]=ae.slice(),X=F[Z]=ae.sort((se,fe)=>fe.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(fe.tileID)?-1:1))}let K=this.crossTileSymbolIndex.addLayer(q,X,u.center.lng,u.projection);A=A||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new t.f("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.e.now(),u.zoom))&&(this.pauseablePlacement=new _p(u,this._mergedOrder,I,_,x,w,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.e.now()),P=!0),A&&this.pauseablePlacement.placement.setStale()),P||A){this._buildingIndex.onNewFrame(u.zoom);for(let H=0;H<this._mergedOrder.length;H++){let q=this._mergedLayers[this._mergedOrder[H]];if(q.type!=="symbol")continue;let Z=this.isLayerClipped(q)&&this._clipLayerIndices.some(X=>H<X);this.placement.updateLayerOpacities(q,F[t.al(q.source,q.scope)],H,Z?S:null)}}let U=!1;for(let H of this._mergedOrder){let q=this._mergedLayers[H];if(q.type!=="symbol")continue;let Z=F[t.al(q.source,q.scope)];for(let X of Z){let K=X.getBucket(q);K&&X.latestFeatureIndex&&q.fqid===K.layerIds[0]&&(U=K.updateOcclusionOpacities(l.context,l.symbolParams,l._dt)||U)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.e.now())||U,occlusionQueryBasedOpacityChanged:U}}_releaseSymbolFadeTiles(){for(let l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l,u){this._checkLoaded();let _=this.stylesheet.imports=this.stylesheet.imports||[];if(_.findIndex(({id:w})=>w===l.id)!==-1)return void this.fire(new t.d(new Error(`Import with id '${l.id}' already exists in the map's style.`)));if(!u)return _.push(l),this._loadImports([l],!0);let x=_.findIndex(({id:w})=>w===u);return x===-1&&this.fire(new t.d(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,x).concat(l).concat(_.slice(x)),this._loadImports([l],!0,u)}updateImport(l,u){this._checkLoaded();let _=this.stylesheet.imports||[],x=this.getImportIndex(l);return x===-1?this:typeof u=="string"?(this.setImportUrl(l,u),this):(u.url&&u.url!==_[x].url&&this.setImportUrl(l,u.url),g(u.config,_[x].config)||this.setImportConfig(l,u.config),g(u.data,_[x].data)||this.setImportData(l,u.data),this)}moveImport(l,u){this._checkLoaded();let _=this.stylesheet.imports||[],x=this.getImportIndex(l);if(x===-1)return this;let w=this.getImportIndex(u);if(w===-1)return this;let S=_[x],I=this.fragments[x];return _=_.filter(({id:A})=>A!==l),this.fragments=this.fragments.filter(({id:A})=>A!==l),this.stylesheet.imports=_.slice(0,w).concat(S).concat(_.slice(w)),this.fragments=this.fragments.slice(0,w).concat(I).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(l,u){this._checkLoaded();let _=this.stylesheet.imports||[],x=this.getImportIndex(l);if(x===-1)return this;_[x].url=u;let w=this.fragments[x];return w.style=this._createFragmentStyle(_[x]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(u),this}setImportData(l,u){this._checkLoaded();let _=this.getImportIndex(l),x=this.stylesheet.imports||[];return _===-1?this:u?(this.fragments[_].style.setState(u),this._reloadImports(),this):(delete x[_].data,this.setImportUrl(l,x[_].url))}setImportConfig(l,u){this._checkLoaded();let _=this.getImportIndex(l),x=this.stylesheet.imports||[];if(_===-1)return this;u?x[_].config=u:delete x[_].config;let w=this.fragments[_],S=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=u,w.style.updateConfig(u,S),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();let u=this.stylesheet.imports||[],_=this.getImportIndex(l);_!==-1&&(u.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(l){let u=(this.stylesheet.imports||[]).findIndex(_=>_.id===l);return u===-1&&this.fire(new t.d(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),u}getLayer(l){return this._mergedLayers[l]}getSources(){let l=[];for(let u in this._mergedOtherSourceCaches){let _=this._mergedOtherSourceCaches[u];_&&l.push(_.getSource())}return l}getSource(l,u){let _=this.getSourceCache(l,u);return _&&_.getSource()}getLayerSource(l){let u=this.getLayerSourceCache(l);return u&&u.getSource()}getSourceCache(l,u){let _=t.al(l,u);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(l){let u=t.al(l.source,l.scope);return l.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(l){if(l==null)return Object.values(this._mergedSourceCaches);let u=[];return this._mergedOtherSourceCaches[l]&&u.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&u.push(this._mergedSymbolSourceCaches[l]),u}updateSourceCaches(){let l=this._changes.getUpdatedSourceCaches();for(let u in l){let _=l[u];_==="reload"?this.reloadSource(u):_==="clear"&&this.clearSource(u)}}updateLayers(l){let u=this._changes.getUpdatedPaintProperties();for(let _ of u){let x=this.getLayer(_);x&&x.updateTransitions(l)}}getImages(l,u,_){this.imageManager.getImages(u.icons,u.scope,_),this._updateTilesForChangedImages();let x=w=>{w&&w.setDependencies(u.tileID.key,u.type,u.icons)};x(this._otherSourceCaches[u.source]),x(this._symbolSourceCaches[u.source])}getGlyphs(l,u,_){this.glyphManager.getGlyphs(u.stacks,u.scope,_)}getResource(l,u,_){return t.c$(u,_)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){let u=[];return this._otherSourceCaches[l]&&u.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&u.push(this._symbolSourceCaches[l]),u}_isSourceCacheLoaded(l){let u=this.getOwnSourceCaches(l);return u.length===0?(this.fire(new t.d(new Error(`There is no source with ID '${l}'`))),!1):u.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(l,u){if(this._clipLayerIndices.length===0&&l.type!=="fill-extrusion")return!1;let _=l.type==="fill-extrusion"&&l.sourceLayer==="building",x=0;if(l.is3D()){if(_||u&&u.type==="batched-model")return!0;l.type==="model"&&(x=t.cu.Model)}else l.type==="symbol"&&(x=t.cu.Symbol);for(let w of this._clipLayerIndices){let S=this._mergedLayers[this._mergedOrder[w]];if(!S)continue;let I=[];for(let A of S.layout.get("clip-layer-types"))I.push(A==="model"?t.cu.Model:A==="symbol"?t.cu.Symbol:t.cu.FillExtrusion);for(let A of I)if(x&A)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(l=>{l.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function ig(f,l){let u=!1,_=null,x=()=>{_=null,u&&(f(),_=setTimeout(x,l),u=!1)};return()=>(u=!0,_||x(),_)}Sa.getSourceType=function(f){return Rr[f]},Sa.setSourceType=function(f,l){Rr[f]=l},Sa.registerForPluginStateChange=t.cL;class u1{constructor(l){this._hashName=l&&encodeURIComponent(l),t.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ig(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let l=this._map;if(!l)return"";let u=Nh(l);if(this._hashName){let _=this._hashName,x=!1,w=location.hash.slice(1).split("&").map(S=>{let I=S.split("=")[0];return I===_?(x=!0,`${I}=${u}`):S}).filter(S=>S);return x||w.push(`${_}=${u}`),`#${w.join("&")}`}return`#${u}`}_getCurrentHash(){let l=location.hash.replace("#","");if(this._hashName){let u;return l.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(u=_)}),(u&&u[1]||"").split("/")}return l.split("/")}_onHashChange(){let l=this._map;if(!l)return!1;let u=this._getCurrentHash();if(u.length>=3&&!u.some(_=>isNaN(_))){let _=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(u[3]||0):l.getBearing();return l.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:_,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Nh(f,l){let u=f.getCenter(),_=Math.round(100*f.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),S=Math.round(u.lng*w)/w,I=Math.round(u.lat*w)/w,A=f.getBearing(),P=f.getPitch(),F=l?`/${S}/${I}/${_}`:`${_}/${I}/${S}`;return(A||P)&&(F+="/"+Math.round(10*A)/10),P&&(F+=`/${Math.round(P)}`),F}let yp={linearity:.3,easing:t.d0(0,0,.3,1)},ly=t.W({deceleration:2500,maxSpeed:1400},yp),ng=t.W({deceleration:20,maxSpeed:1400},yp),bp=t.W({deceleration:1e3,maxSpeed:360},yp),rg=t.W({deceleration:1e3,maxSpeed:90},yp);class Ol{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.e.now(),settings:l})}_drainInertiaBuffer(){let l=this._inertiaBuffer,u=t.e.now();for(;l.length>0&&u-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let u={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:w}of this._inertiaBuffer)u.zoom+=w.zoomDelta||0,u.bearing+=w.bearingDelta||0,u.pitch+=w.pitchDelta||0,w.panDelta&&u.pan._add(w.panDelta),w.around&&(u.around=w.around),w.pinchAround&&(u.pinchAround=w.pinchAround);let _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(u.pan.mag()){let w=Vh(u.pan.mag(),_,t.W({},ly,l||{}));x.offset=u.pan.mult(w.amount/u.pan.mag()),x.center=this._map.transform.center,Xc(x,w)}if(u.zoom){let w=Vh(u.zoom,_,ng);x.zoom=this._map.transform.zoom+w.amount,Xc(x,w)}if(u.bearing){let w=Vh(u.bearing,_,bp);x.bearing=this._map.transform.bearing+t.at(w.amount,-179,179),Xc(x,w)}if(u.pitch){let w=Vh(u.pitch,_,rg);x.pitch=this._map.transform.pitch+w.amount,Xc(x,w)}if(x.zoom||x.bearing){let w=u.pinchAround===void 0?u.around:u.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Xc(f,l){(!f.duration||f.duration<l.duration)&&(f.duration=l.duration,f.easing=l.easing)}function Vh(f,l,u){let{maxSpeed:_,linearity:x,deceleration:w}=u,S=t.at(f*x/(l/1e3),-_,_),I=Math.abs(S)/(w*x);return{easing:u.easing,duration:1e3*I,amount:S*(I/2)}}class Fr extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,u,_,x={}){let w=dt(u.getCanvasContainer(),_),S=u.unproject(w);super(l,t.W({point:w,lngLat:S,originalEvent:_},x)),this._defaultPrevented=!1,this.target=u}}class Gs extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,u,_){let x=l==="touchend"?_.changedTouches:_.touches,w=bt(u.getCanvasContainer(),x),S=w.map(A=>u.unproject(A)),I=w.reduce((A,P,F,B)=>A.add(P.div(B.length)),new t.P(0,0));super(l,{points:w,point:I,lngLats:S,lngLat:u.unproject(I),originalEvent:_}),this._defaultPrevented=!1}}class vp extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,u,_){super(l,{originalEvent:_}),this._defaultPrevented=!1}}class og{constructor(l,u){this._map=l,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new vp(l.type,this._map,l))}mousedown(l,u){return this._mousedownPos=u,this._firePreventable(new Fr(l.type,this._map,l))}mouseup(l){this._map.fire(new Fr(l.type,this._map,l))}preclick(l){let u=t.W({},l);u.type="preclick",this._map.fire(new Fr(u.type,this._map,u))}click(l,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(l),this._map.fire(new Fr(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new Fr(l.type,this._map,l))}mouseover(l){this._map.fire(new Fr(l.type,this._map,l))}mouseout(l){this._map.fire(new Fr(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Gs(l.type,this._map,l))}touchmove(l){this._map.fire(new Gs(l.type,this._map,l))}touchend(l){this._map.fire(new Gs(l.type,this._map,l))}touchcancel(l){this._map.fire(new Gs(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jh{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new Fr(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Fr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Fr(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xp{constructor(l,u){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,u){this.isEnabled()&&l.shiftKey&&l.button===0&&(Me(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(l,u){if(!this._active)return;let _=u,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(_)||!this._box&&_.dist(x)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=L("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));let S=Math.min(x.x,_.x),I=Math.max(x.x,_.x),A=Math.min(x.y,_.y),P=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${A}px)`,this._box.style.width=I-S+"px",this._box.style.height=P-A+"px")})}mouseupWindow(l,u){if(!this._active)return;let _=this._startPos,x=u;if(_&&l.button===0){if(this.reset(),We(),_.x!==x.x||_.y!==x.y)return this._map.fire(new t.f("boxzoomend",{originalEvent:l})),{cameraAnimation:w=>w.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Te(),delete this._startPos,delete this._lastPos}_fireEvent(l,u){return this._map.fire(new t.f(l,{originalEvent:u}))}}function Uh(f,l){let u={};for(let _=0;_<f.length;_++)u[f[_].identifier]=l[_];return u}class cy{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,u,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){let w=new t.P(0,0);for(let S of x)w._add(S);return w.div(x.length)}(u),this.touches=Uh(_,u)))}touchmove(l,u,_){if(this.aborted||!this.centroid)return;let x=Uh(_,u);for(let w in this.touches){let S=x[w];(!S||S.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(l,u,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){let x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Hh{constructor(l){this.singleTap=new cy(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,u,_){this.singleTap.touchstart(l,u,_)}touchmove(l,u,_){this.singleTap.touchmove(l,u,_)}touchend(l,u,_){let x=this.singleTap.touchend(l,u,_);if(x){let w=l.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(x)<30;if(w&&S||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class wp{constructor(){this._zoomIn=new Hh({numTouches:1,numTaps:2}),this._zoomOut=new Hh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,u,_){this._zoomIn.touchstart(l,u,_),this._zoomOut.touchstart(l,u,_)}touchmove(l,u,_){this._zoomIn.touchmove(l,u,_),this._zoomOut.touchmove(l,u,_)}touchend(l,u,_){let x=this._zoomIn.touchend(l,u,_),w=this._zoomOut.touchend(l,u,_);return x?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(x)},{originalEvent:l})}):w?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(w)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Wh={0:1,2:2};class Cp{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,u){return!1}_move(l,u){return{}}mousedown(l,u){if(this._lastPoint)return;let _=ft(l);this._correctButton(l,_)&&(this._lastPoint=u,this._eventButton=_)}mousemoveWindow(l,u){let _=this._lastPoint;if(_){if(l.preventDefault(),this._eventButton!=null&&function(x,w){let S=Wh[w];return x.buttons===void 0||(x.buttons&S)!==S}(l,this._eventButton))this.reset();else if(this._moved||!(u.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(_,u)}}mouseupWindow(l){this._lastPoint&&ft(l)===this._eventButton&&(this._moved&&We(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dy extends Cp{mousedown(l,u){super.mousedown(l,u),this._lastPoint&&(this._active=!0)}_correctButton(l,u){return u===0&&!l.ctrlKey}_move(l,u){return{around:u,panDelta:u.sub(l)}}}class ag extends Cp{_correctButton(l,u){return u===0&&l.ctrlKey||u===2}_move(l,u){let _=.8*(u.x-l.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(l){l.preventDefault()}}class Rl extends Cp{_correctButton(l,u){return u===0&&l.ctrlKey||u===2}_move(l,u){let _=-.5*(u.y-l.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(l){l.preventDefault()}}class hy{constructor(l,u){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),t.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}touchstart(l,u,_){return this._calculateTransform(l,u,_)}touchmove(l,u,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!t.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,u,_)}}touchend(l,u,_){this._calculateTransform(l,u,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,u,_){_.length>0&&(this._active=!0);let x=Uh(_,u),w=new t.P(0,0),S=new t.P(0,0),I=0;for(let P in x){let F=x[P],B=this._touches[P];B&&(w._add(F),S._add(F.sub(B)),I++,x[P]=F)}if(this._touches=x,I<this._minTouches||!S.mag())return;let A=S.div(I);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(I),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=L("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class sg{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,u,_){return{}}touchstart(l,u,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([u[0],u[1]]))}touchmove(l,u,_){let x=this._firstTwoTouches;if(!x)return;l.preventDefault();let[w,S]=x,I=Sp(_,u,w),A=Sp(_,u,S);if(!I||!A)return;let P=this._aroundCenter?null:I.add(A).div(2);return this._move([I,A],P,l)}touchend(l,u,_){if(!this._firstTwoTouches)return;let[x,w]=this._firstTwoTouches,S=Sp(_,u,x),I=Sp(_,u,w);S&&I||(this._active&&We(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Sp(f,l,u){for(let _=0;_<f.length;_++)if(f[_].identifier===u)return l[_]}function uy(f,l){return Math.log(f/l)/Math.LN2}class lg extends sg{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,u){let _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(uy(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:uy(this._distance,_),pinchAround:u}}}function Mp(f,l){return 180*f.angleWith(l)/Math.PI}class cg extends sg{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,u){let _=this._vector;if(this._vector=l[0].sub(l[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Mp(this._vector,_),pinchAround:u}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());let u=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;let x=Mp(l,_);return Math.abs(x)<u}}function Gh(f){return Math.abs(f.y)>Math.abs(f.x)}class py extends sg{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,Gh(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,u,_){let x=this._lastPoints;if(!x)return;let w=l[0].sub(x[0]),S=l[1].sub(x[1]);return this._map._cooperativeGestures&&!t.d1()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(w,S,_.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(w.y+S.y)/2*-.5})}gestureBeginsVertically(l,u,_){if(this._valid!==void 0)return this._valid;let x=l.mag()>=2,w=u.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;let S=l.y>0==u.y>0;return Gh(l)&&Gh(u)&&S}}let my={panStep:100,bearingStep:15,pitchStep:10};class p1{constructor(){let l=my;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let u=0,_=0,x=0,w=0,S=0;switch(l.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?x=1:(l.preventDefault(),S=-1);break;case 40:l.shiftKey?x=-1:(l.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:I=>{let A=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:$h,zoom:u?Math.round(A)+u*(l.shiftKey?2:1):A,bearing:I.getBearing()+_*this._bearingStep,pitch:I.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-S*this._panStep],center:I.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $h(f){return f*(2-f)}let Kc=4.000244140625,fy=1/450;class jo{constructor(l,u){this._map=l,this._el=l.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=fy,t.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||t.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,_=t.e.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,u!==0&&u%Kc==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(x*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),l.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=l,this._delta-=u,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let u=dt(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let u=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){let P=this._type==="wheel"&&Math.abs(this._delta)>Kc?this._wheelZoomRate:this._defaultZoomRate,F=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&F!==0&&(F=1/F);let B=u(),U=Math.pow(2,B),H=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(H*F))),this._type==="wheel"&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let _=typeof this._targetZoom=="number"?this._targetZoom:u(),x=this._startZoom,w=this._easing,S,I=!1;if(this._type==="wheel"&&x&&w){let P=Math.min((t.e.now()-this._lastWheelEventTime)/200,1),F=w(P);S=t.a2(x,_,F),P<1?this._frameId||(this._frameId=!0):I=!0}else S=_,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=S-u();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let u=t.d2;if(this._prevEase){let _=this._prevEase,x=(t.e.now()-_.start)/_.duration,w=_.easing(x+.01)-_.easing(x),S=.27/Math.sqrt(w*w+1e-4)*.01,I=Math.sqrt(.0729-S*S);u=t.d0(S,I,.25,1)}return this._prevEase={start:t.e.now(),duration:l,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=L("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class dg{constructor(l,u){this._clickZoom=l,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Tp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,u){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(l.shiftKey?-1:1),around:_.unproject(u)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ip{constructor(){this._tap=new Hh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,u,_){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=u[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(l,u,_))}touchmove(l,u,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;let x=u[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,l.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(l,u,_)}touchend(l,u,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(l,u,_)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hg{constructor(l,u,_){this._el=l,this._mousePan=u,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ug{constructor(l,u,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=u,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ep{constructor(l,u,_,x){this._el=l,this._touchZoom=u,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Qc=f=>f.zoom||f.drag||f.pitch||f.rotate;class pg extends t.f{}class Dp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,u){let _=t._.sub([],u,l);this.radius=t._.length(_[2]<0?t._.div([],_,this.constants):[_[0],_[1],0])}projectRay(l){t._.div(l,l,this.constants),t._.normalize(l,l),t._.mul(l,l,this.constants);let u=t._.scale([],l,this.radius);if(u[2]>0){let _=t._.scale([],[0,0,1],t._.dot(u,[0,0,1])),x=t._.scale([],t._.normalize([],[u[0],u[1],0]),this.radius),w=t._.add([],u,t._.scale([],t._.sub([],t._.add([],x,_),u),2));u[0]=w[0],u[1]=w[1]}return u}}function qh(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class gy{constructor(l,u){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ol(l),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Dp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),t.bp(["handleEvent","handleWindowEvent"],this);let _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(let[x,w,S]of this._listeners){let I=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(w,I,S)}}destroy(){for(let[l,u,_]of this._listeners){let x=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(u,x,_)}}_addDefaultHandlers(l){let u=this._map,_=u.getCanvasContainer();this._add("mapEvent",new og(u,l));let x=u.boxZoom=new xp(u,l);this._add("boxZoom",x);let w=new wp,S=new Tp;u.doubleClickZoom=new dg(S,w),this._add("tapZoom",w),this._add("clickZoom",S);let I=new Ip;this._add("tapDragZoom",I);let A=u.touchPitch=new py(u);this._add("touchPitch",A);let P=new ag(l),F=new Rl(l);u.dragRotate=new ug(l,P,F),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);let B=new dy(l),U=new hy(u,l);u.dragPan=new hg(_,B,U),this._add("mousePan",B),this._add("touchPan",U,["touchZoom","touchRotate"]);let H=new cg,q=new lg;u.touchZoomRotate=new Ep(_,q,H,I),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new jh(u));let Z=u.scrollZoom=new jo(u,this);this._add("scrollZoom",Z,["mousePan"]);let X=u.keyboard=new p1;this._add("keyboard",X);for(let K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[K]&&u[K].enable(l[K])}_add(l,u,_){this._handlers.push({handlerName:l,handler:u,allowed:_}),this._handlersById[l]=u}stop(l){if(!this._updatingCamera){for(let{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,u,_){for(let x in l)if(x!==_&&(!u||u.indexOf(x)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){let u=[];for(let _ of l)this._el.contains(_.target)&&u.push(_);return u}handleEvent(l,u){this._updatingCamera=!0;let _=l.type==="renderFrame",x=_?void 0:l,w={needsRenderFrame:!1},S={},I={},A=l.touches?this._getMapTouches(l.touches):void 0,P=A?bt(this._el,A):_?void 0:dt(this._el,l);for(let{handlerName:U,handler:H,allowed:q}of this._handlers){if(!H.isEnabled())continue;let Z;this._blockedByActive(I,q,U)?H.reset():H[u||l.type]&&(Z=H[u||l.type](l,P,A),this.mergeHandlerResult(w,S,Z,U,x),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||H.isActive())&&(I[U]=H)}let F={};for(let U in this._previousActiveHandlers)I[U]||(F[U]=x);this._previousActiveHandlers=I,(Object.keys(F).length||qh(w))&&(this._changes.push([w,S,F]),this._triggerRenderFrame()),(Object.keys(I).length||qh(w))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:B}=w;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(l,u,_,x,w){if(!_)return;t.W(l,_);let S={handlerName:x,originalEvent:_.originalEvent||w};_.zoomDelta!==void 0&&(u.zoom=S),_.panDelta!==void 0&&(u.drag=S),_.pitchDelta!==void 0&&(u.pitch=S),_.bearingDelta!==void 0&&(u.rotate=S)}_applyChanges(){let l={},u={},_={};for(let[x,w,S]of this._changes)x.panDelta&&(l.panDelta=(l.panDelta||new t.P(0,0))._add(x.panDelta)),x.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(l.around=x.around),x.aroundCoord!==void 0&&(l.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(l.pinchAround=x.pinchAround),x.noInertia&&(l.noInertia=x.noInertia),t.W(u,w),t.W(_,S);this._updateMapTransform(l,u,_),this._changes=[]}_updateMapTransform(l,u,_){let x=this._map,w=x.transform,S=re=>[re.x,re.y,re.z];if((re=>{let ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!qh(l)){let re=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),re!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!qh(l))return void this._fireEvents(u,_,!0);let{panDelta:I,zoomDelta:A,bearingDelta:P,pitchDelta:F,around:B,aroundCoord:U,pinchAround:H}=l;w._isCameraConstrained&&(A>0&&(A=0),w._isCameraConstrained=!1),H!==void 0&&(B=H),(A||(re=>u[re]&&!this._eventsInProgress[re])("drag"))&&B&&(this._dragOrigin=S(w.pointCoordinate3D(B)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),B=B||x.transform.centerPoint,P&&(w.bearing+=P),F&&(w.pitch+=F),w._updateCameraState();let q=[0,0,0];if(I)if(w.projection.name==="mercator"){let re=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(B).dir),ae=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(B.sub(I)).dir);q[0]=ae[0]-re[0],q[1]=ae[1]-re[1]}else{let re=w.pointCoordinate(B);if(w.projection.name==="globe"){I=I.rotate(-w.angle);let ae=w._pixelsPerMercatorPixel/w.worldSize;q[0]=-I.x*t.d3(t.ay(re.y))*ae,q[1]=-I.y*t.d3(w.center.lat)*ae}else{let ae=w.pointCoordinate(B.sub(I));re&&ae&&(q[0]=ae.x-re.x,q[1]=ae.y-re.y)}}let Z=w.zoom,X=[0,0,0];if(A){let re=S(U||w.pointCoordinate3D(B)),ae={dir:t._.normalize([],t._.sub([],re,w._camera.position))};if(ae.dir[2]<0){let se=w.zoomDeltaToMovement(re,A);t._.scale(X,ae.dir,se)}}let K=t._.add(q,q,X);w._translateCameraConstrained(K),A&&Math.abs(w.zoom-Z)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(u,_,!0)}_fireEvents(l,u,_){let x=Qc(this._eventsInProgress),w=Qc(l),S={};for(let F in l){let{originalEvent:B}=l[F];this._eventsInProgress[F]||(S[`${F}start`]=B),this._eventsInProgress[F]=l[F]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(let F in S)this._fireEvent(F,S[F]);w&&this._fireEvent("move",w.originalEvent);for(let F in l){let{originalEvent:B}=l[F];this._fireEvent(F,B)}let I={},A;for(let F in this._eventsInProgress){let{handlerName:B,originalEvent:U}=this._eventsInProgress[F];this._handlersById[B].isActive()||(delete this._eventsInProgress[F],A=u[B]||U,I[`${F}end`]=A)}for(let F in I)this._fireEvent(F,I[F]);let P=Qc(this._eventsInProgress);if(_&&(x||w)&&!P){this._updatingCamera=!0;let F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;F?(B(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:A})):(this._map.fire(new t.f("moveend",{originalEvent:A})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,u){this._map.fire(new t.f(l,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new pg("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Fl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class m1 extends t.E{constructor(l,u){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,t.bp(["_renderFrameCallback"],this)}getCenter(){return new t.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(l,u){return this.jumpTo({center:l},u)}panBy(l,u,_){return l=t.P.convert(l).mult(-1),this.panTo(this.transform.center,t.W({offset:l},u),_)}panTo(l,u,_){return this.easeTo(t.W({center:l},u),_)}getZoom(){return this.transform.zoom}setZoom(l,u){return this.jumpTo({zoom:l},u),this}zoomTo(l,u,_){return this.easeTo(t.W({zoom:l},u),_)}zoomIn(l,u){return this.zoomTo(this.getZoom()+1,l,u),this}zoomOut(l,u){return this.zoomTo(this.getZoom()-1,l,u),this}getBearing(){return this.transform.bearing}setBearing(l,u){return this.jumpTo({bearing:l},u),this}getPadding(){return this.transform.padding}setPadding(l,u){return this.jumpTo({padding:l},u),this}rotateTo(l,u,_){return this.easeTo(t.W({bearing:l},u),_)}resetNorth(l,u){return this.rotateTo(0,t.W({duration:1e3},l),u),this}resetNorthPitch(l,u){return this.easeTo(t.W({bearing:0,pitch:0,duration:1e3},l),u),this}snapToNorth(l,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,u):this}getPitch(){return this.transform.pitch}setPitch(l,u){return this.jumpTo({pitch:l},u),this}cameraForBounds(l,u){l=t.ai.convert(l);let _=u&&u.bearing||0,x=u&&u.pitch||0,w=l.getNorthWest(),S=l.getSouthEast();return this._cameraForBounds(this.transform,w,S,_,x,u)}_extendPadding(l){let u={top:0,right:0,bottom:0,left:0};return l==null?t.W({},u,this.transform.padding):typeof l=="number"?{top:l,bottom:l,right:l,left:l}:t.W({},u,l)}_extendCameraOptions(l){return(l=t.W({offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=this._extendPadding(l.padding),l}_minimumAABBFrustumDistance(l,u){let _=u.max[0]-u.min[0],x=u.max[1]-u.min[1];return _/x>l.aspect?_/(2*Math.tan(.5*l.fovX)*l.aspect):x/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,u,_,x,w,S){let I=l.clone(),A=this._extendCameraOptions(S);I.bearing=x,I.pitch=w;let P=t.aI.convert(u),F=t.aI.convert(_),B=.5*(P.lat+F.lat),U=.5*(P.lng+F.lng),H=t.d4(B,U),q=t._.normalize([],H),Z=t._.normalize([],t._.cross([],q,[0,1,0])),X=t._.cross([],Z,q),K=[Z[0],Z[1],Z[2],0,X[0],X[1],X[2],0,q[0],q[1],q[2],0,0,0,0,1],re=[H,t.d4(P.lat,P.lng),t.d4(F.lat,P.lng),t.d4(F.lat,F.lng),t.d4(P.lat,F.lng),t.d4(B,P.lng),t.d4(B,F.lng),t.d4(P.lat,U),t.d4(F.lat,U)],ae=t.b6.fromPoints(re.map(Ze=>[t._.dot(Z,Ze),t._.dot(X,Ze),t._.dot(q,Ze)])),se=t._.transformMat4([],ae.center,K);t._.squaredLength(se)===0&&t._.set(se,0,0,1),t._.normalize(se,se),t._.scale(se,se,t.cD),I.center=t.d5(se);let fe=I.getWorldToCameraMatrix(),me=t.ad.invert(new Float64Array(16),fe);ae=t.b6.applyTransform(ae,t.ad.multiply([],fe,K));let ne=this._extendAABB(ae,I,A,x);if(!ne)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=ne,t._.transformMat4(se,se,fe);let le=.5*(ae.max[2]-ae.min[2]),ce=this._minimumAABBFrustumDistance(I,ae),we=t._.scale([],[0,0,1],le),Oe=t._.add(we,se,we),ue=ce+(I.pitch===0?0:t._.distance(se,Oe)),Re=I.globeCenterInViewSpace,ze=t._.sub([],se,[Re[0],Re[1],Re[2]]);t._.normalize(ze,ze),t._.scale(ze,ze,ue);let Ke=t._.add([],se,ze);t._.transformMat4(Ke,Ke,me);let Je=t.d7/t.cD,Xe=t._.length(Ke),De=t.ax(Math.max(Xe*Je-t.d7,Number.EPSILON),0),Ne=Math.min(I.zoomFromMercatorZAdjusted(De),A.maxZoom);return Ne>.5*(t.b1+t.aU)?(I.setProjection({name:"mercator"}),I.zoom=Ne,this._cameraForBounds(I,u,_,x,w,S)):{center:I.center,zoom:Ne,bearing:x,pitch:w}}_extendAABB(l,u,_,x){let w=.5*((_.padding.left||0)+(_.padding.right||0)),S=.5*((_.padding.top||0)+(_.padding.bottom||0)),I=S,A=w,P=w,F=S,B=u.width-(A+P),U=u.height-(I+F),H=t._.sub([],l.max,l.min),q=Math.min(B/H[0],U/H[1]),Z=Math.min(u.scaleZoom(u.scale*q),_.maxZoom);if(isNaN(Z))return null;let X=u.scale/u.zoomScale(Z),K=new t.b6([l.min[0]-A*X,l.min[1]-F*X,l.min[2]],[l.max[0]+P*X,l.max[1]+I*X,l.max[2]]),re=(typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new t.P(_.offset.x,_.offset.y):t.P.convert(_.offset)).rotate(-t.ab(x));return K.center[0]-=re.x*X,K.center[1]+=re.y*X,K}queryTerrainElevation(l,u){let _=this.transform.elevation;return _?(u=t.W({},{exaggerated:!0},u),_.getAtPoint(t.Y.fromLngLat(l),null,u.exaggerated)):null}_cameraForBounds(l,u,_,x,w,S){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,u,_,x,w,S);let I=l.clone(),A=this._extendCameraOptions(S);I.bearing=x,I.pitch=w;let P=t.aI.convert(u),F=t.aI.convert(_),B=new t.aI(P.lng,F.lat),U=new t.aI(F.lng,P.lat),H=I.project(P),q=I.project(F),Z=this.queryTerrainElevation(P),X=this.queryTerrainElevation(F),K=this.queryTerrainElevation(B),re=this.queryTerrainElevation(U),ae=[[H.x,H.y,Math.min(Z||0,X||0,K||0,re||0)],[q.x,q.y,Math.max(Z||0,X||0,K||0,re||0)]],se=t.b6.fromPoints(ae),fe=I.getWorldToCameraMatrix(),me=t.ad.invert(new Float64Array(16),fe);se=t.b6.applyTransform(se,fe);let ne=this._extendAABB(se,I,A,x);if(!ne)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");se=ne;let le=.5*t._.sub([],se.max,se.min)[2],ce=this._minimumAABBFrustumDistance(I,se),we=[0,0,1,0];t.aA.transformMat4(we,we,fe),t.aA.normalize(we,we);let Oe=t._.scale([],we,ce+le),ue=t._.add([],se.center,Oe);t._.transformMat4(se.center,se.center,me),t._.transformMat4(ue,ue,me);let Re=[se.center[0],se.center[1],ue[2]*I.pixelsPerMeter];t._.scale(Re,Re,1/I.worldSize);let ze=t.d6(Re[0]),Ke=t.ay(Re[1]),Je=Math.min(I._zoomFromMercatorZ(Re[2]),A.maxZoom),Xe=new t.aI(ze,Ke);return I.mercatorFromTransition&&Je<.5*(t.b1+t.aU)?(I.setProjection({name:"globe"}),I.zoom=Je,this._cameraForBounds(I,u,_,x,w,S)):{center:Xe,zoom:Je,bearing:x,pitch:w}}fitBounds(l,u,_){let x=this.cameraForBounds(l,u);return this._fitInternal(x,u,_)}fitScreenCoordinates(l,u,_,x,w){let S=t.P.convert(l),I=t.P.convert(u),A=new t.P(Math.min(S.x,I.x),Math.min(S.y,I.y)),P=new t.P(Math.max(S.x,I.x),Math.max(S.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,I))return this;let F=this.transform.pointLocation3D(A),B=this.transform.pointLocation3D(P),U=this.transform.pointLocation3D(new t.P(A.x,P.y)),H=this.transform.pointLocation3D(new t.P(P.x,A.y)),q=[Math.min(F.lng,B.lng,U.lng,H.lng),Math.min(F.lat,B.lat,U.lat,H.lat)],Z=[Math.max(F.lng,B.lng,U.lng,H.lng),Math.max(F.lat,B.lat,U.lat,H.lat)],X=x&&x.pitch?x.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,q,Z,_,X,x);return this._fitInternal(K,x,w)}_fitInternal(l,u,_){return l?(u=t.W(l,u)).linear?this.easeTo(u,_):this.flyTo(u,_):this}jumpTo(l,u){this.stop();let _=l.preloadOnly?this.transform.clone():this.transform,x=!1,w=!1,S=!1;return"zoom"in l&&_.zoom!==+l.zoom&&(x=!0,_.zoom=+l.zoom),l.center!==void 0&&(_.center=t.aI.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(w=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(S=!0,_.pitch=+l.pitch),l.padding==null||_.isPaddingEqual(l.padding)||(_.padding=l.padding),l.preloadOnly?(this._preloadTiles(_),this):(this.fire(new t.f("movestart",u)).fire(new t.f("move",u)),x&&this.fire(new t.f("zoomstart",u)).fire(new t.f("zoom",u)).fire(new t.f("zoomend",u)),w&&this.fire(new t.f("rotatestart",u)).fire(new t.f("rotate",u)).fire(new t.f("rotateend",u)),S&&this.fire(new t.f("pitchstart",u)).fire(new t.f("pitch",u)).fire(new t.f("pitchend",u)),this.fire(new t.f("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.w(Fl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,u){let _=this.transform;if(!_.projection.supportsFreeCamera)return t.w(Fl),this;this.stop();let x=_.zoom,w=_.pitch,S=_.bearing;_.setFreeCameraOptions(l);let I=x!==_.zoom,A=w!==_.pitch,P=S!==_.bearing;return this.fire(new t.f("movestart",u)).fire(new t.f("move",u)),I&&this.fire(new t.f("zoomstart",u)).fire(new t.f("zoom",u)).fire(new t.f("zoomend",u)),P&&this.fire(new t.f("rotatestart",u)).fire(new t.f("rotate",u)).fire(new t.f("rotateend",u)),A&&this.fire(new t.f("pitchstart",u)).fire(new t.f("pitch",u)).fire(new t.f("pitchend",u)),this.fire(new t.f("moveend",u)),this}easeTo(l,u){this._stop(!1,l.easeId),((l=t.W({offset:[0,0],duration:500,easing:t.d2},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);let _=this.transform,x=this.getZoom(),w=this.getBearing(),S=this.getPitch(),I=this.getPadding(),A="zoom"in l?+l.zoom:x,P="bearing"in l?this._normalizeBearing(l.bearing,w):w,F="pitch"in l?+l.pitch:S,B=this._extendPadding(l.padding),U=t.P.convert(l.offset),H,q,Z;if(_.projection.name==="globe"){let ce=t.Y.fromLngLat(_.center),we=U.rotate(-_.angle);ce.x+=we.x/_.worldSize,ce.y+=we.y/_.worldSize;let Oe=ce.toLngLat(),ue=t.aI.convert(l.center||Oe);this._normalizeCenter(ue),H=_.centerPoint.add(we),q=new t.P(ce.x,ce.y).mult(_.worldSize),Z=new t.P(t.aj(ue.lng),t.ak(ue.lat)).mult(_.worldSize).sub(q)}else{H=_.centerPoint.add(U);let ce=_.pointLocation(H),we=t.aI.convert(l.center||ce);this._normalizeCenter(we),q=_.project(ce),Z=_.project(we).sub(q)}let X=_.zoomScale(A-x),K,re;l.around&&(K=t.aI.convert(l.around),re=_.locationPoint(K));let ae=this._zooming||A!==x,se=this._rotating||w!==P,fe=this._pitching||F!==S,me=!_.isPaddingEqual(B),ne=ce=>we=>{if(ae&&(ce.zoom=t.a2(x,A,we)),se&&(ce.bearing=t.a2(w,P,we)),fe&&(ce.pitch=t.a2(S,F,we)),me&&(ce.interpolatePadding(I,B,we),H=ce.centerPoint.add(U)),K)ce.setLocationAtPoint(K,re);else{let Oe=ce.zoomScale(ce.zoom-x),ue=A>x?Math.min(2,X):Math.max(.5,X),Re=Math.pow(ue,1-we),ze=ce.unproject(q.add(Z.mult(we*Re)).mult(Oe));ce.setLocationAtPoint(ce.renderWorldCopies?ze.wrap():ze,H)}return l.preloadOnly||this._fireMoveEvents(u),ce};if(l.preloadOnly){let ce=this._emulate(ne,l.duration,_);return this._preloadTiles(ce),this}let le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ae,this._rotating=se,this._pitching=fe,this._padding=me,this._easeId=l.easeId,this._prepareEase(u,l.noMoveStart,le),this._ease(ne(_),ce=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(u,ce)},l),this}_prepareEase(l,u,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||_.moving||this.fire(new t.f("movestart",l)),this._zooming&&!_.zooming&&this.fire(new t.f("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new t.f("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new t.f("pitchstart",l))}_fireMoveEvents(l){this.fire(new t.f("move",l)),this._zooming&&this.fire(new t.f("zoom",l)),this._rotating&&this.fire(new t.f("rotate",l)),this._pitching&&this.fire(new t.f("pitch",l))}_afterEase(l,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let _=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new t.f("zoomend",l)),x&&this.fire(new t.f("rotateend",l)),w&&this.fire(new t.f("pitchend",l)),this.fire(new t.f("moveend",l))}flyTo(l,u){if(this._prefersReducedMotion(l)){let Ne=t.ah(l,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Ne,u)}this.stop(),l=t.W({offset:[0,0],speed:1.2,curve:1.42,easing:t.d2},l);let _=this.transform,x=this.getZoom(),w=this.getBearing(),S=this.getPitch(),I=this.getPadding(),A="zoom"in l?t.at(+l.zoom,_.minZoom,_.maxZoom):x,P="bearing"in l?this._normalizeBearing(l.bearing,w):w,F="pitch"in l?+l.pitch:S,B=this._extendPadding(l.padding),U=_.zoomScale(A-x),H=t.P.convert(l.offset),q=_.centerPoint.add(H),Z=_.pointLocation(q),X=t.aI.convert(l.center||Z);this._normalizeCenter(X);let K=_.project(Z),re=_.project(X).sub(K),ae=l.curve,se=Math.max(_.width,_.height),fe=se/U,me=re.mag();if("minZoom"in l){let Ne=t.at(Math.min(l.minZoom,x,A),_.minZoom,_.maxZoom),Ze=se/_.zoomScale(Ne-x);ae=Math.sqrt(Ze/me*2)}let ne=ae*ae;function le(Ne){let Ze=(fe*fe-se*se+(Ne?-1:1)*ne*ne*me*me)/(2*(Ne?fe:se)*ne*me);return Math.log(Math.sqrt(Ze*Ze+1)-Ze)}function ce(Ne){return(Math.exp(Ne)-Math.exp(-Ne))/2}function we(Ne){return(Math.exp(Ne)+Math.exp(-Ne))/2}let Oe=le(0),ue=function(Ne){return we(Oe)/we(Oe+ae*Ne)},Re=function(Ne){return se*((we(Oe)*(ce(Ze=Oe+ae*Ne)/we(Ze))-ce(Oe))/ne)/me;var Ze},ze=(le(1)-Oe)/ae;if(Math.abs(me)<1e-6||!isFinite(ze)){if(Math.abs(se-fe)<1e-6)return this.easeTo(l,u);let Ne=fe<se?-1:1;ze=Math.abs(Math.log(fe/se))/ae,Re=function(){return 0},ue=function(Ze){return Math.exp(Ne*ae*Ze)}}l.duration="duration"in l?+l.duration:1e3*ze/("screenSpeed"in l?+l.screenSpeed/ae:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);let Ke=w!==P,Je=F!==S,Xe=!_.isPaddingEqual(B),De=Ne=>Ze=>{let mt=Ze*ze,_t=1/ue(mt);Ne.zoom=Ze===1?A:x+Ne.scaleZoom(_t),Ke&&(Ne.bearing=t.a2(w,P,Ze)),Je&&(Ne.pitch=t.a2(S,F,Ze)),Xe&&(Ne.interpolatePadding(I,B,Ze),q=Ne.centerPoint.add(H));let St=Ze===1?X:Ne.unproject(K.add(re.mult(Re(mt))).mult(_t));return Ne.setLocationAtPoint(Ne.renderWorldCopies?St.wrap():St,q),Ne._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(u),Ne};if(l.preloadOnly){let Ne=this._emulate(De,l.duration,_);return this._preloadTiles(Ne),this}return this._zooming=!0,this._rotating=Ke,this._pitching=Je,this._padding=Xe,this._prepareEase(u,!1),this._ease(De(_),()=>this._afterEase(u),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(l){}_cancelRenderFrame(l){}_stop(l,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,u)}if(!l){let _=this.handlers;_&&_.stop(!1)}return this}_ease(l,u,_){_.animate===!1||_.duration===0?(l(1),u()):(this._easeStart=t.e.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let l=Math.min((t.e.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,u){l=t.au(l,-180,180);let _=Math.abs(l-u);return Math.abs(l-360-u)<_&&(l-=360),Math.abs(l+360-u)<_&&(l+=360),l}_normalizeCenter(l){let u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;let _=l.lng-u.center.lng;l.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&t.e.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,u,_){let x=Math.ceil(15*u/1e3),w=[],S=l(_.clone());for(let I=0;I<=x;I++){let A=S(I/x);w.push(A.clone())}return w}_preloadTiles(l,u){}}class _y{constructor(l={}){this.options=l,t.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){let u=this.options&&this.options.compact;return this._map=l,this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=L("button","mapboxgl-ctrl-attrib-button",this._container),L("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,u){let _=this._map._getUIString(`AttributionControl.${u}`);l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));let u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.d8.ACCESS_TOKEN}];if(l){let _=u.reduce((x,w,S)=>(w.value&&(x+=`${w.key}=${w.value}${S<u.length-1?"&":""}`),x),"?");l.href=`${t.d8.FEEDBACK_URL}/${_}#${Nh(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){let x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}let u=this._map.style._mergedSourceCaches;for(let x in u){let w=u[x];if(w.used){let S=w.getSource();S.attribution&&l.indexOf(S.attribution)<0&&l.push(S.attribution)}}l.sort((x,w)=>x.length-w.length),l=l.filter((x,w)=>{for(let S=w+1;S<l.length;S++)if(l[S].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));let _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class yy{constructor(){t.bp(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=L("div","mapboxgl-ctrl");let u=L("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(let u in l){let _=l[u].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){let l=this._container.children;if(l.length){let u=l[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class by{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){let u=++this._id;return this._queue.push({callback:l,id:u,cancelled:!1}),u}remove(l){let u=this._currentlyRunning,_=u?this._queue.concat(u):this._queue;for(let x of _)if(x.id===l)return void(x.cancelled=!0)}run(l=0){let u=this._currentlyRunning=this._queue;this._queue=[];for(let _ of u)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function vy(f,l,u){if(f=new t.aI(f.lng,f.lat),l){let _=new t.aI(f.lng-360,f.lat),x=new t.aI(f.lng+360,f.lat),w=360*Math.ceil(Math.abs(f.lng-u.center.lng)/360),S=u.locationPoint(f).distSqr(l),I=l.x<0||l.y<0||l.x>u.width||l.y>u.height;u.locationPoint(_).distSqr(l)<S&&(I||Math.abs(_.lng-u.center.lng)<w)?f=_:u.locationPoint(x).distSqr(l)<S&&(I||Math.abs(x.lng-u.center.lng)<w)&&(f=x)}for(;Math.abs(f.lng-u.center.lng)>180;){let _=u.locationPoint(f);if(_.x>=0&&_.y>=0&&_.x<=u.width&&_.y<=u.height)break;f.lng>u.center.lng?f.lng-=360:f.lng+=360}return f}let mg={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Yh extends t.E{constructor(l,u){if(super(),(l instanceof HTMLElement||u)&&(l=t.W({element:l},u)),t.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=t.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=L("div");let w=41,S=27,I=G("svg",{display:"block",height:w*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${w}`},this._element),A=G("radialGradient",{id:"shadowGradient"},G("defs",{},I));G("stop",{offset:"10%","stop-opacity":.4},A),G("stop",{offset:"100%","stop-opacity":.05},A),G("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),G("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),G("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),G("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=t.P.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});let _=this._element.classList;for(let w in mg)_.remove(`mapboxgl-marker-anchor-${w}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`);let x=l&&l.className?l.className.trim().split(/\s+/):[];_.add(...x),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){let l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=t.aI.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){let x=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){let u=l.code,_=l.charCode||l.keyCode;u!=="Space"&&u!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(l){let u=l.originalEvent.target,_=this._element;this._popup&&(u===_||_.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let l=this._map,u=this._pos;if(!l||!u)return!1;let _=l.unproject(u),x=l.getFreeCameraOptions();if(!x.position)return!1;let w=x.position.toLngLat();return w.distanceTo(_)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){let l=this._map;if(!l)return;let u=this._pos;if(!u||u.x<0||u.x>l.transform.width||u.y<0||u.y>l.transform.height)return void this._clearFadeTimer();let _=l.unproject(u),x;l._showingGlobe()&&t.d9(l.transform,this._lngLat)?x=0:(x=1-l._queryFogOpacity(_),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let l=this._pos;if(!l||!this._map)return;let u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${mg[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){let l=this._pos,u=this._map,_=this.getPitchAlignment();if(!u||!l||_!=="map")return"";if(!u._showingGlobe()){let A=u.getPitch();return A?`rotateX(${A}deg)`:""}let x=t.b0(t.da(u.transform,this._lngLat)),w=l.sub(t.db(u.transform)),S=Math.abs(w.x)+Math.abs(w.y);if(S===0)return"";let I=x/S;return`rotateX(${-w.y*I}deg) rotateY(${w.x*I}deg)`}_calculateZTransform(){let l=this._pos,u=this._map;if(!u||!l)return"";let _=0,x=this.getRotationAlignment();if(x==="map")if(u._showingGlobe()){let w=u.project(new t.aI(this._lngLat.lng,this._lngLat.lat+.001)),S=u.project(new t.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);_=t.b0(Math.atan2(S.y,S.x))-90}else _=-u.getBearing();else if(x==="horizon"){let w=t.$(4,6,u.getZoom()),S=t.db(u.transform);S.y+=w*u.transform.height;let I=l.sub(S),A=t.b0(Math.atan2(I.y,I.x));_=(A>90?A-270:A+90)*(1-w)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);let u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=vy(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),l===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=t.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){let u=this._map;if(!u)return;let _=this._pointerdownPos,x=this._positionDelta;if(_&&x){if(!this._isDragging){let w=this._clickTolerance||u._clickTolerance;if(l.point.dist(_)<w)return;this._isDragging=!0}this._pos=l.point.sub(x),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new t.f("dragstart"))),this.fire(new t.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new t.f("dragend")),this._state="inactive"}_addDragHandler(l){let u=this._map,_=this._pos;u&&_&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(_),this._pointerdownPos=l.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;let u=this._map;return u&&(l?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let fg={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},xy=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ll(f=new t.P(0,0),l="bottom"){if(typeof f=="number"){let u=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(l){case"top":return new t.P(0,f);case"top-left":return new t.P(u,u);case"top-right":return new t.P(-u,u);case"bottom":return new t.P(0,-f);case"bottom-left":return new t.P(u,-u);case"bottom-right":return new t.P(-u,-u);case"left":return new t.P(f,0);case"right":return new t.P(-f,0)}return new t.P(0,0)}return f instanceof t.P||Array.isArray(f)?t.P.convert(f):t.P.convert(f[l]||[0,0])}class wy{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;let u=t.b9((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,u,_){this._start=this.getValue(u),this._end=l,this._startTime=u,this._endTime=u+_}}let Cy={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Sy{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let gg={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},zl={showCompass:!0,showZoom:!0,visualizePitch:!1};class My{constructor(l,u,_=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new ag({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,_&&(this.mousePitch=new Rl({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),t.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(l,u){this.mouseRotate.mousedown(l,u),this.mousePitch&&this.mousePitch.mousedown(l,u),Me()}move(l,u){let _=this.map,x=this.mouseRotate.mousemoveWindow(l,u),w=x&&x.bearingDelta;if(w&&_.setBearing(_.getBearing()+w),this.mousePitch){let S=this.mousePitch.mousemoveWindow(l,u),I=S&&S.pitchDelta;I&&_.setPitch(_.getPitch()+I)}}off(){let l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Te(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(t.W({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),dt(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,dt(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=bt(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=bt(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Bl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ty={maxWidth:100,unit:"metric"},kp={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:t.dt,supported:b,setRTLTextPlugin:t.dv,getRTLTextPluginStatus:t.dw,Map:class extends m1{constructor(f){t.dc.mark(t.dd.create);let l=f;if((f=t.W({},gg,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&t.de(window)&&(f.antialias=!1,t.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ja(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new by,this._domRenderTaskQueue=new by,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.df(),this._locale=t.W({},Cy,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new wy(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new t.dg(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?kt({},f.contextCreateOptions):{},typeof f.container=="string"){let u=document.getElementById(f.container);if(!u)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=u}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&t.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),t.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Sy),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new gy(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||t.d8.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new u1(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){l.center==null&&l.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});let u=f.bounds;u&&(this.resize(),this.fitBounds(u,t.W({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new _y({customAttribution:f.customAttribution})),this._logoControl=new yy,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new t.f(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new t.f(`${u.dataType}dataloading`,u))})}_getMapId(){return this._mapId}addControl(f,l){if(l===void 0&&(l=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new t.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let u=f.onAdd(this);this._controls.push(f);let _=this._controlPositions[l];return l.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new t.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let l=this._controls.indexOf(f);return l>-1&&this._controls.splice(l,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let l=!this._moving;return l&&this.fire(new t.f("movestart",f)).fire(new t.f("move",f)),this.fire(new t.f("resize",f)),l&&this.fire(new t.f("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(t.ai.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new t.f("zoomstart")).fire(new t.f("zoom")).fire(new t.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new t.f("zoomstart")).fire(new t.f("zoom")).fire(new t.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new t.f("pitchstart")).fire(new t.f("pitch")).fire(new t.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new t.f("pitchstart")).fire(new t.f("pitch")).fire(new t.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(l=>l==="auto"?navigator.language:l):f}setLanguage(f){let l=this._parseLanguage(f);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(let u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let f=this.transform,l=f.projection.name,u;l==="globe"&&f.zoom>=t.aU?(f.setMercatorFromTransition(),u=!0):l==="mercator"&&f.zoom<t.aU&&(f.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,l){return this._updateProjection(f||l||{name:"mercator"})}_updateProjection(f){let l;return l=f.name==="globe"&&this.transform.zoom>=t.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),l&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(t.aI.convert(f))}unproject(f){return this.transform.pointLocation3D(t.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,l,u){if(f==="mouseenter"||f==="mouseover"){let _=!1,x=S=>{let I=l.filter(P=>this.getLayer(P)),A=I.length?this.queryRenderedFeatures(S.point,{layers:I}):[];A.length?_||(_=!0,u.call(this,new Fr(f,this,S.originalEvent,{features:A}))):_=!1},w=()=>{_=!1};return{layers:new Set(l),listener:u,delegates:{mousemove:x,mouseout:w}}}if(f==="mouseleave"||f==="mouseout"){let _=!1,x=S=>{let I=l.filter(A=>this.getLayer(A));(I.length?this.queryRenderedFeatures(S.point,{layers:I}):[]).length?_=!0:_&&(_=!1,u.call(this,new Fr(f,this,S.originalEvent)))},w=S=>{_&&(_=!1,u.call(this,new Fr(f,this,S.originalEvent)))};return{layers:new Set(l),listener:u,delegates:{mousemove:x,mouseout:w}}}{let _=x=>{let w=l.filter(I=>this.getLayer(I)),S=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];S.length&&(x.features=S,u.call(this,x),delete x.features)};return{layers:new Set(l),listener:u,delegates:{[f]:_}}}}on(f,l,u){if(typeof l=="function"||u===void 0)return super.on(f,l);if(Array.isArray(l)||(l=[l]),l){for(let x of l)if(!this._isValidId(x))return this}let _=this._createDelegatedListener(f,l,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(_);for(let x in _.delegates)this.on(x,_.delegates[x]);return this}once(f,l,u){if(typeof l=="function"||u===void 0)return super.once(f,l);if(Array.isArray(l)||(l=[l]),l){for(let x of l)if(!this._isValidId(x))return this}let _=this._createDelegatedListener(f,l,u);for(let x in _.delegates)this.once(x,_.delegates[x]);return this}off(f,l,u){if(typeof l=="function"||u===void 0)return super.off(f,l);let _=new Set(Array.isArray(l)?l:[l]);for(let S of _)if(!this._isValidId(S))return this;let x=(S,I)=>{if(S.size!==I.size)return!1;for(let A of S)if(!I.has(A))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[f]:void 0;return w&&(S=>{for(let I=0;I<S.length;I++){let A=S[I];if(A.listener===u&&x(A.layers,_)){for(let P in A.delegates)this.off(P,A.delegates[P]);return S.splice(I,1),this}}})(w),this}queryRenderedFeatures(f,l){if(!this.style)return[];if(l!==void 0||f===void 0||f instanceof t.P||Array.isArray(f)||(l=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],(l=l||{}).layers&&Array.isArray(l.layers)){for(let u of l.layers)if(!this._isValidId(u))return[]}return this.style.queryRenderedFeatures(f,l,this.transform)}querySourceFeatures(f,l){return this._isValidId(f)?this.style.querySourceFeatures(f,l):[]}isPointOnSurface(f){let{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&t.w(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.P.convert(f))}setStyle(f,l){return l=t.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l),this.style&&f&&l.diff!==!1&&l.localFontFamily===this._localFontFamily&&l.localIdeographFontFamily===this._localIdeographFontFamily&&!l.config?(this.style._diffStyle(f,(u,_)=>{u?(t.w(`Unable to perform style diff: ${String(u.message||u.error||u)}. Rebuilding the style from scratch.`),this._updateStyle(f,l)):_&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(f,l))}_getUIString(f){let l=this._locale[f];if(l==null)throw new Error(`Missing UI string '${f}'`);return l}_updateStyle(f,l){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){let u=t.W({},l);l&&l.config&&(u.initialConfig=l.config,delete u.config),this.style=new Sa(this,u).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Sa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new t.d(new Error("IDs can't be empty."))),!1):!t.cV(f)||(this.fire(new t.d(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}addSource(f,l){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,l),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,l,u){this._lazyInitEmptyStyle(),this.style.addSourceType(f,l,u)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,l,{pixelRatio:u=1,sdf:_=!1,stretchX:x,stretchY:w,content:S}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){let{width:I,height:A,data:P}=t.e.getImageData(l);this.style.addImage(f,{data:new t.i({width:I,height:A},P),pixelRatio:u,stretchX:x,stretchY:w,content:S,sdf:_,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new t.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:I,height:A}=l,P=l;this.style.addImage(f,{data:new t.i({width:I,height:A},new Uint8Array(P.data)),pixelRatio:u,stretchX:x,stretchY:w,content:S,sdf:_,version:0,userImage:P}),P.onAdd&&P.onAdd(this,f)}}updateImage(f,l){this._lazyInitEmptyStyle();let u=this.style.getImage(f);if(!u)return void this.fire(new t.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?t.e.getImageData(l):l,{width:x,height:w,data:S}=_;if(x===void 0||w===void 0)return void this.fire(new t.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==u.data.width||w!==u.data.height)return void this.fire(new t.d(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));let I=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);u.data.replace(S,I),this.style.updateImage(f,u)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new t.d(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,l){t.h(this._requestManager.transformRequest(f,t.R.Image),(u,_)=>{l(u,_ instanceof HTMLImageElement?t.e.getImageData(_):_)})}listImages(){return this.style.listImages()}addModel(f,l){this._lazyInitEmptyStyle(),this.style.addModel(f,l)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new t.d(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,l){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,l),this._update(!0)):this}getSlot(f){let l=this.getLayer(f);return l&&l.slot||null}setSlot(f,l){return this.style.setSlot(f,l),this.style.mergeLayers(),this._update(!0)}addImport(f,l){return this.style.addImport(f,l),this}updateImport(f,l){return typeof l!="string"&&l.id!==f?(this.removeImport(f),this.addImport(l)):(this.style.updateImport(f,l),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,l){return this.style.moveImport(f,l),this._update(!0)}moveLayer(f,l){return this._isValidId(f)?(this.style.moveLayer(f,l),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){return this._isValidId(f)?this.style.getOwnLayer(f):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,l,u){return this._isValidId(f)?(this.style.setLayerZoomRange(f,l,u),this._update(!0)):this}setFilter(f,l,u={}){return this._isValidId(f)?(this.style.setFilter(f,l,u),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,l,u,_={}){return this._isValidId(f)?(this.style.setPaintProperty(f,l,u,_),this._update(!0)):this}getPaintProperty(f,l){return this._isValidId(f)?this.style.getPaintProperty(f,l):null}setLayoutProperty(f,l,u,_={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,l,u,_),this._update(!0)):this}getLayoutProperty(f,l){return this._isValidId(f)?this.style.getLayoutProperty(f,l):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,l){return this.style.setSchema(f,l),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,l){return this.style.setConfig(f,l),this._update(!0)}getConfigProperty(f,l){return this.style.getConfigProperty(f,l)}setConfigProperty(f,l,u){return this.style.setConfigProperty(f,l,u),this._update(!0)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){let l=f[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.aI.convert(f),this.transform):0}setFeatureState(f,l){return this._isValidId(f.source)?(this.style.setFeatureState(f,l),this._update()):this}removeFeatureState(f,l){return this._isValidId(f.source)?(this.style.removeFeatureState(f,l),this._update()):this}getFeatureState(f){return this._isValidId(f.source)?this.style.getFeatureState(f):null}_updateContainerDimensions(){if(!this._container)return;let f=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300,u,_,x,w=this._container;for(;w&&(!_||!x);){let S=window.getComputedStyle(w).transform;S&&S!=="none"&&(u=S.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(_=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(x=u[3])),w=w.parentElement}this._containerWidth=_?Math.abs(f/_):f,this._containerHeight=x?Math.abs(l/x):l}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&t.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=L("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();let l=this._canvasContainer=L("div","mapboxgl-canvas-container",f);this._canvas=L("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let u=this._controlContainer=L("div","mapboxgl-control-container",f),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=L("div",`mapboxgl-ctrl-${x}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,l){let u=t.e.devicePixelRatio||1;this._canvas.width=u*Math.ceil(f),this._canvas.height=u*Math.ceil(l),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${l}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){let l=this._markers.indexOf(f);l!==-1&&this._markers.splice(l,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){let l=this._popups.indexOf(f);l!==-1&&this._popups.splice(l,1)}_setupPainter(){let f=t.W({},b.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",f);l?(t.dh(l,!0),this.painter=new Q0(l,this._contextCreateOptions,this.transform,this._tp),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),t.di.testSupport(l)):this.fire(new t.d(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.f("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new t.f("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let l;this.fire(new t.f("renderstart")),++this._frameId;let u=this.painter.context.extTimerQuery,_=t.e.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=x.createQuery(),x.beginQuery(u.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();let w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let P=this.transform.zoom,F=this.transform.pitch,B=t.e.now(),U=new t.X(P,{now:B,fadeDuration:w,pitch:F,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(_),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(_);let I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource);if(I&&(this._placementDirty=I.needsRerender,this._occlusionOpacityChanged=I.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.dc.mark(t.dd.load),this.fire(new t.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){let P=t.e.now()-_;x.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{let F=x.getQueryParameter(l,x.QUERY_RESULT)/1e6;x.deleteQuery(l),this.fire(new t.f("gpu-timing-frame",{cpuTime:P,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){let P=this.painter.collectGpuTimers();setTimeout(()=>{let F=this.painter.queryGpuTimers(P);this.fire(new t.f("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){let P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let F=this.painter.queryGpuTimeDeferredRender(P);this.fire(new t.f("gpu-timing-deferred-render",{gpuTime:F}))},50)}let A=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||S;if((this._sourcesDirty||this._styleDirty||S||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),A||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let P=!this.isMoving()&&this.loaded();if(P&&(S=this._updateAverageElevation(_,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new t.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let F=this._calculateSpeedIndex();this.fire(new t.f("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!A&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,t.dc.mark(t.dd.fullLoad),this._performanceMetricsCollection&&t.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(let l of this._markers)f&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(let l of this._popups)!f||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(f,l=!1){let u=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);let _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(l||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){let x=this.transform.averageElevation,w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=f;let S=Math.abs(x-w);if(S>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(w),u(w);this._averageElevation.easeTo(w,f,300)}else if(S>1e-4)return this._averageElevation.jumpTo(w),u(w)}return!!this._averageElevation.isEasing(f)&&u(this._averageElevation.getValue(f))}_authenticate(){t.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===t.dl||f.status===401)){let l=this.painter.context.gl;t.dh(l,!1),this._logoControl instanceof yy&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),t.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&t.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){let f=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());let u=this.painter.context.gl,_=u.createFramebuffer();function x(w){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,w,0);let S=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,S),S}return u.bindFramebuffer(u.FRAMEBUFFER,_),this._canvasPixelComparison(x(f),l.canvasCopies.map(x),l.timeStamps)}_canvasPixelComparison(f,l,u){let _=u[1]-u[0],x=f.length/4;for(let w=0;w<l.length;w++){let S=l[w],I=0;for(let A=0;A<S.length;A+=4)S[A]===f[A]&&S[A+1]===f[A+1]&&S[A+2]===f[A+2]&&S[A+3]===f[A+3]&&(I+=1);_+=(u[w+2]-u[w+1])*(1-I/x)}return _}remove(){this._hash&&this._hash.remove();for(let l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),t.dp(this.painter.context.gl),t.dq.remove(),t.dr.remove(),this._removed=!0,this.fire(new t.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=t.e.frame(l=>{let u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(l)}))}_preloadTiles(f){let l=this.style?this.style.getSourceCaches():[];return t.ds(l,(u,_)=>u._preloadTiles(f,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,l){t.du(f,l)}_occlusionCriteriaSatisfied(){let f=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&f&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return t.dt}},NavigationControl:class{constructor(f){this.options=t.W({},zl,f),this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(t.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),L("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),L("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{let u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:l}):u.resetNorth({},{originalEvent:l}))}),this._compassIcon=L("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let f=this._map;if(!f)return;let l=f.getZoom(),u=l===f.getMaxZoom(),_=l===f.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){let f=this._map;if(!f)return;let l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new My(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){let f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,l){let u=L("button",f,this._container);return u.type="button",u.addEventListener("click",l),u}_setButtonTitle(f,l){if(!this._map)return;let u=this._map._getUIString(`NavigationControl.${l}`);f.setAttribute("aria-label",u),f.firstElementChild&&f.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends t.E{constructor(f){super();let l=navigator.geolocation;this.options=t.W({geolocation:l},Bl,f),t.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ig(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){let l=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,f(u)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>l(u.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(f){let l=this._map.getMaxBounds(),u=f.coords;return!!l&&(u.longitude<l.getWest()||u.longitude>l.getEast()||u.latitude<l.getSouth()||u.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new t.f("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.f("geolocate",f)),this._finish()}}_updateCamera(f){let l=new t.aI(f.coords.longitude,f.coords.latitude),u=f.coords.accuracy,_=this._map.getBearing(),x=t.W({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(u),x,{geolocateSource:!0})}_updateMarker(f){if(f){let l=new t.aI(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let f=this._map.transform,l=t.ax(1,f._center.lat)*f.worldSize,u=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.f("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=L("button","mapboxgl-ctrl-geolocate",this._container),L("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");let l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{let l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L("div","mapboxgl-user-location"),this._dotElement.appendChild(L("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(L("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Yh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=L("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.f("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:_y,ScaleControl:class{constructor(f){this.options=t.W({},Ty,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),t.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let f=this.options.maxWidth||100,l=this._map,u=l._containerHeight/2,_=l._containerWidth/2-f/2,x=l.unproject([_,u]),w=l.unproject([_+f,u]),S=x.distanceTo(w);if(this.options.unit==="imperial"){let I=3.2808*S;I>5280?this._setScale(f,I/5280,"mile"):this._setScale(f,I,"foot")}else this.options.unit==="nautical"?this._setScale(f,S/1852,"nautical-mile"):S>=1e3?this._setScale(f,S/1e3,"kilometer"):this._setScale(f,S,"meter")}_setScale(f,l,u){this._map._requestDomTask(()=>{let _=function(w){let S=Math.pow(10,`${Math.floor(w)}`.length-1),I=w/S;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(A){let P=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*P)/P}(I),S*I}(l),x=_/l;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(_):`${_}&nbsp;${kp[u]}`,this._container.style.width=f*x+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:t.w("Full screen control 'container' must be a DOM element.")),t.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let f=this._fullscreenButton=L("button","mapboxgl-ctrl-fullscreen",this._controlContainer);L("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.E{constructor(f){super(),this.options=t.W(Object.create(fg),f),t.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new t.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new t.f("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=t.aI.convert(f),this._pos=null,this._trackPointer=!1,this._update();let l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){let l=document.createDocumentFragment(),u=document.createElement("body"),_;for(u.innerHTML=f;_=u.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=L("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(f),this.options.closeButton){let u=this._closeButton=L("button","mapboxgl-popup-close-button",l);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let l;return this._classList.delete(f)?l=!1:(this._classList.add(f),l=!0),this._updateClassList(),l}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;let l=this._map,u=this._container,_=this._pos;if(!l||!u||!_)return"bottom";let x=u.offsetWidth,w=u.offsetHeight,S=_.x<x/2,I=_.x>l.transform.width-x/2;if(_.y+f<w)return S?"top-left":I?"top-right":"top";if(_.y>l.transform.height-w){if(S)return"bottom-left";if(I)return"bottom-right"}return S?"left":I?"right":"bottom"}_updateClassList(){let f=this._container;if(!f)return;let l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),f.className=l.join(" ")}_update(f){let l=this._map,u=this._content;if(!l||!this._lngLat&&!this._trackPointer||!u)return;let _=this._container;if(_||(_=this._container=L("div","mapboxgl-popup",l.getContainer()),this._tip=L("div","mapboxgl-popup-tip",_),_.appendChild(u)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=vy(this._lngLat,this._pos,l.transform)),!this._trackPointer||f){let x=this._pos=this._trackPointer&&f?f:l.project(this._lngLat),w=Ll(this.options.offset),S=this._anchor=this._getAnchor(w.y),I=Ll(this.options.offset,S),A=x.add(I).round();l._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${mg[S]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&l._showingGlobe()){let x=t.d9(l.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(xy);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Yh,Style:Sa,LngLat:t.aI,LngLatBounds:t.ai,Point:t.P,MercatorCoordinate:t.Y,FreeCameraOptions:xf,Evented:t.E,config:t.d8,prewarm:t.dx,clearPrewarmedResources:t.dy,get accessToken(){return t.d8.ACCESS_TOKEN},set accessToken(f){t.d8.ACCESS_TOKEN=f},get baseApiUrl(){return t.d8.API_URL},set baseApiUrl(f){t.d8.API_URL=f},get workerCount(){return t.dz.workerCount},set workerCount(f){t.dz.workerCount=f},get maxParallelImageRequests(){return t.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){t.d8.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){t.dA(f)},get workerUrl(){return t.dB.workerUrl},set workerUrl(f){t.dB.workerUrl=f},get workerClass(){return t.dB.workerClass},set workerClass(f){t.dB.workerClass=f},get workerParams(){return t.dB.workerParams},set workerParams(f){t.dB.workerParams=f},get dracoUrl(){return t.dC()},set dracoUrl(f){t.dD(f)},get meshoptUrl(){return t.dE()},set meshoptUrl(f){t.dF(f)},setNow:t.e.setNow,restoreNow:t.e.restoreNow}});var s=d;return s})});var g_=class{},Yb=class{},_u=class a{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(d=>{let r=d.indexOf(":");if(r>0){let s=d.slice(0,r),t=s.toLowerCase(),g=d.slice(r+1).trim();this.maybeSetNormalizedName(s,t),this.headers.has(t)?this.headers.get(t).push(g):this.headers.set(t,[g])}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((d,r)=>{this.setHeaderEntries(r,d)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([d,r])=>{this.setHeaderEntries(d,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let d=this.headers.get(n.toLowerCase());return d&&d.length>0?d[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,d){return this.clone({name:n,value:d,op:"a"})}set(n,d){return this.clone({name:n,value:d,op:"s"})}delete(n,d){return this.clone({name:n,value:d,op:"d"})}maybeSetNormalizedName(n,d){this.normalizedNames.has(d)||this.normalizedNames.set(d,n)}init(){this.lazyInit&&(this.lazyInit instanceof a?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(d=>{this.headers.set(d,n.headers.get(d)),this.normalizedNames.set(d,n.normalizedNames.get(d))})}clone(n){let d=new a;return d.lazyInit=this.lazyInit&&this.lazyInit instanceof a?this.lazyInit:this,d.lazyUpdate=(this.lazyUpdate||[]).concat([n]),d}applyUpdate(n){let d=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(n.name,d);let s=(n.op==="a"?this.headers.get(d):void 0)||[];s.push(...r),this.headers.set(d,s);break;case"d":let t=n.value;if(!t)this.headers.delete(d),this.normalizedNames.delete(d);else{let g=this.headers.get(d);if(!g)return;g=g.filter(b=>t.indexOf(b)===-1),g.length===0?(this.headers.delete(d),this.normalizedNames.delete(d)):this.headers.set(d,g)}break}}setHeaderEntries(n,d){let r=(Array.isArray(d)?d:[d]).map(t=>t.toString()),s=n.toLowerCase();this.headers.set(s,r),this.maybeSetNormalizedName(n,s)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(d=>n(this.normalizedNames.get(d),this.headers.get(d)))}};var EC=class{encodeKey(n){return mk(n)}encodeValue(n){return mk(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}};function OB(a,n){let d=new Map;return a.length>0&&a.replace(/^\?/,"").split("&").forEach(s=>{let t=s.indexOf("="),[g,b]=t==-1?[n.decodeKey(s),""]:[n.decodeKey(s.slice(0,t)),n.decodeValue(s.slice(t+1))],M=d.get(g)||[];M.push(b),d.set(g,M)}),d}var RB=/%(\d[a-f0-9])/gi,FB={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function mk(a){return encodeURIComponent(a).replace(RB,(n,d)=>FB[d]??n)}function qb(a){return`${a}`}var Ld=class a{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new EC,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=OB(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(d=>{let r=n.fromObject[d],s=Array.isArray(r)?r.map(qb):[qb(r)];this.map.set(d,s)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();let d=this.map.get(n);return d?d[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,d){return this.clone({param:n,value:d,op:"a"})}appendAll(n){let d=[];return Object.keys(n).forEach(r=>{let s=n[r];Array.isArray(s)?s.forEach(t=>{d.push({param:r,value:t,op:"a"})}):d.push({param:r,value:s,op:"a"})}),this.clone(d)}set(n,d){return this.clone({param:n,value:d,op:"s"})}delete(n,d){return this.clone({param:n,value:d,op:"d"})}toString(){return this.init(),this.keys().map(n=>{let d=this.encoder.encodeKey(n);return this.map.get(n).map(r=>d+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>n!=="").join("&")}clone(n){let d=new a({encoder:this.encoder});return d.cloneFrom=this.cloneFrom||this,d.updates=(this.updates||[]).concat(n),d}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":let d=(n.op==="a"?this.map.get(n.param):void 0)||[];d.push(qb(n.value)),this.map.set(n.param,d);break;case"d":if(n.value!==void 0){let r=this.map.get(n.param)||[],s=r.indexOf(qb(n.value));s!==-1&&r.splice(s,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}else{this.map.delete(n.param);break}}}),this.cloneFrom=this.updates=null)}};var DC=class{constructor(){this.map=new Map}set(n,d){return this.map.set(n,d),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}};function LB(a){switch(a){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function fk(a){return typeof ArrayBuffer<"u"&&a instanceof ArrayBuffer}function gk(a){return typeof Blob<"u"&&a instanceof Blob}function _k(a){return typeof FormData<"u"&&a instanceof FormData}function zB(a){return typeof URLSearchParams<"u"&&a instanceof URLSearchParams}var f_=class a{constructor(n,d,r,s){this.url=d,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase();let t;if(LB(this.method)||s?(this.body=r!==void 0?r:null,t=s):t=r,t&&(this.reportProgress=!!t.reportProgress,this.withCredentials=!!t.withCredentials,t.responseType&&(this.responseType=t.responseType),t.headers&&(this.headers=t.headers),t.context&&(this.context=t.context),t.params&&(this.params=t.params),this.transferCache=t.transferCache),this.headers??=new _u,this.context??=new DC,!this.params)this.params=new Ld,this.urlWithParams=d;else{let g=this.params.toString();if(g.length===0)this.urlWithParams=d;else{let b=d.indexOf("?"),M=b===-1?"?":b<d.length-1?"&":"";this.urlWithParams=d+M+g}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||fk(this.body)||gk(this.body)||_k(this.body)||zB(this.body)?this.body:this.body instanceof Ld?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||_k(this.body)?null:gk(this.body)?this.body.type||null:fk(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Ld?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(n={}){let d=n.method||this.method,r=n.url||this.url,s=n.responseType||this.responseType,t=n.transferCache??this.transferCache,g=n.body!==void 0?n.body:this.body,b=n.withCredentials??this.withCredentials,M=n.reportProgress??this.reportProgress,k=n.headers||this.headers,L=n.params||this.params,G=n.context??this.context;return n.setHeaders!==void 0&&(k=Object.keys(n.setHeaders).reduce((J,oe)=>J.set(oe,n.setHeaders[oe]),k)),n.setParams&&(L=Object.keys(n.setParams).reduce((J,oe)=>J.set(oe,n.setParams[oe]),L)),new a(d,r,g,{params:L,headers:k,context:G,reportProgress:M,responseType:s,withCredentials:b,transferCache:t})}},fm=function(a){return a[a.Sent=0]="Sent",a[a.UploadProgress=1]="UploadProgress",a[a.ResponseHeader=2]="ResponseHeader",a[a.DownloadProgress=3]="DownloadProgress",a[a.Response=4]="Response",a[a.User=5]="User",a}(fm||{}),__=class{constructor(n,d=Kb.Ok,r="OK"){this.headers=n.headers||new _u,this.status=n.status!==void 0?n.status:d,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}},kC=class a extends __{constructor(n={}){super(n),this.type=fm.ResponseHeader}clone(n={}){return new a({headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Zb=class a extends __{constructor(n={}){super(n),this.type=fm.Response,this.body=n.body!==void 0?n.body:null}clone(n={}){return new a({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Xb=class extends __{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${n.url||"(unknown url)"}`:this.message=`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}},Kb=function(a){return a[a.Continue=100]="Continue",a[a.SwitchingProtocols=101]="SwitchingProtocols",a[a.Processing=102]="Processing",a[a.EarlyHints=103]="EarlyHints",a[a.Ok=200]="Ok",a[a.Created=201]="Created",a[a.Accepted=202]="Accepted",a[a.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",a[a.NoContent=204]="NoContent",a[a.ResetContent=205]="ResetContent",a[a.PartialContent=206]="PartialContent",a[a.MultiStatus=207]="MultiStatus",a[a.AlreadyReported=208]="AlreadyReported",a[a.ImUsed=226]="ImUsed",a[a.MultipleChoices=300]="MultipleChoices",a[a.MovedPermanently=301]="MovedPermanently",a[a.Found=302]="Found",a[a.SeeOther=303]="SeeOther",a[a.NotModified=304]="NotModified",a[a.UseProxy=305]="UseProxy",a[a.Unused=306]="Unused",a[a.TemporaryRedirect=307]="TemporaryRedirect",a[a.PermanentRedirect=308]="PermanentRedirect",a[a.BadRequest=400]="BadRequest",a[a.Unauthorized=401]="Unauthorized",a[a.PaymentRequired=402]="PaymentRequired",a[a.Forbidden=403]="Forbidden",a[a.NotFound=404]="NotFound",a[a.MethodNotAllowed=405]="MethodNotAllowed",a[a.NotAcceptable=406]="NotAcceptable",a[a.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",a[a.RequestTimeout=408]="RequestTimeout",a[a.Conflict=409]="Conflict",a[a.Gone=410]="Gone",a[a.LengthRequired=411]="LengthRequired",a[a.PreconditionFailed=412]="PreconditionFailed",a[a.PayloadTooLarge=413]="PayloadTooLarge",a[a.UriTooLong=414]="UriTooLong",a[a.UnsupportedMediaType=415]="UnsupportedMediaType",a[a.RangeNotSatisfiable=416]="RangeNotSatisfiable",a[a.ExpectationFailed=417]="ExpectationFailed",a[a.ImATeapot=418]="ImATeapot",a[a.MisdirectedRequest=421]="MisdirectedRequest",a[a.UnprocessableEntity=422]="UnprocessableEntity",a[a.Locked=423]="Locked",a[a.FailedDependency=424]="FailedDependency",a[a.TooEarly=425]="TooEarly",a[a.UpgradeRequired=426]="UpgradeRequired",a[a.PreconditionRequired=428]="PreconditionRequired",a[a.TooManyRequests=429]="TooManyRequests",a[a.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",a[a.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",a[a.InternalServerError=500]="InternalServerError",a[a.NotImplemented=501]="NotImplemented",a[a.BadGateway=502]="BadGateway",a[a.ServiceUnavailable=503]="ServiceUnavailable",a[a.GatewayTimeout=504]="GatewayTimeout",a[a.HttpVersionNotSupported=505]="HttpVersionNotSupported",a[a.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",a[a.InsufficientStorage=507]="InsufficientStorage",a[a.LoopDetected=508]="LoopDetected",a[a.NotExtended=510]="NotExtended",a[a.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",a}(Kb||{});function IC(a,n){return{body:n,headers:a.headers,context:a.context,observe:a.observe,params:a.params,reportProgress:a.reportProgress,responseType:a.responseType,withCredentials:a.withCredentials,transferCache:a.transferCache}}var nn=(()=>{let n=class n{constructor(r){this.handler=r}request(r,s,t={}){let g;if(r instanceof f_)g=r;else{let k;t.headers instanceof _u?k=t.headers:k=new _u(t.headers);let L;t.params&&(t.params instanceof Ld?L=t.params:L=new Ld({fromObject:t.params})),g=new f_(r,s,t.body!==void 0?t.body:null,{headers:k,context:t.context,params:L,reportProgress:t.reportProgress,responseType:t.responseType||"json",withCredentials:t.withCredentials,transferCache:t.transferCache})}let b=Jt(g).pipe(Td(k=>this.handler.handle(k)));if(r instanceof f_||t.observe==="events")return b;let M=b.pipe(wr(k=>k instanceof Zb));switch(t.observe||"body"){case"body":switch(g.responseType){case"arraybuffer":return M.pipe(pn(k=>{if(k.body!==null&&!(k.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return k.body}));case"blob":return M.pipe(pn(k=>{if(k.body!==null&&!(k.body instanceof Blob))throw new Error("Response is not a Blob.");return k.body}));case"text":return M.pipe(pn(k=>{if(k.body!==null&&typeof k.body!="string")throw new Error("Response is not a string.");return k.body}));case"json":default:return M.pipe(pn(k=>k.body))}case"response":return M;default:throw new Error(`Unreachable: unhandled observe type ${t.observe}}`)}}delete(r,s={}){return this.request("DELETE",r,s)}get(r,s={}){return this.request("GET",r,s)}head(r,s={}){return this.request("HEAD",r,s)}jsonp(r,s){return this.request("JSONP",r,{params:new Ld().append(s,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,s={}){return this.request("OPTIONS",r,s)}patch(r,s,t={}){return this.request("PATCH",r,IC(t,s))}post(r,s,t={}){return this.request("POST",r,IC(t,s))}put(r,s,t={}){return this.request("PUT",r,IC(t,s))}};n.\u0275fac=function(s){return new(s||n)(Ye(g_))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})();function xk(a,n){return n(a)}function BB(a,n){return(d,r)=>n.intercept(d,{handle:s=>a(s,r)})}function NB(a,n,d){return(r,s)=>il(d,()=>n(r,t=>a(t,s)))}var VB=new Qt(""),AC=new Qt(""),jB=new Qt(""),UB=new Qt("");function HB(){let a=null;return(n,d)=>{a===null&&(a=(Nt(VB,{optional:!0})??[]).reduceRight(BB,xk));let r=Nt(c_),s=r.add();return a(n,d).pipe(pu(()=>r.remove(s)))}}var yk=(()=>{let n=class n extends g_{constructor(r,s){super(),this.backend=r,this.injector=s,this.chain=null,this.pendingTasks=Nt(c_);let t=Nt(UB,{optional:!0});this.backend=t??r}handle(r){if(this.chain===null){let t=Array.from(new Set([...this.injector.get(AC),...this.injector.get(jB,[])]));this.chain=t.reduceRight((g,b)=>NB(g,b,this.injector),xk)}let s=this.pendingTasks.add();return this.chain(r,t=>this.backend.handle(t)).pipe(pu(()=>this.pendingTasks.remove(s)))}};n.\u0275fac=function(s){return new(s||n)(Ye(Yb),Ye(Dd))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})();var WB=/^\)\]\}',?\n/;function GB(a){return"responseURL"in a&&a.responseURL?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):null}var bk=(()=>{let n=class n{constructor(r){this.xhrFactory=r}handle(r){if(r.method==="JSONP")throw new $n(-2800,!1);let s=this.xhrFactory;return(s.\u0275loadImpl?oo(s.\u0275loadImpl()):Jt(null)).pipe(ur(()=>new Ro(g=>{let b=s.build();if(b.open(r.method,r.urlWithParams),r.withCredentials&&(b.withCredentials=!0),r.headers.forEach((Te,He)=>b.setRequestHeader(Te,He.join(","))),r.headers.has("Accept")||b.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){let Te=r.detectContentTypeHeader();Te!==null&&b.setRequestHeader("Content-Type",Te)}if(r.responseType){let Te=r.responseType.toLowerCase();b.responseType=Te!=="json"?Te:"text"}let M=r.serializeBody(),k=null,L=()=>{if(k!==null)return k;let Te=b.statusText||"OK",He=new _u(b.getAllResponseHeaders()),We=GB(b)||r.url;return k=new kC({headers:He,status:b.status,statusText:Te,url:We}),k},G=()=>{let{headers:Te,status:He,statusText:We,url:dt}=L(),bt=null;He!==Kb.NoContent&&(bt=typeof b.response>"u"?b.responseText:b.response),He===0&&(He=bt?Kb.Ok:0);let ft=He>=200&&He<300;if(r.responseType==="json"&&typeof bt=="string"){let It=bt;bt=bt.replace(WB,"");try{bt=bt!==""?JSON.parse(bt):null}catch(Wt){bt=It,ft&&(ft=!1,bt={error:Wt,text:bt})}}ft?(g.next(new Zb({body:bt,headers:Te,status:He,statusText:We,url:dt||void 0})),g.complete()):g.error(new Xb({error:bt,headers:Te,status:He,statusText:We,url:dt||void 0}))},J=Te=>{let{url:He}=L(),We=new Xb({error:Te,status:b.status||0,statusText:b.statusText||"Unknown Error",url:He||void 0});g.error(We)},oe=!1,be=Te=>{oe||(g.next(L()),oe=!0);let He={type:fm.DownloadProgress,loaded:Te.loaded};Te.lengthComputable&&(He.total=Te.total),r.responseType==="text"&&b.responseText&&(He.partialText=b.responseText),g.next(He)},Me=Te=>{let He={type:fm.UploadProgress,loaded:Te.loaded};Te.lengthComputable&&(He.total=Te.total),g.next(He)};return b.addEventListener("load",G),b.addEventListener("error",J),b.addEventListener("timeout",J),b.addEventListener("abort",J),r.reportProgress&&(b.addEventListener("progress",be),M!==null&&b.upload&&b.upload.addEventListener("progress",Me)),b.send(M),g.next({type:fm.Sent}),()=>{b.removeEventListener("error",J),b.removeEventListener("abort",J),b.removeEventListener("load",G),b.removeEventListener("timeout",J),r.reportProgress&&(b.removeEventListener("progress",be),M!==null&&b.upload&&b.upload.removeEventListener("progress",Me)),b.readyState!==b.DONE&&b.abort()}})))}};n.\u0275fac=function(s){return new(s||n)(Ye(Wb))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})(),wk=new Qt(""),$B="XSRF-TOKEN",qB=new Qt("",{providedIn:"root",factory:()=>$B}),YB="X-XSRF-TOKEN",ZB=new Qt("",{providedIn:"root",factory:()=>YB}),Qb=class{},XB=(()=>{let n=class n{constructor(r,s,t){this.doc=r,this.platform=s,this.cookieName=t,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=Ub(r,this.cookieName),this.lastCookieString=r),this.lastToken}};n.\u0275fac=function(s){return new(s||n)(Ye(Ai),Ye($o),Ye(qB))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})();function KB(a,n){let d=a.url.toLowerCase();if(!Nt(wk)||a.method==="GET"||a.method==="HEAD"||d.startsWith("http://")||d.startsWith("https://"))return n(a);let r=Nt(Qb).getToken(),s=Nt(ZB);return r!=null&&!a.headers.has(s)&&(a=a.clone({headers:a.headers.set(s,r)})),n(a)}var Ck=function(a){return a[a.Interceptors=0]="Interceptors",a[a.LegacyInterceptors=1]="LegacyInterceptors",a[a.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",a[a.NoXsrfProtection=3]="NoXsrfProtection",a[a.JsonpSupport=4]="JsonpSupport",a[a.RequestsMadeViaParent=5]="RequestsMadeViaParent",a[a.Fetch=6]="Fetch",a}(Ck||{});function QB(a,n){return{\u0275kind:a,\u0275providers:n}}function JB(...a){let n=[nn,bk,yk,{provide:g_,useExisting:yk},{provide:Yb,useExisting:bk},{provide:AC,useValue:KB,multi:!0},{provide:wk,useValue:!0},{provide:Qb,useClass:XB}];for(let d of a)n.push(...d.\u0275providers);return sm(n)}var vk=new Qt("");function e4(){return QB(Ck.LegacyInterceptors,[{provide:vk,useFactory:HB},{provide:AC,useExisting:vk,multi:!0}])}var Sk=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({providers:[JB(e4())]});let a=n;return a})();var RC=class extends JD{constructor(){super(...arguments),this.supportsDOMEvents=!0}},FC=class a extends RC{static makeCurrent(){QD(new a)}onAndCancel(n,d,r){return n.addEventListener(d,r),()=>{n.removeEventListener(d,r)}}dispatchEvent(n,d){n.dispatchEvent(d)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,d){return d=d||this.getDefaultDocument(),d.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,d){return d==="window"?window:d==="document"?n:d==="body"?n.body:null}getBaseHref(n){let d=i4();return d==null?null:n4(d)}resetBaseElement(){y_=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return Ub(document.cookie,n)}},y_=null;function i4(){return y_=y_||document.querySelector("base"),y_?y_.getAttribute("href"):null}function n4(a){return new URL(a,document.baseURI).pathname}var LC=class{addToWindow(n){Ed.getAngularTestability=(r,s=!0)=>{let t=n.findTestabilityInTree(r,s);if(t==null)throw new $n(5103,!1);return t},Ed.getAllAngularTestabilities=()=>n.getAllTestabilities(),Ed.getAllAngularRootElements=()=>n.getAllRootElements();let d=r=>{let s=Ed.getAllAngularTestabilities(),t=s.length,g=function(){t--,t==0&&r()};s.forEach(b=>{b.whenStable(g)})};Ed.frameworkStabilizers||(Ed.frameworkStabilizers=[]),Ed.frameworkStabilizers.push(d)}findTestabilityInTree(n,d,r){if(d==null)return null;let s=n.getTestability(d);return s??(r?gu().isShadowRoot(d)?this.findTestabilityInTree(n,d.host,!0):this.findTestabilityInTree(n,d.parentElement,!0):null)}},r4=(()=>{let n=class n{build(){return new XMLHttpRequest}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})(),zC=new Qt(""),Ik=(()=>{let n=class n{constructor(r,s){this._zone=s,this._eventNameToPlugin=new Map,r.forEach(t=>{t.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,s,t){return this._findPluginFor(s).addEventListener(r,s,t)}getZone(){return this._zone}_findPluginFor(r){let s=this._eventNameToPlugin.get(r);if(s)return s;if(s=this._plugins.find(g=>g.supports(r)),!s)throw new $n(5101,!1);return this._eventNameToPlugin.set(r,s),s}};n.\u0275fac=function(s){return new(s||n)(Ye(zC),Ye(di))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})(),Jb=class{constructor(n){this._doc=n}},PC="ng-app-id",Ek=(()=>{let n=class n{constructor(r,s,t,g={}){this.doc=r,this.appId=s,this.nonce=t,this.platformId=g,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Hb(g),this.resetHostNodes()}addStyles(r){for(let s of r)this.changeUsageCount(s,1)===1&&this.onStyleAdded(s)}removeStyles(r){for(let s of r)this.changeUsageCount(s,-1)<=0&&this.onStyleRemoved(s)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(s=>s.remove()),r.clear());for(let s of this.getAllStyles())this.onStyleRemoved(s);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let s of this.getAllStyles())this.addStyleToHost(r,s)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let s of this.hostNodes)this.addStyleToHost(s,r)}onStyleRemoved(r){let s=this.styleRef;s.get(r)?.elements?.forEach(t=>t.remove()),s.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${PC}="${this.appId}"]`);if(r?.length){let s=new Map;return r.forEach(t=>{t.textContent!=null&&s.set(t.textContent,t)}),s}return null}changeUsageCount(r,s){let t=this.styleRef;if(t.has(r)){let g=t.get(r);return g.usage+=s,g.usage}return t.set(r,{usage:s,elements:[]}),s}getStyleElement(r,s){let t=this.styleNodesInDOM,g=t?.get(s);if(g?.parentNode===r)return t.delete(s),g.removeAttribute(PC),g;{let b=this.doc.createElement("style");return this.nonce&&b.setAttribute("nonce",this.nonce),b.textContent=s,this.platformIsServer&&b.setAttribute(PC,this.appId),r.appendChild(b),b}}addStyleToHost(r,s){let t=this.getStyleElement(r,s),g=this.styleRef,b=g.get(s)?.elements;b?b.push(t):g.set(s,{elements:[t],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};n.\u0275fac=function(s){return new(s||n)(Ye(Ai),Ye(o_),Ye(a_,8),Ye($o))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})(),OC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},NC=/%COMP%/g,Dk="%COMP%",o4=`_nghost-${Dk}`,a4=`_ngcontent-${Dk}`,s4=!0,l4=new Qt("",{providedIn:"root",factory:()=>s4});function c4(a){return a4.replace(NC,a)}function d4(a){return o4.replace(NC,a)}function kk(a,n){return n.map(d=>d.replace(NC,a))}var gm=(()=>{let n=class n{constructor(r,s,t,g,b,M,k,L=null){this.eventManager=r,this.sharedStylesHost=s,this.appId=t,this.removeStylesOnCompDestroy=g,this.doc=b,this.platformId=M,this.ngZone=k,this.nonce=L,this.rendererByCompId=new Map,this.platformIsServer=Hb(M),this.defaultRenderer=new b_(r,b,k,this.platformIsServer)}createRenderer(r,s){if(!r||!s)return this.defaultRenderer;this.platformIsServer&&s.encapsulation===r_.ShadowDom&&(s=Cn(kt({},s),{encapsulation:r_.Emulated}));let t=this.getOrCreateRenderer(r,s);return t instanceof ev?t.applyToHost(r):t instanceof v_&&t.applyStyles(),t}getOrCreateRenderer(r,s){let t=this.rendererByCompId,g=t.get(s.id);if(!g){let b=this.doc,M=this.ngZone,k=this.eventManager,L=this.sharedStylesHost,G=this.removeStylesOnCompDestroy,J=this.platformIsServer;switch(s.encapsulation){case r_.Emulated:g=new ev(k,L,s,this.appId,G,b,M,J);break;case r_.ShadowDom:return new BC(k,L,r,s,b,M,this.nonce,J);default:g=new v_(k,L,s,G,b,M,J);break}t.set(s.id,g)}return g}ngOnDestroy(){this.rendererByCompId.clear()}};n.\u0275fac=function(s){return new(s||n)(Ye(Ik),Ye(Ek),Ye(o_),Ye(l4),Ye(Ai),Ye($o),Ye(di),Ye(a_))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})(),b_=class{constructor(n,d,r,s){this.eventManager=n,this.doc=d,this.ngZone=r,this.platformIsServer=s,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(n,d){return d?this.doc.createElementNS(OC[d]||d,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,d){(Mk(n)?n.content:n).appendChild(d)}insertBefore(n,d,r){n&&(Mk(n)?n.content:n).insertBefore(d,r)}removeChild(n,d){n&&n.removeChild(d)}selectRootElement(n,d){let r=typeof n=="string"?this.doc.querySelector(n):n;if(!r)throw new $n(-5104,!1);return d||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,d,r,s){if(s){d=s+":"+d;let t=OC[s];t?n.setAttributeNS(t,d,r):n.setAttribute(d,r)}else n.setAttribute(d,r)}removeAttribute(n,d,r){if(r){let s=OC[r];s?n.removeAttributeNS(s,d):n.removeAttribute(`${r}:${d}`)}else n.removeAttribute(d)}addClass(n,d){n.classList.add(d)}removeClass(n,d){n.classList.remove(d)}setStyle(n,d,r,s){s&(s_.DashCase|s_.Important)?n.style.setProperty(d,r,s&s_.Important?"important":""):n.style[d]=r}removeStyle(n,d,r){r&s_.DashCase?n.style.removeProperty(d):n.style[d]=""}setProperty(n,d,r){n!=null&&(n[d]=r)}setValue(n,d){n.nodeValue=d}listen(n,d,r){if(typeof n=="string"&&(n=gu().getGlobalEventTarget(this.doc,n),!n))throw new Error(`Unsupported event target ${n} for event ${d}`);return this.eventManager.addEventListener(n,d,this.decoratePreventDefault(r))}decoratePreventDefault(n){return d=>{if(d==="__ngUnwrap__")return n;(this.platformIsServer?this.ngZone.runGuarded(()=>n(d)):n(d))===!1&&d.preventDefault()}}};function Mk(a){return a.tagName==="TEMPLATE"&&a.content!==void 0}var BC=class extends b_{constructor(n,d,r,s,t,g,b,M){super(n,t,g,M),this.sharedStylesHost=d,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let k=kk(s.id,s.styles);for(let L of k){let G=document.createElement("style");b&&G.setAttribute("nonce",b),G.textContent=L,this.shadowRoot.appendChild(G)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,d){return super.appendChild(this.nodeOrShadowRoot(n),d)}insertBefore(n,d,r){return super.insertBefore(this.nodeOrShadowRoot(n),d,r)}removeChild(n,d){return super.removeChild(this.nodeOrShadowRoot(n),d)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},v_=class extends b_{constructor(n,d,r,s,t,g,b,M){super(n,t,g,b),this.sharedStylesHost=d,this.removeStylesOnCompDestroy=s,this.styles=M?kk(M,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},ev=class extends v_{constructor(n,d,r,s,t,g,b,M){let k=s+"-"+r.id;super(n,d,r,t,g,b,M,k),this.contentAttr=c4(k),this.hostAttr=d4(k)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,d){let r=super.createElement(n,d);return super.setAttribute(r,this.contentAttr,""),r}},h4=(()=>{let n=class n extends Jb{constructor(r){super(r)}supports(r){return!0}addEventListener(r,s,t){return r.addEventListener(s,t,!1),()=>this.removeEventListener(r,s,t)}removeEventListener(r,s,t){return r.removeEventListener(s,t)}};n.\u0275fac=function(s){return new(s||n)(Ye(Ai))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})(),Tk=["alt","control","meta","shift"],u4={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},p4={alt:a=>a.altKey,control:a=>a.ctrlKey,meta:a=>a.metaKey,shift:a=>a.shiftKey},m4=(()=>{let n=class n extends Jb{constructor(r){super(r)}supports(r){return n.parseEventName(r)!=null}addEventListener(r,s,t){let g=n.parseEventName(s),b=n.eventCallback(g.fullKey,t,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>gu().onAndCancel(r,g.domEventName,b))}static parseEventName(r){let s=r.toLowerCase().split("."),t=s.shift();if(s.length===0||!(t==="keydown"||t==="keyup"))return null;let g=n._normalizeKey(s.pop()),b="",M=s.indexOf("code");if(M>-1&&(s.splice(M,1),b="code."),Tk.forEach(L=>{let G=s.indexOf(L);G>-1&&(s.splice(G,1),b+=L+".")}),b+=g,s.length!=0||g.length===0)return null;let k={};return k.domEventName=t,k.fullKey=b,k}static matchEventFullKeyCode(r,s){let t=u4[r.key]||r.key,g="";return s.indexOf("code.")>-1&&(t=r.code,g="code."),t==null||!t?!1:(t=t.toLowerCase(),t===" "?t="space":t==="."&&(t="dot"),Tk.forEach(b=>{if(b!==t){let M=p4[b];M(r)&&(g+=b+".")}}),g+=t,g===s)}static eventCallback(r,s,t){return g=>{n.matchEventFullKeyCode(g,r)&&t.runGuarded(()=>s(g))}}static _normalizeKey(r){return r==="esc"?"escape":r}};n.\u0275fac=function(s){return new(s||n)(Ye(Ai))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})();function f4(){FC.makeCurrent()}function g4(){return new gC}function _4(){return ND(document),document}var y4=[{provide:$o,useValue:rk},{provide:VD,useValue:f4,multi:!0},{provide:Ai,useFactory:_4,deps:[]}],Ak=YD(ZD,"browser",y4),b4=new Qt(""),v4=[{provide:Bb,useClass:LC,deps:[]},{provide:$D,useClass:Nb,deps:[di,bC,Bb]},{provide:Nb,useClass:Nb,deps:[di,bC,Bb]}],x4=[{provide:BD,useValue:"root"},{provide:gC,useFactory:g4,deps:[]},{provide:zC,useClass:h4,multi:!0,deps:[Ai,di,$o]},{provide:zC,useClass:m4,multi:!0,deps:[Ai]},gm,Ek,Ik,{provide:lm,useExisting:gm},{provide:Wb,useClass:r4,deps:[]},[]],tv=(()=>{let n=class n{constructor(r){}static withServerTransition(r){return{ngModule:n,providers:[{provide:o_,useValue:r.appId}]}}};n.\u0275fac=function(s){return new(s||n)(Ye(b4,12))},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({providers:[...x4,...v4],imports:[ol,XD]});let a=n;return a})();var Pk=(()=>{let n=class n{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};n.\u0275fac=function(s){return new(s||n)(Ye(Ai))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var Hk=(()=>{let n=class n{constructor(r,s){this._renderer=r,this._elementRef=s,this.onChange=t=>{},this.onTouched=()=>{}}setProperty(r,s){this._renderer.setProperty(this._elementRef.nativeElement,r,s)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};n.\u0275fac=function(s){return new(s||n)(ge(nl),ge(Zi))},n.\u0275dir=Ei({type:n});let a=n;return a})(),M_=(()=>{let n=class n extends Hk{};n.\u0275fac=(()=>{let r;return function(t){return(r||(r=vo(n)))(t||n)}})(),n.\u0275dir=Ei({type:n,features:[zn]});let a=n;return a})(),ec=new Qt(""),w4={provide:ec,useExisting:Fo(()=>tc),multi:!0},tc=(()=>{let n=class n extends M_{writeValue(r){this.setProperty("checked",r)}};n.\u0275fac=(()=>{let r;return function(t){return(r||(r=vo(n)))(t||n)}})(),n.\u0275dir=Ei({type:n,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(s,t){s&1&&Fe("change",function(b){return t.onChange(b.target.checked)})("blur",function(){return t.onTouched()})},features:[gr([w4]),zn]});let a=n;return a})(),C4={provide:ec,useExisting:Fo(()=>ho),multi:!0};function S4(){let a=gu()?gu().getUserAgent():"";return/android (\d+)/.test(a.toLowerCase())}var M4=new Qt(""),ho=(()=>{let n=class n extends Hk{constructor(r,s,t){super(r,s),this._compositionMode=t,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!S4())}writeValue(r){let s=r??"";this.setProperty("value",s)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};n.\u0275fac=function(s){return new(s||n)(ge(nl),ge(Zi),ge(M4,8))},n.\u0275dir=Ei({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(s,t){s&1&&Fe("input",function(b){return t._handleInput(b.target.value)})("blur",function(){return t.onTouched()})("compositionstart",function(){return t._compositionStart()})("compositionend",function(b){return t._compositionEnd(b.target.value)})},features:[gr([C4]),zn]});let a=n;return a})();function zd(a){return a==null||(typeof a=="string"||Array.isArray(a))&&a.length===0}function Wk(a){return a!=null&&typeof a.length=="number"}var Bd=new Qt(""),dv=new Qt(""),T4=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,kr=class{static min(n){return I4(n)}static max(n){return E4(n)}static required(n){return Gk(n)}static requiredTrue(n){return D4(n)}static email(n){return k4(n)}static minLength(n){return A4(n)}static maxLength(n){return $k(n)}static pattern(n){return P4(n)}static nullValidator(n){return nv(n)}static compose(n){return Qk(n)}static composeAsync(n){return Jk(n)}};function I4(a){return n=>{if(zd(n.value)||zd(a))return null;let d=parseFloat(n.value);return!isNaN(d)&&d<a?{min:{min:a,actual:n.value}}:null}}function E4(a){return n=>{if(zd(n.value)||zd(a))return null;let d=parseFloat(n.value);return!isNaN(d)&&d>a?{max:{max:a,actual:n.value}}:null}}function Gk(a){return zd(a.value)?{required:!0}:null}function D4(a){return a.value===!0?null:{required:!0}}function k4(a){return zd(a.value)||T4.test(a.value)?null:{email:!0}}function A4(a){return n=>zd(n.value)||!Wk(n.value)?null:n.value.length<a?{minlength:{requiredLength:a,actualLength:n.value.length}}:null}function $k(a){return n=>Wk(n.value)&&n.value.length>a?{maxlength:{requiredLength:a,actualLength:n.value.length}}:null}function P4(a){if(!a)return nv;let n,d;return typeof a=="string"?(d="",a.charAt(0)!=="^"&&(d+="^"),d+=a,a.charAt(a.length-1)!=="$"&&(d+="$"),n=new RegExp(d)):(d=a.toString(),n=a),r=>{if(zd(r.value))return null;let s=r.value;return n.test(s)?null:{pattern:{requiredPattern:d,actualValue:s}}}}function nv(a){return null}function qk(a){return a!=null}function Yk(a){return Vb(a)?oo(a):a}function Zk(a){let n={};return a.forEach(d=>{n=d!=null?kt(kt({},n),d):n}),Object.keys(n).length===0?null:n}function Xk(a,n){return n.map(d=>d(a))}function O4(a){return!a.validate}function Kk(a){return a.map(n=>O4(n)?n:d=>n.validate(d))}function Qk(a){if(!a)return null;let n=a.filter(qk);return n.length==0?null:function(d){return Zk(Xk(d,n))}}function HC(a){return a!=null?Qk(Kk(a)):null}function Jk(a){if(!a)return null;let n=a.filter(qk);return n.length==0?null:function(d){let r=Xk(d,n).map(Yk);return PD(r).pipe(pn(Zk))}}function WC(a){return a!=null?Jk(Kk(a)):null}function Rk(a,n){return a===null?[n]:Array.isArray(a)?[...a,n]:[a,n]}function eA(a){return a._rawValidators}function tA(a){return a._rawAsyncValidators}function VC(a){return a?Array.isArray(a)?a:[a]:[]}function rv(a,n){return Array.isArray(a)?a.includes(n):a===n}function Fk(a,n){let d=VC(n);return VC(a).forEach(s=>{rv(d,s)||d.push(s)}),d}function Lk(a,n){return VC(n).filter(d=>!rv(a,d))}var ov=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=HC(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=WC(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,d){return this.control?this.control.hasError(n,d):!1}getError(n,d){return this.control?this.control.getError(n,d):null}},Jl=class extends ov{get formDirective(){return null}get path(){return null}},yu=class extends ov{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},av=class{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},R4={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},B$=Cn(kt({},R4),{"[class.ng-submitted]":"isSubmitted"}),Mr=(()=>{let n=class n extends av{constructor(r){super(r)}};n.\u0275fac=function(s){return new(s||n)(ge(yu,2))},n.\u0275dir=Ei({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(s,t){s&2&&Ni("ng-untouched",t.isUntouched)("ng-touched",t.isTouched)("ng-pristine",t.isPristine)("ng-dirty",t.isDirty)("ng-valid",t.isValid)("ng-invalid",t.isInvalid)("ng-pending",t.isPending)},features:[zn]});let a=n;return a})(),Bo=(()=>{let n=class n extends av{constructor(r){super(r)}};n.\u0275fac=function(s){return new(s||n)(ge(Jl,10))},n.\u0275dir=Ei({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(s,t){s&2&&Ni("ng-untouched",t.isUntouched)("ng-touched",t.isTouched)("ng-pristine",t.isPristine)("ng-dirty",t.isDirty)("ng-valid",t.isValid)("ng-invalid",t.isInvalid)("ng-pending",t.isPending)("ng-submitted",t.isSubmitted)},features:[zn]});let a=n;return a})();var x_="VALID",iv="INVALID",_m="PENDING",w_="DISABLED";function GC(a){return(hv(a)?a.validators:a)||null}function F4(a){return Array.isArray(a)?HC(a):a||null}function $C(a,n){return(hv(n)?n.asyncValidators:a)||null}function L4(a){return Array.isArray(a)?WC(a):a||null}function hv(a){return a!=null&&!Array.isArray(a)&&typeof a=="object"}function iA(a,n,d){let r=a.controls;if(!(n?Object.keys(r):r).length)throw new $n(1e3,"");if(!r[d])throw new $n(1001,"")}function nA(a,n,d){a._forEachChild((r,s)=>{if(d[s]===void 0)throw new $n(1002,"")})}var ym=class{constructor(n,d){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(d)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===x_}get invalid(){return this.status===iv}get pending(){return this.status==_m}get disabled(){return this.status===w_}get enabled(){return this.status!==w_}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(Fk(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(Fk(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(Lk(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(Lk(n,this._rawAsyncValidators))}hasValidator(n){return rv(this._rawValidators,n)}hasAsyncValidator(n){return rv(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(d=>{d.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(d=>{d.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=_m,n.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){let d=this._parentMarkedDirty(n.onlySelf);this.status=w_,this.errors=null,this._forEachChild(r=>{r.disable(Cn(kt({},n),{onlySelf:!0}))}),this._updateValue(),n.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Cn(kt({},n),{skipPristineCheck:d})),this._onDisabledChange.forEach(r=>r(!0))}enable(n={}){let d=this._parentMarkedDirty(n.onlySelf);this.status=x_,this._forEachChild(r=>{r.enable(Cn(kt({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(Cn(kt({},n),{skipPristineCheck:d})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===x_||this.status===_m)&&this._runAsyncValidator(n.emitEvent)),n.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(d=>d._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?w_:x_}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=_m,this._hasOwnPendingAsyncValidator=!0;let d=Yk(this.asyncValidator(this));this._asyncValidationSubscription=d.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,d={}){this.errors=n,this._updateControlsErrors(d.emitEvent!==!1)}get(n){let d=n;return d==null||(Array.isArray(d)||(d=d.split(".")),d.length===0)?null:d.reduce((r,s)=>r&&r._find(s),this)}getError(n,d){let r=d?this.get(d):this;return r&&r.errors?r.errors[n]:null}hasError(n,d){return!!this.getError(n,d)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new Ii,this.statusChanges=new Ii}_calculateStatus(){return this._allControlsDisabled()?w_:this.errors?iv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(_m)?_m:this._anyControlsHaveStatus(iv)?iv:x_}_anyControlsHaveStatus(n){return this._anyControls(d=>d.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){hv(n)&&n.updateOn!=null&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){let d=this._parent&&this._parent.dirty;return!n&&!!d&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=F4(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=L4(this._rawAsyncValidators)}},bm=class extends ym{constructor(n,d,r){super(GC(d),$C(r,d)),this.controls=n,this._initObservables(),this._setUpdateStrategy(d),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,d){return this.controls[n]?this.controls[n]:(this.controls[n]=d,d.setParent(this),d._registerOnCollectionChange(this._onCollectionChange),d)}addControl(n,d,r={}){this.registerControl(n,d),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,d={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:d.emitEvent}),this._onCollectionChange()}setControl(n,d,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],d&&this.registerControl(n,d),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,d={}){nA(this,!0,n),Object.keys(n).forEach(r=>{iA(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d)}patchValue(n,d={}){n!=null&&(Object.keys(n).forEach(r=>{let s=this.controls[r];s&&s.patchValue(n[r],{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d))}reset(n={},d={}){this._forEachChild((r,s)=>{r.reset(n?n[s]:null,{onlySelf:!0,emitEvent:d.emitEvent})}),this._updatePristine(d),this._updateTouched(d),this.updateValueAndValidity(d)}getRawValue(){return this._reduceChildren({},(n,d,r)=>(n[r]=d.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(d,r)=>r._syncPendingControls()?!0:d);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(d=>{let r=this.controls[d];r&&n(r,d)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(let[d,r]of Object.entries(this.controls))if(this.contains(d)&&n(r))return!0;return!1}_reduceValue(){let n={};return this._reduceChildren(n,(d,r,s)=>((r.enabled||this.disabled)&&(d[s]=r.value),d))}_reduceChildren(n,d){let r=n;return this._forEachChild((s,t)=>{r=d(r,s,t)}),r}_allControlsDisabled(){for(let n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}};var jC=class extends bm{};var T_=new Qt("CallSetDisabledState",{providedIn:"root",factory:()=>uv}),uv="always";function rA(a,n){return[...n.path,a]}function sv(a,n,d=uv){qC(a,n),n.valueAccessor.writeValue(a.value),(a.disabled||d==="always")&&n.valueAccessor.setDisabledState?.(a.disabled),B4(a,n),V4(a,n),N4(a,n),z4(a,n)}function zk(a,n,d=!0){let r=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(r),n.valueAccessor.registerOnTouched(r)),cv(a,n),a&&(n._invokeOnDestroyCallbacks(),a._registerOnCollectionChange(()=>{}))}function lv(a,n){a.forEach(d=>{d.registerOnValidatorChange&&d.registerOnValidatorChange(n)})}function z4(a,n){if(n.valueAccessor.setDisabledState){let d=r=>{n.valueAccessor.setDisabledState(r)};a.registerOnDisabledChange(d),n._registerOnDestroy(()=>{a._unregisterOnDisabledChange(d)})}}function qC(a,n){let d=eA(a);n.validator!==null?a.setValidators(Rk(d,n.validator)):typeof d=="function"&&a.setValidators([d]);let r=tA(a);n.asyncValidator!==null?a.setAsyncValidators(Rk(r,n.asyncValidator)):typeof r=="function"&&a.setAsyncValidators([r]);let s=()=>a.updateValueAndValidity();lv(n._rawValidators,s),lv(n._rawAsyncValidators,s)}function cv(a,n){let d=!1;if(a!==null){if(n.validator!==null){let s=eA(a);if(Array.isArray(s)&&s.length>0){let t=s.filter(g=>g!==n.validator);t.length!==s.length&&(d=!0,a.setValidators(t))}}if(n.asyncValidator!==null){let s=tA(a);if(Array.isArray(s)&&s.length>0){let t=s.filter(g=>g!==n.asyncValidator);t.length!==s.length&&(d=!0,a.setAsyncValidators(t))}}}let r=()=>{};return lv(n._rawValidators,r),lv(n._rawAsyncValidators,r),d}function B4(a,n){n.valueAccessor.registerOnChange(d=>{a._pendingValue=d,a._pendingChange=!0,a._pendingDirty=!0,a.updateOn==="change"&&oA(a,n)})}function N4(a,n){n.valueAccessor.registerOnTouched(()=>{a._pendingTouched=!0,a.updateOn==="blur"&&a._pendingChange&&oA(a,n),a.updateOn!=="submit"&&a.markAsTouched()})}function oA(a,n){a._pendingDirty&&a.markAsDirty(),a.setValue(a._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(a._pendingValue),a._pendingChange=!1}function V4(a,n){let d=(r,s)=>{n.valueAccessor.writeValue(r),s&&n.viewToModelUpdate(r)};a.registerOnChange(d),n._registerOnDestroy(()=>{a._unregisterOnChange(d)})}function aA(a,n){a==null,qC(a,n)}function j4(a,n){return cv(a,n)}function sA(a,n){if(!a.hasOwnProperty("model"))return!1;let d=a.model;return d.isFirstChange()?!0:!Object.is(n,d.currentValue)}function U4(a){return Object.getPrototypeOf(a.constructor)===M_}function lA(a,n){a._syncPendingControls(),n.forEach(d=>{let r=d.control;r.updateOn==="submit"&&r._pendingChange&&(d.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function cA(a,n){if(!n)return null;Array.isArray(n);let d,r,s;return n.forEach(t=>{t.constructor===ho?d=t:U4(t)?r=t:s=t}),s||r||d||null}function H4(a,n){let d=a.indexOf(n);d>-1&&a.splice(d,1)}var W4={provide:Jl,useExisting:Fo(()=>YC)},C_=Promise.resolve(),YC=(()=>{let n=class n extends Jl{constructor(r,s,t){super(),this.callSetDisabledState=t,this.submitted=!1,this._directives=new Set,this.ngSubmit=new Ii,this.form=new bm({},HC(r),WC(s))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(r){C_.then(()=>{let s=this._findContainer(r.path);r.control=s.registerControl(r.name,r.control),sv(r.control,r,this.callSetDisabledState),r.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(r)})}getControl(r){return this.form.get(r.path)}removeControl(r){C_.then(()=>{let s=this._findContainer(r.path);s&&s.removeControl(r.name),this._directives.delete(r)})}addFormGroup(r){C_.then(()=>{let s=this._findContainer(r.path),t=new bm({});aA(t,r),s.registerControl(r.name,t),t.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(r){C_.then(()=>{let s=this._findContainer(r.path);s&&s.removeControl(r.name)})}getFormGroup(r){return this.form.get(r.path)}updateModel(r,s){C_.then(()=>{this.form.get(r.path).setValue(s)})}setValue(r){this.control.setValue(r)}onSubmit(r){return this.submitted=!0,lA(this.form,this._directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(r){return r.pop(),r.length?this.form.get(r):this.form}};n.\u0275fac=function(s){return new(s||n)(ge(Bd,10),ge(dv,10),ge(T_,8))},n.\u0275dir=Ei({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(s,t){s&1&&Fe("submit",function(b){return t.onSubmit(b)})("reset",function(){return t.onReset()})},inputs:{options:[bi.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[gr([W4]),zn]});let a=n;return a})();function Bk(a,n){let d=a.indexOf(n);d>-1&&a.splice(d,1)}function Nk(a){return typeof a=="object"&&a!==null&&Object.keys(a).length===2&&"value"in a&&"disabled"in a}var S_=class extends ym{constructor(n=null,d,r){super(GC(d),$C(r,d)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(d),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),hv(d)&&(d.nonNullable||d.initialValueIsDefault)&&(Nk(n)?this.defaultValue=n.value:this.defaultValue=n)}setValue(n,d={}){this.value=this._pendingValue=n,this._onChange.length&&d.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,d.emitViewToModelChange!==!1)),this.updateValueAndValidity(d)}patchValue(n,d={}){this.setValue(n,d)}reset(n=this.defaultValue,d={}){this._applyFormState(n),this.markAsPristine(d),this.markAsUntouched(d),this.setValue(this.value,d),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){Bk(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){Bk(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(n){Nk(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};var G4=a=>a instanceof S_;var $4={provide:yu,useExisting:Fo(()=>Es)},Vk=Promise.resolve(),Es=(()=>{let n=class n extends yu{constructor(r,s,t,g,b,M){super(),this._changeDetectorRef=b,this.callSetDisabledState=M,this.control=new S_,this._registered=!1,this.name="",this.update=new Ii,this._parent=r,this._setValidators(s),this._setAsyncValidators(t),this.valueAccessor=cA(this,g)}ngOnChanges(r){if(this._checkForErrors(),!this._registered||"name"in r){if(this._registered&&(this._checkName(),this.formDirective)){let s=r.name.previousValue;this.formDirective.removeControl({name:s,path:this._getPath(s)})}this._setUpControl()}"isDisabled"in r&&this._updateDisabled(r),sA(r,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){sv(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(r){Vk.then(()=>{this.control.setValue(r,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(r){let s=r.isDisabled.currentValue,t=s!==0&&sr(s);Vk.then(()=>{t&&!this.control.disabled?this.control.disable():!t&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(r){return this._parent?rA(r,this._parent):[r]}};n.\u0275fac=function(s){return new(s||n)(ge(Jl,9),ge(Bd,10),ge(dv,10),ge(ec,10),ge(_r,8),ge(T_,8))},n.\u0275dir=Ei({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[bi.None,"disabled","isDisabled"],model:[bi.None,"ngModel","model"],options:[bi.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[gr([$4]),zn,ar]});let a=n;return a})(),No=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275dir=Ei({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let a=n;return a})(),q4={provide:ec,useExisting:Fo(()=>bu),multi:!0},bu=(()=>{let n=class n extends M_{writeValue(r){let s=r??"";this.setProperty("value",s)}registerOnChange(r){this.onChange=s=>{r(s==""?null:parseFloat(s))}}};n.\u0275fac=(()=>{let r;return function(t){return(r||(r=vo(n)))(t||n)}})(),n.\u0275dir=Ei({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(s,t){s&1&&Fe("input",function(b){return t.onChange(b.target.value)})("blur",function(){return t.onTouched()})},features:[gr([q4]),zn]});let a=n;return a})();var dA=new Qt("");var Y4={provide:Jl,useExisting:Fo(()=>qo)},qo=(()=>{let n=class n extends Jl{constructor(r,s,t){super(),this.callSetDisabledState=t,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Ii,this._setValidators(r),this._setAsyncValidators(s)}ngOnChanges(r){this._checkFormPresent(),r.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(cv(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(r){let s=this.form.get(r.path);return sv(s,r,this.callSetDisabledState),s.updateValueAndValidity({emitEvent:!1}),this.directives.push(r),s}getControl(r){return this.form.get(r.path)}removeControl(r){zk(r.control||null,r,!1),H4(this.directives,r)}addFormGroup(r){this._setUpFormContainer(r)}removeFormGroup(r){this._cleanUpFormContainer(r)}getFormGroup(r){return this.form.get(r.path)}addFormArray(r){this._setUpFormContainer(r)}removeFormArray(r){this._cleanUpFormContainer(r)}getFormArray(r){return this.form.get(r.path)}updateModel(r,s){this.form.get(r.path).setValue(s)}onSubmit(r){return this.submitted=!0,lA(this.form,this.directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_updateDomValue(){this.directives.forEach(r=>{let s=r.control,t=this.form.get(r.path);s!==t&&(zk(s||null,r),G4(t)&&(sv(t,r,this.callSetDisabledState),r.control=t))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(r){let s=this.form.get(r.path);aA(s,r),s.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(r){if(this.form){let s=this.form.get(r.path);s&&j4(s,r)&&s.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){qC(this.form,this),this._oldForm&&cv(this._oldForm,this)}_checkFormPresent(){this.form}};n.\u0275fac=function(s){return new(s||n)(ge(Bd,10),ge(dv,10),ge(T_,8))},n.\u0275dir=Ei({type:n,selectors:[["","formGroup",""]],hostBindings:function(s,t){s&1&&Fe("submit",function(b){return t.onSubmit(b)})("reset",function(){return t.onReset()})},inputs:{form:[bi.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[gr([Y4]),zn,ar]});let a=n;return a})();var Z4={provide:yu,useExisting:Fo(()=>Aa)},Aa=(()=>{let n=class n extends yu{set isDisabled(r){}constructor(r,s,t,g,b){super(),this._ngModelWarningConfig=b,this._added=!1,this.name=null,this.update=new Ii,this._ngModelWarningSent=!1,this._parent=r,this._setValidators(s),this._setAsyncValidators(t),this.valueAccessor=cA(this,g)}ngOnChanges(r){this._added||this._setUpControl(),sA(r,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}get path(){return rA(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};n._ngModelWarningSentOnce=!1,n.\u0275fac=function(s){return new(s||n)(ge(Jl,13),ge(Bd,10),ge(dv,10),ge(ec,10),ge(dA,8))},n.\u0275dir=Ei({type:n,selectors:[["","formControlName",""]],inputs:{name:[bi.None,"formControlName","name"],isDisabled:[bi.None,"disabled","isDisabled"],model:[bi.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[gr([Z4]),zn,ar]});let a=n;return a})(),X4={provide:ec,useExisting:Fo(()=>pv),multi:!0};function hA(a,n){return a==null?`${n}`:(n&&typeof n=="object"&&(n="Object"),`${a}: ${n}`.slice(0,50))}function K4(a){return a.split(":")[0]}var pv=(()=>{let n=class n extends M_{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(r){this._compareWith=r}writeValue(r){this.value=r;let s=this._getOptionId(r),t=hA(s,r);this.setProperty("value",t)}registerOnChange(r){this.onChange=s=>{this.value=this._getOptionValue(s),r(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(r){for(let s of this._optionMap.keys())if(this._compareWith(this._optionMap.get(s),r))return s;return null}_getOptionValue(r){let s=K4(r);return this._optionMap.has(s)?this._optionMap.get(s):r}};n.\u0275fac=(()=>{let r;return function(t){return(r||(r=vo(n)))(t||n)}})(),n.\u0275dir=Ei({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(s,t){s&1&&Fe("change",function(b){return t.onChange(b.target.value)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[gr([X4]),zn]});let a=n;return a})(),uA=(()=>{let n=class n{constructor(r,s,t){this._element=r,this._renderer=s,this._select=t,this._select&&(this.id=this._select._registerOption())}set ngValue(r){this._select!=null&&(this._select._optionMap.set(this.id,r),this._setElementValue(hA(this.id,r)),this._select.writeValue(this._select.value))}set value(r){this._setElementValue(r),this._select&&this._select.writeValue(this._select.value)}_setElementValue(r){this._renderer.setProperty(this._element.nativeElement,"value",r)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};n.\u0275fac=function(s){return new(s||n)(ge(Zi),ge(nl),ge(pv,9))},n.\u0275dir=Ei({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let a=n;return a})(),Q4={provide:ec,useExisting:Fo(()=>pA),multi:!0};function jk(a,n){return a==null?`${n}`:(typeof n=="string"&&(n=`'${n}'`),n&&typeof n=="object"&&(n="Object"),`${a}: ${n}`.slice(0,50))}function J4(a){return a.split(":")[0]}var pA=(()=>{let n=class n extends M_{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(r){this._compareWith=r}writeValue(r){this.value=r;let s;if(Array.isArray(r)){let t=r.map(g=>this._getOptionId(g));s=(g,b)=>{g._setSelected(t.indexOf(b.toString())>-1)}}else s=(t,g)=>{t._setSelected(!1)};this._optionMap.forEach(s)}registerOnChange(r){this.onChange=s=>{let t=[],g=s.selectedOptions;if(g!==void 0){let b=g;for(let M=0;M<b.length;M++){let k=b[M],L=this._getOptionValue(k.value);t.push(L)}}else{let b=s.options;for(let M=0;M<b.length;M++){let k=b[M];if(k.selected){let L=this._getOptionValue(k.value);t.push(L)}}}this.value=t,r(t)}}_registerOption(r){let s=(this._idCounter++).toString();return this._optionMap.set(s,r),s}_getOptionId(r){for(let s of this._optionMap.keys())if(this._compareWith(this._optionMap.get(s)._value,r))return s;return null}_getOptionValue(r){let s=J4(r);return this._optionMap.has(s)?this._optionMap.get(s)._value:r}};n.\u0275fac=(()=>{let r;return function(t){return(r||(r=vo(n)))(t||n)}})(),n.\u0275dir=Ei({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(s,t){s&1&&Fe("change",function(b){return t.onChange(b.target)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[gr([Q4]),zn]});let a=n;return a})(),mA=(()=>{let n=class n{constructor(r,s,t){this._element=r,this._renderer=s,this._select=t,this._select&&(this.id=this._select._registerOption(this))}set ngValue(r){this._select!=null&&(this._value=r,this._setElementValue(jk(this.id,r)),this._select.writeValue(this._select.value))}set value(r){this._select?(this._value=r,this._setElementValue(jk(this.id,r)),this._select.writeValue(this._select.value)):this._setElementValue(r)}_setElementValue(r){this._renderer.setProperty(this._element.nativeElement,"value",r)}_setSelected(r){this._renderer.setProperty(this._element.nativeElement,"selected",r)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};n.\u0275fac=function(s){return new(s||n)(ge(Zi),ge(nl),ge(pA,9))},n.\u0275dir=Ei({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let a=n;return a})();function eN(a){return typeof a=="number"?a:parseInt(a,10)}var fA=(()=>{let n=class n{constructor(){this._validator=nv}ngOnChanges(r){if(this.inputName in r){let s=this.normalizeInput(r[this.inputName].currentValue);this._enabled=this.enabled(s),this._validator=this._enabled?this.createValidator(s):nv,this._onChange&&this._onChange()}}validate(r){return this._validator(r)}registerOnValidatorChange(r){this._onChange=r}enabled(r){return r!=null}};n.\u0275fac=function(s){return new(s||n)},n.\u0275dir=Ei({type:n,features:[ar]});let a=n;return a})();var tN={provide:Bd,useExisting:Fo(()=>ZC),multi:!0};var ZC=(()=>{let n=class n extends fA{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=sr,this.createValidator=r=>Gk}enabled(r){return r}};n.\u0275fac=(()=>{let r;return function(t){return(r||(r=vo(n)))(t||n)}})(),n.\u0275dir=Ei({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(s,t){s&2&&hn("required",t._enabled?"":null)},inputs:{required:"required"},features:[gr([tN]),zn]});let a=n;return a})();var iN={provide:Bd,useExisting:Fo(()=>vu),multi:!0},vu=(()=>{let n=class n extends fA{constructor(){super(...arguments),this.inputName="maxlength",this.normalizeInput=r=>eN(r),this.createValidator=r=>$k(r)}};n.\u0275fac=(()=>{let r;return function(t){return(r||(r=vo(n)))(t||n)}})(),n.\u0275dir=Ei({type:n,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(s,t){s&2&&hn("maxlength",t._enabled?t.maxlength:null)},inputs:{maxlength:"maxlength"},features:[gr([iN]),zn]});let a=n;return a})();var gA=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({});let a=n;return a})(),UC=class extends ym{constructor(n,d,r){super(GC(d),$C(r,d)),this.controls=n,this._initObservables(),this._setUpdateStrategy(d),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[this._adjustIndex(n)]}push(n,d={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:d.emitEvent}),this._onCollectionChange()}insert(n,d,r={}){this.controls.splice(n,0,d),this._registerControl(d),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(n,d={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:d.emitEvent})}setControl(n,d,r={}){let s=this._adjustIndex(n);s<0&&(s=0),this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),this.controls.splice(s,1),d&&(this.controls.splice(s,0,d),this._registerControl(d)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,d={}){nA(this,!1,n),n.forEach((r,s)=>{iA(this,!1,s),this.at(s).setValue(r,{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d)}patchValue(n,d={}){n!=null&&(n.forEach((r,s)=>{this.at(s)&&this.at(s).patchValue(r,{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d))}reset(n=[],d={}){this._forEachChild((r,s)=>{r.reset(n[s],{onlySelf:!0,emitEvent:d.emitEvent})}),this._updatePristine(d),this._updateTouched(d),this.updateValueAndValidity(d)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(d=>d._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((d,r)=>r._syncPendingControls()?!0:d,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((d,r)=>{n(d,r)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(d=>d.enabled&&n(d))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(let n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}};function Uk(a){return!!a&&(a.asyncValidators!==void 0||a.validators!==void 0||a.updateOn!==void 0)}var la=(()=>{let n=class n{constructor(){this.useNonNullable=!1}get nonNullable(){let r=new n;return r.useNonNullable=!0,r}group(r,s=null){let t=this._reduceControls(r),g={};return Uk(s)?g=s:s!==null&&(g.validators=s.validator,g.asyncValidators=s.asyncValidator),new bm(t,g)}record(r,s=null){let t=this._reduceControls(r);return new jC(t,s)}control(r,s,t){let g={};return this.useNonNullable?(Uk(s)?g=s:(g.validators=s,g.asyncValidators=t),new S_(r,Cn(kt({},g),{nonNullable:!0}))):new S_(r,s,t)}array(r,s,t){let g=r.map(b=>this._createControl(b));return new UC(g,s,t)}_reduceControls(r){let s={};return Object.keys(r).forEach(t=>{s[t]=this._createControl(r[t])}),s}_createControl(r){if(r instanceof S_)return r;if(r instanceof ym)return r;if(Array.isArray(r)){let s=r[0],t=r.length>1?r[1]:null,g=r.length>2?r[2]:null;return this.control(s,t,g)}else return this.control(r)}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var _A=(()=>{let n=class n{static withConfig(r){return{ngModule:n,providers:[{provide:T_,useValue:r.callSetDisabledState??uv}]}}};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[gA]});let a=n;return a})(),yA=(()=>{let n=class n{static withConfig(r){return{ngModule:n,providers:[{provide:dA,useValue:r.warnOnNgModelWithFormControl??"always"},{provide:T_,useValue:r.callSetDisabledState??uv}]}}};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[gA]});let a=n;return a})();var nN=(()=>{let n=class n extends $b{constructor(r,s,t){super(r,s,t,Nt(Rb,{optional:!0}))}ngOnDestroy(){this.flush()}};n.\u0275fac=function(s){return new(s||n)(Ye(Ai),Ye(m_),Ye(Gb))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})();function rN(){return new lk}function oN(a,n,d){return new dk(a,n,d)}var vA=[{provide:Gb,useFactory:rN},{provide:$b,useClass:nN},{provide:lm,useFactory:oN,deps:[gm,$b,di]}],bA=[{provide:m_,useFactory:()=>new ck},{provide:lo,useValue:"BrowserAnimations"},...vA],aN=[{provide:m_,useClass:sk},{provide:lo,useValue:"NoopAnimations"},...vA],xA=(()=>{let n=class n{static withConfig(r){return{ngModule:n,providers:r.disableAnimations?aN:bA}}};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({providers:bA,imports:[tv]});let a=n;return a})();var KC;try{KC=typeof Intl<"u"&&Intl.v8BreakIterator}catch{KC=!1}var qn=(()=>{let n=class n{constructor(r){this._platformId=r,this.isBrowser=this._platformId?ok(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||KC)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};n.\u0275fac=function(s){return new(s||n)(Ye($o))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var I_;function sN(){if(I_==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>I_=!0}))}finally{I_=I_||!1}return I_}function al(a){return sN()?a:!!a.capture}var xu;function wA(){if(xu==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return xu=!1,xu;if("scrollBehavior"in document.documentElement.style)xu=!0;else{let a=Element.prototype.scrollTo;a?xu=!/\{\s*\[native code\]\s*\}/.test(a.toString()):xu=!1}}return xu}var XC;function lN(){if(XC==null){let a=typeof document<"u"?document.head:null;XC=!!(a&&(a.createShadowRoot||a.attachShadow))}return XC}function CA(a){if(lN()){let n=a.getRootNode?a.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&n instanceof ShadowRoot)return n}return null}function wu(){let a=typeof document<"u"&&document?document.activeElement:null;for(;a&&a.shadowRoot;){let n=a.shadowRoot.activeElement;if(n===a)break;a=n}return a}function Ds(a){return a.composedPath?a.composedPath()[0]:a.target}function E_(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function xm(a,...n){return n.length?n.some(d=>a[d]):a.altKey||a.shiftKey||a.ctrlKey||a.metaKey}function D_(a,n=0){return cN(a)?Number(a):n}function cN(a){return!isNaN(parseFloat(a))&&!isNaN(Number(a))}function wm(a){return Array.isArray(a)?a:[a]}function Ar(a){return a==null?"":typeof a=="string"?a:`${a}px`}function ic(a){return a instanceof Zi?a.nativeElement:a}var dN=(()=>{let n=class n{create(r){return typeof MutationObserver>"u"?null:new MutationObserver(r)}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var mv=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({providers:[dN]});let a=n;return a})();var SA=new Set,Cu,hN=(()=>{let n=class n{constructor(r,s){this._platform=r,this._nonce=s,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):pN}matchMedia(r){return(this._platform.WEBKIT||this._platform.BLINK)&&uN(r,this._nonce),this._matchMedia(r)}};n.\u0275fac=function(s){return new(s||n)(Ye(qn),Ye(a_,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();function uN(a,n){if(!SA.has(a))try{Cu||(Cu=document.createElement("style"),n&&Cu.setAttribute("nonce",n),Cu.setAttribute("type","text/css"),document.head.appendChild(Cu)),Cu.sheet&&(Cu.sheet.insertRule(`@media ${a} {body{ }}`,0),SA.add(a))}catch(d){console.error(d)}}function pN(a){return{matches:a==="all"||a==="",media:a,addListener:()=>{},removeListener:()=>{}}}var TA=(()=>{let n=class n{constructor(r,s){this._mediaMatcher=r,this._zone=s,this._queries=new Map,this._destroySubject=new dn}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(r){return MA(wm(r)).some(t=>this._registerQuery(t).mql.matches)}observe(r){let t=MA(wm(r)).map(b=>this._registerQuery(b).observable),g=om(t);return g=am(g.pipe(ao(1)),g.pipe(Pb(1),lC(0))),g.pipe(pn(b=>{let M={matches:!1,breakpoints:{}};return b.forEach(({matches:k,query:L})=>{M.matches=M.matches||k,M.breakpoints[L]=k}),M}))}_registerQuery(r){if(this._queries.has(r))return this._queries.get(r);let s=this._mediaMatcher.matchMedia(r),g={observable:new Ro(b=>{let M=k=>this._zone.run(()=>b.next(k));return s.addListener(M),()=>{s.removeListener(M)}}).pipe(ka(s),pn(({matches:b})=>({query:r,matches:b})),Kl(this._destroySubject)),mql:s};return this._queries.set(r,g),g}};n.\u0275fac=function(s){return new(s||n)(Ye(hN),Ye(di))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();function MA(a){return a.map(n=>n.split(",")).reduce((n,d)=>n.concat(d)).map(n=>n.trim())}var k_=(()=>{let n=class n{constructor(r){this._platform=r}isDisabled(r){return r.hasAttribute("disabled")}isVisible(r){return fN(r)&&getComputedStyle(r).visibility==="visible"}isTabbable(r){if(!this._platform.isBrowser)return!1;let s=mN(CN(r));if(s&&(IA(s)===-1||!this.isVisible(s)))return!1;let t=r.nodeName.toLowerCase(),g=IA(r);return r.hasAttribute("contenteditable")?g!==-1:t==="iframe"||t==="object"||this._platform.WEBKIT&&this._platform.IOS&&!xN(r)?!1:t==="audio"?r.hasAttribute("controls")?g!==-1:!1:t==="video"?g===-1?!1:g!==null?!0:this._platform.FIREFOX||r.hasAttribute("controls"):r.tabIndex>=0}isFocusable(r,s){return wN(r)&&!this.isDisabled(r)&&(s?.ignoreVisibility||this.isVisible(r))}};n.\u0275fac=function(s){return new(s||n)(Ye(qn))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();function mN(a){try{return a.frameElement}catch{return null}}function fN(a){return!!(a.offsetWidth||a.offsetHeight||typeof a.getClientRects=="function"&&a.getClientRects().length)}function gN(a){let n=a.nodeName.toLowerCase();return n==="input"||n==="select"||n==="button"||n==="textarea"}function _N(a){return bN(a)&&a.type=="hidden"}function yN(a){return vN(a)&&a.hasAttribute("href")}function bN(a){return a.nodeName.toLowerCase()=="input"}function vN(a){return a.nodeName.toLowerCase()=="a"}function kA(a){if(!a.hasAttribute("tabindex")||a.tabIndex===void 0)return!1;let n=a.getAttribute("tabindex");return!!(n&&!isNaN(parseInt(n,10)))}function IA(a){if(!kA(a))return null;let n=parseInt(a.getAttribute("tabindex")||"",10);return isNaN(n)?-1:n}function xN(a){let n=a.nodeName.toLowerCase(),d=n==="input"&&a.type;return d==="text"||d==="password"||n==="select"||n==="textarea"}function wN(a){return _N(a)?!1:gN(a)||yN(a)||a.hasAttribute("contenteditable")||kA(a)}function CN(a){return a.ownerDocument&&a.ownerDocument.defaultView||window}var JC=class{get enabled(){return this._enabled}set enabled(n){this._enabled=n,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(n,this._startAnchor),this._toggleAnchorTabIndex(n,this._endAnchor))}constructor(n,d,r,s,t=!1){this._element=n,this._checker=d,this._ngZone=r,this._document=s,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,t||this.attachAnchors()}destroy(){let n=this._startAnchor,d=this._endAnchor;n&&(n.removeEventListener("focus",this.startAnchorListener),n.remove()),d&&(d.removeEventListener("focus",this.endAnchorListener),d.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(n){return new Promise(d=>{this._executeOnStable(()=>d(this.focusInitialElement(n)))})}focusFirstTabbableElementWhenReady(n){return new Promise(d=>{this._executeOnStable(()=>d(this.focusFirstTabbableElement(n)))})}focusLastTabbableElementWhenReady(n){return new Promise(d=>{this._executeOnStable(()=>d(this.focusLastTabbableElement(n)))})}_getRegionBoundary(n){let d=this._element.querySelectorAll(`[cdk-focus-region-${n}], [cdkFocusRegion${n}], [cdk-focus-${n}]`);return n=="start"?d.length?d[0]:this._getFirstTabbableElement(this._element):d.length?d[d.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(n){let d=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(d){if(!this._checker.isFocusable(d)){let r=this._getFirstTabbableElement(d);return r?.focus(n),!!r}return d.focus(n),!0}return this.focusFirstTabbableElement(n)}focusFirstTabbableElement(n){let d=this._getRegionBoundary("start");return d&&d.focus(n),!!d}focusLastTabbableElement(n){let d=this._getRegionBoundary("end");return d&&d.focus(n),!!d}hasAttached(){return this._hasAttached}_getFirstTabbableElement(n){if(this._checker.isFocusable(n)&&this._checker.isTabbable(n))return n;let d=n.children;for(let r=0;r<d.length;r++){let s=d[r].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(d[r]):null;if(s)return s}return null}_getLastTabbableElement(n){if(this._checker.isFocusable(n)&&this._checker.isTabbable(n))return n;let d=n.children;for(let r=d.length-1;r>=0;r--){let s=d[r].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(d[r]):null;if(s)return s}return null}_createAnchor(){let n=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,n),n.classList.add("cdk-visually-hidden"),n.classList.add("cdk-focus-trap-anchor"),n.setAttribute("aria-hidden","true"),n}_toggleAnchorTabIndex(n,d){n?d.setAttribute("tabindex","0"):d.removeAttribute("tabindex")}toggleAnchors(n){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(n,this._startAnchor),this._toggleAnchorTabIndex(n,this._endAnchor))}_executeOnStable(n){this._ngZone.isStable?n():this._ngZone.onStable.pipe(ao(1)).subscribe(n)}},A_=(()=>{let n=class n{constructor(r,s,t){this._checker=r,this._ngZone=s,this._document=t}create(r,s=!1){return new JC(r,this._checker,this._ngZone,this._document,s)}};n.\u0275fac=function(s){return new(s||n)(Ye(k_),Ye(di),Ye(Ai))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),AA=(()=>{let n=class n{get enabled(){return this.focusTrap?.enabled||!1}set enabled(r){this.focusTrap&&(this.focusTrap.enabled=r)}constructor(r,s,t){this._elementRef=r,this._focusTrapFactory=s,this._previouslyFocusedElement=null,Nt(qn).isBrowser&&(this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0))}ngOnDestroy(){this.focusTrap?.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap?.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap&&!this.focusTrap.hasAttached()&&this.focusTrap.attachAnchors()}ngOnChanges(r){let s=r.autoCapture;s&&!s.firstChange&&this.autoCapture&&this.focusTrap?.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=wu(),this.focusTrap?.focusInitialElementWhenReady()}};n.\u0275fac=function(s){return new(s||n)(ge(Zi),ge(A_),ge(Ai))},n.\u0275dir=Ei({type:n,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:[bi.HasDecoratorInputTransform,"cdkTrapFocus","enabled",sr],autoCapture:[bi.HasDecoratorInputTransform,"cdkTrapFocusAutoCapture","autoCapture",sr]},exportAs:["cdkTrapFocus"],standalone:!0,features:[co,ar]});let a=n;return a})();function eS(a){return a.buttons===0||a.detail===0}function tS(a){let n=a.touches&&a.touches[0]||a.changedTouches&&a.changedTouches[0];return!!n&&n.identifier===-1&&(n.radiusX==null||n.radiusX===1)&&(n.radiusY==null||n.radiusY===1)}var SN=new Qt("cdk-input-modality-detector-options"),MN={ignoreKeys:[18,17,224,91,16]},PA=650,Cm=al({passive:!0,capture:!0}),TN=(()=>{let n=class n{get mostRecentModality(){return this._modality.value}constructor(r,s,t,g){this._platform=r,this._mostRecentTarget=null,this._modality=new aa(null),this._lastTouchMs=0,this._onKeydown=b=>{this._options?.ignoreKeys?.some(M=>M===b.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Ds(b))},this._onMousedown=b=>{Date.now()-this._lastTouchMs<PA||(this._modality.next(eS(b)?"keyboard":"mouse"),this._mostRecentTarget=Ds(b))},this._onTouchstart=b=>{if(tS(b)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Ds(b)},this._options=kt(kt({},MN),g),this.modalityDetected=this._modality.pipe(Pb(1)),this.modalityChanged=this.modalityDetected.pipe(cC()),r.isBrowser&&s.runOutsideAngular(()=>{t.addEventListener("keydown",this._onKeydown,Cm),t.addEventListener("mousedown",this._onMousedown,Cm),t.addEventListener("touchstart",this._onTouchstart,Cm)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Cm),document.removeEventListener("mousedown",this._onMousedown,Cm),document.removeEventListener("touchstart",this._onTouchstart,Cm))}};n.\u0275fac=function(s){return new(s||n)(Ye(qn),Ye(di),Ye(Ai),Ye(SN,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var gv=function(a){return a[a.IMMEDIATE=0]="IMMEDIATE",a[a.EVENTUAL=1]="EVENTUAL",a}(gv||{}),IN=new Qt("cdk-focus-monitor-default-options"),fv=al({passive:!0,capture:!0}),nc=(()=>{let n=class n{constructor(r,s,t,g,b){this._ngZone=r,this._platform=s,this._inputModalityDetector=t,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new dn,this._rootNodeFocusAndBlurListener=M=>{let k=Ds(M);for(let L=k;L;L=L.parentElement)M.type==="focus"?this._onFocus(M,L):this._onBlur(M,L)},this._document=g,this._detectionMode=b?.detectionMode||gv.IMMEDIATE}monitor(r,s=!1){let t=ic(r);if(!this._platform.isBrowser||t.nodeType!==1)return Jt();let g=CA(t)||this._getDocument(),b=this._elementInfo.get(t);if(b)return s&&(b.checkChildren=!0),b.subject;let M={checkChildren:s,subject:new dn,rootNode:g};return this._elementInfo.set(t,M),this._registerGlobalListeners(M),M.subject}stopMonitoring(r){let s=ic(r),t=this._elementInfo.get(s);t&&(t.subject.complete(),this._setClasses(s),this._elementInfo.delete(s),this._removeGlobalListeners(t))}focusVia(r,s,t){let g=ic(r),b=this._getDocument().activeElement;g===b?this._getClosestElementsInfo(g).forEach(([M,k])=>this._originChanged(M,s,k)):(this._setOrigin(s),typeof g.focus=="function"&&g.focus(t))}ngOnDestroy(){this._elementInfo.forEach((r,s)=>this.stopMonitoring(s))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(r){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(r)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:r&&this._isLastInteractionFromInputLabel(r)?"mouse":"program"}_shouldBeAttributedToTouch(r){return this._detectionMode===gv.EVENTUAL||!!r?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(r,s){r.classList.toggle("cdk-focused",!!s),r.classList.toggle("cdk-touch-focused",s==="touch"),r.classList.toggle("cdk-keyboard-focused",s==="keyboard"),r.classList.toggle("cdk-mouse-focused",s==="mouse"),r.classList.toggle("cdk-program-focused",s==="program")}_setOrigin(r,s=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=r,this._originFromTouchInteraction=r==="touch"&&s,this._detectionMode===gv.IMMEDIATE){clearTimeout(this._originTimeoutId);let t=this._originFromTouchInteraction?PA:1;this._originTimeoutId=setTimeout(()=>this._origin=null,t)}})}_onFocus(r,s){let t=this._elementInfo.get(s),g=Ds(r);!t||!t.checkChildren&&s!==g||this._originChanged(s,this._getFocusOrigin(g),t)}_onBlur(r,s){let t=this._elementInfo.get(s);!t||t.checkChildren&&r.relatedTarget instanceof Node&&s.contains(r.relatedTarget)||(this._setClasses(s),this._emitOrigin(t,null))}_emitOrigin(r,s){r.subject.observers.length&&this._ngZone.run(()=>r.subject.next(s))}_registerGlobalListeners(r){if(!this._platform.isBrowser)return;let s=r.rootNode,t=this._rootNodeFocusListenerCount.get(s)||0;t||this._ngZone.runOutsideAngular(()=>{s.addEventListener("focus",this._rootNodeFocusAndBlurListener,fv),s.addEventListener("blur",this._rootNodeFocusAndBlurListener,fv)}),this._rootNodeFocusListenerCount.set(s,t+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Kl(this._stopInputModalityDetector)).subscribe(g=>{this._setOrigin(g,!0)}))}_removeGlobalListeners(r){let s=r.rootNode;if(this._rootNodeFocusListenerCount.has(s)){let t=this._rootNodeFocusListenerCount.get(s);t>1?this._rootNodeFocusListenerCount.set(s,t-1):(s.removeEventListener("focus",this._rootNodeFocusAndBlurListener,fv),s.removeEventListener("blur",this._rootNodeFocusAndBlurListener,fv),this._rootNodeFocusListenerCount.delete(s))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(r,s,t){this._setClasses(r,s),this._emitOrigin(t,s),this._lastFocusOrigin=s}_getClosestElementsInfo(r){let s=[];return this._elementInfo.forEach((t,g)=>{(g===r||t.checkChildren&&g.contains(r))&&s.push([g,t])}),s}_isLastInteractionFromInputLabel(r){let{_mostRecentTarget:s,mostRecentModality:t}=this._inputModalityDetector;if(t!=="mouse"||!s||s===r||r.nodeName!=="INPUT"&&r.nodeName!=="TEXTAREA"||r.disabled)return!1;let g=r.labels;if(g){for(let b=0;b<g.length;b++)if(g[b].contains(s))return!0}return!1}};n.\u0275fac=function(s){return new(s||n)(Ye(di),Ye(qn),Ye(TN),Ye(Ai,8),Ye(IN,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),OA=(()=>{let n=class n{constructor(r,s){this._elementRef=r,this._focusMonitor=s,this._focusOrigin=null,this.cdkFocusChange=new Ii}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){let r=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(r,r.nodeType===1&&r.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(s=>{this._focusOrigin=s,this.cdkFocusChange.emit(s)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}};n.\u0275fac=function(s){return new(s||n)(ge(Zi),ge(nc))},n.\u0275dir=Ei({type:n,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"],standalone:!0});let a=n;return a})(),Su=function(a){return a[a.NONE=0]="NONE",a[a.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",a[a.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",a}(Su||{}),EA="cdk-high-contrast-black-on-white",DA="cdk-high-contrast-white-on-black",QC="cdk-high-contrast-active",iS=(()=>{let n=class n{constructor(r,s){this._platform=r,this._document=s,this._breakpointSubscription=Nt(TA).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return Su.NONE;let r=this._document.createElement("div");r.style.backgroundColor="rgb(1,2,3)",r.style.position="absolute",this._document.body.appendChild(r);let s=this._document.defaultView||window,t=s&&s.getComputedStyle?s.getComputedStyle(r):null,g=(t&&t.backgroundColor||"").replace(/ /g,"");switch(r.remove(),g){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return Su.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return Su.BLACK_ON_WHITE}return Su.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let r=this._document.body.classList;r.remove(QC,EA,DA),this._hasCheckedHighContrastMode=!0;let s=this.getHighContrastMode();s===Su.BLACK_ON_WHITE?r.add(QC,EA):s===Su.WHITE_ON_BLACK&&r.add(QC,DA)}}};n.\u0275fac=function(s){return new(s||n)(Ye(qn),Ye(Ai))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),_v=(()=>{let n=class n{constructor(r){r._applyBodyHighContrastModeCssClasses()}};n.\u0275fac=function(s){return new(s||n)(Ye(iS))},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[mv]});let a=n;return a})();var EN=new Qt("cdk-dir-doc",{providedIn:"root",factory:DN});function DN(){return Nt(Ai)}var kN=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function AN(a){let n=a?.toLowerCase()||"";return n==="auto"&&typeof navigator<"u"&&navigator?.language?kN.test(navigator.language)?"rtl":"ltr":n==="rtl"?"rtl":"ltr"}var rc=(()=>{let n=class n{constructor(r){if(this.value="ltr",this.change=new Ii,r){let s=r.body?r.body.dir:null,t=r.documentElement?r.documentElement.dir:null;this.value=AN(s||t||"ltr")}}ngOnDestroy(){this.change.complete()}};n.\u0275fac=function(s){return new(s||n)(Ye(EN,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var Nd=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({});let a=n;return a})();var PN=["mat-internal-form-field",""],ON=["*"];function RN(){return!0}var FN=new Qt("mat-sanity-checks",{providedIn:"root",factory:RN}),Un=(()=>{let n=class n{constructor(r,s,t){this._sanityChecks=s,this._document=t,this._hasDoneGlobalChecks=!1,r._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(r){return E_()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[r]}};n.\u0275fac=function(s){return new(s||n)(Ye(iS),Ye(FN,8),Ye(Ai))},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[Nd,Nd]});let a=n;return a})();var FA=new Qt("MAT_DATE_LOCALE",{providedIn:"root",factory:LN});function LN(){return Nt(qD)}var ca=class{constructor(){this._localeChanges=new dn,this.localeChanges=this._localeChanges}getValidDateOrNull(n){return this.isDateInstance(n)&&this.isValid(n)?n:null}deserialize(n){return n==null||this.isDateInstance(n)&&this.isValid(n)?n:this.invalid()}setLocale(n){this.locale=n,this._localeChanges.next()}compareDate(n,d){return this.getYear(n)-this.getYear(d)||this.getMonth(n)-this.getMonth(d)||this.getDate(n)-this.getDate(d)}sameDate(n,d){if(n&&d){let r=this.isValid(n),s=this.isValid(d);return r&&s?!this.compareDate(n,d):r==s}return n==d}clampDate(n,d,r){return d&&this.compareDate(n,d)<0?d:r&&this.compareDate(n,r)>0?r:n}},Sm=new Qt("mat-date-formats"),zN=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function nS(a,n){let d=Array(a);for(let r=0;r<a;r++)d[r]=n(r);return d}var BN=(()=>{let n=class n extends ca{constructor(r){super(),this.useUtcForDisplay=!1,this._matDateLocale=Nt(FA,{optional:!0}),r!==void 0&&(this._matDateLocale=r),super.setLocale(this._matDateLocale)}getYear(r){return r.getFullYear()}getMonth(r){return r.getMonth()}getDate(r){return r.getDate()}getDayOfWeek(r){return r.getDay()}getMonthNames(r){let s=new Intl.DateTimeFormat(this.locale,{month:r,timeZone:"utc"});return nS(12,t=>this._format(s,new Date(2017,t,1)))}getDateNames(){let r=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return nS(31,s=>this._format(r,new Date(2017,0,s+1)))}getDayOfWeekNames(r){let s=new Intl.DateTimeFormat(this.locale,{weekday:r,timeZone:"utc"});return nS(7,t=>this._format(s,new Date(2017,0,t+1)))}getYearName(r){let s=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(s,r)}getFirstDayOfWeek(){return 0}getNumDaysInMonth(r){return this.getDate(this._createDateWithOverflow(this.getYear(r),this.getMonth(r)+1,0))}clone(r){return new Date(r.getTime())}createDate(r,s,t){let g=this._createDateWithOverflow(r,s,t);return g.getMonth()!=s,g}today(){return new Date}parse(r,s){return typeof r=="number"?new Date(r):r?new Date(Date.parse(r)):null}format(r,s){if(!this.isValid(r))throw Error("NativeDateAdapter: Cannot format invalid date.");let t=new Intl.DateTimeFormat(this.locale,Cn(kt({},s),{timeZone:"utc"}));return this._format(t,r)}addCalendarYears(r,s){return this.addCalendarMonths(r,s*12)}addCalendarMonths(r,s){let t=this._createDateWithOverflow(this.getYear(r),this.getMonth(r)+s,this.getDate(r));return this.getMonth(t)!=((this.getMonth(r)+s)%12+12)%12&&(t=this._createDateWithOverflow(this.getYear(t),this.getMonth(t),0)),t}addCalendarDays(r,s){return this._createDateWithOverflow(this.getYear(r),this.getMonth(r),this.getDate(r)+s)}toIso8601(r){return[r.getUTCFullYear(),this._2digit(r.getUTCMonth()+1),this._2digit(r.getUTCDate())].join("-")}deserialize(r){if(typeof r=="string"){if(!r)return null;if(zN.test(r)){let s=new Date(r);if(this.isValid(s))return s}}return super.deserialize(r)}isDateInstance(r){return r instanceof Date}isValid(r){return!isNaN(r.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(r,s,t){let g=new Date;return g.setFullYear(r,s,t),g.setHours(0,0,0,0),g}_2digit(r){return("00"+r).slice(-2)}_format(r,s){let t=new Date;return t.setUTCFullYear(s.getFullYear(),s.getMonth(),s.getDate()),t.setUTCHours(s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()),r.format(t)}};n.\u0275fac=function(s){return new(s||n)(Ye(FA,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})(),NN={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};var WA=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({providers:[VN()]});let a=n;return a})();function VN(a=NN){return[{provide:ca,useClass:BN},{provide:Sm,useValue:a}]}var es=function(a){return a[a.FADING_IN=0]="FADING_IN",a[a.VISIBLE=1]="VISIBLE",a[a.FADING_OUT=2]="FADING_OUT",a[a.HIDDEN=3]="HIDDEN",a}(es||{}),aS=class{constructor(n,d,r,s=!1){this._renderer=n,this.element=d,this.config=r,this._animationForciblyDisabledThroughCss=s,this.state=es.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},LA=al({passive:!0,capture:!0}),sS=class{constructor(){this._events=new Map,this._delegateEventHandler=n=>{let d=Ds(n);d&&this._events.get(n.type)?.forEach((r,s)=>{(s===d||s.contains(d))&&r.forEach(t=>t.handleEvent(n))})}}addHandler(n,d,r,s){let t=this._events.get(d);if(t){let g=t.get(r);g?g.add(s):t.set(r,new Set([s]))}else this._events.set(d,new Map([[r,new Set([s])]])),n.runOutsideAngular(()=>{document.addEventListener(d,this._delegateEventHandler,LA)})}removeHandler(n,d,r){let s=this._events.get(n);if(!s)return;let t=s.get(d);t&&(t.delete(r),t.size===0&&s.delete(d),s.size===0&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,LA)))}},zA={enterDuration:225,exitDuration:150},jN=800,BA=al({passive:!0,capture:!0}),NA=["mousedown","touchstart"],VA=["mouseup","mouseleave","touchend","touchcancel"],P_=class P_{constructor(n,d,r,s){this._target=n,this._ngZone=d,this._platform=s,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,s.isBrowser&&(this._containerElement=ic(r))}fadeInRipple(n,d,r={}){let s=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),t=kt(kt({},zA),r.animation);r.centered&&(n=s.left+s.width/2,d=s.top+s.height/2);let g=r.radius||UN(n,d,s),b=n-s.left,M=d-s.top,k=t.enterDuration,L=document.createElement("div");L.classList.add("mat-ripple-element"),L.style.left=`${b-g}px`,L.style.top=`${M-g}px`,L.style.height=`${g*2}px`,L.style.width=`${g*2}px`,r.color!=null&&(L.style.backgroundColor=r.color),L.style.transitionDuration=`${k}ms`,this._containerElement.appendChild(L);let G=window.getComputedStyle(L),J=G.transitionProperty,oe=G.transitionDuration,be=J==="none"||oe==="0s"||oe==="0s, 0s"||s.width===0&&s.height===0,Me=new aS(this,L,r,be);L.style.transform="scale3d(1, 1, 1)",Me.state=es.FADING_IN,r.persistent||(this._mostRecentTransientRipple=Me);let Te=null;return!be&&(k||t.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let He=()=>this._finishRippleTransition(Me),We=()=>this._destroyRipple(Me);L.addEventListener("transitionend",He),L.addEventListener("transitioncancel",We),Te={onTransitionEnd:He,onTransitionCancel:We}}),this._activeRipples.set(Me,Te),(be||!k)&&this._finishRippleTransition(Me),Me}fadeOutRipple(n){if(n.state===es.FADING_OUT||n.state===es.HIDDEN)return;let d=n.element,r=kt(kt({},zA),n.config.animation);d.style.transitionDuration=`${r.exitDuration}ms`,d.style.opacity="0",n.state=es.FADING_OUT,(n._animationForciblyDisabledThroughCss||!r.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){let d=ic(n);!this._platform.isBrowser||!d||d===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=d,NA.forEach(r=>{P_._eventManager.addHandler(this._ngZone,r,d,this)}))}handleEvent(n){n.type==="mousedown"?this._onMousedown(n):n.type==="touchstart"?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{VA.forEach(d=>{this._triggerElement.addEventListener(d,this,BA)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){n.state===es.FADING_IN?this._startFadeOutTransition(n):n.state===es.FADING_OUT&&this._destroyRipple(n)}_startFadeOutTransition(n){let d=n===this._mostRecentTransientRipple,{persistent:r}=n.config;n.state=es.VISIBLE,!r&&(!d||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){let d=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=es.HIDDEN,d!==null&&(n.element.removeEventListener("transitionend",d.onTransitionEnd),n.element.removeEventListener("transitioncancel",d.onTransitionCancel)),n.element.remove()}_onMousedown(n){let d=eS(n),r=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+jN;!this._target.rippleDisabled&&!d&&!r&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!tS(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let d=n.changedTouches;if(d)for(let r=0;r<d.length;r++)this.fadeInRipple(d[r].clientX,d[r].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{let d=n.state===es.VISIBLE||n.config.terminateOnPointerUp&&n.state===es.FADING_IN;!n.config.persistent&&d&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let n=this._triggerElement;n&&(NA.forEach(d=>P_._eventManager.removeHandler(d,n,this)),this._pointerUpEventsRegistered&&(VA.forEach(d=>n.removeEventListener(d,this,BA)),this._pointerUpEventsRegistered=!1))}};P_._eventManager=new sS;var lS=P_;function UN(a,n,d){let r=Math.max(Math.abs(a-d.left),Math.abs(a-d.right)),s=Math.max(Math.abs(n-d.top),Math.abs(n-d.bottom));return Math.sqrt(r*r+s*s)}var cS=new Qt("mat-ripple-global-options"),vv=(()=>{let n=class n{get disabled(){return this._disabled}set disabled(r){r&&this.fadeOutAllNonPersistent(),this._disabled=r,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(r){this._trigger=r,this._setupTriggerEventsIfEnabled()}constructor(r,s,t,g,b){this._elementRef=r,this._animationMode=b,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=g||{},this._rippleRenderer=new lS(this,s,r,t)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:kt(kt(kt({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(r,s=0,t){return typeof r=="number"?this._rippleRenderer.fadeInRipple(r,s,kt(kt({},this.rippleConfig),t)):this._rippleRenderer.fadeInRipple(0,0,kt(kt({},this.rippleConfig),r))}};n.\u0275fac=function(s){return new(s||n)(ge(Zi),ge(di),ge(qn),ge(cS,8),ge(lo,8))},n.\u0275dir=Ei({type:n,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(s,t){s&2&&Ni("mat-ripple-unbounded",t.unbounded)},inputs:{color:[bi.None,"matRippleColor","color"],unbounded:[bi.None,"matRippleUnbounded","unbounded"],centered:[bi.None,"matRippleCentered","centered"],radius:[bi.None,"matRippleRadius","radius"],animation:[bi.None,"matRippleAnimation","animation"],disabled:[bi.None,"matRippleDisabled","disabled"],trigger:[bi.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let a=n;return a})(),GA=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[Un,Un]});let a=n;return a})();var jA={capture:!0},UA=["focus","click","mouseenter","touchstart"],rS="mat-ripple-loader-uninitialized",oS="mat-ripple-loader-class-name",HA="mat-ripple-loader-centered",bv="mat-ripple-loader-disabled",$A=(()=>{let n=class n{constructor(){this._document=Nt(Ai,{optional:!0}),this._animationMode=Nt(lo,{optional:!0}),this._globalRippleOptions=Nt(cS,{optional:!0}),this._platform=Nt(qn),this._ngZone=Nt(di),this._hosts=new Map,this._onInteraction=r=>{if(!(r.target instanceof HTMLElement))return;let t=r.target.closest(`[${rS}]`);t&&this._createRipple(t)},this._ngZone.runOutsideAngular(()=>{for(let r of UA)this._document?.addEventListener(r,this._onInteraction,jA)})}ngOnDestroy(){let r=this._hosts.keys();for(let s of r)this.destroyRipple(s);for(let s of UA)this._document?.removeEventListener(s,this._onInteraction,jA)}configureRipple(r,s){r.setAttribute(rS,""),(s.className||!r.hasAttribute(oS))&&r.setAttribute(oS,s.className||""),s.centered&&r.setAttribute(HA,""),s.disabled&&r.setAttribute(bv,"")}getRipple(r){return this._hosts.get(r)||this._createRipple(r)}setDisabled(r,s){let t=this._hosts.get(r);if(t){t.disabled=s;return}s?r.setAttribute(bv,""):r.removeAttribute(bv)}_createRipple(r){if(!this._document)return;let s=this._hosts.get(r);if(s)return s;r.querySelector(".mat-ripple")?.remove();let t=this._document.createElement("span");t.classList.add("mat-ripple",r.getAttribute(oS)),r.append(t);let g=new vv(new Zi(t),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return g._isInitialized=!0,g.trigger=r,g.centered=r.hasAttribute(HA),g.disabled=r.hasAttribute(bv),this.attachRipple(r,g),g}attachRipple(r,s){r.removeAttribute(rS),this._hosts.set(r,s)}destroyRipple(r){let s=this._hosts.get(r);s&&(s.ngOnDestroy(),this._hosts.delete(r))}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),qA=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275cmp=gt({type:n,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(s,t){s&2&&Ni("mdc-form-field--align-end",t.labelPosition==="before")},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[Bn],attrs:PN,ngContentSelectors:ON,decls:1,vars:0,template:function(s,t){s&1&&(sa(),zo(0))},styles:[".mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-form-field{font-family:var(--mdc-form-field-label-text-font);line-height:var(--mdc-form-field-label-text-line-height);font-size:var(--mdc-form-field-label-text-size);font-weight:var(--mdc-form-field-label-text-weight);letter-spacing:var(--mdc-form-field-label-text-tracking);color:var(--mdc-form-field-label-text-color)}.mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}"],encapsulation:2,changeDetection:0});let a=n;return a})();var YA=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[Un]});let a=n;return a})();var ZA=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({});let a=n;return a})();var dS=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[Un,ol,mv,Un]});let a=n;return a})();var XA=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[Un,dS,dS,ZA,Un]});let a=n;return a})();var KA=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[Un,ol,Un]});let a=n;return a})();var QA=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[ol,Un]});let a=n;return a})();var O_=class{attach(n){return this._attachedHost=n,n.attach(this)}detach(){let n=this._attachedHost;n!=null&&(this._attachedHost=null,n.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(n){this._attachedHost=n}},Vd=class extends O_{constructor(n,d,r,s,t){super(),this.component=n,this.viewContainerRef=d,this.injector=r,this.componentFactoryResolver=s,this.projectableNodes=t}},Mu=class extends O_{constructor(n,d,r,s){super(),this.templateRef=n,this.viewContainerRef=d,this.context=r,this.injector=s}get origin(){return this.templateRef.elementRef}attach(n,d=this.context){return this.context=d,super.attach(n)}detach(){return this.context=void 0,super.detach()}},hS=class extends O_{constructor(n){super(),this.element=n instanceof Zi?n.nativeElement:n}},Mm=class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(n){if(n instanceof Vd)return this._attachedPortal=n,this.attachComponentPortal(n);if(n instanceof Mu)return this._attachedPortal=n,this.attachTemplatePortal(n);if(this.attachDomPortal&&n instanceof hS)return this._attachedPortal=n,this.attachDomPortal(n)}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(n){this._disposeFn=n}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var xv=class extends Mm{constructor(n,d,r,s,t){super(),this.outletElement=n,this._componentFactoryResolver=d,this._appRef=r,this._defaultInjector=s,this.attachDomPortal=g=>{this._document;let b=g.element;b.parentNode;let M=this._document.createComment("dom-portal");b.parentNode.insertBefore(M,b),this.outletElement.appendChild(b),this._attachedPortal=g,super.setDisposeFn(()=>{M.parentNode&&M.parentNode.replaceChild(b,M)})},this._document=t}attachComponentPortal(n){let r=(n.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(n.component),s;return n.viewContainerRef?(s=n.viewContainerRef.createComponent(r,n.viewContainerRef.length,n.injector||n.viewContainerRef.injector,n.projectableNodes||void 0),this.setDisposeFn(()=>s.destroy())):(s=r.create(n.injector||this._defaultInjector||Lo.NULL),this._appRef.attachView(s.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(s.hostView),s.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(s)),this._attachedPortal=n,s}attachTemplatePortal(n){let d=n.viewContainerRef,r=d.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return r.rootNodes.forEach(s=>this.outletElement.appendChild(s)),r.detectChanges(),this.setDisposeFn(()=>{let s=d.indexOf(r);s!==-1&&d.remove(s)}),this._attachedPortal=n,r}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(n){return n.hostView.rootNodes[0]}};var jd=(()=>{let n=class n extends Mm{constructor(r,s,t){super(),this._componentFactoryResolver=r,this._viewContainerRef=s,this._isInitialized=!1,this.attached=new Ii,this.attachDomPortal=g=>{this._document;let b=g.element;b.parentNode;let M=this._document.createComment("dom-portal");g.setAttachedHost(this),b.parentNode.insertBefore(M,b),this._getRootNode().appendChild(b),this._attachedPortal=g,super.setDisposeFn(()=>{M.parentNode&&M.parentNode.replaceChild(b,M)})},this._document=t}get portal(){return this._attachedPortal}set portal(r){this.hasAttached()&&!r&&!this._isInitialized||(this.hasAttached()&&super.detach(),r&&super.attach(r),this._attachedPortal=r||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(r){r.setAttachedHost(this);let s=r.viewContainerRef!=null?r.viewContainerRef:this._viewContainerRef,g=(r.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(r.component),b=s.createComponent(g,s.length,r.injector||s.injector,r.projectableNodes||void 0);return s!==this._viewContainerRef&&this._getRootNode().appendChild(b.hostView.rootNodes[0]),super.setDisposeFn(()=>b.destroy()),this._attachedPortal=r,this._attachedRef=b,this.attached.emit(b),b}attachTemplatePortal(r){r.setAttachedHost(this);let s=this._viewContainerRef.createEmbeddedView(r.templateRef,r.context,{injector:r.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=r,this._attachedRef=s,this.attached.emit(s),s}_getRootNode(){let r=this._viewContainerRef.element.nativeElement;return r.nodeType===r.ELEMENT_NODE?r:r.parentNode}};n.\u0275fac=function(s){return new(s||n)(ge(l_),ge(Od),ge(Ai))},n.\u0275dir=Ei({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[bi.None,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],standalone:!0,features:[zn]});let a=n;return a})();var oc=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({});let a=n;return a})();var $N=20,JA=(()=>{let n=class n{constructor(r,s,t){this._ngZone=r,this._platform=s,this._scrolled=new dn,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=t}register(r){this.scrollContainers.has(r)||this.scrollContainers.set(r,r.elementScrolled().subscribe(()=>this._scrolled.next(r)))}deregister(r){let s=this.scrollContainers.get(r);s&&(s.unsubscribe(),this.scrollContainers.delete(r))}scrolled(r=$N){return this._platform.isBrowser?new Ro(s=>{this._globalSubscription||this._addGlobalListener();let t=r>0?this._scrolled.pipe(sC(r)).subscribe(s):this._scrolled.subscribe(s);return this._scrolledCount++,()=>{t.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Jt()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((r,s)=>this.deregister(s)),this._scrolled.complete()}ancestorScrolled(r,s){let t=this.getAncestorScrollContainers(r);return this.scrolled(s).pipe(wr(g=>!g||t.indexOf(g)>-1))}getAncestorScrollContainers(r){let s=[];return this.scrollContainers.forEach((t,g)=>{this._scrollableContainsElement(g,r)&&s.push(g)}),s}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(r,s){let t=ic(s),g=r.getElementRef().nativeElement;do if(t==g)return!0;while(t=t.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let r=this._getWindow();return OD(r.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};n.\u0275fac=function(s){return new(s||n)(Ye(di),Ye(qn),Ye(Ai,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var qN=20,uS=(()=>{let n=class n{constructor(r,s,t){this._platform=r,this._change=new dn,this._changeListener=g=>{this._change.next(g)},this._document=t,s.runOutsideAngular(()=>{if(r.isBrowser){let g=this._getWindow();g.addEventListener("resize",this._changeListener),g.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let r=this._getWindow();r.removeEventListener("resize",this._changeListener),r.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let r={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),r}getViewportRect(){let r=this.getViewportScrollPosition(),{width:s,height:t}=this.getViewportSize();return{top:r.top,left:r.left,bottom:r.top+t,right:r.left+s,height:t,width:s}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let r=this._document,s=this._getWindow(),t=r.documentElement,g=t.getBoundingClientRect(),b=-g.top||r.body.scrollTop||s.scrollY||t.scrollTop||0,M=-g.left||r.body.scrollLeft||s.scrollX||t.scrollLeft||0;return{top:b,left:M}}change(r=qN){return r>0?this._change.pipe(sC(r)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let r=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:r.innerWidth,height:r.innerHeight}:{width:0,height:0}}};n.\u0275fac=function(s){return new(s||n)(Ye(qn),Ye(di),Ye(Ai,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var wv=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({});let a=n;return a})(),pS=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[Nd,wv,Nd,wv]});let a=n;return a})();var eP=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[Un,Un]});let a=n;return a})();var ZN=["switch"],XN=["*"];function KN(a,n){a&1&&(V(0,"div",10),kd(),V(1,"svg",12),Ee(2,"path",13),j(),V(3,"svg",14),Ee(4,"path",15),j()())}var QN=new Qt("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1})}),JN={provide:ec,useExisting:Fo(()=>Sv),multi:!0},Cv=class{constructor(n,d){this.source=n,this.checked=d}},eV=0,Sv=(()=>{let n=class n{_createChangeEvent(r){return new Cv(this,r)}get buttonId(){return`${this.id||this._uniqueId}-button`}focus(){this._switchElement.nativeElement.focus()}get checked(){return this._checked}set checked(r){this._checked=r,this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(r,s,t,g,b,M){this._elementRef=r,this._focusMonitor=s,this._changeDetectorRef=t,this.defaults=b,this._onChange=k=>{},this._onTouched=()=>{},this._validatorOnChange=()=>{},this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.change=new Ii,this.toggleChange=new Ii,this.tabIndex=parseInt(g)||0,this.color=b.color||"accent",this._noopAnimations=M==="NoopAnimations",this.id=this._uniqueId=`mat-mdc-slide-toggle-${++eV}`,this.hideIcon=b.hideIcon??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(r=>{r==="keyboard"||r==="program"?(this._focused=!0,this._changeDetectorRef.markForCheck()):r||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(r){r.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(r){this.checked=!!r}registerOnChange(r){this._onChange=r}registerOnTouched(r){this._onTouched=r}validate(r){return this.required&&r.value!==!0?{required:!0}:null}registerOnValidatorChange(r){this._validatorOnChange=r}setDisabledState(r){this.disabled=r,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new Cv(this,this.checked)))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}};n.\u0275fac=function(s){return new(s||n)(ge(Zi),ge(nc),ge(_r),Ad("tabindex"),ge(QN),ge(lo,8))},n.\u0275cmp=gt({type:n,selectors:[["mat-slide-toggle"]],viewQuery:function(s,t){if(s&1&&ki(ZN,5),s&2){let g;Ci(g=Si())&&(t._switchElement=g.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(s,t){s&2&&(Ql("id",t.id),hn("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),Ms(t.color?"mat-"+t.color:""),Ni("mat-mdc-slide-toggle-focused",t._focused)("mat-mdc-slide-toggle-checked",t.checked)("_mat-animation-noopable",t._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[bi.None,"aria-label","ariaLabel"],ariaLabelledby:[bi.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[bi.None,"aria-describedby","ariaDescribedby"],required:[bi.HasDecoratorInputTransform,"required","required",sr],color:"color",disabled:[bi.HasDecoratorInputTransform,"disabled","disabled",sr],disableRipple:[bi.HasDecoratorInputTransform,"disableRipple","disableRipple",sr],tabIndex:[bi.HasDecoratorInputTransform,"tabIndex","tabIndex",r=>r==null?0:CC(r)],checked:[bi.HasDecoratorInputTransform,"checked","checked",sr],hideIcon:[bi.HasDecoratorInputTransform,"hideIcon","hideIcon",sr]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],standalone:!0,features:[gr([JN,{provide:Bd,useExisting:n,multi:!0}]),co,ar,Bn],ngContentSelectors:XN,decls:13,vars:24,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(s,t){if(s&1){let g=gi();sa(),V(0,"div",1)(1,"button",2,0),Fe("click",function(){return Mt(g),Tt(t._handleClick())}),Ee(3,"div",3),V(4,"div",4)(5,"div",5)(6,"div",6),Ee(7,"div",7),j(),V(8,"div",8),Ee(9,"div",9),j(),Zt(10,KN,5,0,"div",10),j()()(),V(11,"label",11),Fe("click",function(M){return Mt(g),Tt(M.stopPropagation())}),zo(12),j()()}if(s&2){let g=Ts(2);rt("labelPosition",t.labelPosition),xe(),Ni("mdc-switch--selected",t.checked)("mdc-switch--unselected",!t.checked)("mdc-switch--checked",t.checked)("mdc-switch--disabled",t.disabled),rt("tabIndex",t.disabled?-1:t.tabIndex)("disabled",t.disabled),hn("id",t.buttonId)("name",t.name)("aria-label",t.ariaLabel)("aria-labelledby",t._getAriaLabelledBy())("aria-describedby",t.ariaDescribedby)("aria-required",t.required||null)("aria-checked",t.checked),xe(8),rt("matRippleTrigger",g)("matRippleDisabled",t.disableRipple||t.disabled)("matRippleCentered",!0),xe(),Dr(10,t.hideIcon?-1:10),xe(),rt("for",t.buttonId),hn("id",t._labelId)}},dependencies:[vv,qA],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1);background-color:var(--mdc-elevation-overlay-color)}.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative}.mdc-switch[hidden]{display:none}.mdc-switch:disabled{cursor:default;pointer-events:none}.mdc-switch__track{overflow:hidden;position:relative;width:100%}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%}@media screen and (forced-colors: active){.mdc-switch__track::before,.mdc-switch__track::after{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(-100%)}[dir=rtl] .mdc-switch__track::after,.mdc-switch__track[dir=rtl]::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track[dir=rtl]::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0)}[dir=rtl] .mdc-switch__handle-track,.mdc-switch__handle-track[dir=rtl]{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track,.mdc-switch--selected .mdc-switch__handle-track[dir=rtl]{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto}[dir=rtl] .mdc-switch__handle,.mdc-switch__handle[dir=rtl]{left:auto;right:0}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media screen and (forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-elevation-overlay{bottom:0;left:0;right:0;top:0}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1}.mdc-switch:disabled .mdc-switch__ripple{display:none}.mdc-switch__icons{height:100%;position:relative;width:100%;z-index:1}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}.mdc-switch{width:var(--mdc-switch-track-width)}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color)}.mdc-switch.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color)}.mdc-switch .mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation)}.mdc-switch .mdc-switch__focus-ring-wrapper,.mdc-switch .mdc-switch__handle{height:var(--mdc-switch-handle-height)}.mdc-switch .mdc-switch__handle{border-radius:var(--mdc-switch-handle-shape)}.mdc-switch .mdc-switch__handle{width:var(--mdc-switch-handle-width)}.mdc-switch .mdc-switch__handle-track{width:calc(100% - var(--mdc-switch-handle-width))}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__icon{fill:var(--mdc-switch-selected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__icon{fill:var(--mdc-switch-unselected-icon-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size)}.mdc-switch.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-hover-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-focus-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-pressed-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-hover-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-focus-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-pressed-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-selected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-selected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-unselected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-unselected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch .mdc-switch__ripple{height:var(--mdc-switch-state-layer-size);width:var(--mdc-switch-state-layer-size)}.mdc-switch .mdc-switch__track{height:var(--mdc-switch-track-height)}.mdc-switch:disabled .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch:enabled .mdc-switch__track::after{background:var(--mdc-switch-selected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color)}.mdc-switch:enabled .mdc-switch__track::before{background:var(--mdc-switch-unselected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color)}.mdc-switch .mdc-switch__track{border-radius:var(--mdc-switch-track-shape)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mat-mdc-slide-toggle{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle .mdc-switch__ripple::after{content:"";opacity:0}.mat-mdc-slide-toggle .mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:opacity 75ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-elevation-overlay,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mdc-switch__handle{transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size);height:var(--mat-switch-unselected-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size);height:var(--mat-switch-selected-handle-size)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size);height:var(--mat-switch-with-icon-handle-size)}.mat-mdc-slide-toggle:active .mdc-switch:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size);height:var(--mat-switch-pressed-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{margin:var(--mat-switch-selected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{margin:var(--mat-switch-unselected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--selected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--unselected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin)}.mdc-switch__track::after,.mdc-switch__track::before{border-width:var(--mat-switch-track-outline-width);border-color:var(--mat-switch-track-outline-color)}.mdc-switch--selected .mdc-switch__track::after,.mdc-switch--selected .mdc-switch__track::before{border-width:var(--mat-switch-selected-track-outline-width)}.mdc-switch--disabled .mdc-switch__track::after,.mdc-switch--disabled .mdc-switch__track::before{border-width:var(--mat-switch-disabled-unselected-track-outline-width);border-color:var(--mat-switch-disabled-unselected-track-outline-color)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity)}'],encapsulation:2,changeDetection:0});let a=n;return a})();var tP=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[Sv,Un,Un]});let a=n;return a})();var iP=wA(),mS=class{constructor(n,d){this._viewportRuler=n,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=d}attach(){}enable(){if(this._canBeEnabled()){let n=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=n.style.left||"",this._previousHTMLStyles.top=n.style.top||"",n.style.left=Ar(-this._previousScrollPosition.left),n.style.top=Ar(-this._previousScrollPosition.top),n.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let n=this._document.documentElement,d=this._document.body,r=n.style,s=d.style,t=r.scrollBehavior||"",g=s.scrollBehavior||"";this._isEnabled=!1,r.left=this._previousHTMLStyles.left,r.top=this._previousHTMLStyles.top,n.classList.remove("cdk-global-scrollblock"),iP&&(r.scrollBehavior=s.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),iP&&(r.scrollBehavior=t,s.scrollBehavior=g)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let d=this._document.body,r=this._viewportRuler.getViewportSize();return d.scrollHeight>r.height||d.scrollWidth>r.width}};var fS=class{constructor(n,d,r,s){this._scrollDispatcher=n,this._ngZone=d,this._viewportRuler=r,this._config=s,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(n){this._overlayRef,this._overlayRef=n}enable(){if(this._scrollSubscription)return;let n=this._scrollDispatcher.scrolled(0).pipe(wr(d=>!d||!this._overlayRef.overlayElement.contains(d.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=n.subscribe(()=>{let d=this._viewportRuler.getViewportScrollPosition().top;Math.abs(d-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=n.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},Mv=class{enable(){}disable(){}attach(){}};function gS(a,n){return n.some(d=>{let r=a.bottom<d.top,s=a.top>d.bottom,t=a.right<d.left,g=a.left>d.right;return r||s||t||g})}function nP(a,n){return n.some(d=>{let r=a.top<d.top,s=a.bottom>d.bottom,t=a.left<d.left,g=a.right>d.right;return r||s||t||g})}var _S=class{constructor(n,d,r,s){this._scrollDispatcher=n,this._viewportRuler=d,this._ngZone=r,this._config=s,this._scrollSubscription=null}attach(n){this._overlayRef,this._overlayRef=n}enable(){if(!this._scrollSubscription){let n=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(n).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let d=this._overlayRef.overlayElement.getBoundingClientRect(),{width:r,height:s}=this._viewportRuler.getViewportSize();gS(d,[{width:r,height:s,bottom:s,right:r,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},iV=(()=>{let n=class n{constructor(r,s,t,g){this._scrollDispatcher=r,this._viewportRuler=s,this._ngZone=t,this.noop=()=>new Mv,this.close=b=>new fS(this._scrollDispatcher,this._ngZone,this._viewportRuler,b),this.block=()=>new mS(this._viewportRuler,this._document),this.reposition=b=>new _S(this._scrollDispatcher,this._viewportRuler,this._ngZone,b),this._document=g}};n.\u0275fac=function(s){return new(s||n)(Ye(JA),Ye(uS),Ye(di),Ye(Ai))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),Tm=class{constructor(n){if(this.scrollStrategy=new Mv,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,n){let d=Object.keys(n);for(let r of d)n[r]!==void 0&&(this[r]=n[r])}}};var yS=class{constructor(n,d){this.connectionPair=n,this.scrollableViewProperties=d}};var lP=(()=>{let n=class n{constructor(r){this._attachedOverlays=[],this._document=r}ngOnDestroy(){this.detach()}add(r){this.remove(r),this._attachedOverlays.push(r)}remove(r){let s=this._attachedOverlays.indexOf(r);s>-1&&this._attachedOverlays.splice(s,1),this._attachedOverlays.length===0&&this.detach()}};n.\u0275fac=function(s){return new(s||n)(Ye(Ai))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),nV=(()=>{let n=class n extends lP{constructor(r,s){super(r),this._ngZone=s,this._keydownListener=t=>{let g=this._attachedOverlays;for(let b=g.length-1;b>-1;b--)if(g[b]._keydownEvents.observers.length>0){let M=g[b]._keydownEvents;this._ngZone?this._ngZone.run(()=>M.next(t)):M.next(t);break}}}add(r){super.add(r),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}};n.\u0275fac=function(s){return new(s||n)(Ye(Ai),Ye(di,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),rV=(()=>{let n=class n extends lP{constructor(r,s,t){super(r),this._platform=s,this._ngZone=t,this._cursorStyleIsSet=!1,this._pointerDownListener=g=>{this._pointerDownEventTarget=Ds(g)},this._clickListener=g=>{let b=Ds(g),M=g.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:b;this._pointerDownEventTarget=null;let k=this._attachedOverlays.slice();for(let L=k.length-1;L>-1;L--){let G=k[L];if(G._outsidePointerEvents.observers.length<1||!G.hasAttached())continue;if(G.overlayElement.contains(b)||G.overlayElement.contains(M))break;let J=G._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>J.next(g)):J.next(g)}}}add(r){if(super.add(r),!this._isAttached){let s=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(s)):this._addEventListeners(s),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=s.style.cursor,s.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let r=this._document.body;r.removeEventListener("pointerdown",this._pointerDownListener,!0),r.removeEventListener("click",this._clickListener,!0),r.removeEventListener("auxclick",this._clickListener,!0),r.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(r.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(r){r.addEventListener("pointerdown",this._pointerDownListener,!0),r.addEventListener("click",this._clickListener,!0),r.addEventListener("auxclick",this._clickListener,!0),r.addEventListener("contextmenu",this._clickListener,!0)}};n.\u0275fac=function(s){return new(s||n)(Ye(Ai),Ye(qn),Ye(di,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),Im=(()=>{let n=class n{constructor(r,s){this._platform=s,this._document=r}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let r="cdk-overlay-container";if(this._platform.isBrowser||E_()){let t=this._document.querySelectorAll(`.${r}[platform="server"], .${r}[platform="test"]`);for(let g=0;g<t.length;g++)t[g].remove()}let s=this._document.createElement("div");s.classList.add(r),E_()?s.setAttribute("platform","test"):this._platform.isBrowser||s.setAttribute("platform","server"),this._document.body.appendChild(s),this._containerElement=s}};n.\u0275fac=function(s){return new(s||n)(Ye(Ai),Ye(qn))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),ac=class{constructor(n,d,r,s,t,g,b,M,k,L=!1){this._portalOutlet=n,this._host=d,this._pane=r,this._config=s,this._ngZone=t,this._keyboardDispatcher=g,this._document=b,this._location=M,this._outsideClickDispatcher=k,this._animationsDisabled=L,this._backdropElement=null,this._backdropClick=new dn,this._attachments=new dn,this._detachments=new dn,this._locationChanges=Da.EMPTY,this._backdropClickHandler=G=>this._backdropClick.next(G),this._backdropTransitionendHandler=G=>{this._disposeBackdrop(G.target)},this._keydownEvents=new dn,this._outsidePointerEvents=new dn,s.scrollStrategy&&(this._scrollStrategy=s.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=s.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(n){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let d=this._portalOutlet.attach(n);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(ao(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof d?.onDestroy=="function"&&d.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),d}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let n=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),n}dispose(){let n=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,n&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(n){n!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=n,this.hasAttached()&&(n.attach(this),this.updatePosition()))}updateSize(n){this._config=kt(kt({},this._config),n),this._updateElementSize()}setDirection(n){this._config=Cn(kt({},this._config),{direction:n}),this._updateElementDirection()}addPanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!0)}removePanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!1)}getDirection(){let n=this._config.direction;return n?typeof n=="string"?n:n.value:"ltr"}updateScrollStrategy(n){n!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=n,this.hasAttached()&&(n.attach(this),n.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let n=this._pane.style;n.width=Ar(this._config.width),n.height=Ar(this._config.height),n.minWidth=Ar(this._config.minWidth),n.minHeight=Ar(this._config.minHeight),n.maxWidth=Ar(this._config.maxWidth),n.maxHeight=Ar(this._config.maxHeight)}_togglePointerEvents(n){this._pane.style.pointerEvents=n?"":"none"}_attachBackdrop(){let n="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(n)})}):this._backdropElement.classList.add(n)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let n=this._backdropElement;if(n){if(this._animationsDisabled){this._disposeBackdrop(n);return}n.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{n.addEventListener("transitionend",this._backdropTransitionendHandler)}),n.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(n)},500))}}_toggleClasses(n,d,r){let s=wm(d||[]).filter(t=>!!t);s.length&&(r?n.classList.add(...s):n.classList.remove(...s))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{let n=this._ngZone.onStable.pipe(Kl(uu(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),n.unsubscribe())})})}_disposeScrollStrategy(){let n=this._scrollStrategy;n&&(n.disable(),n.detach&&n.detach())}_disposeBackdrop(n){n&&(n.removeEventListener("click",this._backdropClickHandler),n.removeEventListener("transitionend",this._backdropTransitionendHandler),n.remove(),this._backdropElement===n&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},rP="cdk-overlay-connected-position-bounding-box",oV=/([A-Za-z%]+)$/,Tv=class{get positions(){return this._preferredPositions}constructor(n,d,r,s,t){this._viewportRuler=d,this._document=r,this._platform=s,this._overlayContainer=t,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new dn,this._resizeSubscription=Da.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(n)}attach(n){this._overlayRef&&this._overlayRef,this._validatePositions(),n.hostElement.classList.add(rP),this._overlayRef=n,this._boundingBox=n.hostElement,this._pane=n.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let n=this._originRect,d=this._overlayRect,r=this._viewportRect,s=this._containerRect,t=[],g;for(let b of this._preferredPositions){let M=this._getOriginPoint(n,s,b),k=this._getOverlayPoint(M,d,b),L=this._getOverlayFit(k,d,r,b);if(L.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(b,M);return}if(this._canFitWithFlexibleDimensions(L,k,r)){t.push({position:b,origin:M,overlayRect:d,boundingBoxRect:this._calculateBoundingBoxRect(M,b)});continue}(!g||g.overlayFit.visibleArea<L.visibleArea)&&(g={overlayFit:L,overlayPoint:k,originPoint:M,position:b,overlayRect:d})}if(t.length){let b=null,M=-1;for(let k of t){let L=k.boundingBoxRect.width*k.boundingBoxRect.height*(k.position.weight||1);L>M&&(M=L,b=k)}this._isPushed=!1,this._applyPosition(b.position,b.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(g.position,g.originPoint);return}this._applyPosition(g.position,g.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Tu(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(rP),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let n=this._lastPosition;if(n){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let d=this._getOriginPoint(this._originRect,this._containerRect,n);this._applyPosition(n,d)}else this.apply()}withScrollableContainers(n){return this._scrollables=n,this}withPositions(n){return this._preferredPositions=n,n.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(n){return this._viewportMargin=n,this}withFlexibleDimensions(n=!0){return this._hasFlexibleDimensions=n,this}withGrowAfterOpen(n=!0){return this._growAfterOpen=n,this}withPush(n=!0){return this._canPush=n,this}withLockedPosition(n=!0){return this._positionLocked=n,this}setOrigin(n){return this._origin=n,this}withDefaultOffsetX(n){return this._offsetX=n,this}withDefaultOffsetY(n){return this._offsetY=n,this}withTransformOriginOn(n){return this._transformOriginSelector=n,this}_getOriginPoint(n,d,r){let s;if(r.originX=="center")s=n.left+n.width/2;else{let g=this._isRtl()?n.right:n.left,b=this._isRtl()?n.left:n.right;s=r.originX=="start"?g:b}d.left<0&&(s-=d.left);let t;return r.originY=="center"?t=n.top+n.height/2:t=r.originY=="top"?n.top:n.bottom,d.top<0&&(t-=d.top),{x:s,y:t}}_getOverlayPoint(n,d,r){let s;r.overlayX=="center"?s=-d.width/2:r.overlayX==="start"?s=this._isRtl()?-d.width:0:s=this._isRtl()?0:-d.width;let t;return r.overlayY=="center"?t=-d.height/2:t=r.overlayY=="top"?0:-d.height,{x:n.x+s,y:n.y+t}}_getOverlayFit(n,d,r,s){let t=aP(d),{x:g,y:b}=n,M=this._getOffset(s,"x"),k=this._getOffset(s,"y");M&&(g+=M),k&&(b+=k);let L=0-g,G=g+t.width-r.width,J=0-b,oe=b+t.height-r.height,be=this._subtractOverflows(t.width,L,G),Me=this._subtractOverflows(t.height,J,oe),Te=be*Me;return{visibleArea:Te,isCompletelyWithinViewport:t.width*t.height===Te,fitsInViewportVertically:Me===t.height,fitsInViewportHorizontally:be==t.width}}_canFitWithFlexibleDimensions(n,d,r){if(this._hasFlexibleDimensions){let s=r.bottom-d.y,t=r.right-d.x,g=oP(this._overlayRef.getConfig().minHeight),b=oP(this._overlayRef.getConfig().minWidth),M=n.fitsInViewportVertically||g!=null&&g<=s,k=n.fitsInViewportHorizontally||b!=null&&b<=t;return M&&k}return!1}_pushOverlayOnScreen(n,d,r){if(this._previousPushAmount&&this._positionLocked)return{x:n.x+this._previousPushAmount.x,y:n.y+this._previousPushAmount.y};let s=aP(d),t=this._viewportRect,g=Math.max(n.x+s.width-t.width,0),b=Math.max(n.y+s.height-t.height,0),M=Math.max(t.top-r.top-n.y,0),k=Math.max(t.left-r.left-n.x,0),L=0,G=0;return s.width<=t.width?L=k||-g:L=n.x<this._viewportMargin?t.left-r.left-n.x:0,s.height<=t.height?G=M||-b:G=n.y<this._viewportMargin?t.top-r.top-n.y:0,this._previousPushAmount={x:L,y:G},{x:n.x+L,y:n.y+G}}_applyPosition(n,d){if(this._setTransformOrigin(n),this._setOverlayElementStyles(d,n),this._setBoundingBoxStyles(d,n),n.panelClass&&this._addPanelClasses(n.panelClass),this._positionChanges.observers.length){let r=this._getScrollVisibility();if(n!==this._lastPosition||!this._lastScrollVisibility||!aV(this._lastScrollVisibility,r)){let s=new yS(n,r);this._positionChanges.next(s)}this._lastScrollVisibility=r}this._lastPosition=n,this._isInitialRender=!1}_setTransformOrigin(n){if(!this._transformOriginSelector)return;let d=this._boundingBox.querySelectorAll(this._transformOriginSelector),r,s=n.overlayY;n.overlayX==="center"?r="center":this._isRtl()?r=n.overlayX==="start"?"right":"left":r=n.overlayX==="start"?"left":"right";for(let t=0;t<d.length;t++)d[t].style.transformOrigin=`${r} ${s}`}_calculateBoundingBoxRect(n,d){let r=this._viewportRect,s=this._isRtl(),t,g,b;if(d.overlayY==="top")g=n.y,t=r.height-g+this._viewportMargin;else if(d.overlayY==="bottom")b=r.height-n.y+this._viewportMargin*2,t=r.height-b+this._viewportMargin;else{let oe=Math.min(r.bottom-n.y+r.top,n.y),be=this._lastBoundingBoxSize.height;t=oe*2,g=n.y-oe,t>be&&!this._isInitialRender&&!this._growAfterOpen&&(g=n.y-be/2)}let M=d.overlayX==="start"&&!s||d.overlayX==="end"&&s,k=d.overlayX==="end"&&!s||d.overlayX==="start"&&s,L,G,J;if(k)J=r.width-n.x+this._viewportMargin*2,L=n.x-this._viewportMargin;else if(M)G=n.x,L=r.right-n.x;else{let oe=Math.min(r.right-n.x+r.left,n.x),be=this._lastBoundingBoxSize.width;L=oe*2,G=n.x-oe,L>be&&!this._isInitialRender&&!this._growAfterOpen&&(G=n.x-be/2)}return{top:g,left:G,bottom:b,right:J,width:L,height:t}}_setBoundingBoxStyles(n,d){let r=this._calculateBoundingBoxRect(n,d);!this._isInitialRender&&!this._growAfterOpen&&(r.height=Math.min(r.height,this._lastBoundingBoxSize.height),r.width=Math.min(r.width,this._lastBoundingBoxSize.width));let s={};if(this._hasExactPosition())s.top=s.left="0",s.bottom=s.right=s.maxHeight=s.maxWidth="",s.width=s.height="100%";else{let t=this._overlayRef.getConfig().maxHeight,g=this._overlayRef.getConfig().maxWidth;s.height=Ar(r.height),s.top=Ar(r.top),s.bottom=Ar(r.bottom),s.width=Ar(r.width),s.left=Ar(r.left),s.right=Ar(r.right),d.overlayX==="center"?s.alignItems="center":s.alignItems=d.overlayX==="end"?"flex-end":"flex-start",d.overlayY==="center"?s.justifyContent="center":s.justifyContent=d.overlayY==="bottom"?"flex-end":"flex-start",t&&(s.maxHeight=Ar(t)),g&&(s.maxWidth=Ar(g))}this._lastBoundingBoxSize=r,Tu(this._boundingBox.style,s)}_resetBoundingBoxStyles(){Tu(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Tu(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(n,d){let r={},s=this._hasExactPosition(),t=this._hasFlexibleDimensions,g=this._overlayRef.getConfig();if(s){let L=this._viewportRuler.getViewportScrollPosition();Tu(r,this._getExactOverlayY(d,n,L)),Tu(r,this._getExactOverlayX(d,n,L))}else r.position="static";let b="",M=this._getOffset(d,"x"),k=this._getOffset(d,"y");M&&(b+=`translateX(${M}px) `),k&&(b+=`translateY(${k}px)`),r.transform=b.trim(),g.maxHeight&&(s?r.maxHeight=Ar(g.maxHeight):t&&(r.maxHeight="")),g.maxWidth&&(s?r.maxWidth=Ar(g.maxWidth):t&&(r.maxWidth="")),Tu(this._pane.style,r)}_getExactOverlayY(n,d,r){let s={top:"",bottom:""},t=this._getOverlayPoint(d,this._overlayRect,n);if(this._isPushed&&(t=this._pushOverlayOnScreen(t,this._overlayRect,r)),n.overlayY==="bottom"){let g=this._document.documentElement.clientHeight;s.bottom=`${g-(t.y+this._overlayRect.height)}px`}else s.top=Ar(t.y);return s}_getExactOverlayX(n,d,r){let s={left:"",right:""},t=this._getOverlayPoint(d,this._overlayRect,n);this._isPushed&&(t=this._pushOverlayOnScreen(t,this._overlayRect,r));let g;if(this._isRtl()?g=n.overlayX==="end"?"left":"right":g=n.overlayX==="end"?"right":"left",g==="right"){let b=this._document.documentElement.clientWidth;s.right=`${b-(t.x+this._overlayRect.width)}px`}else s.left=Ar(t.x);return s}_getScrollVisibility(){let n=this._getOriginRect(),d=this._pane.getBoundingClientRect(),r=this._scrollables.map(s=>s.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:nP(n,r),isOriginOutsideView:gS(n,r),isOverlayClipped:nP(d,r),isOverlayOutsideView:gS(d,r)}}_subtractOverflows(n,...d){return d.reduce((r,s)=>r-Math.max(s,0),n)}_getNarrowedViewportRect(){let n=this._document.documentElement.clientWidth,d=this._document.documentElement.clientHeight,r=this._viewportRuler.getViewportScrollPosition();return{top:r.top+this._viewportMargin,left:r.left+this._viewportMargin,right:r.left+n-this._viewportMargin,bottom:r.top+d-this._viewportMargin,width:n-2*this._viewportMargin,height:d-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(n,d){return d==="x"?n.offsetX==null?this._offsetX:n.offsetX:n.offsetY==null?this._offsetY:n.offsetY}_validatePositions(){}_addPanelClasses(n){this._pane&&wm(n).forEach(d=>{d!==""&&this._appliedPanelClasses.indexOf(d)===-1&&(this._appliedPanelClasses.push(d),this._pane.classList.add(d))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(n=>{this._pane.classList.remove(n)}),this._appliedPanelClasses=[])}_getOriginRect(){let n=this._origin;if(n instanceof Zi)return n.nativeElement.getBoundingClientRect();if(n instanceof Element)return n.getBoundingClientRect();let d=n.width||0,r=n.height||0;return{top:n.y,bottom:n.y+r,left:n.x,right:n.x+d,height:r,width:d}}};function Tu(a,n){for(let d in n)n.hasOwnProperty(d)&&(a[d]=n[d]);return a}function oP(a){if(typeof a!="number"&&a!=null){let[n,d]=a.split(oV);return!d||d==="px"?parseFloat(n):null}return a||null}function aP(a){return{top:Math.floor(a.top),right:Math.floor(a.right),bottom:Math.floor(a.bottom),left:Math.floor(a.left),width:Math.floor(a.width),height:Math.floor(a.height)}}function aV(a,n){return a===n?!0:a.isOriginClipped===n.isOriginClipped&&a.isOriginOutsideView===n.isOriginOutsideView&&a.isOverlayClipped===n.isOverlayClipped&&a.isOverlayOutsideView===n.isOverlayOutsideView}var sP="cdk-global-overlay-wrapper",bS=class{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(n){let d=n.getConfig();this._overlayRef=n,this._width&&!d.width&&n.updateSize({width:this._width}),this._height&&!d.height&&n.updateSize({height:this._height}),n.hostElement.classList.add(sP),this._isDisposed=!1}top(n=""){return this._bottomOffset="",this._topOffset=n,this._alignItems="flex-start",this}left(n=""){return this._xOffset=n,this._xPosition="left",this}bottom(n=""){return this._topOffset="",this._bottomOffset=n,this._alignItems="flex-end",this}right(n=""){return this._xOffset=n,this._xPosition="right",this}start(n=""){return this._xOffset=n,this._xPosition="start",this}end(n=""){return this._xOffset=n,this._xPosition="end",this}width(n=""){return this._overlayRef?this._overlayRef.updateSize({width:n}):this._width=n,this}height(n=""){return this._overlayRef?this._overlayRef.updateSize({height:n}):this._height=n,this}centerHorizontally(n=""){return this.left(n),this._xPosition="center",this}centerVertically(n=""){return this.top(n),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let n=this._overlayRef.overlayElement.style,d=this._overlayRef.hostElement.style,r=this._overlayRef.getConfig(),{width:s,height:t,maxWidth:g,maxHeight:b}=r,M=(s==="100%"||s==="100vw")&&(!g||g==="100%"||g==="100vw"),k=(t==="100%"||t==="100vh")&&(!b||b==="100%"||b==="100vh"),L=this._xPosition,G=this._xOffset,J=this._overlayRef.getConfig().direction==="rtl",oe="",be="",Me="";M?Me="flex-start":L==="center"?(Me="center",J?be=G:oe=G):J?L==="left"||L==="end"?(Me="flex-end",oe=G):(L==="right"||L==="start")&&(Me="flex-start",be=G):L==="left"||L==="start"?(Me="flex-start",oe=G):(L==="right"||L==="end")&&(Me="flex-end",be=G),n.position=this._cssPosition,n.marginLeft=M?"0":oe,n.marginTop=k?"0":this._topOffset,n.marginBottom=this._bottomOffset,n.marginRight=M?"0":be,d.justifyContent=Me,d.alignItems=k?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let n=this._overlayRef.overlayElement.style,d=this._overlayRef.hostElement,r=d.style;d.classList.remove(sP),r.justifyContent=r.alignItems=n.marginTop=n.marginBottom=n.marginLeft=n.marginRight=n.position="",this._overlayRef=null,this._isDisposed=!0}},sV=(()=>{let n=class n{constructor(r,s,t,g){this._viewportRuler=r,this._document=s,this._platform=t,this._overlayContainer=g}global(){return new bS}flexibleConnectedTo(r){return new Tv(r,this._viewportRuler,this._document,this._platform,this._overlayContainer)}};n.\u0275fac=function(s){return new(s||n)(Ye(uS),Ye(Ai),Ye(qn),Ye(Im))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),lV=0,da=(()=>{let n=class n{constructor(r,s,t,g,b,M,k,L,G,J,oe,be){this.scrollStrategies=r,this._overlayContainer=s,this._componentFactoryResolver=t,this._positionBuilder=g,this._keyboardDispatcher=b,this._injector=M,this._ngZone=k,this._document=L,this._directionality=G,this._location=J,this._outsideClickDispatcher=oe,this._animationsModuleType=be}create(r){let s=this._createHostElement(),t=this._createPaneElement(s),g=this._createPortalOutlet(t),b=new Tm(r);return b.direction=b.direction||this._directionality.value,new ac(g,s,t,b,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations")}position(){return this._positionBuilder}_createPaneElement(r){let s=this._document.createElement("div");return s.id=`cdk-overlay-${lV++}`,s.classList.add("cdk-overlay-pane"),r.appendChild(s),s}_createHostElement(){let r=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(r),r}_createPortalOutlet(r){return this._appRef||(this._appRef=this._injector.get(pm)),new xv(r,this._componentFactoryResolver,this._appRef,this._injector,this._document)}};n.\u0275fac=function(s){return new(s||n)(Ye(iV),Ye(Im),Ye(l_),Ye(sV),Ye(nV),Ye(Lo),Ye(di),Ye(Ai),Ye(rc),Ye(Pi),Ye(rV),Ye(lo,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var cV=new Qt("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let a=Nt(da);return()=>a.scrollStrategies.reposition()}});function dV(a){return()=>a.scrollStrategies.reposition()}var hV={provide:cV,deps:[da],useFactory:dV},Em=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({providers:[da,hV],imports:[Nd,oc,pS,pS]});let a=n;return a})();var uV=["mat-button",""],pV=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],mV=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var fV=".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}";var gV=["mat-icon-button",""],_V=["*"];var yV=new Qt("MAT_BUTTON_CONFIG");var bV=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],dP=(()=>{let n=class n{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(r){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,r)}get disableRipple(){return this._disableRipple}set disableRipple(r){this._disableRipple=r,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(r){this._disabled=r,this._updateRippleDisabled()}constructor(r,s,t,g){this._elementRef=r,this._platform=s,this._ngZone=t,this._animationMode=g,this._focusMonitor=Nt(nc),this._rippleLoader=Nt($A),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let b=Nt(yV,{optional:!0}),M=r.nativeElement,k=M.classList;this.disabledInteractive=b?.disabledInteractive??!1,this._rippleLoader?.configureRipple(M,{className:"mat-mdc-button-ripple"});for(let{attribute:L,mdcClasses:G}of bV)M.hasAttribute(L)&&k.add(...G)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(r="program",s){r?this._focusMonitor.focusVia(this._elementRef.nativeElement,r,s):this._elementRef.nativeElement.focus(s)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};n.\u0275fac=function(s){Pd()},n.\u0275dir=Ei({type:n,inputs:{color:"color",disableRipple:[bi.HasDecoratorInputTransform,"disableRipple","disableRipple",sr],disabled:[bi.HasDecoratorInputTransform,"disabled","disabled",sr],ariaDisabled:[bi.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",sr],disabledInteractive:[bi.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",sr]},features:[co]});let a=n;return a})();var vS=(()=>{let n=class n extends dP{constructor(r,s,t,g){super(r,s,t,g)}};n.\u0275fac=function(s){return new(s||n)(ge(Zi),ge(qn),ge(di),ge(lo,8))},n.\u0275cmp=gt({type:n,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(s,t){s&2&&(hn("disabled",t._getDisabledAttribute())("aria-disabled",t._getAriaDisabled()),Ms(t.color?"mat-"+t.color:""),Ni("mat-mdc-button-disabled",t.disabled)("mat-mdc-button-disabled-interactive",t.disabledInteractive)("_mat-animation-noopable",t._animationMode==="NoopAnimations")("mat-unthemed",!t.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[zn,Bn],attrs:uV,ngContentSelectors:mV,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(s,t){s&1&&(sa(pV),Ee(0,"span",0),zo(1),V(2,"span",1),zo(3,1),j(),zo(4,2),Ee(5,"span",2)(6,"span",3)),s&2&&Ni("mdc-button__ripple",!t._isFab)("mdc-fab__ripple",t._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let a=n;return a})();var xS=(()=>{let n=class n extends dP{constructor(r,s,t,g){super(r,s,t,g),this._rippleLoader.configureRipple(this._elementRef.nativeElement,{centered:!0})}};n.\u0275fac=function(s){return new(s||n)(ge(Zi),ge(qn),ge(di),ge(lo,8))},n.\u0275cmp=gt({type:n,selectors:[["button","mat-icon-button",""]],hostVars:14,hostBindings:function(s,t){s&2&&(hn("disabled",t._getDisabledAttribute())("aria-disabled",t._getAriaDisabled()),Ms(t.color?"mat-"+t.color:""),Ni("mat-mdc-button-disabled",t.disabled)("mat-mdc-button-disabled-interactive",t.disabledInteractive)("_mat-animation-noopable",t._animationMode==="NoopAnimations")("mat-unthemed",!t.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[zn,Bn],attrs:gV,ngContentSelectors:_V,decls:4,vars:0,consts:[[1,"mat-mdc-button-persistent-ripple","mdc-icon-button__ripple"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(s,t){s&1&&(sa(),Ee(0,"span",0),zo(1),Ee(2,"span",1)(3,"span",2))},styles:['.mdc-icon-button{display:inline-block;position:relative;box-sizing:border-box;border:none;outline:none;background-color:rgba(0,0,0,0);fill:currentColor;color:inherit;text-decoration:none;cursor:pointer;user-select:none;z-index:0;overflow:visible}.mdc-icon-button .mdc-icon-button__touch{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}@media screen and (forced-colors: active){.mdc-icon-button.mdc-ripple-upgraded--background-focused .mdc-icon-button__focus-ring,.mdc-icon-button:not(.mdc-ripple-upgraded):focus .mdc-icon-button__focus-ring{display:block}}.mdc-icon-button:disabled{cursor:default;pointer-events:none}.mdc-icon-button[hidden]{display:none}.mdc-icon-button--display-flex{align-items:center;display:inline-flex;justify-content:center}.mdc-icon-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%;display:none}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring{border-color:CanvasText}}.mdc-icon-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring::after{border-color:CanvasText}}.mdc-icon-button__icon{display:inline-block}.mdc-icon-button__icon.mdc-icon-button__icon--on{display:none}.mdc-icon-button--on .mdc-icon-button__icon{display:none}.mdc-icon-button--on .mdc-icon-button__icon.mdc-icon-button__icon--on{display:inline-block}.mdc-icon-button__link{height:100%;left:0;outline:none;position:absolute;top:0;width:100%}.mat-mdc-icon-button{color:var(--mdc-icon-button-icon-color)}.mat-mdc-icon-button .mdc-button__icon{font-size:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button svg,.mat-mdc-icon-button img{width:var(--mdc-icon-button-icon-size);height:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button:disabled{color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button{border-radius:50%;flex-shrink:0;text-align:center;width:var(--mdc-icon-button-state-layer-size, 48px);height:var(--mdc-icon-button-state-layer-size, 48px);padding:calc(calc(var(--mdc-icon-button-state-layer-size, 48px) - var(--mdc-icon-button-icon-size, 24px)) / 2);font-size:var(--mdc-icon-button-icon-size);-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-icon-button svg{vertical-align:baseline}.mat-mdc-icon-button[disabled],.mat-mdc-icon-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-icon-button .mat-mdc-button-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-icon-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-icon-button .mdc-button__label{z-index:1}.mat-mdc-icon-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-icon-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-icon-button .mat-ripple-element{background-color:var(--mat-icon-button-ripple-color)}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-state-layer-color)}.mat-mdc-icon-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-disabled-state-layer-color)}.mat-mdc-icon-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-hover-state-layer-opacity)}.mat-mdc-icon-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-focus-state-layer-opacity)}.mat-mdc-icon-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-pressed-state-layer-opacity)}.mat-mdc-icon-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-icon-button-touch-target-display)}.mat-mdc-icon-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple{border-radius:50%}.mat-mdc-icon-button.mat-unthemed:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-primary:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-accent:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-warn:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}',fV],encapsulation:2,changeDetection:0});let a=n;return a})();var hP=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[Un,GA,Un]});let a=n;return a})();var vV=["mat-calendar-body",""];function xV(a,n){if(a&1&&(V(0,"tr",0)(1,"td",3),Y(2),j()()),a&2){let d=Et();xe(),Ka("padding-top",d._cellPadding)("padding-bottom",d._cellPadding),hn("colspan",d.numCols),xe(),bn(" ",d.label," ")}}function wV(a,n){if(a&1&&(V(0,"td",3),Y(1),j()),a&2){let d=Et(2);Ka("padding-top",d._cellPadding)("padding-bottom",d._cellPadding),hn("colspan",d._firstRowOffset),xe(),bn(" ",d._firstRowOffset>=d.labelMinRequiredCells?d.label:""," ")}}function CV(a,n){if(a&1){let d=gi();V(0,"td",6)(1,"button",7),Fe("click",function(s){let t=Mt(d).$implicit,g=Et(2);return Tt(g._cellClicked(t,s))})("focus",function(s){let t=Mt(d).$implicit,g=Et(2);return Tt(g._emitActiveDateChange(t,s))}),V(2,"span",8),Y(3),j(),Ee(4,"span",9),j()()}if(a&2){let d=n.$implicit,r=n.$index,s=Et().$index,t=Et();Ka("width",t._cellWidth)("padding-top",t._cellPadding)("padding-bottom",t._cellPadding),hn("data-mat-row",s)("data-mat-col",r),xe(),Ni("mat-calendar-body-disabled",!d.enabled)("mat-calendar-body-active",t._isActiveCell(s,r))("mat-calendar-body-range-start",t._isRangeStart(d.compareValue))("mat-calendar-body-range-end",t._isRangeEnd(d.compareValue))("mat-calendar-body-in-range",t._isInRange(d.compareValue))("mat-calendar-body-comparison-bridge-start",t._isComparisonBridgeStart(d.compareValue,s,r))("mat-calendar-body-comparison-bridge-end",t._isComparisonBridgeEnd(d.compareValue,s,r))("mat-calendar-body-comparison-start",t._isComparisonStart(d.compareValue))("mat-calendar-body-comparison-end",t._isComparisonEnd(d.compareValue))("mat-calendar-body-in-comparison-range",t._isInComparisonRange(d.compareValue))("mat-calendar-body-preview-start",t._isPreviewStart(d.compareValue))("mat-calendar-body-preview-end",t._isPreviewEnd(d.compareValue))("mat-calendar-body-in-preview",t._isInPreview(d.compareValue)),rt("ngClass",d.cssClasses)("tabindex",t._isActiveCell(s,r)?0:-1),hn("aria-label",d.ariaLabel)("aria-disabled",!d.enabled||null)("aria-pressed",t._isSelected(d.compareValue))("aria-current",t.todayValue===d.compareValue?"date":null)("aria-describedby",t._getDescribedby(d.compareValue)),xe(),Ni("mat-calendar-body-selected",t._isSelected(d.compareValue))("mat-calendar-body-comparison-identical",t._isComparisonIdentical(d.compareValue))("mat-calendar-body-today",t.todayValue===d.compareValue),xe(),bn(" ",d.displayValue," ")}}function SV(a,n){if(a&1&&(V(0,"tr",1),Zt(1,wV,2,6,"td",4),Cr(2,CV,5,48,"td",5,d_),j()),a&2){let d=n.$implicit,r=n.$index,s=Et();xe(),Dr(1,r===0&&s._firstRowOffset?1:-1),xe(),Sr(d)}}function MV(a,n){if(a&1&&(V(0,"th",2)(1,"span",6),Y(2),j(),V(3,"span",3),Y(4),j()()),a&2){let d=n.$implicit;xe(2),zt(d.long),xe(2),zt(d.narrow)}}var TV=["*"];function IV(a,n){}function EV(a,n){if(a&1){let d=gi();V(0,"mat-month-view",2),So("activeDateChange",function(s){Mt(d);let t=Et();return Co(t.activeDate,s)||(t.activeDate=s),Tt(s)}),Fe("_userSelection",function(s){Mt(d);let t=Et();return Tt(t._dateSelected(s))})("dragStarted",function(s){Mt(d);let t=Et();return Tt(t._dragStarted(s))})("dragEnded",function(s){Mt(d);let t=Et();return Tt(t._dragEnded(s))}),j()}if(a&2){let d=Et();wo("activeDate",d.activeDate),rt("selected",d.selected)("dateFilter",d.dateFilter)("maxDate",d.maxDate)("minDate",d.minDate)("dateClass",d.dateClass)("comparisonStart",d.comparisonStart)("comparisonEnd",d.comparisonEnd)("startDateAccessibleName",d.startDateAccessibleName)("endDateAccessibleName",d.endDateAccessibleName)("activeDrag",d._activeDrag)}}function DV(a,n){if(a&1){let d=gi();V(0,"mat-year-view",3),So("activeDateChange",function(s){Mt(d);let t=Et();return Co(t.activeDate,s)||(t.activeDate=s),Tt(s)}),Fe("monthSelected",function(s){Mt(d);let t=Et();return Tt(t._monthSelectedInYearView(s))})("selectedChange",function(s){Mt(d);let t=Et();return Tt(t._goToDateInView(s,"month"))}),j()}if(a&2){let d=Et();wo("activeDate",d.activeDate),rt("selected",d.selected)("dateFilter",d.dateFilter)("maxDate",d.maxDate)("minDate",d.minDate)("dateClass",d.dateClass)}}function kV(a,n){if(a&1){let d=gi();V(0,"mat-multi-year-view",4),So("activeDateChange",function(s){Mt(d);let t=Et();return Co(t.activeDate,s)||(t.activeDate=s),Tt(s)}),Fe("yearSelected",function(s){Mt(d);let t=Et();return Tt(t._yearSelectedInMultiYearView(s))})("selectedChange",function(s){Mt(d);let t=Et();return Tt(t._goToDateInView(s,"year"))}),j()}if(a&2){let d=Et();wo("activeDate",d.activeDate),rt("selected",d.selected)("dateFilter",d.dateFilter)("maxDate",d.maxDate)("minDate",d.minDate)("dateClass",d.dateClass)}}function AV(a,n){}var PV=["button"],OV=[[["","matDatepickerToggleIcon",""]]],RV=["[matDatepickerToggleIcon]"];function FV(a,n){a&1&&(kd(),V(0,"svg",2),Ee(1,"path",3),j())}var z_=(()=>{let n=class n{constructor(){this.changes=new dn,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(r,s){return`${r} \u2013 ${s}`}formatYearRangeLabel(r,s){return`${r} to ${s}`}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),F_=class{constructor(n,d,r,s,t={},g=n,b){this.value=n,this.displayValue=d,this.ariaLabel=r,this.enabled=s,this.cssClasses=t,this.compareValue=g,this.rawValue=b}},LV=1,uP=al({passive:!1,capture:!0}),Ud=al({passive:!0,capture:!0}),Iv=al({passive:!0}),Am=(()=>{let n=class n{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(r,s){this._elementRef=r,this._ngZone=s,this._platform=Nt(qn),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new Ii,this.previewChange=new Ii,this.activeDateChange=new Ii,this.dragStarted=new Ii,this.dragEnded=new Ii,this._didDragSinceMouseDown=!1,this._enterHandler=t=>{if(this._skipNextFocus&&t.type==="focus"){this._skipNextFocus=!1;return}if(t.target&&this.isRange){let g=this._getCellFromElement(t.target);g&&this._ngZone.run(()=>this.previewChange.emit({value:g.enabled?g:null,event:t}))}},this._touchmoveHandler=t=>{if(!this.isRange)return;let g=pP(t),b=g?this._getCellFromElement(g):null;g!==t.target&&(this._didDragSinceMouseDown=!0),CS(t.target)&&t.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:b?.enabled?b:null,event:t}))},this._leaveHandler=t=>{this.previewEnd!==null&&this.isRange&&(t.type!=="blur"&&(this._didDragSinceMouseDown=!0),t.target&&this._getCellFromElement(t.target)&&!(t.relatedTarget&&this._getCellFromElement(t.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:t})))},this._mousedownHandler=t=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;let g=t.target&&this._getCellFromElement(t.target);!g||!this._isInRange(g.compareValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:g.rawValue,event:t})})},this._mouseupHandler=t=>{if(!this.isRange)return;let g=CS(t.target);if(!g){this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:t})});return}g.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{let b=this._getCellFromElement(g);this.dragEnded.emit({value:b?.rawValue??null,event:t})})},this._touchendHandler=t=>{let g=pP(t);g&&this._mouseupHandler({target:g})},this._id=`mat-calendar-body-${LV++}`,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,s.runOutsideAngular(()=>{let t=r.nativeElement;t.addEventListener("touchmove",this._touchmoveHandler,uP),t.addEventListener("mouseenter",this._enterHandler,Ud),t.addEventListener("focus",this._enterHandler,Ud),t.addEventListener("mouseleave",this._leaveHandler,Ud),t.addEventListener("blur",this._leaveHandler,Ud),t.addEventListener("mousedown",this._mousedownHandler,Iv),t.addEventListener("touchstart",this._mousedownHandler,Iv),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(r,s){this._didDragSinceMouseDown||r.enabled&&this.selectedValueChange.emit({value:r.value,event:s})}_emitActiveDateChange(r,s){r.enabled&&this.activeDateChange.emit({value:r.value,event:s})}_isSelected(r){return this.startValue===r||this.endValue===r}ngOnChanges(r){let s=r.numCols,{rows:t,numCols:g}=this;(r.rows||s)&&(this._firstRowOffset=t&&t.length&&t[0].length?g-t[0].length:0),(r.cellAspectRatio||s||!this._cellPadding)&&(this._cellPadding=`${50*this.cellAspectRatio/g}%`),(s||!this._cellWidth)&&(this._cellWidth=`${100/g}%`)}ngOnDestroy(){let r=this._elementRef.nativeElement;r.removeEventListener("touchmove",this._touchmoveHandler,uP),r.removeEventListener("mouseenter",this._enterHandler,Ud),r.removeEventListener("focus",this._enterHandler,Ud),r.removeEventListener("mouseleave",this._leaveHandler,Ud),r.removeEventListener("blur",this._leaveHandler,Ud),r.removeEventListener("mousedown",this._mousedownHandler,Iv),r.removeEventListener("touchstart",this._mousedownHandler,Iv),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(r,s){let t=r*this.numCols+s;return r&&(t-=this._firstRowOffset),t==this.activeCell}_focusActiveCell(r=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(ao(1)).subscribe(()=>{setTimeout(()=>{let s=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");s&&(r||(this._skipNextFocus=!0),s.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(r){return SS(r,this.startValue,this.endValue)}_isRangeEnd(r){return MS(r,this.startValue,this.endValue)}_isInRange(r){return TS(r,this.startValue,this.endValue,this.isRange)}_isComparisonStart(r){return SS(r,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(r,s,t){if(!this._isComparisonStart(r)||this._isRangeStart(r)||!this._isInRange(r))return!1;let g=this.rows[s][t-1];if(!g){let b=this.rows[s-1];g=b&&b[b.length-1]}return g&&!this._isRangeEnd(g.compareValue)}_isComparisonBridgeEnd(r,s,t){if(!this._isComparisonEnd(r)||this._isRangeEnd(r)||!this._isInRange(r))return!1;let g=this.rows[s][t+1];if(!g){let b=this.rows[s+1];g=b&&b[0]}return g&&!this._isRangeStart(g.compareValue)}_isComparisonEnd(r){return MS(r,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(r){return TS(r,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(r){return this.comparisonStart===this.comparisonEnd&&r===this.comparisonStart}_isPreviewStart(r){return SS(r,this.previewStart,this.previewEnd)}_isPreviewEnd(r){return MS(r,this.previewStart,this.previewEnd)}_isInPreview(r){return TS(r,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(r){return this.isRange?this.startValue===r&&this.endValue===r?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===r?this._startDateLabelId:this.endValue===r?this._endDateLabelId:null:null}_getCellFromElement(r){let s=CS(r);if(s){let t=s.getAttribute("data-mat-row"),g=s.getAttribute("data-mat-col");if(t&&g)return this.rows[parseInt(t)][parseInt(g)]}return null}};n.\u0275fac=function(s){return new(s||n)(ge(Zi),ge(di))},n.\u0275cmp=gt({type:n,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],standalone:!0,features:[ar,Bn],attrs:vV,decls:7,vars:5,consts:[["aria-hidden","true"],["role","row"],[1,"mat-calendar-body-hidden-label",3,"id"],[1,"mat-calendar-body-label"],[1,"mat-calendar-body-label",3,"paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"click","focus","ngClass","tabindex"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"]],template:function(s,t){s&1&&(Zt(0,xV,3,6,"tr",0),Cr(1,SV,4,1,"tr",1,d_),V(3,"label",2),Y(4),j(),V(5,"label",2),Y(6),j()),s&2&&(Dr(0,t._firstRowOffset<t.labelMinRequiredCells?0:-1),xe(),Sr(t.rows),xe(2),rt("id",t._startDateLabelId),xe(),bn(" ",t.startDateAccessibleName,`
`),xe(),rt("id",t._endDateLabelId),xe(),bn(" ",t.endDateAccessibleName,`
`))},dependencies:[Qa],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:start;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}'],encapsulation:2,changeDetection:0});let a=n;return a})();function wS(a){return a?.nodeName==="TD"}function CS(a){let n;return wS(a)?n=a:wS(a.parentNode)?n=a.parentNode:wS(a.parentNode?.parentNode)&&(n=a.parentNode.parentNode),n?.getAttribute("data-mat-row")!=null?n:null}function SS(a,n,d){return d!==null&&n!==d&&a<d&&a===n}function MS(a,n,d){return n!==null&&n!==d&&a>=n&&a===d}function TS(a,n,d,r){return r&&n!==null&&d!==null&&n!==d&&a>=n&&a<=d}function pP(a){let n=a.changedTouches[0];return document.elementFromPoint(n.clientX,n.clientY)}var ts=class{constructor(n,d){this.start=n,this.end=d}},Ev=(()=>{let n=class n{constructor(r,s){this.selection=r,this._adapter=s,this._selectionChanged=new dn,this.selectionChanged=this._selectionChanged,this.selection=r}updateSelection(r,s){let t=this.selection;this.selection=r,this._selectionChanged.next({selection:r,source:s,oldValue:t})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(r){return this._adapter.isDateInstance(r)&&this._adapter.isValid(r)}};n.\u0275fac=function(s){Pd()},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})(),zV=(()=>{let n=class n extends Ev{constructor(r){super(null,r)}add(r){super.updateSelection(r,this)}isValid(){return this.selection!=null&&this._isValidDateInstance(this.selection)}isComplete(){return this.selection!=null}clone(){let r=new n(this._adapter);return r.updateSelection(this.selection,this),r}};n.\u0275fac=function(s){return new(s||n)(Ye(ca))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})();function BV(a,n){return a||new zV(n)}var NV={provide:Ev,deps:[[new mu,new Ob,Ev],ca],useFactory:BV};var yP=new Qt("MAT_DATE_RANGE_SELECTION_STRATEGY");var IS=7,mP=(()=>{let n=class n{get activeDate(){return this._activeDate}set activeDate(r){let s=this._activeDate,t=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),this._hasSameMonthAndYear(s,this._activeDate)||this._init()}get selected(){return this._selected}set selected(r){r instanceof ts?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,s,t,g,b){this._changeDetectorRef=r,this._dateFormats=s,this._dateAdapter=t,this._dir=g,this._rangeStrategy=b,this._rerenderSubscription=Da.EMPTY,this.activeDrag=null,this.selectedChange=new Ii,this._userSelection=new Ii,this.dragStarted=new Ii,this.dragEnded=new Ii,this.activeDateChange=new Ii,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(ka(null)).subscribe(()=>this._init())}ngOnChanges(r){let s=r.comparisonStart||r.comparisonEnd;s&&!s.firstChange&&this._setRanges(this.selected),r.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(r){let s=r.value,t=this._getDateFromDayOfMonth(s),g,b;this._selected instanceof ts?(g=this._getDateInCurrentMonth(this._selected.start),b=this._getDateInCurrentMonth(this._selected.end)):g=b=this._getDateInCurrentMonth(this._selected),(g!==s||b!==s)&&this.selectedChange.emit(t),this._userSelection.emit({value:t,event:r.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(r){let s=r.value,t=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(s),this._dateAdapter.compareDate(t,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(r){let s=this._activeDate,t=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,t?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,t?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=r.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=r.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:this._selectionKeyPressed=!0,this._canSelect(this._activeDate)&&r.preventDefault();return;case 27:this._previewEnd!=null&&!xm(r)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:r}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:r})),r.preventDefault(),r.stopPropagation());return;default:return}this._dateAdapter.compareDate(s,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let r=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(IS+this._dateAdapter.getDayOfWeek(r)-this._dateAdapter.getFirstDayOfWeek())%IS,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(r){this._matCalendarBody._focusActiveCell(r)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:r,value:s}){if(this._rangeStrategy){let t=s?s.rawValue:null,g=this._rangeStrategy.createPreview(t,this.selected,r);if(this._previewStart=this._getCellCompareValue(g.start),this._previewEnd=this._getCellCompareValue(g.end),this.activeDrag&&t){let b=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,t,r);b&&(this._previewStart=this._getCellCompareValue(b.start),this._previewEnd=this._getCellCompareValue(b.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(r){if(this.activeDrag)if(r.value){let s=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,r.value,r.event);this.dragEnded.emit({value:s??null,event:r.event})}else this.dragEnded.emit({value:null,event:r.event})}_getDateFromDayOfMonth(r){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r)}_initWeekdays(){let r=this._dateAdapter.getFirstDayOfWeek(),s=this._dateAdapter.getDayOfWeekNames("narrow"),g=this._dateAdapter.getDayOfWeekNames("long").map((b,M)=>({long:b,narrow:s[M]}));this._weekdays=g.slice(r).concat(g.slice(0,r))}_createWeekCells(){let r=this._dateAdapter.getNumDaysInMonth(this.activeDate),s=this._dateAdapter.getDateNames();this._weeks=[[]];for(let t=0,g=this._firstWeekOffset;t<r;t++,g++){g==IS&&(this._weeks.push([]),g=0);let b=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),t+1),M=this._shouldEnableDate(b),k=this._dateAdapter.format(b,this._dateFormats.display.dateA11yLabel),L=this.dateClass?this.dateClass(b,"month"):void 0;this._weeks[this._weeks.length-1].push(new F_(t+1,s[t],k,M,L,this._getCellCompareValue(b),b))}}_shouldEnableDate(r){return!!r&&(!this.minDate||this._dateAdapter.compareDate(r,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(r,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(r))}_getDateInCurrentMonth(r){return r&&this._hasSameMonthAndYear(r,this.activeDate)?this._dateAdapter.getDate(r):null}_hasSameMonthAndYear(r,s){return!!(r&&s&&this._dateAdapter.getMonth(r)==this._dateAdapter.getMonth(s)&&this._dateAdapter.getYear(r)==this._dateAdapter.getYear(s))}_getCellCompareValue(r){if(r){let s=this._dateAdapter.getYear(r),t=this._dateAdapter.getMonth(r),g=this._dateAdapter.getDate(r);return new Date(s,t,g).getTime()}return null}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setRanges(r){r instanceof ts?(this._rangeStart=this._getCellCompareValue(r.start),this._rangeEnd=this._getCellCompareValue(r.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(r),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(r){return!this.dateFilter||this.dateFilter(r)}_clearPreview(){this._previewStart=this._previewEnd=null}};n.\u0275fac=function(s){return new(s||n)(ge(_r),ge(Sm,8),ge(ca,8),ge(rc,8),ge(yP,8))},n.\u0275cmp=gt({type:n,selectors:[["mat-month-view"]],viewQuery:function(s,t){if(s&1&&ki(Am,5),s&2){let g;Ci(g=Si())&&(t._matCalendarBody=g.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],standalone:!0,features:[ar,Bn],decls:8,vars:14,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["scope","col"],["aria-hidden","true"],["colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown","label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName"],[1,"cdk-visually-hidden"]],template:function(s,t){s&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),Cr(3,MV,5,2,"th",2,d_),j(),V(5,"tr",3),Ee(6,"th",4),j()(),V(7,"tbody",5),Fe("selectedValueChange",function(b){return t._dateSelected(b)})("activeDateChange",function(b){return t._updateActiveDate(b)})("previewChange",function(b){return t._previewChanged(b)})("dragStarted",function(b){return t.dragStarted.emit(b)})("dragEnded",function(b){return t._dragEnded(b)})("keyup",function(b){return t._handleCalendarBodyKeyup(b)})("keydown",function(b){return t._handleCalendarBodyKeydown(b)}),j()()),s&2&&(xe(3),Sr(t._weekdays),xe(4),rt("label",t._monthLabel)("rows",t._weeks)("todayValue",t._todayDate)("startValue",t._rangeStart)("endValue",t._rangeEnd)("comparisonStart",t._comparisonRangeStart)("comparisonEnd",t._comparisonRangeEnd)("previewStart",t._previewStart)("previewEnd",t._previewEnd)("isRange",t._isRange)("labelMinRequiredCells",3)("activeCell",t._dateAdapter.getDate(t.activeDate)-1)("startDateAccessibleName",t.startDateAccessibleName)("endDateAccessibleName",t.endDateAccessibleName))},dependencies:[Am],encapsulation:2,changeDetection:0});let a=n;return a})(),Pa=24,ES=4,fP=(()=>{let n=class n{get activeDate(){return this._activeDate}set activeDate(r){let s=this._activeDate,t=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),bP(this._dateAdapter,s,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(r){r instanceof ts?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setSelectedYear(r)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,s,t){this._changeDetectorRef=r,this._dateAdapter=s,this._dir=t,this._rerenderSubscription=Da.EMPTY,this.selectedChange=new Ii,this.yearSelected=new Ii,this.activeDateChange=new Ii,this._dateAdapter,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(ka(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());let s=this._dateAdapter.getYear(this._activeDate)-R_(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let t=0,g=[];t<Pa;t++)g.push(s+t),g.length==ES&&(this._years.push(g.map(b=>this._createCellForYear(b))),g=[]);this._changeDetectorRef.markForCheck()}_yearSelected(r){let s=r.value,t=this._dateAdapter.createDate(s,0,1),g=this._getDateFromYear(s);this.yearSelected.emit(t),this.selectedChange.emit(g)}_updateActiveDate(r){let s=r.value,t=this._activeDate;this.activeDate=this._getDateFromYear(s),this._dateAdapter.compareDate(t,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(r){let s=this._activeDate,t=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-ES);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,ES);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-R_(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,Pa-R_(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?-Pa*10:-Pa);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?Pa*10:Pa);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(s,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_getActiveCell(){return R_(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(r){let s=this._dateAdapter.getMonth(this.activeDate),t=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(r,s,1));return this._dateAdapter.createDate(r,s,Math.min(this._dateAdapter.getDate(this.activeDate),t))}_createCellForYear(r){let s=this._dateAdapter.createDate(r,0,1),t=this._dateAdapter.getYearName(s),g=this.dateClass?this.dateClass(s,"multi-year"):void 0;return new F_(r,t,t,this._shouldEnableYear(r),g)}_shouldEnableYear(r){if(r==null||this.maxDate&&r>this._dateAdapter.getYear(this.maxDate)||this.minDate&&r<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;let s=this._dateAdapter.createDate(r,0,1);for(let t=s;this._dateAdapter.getYear(t)==r;t=this._dateAdapter.addCalendarDays(t,1))if(this.dateFilter(t))return!0;return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedYear(r){if(this._selectedYear=null,r instanceof ts){let s=r.start||r.end;s&&(this._selectedYear=this._dateAdapter.getYear(s))}else r&&(this._selectedYear=this._dateAdapter.getYear(r))}};n.\u0275fac=function(s){return new(s||n)(ge(_r),ge(ca,8),ge(rc,8))},n.\u0275cmp=gt({type:n,selectors:[["mat-multi-year-view"]],viewQuery:function(s,t){if(s&1&&ki(Am,5),s&2){let g;Ci(g=Si())&&(t._matCalendarBody=g.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],standalone:!0,features:[Bn],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell"]],template:function(s,t){s&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),Ee(3,"th",2),j()(),V(4,"tbody",3),Fe("selectedValueChange",function(b){return t._yearSelected(b)})("activeDateChange",function(b){return t._updateActiveDate(b)})("keyup",function(b){return t._handleCalendarBodyKeyup(b)})("keydown",function(b){return t._handleCalendarBodyKeydown(b)}),j()()),s&2&&(xe(4),rt("rows",t._years)("todayValue",t._todayYear)("startValue",t._selectedYear)("endValue",t._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",t._getActiveCell()))},dependencies:[Am],encapsulation:2,changeDetection:0});let a=n;return a})();function bP(a,n,d,r,s){let t=a.getYear(n),g=a.getYear(d),b=vP(a,r,s);return Math.floor((t-b)/Pa)===Math.floor((g-b)/Pa)}function R_(a,n,d,r){let s=a.getYear(n);return VV(s-vP(a,d,r),Pa)}function vP(a,n,d){let r=0;return d?r=a.getYear(d)-Pa+1:n&&(r=a.getYear(n)),r}function VV(a,n){return(a%n+n)%n}var gP=(()=>{let n=class n{get activeDate(){return this._activeDate}set activeDate(r){let s=this._activeDate,t=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),this._dateAdapter.getYear(s)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(r){r instanceof ts?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setSelectedMonth(r)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,s,t,g){this._changeDetectorRef=r,this._dateFormats=s,this._dateAdapter=t,this._dir=g,this._rerenderSubscription=Da.EMPTY,this.selectedChange=new Ii,this.monthSelected=new Ii,this.activeDateChange=new Ii,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(ka(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(r){let s=r.value,t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),s,1);this.monthSelected.emit(t);let g=this._getDateFromMonth(s);this.selectedChange.emit(g)}_updateActiveDate(r){let s=r.value,t=this._activeDate;this.activeDate=this._getDateFromMonth(s),this._dateAdapter.compareDate(t,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(r){let s=this._activeDate,t=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,t?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,t?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(s,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let r=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(s=>s.map(t=>this._createCellForMonth(t,r[t]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(r){return r&&this._dateAdapter.getYear(r)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(r):null}_getDateFromMonth(r){let s=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,1),t=this._dateAdapter.getNumDaysInMonth(s);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,Math.min(this._dateAdapter.getDate(this.activeDate),t))}_createCellForMonth(r,s){let t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,1),g=this._dateAdapter.format(t,this._dateFormats.display.monthYearA11yLabel),b=this.dateClass?this.dateClass(t,"year"):void 0;return new F_(r,s.toLocaleUpperCase(),g,this._shouldEnableMonth(r),b)}_shouldEnableMonth(r){let s=this._dateAdapter.getYear(this.activeDate);if(r==null||this._isYearAndMonthAfterMaxDate(s,r)||this._isYearAndMonthBeforeMinDate(s,r))return!1;if(!this.dateFilter)return!0;let t=this._dateAdapter.createDate(s,r,1);for(let g=t;this._dateAdapter.getMonth(g)==r;g=this._dateAdapter.addCalendarDays(g,1))if(this.dateFilter(g))return!0;return!1}_isYearAndMonthAfterMaxDate(r,s){if(this.maxDate){let t=this._dateAdapter.getYear(this.maxDate),g=this._dateAdapter.getMonth(this.maxDate);return r>t||r===t&&s>g}return!1}_isYearAndMonthBeforeMinDate(r,s){if(this.minDate){let t=this._dateAdapter.getYear(this.minDate),g=this._dateAdapter.getMonth(this.minDate);return r<t||r===t&&s<g}return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedMonth(r){r instanceof ts?this._selectedMonth=this._getMonthInCurrentYear(r.start)||this._getMonthInCurrentYear(r.end):this._selectedMonth=this._getMonthInCurrentYear(r)}};n.\u0275fac=function(s){return new(s||n)(ge(_r),ge(Sm,8),ge(ca,8),ge(rc,8))},n.\u0275cmp=gt({type:n,selectors:[["mat-year-view"]],viewQuery:function(s,t){if(s&1&&ki(Am,5),s&2){let g;Ci(g=Si())&&(t._matCalendarBody=g.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],standalone:!0,features:[Bn],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell"]],template:function(s,t){s&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),Ee(3,"th",2),j()(),V(4,"tbody",3),Fe("selectedValueChange",function(b){return t._monthSelected(b)})("activeDateChange",function(b){return t._updateActiveDate(b)})("keyup",function(b){return t._handleCalendarBodyKeyup(b)})("keydown",function(b){return t._handleCalendarBodyKeydown(b)}),j()()),s&2&&(xe(4),rt("label",t._yearLabel)("rows",t._months)("todayValue",t._todayMonth)("startValue",t._selectedMonth)("endValue",t._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",t._dateAdapter.getMonth(t.activeDate)))},dependencies:[Am],encapsulation:2,changeDetection:0});let a=n;return a})(),jV=1,xP=(()=>{let n=class n{constructor(r,s,t,g,b){this._intl=r,this.calendar=s,this._dateAdapter=t,this._dateFormats=g,this._id=`mat-calendar-header-${jV++}`,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>b.markForCheck())}get periodButtonText(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return this.calendar.currentView=="month"?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView=this.calendar.currentView=="month"?"multi-year":"month"}previousClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?-1:-Pa)}nextClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?1:Pa)}previousEnabled(){return this.calendar.minDate?!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate):!0}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(r,s){return this.calendar.currentView=="month"?this._dateAdapter.getYear(r)==this._dateAdapter.getYear(s)&&this._dateAdapter.getMonth(r)==this._dateAdapter.getMonth(s):this.calendar.currentView=="year"?this._dateAdapter.getYear(r)==this._dateAdapter.getYear(s):bP(this._dateAdapter,r,s,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){let s=this._dateAdapter.getYear(this.calendar.activeDate)-R_(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),t=s+Pa-1,g=this._dateAdapter.getYearName(this._dateAdapter.createDate(s,0,1)),b=this._dateAdapter.getYearName(this._dateAdapter.createDate(t,0,1));return[g,b]}};n.\u0275fac=function(s){return new(s||n)(ge(z_),ge(Fo(()=>DS)),ge(ca,8),ge(Sm,8),ge(_r))},n.\u0275cmp=gt({type:n,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],standalone:!0,features:[Bn],ngContentSelectors:TV,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],[1,"cdk-visually-hidden",3,"id"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"click","disabled"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"click","disabled"]],template:function(s,t){s&1&&(sa(),V(0,"div",0)(1,"div",1)(2,"label",2),Y(3),j(),V(4,"button",3),Fe("click",function(){return t.currentPeriodClicked()}),V(5,"span",4),Y(6),j(),kd(),V(7,"svg",5),Ee(8,"polygon",6),j()(),fC(),Ee(9,"div",7),zo(10),V(11,"button",8),Fe("click",function(){return t.previousClicked()}),j(),V(12,"button",9),Fe("click",function(){return t.nextClicked()}),j()()()),s&2&&(xe(2),rt("id",t._periodButtonLabelId),xe(),zt(t.periodButtonDescription),xe(),hn("aria-label",t.periodButtonLabel)("aria-describedby",t._periodButtonLabelId),xe(2),zt(t.periodButtonText),xe(),Ni("mat-calendar-invert",t.calendar.currentView!=="month"),xe(4),rt("disabled",!t.previousEnabled()),hn("aria-label",t.prevButtonLabel),xe(),rt("disabled",!t.nextEnabled()),hn("aria-label",t.nextButtonLabel))},dependencies:[vS,xS],encapsulation:2,changeDetection:0});let a=n;return a})(),DS=(()=>{let n=class n{get startAt(){return this._startAt}set startAt(r){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get selected(){return this._selected}set selected(r){r instanceof ts?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get activeDate(){return this._clampedActiveDate}set activeDate(r){this._clampedActiveDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(r){let s=this._currentView!==r?r:null;this._currentView=r,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),s&&this.viewChanged.emit(s)}constructor(r,s,t,g){this._dateAdapter=s,this._dateFormats=t,this._changeDetectorRef=g,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new Ii,this.yearSelected=new Ii,this.monthSelected=new Ii,this.viewChanged=new Ii(!0),this._userSelection=new Ii,this._userDragDrop=new Ii,this._activeDrag=null,this.stateChanges=new dn,this._intlChanges=r.changes.subscribe(()=>{g.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new Vd(this.headerComponent||xP),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(r){let s=r.minDate&&!this._dateAdapter.sameDate(r.minDate.previousValue,r.minDate.currentValue)?r.minDate:void 0,t=r.maxDate&&!this._dateAdapter.sameDate(r.maxDate.previousValue,r.maxDate.currentValue)?r.maxDate:void 0,g=s||t||r.dateFilter;if(g&&!g.firstChange){let b=this._getCurrentViewComponent();b&&(this._changeDetectorRef.detectChanges(),b._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(r){let s=r.value;(this.selected instanceof ts||s&&!this._dateAdapter.sameDate(s,this.selected))&&this.selectedChange.emit(s),this._userSelection.emit(r)}_yearSelectedInMultiYearView(r){this.yearSelected.emit(r)}_monthSelectedInYearView(r){this.monthSelected.emit(r)}_goToDateInView(r,s){this.activeDate=r,this.currentView=s}_dragStarted(r){this._activeDrag=r}_dragEnded(r){this._activeDrag&&(r.value&&this._userDragDrop.emit(r),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}};n.\u0275fac=function(s){return new(s||n)(ge(z_),ge(ca,8),ge(Sm,8),ge(_r))},n.\u0275cmp=gt({type:n,selectors:[["mat-calendar"]],viewQuery:function(s,t){if(s&1&&(ki(mP,5),ki(gP,5),ki(fP,5)),s&2){let g;Ci(g=Si())&&(t.monthView=g.first),Ci(g=Si())&&(t.yearView=g.first),Ci(g=Si())&&(t.multiYearView=g.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],standalone:!0,features:[gr([NV]),ar,Bn],decls:5,vars:2,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content"],[3,"activeDateChange","_userSelection","dragStarted","dragEnded","activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag"],[3,"activeDateChange","monthSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"],[3,"activeDateChange","yearSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"]],template:function(s,t){if(s&1&&(Zt(0,IV,0,0,"ng-template",0),V(1,"div",1),Zt(2,EV,1,11)(3,DV,1,6)(4,kV,1,6),j()),s&2){let g;rt("cdkPortalOutlet",t._calendarHeaderPortal),xe(2),Dr(2,(g=t.currentView)==="month"?2:g==="year"?3:g==="multi-year"?4:-1)}},dependencies:[jd,OA,mP,gP,fP],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight);--mdc-text-button-label-text-color:var(--mat-datepicker-calendar-period-button-text-color)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button:not(.mat-mdc-button-disabled),.mat-datepicker-content .mat-calendar-next-button:not(.mat-mdc-button-disabled){color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let a=n;return a})(),_P={transformPanel:SC("transformPanel",[p_("void => enter-dropdown",u_("120ms cubic-bezier(0, 0, 0.2, 1)",TC([Fd({opacity:0,transform:"scale(1, 0.8)"}),Fd({opacity:1,transform:"scale(1, 1)"})]))),p_("void => enter-dialog",u_("150ms cubic-bezier(0, 0, 0.2, 1)",TC([Fd({opacity:0,transform:"scale(0.7)"}),Fd({transform:"none",opacity:1})]))),p_("* => void",u_("100ms linear",Fd({opacity:0})))]),fadeInCalendar:SC("fadeInCalendar",[MC("void",Fd({opacity:0})),MC("enter",Fd({opacity:1})),p_("void => *",u_("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])};var UV=new Qt("mat-datepicker-scroll-strategy",{providedIn:"root",factory:()=>{let a=Nt(da);return()=>a.scrollStrategies.reposition()}});function HV(a){return()=>a.scrollStrategies.reposition()}var WV={provide:UV,deps:[da],useFactory:HV},GV=(()=>{let n=class n{constructor(r,s,t,g,b,M){this._elementRef=r,this._changeDetectorRef=s,this._globalModel=t,this._dateAdapter=g,this._rangeSelectionStrategy=b,this._subscriptions=new Da,this._animationDone=new dn,this._isAnimating=!1,this._actionsPortal=null,this._closeButtonText=M.closeCalendarLabel}ngOnInit(){this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(r){let s=this._model.selection,t=r.value,g=s instanceof ts;if(g&&this._rangeSelectionStrategy){let b=this._rangeSelectionStrategy.selectionFinished(t,s,r.event);this._model.updateSelection(b,this)}else t&&(g||!this._dateAdapter.sameDate(t,s))&&this._model.add(t);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(r){this._model.updateSelection(r.value,this)}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_handleAnimationEvent(r){this._isAnimating=r.phaseName==="start",this._isAnimating||this._animationDone.next()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(r,s){this._model=r?this._globalModel.clone():this._globalModel,this._actionsPortal=r,s&&this._changeDetectorRef.detectChanges()}};n.\u0275fac=function(s){return new(s||n)(ge(Zi),ge(_r),ge(Ev),ge(ca),ge(yP,8),ge(z_))},n.\u0275cmp=gt({type:n,selectors:[["mat-datepicker-content"]],viewQuery:function(s,t){if(s&1&&ki(DS,5),s&2){let g;Ci(g=Si())&&(t._calendar=g.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:5,hostBindings:function(s,t){s&1&&WD("@transformPanel.start",function(b){return t._handleAnimationEvent(b)})("@transformPanel.done",function(b){return t._handleAnimationEvent(b)}),s&2&&(HD("@transformPanel",t._animationState),Ms(t.color?"mat-"+t.color:""),Ni("mat-datepicker-content-touch",t.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],standalone:!0,features:[Bn],decls:5,vars:27,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop","id","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"focus","blur","click","color"]],template:function(s,t){if(s&1&&(V(0,"div",0)(1,"mat-calendar",1),Fe("yearSelected",function(b){return t.datepicker._selectYear(b)})("monthSelected",function(b){return t.datepicker._selectMonth(b)})("viewChanged",function(b){return t.datepicker._viewChanged(b)})("_userSelection",function(b){return t._handleUserSelection(b)})("_userDragDrop",function(b){return t._handleUserDragDrop(b)}),j(),Zt(2,AV,0,0,"ng-template",2),V(3,"button",3),Fe("focus",function(){return t._closeButtonFocused=!0})("blur",function(){return t._closeButtonFocused=!1})("click",function(){return t.datepicker.close()}),Y(4),j()()),s&2){let g;Ni("mat-datepicker-content-container-with-custom-header",t.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",t._actionsPortal),hn("aria-modal",!0)("aria-labelledby",(g=t._dialogLabelId)!==null&&g!==void 0?g:void 0),xe(),Ms(t.datepicker.panelClass),rt("id",t.datepicker.id)("startAt",t.datepicker.startAt)("startView",t.datepicker.startView)("minDate",t.datepicker._getMinDate())("maxDate",t.datepicker._getMaxDate())("dateFilter",t.datepicker._getDateFilter())("headerComponent",t.datepicker.calendarHeaderComponent)("selected",t._getSelected())("dateClass",t.datepicker.dateClass)("comparisonStart",t.comparisonStart)("comparisonEnd",t.comparisonEnd)("@fadeInCalendar","enter")("startDateAccessibleName",t.startDateAccessibleName)("endDateAccessibleName",t.endDateAccessibleName),xe(),rt("cdkPortalOutlet",t._actionsPortal),xe(),Ni("cdk-visually-hidden",!t._closeButtonFocused),rt("color",t.color||"primary"),xe(),zt(t._closeButtonText)}},dependencies:[AA,DS,jd,vS],styles:[".mat-datepicker-content{display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color);color:var(--mat-datepicker-calendar-container-text-color);box-shadow:var(--mat-datepicker-calendar-container-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-shape)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;box-shadow:var(--mat-datepicker-calendar-container-touch-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-touch-shape);position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}"],encapsulation:2,data:{animation:[_P.transformPanel,_P.fadeInCalendar]},changeDetection:0});let a=n;return a})();var $V=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275dir=Ei({type:n,selectors:[["","matDatepickerToggleIcon",""]],standalone:!0});let a=n;return a})(),qV=(()=>{let n=class n{get disabled(){return this._disabled===void 0&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(r){this._disabled=r}constructor(r,s,t){this._intl=r,this._changeDetectorRef=s,this._stateChanges=Da.EMPTY;let g=Number(t);this.tabIndex=g||g===0?g:null}ngOnChanges(r){r.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(r){this.datepicker&&!this.disabled&&(this.datepicker.open(),r.stopPropagation())}_watchStateChanges(){let r=this.datepicker?this.datepicker.stateChanges:Jt(),s=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:Jt(),t=this.datepicker?uu(this.datepicker.openedStream,this.datepicker.closedStream):Jt();this._stateChanges.unsubscribe(),this._stateChanges=uu(this._intl.changes,r,s,t).subscribe(()=>this._changeDetectorRef.markForCheck())}};n.\u0275fac=function(s){return new(s||n)(ge(z_),ge(_r),Ad("tabindex"))},n.\u0275cmp=gt({type:n,selectors:[["mat-datepicker-toggle"]],contentQueries:function(s,t,g){if(s&1&&hm(g,$V,5),s&2){let b;Ci(b=Si())&&(t._customIcon=b.first)}},viewQuery:function(s,t){if(s&1&&ki(PV,5),s&2){let g;Ci(g=Si())&&(t._button=g.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(s,t){s&1&&Fe("click",function(b){return t._open(b)}),s&2&&(hn("tabindex",null)("data-mat-calendar",t.datepicker?t.datepicker.id:null),Ni("mat-datepicker-toggle-active",t.datepicker&&t.datepicker.opened)("mat-accent",t.datepicker&&t.datepicker.color==="accent")("mat-warn",t.datepicker&&t.datepicker.color==="warn"))},inputs:{datepicker:[bi.None,"for","datepicker"],tabIndex:"tabIndex",ariaLabel:[bi.None,"aria-label","ariaLabel"],disabled:[bi.HasDecoratorInputTransform,"disabled","disabled",sr],disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],standalone:!0,features:[co,ar,Bn],ngContentSelectors:RV,decls:4,vars:6,consts:[["button",""],["mat-icon-button","","type","button",3,"disabled","disableRipple"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(s,t){s&1&&(sa(OV),V(0,"button",1,0),Zt(2,FV,2,0,":svg:svg",2),zo(3),j()),s&2&&(rt("disabled",t.disabled)("disableRipple",t.disableRipple),hn("aria-haspopup",t.datepicker?"dialog":null)("aria-label",t.ariaLabel||t._intl.openCalendarLabel)("tabindex",t.disabled?-1:t.tabIndex),xe(2),Dr(2,t._customIcon?-1:2))},dependencies:[xS],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color)}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color)}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}"],encapsulation:2,changeDetection:0});let a=n;return a})();var wP=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({providers:[z_,WV],imports:[ol,hP,Em,_v,oc,Un,GV,qV,xP,wv]});let a=n;return a})();function YV(a,n){}var Iu=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}};var NS=(()=>{let n=class n extends Mm{constructor(r,s,t,g,b,M,k,L){super(),this._elementRef=r,this._focusTrapFactory=s,this._config=g,this._interactivityChecker=b,this._ngZone=M,this._overlayRef=k,this._focusMonitor=L,this._platform=Nt(qn),this._focusTrap=null,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this._changeDetectorRef=Nt(_r),this.attachDomPortal=G=>{this._portalOutlet.hasAttached();let J=this._portalOutlet.attachDomPortal(G);return this._contentAttached(),J},this._document=t,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(r){this._ariaLabelledByQueue.push(r),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(r){let s=this._ariaLabelledByQueue.indexOf(r);s>-1&&(this._ariaLabelledByQueue.splice(s,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(r){this._portalOutlet.hasAttached();let s=this._portalOutlet.attachComponentPortal(r);return this._contentAttached(),s}attachTemplatePortal(r){this._portalOutlet.hasAttached();let s=this._portalOutlet.attachTemplatePortal(r);return this._contentAttached(),s}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(r,s){this._interactivityChecker.isFocusable(r)||(r.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let t=()=>{r.removeEventListener("blur",t),r.removeEventListener("mousedown",t),r.removeAttribute("tabindex")};r.addEventListener("blur",t),r.addEventListener("mousedown",t)})),r.focus(s)}_focusByCssSelector(r,s){let t=this._elementRef.nativeElement.querySelector(r);t&&this._forceFocus(t,s)}_trapFocus(){let r=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||r.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElementWhenReady().then(s=>{s||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}}_restoreFocus(){let r=this._config.restoreFocus,s=null;if(typeof r=="string"?s=this._document.querySelector(r):typeof r=="boolean"?s=r?this._elementFocusedBeforeDialogWasOpened:null:r&&(s=r),this._config.restoreFocus&&s&&typeof s.focus=="function"){let t=wu(),g=this._elementRef.nativeElement;(!t||t===this._document.body||t===g||g.contains(t))&&(this._focusMonitor?(this._focusMonitor.focusVia(s,this._closeInteractionType),this._closeInteractionType=null):s.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let r=this._elementRef.nativeElement,s=wu();return r===s||r.contains(s)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=wu()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}};n.\u0275fac=function(s){return new(s||n)(ge(Zi),ge(A_),ge(Ai,8),ge(Iu),ge(k_),ge(di),ge(ac),ge(nc))},n.\u0275cmp=gt({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(s,t){if(s&1&&ki(jd,7),s&2){let g;Ci(g=Si())&&(t._portalOutlet=g.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(s,t){s&2&&hn("id",t._config.id||null)("role",t._config.role)("aria-modal",t._config.ariaModal)("aria-labelledby",t._config.ariaLabel?null:t._ariaLabelledByQueue[0])("aria-label",t._config.ariaLabel)("aria-describedby",t._config.ariaDescribedBy||null)},standalone:!0,features:[zn,Bn],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(s,t){s&1&&Zt(0,YV,0,0,"ng-template",0)},dependencies:[jd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2});let a=n;return a})(),B_=class{constructor(n,d){this.overlayRef=n,this.config=d,this.closed=new dn,this.disableClose=d.disableClose,this.backdropClick=n.backdropClick(),this.keydownEvents=n.keydownEvents(),this.outsidePointerEvents=n.outsidePointerEvents(),this.id=d.id,this.keydownEvents.subscribe(r=>{r.keyCode===27&&!this.disableClose&&!xm(r)&&(r.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=n.detachments().subscribe(()=>{d.closeOnOverlayDetachments!==!1&&this.close()})}close(n,d){if(this.containerInstance){let r=this.closed;this.containerInstance._closeInteractionType=d?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),r.next(n),r.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(n="",d=""){return this.overlayRef.updateSize({width:n,height:d}),this}addPanelClass(n){return this.overlayRef.addPanelClass(n),this}removePanelClass(n){return this.overlayRef.removePanelClass(n),this}},ZV=new Qt("DialogScrollStrategy",{providedIn:"root",factory:()=>{let a=Nt(da);return()=>a.scrollStrategies.block()}}),XV=new Qt("DialogData"),KV=new Qt("DefaultDialogConfig");var QV=0,VS=(()=>{let n=class n{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(r,s,t,g,b,M){this._overlay=r,this._injector=s,this._defaultOptions=t,this._parentDialog=g,this._overlayContainer=b,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new dn,this._afterOpenedAtThisLevel=new dn,this._ariaHiddenElements=new Map,this.afterAllClosed=hu(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ka(void 0))),this._scrollStrategy=M}open(r,s){let t=this._defaultOptions||new Iu;s=kt(kt({},t),s),s.id=s.id||`cdk-dialog-${QV++}`,s.id&&this.getDialogById(s.id);let g=this._getOverlayConfig(s),b=this._overlay.create(g),M=new B_(b,s),k=this._attachContainer(b,M,s);return M.containerInstance=k,this._attachDialogContent(r,M,k,s),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(M),M.closed.subscribe(()=>this._removeOpenDialog(M,!0)),this.afterOpened.next(M),M}closeAll(){BS(this.openDialogs,r=>r.close())}getDialogById(r){return this.openDialogs.find(s=>s.id===r)}ngOnDestroy(){BS(this._openDialogsAtThisLevel,r=>{r.config.closeOnDestroy===!1&&this._removeOpenDialog(r,!1)}),BS(this._openDialogsAtThisLevel,r=>r.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(r){let s=new Tm({positionStrategy:r.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:r.scrollStrategy||this._scrollStrategy(),panelClass:r.panelClass,hasBackdrop:r.hasBackdrop,direction:r.direction,minWidth:r.minWidth,minHeight:r.minHeight,maxWidth:r.maxWidth,maxHeight:r.maxHeight,width:r.width,height:r.height,disposeOnNavigation:r.closeOnNavigation});return r.backdropClass&&(s.backdropClass=r.backdropClass),s}_attachContainer(r,s,t){let g=t.injector||t.viewContainerRef?.injector,b=[{provide:Iu,useValue:t},{provide:B_,useValue:s},{provide:ac,useValue:r}],M;t.container?typeof t.container=="function"?M=t.container:(M=t.container.type,b.push(...t.container.providers(t))):M=NS;let k=new Vd(M,t.viewContainerRef,Lo.create({parent:g||this._injector,providers:b}),t.componentFactoryResolver);return r.attach(k).instance}_attachDialogContent(r,s,t,g){if(r instanceof fu){let b=this._createInjector(g,s,t,void 0),M={$implicit:g.data,dialogRef:s};g.templateContext&&(M=kt(kt({},M),typeof g.templateContext=="function"?g.templateContext():g.templateContext)),t.attachTemplatePortal(new Mu(r,null,M,b))}else{let b=this._createInjector(g,s,t,this._injector),M=t.attachComponentPortal(new Vd(r,g.viewContainerRef,b,g.componentFactoryResolver));s.componentRef=M,s.componentInstance=M.instance}}_createInjector(r,s,t,g){let b=r.injector||r.viewContainerRef?.injector,M=[{provide:XV,useValue:r.data},{provide:B_,useValue:s}];return r.providers&&(typeof r.providers=="function"?M.push(...r.providers(s,r,t)):M.push(...r.providers)),r.direction&&(!b||!b.get(rc,null,{optional:!0}))&&M.push({provide:rc,useValue:{value:r.direction,change:Jt()}}),Lo.create({parent:b||g,providers:M})}_removeOpenDialog(r,s){let t=this.openDialogs.indexOf(r);t>-1&&(this.openDialogs.splice(t,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((g,b)=>{g?b.setAttribute("aria-hidden",g):b.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),s&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let r=this._overlayContainer.getContainerElement();if(r.parentElement){let s=r.parentElement.children;for(let t=s.length-1;t>-1;t--){let g=s[t];g!==r&&g.nodeName!=="SCRIPT"&&g.nodeName!=="STYLE"&&!g.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(g,g.getAttribute("aria-hidden")),g.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let r=this._parentDialog;return r?r._getAfterAllClosed():this._afterAllClosedAtThisLevel}};n.\u0275fac=function(s){return new(s||n)(Ye(da),Ye(Lo),Ye(KV,8),Ye(n,12),Ye(Im),Ye(ZV))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();function BS(a,n){let d=a.length;for(;d--;)n(a[d])}var CP=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({providers:[VS],imports:[Em,oc,_v,oc]});let a=n;return a})();function JV(a,n){}var N_=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}},jS="mdc-dialog--open",SP="mdc-dialog--opening",MP="mdc-dialog--closing",ej=150,tj=75,ij=(()=>{let n=class n extends NS{constructor(r,s,t,g,b,M,k,L,G){super(r,s,t,g,b,M,k,G),this._animationMode=L,this._animationStateChanged=new Ii,this._animationsEnabled=this._animationMode!=="NoopAnimations",this._actionSectionCount=0,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?IP(this._config.enterAnimationDuration)??ej:0,this._exitAnimationDuration=this._animationsEnabled?IP(this._config.exitAnimationDuration)??tj:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(TP,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(SP,jS)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(jS),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(jS),this._animationsEnabled?(this._hostElement.style.setProperty(TP,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(MP)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(r){this._actionSectionCount+=r,this._changeDetectorRef.markForCheck()}_clearAnimationClasses(){this._hostElement.classList.remove(SP,MP)}_waitForAnimationToComplete(r,s){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(s,r)}_requestAnimationFrame(r){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(r):r()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(r){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:r})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(r){let s=super.attachComponentPortal(r);return s.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),s}};n.\u0275fac=function(s){return new(s||n)(ge(Zi),ge(A_),ge(Ai,8),ge(N_),ge(k_),ge(di),ge(ac),ge(lo,8),ge(nc))},n.\u0275cmp=gt({type:n,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(s,t){s&2&&(Ql("id",t._config.id),hn("aria-modal",t._config.ariaModal)("role",t._config.role)("aria-labelledby",t._config.ariaLabel?null:t._ariaLabelledByQueue[0])("aria-label",t._config.ariaLabel)("aria-describedby",t._config.ariaDescribedBy||null),Ni("_mat-animation-noopable",!t._animationsEnabled)("mat-mdc-dialog-container-with-actions",t._actionSectionCount>0))},standalone:!0,features:[zn,Bn],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1),Zt(2,JV,0,0,"ng-template",2),j()())},dependencies:[jd],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0;transform:scale(0.8)}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--closing .mdc-dialog__surface{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{opacity:1}.mdc-dialog--open .mdc-dialog__surface{transform:none}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{width:100%;height:100%}.mat-mdc-dialog-component-host{display:contents}.mat-mdc-dialog-container{--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition:opacity linear var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container .mdc-dialog__surface{transition:transform var(--mat-dialog-transition-duration, 0ms) 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container,.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__surface{transition:none}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 80vw);min-width:var(--mat-dialog-container-min-width, 0)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, 80vw)}}.mat-mdc-dialog-title{padding:var(--mat-dialog-headline-padding, 0 24px 9px)}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{padding:var(--mat-dialog-actions-padding, 8px);justify-content:var(--mat-dialog-actions-alignment, start)}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2});let a=n;return a})(),TP="--mat-dialog-transition-duration";function IP(a){return a==null?null:typeof a=="number"?a:a.endsWith("ms")?D_(a.substring(0,a.length-2)):a.endsWith("s")?D_(a.substring(0,a.length-1))*1e3:a==="0"?0:null}var Dv=function(a){return a[a.OPEN=0]="OPEN",a[a.CLOSING=1]="CLOSING",a[a.CLOSED=2]="CLOSED",a}(Dv||{}),Pm=class{constructor(n,d,r){this._ref=n,this._containerInstance=r,this._afterOpened=new dn,this._beforeClosed=new dn,this._state=Dv.OPEN,this.disableClose=d.disableClose,this.id=n.id,n.addPanelClass("mat-mdc-dialog-panel"),r._animationStateChanged.pipe(wr(s=>s.state==="opened"),ao(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),r._animationStateChanged.pipe(wr(s=>s.state==="closed"),ao(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),n.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),uu(this.backdropClick(),this.keydownEvents().pipe(wr(s=>s.keyCode===27&&!this.disableClose&&!xm(s)))).subscribe(s=>{this.disableClose||(s.preventDefault(),nj(this,s.type==="keydown"?"keyboard":"mouse"))})}close(n){this._result=n,this._containerInstance._animationStateChanged.pipe(wr(d=>d.state==="closing"),ao(1)).subscribe(d=>{this._beforeClosed.next(n),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),d.totalTime+100)}),this._state=Dv.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(n){let d=this._ref.config.positionStrategy;return n&&(n.left||n.right)?n.left?d.left(n.left):d.right(n.right):d.centerHorizontally(),n&&(n.top||n.bottom)?n.top?d.top(n.top):d.bottom(n.bottom):d.centerVertically(),this._ref.updatePosition(),this}updateSize(n="",d=""){return this._ref.updateSize(n,d),this}addPanelClass(n){return this._ref.addPanelClass(n),this}removePanelClass(n){return this._ref.removePanelClass(n),this}getState(){return this._state}_finishDialogClose(){this._state=Dv.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function nj(a,n,d){return a._closeInteractionType=n,a.close(d)}var US=new Qt("MatMdcDialogData"),rj=new Qt("mat-mdc-dialog-default-options"),oj=new Qt("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let a=Nt(da);return()=>a.scrollStrategies.block()}});var aj=0,Om=(()=>{let n=class n{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let r=this._parentDialog;return r?r._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(r,s,t,g,b,M,k,L){this._overlay=r,this._defaultOptions=g,this._scrollStrategy=b,this._parentDialog=M,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new dn,this._afterOpenedAtThisLevel=new dn,this.dialogConfigClass=N_,this.afterAllClosed=hu(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ka(void 0))),this._dialog=s.get(VS),this._dialogRefConstructor=Pm,this._dialogContainerType=ij,this._dialogDataToken=US}open(r,s){let t;s=kt(kt({},this._defaultOptions||new N_),s),s.id=s.id||`mat-mdc-dialog-${aj++}`,s.scrollStrategy=s.scrollStrategy||this._scrollStrategy();let g=this._dialog.open(r,Cn(kt({},s),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:s},{provide:Iu,useValue:s}]},templateContext:()=>({dialogRef:t}),providers:(b,M,k)=>(t=new this._dialogRefConstructor(b,s,k),t.updatePosition(s?.position),[{provide:this._dialogContainerType,useValue:k},{provide:this._dialogDataToken,useValue:M.data},{provide:this._dialogRefConstructor,useValue:t}])}));return t.componentRef=g.componentRef,t.componentInstance=g.componentInstance,this.openDialogs.push(t),this.afterOpened.next(t),t.afterClosed().subscribe(()=>{let b=this.openDialogs.indexOf(t);b>-1&&(this.openDialogs.splice(b,1),this.openDialogs.length||this._getAfterAllClosed().next())}),t}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(r){return this.openDialogs.find(s=>s.id===r)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(r){let s=r.length;for(;s--;)r[s].close()}};n.\u0275fac=function(s){return new(s||n)(Ye(da),Ye(Lo),Ye(Pi,8),Ye(rj,8),Ye(oj),Ye(n,12),Ye(Im),Ye(lo,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),sj=0;var EP=(()=>{let n=class n{constructor(r,s,t){this._dialogRef=r,this._elementRef=s,this._dialog=t}ngOnInit(){this._dialogRef||(this._dialogRef=lj(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{this._onAdd()})}ngOnDestroy(){this._dialogRef?._containerInstance&&Promise.resolve().then(()=>{this._onRemove()})}};n.\u0275fac=function(s){return new(s||n)(ge(Pm,8),ge(Zi),ge(Om))},n.\u0275dir=Ei({type:n,standalone:!0});let a=n;return a})(),DP=(()=>{let n=class n extends EP{constructor(){super(...arguments),this.id=`mat-mdc-dialog-title-${sj++}`}_onAdd(){this._dialogRef._containerInstance?._addAriaLabelledBy?.(this.id)}_onRemove(){this._dialogRef?._containerInstance?._removeAriaLabelledBy?.(this.id)}};n.\u0275fac=(()=>{let r;return function(t){return(r||(r=vo(n)))(t||n)}})(),n.\u0275dir=Ei({type:n,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-mdc-dialog-title","mdc-dialog__title"],hostVars:1,hostBindings:function(s,t){s&2&&Ql("id",t.id)},inputs:{id:"id"},exportAs:["matDialogTitle"],standalone:!0,features:[zn]});let a=n;return a})(),kP=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275dir=Ei({type:n,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],standalone:!0});let a=n;return a})(),AP=(()=>{let n=class n extends EP{_onAdd(){this._dialogRef._containerInstance?._updateActionSectionCount?.(1)}_onRemove(){this._dialogRef._containerInstance?._updateActionSectionCount?.(-1)}};n.\u0275fac=(()=>{let r;return function(t){return(r||(r=vo(n)))(t||n)}})(),n.\u0275dir=Ei({type:n,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:6,hostBindings:function(s,t){s&2&&Ni("mat-mdc-dialog-actions-align-start",t.align==="start")("mat-mdc-dialog-actions-align-center",t.align==="center")("mat-mdc-dialog-actions-align-end",t.align==="end")},inputs:{align:"align"},standalone:!0,features:[zn]});let a=n;return a})();function lj(a,n){let d=a.nativeElement.parentElement;for(;d&&!d.classList.contains("mat-mdc-dialog-container");)d=d.parentElement;return d?n.find(r=>r.id===d.id):null}var PP=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({providers:[Om],imports:[CP,Em,oc,Un,Un]});let a=n;return a})();var rn="primary",e0=Symbol("RouteTitle"),YS=class{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let d=this.params[n];return Array.isArray(d)?d[0]:d}return null}getAll(n){if(this.has(n)){let d=this.params[n];return Array.isArray(d)?d:[d]}return[]}get keys(){return Object.keys(this.params)}};function Bm(a){return new YS(a)}function cj(a,n,d){let r=d.path.split("/");if(r.length>a.length||d.pathMatch==="full"&&(n.hasChildren()||r.length<a.length))return null;let s={};for(let t=0;t<r.length;t++){let g=r[t],b=a[t];if(g.startsWith(":"))s[g.substring(1)]=b;else if(g!==b.path)return null}return{consumed:a.slice(0,r.length),posParams:s}}function dj(a,n){if(a.length!==n.length)return!1;for(let d=0;d<a.length;++d)if(!sl(a[d],n[d]))return!1;return!0}function sl(a,n){let d=a?ZS(a):void 0,r=n?ZS(n):void 0;if(!d||!r||d.length!=r.length)return!1;let s;for(let t=0;t<d.length;t++)if(s=d[t],!jP(a[s],n[s]))return!1;return!0}function ZS(a){return[...Object.keys(a),...Object.getOwnPropertySymbols(a)]}function jP(a,n){if(Array.isArray(a)&&Array.isArray(n)){if(a.length!==n.length)return!1;let d=[...a].sort(),r=[...n].sort();return d.every((s,t)=>r[t]===s)}else return a===n}function UP(a){return a.length>0?a[a.length-1]:null}function $d(a){return aC(a)?a:Vb(a)?oo(Promise.resolve(a)):Jt(a)}var hj={exact:WP,subset:GP},HP={exact:uj,subset:pj,ignored:()=>!0};function OP(a,n,d){return hj[d.paths](a.root,n.root,d.matrixParams)&&HP[d.queryParams](a.queryParams,n.queryParams)&&!(d.fragment==="exact"&&a.fragment!==n.fragment)}function uj(a,n){return sl(a,n)}function WP(a,n,d){if(!Du(a.segments,n.segments)||!Pv(a.segments,n.segments,d)||a.numberOfChildren!==n.numberOfChildren)return!1;for(let r in n.children)if(!a.children[r]||!WP(a.children[r],n.children[r],d))return!1;return!0}function pj(a,n){return Object.keys(n).length<=Object.keys(a).length&&Object.keys(n).every(d=>jP(a[d],n[d]))}function GP(a,n,d){return $P(a,n,n.segments,d)}function $P(a,n,d,r){if(a.segments.length>d.length){let s=a.segments.slice(0,d.length);return!(!Du(s,d)||n.hasChildren()||!Pv(s,d,r))}else if(a.segments.length===d.length){if(!Du(a.segments,d)||!Pv(a.segments,d,r))return!1;for(let s in n.children)if(!a.children[s]||!GP(a.children[s],n.children[s],r))return!1;return!0}else{let s=d.slice(0,a.segments.length),t=d.slice(a.segments.length);return!Du(a.segments,s)||!Pv(a.segments,s,r)||!a.children[rn]?!1:$P(a.children[rn],n,t,r)}}function Pv(a,n,d){return n.every((r,s)=>HP[d](a[s].parameters,r.parameters))}var Hd=class{constructor(n=new Nn([],{}),d={},r=null){this.root=n,this.queryParams=d,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Bm(this.queryParams),this._queryParamMap}toString(){return gj.serialize(this)}},Nn=class{constructor(n,d){this.segments=n,this.children=d,this.parent=null,Object.values(d).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ov(this)}},Eu=class{constructor(n,d){this.path=n,this.parameters=d}get parameterMap(){return this._parameterMap??=Bm(this.parameters),this._parameterMap}toString(){return YP(this)}};function mj(a,n){return Du(a,n)&&a.every((d,r)=>sl(d.parameters,n[r].parameters))}function Du(a,n){return a.length!==n.length?!1:a.every((d,r)=>d.path===n[r].path)}function fj(a,n){let d=[];return Object.entries(a.children).forEach(([r,s])=>{r===rn&&(d=d.concat(n(s,r)))}),Object.entries(a.children).forEach(([r,s])=>{r!==rn&&(d=d.concat(n(s,r)))}),d}var t0=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:()=>new $_,providedIn:"root"});let a=n;return a})(),$_=class{parse(n){let d=new KS(n);return new Hd(d.parseRootSegment(),d.parseQueryParams(),d.parseFragment())}serialize(n){let d=`/${V_(n.root,!0)}`,r=bj(n.queryParams),s=typeof n.fragment=="string"?`#${_j(n.fragment)}`:"";return`${d}${r}${s}`}},gj=new $_;function Ov(a){return a.segments.map(n=>YP(n)).join("/")}function V_(a,n){if(!a.hasChildren())return Ov(a);if(n){let d=a.children[rn]?V_(a.children[rn],!1):"",r=[];return Object.entries(a.children).forEach(([s,t])=>{s!==rn&&r.push(`${s}:${V_(t,!1)}`)}),r.length>0?`${d}(${r.join("//")})`:d}else{let d=fj(a,(r,s)=>s===rn?[V_(a.children[rn],!1)]:[`${s}:${V_(r,!1)}`]);return Object.keys(a.children).length===1&&a.children[rn]!=null?`${Ov(a)}/${d[0]}`:`${Ov(a)}/(${d.join("//")})`}}function qP(a){return encodeURIComponent(a).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function kv(a){return qP(a).replace(/%3B/gi,";")}function _j(a){return encodeURI(a)}function XS(a){return qP(a).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Rv(a){return decodeURIComponent(a)}function RP(a){return Rv(a.replace(/\+/g,"%20"))}function YP(a){return`${XS(a.path)}${yj(a.parameters)}`}function yj(a){return Object.entries(a).map(([n,d])=>`;${XS(n)}=${XS(d)}`).join("")}function bj(a){let n=Object.entries(a).map(([d,r])=>Array.isArray(r)?r.map(s=>`${kv(d)}=${kv(s)}`).join("&"):`${kv(d)}=${kv(r)}`).filter(d=>d);return n.length?`?${n.join("&")}`:""}var vj=/^[^\/()?;#]+/;function WS(a){let n=a.match(vj);return n?n[0]:""}var xj=/^[^\/()?;=#]+/;function wj(a){let n=a.match(xj);return n?n[0]:""}var Cj=/^[^=?&#]+/;function Sj(a){let n=a.match(Cj);return n?n[0]:""}var Mj=/^[^&#]+/;function Tj(a){let n=a.match(Mj);return n?n[0]:""}var KS=class{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Nn([],{}):new Nn([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let d={};this.peekStartsWith("/(")&&(this.capture("/"),d=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(d).length>0)&&(r[rn]=new Nn(n,d)),r}parseSegment(){let n=WS(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new $n(4009,!1);return this.capture(n),new Eu(Rv(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let d=wj(this.remaining);if(!d)return;this.capture(d);let r="";if(this.consumeOptional("=")){let s=WS(this.remaining);s&&(r=s,this.capture(r))}n[Rv(d)]=Rv(r)}parseQueryParam(n){let d=Sj(this.remaining);if(!d)return;this.capture(d);let r="";if(this.consumeOptional("=")){let g=Tj(this.remaining);g&&(r=g,this.capture(r))}let s=RP(d),t=RP(r);if(n.hasOwnProperty(s)){let g=n[s];Array.isArray(g)||(g=[g],n[s]=g),g.push(t)}else n[s]=t}parseParens(n){let d={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=WS(this.remaining),s=this.remaining[r.length];if(s!=="/"&&s!==")"&&s!==";")throw new $n(4010,!1);let t;r.indexOf(":")>-1?(t=r.slice(0,r.indexOf(":")),this.capture(t),this.capture(":")):n&&(t=rn);let g=this.parseChildren();d[t]=Object.keys(g).length===1?g[rn]:new Nn([],g),this.consumeOptional("//")}return d}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new $n(4011,!1)}};function ZP(a){return a.segments.length>0?new Nn([],{[rn]:a}):a}function XP(a){let n={};for(let[r,s]of Object.entries(a.children)){let t=XP(s);if(r===rn&&t.segments.length===0&&t.hasChildren())for(let[g,b]of Object.entries(t.children))n[g]=b;else(t.segments.length>0||t.hasChildren())&&(n[r]=t)}let d=new Nn(a.segments,n);return Ij(d)}function Ij(a){if(a.numberOfChildren===1&&a.children[rn]){let n=a.children[rn];return new Nn(a.segments.concat(n.segments),n.children)}return a}function Nm(a){return a instanceof Hd}function Ej(a,n,d=null,r=null){let s=KP(a);return QP(s,n,d,r)}function KP(a){let n;function d(t){let g={};for(let M of t.children){let k=d(M);g[M.outlet]=k}let b=new Nn(t.url,g);return t===a&&(n=b),b}let r=d(a.root),s=ZP(r);return n??s}function QP(a,n,d,r){let s=a;for(;s.parent;)s=s.parent;if(n.length===0)return GS(s,s,s,d,r);let t=Dj(n);if(t.toRoot())return GS(s,s,new Nn([],{}),d,r);let g=kj(t,s,a),b=g.processChildren?H_(g.segmentGroup,g.index,t.commands):eO(g.segmentGroup,g.index,t.commands);return GS(s,g.segmentGroup,b,d,r)}function Fv(a){return typeof a=="object"&&a!=null&&!a.outlets&&!a.segmentPath}function q_(a){return typeof a=="object"&&a!=null&&a.outlets}function GS(a,n,d,r,s){let t={};r&&Object.entries(r).forEach(([M,k])=>{t[M]=Array.isArray(k)?k.map(L=>`${L}`):`${k}`});let g;a===n?g=d:g=JP(a,n,d);let b=ZP(XP(g));return new Hd(b,t,s)}function JP(a,n,d){let r={};return Object.entries(a.children).forEach(([s,t])=>{t===n?r[s]=d:r[s]=JP(t,n,d)}),new Nn(a.segments,r)}var Lv=class{constructor(n,d,r){if(this.isAbsolute=n,this.numberOfDoubleDots=d,this.commands=r,n&&r.length>0&&Fv(r[0]))throw new $n(4003,!1);let s=r.find(q_);if(s&&s!==UP(r))throw new $n(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function Dj(a){if(typeof a[0]=="string"&&a.length===1&&a[0]==="/")return new Lv(!0,0,a);let n=0,d=!1,r=a.reduce((s,t,g)=>{if(typeof t=="object"&&t!=null){if(t.outlets){let b={};return Object.entries(t.outlets).forEach(([M,k])=>{b[M]=typeof k=="string"?k.split("/"):k}),[...s,{outlets:b}]}if(t.segmentPath)return[...s,t.segmentPath]}return typeof t!="string"?[...s,t]:g===0?(t.split("/").forEach((b,M)=>{M==0&&b==="."||(M==0&&b===""?d=!0:b===".."?n++:b!=""&&s.push(b))}),s):[...s,t]},[]);return new Lv(d,n,r)}var Lm=class{constructor(n,d,r){this.segmentGroup=n,this.processChildren=d,this.index=r}};function kj(a,n,d){if(a.isAbsolute)return new Lm(n,!0,0);if(!d)return new Lm(n,!1,NaN);if(d.parent===null)return new Lm(d,!0,0);let r=Fv(a.commands[0])?0:1,s=d.segments.length-1+r;return Aj(d,s,a.numberOfDoubleDots)}function Aj(a,n,d){let r=a,s=n,t=d;for(;t>s;){if(t-=s,r=r.parent,!r)throw new $n(4005,!1);s=r.segments.length}return new Lm(r,!1,s-t)}function Pj(a){return q_(a[0])?a[0].outlets:{[rn]:a}}function eO(a,n,d){if(a??=new Nn([],{}),a.segments.length===0&&a.hasChildren())return H_(a,n,d);let r=Oj(a,n,d),s=d.slice(r.commandIndex);if(r.match&&r.pathIndex<a.segments.length){let t=new Nn(a.segments.slice(0,r.pathIndex),{});return t.children[rn]=new Nn(a.segments.slice(r.pathIndex),a.children),H_(t,0,s)}else return r.match&&s.length===0?new Nn(a.segments,{}):r.match&&!a.hasChildren()?QS(a,n,d):r.match?H_(a,0,s):QS(a,n,d)}function H_(a,n,d){if(d.length===0)return new Nn(a.segments,{});{let r=Pj(d),s={};if(Object.keys(r).some(t=>t!==rn)&&a.children[rn]&&a.numberOfChildren===1&&a.children[rn].segments.length===0){let t=H_(a.children[rn],n,d);return new Nn(a.segments,t.children)}return Object.entries(r).forEach(([t,g])=>{typeof g=="string"&&(g=[g]),g!==null&&(s[t]=eO(a.children[t],n,g))}),Object.entries(a.children).forEach(([t,g])=>{r[t]===void 0&&(s[t]=g)}),new Nn(a.segments,s)}}function Oj(a,n,d){let r=0,s=n,t={match:!1,pathIndex:0,commandIndex:0};for(;s<a.segments.length;){if(r>=d.length)return t;let g=a.segments[s],b=d[r];if(q_(b))break;let M=`${b}`,k=r<d.length-1?d[r+1]:null;if(s>0&&M===void 0)break;if(M&&k&&typeof k=="object"&&k.outlets===void 0){if(!LP(M,k,g))return t;r+=2}else{if(!LP(M,{},g))return t;r++}s++}return{match:!0,pathIndex:s,commandIndex:r}}function QS(a,n,d){let r=a.segments.slice(0,n),s=0;for(;s<d.length;){let t=d[s];if(q_(t)){let M=Rj(t.outlets);return new Nn(r,M)}if(s===0&&Fv(d[0])){let M=a.segments[n];r.push(new Eu(M.path,FP(d[0]))),s++;continue}let g=q_(t)?t.outlets[rn]:`${t}`,b=s<d.length-1?d[s+1]:null;g&&b&&Fv(b)?(r.push(new Eu(g,FP(b))),s+=2):(r.push(new Eu(g,{})),s++)}return new Nn(r,{})}function Rj(a){let n={};return Object.entries(a).forEach(([d,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(n[d]=QS(new Nn([],{}),0,r))}),n}function FP(a){let n={};return Object.entries(a).forEach(([d,r])=>n[d]=`${r}`),n}function LP(a,n,d){return a==d.path&&sl(n,d.parameters)}var W_="imperative",uo=function(a){return a[a.NavigationStart=0]="NavigationStart",a[a.NavigationEnd=1]="NavigationEnd",a[a.NavigationCancel=2]="NavigationCancel",a[a.NavigationError=3]="NavigationError",a[a.RoutesRecognized=4]="RoutesRecognized",a[a.ResolveStart=5]="ResolveStart",a[a.ResolveEnd=6]="ResolveEnd",a[a.GuardsCheckStart=7]="GuardsCheckStart",a[a.GuardsCheckEnd=8]="GuardsCheckEnd",a[a.RouteConfigLoadStart=9]="RouteConfigLoadStart",a[a.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",a[a.ChildActivationStart=11]="ChildActivationStart",a[a.ChildActivationEnd=12]="ChildActivationEnd",a[a.ActivationStart=13]="ActivationStart",a[a.ActivationEnd=14]="ActivationEnd",a[a.Scroll=15]="Scroll",a[a.NavigationSkipped=16]="NavigationSkipped",a}(uo||{}),is=class{constructor(n,d){this.id=n,this.url=d}},Vm=class extends is{constructor(n,d,r="imperative",s=null){super(n,d),this.type=uo.NavigationStart,this.navigationTrigger=r,this.restoredState=s}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Yo=class extends is{constructor(n,d,r){super(n,d),this.urlAfterRedirects=r,this.type=uo.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Ra=function(a){return a[a.Redirect=0]="Redirect",a[a.SupersededByNewNavigation=1]="SupersededByNewNavigation",a[a.NoDataFromResolver=2]="NoDataFromResolver",a[a.GuardRejected=3]="GuardRejected",a}(Ra||{}),zv=function(a){return a[a.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",a[a.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",a}(zv||{}),Wd=class extends is{constructor(n,d,r,s){super(n,d),this.reason=r,this.code=s,this.type=uo.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Gd=class extends is{constructor(n,d,r,s){super(n,d),this.reason=r,this.code=s,this.type=uo.NavigationSkipped}},Y_=class extends is{constructor(n,d,r,s){super(n,d),this.error=r,this.target=s,this.type=uo.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Bv=class extends is{constructor(n,d,r,s){super(n,d),this.urlAfterRedirects=r,this.state=s,this.type=uo.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},JS=class extends is{constructor(n,d,r,s){super(n,d),this.urlAfterRedirects=r,this.state=s,this.type=uo.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},e2=class extends is{constructor(n,d,r,s,t){super(n,d),this.urlAfterRedirects=r,this.state=s,this.shouldActivate=t,this.type=uo.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},t2=class extends is{constructor(n,d,r,s){super(n,d),this.urlAfterRedirects=r,this.state=s,this.type=uo.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},i2=class extends is{constructor(n,d,r,s){super(n,d),this.urlAfterRedirects=r,this.state=s,this.type=uo.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},n2=class{constructor(n){this.route=n,this.type=uo.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},r2=class{constructor(n){this.route=n,this.type=uo.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},o2=class{constructor(n){this.snapshot=n,this.type=uo.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},a2=class{constructor(n){this.snapshot=n,this.type=uo.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},s2=class{constructor(n){this.snapshot=n,this.type=uo.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},l2=class{constructor(n){this.snapshot=n,this.type=uo.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Nv=class{constructor(n,d,r){this.routerEvent=n,this.position=d,this.anchor=r,this.type=uo.Scroll}toString(){let n=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${n}')`}},Z_=class{},X_=class{constructor(n){this.url=n}};var c2=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new i0,this.attachRef=null}},i0=(()=>{let n=class n{constructor(){this.contexts=new Map}onChildOutletCreated(r,s){let t=this.getOrCreateContext(r);t.outlet=s,this.contexts.set(r,t)}onChildOutletDestroyed(r){let s=this.getContext(r);s&&(s.outlet=null,s.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let s=this.getContext(r);return s||(s=new c2,this.contexts.set(r,s)),s}getContext(r){return this.contexts.get(r)||null}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),Vv=class{constructor(n){this._root=n}get root(){return this._root.value}parent(n){let d=this.pathFromRoot(n);return d.length>1?d[d.length-2]:null}children(n){let d=d2(n,this._root);return d?d.children.map(r=>r.value):[]}firstChild(n){let d=d2(n,this._root);return d&&d.children.length>0?d.children[0].value:null}siblings(n){let d=h2(n,this._root);return d.length<2?[]:d[d.length-2].children.map(s=>s.value).filter(s=>s!==n)}pathFromRoot(n){return h2(n,this._root).map(d=>d.value)}};function d2(a,n){if(a===n.value)return n;for(let d of n.children){let r=d2(a,d);if(r)return r}return null}function h2(a,n){if(a===n.value)return[n];for(let d of n.children){let r=h2(a,d);if(r.length)return r.unshift(n),r}return[]}var Oa=class{constructor(n,d){this.value=n,this.children=d}toString(){return`TreeNode(${this.value})`}};function Fm(a){let n={};return a&&a.children.forEach(d=>n[d.value.outlet]=d),n}var jv=class extends Vv{constructor(n,d){super(n),this.snapshot=d,x2(this,n)}toString(){return this.snapshot.toString()}};function tO(a){let n=Fj(a),d=new aa([new Eu("",{})]),r=new aa({}),s=new aa({}),t=new aa({}),g=new aa(""),b=new ku(d,r,t,g,s,rn,a,n.root);return b.snapshot=n.root,new jv(new Oa(b,[]),n)}function Fj(a){let n={},d={},r={},s="",t=new K_([],n,r,s,d,rn,a,null,{});return new Uv("",new Oa(t,[]))}var ku=class{constructor(n,d,r,s,t,g,b,M){this.urlSubject=n,this.paramsSubject=d,this.queryParamsSubject=r,this.fragmentSubject=s,this.dataSubject=t,this.outlet=g,this.component=b,this._futureSnapshot=M,this.title=this.dataSubject?.pipe(pn(k=>k[e0]))??Jt(void 0),this.url=n,this.params=d,this.queryParams=r,this.fragment=s,this.data=t}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(pn(n=>Bm(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(pn(n=>Bm(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function v2(a,n,d="emptyOnly"){let r,{routeConfig:s}=a;return n!==null&&(d==="always"||s?.path===""||!n.component&&!n.routeConfig?.loadComponent)?r={params:kt(kt({},n.params),a.params),data:kt(kt({},n.data),a.data),resolve:kt(kt(kt(kt({},a.data),n.data),s?.data),a._resolvedData)}:r={params:kt({},a.params),data:kt({},a.data),resolve:kt(kt({},a.data),a._resolvedData??{})},s&&nO(s)&&(r.resolve[e0]=s.title),r}var K_=class{get title(){return this.data?.[e0]}constructor(n,d,r,s,t,g,b,M,k){this.url=n,this.params=d,this.queryParams=r,this.fragment=s,this.data=t,this.outlet=g,this.component=b,this.routeConfig=M,this._resolve=k}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Bm(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Bm(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(r=>r.toString()).join("/"),d=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${d}')`}},Uv=class extends Vv{constructor(n,d){super(d),this.url=n,x2(this,d)}toString(){return iO(this._root)}};function x2(a,n){n.value._routerState=a,n.children.forEach(d=>x2(a,d))}function iO(a){let n=a.children.length>0?` { ${a.children.map(iO).join(", ")} } `:"";return`${a.value}${n}`}function $S(a){if(a.snapshot){let n=a.snapshot,d=a._futureSnapshot;a.snapshot=d,sl(n.queryParams,d.queryParams)||a.queryParamsSubject.next(d.queryParams),n.fragment!==d.fragment&&a.fragmentSubject.next(d.fragment),sl(n.params,d.params)||a.paramsSubject.next(d.params),dj(n.url,d.url)||a.urlSubject.next(d.url),sl(n.data,d.data)||a.dataSubject.next(d.data)}else a.snapshot=a._futureSnapshot,a.dataSubject.next(a._futureSnapshot.data)}function u2(a,n){let d=sl(a.params,n.params)&&mj(a.url,n.url),r=!a.parent!=!n.parent;return d&&!r&&(!a.parent||u2(a.parent,n.parent))}function nO(a){return typeof a.title=="string"||a.title===null}var n0=(()=>{let n=class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=rn,this.activateEvents=new Ii,this.deactivateEvents=new Ii,this.attachEvents=new Ii,this.detachEvents=new Ii,this.parentContexts=Nt(i0),this.location=Nt(Od),this.changeDetector=Nt(_r),this.environmentInjector=Nt(Dd),this.inputBinder=Nt(qv,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:s,previousValue:t}=r.name;if(s)return;this.isTrackedInParentContexts(t)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(t)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new $n(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new $n(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new $n(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,s){this.activated=r,this._activatedRoute=s,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,s){if(this.isActivated)throw new $n(4013,!1);this._activatedRoute=r;let t=this.location,b=r.snapshot.component,M=this.parentContexts.getOrCreateContext(this.name).children,k=new p2(r,M,t.injector);this.activated=t.createComponent(b,{index:t.length,injector:k,environmentInjector:s??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};n.\u0275fac=function(s){return new(s||n)},n.\u0275dir=Ei({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[ar]});let a=n;return a})(),p2=class a{__ngOutletInjector(n){return new a(this.route,this.childContexts,n)}constructor(n,d,r){this.route=n,this.childContexts=d,this.parent=r}get(n,d){return n===ku?this.route:n===i0?this.childContexts:this.parent.get(n,d)}},qv=new Qt(""),zP=(()=>{let n=class n{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(r){this.unsubscribeFromRouteData(r),this.subscribeToRouteData(r)}unsubscribeFromRouteData(r){this.outletDataSubscriptions.get(r)?.unsubscribe(),this.outletDataSubscriptions.delete(r)}subscribeToRouteData(r){let{activatedRoute:s}=r,t=om([s.queryParams,s.params,s.data]).pipe(ur(([g,b,M],k)=>(M=kt(kt(kt({},g),b),M),k===0?Jt(M):Promise.resolve(M)))).subscribe(g=>{if(!r.isActivated||!r.activatedComponentRef||r.activatedRoute!==s||s.component===null){this.unsubscribeFromRouteData(r);return}let b=KD(s.component);if(!b){this.unsubscribeFromRouteData(r);return}for(let{templateName:M}of b.inputs)r.activatedComponentRef.setInput(M,g[M])});this.outletDataSubscriptions.set(r,t)}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})();function Lj(a,n,d){let r=Q_(a,n._root,d?d._root:void 0);return new jv(r,n)}function Q_(a,n,d){if(d&&a.shouldReuseRoute(n.value,d.value.snapshot)){let r=d.value;r._futureSnapshot=n.value;let s=zj(a,n,d);return new Oa(r,s)}else{if(a.shouldAttach(n.value)){let t=a.retrieve(n.value);if(t!==null){let g=t.route;return g.value._futureSnapshot=n.value,g.children=n.children.map(b=>Q_(a,b)),g}}let r=Bj(n.value),s=n.children.map(t=>Q_(a,t));return new Oa(r,s)}}function zj(a,n,d){return n.children.map(r=>{for(let s of d.children)if(a.shouldReuseRoute(r.value,s.value.snapshot))return Q_(a,r,s);return Q_(a,r)})}function Bj(a){return new ku(new aa(a.url),new aa(a.params),new aa(a.queryParams),new aa(a.fragment),new aa(a.data),a.outlet,a.component,a)}var rO="ngNavigationCancelingError";function oO(a,n){let{redirectTo:d,navigationBehaviorOptions:r}=Nm(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,s=aO(!1,Ra.Redirect);return s.url=d,s.navigationBehaviorOptions=r,s}function aO(a,n){let d=new Error(`NavigationCancelingError: ${a||""}`);return d[rO]=!0,d.cancellationCode=n,d}function Nj(a){return sO(a)&&Nm(a.url)}function sO(a){return!!a&&a[rO]}var Vj=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275cmp=gt({type:n,selectors:[["ng-component"]],standalone:!0,features:[Bn],decls:1,vars:0,template:function(s,t){s&1&&Ee(0,"router-outlet")},dependencies:[n0],encapsulation:2});let a=n;return a})();function jj(a,n){return a.providers&&!a._injector&&(a._injector=yC(a.providers,n,`Route: ${a.path}`)),a._injector??n}function w2(a){let n=a.children&&a.children.map(w2),d=n?Cn(kt({},a),{children:n}):kt({},a);return!d.component&&!d.loadComponent&&(n||d.loadChildren)&&d.outlet&&d.outlet!==rn&&(d.component=Vj),d}function ll(a){return a.outlet||rn}function Uj(a,n){let d=a.filter(r=>ll(r)===n);return d.push(...a.filter(r=>ll(r)!==n)),d}function r0(a){if(!a)return null;if(a.routeConfig?._injector)return a.routeConfig._injector;for(let n=a.parent;n;n=n.parent){let d=n.routeConfig;if(d?._loadedInjector)return d._loadedInjector;if(d?._injector)return d._injector}return null}var Hj=(a,n,d,r)=>pn(s=>(new m2(n,s.targetRouterState,s.currentRouterState,d,r).activate(a),s)),m2=class{constructor(n,d,r,s,t){this.routeReuseStrategy=n,this.futureState=d,this.currState=r,this.forwardEvent=s,this.inputBindingEnabled=t}activate(n){let d=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(d,r,n),$S(this.futureState.root),this.activateChildRoutes(d,r,n)}deactivateChildRoutes(n,d,r){let s=Fm(d);n.children.forEach(t=>{let g=t.value.outlet;this.deactivateRoutes(t,s[g],r),delete s[g]}),Object.values(s).forEach(t=>{this.deactivateRouteAndItsChildren(t,r)})}deactivateRoutes(n,d,r){let s=n.value,t=d?d.value:null;if(s===t)if(s.component){let g=r.getContext(s.outlet);g&&this.deactivateChildRoutes(n,d,g.children)}else this.deactivateChildRoutes(n,d,r);else t&&this.deactivateRouteAndItsChildren(d,r)}deactivateRouteAndItsChildren(n,d){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,d):this.deactivateRouteAndOutlet(n,d)}detachAndStoreRouteSubtree(n,d){let r=d.getContext(n.value.outlet),s=r&&n.value.component?r.children:d,t=Fm(n);for(let g of Object.values(t))this.deactivateRouteAndItsChildren(g,s);if(r&&r.outlet){let g=r.outlet.detach(),b=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:g,route:n,contexts:b})}}deactivateRouteAndOutlet(n,d){let r=d.getContext(n.value.outlet),s=r&&n.value.component?r.children:d,t=Fm(n);for(let g of Object.values(t))this.deactivateRouteAndItsChildren(g,s);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,d,r){let s=Fm(d);n.children.forEach(t=>{this.activateRoutes(t,s[t.value.outlet],r),this.forwardEvent(new l2(t.value.snapshot))}),n.children.length&&this.forwardEvent(new a2(n.value.snapshot))}activateRoutes(n,d,r){let s=n.value,t=d?d.value:null;if($S(s),s===t)if(s.component){let g=r.getOrCreateContext(s.outlet);this.activateChildRoutes(n,d,g.children)}else this.activateChildRoutes(n,d,r);else if(s.component){let g=r.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){let b=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),g.children.onOutletReAttached(b.contexts),g.attachRef=b.componentRef,g.route=b.route.value,g.outlet&&g.outlet.attach(b.componentRef,b.route.value),$S(b.route.value),this.activateChildRoutes(n,null,g.children)}else{let b=r0(s.snapshot);g.attachRef=null,g.route=s,g.injector=b,g.outlet&&g.outlet.activateWith(s,g.injector),this.activateChildRoutes(n,null,g.children)}}else this.activateChildRoutes(n,null,r)}},Hv=class{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},zm=class{constructor(n,d){this.component=n,this.route=d}};function Wj(a,n,d){let r=a._root,s=n?n._root:null;return j_(r,s,d,[r.value])}function Gj(a){let n=a.routeConfig?a.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:a,guards:n}}function Hm(a,n){let d=Symbol(),r=n.get(a,d);return r===d?typeof a=="function"&&!zD(a)?a:n.get(a):r}function j_(a,n,d,r,s={canDeactivateChecks:[],canActivateChecks:[]}){let t=Fm(n);return a.children.forEach(g=>{$j(g,t[g.value.outlet],d,r.concat([g.value]),s),delete t[g.value.outlet]}),Object.entries(t).forEach(([g,b])=>G_(b,d.getContext(g),s)),s}function $j(a,n,d,r,s={canDeactivateChecks:[],canActivateChecks:[]}){let t=a.value,g=n?n.value:null,b=d?d.getContext(a.value.outlet):null;if(g&&t.routeConfig===g.routeConfig){let M=qj(g,t,t.routeConfig.runGuardsAndResolvers);M?s.canActivateChecks.push(new Hv(r)):(t.data=g.data,t._resolvedData=g._resolvedData),t.component?j_(a,n,b?b.children:null,r,s):j_(a,n,d,r,s),M&&b&&b.outlet&&b.outlet.isActivated&&s.canDeactivateChecks.push(new zm(b.outlet.component,g))}else g&&G_(n,b,s),s.canActivateChecks.push(new Hv(r)),t.component?j_(a,null,b?b.children:null,r,s):j_(a,null,d,r,s);return s}function qj(a,n,d){if(typeof d=="function")return d(a,n);switch(d){case"pathParamsChange":return!Du(a.url,n.url);case"pathParamsOrQueryParamsChange":return!Du(a.url,n.url)||!sl(a.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!u2(a,n)||!sl(a.queryParams,n.queryParams);case"paramsChange":default:return!u2(a,n)}}function G_(a,n,d){let r=Fm(a),s=a.value;Object.entries(r).forEach(([t,g])=>{s.component?n?G_(g,n.children.getContext(t),d):G_(g,null,d):G_(g,n,d)}),s.component?n&&n.outlet&&n.outlet.isActivated?d.canDeactivateChecks.push(new zm(n.outlet.component,s)):d.canDeactivateChecks.push(new zm(null,s)):d.canDeactivateChecks.push(new zm(null,s))}function o0(a){return typeof a=="function"}function Yj(a){return typeof a=="boolean"}function Zj(a){return a&&o0(a.canLoad)}function Xj(a){return a&&o0(a.canActivate)}function Kj(a){return a&&o0(a.canActivateChild)}function Qj(a){return a&&o0(a.canDeactivate)}function Jj(a){return a&&o0(a.canMatch)}function lO(a){return a instanceof AD||a?.name==="EmptyError"}var Av=Symbol("INITIAL_VALUE");function jm(){return ur(a=>om(a.map(n=>n.pipe(ao(1),ka(Av)))).pipe(pn(n=>{for(let d of n)if(d!==!0){if(d===Av)return Av;if(d===!1||d instanceof Hd)return d}return!0}),wr(n=>n!==Av),ao(1)))}function e6(a,n){return Go(d=>{let{targetSnapshot:r,currentSnapshot:s,guards:{canActivateChecks:t,canDeactivateChecks:g}}=d;return g.length===0&&t.length===0?Jt(Cn(kt({},d),{guardsResult:!0})):t6(g,r,s,a).pipe(Go(b=>b&&Yj(b)?i6(r,t,a,n):Jt(b)),pn(b=>Cn(kt({},d),{guardsResult:b})))})}function t6(a,n,d,r){return oo(a).pipe(Go(s=>s6(s.component,s.route,d,n,r)),Id(s=>s!==!0,!0))}function i6(a,n,d,r){return oo(n).pipe(Td(s=>am(r6(s.route.parent,r),n6(s.route,r),a6(a,s.path,d),o6(a,s.route,d))),Id(s=>s!==!0,!0))}function n6(a,n){return a!==null&&n&&n(new s2(a)),Jt(!0)}function r6(a,n){return a!==null&&n&&n(new o2(a)),Jt(!0)}function o6(a,n,d){let r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||r.length===0)return Jt(!0);let s=r.map(t=>hu(()=>{let g=r0(n)??d,b=Hm(t,g),M=Xj(b)?b.canActivate(n,a):il(g,()=>b(n,a));return $d(M).pipe(Id())}));return Jt(s).pipe(jm())}function a6(a,n,d){let r=n[n.length-1],t=n.slice(0,n.length-1).reverse().map(g=>Gj(g)).filter(g=>g!==null).map(g=>hu(()=>{let b=g.guards.map(M=>{let k=r0(g.node)??d,L=Hm(M,k),G=Kj(L)?L.canActivateChild(r,a):il(k,()=>L(r,a));return $d(G).pipe(Id())});return Jt(b).pipe(jm())}));return Jt(t).pipe(jm())}function s6(a,n,d,r,s){let t=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!t||t.length===0)return Jt(!0);let g=t.map(b=>{let M=r0(n)??s,k=Hm(b,M),L=Qj(k)?k.canDeactivate(a,n,d,r):il(M,()=>k(a,n,d,r));return $d(L).pipe(Id())});return Jt(g).pipe(jm())}function l6(a,n,d,r){let s=n.canLoad;if(s===void 0||s.length===0)return Jt(!0);let t=s.map(g=>{let b=Hm(g,a),M=Zj(b)?b.canLoad(n,d):il(a,()=>b(n,d));return $d(M)});return Jt(t).pipe(jm(),cO(r))}function cO(a){return ED(so(n=>{if(Nm(n))throw oO(a,n)}),pn(n=>n===!0))}function c6(a,n,d,r){let s=n.canMatch;if(!s||s.length===0)return Jt(!0);let t=s.map(g=>{let b=Hm(g,a),M=Jj(b)?b.canMatch(n,d):il(a,()=>b(n,d));return $d(M)});return Jt(t).pipe(jm(),cO(r))}var J_=class{constructor(n){this.segmentGroup=n||null}},Wv=class extends Error{constructor(n){super(),this.urlTree=n}};function Rm(a){return t_(new J_(a))}function d6(a){return t_(new $n(4e3,!1))}function h6(a){return t_(aO(!1,Ra.GuardRejected))}var f2=class{constructor(n,d){this.urlSerializer=n,this.urlTree=d}lineralizeSegments(n,d){let r=[],s=d.root;for(;;){if(r=r.concat(s.segments),s.numberOfChildren===0)return Jt(r);if(s.numberOfChildren>1||!s.children[rn])return d6(n.redirectTo);s=s.children[rn]}}applyRedirectCommands(n,d,r){let s=this.applyRedirectCreateUrlTree(d,this.urlSerializer.parse(d),n,r);if(d.startsWith("/"))throw new Wv(s);return s}applyRedirectCreateUrlTree(n,d,r,s){let t=this.createSegmentGroup(n,d.root,r,s);return new Hd(t,this.createQueryParams(d.queryParams,this.urlTree.queryParams),d.fragment)}createQueryParams(n,d){let r={};return Object.entries(n).forEach(([s,t])=>{if(typeof t=="string"&&t.startsWith(":")){let b=t.substring(1);r[s]=d[b]}else r[s]=t}),r}createSegmentGroup(n,d,r,s){let t=this.createSegments(n,d.segments,r,s),g={};return Object.entries(d.children).forEach(([b,M])=>{g[b]=this.createSegmentGroup(n,M,r,s)}),new Nn(t,g)}createSegments(n,d,r,s){return d.map(t=>t.path.startsWith(":")?this.findPosParam(n,t,s):this.findOrReturn(t,r))}findPosParam(n,d,r){let s=r[d.path.substring(1)];if(!s)throw new $n(4001,!1);return s}findOrReturn(n,d){let r=0;for(let s of d){if(s.path===n.path)return d.splice(r),s;r++}return n}},g2={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function u6(a,n,d,r,s){let t=C2(a,n,d);return t.matched?(r=jj(n,r),c6(r,n,d,s).pipe(pn(g=>g===!0?t:kt({},g2)))):Jt(t)}function C2(a,n,d){if(n.path==="**")return p6(d);if(n.path==="")return n.pathMatch==="full"&&(a.hasChildren()||d.length>0)?kt({},g2):{matched:!0,consumedSegments:[],remainingSegments:d,parameters:{},positionalParamSegments:{}};let s=(n.matcher||cj)(d,a,n);if(!s)return kt({},g2);let t={};Object.entries(s.posParams??{}).forEach(([b,M])=>{t[b]=M.path});let g=s.consumed.length>0?kt(kt({},t),s.consumed[s.consumed.length-1].parameters):t;return{matched:!0,consumedSegments:s.consumed,remainingSegments:d.slice(s.consumed.length),parameters:g,positionalParamSegments:s.posParams??{}}}function p6(a){return{matched:!0,parameters:a.length>0?UP(a).parameters:{},consumedSegments:a,remainingSegments:[],positionalParamSegments:{}}}function BP(a,n,d,r){return d.length>0&&g6(a,d,r)?{segmentGroup:new Nn(n,f6(r,new Nn(d,a.children))),slicedSegments:[]}:d.length===0&&_6(a,d,r)?{segmentGroup:new Nn(a.segments,m6(a,d,r,a.children)),slicedSegments:d}:{segmentGroup:new Nn(a.segments,a.children),slicedSegments:d}}function m6(a,n,d,r){let s={};for(let t of d)if(Yv(a,n,t)&&!r[ll(t)]){let g=new Nn([],{});s[ll(t)]=g}return kt(kt({},r),s)}function f6(a,n){let d={};d[rn]=n;for(let r of a)if(r.path===""&&ll(r)!==rn){let s=new Nn([],{});d[ll(r)]=s}return d}function g6(a,n,d){return d.some(r=>Yv(a,n,r)&&ll(r)!==rn)}function _6(a,n,d){return d.some(r=>Yv(a,n,r))}function Yv(a,n,d){return(a.hasChildren()||n.length>0)&&d.pathMatch==="full"?!1:d.path===""}function y6(a,n,d,r){return ll(a)!==r&&(r===rn||!Yv(n,d,a))?!1:C2(n,a,d).matched}function b6(a,n,d){return n.length===0&&!a.children[d]}var _2=class{};function v6(a,n,d,r,s,t,g="emptyOnly"){return new y2(a,n,d,r,s,g,t).recognize()}var x6=31,y2=class{constructor(n,d,r,s,t,g,b){this.injector=n,this.configLoader=d,this.rootComponentType=r,this.config=s,this.urlTree=t,this.paramsInheritanceStrategy=g,this.urlSerializer=b,this.applyRedirects=new f2(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(n){return new $n(4002,`'${n.segmentGroup}'`)}recognize(){let n=BP(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(pn(d=>{let r=new K_([],Object.freeze({}),Object.freeze(kt({},this.urlTree.queryParams)),this.urlTree.fragment,{},rn,this.rootComponentType,null,{}),s=new Oa(r,d),t=new Uv("",s),g=Ej(r,[],this.urlTree.queryParams,this.urlTree.fragment);return g.queryParams=this.urlTree.queryParams,t.url=this.urlSerializer.serialize(g),this.inheritParamsAndData(t._root,null),{state:t,tree:g}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n,rn).pipe(Md(r=>{if(r instanceof Wv)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof J_?this.noMatchError(r):r}))}inheritParamsAndData(n,d){let r=n.value,s=v2(r,d,this.paramsInheritanceStrategy);r.params=Object.freeze(s.params),r.data=Object.freeze(s.data),n.children.forEach(t=>this.inheritParamsAndData(t,r))}processSegmentGroup(n,d,r,s){return r.segments.length===0&&r.hasChildren()?this.processChildren(n,d,r):this.processSegment(n,d,r,r.segments,s,!0).pipe(pn(t=>t instanceof Oa?[t]:[]))}processChildren(n,d,r){let s=[];for(let t of Object.keys(r.children))t==="primary"?s.unshift(t):s.push(t);return oo(s).pipe(Td(t=>{let g=r.children[t],b=Uj(d,t);return this.processSegmentGroup(n,b,g,t)}),LD((t,g)=>(t.push(...g),t)),n_(null),FD(),Go(t=>{if(t===null)return Rm(r);let g=dO(t);return w6(g),Jt(g)}))}processSegment(n,d,r,s,t,g){return oo(d).pipe(Td(b=>this.processSegmentAgainstRoute(b._injector??n,d,b,r,s,t,g).pipe(Md(M=>{if(M instanceof J_)return Jt(null);throw M}))),Id(b=>!!b),Md(b=>{if(lO(b))return b6(r,s,t)?Jt(new _2):Rm(r);throw b}))}processSegmentAgainstRoute(n,d,r,s,t,g,b){return y6(r,s,t,g)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(n,s,r,t,g):this.allowRedirects&&b?this.expandSegmentAgainstRouteUsingRedirect(n,s,d,r,t,g):Rm(s):Rm(s)}expandSegmentAgainstRouteUsingRedirect(n,d,r,s,t,g){let{matched:b,consumedSegments:M,positionalParamSegments:k,remainingSegments:L}=C2(d,s,t);if(!b)return Rm(d);s.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>x6&&(this.allowRedirects=!1));let G=this.applyRedirects.applyRedirectCommands(M,s.redirectTo,k);return this.applyRedirects.lineralizeSegments(s,G).pipe(Go(J=>this.processSegment(n,r,d,J.concat(L),g,!1)))}matchSegmentAgainstRoute(n,d,r,s,t){let g=u6(d,r,s,n,this.urlSerializer);return r.path==="**"&&(d.children={}),g.pipe(ur(b=>b.matched?(n=r._injector??n,this.getChildConfig(n,r,s).pipe(ur(({routes:M})=>{let k=r._loadedInjector??n,{consumedSegments:L,remainingSegments:G,parameters:J}=b,oe=new K_(L,J,Object.freeze(kt({},this.urlTree.queryParams)),this.urlTree.fragment,S6(r),ll(r),r.component??r._loadedComponent??null,r,M6(r)),{segmentGroup:be,slicedSegments:Me}=BP(d,L,G,M);if(Me.length===0&&be.hasChildren())return this.processChildren(k,M,be).pipe(pn(He=>He===null?null:new Oa(oe,He)));if(M.length===0&&Me.length===0)return Jt(new Oa(oe,[]));let Te=ll(r)===t;return this.processSegment(k,M,be,Me,Te?rn:t,!0).pipe(pn(He=>new Oa(oe,He instanceof Oa?[He]:[])))}))):Rm(d)))}getChildConfig(n,d,r){return d.children?Jt({routes:d.children,injector:n}):d.loadChildren?d._loadedRoutes!==void 0?Jt({routes:d._loadedRoutes,injector:d._loadedInjector}):l6(n,d,r,this.urlSerializer).pipe(Go(s=>s?this.configLoader.loadChildren(n,d).pipe(so(t=>{d._loadedRoutes=t.routes,d._loadedInjector=t.injector})):h6(d))):Jt({routes:[],injector:n})}};function w6(a){a.sort((n,d)=>n.value.outlet===rn?-1:d.value.outlet===rn?1:n.value.outlet.localeCompare(d.value.outlet))}function C6(a){let n=a.value.routeConfig;return n&&n.path===""}function dO(a){let n=[],d=new Set;for(let r of a){if(!C6(r)){n.push(r);continue}let s=n.find(t=>r.value.routeConfig===t.value.routeConfig);s!==void 0?(s.children.push(...r.children),d.add(s)):n.push(r)}for(let r of d){let s=dO(r.children);n.push(new Oa(r.value,s))}return n.filter(r=>!d.has(r))}function S6(a){return a.data||{}}function M6(a){return a.resolve||{}}function T6(a,n,d,r,s,t){return Go(g=>v6(a,n,d,r,g.extractedUrl,s,t).pipe(pn(({state:b,tree:M})=>Cn(kt({},g),{targetSnapshot:b,urlAfterRedirects:M}))))}function I6(a,n){return Go(d=>{let{targetSnapshot:r,guards:{canActivateChecks:s}}=d;if(!s.length)return Jt(d);let t=new Set(s.map(M=>M.route)),g=new Set;for(let M of t)if(!g.has(M))for(let k of hO(M))g.add(k);let b=0;return oo(g).pipe(Td(M=>t.has(M)?E6(M,r,a,n):(M.data=v2(M,M.parent,a).resolve,Jt(void 0))),so(()=>b++),dC(1),Go(M=>b===g.size?Jt(d):tl))})}function hO(a){let n=a.children.map(d=>hO(d)).flat();return[a,...n]}function E6(a,n,d,r){let s=a.routeConfig,t=a._resolve;return s?.title!==void 0&&!nO(s)&&(t[e0]=s.title),D6(t,a,n,r).pipe(pn(g=>(a._resolvedData=g,a.data=v2(a,a.parent,d).resolve,null)))}function D6(a,n,d,r){let s=ZS(a);if(s.length===0)return Jt({});let t={};return oo(s).pipe(Go(g=>k6(a[g],n,d,r).pipe(Id(),so(b=>{t[g]=b}))),dC(1),RD(t),Md(g=>lO(g)?tl:t_(g)))}function k6(a,n,d,r){let s=r0(n)??r,t=Hm(a,s),g=t.resolve?t.resolve(n,d):il(s,()=>t(n,d));return $d(g)}function qS(a){return ur(n=>{let d=a(n);return d?oo(d).pipe(pn(()=>n)):Jt(n)})}var uO=(()=>{let n=class n{buildTitle(r){let s,t=r.root;for(;t!==void 0;)s=this.getResolvedTitleForRoute(t)??s,t=t.children.find(g=>g.outlet===rn);return s}getResolvedTitleForRoute(r){return r.data[e0]}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:()=>Nt(A6),providedIn:"root"});let a=n;return a})(),A6=(()=>{let n=class n extends uO{constructor(r){super(),this.title=r}updateTitle(r){let s=this.buildTitle(r);s!==void 0&&this.title.setTitle(s)}};n.\u0275fac=function(s){return new(s||n)(Ye(Pk))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),a0=new Qt("",{providedIn:"root",factory:()=>({})}),Gv=new Qt(""),S2=(()=>{let n=class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Nt(jb)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return Jt(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let s=$d(r.loadComponent()).pipe(pn(pO),so(g=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=g}),pu(()=>{this.componentLoaders.delete(r)})),t=new oC(s,()=>new dn).pipe(rC());return this.componentLoaders.set(r,t),t}loadChildren(r,s){if(this.childrenLoaders.get(s))return this.childrenLoaders.get(s);if(s._loadedRoutes)return Jt({routes:s._loadedRoutes,injector:s._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(s);let g=P6(s,this.compiler,r,this.onLoadEndListener).pipe(pu(()=>{this.childrenLoaders.delete(s)})),b=new oC(g,()=>new dn).pipe(rC());return this.childrenLoaders.set(s,b),b}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();function P6(a,n,d,r){return $d(a.loadChildren()).pipe(pn(pO),Go(s=>s instanceof UD||Array.isArray(s)?Jt(s):oo(n.compileModuleAsync(s))),pn(s=>{r&&r(a);let t,g,b=!1;return Array.isArray(s)?(g=s,b=!0):(t=s.create(d).injector,g=t.get(Gv,[],{optional:!0,self:!0}).flat()),{routes:g.map(w2),injector:t}}))}function O6(a){return a&&typeof a=="object"&&"default"in a}function pO(a){return O6(a)?a.default:a}var M2=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:()=>Nt(R6),providedIn:"root"});let a=n;return a})(),R6=(()=>{let n=class n{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,s){return r}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),mO=new Qt(""),fO=new Qt("");function F6(a,n,d){let r=a.get(fO),s=a.get(Ai);return a.get(di).runOutsideAngular(()=>{if(!s.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,new Promise(k=>setTimeout(k));let t,g=new Promise(k=>{t=k}),b=s.startViewTransition(()=>(t(),L6(a))),{onViewTransitionCreated:M}=r;return M&&il(a,()=>M({transition:b,from:n,to:d})),g})}function L6(a){return new Promise(n=>{_C(n,{injector:a})})}var T2=(()=>{let n=class n{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new dn,this.transitionAbortSubject=new dn,this.configLoader=Nt(S2),this.environmentInjector=Nt(Dd),this.urlSerializer=Nt(t0),this.rootContexts=Nt(i0),this.location=Nt(Pi),this.inputBindingEnabled=Nt(qv,{optional:!0})!==null,this.titleStrategy=Nt(uO),this.options=Nt(a0,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Nt(M2),this.createViewTransition=Nt(mO,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Jt(void 0),this.rootComponentType=null;let r=t=>this.events.next(new n2(t)),s=t=>this.events.next(new r2(t));this.configLoader.onLoadEndListener=s,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let s=++this.navigationId;this.transitions?.next(Cn(kt(kt({},this.transitions.value),r),{id:s}))}setupNavigations(r,s,t){return this.transitions=new aa({id:0,currentUrlTree:s,currentRawUrl:s,extractedUrl:this.urlHandlingStrategy.extract(s),urlAfterRedirects:this.urlHandlingStrategy.extract(s),rawUrl:s,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:W_,restoredState:null,currentSnapshot:t.snapshot,targetSnapshot:null,currentRouterState:t,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(wr(g=>g.id!==0),pn(g=>Cn(kt({},g),{extractedUrl:this.urlHandlingStrategy.extract(g.rawUrl)})),ur(g=>{let b=!1,M=!1;return Jt(g).pipe(ur(k=>{if(this.navigationId>g.id)return this.cancelNavigationTransition(g,"",Ra.SupersededByNewNavigation),tl;this.currentTransition=g,this.currentNavigation={id:k.id,initialUrl:k.rawUrl,extractedUrl:k.extractedUrl,trigger:k.source,extras:k.extras,previousNavigation:this.lastSuccessfulNavigation?Cn(kt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let L=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),G=k.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!L&&G!=="reload"){let J="";return this.events.next(new Gd(k.id,this.urlSerializer.serialize(k.rawUrl),J,zv.IgnoredSameUrlNavigation)),k.resolve(null),tl}if(this.urlHandlingStrategy.shouldProcessUrl(k.rawUrl))return Jt(k).pipe(ur(J=>{let oe=this.transitions?.getValue();return this.events.next(new Vm(J.id,this.urlSerializer.serialize(J.extractedUrl),J.source,J.restoredState)),oe!==this.transitions?.getValue()?tl:Promise.resolve(J)}),T6(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),so(J=>{g.targetSnapshot=J.targetSnapshot,g.urlAfterRedirects=J.urlAfterRedirects,this.currentNavigation=Cn(kt({},this.currentNavigation),{finalUrl:J.urlAfterRedirects});let oe=new Bv(J.id,this.urlSerializer.serialize(J.extractedUrl),this.urlSerializer.serialize(J.urlAfterRedirects),J.targetSnapshot);this.events.next(oe)}));if(L&&this.urlHandlingStrategy.shouldProcessUrl(k.currentRawUrl)){let{id:J,extractedUrl:oe,source:be,restoredState:Me,extras:Te}=k,He=new Vm(J,this.urlSerializer.serialize(oe),be,Me);this.events.next(He);let We=tO(this.rootComponentType).snapshot;return this.currentTransition=g=Cn(kt({},k),{targetSnapshot:We,urlAfterRedirects:oe,extras:Cn(kt({},Te),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=oe,Jt(g)}else{let J="";return this.events.next(new Gd(k.id,this.urlSerializer.serialize(k.extractedUrl),J,zv.IgnoredByUrlHandlingStrategy)),k.resolve(null),tl}}),so(k=>{let L=new JS(k.id,this.urlSerializer.serialize(k.extractedUrl),this.urlSerializer.serialize(k.urlAfterRedirects),k.targetSnapshot);this.events.next(L)}),pn(k=>(this.currentTransition=g=Cn(kt({},k),{guards:Wj(k.targetSnapshot,k.currentSnapshot,this.rootContexts)}),g)),e6(this.environmentInjector,k=>this.events.next(k)),so(k=>{if(g.guardsResult=k.guardsResult,Nm(k.guardsResult))throw oO(this.urlSerializer,k.guardsResult);let L=new e2(k.id,this.urlSerializer.serialize(k.extractedUrl),this.urlSerializer.serialize(k.urlAfterRedirects),k.targetSnapshot,!!k.guardsResult);this.events.next(L)}),wr(k=>k.guardsResult?!0:(this.cancelNavigationTransition(k,"",Ra.GuardRejected),!1)),qS(k=>{if(k.guards.canActivateChecks.length)return Jt(k).pipe(so(L=>{let G=new t2(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot);this.events.next(G)}),ur(L=>{let G=!1;return Jt(L).pipe(I6(this.paramsInheritanceStrategy,this.environmentInjector),so({next:()=>G=!0,complete:()=>{G||this.cancelNavigationTransition(L,"",Ra.NoDataFromResolver)}}))}),so(L=>{let G=new i2(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot);this.events.next(G)}))}),qS(k=>{let L=G=>{let J=[];G.routeConfig?.loadComponent&&!G.routeConfig._loadedComponent&&J.push(this.configLoader.loadComponent(G.routeConfig).pipe(so(oe=>{G.component=oe}),pn(()=>{})));for(let oe of G.children)J.push(...L(oe));return J};return om(L(k.targetSnapshot.root)).pipe(n_(null),ao(1))}),qS(()=>this.afterPreactivation()),ur(()=>{let{currentSnapshot:k,targetSnapshot:L}=g,G=this.createViewTransition?.(this.environmentInjector,k.root,L.root);return G?oo(G).pipe(pn(()=>g)):Jt(g)}),pn(k=>{let L=Lj(r.routeReuseStrategy,k.targetSnapshot,k.currentRouterState);return this.currentTransition=g=Cn(kt({},k),{targetRouterState:L}),this.currentNavigation.targetRouterState=L,g}),so(()=>{this.events.next(new Z_)}),Hj(this.rootContexts,r.routeReuseStrategy,k=>this.events.next(k),this.inputBindingEnabled),ao(1),so({next:k=>{b=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Yo(k.id,this.urlSerializer.serialize(k.extractedUrl),this.urlSerializer.serialize(k.urlAfterRedirects))),this.titleStrategy?.updateTitle(k.targetRouterState.snapshot),k.resolve(!0)},complete:()=>{b=!0}}),Kl(this.transitionAbortSubject.pipe(so(k=>{throw k}))),pu(()=>{!b&&!M&&this.cancelNavigationTransition(g,"",Ra.SupersededByNewNavigation),this.currentTransition?.id===g.id&&(this.currentNavigation=null,this.currentTransition=null)}),Md(k=>{if(M=!0,sO(k))this.events.next(new Wd(g.id,this.urlSerializer.serialize(g.extractedUrl),k.message,k.cancellationCode)),Nj(k)?this.events.next(new X_(k.url)):g.resolve(!1);else{this.events.next(new Y_(g.id,this.urlSerializer.serialize(g.extractedUrl),k,g.targetSnapshot??void 0));try{g.resolve(r.errorHandler(k))}catch(L){this.options.resolveNavigationPromiseOnError?g.resolve(!1):g.reject(L)}}return tl}))}))}cancelNavigationTransition(r,s,t){let g=new Wd(r.id,this.urlSerializer.serialize(r.extractedUrl),s,t);this.events.next(g),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();function z6(a){return a!==W_}var B6=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:()=>Nt(N6),providedIn:"root"});let a=n;return a})(),b2=class{shouldDetach(n){return!1}store(n,d){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,d){return n.routeConfig===d.routeConfig}},N6=(()=>{let n=class n extends b2{};n.\u0275fac=(()=>{let r;return function(t){return(r||(r=vo(n)))(t||n)}})(),n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),gO=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:()=>Nt(V6),providedIn:"root"});let a=n;return a})(),V6=(()=>{let n=class n extends gO{constructor(){super(...arguments),this.location=Nt(Pi),this.urlSerializer=Nt(t0),this.options=Nt(a0,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Nt(M2),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Hd,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=tO(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(s=>{s.type==="popstate"&&r(s.url,s.state)})}handleRouterEvent(r,s){if(r instanceof Vm)this.stateMemento=this.createStateMemento();else if(r instanceof Gd)this.rawUrlTree=s.initialUrl;else if(r instanceof Bv){if(this.urlUpdateStrategy==="eager"&&!s.extras.skipLocationChange){let t=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl);this.setBrowserUrl(t,s)}}else r instanceof Z_?(this.currentUrlTree=s.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl),this.routerState=s.targetRouterState,this.urlUpdateStrategy==="deferred"&&(s.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,s))):r instanceof Wd&&(r.code===Ra.GuardRejected||r.code===Ra.NoDataFromResolver)?this.restoreHistory(s):r instanceof Y_?this.restoreHistory(s,!0):r instanceof Yo&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,s){let t=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(t)||s.extras.replaceUrl){let g=this.browserPageId,b=kt(kt({},s.extras.state),this.generateNgRouterState(s.id,g));this.location.replaceState(t,"",b)}else{let g=kt(kt({},s.extras.state),this.generateNgRouterState(s.id,this.browserPageId+1));this.location.go(t,"",g)}}restoreHistory(r,s=!1){if(this.canceledNavigationResolution==="computed"){let t=this.browserPageId,g=this.currentPageId-t;g!==0?this.location.historyGo(g):this.currentUrlTree===r.finalUrl&&g===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(s&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,s){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:s}:{navigationId:r}}};n.\u0275fac=(()=>{let r;return function(t){return(r||(r=vo(n)))(t||n)}})(),n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),U_=function(a){return a[a.COMPLETE=0]="COMPLETE",a[a.FAILED=1]="FAILED",a[a.REDIRECTING=2]="REDIRECTING",a}(U_||{});function _O(a,n){a.events.pipe(wr(d=>d instanceof Yo||d instanceof Wd||d instanceof Y_||d instanceof Gd),pn(d=>d instanceof Yo||d instanceof Gd?U_.COMPLETE:(d instanceof Wd?d.code===Ra.Redirect||d.code===Ra.SupersededByNewNavigation:!1)?U_.REDIRECTING:U_.FAILED),wr(d=>d!==U_.REDIRECTING),ao(1)).subscribe(()=>{n()})}function j6(a){throw a}var U6={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},H6={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},jt=(()=>{let n=class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Nt(zb),this.stateManager=Nt(gO),this.options=Nt(a0,{optional:!0})||{},this.pendingTasks=Nt(c_),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Nt(T2),this.urlSerializer=Nt(t0),this.location=Nt(Pi),this.urlHandlingStrategy=Nt(M2),this._events=new dn,this.errorHandler=this.options.errorHandler||j6,this.navigated=!1,this.routeReuseStrategy=Nt(B6),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Nt(Gv,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Nt(qv,{optional:!0}),this.eventsSubscription=new Da,this.isNgZoneEnabled=Nt(di)instanceof di&&di.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(s=>{try{let t=this.navigationTransitions.currentTransition,g=this.navigationTransitions.currentNavigation;if(t!==null&&g!==null){if(this.stateManager.handleRouterEvent(s,g),s instanceof Wd&&s.code!==Ra.Redirect&&s.code!==Ra.SupersededByNewNavigation)this.navigated=!0;else if(s instanceof Yo)this.navigated=!0;else if(s instanceof X_){let b=this.urlHandlingStrategy.merge(s.url,t.currentRawUrl),M={info:t.extras.info,skipLocationChange:t.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||z6(t.source)};this.scheduleNavigation(b,W_,null,M,{resolve:t.resolve,reject:t.reject,promise:t.promise})}}G6(s)&&this._events.next(s)}catch(t){this.navigationTransitions.transitionAbortSubject.next(t)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),W_,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,s)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",s)},0)})}navigateToSyncWithBrowser(r,s,t){let g={replaceUrl:!0},b=t?.navigationId?t:null;if(t){let k=kt({},t);delete k.navigationId,delete k.\u0275routerPageId,Object.keys(k).length!==0&&(g.state=k)}let M=this.parseUrl(r);this.scheduleNavigation(M,s,b,g)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(w2),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,s={}){let{relativeTo:t,queryParams:g,fragment:b,queryParamsHandling:M,preserveFragment:k}=s,L=k?this.currentUrlTree.fragment:b,G=null;switch(M){case"merge":G=kt(kt({},this.currentUrlTree.queryParams),g);break;case"preserve":G=this.currentUrlTree.queryParams;break;default:G=g||null}G!==null&&(G=this.removeEmptyProps(G));let J;try{let oe=t?t.snapshot:this.routerState.snapshot.root;J=KP(oe)}catch{(typeof r[0]!="string"||!r[0].startsWith("/"))&&(r=[]),J=this.currentUrlTree.root}return QP(J,r,G,L??null)}navigateByUrl(r,s={skipLocationChange:!1}){let t=Nm(r)?r:this.parseUrl(r),g=this.urlHandlingStrategy.merge(t,this.rawUrlTree);return this.scheduleNavigation(g,W_,null,s)}navigate(r,s={skipLocationChange:!1}){return W6(r),this.navigateByUrl(this.createUrlTree(r,s),s)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,s){let t;if(s===!0?t=kt({},U6):s===!1?t=kt({},H6):t=s,Nm(r))return OP(this.currentUrlTree,r,t);let g=this.parseUrl(r);return OP(this.currentUrlTree,g,t)}removeEmptyProps(r){return Object.entries(r).reduce((s,[t,g])=>(g!=null&&(s[t]=g),s),{})}scheduleNavigation(r,s,t,g,b){if(this.disposed)return Promise.resolve(!1);let M,k,L;b?(M=b.resolve,k=b.reject,L=b.promise):L=new Promise((J,oe)=>{M=J,k=oe});let G=this.pendingTasks.add();return _O(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(G))}),this.navigationTransitions.handleNavigationRequest({source:s,restoredState:t,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:g,resolve:M,reject:k,promise:L,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),L.catch(J=>Promise.reject(J))}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();function W6(a){for(let n=0;n<a.length;n++)if(a[n]==null)throw new $n(4008,!1)}function G6(a){return!(a instanceof Z_)&&!(a instanceof X_)}var Um=(()=>{let n=class n{constructor(r,s,t,g,b,M){this.router=r,this.route=s,this.tabIndexAttribute=t,this.renderer=g,this.el=b,this.locationStrategy=M,this.href=null,this.commands=null,this.onChanges=new dn,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let k=b.nativeElement.tagName?.toLowerCase();this.isAnchorElement=k==="a"||k==="area",this.isAnchorElement?this.subscription=r.events.subscribe(L=>{L instanceof Yo&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(r){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",r)}ngOnChanges(r){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(r){r!=null?(this.commands=Array.isArray(r)?r:[r],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(r,s,t,g,b){let M=this.urlTree;if(M===null||this.isAnchorElement&&(r!==0||s||t||g||b||typeof this.target=="string"&&this.target!="_self"))return!0;let k={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(M,k),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let r=this.urlTree;this.href=r!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(r)):null;let s=this.href===null?null:jD(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",s)}applyAttributeValue(r,s){let t=this.renderer,g=this.el.nativeElement;s!==null?t.setAttribute(g,r,s):t.removeAttribute(g,r)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};n.\u0275fac=function(s){return new(s||n)(ge(jt),ge(ku),Ad("tabindex"),ge(nl),ge(Zi),ge(h_))},n.\u0275dir=Ei({type:n,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(s,t){s&1&&Fe("click",function(b){return t.onClick(b.button,b.ctrlKey,b.shiftKey,b.altKey,b.metaKey)}),s&2&&hn("target",t.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[bi.HasDecoratorInputTransform,"preserveFragment","preserveFragment",sr],skipLocationChange:[bi.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",sr],replaceUrl:[bi.HasDecoratorInputTransform,"replaceUrl","replaceUrl",sr],routerLink:"routerLink"},standalone:!0,features:[co,ar]});let a=n;return a})(),Zv=(()=>{let n=class n{get isActive(){return this._isActive}constructor(r,s,t,g,b){this.router=r,this.element=s,this.renderer=t,this.cdr=g,this.link=b,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new Ii,this.routerEventsSubscription=r.events.subscribe(M=>{M instanceof Yo&&this.update()})}ngAfterContentInit(){Jt(this.links.changes,Jt(null)).pipe(i_()).subscribe(r=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let r=[...this.links.toArray(),this.link].filter(s=>!!s).map(s=>s.onChanges);this.linkInputChangesSubscription=oo(r).pipe(i_()).subscribe(s=>{this._isActive!==this.isLinkActive(this.router)(s)&&this.update()})}set routerLinkActive(r){let s=Array.isArray(r)?r:r.split(" ");this.classes=s.filter(t=>!!t)}ngOnChanges(r){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let r=this.hasActiveLinks();this.classes.forEach(s=>{r?this.renderer.addClass(this.element.nativeElement,s):this.renderer.removeClass(this.element.nativeElement,s)}),r&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==r&&(this._isActive=r,this.cdr.markForCheck(),this.isActiveChange.emit(r))})}isLinkActive(r){let s=$6(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return t=>{let g=t.urlTree;return g?r.isActive(g,s):!1}}hasActiveLinks(){let r=this.isLinkActive(this.router);return this.link&&r(this.link)||this.links.some(r)}};n.\u0275fac=function(s){return new(s||n)(ge(jt),ge(Zi),ge(nl),ge(_r),ge(Um,8))},n.\u0275dir=Ei({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(s,t,g){if(s&1&&hm(g,Um,5),s&2){let b;Ci(b=Si())&&(t.links=b)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[ar]});let a=n;return a})();function $6(a){return!!a.paths}var $v=class{};var q6=(()=>{let n=class n{constructor(r,s,t,g,b){this.router=r,this.injector=t,this.preloadingStrategy=g,this.loader=b}setUpPreloading(){this.subscription=this.router.events.pipe(wr(r=>r instanceof Yo),Td(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(r,s){let t=[];for(let g of s){g.providers&&!g._injector&&(g._injector=yC(g.providers,r,`Route: ${g.path}`));let b=g._injector??r,M=g._loadedInjector??b;(g.loadChildren&&!g._loadedRoutes&&g.canLoad===void 0||g.loadComponent&&!g._loadedComponent)&&t.push(this.preloadConfig(b,g)),(g.children||g._loadedRoutes)&&t.push(this.processRoutes(M,g.children??g._loadedRoutes))}return oo(t).pipe(i_())}preloadConfig(r,s){return this.preloadingStrategy.preload(s,()=>{let t;s.loadChildren&&s.canLoad===void 0?t=this.loader.loadChildren(r,s):t=Jt(null);let g=t.pipe(Go(b=>b===null?Jt(void 0):(s._loadedRoutes=b.routes,s._loadedInjector=b.injector,this.processRoutes(b.injector??r,b.routes))));if(s.loadComponent&&!s._loadedComponent){let b=this.loader.loadComponent(s);return oo([g,b]).pipe(i_())}else return g})}};n.\u0275fac=function(s){return new(s||n)(Ye(jt),Ye(jb),Ye(Dd),Ye($v),Ye(S2))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),yO=new Qt(""),Y6=(()=>{let n=class n{constructor(r,s,t,g,b={}){this.urlSerializer=r,this.transitions=s,this.viewportScroller=t,this.zone=g,this.options=b,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},this.environmentInjector=Nt(Dd),b.scrollPositionRestoration||="disabled",b.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Vm?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=r.navigationTrigger,this.restoredId=r.restoredState?r.restoredState.navigationId:0):r instanceof Yo?(this.lastId=r.id,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.urlAfterRedirects).fragment)):r instanceof Gd&&r.code===zv.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Nv&&(r.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(r.position):r.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(r.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(r,s){this.zone.runOutsideAngular(()=>Qr(this,null,function*(){yield new Promise(t=>{setTimeout(()=>{t()}),_C(()=>{t()},{injector:this.environmentInjector})}),this.zone.run(()=>{this.transitions.events.next(new Nv(r,this.lastSource==="popstate"?this.store[this.restoredId]:null,s))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};n.\u0275fac=function(s){Pd()},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})();function Z6(a){return a.routerState.root}function s0(a,n){return{\u0275kind:a,\u0275providers:n}}function X6(){let a=Nt(Lo);return n=>{let d=a.get(pm);if(n!==d.components[0])return;let r=a.get(jt),s=a.get(bO);a.get(I2)===1&&r.initialNavigation(),a.get(vO,null,mC.Optional)?.setUpPreloading(),a.get(yO,null,mC.Optional)?.init(),r.resetRootComponentType(d.componentTypes[0]),s.closed||(s.next(),s.complete(),s.unsubscribe())}}var bO=new Qt("",{factory:()=>new dn}),I2=new Qt("",{providedIn:"root",factory:()=>1});function K6(){return s0(2,[{provide:I2,useValue:0},{provide:vC,multi:!0,deps:[Lo],useFactory:n=>{let d=n.get(ek,Promise.resolve());return()=>d.then(()=>new Promise(r=>{let s=n.get(jt),t=n.get(bO);_O(s,()=>{r(!0)}),n.get(T2).afterPreactivation=()=>(r(!0),t.closed?Jt(void 0):t),s.initialNavigation()}))}}])}function Q6(){return s0(3,[{provide:vC,multi:!0,useFactory:()=>{let n=Nt(jt);return()=>{n.setUpLocationChangeListener()}}},{provide:I2,useValue:2}])}var vO=new Qt("");function J6(a){return s0(0,[{provide:vO,useExisting:q6},{provide:$v,useExisting:a}])}function eU(){return s0(8,[zP,{provide:qv,useExisting:zP}])}function tU(a){let n=[{provide:mO,useValue:F6},{provide:fO,useValue:kt({skipNextTransition:!!a?.skipInitialTransition},a)}];return s0(9,n)}var NP=new Qt("ROUTER_FORROOT_GUARD"),iU=[Pi,{provide:t0,useClass:$_},jt,i0,{provide:ku,useFactory:Z6,deps:[jt]},S2,[]],E2=(()=>{let n=class n{constructor(r){}static forRoot(r,s){return{ngModule:n,providers:[iU,[],{provide:Gv,multi:!0,useValue:r},{provide:NP,useFactory:aU,deps:[[jt,new mu,new Ob]]},{provide:a0,useValue:s||{}},s?.useHash?rU():oU(),nU(),s?.preloadingStrategy?J6(s.preloadingStrategy).\u0275providers:[],s?.initialNavigation?sU(s):[],s?.bindToComponentInputs?eU().\u0275providers:[],s?.enableViewTransitions?tU().\u0275providers:[],lU()]}}static forChild(r){return{ngModule:n,providers:[{provide:Gv,multi:!0,useValue:r}]}}};n.\u0275fac=function(s){return new(s||n)(Ye(NP,8))},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({});let a=n;return a})();function nU(){return{provide:yO,useFactory:()=>{let a=Nt(ak),n=Nt(di),d=Nt(a0),r=Nt(T2),s=Nt(t0);return d.scrollOffset&&a.setOffset(d.scrollOffset),new Y6(s,r,a,n,d)}}}function rU(){return{provide:h_,useClass:ik}}function oU(){return{provide:h_,useClass:tk}}function aU(a){return"guarded"}function sU(a){return[a.initialNavigation==="disabled"?Q6().\u0275providers:[],a.initialNavigation==="enabledBlocking"?K6().\u0275providers:[]]}var VP=new Qt("");function lU(){return[{provide:VP,useFactory:X6},{provide:xC,multi:!0,useExisting:VP}]}var xO=(()=>{let n=class n{constructor(r){this.router=r,setTimeout(()=>{this.router.navigate(["started"])},4e3)}};n.\u0275fac=function(s){return new(s||n)(ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-landing-page"]],decls:3,vars:0,consts:[[1,"container"],[1,"sub-container"],["src","assets/logo/logo png1.png"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1),Ee(2,"img",2),j()())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;text-align:center}.sub-container[_ngcontent-%COMP%]{width:250px;height:240px;position:relative;top:30%;left:20%}.sub-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}"]});let a=n;return a})();function cU(a,n){if(a&1){let d=gi();V(0,"div",7)(1,"div",8),Y(2),j(),Ee(3,"br")(4,"br"),V(5,"div")(6,"label",9),Fe("click",function(){let s=Mt(d).$implicit,t=Et();return Tt(t.selectOnlyOne(s))}),Ee(7,"input",10),j()()()}if(a&2){let d=n.$implicit;xe(2),zt(d.languages),xe(4),Ni("checked",d.isChecked),xe(),rt("checked",d.isChecked)}}var wO=(()=>{let n=class n{constructor(r){this.router=r,this.Language=[{languages:"English",isChecked:!1},{languages:"\u0939\u093F\u0902\u0926\u0940",isChecked:!1},{languages:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41",isChecked:!1},{languages:"\u0C95\u0CA8\u0CCD\u0CA8\u0CA1",isChecked:!1},{languages:"\u0627\u0631\u062F\u0648",isChecked:!1}]}toggleCheckbox(r){r.isChecked?r.isChecked=!1:r.isChecked=!0}selectOnlyOne(r){this.Language.forEach(s=>{s.isChecked=!1}),r.isChecked=!0,console.log(r.languages)}submit(){this.router.navigate(["log-in"])}};n.\u0275fac=function(s){return new(s||n)(ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-language"]],decls:14,vars:1,consts:[[1,"container"],[1,"sub-container"],[1,"select-language"],["src","assets\\logo\\language logo.png"],["class","Language-div",4,"ngFor","ngForOf"],[1,"btn"],[3,"click"],[1,"Language-div"],[1,"language-text"],[1,"custom-checkbox",3,"click"],["type","checkbox",3,"checked"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),Y(4,"Select Language"),j(),Ee(5,"img",3),j(),Ee(6,"br")(7,"br"),Zt(8,cU,8,4,"div",4),Ee(9,"br")(10,"br"),V(11,"div",5)(12,"button",6),Fe("click",function(){return t.submit()}),Y(13,"Continue"),j()()()()),s&2&&(xe(8),rt("ngForOf",t.Language))},dependencies:[Vr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:90%;position:relative;top:10%;left:5%}.select-language[_ngcontent-%COMP%]{display:flex;justify-content:space-between}span[_ngcontent-%COMP%]{font-size:1.4rem;font-family:inter;font-weight:500}.Language-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.language-text[_ngcontent-%COMP%]{font-size:1.3rem;font-family:inter;font-weight:500}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:#d16611}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}.btn[_ngcontent-%COMP%]{width:100%;align-items:center}button[_ngcontent-%COMP%]{width:90%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}']});let a=n;return a})();var CO=(()=>{let n=class n{constructor(r){this.http=r,this.api="https://api.coolieno1.in/v1.0/providers/provider-auth/signup"}setLog(r){console.log(r);let s={phone:r};console.log(s),this.http.post(this.api,s).subscribe(t=>{console.log(t)},t=>{console.log(t)})}};n.\u0275fac=function(s){return new(s||n)(Ye(nn))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var Xv=(()=>{let n=class n{constructor(r,s){this.dialogRef=r,this.data=s,this.content="",this.content=s.content,setTimeout(()=>{this.onNoClick()},3e3)}onNoClick(){this.dialogRef.close()}};n.\u0275fac=function(s){return new(s||n)(ge(Pm),ge(US))},n.\u0275cmp=gt({type:n,selectors:[["app-demo"]],inputs:{content:"content"},decls:3,vars:1,consts:[[1,"mat-dialog-container","bottom-dialog-container"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"p"),Y(2),j()()),s&2&&(xe(2),zt(t.content))},styles:[".mat-dialog-container[_ngcontent-%COMP%]{position:fixed;bottom:2rem;left:5%;width:90%;height:auto;border-radius:16px;color:#fff;background-color:#0d0c0cad;padding:8px;display:flex;align-items:center;justify-content:center}"]});let a=n;return a})();var ns=(()=>{let n=class n{constructor(r){this.dialog=r}openDialog(r){let s={content:r};this.dialog.open(Xv,{width:"100%",height:"auto",panelClass:"bottom-dialog-container",data:s})}};n.\u0275fac=function(s){return new(s||n)(Ye(Om))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var tr=(()=>{let n=class n{constructor(r,s,t){this.http=r,this.router=s,this.dialogService=t,this.userDetails=[],this.workDetails=[],this.alreadyHasAccount=!1,this.isAccountVerify=!0,this.api="",this.name="",this.experience=0,this.selectedSubCategories=[],this.userFromServer=[]}setLogInApi(){this.api="https://api.coolieno1.in/v1.0/providers/provider-auth/login",console.log(this.api)}setSignUpApi(){this.api="https://api.coolieno1.in/v1.0/providers/provider-auth/signup",console.log(this.api)}setLog(r){console.log(r),console.log(this.api);let s={phone:r};console.log(s),this.http.post(this.api,s).subscribe(t=>{console.log(t),this.responseOtp=t,this.userNumber=r,this.router.navigate(["verify"])},t=>{console.log(t),console.log(t.error),console.log(t.error.message),t.error.message==="User does not exist. Please sign up first."?(alert("Account was not found. Please signUp first."),this.router.navigate(["selectAccount"])):alert("something went wrong.Please retry again")})}showOtp(){alert(this.responseOtp.otp)}resendOtp(){console.log(this.userNumber),console.log(this.api);let r={phone:this.userNumber};console.log(r),this.http.post(this.api,r).subscribe(s=>{console.log(s)},s=>{console.log(s)})}verifyOtp(r){let s={otp:r,phone:this.userNumber};return this.http.post("https://api.coolieno1.in/v1.0/providers/provider-auth/verify-otp",s)}setUserInLocalStroage(r){localStorage.setItem("providerId",r)}setUser(r){this.userDetails.push({number:this.userNumber}),console.log(this.userDetails),localStorage.setItem("providerId",r),this.userId=localStorage.getItem("providerId")}getUserId(){let r=localStorage.getItem("providerId");return console.log(r),Jt(r)}removeUser(){localStorage.removeItem("providerId")}setWork(r,s){this.workName=r,this.workId=s}setSubCat(r){console.log(r),this.selectedSubCategories.push(r),console.log(this.selectedSubCategories)}setAge(r){console.log(r),this.age=r,console.log(this.age)}setExperiance(r){console.log(r),this.experience=r}setWorkDetails(){console.log(this.selectedSubCategories);let r=[{categoryId:this.workId,nameOfService:this.workName,experience:this.experience,subcategory:this.selectedSubCategories}];this.workDetails.push(r),console.log(this.workDetails.flat())}getSubCategory(){let r=`https://api.coolieno1.in/v1.0/core/sub-categories/category/${this.categoryId}`;return this.http.get(r)}sendWorkDetails(){let r="https://api.coolieno1.in/v1.0/providers/work",s=this.workDetails.flat(),g={providerId:localStorage.getItem("providerId"),works:s};return console.log(g),this.http.post(r,g)}UserDetails(r){let s=[];r.forEach((g,b)=>{s.push(b=g)}),console.log(s),console.log(r),this.http.post("https://api.coolieno1.in/v1.0/providers/provider-details",r).subscribe(g=>{console.log("Success",g),this.userFromServer=g,this.router.navigate(["aadharVerify"])},g=>{console.error("Error",g),g.error instanceof ErrorEvent?alert("A network error occurred. Please try again later."):alert("An error occurred. Please try again later."),console.error(`Backend returned code ${g.status}, body was: `,g.error)})}formatingResponse(r){console.log(r.work),console.log(r.work);let t=JSON.parse(r.work).flat();this.userFromServer.work=t,console.log(this.userFromServer)}updateUserWork(r,s){console.log(s);let t={works:r};console.log("work in service",t);let g=`https://api.coolieno1.in/v1.0/providers/work/${s}`;this.http.put(g,t).subscribe(b=>{console.log(b),this.dialogService.openDialog("Service has been updated"),this.router.navigate(["home"])},b=>{console.log(b)})}getPhoneNumber(){let s=`https://api.coolieno1.in/v1.0/providers/provider-auth/${localStorage.getItem("providerId")}`;return this.http.get(s).subscribe(t=>{this.userNumber=t.phone,console.log(this.userNumber)},t=>{console.log(t)}),this.userNumber}setDefult(){this.userDetails=[],this.workDetails=[],this.userNumber=null,this.userId="",this.alreadyHasAccount=!1,this.isAccountVerify=!0,this.api="",this.responseOtp="",this.name="",this.pincode="",this.radius=void 0,this.workName="",this.workId="",this.age="",this.gender="",this.experience=0,this.selectedSubCategories=[],this.categoryId="",this.userFromServer=[]}};n.\u0275fac=function(s){return new(s||n)(Ye(nn),Ye(jt),Ye(ns))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();function hU(a,n){a&1&&(V(0,"div")(1,"p",14),Y(2,"***Please enter a valid 10-digit phone number."),j()())}var SO=(()=>{let n=class n{constructor(r,s,t,g,b){this.router=r,this.fb=s,this.auth=t,this.http=g,this.logInService=b,this.showError=!1,this.myForm=this.fb.group({phoneNumber:[null,[kr.required,kr.pattern("^[0-9]{10}$")]]})}validate(){this.myForm.value.phoneNumber.length===10?this.showError=!1:this.showError=!0}login(){this.logInService.setLog(this.myForm.value.phoneNumber)}};n.\u0275fac=function(s){return new(s||n)(ge(jt),ge(la),ge(CO),ge(nn),ge(tr))},n.\u0275cmp=gt({type:n,selectors:[["app-log-in"]],decls:28,vars:2,consts:[[1,"container"],[1,"sub-container"],[1,"banner-div"],[1,"banner"],[3,"submit","input","formGroup"],[1,"phone-div"],[1,"num"],[1,"line"],["type","tel","formControlName","phoneNumber",1,"input-box"],[4,"ngIf"],[1,"update-div"],["type","checkbox"],["src","assets\\logo\\wts up .png"],[1,"btn"],[1,"error-message",2,"color","red"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span"),Y(5,"Earn more"),j(),Ee(6,"br"),V(7,"p"),Y(8,"fill your dreams"),j()()(),V(9,"form",4),Fe("submit",function(){return t.login()})("input",function(){return t.validate()}),V(10,"div",5)(11,"div")(12,"span",6),Y(13,"+91"),j(),Ee(14,"span",7)(15,"input",8),j()(),Ee(16,"br"),Zt(17,hU,3,0,"div",9),V(18,"div",10),Ee(19,"input",11),V(20,"span"),Y(21,"Get update on \xA0"),Ee(22,"img",12),Y(23," whatsapp"),j()(),Ee(24,"br"),V(25,"div",13)(26,"button"),Y(27,"Get OTP"),j()()()()()),s&2&&(xe(9),rt("formGroup",t.myForm),xe(8),rt("ngIf",t.showError))},dependencies:[jr,No,ho,Mr,Bo,qo,Aa],styles:['.container[_ngcontent-%COMP%]{width:99vw;height:100vh;text-align:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:100%;position:relative;top:3%;display:grid;grid-gap:1.2rem;text-align:center;align-items:center}.banner-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}.banner[_ngcontent-%COMP%]{width:20rem;height:26rem;background-image:url("./media/Rectangle 25-RGNGM5F3.png");background-repeat:no-repeat;display:flex;flex-direction:column;justify-content:center;text-align:center}.banner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:42px;font-family:Inter,sans-serif;font-weight:600;color:#fff}.banner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:26px;font-family:Inter,sans-serif;font-weight:600;color:#fff}.phone-div[_ngcontent-%COMP%]{width:90%;align-items:start;border-radius:.5rem;height:3.5rem;border:1px solid rgba(0,0,0,1);position:relative;left:5%}.phone-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:flex;position:relative;top:30%;left:5%;font-size:1.3rem}.phone-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:26px;height:17px}.num[_ngcontent-%COMP%]{font-size:1.4rem}.line[_ngcontent-%COMP%]{margin-top:-.2rem;font-size:2.2rem}.input-box[_ngcontent-%COMP%]{float:left;margin-top:-.4rem;width:70%;height:2rem;outline:0;border-width:0 0 0;font-size:1.5rem}input[type=checkbox][_ngcontent-%COMP%]{accent-color:#D16611}.update-div[_ngcontent-%COMP%]{width:80%;height:1.6rem;text-align:center;align-items:center;display:flex;justify-content:space-around}.update-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:24px;height:24px;background-color:#d70d09}.update-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.3rem;font-family:inter;font-weight:400}.btn[_ngcontent-%COMP%]{width:100%;align-items:center}button[_ngcontent-%COMP%]{width:90%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}']});let a=n;return a})();var Hr=(()=>{let n=class n{constructor(r,s,t){this.http=r,this.router=s,this.dialogService=t,this.userId=localStorage.getItem("provider"),this.isVerify=!1,this.items=[],this.selectedJob=[],this.userName="",this.workDetails=[],this.getServices()}selectedJobDetails(r){console.log(r),this.selectedJob=r}getSelectedJob(){return console.log(this.selectedJob),this.selectedJob}getUserDetails(r){let s=`https://api.coolieno1.in/v1.0/providers/provider-details/${r}`;return new Ro(t=>{this.http.get(s).subscribe(g=>{console.log(g),console.log("response",g),this.isVerify=g.isVerified,this.userDetails=g,this.formatingResponse(this.userDetails),t.next(!1),t.complete()},g=>{console.log(g),g.error.message=="No items found for this user"?(console.log("not found"),t.next(!0)):(t.error(g),this.dialogService.openDialog("Please add the details"),this.router.navigate(["aboutUser"])),t.complete()})})}formatingResponse(r){try{typeof r.work=="string"&&(this.workDetails=r.work);let t=r.work;this.workDetails=t,console.log(this.workDetails)}catch(s){console.error("Error processing response.work",s)}}flattenArray(r){return r.reduce((s,t)=>Array.isArray(t)?s.concat(this.flattenArray(t)):s.concat(t),[])}getServices(){this.http.get("https://api.coolieno1.in/v1.0/core/categories").subscribe(s=>{console.log(s),this.formattingServices(s)},s=>{console.log(s)})}formattingServices(r){r.forEach(s=>{this.items.push({id:s._id,names:s.name,checked:!1})})}getAvailability(){let r=`https://api.coolieno1.in/v1.0/providers/provider-date/${localStorage.getItem("providerId")}`;return this.http.get(r)}setDefault(){this.items=[],this.selectedJob=[],this.userDetails="",this.userName=""}};n.\u0275fac=function(s){return new(s||n)(Ye(nn),Ye(jt),Ye(ns))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var uU=["input1"],pU=["input2"],mU=["input3"],fU=["input4"];function gU(a,n){if(a&1){let d=gi();V(0,"div",16),Fe("click",function(){Mt(d);let s=Et();return Tt(s.resend())}),V(1,"p"),Y(2,"Resend"),j()()}}function _U(a,n){if(a&1&&(V(0,"div",17)(1,"p"),Y(2),j()()),a&2){let d=Et();xe(2),rl("",d.minutes," : ",d.seconds,"")}}var MO=(()=>{let n=class n{constructor(r,s,t,g,b,M,k){this.form=r,this.logInService=s,this.jobDetailsService=t,this.loginServices=g,this.router=b,this.dialogeService=M,this.http=k,this.userNumber=0,this.resendToggling="resend",this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}ngOnInit(){this.userNumber=this.logInService.userNumber,this.logInService.showOtp()}onInput(r,s){if(r.target.value.length===1)switch(s){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}onKeyDown(r,s){console.log("called",r,s);let t=r.target;if(console.log("input :",t.value),console.log(s==1),r.key==="Backspace"&&!t.value&&s>1){let g=s-1;if(console.log("previous input",`#input${s-1}`),g)switch(g){case 3:this.input3.nativeElement.focus();break;case 2:this.input2.nativeElement.focus();break;case 1:this.input1.nativeElement.focus();break;default:console.log("something went wrong")}}}login(){return Qr(this,null,function*(){let r=this.otp.value,s=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log("OTP:",this.otp.value),console.log(s),this.logInService.verifyOtp(s).subscribe(t=>Qr(this,null,function*(){console.log("log in done",t),console.log(t.providerId),yield this.logInService.setUser(t.providerId),this.storeUserData(),yield this.chekingUser()}),t=>{console.log("error",t),alert(t.error.message)})})}storeUserData(){}resend(){this.logInService.resendOtp(),this.resendToggling="countdown",this.startCountdown()}startCountdown(){let r=120;this.updateDisplay(r),this.countdownInterval=setInterval(()=>{r-=1,r<=0?(this.stopCountdown(),this.resendToggling="resend"):this.updateDisplay(r)},1e3)}stopCountdown(){clearInterval(this.countdownInterval)}ngOnDestroy(){this.stopCountdown()}updateDisplay(r){this.minutes=Math.floor(r/60),this.seconds=r%60}chekingUser(){return Qr(this,null,function*(){let s=`https://api.coolieno1.in/v1.0/providers/provider-details/${localStorage.getItem("providerId")}`;this.http.get(s).subscribe(t=>{console.log("response",t),console.log(t.providerName),this.logInService.alreadyHasAccount=!0,this.navTo()},t=>{console.log(t),this.dialogeService.openDialog("Please add your Details"),this.router.navigate(["aboutUser"])})})}navTo(){this.logInService.alreadyHasAccount?this.router.navigate(["home"]):(this.dialogeService.openDialog("Please add your Details"),this.router.navigate(["aboutUser"]))}};n.\u0275fac=function(s){return new(s||n)(ge(la),ge(tr),ge(Hr),ge(tr),ge(jt),ge(ns),ge(nn))},n.\u0275cmp=gt({type:n,selectors:[["app-verify"]],viewQuery:function(s,t){if(s&1&&(ki(uU,5),ki(pU,5),ki(mU,5),ki(fU,5)),s&2){let g;Ci(g=Si())&&(t.input1=g.first),Ci(g=Si())&&(t.input2=g.first),Ci(g=Si())&&(t.input3=g.first),Ci(g=Si())&&(t.input4=g.first)}},decls:27,vars:3,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"info-text"],[3,"ngSubmit","formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputTwo",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputThree",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputFour",3,"input","keydown"],[1,"resend-div"],["type","submit",1,"login-btn",3,"click"],[1,"resend",3,"click"],[1,"resend"]],template:function(s,t){if(s&1){let g=gi();V(0,"div",4)(1,"div",5)(2,"span",6),Y(3,"Enter Otp"),j(),Ee(4,"br"),V(5,"span",7),Y(6,"Please enter the code we just send to"),j(),V(7,"p",7),Y(8),j(),Ee(9,"br"),V(10,"form",8),Fe("ngSubmit",function(){return Mt(g),Tt(t.login())}),V(11,"div",9)(12,"input",10,0),Fe("input",function(M){return Mt(g),Tt(t.onInput(M,1))})("keydown",function(M){return Mt(g),Tt(t.onKeyDown(M,1))}),j(),V(14,"input",11,1),Fe("input",function(M){return Mt(g),Tt(t.onInput(M,2))})("keydown",function(M){return Mt(g),Tt(t.onKeyDown(M,2))}),j(),V(16,"input",12,2),Fe("input",function(M){return Mt(g),Tt(t.onInput(M,3))})("keydown",function(M){return Mt(g),Tt(t.onKeyDown(M,3))}),j(),V(18,"input",13,3),Fe("input",function(M){return Mt(g),Tt(t.onInput(M,4))})("keydown",function(M){return Mt(g),Tt(t.onKeyDown(M,4))}),j()(),V(20,"div",14)(21,"span"),Y(22,"Didn\u2019t receive OTP?"),j(),Zt(23,gU,3,0)(24,_U,3,2),j(),V(25,"button",15),Fe("click",function(){return Mt(g),Tt(t.login())}),Y(26,"Verify"),j()()()()}if(s&2){let g;xe(8),bn("+91 ",t.userNumber,""),xe(2),rt("formGroup",t.otp),xe(13),Dr(23,(g=t.resendToggling)==="resend"?23:g==="countdown"?24:-1)}},dependencies:[No,ho,Mr,Bo,vu,qo,Aa],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;text-align:center;align-items:center}.sub-container[_ngcontent-%COMP%]{position:relative;top:10%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px}.info-text[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}.resend-div[_ngcontent-%COMP%]{margin-top:3rem;width:90%;height:4rem;display:grid;align-items:center;row-gap:0}.resend-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer;font-size:1.1rem;font-family:Roboto,sans-serif;font-weight:400;color:#000}.resend[_ngcontent-%COMP%]{float:left;margin-top:2%}.resend[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#000}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}@media screen and (min-width: 600px){.container[_ngcontent-%COMP%]{align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:30%;border:1px solid black;position:relative;left:35%}}"]});let a=n;return a})();var po=(()=>{let n=class n{constructor(r){this.http=r,this.workResponse=[],this.api="https://api.coolieno1.in/v1.0"}selectWork(r){return r}getWork(r){let s=`${this.api}/${`providers/work/${r}`}`;return console.log(s),this.http.get(s)}getFinancialDetails(){let r=`https://api.coolieno1.in/v1.0/providers/provider-finance/${localStorage.getItem("providerId")}`;return this.http.get(r)}getPackages(){return this.http.get("https://api.coolieno1.in/v1.0/admin/provider-package")}getCertificated(r){let s=`https://api.coolieno1.in/v1.0/providers/provider-certificate/${r}`;return this.http.get(s)}setDefult(){this.workResponseId="",this.workResponse=[],this.currentLocation="",this.currentCordinates="",this.userRegistered="",this.api=""}};n.\u0275fac=function(s){return new(s||n)(Ye(nn))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();function yU(a,n){if(a&1){let d=gi();V(0,"div",5)(1,"label",8),Y(2,"what work do you do?"),j(),Ee(3,"br"),V(4,"input",26),Fe("click",function(){Mt(d);let s=Et();return Tt(s.navTo())}),j(),Ee(5,"i",27),j()}if(a&2){let d=Et();xe(4),rt("ngModel",d.selectedWork)}}function bU(a,n){a&1&&Ee(0,"img",28)}function vU(a,n){if(a&1&&Ee(0,"img",29),a&2){let d=Et();rt("src",d.imagePreview,Er)}}var TO=(()=>{let n=class n{constructor(r,s,t,g){this.fb=r,this.router=s,this.loginService=t,this.userDetailsService=g,this.selectedFile=null,this.imagePreview=null,this.workAdded=!0,this.aboutProvider=this.fb.group({userId:localStorage.getItem("providerId"),providerName:["",kr.required],work:["",kr.required],pincode:["",kr.required],radius:["",kr.required],phone:[this.loginService.userNumber,kr.required],age:[this.loginService.age,kr.required],gender:["",kr.required],address:["",kr.required],image:[""]});let b=this.loginService.workDetails.flat();this.aboutProvider.controls.work.setValue(b),console.log(b),console.log("inform",this.aboutProvider.value.work),this.selectedWork=this.loginService.workDetails.flatMap(M=>M.flatMap(k=>k.nameOfService)).join(", ")}ngOnInit(){this.getNumber(),this.getWork()}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r),r.length>0&&(this.workAdded=!1)},error:r=>{console.log(r)}})}getNumber(){return Qr(this,null,function*(){let r=this.loginService.getPhoneNumber();console.log(r),this.userNumber=yield this.loginService.userNumber,console.log(this.userNumber)})}flattenWorkDetails(r){return r.flatMap(s=>s.flatMap(t=>t.nameOfService))}onFileSelected(r){let s=r.target;if(s.files&&s.files.length>0){this.selectedFile=s.files[0];let t=new FileReader;t.onload=()=>{this.imagePreview=t.result},t.readAsDataURL(this.selectedFile)}}navTo(){this.router.navigate(["selectWork"])}submit(){let r=new FormData;r.append("providerName",this.aboutProvider.value.providerName),r.append("age",this.aboutProvider.value.age),r.append("pincode",this.aboutProvider.value.pincode),r.append("radius",this.aboutProvider.value.radius),r.append("providerId",this.aboutProvider.value.userId),r.append("gender",this.aboutProvider.value.gender),r.append("address",this.aboutProvider.value.address),r.append("phone",this.loginService.userNumber),this.selectedFile&&r.append("image",this.selectedFile,this.selectedFile.name),r.forEach((s,t)=>{console.log(`${t}: ${s}`)}),this.loginService.UserDetails(r)}};n.\u0275fac=function(s){return new(s||n)(ge(la),ge(jt),ge(tr),ge(po))},n.\u0275cmp=gt({type:n,selectors:[["app-about-user"]],decls:52,vars:4,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[3,"formGroup"],[1,"form-div"],[2,"position","relative"],["for","name"],["type","text","placeholder","Name","formControlName","providerName","id","names","required",""],["for","work"],["for","name","formControlName","gender"],["value","","disabled","","selected",""],["value","Male"],["value","Female"],["value","Others"],["for","location"],["type","number","formControlName","pincode","required","","placeholder","Pincode"],["for","address"],["type","text","formControlName","address","required","","placeholder","Address"],["type","number","formControlName","radius","required","","placeholder","Enter radius"],["for","file",1,"image-label"],[1,"file-input-container"],["for","file-input",1,"file-label"],["src","assets/documents/Group.png","alt","Upload image","class","placeholder-image",4,"ngIf"],["alt","Selected image","class","preview-image",3,"src",4,"ngIf"],["type","file","id","file-input","formControlName","image","required","",1,"file-input",3,"change"],["type","submit",1,"login-btn",3,"click"],["formControlName","work","id","providerType","required","","placeholder","please select the Work ",3,"click","ngModel"],[1,"fa","fa-angle-down",2,"font-size","36px","position","absolute","right","10px","top","75%","transform","translateY(-50%)","pointer-events","none"],["src","assets/documents/Group.png","alt","Upload image",1,"placeholder-image"],["alt","Selected image",1,"preview-image",3,"src"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Y(3,"Tell us about yourself"),j(),Ee(4,"br"),V(5,"form",3)(6,"div",4),Zt(7,yU,6,1,"div",5),V(8,"div")(9,"label",6),Y(10,"what's your Name"),j(),Ee(11,"br")(12,"input",7),j(),V(13,"div")(14,"label",8),Y(15,"Select your Gender"),j(),Ee(16,"br"),V(17,"select",9)(18,"option",10),Y(19,"Select"),j(),V(20,"option",11),Y(21,"Male"),j(),V(22,"option",12),Y(23,"Female"),j(),V(24,"option",13),Y(25,"Others"),j()(),Ee(26,"br"),j(),V(27,"div")(28,"label",14),Y(29," Pin code "),j(),Ee(30,"br")(31,"input",15),j(),V(32,"div")(33,"label",16),Y(34," Address "),j(),Ee(35,"br")(36,"input",17),j(),V(37,"div")(38,"label",14),Y(39," Select radius or Range to you want to work from your place "),j(),Ee(40,"br")(41,"input",18),j(),V(42,"label",19),Y(43," Upload image "),j(),V(44,"div",20)(45,"label",21),Zt(46,bU,1,0,"img",22)(47,vU,1,1,"img",23),j(),V(48,"input",24),Fe("change",function(b){return t.onFileSelected(b)}),j()(),V(49,"button",25),Fe("click",function(){return t.submit()}),Y(50,"Continue"),j()()()()(),Ee(51,"br")),s&2&&(xe(5),rt("formGroup",t.aboutProvider),xe(2),Dr(7,t.workAdded?7:-1),xe(39),rt("ngIf",!t.selectedFile),xe(),rt("ngIf",t.selectedFile))},dependencies:[jr,No,uA,mA,ho,bu,pv,Mr,Bo,ZC,qo,Aa],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;top:10%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.form-div[_ngcontent-%COMP%]{width:100%;display:grid;grid-gap:2.5rem}.form-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:grid;text-align:left}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;height:3rem;border:1px solid black;border-radius:.8rem;font-size:1rem}input[_ngcontent-%COMP%]::placeholder{padding-left:.5rem}label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:400;font-family:inter;line-height:19px}#providerType[_ngcontent-%COMP%]   option[value=""][disabled][_ngcontent-%COMP%]{display:none}.file-input-container[_ngcontent-%COMP%]{position:relative;width:200px;height:200px;border:.25px solid #ccc;display:flex;align-items:center;justify-content:center;border-radius:.5rem}.file-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:60%;cursor:pointer;position:relative}.placeholder-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.preview-image[_ngcontent-%COMP%]{width:10rem;height:8rem}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.image-label[_ngcontent-%COMP%]{float:left;text-align:left}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:100%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;margin-bottom:3rem}']});let a=n;return a})();var IO=(()=>{let n=class n{constructor(r){this.router=r,this.currentUrl=this.router.url,this.router.events.pipe(wr(s=>s instanceof Yo),hC()).subscribe(s=>{this.previousUrl=s[0].url,this.currentUrl=s[1].url})}getPreviousUrl(){return this.previousUrl}};n.\u0275fac=function(s){return new(s||n)(Ye(jt))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();function wU(a,n){if(a&1){let d=gi();V(0,"div",8)(1,"div",10),Y(2),j(),V(3,"div")(4,"input",11),So("ngModelChange",function(s){let t=Mt(d).$implicit;return Co(t.checked,s)||(t.checked=s),Tt(s)}),Fe("change",function(s){let t=Mt(d).$implicit,g=Et();return Tt(g.onChange(s,t))}),j()()()}if(a&2){let d=n.$implicit;xe(2),zt(d.names),xe(2),wo("ngModel",d.checked)}}function CU(a,n){if(a&1){let d=gi();V(0,"div",8)(1,"div",10),Y(2),j(),V(3,"div")(4,"input",11),So("ngModelChange",function(s){let t=Mt(d).$implicit;return Co(t.checked,s)||(t.checked=s),Tt(s)}),Fe("change",function(s){let t=Mt(d).$implicit,g=Et();return Tt(g.onChange(s,t))}),j()()()}if(a&2){let d=n.$implicit;xe(2),zt(d.names),xe(2),wo("ngModel",d.checked)}}var EO=(()=>{let n=class n{onInputChange(r){console.log(this.searchQuery);let s=this.jobDetails.items.filter(t=>t.names.toLowerCase().includes(this.searchQuery.toLowerCase()));console.log(s),this.items=s}ngOnInit(){this.previousUrl=this.routeTrackingService.getPreviousUrl(),console.log("Previous URL:",this.previousUrl)}constructor(r,s,t,g,b,M){this.router=r,this.logInservice=s,this.jobDetails=t,this.routeTrackingService=g,this.userDetailsService=b,this.dialogeService=M,this.searchQuery="",this.items=this.jobDetails.items,this.workForSending=[]}onChange(r,s){let t=r.target;if(t&&t.checked){let b=this.items.indexOf(s);this.jobDetails.items[b].checked=!0,console.log("Item checked:",this.items.indexOf(s)),console.log("Item checked:",s.names),console.log("categoryId",s.id),this.logInservice.categoryId=s.id,this.logInservice.setWork(s.names,s.id),this.router.navigate(["subServices"])}}send(){let r=this.items.filter(s=>s.checked===!0);if(console.log(r),this.jobDetails.userDetails&&this.jobDetails.userDetails.providerName!=null){let s=this.logInservice.workDetails.flat();this.UpdatingUserWork(s)}else r.length<1?alert("please select any one service"):this.logInservice.sendWorkDetails().subscribe(s=>{console.log(s),this.dialogeService.openDialog("Service has been added"),this.router.navigate(["aboutUser"])},s=>{console.log(s)})}UpdatingUserWork(r){console.log(r);let s=this.userDetailsService.workResponseId;console.log("work before",this.userDetailsService.workResponse),console.log("id before",s),this.workForSending.push(this.userDetailsService.workResponse),this.workForSending.push(r),console.log(this.workForSending.flat()),this.logInservice.updateUserWork(this.workForSending.flat(),s)}};n.\u0275fac=function(s){return new(s||n)(ge(jt),ge(tr),ge(Hr),ge(IO),ge(po),ge(ns))},n.\u0275cmp=gt({type:n,selectors:[["app-select-work"]],decls:22,vars:2,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"search-container"],["type","text","placeholder","Search for Service",1,"search-input",3,"ngModelChange","input","ngModel"],[1,"material-symbols-outlined",3,"hidden"],[1,"serivce"],[1,"tittle2"],[1,"service-div"],["type","submit",1,"login-btn",3,"click"],[1,"names"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Y(3,"what work do you do?"),j(),Ee(4,"br"),V(5,"div",3)(6,"input",4),So("ngModelChange",function(b){return Co(t.searchQuery,b)||(t.searchQuery=b),b}),Fe("input",function(b){return t.onInputChange(b)}),j(),V(7,"span",5),Y(8,"search"),j()(),V(9,"div",6)(10,"span",7),Y(11,"Popular categories"),j(),Ee(12,"br"),Cr(13,wU,5,2,"div",8,xo),V(15,"span",7),Y(16,"All categories"),j(),Ee(17,"br"),Cr(18,CU,5,2,"div",8,xo),j()(),V(20,"button",9),Fe("click",function(){return t.send()}),Y(21,"Continue"),j()()),s&2&&(xe(6),wo("ngModel",t.searchQuery),xe(),rt("hidden",t.searchQuery),xe(6),Sr(t.items),xe(5),Sr(t.items))},dependencies:[ho,tc,Mr,Es],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-container[_ngcontent-%COMP%]{position:relative}.search-container[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{padding-right:30px;width:70%;height:2.5rem;border-radius:.8rem;font-size:1.5rem}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.search-container[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{position:absolute;top:50%;left:7%;transform:translateY(-50%);cursor:pointer;pointer-events:none;font-size:32px;margin:0}.tittle2[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:500;line-height:24px;display:flex;align-items:start}.serivce[_ngcontent-%COMP%]{height:70vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.7rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let a=n;return a})();var DO=(()=>{let n=class n{constructor(r,s){this.router=r,this.loginService=s,this.selectedExperiance="",this.selectedAge="",this.workSelected=this.loginService.workName,this.selectedCheckbox=null}sendResponse(){console.log(this.selectedAge,this.selectedExperiance)}expSelected(r){this.selectedExperiance===r?this.selectedExperiance=null:this.selectedExperiance=r,console.log(this.selectedExperiance),this.selectedExperiance==="yes"?this.router.navigate(["workExperiance"]):(this.loginService.setExperiance("0"),this.loginService.setWorkDetails(),this.router.navigate(["selectWork"]))}onCheckboxChange(r){this.selectedAge===r?this.selectedAge=null:this.selectedAge=r,console.log("Selected Checkbox:",this.selectedAge),this.loginService.setAge(this.selectedAge)}};n.\u0275fac=function(s){return new(s||n)(ge(jt),ge(tr))},n.\u0275cmp=gt({type:n,selectors:[["app-about-work"]],decls:44,vars:6,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["type","checkbox",3,"change","checked"],[2,"padding","0.5rem"],[1,"select-div"],[1,"conditions"],["type","checkbox"],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Y(3,"Tell us about your work!"),j(),Ee(4,"br")(5,"br"),V(6,"div",3)(7,"pre"),Y(8,"What is your age?"),j(),Ee(9,"hr"),V(10,"div")(11,"span"),Y(12,"16 - 18"),j(),V(13,"input",4),Fe("change",function(){return t.onCheckboxChange("16-18")}),j()(),Ee(14,"hr"),V(15,"div")(16,"span"),Y(17,"18 - 40"),j(),V(18,"input",4),Fe("change",function(){return t.onCheckboxChange("18-40")}),j()(),Ee(19,"hr"),V(20,"div")(21,"span"),Y(22,"More than 40"),j(),V(23,"input",4),Fe("change",function(){return t.onCheckboxChange("more than 40")}),j()()(),V(24,"div",3)(25,"p",5),Y(26),j(),Ee(27,"hr"),V(28,"div",6)(29,"span"),Y(30,"Yes"),j(),V(31,"input",4),Fe("change",function(){return t.expSelected("yes")}),j()(),Ee(32,"hr"),V(33,"div")(34,"span"),Y(35,"No"),j(),V(36,"input",4),Fe("change",function(){return t.expSelected("no")}),j()()(),V(37,"div",7),Ee(38,"input",8),Y(39," \xA0 Agree with Terms & conditions"),j(),Ee(40,"br")(41,"br"),V(42,"button",9),Fe("click",function(){return t.sendResponse()}),Y(43,"Continue"),j()()()),s&2&&(xe(13),rt("checked",t.selectedAge==="16-18"),xe(5),rt("checked",t.selectedAge==="18-40"),xe(5),rt("checked",t.selectedAge==="more than 40"),xe(3),bn("Do you have any experience in ",t.workSelected," services?"),xe(5),rt("checked",t.selectedExperiance==="yes"),xe(5),rt("checked",t.selectedExperiance==="no"))},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content;border:1px solid black;margin-bottom:5%;border-radius:1rem}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5%;display:flex;justify-content:space-between}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:95%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611}.conditions[_ngcontent-%COMP%]{width:max-content;font-size:1.2rem;font-family:inter,sans-serif;font-weight:400;line-height:1.4rem;float:left;display:flex;justify-content:space-around}.conditions[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}.sub-div1[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1rem}"]});let a=n;return a})();var kO=(()=>{let n=class n{constructor(r,s){this.logInservice=r,this.router=s,this.experiance=""}onCheckboxChange(r){this.experiance===r?this.experiance=null:this.experiance=r,console.log("Selected Checkbox:",this.experiance)}sendResponse(){this.logInservice.setExperiance(this.experiance),this.logInservice.setWorkDetails(),this.router.navigate(["selectWork"])}};n.\u0275fac=function(s){return new(s||n)(ge(tr),ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-work-experiance"]],decls:30,vars:4,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["type","checkbox",3,"change","checked"],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Y(3,"Tell us about your work!"),j(),Ee(4,"br")(5,"br"),V(6,"div",3)(7,"div")(8,"span"),Y(9,"0-1 Years"),j(),V(10,"input",4),Fe("change",function(){return t.onCheckboxChange("0-1")}),j()(),Ee(11,"hr"),V(12,"div")(13,"span"),Y(14,"2-4 Years"),j(),V(15,"input",4),Fe("change",function(){return t.onCheckboxChange("2-4")}),j()(),Ee(16,"hr"),V(17,"div")(18,"span"),Y(19,"3-5 Years"),j(),V(20,"input",4),Fe("change",function(){return t.onCheckboxChange("3-5")}),j()(),Ee(21,"hr"),V(22,"div")(23,"span"),Y(24,"More than 5 Years"),j(),V(25,"input",4),Fe("change",function(){return t.onCheckboxChange("more than 5")}),j()()()(),Ee(26,"br")(27,"br"),V(28,"button",5),Fe("click",function(){return t.sendResponse()}),Y(29,"Continue"),j()()),s&2&&(xe(10),rt("checked",t.experiance==="0-1"),xe(5),rt("checked",t.experiance==="2-4"),xe(5),rt("checked",t.experiance==="3-5"),xe(5),rt("checked",t.experiance==="moreThan5"))},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content;border:1px solid black;margin-bottom:5%;border-radius:1rem}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5%;display:flex;justify-content:space-between}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:95%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611}"]});let a=n;return a})();var AO=(()=>{let n=class n{constructor(r){this.router=r}verify(){console.log("inside"),this.router.navigate(["pancard"])}};n.\u0275fac=function(s){return new(s||n)(ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-aadhar-verification"]],decls:24,vars:0,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["for","name"],["type","number","placeholder","name","id","names","required",""],["type","number","placeholder","OTP","id","names","required",""],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Y(3,"Lets Get the Documentation Done....!!"),j(),Ee(4,"br")(5,"br"),V(6,"div",3)(7,"div")(8,"label",4),Y(9,"Adhar Number"),j(),Ee(10,"br")(11,"input",5),j(),Ee(12,"br"),V(13,"button"),Y(14,"Verify"),j(),V(15,"div")(16,"label",4),Y(17,"OTP"),j(),Ee(18,"br")(19,"input",6),j()(),V(20,"button",7),Fe("click",function(){return t.verify()}),Y(21,"Verify"),j()(),Ee(22,"br")(23,"br"),j())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.6rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:grid;text-align:left}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;height:3rem;border:1px solid black;border-radius:.8rem;font-size:1rem}input[_ngcontent-%COMP%]::placeholder{padding-left:.5rem}label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:400;font-family:inter,sans-serif;line-height:19px}.sub-div1[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:4rem;height:1.4rem;background-color:#d16611;color:#fff;font-size:.8rem;font-family:inter;float:right;border:none;border-radius:.4rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}"]});let a=n;return a})();var PO=(()=>{let n=class n{constructor(r){this.router=r}skip(){this.router.navigate(["bankDetails"])}submit(){this.router.navigate(["bankDetails"])}};n.\u0275fac=function(s){return new(s||n)(ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-pancard"]],decls:21,vars:0,consts:[[1,"container"],[1,"skip-btn",3,"click"],[1,"sub-container"],[1,"tittle"],[1,"tittle1"],[1,"pan"],["src","assets\\documents\\pancard.png"],[1,"input"],["type","number","placeholder","PAN Number","id","Enter GST Number","required",""],["type","number","placeholder","Enter GST Number","id","Enter GST Number","required",""],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"button",1),Fe("click",function(){return t.skip()}),Y(2,"skip"),j(),V(3,"div",2)(4,"div")(5,"span",3),Y(6,"PAN Number"),j(),Ee(7,"br")(8,"br"),V(9,"span",4),Y(10,"Please Input your PAN number"),j(),Ee(11,"br")(12,"br"),j(),V(13,"div",5),Ee(14,"img",6),j(),V(15,"div",7),Ee(16,"input",8)(17,"br")(18,"input",9),j(),V(19,"button",10),Fe("click",function(){return t.submit()}),Y(20,"Submit"),j()()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.skip-btn[_ngcontent-%COMP%]{width:max-content;height:max-content;float:right;margin:1rem;margin-bottom:0;background-color:transparent;border:none;font-family:"Inter" sans-serif;color:#00000080;font-size:16px;font-weight:400;line-height:16.94px;text-align:left}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:0%;left:5%;display:grid;grid-template-rows:auto auto auto;row-gap:30px;align-items:center;text-align:center;justify-content:center}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.6rem;font-weight:600;line-height:24px}.tittle1[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1rem;font-weight:400;line-height:19px}.pan[_ngcontent-%COMP%]{width:19rem;height:11.5rem}.pan[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.input[_ngcontent-%COMP%]{width:100%;height:7rem}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-top:1rem;width:98%;height:2rem;border-radius:.9rem;font-size:1rem;text-align:center}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{text-align:center;font-size:1rem;font-weight:600;color:#000}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:89%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}']});let a=n;return a})();var OO=(()=>{let n=class n{constructor(r,s,t){this.fb=r,this.router=s,this.http=t,this.bankDetails=this.fb.group({accountName:["",kr.required],accountNumber:["",kr.required],PANNumber:["",kr.required],bankName:["",kr.required],IFSC:["",kr.required],branch:["",kr.required],aadhaarNumber:532268448050})}submit(){let r="https://api.coolieno1.in/v1.0/providers/provider-finance",s=new FormData;s.append("accountName",this.bankDetails.value.accountName),s.append("providerId",localStorage.getItem("providerId")||""),s.append("aadhaarNumber",this.bankDetails.value.aadhaarNumber),s.append("accountNumber",this.bankDetails.value.accountNumber),s.append("pan",this.bankDetails.value.PANNumber),s.append("bankName",this.bankDetails.value.bankName),s.append("ifscCode",this.bankDetails.value.IFSC),s.append("branch",this.bankDetails.value.branch),this.http.post(r,s).subscribe(t=>{console.log(t),this.router.navigate(["induction"])},t=>{console.log(t),t.error.error==='E11000 duplicate key error collection: test.finances index: pan_1 dup key: { pan: "cggpc1173E" }'&&alert("Pancard is already registered")})}skip(){this.router.navigate(["induction"])}};n.\u0275fac=function(s){return new(s||n)(ge(la),ge(jt),ge(nn))},n.\u0275cmp=gt({type:n,selectors:[["app-bank-details"]],decls:50,vars:1,consts:[[1,"skip-btn",3,"click"],[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],[1,"form-main",3,"formGroup"],[1,"form-div-section"],["for","accountName"],["type","text","id","accountName","formControlName","accountName"],["for","accountNumber"],["type","number","id","accountNumber","formControlName","accountNumber"],["for","PANNumber"],["type","text","id","PANNumber","formControlName","PANNumber"],["for","bankName"],["type","text","id","bankName","formControlName","bankName"],["for","IFSC"],["type","text","id","IFSC","formControlName","IFSC"],["for","branch"],["type","text","id","branch","formControlName","branch"],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){s&1&&(V(0,"button",0),Fe("click",function(){return t.skip()}),Y(1,"skip"),j(),V(2,"div",1)(3,"div",2)(4,"span",3),Y(5,"Banking details"),j(),Ee(6,"br")(7,"br"),V(8,"div",4)(9,"form",5)(10,"div",6)(11,"fieldset")(12,"legend",7),Y(13," Account Name \xA0"),j(),Ee(14,"input",8)(15,"br"),j()(),V(16,"div",6)(17,"fieldset")(18,"legend",9),Y(19," Account Number \xA0"),j(),Ee(20,"input",10)(21,"br"),j()(),V(22,"div",6)(23,"fieldset")(24,"legend",11),Y(25," PAN Number \xA0"),j(),Ee(26,"input",12)(27,"br"),j()(),V(28,"div",6)(29,"fieldset")(30,"legend",13),Y(31," Bank name \xA0"),j(),Ee(32,"input",14)(33,"br"),j()(),V(34,"div",6)(35,"fieldset")(36,"legend",15),Y(37," IFSC \xA0"),j(),Ee(38,"input",16)(39,"br"),j()(),V(40,"div",6)(41,"fieldset")(42,"legend",17),Y(43," Branch \xA0"),j(),Ee(44,"input",18)(45,"br"),j()()()(),V(46,"button",19),Fe("click",function(){return t.submit()}),Y(47,"Submit"),j()(),Ee(48,"br")(49,"br"),j()),s&2&&(xe(9),rt("formGroup",t.bankDetails))},dependencies:[No,ho,bu,Mr,Bo,qo,Aa],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;justify-content:center;align-items:center;text-align:center}.skip-btn[_ngcontent-%COMP%]{width:max-content;height:max-content;float:right;margin:1rem;margin-bottom:0;background-color:transparent;border:none;font-family:"Inter" sans-serif;color:#00000080;font-size:16px;font-weight:400;line-height:16.94px;text-align:left}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:0%;left:0%;display:grid;grid-template-rows:max-content max-content;align-items:start;text-align:left}.tittle[_ngcontent-%COMP%]{float:left;font-family:Inter,sans-serif;font-size:1.6rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content}.form-main[_ngcontent-%COMP%]{width:90%;height:max-content;display:flex;flex-direction:column;gap:.9rem}fieldset[_ngcontent-%COMP%]{width:100%;height:2.5rem;border-radius:.5rem}fieldset[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{font-size:.9rem;font-family:Inter,sans-serif;font-weight:400;line-height:1rem;flex-shrink:0;margin-right:10px;color:#030b33b3}input[_ngcontent-%COMP%]{flex-grow:1;outline:0;border-width:0 0 0 0;border-color:#000;font-size:1.1rem;padding:5px 0}.login-btn[_ngcontent-%COMP%]{height:3rem;width:90%;font-size:1.3rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:3rem;border:none;background-color:#d16611;position:fixed;top:90%;left:5%}.mat-mdc-text-field-wrapper.mdc-text-field.mdc-text-field--filled[_ngcontent-%COMP%]{background-color:transparent;height:5rem}']});let a=n;return a})();var Wm=(()=>{let n=class n{constructor(r){this.http=r,this.apiForVideo="https://api.coolieno1.in/v1.0/admin"}getingVideos(){return this.http.get(`${this.apiForVideo}/training`)}gettingInductionVeideos(){return this.http.get(`${this.apiForVideo}/induction`)}};n.\u0275fac=function(s){return new(s||n)(Ye(nn))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var ha=(()=>{let n=class n{constructor(r){this.http=r,this.userId=localStorage.getItem("providerId"),this.userCredit=0}payWithRazorpay(r,s,t){let g={key:"rzp_test_b8XfUOQ4u8dlSq",amount:r*100,currency:t,name:"Coolie no.1",description:"Test Transaction",image:"assets/location/logo-v3 3.png",handler:M=>{console.log(M),this.addingCredit(r)},prefill:{name:"Customer Name",email:"customer@example.com",contact:"9999999999"},notes:{address:"Razorpay Corporate Office"},theme:{color:"#3399cc"},modal:{ondismiss:function(){console.log("Checkout form closed")},escape:!1,backdropclose:!1,handleback:!0}};new Razorpay(g).open()}addingCredit(r){let s="https://api.coolieno1.in/v1.0/providers/provider-credits/recharge",t={providerId:this.userId,amount:r};return this.http.post(s,t).subscribe(g=>{console.log(g),this.getNow()},g=>{console.log(g)})}getCredits(){let r=`https://api.coolieno1.in/v1.0/providers/provider-credits/${this.userId}`;return this.http.get(r)}getNow(){this.getCredits().subscribe(r=>{console.log(r),this.userCredit=r.credits},r=>{console.log(r)})}getCreditHistory(){let r=`https://api.coolieno1.in/v1.0/providers/provider-credits/${this.userId}`;return this.http.get}setDefault(){this.userId="",this.userCredit=0}};n.\u0275fac=function(s){return new(s||n)(Ye(nn))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var ks=ID(P2());var qd=(()=>{let n=class n{setonlineStatus(r,s){this.onlineStatus=r,localStorage.setItem("onlineStatus",r.toString()),localStorage.setItem("onlineText",s)}getonlineStatus(){let r=localStorage.getItem("onlineStatus"),s=localStorage.getItem("onlineText");return{status:r==="true",text:s||"Go"}}constructor(r,s){this.platformId=r,this.http=s,this.destinationInput="",this.currentLocation=[0,0],this.directionsLayerId="directions",this.userCordinates=[0,0],this.onlineStatus=!1,ks.default.accessToken="pk.eyJ1IjoiY29vbGllbm8xLWFkbWluIiwiYSI6ImNsdWZjZGR1ZzBtZHcybnJvaHBiYTd2NzMifQ.TQ6FrqUIUUWv7J7n75A3tQ"}ngOnInit(){this.initializeMap()}ngOnDestroy(){this.watchId&&navigator.geolocation.clearWatch(this.watchId)}initializeMap(){navigator.geolocation.getCurrentPosition(r=>{this.currentLocation=[r.coords.longitude,r.coords.latitude],console.log(this.currentLocation,"currect location"),this.map=new ks.default.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:this.currentLocation,zoom:12}),this.map.addControl(new ks.default.NavigationControl),this.userMarker=new ks.default.Marker({color:"blue"}).setLngLat(this.currentLocation).setPopup(new ks.default.Popup().setText("You are here")).addTo(this.map),this.watchId=navigator.geolocation.watchPosition(s=>{let t=[s.coords.longitude,s.coords.latitude];this.currentLocation=t,this.userMarker&&this.userMarker.setLngLat(t),this.userCordinates[0]!=0&&this.addDestinationMarker(this.userCordinates)},s=>{console.error("Error watching position:",s)})})}navigateToPlace(){if(!this.destinationInput){console.error("Please enter the destination address or coordinates.");return}if(/^(-?\d+(\.\d+)?),\s*(-?\d+(\.\d+)?)$/.test(this.destinationInput)){let[s,t]=this.destinationInput.split(",").map(g=>parseFloat(g.trim()));this.addDestinationMarker([s,t])}else fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(this.destinationInput)}.json?access_token=${ks.default.accessToken}`).then(s=>{if(!s.ok)throw new Error("Network response was not ok");return s.json()}).then(s=>{if(s.features.length===0)throw new Error("No results found");let t=s.features[0].geometry.coordinates;this.addDestinationMarker(t)}).catch(s=>{console.error("Error fetching destination coordinates:",s),alert("Error: Could not find the location. Please check your input.")})}addDestinationMarker(r){console.log(r),this.destinationMarker&&this.destinationMarker.remove(),this.destinationMarker=new ks.default.Marker({color:"red"}).setLngLat(r).setPopup(new ks.default.Popup().setText(this.destinationInput)).addTo(this.map),this.map.flyTo({center:r,zoom:12}),this.getDirections(r)}getDirections(r){let s=`https://api.mapbox.com/directions/v5/mapbox/driving/${this.currentLocation[0]},${this.currentLocation[1]};${r[0]},${r[1]}?alternatives=true&geometries=geojson&steps=true&access_token=${ks.default.accessToken}`;fetch(s).then(t=>{if(!t.ok)throw new Error("NoRoute");return t.json()}).then(t=>{if(console.log("Directions data:",t),t.routes.length===0)throw new Error("No routes found");this.map.getSource(this.directionsLayerId)&&(this.map.removeLayer(this.directionsLayerId),this.map.removeSource(this.directionsLayerId)),this.map.addSource(this.directionsLayerId,{type:"geojson",data:{type:"Feature",properties:{},geometry:t.routes[0].geometry}}),this.map.addLayer({id:this.directionsLayerId,type:"line",source:this.directionsLayerId,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"red","line-width":5}});let g=new ks.default.LngLatBounds;t.routes[0].geometry.coordinates.forEach(b=>{g.extend(b)}),this.map.fitBounds(g,{padding:50})}).catch(t=>{console.error("Error fetching directions:",t),alert("Error: Could not find a route.")})}getCurrentLocation(){return new Ro(r=>{navigator.geolocation.getCurrentPosition(s=>{let t=[s.coords.longitude,s.coords.latitude];console.log("current location inside getcurrent location",t),this.getPlaceNameFromCoordinates(t),r.next(t),r.complete()},s=>{r.error(s)})})}getPlaceNameFromCoordinates(r){let t=`https://api.mapbox.com/geocoding/v5/mapbox.places/${r[0]},${r[1]}.json?access_token=pk.eyJ1IjoiY29vbGllbm8xLWFkbWluIiwiYSI6ImNsdWZjZGR1ZzBtZHcybnJvaHBiYTd2NzMifQ.TQ6FrqUIUUWv7J7n75A3tQ`;return new Ro(g=>{fetch(t).then(b=>{if(!b.ok)throw console.error("Network response was not ok:",b.status,b.statusText),new Error(`Network response was not ok: ${b.status} ${b.statusText}`);return b.json()}).then(b=>{if(b.features.length===0)throw console.error("No results found:",b),new Error("No results found");let M=b.features[0].place_name;g.next(M),g.complete()}).catch(b=>{console.error("Error fetching place name:",b),g.error(b)})})}sendCordinates(r){let s="https://api.coolieno1.in/v1.0/providers/cordinates",g={providerId:localStorage.getItem("providerId"),longitude:r[0],latitude:r[1]};return console.log(g),this.http.post(s,g)}};n.\u0275fac=function(s){return new(s||n)(Ye($o),Ye(nn))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var mo=(()=>{let n=class n{constructor(r){this.http=r,this.oredrDetails=[]}getOrder(r){let s=`https://api.coolieno1.in/v1.0/users/order/category/${r}`;return this.http.get(s)}getOrderDetails(r){return this.http.get("")}accept(r){let s={orderId:r,providerId:localStorage.getItem("providerId")};return this.http.post("https://api.coolieno1.in/v1.0/users/order-history/accept-order",s)}verifyOtp(){let r="https://api.coolieno1.in/v1.0/users/order-history/verify-start-order",s={orderId:this.orderIds};return this.http.post(r,s)}verifyStartOrder(r){let s="https://api.coolieno1.in/v1.0/users/order-history/verify-start-order",t={orderHistoryId:this.orderIds,otp:r};return this.http.post(s,t)}cancelOrder(){let r="https://api.coolieno1.in/v1.0/users/order-history/cancel-order",s={orderHistoryId:this.orderIds,providerId:localStorage.getItem("providerId"),reason:"nothing"};return console.log(s),this.http.post(r,s)}completeOrder(){let r="https://api.coolieno1.in/v1.0/users/order-history/order-completed-generateotp",s={orderHistoryId:this.orderIds,providerId:localStorage.getItem("providerId")};return console.log(s),this.http.post(r,s)}verifyAfterComplete(r){let s="https://api.coolieno1.in/v1.0/users/order-history/order-completed-verify",t={orderId:this.orderIds,providerId:localStorage.getItem("providerId"),otp:r};return this.http.post(s,t)}orderHistory(){let s=`https://api.coolieno1.in/v1.0/users/order-history/${localStorage.getItem("providerId")}`;return this.http.get(s)}setDefult(){this.orderIds="",this.oredrDetails=[],this.userFullAddress=""}};n.\u0275fac=function(s){return new(s||n)(Ye(nn))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var Qv=a=>({active:a}),dl=(()=>{let n=class n{constructor(r){this.router=r,this.activeIcon="home"}ngOnInit(){this.router.events.subscribe(r=>{r instanceof Yo&&this.setActiveIcon(r.urlAfterRedirects)}),this.setActiveIcon(this.router.url)}changeColor(r,s){this.activeIcon=r,this.router.navigate([s])}setActiveIcon(r){r.includes("home")?this.activeIcon="home":r.includes("ongoing")?this.activeIcon="Services":r.includes("earnings")?this.activeIcon="Activity":r.includes("target")&&(this.activeIcon="Account")}};n.\u0275fac=function(s){return new(s||n)(ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-fotter"]],decls:25,vars:12,consts:[[1,"fottersss"],[1,"sub-fotterss",3,"click","ngClass"],[1,"material-symbols-outlined"],[1,"names"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1),Fe("click",function(){return t.changeColor("home","home")}),V(2,"i",2),Y(3,"home"),j(),Y(4," \xA0 "),V(5,"span",3),Y(6,"Home"),j()(),V(7,"div",1),Fe("click",function(){return t.changeColor("Services","ongoing")}),V(8,"i",2),Y(9,"work_history"),j(),Y(10,"\xA0 "),V(11,"span",3),Y(12,"Ongoing"),j()(),V(13,"div",1),Fe("click",function(){return t.changeColor("Activity","earnings")}),V(14,"i",2),Y(15,"payments"),j(),Y(16,"\xA0 "),V(17,"span",3),Y(18,"Earnings"),j()(),V(19,"div",1),Fe("click",function(){return t.changeColor("Account","target")}),V(20,"i",2),Y(21,"ads_click"),j(),Y(22,"\xA0 "),V(23,"span",3),Y(24,"Target"),j()()()),s&2&&(xe(),rt("ngClass",Mo(4,Qv,t.activeIcon==="home")),xe(6),rt("ngClass",Mo(6,Qv,t.activeIcon==="Services")),xe(6),rt("ngClass",Mo(8,Qv,t.activeIcon==="Activity")),xe(6),rt("ngClass",Mo(10,Qv,t.activeIcon==="Account")))},dependencies:[Qa],styles:[".fottersss[_ngcontent-%COMP%]{border:0;width:100%;display:flex;justify-content:space-around;position:fixed;bottom:0;text-align:center;padding-top:.5rem;padding-bottom:.5rem;background-color:#fff}.sub-fotterss[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{font-size:2rem;color:#00000080}.names[_ngcontent-%COMP%]{display:none}.active[_ngcontent-%COMP%]{background-color:#d16611;border-radius:25px;padding:.5rem 1rem}.active[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{color:#fff}.active[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]{display:block;color:#fff}"]});let a=n;return a})();var SU=["footer"];function MU(a,n){if(a&1&&(V(0,"div")(1,"div",25),Ee(2,"img",26),j()()),a&2){let d=n.$implicit;xe(2),rt("src",d.src,Er)}}function TU(a,n){if(a&1&&(V(0,"div")(1,"span"),Y(2),j(),V(3,"span"),Ee(4,"i",30),Y(5),j()()),a&2){let d=n.$implicit;xe(2),Rd("",d.day,", ",d.month," ",d.date,""),xe(3),bn(" ",d.isWorking,"")}}function IU(a,n){if(a&1){let d=gi();V(0,"div",27),Zt(1,TU,6,4,"div",11),V(2,"div",28),Fe("click",function(){Mt(d);let s=Et();return Tt(s.navToCal())}),V(3,"pre",29),Y(4,"calendar_today"),j()()()}if(a&2){let d=Et();xe(),rt("ngForOf",d.nextWorking)}}function EU(a,n){a&1&&(V(0,"span"),Y(1,"No more jobs today"),j())}function DU(a,n){if(a&1&&(V(0,"span"),Y(1),j()),a&2){let d=Et();xe(),bn("",d.noOfPendingOrders," more jobs today")}}function kU(a,n){if(a&1&&(V(0,"div")(1,"div",32)(2,"video",33),Ee(3,"source",34),j()()()),a&2){let d=n.$implicit,r=Et(2);xe(3),rt("src","https://"+r.bucketName+".s3."+r.region+".amazonaws.com/"+d.videoKey,Er)}}function AU(a,n){if(a&1&&(V(0,"div",31),Zt(1,kU,4,1,"div",11),j()),a&2){let d=Et();xe(),rt("ngForOf",d.data)}}var FO=(()=>{let n=class n{ngOnInit(){let r=localStorage.getItem("onlineStatus"),s=localStorage.getItem("onlineText");r!==null&&(this.online=r==="true"),s!==null&&(this.onlineText=s),this.isAccountVerify=this.logInService.isAccountVerify,this.trainingService.getingVideos().subscribe(t=>{console.log(t),this.data=t},t=>{console.log(t)})}toggleDrawer(){this.isDrawerOpen=!this.isDrawerOpen,this.router.navigate(["menu"])}navToCredit(){this.router.navigate(["credits"])}navToNotification(){this.router.navigate(["notification"])}navToCal(){this.router.navigate(["calender"])}constructor(r,s,t,g,b,M,k,L,G,J){this.router=r,this.http=s,this.trainingService=t,this.logInService=g,this.userDetailsService=b,this.jobDetailsService=M,this.razorpayService=k,this.mapboxService=L,this.orderService=G,this.dialogService=J,this.isDrawerOpen=!1,this.data=[],this.bucketName="coolie1-dev",this.region="ap-south-1",this.nextWorking=[],this.ads=[{src:"assets/demo/ad.png"},{src:"assets/demo/ad.png"},{src:"assets/demo/ad.png"},{src:"assets/documents/pancard.png"}],this.dates=[],this.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.credits=0,this.online=!1,this.onlineText="Go",this.noOfPendingOrders=0,console.log(this.nextWorking.length),this.getProviderDetails(),this.workingDates(),this.getAvalibility(),this.getWork(),this.getCredit(),this.getPendingOrders()}getProviderDetails(){return Qr(this,null,function*(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")),setTimeout(()=>{this.navToAboutUser()},2e3)})}navToAboutUser(){let r;this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")).subscribe(s=>{console.log(s),r=s,r&&(this.dialogService.openDialog("Please add the details"),this.router.navigate(["aboutUser"]))}),console.log(r)}workingDates(){this.nextWorking=this.dates.splice(0,2),console.log(this.nextWorking)}getAvalibility(){this.jobDetailsService.getAvailability().subscribe(r=>{console.log(r),this.formattingAvailbility(r)},r=>{console.log(r)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),console.log(r[0]._id),this.userDetailsService.workResponse=r[0].works,this.userDetailsService.workResponseId=r[0]._id},r=>{console.log(r)})}formattingAvailbility(r){let s=new Date;for(let t=0;t<r.length;t++){let b=r[t].date.split("T")[0],M=new Date(b),k=this.dayNames[M.getDay()],L=this.monthNames[M.getMonth()],G=M.getFullYear(),J=M.getDate();(M>=s||M.toDateString()===s.toDateString())&&(this.dates.some(be=>be.date===J&&be.day===k&&be.month===L&&be.year===G)||(this.dates.push({date:J,day:k,month:L,year:G,isWorking:"working"}),this.dates.sort((be,Me)=>{let Te=this.monthNames.indexOf(be.month),He=this.monthNames.indexOf(Me.month);if(Te===-1||He===-1)return 0;let We=new Date(be.year,Te,be.date),dt=new Date(Me.year,He,Me.date);return We.getTime()-dt.getTime()})))}this.workingDates()}getCredit(){this.razorpayService.getCredits().subscribe(r=>{console.log(r),this.razorpayService.userCredit=r.creditBalance,this.credits=r.creditBalance},r=>{console.log(r)})}onlineStatus(){try{let r=this.jobDetailsService.isVerify;if(console.log(r),!r){alert("Account is not verified...");return}this.online=!this.online,this.onlineText=this.online?"Off":"Go",this.mapboxService.onlineStatus=this.online,this.mapboxService.setonlineStatus(this.online,this.onlineText),localStorage.setItem("onlineStatus",this.online.toString()),localStorage.setItem("onlineText",this.onlineText),this.online&&this.mapboxService.getCurrentLocation().subscribe(s=>{console.log("Current Location:",s),this.sendCordinates(s),this.getname(s)},s=>{console.error("Error getting current location:",s)})}catch(r){console.error("Error in onlineStatus method:",r)}console.log(this.online)}getname(r){this.mapboxService.getPlaceNameFromCoordinates(r).subscribe(s=>{console.log("Place Name:",s),this.userDetailsService.currentCordinates=r,this.userDetailsService.currentLocation=s,this.mapboxService.placeName=s},s=>{console.error("Error getting place name:",s)})}sendCordinates(r){this.mapboxService.sendCordinates(r).subscribe(s=>{console.log(s)},s=>{console.log(s)})}sendTokens(){let r="",s={};this.http.post(r,s).subscribe(t=>{console.log(t)},t=>{console.log(t)})}getPendingOrders(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r);let s="InProgress",t=r.filter(g=>g.status.toLowerCase().includes(s.toLowerCase()));this.noOfPendingOrders=t.length},error:r=>{console.log(r)}})}};n.\u0275fac=function(s){return new(s||n)(ge(jt),ge(nn),ge(Wm),ge(tr),ge(po),ge(Hr),ge(ha),ge(qd),ge(mo),ge(ns))},n.\u0275cmp=gt({type:n,selectors:[["app-home"]],viewQuery:function(s,t){if(s&1&&ki(SU,5),s&2){let g;Ci(g=Si())&&(t.footer=g.first)}},decls:61,vars:9,consts:[[1,"container"],[1,"header"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets/logo/credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined"],[1,"sub-container"],[1,"ads-div"],[1,"wrapperrr"],[4,"ngFor","ngForOf"],[1,"sub-divs"],["class","availability-div",4,"ngIf"],[1,"new-jobs"],[1,"text-div"],[1,"icon-div"],[1,"more-jobs"],[1,"text-div1"],[1,"pending-task-div"],[1,"quick-links"],["routerLinkActive","help",1,"helps",3,"routerLink"],["id","video-div",4,"ngIf"],[1,"online",3,"click"],[2,"height","5rem"],[1,"slidesss"],[3,"src"],[1,"availability-div"],[3,"click"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"fa","fa-circle",2,"font-size","10px"],["id","video-div"],["id","video-slidess"],["controls","","id","videoss"],["type","video/mp4",3,"src"]],template:function(s,t){s&1&&(V(0,"div",0),Ee(1,"br"),V(2,"div",1)(3,"div",2),Fe("click",function(){return t.toggleDrawer()}),Y(4,"\u2630"),j(),V(5,"div",3)(6,"div",4),Fe("click",function(){return t.navToCredit()}),Ee(7,"img",5),V(8,"pre"),Y(9),j()(),V(10,"div",6),Fe("click",function(){return t.navToNotification()}),V(11,"span",7),Y(12,"notifications"),j()()()(),Ee(13,"br"),V(14,"div",8)(15,"div",9)(16,"div",10),Zt(17,MU,3,1,"div",11),j()(),V(18,"div",12),Zt(19,IU,5,1,"div",13),V(20,"div")(21,"div",14)(22,"div",15)(23,"span"),Y(24,"No new jobs"),j(),V(25,"span"),Y(26,"5 jobs missed recently"),j()(),V(27,"div",16)(28,"span",7),Y(29,"arrow_forward_ios"),j()()(),Ee(30,"br"),V(31,"div",17)(32,"div",18),Zt(33,EU,2,0,"span")(34,DU,2,1),j(),V(35,"div",16)(36,"span",7),Y(37,"arrow_forward_ios"),j()()()(),V(38,"div",19)(39,"span"),Y(40,"Pending Tasks"),j(),Ee(41,"br")(42,"br"),V(43,"p"),Y(44," 80 subscription jobs . 4days left to buy job pack now "),j(),V(45,"p"),Y(46," Only 50 credits left.Recharge credits to get new jobs "),j()(),V(47,"div",20)(48,"div")(49,"span"),Y(50,"Quick links"),j()(),V(51,"div",21)(52,"span"),Y(53,"Help?"),j()()(),Zt(54,AU,2,1,"div",22),j()()(),V(55,"div",23),Fe("click",function(){return t.onlineStatus()}),V(56,"span"),Y(57),j()(),Ee(58,"div",24)(59,"router-outlet")(60,"app-fotter")),s&2&&(Ni("overlap",t.isDrawerOpen),xe(9),zt(t.credits),xe(8),rt("ngForOf",t.ads),xe(2),rt("ngIf",t.nextWorking.length!=0),xe(14),Dr(33,t.noOfPendingOrders===0?33:34),xe(18),rt("routerLink","/help"),xe(3),rt("ngIf",t.isAccountVerify),xe(3),zt(t.onlineText))},dependencies:[Vr,jr,n0,Um,Zv,dl],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%;transition:padding-left .3s ease;margin-top:0}#drawer[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000;color:red;padding:20px;box-sizing:border-box;transition:transform .3s ease;transform:translate(-100%);z-index:2}#drawer.open[_ngcontent-%COMP%]{transform:translate(0);overlay:auto}.header[_ngcontent-%COMP%]{margin-top:0rem;width:90%;display:flex;justify-content:space-between}#menu-button[_ngcontent-%COMP%]{cursor:pointer;z-index:2;color:#d16611;font-size:24px}.list-menu[_ngcontent-%COMP%]{list-style-type:none;font-size:1rem;font-weight:400;font-family:Roboto Condensed}.bell-credit[_ngcontent-%COMP%]{width:max-content;height:2.5rem;display:flex;justify-content:space-between;gap:.5rem;border-radius:.2rem}.package[_ngcontent-%COMP%]{width:max-content;padding:0 .5rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.credit[_ngcontent-%COMP%]{width:5rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .package[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%], .package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center;border-radius:.4rem}.sub-container[_ngcontent-%COMP%]{width:95%;height:90vh;overflow-y:auto;scroll-snap-type:y;scroll-behavior:smooth;scrollbar-width:none}.sub-divs[_ngcontent-%COMP%]{margin-top:1rem;display:grid;row-gap:1.4rem}.ads-div[_ngcontent-%COMP%]{display:flex;height:7rem;width:100%}.wrapperrr[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;grid-gap:.5rem;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}.slidesss[_ngcontent-%COMP%]{width:100%;height:100%}.slidesss[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:auto;object-fit:cover}.availability-div[_ngcontent-%COMP%]{width:98%;height:max-content;display:flex;column-gap:4%;row-gap:0;align-items:center;margin-left:.5rem;justify-content:space-between}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:22px;text-align:left}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:22px;text-align:left}.new-jobs[_ngcontent-%COMP%]{width:100%;height:5rem;background-color:#d70d09;border-radius:1.3rem;color:#f5f5f5;display:flex;justify-content:space-between;align-items:center}.text-div[_ngcontent-%COMP%]{width:max-content;height:4rem;display:grid;justify-content:center;row-gap:0rem;text-align:left;align-items:center;padding-left:2rem}.text-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(1), .pending-task-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .quick-links[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .text-div1[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-size:1.4rem;font-weight:500}.text-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(2){font-family:Inter,sans-serif;font-size:.95rem;font-weight:400}.icon-div[_ngcontent-%COMP%]{width:30%;display:flex;justify-content:center;align-items:center}.more-jobs[_ngcontent-%COMP%]{width:100%;height:4rem;background-color:#d70d09;border-radius:1.3rem;color:#fff;display:flex;align-items:center;justify-content:space-between}.text-div1[_ngcontent-%COMP%]{width:max-content;height:4rem;display:grid;justify-content:center;align-items:center;padding-left:2rem}.pending-task-div[_ngcontent-%COMP%]{text-align:left}.pending-task-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:15px;font-weight:400;line-height:16.94px;letter-spacing:.05em;text-align:left}.quick-links[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.helps[_ngcontent-%COMP%]{width:6rem;height:3rem;background-color:#20193f;color:#fff;display:flex;justify-content:center;align-items:center;border-radius:1.8rem}#video-div[_ngcontent-%COMP%]{width:100%;height:10rem;display:flex;grid-gap:.5rem;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}video[_ngcontent-%COMP%]{width:100vw;height:10rem;object-fit:cover;cursor:pointer}.online[_ngcontent-%COMP%]{background-color:#d16611;width:6rem;height:6rem;border-radius:50%;position:fixed;bottom:70px;left:40%;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:500;color:#fff;overflow:hidden}.online[_ngcontent-%COMP%]:before{content:"";position:absolute;width:50%;height:50%;border:.2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_wave 1.9s ease-out infinite;pointer-events:none}@keyframes _ngcontent-%COMP%_wave{50%{transform:scale(1);width:50%;height:50%}60%{transform:scale(1.5);width:60%;height:60%}70%{transform:scale(2);width:70%;height:70%}to{transform:scale(2.5);width:100%;height:100%}}']});let a=n;return a})();var PU=a=>({active:a});function OU(a,n){if(a&1){let d=gi();V(0,"button",14),Fe("click",function(){let s=Mt(d).$implicit,t=Et();return Tt(t.setActiveButton(s))}),Y(1),j()}if(a&2){let d=n.$implicit,r=Et();rt("ngClass",Mo(2,PU,r.activeButton===d)),xe(),bn(" ",d," ")}}function RU(a,n){if(a&1&&(V(0,"div",15)(1,"span",16)(2,"span",17),Y(3),j(),V(4,"span",18),Y(5),j()(),V(6,"span",18),Y(7),j()(),Ee(8,"div",19)),a&2){let d=n.$implicit;xe(3),zt(d.date),xe(2),zt(d.details),xe(2),zt(d.amount)}}var LO=(()=>{let n=class n{navBack(){this.location.back()}navToAddCredit(){this.router.navigate(["addCredit"])}constructor(r,s,t){this.location=r,this.router=s,this.razorpayServie=t,this.buttons=["All","Recharge","Expenses","Penalties"],this.activeButton="All",this.history=[],this.filteredCreditHistory=[],this.credits=this.razorpayServie.userCredit,console.log(this.razorpayServie.userCredit),this.getCredit()}setActiveButton(r){this.activeButton=r,this.filter(this.activeButton)}getCredit(){this.razorpayServie.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.creditBalance,this.history=r.transactions,this.filteredCreditHistory=this.history},error:r=>{console.log(r)}})}filter(r){let s=this.history,t;r!="All"?(t=s.filter(g=>g.type.toLowerCase().includes(r.toLowerCase())),this.filteredCreditHistory=t):this.filteredCreditHistory=s,console.log(this.filteredCreditHistory)}};n.\u0275fac=function(s){return new(s||n)(ge(Pi),ge(jt),ge(ha))},n.\u0275cmp=gt({type:n,selectors:[["app-credit"]],decls:24,vars:2,consts:[[1,"container"],[1,"header"],[1,"arrow_back",3,"click"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"logo"],["src","assets\\documents\\credit bg.png"],[1,"credit"],[1,"credit-details"],[3,"click"],[1,"sub-container"],[1,"cat"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"content"],[1,"content-div"],[3,"click","ngClass"],[1,"sub-content-div"],[1,"span-div"],[1,"highlight"],[1,"normal-text"],[1,"line"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"div",2),Fe("click",function(){return t.navBack()}),V(3,"span",3),Y(4,"arrow_back"),j()(),V(5,"div",4),Ee(6,"img",5),j()(),V(7,"div",6)(8,"div",7)(9,"span"),Y(10,"Credit balance :"),j(),Y(11,"\xA0 "),V(12,"span"),Y(13),j()(),V(14,"div")(15,"button",8),Fe("click",function(){return t.navToAddCredit()}),Y(16,"Add+"),j()()(),V(17,"div",9)(18,"div",10),Zt(19,OU,2,4,"button",11),j(),V(20,"div",12)(21,"div",13),Cr(22,RU,9,3,null,null,xo),j()()()()),s&2&&(xe(13),zt(t.credits),xe(6),rt("ngForOf",t.buttons),xe(3),Sr(t.filteredCreditHistory))},dependencies:[Qa,Vr],styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh;align-items:center;text-align:center;display:grid;grid-template-rows:max-content max-content auto;row-gap:2rem;gap:2rem;grid-gap:2rem}.header[_ngcontent-%COMP%]{border:1px solid black;width:90%;height:10rem;display:flex;position:relative;left:5%;top:10%;border-radius:.8rem}.arrow_back[_ngcontent-%COMP%]{width:10%;position:relative;top:8%;left:2%}.logo[_ngcontent-%COMP%]{width:90%;display:flex;justify-content:center;align-items:center}.credit[_ngcontent-%COMP%]{width:90%;height:max-content;display:flex;justify-content:space-between;position:relative;left:5%}.credit-details[_ngcontent-%COMP%]{float:left;text-align:left}.credit-details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:1rem;font-family:"Inter" sans-serif;font-weight:500;line-height:1.2rem}.credit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:4rem;height:2rem;background-color:#5ba36b;color:#fff;border:none;border-radius:.6rem}.sub-container[_ngcontent-%COMP%]{width:90%;height:70vh;position:relative;left:5%}.cat[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px;border-bottom:2px solid transparent;cursor:pointer}.cat[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-bottom:2px solid #f40905}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:border-bottom .3s}.content[_ngcontent-%COMP%]{width:100%;margin-top:.8rem}.content-div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-content-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.span-div[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.highlight[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:16.94px;text-align:left}.normal-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:14.52px;text-align:left}.line[_ngcontent-%COMP%]{margin-top:.5rem;border:none;border-bottom:.25px solid black}']});let a=n;return a})();function FU(a,n){a&1&&(V(0,"span"),Y(1,"Name"),j())}function LU(a,n){if(a&1&&(V(0,"span"),Y(1),j()),a&2){let d=Et();xe(),zt(d.userName)}}function zU(a,n){if(a&1){let d=gi();Ee(0,"br"),V(1,"div",12),Fe("click",function(){let s=Mt(d).$implicit,t=Et();return Tt(t.navTo(s.name))}),V(2,"div",12),Fe("click",function(){let s=Mt(d).$implicit,t=Et();return Tt(t.navTo(s.name))}),V(3,"span",11),Y(4),j(),Y(5," \xA0 \xA0 "),V(6,"span"),Y(7),j()(),V(8,"span",11),Y(9,"arrow_forward_ios"),j()(),Ee(10,"hr")}if(a&2){let d=n.$implicit;xe(4),zt(d.icon),xe(3),zt(d.name)}}var zO=(()=>{let n=class n{constructor(r,s,t,g,b,M,k){this.location=r,this.router=s,this.loginService=t,this.jobDetailsService=g,this.ordersService=b,this.razorpayService=M,this.userDetals=k,this.userName="",this.userImage="",this.whatsAppStaus="on",this.options=[{icon:"calendar_today",name:"Calendar"},{icon:"work",name:"Job History"},{icon:"poker_chip",name:"Credits"},{icon:"tv_gen",name:"Tranning"},{icon:"featured_seasonal_and_gifts",name:"Invite a friend"},{icon:"question_mark",name:"Help Center"},{icon:"emoji_events",name:"Certificate & documents"}]}ngOnInit(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")),this.getUsername()}getUsername(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r)},complete:()=>{this.userName=this.jobDetailsService.userDetails?.providerName,this.userImage=this.jobDetailsService.userDetails?.image,console.log(this.jobDetailsService.userDetails),console.log(this.userName),this.apiSubscription?.unsubscribe()}})}navTo(r){switch(console.log(r),r){case"Calendar":this.router.navigate(["calender"]);break;case"Job History":this.router.navigate(["jobHistory"]);break;case"Credits":console.log("inside"),this.router.navigate(["credits"]);break;case"Tranning":this.router.navigate(["training"]);break;case"Invite a friend":this.router.navigate(["referAndEarn"]);break;case"Help Center":this.router.navigate(["help"]);break;case"Certificate & documents":this.router.navigate(["awards"]);break;case"packages":this.router.navigate(["packages"]);break;default:console.log("No matching case found")}}navToFinancial(){this.router.navigate(["financialDetails"])}navBack(){this.location.back()}navToVisiting(){this.router.navigate(["visitingCard"])}logOut(){this.jobDetailsService.setDefault(),this.loginService.setDefult(),this.ordersService.setDefult(),this.razorpayService.setDefault(),this.userDetals.setDefult(),this.loginService.removeUser(),this.router.navigate(["selectAccount"])}statusChange(){this.whatsAppStaus==="on"?this.whatsAppStaus="off":(this.whatsAppStaus="off")&&(this.whatsAppStaus="on")}};n.\u0275fac=function(s){return new(s||n)(ge(Pi),ge(jt),ge(tr),ge(Hr),ge(mo),ge(ha),ge(po))},n.\u0275cmp=gt({type:n,selectors:[["app-menu"]],decls:66,vars:4,consts:[[1,"material-symbols-outlined",3,"click"],[1,"container"],[1,"sub-container"],[1,"profile"],[1,"image"],[1,"profile-img",3,"src"],[1,"details"],[1,"details-div"],[1,"package",3,"click"],["src","assets/packages/silver coin 1.png",1,"package-img"],[1,"rating"],[1,"material-symbols-outlined"],[3,"click"],[1,"category"],[1,"updates"],[1,"finacial",3,"click"],[1,"iconss"],[1,"finacial"],[1,"fa","fa-whatsapp"],["routerLinkActive","language",1,"finacial",3,"routerLink"],[1,"btn",3,"click"]],template:function(s,t){s&1&&(Ee(0,"br")(1,"br"),Y(2,"\xA0\xA0 \xA0"),V(3,"span",0),Fe("click",function(){return t.navBack()}),Y(4,"arrow_back"),j(),Ee(5,"br")(6,"br"),V(7,"div",1)(8,"div",2)(9,"div",3)(10,"div",4),Ee(11,"img",5),j(),V(12,"div",6)(13,"div",7),Zt(14,FU,2,0,"span")(15,LU,2,1),V(16,"span",8),Fe("click",function(){return t.navTo("packages")}),Ee(17,"img",9),Y(18,"\xA0 "),V(19,"pre"),Y(20,"Silver"),j()()(),V(21,"div",10)(22,"span",11),Y(23,"star"),j(),Y(24," 4.89"),j(),V(25,"button",12),Fe("click",function(){return t.navToVisiting()}),Y(26,"View more"),j()()(),Ee(27,"br"),V(28,"div",13),Cr(29,zU,11,2,null,null,xo),j(),Ee(31,"br"),V(32,"div",14)(33,"div",15),Fe("click",function(){return t.navToFinancial()}),V(34,"div",16)(35,"span",11),Y(36,"currency_rupee"),j()(),V(37,"div")(38,"span"),Y(39,"Financial details"),j(),Ee(40,"br"),Y(41," GST,PAN and bank information "),j()(),V(42,"div",17)(43,"div",16),Ee(44,"span",18),j(),V(45,"div")(46,"span"),Y(47,"Send whatsApp updates"),j(),Ee(48,"br"),V(49,"span",12),Fe("click",function(){return t.statusChange()}),Y(50),j()()(),V(51,"div",19)(52,"div",16)(53,"span",11),Y(54,"g_translate"),j()(),V(55,"div")(56,"span"),Y(57,"Change language"),j(),Ee(58,"br"),Y(59," English "),j()()(),Ee(60,"br"),V(61,"div",20),Fe("click",function(){return t.logOut()}),V(62,"button")(63,"span",11),Y(64,"power_settings_new"),j(),Y(65,"\xA0 Logout"),j()()()()),s&2&&(xe(11),rt("src",t.userImage?t.userImage:"assets/logo/profile.png",Er),xe(3),Dr(14,t.userName===""?14:15),xe(15),Sr(t.options),xe(21),zt(t.whatsAppStaus),xe(),rt("routerLink","/language"))},dependencies:[Um,Zv],styles:['.container[_ngcontent-%COMP%]{width:90%;height:100vh;padding:1rem}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;left:5%}.profile[_ngcontent-%COMP%]{width:100%;height:9rem;display:flex;align-items:center;justify-content:space-evenly;border:.25px solid black;border-radius:.5rem}.image[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.profile-img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.details[_ngcontent-%COMP%]{width:70%;display:flex;flex-direction:column;text-align:left;gap:.5rem}.details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.5rem;font-family:"Inter" sans-serif;font-weight:500}.details-div[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.package[_ngcontent-%COMP%]{width:max-content;height:2rem;padding:0 .3rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.package-img[_ngcontent-%COMP%]{width:1.3rem;height:1.3rem}.package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1rem;line-height:1.7rem}.details[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:18px;border:none;background-color:transparent;width:max-content;border-bottom:2px solid black;display:flex;align-items:center}.rating[_ngcontent-%COMP%]{display:flex;width:max-content;height:max-content;align-items:center}.category[_ngcontent-%COMP%]{width:100%}.category[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.category[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .finacial[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:500}.updates[_ngcontent-%COMP%]{border:.25px solid black;width:100%;height:11.5rem;border-radius:.5rem;display:flex;flex-direction:column;align-items:center;justify-content:center}.finacial[_ngcontent-%COMP%]{display:flex;width:100%;height:3.2rem}.iconss[_ngcontent-%COMP%]{width:20%;display:flex;justify-content:center;align-items:center;text-align:center}.iconss[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px}.btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:18px;border:none;background-color:transparent;display:flex;align-items:center}.btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;color:red}']});let a=n;return a})();function BU(a,n){a&1&&(V(0,"span"),Y(1,"Name"),j())}function NU(a,n){if(a&1&&(V(0,"span"),Y(1),j()),a&2){let d=Et();xe(),zt(d.userName)}}function VU(a,n){if(a&1&&(V(0,"span"),Y(1),j()),a&2){let d=n.$implicit;xe(),bn(" ",d.nameOfService," ")}}var BO=(()=>{let n=class n{constructor(r,s,t,g,b){this.router=r,this.location=s,this.jobDetailsService=t,this.logInService=g,this.userService=b,this.userImage="",this.userName="",this.userId=localStorage.getItem("providerId"),this.workSeleceted=this.jobDetailsService.userDetails.work,this.certificateImages=[{images:"assets/demo/awards.png"},{images:"assets/demo/certificate2.png"}]}ngOnInit(){this.signingDetails(),this.getWork(),this.getCertificates()}signingDetails(){this.phoneNumber=this.jobDetailsService.userDetails?.phone,this.userName=this.jobDetailsService.userDetails?.providerName,this.userImage=this.jobDetailsService.userDetails?.image}getWork(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r[0].works},r=>{console.log(r)})}getCertificates(){let r=localStorage.getItem("providerId");this.userService.getCertificated(r).subscribe({next:s=>{console.log(s);let t=[];for(let g=0;g<s.length;g++){let b=s[g];t.push({images:b.image})}this.certificateImages=t},error:s=>{console.log(s)},complete:()=>{this.apiSubscription?.unsubscribe()}})}navTo(){this.router.navigate(["selectWork"])}navToBack(){this.location.back()}navToVerification(){this.logInService.isAccountVerify?this.router.navigate(["identityVerification"]):this.router.navigate(["aadharVerify"])}navToCertificates(){this.router.navigate(["awards"])}};n.\u0275fac=function(s){return new(s||n)(ge(jt),ge(Pi),ge(Hr),ge(tr),ge(po))},n.\u0275cmp=gt({type:n,selectors:[["app-visiting-card"]],decls:66,vars:7,consts:[[1,"container"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"sub-container"],[1,"profile"],[1,"image"],["alt","User Image",3,"src"],[1,"details"],[1,"rating"],[4,"ngFor","ngForOf"],[1,"category"],[1,"ids"],[1,"tittle"],[1,"ids",3,"click"],[3,"click"],[1,"tittle2"],[1,"material-symbols-outlined"],[1,"awards-div"],[1,"awards"],[3,"src"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"span",1),Fe("click",function(){return t.navToBack()}),Y(2,"arrow_back"),j(),Ee(3,"br"),V(4,"div",2)(5,"div",3)(6,"div",4),Ee(7,"img",5),j(),V(8,"div",6),Zt(9,BU,2,0,"span")(10,NU,2,1),V(11,"div",7),Y(12," \u2605 4.89 "),j(),Zt(13,VU,2,1,"span",8),j()(),V(14,"div",9)(15,"div")(16,"div",10)(17,"span",11),Y(18,"My Id"),j(),V(19,"span",11),Y(20),j()(),Ee(21,"hr"),j(),V(22,"div")(23,"div",12),Fe("click",function(){return t.navTo()}),V(24,"span",11),Y(25,"Add new service"),j(),V(26,"span",11),Y(27,"+"),j()(),Ee(28,"hr"),j(),V(29,"div")(30,"div",10)(31,"div",13),Fe("click",function(){return t.navToVerification()}),V(32,"span",11),Y(33,"Identity verification"),j(),Ee(34,"br"),V(35,"span",14),Y(36,"Identity Proof and Personal details"),j()(),V(37,"span",15),Y(38,"arrow_forward_ios"),j()()()(),V(39,"div",16)(40,"span"),Y(41,"Award and certificate "),j(),V(42,"div",17)(43,"div"),Ee(44,"img",18),j(),V(45,"div"),Ee(46,"img",18),j()(),V(47,"span",13),Fe("click",function(){return t.navToCertificates()}),Y(48,"View More"),j()(),V(49,"div",16)(50,"span"),Y(51,"Contact Details"),j(),V(52,"div"),Ee(53,"hr"),j(),V(54,"div")(55,"pre"),Y(56,"Phone"),j(),V(57,"span"),Y(58),j()(),V(59,"div")(60,"pre"),Y(61,"Email"),j(),V(62,"span"),Y(63,"abcdgmail.com"),j()()()()(),Ee(64,"br")(65,"br")),s&2&&(xe(7),rt("src",t.userImage?t.userImage:"assets/logo/profile.png",Er),xe(2),Dr(9,t.userName===""?9:10),xe(4),rt("ngForOf",t.workSeleceted),xe(7),zt(t.userId),xe(24),rt("src",t.certificateImages[0].images,Er),xe(2),rt("src",t.certificateImages[0].images,Er),xe(12),zt(t.phoneNumber))},dependencies:[Vr],styles:['.container[_ngcontent-%COMP%]{width:100%;margin-bottom:3rem}.material-symbols-outlined[_ngcontent-%COMP%]{margin:1rem}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;left:5%;display:grid;row-gap:2rem}.profile[_ngcontent-%COMP%]{width:100%;height:8rem;display:flex;align-items:center;justify-content:space-evenly;border:.25px solid black;border-radius:.5rem}.image[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.profile[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.details[_ngcontent-%COMP%]{width:70%;height:5rem}.details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:500}.rating[_ngcontent-%COMP%]{display:flex;width:max-content;height:1.3rem;align-items:center;text-align:left}.category[_ngcontent-%COMP%]{width:100%;padding:.5rem;display:flex;flex-direction:column;gap:.8rem}.work-names[_ngcontent-%COMP%]{border:1px solid red;width:100%;display:flex;flex-direction:row}.ids[_ngcontent-%COMP%]{width:100%;height:max-content;display:flex;justify-content:space-between;margin-top:.5rem;margin-bottom:.5rem}.tittle[_ngcontent-%COMP%], .awards-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter"sans-serif;font-weight:500}.tittle2[_ngcontent-%COMP%], pre[_ngcontent-%COMP%]{font-size:1rem;font-family:"Inter"sans-serif;font-weight:400}.awards-div[_ngcontent-%COMP%]{display:grid;row-gap:1rem;border:.25px solid black;border-radius:.5rem;padding:1rem}.awards[_ngcontent-%COMP%]{width:100%;border:1px solid black;display:flex;justify-content:space-between}.awards[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:48%;height:141px}.awards[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}hr[_ngcontent-%COMP%]{color:#000}']});let a=n;return a})();var NO=(()=>{let n=class n{navToBack(){this.location.back()}constructor(r){this.location=r}};n.\u0275fac=function(s){return new(s||n)(ge(Pi))},n.\u0275cmp=gt({type:n,selectors:[["app-refer-and-earn"]],decls:54,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"refer-div"],[1,"refer"],[1,"tittle1"],["src","assets\\documents\\invite.png"],[1,"dot"],[1,"line"],[1,"links"],["src","assets\\logo\\whatsup.png"],[1,"material-symbols-outlined"],[1,"how"],[1,"steps-div"],[1,"steps"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return t.navToBack()}),Y(3,"arrow_back"),j(),Y(4,"\xA0 "),V(5,"span",3),Y(6,"Refer and Earn"),j()(),V(7,"div",4)(8,"div",5)(9,"div",6)(10,"div")(11,"span",7),Y(12,"Refer and get FREE services "),j(),V(13,"p"),Y(14,"Invite your to our company off.You win \u20B9 500 once they take services.They get instant \u20B9 500 "),j()(),V(15,"div"),Ee(16,"img",8),j()(),V(17,"div",9),Ee(18,"div",10),V(19,"span"),Y(20,"Refer via"),j(),Ee(21,"div",10),j(),V(22,"div",11)(23,"div"),Ee(24,"img",12)(25,"br"),V(26,"span"),Y(27,"Whatsapp"),j()(),V(28,"div")(29,"span",13),Y(30,"link"),j(),Ee(31,"br"),V(32,"span"),Y(33,"Link"),j()()()(),V(34,"div",14)(35,"span",7),Y(36,"How it works?"),j(),Ee(37,"br"),V(38,"div",15)(39,"div",16)(40,"div"),Y(41,"1"),j(),V(42,"span"),Y(43,"Invite your friends & get rewarded"),j()(),V(44,"div",16)(45,"div"),Y(46,"2"),j(),V(47,"span"),Y(48,"They get free service on first order"),j()(),V(49,"div",16)(50,"div"),Y(51,"3"),j(),V(52,"span"),Y(53,"You get reward once their service is completed"),j()()()()()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-rows:auto auto auto;row-gap:30px;align-items:center;text-align:center;justify-content:center}.tittle[_ngcontent-%COMP%]{float:left;font-family:inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:24px}.refer-div[_ngcontent-%COMP%]{border:.25px solid black;border-radius:.5rem}.refer[_ngcontent-%COMP%]{padding:1rem;width:90%;height:max-content;display:flex;border-radius:.4rem}.refer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:92px;height:92px}.dot[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto max-content auto}.dot[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1rem;font-weight:500;line-height:14.52px}.line[_ngcontent-%COMP%]{margin-top:8px;border:none;border-top:1.2px dashed rgb(91,90,90)}.links[_ngcontent-%COMP%]{display:flex;justify-content:space-around;padding:1rem}.tittle1[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:500;line-height:24px}.how[_ngcontent-%COMP%]{width:90%;height:max-content;padding:1rem;border:.25px solid black;border-radius:.5rem;display:grid;text-align:left}.how[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.steps-div[_ngcontent-%COMP%]{display:grid;row-gap:1.5rem}.steps[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background-color:#49a010;color:#fff;align-items:center}.steps[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:80%}']});let a=n;return a})();function jU(a,n){a&1&&(V(0,"div",13)(1,"span"),Y(2,"+"),j(),V(3,"span"),Y(4,"Add Photo"),j()())}function UU(a,n){if(a&1&&Ee(0,"img",14),a&2){let d=Et();rt("src",d.imagePreview,Er)}}function HU(a,n){a&1&&(V(0,"div",13)(1,"span"),Y(2,"+"),j(),V(3,"span"),Y(4,"Add Documents"),j()())}function WU(a,n){if(a&1&&Ee(0,"img",14),a&2){let d=Et();rt("src",d.documentPreview,Er)}}function GU(a,n){if(a&1&&(V(0,"div",12),Ee(1,"img",15),j()),a&2){let d=n.$implicit;xe(),rt("src",d.image,Er)}}var VO=(()=>{let n=class n{navToBack(){this.location.back()}constructor(r,s,t,g){this.location=r,this.http=s,this.fb=t,this.userDetalsService=g,this.items=[],this.bucketName="coolie1-dev",this.region="ap-south-1",this.userId=localStorage.getItem("providerId"),this.selectedFile=null,this.selectedDocument=null,this.base64Image=null,this.imagePreview=null,this.documentPreview=null,this.getCertificates(),this.imageForm=this.fb.group({image:"",user:this.userId,isverified:!1}),console.log(this.items)}onFileSelected(r){let s=r.target;if(s.files&&s.files.length>0){this.selectedFile=s.files[0],this.imagePreview=s.files[0];let t=s.files[0],g=new FileReader;g.onload=()=>{this.imagePreview=g.result},g.readAsDataURL(this.selectedFile),console.log("image",this.imagePreview),this.imageForm.value.image=t}this.sending()}onDocumentSelected(r){let s=r.target;if(s.files&&s.files.length>0){this.selectedDocument=s.files[0],this.imagePreview=s.files[0];let t=s.files[0],g=new FileReader;g.onload=()=>{this.imagePreview=g.result},g.readAsDataURL(this.selectedDocument),console.log("image",this.imagePreview),this.imageForm.value.image=t}this.sending()}sending(){console.log("sending doc");let r=new FormData;r.append("image",this.imageForm.value.image),r.append("isVerified",this.imageForm.value.isverified),r.append("providerId",this.imageForm.value.user),this.http.post("https://api.coolieno1.in/v1.0/providers/provider-certificate",r).subscribe({next:t=>{console.log(t),this.getCertificates()},error:t=>{console.log(t)}})}getCertificates(){this.userDetalsService.getCertificated(this.userId).subscribe({next:r=>{console.log(r),this.items=r,console.log(this.items[0].image)},error:r=>{console.log(r)},complete:()=>{this.apiSubscription?.unsubscribe()}})}};n.\u0275fac=function(s){return new(s||n)(ge(Pi),ge(nn),ge(la),ge(po))},n.\u0275cmp=gt({type:n,selectors:[["app-awards"]],decls:22,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"addPhoto"],["for","file-input",1,"file-label"],["class","placeholder-image",4,"ngIf"],["alt","Selected image","class","preview-image",3,"src",4,"ngIf"],[3,"formGroup"],["type","file","id","file-input","required","",1,"file-input",3,"change"],["type","file","id","document-inputs","required","",1,"file-input",3,"change"],[1,"awards"],[1,"placeholder-image"],["alt","Selected image",1,"preview-image",3,"src"],["alt","Image from AWS S3",3,"src"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return t.navToBack()}),Y(3,"arrow_back"),j(),Y(4,"\xA0\xA0 "),V(5,"span",3),Y(6,"Certificate and Documents"),j()(),V(7,"div",4)(8,"div",5)(9,"label",6),Zt(10,jU,5,0,"div",7)(11,UU,1,1,"img",8),j(),V(12,"form",9)(13,"input",10),Fe("change",function(b){return t.onFileSelected(b)}),j()()(),V(14,"div",5)(15,"label",6),Zt(16,HU,5,0,"div",7)(17,WU,1,1,"img",8),j(),V(18,"form",9)(19,"input",11),Fe("change",function(b){return t.onDocumentSelected(b)}),j()()(),Cr(20,GU,2,1,"div",12,xo),j()()),s&2&&(xe(10),rt("ngIf",!t.selectedFile),xe(),rt("ngIf",t.selectedFile),xe(),rt("formGroup",t.imageForm),xe(4),rt("ngIf",!t.selectedDocument),xe(),rt("ngIf",t.selectedDocument),xe(),rt("formGroup",t.imageForm),xe(2),Sr(t.items))},dependencies:[jr,No,Bo,qo],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-columns:auto auto;row-gap:30px;column-gap:30px;align-items:center;text-align:center;justify-content:space-around}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:24px}.addPhoto[_ngcontent-%COMP%]{width:8.5rem;height:8rem;display:grid;align-items:center;border:1px dashed black}span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:600;line-height:19px}.awards[_ngcontent-%COMP%]{width:8.5rem;height:8rem}.awards[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.file-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:60%;cursor:pointer;position:relative}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.placeholder-image[_ngcontent-%COMP%]{display:grid;row-gap:1rem}.preview-image[_ngcontent-%COMP%]{width:10rem;height:8rem}']});let a=n;return a})();var jO=(()=>{let n=class n{navToBack(){this.location.back()}constructor(r){this.location=r}};n.\u0275fac=function(s){return new(s||n)(ge(Pi))},n.\u0275cmp=gt({type:n,selectors:[["app-helps"]],decls:41,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"tittle1"],[1,"topics"],[1,"material-symbols-outlined"],[1,"namee"],[1,"line"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return t.navToBack()}),Y(3,"arrow_back"),j(),Ee(4,"br")(5,"br"),Y(6," \xA0 "),V(7,"span",3),Y(8,"How can we help you?"),j()(),V(9,"div",4)(10,"span",5),Y(11,"All Topics"),j(),V(12,"div",6)(13,"div")(14,"span",7),Y(15,"person"),j(),Y(16," \xA0"),V(17,"span",8),Y(18,"Account"),j()(),V(19,"span",7),Y(20,"chevron_right"),j()(),Ee(21,"div",9),V(22,"div",6)(23,"div")(24,"span",7),Y(25,"credit_card"),j(),Y(26," \xA0"),V(27,"span",8),Y(28,"Payments & credits"),j()(),V(29,"span",7),Y(30,"chevron_right"),j()(),Ee(31,"div",9),V(32,"div",6)(33,"div")(34,"span",7),Y(35,"verified_user"),j(),Y(36," \xA0"),V(37,"span",8),Y(38,"Safety"),j()(),V(39,"span",7),Y(40,"chevron_right"),j()()()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-rows:auto auto auto;row-gap:30px}.tittle[_ngcontent-%COMP%]{float:left;font-family:Inter,sans-serif;font-size:1.4rem;font-weight:600;line-height:24px}.tittle1[_ngcontent-%COMP%]{float:left;text-align:left;font-family:Inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:19px}.topics[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.topics[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex}.namee[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.4rem;font-weight:400;line-height:1.4rem}.line[_ngcontent-%COMP%]{border:none;border-top:1px dashed rgb(101,99,99)}']});let a=n;return a})();var $U=["path"],qU=Math.PI/180,YU=(()=>{let n=class n{constructor(r){this.supportsSvg=!!(r&&r.createElementNS&&r.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect),this.base=r&&r.head.querySelector("base"),this.hasPerf=typeof window<"u"&&window.performance&&window.performance.now&&typeof window.performance.now()=="number"}resolveColor(r){if(this.base&&this.base.href){let s=r.indexOf("#");if(s>-1&&r.indexOf("url")>-1)return r.slice(0,s)+location.href+r.slice(s)}return r}getTimestamp(){return this.hasPerf?window.performance.now():Date.now()}getArc(r,s,t,g,b=!1){let M=Math.max(0,Math.min(r||0,s)),k=b?180:359.9999,L=s===0?k:M/s*k,G=this._polarToCartesian(g,t,L),J=this._polarToCartesian(g,t,0),oe=L<=180?0:1;return`M ${G} A ${t} ${t} 0 ${oe} 0 ${J}`}_polarToCartesian(r,s,t){let g=(t-90)*qU,b=r+s*Math.cos(g),M=r+s*Math.sin(g);return b+" "+M}};n.\u0275fac=function(s){return new(s||n)(Ye(Ai,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),UO={radius:125,animation:"easeOutCubic",animationDelay:void 0,duration:500,stroke:15,color:"#45CCCE",background:"#EAEAEA",responsive:!1,clockwise:!0,semicircle:!1,rounded:!1},HO=new Qt("ROUND_PROGRESS_DEFAULTS",{providedIn:"root",factory:()=>UO}),ZU={provide:HO,useValue:UO},XU=(()=>{let n=class n{linearEase(r,s,t,g){return t*r/g+s}easeInQuad(r,s,t,g){return t*(r/=g)*r+s}easeOutQuad(r,s,t,g){return-t*(r/=g)*(r-2)+s}easeInOutQuad(r,s,t,g){return(r/=g/2)<1?t/2*r*r+s:-t/2*(--r*(r-2)-1)+s}easeInCubic(r,s,t,g){return t*(r/=g)*r*r+s}easeOutCubic(r,s,t,g){return t*((r=r/g-1)*r*r+1)+s}easeInOutCubic(r,s,t,g){return(r/=g/2)<1?t/2*r*r*r+s:t/2*((r-=2)*r*r+2)+s}easeInQuart(r,s,t,g){return t*(r/=g)*r*r*r+s}easeOutQuart(r,s,t,g){return-t*((r=r/g-1)*r*r*r-1)+s}easeInOutQuart(r,s,t,g){return(r/=g/2)<1?t/2*r*r*r*r+s:-t/2*((r-=2)*r*r*r-2)+s}easeInQuint(r,s,t,g){return t*(r/=g)*r*r*r*r+s}easeOutQuint(r,s,t,g){return t*((r=r/g-1)*r*r*r*r+1)+s}easeInOutQuint(r,s,t,g){return(r/=g/2)<1?t/2*r*r*r*r*r+s:t/2*((r-=2)*r*r*r*r+2)+s}easeInSine(r,s,t,g){return-t*Math.cos(r/g*(Math.PI/2))+t+s}easeOutSine(r,s,t,g){return t*Math.sin(r/g*(Math.PI/2))+s}easeInOutSine(r,s,t,g){return-t/2*(Math.cos(Math.PI*r/g)-1)+s}easeInExpo(r,s,t,g){return r===0?s:t*Math.pow(2,10*(r/g-1))+s}easeOutExpo(r,s,t,g){return r===g?s+t:t*(-Math.pow(2,-10*r/g)+1)+s}easeInOutExpo(r,s,t,g){return r===0?s:r===g?s+t:(r/=g/2)<1?t/2*Math.pow(2,10*(r-1))+s:t/2*(-Math.pow(2,-10*--r)+2)+s}easeInCirc(r,s,t,g){return-t*(Math.sqrt(1-(r/=g)*r)-1)+s}easeOutCirc(r,s,t,g){return t*Math.sqrt(1-(r=r/g-1)*r)+s}easeInOutCirc(r,s,t,g){return(r/=g/2)<1?-t/2*(Math.sqrt(1-r*r)-1)+s:t/2*(Math.sqrt(1-(r-=2)*r)+1)+s}easeInElastic(r,s,t,g){let b=g*.3,M=1.70158,k=t;return r===0?s:(r/=g)===1?s+t:(k<Math.abs(t)?(k=t,M=b/4):M=b/(2*Math.PI)*Math.asin(t/k),-(k*Math.pow(2,10*r--)*Math.sin((r*g-M)*(2*Math.PI)/b))+s)}easeOutElastic(r,s,t,g){let b=g*.3,M=1.70158,k=t;return r===0?s:(r/=g)===1?s+t:(k<Math.abs(t)?(k=t,M=b/4):M=b/(2*Math.PI)*Math.asin(t/k),k*Math.pow(2,-10*r)*Math.sin((r*g-M)*(2*Math.PI)/b)+t+s)}easeInOutElastic(r,s,t,g){let b=g*.44999999999999996,M=1.70158,k=t;return r===0?s:(r/=g/2)===2?s+t:(k<Math.abs(t)?(k=t,M=b/4):M=b/(2*Math.PI)*Math.asin(t/k),r<1?-.5*(k*Math.pow(2,10*(r-=1))*Math.sin((r*g-M)*(2*Math.PI)/b))+s:k*Math.pow(2,-10*(r-=1))*Math.sin((r*g-M)*(2*Math.PI)/b)*.5+t+s)}easeInBack(r,s,t,g,b=1.70158){return t*(r/=g)*r*((b+1)*r-b)+s}easeOutBack(r,s,t,g,b=1.70158){return t*((r=r/g-1)*r*((b+1)*r+b)+1)+s}easeInOutBack(r,s,t,g,b=1.70158){return(r/=g/2)<1?t/2*(r*r*(((b*=1.525)+1)*r-b))+s:t/2*((r-=2)*r*(((b*=1.525)+1)*r+b)+2)+s}easeInBounce(r,s,t,g){return t-this.easeOutBounce(g-r,0,t,g)+s}easeOutBounce(r,s,t,g){return(r/=g)<1/2.75?t*(7.5625*r*r)+s:r<2/2.75?t*(7.5625*(r-=1.5/2.75)*r+.75)+s:r<2.5/2.75?t*(7.5625*(r-=2.25/2.75)*r+.9375)+s:t*(7.5625*(r-=2.625/2.75)*r+.984375)+s}easeInOutBounce(r,s,t,g){return r<g/2?this.easeInBounce(r*2,0,t,g)*.5+s:this.easeOutBounce(r*2-g,0,t,g)*.5+t*.5+s}};n.\u0275fac=function(s){return new(s||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})(),ex=(()=>{let n=class n{constructor(r,s,t,g){this.service=r,this.easing=s,this.defaults=t,this.ngZone=g,this.currentLinecap="",this.current=0,this.max=0,this.radius=this.defaults.radius,this.animation=this.defaults.animation,this.animationDelay=this.defaults.animationDelay,this.duration=this.defaults.duration,this.stroke=this.defaults.stroke,this.color=this.defaults.color,this.background=this.defaults.background,this.responsive=this.defaults.responsive,this.clockwise=this.defaults.clockwise,this.semicircle=this.defaults.semicircle,this.rounded=this.defaults.rounded,this.onRender=new Ii,this.lastAnimationId=0}_animateChange(r,s){typeof r!="number"&&(r=0),s=this._clamp(s),r=this._clamp(r);let t=this,g=s-r,b=t.duration;t.ngZone.runOutsideAngular(()=>{let M=()=>{let k=t.service.getTimestamp(),L=++t.lastAnimationId;requestAnimationFrame(function G(){let J=Math.min(t.service.getTimestamp()-k,b),oe=t.easing[t.animation],be=oe(J,r,g,b);t._updatePath(be),t.onRender.observers.length>0&&t.onRender.emit(be),L===t.lastAnimationId&&J<b&&requestAnimationFrame(G)})};this.animationDelay>0?setTimeout(M,this.animationDelay):M()})}_updatePath(r){if(this.path){let s=this.service.getArc(r,this.max,this.radius-this.stroke/2,this.radius,this.semicircle),t=this.path.nativeElement,g=this.rounded&&r>0?"round":"";g!==this.currentLinecap&&(this.currentLinecap=g,t.style.strokeLinecap=g),t.setAttribute("d",s)}}_clamp(r){return Math.max(0,Math.min(r||0,this.max))}getPathTransform(){let r=this._getDiameter();return this.semicircle?this.clockwise?`translate(0, ${r}) rotate(-90)`:`translate(${r+","+r}) rotate(90) scale(-1, 1)`:this.clockwise?null:`scale(-1, 1) translate(-${r} 0)`}resolveColor(r){return this.service.resolveColor(r)}ngOnChanges(r){r.current?this._animateChange(r.current.previousValue,r.current.currentValue):this._updatePath(this.current)}_getDiameter(){return this.radius*2}_getElementHeight(){return this.responsive?null:(this.semicircle?this.radius:this._getDiameter())+"px"}_getViewBox(){let r=this._getDiameter();return`0 0 ${r} ${this.semicircle?this.radius:r}`}_getPaddingBottom(){return this.responsive?this.semicircle?"50%":"100%":null}};n.\u0275fac=function(s){return new(s||n)(ge(YU),ge(XU),ge(HO),ge(di))},n.\u0275cmp=gt({type:n,selectors:[["round-progress"]],viewQuery:function(s,t){if(s&1&&ki($U,5),s&2){let g;Ci(g=Si())&&(t.path=g.first)}},hostAttrs:["role","progressbar"],hostVars:11,hostBindings:function(s,t){s&2&&(hn("aria-valuemin",0)("aria-valuemax",t.max)("aria-valuenow",t.current),Ka("width",t.responsive?"":t._getDiameter()+"px")("height",t._getElementHeight())("padding-bottom",t._getPaddingBottom()),Ni("responsive",t.responsive))},inputs:{current:"current",max:"max",radius:"radius",animation:"animation",animationDelay:"animationDelay",duration:"duration",stroke:"stroke",color:"color",background:"background",responsive:"responsive",clockwise:"clockwise",semicircle:"semicircle",rounded:"rounded"},outputs:{onRender:"onRender"},standalone:!0,features:[ar,Bn],decls:4,vars:13,consts:[["path",""],["xmlns","http://www.w3.org/2000/svg"],["fill","none"]],template:function(s,t){s&1&&(kd(),V(0,"svg",1),Ee(1,"circle",2)(2,"path",2,0),j()),s&2&&(hn("viewBox",t._getViewBox()),xe(),Ka("stroke",t.resolveColor(t.background))("stroke-width",t.stroke),hn("cx",t.radius)("cy",t.radius)("r",t.radius-t.stroke/2),xe(),Ka("stroke-width",t.stroke)("stroke",t.resolveColor(t.color)),hn("transform",t.getPathTransform()))},styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden}.responsive[_nghost-%COMP%]{width:100%;padding-bottom:100%}.responsive[_nghost-%COMP%] > svg[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0}"],changeDetection:0});let a=n;return a})(),WO=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({providers:[ZU]});let a=n;return a})();var $O=a=>({color:a}),qO=(()=>{let n=class n{constructor(r,s,t){this.http=r,this.router=s,this.razorpayService=t,this.enteredValue=0,this.maxValue=5,this.minTarget=0,this.min=80,this.divColor="black",this.creditBalance=50,this.isDrawerOpen=!1,this.current=0,this.max=5,this.radius=150,this.semicircle=!0,this.color="black",this.background="#eaeaea",this.cancelRate=0,this.workingHours=0,this.credits=0,this.colorChange(),this.getTarget(),this.credits=this.razorpayService.userCredit}colorChange(){this.minTarget<this.min&&(this.divColor="red")}calculateProgress(r,s){let t=r+5;return s===0?0:t/s*100}toggleDrawer(){this.isDrawerOpen=!this.isDrawerOpen,this.router.navigate(["menu"])}increment(r=1){this.current+=r}getOverlayStyle(){let r=this.semicircle,s=(r?"":"translateY(-50%) ")+"translateX(-50%)";return{top:r?"auto":"50%",bottom:r?"5%":"auto",left:"50%",transform:s,"font-size":this.radius/3.5+"px"}}getTarget(){let s=`https://api.coolieno1.in/v1.0/providers/service-provider-targets/${localStorage.getItem("providerId")}`;this.http.get(s).subscribe(t=>{console.log(t),this.current=t.specialRating,this.minTarget=t.responseRate,this.cancelRate=t.cancellationRate,this.workingHours=t.totalWorkingHours},t=>{console.log(t)})}navTo(r){switch(r){case"credit":this.router.navigate(["credits"]);break;case"notification":this.router.navigate(["notification"]);break;case"buyNow":this.router.navigate(["addCredit"])}}};n.\u0275fac=function(s){return new(s||n)(ge(nn),ge(jt),ge(ha))},n.\u0275cmp=gt({type:n,selectors:[["app-target"]],decls:70,vars:21,consts:[[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined"],[1,"sub-container"],[1,"container-target"],[1,"progress-wrapper"],[1,"current",3,"ngStyle"],[3,"current","max","color","background","radius","semicircle","rounded","stroke"],[1,"progress-content"],[1,"fa","fa-star"],[1,"section-div"],[1,"section"],[1,"info"],[1,"sub-info"],[1,"material-symbols-outlined",3,"ngStyle"],[2,"font-size","1.4rem",3,"ngStyle"],[1,"material-symbols-outlined",2,"color","red","font-size","28px"],[1,"credit-balance-div"],[3,"click"],[2,"height","10rem"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1),Fe("click",function(){return t.toggleDrawer()}),Y(2,"\u2630"),j(),V(3,"div",2)(4,"div",3),Fe("click",function(){return t.navTo("credit")}),Ee(5,"img",4),V(6,"pre"),Y(7),j()(),V(8,"div",5),Fe("click",function(){return t.navTo("notification")}),V(9,"span",6),Y(10,"notifications"),j()()(),V(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10),Y(15),j(),Ee(16,"round-progress",11),V(17,"div",12),Ee(18,"br"),V(19,"div"),Ee(20,"span",13),V(21,"span"),Y(22,"Min : 4.7"),j()()()()(),V(23,"div",14)(24,"div",15)(25,"span",6),Y(26,"schedule"),j(),Ee(27,"br")(28,"br"),V(29,"span",16),Y(30),j(),Ee(31,"br"),V(32,"span",17),Y(33,"Weekend hours"),j()(),V(34,"div",15)(35,"span",18),Y(36,"draft"),j(),Y(37," \xA0"),V(38,"span",19),Y(39,"Min:80%"),j(),Ee(40,"br")(41,"br"),V(42,"span",16),Y(43),j(),Ee(44,"br"),V(45,"span",17),Y(46,"Response rate"),j()(),V(47,"div",15)(48,"span",20),Y(49,"privacy_tip"),j(),Ee(50,"br")(51,"br"),V(52,"span",16),Y(53),j(),Ee(54,"br"),V(55,"span",17),Y(56,"Cancellation"),j()()(),Ee(57,"br"),V(58,"div",21)(59,"span",17),Y(60),j(),Ee(61,"br")(62,"br"),V(63,"div")(64,"button",22),Fe("click",function(){return t.navTo("buyNow")}),Y(65,"Buy now"),j(),V(66,"button"),Y(67,"See details"),j()()()()(),Ee(68,"div",23)(69,"app-fotter")),s&2&&(xe(7),zt(t.credits),xe(7),rt("ngStyle",t.getOverlayStyle()),xe(),bn("",t.current,"%"),xe(),rt("current",t.current)("max",t.max)("color",t.color)("background",t.background)("radius",t.radius)("semicircle",t.semicircle)("rounded",!0)("stroke",20),xe(14),bn("",t.workingHours," HRS"),xe(5),rt("ngStyle",Mo(17,$O,t.divColor)),xe(3),rt("ngStyle",Mo(19,$O,t.divColor)),xe(5),bn("",t.minTarget,"%"),xe(10),zt(t.cancelRate),xe(7),bn("Credit Balance ",t.credits,""))},dependencies:[nk,ex,dl],styles:['.left-half-spinner-container[_ngcontent-%COMP%]{position:relative;width:100px;height:100px;overflow:hidden;transform:rotate(90deg)}.left-half-spinner-container[_ngcontent-%COMP%]   .mat-progress-spinner[_ngcontent-%COMP%]{width:100px;height:100px}.left-half-spinner-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;right:0;width:50%;height:100%;background:#fff;z-index:1}.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%;margin-bottom:5rem}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#000;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:9rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:6rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border:1px solid black;width:2.3rem;border-radius:.4rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh}.section-div[_ngcontent-%COMP%]{display:grid;grid-template-columns:45% 45%;column-gap:2%;width:100%;height:max-content;justify-content:space-around}.section[_ngcontent-%COMP%]{border:.25px solid black;border-radius:.4rem;height:7rem;margin-top:2rem;padding:2rem 1rem 1rem;text-align:left}.info[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:600;line-height:19.36px}.sub-info[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:16.94px}.credit-balance-div[_ngcontent-%COMP%]{width:88%;height:5.5rem;border:.25px solid black;text-align:left;padding:1rem;padding-left:6%;border-radius:.8rem}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:max-content;height:2rem;display:flex;align-items:center;justify-content:center;font-family:"Inter" sans-serif;font-size:14px;font-weight:500;line-height:16.94px;border-radius:.5rem}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#3cc04b;color:#fff;border:none}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:transparent;border:.25 solid black}.credit-balance-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%;display:grid;grid-template-columns:auto auto;column-gap:1rem}cf[_ngcontent-%COMP%]:before, .cf[_ngcontent-%COMP%]:after{content:" ";display:table}.cf[_ngcontent-%COMP%]:after{clear:both}.progress-wrapper[_ngcontent-%COMP%]{position:relative;margin:20px auto;font-size:40px}.current[_ngcontent-%COMP%]{position:absolute;color:#bbb;font-weight:100;line-height:1}round-progress[_ngcontent-%COMP%]{margin:auto}.container-target[_ngcontent-%COMP%]{width:80%;max-width:650px;margin:40px auto 80px;text-align:center;padding:40px;background:#fff;border:solid 1px #ccc;border-radius:4px}button[_ngcontent-%COMP%]{display:inline-block;padding:10px 20px;background:#45ccce;color:#fff;font-size:16px;border:none;cursor:pointer;border-radius:4px;text-align:center;margin:0 5px 5px 0}button[_ngcontent-%COMP%]:nth-child(2){color:#000;border:.25px solid black;border-radius:4px;display:inline-block;text-align:center}form[_ngcontent-%COMP%]{text-align:left;max-width:350px;margin:30px auto}form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:15px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{float:right;padding:5px;width:150px}input[type=checkbox][_ngcontent-%COMP%]{width:auto}input[type=color][_ngcontent-%COMP%]{height:30px}.back[_ngcontent-%COMP%]{position:fixed;top:5px;right:5px}.progress-container[_ngcontent-%COMP%]   round-progress[_ngcontent-%COMP%]{position:relative;z-index:1}.progress-content[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(-50%,-50%);text-align:center;font-size:1.1rem;font-weight:400;line-height:1.2;z-index:2}.progress-content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;top:.5rem;display:flex;flex-direction:column}@media (max-width: 650px){.back[_ngcontent-%COMP%]{position:static;display:block;text-align:center}h2[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]{margin-bottom:20px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;margin-top:5px;float:none}.container-target[_ngcontent-%COMP%]{margin:0 auto 50px;padding:25px}}']});let a=n;return a})();function h0(a){return a+.5|0}var Yd=(a,n,d)=>Math.max(Math.min(a,d),n);function c0(a){return Yd(h0(a*2.55),0,255)}function Zd(a){return Yd(h0(a*255),0,255)}function cc(a){return Yd(h0(a/2.55)/100,0,1)}function YO(a){return Yd(h0(a*100),0,100)}var os={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},R2=[..."0123456789ABCDEF"],KU=a=>R2[a&15],QU=a=>R2[(a&240)>>4]+R2[a&15],tx=a=>(a&240)>>4===(a&15),JU=a=>tx(a.r)&&tx(a.g)&&tx(a.b)&&tx(a.a);function e8(a){var n=a.length,d;return a[0]==="#"&&(n===4||n===5?d={r:255&os[a[1]]*17,g:255&os[a[2]]*17,b:255&os[a[3]]*17,a:n===5?os[a[4]]*17:255}:(n===7||n===9)&&(d={r:os[a[1]]<<4|os[a[2]],g:os[a[3]]<<4|os[a[4]],b:os[a[5]]<<4|os[a[6]],a:n===9?os[a[7]]<<4|os[a[8]]:255})),d}var t8=(a,n)=>a<255?n(a):"";function i8(a){var n=JU(a)?KU:QU;return a?"#"+n(a.r)+n(a.g)+n(a.b)+t8(a.a,n):void 0}var n8=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function QO(a,n,d){let r=n*Math.min(d,1-d),s=(t,g=(t+a/30)%12)=>d-r*Math.max(Math.min(g-3,9-g,1),-1);return[s(0),s(8),s(4)]}function r8(a,n,d){let r=(s,t=(s+a/60)%6)=>d-d*n*Math.max(Math.min(t,4-t,1),0);return[r(5),r(3),r(1)]}function o8(a,n,d){let r=QO(a,1,.5),s;for(n+d>1&&(s=1/(n+d),n*=s,d*=s),s=0;s<3;s++)r[s]*=1-n-d,r[s]+=n;return r}function a8(a,n,d,r,s){return a===s?(n-d)/r+(n<d?6:0):n===s?(d-a)/r+2:(a-n)/r+4}function F2(a){let d=a.r/255,r=a.g/255,s=a.b/255,t=Math.max(d,r,s),g=Math.min(d,r,s),b=(t+g)/2,M,k,L;return t!==g&&(L=t-g,k=b>.5?L/(2-t-g):L/(t+g),M=a8(d,r,s,L,t),M=M*60+.5),[M|0,k||0,b]}function L2(a,n,d,r){return(Array.isArray(n)?a(n[0],n[1],n[2]):a(n,d,r)).map(Zd)}function z2(a,n,d){return L2(QO,a,n,d)}function s8(a,n,d){return L2(o8,a,n,d)}function l8(a,n,d){return L2(r8,a,n,d)}function JO(a){return(a%360+360)%360}function c8(a){let n=n8.exec(a),d=255,r;if(!n)return;n[5]!==r&&(d=n[6]?c0(+n[5]):Zd(+n[5]));let s=JO(+n[2]),t=+n[3]/100,g=+n[4]/100;return n[1]==="hwb"?r=s8(s,t,g):n[1]==="hsv"?r=l8(s,t,g):r=z2(s,t,g),{r:r[0],g:r[1],b:r[2],a:d}}function d8(a,n){var d=F2(a);d[0]=JO(d[0]+n),d=z2(d),a.r=d[0],a.g=d[1],a.b=d[2]}function h8(a){if(!a)return;let n=F2(a),d=n[0],r=YO(n[1]),s=YO(n[2]);return a.a<255?`hsla(${d}, ${r}%, ${s}%, ${cc(a.a)})`:`hsl(${d}, ${r}%, ${s}%)`}var ZO={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},XO={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function u8(){let a={},n=Object.keys(XO),d=Object.keys(ZO),r,s,t,g,b;for(r=0;r<n.length;r++){for(g=b=n[r],s=0;s<d.length;s++)t=d[s],b=b.replace(t,ZO[t]);t=parseInt(XO[g],16),a[b]=[t>>16&255,t>>8&255,t&255]}return a}var ix;function p8(a){ix||(ix=u8(),ix.transparent=[0,0,0,0]);let n=ix[a.toLowerCase()];return n&&{r:n[0],g:n[1],b:n[2],a:n.length===4?n[3]:255}}var m8=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function f8(a){let n=m8.exec(a),d=255,r,s,t;if(n){if(n[7]!==r){let g=+n[7];d=n[8]?c0(g):Yd(g*255,0,255)}return r=+n[1],s=+n[3],t=+n[5],r=255&(n[2]?c0(r):Yd(r,0,255)),s=255&(n[4]?c0(s):Yd(s,0,255)),t=255&(n[6]?c0(t):Yd(t,0,255)),{r,g:s,b:t,a:d}}}function g8(a){return a&&(a.a<255?`rgba(${a.r}, ${a.g}, ${a.b}, ${cc(a.a)})`:`rgb(${a.r}, ${a.g}, ${a.b})`)}var O2=a=>a<=.0031308?a*12.92:Math.pow(a,1/2.4)*1.055-.055,Gm=a=>a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4);function _8(a,n,d){let r=Gm(cc(a.r)),s=Gm(cc(a.g)),t=Gm(cc(a.b));return{r:Zd(O2(r+d*(Gm(cc(n.r))-r))),g:Zd(O2(s+d*(Gm(cc(n.g))-s))),b:Zd(O2(t+d*(Gm(cc(n.b))-t))),a:a.a+d*(n.a-a.a)}}function nx(a,n,d){if(a){let r=F2(a);r[n]=Math.max(0,Math.min(r[n]+r[n]*d,n===0?360:1)),r=z2(r),a.r=r[0],a.g=r[1],a.b=r[2]}}function eR(a,n){return a&&Object.assign(n||{},a)}function KO(a){var n={r:0,g:0,b:0,a:255};return Array.isArray(a)?a.length>=3&&(n={r:a[0],g:a[1],b:a[2],a:255},a.length>3&&(n.a=Zd(a[3]))):(n=eR(a,{r:0,g:0,b:0,a:1}),n.a=Zd(n.a)),n}function y8(a){return a.charAt(0)==="r"?f8(a):c8(a)}var d0=class a{constructor(n){if(n instanceof a)return n;let d=typeof n,r;d==="object"?r=KO(n):d==="string"&&(r=e8(n)||p8(n)||y8(n)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var n=eR(this._rgb);return n&&(n.a=cc(n.a)),n}set rgb(n){this._rgb=KO(n)}rgbString(){return this._valid?g8(this._rgb):void 0}hexString(){return this._valid?i8(this._rgb):void 0}hslString(){return this._valid?h8(this._rgb):void 0}mix(n,d){if(n){let r=this.rgb,s=n.rgb,t,g=d===t?.5:d,b=2*g-1,M=r.a-s.a,k=((b*M===-1?b:(b+M)/(1+b*M))+1)/2;t=1-k,r.r=255&k*r.r+t*s.r+.5,r.g=255&k*r.g+t*s.g+.5,r.b=255&k*r.b+t*s.b+.5,r.a=g*r.a+(1-g)*s.a,this.rgb=r}return this}interpolate(n,d){return n&&(this._rgb=_8(this._rgb,n._rgb,d)),this}clone(){return new a(this.rgb)}alpha(n){return this._rgb.a=Zd(n),this}clearer(n){let d=this._rgb;return d.a*=1-n,this}greyscale(){let n=this._rgb,d=h0(n.r*.3+n.g*.59+n.b*.11);return n.r=n.g=n.b=d,this}opaquer(n){let d=this._rgb;return d.a*=1+n,this}negate(){let n=this._rgb;return n.r=255-n.r,n.g=255-n.g,n.b=255-n.b,this}lighten(n){return nx(this._rgb,2,n),this}darken(n){return nx(this._rgb,2,-n),this}saturate(n){return nx(this._rgb,1,n),this}desaturate(n){return nx(this._rgb,1,-n),this}rotate(n){return d8(this._rgb,n),this}};function pl(){}var hR=(()=>{let a=0;return()=>a++})();function Sn(a){return a===null||typeof a>"u"}function ir(a){if(Array.isArray&&Array.isArray(a))return!0;let n=Object.prototype.toString.call(a);return n.slice(0,7)==="[object"&&n.slice(-6)==="Array]"}function fn(a){return a!==null&&Object.prototype.toString.call(a)==="[object Object]"}function yr(a){return(typeof a=="number"||a instanceof Number)&&isFinite(+a)}function pa(a,n){return yr(a)?a:n}function en(a,n){return typeof a>"u"?n:a}var uR=(a,n)=>typeof a=="string"&&a.endsWith("%")?parseFloat(a)/100:+a/n,j2=(a,n)=>typeof a=="string"&&a.endsWith("%")?parseFloat(a)/100*n:+a;function Yn(a,n,d){if(a&&typeof a.call=="function")return a.apply(d,n)}function Vn(a,n,d,r){let s,t,g;if(ir(a))if(t=a.length,r)for(s=t-1;s>=0;s--)n.call(d,a[s],s);else for(s=0;s<t;s++)n.call(d,a[s],s);else if(fn(a))for(g=Object.keys(a),t=g.length,s=0;s<t;s++)n.call(d,a[g[s]],g[s])}function m0(a,n){let d,r,s,t;if(!a||!n||a.length!==n.length)return!1;for(d=0,r=a.length;d<r;++d)if(s=a[d],t=n[d],s.datasetIndex!==t.datasetIndex||s.index!==t.index)return!1;return!0}function sx(a){if(ir(a))return a.map(sx);if(fn(a)){let n=Object.create(null),d=Object.keys(a),r=d.length,s=0;for(;s<r;++s)n[d[s]]=sx(a[d[s]]);return n}return a}function pR(a){return["__proto__","prototype","constructor"].indexOf(a)===-1}function b8(a,n,d,r){if(!pR(a))return;let s=n[a],t=d[a];fn(s)&&fn(t)?qm(s,t,r):n[a]=sx(t)}function qm(a,n,d){let r=ir(n)?n:[n],s=r.length;if(!fn(a))return a;d=d||{};let t=d.merger||b8,g;for(let b=0;b<s;++b){if(g=r[b],!fn(g))continue;let M=Object.keys(g);for(let k=0,L=M.length;k<L;++k)t(M[k],a,g,d)}return a}function Zm(a,n){return qm(a,n,{merger:v8})}function v8(a,n,d){if(!pR(a))return;let r=n[a],s=d[a];fn(r)&&fn(s)?Zm(r,s):Object.prototype.hasOwnProperty.call(n,a)||(n[a]=sx(s))}var tR={"":a=>a,x:a=>a.x,y:a=>a.y};function x8(a){let n=a.split("."),d=[],r="";for(let s of n)r+=s,r.endsWith("\\")?r=r.slice(0,-1)+".":(d.push(r),r="");return d}function w8(a){let n=x8(a);return d=>{for(let r of n){if(r==="")break;d=d&&d[r]}return d}}function uc(a,n){return(tR[n]||(tR[n]=w8(n)))(a)}function hx(a){return a.charAt(0).toUpperCase()+a.slice(1)}var Xm=a=>typeof a<"u",dc=a=>typeof a=="function",U2=(a,n)=>{if(a.size!==n.size)return!1;for(let d of a)if(!n.has(d))return!1;return!0};function mR(a){return a.type==="mouseup"||a.type==="click"||a.type==="contextmenu"}var nr=Math.PI,rr=2*nr,C8=rr+nr,lx=Number.POSITIVE_INFINITY,S8=nr/180,Tr=nr/2,Pu=nr/4,iR=nr*2/3,hc=Math.log10,As=Math.sign;function Km(a,n,d){return Math.abs(a-n)<d}function H2(a){let n=Math.round(a);a=Km(a,n,a/1e3)?n:a;let d=Math.pow(10,Math.floor(hc(a))),r=a/d;return(r<=1?1:r<=2?2:r<=5?5:10)*d}function fR(a){let n=[],d=Math.sqrt(a),r;for(r=1;r<d;r++)a%r===0&&(n.push(r),n.push(a/r));return d===(d|0)&&n.push(d),n.sort((s,t)=>s-t).pop(),n}function Fu(a){return!isNaN(parseFloat(a))&&isFinite(a)}function gR(a,n){let d=Math.round(a);return d-n<=a&&d+n>=a}function W2(a,n,d){let r,s,t;for(r=0,s=a.length;r<s;r++)t=a[r][d],isNaN(t)||(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t))}function as(a){return a*(nr/180)}function ux(a){return a*(180/nr)}function G2(a){if(!yr(a))return;let n=1,d=0;for(;Math.round(a*n)/n!==a;)n*=10,d++;return d}function $2(a,n){let d=n.x-a.x,r=n.y-a.y,s=Math.sqrt(d*d+r*r),t=Math.atan2(r,d);return t<-.5*nr&&(t+=rr),{angle:t,distance:s}}function cx(a,n){return Math.sqrt(Math.pow(n.x-a.x,2)+Math.pow(n.y-a.y,2))}function M8(a,n){return(a-n+C8)%rr-nr}function ua(a){return(a%rr+rr)%rr}function Qm(a,n,d,r){let s=ua(a),t=ua(n),g=ua(d),b=ua(t-s),M=ua(g-s),k=ua(s-t),L=ua(s-g);return s===t||s===g||r&&t===g||b>M&&k<L}function Jr(a,n,d){return Math.max(n,Math.min(d,a))}function _R(a){return Jr(a,-32768,32767)}function ml(a,n,d,r=1e-6){return a>=Math.min(n,d)-r&&a<=Math.max(n,d)+r}function px(a,n,d){d=d||(g=>a[g]<n);let r=a.length-1,s=0,t;for(;r-s>1;)t=s+r>>1,d(t)?s=t:r=t;return{lo:s,hi:r}}var hl=(a,n,d,r)=>px(a,d,r?s=>{let t=a[s][n];return t<d||t===d&&a[s+1][n]===d}:s=>a[s][n]<d),yR=(a,n,d)=>px(a,d,r=>a[r][n]>=d);function bR(a,n,d){let r=0,s=a.length;for(;r<s&&a[r]<n;)r++;for(;s>r&&a[s-1]>d;)s--;return r>0||s<a.length?a.slice(r,s):a}var vR=["push","pop","shift","splice","unshift"];function xR(a,n){if(a._chartjs){a._chartjs.listeners.push(n);return}Object.defineProperty(a,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[n]}}),vR.forEach(d=>{let r="_onData"+hx(d),s=a[d];Object.defineProperty(a,d,{configurable:!0,enumerable:!1,value(...t){let g=s.apply(this,t);return a._chartjs.listeners.forEach(b=>{typeof b[r]=="function"&&b[r](...t)}),g}})})}function q2(a,n){let d=a._chartjs;if(!d)return;let r=d.listeners,s=r.indexOf(n);s!==-1&&r.splice(s,1),!(r.length>0)&&(vR.forEach(t=>{delete a[t]}),delete a._chartjs)}function Y2(a){let n=new Set(a);return n.size===a.length?a:Array.from(n)}var Z2=function(){return typeof window>"u"?function(a){return a()}:window.requestAnimationFrame}();function X2(a,n){let d=[],r=!1;return function(...s){d=s,r||(r=!0,Z2.call(window,()=>{r=!1,a.apply(n,d)}))}}function wR(a,n){let d;return function(...r){return n?(clearTimeout(d),d=setTimeout(a,n,r)):a.apply(this,r),n}}var mx=a=>a==="start"?"left":a==="end"?"right":"center",To=(a,n,d)=>a==="start"?n:a==="end"?d:(n+d)/2,CR=(a,n,d,r)=>a===(r?"left":"right")?d:a==="center"?(n+d)/2:n;function K2(a,n,d){let r=n.length,s=0,t=r;if(a._sorted){let{iScale:g,_parsed:b}=a,M=g.axis,{min:k,max:L,minDefined:G,maxDefined:J}=g.getUserBounds();G&&(s=Jr(Math.min(hl(b,M,k).lo,d?r:hl(n,M,g.getPixelForValue(k)).lo),0,r-1)),J?t=Jr(Math.max(hl(b,g.axis,L,!0).hi+1,d?0:hl(n,M,g.getPixelForValue(L),!0).hi+1),s,r)-s:t=r-s}return{start:s,count:t}}function Q2(a){let{xScale:n,yScale:d,_scaleRanges:r}=a,s={xmin:n.min,xmax:n.max,ymin:d.min,ymax:d.max};if(!r)return a._scaleRanges=s,!0;let t=r.xmin!==n.min||r.xmax!==n.max||r.ymin!==d.min||r.ymax!==d.max;return Object.assign(r,s),t}var rx=a=>a===0||a===1,nR=(a,n,d)=>-(Math.pow(2,10*(a-=1))*Math.sin((a-n)*rr/d)),rR=(a,n,d)=>Math.pow(2,-10*a)*Math.sin((a-n)*rr/d)+1,$m={linear:a=>a,easeInQuad:a=>a*a,easeOutQuad:a=>-a*(a-2),easeInOutQuad:a=>(a/=.5)<1?.5*a*a:-.5*(--a*(a-2)-1),easeInCubic:a=>a*a*a,easeOutCubic:a=>(a-=1)*a*a+1,easeInOutCubic:a=>(a/=.5)<1?.5*a*a*a:.5*((a-=2)*a*a+2),easeInQuart:a=>a*a*a*a,easeOutQuart:a=>-((a-=1)*a*a*a-1),easeInOutQuart:a=>(a/=.5)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2),easeInQuint:a=>a*a*a*a*a,easeOutQuint:a=>(a-=1)*a*a*a*a+1,easeInOutQuint:a=>(a/=.5)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2),easeInSine:a=>-Math.cos(a*Tr)+1,easeOutSine:a=>Math.sin(a*Tr),easeInOutSine:a=>-.5*(Math.cos(nr*a)-1),easeInExpo:a=>a===0?0:Math.pow(2,10*(a-1)),easeOutExpo:a=>a===1?1:-Math.pow(2,-10*a)+1,easeInOutExpo:a=>rx(a)?a:a<.5?.5*Math.pow(2,10*(a*2-1)):.5*(-Math.pow(2,-10*(a*2-1))+2),easeInCirc:a=>a>=1?a:-(Math.sqrt(1-a*a)-1),easeOutCirc:a=>Math.sqrt(1-(a-=1)*a),easeInOutCirc:a=>(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1),easeInElastic:a=>rx(a)?a:nR(a,.075,.3),easeOutElastic:a=>rx(a)?a:rR(a,.075,.3),easeInOutElastic(a){return rx(a)?a:a<.5?.5*nR(a*2,.1125,.45):.5+.5*rR(a*2-1,.1125,.45)},easeInBack(a){return a*a*((1.70158+1)*a-1.70158)},easeOutBack(a){return(a-=1)*a*((1.70158+1)*a+1.70158)+1},easeInOutBack(a){let n=1.70158;return(a/=.5)<1?.5*(a*a*(((n*=1.525)+1)*a-n)):.5*((a-=2)*a*(((n*=1.525)+1)*a+n)+2)},easeInBounce:a=>1-$m.easeOutBounce(1-a),easeOutBounce(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},easeInOutBounce:a=>a<.5?$m.easeInBounce(a*2)*.5:$m.easeOutBounce(a*2-1)*.5+.5};function J2(a){if(a&&typeof a=="object"){let n=a.toString();return n==="[object CanvasPattern]"||n==="[object CanvasGradient]"}return!1}function eM(a){return J2(a)?a:new d0(a)}function B2(a){return J2(a)?a:new d0(a).saturate(.5).darken(.1).hexString()}var T8=["x","y","borderWidth","radius","tension"],I8=["color","borderColor","backgroundColor"];function E8(a){a.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),a.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:n=>n!=="onProgress"&&n!=="onComplete"&&n!=="fn"}),a.set("animations",{colors:{type:"color",properties:I8},numbers:{type:"number",properties:T8}}),a.describe("animations",{_fallback:"animation"}),a.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:n=>n|0}}}})}function D8(a){a.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}var oR=new Map;function k8(a,n){n=n||{};let d=a+JSON.stringify(n),r=oR.get(d);return r||(r=new Intl.NumberFormat(a,n),oR.set(d,r)),r}function Jm(a,n,d){return k8(n,d).format(a)}var SR={values(a){return ir(a)?a:""+a},numeric(a,n,d){if(a===0)return"0";let r=this.chart.options.locale,s,t=a;if(d.length>1){let k=Math.max(Math.abs(d[0].value),Math.abs(d[d.length-1].value));(k<1e-4||k>1e15)&&(s="scientific"),t=A8(a,d)}let g=hc(Math.abs(t)),b=isNaN(g)?1:Math.max(Math.min(-1*Math.floor(g),20),0),M={notation:s,minimumFractionDigits:b,maximumFractionDigits:b};return Object.assign(M,this.options.ticks.format),Jm(a,r,M)},logarithmic(a,n,d){if(a===0)return"0";let r=d[n].significand||a/Math.pow(10,Math.floor(hc(a)));return[1,2,3,5,10,15].includes(r)||n>.8*d.length?SR.numeric.call(this,a,n,d):""}};function A8(a,n){let d=n.length>3?n[2].value-n[1].value:n[1].value-n[0].value;return Math.abs(d)>=1&&a!==Math.floor(a)&&(d=a-Math.floor(a)),d}var f0={formatters:SR};function P8(a){a.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(n,d)=>d.lineWidth,tickColor:(n,d)=>d.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:f0.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),a.route("scale.ticks","color","","color"),a.route("scale.grid","color","","borderColor"),a.route("scale.border","color","","borderColor"),a.route("scale.title","color","","color"),a.describe("scale",{_fallback:!1,_scriptable:n=>!n.startsWith("before")&&!n.startsWith("after")&&n!=="callback"&&n!=="parser",_indexable:n=>n!=="borderDash"&&n!=="tickBorderDash"&&n!=="dash"}),a.describe("scales",{_fallback:"scale"}),a.describe("scale.ticks",{_scriptable:n=>n!=="backdropPadding"&&n!=="callback",_indexable:n=>n!=="backdropPadding"})}var Kd=Object.create(null),fx=Object.create(null);function u0(a,n){if(!n)return a;let d=n.split(".");for(let r=0,s=d.length;r<s;++r){let t=d[r];a=a[t]||(a[t]=Object.create(null))}return a}function N2(a,n,d){return typeof n=="string"?qm(u0(a,n),d):qm(u0(a,""),n)}var V2=class{constructor(n,d){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,s)=>B2(s.backgroundColor),this.hoverBorderColor=(r,s)=>B2(s.borderColor),this.hoverColor=(r,s)=>B2(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(n),this.apply(d)}set(n,d){return N2(this,n,d)}get(n){return u0(this,n)}describe(n,d){return N2(fx,n,d)}override(n,d){return N2(Kd,n,d)}route(n,d,r,s){let t=u0(this,n),g=u0(this,r),b="_"+d;Object.defineProperties(t,{[b]:{value:t[d],writable:!0},[d]:{enumerable:!0,get(){let M=this[b],k=g[s];return fn(M)?Object.assign({},k,M):en(M,k)},set(M){this[b]=M}}})}apply(n){n.forEach(d=>d(this))}},br=new V2({_scriptable:a=>!a.startsWith("on"),_indexable:a=>a!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[E8,D8,P8]);function O8(a){return!a||Sn(a.size)||Sn(a.family)?null:(a.style?a.style+" ":"")+(a.weight?a.weight+" ":"")+a.size+"px "+a.family}function p0(a,n,d,r,s){let t=n[s];return t||(t=n[s]=a.measureText(s).width,d.push(s)),t>r&&(r=t),r}function MR(a,n,d,r){r=r||{};let s=r.data=r.data||{},t=r.garbageCollect=r.garbageCollect||[];r.font!==n&&(s=r.data={},t=r.garbageCollect=[],r.font=n),a.save(),a.font=n;let g=0,b=d.length,M,k,L,G,J;for(M=0;M<b;M++)if(G=d[M],G!=null&&!ir(G))g=p0(a,s,t,g,G);else if(ir(G))for(k=0,L=G.length;k<L;k++)J=G[k],J!=null&&!ir(J)&&(g=p0(a,s,t,g,J));a.restore();let oe=t.length/2;if(oe>d.length){for(M=0;M<oe;M++)delete s[t[M]];t.splice(0,oe)}return g}function Qd(a,n,d){let r=a.currentDevicePixelRatio,s=d!==0?Math.max(d/2,.5):0;return Math.round((n-s)*r)/r+s}function tM(a,n){!n&&!a||(n=n||a.getContext("2d"),n.save(),n.resetTransform(),n.clearRect(0,0,a.width,a.height),n.restore())}function gx(a,n,d,r){iM(a,n,d,r,null)}function iM(a,n,d,r,s){let t,g,b,M,k,L,G,J,oe=n.pointStyle,be=n.rotation,Me=n.radius,Te=(be||0)*S8;if(oe&&typeof oe=="object"&&(t=oe.toString(),t==="[object HTMLImageElement]"||t==="[object HTMLCanvasElement]")){a.save(),a.translate(d,r),a.rotate(Te),a.drawImage(oe,-oe.width/2,-oe.height/2,oe.width,oe.height),a.restore();return}if(!(isNaN(Me)||Me<=0)){switch(a.beginPath(),oe){default:s?a.ellipse(d,r,s/2,Me,0,0,rr):a.arc(d,r,Me,0,rr),a.closePath();break;case"triangle":L=s?s/2:Me,a.moveTo(d+Math.sin(Te)*L,r-Math.cos(Te)*Me),Te+=iR,a.lineTo(d+Math.sin(Te)*L,r-Math.cos(Te)*Me),Te+=iR,a.lineTo(d+Math.sin(Te)*L,r-Math.cos(Te)*Me),a.closePath();break;case"rectRounded":k=Me*.516,M=Me-k,g=Math.cos(Te+Pu)*M,G=Math.cos(Te+Pu)*(s?s/2-k:M),b=Math.sin(Te+Pu)*M,J=Math.sin(Te+Pu)*(s?s/2-k:M),a.arc(d-G,r-b,k,Te-nr,Te-Tr),a.arc(d+J,r-g,k,Te-Tr,Te),a.arc(d+G,r+b,k,Te,Te+Tr),a.arc(d-J,r+g,k,Te+Tr,Te+nr),a.closePath();break;case"rect":if(!be){M=Math.SQRT1_2*Me,L=s?s/2:M,a.rect(d-L,r-M,2*L,2*M);break}Te+=Pu;case"rectRot":G=Math.cos(Te)*(s?s/2:Me),g=Math.cos(Te)*Me,b=Math.sin(Te)*Me,J=Math.sin(Te)*(s?s/2:Me),a.moveTo(d-G,r-b),a.lineTo(d+J,r-g),a.lineTo(d+G,r+b),a.lineTo(d-J,r+g),a.closePath();break;case"crossRot":Te+=Pu;case"cross":G=Math.cos(Te)*(s?s/2:Me),g=Math.cos(Te)*Me,b=Math.sin(Te)*Me,J=Math.sin(Te)*(s?s/2:Me),a.moveTo(d-G,r-b),a.lineTo(d+G,r+b),a.moveTo(d+J,r-g),a.lineTo(d-J,r+g);break;case"star":G=Math.cos(Te)*(s?s/2:Me),g=Math.cos(Te)*Me,b=Math.sin(Te)*Me,J=Math.sin(Te)*(s?s/2:Me),a.moveTo(d-G,r-b),a.lineTo(d+G,r+b),a.moveTo(d+J,r-g),a.lineTo(d-J,r+g),Te+=Pu,G=Math.cos(Te)*(s?s/2:Me),g=Math.cos(Te)*Me,b=Math.sin(Te)*Me,J=Math.sin(Te)*(s?s/2:Me),a.moveTo(d-G,r-b),a.lineTo(d+G,r+b),a.moveTo(d+J,r-g),a.lineTo(d-J,r+g);break;case"line":g=s?s/2:Math.cos(Te)*Me,b=Math.sin(Te)*Me,a.moveTo(d-g,r-b),a.lineTo(d+g,r+b);break;case"dash":a.moveTo(d,r),a.lineTo(d+Math.cos(Te)*(s?s/2:Me),r+Math.sin(Te)*Me);break;case!1:a.closePath();break}a.fill(),n.borderWidth>0&&a.stroke()}}function ul(a,n,d){return d=d||.5,!n||a&&a.x>n.left-d&&a.x<n.right+d&&a.y>n.top-d&&a.y<n.bottom+d}function g0(a,n){a.save(),a.beginPath(),a.rect(n.left,n.top,n.right-n.left,n.bottom-n.top),a.clip()}function _0(a){a.restore()}function TR(a,n,d,r,s){if(!n)return a.lineTo(d.x,d.y);if(s==="middle"){let t=(n.x+d.x)/2;a.lineTo(t,n.y),a.lineTo(t,d.y)}else s==="after"!=!!r?a.lineTo(n.x,d.y):a.lineTo(d.x,n.y);a.lineTo(d.x,d.y)}function IR(a,n,d,r){if(!n)return a.lineTo(d.x,d.y);a.bezierCurveTo(r?n.cp1x:n.cp2x,r?n.cp1y:n.cp2y,r?d.cp2x:d.cp1x,r?d.cp2y:d.cp1y,d.x,d.y)}function R8(a,n){n.translation&&a.translate(n.translation[0],n.translation[1]),Sn(n.rotation)||a.rotate(n.rotation),n.color&&(a.fillStyle=n.color),n.textAlign&&(a.textAlign=n.textAlign),n.textBaseline&&(a.textBaseline=n.textBaseline)}function F8(a,n,d,r,s){if(s.strikethrough||s.underline){let t=a.measureText(r),g=n-t.actualBoundingBoxLeft,b=n+t.actualBoundingBoxRight,M=d-t.actualBoundingBoxAscent,k=d+t.actualBoundingBoxDescent,L=s.strikethrough?(M+k)/2:k;a.strokeStyle=a.fillStyle,a.beginPath(),a.lineWidth=s.decorationWidth||2,a.moveTo(g,L),a.lineTo(b,L),a.stroke()}}function L8(a,n){let d=a.fillStyle;a.fillStyle=n.color,a.fillRect(n.left,n.top,n.width,n.height),a.fillStyle=d}function Jd(a,n,d,r,s,t={}){let g=ir(n)?n:[n],b=t.strokeWidth>0&&t.strokeColor!=="",M,k;for(a.save(),a.font=s.string,R8(a,t),M=0;M<g.length;++M)k=g[M],t.backdrop&&L8(a,t.backdrop),b&&(t.strokeColor&&(a.strokeStyle=t.strokeColor),Sn(t.strokeWidth)||(a.lineWidth=t.strokeWidth),a.strokeText(k,d,r,t.maxWidth)),a.fillText(k,d,r,t.maxWidth),F8(a,d,r,k,t),r+=Number(s.lineHeight);a.restore()}function ef(a,n){let{x:d,y:r,w:s,h:t,radius:g}=n;a.arc(d+g.topLeft,r+g.topLeft,g.topLeft,1.5*nr,nr,!0),a.lineTo(d,r+t-g.bottomLeft),a.arc(d+g.bottomLeft,r+t-g.bottomLeft,g.bottomLeft,nr,Tr,!0),a.lineTo(d+s-g.bottomRight,r+t),a.arc(d+s-g.bottomRight,r+t-g.bottomRight,g.bottomRight,Tr,0,!0),a.lineTo(d+s,r+g.topRight),a.arc(d+s-g.topRight,r+g.topRight,g.topRight,0,-Tr,!0),a.lineTo(d+g.topLeft,r)}var z8=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,B8=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function N8(a,n){let d=(""+a).match(z8);if(!d||d[1]==="normal")return n*1.2;switch(a=+d[2],d[3]){case"px":return a;case"%":a/=100;break}return n*a}var V8=a=>+a||0;function _x(a,n){let d={},r=fn(n),s=r?Object.keys(n):n,t=fn(a)?r?g=>en(a[g],a[n[g]]):g=>a[g]:()=>a;for(let g of s)d[g]=V8(t(g));return d}function nM(a){return _x(a,{top:"y",right:"x",bottom:"y",left:"x"})}function eh(a){return _x(a,["topLeft","topRight","bottomLeft","bottomRight"])}function Io(a){let n=nM(a);return n.width=n.left+n.right,n.height=n.top+n.bottom,n}function Wr(a,n){a=a||{},n=n||br.font;let d=en(a.size,n.size);typeof d=="string"&&(d=parseInt(d,10));let r=en(a.style,n.style);r&&!(""+r).match(B8)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);let s={family:en(a.family,n.family),lineHeight:N8(en(a.lineHeight,n.lineHeight),d),size:d,style:r,weight:en(a.weight,n.weight),string:""};return s.string=O8(s),s}function tf(a,n,d,r){let s=!0,t,g,b;for(t=0,g=a.length;t<g;++t)if(b=a[t],b!==void 0&&(n!==void 0&&typeof b=="function"&&(b=b(n),s=!1),d!==void 0&&ir(b)&&(b=b[d%b.length],s=!1),b!==void 0))return r&&!s&&(r.cacheable=!1),b}function ER(a,n,d){let{min:r,max:s}=a,t=j2(n,(s-r)/2),g=(b,M)=>d&&b===0?0:b+M;return{min:g(r,-Math.abs(t)),max:g(s,t)}}function pc(a,n){return Object.assign(Object.create(a),n)}function yx(a,n=[""],d,r,s=()=>a[0]){let t=d||a;typeof r>"u"&&(r=AR("_fallback",a));let g={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:a,_rootScopes:t,_fallback:r,_getTarget:s,override:b=>yx([b,...a],n,t,r)};return new Proxy(g,{deleteProperty(b,M){return delete b[M],delete b._keys,delete a[0][M],!0},get(b,M){return DR(b,M,()=>Y8(M,n,a,b))},getOwnPropertyDescriptor(b,M){return Reflect.getOwnPropertyDescriptor(b._scopes[0],M)},getPrototypeOf(){return Reflect.getPrototypeOf(a[0])},has(b,M){return sR(b).includes(M)},ownKeys(b){return sR(b)},set(b,M,k){let L=b._storage||(b._storage=s());return b[M]=L[M]=k,delete b._keys,!0}})}function Ru(a,n,d,r){let s={_cacheable:!1,_proxy:a,_context:n,_subProxy:d,_stack:new Set,_descriptors:rM(a,r),setContext:t=>Ru(a,t,d,r),override:t=>Ru(a.override(t),n,d,r)};return new Proxy(s,{deleteProperty(t,g){return delete t[g],delete a[g],!0},get(t,g,b){return DR(t,g,()=>U8(t,g,b))},getOwnPropertyDescriptor(t,g){return t._descriptors.allKeys?Reflect.has(a,g)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(a,g)},getPrototypeOf(){return Reflect.getPrototypeOf(a)},has(t,g){return Reflect.has(a,g)},ownKeys(){return Reflect.ownKeys(a)},set(t,g,b){return a[g]=b,delete t[g],!0}})}function rM(a,n={scriptable:!0,indexable:!0}){let{_scriptable:d=n.scriptable,_indexable:r=n.indexable,_allKeys:s=n.allKeys}=a;return{allKeys:s,scriptable:d,indexable:r,isScriptable:dc(d)?d:()=>d,isIndexable:dc(r)?r:()=>r}}var j8=(a,n)=>a?a+hx(n):n,oM=(a,n)=>fn(n)&&a!=="adapters"&&(Object.getPrototypeOf(n)===null||n.constructor===Object);function DR(a,n,d){if(Object.prototype.hasOwnProperty.call(a,n)||n==="constructor")return a[n];let r=d();return a[n]=r,r}function U8(a,n,d){let{_proxy:r,_context:s,_subProxy:t,_descriptors:g}=a,b=r[n];return dc(b)&&g.isScriptable(n)&&(b=H8(n,b,a,d)),ir(b)&&b.length&&(b=W8(n,b,a,g.isIndexable)),oM(n,b)&&(b=Ru(b,s,t&&t[n],g)),b}function H8(a,n,d,r){let{_proxy:s,_context:t,_subProxy:g,_stack:b}=d;if(b.has(a))throw new Error("Recursion detected: "+Array.from(b).join("->")+"->"+a);b.add(a);let M=n(t,g||r);return b.delete(a),oM(a,M)&&(M=aM(s._scopes,s,a,M)),M}function W8(a,n,d,r){let{_proxy:s,_context:t,_subProxy:g,_descriptors:b}=d;if(typeof t.index<"u"&&r(a))return n[t.index%n.length];if(fn(n[0])){let M=n,k=s._scopes.filter(L=>L!==M);n=[];for(let L of M){let G=aM(k,s,a,L);n.push(Ru(G,t,g&&g[a],b))}}return n}function kR(a,n,d){return dc(a)?a(n,d):a}var G8=(a,n)=>a===!0?n:typeof a=="string"?uc(n,a):void 0;function $8(a,n,d,r,s){for(let t of n){let g=G8(d,t);if(g){a.add(g);let b=kR(g._fallback,d,s);if(typeof b<"u"&&b!==d&&b!==r)return b}else if(g===!1&&typeof r<"u"&&d!==r)return null}return!1}function aM(a,n,d,r){let s=n._rootScopes,t=kR(n._fallback,d,r),g=[...a,...s],b=new Set;b.add(r);let M=aR(b,g,d,t||d,r);return M===null||typeof t<"u"&&t!==d&&(M=aR(b,g,t,M,r),M===null)?!1:yx(Array.from(b),[""],s,t,()=>q8(n,d,r))}function aR(a,n,d,r,s){for(;d;)d=$8(a,n,d,r,s);return d}function q8(a,n,d){let r=a._getTarget();n in r||(r[n]={});let s=r[n];return ir(s)&&fn(d)?d:s||{}}function Y8(a,n,d,r){let s;for(let t of n)if(s=AR(j8(t,a),d),typeof s<"u")return oM(a,s)?aM(d,r,a,s):s}function AR(a,n){for(let d of n){if(!d)continue;let r=d[a];if(typeof r<"u")return r}}function sR(a){let n=a._keys;return n||(n=a._keys=Z8(a._scopes)),n}function Z8(a){let n=new Set;for(let d of a)for(let r of Object.keys(d).filter(s=>!s.startsWith("_")))n.add(r);return Array.from(n)}function sM(a,n,d,r){let{iScale:s}=a,{key:t="r"}=this._parsing,g=new Array(r),b,M,k,L;for(b=0,M=r;b<M;++b)k=b+d,L=n[k],g[b]={r:s.parse(uc(L,t),k)};return g}var X8=Number.EPSILON||1e-14,Ym=(a,n)=>n<a.length&&!a[n].skip&&a[n],PR=a=>a==="x"?"y":"x";function K8(a,n,d,r){let s=a.skip?n:a,t=n,g=d.skip?n:d,b=cx(t,s),M=cx(g,t),k=b/(b+M),L=M/(b+M);k=isNaN(k)?0:k,L=isNaN(L)?0:L;let G=r*k,J=r*L;return{previous:{x:t.x-G*(g.x-s.x),y:t.y-G*(g.y-s.y)},next:{x:t.x+J*(g.x-s.x),y:t.y+J*(g.y-s.y)}}}function Q8(a,n,d){let r=a.length,s,t,g,b,M,k=Ym(a,0);for(let L=0;L<r-1;++L)if(M=k,k=Ym(a,L+1),!(!M||!k)){if(Km(n[L],0,X8)){d[L]=d[L+1]=0;continue}s=d[L]/n[L],t=d[L+1]/n[L],b=Math.pow(s,2)+Math.pow(t,2),!(b<=9)&&(g=3/Math.sqrt(b),d[L]=s*g*n[L],d[L+1]=t*g*n[L])}}function J8(a,n,d="x"){let r=PR(d),s=a.length,t,g,b,M=Ym(a,0);for(let k=0;k<s;++k){if(g=b,b=M,M=Ym(a,k+1),!b)continue;let L=b[d],G=b[r];g&&(t=(L-g[d])/3,b[`cp1${d}`]=L-t,b[`cp1${r}`]=G-t*n[k]),M&&(t=(M[d]-L)/3,b[`cp2${d}`]=L+t,b[`cp2${r}`]=G+t*n[k])}}function eH(a,n="x"){let d=PR(n),r=a.length,s=Array(r).fill(0),t=Array(r),g,b,M,k=Ym(a,0);for(g=0;g<r;++g)if(b=M,M=k,k=Ym(a,g+1),!!M){if(k){let L=k[n]-M[n];s[g]=L!==0?(k[d]-M[d])/L:0}t[g]=b?k?As(s[g-1])!==As(s[g])?0:(s[g-1]+s[g])/2:s[g-1]:s[g]}Q8(a,s,t),J8(a,t,n)}function ox(a,n,d){return Math.max(Math.min(a,d),n)}function tH(a,n){let d,r,s,t,g,b=ul(a[0],n);for(d=0,r=a.length;d<r;++d)g=t,t=b,b=d<r-1&&ul(a[d+1],n),t&&(s=a[d],g&&(s.cp1x=ox(s.cp1x,n.left,n.right),s.cp1y=ox(s.cp1y,n.top,n.bottom)),b&&(s.cp2x=ox(s.cp2x,n.left,n.right),s.cp2y=ox(s.cp2y,n.top,n.bottom)))}function OR(a,n,d,r,s){let t,g,b,M;if(n.spanGaps&&(a=a.filter(k=>!k.skip)),n.cubicInterpolationMode==="monotone")eH(a,s);else{let k=r?a[a.length-1]:a[0];for(t=0,g=a.length;t<g;++t)b=a[t],M=K8(k,b,a[Math.min(t+1,g-(r?0:1))%g],n.tension),b.cp1x=M.previous.x,b.cp1y=M.previous.y,b.cp2x=M.next.x,b.cp2y=M.next.y,k=b}n.capBezierPoints&&tH(a,d)}function bx(){return typeof window<"u"&&typeof document<"u"}function vx(a){let n=a.parentNode;return n&&n.toString()==="[object ShadowRoot]"&&(n=n.host),n}function dx(a,n,d){let r;return typeof a=="string"?(r=parseInt(a,10),a.indexOf("%")!==-1&&(r=r/100*n.parentNode[d])):r=a,r}var xx=a=>a.ownerDocument.defaultView.getComputedStyle(a,null);function iH(a,n){return xx(a).getPropertyValue(n)}var nH=["top","right","bottom","left"];function Ou(a,n,d){let r={};d=d?"-"+d:"";for(let s=0;s<4;s++){let t=nH[s];r[t]=parseFloat(a[n+"-"+t+d])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}var rH=(a,n,d)=>(a>0||n>0)&&(!d||!d.shadowRoot);function oH(a,n){let d=a.touches,r=d&&d.length?d[0]:a,{offsetX:s,offsetY:t}=r,g=!1,b,M;if(rH(s,t,a.target))b=s,M=t;else{let k=n.getBoundingClientRect();b=r.clientX-k.left,M=r.clientY-k.top,g=!0}return{x:b,y:M,box:g}}function th(a,n){if("native"in a)return a;let{canvas:d,currentDevicePixelRatio:r}=n,s=xx(d),t=s.boxSizing==="border-box",g=Ou(s,"padding"),b=Ou(s,"border","width"),{x:M,y:k,box:L}=oH(a,d),G=g.left+(L&&b.left),J=g.top+(L&&b.top),{width:oe,height:be}=n;return t&&(oe-=g.width+b.width,be-=g.height+b.height),{x:Math.round((M-G)/oe*d.width/r),y:Math.round((k-J)/be*d.height/r)}}function aH(a,n,d){let r,s;if(n===void 0||d===void 0){let t=a&&vx(a);if(!t)n=a.clientWidth,d=a.clientHeight;else{let g=t.getBoundingClientRect(),b=xx(t),M=Ou(b,"border","width"),k=Ou(b,"padding");n=g.width-k.width-M.width,d=g.height-k.height-M.height,r=dx(b.maxWidth,t,"clientWidth"),s=dx(b.maxHeight,t,"clientHeight")}}return{width:n,height:d,maxWidth:r||lx,maxHeight:s||lx}}var ax=a=>Math.round(a*10)/10;function RR(a,n,d,r){let s=xx(a),t=Ou(s,"margin"),g=dx(s.maxWidth,a,"clientWidth")||lx,b=dx(s.maxHeight,a,"clientHeight")||lx,M=aH(a,n,d),{width:k,height:L}=M;if(s.boxSizing==="content-box"){let J=Ou(s,"border","width"),oe=Ou(s,"padding");k-=oe.width+J.width,L-=oe.height+J.height}return k=Math.max(0,k-t.width),L=Math.max(0,r?k/r:L-t.height),k=ax(Math.min(k,g,M.maxWidth)),L=ax(Math.min(L,b,M.maxHeight)),k&&!L&&(L=ax(k/2)),(n!==void 0||d!==void 0)&&r&&M.height&&L>M.height&&(L=M.height,k=ax(Math.floor(L*r))),{width:k,height:L}}function lM(a,n,d){let r=n||1,s=Math.floor(a.height*r),t=Math.floor(a.width*r);a.height=Math.floor(a.height),a.width=Math.floor(a.width);let g=a.canvas;return g.style&&(d||!g.style.height&&!g.style.width)&&(g.style.height=`${a.height}px`,g.style.width=`${a.width}px`),a.currentDevicePixelRatio!==r||g.height!==s||g.width!==t?(a.currentDevicePixelRatio=r,g.height=s,g.width=t,a.ctx.setTransform(r,0,0,r,0,0),!0):!1}var FR=function(){let a=!1;try{let n={get passive(){return a=!0,!1}};bx()&&(window.addEventListener("test",null,n),window.removeEventListener("test",null,n))}catch{}return a}();function cM(a,n){let d=iH(a,n),r=d&&d.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function Xd(a,n,d,r){return{x:a.x+d*(n.x-a.x),y:a.y+d*(n.y-a.y)}}function LR(a,n,d,r){return{x:a.x+d*(n.x-a.x),y:r==="middle"?d<.5?a.y:n.y:r==="after"?d<1?a.y:n.y:d>0?n.y:a.y}}function zR(a,n,d,r){let s={x:a.cp2x,y:a.cp2y},t={x:n.cp1x,y:n.cp1y},g=Xd(a,s,d),b=Xd(s,t,d),M=Xd(t,n,d),k=Xd(g,b,d),L=Xd(b,M,d);return Xd(k,L,d)}var sH=function(a,n){return{x(d){return a+a+n-d},setWidth(d){n=d},textAlign(d){return d==="center"?d:d==="right"?"left":"right"},xPlus(d,r){return d-r},leftForLtr(d,r){return d-r}}},lH=function(){return{x(a){return a},setWidth(a){},textAlign(a){return a},xPlus(a,n){return a+n},leftForLtr(a,n){return a}}};function Lu(a,n,d){return a?sH(n,d):lH()}function dM(a,n){let d,r;(n==="ltr"||n==="rtl")&&(d=a.canvas.style,r=[d.getPropertyValue("direction"),d.getPropertyPriority("direction")],d.setProperty("direction",n,"important"),a.prevTextDirection=r)}function hM(a,n){n!==void 0&&(delete a.prevTextDirection,a.canvas.style.setProperty("direction",n[0],n[1]))}function BR(a){return a==="angle"?{between:Qm,compare:M8,normalize:ua}:{between:ml,compare:(n,d)=>n-d,normalize:n=>n}}function lR({start:a,end:n,count:d,loop:r,style:s}){return{start:a%d,end:n%d,loop:r&&(n-a+1)%d===0,style:s}}function cH(a,n,d){let{property:r,start:s,end:t}=d,{between:g,normalize:b}=BR(r),M=n.length,{start:k,end:L,loop:G}=a,J,oe;if(G){for(k+=M,L+=M,J=0,oe=M;J<oe&&g(b(n[k%M][r]),s,t);++J)k--,L--;k%=M,L%=M}return L<k&&(L+=M),{start:k,end:L,loop:G,style:a.style}}function uM(a,n,d){if(!d)return[a];let{property:r,start:s,end:t}=d,g=n.length,{compare:b,between:M,normalize:k}=BR(r),{start:L,end:G,loop:J,style:oe}=cH(a,n,d),be=[],Me=!1,Te=null,He,We,dt,bt=()=>M(s,dt,He)&&b(s,dt)!==0,ft=()=>b(t,He)===0||M(t,dt,He),It=()=>Me||bt(),Wt=()=>!Me||ft();for(let xt=L,Xt=L;xt<=G;++xt)We=n[xt%g],!We.skip&&(He=k(We[r]),He!==dt&&(Me=M(He,s,t),Te===null&&It()&&(Te=b(He,s)===0?xt:Xt),Te!==null&&Wt()&&(be.push(lR({start:Te,end:xt,loop:J,count:g,style:oe})),Te=null),Xt=xt,dt=He));return Te!==null&&be.push(lR({start:Te,end:G,loop:J,count:g,style:oe})),be}function pM(a,n){let d=[],r=a.segments;for(let s=0;s<r.length;s++){let t=uM(r[s],a.points,n);t.length&&d.push(...t)}return d}function dH(a,n,d,r){let s=0,t=n-1;if(d&&!r)for(;s<n&&!a[s].skip;)s++;for(;s<n&&a[s].skip;)s++;for(s%=n,d&&(t+=s);t>s&&a[t%n].skip;)t--;return t%=n,{start:s,end:t}}function hH(a,n,d,r){let s=a.length,t=[],g=n,b=a[n],M;for(M=n+1;M<=d;++M){let k=a[M%s];k.skip||k.stop?b.skip||(r=!1,t.push({start:n%s,end:(M-1)%s,loop:r}),n=g=k.stop?M:null):(g=M,b.skip&&(n=M)),b=k}return g!==null&&t.push({start:n%s,end:g%s,loop:r}),t}function NR(a,n){let d=a.points,r=a.options.spanGaps,s=d.length;if(!s)return[];let t=!!a._loop,{start:g,end:b}=dH(d,s,t,r);if(r===!0)return cR(a,[{start:g,end:b,loop:t}],d,n);let M=b<g?b+s:b,k=!!a._fullLoop&&g===0&&b===s-1;return cR(a,hH(d,g,M,k),d,n)}function cR(a,n,d,r){return!r||!r.setContext||!d?n:uH(a,n,d,r)}function uH(a,n,d,r){let s=a._chart.getContext(),t=dR(a.options),{_datasetIndex:g,options:{spanGaps:b}}=a,M=d.length,k=[],L=t,G=n[0].start,J=G;function oe(be,Me,Te,He){let We=b?-1:1;if(be!==Me){for(be+=M;d[be%M].skip;)be-=We;for(;d[Me%M].skip;)Me+=We;be%M!==Me%M&&(k.push({start:be%M,end:Me%M,loop:Te,style:He}),L=He,G=Me%M)}}for(let be of n){G=b?G:be.start;let Me=d[G%M],Te;for(J=G+1;J<=be.end;J++){let He=d[J%M];Te=dR(r.setContext(pc(s,{type:"segment",p0:Me,p1:He,p0DataIndex:(J-1)%M,p1DataIndex:J%M,datasetIndex:g}))),pH(Te,L)&&oe(G,J-1,be.loop,L),Me=He,L=Te}G<J-1&&oe(G,J-1,be.loop,L)}return k}function dR(a){return{backgroundColor:a.backgroundColor,borderCapStyle:a.borderCapStyle,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderJoinStyle:a.borderJoinStyle,borderWidth:a.borderWidth,borderColor:a.borderColor}}function pH(a,n){if(!n)return!1;let d=[],r=function(s,t){return J2(t)?(d.includes(t)||d.push(t),d.indexOf(t)):t};return JSON.stringify(a,r)!==JSON.stringify(n,r)}var CM=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(n,d,r,s){let t=d.listeners[s],g=d.duration;t.forEach(b=>b({chart:n,initial:d.initial,numSteps:g,currentStep:Math.min(r-d.start,g)}))}_refresh(){this._request||(this._running=!0,this._request=Z2.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(n=Date.now()){let d=0;this._charts.forEach((r,s)=>{if(!r.running||!r.items.length)return;let t=r.items,g=t.length-1,b=!1,M;for(;g>=0;--g)M=t[g],M._active?(M._total>r.duration&&(r.duration=M._total),M.tick(n),b=!0):(t[g]=t[t.length-1],t.pop());b&&(s.draw(),this._notify(s,r,n,"progress")),t.length||(r.running=!1,this._notify(s,r,n,"complete"),r.initial=!1),d+=t.length}),this._lastDate=n,d===0&&(this._running=!1)}_getAnims(n){let d=this._charts,r=d.get(n);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},d.set(n,r)),r}listen(n,d,r){this._getAnims(n).listeners[d].push(r)}add(n,d){!d||!d.length||this._getAnims(n).items.push(...d)}has(n){return this._getAnims(n).items.length>0}start(n){let d=this._charts.get(n);d&&(d.running=!0,d.start=Date.now(),d.duration=d.items.reduce((r,s)=>Math.max(r,s._duration),0),this._refresh())}running(n){if(!this._running)return!1;let d=this._charts.get(n);return!(!d||!d.running||!d.items.length)}stop(n){let d=this._charts.get(n);if(!d||!d.items.length)return;let r=d.items,s=r.length-1;for(;s>=0;--s)r[s].cancel();d.items=[],this._notify(n,d,Date.now(),"complete")}remove(n){return this._charts.delete(n)}},mc=new CM,VR="transparent",mH={boolean(a,n,d){return d>.5?n:a},color(a,n,d){let r=eM(a||VR),s=r.valid&&eM(n||VR);return s&&s.valid?s.mix(r,d).hexString():n},number(a,n,d){return a+(n-a)*d}},SM=class{constructor(n,d,r,s){let t=d[r];s=tf([n.to,s,t,n.from]);let g=tf([n.from,t,s]);this._active=!0,this._fn=n.fn||mH[n.type||typeof g],this._easing=$m[n.easing]||$m.linear,this._start=Math.floor(Date.now()+(n.delay||0)),this._duration=this._total=Math.floor(n.duration),this._loop=!!n.loop,this._target=d,this._prop=r,this._from=g,this._to=s,this._promises=void 0}active(){return this._active}update(n,d,r){if(this._active){this._notify(!1);let s=this._target[this._prop],t=r-this._start,g=this._duration-t;this._start=r,this._duration=Math.floor(Math.max(g,n.duration)),this._total+=t,this._loop=!!n.loop,this._to=tf([n.to,d,s,n.from]),this._from=tf([n.from,s,d])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(n){let d=n-this._start,r=this._duration,s=this._prop,t=this._from,g=this._loop,b=this._to,M;if(this._active=t!==b&&(g||d<r),!this._active){this._target[s]=b,this._notify(!0);return}if(d<0){this._target[s]=t;return}M=d/r%2,M=g&&M>1?2-M:M,M=this._easing(Math.min(1,Math.max(0,M))),this._target[s]=this._fn(t,b,M)}wait(){let n=this._promises||(this._promises=[]);return new Promise((d,r)=>{n.push({res:d,rej:r})})}_notify(n){let d=n?"res":"rej",r=this._promises||[];for(let s=0;s<r.length;s++)r[s][d]()}},Ax=class{constructor(n,d){this._chart=n,this._properties=new Map,this.configure(d)}configure(n){if(!fn(n))return;let d=Object.keys(br.animation),r=this._properties;Object.getOwnPropertyNames(n).forEach(s=>{let t=n[s];if(!fn(t))return;let g={};for(let b of d)g[b]=t[b];(ir(t.properties)&&t.properties||[s]).forEach(b=>{(b===s||!r.has(b))&&r.set(b,g)})})}_animateOptions(n,d){let r=d.options,s=gH(n,r);if(!s)return[];let t=this._createAnimations(s,r);return r.$shared&&fH(n.options.$animations,r).then(()=>{n.options=r},()=>{}),t}_createAnimations(n,d){let r=this._properties,s=[],t=n.$animations||(n.$animations={}),g=Object.keys(d),b=Date.now(),M;for(M=g.length-1;M>=0;--M){let k=g[M];if(k.charAt(0)==="$")continue;if(k==="options"){s.push(...this._animateOptions(n,d));continue}let L=d[k],G=t[k],J=r.get(k);if(G)if(J&&G.active()){G.update(J,L,b);continue}else G.cancel();if(!J||!J.duration){n[k]=L;continue}t[k]=G=new SM(J,n,k,L),s.push(G)}return s}update(n,d){if(this._properties.size===0){Object.assign(n,d);return}let r=this._createAnimations(n,d);if(r.length)return mc.add(this._chart,r),!0}};function fH(a,n){let d=[],r=Object.keys(n);for(let s=0;s<r.length;s++){let t=a[r[s]];t&&t.active()&&d.push(t.wait())}return Promise.all(d)}function gH(a,n){if(!n)return;let d=a.options;if(!d){a.options=n;return}return d.$shared&&(a.options=d=Object.assign({},d,{$shared:!1,$animations:{}})),d}function jR(a,n){let d=a&&a.options||{},r=d.reverse,s=d.min===void 0?n:0,t=d.max===void 0?n:0;return{start:r?t:s,end:r?s:t}}function _H(a,n,d){if(d===!1)return!1;let r=jR(a,d),s=jR(n,d);return{top:s.end,right:r.end,bottom:s.start,left:r.start}}function yH(a){let n,d,r,s;return fn(a)?(n=a.top,d=a.right,r=a.bottom,s=a.left):n=d=r=s=a,{top:n,right:d,bottom:r,left:s,disabled:a===!1}}function jF(a,n){let d=[],r=a._getSortedDatasetMetas(n),s,t;for(s=0,t=r.length;s<t;++s)d.push(r[s].index);return d}function UR(a,n,d,r={}){let s=a.keys,t=r.mode==="single",g,b,M,k;if(n!==null){for(g=0,b=s.length;g<b;++g){if(M=+s[g],M===d){if(r.all)continue;break}k=a.values[M],yr(k)&&(t||n===0||As(n)===As(k))&&(n+=k)}return n}}function bH(a,n){let{iScale:d,vScale:r}=n,s=d.axis==="x"?"x":"y",t=r.axis==="x"?"x":"y",g=Object.keys(a),b=new Array(g.length),M,k,L;for(M=0,k=g.length;M<k;++M)L=g[M],b[M]={[s]:L,[t]:a[L]};return b}function HR(a,n){let d=a&&a.options.stacked;return d||d===void 0&&n.stack!==void 0}function vH(a,n,d){return`${a.id}.${n.id}.${d.stack||d.type}`}function xH(a){let{min:n,max:d,minDefined:r,maxDefined:s}=a.getUserBounds();return{min:r?n:Number.NEGATIVE_INFINITY,max:s?d:Number.POSITIVE_INFINITY}}function wH(a,n,d){let r=a[n]||(a[n]={});return r[d]||(r[d]={})}function WR(a,n,d,r){for(let s of n.getMatchingVisibleMetas(r).reverse()){let t=a[s.index];if(d&&t>0||!d&&t<0)return s.index}return null}function GR(a,n){let{chart:d,_cachedMeta:r}=a,s=d._stacks||(d._stacks={}),{iScale:t,vScale:g,index:b}=r,M=t.axis,k=g.axis,L=vH(t,g,r),G=n.length,J;for(let oe=0;oe<G;++oe){let be=n[oe],{[M]:Me,[k]:Te}=be,He=be._stacks||(be._stacks={});J=He[k]=wH(s,L,Me),J[b]=Te,J._top=WR(J,g,!0,r.type),J._bottom=WR(J,g,!1,r.type);let We=J._visualValues||(J._visualValues={});We[b]=Te}}function mM(a,n){let d=a.scales;return Object.keys(d).filter(r=>d[r].axis===n).shift()}function CH(a,n){return pc(a,{active:!1,dataset:void 0,datasetIndex:n,index:n,mode:"default",type:"dataset"})}function SH(a,n,d){return pc(a,{active:!1,dataIndex:n,parsed:void 0,raw:void 0,element:d,index:n,mode:"default",type:"data"})}function y0(a,n){let d=a.controller.index,r=a.vScale&&a.vScale.axis;if(r){n=n||a._parsed;for(let s of n){let t=s._stacks;if(!t||t[r]===void 0||t[r][d]===void 0)return;delete t[r][d],t[r]._visualValues!==void 0&&t[r]._visualValues[d]!==void 0&&delete t[r]._visualValues[d]}}}var fM=a=>a==="reset"||a==="none",$R=(a,n)=>n?a:Object.assign({},a),MH=(a,n,d)=>a&&!n.hidden&&n._stacked&&{keys:jF(d,!0),values:null},nh=(()=>{class a{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(d,r){this.chart=d,this._ctx=d.ctx,this.index=r,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){let d=this._cachedMeta;this.configure(),this.linkScales(),d._stacked=HR(d.vScale,d),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(d){this.index!==d&&y0(this._cachedMeta),this.index=d}linkScales(){let d=this.chart,r=this._cachedMeta,s=this.getDataset(),t=(J,oe,be,Me)=>J==="x"?oe:J==="r"?Me:be,g=r.xAxisID=en(s.xAxisID,mM(d,"x")),b=r.yAxisID=en(s.yAxisID,mM(d,"y")),M=r.rAxisID=en(s.rAxisID,mM(d,"r")),k=r.indexAxis,L=r.iAxisID=t(k,g,b,M),G=r.vAxisID=t(k,b,g,M);r.xScale=this.getScaleForId(g),r.yScale=this.getScaleForId(b),r.rScale=this.getScaleForId(M),r.iScale=this.getScaleForId(L),r.vScale=this.getScaleForId(G)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(d){return this.chart.scales[d]}_getOtherScale(d){let r=this._cachedMeta;return d===r.iScale?r.vScale:r.iScale}reset(){this._update("reset")}_destroy(){let d=this._cachedMeta;this._data&&q2(this._data,this),d._stacked&&y0(d)}_dataCheck(){let d=this.getDataset(),r=d.data||(d.data=[]),s=this._data;if(fn(r)){let t=this._cachedMeta;this._data=bH(r,t)}else if(s!==r){if(s){q2(s,this);let t=this._cachedMeta;y0(t),t._parsed=[]}r&&Object.isExtensible(r)&&xR(r,this),this._syncList=[],this._data=r}}addElements(){let d=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(d.dataset=new this.datasetElementType)}buildOrUpdateElements(d){let r=this._cachedMeta,s=this.getDataset(),t=!1;this._dataCheck();let g=r._stacked;r._stacked=HR(r.vScale,r),r.stack!==s.stack&&(t=!0,y0(r),r.stack=s.stack),this._resyncElements(d),(t||g!==r._stacked)&&GR(this,r._parsed)}configure(){let d=this.chart.config,r=d.datasetScopeKeys(this._type),s=d.getOptionScopes(this.getDataset(),r,!0);this.options=d.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(d,r){let{_cachedMeta:s,_data:t}=this,{iScale:g,_stacked:b}=s,M=g.axis,k=d===0&&r===t.length?!0:s._sorted,L=d>0&&s._parsed[d-1],G,J,oe;if(this._parsing===!1)s._parsed=t,s._sorted=!0,oe=t;else{ir(t[d])?oe=this.parseArrayData(s,t,d,r):fn(t[d])?oe=this.parseObjectData(s,t,d,r):oe=this.parsePrimitiveData(s,t,d,r);let be=()=>J[M]===null||L&&J[M]<L[M];for(G=0;G<r;++G)s._parsed[G+d]=J=oe[G],k&&(be()&&(k=!1),L=J);s._sorted=k}b&&GR(this,oe)}parsePrimitiveData(d,r,s,t){let{iScale:g,vScale:b}=d,M=g.axis,k=b.axis,L=g.getLabels(),G=g===b,J=new Array(t),oe,be,Me;for(oe=0,be=t;oe<be;++oe)Me=oe+s,J[oe]={[M]:G||g.parse(L[Me],Me),[k]:b.parse(r[Me],Me)};return J}parseArrayData(d,r,s,t){let{xScale:g,yScale:b}=d,M=new Array(t),k,L,G,J;for(k=0,L=t;k<L;++k)G=k+s,J=r[G],M[k]={x:g.parse(J[0],G),y:b.parse(J[1],G)};return M}parseObjectData(d,r,s,t){let{xScale:g,yScale:b}=d,{xAxisKey:M="x",yAxisKey:k="y"}=this._parsing,L=new Array(t),G,J,oe,be;for(G=0,J=t;G<J;++G)oe=G+s,be=r[oe],L[G]={x:g.parse(uc(be,M),oe),y:b.parse(uc(be,k),oe)};return L}getParsed(d){return this._cachedMeta._parsed[d]}getDataElement(d){return this._cachedMeta.data[d]}applyStack(d,r,s){let t=this.chart,g=this._cachedMeta,b=r[d.axis],M={keys:jF(t,!0),values:r._stacks[d.axis]._visualValues};return UR(M,b,g.index,{mode:s})}updateRangeFromParsed(d,r,s,t){let g=s[r.axis],b=g===null?NaN:g,M=t&&s._stacks[r.axis];t&&M&&(t.values=M,b=UR(t,g,this._cachedMeta.index)),d.min=Math.min(d.min,b),d.max=Math.max(d.max,b)}getMinMax(d,r){let s=this._cachedMeta,t=s._parsed,g=s._sorted&&d===s.iScale,b=t.length,M=this._getOtherScale(d),k=MH(r,s,this.chart),L={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:G,max:J}=xH(M),oe,be;function Me(){be=t[oe];let Te=be[M.axis];return!yr(be[d.axis])||G>Te||J<Te}for(oe=0;oe<b&&!(!Me()&&(this.updateRangeFromParsed(L,d,be,k),g));++oe);if(g){for(oe=b-1;oe>=0;--oe)if(!Me()){this.updateRangeFromParsed(L,d,be,k);break}}return L}getAllParsedValues(d){let r=this._cachedMeta._parsed,s=[],t,g,b;for(t=0,g=r.length;t<g;++t)b=r[t][d.axis],yr(b)&&s.push(b);return s}getMaxOverflow(){return!1}getLabelAndValue(d){let r=this._cachedMeta,s=r.iScale,t=r.vScale,g=this.getParsed(d);return{label:s?""+s.getLabelForValue(g[s.axis]):"",value:t?""+t.getLabelForValue(g[t.axis]):""}}_update(d){let r=this._cachedMeta;this.update(d||"default"),r._clip=yH(en(this.options.clip,_H(r.xScale,r.yScale,this.getMaxOverflow())))}update(d){}draw(){let d=this._ctx,r=this.chart,s=this._cachedMeta,t=s.data||[],g=r.chartArea,b=[],M=this._drawStart||0,k=this._drawCount||t.length-M,L=this.options.drawActiveElementsOnTop,G;for(s.dataset&&s.dataset.draw(d,g,M,k),G=M;G<M+k;++G){let J=t[G];J.hidden||(J.active&&L?b.push(J):J.draw(d,g))}for(G=0;G<b.length;++G)b[G].draw(d,g)}getStyle(d,r){let s=r?"active":"default";return d===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(d||0,s)}getContext(d,r,s){let t=this.getDataset(),g;if(d>=0&&d<this._cachedMeta.data.length){let b=this._cachedMeta.data[d];g=b.$context||(b.$context=SH(this.getContext(),d,b)),g.parsed=this.getParsed(d),g.raw=t.data[d],g.index=g.dataIndex=d}else g=this.$context||(this.$context=CH(this.chart.getContext(),this.index)),g.dataset=t,g.index=g.datasetIndex=this.index;return g.active=!!r,g.mode=s,g}resolveDatasetElementOptions(d){return this._resolveElementOptions(this.datasetElementType.id,d)}resolveDataElementOptions(d,r){return this._resolveElementOptions(this.dataElementType.id,r,d)}_resolveElementOptions(d,r="default",s){let t=r==="active",g=this._cachedDataOpts,b=d+"-"+r,M=g[b],k=this.enableOptionSharing&&Xm(s);if(M)return $R(M,k);let L=this.chart.config,G=L.datasetElementScopeKeys(this._type,d),J=t?[`${d}Hover`,"hover",d,""]:[d,""],oe=L.getOptionScopes(this.getDataset(),G),be=Object.keys(br.elements[d]),Me=()=>this.getContext(s,t,r),Te=L.resolveNamedOptions(oe,be,Me,J);return Te.$shared&&(Te.$shared=k,g[b]=Object.freeze($R(Te,k))),Te}_resolveAnimations(d,r,s){let t=this.chart,g=this._cachedDataOpts,b=`animation-${r}`,M=g[b];if(M)return M;let k;if(t.options.animation!==!1){let G=this.chart.config,J=G.datasetAnimationScopeKeys(this._type,r),oe=G.getOptionScopes(this.getDataset(),J);k=G.createResolver(oe,this.getContext(d,s,r))}let L=new Ax(t,k&&k.animations);return k&&k._cacheable&&(g[b]=Object.freeze(L)),L}getSharedOptions(d){if(d.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},d))}includeOptions(d,r){return!r||fM(d)||this.chart._animationsDisabled}_getSharedOptions(d,r){let s=this.resolveDataElementOptions(d,r),t=this._sharedOptions,g=this.getSharedOptions(s),b=this.includeOptions(r,g)||g!==t;return this.updateSharedOptions(g,r,s),{sharedOptions:g,includeOptions:b}}updateElement(d,r,s,t){fM(t)?Object.assign(d,s):this._resolveAnimations(r,t).update(d,s)}updateSharedOptions(d,r,s){d&&!fM(r)&&this._resolveAnimations(void 0,r).update(d,s)}_setStyle(d,r,s,t){d.active=t;let g=this.getStyle(r,t);this._resolveAnimations(r,s,t).update(d,{options:!t&&this.getSharedOptions(g)||g})}removeHoverStyle(d,r,s){this._setStyle(d,s,"active",!1)}setHoverStyle(d,r,s){this._setStyle(d,s,"active",!0)}_removeDatasetHoverStyle(){let d=this._cachedMeta.dataset;d&&this._setStyle(d,void 0,"active",!1)}_setDatasetHoverStyle(){let d=this._cachedMeta.dataset;d&&this._setStyle(d,void 0,"active",!0)}_resyncElements(d){let r=this._data,s=this._cachedMeta.data;for(let[M,k,L]of this._syncList)this[M](k,L);this._syncList=[];let t=s.length,g=r.length,b=Math.min(g,t);b&&this.parse(0,b),g>t?this._insertElements(t,g-t,d):g<t&&this._removeElements(g,t-g)}_insertElements(d,r,s=!0){let t=this._cachedMeta,g=t.data,b=d+r,M,k=L=>{for(L.length+=r,M=L.length-1;M>=b;M--)L[M]=L[M-r]};for(k(g),M=d;M<b;++M)g[M]=new this.dataElementType;this._parsing&&k(t._parsed),this.parse(d,r),s&&this.updateElements(g,d,r,"reset")}updateElements(d,r,s,t){}_removeElements(d,r){let s=this._cachedMeta;if(this._parsing){let t=s._parsed.splice(d,r);s._stacked&&y0(s,t)}s.data.splice(d,r)}_sync(d){if(this._parsing)this._syncList.push(d);else{let[r,s,t]=d;this[r](s,t)}this.chart._dataChanges.push([this.index,...d])}_onDataPush(){let d=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-d,d])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(d,r){r&&this._sync(["_removeElements",d,r]);let s=arguments.length-2;s&&this._sync(["_insertElements",d,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return a})();function TH(a,n){if(!a._cache.$bar){let d=a.getMatchingVisibleMetas(n),r=[];for(let s=0,t=d.length;s<t;s++)r=r.concat(d[s].controller.getAllParsedValues(a));a._cache.$bar=Y2(r.sort((s,t)=>s-t))}return a._cache.$bar}function IH(a){let n=a.iScale,d=TH(n,a.type),r=n._length,s,t,g,b,M=()=>{g===32767||g===-32768||(Xm(b)&&(r=Math.min(r,Math.abs(g-b)||r)),b=g)};for(s=0,t=d.length;s<t;++s)g=n.getPixelForValue(d[s]),M();for(b=void 0,s=0,t=n.ticks.length;s<t;++s)g=n.getPixelForTick(s),M();return r}function EH(a,n,d,r){let s=d.barThickness,t,g;return Sn(s)?(t=n.min*d.categoryPercentage,g=d.barPercentage):(t=s*r,g=1),{chunk:t/r,ratio:g,start:n.pixels[a]-t/2}}function DH(a,n,d,r){let s=n.pixels,t=s[a],g=a>0?s[a-1]:null,b=a<s.length-1?s[a+1]:null,M=d.categoryPercentage;g===null&&(g=t-(b===null?n.end-n.start:b-t)),b===null&&(b=t+t-g);let k=t-(t-Math.min(g,b))/2*M;return{chunk:Math.abs(b-g)/2*M/r,ratio:d.barPercentage,start:k}}function kH(a,n,d,r){let s=d.parse(a[0],r),t=d.parse(a[1],r),g=Math.min(s,t),b=Math.max(s,t),M=g,k=b;Math.abs(g)>Math.abs(b)&&(M=b,k=g),n[d.axis]=k,n._custom={barStart:M,barEnd:k,start:s,end:t,min:g,max:b}}function UF(a,n,d,r){return ir(a)?kH(a,n,d,r):n[d.axis]=d.parse(a,r),n}function qR(a,n,d,r){let s=a.iScale,t=a.vScale,g=s.getLabels(),b=s===t,M=[],k,L,G,J;for(k=d,L=d+r;k<L;++k)J=n[k],G={},G[s.axis]=b||s.parse(g[k],k),M.push(UF(J,G,t,k));return M}function gM(a){return a&&a.barStart!==void 0&&a.barEnd!==void 0}function AH(a,n,d){return a!==0?As(a):(n.isHorizontal()?1:-1)*(n.min>=d?1:-1)}function PH(a){let n,d,r,s,t;return a.horizontal?(n=a.base>a.x,d="left",r="right"):(n=a.base<a.y,d="bottom",r="top"),n?(s="end",t="start"):(s="start",t="end"),{start:d,end:r,reverse:n,top:s,bottom:t}}function OH(a,n,d,r){let s=n.borderSkipped,t={};if(!s){a.borderSkipped=t;return}if(s===!0){a.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}let{start:g,end:b,reverse:M,top:k,bottom:L}=PH(a);s==="middle"&&d&&(a.enableBorderRadius=!0,(d._top||0)===r?s=k:(d._bottom||0)===r?s=L:(t[YR(L,g,b,M)]=!0,s=k)),t[YR(s,g,b,M)]=!0,a.borderSkipped=t}function YR(a,n,d,r){return r?(a=RH(a,n,d),a=ZR(a,d,n)):a=ZR(a,n,d),a}function RH(a,n,d){return a===n?d:a===d?n:a}function ZR(a,n,d){return a==="start"?n:a==="end"?d:a}function FH(a,{inflateAmount:n},d){a.inflateAmount=n==="auto"?d===1?.33:0:n}var LH=(()=>{class a extends nh{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(d,r,s,t){return qR(d,r,s,t)}parseArrayData(d,r,s,t){return qR(d,r,s,t)}parseObjectData(d,r,s,t){let{iScale:g,vScale:b}=d,{xAxisKey:M="x",yAxisKey:k="y"}=this._parsing,L=g.axis==="x"?M:k,G=b.axis==="x"?M:k,J=[],oe,be,Me,Te;for(oe=s,be=s+t;oe<be;++oe)Te=r[oe],Me={},Me[g.axis]=g.parse(uc(Te,L),oe),J.push(UF(uc(Te,G),Me,b,oe));return J}updateRangeFromParsed(d,r,s,t){super.updateRangeFromParsed(d,r,s,t);let g=s._custom;g&&r===this._cachedMeta.vScale&&(d.min=Math.min(d.min,g.min),d.max=Math.max(d.max,g.max))}getMaxOverflow(){return 0}getLabelAndValue(d){let r=this._cachedMeta,{iScale:s,vScale:t}=r,g=this.getParsed(d),b=g._custom,M=gM(b)?"["+b.start+", "+b.end+"]":""+t.getLabelForValue(g[t.axis]);return{label:""+s.getLabelForValue(g[s.axis]),value:M}}initialize(){this.enableOptionSharing=!0,super.initialize();let d=this._cachedMeta;d.stack=this.getDataset().stack}update(d){let r=this._cachedMeta;this.updateElements(r.data,0,r.data.length,d)}updateElements(d,r,s,t){let g=t==="reset",{index:b,_cachedMeta:{vScale:M}}=this,k=M.getBasePixel(),L=M.isHorizontal(),G=this._getRuler(),{sharedOptions:J,includeOptions:oe}=this._getSharedOptions(r,t);for(let be=r;be<r+s;be++){let Me=this.getParsed(be),Te=g||Sn(Me[M.axis])?{base:k,head:k}:this._calculateBarValuePixels(be),He=this._calculateBarIndexPixels(be,G),We=(Me._stacks||{})[M.axis],dt={horizontal:L,base:Te.base,enableBorderRadius:!We||gM(Me._custom)||b===We._top||b===We._bottom,x:L?Te.head:He.center,y:L?He.center:Te.head,height:L?He.size:Math.abs(Te.size),width:L?Math.abs(Te.size):He.size};oe&&(dt.options=J||this.resolveDataElementOptions(be,d[be].active?"active":t));let bt=dt.options||d[be].options;OH(dt,bt,We,b),FH(dt,bt,G.ratio),this.updateElement(d[be],be,dt,t)}}_getStacks(d,r){let{iScale:s}=this._cachedMeta,t=s.getMatchingVisibleMetas(this._type).filter(k=>k.controller.options.grouped),g=s.options.stacked,b=[],M=k=>{let L=k.controller.getParsed(r),G=L&&L[k.vScale.axis];if(Sn(G)||isNaN(G))return!0};for(let k of t)if(!(r!==void 0&&M(k))&&((g===!1||b.indexOf(k.stack)===-1||g===void 0&&k.stack===void 0)&&b.push(k.stack),k.index===d))break;return b.length||b.push(void 0),b}_getStackCount(d){return this._getStacks(void 0,d).length}_getStackIndex(d,r,s){let t=this._getStacks(d,s),g=r!==void 0?t.indexOf(r):-1;return g===-1?t.length-1:g}_getRuler(){let d=this.options,r=this._cachedMeta,s=r.iScale,t=[],g,b;for(g=0,b=r.data.length;g<b;++g)t.push(s.getPixelForValue(this.getParsed(g)[s.axis],g));let M=d.barThickness;return{min:M||IH(r),pixels:t,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:d.grouped,ratio:M?1:d.categoryPercentage*d.barPercentage}}_calculateBarValuePixels(d){let{_cachedMeta:{vScale:r,_stacked:s,index:t},options:{base:g,minBarLength:b}}=this,M=g||0,k=this.getParsed(d),L=k._custom,G=gM(L),J=k[r.axis],oe=0,be=s?this.applyStack(r,k,s):J,Me,Te;be!==J&&(oe=be-J,be=J),G&&(J=L.barStart,be=L.barEnd-L.barStart,J!==0&&As(J)!==As(L.barEnd)&&(oe=0),oe+=J);let He=!Sn(g)&&!G?g:oe,We=r.getPixelForValue(He);if(this.chart.getDataVisibility(d)?Me=r.getPixelForValue(oe+be):Me=We,Te=Me-We,Math.abs(Te)<b){Te=AH(Te,r,M)*b,J===M&&(We-=Te/2);let dt=r.getPixelForDecimal(0),bt=r.getPixelForDecimal(1),ft=Math.min(dt,bt),It=Math.max(dt,bt);We=Math.max(Math.min(We,It),ft),Me=We+Te,s&&!G&&(k._stacks[r.axis]._visualValues[t]=r.getValueForPixel(Me)-r.getValueForPixel(We))}if(We===r.getPixelForValue(M)){let dt=As(Te)*r.getLineWidthForValue(M)/2;We+=dt,Te-=dt}return{size:Te,base:We,head:Me,center:Me+Te/2}}_calculateBarIndexPixels(d,r){let s=r.scale,t=this.options,g=t.skipNull,b=en(t.maxBarThickness,1/0),M,k;if(r.grouped){let L=g?this._getStackCount(d):r.stackCount,G=t.barThickness==="flex"?DH(d,r,t,L):EH(d,r,t,L),J=this._getStackIndex(this.index,this._cachedMeta.stack,g?d:void 0);M=G.start+G.chunk*J+G.chunk/2,k=Math.min(b,G.chunk*G.ratio)}else M=s.getPixelForValue(this.getParsed(d)[s.axis],d),k=Math.min(b,r.min*r.ratio);return{base:M-k/2,head:M+k/2,center:M,size:k}}draw(){let d=this._cachedMeta,r=d.vScale,s=d.data,t=s.length,g=0;for(;g<t;++g)this.getParsed(g)[r.axis]!==null&&!s[g].hidden&&s[g].draw(this._ctx)}}return a})(),zH=(()=>{class a extends nh{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(d,r,s,t){let g=super.parsePrimitiveData(d,r,s,t);for(let b=0;b<g.length;b++)g[b]._custom=this.resolveDataElementOptions(b+s).radius;return g}parseArrayData(d,r,s,t){let g=super.parseArrayData(d,r,s,t);for(let b=0;b<g.length;b++){let M=r[s+b];g[b]._custom=en(M[2],this.resolveDataElementOptions(b+s).radius)}return g}parseObjectData(d,r,s,t){let g=super.parseObjectData(d,r,s,t);for(let b=0;b<g.length;b++){let M=r[s+b];g[b]._custom=en(M&&M.r&&+M.r,this.resolveDataElementOptions(b+s).radius)}return g}getMaxOverflow(){let d=this._cachedMeta.data,r=0;for(let s=d.length-1;s>=0;--s)r=Math.max(r,d[s].size(this.resolveDataElementOptions(s))/2);return r>0&&r}getLabelAndValue(d){let r=this._cachedMeta,s=this.chart.data.labels||[],{xScale:t,yScale:g}=r,b=this.getParsed(d),M=t.getLabelForValue(b.x),k=g.getLabelForValue(b.y),L=b._custom;return{label:s[d]||"",value:"("+M+", "+k+(L?", "+L:"")+")"}}update(d){let r=this._cachedMeta.data;this.updateElements(r,0,r.length,d)}updateElements(d,r,s,t){let g=t==="reset",{iScale:b,vScale:M}=this._cachedMeta,{sharedOptions:k,includeOptions:L}=this._getSharedOptions(r,t),G=b.axis,J=M.axis;for(let oe=r;oe<r+s;oe++){let be=d[oe],Me=!g&&this.getParsed(oe),Te={},He=Te[G]=g?b.getPixelForDecimal(.5):b.getPixelForValue(Me[G]),We=Te[J]=g?M.getBasePixel():M.getPixelForValue(Me[J]);Te.skip=isNaN(He)||isNaN(We),L&&(Te.options=k||this.resolveDataElementOptions(oe,be.active?"active":t),g&&(Te.options.radius=0)),this.updateElement(be,oe,Te,t)}}resolveDataElementOptions(d,r){let s=this.getParsed(d),t=super.resolveDataElementOptions(d,r);t.$shared&&(t=Object.assign({},t,{$shared:!1}));let g=t.radius;return r!=="active"&&(t.radius=0),t.radius+=en(s&&s._custom,g),t}}return a})();function BH(a,n,d){let r=1,s=1,t=0,g=0;if(n<rr){let b=a,M=b+n,k=Math.cos(b),L=Math.sin(b),G=Math.cos(M),J=Math.sin(M),oe=(dt,bt,ft)=>Qm(dt,b,M,!0)?1:Math.max(bt,bt*d,ft,ft*d),be=(dt,bt,ft)=>Qm(dt,b,M,!0)?-1:Math.min(bt,bt*d,ft,ft*d),Me=oe(0,k,G),Te=oe(Tr,L,J),He=be(nr,k,G),We=be(nr+Tr,L,J);r=(Me-He)/2,s=(Te-We)/2,t=-(Me+He)/2,g=-(Te+We)/2}return{ratioX:r,ratioY:s,offsetX:t,offsetY:g}}var WM=(()=>{class a extends nh{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:d=>d!=="spacing",_indexable:d=>d!=="spacing"&&!d.startsWith("borderDash")&&!d.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(d){let r=d.data;if(r.labels.length&&r.datasets.length){let{labels:{pointStyle:s,color:t}}=d.legend.options;return r.labels.map((g,b)=>{let k=d.getDatasetMeta(0).controller.getStyle(b);return{text:g,fillStyle:k.backgroundColor,strokeStyle:k.borderColor,fontColor:t,lineWidth:k.borderWidth,pointStyle:s,hidden:!d.getDataVisibility(b),index:b}})}return[]}},onClick(d,r,s){s.chart.toggleDataVisibility(r.index),s.chart.update()}}}};constructor(d,r){super(d,r),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(d,r){let s=this.getDataset().data,t=this._cachedMeta;if(this._parsing===!1)t._parsed=s;else{let g=k=>+s[k];if(fn(s[d])){let{key:k="value"}=this._parsing;g=L=>+uc(s[L],k)}let b,M;for(b=d,M=d+r;b<M;++b)t._parsed[b]=g(b)}}_getRotation(){return as(this.options.rotation-90)}_getCircumference(){return as(this.options.circumference)}_getRotationExtents(){let d=rr,r=-rr;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){let t=this.chart.getDatasetMeta(s).controller,g=t._getRotation(),b=t._getCircumference();d=Math.min(d,g),r=Math.max(r,g+b)}return{rotation:d,circumference:r-d}}update(d){let r=this.chart,{chartArea:s}=r,t=this._cachedMeta,g=t.data,b=this.getMaxBorderWidth()+this.getMaxOffset(g)+this.options.spacing,M=Math.max((Math.min(s.width,s.height)-b)/2,0),k=Math.min(uR(this.options.cutout,M),1),L=this._getRingWeight(this.index),{circumference:G,rotation:J}=this._getRotationExtents(),{ratioX:oe,ratioY:be,offsetX:Me,offsetY:Te}=BH(J,G,k),He=(s.width-b)/oe,We=(s.height-b)/be,dt=Math.max(Math.min(He,We)/2,0),bt=j2(this.options.radius,dt),ft=Math.max(bt*k,0),It=(bt-ft)/this._getVisibleDatasetWeightTotal();this.offsetX=Me*bt,this.offsetY=Te*bt,t.total=this.calculateTotal(),this.outerRadius=bt-It*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-It*L,0),this.updateElements(g,0,g.length,d)}_circumference(d,r){let s=this.options,t=this._cachedMeta,g=this._getCircumference();return r&&s.animation.animateRotate||!this.chart.getDataVisibility(d)||t._parsed[d]===null||t.data[d].hidden?0:this.calculateCircumference(t._parsed[d]*g/rr)}updateElements(d,r,s,t){let g=t==="reset",b=this.chart,M=b.chartArea,L=b.options.animation,G=(M.left+M.right)/2,J=(M.top+M.bottom)/2,oe=g&&L.animateScale,be=oe?0:this.innerRadius,Me=oe?0:this.outerRadius,{sharedOptions:Te,includeOptions:He}=this._getSharedOptions(r,t),We=this._getRotation(),dt;for(dt=0;dt<r;++dt)We+=this._circumference(dt,g);for(dt=r;dt<r+s;++dt){let bt=this._circumference(dt,g),ft=d[dt],It={x:G+this.offsetX,y:J+this.offsetY,startAngle:We,endAngle:We+bt,circumference:bt,outerRadius:Me,innerRadius:be};He&&(It.options=Te||this.resolveDataElementOptions(dt,ft.active?"active":t)),We+=bt,this.updateElement(ft,dt,It,t)}}calculateTotal(){let d=this._cachedMeta,r=d.data,s=0,t;for(t=0;t<r.length;t++){let g=d._parsed[t];g!==null&&!isNaN(g)&&this.chart.getDataVisibility(t)&&!r[t].hidden&&(s+=Math.abs(g))}return s}calculateCircumference(d){let r=this._cachedMeta.total;return r>0&&!isNaN(d)?rr*(Math.abs(d)/r):0}getLabelAndValue(d){let r=this._cachedMeta,s=this.chart,t=s.data.labels||[],g=Jm(r._parsed[d],s.options.locale);return{label:t[d]||"",value:g}}getMaxBorderWidth(d){let r=0,s=this.chart,t,g,b,M,k;if(!d){for(t=0,g=s.data.datasets.length;t<g;++t)if(s.isDatasetVisible(t)){b=s.getDatasetMeta(t),d=b.data,M=b.controller;break}}if(!d)return 0;for(t=0,g=d.length;t<g;++t)k=M.resolveDataElementOptions(t),k.borderAlign!=="inner"&&(r=Math.max(r,k.borderWidth||0,k.hoverBorderWidth||0));return r}getMaxOffset(d){let r=0;for(let s=0,t=d.length;s<t;++s){let g=this.resolveDataElementOptions(s);r=Math.max(r,g.offset||0,g.hoverOffset||0)}return r}_getRingWeightOffset(d){let r=0;for(let s=0;s<d;++s)this.chart.isDatasetVisible(s)&&(r+=this._getRingWeight(s));return r}_getRingWeight(d){return Math.max(en(this.chart.data.datasets[d].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return a})(),NH=(()=>{class a extends nh{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(d){let r=this._cachedMeta,{dataset:s,data:t=[],_dataset:g}=r,b=this.chart._animationsDisabled,{start:M,count:k}=K2(r,t,b);this._drawStart=M,this._drawCount=k,Q2(r)&&(M=0,k=t.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!g._decimated,s.points=t;let L=this.resolveDatasetElementOptions(d);this.options.showLine||(L.borderWidth=0),L.segment=this.options.segment,this.updateElement(s,void 0,{animated:!b,options:L},d),this.updateElements(t,M,k,d)}updateElements(d,r,s,t){let g=t==="reset",{iScale:b,vScale:M,_stacked:k,_dataset:L}=this._cachedMeta,{sharedOptions:G,includeOptions:J}=this._getSharedOptions(r,t),oe=b.axis,be=M.axis,{spanGaps:Me,segment:Te}=this.options,He=Fu(Me)?Me:Number.POSITIVE_INFINITY,We=this.chart._animationsDisabled||g||t==="none",dt=r+s,bt=d.length,ft=r>0&&this.getParsed(r-1);for(let It=0;It<bt;++It){let Wt=d[It],xt=We?Wt:{};if(It<r||It>=dt){xt.skip=!0;continue}let Xt=this.getParsed(It),Vt=Sn(Xt[be]),Oi=xt[oe]=b.getPixelForValue(Xt[oe],It),Xi=xt[be]=g||Vt?M.getBasePixel():M.getPixelForValue(k?this.applyStack(M,Xt,k):Xt[be],It);xt.skip=isNaN(Oi)||isNaN(Xi)||Vt,xt.stop=It>0&&Math.abs(Xt[oe]-ft[oe])>He,Te&&(xt.parsed=Xt,xt.raw=L.data[It]),J&&(xt.options=G||this.resolveDataElementOptions(It,Wt.active?"active":t)),We||this.updateElement(Wt,It,xt,t),ft=Xt}}getMaxOverflow(){let d=this._cachedMeta,r=d.dataset,s=r.options&&r.options.borderWidth||0,t=d.data||[];if(!t.length)return s;let g=t[0].size(this.resolveDataElementOptions(0)),b=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(s,g,b)/2}draw(){let d=this._cachedMeta;d.dataset.updateControlPoints(this.chart.chartArea,d.iScale.axis),super.draw()}}return a})(),HF=(()=>{class a extends nh{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(d){let r=d.data;if(r.labels.length&&r.datasets.length){let{labels:{pointStyle:s,color:t}}=d.legend.options;return r.labels.map((g,b)=>{let k=d.getDatasetMeta(0).controller.getStyle(b);return{text:g,fillStyle:k.backgroundColor,strokeStyle:k.borderColor,fontColor:t,lineWidth:k.borderWidth,pointStyle:s,hidden:!d.getDataVisibility(b),index:b}})}return[]}},onClick(d,r,s){s.chart.toggleDataVisibility(r.index),s.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(d,r){super(d,r),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(d){let r=this._cachedMeta,s=this.chart,t=s.data.labels||[],g=Jm(r._parsed[d].r,s.options.locale);return{label:t[d]||"",value:g}}parseObjectData(d,r,s,t){return sM.bind(this)(d,r,s,t)}update(d){let r=this._cachedMeta.data;this._updateRadius(),this.updateElements(r,0,r.length,d)}getMinMax(){let d=this._cachedMeta,r={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return d.data.forEach((s,t)=>{let g=this.getParsed(t).r;!isNaN(g)&&this.chart.getDataVisibility(t)&&(g<r.min&&(r.min=g),g>r.max&&(r.max=g))}),r}_updateRadius(){let d=this.chart,r=d.chartArea,s=d.options,t=Math.min(r.right-r.left,r.bottom-r.top),g=Math.max(t/2,0),b=Math.max(s.cutoutPercentage?g/100*s.cutoutPercentage:1,0),M=(g-b)/d.getVisibleDatasetCount();this.outerRadius=g-M*this.index,this.innerRadius=this.outerRadius-M}updateElements(d,r,s,t){let g=t==="reset",b=this.chart,k=b.options.animation,L=this._cachedMeta.rScale,G=L.xCenter,J=L.yCenter,oe=L.getIndexAngle(0)-.5*nr,be=oe,Me,Te=360/this.countVisibleElements();for(Me=0;Me<r;++Me)be+=this._computeAngle(Me,t,Te);for(Me=r;Me<r+s;Me++){let He=d[Me],We=be,dt=be+this._computeAngle(Me,t,Te),bt=b.getDataVisibility(Me)?L.getDistanceFromCenterForValue(this.getParsed(Me).r):0;be=dt,g&&(k.animateScale&&(bt=0),k.animateRotate&&(We=dt=oe));let ft={x:G,y:J,innerRadius:0,outerRadius:bt,startAngle:We,endAngle:dt,options:this.resolveDataElementOptions(Me,He.active?"active":t)};this.updateElement(He,Me,ft,t)}}countVisibleElements(){let d=this._cachedMeta,r=0;return d.data.forEach((s,t)=>{!isNaN(this.getParsed(t).r)&&this.chart.getDataVisibility(t)&&r++}),r}_computeAngle(d,r,s){return this.chart.getDataVisibility(d)?as(this.resolveDataElementOptions(d,r).angle||s):0}}return a})(),VH=(()=>{class a extends WM{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}return a})(),jH=(()=>{class a extends nh{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(d){let r=this._cachedMeta.vScale,s=this.getParsed(d);return{label:r.getLabels()[d],value:""+r.getLabelForValue(s[r.axis])}}parseObjectData(d,r,s,t){return sM.bind(this)(d,r,s,t)}update(d){let r=this._cachedMeta,s=r.dataset,t=r.data||[],g=r.iScale.getLabels();if(s.points=t,d!=="resize"){let b=this.resolveDatasetElementOptions(d);this.options.showLine||(b.borderWidth=0);let M={_loop:!0,_fullLoop:g.length===t.length,options:b};this.updateElement(s,void 0,M,d)}this.updateElements(t,0,t.length,d)}updateElements(d,r,s,t){let g=this._cachedMeta.rScale,b=t==="reset";for(let M=r;M<r+s;M++){let k=d[M],L=this.resolveDataElementOptions(M,k.active?"active":t),G=g.getPointPositionForValue(M,this.getParsed(M).r),J=b?g.xCenter:G.x,oe=b?g.yCenter:G.y,be={x:J,y:oe,angle:G.angle,skip:isNaN(J)||isNaN(oe),options:L};this.updateElement(k,M,be,t)}}}return a})(),UH=(()=>{class a extends nh{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(d){let r=this._cachedMeta,s=this.chart.data.labels||[],{xScale:t,yScale:g}=r,b=this.getParsed(d),M=t.getLabelForValue(b.x),k=g.getLabelForValue(b.y);return{label:s[d]||"",value:"("+M+", "+k+")"}}update(d){let r=this._cachedMeta,{data:s=[]}=r,t=this.chart._animationsDisabled,{start:g,count:b}=K2(r,s,t);if(this._drawStart=g,this._drawCount=b,Q2(r)&&(g=0,b=s.length),this.options.showLine){this.datasetElementType||this.addElements();let{dataset:M,_dataset:k}=r;M._chart=this.chart,M._datasetIndex=this.index,M._decimated=!!k._decimated,M.points=s;let L=this.resolveDatasetElementOptions(d);L.segment=this.options.segment,this.updateElement(M,void 0,{animated:!t,options:L},d)}else this.datasetElementType&&(delete r.dataset,this.datasetElementType=!1);this.updateElements(s,g,b,d)}addElements(){let{showLine:d}=this.options;!this.datasetElementType&&d&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(d,r,s,t){let g=t==="reset",{iScale:b,vScale:M,_stacked:k,_dataset:L}=this._cachedMeta,G=this.resolveDataElementOptions(r,t),J=this.getSharedOptions(G),oe=this.includeOptions(t,J),be=b.axis,Me=M.axis,{spanGaps:Te,segment:He}=this.options,We=Fu(Te)?Te:Number.POSITIVE_INFINITY,dt=this.chart._animationsDisabled||g||t==="none",bt=r>0&&this.getParsed(r-1);for(let ft=r;ft<r+s;++ft){let It=d[ft],Wt=this.getParsed(ft),xt=dt?It:{},Xt=Sn(Wt[Me]),Vt=xt[be]=b.getPixelForValue(Wt[be],ft),Oi=xt[Me]=g||Xt?M.getBasePixel():M.getPixelForValue(k?this.applyStack(M,Wt,k):Wt[Me],ft);xt.skip=isNaN(Vt)||isNaN(Oi)||Xt,xt.stop=ft>0&&Math.abs(Wt[be]-bt[be])>We,He&&(xt.parsed=Wt,xt.raw=L.data[ft]),oe&&(xt.options=J||this.resolveDataElementOptions(ft,It.active?"active":t)),dt||this.updateElement(It,ft,xt,t),bt=Wt}this.updateSharedOptions(J,t,G)}getMaxOverflow(){let d=this._cachedMeta,r=d.data||[];if(!this.options.showLine){let M=0;for(let k=r.length-1;k>=0;--k)M=Math.max(M,r[k].size(this.resolveDataElementOptions(k))/2);return M>0&&M}let s=d.dataset,t=s.options&&s.options.borderWidth||0;if(!r.length)return t;let g=r[0].size(this.resolveDataElementOptions(0)),b=r[r.length-1].size(this.resolveDataElementOptions(r.length-1));return Math.max(t,g,b)/2}}return a})(),HH=Object.freeze({__proto__:null,BarController:LH,BubbleController:zH,DoughnutController:WM,LineController:NH,PieController:VH,PolarAreaController:HF,RadarController:jH,ScatterController:UH});function zu(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var MM=class a{static override(n){Object.assign(a.prototype,n)}options;constructor(n){this.options=n||{}}init(){}formats(){return zu()}parse(){return zu()}format(){return zu()}add(){return zu()}diff(){return zu()}startOf(){return zu()}endOf(){return zu()}},WH={_date:MM};function GH(a,n,d,r){let{controller:s,data:t,_sorted:g}=a,b=s._cachedMeta.iScale;if(b&&n===b.axis&&n!=="r"&&g&&t.length){let M=b._reversePixels?yR:hl;if(r){if(s._sharedOptions){let k=t[0],L=typeof k.getRange=="function"&&k.getRange(n);if(L){let G=M(t,n,d-L),J=M(t,n,d+L);return{lo:G.lo,hi:J.hi}}}}else return M(t,n,d)}return{lo:0,hi:t.length-1}}function E0(a,n,d,r,s){let t=a.getSortedVisibleDatasetMetas(),g=d[n];for(let b=0,M=t.length;b<M;++b){let{index:k,data:L}=t[b],{lo:G,hi:J}=GH(t[b],n,g,s);for(let oe=G;oe<=J;++oe){let be=L[oe];be.skip||r(be,k,oe)}}}function $H(a){let n=a.indexOf("x")!==-1,d=a.indexOf("y")!==-1;return function(r,s){let t=n?Math.abs(r.x-s.x):0,g=d?Math.abs(r.y-s.y):0;return Math.sqrt(Math.pow(t,2)+Math.pow(g,2))}}function _M(a,n,d,r,s){let t=[];return!s&&!a.isPointInArea(n)||E0(a,d,n,function(b,M,k){!s&&!ul(b,a.chartArea,0)||b.inRange(n.x,n.y,r)&&t.push({element:b,datasetIndex:M,index:k})},!0),t}function qH(a,n,d,r){let s=[];function t(g,b,M){let{startAngle:k,endAngle:L}=g.getProps(["startAngle","endAngle"],r),{angle:G}=$2(g,{x:n.x,y:n.y});Qm(G,k,L)&&s.push({element:g,datasetIndex:b,index:M})}return E0(a,d,n,t),s}function YH(a,n,d,r,s,t){let g=[],b=$H(d),M=Number.POSITIVE_INFINITY;function k(L,G,J){let oe=L.inRange(n.x,n.y,s);if(r&&!oe)return;let be=L.getCenterPoint(s);if(!(!!t||a.isPointInArea(be))&&!oe)return;let Te=b(n,be);Te<M?(g=[{element:L,datasetIndex:G,index:J}],M=Te):Te===M&&g.push({element:L,datasetIndex:G,index:J})}return E0(a,d,n,k),g}function yM(a,n,d,r,s,t){return!t&&!a.isPointInArea(n)?[]:d==="r"&&!r?qH(a,n,d,s):YH(a,n,d,r,s,t)}function XR(a,n,d,r,s){let t=[],g=d==="x"?"inXRange":"inYRange",b=!1;return E0(a,d,n,(M,k,L)=>{M[g](n[d],s)&&(t.push({element:M,datasetIndex:k,index:L}),b=b||M.inRange(n.x,n.y,s))}),r&&!b?[]:t}var ZH={evaluateInteractionItems:E0,modes:{index(a,n,d,r){let s=th(n,a),t=d.axis||"x",g=d.includeInvisible||!1,b=d.intersect?_M(a,s,t,r,g):yM(a,s,t,!1,r,g),M=[];return b.length?(a.getSortedVisibleDatasetMetas().forEach(k=>{let L=b[0].index,G=k.data[L];G&&!G.skip&&M.push({element:G,datasetIndex:k.index,index:L})}),M):[]},dataset(a,n,d,r){let s=th(n,a),t=d.axis||"xy",g=d.includeInvisible||!1,b=d.intersect?_M(a,s,t,r,g):yM(a,s,t,!1,r,g);if(b.length>0){let M=b[0].datasetIndex,k=a.getDatasetMeta(M).data;b=[];for(let L=0;L<k.length;++L)b.push({element:k[L],datasetIndex:M,index:L})}return b},point(a,n,d,r){let s=th(n,a),t=d.axis||"xy",g=d.includeInvisible||!1;return _M(a,s,t,r,g)},nearest(a,n,d,r){let s=th(n,a),t=d.axis||"xy",g=d.includeInvisible||!1;return yM(a,s,t,d.intersect,r,g)},x(a,n,d,r){let s=th(n,a);return XR(a,s,"x",d.intersect,r)},y(a,n,d,r){let s=th(n,a);return XR(a,s,"y",d.intersect,r)}}},WF=["left","top","right","bottom"];function b0(a,n){return a.filter(d=>d.pos===n)}function KR(a,n){return a.filter(d=>WF.indexOf(d.pos)===-1&&d.box.axis===n)}function v0(a,n){return a.sort((d,r)=>{let s=n?r:d,t=n?d:r;return s.weight===t.weight?s.index-t.index:s.weight-t.weight})}function XH(a){let n=[],d,r,s,t,g,b;for(d=0,r=(a||[]).length;d<r;++d)s=a[d],{position:t,options:{stack:g,stackWeight:b=1}}=s,n.push({index:d,box:s,pos:t,horizontal:s.isHorizontal(),weight:s.weight,stack:g&&t+g,stackWeight:b});return n}function KH(a){let n={};for(let d of a){let{stack:r,pos:s,stackWeight:t}=d;if(!r||!WF.includes(s))continue;let g=n[r]||(n[r]={count:0,placed:0,weight:0,size:0});g.count++,g.weight+=t}return n}function QH(a,n){let d=KH(a),{vBoxMaxWidth:r,hBoxMaxHeight:s}=n,t,g,b;for(t=0,g=a.length;t<g;++t){b=a[t];let{fullSize:M}=b.box,k=d[b.stack],L=k&&b.stackWeight/k.weight;b.horizontal?(b.width=L?L*r:M&&n.availableWidth,b.height=s):(b.width=r,b.height=L?L*s:M&&n.availableHeight)}return d}function JH(a){let n=XH(a),d=v0(n.filter(k=>k.box.fullSize),!0),r=v0(b0(n,"left"),!0),s=v0(b0(n,"right")),t=v0(b0(n,"top"),!0),g=v0(b0(n,"bottom")),b=KR(n,"x"),M=KR(n,"y");return{fullSize:d,leftAndTop:r.concat(t),rightAndBottom:s.concat(M).concat(g).concat(b),chartArea:b0(n,"chartArea"),vertical:r.concat(s).concat(M),horizontal:t.concat(g).concat(b)}}function QR(a,n,d,r){return Math.max(a[d],n[d])+Math.max(a[r],n[r])}function GF(a,n){a.top=Math.max(a.top,n.top),a.left=Math.max(a.left,n.left),a.bottom=Math.max(a.bottom,n.bottom),a.right=Math.max(a.right,n.right)}function eW(a,n,d,r){let{pos:s,box:t}=d,g=a.maxPadding;if(!fn(s)){d.size&&(a[s]-=d.size);let G=r[d.stack]||{size:0,count:1};G.size=Math.max(G.size,d.horizontal?t.height:t.width),d.size=G.size/G.count,a[s]+=d.size}t.getPadding&&GF(g,t.getPadding());let b=Math.max(0,n.outerWidth-QR(g,a,"left","right")),M=Math.max(0,n.outerHeight-QR(g,a,"top","bottom")),k=b!==a.w,L=M!==a.h;return a.w=b,a.h=M,d.horizontal?{same:k,other:L}:{same:L,other:k}}function tW(a){let n=a.maxPadding;function d(r){let s=Math.max(n[r]-a[r],0);return a[r]+=s,s}a.y+=d("top"),a.x+=d("left"),d("right"),d("bottom")}function iW(a,n){let d=n.maxPadding;function r(s){let t={left:0,top:0,right:0,bottom:0};return s.forEach(g=>{t[g]=Math.max(n[g],d[g])}),t}return r(a?["left","right"]:["top","bottom"])}function C0(a,n,d,r){let s=[],t,g,b,M,k,L;for(t=0,g=a.length,k=0;t<g;++t){b=a[t],M=b.box,M.update(b.width||n.w,b.height||n.h,iW(b.horizontal,n));let{same:G,other:J}=eW(n,d,b,r);k|=G&&s.length,L=L||J,M.fullSize||s.push(b)}return k&&C0(s,n,d,r)||L}function wx(a,n,d,r,s){a.top=d,a.left=n,a.right=n+r,a.bottom=d+s,a.width=r,a.height=s}function JR(a,n,d,r){let s=d.padding,{x:t,y:g}=n;for(let b of a){let M=b.box,k=r[b.stack]||{count:1,placed:0,weight:1},L=b.stackWeight/k.weight||1;if(b.horizontal){let G=n.w*L,J=k.size||M.height;Xm(k.start)&&(g=k.start),M.fullSize?wx(M,s.left,g,d.outerWidth-s.right-s.left,J):wx(M,n.left+k.placed,g,G,J),k.start=g,k.placed+=G,g=M.bottom}else{let G=n.h*L,J=k.size||M.width;Xm(k.start)&&(t=k.start),M.fullSize?wx(M,t,s.top,J,d.outerHeight-s.bottom-s.top):wx(M,t,n.top+k.placed,J,G),k.start=t,k.placed+=G,t=M.right}}n.x=t,n.y=g}var Vo={addBox(a,n){a.boxes||(a.boxes=[]),n.fullSize=n.fullSize||!1,n.position=n.position||"top",n.weight=n.weight||0,n._layers=n._layers||function(){return[{z:0,draw(d){n.draw(d)}}]},a.boxes.push(n)},removeBox(a,n){let d=a.boxes?a.boxes.indexOf(n):-1;d!==-1&&a.boxes.splice(d,1)},configure(a,n,d){n.fullSize=d.fullSize,n.position=d.position,n.weight=d.weight},update(a,n,d,r){if(!a)return;let s=Io(a.options.layout.padding),t=Math.max(n-s.width,0),g=Math.max(d-s.height,0),b=JH(a.boxes),M=b.vertical,k=b.horizontal;Vn(a.boxes,Me=>{typeof Me.beforeLayout=="function"&&Me.beforeLayout()});let L=M.reduce((Me,Te)=>Te.box.options&&Te.box.options.display===!1?Me:Me+1,0)||1,G=Object.freeze({outerWidth:n,outerHeight:d,padding:s,availableWidth:t,availableHeight:g,vBoxMaxWidth:t/2/L,hBoxMaxHeight:g/2}),J=Object.assign({},s);GF(J,Io(r));let oe=Object.assign({maxPadding:J,w:t,h:g,x:s.left,y:s.top},s),be=QH(M.concat(k),G);C0(b.fullSize,oe,G,be),C0(M,oe,G,be),C0(k,oe,G,be)&&C0(M,oe,G,be),tW(oe),JR(b.leftAndTop,oe,G,be),oe.x+=oe.w,oe.y+=oe.h,JR(b.rightAndBottom,oe,G,be),a.chartArea={left:oe.left,top:oe.top,right:oe.left+oe.w,bottom:oe.top+oe.h,height:oe.h,width:oe.w},Vn(b.chartArea,Me=>{let Te=Me.box;Object.assign(Te,a.chartArea),Te.update(oe.w,oe.h,{left:0,top:0,right:0,bottom:0})})}},Px=class{acquireContext(n,d){}releaseContext(n){return!1}addEventListener(n,d,r){}removeEventListener(n,d,r){}getDevicePixelRatio(){return 1}getMaximumSize(n,d,r,s){return d=Math.max(0,d||n.width),r=r||n.height,{width:d,height:Math.max(0,s?Math.floor(d/s):r)}}isAttached(n){return!0}updateConfig(n){}},TM=class extends Px{acquireContext(n){return n&&n.getContext&&n.getContext("2d")||null}updateConfig(n){n.options.animation=!1}},Dx="$chartjs",nW={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},eF=a=>a===null||a==="";function rW(a,n){let d=a.style,r=a.getAttribute("height"),s=a.getAttribute("width");if(a[Dx]={initial:{height:r,width:s,style:{display:d.display,height:d.height,width:d.width}}},d.display=d.display||"block",d.boxSizing=d.boxSizing||"border-box",eF(s)){let t=cM(a,"width");t!==void 0&&(a.width=t)}if(eF(r))if(a.style.height==="")a.height=a.width/(n||2);else{let t=cM(a,"height");t!==void 0&&(a.height=t)}return a}var $F=FR?{passive:!0}:!1;function oW(a,n,d){a&&a.addEventListener(n,d,$F)}function aW(a,n,d){a&&a.canvas&&a.canvas.removeEventListener(n,d,$F)}function sW(a,n){let d=nW[a.type]||a.type,{x:r,y:s}=th(a,n);return{type:d,chart:n,native:a,x:r!==void 0?r:null,y:s!==void 0?s:null}}function Ox(a,n){for(let d of a)if(d===n||d.contains(n))return!0}function lW(a,n,d){let r=a.canvas,s=new MutationObserver(t=>{let g=!1;for(let b of t)g=g||Ox(b.addedNodes,r),g=g&&!Ox(b.removedNodes,r);g&&d()});return s.observe(document,{childList:!0,subtree:!0}),s}function cW(a,n,d){let r=a.canvas,s=new MutationObserver(t=>{let g=!1;for(let b of t)g=g||Ox(b.removedNodes,r),g=g&&!Ox(b.addedNodes,r);g&&d()});return s.observe(document,{childList:!0,subtree:!0}),s}var M0=new Map,tF=0;function qF(){let a=window.devicePixelRatio;a!==tF&&(tF=a,M0.forEach((n,d)=>{d.currentDevicePixelRatio!==a&&n()}))}function dW(a,n){M0.size||window.addEventListener("resize",qF),M0.set(a,n)}function hW(a){M0.delete(a),M0.size||window.removeEventListener("resize",qF)}function uW(a,n,d){let r=a.canvas,s=r&&vx(r);if(!s)return;let t=X2((b,M)=>{let k=s.clientWidth;d(b,M),k<s.clientWidth&&d()},window),g=new ResizeObserver(b=>{let M=b[0],k=M.contentRect.width,L=M.contentRect.height;k===0&&L===0||t(k,L)});return g.observe(s),dW(a,t),g}function bM(a,n,d){d&&d.disconnect(),n==="resize"&&hW(a)}function pW(a,n,d){let r=a.canvas,s=X2(t=>{a.ctx!==null&&d(sW(t,a))},a);return oW(r,n,s),s}var IM=class extends Px{acquireContext(n,d){let r=n&&n.getContext&&n.getContext("2d");return r&&r.canvas===n?(rW(n,d),r):null}releaseContext(n){let d=n.canvas;if(!d[Dx])return!1;let r=d[Dx].initial;["height","width"].forEach(t=>{let g=r[t];Sn(g)?d.removeAttribute(t):d.setAttribute(t,g)});let s=r.style||{};return Object.keys(s).forEach(t=>{d.style[t]=s[t]}),d.width=d.width,delete d[Dx],!0}addEventListener(n,d,r){this.removeEventListener(n,d);let s=n.$proxies||(n.$proxies={}),g={attach:lW,detach:cW,resize:uW}[d]||pW;s[d]=g(n,d,r)}removeEventListener(n,d){let r=n.$proxies||(n.$proxies={}),s=r[d];if(!s)return;({attach:bM,detach:bM,resize:bM}[d]||aW)(n,d,s),r[d]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(n,d,r,s){return RR(n,d,r,s)}isAttached(n){let d=n&&vx(n);return!!(d&&d.isConnected)}};function mW(a){return!bx()||typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas?TM:IM}var Ps=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(n){let{x:d,y:r}=this.getProps(["x","y"],n);return{x:d,y:r}}hasValue(){return Fu(this.x)&&Fu(this.y)}getProps(n,d){let r=this.$animations;if(!d||!r)return this;let s={};return n.forEach(t=>{s[t]=r[t]&&r[t].active()?r[t]._to:this[t]}),s}};function fW(a,n){let d=a.options.ticks,r=gW(a),s=Math.min(d.maxTicksLimit||r,r),t=d.major.enabled?yW(n):[],g=t.length,b=t[0],M=t[g-1],k=[];if(g>s)return bW(n,k,t,g/s),k;let L=_W(t,n,s);if(g>0){let G,J,oe=g>1?Math.round((M-b)/(g-1)):null;for(Cx(n,k,L,Sn(oe)?0:b-oe,b),G=0,J=g-1;G<J;G++)Cx(n,k,L,t[G],t[G+1]);return Cx(n,k,L,M,Sn(oe)?n.length:M+oe),k}return Cx(n,k,L),k}function gW(a){let n=a.options.offset,d=a._tickSize(),r=a._length/d+(n?0:1),s=a._maxLength/d;return Math.floor(Math.min(r,s))}function _W(a,n,d){let r=vW(a),s=n.length/d;if(!r)return Math.max(s,1);let t=fR(r);for(let g=0,b=t.length-1;g<b;g++){let M=t[g];if(M>s)return M}return Math.max(s,1)}function yW(a){let n=[],d,r;for(d=0,r=a.length;d<r;d++)a[d].major&&n.push(d);return n}function bW(a,n,d,r){let s=0,t=d[0],g;for(r=Math.ceil(r),g=0;g<a.length;g++)g===t&&(n.push(a[g]),s++,t=d[s*r])}function Cx(a,n,d,r,s){let t=en(r,0),g=Math.min(en(s,a.length),a.length),b=0,M,k,L;for(d=Math.ceil(d),s&&(M=s-r,d=M/Math.floor(M/d)),L=t;L<0;)b++,L=Math.round(t+b*d);for(k=Math.max(t,0);k<g;k++)k===L&&(n.push(a[k]),b++,L=Math.round(t+b*d))}function vW(a){let n=a.length,d,r;if(n<2)return!1;for(r=a[0],d=1;d<n;++d)if(a[d]-a[d-1]!==r)return!1;return r}var xW=a=>a==="left"?"right":a==="right"?"left":a,iF=(a,n,d)=>n==="top"||n==="left"?a[n]+d:a[n]-d,nF=(a,n)=>Math.min(n||a,a);function rF(a,n){let d=[],r=a.length/n,s=a.length,t=0;for(;t<s;t+=r)d.push(a[Math.floor(t)]);return d}function wW(a,n,d){let r=a.ticks.length,s=Math.min(n,r-1),t=a._startPixel,g=a._endPixel,b=1e-6,M=a.getPixelForTick(s),k;if(!(d&&(r===1?k=Math.max(M-t,g-M):n===0?k=(a.getPixelForTick(1)-M)/2:k=(M-a.getPixelForTick(s-1))/2,M+=s<n?k:-k,M<t-b||M>g+b)))return M}function CW(a,n){Vn(a,d=>{let r=d.gc,s=r.length/2,t;if(s>n){for(t=0;t<s;++t)delete d.data[r[t]];r.splice(0,s)}})}function x0(a){return a.drawTicks?a.tickLength:0}function oF(a,n){if(!a.display)return 0;let d=Wr(a.font,n),r=Io(a.padding);return(ir(a.text)?a.text.length:1)*d.lineHeight+r.height}function SW(a,n){return pc(a,{scale:n,type:"scale"})}function MW(a,n,d){return pc(a,{tick:d,index:n,type:"tick"})}function TW(a,n,d){let r=mx(a);return(d&&n!=="right"||!d&&n==="right")&&(r=xW(r)),r}function IW(a,n,d,r){let{top:s,left:t,bottom:g,right:b,chart:M}=a,{chartArea:k,scales:L}=M,G=0,J,oe,be,Me=g-s,Te=b-t;if(a.isHorizontal()){if(oe=To(r,t,b),fn(d)){let He=Object.keys(d)[0],We=d[He];be=L[He].getPixelForValue(We)+Me-n}else d==="center"?be=(k.bottom+k.top)/2+Me-n:be=iF(a,d,n);J=b-t}else{if(fn(d)){let He=Object.keys(d)[0],We=d[He];oe=L[He].getPixelForValue(We)-Te+n}else d==="center"?oe=(k.left+k.right)/2-Te+n:oe=iF(a,d,n);be=To(r,g,s),G=d==="left"?-Tr:Tr}return{titleX:oe,titleY:be,maxWidth:J,rotation:G}}var Nu=class a extends Ps{constructor(n){super(),this.id=n.id,this.type=n.type,this.options=void 0,this.ctx=n.ctx,this.chart=n.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(n){this.options=n.setContext(this.getContext()),this.axis=n.axis,this._userMin=this.parse(n.min),this._userMax=this.parse(n.max),this._suggestedMin=this.parse(n.suggestedMin),this._suggestedMax=this.parse(n.suggestedMax)}parse(n,d){return n}getUserBounds(){let{_userMin:n,_userMax:d,_suggestedMin:r,_suggestedMax:s}=this;return n=pa(n,Number.POSITIVE_INFINITY),d=pa(d,Number.NEGATIVE_INFINITY),r=pa(r,Number.POSITIVE_INFINITY),s=pa(s,Number.NEGATIVE_INFINITY),{min:pa(n,r),max:pa(d,s),minDefined:yr(n),maxDefined:yr(d)}}getMinMax(n){let{min:d,max:r,minDefined:s,maxDefined:t}=this.getUserBounds(),g;if(s&&t)return{min:d,max:r};let b=this.getMatchingVisibleMetas();for(let M=0,k=b.length;M<k;++M)g=b[M].controller.getMinMax(this,n),s||(d=Math.min(d,g.min)),t||(r=Math.max(r,g.max));return d=t&&d>r?r:d,r=s&&d>r?d:r,{min:pa(d,pa(r,d)),max:pa(r,pa(d,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let n=this.chart.data;return this.options.labels||(this.isHorizontal()?n.xLabels:n.yLabels)||n.labels||[]}getLabelItems(n=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(n))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Yn(this.options.beforeUpdate,[this])}update(n,d,r){let{beginAtZero:s,grace:t,ticks:g}=this.options,b=g.sampleSize;this.beforeUpdate(),this.maxWidth=n,this.maxHeight=d,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=ER(this,t,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let M=b<this.ticks.length;this._convertTicksToLabels(M?rF(this.ticks,b):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),g.display&&(g.autoSkip||g.source==="auto")&&(this.ticks=fW(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),M&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let n=this.options.reverse,d,r;this.isHorizontal()?(d=this.left,r=this.right):(d=this.top,r=this.bottom,n=!n),this._startPixel=d,this._endPixel=r,this._reversePixels=n,this._length=r-d,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Yn(this.options.afterUpdate,[this])}beforeSetDimensions(){Yn(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Yn(this.options.afterSetDimensions,[this])}_callHooks(n){this.chart.notifyPlugins(n,this.getContext()),Yn(this.options[n],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Yn(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(n){let d=this.options.ticks,r,s,t;for(r=0,s=n.length;r<s;r++)t=n[r],t.label=Yn(d.callback,[t.value,r,n],this)}afterTickToLabelConversion(){Yn(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Yn(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let n=this.options,d=n.ticks,r=nF(this.ticks.length,n.ticks.maxTicksLimit),s=d.minRotation||0,t=d.maxRotation,g=s,b,M,k;if(!this._isVisible()||!d.display||s>=t||r<=1||!this.isHorizontal()){this.labelRotation=s;return}let L=this._getLabelSizes(),G=L.widest.width,J=L.highest.height,oe=Jr(this.chart.width-G,0,this.maxWidth);b=n.offset?this.maxWidth/r:oe/(r-1),G+6>b&&(b=oe/(r-(n.offset?.5:1)),M=this.maxHeight-x0(n.grid)-d.padding-oF(n.title,this.chart.options.font),k=Math.sqrt(G*G+J*J),g=ux(Math.min(Math.asin(Jr((L.highest.height+6)/b,-1,1)),Math.asin(Jr(M/k,-1,1))-Math.asin(Jr(J/k,-1,1)))),g=Math.max(s,Math.min(t,g))),this.labelRotation=g}afterCalculateLabelRotation(){Yn(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Yn(this.options.beforeFit,[this])}fit(){let n={width:0,height:0},{chart:d,options:{ticks:r,title:s,grid:t}}=this,g=this._isVisible(),b=this.isHorizontal();if(g){let M=oF(s,d.options.font);if(b?(n.width=this.maxWidth,n.height=x0(t)+M):(n.height=this.maxHeight,n.width=x0(t)+M),r.display&&this.ticks.length){let{first:k,last:L,widest:G,highest:J}=this._getLabelSizes(),oe=r.padding*2,be=as(this.labelRotation),Me=Math.cos(be),Te=Math.sin(be);if(b){let He=r.mirror?0:Te*G.width+Me*J.height;n.height=Math.min(this.maxHeight,n.height+He+oe)}else{let He=r.mirror?0:Me*G.width+Te*J.height;n.width=Math.min(this.maxWidth,n.width+He+oe)}this._calculatePadding(k,L,Te,Me)}}this._handleMargins(),b?(this.width=this._length=d.width-this._margins.left-this._margins.right,this.height=n.height):(this.width=n.width,this.height=this._length=d.height-this._margins.top-this._margins.bottom)}_calculatePadding(n,d,r,s){let{ticks:{align:t,padding:g},position:b}=this.options,M=this.labelRotation!==0,k=b!=="top"&&this.axis==="x";if(this.isHorizontal()){let L=this.getPixelForTick(0)-this.left,G=this.right-this.getPixelForTick(this.ticks.length-1),J=0,oe=0;M?k?(J=s*n.width,oe=r*d.height):(J=r*n.height,oe=s*d.width):t==="start"?oe=d.width:t==="end"?J=n.width:t!=="inner"&&(J=n.width/2,oe=d.width/2),this.paddingLeft=Math.max((J-L+g)*this.width/(this.width-L),0),this.paddingRight=Math.max((oe-G+g)*this.width/(this.width-G),0)}else{let L=d.height/2,G=n.height/2;t==="start"?(L=0,G=n.height):t==="end"&&(L=d.height,G=0),this.paddingTop=L+g,this.paddingBottom=G+g}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Yn(this.options.afterFit,[this])}isHorizontal(){let{axis:n,position:d}=this.options;return d==="top"||d==="bottom"||n==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(n){this.beforeTickToLabelConversion(),this.generateTickLabels(n);let d,r;for(d=0,r=n.length;d<r;d++)Sn(n[d].label)&&(n.splice(d,1),r--,d--);this.afterTickToLabelConversion()}_getLabelSizes(){let n=this._labelSizes;if(!n){let d=this.options.ticks.sampleSize,r=this.ticks;d<r.length&&(r=rF(r,d)),this._labelSizes=n=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return n}_computeLabelSizes(n,d,r){let{ctx:s,_longestTextCache:t}=this,g=[],b=[],M=Math.floor(d/nF(d,r)),k=0,L=0,G,J,oe,be,Me,Te,He,We,dt,bt,ft;for(G=0;G<d;G+=M){if(be=n[G].label,Me=this._resolveTickFontOptions(G),s.font=Te=Me.string,He=t[Te]=t[Te]||{data:{},gc:[]},We=Me.lineHeight,dt=bt=0,!Sn(be)&&!ir(be))dt=p0(s,He.data,He.gc,dt,be),bt=We;else if(ir(be))for(J=0,oe=be.length;J<oe;++J)ft=be[J],!Sn(ft)&&!ir(ft)&&(dt=p0(s,He.data,He.gc,dt,ft),bt+=We);g.push(dt),b.push(bt),k=Math.max(dt,k),L=Math.max(bt,L)}CW(t,d);let It=g.indexOf(k),Wt=b.indexOf(L),xt=Xt=>({width:g[Xt]||0,height:b[Xt]||0});return{first:xt(0),last:xt(d-1),widest:xt(It),highest:xt(Wt),widths:g,heights:b}}getLabelForValue(n){return n}getPixelForValue(n,d){return NaN}getValueForPixel(n){}getPixelForTick(n){let d=this.ticks;return n<0||n>d.length-1?null:this.getPixelForValue(d[n].value)}getPixelForDecimal(n){this._reversePixels&&(n=1-n);let d=this._startPixel+n*this._length;return _R(this._alignToPixels?Qd(this.chart,d,0):d)}getDecimalForPixel(n){let d=(n-this._startPixel)/this._length;return this._reversePixels?1-d:d}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:n,max:d}=this;return n<0&&d<0?d:n>0&&d>0?n:0}getContext(n){let d=this.ticks||[];if(n>=0&&n<d.length){let r=d[n];return r.$context||(r.$context=MW(this.getContext(),n,r))}return this.$context||(this.$context=SW(this.chart.getContext(),this))}_tickSize(){let n=this.options.ticks,d=as(this.labelRotation),r=Math.abs(Math.cos(d)),s=Math.abs(Math.sin(d)),t=this._getLabelSizes(),g=n.autoSkipPadding||0,b=t?t.widest.width+g:0,M=t?t.highest.height+g:0;return this.isHorizontal()?M*r>b*s?b/r:M/s:M*s<b*r?M/r:b/s}_isVisible(){let n=this.options.display;return n!=="auto"?!!n:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(n){let d=this.axis,r=this.chart,s=this.options,{grid:t,position:g,border:b}=s,M=t.offset,k=this.isHorizontal(),G=this.ticks.length+(M?1:0),J=x0(t),oe=[],be=b.setContext(this.getContext()),Me=be.display?be.width:0,Te=Me/2,He=function(sn){return Qd(r,sn,Me)},We,dt,bt,ft,It,Wt,xt,Xt,Vt,Oi,Xi,lr;if(g==="top")We=He(this.bottom),Wt=this.bottom-J,Xt=We-Te,Oi=He(n.top)+Te,lr=n.bottom;else if(g==="bottom")We=He(this.top),Oi=n.top,lr=He(n.bottom)-Te,Wt=We+Te,Xt=this.top+J;else if(g==="left")We=He(this.right),It=this.right-J,xt=We-Te,Vt=He(n.left)+Te,Xi=n.right;else if(g==="right")We=He(this.left),Vt=n.left,Xi=He(n.right)-Te,It=We+Te,xt=this.left+J;else if(d==="x"){if(g==="center")We=He((n.top+n.bottom)/2+.5);else if(fn(g)){let sn=Object.keys(g)[0],Hn=g[sn];We=He(this.chart.scales[sn].getPixelForValue(Hn))}Oi=n.top,lr=n.bottom,Wt=We+Te,Xt=Wt+J}else if(d==="y"){if(g==="center")We=He((n.left+n.right)/2);else if(fn(g)){let sn=Object.keys(g)[0],Hn=g[sn];We=He(this.chart.scales[sn].getPixelForValue(Hn))}It=We-Te,xt=It-J,Vt=n.left,Xi=n.right}let Mi=en(s.ticks.maxTicksLimit,G),gn=Math.max(1,Math.ceil(G/Mi));for(dt=0;dt<G;dt+=gn){let sn=this.getContext(dt),Hn=t.setContext(sn),Gr=b.setContext(sn),Zn=Hn.lineWidth,Ri=Hn.color,ga=Gr.dash||[],Xn=Gr.dashOffset,Fa=Hn.tickWidth,Zo=Hn.tickColor,La=Hn.tickBorderDash||[],$t=Hn.tickBorderDashOffset;bt=wW(this,dt,M),bt!==void 0&&(ft=Qd(r,bt,Zn),k?It=xt=Vt=Xi=ft:Wt=Xt=Oi=lr=ft,oe.push({tx1:It,ty1:Wt,tx2:xt,ty2:Xt,x1:Vt,y1:Oi,x2:Xi,y2:lr,width:Zn,color:Ri,borderDash:ga,borderDashOffset:Xn,tickWidth:Fa,tickColor:Zo,tickBorderDash:La,tickBorderDashOffset:$t}))}return this._ticksLength=G,this._borderValue=We,oe}_computeLabelItems(n){let d=this.axis,r=this.options,{position:s,ticks:t}=r,g=this.isHorizontal(),b=this.ticks,{align:M,crossAlign:k,padding:L,mirror:G}=t,J=x0(r.grid),oe=J+L,be=G?-L:oe,Me=-as(this.labelRotation),Te=[],He,We,dt,bt,ft,It,Wt,xt,Xt,Vt,Oi,Xi,lr="middle";if(s==="top")It=this.bottom-be,Wt=this._getXAxisLabelAlignment();else if(s==="bottom")It=this.top+be,Wt=this._getXAxisLabelAlignment();else if(s==="left"){let gn=this._getYAxisLabelAlignment(J);Wt=gn.textAlign,ft=gn.x}else if(s==="right"){let gn=this._getYAxisLabelAlignment(J);Wt=gn.textAlign,ft=gn.x}else if(d==="x"){if(s==="center")It=(n.top+n.bottom)/2+oe;else if(fn(s)){let gn=Object.keys(s)[0],sn=s[gn];It=this.chart.scales[gn].getPixelForValue(sn)+oe}Wt=this._getXAxisLabelAlignment()}else if(d==="y"){if(s==="center")ft=(n.left+n.right)/2-oe;else if(fn(s)){let gn=Object.keys(s)[0],sn=s[gn];ft=this.chart.scales[gn].getPixelForValue(sn)}Wt=this._getYAxisLabelAlignment(J).textAlign}d==="y"&&(M==="start"?lr="top":M==="end"&&(lr="bottom"));let Mi=this._getLabelSizes();for(He=0,We=b.length;He<We;++He){dt=b[He],bt=dt.label;let gn=t.setContext(this.getContext(He));xt=this.getPixelForTick(He)+t.labelOffset,Xt=this._resolveTickFontOptions(He),Vt=Xt.lineHeight,Oi=ir(bt)?bt.length:1;let sn=Oi/2,Hn=gn.color,Gr=gn.textStrokeColor,Zn=gn.textStrokeWidth,Ri=Wt;g?(ft=xt,Wt==="inner"&&(He===We-1?Ri=this.options.reverse?"left":"right":He===0?Ri=this.options.reverse?"right":"left":Ri="center"),s==="top"?k==="near"||Me!==0?Xi=-Oi*Vt+Vt/2:k==="center"?Xi=-Mi.highest.height/2-sn*Vt+Vt:Xi=-Mi.highest.height+Vt/2:k==="near"||Me!==0?Xi=Vt/2:k==="center"?Xi=Mi.highest.height/2-sn*Vt:Xi=Mi.highest.height-Oi*Vt,G&&(Xi*=-1),Me!==0&&!gn.showLabelBackdrop&&(ft+=Vt/2*Math.sin(Me))):(It=xt,Xi=(1-Oi)*Vt/2);let ga;if(gn.showLabelBackdrop){let Xn=Io(gn.backdropPadding),Fa=Mi.heights[He],Zo=Mi.widths[He],La=Xi-Xn.top,$t=0-Xn.left;switch(lr){case"middle":La-=Fa/2;break;case"bottom":La-=Fa;break}switch(Wt){case"center":$t-=Zo/2;break;case"right":$t-=Zo;break;case"inner":He===We-1?$t-=Zo:He>0&&($t-=Zo/2);break}ga={left:$t,top:La,width:Zo+Xn.width,height:Fa+Xn.height,color:gn.backdropColor}}Te.push({label:bt,font:Xt,textOffset:Xi,options:{rotation:Me,color:Hn,strokeColor:Gr,strokeWidth:Zn,textAlign:Ri,textBaseline:lr,translation:[ft,It],backdrop:ga}})}return Te}_getXAxisLabelAlignment(){let{position:n,ticks:d}=this.options;if(-as(this.labelRotation))return n==="top"?"left":"right";let s="center";return d.align==="start"?s="left":d.align==="end"?s="right":d.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(n){let{position:d,ticks:{crossAlign:r,mirror:s,padding:t}}=this.options,g=this._getLabelSizes(),b=n+t,M=g.widest.width,k,L;return d==="left"?s?(L=this.right+t,r==="near"?k="left":r==="center"?(k="center",L+=M/2):(k="right",L+=M)):(L=this.right-b,r==="near"?k="right":r==="center"?(k="center",L-=M/2):(k="left",L=this.left)):d==="right"?s?(L=this.left+t,r==="near"?k="right":r==="center"?(k="center",L-=M/2):(k="left",L-=M)):(L=this.left+b,r==="near"?k="left":r==="center"?(k="center",L+=M/2):(k="right",L=this.right)):k="right",{textAlign:k,x:L}}_computeLabelArea(){if(this.options.ticks.mirror)return;let n=this.chart,d=this.options.position;if(d==="left"||d==="right")return{top:0,left:this.left,bottom:n.height,right:this.right};if(d==="top"||d==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:n.width}}drawBackground(){let{ctx:n,options:{backgroundColor:d},left:r,top:s,width:t,height:g}=this;d&&(n.save(),n.fillStyle=d,n.fillRect(r,s,t,g),n.restore())}getLineWidthForValue(n){let d=this.options.grid;if(!this._isVisible()||!d.display)return 0;let s=this.ticks.findIndex(t=>t.value===n);return s>=0?d.setContext(this.getContext(s)).lineWidth:0}drawGrid(n){let d=this.options.grid,r=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(n)),t,g,b=(M,k,L)=>{!L.width||!L.color||(r.save(),r.lineWidth=L.width,r.strokeStyle=L.color,r.setLineDash(L.borderDash||[]),r.lineDashOffset=L.borderDashOffset,r.beginPath(),r.moveTo(M.x,M.y),r.lineTo(k.x,k.y),r.stroke(),r.restore())};if(d.display)for(t=0,g=s.length;t<g;++t){let M=s[t];d.drawOnChartArea&&b({x:M.x1,y:M.y1},{x:M.x2,y:M.y2},M),d.drawTicks&&b({x:M.tx1,y:M.ty1},{x:M.tx2,y:M.ty2},{color:M.tickColor,width:M.tickWidth,borderDash:M.tickBorderDash,borderDashOffset:M.tickBorderDashOffset})}}drawBorder(){let{chart:n,ctx:d,options:{border:r,grid:s}}=this,t=r.setContext(this.getContext()),g=r.display?t.width:0;if(!g)return;let b=s.setContext(this.getContext(0)).lineWidth,M=this._borderValue,k,L,G,J;this.isHorizontal()?(k=Qd(n,this.left,g)-g/2,L=Qd(n,this.right,b)+b/2,G=J=M):(G=Qd(n,this.top,g)-g/2,J=Qd(n,this.bottom,b)+b/2,k=L=M),d.save(),d.lineWidth=t.width,d.strokeStyle=t.color,d.beginPath(),d.moveTo(k,G),d.lineTo(L,J),d.stroke(),d.restore()}drawLabels(n){if(!this.options.ticks.display)return;let r=this.ctx,s=this._computeLabelArea();s&&g0(r,s);let t=this.getLabelItems(n);for(let g of t){let b=g.options,M=g.font,k=g.label,L=g.textOffset;Jd(r,k,0,L,M,b)}s&&_0(r)}drawTitle(){let{ctx:n,options:{position:d,title:r,reverse:s}}=this;if(!r.display)return;let t=Wr(r.font),g=Io(r.padding),b=r.align,M=t.lineHeight/2;d==="bottom"||d==="center"||fn(d)?(M+=g.bottom,ir(r.text)&&(M+=t.lineHeight*(r.text.length-1))):M+=g.top;let{titleX:k,titleY:L,maxWidth:G,rotation:J}=IW(this,M,d,b);Jd(n,r.text,0,0,t,{color:r.color,maxWidth:G,rotation:J,textAlign:TW(b,d,s),textBaseline:"middle",translation:[k,L]})}draw(n){this._isVisible()&&(this.drawBackground(),this.drawGrid(n),this.drawBorder(),this.drawTitle(),this.drawLabels(n))}_layers(){let n=this.options,d=n.ticks&&n.ticks.z||0,r=en(n.grid&&n.grid.z,-1),s=en(n.border&&n.border.z,0);return!this._isVisible()||this.draw!==a.prototype.draw?[{z:d,draw:t=>{this.draw(t)}}]:[{z:r,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:d,draw:t=>{this.drawLabels(t)}}]}getMatchingVisibleMetas(n){let d=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",s=[],t,g;for(t=0,g=d.length;t<g;++t){let b=d[t];b[r]===this.id&&(!n||b.type===n)&&s.push(b)}return s}_resolveTickFontOptions(n){let d=this.options.ticks.setContext(this.getContext(n));return Wr(d.font)}_maxDigits(){let n=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/n}},rf=class{constructor(n,d,r){this.type=n,this.scope=d,this.override=r,this.items=Object.create(null)}isForType(n){return Object.prototype.isPrototypeOf.call(this.type.prototype,n.prototype)}register(n){let d=Object.getPrototypeOf(n),r;kW(d)&&(r=this.register(d));let s=this.items,t=n.id,g=this.scope+"."+t;if(!t)throw new Error("class does not have id: "+n);return t in s||(s[t]=n,EW(n,g,r),this.override&&br.override(n.id,n.overrides)),g}get(n){return this.items[n]}unregister(n){let d=this.items,r=n.id,s=this.scope;r in d&&delete d[r],s&&r in br[s]&&(delete br[s][r],this.override&&delete Kd[r])}};function EW(a,n,d){let r=qm(Object.create(null),[d?br.get(d):{},br.get(n),a.defaults]);br.set(n,r),a.defaultRoutes&&DW(n,a.defaultRoutes),a.descriptors&&br.describe(n,a.descriptors)}function DW(a,n){Object.keys(n).forEach(d=>{let r=d.split("."),s=r.pop(),t=[a].concat(r).join("."),g=n[d].split("."),b=g.pop(),M=g.join(".");br.route(t,s,M,b)})}function kW(a){return"id"in a&&"defaults"in a}var EM=class{constructor(){this.controllers=new rf(nh,"datasets",!0),this.elements=new rf(Ps,"elements"),this.plugins=new rf(Object,"plugins"),this.scales=new rf(Nu,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...n){this._each("register",n)}remove(...n){this._each("unregister",n)}addControllers(...n){this._each("register",n,this.controllers)}addElements(...n){this._each("register",n,this.elements)}addPlugins(...n){this._each("register",n,this.plugins)}addScales(...n){this._each("register",n,this.scales)}getController(n){return this._get(n,this.controllers,"controller")}getElement(n){return this._get(n,this.elements,"element")}getPlugin(n){return this._get(n,this.plugins,"plugin")}getScale(n){return this._get(n,this.scales,"scale")}removeControllers(...n){this._each("unregister",n,this.controllers)}removeElements(...n){this._each("unregister",n,this.elements)}removePlugins(...n){this._each("unregister",n,this.plugins)}removeScales(...n){this._each("unregister",n,this.scales)}_each(n,d,r){[...d].forEach(s=>{let t=r||this._getRegistryForType(s);r||t.isForType(s)||t===this.plugins&&s.id?this._exec(n,t,s):Vn(s,g=>{let b=r||this._getRegistryForType(g);this._exec(n,b,g)})})}_exec(n,d,r){let s=hx(n);Yn(r["before"+s],[],r),d[n](r),Yn(r["after"+s],[],r)}_getRegistryForType(n){for(let d=0;d<this._typedRegistries.length;d++){let r=this._typedRegistries[d];if(r.isForType(n))return r}return this.plugins}_get(n,d,r){let s=d.get(n);if(s===void 0)throw new Error('"'+n+'" is not a registered '+r+".");return s}},gl=new EM,DM=class{constructor(){this._init=[]}notify(n,d,r,s){d==="beforeInit"&&(this._init=this._createDescriptors(n,!0),this._notify(this._init,n,"install"));let t=s?this._descriptors(n).filter(s):this._descriptors(n),g=this._notify(t,n,d,r);return d==="afterDestroy"&&(this._notify(t,n,"stop"),this._notify(this._init,n,"uninstall")),g}_notify(n,d,r,s){s=s||{};for(let t of n){let g=t.plugin,b=g[r],M=[d,s,t.options];if(Yn(b,M,g)===!1&&s.cancelable)return!1}return!0}invalidate(){Sn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(n){if(this._cache)return this._cache;let d=this._cache=this._createDescriptors(n);return this._notifyStateChanges(n),d}_createDescriptors(n,d){let r=n&&n.config,s=en(r.options&&r.options.plugins,{}),t=AW(r);return s===!1&&!d?[]:OW(n,t,s,d)}_notifyStateChanges(n){let d=this._oldCache||[],r=this._cache,s=(t,g)=>t.filter(b=>!g.some(M=>b.plugin.id===M.plugin.id));this._notify(s(d,r),n,"stop"),this._notify(s(r,d),n,"start")}};function AW(a){let n={},d=[],r=Object.keys(gl.plugins.items);for(let t=0;t<r.length;t++)d.push(gl.getPlugin(r[t]));let s=a.plugins||[];for(let t=0;t<s.length;t++){let g=s[t];d.indexOf(g)===-1&&(d.push(g),n[g.id]=!0)}return{plugins:d,localIds:n}}function PW(a,n){return!n&&a===!1?null:a===!0?{}:a}function OW(a,{plugins:n,localIds:d},r,s){let t=[],g=a.getContext();for(let b of n){let M=b.id,k=PW(r[M],s);k!==null&&t.push({plugin:b,options:RW(a.config,{plugin:b,local:d[M]},k,g)})}return t}function RW(a,{plugin:n,local:d},r,s){let t=a.pluginScopeKeys(n),g=a.getOptionScopes(r,t);return d&&n.defaults&&g.push(n.defaults),a.createResolver(g,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function kM(a,n){let d=br.datasets[a]||{};return((n.datasets||{})[a]||{}).indexAxis||n.indexAxis||d.indexAxis||"x"}function FW(a,n){let d=a;return a==="_index_"?d=n:a==="_value_"&&(d=n==="x"?"y":"x"),d}function LW(a,n){return a===n?"_index_":"_value_"}function aF(a){if(a==="x"||a==="y"||a==="r")return a}function zW(a){if(a==="top"||a==="bottom")return"x";if(a==="left"||a==="right")return"y"}function AM(a,...n){if(aF(a))return a;for(let d of n){let r=d.axis||zW(d.position)||a.length>1&&aF(a[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${a}' axis. Please provide 'axis' or 'position' option.`)}function sF(a,n,d){if(d[n+"AxisID"]===a)return{axis:n}}function BW(a,n){if(n.data&&n.data.datasets){let d=n.data.datasets.filter(r=>r.xAxisID===a||r.yAxisID===a);if(d.length)return sF(a,"x",d[0])||sF(a,"y",d[0])}return{}}function NW(a,n){let d=Kd[a.type]||{scales:{}},r=n.scales||{},s=kM(a.type,n),t=Object.create(null);return Object.keys(r).forEach(g=>{let b=r[g];if(!fn(b))return console.error(`Invalid scale configuration for scale: ${g}`);if(b._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${g}`);let M=AM(g,b,BW(g,a),br.scales[b.type]),k=LW(M,s),L=d.scales||{};t[g]=Zm(Object.create(null),[{axis:M},b,L[M],L[k]])}),a.data.datasets.forEach(g=>{let b=g.type||a.type,M=g.indexAxis||kM(b,n),L=(Kd[b]||{}).scales||{};Object.keys(L).forEach(G=>{let J=FW(G,M),oe=g[J+"AxisID"]||J;t[oe]=t[oe]||Object.create(null),Zm(t[oe],[{axis:J},r[oe],L[G]])})}),Object.keys(t).forEach(g=>{let b=t[g];Zm(b,[br.scales[b.type],br.scale])}),t}function YF(a){let n=a.options||(a.options={});n.plugins=en(n.plugins,{}),n.scales=NW(a,n)}function ZF(a){return a=a||{},a.datasets=a.datasets||[],a.labels=a.labels||[],a}function VW(a){return a=a||{},a.data=ZF(a.data),YF(a),a}var lF=new Map,XF=new Set;function Sx(a,n){let d=lF.get(a);return d||(d=n(),lF.set(a,d),XF.add(d)),d}var w0=(a,n,d)=>{let r=uc(n,d);r!==void 0&&a.add(r)},PM=class{constructor(n){this._config=VW(n),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(n){this._config.type=n}get data(){return this._config.data}set data(n){this._config.data=ZF(n)}get options(){return this._config.options}set options(n){this._config.options=n}get plugins(){return this._config.plugins}update(){let n=this._config;this.clearCache(),YF(n)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(n){return Sx(n,()=>[[`datasets.${n}`,""]])}datasetAnimationScopeKeys(n,d){return Sx(`${n}.transition.${d}`,()=>[[`datasets.${n}.transitions.${d}`,`transitions.${d}`],[`datasets.${n}`,""]])}datasetElementScopeKeys(n,d){return Sx(`${n}-${d}`,()=>[[`datasets.${n}.elements.${d}`,`datasets.${n}`,`elements.${d}`,""]])}pluginScopeKeys(n){let d=n.id,r=this.type;return Sx(`${r}-plugin-${d}`,()=>[[`plugins.${d}`,...n.additionalOptionScopes||[]]])}_cachedScopes(n,d){let r=this._scopeCache,s=r.get(n);return(!s||d)&&(s=new Map,r.set(n,s)),s}getOptionScopes(n,d,r){let{options:s,type:t}=this,g=this._cachedScopes(n,r),b=g.get(d);if(b)return b;let M=new Set;d.forEach(L=>{n&&(M.add(n),L.forEach(G=>w0(M,n,G))),L.forEach(G=>w0(M,s,G)),L.forEach(G=>w0(M,Kd[t]||{},G)),L.forEach(G=>w0(M,br,G)),L.forEach(G=>w0(M,fx,G))});let k=Array.from(M);return k.length===0&&k.push(Object.create(null)),XF.has(d)&&g.set(d,k),k}chartOptionScopes(){let{options:n,type:d}=this;return[n,Kd[d]||{},br.datasets[d]||{},{type:d},br,fx]}resolveNamedOptions(n,d,r,s=[""]){let t={$shared:!0},{resolver:g,subPrefixes:b}=cF(this._resolverCache,n,s),M=g;if(UW(g,d)){t.$shared=!1,r=dc(r)?r():r;let k=this.createResolver(n,r,b);M=Ru(g,r,k)}for(let k of d)t[k]=M[k];return t}createResolver(n,d,r=[""],s){let{resolver:t}=cF(this._resolverCache,n,r);return fn(d)?Ru(t,d,void 0,s):t}};function cF(a,n,d){let r=a.get(n);r||(r=new Map,a.set(n,r));let s=d.join(),t=r.get(s);return t||(t={resolver:yx(n,d),subPrefixes:d.filter(b=>!b.toLowerCase().includes("hover"))},r.set(s,t)),t}var jW=a=>fn(a)&&Object.getOwnPropertyNames(a).some(n=>dc(a[n]));function UW(a,n){let{isScriptable:d,isIndexable:r}=rM(a);for(let s of n){let t=d(s),g=r(s),b=(g||t)&&a[s];if(t&&(dc(b)||jW(b))||g&&ir(b))return!0}return!1}var HW="4.4.3",WW=["top","bottom","left","right","chartArea"];function dF(a,n){return a==="top"||a==="bottom"||WW.indexOf(a)===-1&&n==="x"}function hF(a,n){return function(d,r){return d[a]===r[a]?d[n]-r[n]:d[a]-r[a]}}function uF(a){let n=a.chart,d=n.options.animation;n.notifyPlugins("afterRender"),Yn(d&&d.onComplete,[a],n)}function GW(a){let n=a.chart,d=n.options.animation;Yn(d&&d.onProgress,[a],n)}function KF(a){return bx()&&typeof a=="string"?a=document.getElementById(a):a&&a.length&&(a=a[0]),a&&a.canvas&&(a=a.canvas),a}var kx={},pF=a=>{let n=KF(a);return Object.values(kx).filter(d=>d.canvas===n).pop()};function $W(a,n,d){let r=Object.keys(a);for(let s of r){let t=+s;if(t>=n){let g=a[s];delete a[s],(d>0||t>n)&&(a[t+d]=g)}}}function qW(a,n,d,r){return!d||a.type==="mouseout"?null:r?n:a}function Mx(a,n,d){return a.options.clip?a[d]:n[d]}function YW(a,n){let{xScale:d,yScale:r}=a;return d&&r?{left:Mx(d,n,"left"),right:Mx(d,n,"right"),top:Mx(r,n,"top"),bottom:Mx(r,n,"bottom")}:n}var af=(()=>{class a{static defaults=br;static instances=kx;static overrides=Kd;static registry=gl;static version=HW;static getChart=pF;static register(...d){gl.add(...d),mF()}static unregister(...d){gl.remove(...d),mF()}constructor(d,r){let s=this.config=new PM(r),t=KF(d),g=pF(t);if(g)throw new Error("Canvas is already in use. Chart with ID '"+g.id+"' must be destroyed before the canvas with ID '"+g.canvas.id+"' can be reused.");let b=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||mW(t)),this.platform.updateConfig(s);let M=this.platform.acquireContext(t,b.aspectRatio),k=M&&M.canvas,L=k&&k.height,G=k&&k.width;if(this.id=hR(),this.ctx=M,this.canvas=k,this.width=G,this.height=L,this._options=b,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new DM,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=wR(J=>this.update(J),b.resizeDelay||0),this._dataChanges=[],kx[this.id]=this,!M||!k){console.error("Failed to create chart: can't acquire context from the given item");return}mc.listen(this,"complete",uF),mc.listen(this,"progress",GW),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:d,maintainAspectRatio:r},width:s,height:t,_aspectRatio:g}=this;return Sn(d)?r&&g?g:t?s/t:null:d}get data(){return this.config.data}set data(d){this.config.data=d}get options(){return this._options}set options(d){this.config.options=d}get registry(){return gl}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():lM(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return tM(this.canvas,this.ctx),this}stop(){return mc.stop(this),this}resize(d,r){mc.running(this)?this._resizeBeforeDraw={width:d,height:r}:this._resize(d,r)}_resize(d,r){let s=this.options,t=this.canvas,g=s.maintainAspectRatio&&this.aspectRatio,b=this.platform.getMaximumSize(t,d,r,g),M=s.devicePixelRatio||this.platform.getDevicePixelRatio(),k=this.width?"resize":"attach";this.width=b.width,this.height=b.height,this._aspectRatio=this.aspectRatio,lM(this,M,!0)&&(this.notifyPlugins("resize",{size:b}),Yn(s.onResize,[this,b],this),this.attached&&this._doResize(k)&&this.render())}ensureScalesHaveIDs(){let r=this.options.scales||{};Vn(r,(s,t)=>{s.id=t})}buildOrUpdateScales(){let d=this.options,r=d.scales,s=this.scales,t=Object.keys(s).reduce((b,M)=>(b[M]=!1,b),{}),g=[];r&&(g=g.concat(Object.keys(r).map(b=>{let M=r[b],k=AM(b,M),L=k==="r",G=k==="x";return{options:M,dposition:L?"chartArea":G?"bottom":"left",dtype:L?"radialLinear":G?"category":"linear"}}))),Vn(g,b=>{let M=b.options,k=M.id,L=AM(k,M),G=en(M.type,b.dtype);(M.position===void 0||dF(M.position,L)!==dF(b.dposition))&&(M.position=b.dposition),t[k]=!0;let J=null;if(k in s&&s[k].type===G)J=s[k];else{let oe=gl.getScale(G);J=new oe({id:k,type:G,ctx:this.ctx,chart:this}),s[J.id]=J}J.init(M,d)}),Vn(t,(b,M)=>{b||delete s[M]}),Vn(s,b=>{Vo.configure(this,b,b.options),Vo.addBox(this,b)})}_updateMetasets(){let d=this._metasets,r=this.data.datasets.length,s=d.length;if(d.sort((t,g)=>t.index-g.index),s>r){for(let t=r;t<s;++t)this._destroyDatasetMeta(t);d.splice(r,s-r)}this._sortedMetasets=d.slice(0).sort(hF("order","index"))}_removeUnreferencedMetasets(){let{_metasets:d,data:{datasets:r}}=this;d.length>r.length&&delete this._stacks,d.forEach((s,t)=>{r.filter(g=>g===s._dataset).length===0&&this._destroyDatasetMeta(t)})}buildOrUpdateControllers(){let d=[],r=this.data.datasets,s,t;for(this._removeUnreferencedMetasets(),s=0,t=r.length;s<t;s++){let g=r[s],b=this.getDatasetMeta(s),M=g.type||this.config.type;if(b.type&&b.type!==M&&(this._destroyDatasetMeta(s),b=this.getDatasetMeta(s)),b.type=M,b.indexAxis=g.indexAxis||kM(M,this.options),b.order=g.order||0,b.index=s,b.label=""+g.label,b.visible=this.isDatasetVisible(s),b.controller)b.controller.updateIndex(s),b.controller.linkScales();else{let k=gl.getController(M),{datasetElementType:L,dataElementType:G}=br.datasets[M];Object.assign(k,{dataElementType:gl.getElement(G),datasetElementType:L&&gl.getElement(L)}),b.controller=new k(this,s),d.push(b.controller)}}return this._updateMetasets(),d}_resetElements(){Vn(this.data.datasets,(d,r)=>{this.getDatasetMeta(r).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(d){let r=this.config;r.update();let s=this._options=r.createResolver(r.chartOptionScopes(),this.getContext()),t=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:d,cancelable:!0})===!1)return;let g=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let b=0;for(let L=0,G=this.data.datasets.length;L<G;L++){let{controller:J}=this.getDatasetMeta(L),oe=!t&&g.indexOf(J)===-1;J.buildOrUpdateElements(oe),b=Math.max(+J.getMaxOverflow(),b)}b=this._minPadding=s.layout.autoPadding?b:0,this._updateLayout(b),t||Vn(g,L=>{L.reset()}),this._updateDatasets(d),this.notifyPlugins("afterUpdate",{mode:d}),this._layers.sort(hF("z","_idx"));let{_active:M,_lastEvent:k}=this;k?this._eventHandler(k,!0):M.length&&this._updateHoverStyles(M,M,!0),this.render()}_updateScales(){Vn(this.scales,d=>{Vo.removeBox(this,d)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let d=this.options,r=new Set(Object.keys(this._listeners)),s=new Set(d.events);(!U2(r,s)||!!this._responsiveListeners!==d.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:d}=this,r=this._getUniformDataChanges()||[];for(let{method:s,start:t,count:g}of r){let b=s==="_removeElements"?-g:g;$W(d,t,b)}}_getUniformDataChanges(){let d=this._dataChanges;if(!d||!d.length)return;this._dataChanges=[];let r=this.data.datasets.length,s=g=>new Set(d.filter(b=>b[0]===g).map((b,M)=>M+","+b.splice(1).join(","))),t=s(0);for(let g=1;g<r;g++)if(!U2(t,s(g)))return;return Array.from(t).map(g=>g.split(",")).map(g=>({method:g[1],start:+g[2],count:+g[3]}))}_updateLayout(d){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Vo.update(this,this.width,this.height,d);let r=this.chartArea,s=r.width<=0||r.height<=0;this._layers=[],Vn(this.boxes,t=>{s&&t.position==="chartArea"||(t.configure&&t.configure(),this._layers.push(...t._layers()))},this),this._layers.forEach((t,g)=>{t._idx=g}),this.notifyPlugins("afterLayout")}_updateDatasets(d){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:d,cancelable:!0})!==!1){for(let r=0,s=this.data.datasets.length;r<s;++r)this.getDatasetMeta(r).controller.configure();for(let r=0,s=this.data.datasets.length;r<s;++r)this._updateDataset(r,dc(d)?d({datasetIndex:r}):d);this.notifyPlugins("afterDatasetsUpdate",{mode:d})}}_updateDataset(d,r){let s=this.getDatasetMeta(d),t={meta:s,index:d,mode:r,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",t)!==!1&&(s.controller._update(r),t.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",t))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(mc.has(this)?this.attached&&!mc.running(this)&&mc.start(this):(this.draw(),uF({chart:this})))}draw(){let d;if(this._resizeBeforeDraw){let{width:s,height:t}=this._resizeBeforeDraw;this._resize(s,t),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let r=this._layers;for(d=0;d<r.length&&r[d].z<=0;++d)r[d].draw(this.chartArea);for(this._drawDatasets();d<r.length;++d)r[d].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(d){let r=this._sortedMetasets,s=[],t,g;for(t=0,g=r.length;t<g;++t){let b=r[t];(!d||b.visible)&&s.push(b)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let d=this.getSortedVisibleDatasetMetas();for(let r=d.length-1;r>=0;--r)this._drawDataset(d[r]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(d){let r=this.ctx,s=d._clip,t=!s.disabled,g=YW(d,this.chartArea),b={meta:d,index:d.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",b)!==!1&&(t&&g0(r,{left:s.left===!1?0:g.left-s.left,right:s.right===!1?this.width:g.right+s.right,top:s.top===!1?0:g.top-s.top,bottom:s.bottom===!1?this.height:g.bottom+s.bottom}),d.controller.draw(),t&&_0(r),b.cancelable=!1,this.notifyPlugins("afterDatasetDraw",b))}isPointInArea(d){return ul(d,this.chartArea,this._minPadding)}getElementsAtEventForMode(d,r,s,t){let g=ZH.modes[r];return typeof g=="function"?g(this,d,s,t):[]}getDatasetMeta(d){let r=this.data.datasets[d],s=this._metasets,t=s.filter(g=>g&&g._dataset===r).pop();return t||(t={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:r&&r.order||0,index:d,_dataset:r,_parsed:[],_sorted:!1},s.push(t)),t}getContext(){return this.$context||(this.$context=pc(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(d){let r=this.data.datasets[d];if(!r)return!1;let s=this.getDatasetMeta(d);return typeof s.hidden=="boolean"?!s.hidden:!r.hidden}setDatasetVisibility(d,r){let s=this.getDatasetMeta(d);s.hidden=!r}toggleDataVisibility(d){this._hiddenIndices[d]=!this._hiddenIndices[d]}getDataVisibility(d){return!this._hiddenIndices[d]}_updateVisibility(d,r,s){let t=s?"show":"hide",g=this.getDatasetMeta(d),b=g.controller._resolveAnimations(void 0,t);Xm(r)?(g.data[r].hidden=!s,this.update()):(this.setDatasetVisibility(d,s),b.update(g,{visible:s}),this.update(M=>M.datasetIndex===d?t:void 0))}hide(d,r){this._updateVisibility(d,r,!1)}show(d,r){this._updateVisibility(d,r,!0)}_destroyDatasetMeta(d){let r=this._metasets[d];r&&r.controller&&r.controller._destroy(),delete this._metasets[d]}_stop(){let d,r;for(this.stop(),mc.remove(this),d=0,r=this.data.datasets.length;d<r;++d)this._destroyDatasetMeta(d)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:d,ctx:r}=this;this._stop(),this.config.clearCache(),d&&(this.unbindEvents(),tM(d,r),this.platform.releaseContext(r),this.canvas=null,this.ctx=null),delete kx[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...d){return this.canvas.toDataURL(...d)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let d=this._listeners,r=this.platform,s=(g,b)=>{r.addEventListener(this,g,b),d[g]=b},t=(g,b,M)=>{g.offsetX=b,g.offsetY=M,this._eventHandler(g)};Vn(this.options.events,g=>s(g,t))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let d=this._responsiveListeners,r=this.platform,s=(k,L)=>{r.addEventListener(this,k,L),d[k]=L},t=(k,L)=>{d[k]&&(r.removeEventListener(this,k,L),delete d[k])},g=(k,L)=>{this.canvas&&this.resize(k,L)},b,M=()=>{t("attach",M),this.attached=!0,this.resize(),s("resize",g),s("detach",b)};b=()=>{this.attached=!1,t("resize",g),this._stop(),this._resize(0,0),s("attach",M)},r.isAttached(this.canvas)?M():b()}unbindEvents(){Vn(this._listeners,(d,r)=>{this.platform.removeEventListener(this,r,d)}),this._listeners={},Vn(this._responsiveListeners,(d,r)=>{this.platform.removeEventListener(this,r,d)}),this._responsiveListeners=void 0}updateHoverStyle(d,r,s){let t=s?"set":"remove",g,b,M,k;for(r==="dataset"&&(g=this.getDatasetMeta(d[0].datasetIndex),g.controller["_"+t+"DatasetHoverStyle"]()),M=0,k=d.length;M<k;++M){b=d[M];let L=b&&this.getDatasetMeta(b.datasetIndex).controller;L&&L[t+"HoverStyle"](b.element,b.datasetIndex,b.index)}}getActiveElements(){return this._active||[]}setActiveElements(d){let r=this._active||[],s=d.map(({datasetIndex:g,index:b})=>{let M=this.getDatasetMeta(g);if(!M)throw new Error("No dataset found at index "+g);return{datasetIndex:g,element:M.data[b],index:b}});!m0(s,r)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,r))}notifyPlugins(d,r,s){return this._plugins.notify(this,d,r,s)}isPluginEnabled(d){return this._plugins._cache.filter(r=>r.plugin.id===d).length===1}_updateHoverStyles(d,r,s){let t=this.options.hover,g=(k,L)=>k.filter(G=>!L.some(J=>G.datasetIndex===J.datasetIndex&&G.index===J.index)),b=g(r,d),M=s?d:g(d,r);b.length&&this.updateHoverStyle(b,t.mode,!1),M.length&&t.mode&&this.updateHoverStyle(M,t.mode,!0)}_eventHandler(d,r){let s={event:d,replay:r,cancelable:!0,inChartArea:this.isPointInArea(d)},t=b=>(b.options.events||this.options.events).includes(d.native.type);if(this.notifyPlugins("beforeEvent",s,t)===!1)return;let g=this._handleEvent(d,r,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,t),(g||s.changed)&&this.render(),this}_handleEvent(d,r,s){let{_active:t=[],options:g}=this,b=r,M=this._getActiveElements(d,t,s,b),k=mR(d),L=qW(d,this._lastEvent,s,k);s&&(this._lastEvent=null,Yn(g.onHover,[d,M,this],this),k&&Yn(g.onClick,[d,M,this],this));let G=!m0(M,t);return(G||r)&&(this._active=M,this._updateHoverStyles(M,t,r)),this._lastEvent=L,G}_getActiveElements(d,r,s,t){if(d.type==="mouseout")return[];if(!s)return r;let g=this.options.hover;return this.getElementsAtEventForMode(d,g.mode,g,t)}}return a})();function mF(){return Vn(af.instances,a=>a._plugins.invalidate())}function ZW(a,n,d){let{startAngle:r,pixelMargin:s,x:t,y:g,outerRadius:b,innerRadius:M}=n,k=s/b;a.beginPath(),a.arc(t,g,b,r-k,d+k),M>s?(k=s/M,a.arc(t,g,M,d+k,r-k,!0)):a.arc(t,g,s,d+Tr,r-Tr),a.closePath(),a.clip()}function XW(a){return _x(a,["outerStart","outerEnd","innerStart","innerEnd"])}function KW(a,n,d,r){let s=XW(a.options.borderRadius),t=(d-n)/2,g=Math.min(t,r*n/2),b=M=>{let k=(d-Math.min(t,M))*r/2;return Jr(M,0,Math.min(t,k))};return{outerStart:b(s.outerStart),outerEnd:b(s.outerEnd),innerStart:Jr(s.innerStart,0,g),innerEnd:Jr(s.innerEnd,0,g)}}function nf(a,n,d,r){return{x:d+a*Math.cos(n),y:r+a*Math.sin(n)}}function Rx(a,n,d,r,s,t){let{x:g,y:b,startAngle:M,pixelMargin:k,innerRadius:L}=n,G=Math.max(n.outerRadius+r+d-k,0),J=L>0?L+r+d+k:0,oe=0,be=s-M;if(r){let gn=L>0?L-r:0,sn=G>0?G-r:0,Hn=(gn+sn)/2,Gr=Hn!==0?be*Hn/(Hn+r):be;oe=(be-Gr)/2}let Me=Math.max(.001,be*G-d/nr)/G,Te=(be-Me)/2,He=M+Te+oe,We=s-Te-oe,{outerStart:dt,outerEnd:bt,innerStart:ft,innerEnd:It}=KW(n,J,G,We-He),Wt=G-dt,xt=G-bt,Xt=He+dt/Wt,Vt=We-bt/xt,Oi=J+ft,Xi=J+It,lr=He+ft/Oi,Mi=We-It/Xi;if(a.beginPath(),t){let gn=(Xt+Vt)/2;if(a.arc(g,b,G,Xt,gn),a.arc(g,b,G,gn,Vt),bt>0){let Zn=nf(xt,Vt,g,b);a.arc(Zn.x,Zn.y,bt,Vt,We+Tr)}let sn=nf(Xi,We,g,b);if(a.lineTo(sn.x,sn.y),It>0){let Zn=nf(Xi,Mi,g,b);a.arc(Zn.x,Zn.y,It,We+Tr,Mi+Math.PI)}let Hn=(We-It/J+(He+ft/J))/2;if(a.arc(g,b,J,We-It/J,Hn,!0),a.arc(g,b,J,Hn,He+ft/J,!0),ft>0){let Zn=nf(Oi,lr,g,b);a.arc(Zn.x,Zn.y,ft,lr+Math.PI,He-Tr)}let Gr=nf(Wt,He,g,b);if(a.lineTo(Gr.x,Gr.y),dt>0){let Zn=nf(Wt,Xt,g,b);a.arc(Zn.x,Zn.y,dt,He-Tr,Xt)}}else{a.moveTo(g,b);let gn=Math.cos(Xt)*G+g,sn=Math.sin(Xt)*G+b;a.lineTo(gn,sn);let Hn=Math.cos(Vt)*G+g,Gr=Math.sin(Vt)*G+b;a.lineTo(Hn,Gr)}a.closePath()}function QW(a,n,d,r,s){let{fullCircles:t,startAngle:g,circumference:b}=n,M=n.endAngle;if(t){Rx(a,n,d,r,M,s);for(let k=0;k<t;++k)a.fill();isNaN(b)||(M=g+(b%rr||rr))}return Rx(a,n,d,r,M,s),a.fill(),M}function JW(a,n,d,r,s){let{fullCircles:t,startAngle:g,circumference:b,options:M}=n,{borderWidth:k,borderJoinStyle:L,borderDash:G,borderDashOffset:J}=M,oe=M.borderAlign==="inner";if(!k)return;a.setLineDash(G||[]),a.lineDashOffset=J,oe?(a.lineWidth=k*2,a.lineJoin=L||"round"):(a.lineWidth=k,a.lineJoin=L||"bevel");let be=n.endAngle;if(t){Rx(a,n,d,r,be,s);for(let Me=0;Me<t;++Me)a.stroke();isNaN(b)||(be=g+(b%rr||rr))}oe&&ZW(a,n,be),t||(Rx(a,n,d,r,be,s),a.stroke())}var OM=class extends Ps{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:n=>n!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(n){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,n&&Object.assign(this,n)}inRange(n,d,r){let s=this.getProps(["x","y"],r),{angle:t,distance:g}=$2(s,{x:n,y:d}),{startAngle:b,endAngle:M,innerRadius:k,outerRadius:L,circumference:G}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],r),J=(this.options.spacing+this.options.borderWidth)/2,be=en(G,M-b)>=rr||Qm(t,b,M),Me=ml(g,k+J,L+J);return be&&Me}getCenterPoint(n){let{x:d,y:r,startAngle:s,endAngle:t,innerRadius:g,outerRadius:b}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],n),{offset:M,spacing:k}=this.options,L=(s+t)/2,G=(g+b+k+M)/2;return{x:d+Math.cos(L)*G,y:r+Math.sin(L)*G}}tooltipPosition(n){return this.getCenterPoint(n)}draw(n){let{options:d,circumference:r}=this,s=(d.offset||0)/4,t=(d.spacing||0)/2,g=d.circular;if(this.pixelMargin=d.borderAlign==="inner"?.33:0,this.fullCircles=r>rr?Math.floor(r/rr):0,r===0||this.innerRadius<0||this.outerRadius<0)return;n.save();let b=(this.startAngle+this.endAngle)/2;n.translate(Math.cos(b)*s,Math.sin(b)*s);let M=1-Math.sin(Math.min(nr,r||0)),k=s*M;n.fillStyle=d.backgroundColor,n.strokeStyle=d.borderColor,QW(n,this,k,t,g),JW(n,this,k,t,g),n.restore()}};function QF(a,n,d=n){a.lineCap=en(d.borderCapStyle,n.borderCapStyle),a.setLineDash(en(d.borderDash,n.borderDash)),a.lineDashOffset=en(d.borderDashOffset,n.borderDashOffset),a.lineJoin=en(d.borderJoinStyle,n.borderJoinStyle),a.lineWidth=en(d.borderWidth,n.borderWidth),a.strokeStyle=en(d.borderColor,n.borderColor)}function e7(a,n,d){a.lineTo(d.x,d.y)}function t7(a){return a.stepped?TR:a.tension||a.cubicInterpolationMode==="monotone"?IR:e7}function JF(a,n,d={}){let r=a.length,{start:s=0,end:t=r-1}=d,{start:g,end:b}=n,M=Math.max(s,g),k=Math.min(t,b),L=s<g&&t<g||s>b&&t>b;return{count:r,start:M,loop:n.loop,ilen:k<M&&!L?r+k-M:k-M}}function i7(a,n,d,r){let{points:s,options:t}=n,{count:g,start:b,loop:M,ilen:k}=JF(s,d,r),L=t7(t),{move:G=!0,reverse:J}=r||{},oe,be,Me;for(oe=0;oe<=k;++oe)be=s[(b+(J?k-oe:oe))%g],!be.skip&&(G?(a.moveTo(be.x,be.y),G=!1):L(a,Me,be,J,t.stepped),Me=be);return M&&(be=s[(b+(J?k:0))%g],L(a,Me,be,J,t.stepped)),!!M}function n7(a,n,d,r){let s=n.points,{count:t,start:g,ilen:b}=JF(s,d,r),{move:M=!0,reverse:k}=r||{},L=0,G=0,J,oe,be,Me,Te,He,We=bt=>(g+(k?b-bt:bt))%t,dt=()=>{Me!==Te&&(a.lineTo(L,Te),a.lineTo(L,Me),a.lineTo(L,He))};for(M&&(oe=s[We(0)],a.moveTo(oe.x,oe.y)),J=0;J<=b;++J){if(oe=s[We(J)],oe.skip)continue;let bt=oe.x,ft=oe.y,It=bt|0;It===be?(ft<Me?Me=ft:ft>Te&&(Te=ft),L=(G*L+bt)/++G):(dt(),a.lineTo(bt,ft),be=It,G=0,Me=Te=ft),He=ft}dt()}function RM(a){let n=a.options,d=n.borderDash&&n.borderDash.length;return!a._decimated&&!a._loop&&!n.tension&&n.cubicInterpolationMode!=="monotone"&&!n.stepped&&!d?n7:i7}function r7(a){return a.stepped?LR:a.tension||a.cubicInterpolationMode==="monotone"?zR:Xd}function o7(a,n,d,r){let s=n._path;s||(s=n._path=new Path2D,n.path(s,d,r)&&s.closePath()),QF(a,n.options),a.stroke(s)}function a7(a,n,d,r){let{segments:s,options:t}=n,g=RM(n);for(let b of s)QF(a,t,b.style),a.beginPath(),g(a,n,b,{start:d,end:d+r-1})&&a.closePath(),a.stroke()}var s7=typeof Path2D=="function";function l7(a,n,d,r){s7&&!n.options.segment?o7(a,n,d,r):a7(a,n,d,r)}var zx=(()=>{class a extends Ps{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:d=>d!=="borderDash"&&d!=="fill"};constructor(d){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,d&&Object.assign(this,d)}updateControlPoints(d,r){let s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){let t=s.spanGaps?this._loop:this._fullLoop;OR(this._points,s,d,t,r),this._pointsUpdated=!0}}set points(d){this._points=d,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=NR(this,this.options.segment))}first(){let d=this.segments,r=this.points;return d.length&&r[d[0].start]}last(){let d=this.segments,r=this.points,s=d.length;return s&&r[d[s-1].end]}interpolate(d,r){let s=this.options,t=d[r],g=this.points,b=pM(this,{property:r,start:t,end:t});if(!b.length)return;let M=[],k=r7(s),L,G;for(L=0,G=b.length;L<G;++L){let{start:J,end:oe}=b[L],be=g[J],Me=g[oe];if(be===Me){M.push(be);continue}let Te=Math.abs((t-be[r])/(Me[r]-be[r])),He=k(be,Me,Te,s.stepped);He[r]=d[r],M.push(He)}return M.length===1?M[0]:M}pathSegment(d,r,s){return RM(this)(d,this,r,s)}path(d,r,s){let t=this.segments,g=RM(this),b=this._loop;r=r||0,s=s||this.points.length-r;for(let M of t)b&=g(d,this,M,{start:r,end:r+s-1});return!!b}draw(d,r,s,t){let g=this.options||{};(this.points||[]).length&&g.borderWidth&&(d.save(),l7(d,this,s,t),d.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return a})();function fF(a,n,d,r){let s=a.options,{[d]:t}=a.getProps([d],r);return Math.abs(n-t)<s.radius+s.hitRadius}var c7=(()=>{class a extends Ps{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(d){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,d&&Object.assign(this,d)}inRange(d,r,s){let t=this.options,{x:g,y:b}=this.getProps(["x","y"],s);return Math.pow(d-g,2)+Math.pow(r-b,2)<Math.pow(t.hitRadius+t.radius,2)}inXRange(d,r){return fF(this,d,"x",r)}inYRange(d,r){return fF(this,d,"y",r)}getCenterPoint(d){let{x:r,y:s}=this.getProps(["x","y"],d);return{x:r,y:s}}size(d){d=d||this.options||{};let r=d.radius||0;r=Math.max(r,r&&d.hoverRadius||0);let s=r&&d.borderWidth||0;return(r+s)*2}draw(d,r){let s=this.options;this.skip||s.radius<.1||!ul(this,r,this.size(s)/2)||(d.strokeStyle=s.borderColor,d.lineWidth=s.borderWidth,d.fillStyle=s.backgroundColor,gx(d,s,this.x,this.y))}getRange(){let d=this.options||{};return d.radius+d.hitRadius}}return a})();function eL(a,n){let{x:d,y:r,base:s,width:t,height:g}=a.getProps(["x","y","base","width","height"],n),b,M,k,L,G;return a.horizontal?(G=g/2,b=Math.min(d,s),M=Math.max(d,s),k=r-G,L=r+G):(G=t/2,b=d-G,M=d+G,k=Math.min(r,s),L=Math.max(r,s)),{left:b,top:k,right:M,bottom:L}}function ih(a,n,d,r){return a?0:Jr(n,d,r)}function d7(a,n,d){let r=a.options.borderWidth,s=a.borderSkipped,t=nM(r);return{t:ih(s.top,t.top,0,d),r:ih(s.right,t.right,0,n),b:ih(s.bottom,t.bottom,0,d),l:ih(s.left,t.left,0,n)}}function h7(a,n,d){let{enableBorderRadius:r}=a.getProps(["enableBorderRadius"]),s=a.options.borderRadius,t=eh(s),g=Math.min(n,d),b=a.borderSkipped,M=r||fn(s);return{topLeft:ih(!M||b.top||b.left,t.topLeft,0,g),topRight:ih(!M||b.top||b.right,t.topRight,0,g),bottomLeft:ih(!M||b.bottom||b.left,t.bottomLeft,0,g),bottomRight:ih(!M||b.bottom||b.right,t.bottomRight,0,g)}}function u7(a){let n=eL(a),d=n.right-n.left,r=n.bottom-n.top,s=d7(a,d/2,r/2),t=h7(a,d/2,r/2);return{outer:{x:n.left,y:n.top,w:d,h:r,radius:t},inner:{x:n.left+s.l,y:n.top+s.t,w:d-s.l-s.r,h:r-s.t-s.b,radius:{topLeft:Math.max(0,t.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,t.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,t.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,t.bottomRight-Math.max(s.b,s.r))}}}}function vM(a,n,d,r){let s=n===null,t=d===null,b=a&&!(s&&t)&&eL(a,r);return b&&(s||ml(n,b.left,b.right))&&(t||ml(d,b.top,b.bottom))}function p7(a){return a.topLeft||a.topRight||a.bottomLeft||a.bottomRight}function m7(a,n){a.rect(n.x,n.y,n.w,n.h)}function xM(a,n,d={}){let r=a.x!==d.x?-n:0,s=a.y!==d.y?-n:0,t=(a.x+a.w!==d.x+d.w?n:0)-r,g=(a.y+a.h!==d.y+d.h?n:0)-s;return{x:a.x+r,y:a.y+s,w:a.w+t,h:a.h+g,radius:a.radius}}var FM=class extends Ps{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(n){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,n&&Object.assign(this,n)}draw(n){let{inflateAmount:d,options:{borderColor:r,backgroundColor:s}}=this,{inner:t,outer:g}=u7(this),b=p7(g.radius)?ef:m7;n.save(),(g.w!==t.w||g.h!==t.h)&&(n.beginPath(),b(n,xM(g,d,t)),n.clip(),b(n,xM(t,-d,g)),n.fillStyle=r,n.fill("evenodd")),n.beginPath(),b(n,xM(t,d)),n.fillStyle=s,n.fill(),n.restore()}inRange(n,d,r){return vM(this,n,d,r)}inXRange(n,d){return vM(this,n,null,d)}inYRange(n,d){return vM(this,null,n,d)}getCenterPoint(n){let{x:d,y:r,base:s,horizontal:t}=this.getProps(["x","y","base","horizontal"],n);return{x:t?(d+s)/2:d,y:t?r:(r+s)/2}}getRange(n){return n==="x"?this.width/2:this.height/2}},f7=Object.freeze({__proto__:null,ArcElement:OM,BarElement:FM,LineElement:zx,PointElement:c7}),LM=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],gF=LM.map(a=>a.replace("rgb(","rgba(").replace(")",", 0.5)"));function tL(a){return LM[a%LM.length]}function iL(a){return gF[a%gF.length]}function g7(a,n){return a.borderColor=tL(n),a.backgroundColor=iL(n),++n}function _7(a,n){return a.backgroundColor=a.data.map(()=>tL(n++)),n}function y7(a,n){return a.backgroundColor=a.data.map(()=>iL(n++)),n}function b7(a){let n=0;return(d,r)=>{let s=a.getDatasetMeta(r).controller;s instanceof WM?n=_7(d,n):s instanceof HF?n=y7(d,n):s&&(n=g7(d,n))}}function _F(a){let n;for(n in a)if(a[n].borderColor||a[n].backgroundColor)return!0;return!1}function v7(a){return a&&(a.borderColor||a.backgroundColor)}var x7={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(a,n,d){if(!d.enabled)return;let{data:{datasets:r},options:s}=a.config,{elements:t}=s;if(!d.forceOverride&&(_F(r)||v7(s)||t&&_F(t)))return;let g=b7(a);r.forEach(g)}};function w7(a,n,d,r,s){let t=s.samples||r;if(t>=d)return a.slice(n,n+d);let g=[],b=(d-2)/(t-2),M=0,k=n+d-1,L=n,G,J,oe,be,Me;for(g[M++]=a[L],G=0;G<t-2;G++){let Te=0,He=0,We,dt=Math.floor((G+1)*b)+1+n,bt=Math.min(Math.floor((G+2)*b)+1,d)+n,ft=bt-dt;for(We=dt;We<bt;We++)Te+=a[We].x,He+=a[We].y;Te/=ft,He/=ft;let It=Math.floor(G*b)+1+n,Wt=Math.min(Math.floor((G+1)*b)+1,d)+n,{x:xt,y:Xt}=a[L];for(oe=be=-1,We=It;We<Wt;We++)be=.5*Math.abs((xt-Te)*(a[We].y-Xt)-(xt-a[We].x)*(He-Xt)),be>oe&&(oe=be,J=a[We],Me=We);g[M++]=J,L=Me}return g[M++]=a[k],g}function C7(a,n,d,r){let s=0,t=0,g,b,M,k,L,G,J,oe,be,Me,Te=[],He=n+d-1,We=a[n].x,bt=a[He].x-We;for(g=n;g<n+d;++g){b=a[g],M=(b.x-We)/bt*r,k=b.y;let ft=M|0;if(ft===L)k<be?(be=k,G=g):k>Me&&(Me=k,J=g),s=(t*s+b.x)/++t;else{let It=g-1;if(!Sn(G)&&!Sn(J)){let Wt=Math.min(G,J),xt=Math.max(G,J);Wt!==oe&&Wt!==It&&Te.push(Cn(kt({},a[Wt]),{x:s})),xt!==oe&&xt!==It&&Te.push(Cn(kt({},a[xt]),{x:s}))}g>0&&It!==oe&&Te.push(a[It]),Te.push(b),L=ft,t=0,be=Me=k,G=J=oe=g}}return Te}function nL(a){if(a._decimated){let n=a._data;delete a._decimated,delete a._data,Object.defineProperty(a,"data",{configurable:!0,enumerable:!0,writable:!0,value:n})}}function yF(a){a.data.datasets.forEach(n=>{nL(n)})}function S7(a,n){let d=n.length,r=0,s,{iScale:t}=a,{min:g,max:b,minDefined:M,maxDefined:k}=t.getUserBounds();return M&&(r=Jr(hl(n,t.axis,g).lo,0,d-1)),k?s=Jr(hl(n,t.axis,b).hi+1,r,d)-r:s=d-r,{start:r,count:s}}var M7={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(a,n,d)=>{if(!d.enabled){yF(a);return}let r=a.width;a.data.datasets.forEach((s,t)=>{let{_data:g,indexAxis:b}=s,M=a.getDatasetMeta(t),k=g||s.data;if(tf([b,a.options.indexAxis])==="y"||!M.controller.supportsDecimation)return;let L=a.scales[M.xAxisID];if(L.type!=="linear"&&L.type!=="time"||a.options.parsing)return;let{start:G,count:J}=S7(M,k),oe=d.threshold||4*r;if(J<=oe){nL(s);return}Sn(g)&&(s._data=k,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(Me){this._data=Me}}));let be;switch(d.algorithm){case"lttb":be=w7(k,G,J,r,d);break;case"min-max":be=C7(k,G,J,r);break;default:throw new Error(`Unsupported decimation algorithm '${d.algorithm}'`)}s._decimated=be})},destroy(a){yF(a)}};function T7(a,n,d){let r=a.segments,s=a.points,t=n.points,g=[];for(let b of r){let{start:M,end:k}=b;k=GM(M,k,s);let L=zM(d,s[M],s[k],b.loop);if(!n.segments){g.push({source:b,target:L,start:s[M],end:s[k]});continue}let G=pM(n,L);for(let J of G){let oe=zM(d,t[J.start],t[J.end],J.loop),be=uM(b,s,oe);for(let Me of be)g.push({source:Me,target:J,start:{[d]:bF(L,oe,"start",Math.max)},end:{[d]:bF(L,oe,"end",Math.min)}})}}return g}function zM(a,n,d,r){if(r)return;let s=n[a],t=d[a];return a==="angle"&&(s=ua(s),t=ua(t)),{property:a,start:s,end:t}}function I7(a,n){let{x:d=null,y:r=null}=a||{},s=n.points,t=[];return n.segments.forEach(({start:g,end:b})=>{b=GM(g,b,s);let M=s[g],k=s[b];r!==null?(t.push({x:M.x,y:r}),t.push({x:k.x,y:r})):d!==null&&(t.push({x:d,y:M.y}),t.push({x:d,y:k.y}))}),t}function GM(a,n,d){for(;n>a;n--){let r=d[n];if(!isNaN(r.x)&&!isNaN(r.y))break}return n}function bF(a,n,d,r){return a&&n?r(a[d],n[d]):a?a[d]:n?n[d]:0}function rL(a,n){let d=[],r=!1;return ir(a)?(r=!0,d=a):d=I7(a,n),d.length?new zx({points:d,options:{tension:0},_loop:r,_fullLoop:r}):null}function vF(a){return a&&a.fill!==!1}function E7(a,n,d){let s=a[n].fill,t=[n],g;if(!d)return s;for(;s!==!1&&t.indexOf(s)===-1;){if(!yr(s))return s;if(g=a[s],!g)return!1;if(g.visible)return s;t.push(s),s=g.fill}return!1}function D7(a,n,d){let r=O7(a);if(fn(r))return isNaN(r.value)?!1:r;let s=parseFloat(r);return yr(s)&&Math.floor(s)===s?k7(r[0],n,s,d):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function k7(a,n,d,r){return(a==="-"||a==="+")&&(d=n+d),d===n||d<0||d>=r?!1:d}function A7(a,n){let d=null;return a==="start"?d=n.bottom:a==="end"?d=n.top:fn(a)?d=n.getPixelForValue(a.value):n.getBasePixel&&(d=n.getBasePixel()),d}function P7(a,n,d){let r;return a==="start"?r=d:a==="end"?r=n.options.reverse?n.min:n.max:fn(a)?r=a.value:r=n.getBaseValue(),r}function O7(a){let n=a.options,d=n.fill,r=en(d&&d.target,d);return r===void 0&&(r=!!n.backgroundColor),r===!1||r===null?!1:r===!0?"origin":r}function R7(a){let{scale:n,index:d,line:r}=a,s=[],t=r.segments,g=r.points,b=F7(n,d);b.push(rL({x:null,y:n.bottom},r));for(let M=0;M<t.length;M++){let k=t[M];for(let L=k.start;L<=k.end;L++)L7(s,g[L],b)}return new zx({points:s,options:{}})}function F7(a,n){let d=[],r=a.getMatchingVisibleMetas("line");for(let s=0;s<r.length;s++){let t=r[s];if(t.index===n)break;t.hidden||d.unshift(t.dataset)}return d}function L7(a,n,d){let r=[];for(let s=0;s<d.length;s++){let t=d[s],{first:g,last:b,point:M}=z7(t,n,"x");if(!(!M||g&&b)){if(g)r.unshift(M);else if(a.push(M),!b)break}}a.push(...r)}function z7(a,n,d){let r=a.interpolate(n,d);if(!r)return{};let s=r[d],t=a.segments,g=a.points,b=!1,M=!1;for(let k=0;k<t.length;k++){let L=t[k],G=g[L.start][d],J=g[L.end][d];if(ml(s,G,J)){b=s===G,M=s===J;break}}return{first:b,last:M,point:r}}var Fx=class{constructor(n){this.x=n.x,this.y=n.y,this.radius=n.radius}pathSegment(n,d,r){let{x:s,y:t,radius:g}=this;return d=d||{start:0,end:rr},n.arc(s,t,g,d.end,d.start,!0),!r.bounds}interpolate(n){let{x:d,y:r,radius:s}=this,t=n.angle;return{x:d+Math.cos(t)*s,y:r+Math.sin(t)*s,angle:t}}};function B7(a){let{chart:n,fill:d,line:r}=a;if(yr(d))return N7(n,d);if(d==="stack")return R7(a);if(d==="shape")return!0;let s=V7(a);return s instanceof Fx?s:rL(s,r)}function N7(a,n){let d=a.getDatasetMeta(n);return d&&a.isDatasetVisible(n)?d.dataset:null}function V7(a){return(a.scale||{}).getPointPositionForValue?U7(a):j7(a)}function j7(a){let{scale:n={},fill:d}=a,r=A7(d,n);if(yr(r)){let s=n.isHorizontal();return{x:s?r:null,y:s?null:r}}return null}function U7(a){let{scale:n,fill:d}=a,r=n.options,s=n.getLabels().length,t=r.reverse?n.max:n.min,g=P7(d,n,t),b=[];if(r.grid.circular){let M=n.getPointPositionForValue(0,t);return new Fx({x:M.x,y:M.y,radius:n.getDistanceFromCenterForValue(g)})}for(let M=0;M<s;++M)b.push(n.getPointPositionForValue(M,g));return b}function wM(a,n,d){let r=B7(n),{line:s,scale:t,axis:g}=n,b=s.options,M=b.fill,k=b.backgroundColor,{above:L=k,below:G=k}=M||{};r&&s.points.length&&(g0(a,d),H7(a,{line:s,target:r,above:L,below:G,area:d,scale:t,axis:g}),_0(a))}function H7(a,n){let{line:d,target:r,above:s,below:t,area:g,scale:b}=n,M=d._loop?"angle":n.axis;a.save(),M==="x"&&t!==s&&(xF(a,r,g.top),wF(a,{line:d,target:r,color:s,scale:b,property:M}),a.restore(),a.save(),xF(a,r,g.bottom)),wF(a,{line:d,target:r,color:t,scale:b,property:M}),a.restore()}function xF(a,n,d){let{segments:r,points:s}=n,t=!0,g=!1;a.beginPath();for(let b of r){let{start:M,end:k}=b,L=s[M],G=s[GM(M,k,s)];t?(a.moveTo(L.x,L.y),t=!1):(a.lineTo(L.x,d),a.lineTo(L.x,L.y)),g=!!n.pathSegment(a,b,{move:g}),g?a.closePath():a.lineTo(G.x,d)}a.lineTo(n.first().x,d),a.closePath(),a.clip()}function wF(a,n){let{line:d,target:r,property:s,color:t,scale:g}=n,b=T7(d,r,s);for(let{source:M,target:k,start:L,end:G}of b){let{style:{backgroundColor:J=t}={}}=M,oe=r!==!0;a.save(),a.fillStyle=J,W7(a,g,oe&&zM(s,L,G)),a.beginPath();let be=!!d.pathSegment(a,M),Me;if(oe){be?a.closePath():CF(a,r,G,s);let Te=!!r.pathSegment(a,k,{move:be,reverse:!0});Me=be&&Te,Me||CF(a,r,L,s)}a.closePath(),a.fill(Me?"evenodd":"nonzero"),a.restore()}}function W7(a,n,d){let{top:r,bottom:s}=n.chart.chartArea,{property:t,start:g,end:b}=d||{};t==="x"&&(a.beginPath(),a.rect(g,r,b-g,s-r),a.clip())}function CF(a,n,d,r){let s=n.interpolate(d,r);s&&a.lineTo(s.x,s.y)}var G7={id:"filler",afterDatasetsUpdate(a,n,d){let r=(a.data.datasets||[]).length,s=[],t,g,b,M;for(g=0;g<r;++g)t=a.getDatasetMeta(g),b=t.dataset,M=null,b&&b.options&&b instanceof zx&&(M={visible:a.isDatasetVisible(g),index:g,fill:D7(b,g,r),chart:a,axis:t.controller.options.indexAxis,scale:t.vScale,line:b}),t.$filler=M,s.push(M);for(g=0;g<r;++g)M=s[g],!(!M||M.fill===!1)&&(M.fill=E7(s,g,d.propagate))},beforeDraw(a,n,d){let r=d.drawTime==="beforeDraw",s=a.getSortedVisibleDatasetMetas(),t=a.chartArea;for(let g=s.length-1;g>=0;--g){let b=s[g].$filler;b&&(b.line.updateControlPoints(t,b.axis),r&&b.fill&&wM(a.ctx,b,t))}},beforeDatasetsDraw(a,n,d){if(d.drawTime!=="beforeDatasetsDraw")return;let r=a.getSortedVisibleDatasetMetas();for(let s=r.length-1;s>=0;--s){let t=r[s].$filler;vF(t)&&wM(a.ctx,t,a.chartArea)}},beforeDatasetDraw(a,n,d){let r=n.meta.$filler;!vF(r)||d.drawTime!=="beforeDatasetDraw"||wM(a.ctx,r,a.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}},SF=(a,n)=>{let{boxHeight:d=n,boxWidth:r=n}=a;return a.usePointStyle&&(d=Math.min(d,n),r=a.pointStyleWidth||Math.min(r,n)),{boxWidth:r,boxHeight:d,itemHeight:Math.max(n,d)}},$7=(a,n)=>a!==null&&n!==null&&a.datasetIndex===n.datasetIndex&&a.index===n.index,Lx=class extends Ps{constructor(n){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=n.chart,this.options=n.options,this.ctx=n.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(n,d,r){this.maxWidth=n,this.maxHeight=d,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let n=this.options.labels||{},d=Yn(n.generateLabels,[this.chart],this)||[];n.filter&&(d=d.filter(r=>n.filter(r,this.chart.data))),n.sort&&(d=d.sort((r,s)=>n.sort(r,s,this.chart.data))),this.options.reverse&&d.reverse(),this.legendItems=d}fit(){let{options:n,ctx:d}=this;if(!n.display){this.width=this.height=0;return}let r=n.labels,s=Wr(r.font),t=s.size,g=this._computeTitleHeight(),{boxWidth:b,itemHeight:M}=SF(r,t),k,L;d.font=s.string,this.isHorizontal()?(k=this.maxWidth,L=this._fitRows(g,t,b,M)+10):(L=this.maxHeight,k=this._fitCols(g,s,b,M)+10),this.width=Math.min(k,n.maxWidth||this.maxWidth),this.height=Math.min(L,n.maxHeight||this.maxHeight)}_fitRows(n,d,r,s){let{ctx:t,maxWidth:g,options:{labels:{padding:b}}}=this,M=this.legendHitBoxes=[],k=this.lineWidths=[0],L=s+b,G=n;t.textAlign="left",t.textBaseline="middle";let J=-1,oe=-L;return this.legendItems.forEach((be,Me)=>{let Te=r+d/2+t.measureText(be.text).width;(Me===0||k[k.length-1]+Te+2*b>g)&&(G+=L,k[k.length-(Me>0?0:1)]=0,oe+=L,J++),M[Me]={left:0,top:oe,row:J,width:Te,height:s},k[k.length-1]+=Te+b}),G}_fitCols(n,d,r,s){let{ctx:t,maxHeight:g,options:{labels:{padding:b}}}=this,M=this.legendHitBoxes=[],k=this.columnSizes=[],L=g-n,G=b,J=0,oe=0,be=0,Me=0;return this.legendItems.forEach((Te,He)=>{let{itemWidth:We,itemHeight:dt}=q7(r,d,t,Te,s);He>0&&oe+dt+2*b>L&&(G+=J+b,k.push({width:J,height:oe}),be+=J+b,Me++,J=oe=0),M[He]={left:be,top:oe,col:Me,width:We,height:dt},J=Math.max(J,We),oe+=dt+b}),G+=J,k.push({width:J,height:oe}),G}adjustHitBoxes(){if(!this.options.display)return;let n=this._computeTitleHeight(),{legendHitBoxes:d,options:{align:r,labels:{padding:s},rtl:t}}=this,g=Lu(t,this.left,this.width);if(this.isHorizontal()){let b=0,M=To(r,this.left+s,this.right-this.lineWidths[b]);for(let k of d)b!==k.row&&(b=k.row,M=To(r,this.left+s,this.right-this.lineWidths[b])),k.top+=this.top+n+s,k.left=g.leftForLtr(g.x(M),k.width),M+=k.width+s}else{let b=0,M=To(r,this.top+n+s,this.bottom-this.columnSizes[b].height);for(let k of d)k.col!==b&&(b=k.col,M=To(r,this.top+n+s,this.bottom-this.columnSizes[b].height)),k.top=M,k.left+=this.left+s,k.left=g.leftForLtr(g.x(k.left),k.width),M+=k.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){let n=this.ctx;g0(n,this),this._draw(),_0(n)}}_draw(){let{options:n,columnSizes:d,lineWidths:r,ctx:s}=this,{align:t,labels:g}=n,b=br.color,M=Lu(n.rtl,this.left,this.width),k=Wr(g.font),{padding:L}=g,G=k.size,J=G/2,oe;this.drawTitle(),s.textAlign=M.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=k.string;let{boxWidth:be,boxHeight:Me,itemHeight:Te}=SF(g,G),He=function(It,Wt,xt){if(isNaN(be)||be<=0||isNaN(Me)||Me<0)return;s.save();let Xt=en(xt.lineWidth,1);if(s.fillStyle=en(xt.fillStyle,b),s.lineCap=en(xt.lineCap,"butt"),s.lineDashOffset=en(xt.lineDashOffset,0),s.lineJoin=en(xt.lineJoin,"miter"),s.lineWidth=Xt,s.strokeStyle=en(xt.strokeStyle,b),s.setLineDash(en(xt.lineDash,[])),g.usePointStyle){let Vt={radius:Me*Math.SQRT2/2,pointStyle:xt.pointStyle,rotation:xt.rotation,borderWidth:Xt},Oi=M.xPlus(It,be/2),Xi=Wt+J;iM(s,Vt,Oi,Xi,g.pointStyleWidth&&be)}else{let Vt=Wt+Math.max((G-Me)/2,0),Oi=M.leftForLtr(It,be),Xi=eh(xt.borderRadius);s.beginPath(),Object.values(Xi).some(lr=>lr!==0)?ef(s,{x:Oi,y:Vt,w:be,h:Me,radius:Xi}):s.rect(Oi,Vt,be,Me),s.fill(),Xt!==0&&s.stroke()}s.restore()},We=function(It,Wt,xt){Jd(s,xt.text,It,Wt+Te/2,k,{strikethrough:xt.hidden,textAlign:M.textAlign(xt.textAlign)})},dt=this.isHorizontal(),bt=this._computeTitleHeight();dt?oe={x:To(t,this.left+L,this.right-r[0]),y:this.top+L+bt,line:0}:oe={x:this.left+L,y:To(t,this.top+bt+L,this.bottom-d[0].height),line:0},dM(this.ctx,n.textDirection);let ft=Te+L;this.legendItems.forEach((It,Wt)=>{s.strokeStyle=It.fontColor,s.fillStyle=It.fontColor;let xt=s.measureText(It.text).width,Xt=M.textAlign(It.textAlign||(It.textAlign=g.textAlign)),Vt=be+J+xt,Oi=oe.x,Xi=oe.y;M.setWidth(this.width),dt?Wt>0&&Oi+Vt+L>this.right&&(Xi=oe.y+=ft,oe.line++,Oi=oe.x=To(t,this.left+L,this.right-r[oe.line])):Wt>0&&Xi+ft>this.bottom&&(Oi=oe.x=Oi+d[oe.line].width+L,oe.line++,Xi=oe.y=To(t,this.top+bt+L,this.bottom-d[oe.line].height));let lr=M.x(Oi);if(He(lr,Xi,It),Oi=CR(Xt,Oi+be+J,dt?Oi+Vt:this.right,n.rtl),We(M.x(Oi),Xi,It),dt)oe.x+=Vt+L;else if(typeof It.text!="string"){let Mi=k.lineHeight;oe.y+=oL(It,Mi)+L}else oe.y+=ft}),hM(this.ctx,n.textDirection)}drawTitle(){let n=this.options,d=n.title,r=Wr(d.font),s=Io(d.padding);if(!d.display)return;let t=Lu(n.rtl,this.left,this.width),g=this.ctx,b=d.position,M=r.size/2,k=s.top+M,L,G=this.left,J=this.width;if(this.isHorizontal())J=Math.max(...this.lineWidths),L=this.top+k,G=To(n.align,G,this.right-J);else{let be=this.columnSizes.reduce((Me,Te)=>Math.max(Me,Te.height),0);L=k+To(n.align,this.top,this.bottom-be-n.labels.padding-this._computeTitleHeight())}let oe=To(b,G,G+J);g.textAlign=t.textAlign(mx(b)),g.textBaseline="middle",g.strokeStyle=d.color,g.fillStyle=d.color,g.font=r.string,Jd(g,d.text,oe,L,r)}_computeTitleHeight(){let n=this.options.title,d=Wr(n.font),r=Io(n.padding);return n.display?d.lineHeight+r.height:0}_getLegendItemAt(n,d){let r,s,t;if(ml(n,this.left,this.right)&&ml(d,this.top,this.bottom)){for(t=this.legendHitBoxes,r=0;r<t.length;++r)if(s=t[r],ml(n,s.left,s.left+s.width)&&ml(d,s.top,s.top+s.height))return this.legendItems[r]}return null}handleEvent(n){let d=this.options;if(!X7(n.type,d))return;let r=this._getLegendItemAt(n.x,n.y);if(n.type==="mousemove"||n.type==="mouseout"){let s=this._hoveredItem,t=$7(s,r);s&&!t&&Yn(d.onLeave,[n,s,this],this),this._hoveredItem=r,r&&!t&&Yn(d.onHover,[n,r,this],this)}else r&&Yn(d.onClick,[n,r,this],this)}};function q7(a,n,d,r,s){let t=Y7(r,a,n,d),g=Z7(s,r,n.lineHeight);return{itemWidth:t,itemHeight:g}}function Y7(a,n,d,r){let s=a.text;return s&&typeof s!="string"&&(s=s.reduce((t,g)=>t.length>g.length?t:g)),n+d.size/2+r.measureText(s).width}function Z7(a,n,d){let r=a;return typeof n.text!="string"&&(r=oL(n,d)),r}function oL(a,n){let d=a.text?a.text.length:0;return n*d}function X7(a,n){return!!((a==="mousemove"||a==="mouseout")&&(n.onHover||n.onLeave)||n.onClick&&(a==="click"||a==="mouseup"))}var K7={id:"legend",_element:Lx,start(a,n,d){let r=a.legend=new Lx({ctx:a.ctx,options:d,chart:a});Vo.configure(a,r,d),Vo.addBox(a,r)},stop(a){Vo.removeBox(a,a.legend),delete a.legend},beforeUpdate(a,n,d){let r=a.legend;Vo.configure(a,r,d),r.options=d},afterUpdate(a){let n=a.legend;n.buildLabels(),n.adjustHitBoxes()},afterEvent(a,n){n.replay||a.legend.handleEvent(n.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(a,n,d){let r=n.datasetIndex,s=d.chart;s.isDatasetVisible(r)?(s.hide(r),n.hidden=!0):(s.show(r),n.hidden=!1)},onHover:null,onLeave:null,labels:{color:a=>a.chart.options.color,boxWidth:40,padding:10,generateLabels(a){let n=a.data.datasets,{labels:{usePointStyle:d,pointStyle:r,textAlign:s,color:t,useBorderRadius:g,borderRadius:b}}=a.legend.options;return a._getSortedDatasetMetas().map(M=>{let k=M.controller.getStyle(d?0:void 0),L=Io(k.borderWidth);return{text:n[M.index].label,fillStyle:k.backgroundColor,fontColor:t,hidden:!M.visible,lineCap:k.borderCapStyle,lineDash:k.borderDash,lineDashOffset:k.borderDashOffset,lineJoin:k.borderJoinStyle,lineWidth:(L.width+L.height)/4,strokeStyle:k.borderColor,pointStyle:r||k.pointStyle,rotation:k.rotation,textAlign:s||k.textAlign,borderRadius:g&&(b||k.borderRadius),datasetIndex:M.index}},this)}},title:{color:a=>a.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:a=>!a.startsWith("on"),labels:{_scriptable:a=>!["generateLabels","filter","sort"].includes(a)}}},T0=class extends Ps{constructor(n){super(),this.chart=n.chart,this.options=n.options,this.ctx=n.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(n,d){let r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=n,this.height=this.bottom=d;let s=ir(r.text)?r.text.length:1;this._padding=Io(r.padding);let t=s*Wr(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=t:this.width=t}isHorizontal(){let n=this.options.position;return n==="top"||n==="bottom"}_drawArgs(n){let{top:d,left:r,bottom:s,right:t,options:g}=this,b=g.align,M=0,k,L,G;return this.isHorizontal()?(L=To(b,r,t),G=d+n,k=t-r):(g.position==="left"?(L=r+n,G=To(b,s,d),M=nr*-.5):(L=t-n,G=To(b,d,s),M=nr*.5),k=s-d),{titleX:L,titleY:G,maxWidth:k,rotation:M}}draw(){let n=this.ctx,d=this.options;if(!d.display)return;let r=Wr(d.font),t=r.lineHeight/2+this._padding.top,{titleX:g,titleY:b,maxWidth:M,rotation:k}=this._drawArgs(t);Jd(n,d.text,0,0,r,{color:d.color,maxWidth:M,rotation:k,textAlign:mx(d.align),textBaseline:"middle",translation:[g,b]})}};function Q7(a,n){let d=new T0({ctx:a.ctx,options:n,chart:a});Vo.configure(a,d,n),Vo.addBox(a,d),a.titleBlock=d}var J7={id:"title",_element:T0,start(a,n,d){Q7(a,d)},stop(a){let n=a.titleBlock;Vo.removeBox(a,n),delete a.titleBlock},beforeUpdate(a,n,d){let r=a.titleBlock;Vo.configure(a,r,d),r.options=d},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},Tx=new WeakMap,eG={id:"subtitle",start(a,n,d){let r=new T0({ctx:a.ctx,options:d,chart:a});Vo.configure(a,r,d),Vo.addBox(a,r),Tx.set(a,r)},stop(a){Vo.removeBox(a,Tx.get(a)),Tx.delete(a)},beforeUpdate(a,n,d){let r=Tx.get(a);Vo.configure(a,r,d),r.options=d},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},S0={average(a){if(!a.length)return!1;let n,d,r=new Set,s=0,t=0;for(n=0,d=a.length;n<d;++n){let b=a[n].element;if(b&&b.hasValue()){let M=b.tooltipPosition();r.add(M.x),s+=M.y,++t}}return{x:[...r].reduce((b,M)=>b+M)/r.size,y:s/t}},nearest(a,n){if(!a.length)return!1;let d=n.x,r=n.y,s=Number.POSITIVE_INFINITY,t,g,b;for(t=0,g=a.length;t<g;++t){let M=a[t].element;if(M&&M.hasValue()){let k=M.getCenterPoint(),L=cx(n,k);L<s&&(s=L,b=M)}}if(b){let M=b.tooltipPosition();d=M.x,r=M.y}return{x:d,y:r}}};function fl(a,n){return n&&(ir(n)?Array.prototype.push.apply(a,n):a.push(n)),a}function fc(a){return(typeof a=="string"||a instanceof String)&&a.indexOf(`
`)>-1?a.split(`
`):a}function tG(a,n){let{element:d,datasetIndex:r,index:s}=n,t=a.getDatasetMeta(r).controller,{label:g,value:b}=t.getLabelAndValue(s);return{chart:a,label:g,parsed:t.getParsed(s),raw:a.data.datasets[r].data[s],formattedValue:b,dataset:t.getDataset(),dataIndex:s,datasetIndex:r,element:d}}function MF(a,n){let d=a.chart.ctx,{body:r,footer:s,title:t}=a,{boxWidth:g,boxHeight:b}=n,M=Wr(n.bodyFont),k=Wr(n.titleFont),L=Wr(n.footerFont),G=t.length,J=s.length,oe=r.length,be=Io(n.padding),Me=be.height,Te=0,He=r.reduce((bt,ft)=>bt+ft.before.length+ft.lines.length+ft.after.length,0);if(He+=a.beforeBody.length+a.afterBody.length,G&&(Me+=G*k.lineHeight+(G-1)*n.titleSpacing+n.titleMarginBottom),He){let bt=n.displayColors?Math.max(b,M.lineHeight):M.lineHeight;Me+=oe*bt+(He-oe)*M.lineHeight+(He-1)*n.bodySpacing}J&&(Me+=n.footerMarginTop+J*L.lineHeight+(J-1)*n.footerSpacing);let We=0,dt=function(bt){Te=Math.max(Te,d.measureText(bt).width+We)};return d.save(),d.font=k.string,Vn(a.title,dt),d.font=M.string,Vn(a.beforeBody.concat(a.afterBody),dt),We=n.displayColors?g+2+n.boxPadding:0,Vn(r,bt=>{Vn(bt.before,dt),Vn(bt.lines,dt),Vn(bt.after,dt)}),We=0,d.font=L.string,Vn(a.footer,dt),d.restore(),Te+=be.width,{width:Te,height:Me}}function iG(a,n){let{y:d,height:r}=n;return d<r/2?"top":d>a.height-r/2?"bottom":"center"}function nG(a,n,d,r){let{x:s,width:t}=r,g=d.caretSize+d.caretPadding;if(a==="left"&&s+t+g>n.width||a==="right"&&s-t-g<0)return!0}function rG(a,n,d,r){let{x:s,width:t}=d,{width:g,chartArea:{left:b,right:M}}=a,k="center";return r==="center"?k=s<=(b+M)/2?"left":"right":s<=t/2?k="left":s>=g-t/2&&(k="right"),nG(k,a,n,d)&&(k="center"),k}function TF(a,n,d){let r=d.yAlign||n.yAlign||iG(a,d);return{xAlign:d.xAlign||n.xAlign||rG(a,n,d,r),yAlign:r}}function oG(a,n){let{x:d,width:r}=a;return n==="right"?d-=r:n==="center"&&(d-=r/2),d}function aG(a,n,d){let{y:r,height:s}=a;return n==="top"?r+=d:n==="bottom"?r-=s+d:r-=s/2,r}function IF(a,n,d,r){let{caretSize:s,caretPadding:t,cornerRadius:g}=a,{xAlign:b,yAlign:M}=d,k=s+t,{topLeft:L,topRight:G,bottomLeft:J,bottomRight:oe}=eh(g),be=oG(n,b),Me=aG(n,M,k);return M==="center"?b==="left"?be+=k:b==="right"&&(be-=k):b==="left"?be-=Math.max(L,J)+s:b==="right"&&(be+=Math.max(G,oe)+s),{x:Jr(be,0,r.width-n.width),y:Jr(Me,0,r.height-n.height)}}function Ix(a,n,d){let r=Io(d.padding);return n==="center"?a.x+a.width/2:n==="right"?a.x+a.width-r.right:a.x+r.left}function EF(a){return fl([],fc(a))}function sG(a,n,d){return pc(a,{tooltip:n,tooltipItems:d,type:"tooltip"})}function DF(a,n){let d=n&&n.dataset&&n.dataset.tooltip&&n.dataset.tooltip.callbacks;return d?a.override(d):a}var aL={beforeTitle:pl,title(a){if(a.length>0){let n=a[0],d=n.chart.data.labels,r=d?d.length:0;if(this&&this.options&&this.options.mode==="dataset")return n.dataset.label||"";if(n.label)return n.label;if(r>0&&n.dataIndex<r)return d[n.dataIndex]}return""},afterTitle:pl,beforeBody:pl,beforeLabel:pl,label(a){if(this&&this.options&&this.options.mode==="dataset")return a.label+": "+a.formattedValue||a.formattedValue;let n=a.dataset.label||"";n&&(n+=": ");let d=a.formattedValue;return Sn(d)||(n+=d),n},labelColor(a){let d=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{borderColor:d.borderColor,backgroundColor:d.backgroundColor,borderWidth:d.borderWidth,borderDash:d.borderDash,borderDashOffset:d.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(a){let d=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{pointStyle:d.pointStyle,rotation:d.rotation}},afterLabel:pl,afterBody:pl,beforeFooter:pl,footer:pl,afterFooter:pl};function ma(a,n,d,r){let s=a[n].call(d,r);return typeof s>"u"?aL[n].call(d,r):s}var kF=(()=>{class a extends Ps{static positioners=S0;constructor(d){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=d.chart,this.options=d.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(d){this.options=d,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let d=this._cachedAnimations;if(d)return d;let r=this.chart,s=this.options.setContext(this.getContext()),t=s.enabled&&r.options.animation&&s.animations,g=new Ax(this.chart,t);return t._cacheable&&(this._cachedAnimations=Object.freeze(g)),g}getContext(){return this.$context||(this.$context=sG(this.chart.getContext(),this,this._tooltipItems))}getTitle(d,r){let{callbacks:s}=r,t=ma(s,"beforeTitle",this,d),g=ma(s,"title",this,d),b=ma(s,"afterTitle",this,d),M=[];return M=fl(M,fc(t)),M=fl(M,fc(g)),M=fl(M,fc(b)),M}getBeforeBody(d,r){return EF(ma(r.callbacks,"beforeBody",this,d))}getBody(d,r){let{callbacks:s}=r,t=[];return Vn(d,g=>{let b={before:[],lines:[],after:[]},M=DF(s,g);fl(b.before,fc(ma(M,"beforeLabel",this,g))),fl(b.lines,ma(M,"label",this,g)),fl(b.after,fc(ma(M,"afterLabel",this,g))),t.push(b)}),t}getAfterBody(d,r){return EF(ma(r.callbacks,"afterBody",this,d))}getFooter(d,r){let{callbacks:s}=r,t=ma(s,"beforeFooter",this,d),g=ma(s,"footer",this,d),b=ma(s,"afterFooter",this,d),M=[];return M=fl(M,fc(t)),M=fl(M,fc(g)),M=fl(M,fc(b)),M}_createItems(d){let r=this._active,s=this.chart.data,t=[],g=[],b=[],M=[],k,L;for(k=0,L=r.length;k<L;++k)M.push(tG(this.chart,r[k]));return d.filter&&(M=M.filter((G,J,oe)=>d.filter(G,J,oe,s))),d.itemSort&&(M=M.sort((G,J)=>d.itemSort(G,J,s))),Vn(M,G=>{let J=DF(d.callbacks,G);t.push(ma(J,"labelColor",this,G)),g.push(ma(J,"labelPointStyle",this,G)),b.push(ma(J,"labelTextColor",this,G))}),this.labelColors=t,this.labelPointStyles=g,this.labelTextColors=b,this.dataPoints=M,M}update(d,r){let s=this.options.setContext(this.getContext()),t=this._active,g,b=[];if(!t.length)this.opacity!==0&&(g={opacity:0});else{let M=S0[s.position].call(this,t,this._eventPosition);b=this._createItems(s),this.title=this.getTitle(b,s),this.beforeBody=this.getBeforeBody(b,s),this.body=this.getBody(b,s),this.afterBody=this.getAfterBody(b,s),this.footer=this.getFooter(b,s);let k=this._size=MF(this,s),L=Object.assign({},M,k),G=TF(this.chart,s,L),J=IF(s,L,G,this.chart);this.xAlign=G.xAlign,this.yAlign=G.yAlign,g={opacity:1,x:J.x,y:J.y,width:k.width,height:k.height,caretX:M.x,caretY:M.y}}this._tooltipItems=b,this.$context=void 0,g&&this._resolveAnimations().update(this,g),d&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:r})}drawCaret(d,r,s,t){let g=this.getCaretPosition(d,s,t);r.lineTo(g.x1,g.y1),r.lineTo(g.x2,g.y2),r.lineTo(g.x3,g.y3)}getCaretPosition(d,r,s){let{xAlign:t,yAlign:g}=this,{caretSize:b,cornerRadius:M}=s,{topLeft:k,topRight:L,bottomLeft:G,bottomRight:J}=eh(M),{x:oe,y:be}=d,{width:Me,height:Te}=r,He,We,dt,bt,ft,It;return g==="center"?(ft=be+Te/2,t==="left"?(He=oe,We=He-b,bt=ft+b,It=ft-b):(He=oe+Me,We=He+b,bt=ft-b,It=ft+b),dt=He):(t==="left"?We=oe+Math.max(k,G)+b:t==="right"?We=oe+Me-Math.max(L,J)-b:We=this.caretX,g==="top"?(bt=be,ft=bt-b,He=We-b,dt=We+b):(bt=be+Te,ft=bt+b,He=We+b,dt=We-b),It=bt),{x1:He,x2:We,x3:dt,y1:bt,y2:ft,y3:It}}drawTitle(d,r,s){let t=this.title,g=t.length,b,M,k;if(g){let L=Lu(s.rtl,this.x,this.width);for(d.x=Ix(this,s.titleAlign,s),r.textAlign=L.textAlign(s.titleAlign),r.textBaseline="middle",b=Wr(s.titleFont),M=s.titleSpacing,r.fillStyle=s.titleColor,r.font=b.string,k=0;k<g;++k)r.fillText(t[k],L.x(d.x),d.y+b.lineHeight/2),d.y+=b.lineHeight+M,k+1===g&&(d.y+=s.titleMarginBottom-M)}}_drawColorBox(d,r,s,t,g){let b=this.labelColors[s],M=this.labelPointStyles[s],{boxHeight:k,boxWidth:L}=g,G=Wr(g.bodyFont),J=Ix(this,"left",g),oe=t.x(J),be=k<G.lineHeight?(G.lineHeight-k)/2:0,Me=r.y+be;if(g.usePointStyle){let Te={radius:Math.min(L,k)/2,pointStyle:M.pointStyle,rotation:M.rotation,borderWidth:1},He=t.leftForLtr(oe,L)+L/2,We=Me+k/2;d.strokeStyle=g.multiKeyBackground,d.fillStyle=g.multiKeyBackground,gx(d,Te,He,We),d.strokeStyle=b.borderColor,d.fillStyle=b.backgroundColor,gx(d,Te,He,We)}else{d.lineWidth=fn(b.borderWidth)?Math.max(...Object.values(b.borderWidth)):b.borderWidth||1,d.strokeStyle=b.borderColor,d.setLineDash(b.borderDash||[]),d.lineDashOffset=b.borderDashOffset||0;let Te=t.leftForLtr(oe,L),He=t.leftForLtr(t.xPlus(oe,1),L-2),We=eh(b.borderRadius);Object.values(We).some(dt=>dt!==0)?(d.beginPath(),d.fillStyle=g.multiKeyBackground,ef(d,{x:Te,y:Me,w:L,h:k,radius:We}),d.fill(),d.stroke(),d.fillStyle=b.backgroundColor,d.beginPath(),ef(d,{x:He,y:Me+1,w:L-2,h:k-2,radius:We}),d.fill()):(d.fillStyle=g.multiKeyBackground,d.fillRect(Te,Me,L,k),d.strokeRect(Te,Me,L,k),d.fillStyle=b.backgroundColor,d.fillRect(He,Me+1,L-2,k-2))}d.fillStyle=this.labelTextColors[s]}drawBody(d,r,s){let{body:t}=this,{bodySpacing:g,bodyAlign:b,displayColors:M,boxHeight:k,boxWidth:L,boxPadding:G}=s,J=Wr(s.bodyFont),oe=J.lineHeight,be=0,Me=Lu(s.rtl,this.x,this.width),Te=function(Xt){r.fillText(Xt,Me.x(d.x+be),d.y+oe/2),d.y+=oe+g},He=Me.textAlign(b),We,dt,bt,ft,It,Wt,xt;for(r.textAlign=b,r.textBaseline="middle",r.font=J.string,d.x=Ix(this,He,s),r.fillStyle=s.bodyColor,Vn(this.beforeBody,Te),be=M&&He!=="right"?b==="center"?L/2+G:L+2+G:0,ft=0,Wt=t.length;ft<Wt;++ft){for(We=t[ft],dt=this.labelTextColors[ft],r.fillStyle=dt,Vn(We.before,Te),bt=We.lines,M&&bt.length&&(this._drawColorBox(r,d,ft,Me,s),oe=Math.max(J.lineHeight,k)),It=0,xt=bt.length;It<xt;++It)Te(bt[It]),oe=J.lineHeight;Vn(We.after,Te)}be=0,oe=J.lineHeight,Vn(this.afterBody,Te),d.y-=g}drawFooter(d,r,s){let t=this.footer,g=t.length,b,M;if(g){let k=Lu(s.rtl,this.x,this.width);for(d.x=Ix(this,s.footerAlign,s),d.y+=s.footerMarginTop,r.textAlign=k.textAlign(s.footerAlign),r.textBaseline="middle",b=Wr(s.footerFont),r.fillStyle=s.footerColor,r.font=b.string,M=0;M<g;++M)r.fillText(t[M],k.x(d.x),d.y+b.lineHeight/2),d.y+=b.lineHeight+s.footerSpacing}}drawBackground(d,r,s,t){let{xAlign:g,yAlign:b}=this,{x:M,y:k}=d,{width:L,height:G}=s,{topLeft:J,topRight:oe,bottomLeft:be,bottomRight:Me}=eh(t.cornerRadius);r.fillStyle=t.backgroundColor,r.strokeStyle=t.borderColor,r.lineWidth=t.borderWidth,r.beginPath(),r.moveTo(M+J,k),b==="top"&&this.drawCaret(d,r,s,t),r.lineTo(M+L-oe,k),r.quadraticCurveTo(M+L,k,M+L,k+oe),b==="center"&&g==="right"&&this.drawCaret(d,r,s,t),r.lineTo(M+L,k+G-Me),r.quadraticCurveTo(M+L,k+G,M+L-Me,k+G),b==="bottom"&&this.drawCaret(d,r,s,t),r.lineTo(M+be,k+G),r.quadraticCurveTo(M,k+G,M,k+G-be),b==="center"&&g==="left"&&this.drawCaret(d,r,s,t),r.lineTo(M,k+J),r.quadraticCurveTo(M,k,M+J,k),r.closePath(),r.fill(),t.borderWidth>0&&r.stroke()}_updateAnimationTarget(d){let r=this.chart,s=this.$animations,t=s&&s.x,g=s&&s.y;if(t||g){let b=S0[d.position].call(this,this._active,this._eventPosition);if(!b)return;let M=this._size=MF(this,d),k=Object.assign({},b,this._size),L=TF(r,d,k),G=IF(d,k,L,r);(t._to!==G.x||g._to!==G.y)&&(this.xAlign=L.xAlign,this.yAlign=L.yAlign,this.width=M.width,this.height=M.height,this.caretX=b.x,this.caretY=b.y,this._resolveAnimations().update(this,G))}}_willRender(){return!!this.opacity}draw(d){let r=this.options.setContext(this.getContext()),s=this.opacity;if(!s)return;this._updateAnimationTarget(r);let t={width:this.width,height:this.height},g={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;let b=Io(r.padding),M=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;r.enabled&&M&&(d.save(),d.globalAlpha=s,this.drawBackground(g,d,t,r),dM(d,r.textDirection),g.y+=b.top,this.drawTitle(g,d,r),this.drawBody(g,d,r),this.drawFooter(g,d,r),hM(d,r.textDirection),d.restore())}getActiveElements(){return this._active||[]}setActiveElements(d,r){let s=this._active,t=d.map(({datasetIndex:M,index:k})=>{let L=this.chart.getDatasetMeta(M);if(!L)throw new Error("Cannot find a dataset at index "+M);return{datasetIndex:M,element:L.data[k],index:k}}),g=!m0(s,t),b=this._positionChanged(t,r);(g||b)&&(this._active=t,this._eventPosition=r,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(d,r,s=!0){if(r&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let t=this.options,g=this._active||[],b=this._getActiveElements(d,g,r,s),M=this._positionChanged(b,d),k=r||!m0(b,g)||M;return k&&(this._active=b,(t.enabled||t.external)&&(this._eventPosition={x:d.x,y:d.y},this.update(!0,r))),k}_getActiveElements(d,r,s,t){let g=this.options;if(d.type==="mouseout")return[];if(!t)return r.filter(M=>this.chart.data.datasets[M.datasetIndex]&&this.chart.getDatasetMeta(M.datasetIndex).controller.getParsed(M.index)!==void 0);let b=this.chart.getElementsAtEventForMode(d,g.mode,g,s);return g.reverse&&b.reverse(),b}_positionChanged(d,r){let{caretX:s,caretY:t,options:g}=this,b=S0[g.position].call(this,d,r);return b!==!1&&(s!==b.x||t!==b.y)}}return a})(),lG={id:"tooltip",_element:kF,positioners:S0,afterInit(a,n,d){d&&(a.tooltip=new kF({chart:a,options:d}))},beforeUpdate(a,n,d){a.tooltip&&a.tooltip.initialize(d)},reset(a,n,d){a.tooltip&&a.tooltip.initialize(d)},afterDraw(a){let n=a.tooltip;if(n&&n._willRender()){let d={tooltip:n};if(a.notifyPlugins("beforeTooltipDraw",Cn(kt({},d),{cancelable:!0}))===!1)return;n.draw(a.ctx),a.notifyPlugins("afterTooltipDraw",d)}},afterEvent(a,n){if(a.tooltip){let d=n.replay;a.tooltip.handleEvent(n.event,d,n.inChartArea)&&(n.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(a,n)=>n.bodyFont.size,boxWidth:(a,n)=>n.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:aL},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:a=>a!=="filter"&&a!=="itemSort"&&a!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},cG=Object.freeze({__proto__:null,Colors:x7,Decimation:M7,Filler:G7,Legend:K7,SubTitle:eG,Title:J7,Tooltip:lG}),dG=(a,n,d,r)=>(typeof n=="string"?(d=a.push(n)-1,r.unshift({index:d,label:n})):isNaN(n)&&(d=null),d);function hG(a,n,d,r){let s=a.indexOf(n);if(s===-1)return dG(a,n,d,r);let t=a.lastIndexOf(n);return s!==t?d:s}var uG=(a,n)=>a===null?null:Jr(Math.round(a),0,n);function AF(a){let n=this.getLabels();return a>=0&&a<n.length?n[a]:a}var pG=(()=>{class a extends Nu{static id="category";static defaults={ticks:{callback:AF}};constructor(d){super(d),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(d){let r=this._addedLabels;if(r.length){let s=this.getLabels();for(let{index:t,label:g}of r)s[t]===g&&s.splice(t,1);this._addedLabels=[]}super.init(d)}parse(d,r){if(Sn(d))return null;let s=this.getLabels();return r=isFinite(r)&&s[r]===d?r:hG(s,d,en(r,d),this._addedLabels),uG(r,s.length-1)}determineDataLimits(){let{minDefined:d,maxDefined:r}=this.getUserBounds(),{min:s,max:t}=this.getMinMax(!0);this.options.bounds==="ticks"&&(d||(s=0),r||(t=this.getLabels().length-1)),this.min=s,this.max=t}buildTicks(){let d=this.min,r=this.max,s=this.options.offset,t=[],g=this.getLabels();g=d===0&&r===g.length-1?g:g.slice(d,r+1),this._valueRange=Math.max(g.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let b=d;b<=r;b++)t.push({value:b});return t}getLabelForValue(d){return AF.call(this,d)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(d){return typeof d!="number"&&(d=this.parse(d)),d===null?NaN:this.getPixelForDecimal((d-this._startValue)/this._valueRange)}getPixelForTick(d){let r=this.ticks;return d<0||d>r.length-1?null:this.getPixelForValue(r[d].value)}getValueForPixel(d){return Math.round(this._startValue+this.getDecimalForPixel(d)*this._valueRange)}getBasePixel(){return this.bottom}}return a})();function mG(a,n){let d=[],{bounds:s,step:t,min:g,max:b,precision:M,count:k,maxTicks:L,maxDigits:G,includeBounds:J}=a,oe=t||1,be=L-1,{min:Me,max:Te}=n,He=!Sn(g),We=!Sn(b),dt=!Sn(k),bt=(Te-Me)/(G+1),ft=H2((Te-Me)/be/oe)*oe,It,Wt,xt,Xt;if(ft<1e-14&&!He&&!We)return[{value:Me},{value:Te}];Xt=Math.ceil(Te/ft)-Math.floor(Me/ft),Xt>be&&(ft=H2(Xt*ft/be/oe)*oe),Sn(M)||(It=Math.pow(10,M),ft=Math.ceil(ft*It)/It),s==="ticks"?(Wt=Math.floor(Me/ft)*ft,xt=Math.ceil(Te/ft)*ft):(Wt=Me,xt=Te),He&&We&&t&&gR((b-g)/t,ft/1e3)?(Xt=Math.round(Math.min((b-g)/ft,L)),ft=(b-g)/Xt,Wt=g,xt=b):dt?(Wt=He?g:Wt,xt=We?b:xt,Xt=k-1,ft=(xt-Wt)/Xt):(Xt=(xt-Wt)/ft,Km(Xt,Math.round(Xt),ft/1e3)?Xt=Math.round(Xt):Xt=Math.ceil(Xt));let Vt=Math.max(G2(ft),G2(Wt));It=Math.pow(10,Sn(M)?Vt:M),Wt=Math.round(Wt*It)/It,xt=Math.round(xt*It)/It;let Oi=0;for(He&&(J&&Wt!==g?(d.push({value:g}),Wt<g&&Oi++,Km(Math.round((Wt+Oi*ft)*It)/It,g,PF(g,bt,a))&&Oi++):Wt<g&&Oi++);Oi<Xt;++Oi){let Xi=Math.round((Wt+Oi*ft)*It)/It;if(We&&Xi>b)break;d.push({value:Xi})}return We&&J&&xt!==b?d.length&&Km(d[d.length-1].value,b,PF(b,bt,a))?d[d.length-1].value=b:d.push({value:b}):(!We||xt===b)&&d.push({value:xt}),d}function PF(a,n,{horizontal:d,minRotation:r}){let s=as(r),t=(d?Math.sin(s):Math.cos(s))||.001,g=.75*n*(""+a).length;return Math.min(n/t,g)}var of=class extends Nu{constructor(n){super(n),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(n,d){return Sn(n)||(typeof n=="number"||n instanceof Number)&&!isFinite(+n)?null:+n}handleTickRangeOptions(){let{beginAtZero:n}=this.options,{minDefined:d,maxDefined:r}=this.getUserBounds(),{min:s,max:t}=this,g=M=>s=d?s:M,b=M=>t=r?t:M;if(n){let M=As(s),k=As(t);M<0&&k<0?b(0):M>0&&k>0&&g(0)}if(s===t){let M=t===0?1:Math.abs(t*.05);b(t+M),n||g(s-M)}this.min=s,this.max=t}getTickLimit(){let n=this.options.ticks,{maxTicksLimit:d,stepSize:r}=n,s;return r?(s=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),d=d||11),d&&(s=Math.min(d,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let n=this.options,d=n.ticks,r=this.getTickLimit();r=Math.max(2,r);let s={maxTicks:r,bounds:n.bounds,min:n.min,max:n.max,precision:d.precision,step:d.stepSize,count:d.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:d.minRotation||0,includeBounds:d.includeBounds!==!1},t=this._range||this,g=mG(s,t);return n.bounds==="ticks"&&W2(g,this,"value"),n.reverse?(g.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),g}configure(){let n=this.ticks,d=this.min,r=this.max;if(super.configure(),this.options.offset&&n.length){let s=(r-d)/Math.max(n.length-1,1)/2;d-=s,r+=s}this._startValue=d,this._endValue=r,this._valueRange=r-d}getLabelForValue(n){return Jm(n,this.chart.options.locale,this.options.ticks.format)}},BM=class extends of{static id="linear";static defaults={ticks:{callback:f0.formatters.numeric}};determineDataLimits(){let{min:n,max:d}=this.getMinMax(!0);this.min=yr(n)?n:0,this.max=yr(d)?d:1,this.handleTickRangeOptions()}computeTickLimit(){let n=this.isHorizontal(),d=n?this.width:this.height,r=as(this.options.ticks.minRotation),s=(n?Math.sin(r):Math.cos(r))||.001,t=this._resolveTickFontOptions(0);return Math.ceil(d/Math.min(40,t.lineHeight/s))}getPixelForValue(n){return n===null?NaN:this.getPixelForDecimal((n-this._startValue)/this._valueRange)}getValueForPixel(n){return this._startValue+this.getDecimalForPixel(n)*this._valueRange}},I0=a=>Math.floor(hc(a)),Bu=(a,n)=>Math.pow(10,I0(a)+n);function OF(a){return a/Math.pow(10,I0(a))===1}function RF(a,n,d){let r=Math.pow(10,d),s=Math.floor(a/r);return Math.ceil(n/r)-s}function fG(a,n){let d=n-a,r=I0(d);for(;RF(a,n,r)>10;)r++;for(;RF(a,n,r)<10;)r--;return Math.min(r,I0(a))}function gG(a,{min:n,max:d}){n=pa(a.min,n);let r=[],s=I0(n),t=fG(n,d),g=t<0?Math.pow(10,Math.abs(t)):1,b=Math.pow(10,t),M=s>t?Math.pow(10,s):0,k=Math.round((n-M)*g)/g,L=Math.floor((n-M)/b/10)*b*10,G=Math.floor((k-L)/Math.pow(10,t)),J=pa(a.min,Math.round((M+L+G*Math.pow(10,t))*g)/g);for(;J<d;)r.push({value:J,major:OF(J),significand:G}),G>=10?G=G<15?15:20:G++,G>=20&&(t++,G=2,g=t>=0?1:g),J=Math.round((M+L+G*Math.pow(10,t))*g)/g;let oe=pa(a.max,J);return r.push({value:oe,major:OF(oe),significand:G}),r}var NM=class extends Nu{static id="logarithmic";static defaults={ticks:{callback:f0.formatters.logarithmic,major:{enabled:!0}}};constructor(n){super(n),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(n,d){let r=of.prototype.parse.apply(this,[n,d]);if(r===0){this._zero=!0;return}return yr(r)&&r>0?r:null}determineDataLimits(){let{min:n,max:d}=this.getMinMax(!0);this.min=yr(n)?Math.max(0,n):null,this.max=yr(d)?Math.max(0,d):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!yr(this._userMin)&&(this.min=n===Bu(this.min,0)?Bu(this.min,-1):Bu(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:n,maxDefined:d}=this.getUserBounds(),r=this.min,s=this.max,t=b=>r=n?r:b,g=b=>s=d?s:b;r===s&&(r<=0?(t(1),g(10)):(t(Bu(r,-1)),g(Bu(s,1)))),r<=0&&t(Bu(s,-1)),s<=0&&g(Bu(r,1)),this.min=r,this.max=s}buildTicks(){let n=this.options,d={min:this._userMin,max:this._userMax},r=gG(d,this);return n.bounds==="ticks"&&W2(r,this,"value"),n.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}getLabelForValue(n){return n===void 0?"0":Jm(n,this.chart.options.locale,this.options.ticks.format)}configure(){let n=this.min;super.configure(),this._startValue=hc(n),this._valueRange=hc(this.max)-hc(n)}getPixelForValue(n){return(n===void 0||n===0)&&(n=this.min),n===null||isNaN(n)?NaN:this.getPixelForDecimal(n===this.min?0:(hc(n)-this._startValue)/this._valueRange)}getValueForPixel(n){let d=this.getDecimalForPixel(n);return Math.pow(10,this._startValue+d*this._valueRange)}};function VM(a){let n=a.ticks;if(n.display&&a.display){let d=Io(n.backdropPadding);return en(n.font&&n.font.size,br.font.size)+d.height}return 0}function _G(a,n,d){return d=ir(d)?d:[d],{w:MR(a,n.string,d),h:d.length*n.lineHeight}}function FF(a,n,d,r,s){return a===r||a===s?{start:n-d/2,end:n+d/2}:a<r||a>s?{start:n-d,end:n}:{start:n,end:n+d}}function yG(a){let n={l:a.left+a._padding.left,r:a.right-a._padding.right,t:a.top+a._padding.top,b:a.bottom-a._padding.bottom},d=Object.assign({},n),r=[],s=[],t=a._pointLabels.length,g=a.options.pointLabels,b=g.centerPointLabels?nr/t:0;for(let M=0;M<t;M++){let k=g.setContext(a.getPointLabelContext(M));s[M]=k.padding;let L=a.getPointPosition(M,a.drawingArea+s[M],b),G=Wr(k.font),J=_G(a.ctx,G,a._pointLabels[M]);r[M]=J;let oe=ua(a.getIndexAngle(M)+b),be=Math.round(ux(oe)),Me=FF(be,L.x,J.w,0,180),Te=FF(be,L.y,J.h,90,270);bG(d,n,oe,Me,Te)}a.setCenterPoint(n.l-d.l,d.r-n.r,n.t-d.t,d.b-n.b),a._pointLabelItems=wG(a,r,s)}function bG(a,n,d,r,s){let t=Math.abs(Math.sin(d)),g=Math.abs(Math.cos(d)),b=0,M=0;r.start<n.l?(b=(n.l-r.start)/t,a.l=Math.min(a.l,n.l-b)):r.end>n.r&&(b=(r.end-n.r)/t,a.r=Math.max(a.r,n.r+b)),s.start<n.t?(M=(n.t-s.start)/g,a.t=Math.min(a.t,n.t-M)):s.end>n.b&&(M=(s.end-n.b)/g,a.b=Math.max(a.b,n.b+M))}function vG(a,n,d){let r=a.drawingArea,{extra:s,additionalAngle:t,padding:g,size:b}=d,M=a.getPointPosition(n,r+s+g,t),k=Math.round(ux(ua(M.angle+Tr))),L=MG(M.y,b.h,k),G=CG(k),J=SG(M.x,b.w,G);return{visible:!0,x:M.x,y:L,textAlign:G,left:J,top:L,right:J+b.w,bottom:L+b.h}}function xG(a,n){if(!n)return!0;let{left:d,top:r,right:s,bottom:t}=a;return!(ul({x:d,y:r},n)||ul({x:d,y:t},n)||ul({x:s,y:r},n)||ul({x:s,y:t},n))}function wG(a,n,d){let r=[],s=a._pointLabels.length,t=a.options,{centerPointLabels:g,display:b}=t.pointLabels,M={extra:VM(t)/2,additionalAngle:g?nr/s:0},k;for(let L=0;L<s;L++){M.padding=d[L],M.size=n[L];let G=vG(a,L,M);r.push(G),b==="auto"&&(G.visible=xG(G,k),G.visible&&(k=G))}return r}function CG(a){return a===0||a===180?"center":a<180?"left":"right"}function SG(a,n,d){return d==="right"?a-=n:d==="center"&&(a-=n/2),a}function MG(a,n,d){return d===90||d===270?a-=n/2:(d>270||d<90)&&(a-=n),a}function TG(a,n,d){let{left:r,top:s,right:t,bottom:g}=d,{backdropColor:b}=n;if(!Sn(b)){let M=eh(n.borderRadius),k=Io(n.backdropPadding);a.fillStyle=b;let L=r-k.left,G=s-k.top,J=t-r+k.width,oe=g-s+k.height;Object.values(M).some(be=>be!==0)?(a.beginPath(),ef(a,{x:L,y:G,w:J,h:oe,radius:M}),a.fill()):a.fillRect(L,G,J,oe)}}function IG(a,n){let{ctx:d,options:{pointLabels:r}}=a;for(let s=n-1;s>=0;s--){let t=a._pointLabelItems[s];if(!t.visible)continue;let g=r.setContext(a.getPointLabelContext(s));TG(d,g,t);let b=Wr(g.font),{x:M,y:k,textAlign:L}=t;Jd(d,a._pointLabels[s],M,k+b.lineHeight/2,b,{color:g.color,textAlign:L,textBaseline:"middle"})}}function sL(a,n,d,r){let{ctx:s}=a;if(d)s.arc(a.xCenter,a.yCenter,n,0,rr);else{let t=a.getPointPosition(0,n);s.moveTo(t.x,t.y);for(let g=1;g<r;g++)t=a.getPointPosition(g,n),s.lineTo(t.x,t.y)}}function EG(a,n,d,r,s){let t=a.ctx,g=n.circular,{color:b,lineWidth:M}=n;!g&&!r||!b||!M||d<0||(t.save(),t.strokeStyle=b,t.lineWidth=M,t.setLineDash(s.dash),t.lineDashOffset=s.dashOffset,t.beginPath(),sL(a,d,g,r),t.closePath(),t.stroke(),t.restore())}function DG(a,n,d){return pc(a,{label:d,index:n,type:"pointLabel"})}var jM=class extends of{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:f0.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(n){return n},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(n){super(n),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let n=this._padding=Io(VM(this.options)/2),d=this.width=this.maxWidth-n.width,r=this.height=this.maxHeight-n.height;this.xCenter=Math.floor(this.left+d/2+n.left),this.yCenter=Math.floor(this.top+r/2+n.top),this.drawingArea=Math.floor(Math.min(d,r)/2)}determineDataLimits(){let{min:n,max:d}=this.getMinMax(!1);this.min=yr(n)&&!isNaN(n)?n:0,this.max=yr(d)&&!isNaN(d)?d:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/VM(this.options))}generateTickLabels(n){of.prototype.generateTickLabels.call(this,n),this._pointLabels=this.getLabels().map((d,r)=>{let s=Yn(this.options.pointLabels.callback,[d,r],this);return s||s===0?s:""}).filter((d,r)=>this.chart.getDataVisibility(r))}fit(){let n=this.options;n.display&&n.pointLabels.display?yG(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(n,d,r,s){this.xCenter+=Math.floor((n-d)/2),this.yCenter+=Math.floor((r-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(n,d,r,s))}getIndexAngle(n){let d=rr/(this._pointLabels.length||1),r=this.options.startAngle||0;return ua(n*d+as(r))}getDistanceFromCenterForValue(n){if(Sn(n))return NaN;let d=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-n)*d:(n-this.min)*d}getValueForDistanceFromCenter(n){if(Sn(n))return NaN;let d=n/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-d:this.min+d}getPointLabelContext(n){let d=this._pointLabels||[];if(n>=0&&n<d.length){let r=d[n];return DG(this.getContext(),n,r)}}getPointPosition(n,d,r=0){let s=this.getIndexAngle(n)-Tr+r;return{x:Math.cos(s)*d+this.xCenter,y:Math.sin(s)*d+this.yCenter,angle:s}}getPointPositionForValue(n,d){return this.getPointPosition(n,this.getDistanceFromCenterForValue(d))}getBasePosition(n){return this.getPointPositionForValue(n||0,this.getBaseValue())}getPointLabelPosition(n){let{left:d,top:r,right:s,bottom:t}=this._pointLabelItems[n];return{left:d,top:r,right:s,bottom:t}}drawBackground(){let{backgroundColor:n,grid:{circular:d}}=this.options;if(n){let r=this.ctx;r.save(),r.beginPath(),sL(this,this.getDistanceFromCenterForValue(this._endValue),d,this._pointLabels.length),r.closePath(),r.fillStyle=n,r.fill(),r.restore()}}drawGrid(){let n=this.ctx,d=this.options,{angleLines:r,grid:s,border:t}=d,g=this._pointLabels.length,b,M,k;if(d.pointLabels.display&&IG(this,g),s.display&&this.ticks.forEach((L,G)=>{if(G!==0||G===0&&this.min<0){M=this.getDistanceFromCenterForValue(L.value);let J=this.getContext(G),oe=s.setContext(J),be=t.setContext(J);EG(this,oe,M,g,be)}}),r.display){for(n.save(),b=g-1;b>=0;b--){let L=r.setContext(this.getPointLabelContext(b)),{color:G,lineWidth:J}=L;!J||!G||(n.lineWidth=J,n.strokeStyle=G,n.setLineDash(L.borderDash),n.lineDashOffset=L.borderDashOffset,M=this.getDistanceFromCenterForValue(d.ticks.reverse?this.min:this.max),k=this.getPointPosition(b,M),n.beginPath(),n.moveTo(this.xCenter,this.yCenter),n.lineTo(k.x,k.y),n.stroke())}n.restore()}}drawBorder(){}drawLabels(){let n=this.ctx,d=this.options,r=d.ticks;if(!r.display)return;let s=this.getIndexAngle(0),t,g;n.save(),n.translate(this.xCenter,this.yCenter),n.rotate(s),n.textAlign="center",n.textBaseline="middle",this.ticks.forEach((b,M)=>{if(M===0&&this.min>=0&&!d.reverse)return;let k=r.setContext(this.getContext(M)),L=Wr(k.font);if(t=this.getDistanceFromCenterForValue(this.ticks[M].value),k.showLabelBackdrop){n.font=L.string,g=n.measureText(b.label).width,n.fillStyle=k.backdropColor;let G=Io(k.backdropPadding);n.fillRect(-g/2-G.left,-t-L.size/2-G.top,g+G.width,L.size+G.height)}Jd(n,b.label,0,-t,L,{color:k.color,strokeColor:k.textStrokeColor,strokeWidth:k.textStrokeWidth})}),n.restore()}drawTitle(){}},Bx={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},fa=Object.keys(Bx);function LF(a,n){return a-n}function zF(a,n){if(Sn(n))return null;let d=a._adapter,{parser:r,round:s,isoWeekday:t}=a._parseOpts,g=n;return typeof r=="function"&&(g=r(g)),yr(g)||(g=typeof r=="string"?d.parse(g,r):d.parse(g)),g===null?null:(s&&(g=s==="week"&&(Fu(t)||t===!0)?d.startOf(g,"isoWeek",t):d.startOf(g,s)),+g)}function BF(a,n,d,r){let s=fa.length;for(let t=fa.indexOf(a);t<s-1;++t){let g=Bx[fa[t]],b=g.steps?g.steps:Number.MAX_SAFE_INTEGER;if(g.common&&Math.ceil((d-n)/(b*g.size))<=r)return fa[t]}return fa[s-1]}function kG(a,n,d,r,s){for(let t=fa.length-1;t>=fa.indexOf(d);t--){let g=fa[t];if(Bx[g].common&&a._adapter.diff(s,r,g)>=n-1)return g}return fa[d?fa.indexOf(d):0]}function AG(a){for(let n=fa.indexOf(a)+1,d=fa.length;n<d;++n)if(Bx[fa[n]].common)return fa[n]}function NF(a,n,d){if(!d)a[n]=!0;else if(d.length){let{lo:r,hi:s}=px(d,n),t=d[r]>=n?d[r]:d[s];a[t]=!0}}function PG(a,n,d,r){let s=a._adapter,t=+s.startOf(n[0].value,r),g=n[n.length-1].value,b,M;for(b=t;b<=g;b=+s.add(b,1,r))M=d[b],M>=0&&(n[M].major=!0);return n}function VF(a,n,d){let r=[],s={},t=n.length,g,b;for(g=0;g<t;++g)b=n[g],s[b]=g,r.push({value:b,major:!1});return t===0||!d?r:PG(a,r,s,d)}var UM=(()=>{class a extends Nu{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(d){super(d),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(d,r={}){let s=d.time||(d.time={}),t=this._adapter=new WH._date(d.adapters.date);t.init(r),Zm(s.displayFormats,t.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(d),this._normalized=r.normalized}parse(d,r){return d===void 0?null:zF(this,d)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let d=this.options,r=this._adapter,s=d.time.unit||"day",{min:t,max:g,minDefined:b,maxDefined:M}=this.getUserBounds();function k(L){!b&&!isNaN(L.min)&&(t=Math.min(t,L.min)),!M&&!isNaN(L.max)&&(g=Math.max(g,L.max))}(!b||!M)&&(k(this._getLabelBounds()),(d.bounds!=="ticks"||d.ticks.source!=="labels")&&k(this.getMinMax(!1))),t=yr(t)&&!isNaN(t)?t:+r.startOf(Date.now(),s),g=yr(g)&&!isNaN(g)?g:+r.endOf(Date.now(),s)+1,this.min=Math.min(t,g-1),this.max=Math.max(t+1,g)}_getLabelBounds(){let d=this.getLabelTimestamps(),r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return d.length&&(r=d[0],s=d[d.length-1]),{min:r,max:s}}buildTicks(){let d=this.options,r=d.time,s=d.ticks,t=s.source==="labels"?this.getLabelTimestamps():this._generate();d.bounds==="ticks"&&t.length&&(this.min=this._userMin||t[0],this.max=this._userMax||t[t.length-1]);let g=this.min,b=this.max,M=bR(t,g,b);return this._unit=r.unit||(s.autoSkip?BF(r.minUnit,this.min,this.max,this._getLabelCapacity(g)):kG(this,M.length,r.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:AG(this._unit),this.initOffsets(t),d.reverse&&M.reverse(),VF(this,M,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(d=>+d.value))}initOffsets(d=[]){let r=0,s=0,t,g;this.options.offset&&d.length&&(t=this.getDecimalForValue(d[0]),d.length===1?r=1-t:r=(this.getDecimalForValue(d[1])-t)/2,g=this.getDecimalForValue(d[d.length-1]),d.length===1?s=g:s=(g-this.getDecimalForValue(d[d.length-2]))/2);let b=d.length<3?.5:.25;r=Jr(r,0,b),s=Jr(s,0,b),this._offsets={start:r,end:s,factor:1/(r+1+s)}}_generate(){let d=this._adapter,r=this.min,s=this.max,t=this.options,g=t.time,b=g.unit||BF(g.minUnit,r,s,this._getLabelCapacity(r)),M=en(t.ticks.stepSize,1),k=b==="week"?g.isoWeekday:!1,L=Fu(k)||k===!0,G={},J=r,oe,be;if(L&&(J=+d.startOf(J,"isoWeek",k)),J=+d.startOf(J,L?"day":b),d.diff(s,r,b)>1e5*M)throw new Error(r+" and "+s+" are too far apart with stepSize of "+M+" "+b);let Me=t.ticks.source==="data"&&this.getDataTimestamps();for(oe=J,be=0;oe<s;oe=+d.add(oe,M,b),be++)NF(G,oe,Me);return(oe===s||t.bounds==="ticks"||be===1)&&NF(G,oe,Me),Object.keys(G).sort(LF).map(Te=>+Te)}getLabelForValue(d){let r=this._adapter,s=this.options.time;return s.tooltipFormat?r.format(d,s.tooltipFormat):r.format(d,s.displayFormats.datetime)}format(d,r){let t=this.options.time.displayFormats,g=this._unit,b=r||t[g];return this._adapter.format(d,b)}_tickFormatFunction(d,r,s,t){let g=this.options,b=g.ticks.callback;if(b)return Yn(b,[d,r,s],this);let M=g.time.displayFormats,k=this._unit,L=this._majorUnit,G=k&&M[k],J=L&&M[L],oe=s[r],be=L&&J&&oe&&oe.major;return this._adapter.format(d,t||(be?J:G))}generateTickLabels(d){let r,s,t;for(r=0,s=d.length;r<s;++r)t=d[r],t.label=this._tickFormatFunction(t.value,r,d)}getDecimalForValue(d){return d===null?NaN:(d-this.min)/(this.max-this.min)}getPixelForValue(d){let r=this._offsets,s=this.getDecimalForValue(d);return this.getPixelForDecimal((r.start+s)*r.factor)}getValueForPixel(d){let r=this._offsets,s=this.getDecimalForPixel(d)/r.factor-r.end;return this.min+s*(this.max-this.min)}_getLabelSize(d){let r=this.options.ticks,s=this.ctx.measureText(d).width,t=as(this.isHorizontal()?r.maxRotation:r.minRotation),g=Math.cos(t),b=Math.sin(t),M=this._resolveTickFontOptions(0).size;return{w:s*g+M*b,h:s*b+M*g}}_getLabelCapacity(d){let r=this.options.time,s=r.displayFormats,t=s[r.unit]||s.millisecond,g=this._tickFormatFunction(d,0,VF(this,[d],this._majorUnit),t),b=this._getLabelSize(g),M=Math.floor(this.isHorizontal()?this.width/b.w:this.height/b.h)-1;return M>0?M:1}getDataTimestamps(){let d=this._cache.data||[],r,s;if(d.length)return d;let t=this.getMatchingVisibleMetas();if(this._normalized&&t.length)return this._cache.data=t[0].controller.getAllParsedValues(this);for(r=0,s=t.length;r<s;++r)d=d.concat(t[r].controller.getAllParsedValues(this));return this._cache.data=this.normalize(d)}getLabelTimestamps(){let d=this._cache.labels||[],r,s;if(d.length)return d;let t=this.getLabels();for(r=0,s=t.length;r<s;++r)d.push(zF(this,t[r]));return this._cache.labels=this._normalized?d:this.normalize(d)}normalize(d){return Y2(d.sort(LF))}}return a})();function Ex(a,n,d){let r=0,s=a.length-1,t,g,b,M;d?(n>=a[r].pos&&n<=a[s].pos&&({lo:r,hi:s}=hl(a,"pos",n)),{pos:t,time:b}=a[r],{pos:g,time:M}=a[s]):(n>=a[r].time&&n<=a[s].time&&({lo:r,hi:s}=hl(a,"time",n)),{time:t,pos:b}=a[r],{time:g,pos:M}=a[s]);let k=g-t;return k?b+(M-b)*(n-t)/k:b}var HM=class extends UM{static id="timeseries";static defaults=UM.defaults;constructor(n){super(n),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let n=this._getTimestampsForTable(),d=this._table=this.buildLookupTable(n);this._minPos=Ex(d,this.min),this._tableRange=Ex(d,this.max)-this._minPos,super.initOffsets(n)}buildLookupTable(n){let{min:d,max:r}=this,s=[],t=[],g,b,M,k,L;for(g=0,b=n.length;g<b;++g)k=n[g],k>=d&&k<=r&&s.push(k);if(s.length<2)return[{time:d,pos:0},{time:r,pos:1}];for(g=0,b=s.length;g<b;++g)L=s[g+1],M=s[g-1],k=s[g],Math.round((L+M)/2)!==k&&t.push({time:k,pos:g/(b-1)});return t}_generate(){let n=this.min,d=this.max,r=super.getDataTimestamps();return(!r.includes(n)||!r.length)&&r.splice(0,0,n),(!r.includes(d)||r.length===1)&&r.push(d),r.sort((s,t)=>s-t)}_getTimestampsForTable(){let n=this._cache.all||[];if(n.length)return n;let d=this.getDataTimestamps(),r=this.getLabelTimestamps();return d.length&&r.length?n=this.normalize(d.concat(r)):n=d.length?d:r,n=this._cache.all=n,n}getDecimalForValue(n){return(Ex(this._table,n)-this._minPos)/this._tableRange}getValueForPixel(n){let d=this._offsets,r=this.getDecimalForPixel(n)/d.factor-d.end;return Ex(this._table,r*this._tableRange+this._minPos,!0)}},OG=Object.freeze({__proto__:null,CategoryScale:pG,LinearScale:BM,LogarithmicScale:NM,RadialLinearScale:jM,TimeScale:UM,TimeSeriesScale:HM}),Nx=[HH,f7,cG,OG];af.register(...Nx);var RG=["chartContainer"];af.register(...Nx);var lL=(()=>{let n=class n{constructor(r,s,t){this.http=r,this.router=s,this.razorpayService=t,this.earn=null,this.years=[],this.selectedYear=0,this.selectedMonth=0,this.months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.currentWeek=0,this.totalWeeks=0,this.allChartData=[],this.allLabelsData=[],this.dateRange="",this.credits=this.razorpayService.userCredit;for(let g=2022;g<=2030;g++)this.years.push(g)}ngOnInit(){this.initializeChart(),this.loadDefaultEarnings()}initializeChart(){let r=document.getElementById("MyChart");this.chart=new af(r,{type:"bar",data:{labels:[],datasets:[{data:[],backgroundColor:"limegreen",barPercentage:.8,categoryPercentage:.8}]},options:{aspectRatio:1.8,plugins:{tooltip:{enabled:!1}},scales:{y:{display:!1},x:{display:!0,grid:{display:!1}}}}}),this.chart.canvas.addEventListener("click",s=>{let t=this.chart.getElementsAtEventForMode(s,"nearest",{intersect:!0},!1);if(t.length>0){let g=t[0],b=this.chart.data.labels[g.index],M=this.chart.data.datasets[g.datasetIndex].data[g.index];this.earn=M}})}loadDefaultEarnings(){let r=new Date;this.selectedYear=r.getFullYear(),this.selectedMonth=r.getMonth(),this.updateChartData(this.selectedYear,this.selectedMonth)}onYearMonthChange(){this.selectedYear!==0&&this.selectedMonth!==0&&this.updateChartData(this.selectedYear,this.selectedMonth)}updateChartData(r,s){let g=`https://api.coolieno1.in/v1.0/providers/earnings/get-earnings/${localStorage.getItem("providerId")}`;this.http.get(g).subscribe(b=>{console.log("API Response:",b);let k=b.sort((G,J)=>{let oe=new Date(G.date),be=new Date(J.date);return oe.getTime()-be.getTime()}).filter(G=>{let J=new Date(G.date);return J.getFullYear()===r&&J.getMonth()===s});console.log("Filtered Data:",k);let L=this.transformData(k,r,s);this.allChartData=L.data,this.allLabelsData=L.labels,this.totalWeeks=Math.ceil(this.allChartData.length/7),this.currentWeek=0,this.displayCurrentWeek()},b=>{console.error(b)})}transformData(r,s,t){let g=new Date(s,t+1,0).getDate(),b=Array.from({length:g},(k,L)=>(L+1).toString()),M=new Array(g).fill(0);return r.forEach(k=>{let G=new Date(k.date).getDate();M[G-1]+=k.amount}),console.log("Transformed Data:",{labels:b,amounts:M}),{labels:b,data:M}}displayCurrentWeek(){let r=this.currentWeek*7,s=r+7,t=this.allLabelsData.slice(r,s),g=this.allChartData.slice(r,s);console.log("Week Labels:",t),console.log("Week Data:",g),this.chart.data.labels=t,this.chart.data.datasets[0].data=g,this.chart.update(),this.updateDateRange(t)}updateDateRange(r){if(r.length>0){let s=this.selectedYear,t=this.selectedMonth,g=new Date(s,t,parseInt(r[0])),b=new Date(s,t,parseInt(r[r.length-1]));this.dateRange=`${g.toDateString()} - ${b.toDateString()}`}else this.dateRange=""}previousWeek(){this.currentWeek>0?this.currentWeek--:this.navigateMonth("previous"),this.displayCurrentWeek()}nextWeek(){this.currentWeek<this.totalWeeks-1?this.currentWeek++:this.navigateMonth("next"),this.displayCurrentWeek()}navigateMonth(r){r==="previous"?this.selectedMonth===0?Number(this.selectedYear)>this.years[0]&&(this.selectedYear--,this.selectedMonth=11):this.selectedMonth--:this.selectedMonth===11?this.selectedYear<this.years[this.years.length-1]&&(this.selectedYear++,this.selectedMonth=0):this.selectedMonth++,this.updateChartData(this.selectedYear,this.selectedMonth)}navToCredit(){this.router.navigate(["credits"])}navToMenu(){this.router.navigate(["menu"])}navToPackage(){this.router.navigate(["packages"])}};n.\u0275fac=function(s){return new(s||n)(ge(nn),ge(jt),ge(ha))},n.\u0275cmp=gt({type:n,selectors:[["app-earnings"]],viewQuery:function(s,t){if(s&1&&ki(RG,5),s&2){let g;Ci(g=Si())&&(t.chartContainer=g.first)}},decls:76,vars:5,consts:[["chartContainer",""],[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell"],[1,"material-symbols-outlined"],[1,"sub-container"],[1,"chart-container"],[1,"chart-navigation"],[2,"font-size","36px",3,"click"],[1,"date-range"],[1,"scroll-container"],[1,"icon2"],["id","MyChart"],[1,"bank-transfer"],[1,"middle-text"],[1,"withdraw-div"],[1,"big-text"],[1,"credit-div"],[1,"icon-credit"],[1,"icon"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"credit1"],[1,"title"],[1,"material-symbols-outlined",3,"click"],[1,"credit-div",3,"click"],[1,"package"],["src","assets/packages/silver coin 1.png",1,"package-img"],[2,"height","5rem"]],template:function(s,t){if(s&1){let g=gi();V(0,"div",1)(1,"div",2),Fe("click",function(){return Mt(g),Tt(t.navToMenu())}),Y(2,"\u2630"),j(),V(3,"div",3)(4,"div",4),Fe("click",function(){return Mt(g),Tt(t.navToCredit())}),Ee(5,"img",5),V(6,"pre"),Y(7),j()(),V(8,"div",6)(9,"span",7),Y(10,"notifications"),j()()(),V(11,"div",8)(12,"div",9)(13,"div",10)(14,"span",11),Fe("click",function(){return Mt(g),Tt(t.previousWeek())}),Y(15,"	<"),j(),V(16,"p",12),Y(17),j(),V(18,"span",11),Fe("click",function(){return Mt(g),Tt(t.nextWeek())}),Y(19,">"),j()(),V(20,"div",13,0)(22,"span",14),Y(23,"\u20B9 \xA0"),V(24,"span"),Y(25),j()(),Ee(26,"br")(27,"br"),V(28,"canvas",15),Y(29),j()()(),V(30,"div")(31,"div",16)(32,"span",17),Y(33,"Bank transfer"),j(),V(34,"span",7),Y(35,"chevron_right"),j()(),Ee(36,"br"),V(37,"div",18)(38,"div")(39,"span",19),Y(40,"\u20B9 1897"),j(),V(41,"span",17),Y(42,"28-29 Mar"),j(),V(43,"span",17),Y(44,"Upcoming"),j()(),V(45,"div")(46,"span",19),Y(47,"\u20B9 176"),j(),V(48,"span",17),Y(49,"26-27 Mar"),j(),V(50,"span",17),Y(51,"Success"),j()()()(),V(52,"div",20)(53,"div",21)(54,"div",22)(55,"span",23),Y(56,"poker_chip"),j()(),Y(57," \xA0 \xA0 "),V(58,"div",24)(59,"span",25),Y(60,"Credits"),j(),V(61,"span",25),Y(62),j()()(),V(63,"span",26),Fe("click",function(){return Mt(g),Tt(t.navToCredit())}),Y(64,"chevron_right"),j()(),V(65,"div",27),Fe("click",function(){return Mt(g),Tt(t.navToPackage())}),V(66,"div",21)(67,"span",28),Ee(68,"img",29),Y(69,"\xA0 "),V(70,"pre"),Y(71,"Silver"),j()()(),V(72,"span",26),Fe("click",function(){return Mt(g),Tt(t.navToPackage())}),Y(73,"chevron_right"),j()()()(),Ee(74,"div",30)(75,"app-fotter")}s&2&&(xe(7),zt(t.credits),xe(10),zt(t.dateRange),xe(8),zt(t.earn),xe(4),zt(t.chart),xe(33),zt(t.credits))},dependencies:[dl],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100%;height:100%}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#d16611;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:8rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:5rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border-radius:.4rem;border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh;display:grid;row-gap:2rem}.chart-container[_ngcontent-%COMP%]{width:100%;height:fit-content;display:grid;row-gap:1rem;box-shadow:0 5px 5px #00000080;border-radius:.5rem}.scroll-container[_ngcontent-%COMP%]{position:relative;width:100%;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}#MyChart[_ngcontent-%COMP%]{background-color:#d6ffdf3b;width:100%;display:inline-block;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none;min-width:100%}.chart-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .chart-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{float:left;text-align:left}.icon2[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.8rem;font-weight:500;line-height:24.2px;color:#49a010;float:left;text-align:left;display:flex;margin-left:1rem}.earning-tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:24.2px;float:left;text-align:left}.bank-transfer[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.withdraw-div[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:49% 49%;column-gap:2%}.withdraw-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:grid;padding:1rem;row-gap:0;height:120px;border:.25px solid black;border-radius:.5rem}.credit-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;height:2rem}.icon[_ngcontent-%COMP%]{width:2rem;height:2rem;border-radius:.4rem;border:.25px solid black}.icon-credit[_ngcontent-%COMP%]{display:flex;width:30%;height:2rem}.credit1[_ngcontent-%COMP%]{display:grid;border:none;justify-content:space-around}.rank[_ngcontent-%COMP%]{display:grid;float:left;text-align:left}.title[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:22.94px}.middle-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px}.big-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:20px;font-weight:600;line-height:19.36px}.date-div[_ngcontent-%COMP%]{width:100%;display:flex;column-gap:.5rem}.date-div[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:10rem;height:2rem;border:.25px solid black}.chart-navigation[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.date-range[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"inter" sans-serif;font-weight:500}.package[_ngcontent-%COMP%]{width:max-content;height:2rem;padding:0 .3rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.package-img[_ngcontent-%COMP%]{width:1.3rem;height:1.3rem}.package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1rem;line-height:1.7rem}']});let a=n;return a})();var cL=(()=>{let n=class n{constructor(r){this.router=r}navToHome(){this.router.navigate(["home"])}};n.\u0275fac=function(s){return new(s||n)(ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-waiting-page"]],decls:10,vars:0,consts:[[1,"container"],[1,"sub-container"],["src","assets/new/Man playing Basketball.gif"],[3,"click"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"div"),Ee(3,"img",2)(4,"br")(5,"br"),V(6,"p"),Y(7,"Thanks for uploading your documents, your documents are under review. We will let you once you ready to work."),j()()(),V(8,"button",3),Fe("click",function(){return t.navToHome()}),Y(9,"Next"),j()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:3rem}.sub-container[_ngcontent-%COMP%]{width:80%;margin-top:-5rem;height:max-content;display:grid;align-items:center}.sub-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column}.sub-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60%;height:60%}p[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:16.94px;text-align:center;color:#00000080}button[_ngcontent-%COMP%]{width:90%;height:2.5rem;background:#d16611;color:#f0f8ff;font-size:1.1rem;font-weight:400;line-height:16.94px;border:none;border-radius:.5rem}']});let a=n;return a})();var dL=(()=>{let n=class n{constructor(r){this.router=r}};n.\u0275fac=function(s){return new(s||n)(ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-notification"]],decls:2,vars:0,template:function(s,t){s&1&&(V(0,"p"),Y(1,"notification works!"),j())}});let a=n;return a})();var FG=["dialogTemplate"],LG=a=>({selected:a});function zG(a,n){if(a&1){let d=gi();cm(0),V(1,"div")(2,"p",3),Fe("click",function(){Mt(d);let s=Et();return Tt(s.extend())}),Y(3,"expand_circle_right"),j()(),dm()}}function BG(a,n){if(a&1){let d=gi();cm(0),V(1,"span",17)(2,"input",18),Fe("change",function(){Mt(d);let s=Et().$implicit,t=Et();return Tt(t.availabilityService(s.nameOfService))}),j(),Y(3,"\xA0 "),V(4,"span",19),Y(5),j()(),dm()}if(a&2){let d=Et().$implicit,r=Et();xe(2),rt("checked",r.selectedService===d.nameOfService),xe(3),zt(d.nameOfService)}}function NG(a,n){if(a&1){let d=gi();cm(0),V(1,"span",3),Fe("click",function(){Mt(d);let s=Et(2);return Tt(s.openServiceDialog())}),Y(2,"expand_circle_down"),j(),dm()}}function VG(a,n){if(a&1){let d=gi();V(0,"div",20)(1,"span",21)(2,"input",18),Fe("change",function(){Mt(d);let s=Et().$implicit,t=Et();return Tt(t.availabilityService(s.nameOfService))}),j(),V(3,"span",19),Y(4),j()()()}if(a&2){let d=Et().$implicit,r=Et();xe(2),rt("checked",r.selectedService===d.nameOfService),xe(2),zt(d.nameOfService)}}function jG(a,n){if(a&1&&(cm(0),Zt(1,BG,6,2,"ng-container",4)(2,NG,3,0,"ng-container",4)(3,VG,5,2,"div",16),dm()),a&2){let d=n.index,r=Et();xe(),rt("ngIf",d<=1&&!r.extendServices),xe(),rt("ngIf",d===2&&!r.extendServices),xe(),rt("ngIf",r.extendServices)}}function UG(a,n){if(a&1){let d=gi();cm(0),V(1,"div",22),Fe("click",function(){let s=Mt(d),t=s.$implicit,g=s.index,b=Et();return Tt(b.selected(t,g))}),V(2,"p"),Y(3),j(),V(4,"p"),Y(5),j(),V(6,"span",23),Y(7),j()(),dm()}if(a&2){let d=n.$implicit,r=n.index,s=Et();xe(),rt("ngClass",Mo(4,LG,s.selectedIndex===r)),xe(2),zt(d.day.substring(0,3).toUpperCase()),xe(2),zt(d.date.split("-")[0]),xe(2),zt(d.workingStaus?"check":"close")}}function HG(a,n){if(a&1){let d=gi();V(0,"div",28)(1,"span"),Y(2),j(),V(3,"p")(4,"mat-slide-toggle",29),So("ngModelChange",function(s){let t=Mt(d).$implicit;return Co(t.isSelected,s)||(t.isSelected=s),Tt(s)}),Fe("change",function(s){let t=Mt(d).$implicit,g=Et(2);return Tt(g.onToggleChange(s,t))}),j()()()}if(a&2){let d=n.$implicit;xe(2),zt(d.time),xe(2),wo("ngModel",d.isSelected)}}function WG(a,n){if(a&1&&(V(0,"div",24)(1,"div",25)(2,"span",12),Y(3,"check"),j(),V(4,"p"),Y(5,"confirmation your working hours"),j(),V(6,"span",12),Y(7,"expand_circle_up"),j()(),Ee(8,"br")(9,"div",26),Zt(10,HG,5,2,"div",27),j()),a&2){let d=Et();xe(10),rt("ngForOf",d.nextDaysOfIndex.timming)}}function GG(a,n){if(a&1){let d=gi();V(0,"div")(1,"div",34)(2,"input",18),Fe("change",function(){let s=Mt(d).$implicit,t=Et(2);return Tt(t.availabilityService(s.nameOfService))}),j(),Y(3," \xA0"),V(4,"span",35),Y(5),j()()()}if(a&2){let d=n.$implicit,r=Et(2);xe(2),rt("checked",r.selectedService===d.nameOfService),xe(3),zt(d.nameOfService)}}function $G(a,n){if(a&1){let d=gi();V(0,"h1",30),Y(1,"Select Services"),j(),V(2,"div",31)(3,"form"),Zt(4,GG,6,2,"div",5),j()(),V(5,"div",32)(6,"button",33),Fe("click",function(){Mt(d);let s=Et();return Tt(s.onCancel())}),Y(7,"Cancel"),j(),V(8,"button",33),Fe("click",function(){Mt(d);let s=Et();return Tt(s.onSubmit())}),Y(9,"Submit"),j()()}if(a&2){let d=Et();xe(4),rt("ngForOf",d.services)}}var hL=(()=>{let n=class n{constructor(r,s,t,g,b,M,k){this.location=r,this.renderer=s,this.el=t,this.http=g,this.dialog=b,this.jobDetailsService=M,this.userService=k,this.date=new Date,this.userId=localStorage.getItem("providerId"),this.defaultMonth=this.date.toLocaleDateString("default",{month:"long"}),this.daySelected=String(this.date.getDate()).padStart(2,"0"),this.monthSelected=this.defaultMonth.substring(0,3),this.dateSelected=this.date.getDate(),this.isChecked=!1,this.working=!1,this.extendServices=!1,this.services=[],this.nextFourDays=[],this.nextDaysOfIndex=[],this.selectedService="",this.timing=[{time:"07:00AM - 10:00AM",isSelected:!1},{time:"10:00AM - 01:00PM",isSelected:!1},{time:"01:00PM - 04:00PM",isSelected:!1},{time:"04:00PM - 07:00PM",isSelected:!1}],this.selectedIndex=0,this.api="",this.availabilityResponse=[]}extend(){this.extendServices=!this.extendServices}openServiceDialog(){this.dialogRef=this.dialog.open(this.dialogTemplate),this.dialogRef.afterClosed().subscribe(r=>{r&&(this.services=r)})}onCancel(){this.dialogRef.close()}onSubmit(){this.dialogRef.close(this.services)}ngOnInit(){this.getDetails(),this.getNextFourDays();let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];this.daySelected=r[this.date.getDay()],this.getSelectedService()}getSelectedService(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.services=r[0].works},r=>{console.log(r)})}availabilityService(r){this.selectedService=r,this.showAvailabilityForService(r)}getNextFourDays(){let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s=new Date;for(let t=0;t<10;t++){let g=new Date(s);g.setDate(s.getDate()+t);let b=this.formatDate(g);this.nextFourDays.push({date:b,day:r[g.getDay()],workingStaus:!1,timming:this.timing.map(M=>kt({},M))})}this.nextDaysOfIndex=this.nextFourDays[this.selectedIndex]}formatDate(r){let s=String(r.getDate()).padStart(2,"0"),t=r.getFullYear(),g=r.toLocaleDateString("default",{month:"long"});return`${s}-${g}-${t}`}selected(r,s){console.log(r),this.isChecked=!1,r.workingStaus?this.working=!0:this.working=!1,this.selectedIndex=s,this.dateSelected=r.date.toString().split("-")[0],this.daySelected=r.day,this.monthSelected=r.date.toString().split("-")[1],this.yearSelected=r.date.toString().split("-")[2],this.nextDaysOfIndex=this.nextFourDays[this.selectedIndex],console.log(this.nextDaysOfIndex),console.log(this.monthSelected),this.timing.forEach(t=>t.isSelected=!1)}workingChange(){this.nextFourDays[this.selectedIndex].workingStaus=!this.nextFourDays[this.selectedIndex].workingStaus}onToggleChange(r,s){this.nextDaysOfIndex.timming.forEach(G=>{G.time===s.time&&(G.isSelected=r.checked)}),this.timeSelected=r.checked?s.time:"",console.log(this.dateSelected);let t=new Date(`${this.monthSelected} ${this.dateSelected} ${this.yearSelected}`);t.setDate(this.dateSelected);let g=t.getDate(),b=t.getMonth()+1,M=g<10?`0${g}`:g,k=b<10?`0${b}`:b,L=this.yearSelected;this.fullDate=`${L}-${k}-${M}`,console.log(k)}submitAllData(){console.log(this.checkDuplicate(this.fullDate,this.timeSelected,this.selectedService)),this.checkDuplicate(this.fullDate,this.timeSelected,this.selectedService)?alert("The same time slot on the selected date for the selected service is already taken."):this.sendingData()}sendingData(){this.timeSelected!=""?this.api="https://api.coolieno1.in/v1.0/providers/provider-date":this.api="https://api.coolieno1.in/v1.0/providers/provider-date/delete";let r={providerId:this.userId,service:this.selectedService,date:this.fullDate,work:this.working,time:this.timeSelected};console.log(r),console.log(this.api),this.http.post(this.api,r).subscribe(s=>{console.log(s),alert("Availability added successfully"),this.timing.forEach(t=>t.isSelected=!1),console.log(this.timing),this.getDetails()},s=>{console.log(s),alert("Something went wrong")})}getDetails(){let r=`https://api.coolieno1.in/v1.0/providers/provider-date/${this.userId}`;this.http.get(r).subscribe(s=>{console.log(s),this.availabilityResponse=s,this.showAvailability(this.availabilityResponse)},s=>{console.log(s)})}deleteData(){}showAvailability(r){console.log(this.services),r.forEach(s=>{let t=s.date,g=new Date(t),b=g.getDate(),M=g.toLocaleDateString("default",{month:"long"}),k=`${String(b).padStart(2,"0")}-${M}-${g.getFullYear()}`;this.nextFourDays.forEach(L=>{L.date===k&&(L.workingStaus=s.work,L.timming.forEach(G=>{G.time===s.time&&(G.isSelected=!0)}))})}),console.log(this.nextFourDays)}checkDuplicate(r,s,t){return this.availabilityResponse.some(g=>g.date===r&&g.time===s&&g.service===t)}navToBack(){this.location.back()}showAvailabilityForService(r){console.log("new called"),this.nextFourDays.forEach(s=>{s.workingStaus=!1,s.timming.forEach(t=>{t.isSelected=!1})}),console.log(this.availabilityResponse),this.availabilityResponse.forEach(s=>{if(s.service===r){let t=s.date,g=new Date(t),b=g.getDate(),M=g.toLocaleDateString("default",{month:"long"}),k=`${String(b).padStart(2,"0")}-${M}-${g.getFullYear()}`;this.nextFourDays.forEach(L=>{k===L.date&&(L.workingStaus=!0,L.timming.forEach(G=>{G.time===s.time&&(G.isSelected=!0)}))})}})}};n.\u0275fac=function(s){return new(s||n)(ge(Pi),ge(nl),ge(Zi),ge(nn),ge(Om),ge(Hr),ge(po))},n.\u0275cmp=gt({type:n,selectors:[["app-calender"]],viewQuery:function(s,t){if(s&1&&ki(FG,5),s&2){let g;Ci(g=Si())&&(t.dialogTemplate=g.first)}},decls:27,vars:12,consts:[["dialogTemplate",""],[1,"container"],[1,"headers"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"sub-container"],[1,"working-dates"],[1,"selected-date"],[1,"update"],[1,"custom-checkbox"],["type","checkbox",3,"change","ngModelChange","checked","ngModel"],[1,"material-symbols-outlined",2,"font-size","28px"],["class","confirmation-div",4,"ngIf"],[3,"click"],[2,"width","300px"],["class","extended",4,"ngIf"],[2,"display","flex","align-items","center","justify-content","center"],["type","checkbox",3,"change","checked"],[1,"service-tittle"],[1,"extended"],[1,"service"],[1,"datess",3,"click","ngClass"],[1,"material-symbols-outlined"],[1,"confirmation-div"],[1,"conformation"],[1,"line"],["class","time-confirm",4,"ngFor","ngForOf"],[1,"time-confirm"],["color","accent",3,"ngModelChange","change","ngModel"],["mat-dialog-title",""],["mat-dialog-content","",2,"width","300px"],["mat-dialog-actions","",2,"display","flex","justify-content","space-evenly"],["mat-button","",2,"width","30%","height","2rem",3,"click"],[2,"display","flex","align-items","center","width","100%","height","3rem"],[2,"color","black"]],template:function(s,t){if(s&1){let g=gi();V(0,"div",1)(1,"div",2)(2,"span",3),Fe("click",function(){return Mt(g),Tt(t.navToBack())}),Y(3,"arrow_back"),j(),Zt(4,zG,4,0,"ng-container",4)(5,jG,4,3,"ng-container",5),j(),Ee(6,"br")(7,"br"),V(8,"div",6)(9,"div",7),Zt(10,UG,8,6,"ng-container",5),j(),V(11,"div",8)(12,"span"),Y(13),j()(),V(14,"div",9)(15,"div")(16,"label",10)(17,"input",11),Fe("change",function(){return Mt(g),Tt(t.workingChange())}),So("ngModelChange",function(M){return Mt(g),Co(t.working,M)||(t.working=M),Tt(M)}),j()(),V(18,"span"),Y(19,"Working"),j()(),V(20,"span",12),Y(21),j()(),Zt(22,WG,11,1,"div",13),V(23,"button",14),Fe("click",function(){return Mt(g),Tt(t.submitAllData())}),Y(24,"submit"),j()()(),Zt(25,$G,10,1,"ng-template",15,0,Lb)}s&2&&(xe(4),rt("ngIf",t.extendServices),xe(),rt("ngForOf",t.services),xe(5),rt("ngForOf",t.nextFourDays),xe(3),Rd("",t.daySelected,",",t.monthSelected," ",t.dateSelected,""),xe(3),Ni("checked",t.isChecked),xe(),rt("checked",t.isChecked),wo("ngModel",t.working),xe(4),zt(t.working?"expand_circle_right":"expand_circle_down"),xe(),rt("ngIf",t.working))},dependencies:[Qa,Vr,jr,No,tc,Mr,Bo,Es,YC,DP,AP,kP,Sv],styles:['.container[_ngcontent-%COMP%]{width:90%;height:100vh;padding:1rem}.headers[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.service[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.service-tittle[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1.2rem;font-weight:400;line-height:16.94px;text-align:left}.extended[_ngcontent-%COMP%]{border:1px solid red}.sub-container[_ngcontent-%COMP%]{width:95%;position:relative;left:2.5%;display:grid;row-gap:3rem}.working-dates[_ngcontent-%COMP%]{width:100%;display:flex;column-gap:2rem;justify-content:space-between;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;flex-direction:row;-ms-overflow-style:none;scrollbar-width:none}.datess[_ngcontent-%COMP%]{width:5rem;height:5rem;display:flex;text-align:center;flex-direction:column;border:1px solid black;border-radius:.5rem;flex:0 0 20%;padding-top:1rem;padding-bottom:1rem}.datess.selected[_ngcontent-%COMP%]{background-color:#72d388;border:none;color:#fff}.selected-date[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;letter-spacing:.07em}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:#72d388;border:0}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}.btn[_ngcontent-%COMP%]{width:100%;align-items:center}button[_ngcontent-%COMP%]{width:100%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}.update[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-around;border:.25px solid black;border-radius:.4rem;align-items:center}.update[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%;display:flex;justify-content:space-around;text-align:center;align-items:center}.update[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px;letter-spacing:.07em;text-align:center;align-items:center}.confirmation-div[_ngcontent-%COMP%]{background:#fcf5fc;border:.25px solid rgba(0,0,0,1);border-radius:.4rem;padding:1rem}.conformation[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.line[_ngcontent-%COMP%]{height:1rem;border-bottom:.2px solid transparent;border-top:.25px dashed black}.time-confirm[_ngcontent-%COMP%]{display:flex;justify-content:space-between}']});let a=n;return a})();function qG(a,n){if(a&1){let d=gi();V(0,"div",5),Fe("click",function(){let s=Mt(d).$implicit,t=Et();return Tt(t.selectedJob(s))}),V(1,"div")(2,"p")(3,"span",6),Y(4),j()(),V(5,"p")(6,"span",7),Fe("click",function(){Mt(d);let s=Et();return Tt(s.navToBack())}),Y(7,"account_balance_wallet"),j(),Y(8,"\xA0 "),V(9,"span",8),Y(10),j()(),V(11,"p")(12,"span",7),Fe("click",function(){Mt(d);let s=Et();return Tt(s.navToBack())}),Y(13,"description"),j(),Y(14,"\xA0 "),V(15,"span",8),Y(16),j()()(),V(17,"div")(18,"p",6),Y(19,"9:30"),j(),V(20,"p",8),Y(21,"89-0"),j()()(),Ee(22,"br")}if(a&2){let d=n.$implicit;xe(4),zt(d.name),xe(6),bn("Job value:",d.value,""),xe(6),bn("Online Payments:",d.paymentDone,"")}}var uL=(()=>{let n=class n{navToBack(){this.location.back()}constructor(r,s,t){this.location=r,this.jobDetailsService=s,this.router=t,this.jobs=[{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"},{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"},{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"}]}selectedJob(r){console.log(r),this.jobDetailsService.selectedJobDetails(r),this.router.navigate(["jobDetails"])}};n.\u0275fac=function(s){return new(s||n)(ge(Pi),ge(Hr),ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-job-history"]],decls:11,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","24px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"section",3,"click"],[1,"main-text"],[1,"material-symbols-outlined",2,"font-size","1rem",3,"click"],[1,"text"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return t.navToBack()}),Y(3,"arrow_back"),j(),Y(4,"\xA0"),V(5,"span",3),Y(6,"Job History"),j()(),V(7,"div",4)(8,"div"),Cr(9,qG,23,3,null,null,xo),j()()()),s&2&&(xe(9),Sr(t.jobs))},styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%}.section[_ngcontent-%COMP%]{width:100%;height:7rem;border:.25px solid black;border-radius:.5rem;display:flex;justify-content:space-between;align-items:center;text-align:center}.section[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:.5rem;display:flexbox;text-align:left}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:19.36px}.main-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:19.36px}.text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:14.52px}']});let a=n;return a})();function YG(a,n){if(a&1){let d=gi();V(0,"div",16),Fe("click",function(){let s=Mt(d).$implicit,t=Et();return Tt(t.selected(s))}),Y(1),j()}if(a&2){let d=n.$implicit;xe(),zt(d)}}var pL=(()=>{let n=class n{navToBack(){this.location.back()}constructor(r,s,t){this.location=r,this.http=s,this.razorPayService=t,this.credits=[20,50,100,250],this.selectedValue=0,this.AmountToPay=0,this.payOnline=!1,this.deductNextPayout=!1}entredAmount(){this.AmountToPay=this.selectedValue}selected(r){this.selectedValue=r,this.AmountToPay=this.selectedValue}togglePayOnline(r){this.payOnline=!this.payOnline,this.payOnline&&(this.deductNextPayout=!1,this.makePayment())}toggleDeductNextPayout(){this.deductNextPayout=!this.deductNextPayout,this.deductNextPayout&&(this.payOnline=!1)}makePayment(){let r=this.AmountToPay;this.razorPayService.payWithRazorpay(r,"order_id_from_backend","INR")}};n.\u0275fac=function(s){return new(s||n)(ge(Pi),ge(nn),ge(ha))},n.\u0275cmp=gt({type:n,selectors:[["app-add-credit"]],decls:32,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","32px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"credit-input"],["src","assets/logo/credit12.png"],["type","number","placeholder","Enter number of credits",3,"ngModelChange","input","value","ngModel"],[1,"quickSelect-div"],[1,"maintext"],[1,"selec-div"],["class","maintext",3,"click",4,"ngFor","ngForOf"],[1,"Amount-div"],[1,"selecPayment-div"],[1,"minText"],["type","checkbox",3,"change","checked"],[1,"maintext",3,"click"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return t.navToBack()}),Y(3,"arrow_back"),j(),Y(4,"\xA0 "),V(5,"span",3),Y(6,"Add credits"),j()(),V(7,"div",4)(8,"div",5),Ee(9,"img",6),V(10,"input",7),So("ngModelChange",function(b){return Co(t.selectedValue,b)||(t.selectedValue=b),b}),Fe("input",function(){return t.entredAmount()}),j()(),V(11,"div",8)(12,"span",9),Y(13,"Quick select"),j(),V(14,"div",10),Zt(15,YG,2,1,"div",11),j()(),V(16,"div",12)(17,"span",9),Y(18,"Amount to pay"),j(),V(19,"p",9),Y(20),j()(),V(21,"div",13)(22,"span",9),Y(23,"Select payment method"),j(),Ee(24,"br")(25,"br"),V(26,"p",14)(27,"input",15),Fe("change",function(b){return t.togglePayOnline(b)}),j(),Y(28,"\xA0Pay Online "),j(),V(29,"p",14)(30,"input",15),Fe("change",function(){return t.toggleDeductNextPayout()}),j(),Y(31,"\xA0Deduct from next payout "),j()()()()),s&2&&(xe(10),rt("value",t.selectedValue),wo("ngModel",t.selectedValue),xe(5),rt("ngForOf",t.credits),xe(5),bn("\u20B9\xA0 ",t.AmountToPay,""),xe(7),rt("checked",t.payOnline),xe(3),rt("checked",t.deductNextPayout))},dependencies:[Vr,ho,bu,Mr,Es],styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.6rem;font-weight:500;line-height:19.36px}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%;display:grid;row-gap:2rem}.maintext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px}.minText[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:19.36px}.credit-input[_ngcontent-%COMP%]{height:3rem;width:100%;border:.25px solid black;border-radius:.4rem;display:flex;align-items:center;justify-content:space-around}.credit-input[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1rem;height:1rem}.credit-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80%;height:2.5rem;outline:0;border-width:0;font-size:1.2rem}.quickSelect-div[_ngcontent-%COMP%]{width:100%;height:max-content;display:grid;row-gap:1.5rem}.selec-div[_ngcontent-%COMP%]{width:100%;height:max-content;display:flex;flex-wrap:wrap;column-gap:3rem;row-gap:1.5rem}.selec-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{border:.25px solid black;width:4.8rem;height:2.5rem;display:flex;border-radius:.5rem;align-items:center;justify-content:center}.Amount-div[_ngcontent-%COMP%]{width:90%;height:4rem;display:flex;align-items:center;text-align:center;padding-left:5%;padding-right:5%;justify-content:space-between;border:.25px solid black;border-radius:.5rem}.minText[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}']});let a=n;return a})();var mL=(()=>{let n=class n{navToBack(){this.location.back()}constructor(r,s){this.location=r,this.userDetails=s,this.bankDetails=[],this.getUserDetails()}getUserDetails(){this.userDetails.getFinancialDetails().subscribe(r=>{console.log(r),this.bankDetails=r},r=>{console.log(r)})}};n.\u0275fac=function(s){return new(s||n)(ge(Pi),ge(po))},n.\u0275cmp=gt({type:n,selectors:[["app-financial-details"]],decls:61,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"gst-div"],[1,"largetext"],[1,"panDetails"],[1,"edit"],[1,"bankdetails"],[1,"normaltext"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return t.navToBack()}),Y(3,"arrow_back"),j(),Y(4,"\xA0 "),V(5,"span",3),Y(6,"Financial details"),j()(),V(7,"div",4)(8,"div",5)(9,"span",6),Y(10,"GST Details"),j(),V(11,"span",6),Y(12,"Add+"),j()(),V(13,"div",7)(14,"p")(15,"span",6),Y(16,"Aadhar Card details"),j(),V(17,"span",8),Y(18,"Edit"),j()(),V(19,"p")(20,"span",6),Y(21,"Aadhar "),j(),V(22,"span",6),Y(23),j()()(),V(24,"div",7)(25,"p")(26,"span",6),Y(27,"PAN Card details"),j(),V(28,"span",8),Y(29,"Edit"),j()(),V(30,"p")(31,"span",6),Y(32,"PAN "),j(),V(33,"span",6),Y(34),j()()(),V(35,"div",9)(36,"p")(37,"span",6),Y(38,"Bank account details"),j(),V(39,"span",8),Y(40,"Edit"),j()(),V(41,"p")(42,"span",10),Y(43,"Account number"),j(),V(44,"span",6),Y(45),j()(),V(46,"p")(47,"span",10),Y(48,"Bank name"),j(),V(49,"span",6),Y(50),j()(),V(51,"p")(52,"span",10),Y(53,"IFSC code"),j(),V(54,"span",6),Y(55),j()(),V(56,"p")(57,"span",10),Y(58,"Name in account"),j(),V(59,"span",6),Y(60),j()()()()()),s&2&&(xe(23),zt(t.bankDetails.aadhaarNumber),xe(11),zt(t.bankDetails.pan),xe(11),zt(t.bankDetails.accountNumber),xe(5),zt(t.bankDetails.bankName),xe(5),zt(t.bankDetails.ifscCode),xe(5),zt(t.bankDetails.accountName))},styles:['.container[_ngcontent-%COMP%]{width:93vw;height:100vh;padding:1rem .5rem 0 1rem}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.5rem;font-weight:500;line-height:19.36px}.sub-container[_ngcontent-%COMP%]{width:97%;position:relative;top:3.5%;display:grid;row-gap:2rem}.gst-div[_ngcontent-%COMP%]{width:90%;height:4rem;border:.25px solid black;display:flex;justify-content:space-between;align-items:center;text-align:center;padding:5%;border-radius:.5rem}.panDetails[_ngcontent-%COMP%]{width:90%;height:5rem;border:.25px solid black;display:flex;flex-direction:column;row-gap:1rem;padding:5%;border-radius:.5rem}p[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;text-align:center}.bankdetails[_ngcontent-%COMP%]{width:90%;height:13rem;border:.25px solid black;display:flex;flex-direction:column;row-gap:1rem;padding:5%;border-radius:.5rem}.largetext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px}.edit[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px;color:#00000080}.normaltext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px}']});let a=n;return a})();var fL=(()=>{let n=class n{navToBack(){this.location.back()}navToHelp(){this.router.navigate(["help"])}constructor(r,s,t){this.jobDetailsService=r,this.location=s,this.router=t,this.orderDetails={_id:"669e626966dc877d8f903918",providerId:"669caa1c061e2bbc2ae85c1c",status:"Accepted",orderId:{_id:"669cec5b2646b0e97309c544",userId:"669115768f0d9e6728c61edd",addressId:"669caa31061e2bbc2ae85c24",address:{latitude:17.4975851,longitude:78.3961531,pincode:"500060",city:"Hyderabad",state:"Telangana",username:"Ramarao",mobileNumber:"9490856692"},paymentId:"pay_ObBS9ZdsRoztUF",categoryIds:["Lock smith"],subCategoryIds:["Key duplication & replacement"],items:[{serviceName:"Lost car key replacement & programming (transponder keys)",serviceVariants:[{variantName:"Normal cleaning",price:5e3,serviceTime:239,metric:"quantity",min:1,max:2}],quantity:1,selectedDate:"22",selectedTime:"9AM - 10AM",scheduledDate:"22-6-2024 9AM - 10AM"}]}},this.noJobs=this.orderDetails.orderId,this.jobDetailsService.getSelectedJob(),console.log(this.jobDetailsService.getSelectedJob())}};n.\u0275fac=function(s){return new(s||n)(ge(Hr),ge(Pi),ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-job-details"]],decls:65,vars:9,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","24px",3,"click"],[1,"help",3,"click"],[1,"sub-container"],[1,"name"],[1,"tittle"],[1,"customer-details"],[1,"sub-tittle"],[1,"Details"],[1,"para-section"],[1,"highlight-text"],[1,"line"],[1,"time-div"],[1,"summary"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return t.navToBack()}),Y(3,"arrow_back"),j(),V(4,"div",3),Fe("click",function(){return t.navToHelp()}),Y(5,"Help?"),j()(),V(6,"div",4)(7,"div",5)(8,"span",6),Y(9),j(),V(10,"span"),Y(11),j()(),V(12,"div",7)(13,"span",8),Y(14,"Customers Details"),j(),V(15,"div",9)(16,"p",10)(17,"span",11),Y(18,"Location"),j(),V(19,"span"),Y(20),j()(),Ee(21,"div",12)(22,"br"),V(23,"div",13)(24,"p",10)(25,"span",11),Y(26,"Job start"),j(),V(27,"span"),Y(28," 12 Apr 06:30 PM "),j()(),V(29,"p",10)(30,"span",11),Y(31,"Job End"),j(),V(32,"span"),Y(33,"12 Apr 07:30 PM"),j()()()()(),V(34,"div",14)(35,"span",8),Y(36,"Summary"),j(),V(37,"div",9)(38,"div",13)(39,"span",11),Y(40),j(),V(41,"span",8),Y(42),j()(),Ee(43,"div",12)(44,"br"),V(45,"div",13)(46,"p")(47,"span"),Y(48,"Others"),j(),Ee(49,"br"),V(50,"span",11),Y(51,"Convenience Fee"),j()(),V(52,"p",8),Y(53,"69"),j()(),Ee(54,"div",12)(55,"br"),V(56,"div",13)(57,"p")(58,"span",11),Y(59,"Total value"),j(),Ee(60,"br"),V(61,"span"),Y(62,"commission 5 credits"),j()(),V(63,"p",8),Y(64),j()()()()()()),s&2&&(xe(9),zt(t.orderDetails.orderId.address.username),xe(2),zt(t.orderDetails.orderId.items[0].scheduledDate),xe(9),Rd(" ",t.orderDetails.orderId.address.city,", ",t.orderDetails.orderId.address.state,", ",t.orderDetails.orderId.address.pincode," "),xe(20),rl("",t.orderDetails.orderId.items[0].quantity," \xA0 X \xA0 ",t.orderDetails.orderId.categoryIds,""),xe(2),bn("\u20B9 \xA0",t.orderDetails.orderId.items[0].serviceVariants[0].price,""),xe(22),zt(t.orderDetails.orderId.items[0].serviceVariants[0].price))},styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;justify-content:space-between;align-items:center}.help[_ngcontent-%COMP%]{width:4rem;height:2.5rem;border:none;background:#20193f;border-radius:1.3rem;color:#fff;display:flex;justify-content:center;align-items:center}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:19.36px;margin-bottom:1rem}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%;display:grid;row-gap:1.5rem}.name[_ngcontent-%COMP%]{position:relative;left:5%;display:flex;flex-direction:column}.sub-tittle[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;padding:0 0 1rem 1rem;margin-bottom:.5rem}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:600;line-height:16.94px;margin-bottom:.5rem}.customer-details[_ngcontent-%COMP%]{padding-top:1rem;display:grid;row-gap:1rem}.time-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.Details[_ngcontent-%COMP%]{width:90%;padding:1rem;border:.25px solid black;border-radius:.5rem}.summary[_ngcontent-%COMP%]{padding-top:1rem;display:grid;row-gap:1rem}.line[_ngcontent-%COMP%]{border:0;border-bottom:1px dashed rgb(45,44,44)}.para-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}']});let a=n;return a})();function ZG(a,n){if(a&1&&(V(0,"div")(1,"label",6),Ee(2,"input",7),j(),Y(3," \xA0 "),V(4,"span",3),Y(5),j()(),Ee(6,"br")),a&2){let d=n.$implicit;xe(),Ni("checked",d.checked),xe(),rt("checked",d.checked),xe(3),zt(d.name)}}var gL=(()=>{let n=class n{navToBack(){this.location.back()}constructor(r){this.location=r,this.items=[{name:"Contact Details",checked:!0},{name:"Aadhar card",checked:!0},{name:"Bank Details",checked:!0},{name:"Professional documents",checked:!1}]}toggleCheckbox(){}};n.\u0275fac=function(s){return new(s||n)(ge(Pi))},n.\u0275cmp=gt({type:n,selectors:[["app-identity-verification"]],decls:13,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"para"],[1,"verify-div"],[1,"custom-checkbox"],["type","checkbox","disabled","",3,"checked"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Fe("click",function(){return t.navToBack()}),Y(3,"arrow_back"),j(),Y(4,"\xA0 "),V(5,"span",3),Y(6,"Identity Verification"),j()(),V(7,"div",4)(8,"p"),Y(9,"We were to successfully verify your details . As a part of our quality process we will request you to re-verify the information every 5months "),j()(),V(10,"div",5),Cr(11,ZG,7,4,null,null,xo),j()()),s&2&&(xe(11),Sr(t.items))},styles:['.container[_ngcontent-%COMP%]{width:92vw;padding:1rem;display:grid;row-gap:2rem}.para[_ngcontent-%COMP%]{background-color:#ef8c534d;width:90%;padding:1rem;border-radius:.5rem;color:#ffa800}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:green}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}input[type=checkbox][disabled][_ngcontent-%COMP%]{cursor:not-allowed;background-color:#f0f0f0}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.5rem;font-weight:500;line-height:19.36px}']});let a=n;return a})();var XG=["footer"],KG=a=>({active:a});function QG(a,n){if(a&1){let d=gi();V(0,"button",13),Fe("click",function(){let s=Mt(d).$implicit,t=Et();return Tt(t.setActiveButton(s))}),Y(1),j()}if(a&2){let d=n.$implicit,r=Et();rt("ngClass",Mo(2,KG,r.activeButton===d)),xe(),bn(" ",d," ")}}function JG(a,n){if(a&1){let d=gi();V(0,"span",15)(1,"a",20)(2,"span",6),Y(3," call "),j()(),V(4,"span",6),Y(5," chat "),j(),V(6,"span",21),Fe("click",function(){Mt(d);let s=Et(2);return Tt(s.navToArrived())}),Y(7," directions "),j()()}}function e9(a,n){if(a&1&&(V(0,"div",14)(1,"span",15)(2,"span",16),Y(3),j(),Zt(4,JG,8,0,"span",17),j(),V(5,"span",16),Y(6),j(),V(7,"span",18),Y(8),j(),V(9,"span",19)(10,"span",18),Y(11),j(),V(12,"span",16),Y(13),j()(),V(14,"span",18),Y(15),j()()),a&2){let d=n.$implicit;xe(3),zt(d.orderId.address.username),xe(),rt("ngIf",d.status==="Accepted"||d.status==="InProgress"),xe(2),zt(d.orderId.categoryIds[0]),xe(2),zt(d.orderId.subCategoryIds[0]),xe(3),zt(d.orderId.items[0].scheduledDate),xe(2),zt(d.orderId.items[0].serviceVariants[0].price),xe(2),Rd("",d.orderId.address.city," ",d.orderId.address.state," ",d.orderId.address.pincode,"")}}var _L=(()=>{let n=class n{navBack(){this.location.back()}constructor(r,s,t,g){this.location=r,this.router=s,this.razorpayService=t,this.orderService=g,this.buttons=["Ongoing","Pending","Completed","Cancelled"],this.activeButton="Ongoing",this.text=this.activeButton,this.filterStatus="Accepted",this.credits=this.razorpayService.userCredit,this.getOrderDetails()}getOrderDetails(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r),this.order=r,this.filterOrder()},error:r=>{console.log(r)}})}setActiveButton(r){this.activeButton=r,this.text=r,this.assignOrder()}assignOrder(){switch(this.activeButton){case"Ongoing":this.filterStatus="Accepted";break;case"Pending":this.filterStatus="InProgress";break;case"Completed":this.filterStatus="Completed";break;case"Cancelled":this.filterStatus="Cancelled";break}this.filterOrder()}filterOrder(){let r=this.order.filter(s=>s.status.toLowerCase().includes(this.filterStatus.toLowerCase()));console.log(r),this.filteredOrder=r}navTo(r){switch(r){case"credit":this.router.navigate(["credits"]);break;case"notification":this.router.navigate(["notification"]);break;case"menu":this.router.navigate(["menu"])}}navToArrived(){this.router.navigate(["arrived"])}};n.\u0275fac=function(s){return new(s||n)(ge(Pi),ge(jt),ge(ha),ge(mo))},n.\u0275cmp=gt({type:n,selectors:[["app-ongoing"]],viewQuery:function(s,t){if(s&1&&ki(XG,5),s&2){let g;Ci(g=Si())&&(t.footer=g.first)}},decls:20,vars:3,consts:[[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined"],[1,"sub-container"],[1,"cat"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"content-container"],["class","content",4,"ngFor","ngForOf"],[2,"height","5rem"],[3,"click","ngClass"],[1,"content"],[1,"icons-div"],[1,"highlight-text"],["class","icons-div",4,"ngIf"],[1,"normal-text"],[1,"service-div"],["href","'tel:'+ item.orderId.address.mobileNumber"],[1,"material-symbols-outlined",3,"click"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1),Fe("click",function(){return t.navTo("menu")}),Y(2,"\u2630"),j(),V(3,"div",2)(4,"div",3),Fe("click",function(){return t.navTo("credit")}),Ee(5,"img",4),V(6,"pre"),Y(7),j()(),V(8,"div",5),Fe("click",function(){return t.navTo("notification")}),V(9,"span",6),Y(10,"notifications"),j()()(),V(11,"div",7)(12,"div",8),Zt(13,QG,2,4,"button",9),j(),V(14,"div",10),Ee(15,"br"),Zt(16,e9,16,9,"div",11),j(),Ee(17,"br"),j()(),Ee(18,"div",12)(19,"app-fotter")),s&2&&(xe(7),zt(t.credits),xe(6),rt("ngForOf",t.buttons),xe(3),rt("ngForOf",t.filteredOrder))},dependencies:[Qa,Vr,jr,dl],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#d16611;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:8rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:5rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border-radius:.4rem;border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh}.cat[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px;border-bottom:2px solid transparent;cursor:pointer}.cat[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-bottom:1px solid #D70D09}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:border-bottom .3s}.content-container[_ngcontent-%COMP%]{width:100%;height:92%;overflow-y:auto;scroll-snap-type:y;scrollbar-width:none;display:flex;flex-direction:column;gap:2rem}.content[_ngcontent-%COMP%]{width:87%;display:flex;flex-direction:column;gap:.8rem;padding:1.5rem;box-shadow:0 1px 3px #000;border-radius:.5rem}.icons-div[_ngcontent-%COMP%]{display:flex;gap:1rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:16.94px;text-align:left;color:#000}.normal-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:15.73px;text-align:left;color:#000}']});let a=n;return a})();var t9=["videoPlayer"],i9=["activeVideo"];function n9(a,n){if(a&1){let d=gi();V(0,"div",10),Fe("click",function(){let s=Mt(d).index,t=Et();return Tt(t.getVideoUrl(s))}),V(1,"div",11),Fe("click",function(){let s=Mt(d).index,t=Et();return Tt(t.getVideoUrl(s))}),Ee(2,"img",12),j(),Ee(3,"br"),j()}}function r9(a,n){if(a&1){let d=gi();V(0,"div",13),Fe("click",function(){Mt(d);let s=Et();return Tt(s.stopVideo())}),V(1,"video",14,0),Fe("ended",function(){Mt(d);let s=Et();return Tt(s.onVideoEnded())})("timeupdate",function(){Mt(d);let s=Ts(2),t=Et();return Tt(t.preventSeek(s))})("loadedmetadata",function(){Mt(d);let s=Ts(2),t=Et();return Tt(t.onVideoLoaded(s))}),j()()}if(a&2){let d=Et();xe(),rt("src",d.getVideoUrl(d.currentVideoIndex),Er)}}function o9(a,n){if(a&1){let d=gi();V(0,"div")(1,"button",15),Fe("click",function(){Mt(d);let s=Et();return Tt(s.navigateWaiting())}),Y(2,"Go to Home"),j()()}}var yL=(()=>{let n=class n{navBack(){}constructor(r,s,t){this.http=r,this.tranningService=s,this.router=t,this.videos=[],this.pupUp=!1,this.bucketName="coolie1-dev",this.region="ap-south-1",this.currentVideoIndex=0,this.lastTime=0,this.isVideoPlaying=!1,this.showNavigationButton=!1}ngOnInit(){this.gettingVideos()}gettingVideos(){this.tranningService.gettingInductionVeideos().subscribe(r=>{console.log(r),this.videos=r},r=>{console.log(r)})}playVideo(r){this.pupUp=!0,this.currentVideoIndex=r,this.isVideoPlaying=!0,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())}stopVideo(){this.isVideoPlaying=!1,this.activeVideo&&this.activeVideo.nativeElement&&this.activeVideo.nativeElement.pause()}skipVideo(){this.playNextVideo()}onVideoEnded(){this.pupUp=!1,this.playNextVideo()}onVideoLoaded(r){r.play()}preventSeek(r){r.currentTime>this.lastTime+1?r.currentTime=this.lastTime:this.lastTime=r.currentTime}playNextVideo(){this.currentVideoIndex<this.videos.length-1?(this.currentVideoIndex++,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())):(this.isVideoPlaying=!1,alert("Congrats you have completed the traning"),this.navigateWaiting(),this.showNavigationButton=!0)}getVideoUrl(r){return this.pupUp=!0,`https://${this.bucketName}.s3.${this.region}.amazonaws.com/${this.videos[r].videoKey}`}navigateWaiting(){this.router.navigate(["waiting"])}};n.\u0275fac=function(s){return new(s||n)(ge(nn),ge(Wm),ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-induction"]],viewQuery:function(s,t){if(s&1&&(ki(t9,5),ki(i9,5)),s&2){let g;Ci(g=Si())&&(t.videoPlayer=g.first),Ci(g=Si())&&(t.activeVideo=g.first)}},decls:15,vars:5,consts:[["activeVideo",""],[1,"tittle-div"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-tittle-div"],[1,"container"],[1,"sub-container"],["class","videoss",3,"click",4,"ngFor","ngForOf"],["class","overlay",3,"click",4,"ngIf"],[4,"ngIf"],[1,"videoss",3,"click"],[1,"dummy-video",3,"click"],["src","assets/demo/video.png"],[1,"overlay",3,"click"],["controls","","autoplay","","type","video/mp4",1,"active-video",3,"ended","timeupdate","loadedmetadata","src"],[3,"click"]],template:function(s,t){s&1&&(V(0,"div",1)(1,"span",2),Fe("click",function(){return t.navBack()}),Y(2,"arrow_back"),j(),V(3,"span",3),Y(4,"Induction videos"),j()(),V(5,"div",4)(6,"span"),Y(7," Complete the Training session!! "),j(),V(8,"span"),Y(9," You will be moved to next process "),j()(),V(10,"div",5)(11,"div",6),Zt(12,n9,4,0,"div",7),j()(),Zt(13,r9,3,1,"div",8)(14,o9,3,0,"div",9)),s&2&&(xe(10),Ni("blur",t.isVideoPlaying),xe(2),rt("ngForOf",t.videos),xe(),rt("ngIf",t.pupUp),xe(),rt("ngIf",t.showNavigationButton))},dependencies:[Vr,jr],styles:['.tittle-div[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin:1rem 0 2rem 1rem}.tittle[_ngcontent-%COMP%]{font-size:1.3rem;font-family:"inter" sans-serif;font-weight:500}.sub-tittle-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem;justify-content:center;text-align:center;margin-bottom:1rem}.sub-tittle-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-size:1.1rem;font-family:"inter" sans-serif;font-weight:500;color:red}.sub-tittle-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.1rem;font-family:"inter" sans-serif;font-weight:400;color:#0009}#video[_ngcontent-%COMP%]{width:100%}video[_ngcontent-%COMP%]{width:90%;height:360px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin-top:10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:space-around;align-items:center;text-align:center}.blur[_ngcontent-%COMP%]{filter:blur(5px)}video[_ngcontent-%COMP%]{width:300px;height:200px;margin:10px;cursor:pointer}.videoss[_ngcontent-%COMP%]{width:90%;display:grid;row-gap:2rem}.dummy-video[_ngcontent-%COMP%]{width:100%}.dummy-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:fixed;top:0%;width:100%;height:100%;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}.overlay[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.active-video[_ngcontent-%COMP%]{width:640px;height:360px}button[_ngcontent-%COMP%]{margin-top:10px;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{cursor:pointer}']});let a=n;return a})();var bL=(()=>{let n=class n{constructor(r,s){this.logInService=r,this.router=s}navTo(){console.log(localStorage.getItem("providerId")),localStorage.getItem("providerId")?this.router.navigate(["home"]):this.router.navigate(["selectAccount"])}};n.\u0275fac=function(s){return new(s||n)(ge(tr),ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-start"]],decls:17,vars:0,consts:[[1,"container"],[1,"logo"],["src","assets/logo/logo png1.png","alt","Coolie No. 1"],[1,"content"],["src","assets/location/login-home-services-image.png","alt","Worker",1,"worker-image"],[1,"text"],[1,"cta-button",3,"click"],[1,"material-symbols-outlined"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1),Ee(2,"img",2),j(),V(3,"div",3),Ee(4,"img",4),V(5,"div",5)(6,"h2"),Y(7,"Home "),V(8,"span"),Y(9,"SERVICES"),j(),Y(10," at your "),Ee(11,"br"),Y(12," Door Step"),j(),V(13,"button",6),Fe("click",function(){return t.navTo()}),Y(14,"Let's Go \xA0 "),V(15,"span",7),Y(16," arrow_forward "),j()()()()())},styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:20px;height:100vh;box-sizing:border-box;text-align:center;background:radial-gradient(circle at bottom right,#cd2e28 50%,#fff 45%)}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80%;max-width:300px;margin-bottom:20px}.content[_ngcontent-%COMP%]{position:relative;top:15%;display:flex;flex-direction:column;align-items:center;width:100%}.worker-image[_ngcontent-%COMP%]{width:12rem;max-width:13.5rem}.text[_ngcontent-%COMP%]{margin-top:20px}.text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;color:#fff}.text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff}.cta-button[_ngcontent-%COMP%]{background-color:transparent;color:#fff;border:none;padding:15px 30px;font-size:18px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;border-radius:5px}.cta-button[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{margin-left:10px;font-size:24px}@media (min-width: 600px){.container[_ngcontent-%COMP%]{border:1px solid black;flex-direction:row;justify-content:space-around;text-align:left}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50%}.content[_ngcontent-%COMP%]{flex-direction:row;align-items:center}.worker-image[_ngcontent-%COMP%]{width:50%}.text[_ngcontent-%COMP%]{margin-top:0;margin-left:20px}.text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:32px}.cta-button[_ngcontent-%COMP%]{font-size:20px;padding:15px 40px}}@media (min-width: 1024px){.container[_ngcontent-%COMP%]{padding:40px}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:40%}.content[_ngcontent-%COMP%]{width:60%}.worker-image[_ngcontent-%COMP%]{width:40%}.text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:36px}.cta-button[_ngcontent-%COMP%]{font-size:22px;padding:20px 50px}}"]});let a=n;return a})();function a9(a,n){a&1&&(V(0,"span"),Y(1,"\u2192"),j())}function s9(a,n){a&1&&(V(0,"span"),Y(1,"\u2714"),j())}function l9(a,n){a&1&&(V(0,"span"),Y(1,"\u2192"),j())}function c9(a,n){a&1&&(V(0,"span"),Y(1,"\u2714"),j())}var vL=(()=>{let n=class n{constructor(r,s,t){this.loginService=r,this.router=s,this.jobDetailsService=t,this.isExistingActive=!1,this.isNewActive=!1,this.startX=0,this.isDragging=!1;let g=localStorage.getItem("providerId");this.jobDetailsService.getUserDetails(g)}onTouchStart(r,s){this.startX=r.touches[0].clientX,this.isDragging=!0}onTouchMove(r,s){if(this.isDragging){let t=r.touches[0].clientX-this.startX;s==="existing"?this.handleSlide(t,"existing"):s==="new"&&this.handleSlide(t,"new")}}onTouchEnd(r){this.isDragging=!1}onMouseDown(r,s){this.startX=r.clientX,this.isDragging=!0}onMouseMove(r,s){if(this.isDragging){let t=r.clientX-this.startX;s==="existing"?this.handleSlide(t,"existing"):s==="new"&&this.handleSlide(t,"new")}}onMouseUp(r){this.isDragging=!1}handleSlide(r,s){s==="existing"?r>50&&!this.isExistingActive?(this.isExistingActive=!0,this.onToggleChange("existing"),this.isDragging=!1):r<-50&&this.isExistingActive&&(this.isExistingActive=!1,this.isDragging=!1):s==="new"&&(r>50&&!this.isNewActive?(this.isNewActive=!0,this.onToggleChange("new"),this.isDragging=!1):r<-50&&this.isNewActive&&(this.isNewActive=!1,this.isDragging=!1))}onToggleChange(r){r==="existing"?(this.loginService.setLogInApi(),this.navigateBasedOnAccount()):r==="new"&&(this.loginService.setSignUpApi(),setTimeout(()=>{this.router.navigate(["log-in"])},1e3))}navigateBasedOnAccount(){localStorage.getItem("providerId")?this.jobDetailsService.userDetails?setTimeout(()=>{this.router.navigate(["home"])},1e3):setTimeout(()=>{this.router.navigate(["aboutUser"])},1e3):setTimeout(()=>{this.router.navigate(["log-in"])},1e3)}};n.\u0275fac=function(s){return new(s||n)(ge(tr),ge(jt),ge(Hr))},n.\u0275cmp=gt({type:n,selectors:[["app-select-account"]],decls:23,vars:8,consts:[[1,"container"],[1,"sub-container"],[1,"sp-div"],[1,"img-div"],["src","assets/logo/start2.png","alt","Logo"],[1,"slide-container",3,"touchstart","touchmove","touchend","mousedown","mousemove","mouseup"],[1,"placehlder"],[1,"slider"],[4,"ngIf"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),Y(4,"Hey!"),j(),V(5,"span"),Y(6,"Join now"),j()(),V(7,"div",3),Ee(8,"img",4),j(),V(9,"div",5),Fe("touchstart",function(b){return t.onTouchStart(b,"existing")})("touchmove",function(b){return t.onTouchMove(b,"existing")})("touchend",function(){return t.onTouchEnd("existing")})("mousedown",function(b){return t.onMouseDown(b,"existing")})("mousemove",function(b){return t.onMouseMove(b,"existing")})("mouseup",function(){return t.onMouseUp("existing")}),V(10,"div",6)(11,"span"),Y(12,"Existing Provider"),j()(),V(13,"div",7),Zt(14,a9,2,0,"span",8)(15,s9,2,0,"span",8),j()(),V(16,"div",5),Fe("touchstart",function(b){return t.onTouchStart(b,"new")})("touchmove",function(b){return t.onTouchMove(b,"new")})("touchend",function(){return t.onTouchEnd("new")})("mousedown",function(b){return t.onMouseDown(b,"new")})("mousemove",function(b){return t.onMouseMove(b,"new")})("mouseup",function(){return t.onMouseUp("new")}),V(17,"div",6)(18,"span"),Y(19,"New Provider"),j()(),V(20,"div",7),Zt(21,l9,2,0,"span",8)(22,c9,2,0,"span",8),j()()()()),s&2&&(xe(13),Ni("active",t.isExistingActive),xe(),rt("ngIf",!t.isExistingActive),xe(),rt("ngIf",t.isExistingActive),xe(5),Ni("active",t.isNewActive),xe(),rt("ngIf",!t.isNewActive),xe(),rt("ngIf",t.isNewActive))},dependencies:[jr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;align-items:center;justify-content:center;background-color:#f5f5f5}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:400px;display:flex;flex-direction:column;align-items:center;row-gap:1rem}.sp-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:left}span[_ngcontent-%COMP%]{float:left;font-family:Poppins,sans-serif;font-size:24px;font-weight:600;line-height:36px;text-align:left}.img-div[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.img-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.slide-container[_ngcontent-%COMP%]{width:100%;height:50px;background-color:#d16611;border-radius:25px;position:relative;display:flex;align-items:center}.slider[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#000;font-size:14px;font-weight:200;position:absolute;left:5px;transition:left .3s}.slider.active[_ngcontent-%COMP%]{left:50%}.placehlder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:50px;font-family:"Poppins" sans-serif;font-size:16px;font-weight:400;color:#fff}']});let a=n;return a})();var xL=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275cmp=gt({type:n,selectors:[["app-congrats"]],decls:14,vars:0,consts:[[1,"main"],[1,"container"],["src","assets/new/congrats.png"],[1,"text"],[1,"arrow-container"],["src","assets/new/round arrow.png"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"div"),Ee(3,"img",2),j(),Ee(4,"br"),V(5,"div",3)(6,"p"),Y(7,"congratulations"),j(),V(8,"p"),Y(9,"You have completed induction videos"),j(),V(10,"p"),Y(11,"you are now. Partner of Coolieno1! You are successfully on boarded."),j()()(),V(12,"div",4),Ee(13,"img",5),j()())},styles:['.main[_ngcontent-%COMP%]{width:100%;height:100vh}.container[_ngcontent-%COMP%]{width:100%;display:grid;row-gap:1rem;align-items:center;justify-content:center;text-align:center;position:relative;top:15%}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;height:max-content}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){width:100%;display:flex;align-items:center;justify-content:center}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:130px;height:130px}.arrow-container[_ngcontent-%COMP%]{position:fixed;bottom:10%;left:40%;display:flex;align-items:center;justify-content:center}.text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(1){font-family:"Archivo" sans-serif Black;font-size:1.2rem;font-weight:600;line-height:17.41px;letter-spacing:.04em}.text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(2){font-family:"inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;letter-spacing:.04em}']});let a=n;return a})();var d9=a=>({"first-package":a,package:!0});function h9(a,n){a&1&&(V(0,"button"),Y(1,"1 month"),j())}function u9(a,n){a&1&&(V(0,"span"),Y(1,"Amount Payable"),j())}function p9(a,n){if(a&1&&(V(0,"div",6),Ee(1,"br"),V(2,"div")(3,"p",7)(4,"span"),Y(5,"UPGRADE TO"),j(),V(6,"button"),Y(7,"1 Month"),j()(),V(8,"p",8),Ee(9,"img",9),Y(10," \xA0"),V(11,"span"),Y(12),j()(),V(13,"p",7)(14,"span")(15,"span",10),Y(16,"Current"),j(),V(17,"span",11),Y(18,"lock_open"),j()(),V(19,"span"),Y(20,"Expire : 19th Jul 24"),j()(),V(21,"ul")(22,"li"),Y(23),j(),V(24,"li"),Y(25),j()(),V(26,"p",7),Zt(27,h9,2,0,"button",12)(28,u9,2,0,"span",12),V(29,"span"),Y(30,"\u20B9 1499"),j()()()()),a&2){let d=n.$implicit,r=Et();rt("ngClass",Mo(7,d9,d.packageName==="silver")),xe(9),rt("src",d.image,Er),xe(3),zt(d.packageName),xe(11),zt(d.noOfJobOffers),xe(2),zt(d.bonus),xe(2),rt("ngIf",r.isEnrolled),xe(),rt("ngIf",!r.isEnrolled)}}var wL=(()=>{let n=class n{navToBack(){this.location.back()}constructor(r,s){this.userDetails=r,this.location=s,this.isEnrolled=!0,this.packages=[],this.getPackage()}getPackage(){this.userDetails.getPackages().subscribe(r=>{console.log(r),this.packages=r},r=>{console.log(r)})}};n.\u0275fac=function(s){return new(s||n)(ge(po),ge(Pi))},n.\u0275cmp=gt({type:n,selectors:[["app-packages"]],decls:8,vars:1,consts:[[1,"container"],[1,"sub-container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"upgrade"],[1,"package-name"],[3,"src"],[1,"Current"],[1,"material-symbols-outlined",2,"font-size","1rem"],[4,"ngIf"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),Fe("click",function(){return t.navToBack()}),Y(4,"arrow_back"),j(),V(5,"span",4),Y(6,"Packages"),j()(),Zt(7,p9,31,9,"div",5),j()()),s&2&&(xe(7),rt("ngForOf",t.packages))},dependencies:[Qa,Vr,jr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:670px;position:relative;top:2%;left:5%;display:flex;flex-direction:column;gap:2rem}.arrow[_ngcontent-%COMP%]{width:100%;display:flex;text-align:center}.tittle[_ngcontent-%COMP%]{width:80%;font-family:"Inter" sans-serif;font-size:22px;font-weight:500;line-height:26.63px;text-align:center}.package[_ngcontent-%COMP%]{border-radius:.6rem;background-color:#414141}.first-package[_ngcontent-%COMP%]{background:#605c5c}.package[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;width:90%;left:5%;top:5%;display:flex;flex-direction:column;gap:.5rem}.upgrade[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.upgrade[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px;text-align:left;color:#fff}.package-name[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center}.package-name[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem}.package-name[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], li[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px;text-align:left;color:#fff}.upgrade[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff}.Current[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:18px;font-weight:500;line-height:21.78px;text-align:left;color:#fff}.material-symbols-outlined[_ngcontent-%COMP%]{font-variation-settings:"FILL" 0,"wght" 400,"GRAD" 0,"opsz" 20}button[_ngcontent-%COMP%]{background-color:transparent;border:1px solid rgba(212,175,55,1);color:#d4af37;border-radius:.2rem}ul[_ngcontent-%COMP%]{float:left}']});let a=n;return a})();var m9=["videoPlayer"],f9=["activeVideo"];function g9(a,n){if(a&1){let d=gi();V(0,"div",6),Fe("click",function(){let s=Mt(d).index,t=Et();return Tt(t.getVideoUrl(s))}),V(1,"div",7),Fe("click",function(){let s=Mt(d).index,t=Et();return Tt(t.getVideoUrl(s))}),Ee(2,"img",8),j(),Ee(3,"br"),j()}}function _9(a,n){if(a&1){let d=gi();V(0,"div",9),Fe("click",function(){Mt(d);let s=Et();return Tt(s.stopVideo())}),V(1,"video",10,0),Fe("ended",function(){Mt(d);let s=Et();return Tt(s.onVideoEnded())})("timeupdate",function(){Mt(d);let s=Ts(2),t=Et();return Tt(t.preventSeek(s))})("loadedmetadata",function(){Mt(d);let s=Ts(2),t=Et();return Tt(t.onVideoLoaded(s))}),j()()}if(a&2){let d=Et();xe(),rt("src",d.getVideoUrl(d.currentVideoIndex),Er)}}var CL=(()=>{let n=class n{navBack(){}constructor(r,s){this.http=r,this.tranningService=s,this.videos=[],this.pupUp=!1,this.bucketName="coolie1-dev",this.region="ap-south-1",this.currentVideoIndex=0,this.lastTime=0,this.isVideoPlaying=!1}ngOnInit(){this.gettingVideos()}gettingVideos(){this.tranningService.getingVideos().subscribe(r=>{console.log(r),this.videos=r},r=>{console.log(r)})}playVideo(r){this.pupUp=!0,console.log(this.pupUp),this.currentVideoIndex=r,this.isVideoPlaying=!0,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())}stopVideo(){this.isVideoPlaying=!1,this.activeVideo&&this.activeVideo.nativeElement&&this.activeVideo.nativeElement.pause()}skipVideo(){this.playNextVideo()}onVideoEnded(){console.log("ended"),this.pupUp=!1}onVideoLoaded(r){r.play()}preventSeek(r){r.currentTime>this.lastTime+1?r.currentTime=this.lastTime:this.lastTime=r.currentTime}playNextVideo(){this.currentVideoIndex<this.videos.length-1?(this.currentVideoIndex++,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())):this.isVideoPlaying=!1}getVideoUrl(r){return this.pupUp=!0,console.log(this.pupUp),`https://${this.bucketName}.s3.${this.region}.amazonaws.com/${this.videos[r].videoKey}`}};n.\u0275fac=function(s){return new(s||n)(ge(nn),ge(Wm))},n.\u0275cmp=gt({type:n,selectors:[["app-training"]],viewQuery:function(s,t){if(s&1&&(ki(m9,5),ki(f9,5)),s&2){let g;Ci(g=Si())&&(t.videoPlayer=g.first),Ci(g=Si())&&(t.activeVideo=g.first)}},decls:11,vars:4,consts:[["activeVideo",""],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"container"],[1,"sub-container"],["class","videoss",3,"click",4,"ngFor","ngForOf"],["class","overlay",3,"click",4,"ngIf"],[1,"videoss",3,"click"],[1,"dummy-video",3,"click"],["src","assets/demo/video.png"],[1,"overlay",3,"click"],["controls","","autoplay","","type","video/mp4",1,"active-video",3,"ended","timeupdate","loadedmetadata","src"]],template:function(s,t){s&1&&(Ee(0,"br")(1,"br"),Y(2,"\xA0\xA0 \xA0"),V(3,"span",1),Fe("click",function(){return t.navBack()}),Y(4,"arrow_back"),j(),Ee(5,"br")(6,"br"),V(7,"div",2)(8,"div",3),Zt(9,g9,4,0,"div",4),j()(),Zt(10,_9,3,1,"div",5)),s&2&&(xe(7),Ni("blur",t.isVideoPlaying),xe(2),rt("ngForOf",t.videos),xe(),rt("ngIf",t.pupUp))},dependencies:[Vr,jr],styles:["#video[_ngcontent-%COMP%]{width:100%}video[_ngcontent-%COMP%]{width:90%;height:360px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin-top:10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:space-around;align-items:center;text-align:center}.blur[_ngcontent-%COMP%]{filter:blur(5px)}video[_ngcontent-%COMP%]{width:300px;height:200px;margin:10px;cursor:pointer}.videoss[_ngcontent-%COMP%]{width:90%;display:grid;row-gap:2rem}.dummy-video[_ngcontent-%COMP%]{width:100%}.dummy-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:fixed;top:0%;width:100%;height:100%;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}.overlay[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.active-video[_ngcontent-%COMP%]{width:640px;height:360px}button[_ngcontent-%COMP%]{margin-top:10px;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{cursor:pointer}"]});let a=n;return a})();var sf=mm("PushNotifications",{});var y9="firebase",b9="10.12.4";uk(y9,b9,"app");var D0=new um("ANGULARFIRE2_VERSION");var Vx=class{zone;delegate;constructor(n,d=kD){this.zone=n,this.delegate=d}now(){return this.delegate.now()}schedule(n,d,r){let s=this.zone,t=function(g){s.runGuarded(()=>{n.apply(this,[g])})};return this.delegate.schedule(t,d,r)}};var SL=(()=>{class a{ngZone;outsideAngular;insideAngular;constructor(d){this.ngZone=d,this.outsideAngular=d.runOutsideAngular(()=>new Vx(Zone.current)),this.insideAngular=d.run(()=>new Vx(Zone.current,DD)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||a)(Ye(di))};static \u0275prov=At({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var x9="firebase",w9="10.12.4";Is.registerVersion(x9,w9,"app-compat");var C9=["ngOnDestroy"],TL=(a,n,d,r={})=>new Proxy(a,{get:(s,t)=>d.runOutsideAngular(()=>{if(a[t])return r?.spy?.get&&r.spy.get(t,a[t]),a[t];if(C9.indexOf(t)>-1)return()=>{};let g=n.toPromise().then(b=>{let M=b?.[t];return typeof M=="function"?M.bind(b):M?.then?M.then(k=>d.run(()=>k)):d.run(()=>M)});return new Proxy(()=>{},{get:(b,M)=>g[M],apply:(b,M,k)=>g.then(L=>{let G=L?.(...k);return r?.spy?.apply&&r.spy.apply(t,k,G),G})})})});var jx=class{constructor(n){return n}},Ux=new Qt("angularfire2.app.options"),Hx=new Qt("angularfire2.app.name");function $M(a,n,d){let r=typeof d=="string"&&d||"[DEFAULT]",s=typeof d=="object"&&d||{};s.name=s.name||r;let g=Is.apps.filter(b=>b&&b.name===s.name)[0]||n.runOutsideAngular(()=>Is.initializeApp(a,s));try{if(JSON.stringify(a)!==JSON.stringify(g.options)){let b=!!module.hot;S9("error",`${g.name} Firebase App already initialized with different options${b?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new jx(g)}var S9=(a,...n)=>{wC()&&typeof console<"u"&&console[a](...n)},M9={provide:jx,useFactory:$M,deps:[Ux,di,[new mu,Hx]]},IL=(()=>{class a{static initializeApp(d,r){return{ngModule:a,providers:[{provide:Ux,useValue:d},{provide:Hx,useValue:r}]}}constructor(d){Is.registerVersion("angularfire",D0.full,"core"),Is.registerVersion("angularfire",D0.full,"app-compat"),Is.registerVersion("angular",GD.full,d.toString())}static \u0275fac=function(r){return new(r||a)(Ye($o))};static \u0275mod=ni({type:a});static \u0275inj=ii({providers:[M9]})}return a})();function EL(a,n,d,r,s){let[,t,g]=globalThis.\u0275AngularfireInstanceCache.find(b=>b[0]===a)||[];if(t)return T9(s,g)||(ML("error",`${n} was already initialized on the ${d} Firebase App with different settings.${I9?" You may need to reload as Firebase is not HMR aware.":""}`),ML("warn",{is:s,was:g})),t;{let b=r();return globalThis.\u0275AngularfireInstanceCache.push([a,b,s]),b}}function T9(a,n){try{return a.toString()===n.toString()}catch{return a===n}}var I9=typeof module<"u"&&!!module.hot,ML=(a,...n)=>{wC()&&typeof console<"u"&&console[a](...n)};globalThis.\u0275AngularfireInstanceCache||=[];var E9=new Qt("angularfire2.messaging.vapid-key"),D9=new Qt("angularfire2.messaging.service-worker-registeration"),qM=(()=>{class a{requestPermission;getToken;tokenChanges;messages;requestToken;deleteToken;constructor(d,r,s,t,g,b,M){let k=M,L=Jt(void 0).pipe(Xl(g.outsideAngular),Zl(g.insideAngular),ur(pk),ur(oe=>oe?import("./chunk-WCJOXY6X.js"):tl),pn(()=>$M(d,t,r)),ur(oe=>EL(`${oe.name}.messaging`,"AngularFireMessaging",oe.name,()=>Jt(oe.messaging()),[])),uC({bufferSize:1,refCount:!1}));this.requestPermission=L.pipe(Xl(g.outsideAngular),Zl(g.insideAngular),ur(()=>Notification.requestPermission())),this.getToken=L.pipe(Xl(g.outsideAngular),Zl(g.insideAngular),ur(oe=>Qr(this,null,function*(){if(Notification.permission==="granted"){let be=k?yield k:null;return yield oe.getToken({vapidKey:b,serviceWorkerRegistration:be})}else return null})));let G=new Ro(oe=>{navigator.permissions.query({name:"notifications"}).then(be=>{be.onchange=()=>oe.next()})}),J=L.pipe(Xl(g.outsideAngular),Zl(g.insideAngular),pC(G),pC(this.getToken));return this.tokenChanges=L.pipe(Xl(g.outsideAngular),Zl(g.insideAngular),ur(()=>am(this.getToken,J))),this.messages=L.pipe(Xl(g.outsideAngular),Zl(g.insideAngular),ur(oe=>new Ro(be=>oe.onMessage(be)))),this.requestToken=L.pipe(Xl(g.outsideAngular),Zl(g.insideAngular),ur(()=>this.requestPermission),Md(()=>Jt(null)),Go(()=>this.tokenChanges)),this.deleteToken=()=>L.pipe(Xl(g.outsideAngular),Zl(g.insideAngular),ur(oe=>oe.deleteToken()),n_(!1)),TL(this,L,t)}static \u0275fac=function(r){return new(r||a)(Ye(Ux),Ye(Hx,8),Ye($o),Ye(di),Ye(SL),Ye(E9,8),Ye(D9,8))};static \u0275prov=At({token:a,factory:a.\u0275fac,providedIn:"any"})}return a})(),DL=(()=>{class a{constructor(){Is.registerVersion("angularfire",D0.full,"fcm-compat")}static \u0275fac=function(r){return new(r||a)};static \u0275mod=ni({type:a});static \u0275inj=ii({providers:[qM]})}return a})();var Wx=(()=>{let n=class n{constructor(r,s,t){this.afMessaging=r,this.http=s,this.router=t,this.listenForMessages()}requestPermission(){hk.isNativePlatform()?sf.requestPermissions().then(r=>{r.receive==="granted"&&(sf.register(),sf.addListener("registration",s=>{console.log("Push registration success, token: "+s.value),this.token=s.value,this.sendTokenToBackend(s.value)}),sf.addListener("pushNotificationReceived",s=>{console.log("Push received: ",s)}),sf.addListener("pushNotificationActionPerformed",s=>{console.log("Push action performed: ",s)}))}):this.afMessaging.requestToken.subscribe({next:r=>{console.log("FCM token:",r),this.token=r,this.sendTokenToBackend(r)},error:r=>{console.error("Error getting token",r)}})}listenForMessages(){console.log("listing..................."),this.afMessaging.messages.subscribe(r=>{console.log(r),alert(r),this.router.navigate(["getOrder"]),console.log(r.notification),console.log(r.data?.order),console.log(r.notification?.title)},r=>{console.log(r)})}sendTokenToBackend(r){alert(r);let s="https://api.coolieno1.in/v1.0/providers/provider-token",t={providerId:localStorage.getItem("providerId"),token:r};alert(t.providerId),alert(t.token),this.http.post(s,t).subscribe({next:g=>{console.log(g),alert("token send sucessfully")},error:g=>{console.log(g),alert("error"),alert(g.error.message)}})}};n.\u0275fac=function(s){return new(s||n)(Ye(qM),Ye(nn),Ye(jt))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let a=n;return a})();var AL=(()=>{let n=class n{constructor(r,s,t,g,b){this.router=r,this.jobDetailsService=s,this.orderService=t,this.mapboxService=g,this.getOrderService=b,this.timeLeft=120,this.extractedDetails=[],this.current=0,this.max=120,this.radius=100,this.color="rgba(255, 0, 0, 1)",this.background="rgba(253, 5, 0, 0.4)",this.cancelRate=0,this.workingHours=0,this.credits=0,this.serviceName=[{name:"cleaning"},{name:"tank cleaning"},{name:"tankcleaning"}],this.userCoordinates=[0,0],this.orderIds=[],this.workSeleceted=this.jobDetailsService.workDetails}ngOnInit(){this.startTimer(),this.providerCurrentLocation=this.mapboxService.placeName,this.order=this.getOrderService.order,this.details()}startTimer(){this.interval=setInterval(()=>{this.timeLeft>0?(this.timeLeft--,this.current=this.timeLeft):clearInterval(this.interval)},1e3)}ngOnDestroy(){clearInterval(this.interval)}get minutes(){return Math.floor(this.timeLeft/60)}get seconds(){return this.timeLeft%60}details(){this.order=JSON.parse(this.order.order),this.orderService.oredrDetails=this.order,this.parsedOrder=this.order,this.getCartId(this.order),this.extractedDetails.push({fullAddress:`${this.parsedOrder.addressId.city}, ${this.parsedOrder.addressId.state}, ${this.parsedOrder.addressId.pincode}`,latitude:this.parsedOrder.addressId.latitude,longitude:this.parsedOrder.addressId.longitude,categoryName:this.parsedOrder.items[0].categoryId.name,subCategoryName:this.parsedOrder.items[0].subCategoryId.name,quantity:this.parsedOrder.items[0].quantity,scheduledDate:this.parsedOrder.items[0].scheduledDate,price:this.parsedOrder.items[0].serviceId.serviceVariants[0].price}),console.log(this.extractedDetails),this.userCoordinates=[this.extractedDetails[0].longitude,this.extractedDetails[0].latitude],this.orderService.userFullAddress=this.extractedDetails[0].fullAddress,this.mapboxService.userCordinates=this.userCoordinates}getCartId(r){let s=this.order._id,t=g=>{let b=setInterval(()=>{if(this.acceptStatus)if(clearInterval(b),this.acceptStatus){this.acceptStatus=!1,this.acceptedOrder(s),console.log("User accepted, exiting the loop");return}else console.log("User declined, moving to the next item"),this.acceptStatus=!1,t(g+1)},1e3);setTimeout(()=>{this.acceptStatus===null&&(clearInterval(b),console.log("Automatically moving to the next item"),t(g+1))},12e4)};t(0)}accepted(){this.acceptStatus=!0}declined(){this.acceptStatus=!1,console.log("declined"),this.acceptStatus=!1,this.timeLeft=120,this.router.navigate(["home"])}acceptedOrder(r){console.log(r),this.orderService.accept(r).subscribe(s=>{console.log(s),this.orderService.orderIds=s.orderHistoryId,this.router.navigate(["arrived"])},s=>{console.log(s)})}};n.\u0275fac=function(s){return new(s||n)(ge(jt),ge(Hr),ge(mo),ge(qd),ge(Wx))},n.\u0275cmp=gt({type:n,selectors:[["app-get-order"]],decls:57,vars:16,consts:[[1,"container"],[1,"timer"],[3,"current","max","color","background","radius","rounded","stroke"],[1,"timer-container"],[1,"time"],[1,"location-container"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"line"],[1,"address"],[1,"location-txt"],[1,"location"],[1,"service-details"],[1,"main-Text"],[1,"value-Text"],[1,"acc-rej-btns"],[3,"click"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1),Ee(2,"round-progress",2),V(3,"div",3)(4,"p",4)(5,"span"),Y(6),j(),V(7,"span"),Y(8,"Time left"),j()()()(),V(9,"div",5)(10,"div")(11,"span",6),Y(12," location_on "),j(),Ee(13,"div",7),V(14,"span",6),Y(15," location_on "),j()(),V(16,"div",8)(17,"p")(18,"span",9),Y(19,"My location"),j(),V(20,"span",10),Y(21),j()(),Ee(22,"br"),V(23,"p"),Y(24,"10 Km"),j(),Ee(25,"br"),V(26,"p")(27,"span",9),Y(28,"User location"),j(),V(29,"span",10),Y(30),j()()()(),V(31,"div",11)(32,"span")(33,"span",12),Y(34,"Category Type :"),j(),V(35,"span",13),Y(36),j()(),V(37,"span")(38,"span",12),Y(39,"Service Type :"),j(),V(40,"span",13),Y(41),j()(),V(42,"span")(43,"span",12),Y(44,"Price :"),j(),V(45,"span",13),Y(46),j()(),V(47,"span")(48,"span",12),Y(49,"Schedule :"),j(),V(50,"span",13),Y(51),j()()(),V(52,"div",14)(53,"button",15),Fe("click",function(){return t.declined()}),Y(54,"Reject"),j(),V(55,"button",15),Fe("click",function(){return t.accepted()}),Y(56,"Accept"),j()()()),s&2&&(xe(2),rt("current",t.current)("max",t.max)("color",t.color)("background",t.background)("radius",t.radius)("rounded",!0)("stroke",10),xe(4),rl("",t.minutes,":",t.seconds<10?"0"+t.seconds:t.seconds,""),xe(15),zt(t.providerCurrentLocation),xe(9),zt(t.extractedDetails[0]==null?null:t.extractedDetails[0].fullAddress),xe(6),zt(t.extractedDetails[0]==null?null:t.extractedDetails[0].categoryName),xe(5),zt(t.extractedDetails[0]==null?null:t.extractedDetails[0].subCategoryName),xe(5),rl("",t.extractedDetails[0]==null?null:t.extractedDetails[0].price," X ",t.extractedDetails[0]==null?null:t.extractedDetails[0].quantity,""),xe(5),zt(t.extractedDetails[0]==null?null:t.extractedDetails[0].scheduledDate))},dependencies:[ex],styles:[".container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;top:5%;left:2.5%;display:flex;flex-direction:column;gap:2rem}.timer[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.timer-container[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center}.time[_ngcontent-%COMP%]{font-size:2em;text-align:center;display:flex;flex-direction:column;gap:.5rem}.time[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1rem}.location-container[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:10% 80%}.location-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){display:flex;flex-direction:column;align-items:center;justify-content:center}.line[_ngcontent-%COMP%]{width:1px;height:6rem;border-left:.25px dashed black}.address[_ngcontent-%COMP%], .address[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-align:left}.location-txt[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:500}.location[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:.9rem;font-weight:400;color:#b8b8b8}.service-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.main-Text[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:500;color:#5a5a5a80}.value-Text[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:400;color:#515151}.acc-rej-btns[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-around}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:150px;height:50px;border:none;border-radius:.4rem;font-family:Inter,sans-serif;font-size:1rem;font-weight:500;letter-spacing:1px;color:#fff;text-align:center}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#d70d09}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:#409000}"]});let a=n;return a})();var PL=(()=>{let n=class n{navTOBack(){this.location.back()}constructor(r,s,t,g){this.router=r,this.mapboxService=s,this.orderService=t,this.location=g,this.toggleChecked=!1}ngOnInit(){this.intalizeMap()}intalizeMap(){return Qr(this,null,function*(){let r=this.mapboxService.userCordinates;console.log(r),this.mapboxService.initializeMap(),console.log(this.mapboxService.mapStatus),this.userFullAddress=this.orderService.userFullAddress,yield this.mapboxService.addDestinationMarker(r)})}toggleDisplay(r){this.toggleChecked=!this.toggleChecked,console.log(this.toggleChecked),this.router.navigate(["startWork"])}cancel(){this.orderService.cancelOrder().subscribe(r=>{console.log(r),this.router.navigate(["home"])},r=>{console.log(r)})}};n.\u0275fac=function(s){return new(s||n)(ge(jt),ge(qd),ge(mo),ge(Pi))},n.\u0275cmp=gt({type:n,selectors:[["app-arvied"]],decls:18,vars:1,consts:[[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"arival-status"],[3,"click"],["id","map"],[1,"location"],[1,"material-symbols-outlined"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"change"],["for","toggle",1,"already-label",2,"content","'Iam Existing provider '"]],template:function(s,t){s&1&&(V(0,"section",0)(1,"span",1),Fe("click",function(){return t.navTOBack()}),Y(2," arrow_back "),j(),V(3,"div",2)(4,"span"),Y(5,"On the way "),j(),V(6,"button",3),Fe("click",function(){return t.cancel()}),Y(7,"Cancel"),j()(),Ee(8,"div",4)(9,"br"),V(10,"div",5)(11,"span",6),Y(12," near_me "),j(),V(13,"span"),Y(14),j()(),V(15,"div",7)(16,"input",8),Fe("change",function(b){return t.toggleDisplay(b)}),j(),Ee(17,"label",9),j()()),s&2&&(xe(14),bn(" ",t.userFullAddress," "))},styles:['.container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;left:2.5%;top:2.5%;display:flex;flex-direction:column;gap:2rem}.arival-status[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-between;border-radius:.5rem;align-items:center;background-color:#d70d09}.arival-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Poppins" sans-serif;margin-left:1.5rem;font-size:1.1rem;font-weight:500;line-height:24px;text-align:left;color:#fff}.arival-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:6rem;height:2.5rem;color:#fff;background-color:transparent;border:.25px solid #ffff;font-family:"Poppins" sans-serif;font-size:1.1rem;font-weight:500;border-radius:.4rem;margin-right:1rem}#map[_ngcontent-%COMP%]{width:100%;height:20rem}.location[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:20% 80%}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){display:flex;justify-content:center;align-items:center}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Poppins" sans-serif;font-size:14px;font-weight:400;line-height:25px;letter-spacing:.05em;text-align:left}.slide-toggle[_ngcontent-%COMP%]{position:fixed;width:95%;height:46px;left:2%;bottom:10%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Arrived";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#409000;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:2px;left:2px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;content:"Arrived";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;pointer-events:none}']});let a=n;return a})();var OL=(()=>{let n=class n{navTOBack(){this.location.back()}constructor(r,s,t,g){this.router=r,this.orderService=s,this.mapboxService=t,this.location=g,this.toggleChecked=!1,this.intalizeMap()}intalizeMap(){return Qr(this,null,function*(){let r=this.mapboxService.userCordinates;console.log(r),this.mapboxService.initializeMap(),console.log(this.mapboxService.mapStatus),this.userFullAddress=this.orderService.userFullAddress,yield this.mapboxService.addDestinationMarker(r)})}getOtp(){this.orderService.verifyOtp().subscribe(r=>{console.log(r)},r=>{console.log(r)})}toggleDisplay(r){this.toggleChecked=!this.toggleChecked,console.log(this.toggleChecked),this.router.navigate(["work/otp"])}};n.\u0275fac=function(s){return new(s||n)(ge(jt),ge(mo),ge(qd),ge(Pi))},n.\u0275cmp=gt({type:n,selectors:[["app-start-work"]],decls:18,vars:1,consts:[[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"arival-status"],[1,"material-symbols-outlined",2,"font-size","24px","margin-right","1.5rem"],["id","map"],[1,"location"],[1,"material-symbols-outlined"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"change"],["for","toggle",1,"already-label",2,"content","'Iam Existing provider '"]],template:function(s,t){s&1&&(V(0,"section",0)(1,"span",1),Fe("click",function(){return t.navTOBack()}),Y(2," arrow_back "),j(),V(3,"div",2)(4,"span"),Y(5,"Reached customer location "),j(),V(6,"span",3),Y(7," call "),j()(),Ee(8,"div",4)(9,"br"),V(10,"div",5)(11,"span",6),Y(12," near_me "),j(),V(13,"span"),Y(14),j()(),V(15,"div",7)(16,"input",8),Fe("change",function(b){return t.toggleDisplay(b)}),j(),Ee(17,"label",9),j()()),s&2&&(xe(14),bn(" ",t.userFullAddress," "))},styles:['.container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;left:2.5%;display:flex;flex-direction:column;gap:2rem;margin-top:2.5%}.arival-status[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-between;border-radius:.5rem;align-items:center;background-color:#d70d09}.arival-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Poppins" sans-serif;margin-left:1.5rem;font-size:1.1rem;font-weight:500;line-height:24px;text-align:left;color:#fff}#map[_ngcontent-%COMP%]{width:100%;height:20rem}.map[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.location[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:20% 80%}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){display:flex;justify-content:center;align-items:center}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Poppins" sans-serif;font-size:14px;font-weight:400;line-height:25px;letter-spacing:.05em;text-align:left}.slide-toggle[_ngcontent-%COMP%]{position:fixed;width:95%;height:60px;left:2%;bottom:10%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Arrived";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#409000;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:10px;left:15px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;content:"Start working";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;pointer-events:none}']});let a=n;return a})();var A9=["input1"],P9=["input2"],O9=["input3"],R9=["input4"],RL=(()=>{let n=class n{navTOBack(){this.location.back()}constructor(r,s,t,g){this.form=r,this.orderService=s,this.router=t,this.location=g,this.getOtp(),this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}onInput(r,s){if(r.target.value.length===1)switch(s){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}getOtp(){}verifyOtp(){let r=this.otp.value,s=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log(s),this.orderService.verifyStartOrder(s).subscribe(t=>{console.log(t),this.router.navigate(["completeWork"])},t=>{console.log(t)}),this.router.navigate(["completeWork"])}};n.\u0275fac=function(s){return new(s||n)(ge(la),ge(mo),ge(jt),ge(Pi))},n.\u0275cmp=gt({type:n,selectors:[["app-work-otp"]],viewQuery:function(s,t){if(s&1&&(ki(A9,5),ki(P9,5),ki(O9,5),ki(R9,5)),s&2){let g;Ci(g=Si())&&(t.input1=g.first),Ci(g=Si())&&(t.input2=g.first),Ci(g=Si())&&(t.input3=g.first),Ci(g=Si())&&(t.input4=g.first)}},decls:24,vars:1,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"sub-container"],[1,"image-div"],["src","assets/demo/Stylist doing haircut.png"],[1,"info-text"],[1,"numberss"],[3,"formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input"],["type","text","maxlength","1","formControlName","inputTwo",3,"input"],["type","text","maxlength","1","formControlName","inputThree",3,"input"],["type","text","maxlength","1","formControlName","inputFour",3,"input"],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){if(s&1){let g=gi();V(0,"div",4)(1,"span",5),Fe("click",function(){return Mt(g),Tt(t.navTOBack())}),Y(2," arrow_back "),j(),V(3,"div",6)(4,"div",7),Ee(5,"img",8),j(),V(6,"span")(7,"span",9),Y(8,"Before start the work"),j(),Ee(9,"br"),V(10,"span",10),Y(11,"Enter OTP from user"),j()(),V(12,"form",11)(13,"div",12)(14,"input",13,0),Fe("input",function(M){return Mt(g),Tt(t.onInput(M,1))}),j(),V(16,"input",14,1),Fe("input",function(M){return Mt(g),Tt(t.onInput(M,2))}),j(),V(18,"input",15,2),Fe("input",function(M){return Mt(g),Tt(t.onInput(M,3))}),j(),V(20,"input",16,3),Fe("input",function(M){return Mt(g),Tt(t.onInput(M,4))}),j()(),V(22,"button",17),Fe("click",function(){return Mt(g),Tt(t.verifyOtp())}),Y(23,"Confirm"),j()()()()}s&2&&(xe(12),rt("formGroup",t.otp))},dependencies:[No,ho,Mr,Bo,vu,qo,Aa],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;margin-top:2.5%}.material-symbols-outlined[_ngcontent-%COMP%]{width:max-content;margin-left:2.5%}.sub-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;text-align:center}.image-div[_ngcontent-%COMP%]{width:100%;height:25rem}.image-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px;color:#414141}.info-text[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0;color:#414141}.numberss[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:600;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;margin-left:5%}"]});let a=n;return a})();function F9(a,n){if(a&1&&(V(0,"div",5)(1,"span",12)(2,"span",7),Y(3),j(),V(4,"span",7),Y(5),j()(),V(6,"span",13),Y(7),j(),Ee(8,"div",8),j()),a&2){let d=n.$implicit;xe(3),rl("",d.quantity," X ",d.categoryId.name,""),xe(2),zt(d.serviceId.serviceVariants[0].price),xe(2),rl("",d.quantity," X ",d.subCategoryId.name,"")}}var FL=(()=>{let n=class n{navTOBack(){this.location.back()}constructor(r,s,t){this.orderService=r,this.router=s,this.location=t,this.total=0,this.work=[],this.alreadyHasAccount="",this.getWorkDetails()}getWorkDetails(){let r=this.orderService.oredrDetails;console.log(r);for(let s=0;s<r.items.length;s++){let t=r.items[s];this.work.push(t)}console.log(r.items),this.work.forEach(s=>{this.total=this.total+s.serviceId.serviceVariants[0].price})}toggleDisplay(){this.orderService.completeOrder().subscribe(r=>{console.log(r),this.router.navigate(["verifyAfterWork"])},r=>{console.log(r)})}};n.\u0275fac=function(s){return new(s||n)(ge(mo),ge(jt),ge(Pi))},n.\u0275cmp=gt({type:n,selectors:[["app-work-complete"]],decls:31,vars:2,consts:[[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"image"],["src","assets\\new\\Man washing hand.png"],[1,"details"],[1,"details-div"],[1,"time-div"],[1,"highlight-text"],[1,"line"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"ngModelChange","change","ngModel"],["for","toggle",1,"already-label",2,"content","'Iam Existing provider '"],[1,"about"],[1,"sub-tittle"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"span",1),Fe("click",function(){return t.navTOBack()}),Y(2," arrow_back "),j(),V(3,"div",2),Ee(4,"img",3),j(),V(5,"section",4),Cr(6,F9,9,5,"div",5,xo),V(8,"div",6)(9,"p")(10,"span"),Y(11,"Others"),j(),Ee(12,"br"),V(13,"span",7),Y(14,"Convenience Fee"),j()(),V(15,"p",7),Y(16,"69"),j()(),Ee(17,"div",8)(18,"br"),V(19,"div",6)(20,"p")(21,"span",7),Y(22,"Total value"),j(),Ee(23,"br"),V(24,"span"),Y(25,"commission credits"),j()(),V(26,"p",7),Y(27),j()()(),V(28,"div",9)(29,"input",10),So("ngModelChange",function(b){return Co(t.alreadyHasAccount,b)||(t.alreadyHasAccount=b),b}),Fe("change",function(){return t.toggleDisplay()}),j(),Ee(30,"label",11),j()()),s&2&&(xe(6),Sr(t.work),xe(21),zt(t.total),xe(2),wo("ngModel",t.alreadyHasAccount))},dependencies:[tc,Mr,Es],styles:['.container[_ngcontent-%COMP%]{width:95vw;height:100%;display:flex;flex-direction:column;gap:1rem;position:relative;left:2.5%;right:2.5%;top:2.5%}.image[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.details[_ngcontent-%COMP%], .details-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem}.about[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.slide-toggle[_ngcontent-%COMP%]{position:relative;width:95%;height:46px;left:2%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Placeholder Text";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#bb0e0e;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:2px;left:2px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;color:#fff;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#000;font-size:14px;pointer-events:none}.slide-toggle[_ngcontent-%COMP%]   label.already-label[_ngcontent-%COMP%]:before{content:"Swipe to Complete";color:#fff;font-family:Poppins;font-size:1.1rem;font-weight:500;line-height:22.82px;text-align:left}.time-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.Details[_ngcontent-%COMP%]{width:90%;border:.25px solid black;border-radius:.5rem}.line[_ngcontent-%COMP%]{width:100%;height:0;border:0;border-bottom:1px dashed rgb(45,44,44)}.sub-tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:.9rem;font-weight:400;line-height:14.52px;text-align:left}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:600;line-height:16.94px;text-align:left}']});let a=n;return a})();var L9=["input1"],z9=["input2"],B9=["input3"],N9=["input4"],LL=(()=>{let n=class n{navTOBack(){this.location.back()}constructor(r,s,t,g){this.form=r,this.orderService=s,this.router=t,this.location=g,this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}onInput(r,s){if(r.target.value.length===1)switch(s){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}login(){let r=this.otp.value,s=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log(s),this.orderService.verifyAfterComplete(s).subscribe(t=>{console.log(t),this.router.navigate(["home"])},t=>{console.log(t)})}};n.\u0275fac=function(s){return new(s||n)(ge(la),ge(mo),ge(jt),ge(Pi))},n.\u0275cmp=gt({type:n,selectors:[["app-verify-after-work"]],viewQuery:function(s,t){if(s&1&&(ki(L9,5),ki(z9,5),ki(B9,5),ki(N9,5)),s&2){let g;Ci(g=Si())&&(t.input1=g.first),Ci(g=Si())&&(t.input2=g.first),Ci(g=Si())&&(t.input3=g.first),Ci(g=Si())&&(t.input4=g.first)}},decls:24,vars:1,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"sub-container"],[1,"image-div"],["src","assets/demo/Stylist doing haircut.png"],[1,"info-text"],[1,"numberss"],[3,"formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input"],["type","text","maxlength","1","formControlName","inputTwo",3,"input"],["type","text","maxlength","1","formControlName","inputThree",3,"input"],["type","text","maxlength","1","formControlName","inputFour",3,"input"],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){if(s&1){let g=gi();V(0,"div",4)(1,"span",5),Fe("click",function(){return Mt(g),Tt(t.navTOBack())}),Y(2," arrow_back "),j(),V(3,"div",6)(4,"div",7),Ee(5,"img",8),j(),V(6,"span")(7,"span",9),Y(8,"Before start the work"),j(),Ee(9,"br"),V(10,"span",10),Y(11,"Enter OTP from user"),j()(),V(12,"form",11)(13,"div",12)(14,"input",13,0),Fe("input",function(M){return Mt(g),Tt(t.onInput(M,1))}),j(),V(16,"input",14,1),Fe("input",function(M){return Mt(g),Tt(t.onInput(M,2))}),j(),V(18,"input",15,2),Fe("input",function(M){return Mt(g),Tt(t.onInput(M,3))}),j(),V(20,"input",16,3),Fe("input",function(M){return Mt(g),Tt(t.onInput(M,4))}),j()(),V(22,"button",17),Fe("click",function(){return Mt(g),Tt(t.login())}),Y(23,"Confirm"),j()()()()}s&2&&(xe(12),rt("formGroup",t.otp))},dependencies:[No,ho,Mr,Bo,vu,qo,Aa],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;margin-top:2.5%;align-items:center}.material-symbols-outlined[_ngcontent-%COMP%]{width:max-content;margin-left:2.5%}.sub-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;text-align:center}.image-div[_ngcontent-%COMP%]{width:100%;height:25rem}.image-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px;color:#414141}.info-text[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0;color:#414141}.numberss[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:600;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#cd2e28;margin-left:5%}"]});let a=n;return a})();function V9(a,n){if(a&1){let d=gi();V(0,"div",4)(1,"div",6),Y(2),j(),V(3,"div")(4,"input",7),So("ngModelChange",function(s){let t=Mt(d).$implicit;return Co(t.checked,s)||(t.checked=s),Tt(s)}),Fe("change",function(s){let t=Mt(d).$implicit,g=Et();return Tt(g.onChange(s,t))}),j()()()}if(a&2){let d=n.$implicit;xe(2),zt(d.name),xe(2),wo("ngModel",d.checked)}}var zL=(()=>{let n=class n{constructor(r,s,t){this.loginService=r,this.logInService=s,this.router=t,this.items=[],this.loginService.getSubCategory().subscribe(g=>{console.log(g),this.items=g},g=>{console.log(g)})}send(){this.logInService.selectedSubCategories.length>0?this.router.navigate(["aboutWork"]):alert("Please select atleat one sub-category ")}onChange(r,s){let t=r.target;if(console.log(s),t&&t.checked){let b=this.items.indexOf(s);console.log("categoryId",s._),this.logInService.setSubCat(s._id)}}};n.\u0275fac=function(s){return new(s||n)(ge(tr),ge(tr),ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-sub-services"]],decls:10,vars:0,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"serivce"],[1,"service-div"],["type","submit",1,"login-btn",3,"click"],[1,"names"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Y(3,"Select Sub-Services"),j(),Ee(4,"br"),V(5,"div",3),Cr(6,V9,5,2,"div",4,xo),j()(),V(8,"button",5),Fe("click",function(){return t.send()}),Y(9,"Continue"),j()()),s&2&&(xe(6),Sr(t.items))},dependencies:[tc,Mr,Es],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.serivce[_ngcontent-%COMP%]{height:78vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.5rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let a=n;return a})();var BL=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275cmp=gt({type:n,selectors:[["app-not-found"]],decls:11,vars:0,consts:[[1,"container"],[1,"material-symbols-outlined"]],template:function(s,t){s&1&&(V(0,"div",0)(1,"span",1),Y(2," wifi_off "),j(),V(3,"span"),Y(4,"You're offline"),j(),V(5,"span"),Y(6,"Please connect to internet and try again"),j(),V(7,"button")(8,"span",1),Y(9," refresh "),j(),Y(10," Retry "),j()())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center}.material-symbols-outlined[_ngcontent-%COMP%]{font-weight:300}"]});let a=n;return a})();var NL=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275cmp=gt({type:n,selectors:[["app-location"]],decls:2,vars:0,template:function(s,t){s&1&&(V(0,"p"),Y(1,"location works!"),j())}});let a=n;return a})();var j9=[{path:"",component:xO},{path:"language",component:wO},{path:"log-in",component:SO},{path:"location",component:NL},{path:"verify",component:MO},{path:"aboutUser",component:TO},{path:"selectWork",component:EO},{path:"aboutWork",component:DO},{path:"workExperiance",component:kO},{path:"aadharVerify",component:AO},{path:"pancard",component:PO},{path:"bankDetails",component:OO},{path:"waiting",component:cL},{path:"home",component:FO},{path:"fotter",component:dl},{path:"credits",component:LO},{path:"notification",component:dL},{path:"menu",component:zO},{path:"visitingCard",component:BO},{path:"referAndEarn",component:NO},{path:"awards",component:VO},{path:"help",component:jO},{path:"target",component:qO},{path:"earnings",component:lL},{path:"calender",component:hL},{path:"jobHistory",component:uL},{path:"jobDetails",component:fL},{path:"addCredit",component:pL},{path:"financialDetails",component:mL},{path:"identityVerification",component:gL},{path:"ongoing",component:_L},{path:"demo",component:Xv},{path:"induction",component:yL},{path:"started",component:bL},{path:"selectAccount",component:vL},{path:"congrats",component:xL},{path:"packages",component:wL},{path:"training",component:CL},{path:"getOrder",component:AL},{path:"arrived",component:PL},{path:"startWork",component:OL},{path:"work/otp",component:RL},{path:"completeWork",component:FL},{path:"verifyAfterWork",component:LL},{path:"subServices",component:zL},{path:"notFound",component:BL}],VL=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n}),n.\u0275inj=ii({imports:[E2.forRoot(j9),E2]});let a=n;return a})();var YM=mm("App",{web:()=>import("./chunk-4TIA3IU3.js").then(a=>new a.AppWeb)});var ZM=mm("Network",{web:()=>import("./chunk-Y3XLC3XN.js").then(a=>new a.NetworkWeb)});var jL=(()=>{let n=class n{constructor(r,s,t){this.location=r,this.messagingService=s,this.router=t,this.title="CoolieNo.1_Provider",this.myObject={}}ngOnInit(){this.messagingService.requestPermission(),setTimeout(()=>{this.myObject=this.messagingService.token?{token:this.messagingService.token}:{}},5e3),this.messagingService.listenForMessages(),this.monitorNetworkStatus(),this.registerBackButtonListener()}registerBackButtonListener(){YM.addListener("backButton",r=>{r.canGoBack?(this.location.back(),console.log("Back button pressed, navigating back")):(console.log("Back button pressed, exiting app"),YM.exitApp())})}monitorNetworkStatus(){return Qr(this,null,function*(){(yield ZM.getStatus()).connected||this.router.navigate(["not-found"]),ZM.addListener("networkStatusChange",s=>{s.connected||this.router.navigate(["not-found"])})})}};n.\u0275fac=function(s){return new(s||n)(ge(Pi),ge(Wx),ge(jt))},n.\u0275cmp=gt({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(s,t){s&1&&Ee(0,"router-outlet")},dependencies:[n0]});let a=n;return a})();var U9="@",H9=(()=>{let n=class n{constructor(r,s,t,g,b){this.doc=r,this.delegate=s,this.zone=t,this.animationType=g,this.moduleImpl=b,this._rendererFactoryPromise=null,this.scheduler=Nt(Rb,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-ZIYTDWTP.js")).catch(s=>{throw new $n(5300,!1)}).then(({\u0275createEngine:s,\u0275AnimationRendererFactory:t})=>{this._engine=s(this.animationType,this.doc,this.scheduler);let g=new t(this.delegate,this._engine,this.zone);return this.delegate=g,g})}createRenderer(r,s){let t=this.delegate.createRenderer(r,s);if(t.\u0275type===0)return t;typeof t.throwOnSyntheticProps=="boolean"&&(t.throwOnSyntheticProps=!1);let g=new XM(t);return s?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(b=>{let M=b.createRenderer(r,s);g.use(M)}).catch(b=>{g.use(t)}),g}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};n.\u0275fac=function(s){Pd()},n.\u0275prov=At({token:n,factory:n.\u0275fac});let a=n;return a})(),XM=class{constructor(n){this.delegate=n,this.replay=[],this.\u0275type=1}use(n){if(this.delegate=n,this.replay!==null){for(let d of this.replay)d(n);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(n,d){return this.delegate.createElement(n,d)}createComment(n){return this.delegate.createComment(n)}createText(n){return this.delegate.createText(n)}get destroyNode(){return this.delegate.destroyNode}appendChild(n,d){this.delegate.appendChild(n,d)}insertBefore(n,d,r,s){this.delegate.insertBefore(n,d,r,s)}removeChild(n,d,r){this.delegate.removeChild(n,d,r)}selectRootElement(n,d){return this.delegate.selectRootElement(n,d)}parentNode(n){return this.delegate.parentNode(n)}nextSibling(n){return this.delegate.nextSibling(n)}setAttribute(n,d,r,s){this.delegate.setAttribute(n,d,r,s)}removeAttribute(n,d,r){this.delegate.removeAttribute(n,d,r)}addClass(n,d){this.delegate.addClass(n,d)}removeClass(n,d){this.delegate.removeClass(n,d)}setStyle(n,d,r,s){this.delegate.setStyle(n,d,r,s)}removeStyle(n,d,r){this.delegate.removeStyle(n,d,r)}setProperty(n,d,r){this.shouldReplay(d)&&this.replay.push(s=>s.setProperty(n,d,r)),this.delegate.setProperty(n,d,r)}setValue(n,d){this.delegate.setValue(n,d)}listen(n,d,r){return this.shouldReplay(d)&&this.replay.push(s=>s.listen(n,d,r)),this.delegate.listen(n,d,r)}shouldReplay(n){return this.replay!==null&&n.startsWith(U9)}};function UL(a="animations"){return Fb("NgAsyncAnimations"),sm([{provide:lm,useFactory:(n,d,r)=>new H9(n,d,r,a),deps:[Ai,gm,di]},{provide:lo,useValue:a==="noop"?"NoopAnimations":"BrowserAnimations"}])}var W9=ID(P2());var Gx={production:!1,firebase:{apiKey:"AIzaSyAcziwgDyx2SxCSeuGbgFDr9_94R2tpDfk",authDomain:"coolie-9cc38.firebaseapp.com",projectId:"coolie-9cc38",storageBucket:"coolie-9cc38.appspot.com",messagingSenderId:"425618348845",appId:"1:425618348845:android:dfb682ab264340b4f611a4",measurementId:"G-X6752VX6L5",vapidKey:"BFLySRIkI2i4ZrxUJjrsCDeG921cCUs-9zLhyulNlP7HUawhIVFefo8GFfxxgnpTWV9zgiKJ9m9Vx8C39MRgPYA"}};var HL=(()=>{let n=class n{};n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=ni({type:n,bootstrap:[jL]}),n.\u0275inj=ii({providers:[UL(),ns],imports:[tv,VL,_A,yA,Sk,xA,YA,XA,KA,QA,eP,PP,tP,WO,wP,WA,IL.initializeApp(Gx.firebase),DL]});let a=n;return a})();Gx.production&&void 0;Ak().bootstrapModule(HL).catch(a=>console.error(a));"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js").then(a=>{console.log("Service Worker registered with scope:",a.scope)}).catch(a=>{console.log("Service Worker registration failed:",a)});
