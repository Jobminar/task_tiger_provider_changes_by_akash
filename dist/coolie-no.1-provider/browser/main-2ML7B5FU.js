import{A as lT,a as fw,b as Eg,c as Td,d as gw,e as _w,f as Dg,l as oT,m as Ag,n as Lb,s as aT,t as Fb,v as sT}from"./chunk-VFYDMS3I.js";import{i as hT,j as Ps,k as uT}from"./chunk-VR2CY5TD.js";import{A as nT,B as rT,C as zb,D as Fo,E as Bb,F as Bt,G as Nb,H as Vb,I as bw,a as $I,c as Gi,d as YI,e as Pb,f as ZI,g as Ob,h as XI,i as cl,j as mo,k as QI,l as po,m as hr,n as Ro,o as KI,p as ra,q as Lo,r as Rb,s as oa,t as es,u as JI,v as eT,w as tT,x as iT,y as Gm,z as aa}from"./chunk-5ATCEA3X.js";import{$ as Ut,A as eu,Aa as hn,Ab as yi,Ac as Oo,B as Ea,Ba as ln,Bb as _i,Bc as uo,C as iw,Cb as bi,Cc as Cr,D as Jl,Db as Da,Dc as UI,Eb as $,Ec as WI,F as nw,Fa as Md,Fb as Ft,Fc as HI,G as MI,Ga as co,Gb as Ii,Gc as Db,H as Qa,Ha as DI,Hb as Aa,Hc as Ab,Ia as Un,Ib as Tb,Ic as GI,J as rw,Jb as RI,Jc as ll,Kb as LI,La as ue,Lb as Lr,Lc as qI,Ma as fe,Mb as Fr,Na as Um,Nb as zr,O as ow,Oa as iu,Ob as As,P as kI,Pa as Mb,Pb as Qn,Qa as Ig,Qb as Eb,R as aw,Ra as kb,Rb as di,S as wb,Sa as AI,Sb as hw,T as Ts,Ta as cw,Tb as FI,U as Es,Ua as Bi,Ub as zI,V as sw,Vb as BI,W as tu,Wa as Wm,Wb as Hm,Xa as Ho,Xb as uw,Y as II,Ya as Ao,Yb as NI,_ as Cb,a as Is,aa as mi,ab as Nt,bb as wn,c as vo,ca as bn,cb as Fe,db as Ja,ea as at,eb as ki,f as Ln,fa as Tn,fb as Ds,fc as VI,g as Mg,ga as Sb,gb as Xn,h as bI,ha as TI,hb as io,hc as jI,i as yI,ib as Tg,j as vI,ja as Qi,jb as xr,jc as mw,k as Ql,ka as ft,kb as wr,kc as xo,l as Kl,la as pi,lb as V,ma as dr,mb as j,n as tr,na as EI,nb as ke,nc as ho,ob as kd,oc as pw,pb as Id,qb as dw,r as xI,ra as Do,rb as Xt,s as Nm,sa as gt,sb as ec,t as wI,ta as _t,tb as PI,tc as gn,u as CI,ua as Sd,ub as Oe,va as lw,vb as OI,w as vb,wa as Vm,wb as lt,x as xb,xa as jm,xb as na,y as kg,ya as Ka,yb as Po,yc as ii,z as SI,zb as Ib}from"./chunk-IGDLGV62.js";import{a as jb,b as cT,c as Ed,d as dT}from"./chunk-HJO2KOHN.js";import{a as Xi,b as ia,c as gI,d as vF,f as _I,g as jn}from"./chunk-MON7YFGF.js";var yC=vF((_C,bC)=>{"use strict";(function(d,o){typeof _C=="object"&&typeof bC<"u"?bC.exports=o():typeof define=="function"&&define.amd?define(o):(d=typeof globalThis<"u"?globalThis:d||self,d.mapboxgl=o())})(_C,function(){"use strict";var d,o,c;function r(t,g){if(!d)d=g;else if(!o)o=g;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+d+")(sharedChunk); ("+o+")(sharedChunk); self.onerror = null;",I={};d(I),c=g(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(c.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}r(["exports"],function(t){var g="3.5.1";let C,I={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){let i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):i}catch{C=i}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!I.API_URL)return null;try{let i=new URL(I.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function O(i){return I.API_URL_REGEX.test(i)}function z(i){return i.indexOf("mapbox:")===0}function q(i){return I.API_CDN_URL_REGEX.test(i)}function ie(i){return I.API_SPRITE_REGEX.test(i)}function de(i){return I.API_STYLE_REGEX.test(i)&&!ie(i)}let xe={create:"create",load:"load",fullLoad:"fullLoad"},Ie={mark(i){performance.mark(i)},measure(i,e,n){performance.measure(i,e,n)}};function Me(i){let e=i.name.split("?")[0];return q(e)&&e.includes("mapbox-gl.js")?"javascript":q(e)&&e.includes("mapbox-gl.css")?"css":function(n){return I.API_FONTS_REGEX.test(n)}(e)?"fontRange":ie(e)?"sprite":de(e)?"style":function(n){return I.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function Ge(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var He={},ht={};Object.defineProperty(ht,"__esModule",{value:!0}),ht.setMatrixArrayType=function(i){ht.ARRAY_TYPE=yt=i},ht.toRadian=function(i){return i*Wt},ht.equals=function(i,e){return Math.abs(i-e)<=Mt*Math.max(1,Math.abs(i),Math.abs(e))},ht.RANDOM=ht.ARRAY_TYPE=ht.EPSILON=void 0;var Mt=1e-6;ht.EPSILON=Mt;var yt=typeof Float32Array<"u"?Float32Array:Array;ht.ARRAY_TYPE=yt;var Tt=Math.random;ht.RANDOM=Tt;var Wt=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Ct={};function Yt(i){return Yt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yt(i)}Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.create=function(){var i=new zt.ARRAY_TYPE(4);return zt.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},Ct.clone=function(i){var e=new zt.ARRAY_TYPE(4);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e},Ct.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},Ct.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i},Ct.fromValues=function(i,e,n,s){var h=new zt.ARRAY_TYPE(4);return h[0]=i,h[1]=e,h[2]=n,h[3]=s,h},Ct.set=function(i,e,n,s,h){return i[0]=e,i[1]=n,i[2]=s,i[3]=h,i},Ct.transpose=function(i,e){if(i===e){var n=e[1];i[1]=e[2],i[2]=n}else i[0]=e[0],i[1]=e[2],i[2]=e[1],i[3]=e[3];return i},Ct.invert=function(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=n*m-h*s;return p?(i[0]=m*(p=1/p),i[1]=-s*p,i[2]=-h*p,i[3]=n*p,i):null},Ct.adjoint=function(i,e){var n=e[0];return i[0]=e[3],i[1]=-e[1],i[2]=-e[2],i[3]=n,i},Ct.determinant=function(i){return i[0]*i[3]-i[2]*i[1]},Ct.multiply=Hi,Ct.rotate=function(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return i[0]=s*y+m*b,i[1]=h*y+p*b,i[2]=s*-b+m*y,i[3]=h*-b+p*y,i},Ct.scale=function(i,e,n){var s=e[1],h=e[2],m=e[3],p=n[0],b=n[1];return i[0]=e[0]*p,i[1]=s*p,i[2]=h*b,i[3]=m*b,i},Ct.fromRotation=function(i,e){var n=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=n,i[2]=-n,i[3]=s,i},Ct.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=e[1],i},Ct.str=function(i){return"mat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},Ct.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},Ct.LDU=function(i,e,n,s){return i[2]=s[2]/s[0],n[0]=s[0],n[1]=s[1],n[3]=s[3]-i[2]*n[1],[i,e,n]},Ct.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i},Ct.subtract=_r,Ct.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},Ct.equals=function(i,e){var n=i[0],s=i[1],h=i[2],m=i[3],p=e[0],b=e[1],y=e[2],w=e[3];return Math.abs(n-p)<=zt.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-b)<=zt.EPSILON*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(h-y)<=zt.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(m-w)<=zt.EPSILON*Math.max(1,Math.abs(m),Math.abs(w))},Ct.multiplyScalar=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},Ct.multiplyScalarAndAdd=function(i,e,n,s){return i[0]=e[0]+n[0]*s,i[1]=e[1]+n[1]*s,i[2]=e[2]+n[2]*s,i[3]=e[3]+n[3]*s,i},Ct.sub=Ct.mul=void 0;var zt=function(i,e){if(i&&i.__esModule)return i;if(i===null||Yt(i)!=="object"&&typeof i!="function")return{default:i};var n=Ti(void 0);if(n&&n.has(i))return n.get(i);var s={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=h?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(s,m,p):s[m]=i[m]}return s.default=i,n&&n.set(i,s),s}(ht);function Ti(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ti=function(s){return s?n:e})(i)}function Hi(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=n[0],y=n[1],w=n[2],M=n[3];return i[0]=s*b+m*y,i[1]=h*b+p*y,i[2]=s*w+m*M,i[3]=h*w+p*M,i}function _r(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i}Ct.mul=Hi,Ct.sub=_r;var Ci={};function mn(i){return mn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mn(i)}Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.create=function(){var i=new rn.ARRAY_TYPE(6);return rn.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[4]=0,i[5]=0),i[0]=1,i[3]=1,i},Ci.clone=function(i){var e=new rn.ARRAY_TYPE(6);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e},Ci.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i},Ci.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i},Ci.fromValues=function(i,e,n,s,h,m){var p=new rn.ARRAY_TYPE(6);return p[0]=i,p[1]=e,p[2]=n,p[3]=s,p[4]=h,p[5]=m,p},Ci.set=function(i,e,n,s,h,m,p){return i[0]=e,i[1]=n,i[2]=s,i[3]=h,i[4]=m,i[5]=p,i},Ci.invert=function(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=e[4],b=e[5],y=n*m-s*h;return y?(i[0]=m*(y=1/y),i[1]=-s*y,i[2]=-h*y,i[3]=n*y,i[4]=(h*b-m*p)*y,i[5]=(s*p-n*b)*y,i):null},Ci.determinant=function(i){return i[0]*i[3]-i[1]*i[2]},Ci.multiply=Zr,Ci.rotate=function(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=Math.sin(n),M=Math.cos(n);return i[0]=s*M+m*w,i[1]=h*M+p*w,i[2]=s*-w+m*M,i[3]=h*-w+p*M,i[4]=b,i[5]=y,i},Ci.scale=function(i,e,n){var s=e[1],h=e[2],m=e[3],p=e[4],b=e[5],y=n[0],w=n[1];return i[0]=e[0]*y,i[1]=s*y,i[2]=h*w,i[3]=m*w,i[4]=p,i[5]=b,i},Ci.translate=function(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=n[0],M=n[1];return i[0]=s,i[1]=h,i[2]=m,i[3]=p,i[4]=s*w+m*M+b,i[5]=h*w+p*M+y,i},Ci.fromRotation=function(i,e){var n=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=n,i[2]=-n,i[3]=s,i[4]=0,i[5]=0,i},Ci.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=e[1],i[4]=0,i[5]=0,i},Ci.fromTranslation=function(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=e[0],i[5]=e[1],i},Ci.str=function(i){return"mat2d("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+")"},Ci.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],1)},Ci.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i},Ci.subtract=rr,Ci.multiplyScalar=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i},Ci.multiplyScalarAndAdd=function(i,e,n,s){return i[0]=e[0]+n[0]*s,i[1]=e[1]+n[1]*s,i[2]=e[2]+n[2]*s,i[3]=e[3]+n[3]*s,i[4]=e[4]+n[4]*s,i[5]=e[5]+n[5]*s,i},Ci.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]},Ci.equals=function(i,e){var n=i[0],s=i[1],h=i[2],m=i[3],p=i[4],b=i[5],y=e[0],w=e[1],M=e[2],T=e[3],E=e[4],P=e[5];return Math.abs(n-y)<=rn.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(s-w)<=rn.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(h-M)<=rn.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(m-T)<=rn.EPSILON*Math.max(1,Math.abs(m),Math.abs(T))&&Math.abs(p-E)<=rn.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(b-P)<=rn.EPSILON*Math.max(1,Math.abs(b),Math.abs(P))},Ci.sub=Ci.mul=void 0;var rn=function(i,e){if(i&&i.__esModule)return i;if(i===null||mn(i)!=="object"&&typeof i!="function")return{default:i};var n=Yn(void 0);if(n&&n.has(i))return n.get(i);var s={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=h?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(s,m,p):s[m]=i[m]}return s.default=i,n&&n.set(i,s),s}(ht);function Yn(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Yn=function(s){return s?n:e})(i)}function Zr(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=n[0],M=n[1],T=n[2],E=n[3],P=n[4],R=n[5];return i[0]=s*w+m*M,i[1]=h*w+p*M,i[2]=s*T+m*E,i[3]=h*T+p*E,i[4]=s*P+m*R+b,i[5]=h*P+p*R+y,i}function rr(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i[4]=e[4]-n[4],i[5]=e[5]-n[5],i}Ci.mul=Zr,Ci.sub=rr;var Ei={};function ga(i){return ga=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ga(i)}Object.defineProperty(Ei,"__esModule",{value:!0}),Ei.create=function(){var i=new or.ARRAY_TYPE(9);return or.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},Ei.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},Ei.clone=function(i){var e=new or.ARRAY_TYPE(9);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e},Ei.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i},Ei.fromValues=function(i,e,n,s,h,m,p,b,y){var w=new or.ARRAY_TYPE(9);return w[0]=i,w[1]=e,w[2]=n,w[3]=s,w[4]=h,w[5]=m,w[6]=p,w[7]=b,w[8]=y,w},Ei.set=function(i,e,n,s,h,m,p,b,y,w){return i[0]=e,i[1]=n,i[2]=s,i[3]=h,i[4]=m,i[5]=p,i[6]=b,i[7]=y,i[8]=w,i},Ei.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Ei.transpose=function(i,e){if(i===e){var n=e[1],s=e[2],h=e[5];i[1]=e[3],i[2]=e[6],i[3]=n,i[5]=e[7],i[6]=s,i[7]=h}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},Ei.invert=function(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=M*p-b*w,E=-M*m+b*y,P=w*m-p*y,R=n*T+s*E+h*P;return R?(i[0]=T*(R=1/R),i[1]=(-M*s+h*w)*R,i[2]=(b*s-h*p)*R,i[3]=E*R,i[4]=(M*n-h*y)*R,i[5]=(-b*n+h*m)*R,i[6]=P*R,i[7]=(-w*n+s*y)*R,i[8]=(p*n-s*m)*R,i):null},Ei.adjoint=function(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8];return i[0]=p*M-b*w,i[1]=h*w-s*M,i[2]=s*b-h*p,i[3]=b*y-m*M,i[4]=n*M-h*y,i[5]=h*m-n*b,i[6]=m*w-p*y,i[7]=s*y-n*w,i[8]=n*p-s*m,i},Ei.determinant=function(i){var e=i[3],n=i[4],s=i[5],h=i[6],m=i[7],p=i[8];return i[0]*(p*n-s*m)+i[1]*(-p*e+s*h)+i[2]*(m*e-n*h)},Ei.multiply=Go,Ei.translate=function(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=n[0],P=n[1];return i[0]=s,i[1]=h,i[2]=m,i[3]=p,i[4]=b,i[5]=y,i[6]=E*s+P*p+w,i[7]=E*h+P*b+M,i[8]=E*m+P*y+T,i},Ei.rotate=function(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=Math.sin(n),P=Math.cos(n);return i[0]=P*s+E*p,i[1]=P*h+E*b,i[2]=P*m+E*y,i[3]=P*p-E*s,i[4]=P*b-E*h,i[5]=P*y-E*m,i[6]=w,i[7]=M,i[8]=T,i},Ei.scale=function(i,e,n){var s=n[0],h=n[1];return i[0]=s*e[0],i[1]=s*e[1],i[2]=s*e[2],i[3]=h*e[3],i[4]=h*e[4],i[5]=h*e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i},Ei.fromTranslation=function(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=e[0],i[7]=e[1],i[8]=1,i},Ei.fromRotation=function(i,e){var n=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=n,i[2]=0,i[3]=-n,i[4]=s,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Ei.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=e[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Ei.fromMat2d=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=0,i[3]=e[2],i[4]=e[3],i[5]=0,i[6]=e[4],i[7]=e[5],i[8]=1,i},Ei.fromQuat=function(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=n+n,b=s+s,y=h+h,w=n*p,M=s*p,T=s*b,E=h*p,P=h*b,R=h*y,F=m*p,N=m*b,H=m*y;return i[0]=1-T-R,i[3]=M-H,i[6]=E+N,i[1]=M+H,i[4]=1-w-R,i[7]=P-F,i[2]=E-N,i[5]=P+F,i[8]=1-w-T,i},Ei.normalFromMat4=function(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=e[9],E=e[10],P=e[11],R=e[12],F=e[13],N=e[14],H=e[15],J=n*b-s*p,ee=n*y-h*p,te=n*w-m*p,pe=s*y-h*b,he=s*w-m*b,ve=h*w-m*y,Ce=M*F-T*R,Ae=M*N-E*R,Ue=M*H-P*R,ze=T*N-E*F,Ye=T*H-P*F,rt=E*H-P*N,qe=J*rt-ee*Ye+te*ze+pe*Ue-he*Ae+ve*Ce;return qe?(i[0]=(b*rt-y*Ye+w*ze)*(qe=1/qe),i[1]=(y*Ue-p*rt-w*Ae)*qe,i[2]=(p*Ye-b*Ue+w*Ce)*qe,i[3]=(h*Ye-s*rt-m*ze)*qe,i[4]=(n*rt-h*Ue+m*Ae)*qe,i[5]=(s*Ue-n*Ye-m*Ce)*qe,i[6]=(F*ve-N*he+H*pe)*qe,i[7]=(N*te-R*ve-H*ee)*qe,i[8]=(R*he-F*te+H*J)*qe,i):null},Ei.projection=function(i,e,n){return i[0]=2/e,i[1]=0,i[2]=0,i[3]=0,i[4]=-2/n,i[5]=0,i[6]=-1,i[7]=1,i[8]=1,i},Ei.str=function(i){return"mat3("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+")"},Ei.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},Ei.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i[6]=e[6]+n[6],i[7]=e[7]+n[7],i[8]=e[8]+n[8],i},Ei.subtract=Fa,Ei.multiplyScalar=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*n,i},Ei.multiplyScalarAndAdd=function(i,e,n,s){return i[0]=e[0]+n[0]*s,i[1]=e[1]+n[1]*s,i[2]=e[2]+n[2]*s,i[3]=e[3]+n[3]*s,i[4]=e[4]+n[4]*s,i[5]=e[5]+n[5]*s,i[6]=e[6]+n[6]*s,i[7]=e[7]+n[7]*s,i[8]=e[8]+n[8]*s,i},Ei.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]},Ei.equals=function(i,e){var n=i[0],s=i[1],h=i[2],m=i[3],p=i[4],b=i[5],y=i[6],w=i[7],M=i[8],T=e[0],E=e[1],P=e[2],R=e[3],F=e[4],N=e[5],H=e[6],J=e[7],ee=e[8];return Math.abs(n-T)<=or.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(s-E)<=or.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(h-P)<=or.EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(m-R)<=or.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(p-F)<=or.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(b-N)<=or.EPSILON*Math.max(1,Math.abs(b),Math.abs(N))&&Math.abs(y-H)<=or.EPSILON*Math.max(1,Math.abs(y),Math.abs(H))&&Math.abs(w-J)<=or.EPSILON*Math.max(1,Math.abs(w),Math.abs(J))&&Math.abs(M-ee)<=or.EPSILON*Math.max(1,Math.abs(M),Math.abs(ee))},Ei.sub=Ei.mul=void 0;var or=function(i,e){if(i&&i.__esModule)return i;if(i===null||ga(i)!=="object"&&typeof i!="function")return{default:i};var n=La(void 0);if(n&&n.has(i))return n.get(i);var s={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=h?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(s,m,p):s[m]=i[m]}return s.default=i,n&&n.set(i,s),s}(ht);function La(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(La=function(s){return s?n:e})(i)}function Go(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=n[0],P=n[1],R=n[2],F=n[3],N=n[4],H=n[5],J=n[6],ee=n[7],te=n[8];return i[0]=E*s+P*p+R*w,i[1]=E*h+P*b+R*M,i[2]=E*m+P*y+R*T,i[3]=F*s+N*p+H*w,i[4]=F*h+N*b+H*M,i[5]=F*m+N*y+H*T,i[6]=J*s+ee*p+te*w,i[7]=J*h+ee*b+te*M,i[8]=J*m+ee*y+te*T,i}function Fa(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i[4]=e[4]-n[4],i[5]=e[5]-n[5],i[6]=e[6]-n[6],i[7]=e[7]-n[7],i[8]=e[8]-n[8],i}Ei.mul=Go,Ei.sub=Fa;var Gt={};function fc(i){return fc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fc(i)}Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=function(){var i=new En.ARRAY_TYPE(16);return En.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},Gt.clone=function(i){var e=new En.ARRAY_TYPE(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},Gt.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},Gt.fromValues=function(i,e,n,s,h,m,p,b,y,w,M,T,E,P,R,F){var N=new En.ARRAY_TYPE(16);return N[0]=i,N[1]=e,N[2]=n,N[3]=s,N[4]=h,N[5]=m,N[6]=p,N[7]=b,N[8]=y,N[9]=w,N[10]=M,N[11]=T,N[12]=E,N[13]=P,N[14]=R,N[15]=F,N},Gt.set=function(i,e,n,s,h,m,p,b,y,w,M,T,E,P,R,F,N){return i[0]=e,i[1]=n,i[2]=s,i[3]=h,i[4]=m,i[5]=p,i[6]=b,i[7]=y,i[8]=w,i[9]=M,i[10]=T,i[11]=E,i[12]=P,i[13]=R,i[14]=F,i[15]=N,i},Gt.identity=xu,Gt.transpose=function(i,e){if(i===e){var n=e[1],s=e[2],h=e[3],m=e[6],p=e[7],b=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=n,i[6]=e[9],i[7]=e[13],i[8]=s,i[9]=m,i[11]=e[14],i[12]=h,i[13]=p,i[14]=b}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i},Gt.invert=function(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=e[9],E=e[10],P=e[11],R=e[12],F=e[13],N=e[14],H=e[15],J=n*b-s*p,ee=n*y-h*p,te=n*w-m*p,pe=s*y-h*b,he=s*w-m*b,ve=h*w-m*y,Ce=M*F-T*R,Ae=M*N-E*R,Ue=M*H-P*R,ze=T*N-E*F,Ye=T*H-P*F,rt=E*H-P*N,qe=J*rt-ee*Ye+te*ze+pe*Ue-he*Ae+ve*Ce;return qe?(i[0]=(b*rt-y*Ye+w*ze)*(qe=1/qe),i[1]=(h*Ye-s*rt-m*ze)*qe,i[2]=(F*ve-N*he+H*pe)*qe,i[3]=(E*he-T*ve-P*pe)*qe,i[4]=(y*Ue-p*rt-w*Ae)*qe,i[5]=(n*rt-h*Ue+m*Ae)*qe,i[6]=(N*te-R*ve-H*ee)*qe,i[7]=(M*ve-E*te+P*ee)*qe,i[8]=(p*Ye-b*Ue+w*Ce)*qe,i[9]=(s*Ue-n*Ye-m*Ce)*qe,i[10]=(R*he-F*te+H*J)*qe,i[11]=(T*te-M*he-P*J)*qe,i[12]=(b*Ae-p*ze-y*Ce)*qe,i[13]=(n*ze-s*Ae+h*Ce)*qe,i[14]=(F*ee-R*pe-N*J)*qe,i[15]=(M*pe-T*ee+E*J)*qe,i):null},Gt.adjoint=function(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=e[9],E=e[10],P=e[11],R=e[12],F=e[13],N=e[14],H=e[15];return i[0]=b*(E*H-P*N)-T*(y*H-w*N)+F*(y*P-w*E),i[1]=-(s*(E*H-P*N)-T*(h*H-m*N)+F*(h*P-m*E)),i[2]=s*(y*H-w*N)-b*(h*H-m*N)+F*(h*w-m*y),i[3]=-(s*(y*P-w*E)-b*(h*P-m*E)+T*(h*w-m*y)),i[4]=-(p*(E*H-P*N)-M*(y*H-w*N)+R*(y*P-w*E)),i[5]=n*(E*H-P*N)-M*(h*H-m*N)+R*(h*P-m*E),i[6]=-(n*(y*H-w*N)-p*(h*H-m*N)+R*(h*w-m*y)),i[7]=n*(y*P-w*E)-p*(h*P-m*E)+M*(h*w-m*y),i[8]=p*(T*H-P*F)-M*(b*H-w*F)+R*(b*P-w*T),i[9]=-(n*(T*H-P*F)-M*(s*H-m*F)+R*(s*P-m*T)),i[10]=n*(b*H-w*F)-p*(s*H-m*F)+R*(s*w-m*b),i[11]=-(n*(b*P-w*T)-p*(s*P-m*T)+M*(s*w-m*b)),i[12]=-(p*(T*N-E*F)-M*(b*N-y*F)+R*(b*E-y*T)),i[13]=n*(T*N-E*F)-M*(s*N-h*F)+R*(s*E-h*T),i[14]=-(n*(b*N-y*F)-p*(s*N-h*F)+R*(s*y-h*b)),i[15]=n*(b*E-y*T)-p*(s*E-h*T)+M*(s*y-h*b),i},Gt.determinant=function(i){var e=i[0],n=i[1],s=i[2],h=i[3],m=i[4],p=i[5],b=i[6],y=i[7],w=i[8],M=i[9],T=i[10],E=i[11],P=i[12],R=i[13],F=i[14],N=i[15];return(e*p-n*m)*(T*N-E*F)-(e*b-s*m)*(M*N-E*R)+(e*y-h*m)*(M*F-T*R)+(n*b-s*p)*(w*N-E*P)-(n*y-h*p)*(w*F-T*P)+(s*y-h*b)*(w*R-M*P)},Gt.multiply=wu,Gt.translate=function(i,e,n){var s,h,m,p,b,y,w,M,T,E,P,R,F=n[0],N=n[1],H=n[2];return e===i?(i[12]=e[0]*F+e[4]*N+e[8]*H+e[12],i[13]=e[1]*F+e[5]*N+e[9]*H+e[13],i[14]=e[2]*F+e[6]*N+e[10]*H+e[14],i[15]=e[3]*F+e[7]*N+e[11]*H+e[15]):(h=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=e[9],P=e[10],R=e[11],i[0]=s=e[0],i[1]=h,i[2]=m,i[3]=p,i[4]=b,i[5]=y,i[6]=w,i[7]=M,i[8]=T,i[9]=E,i[10]=P,i[11]=R,i[12]=s*F+b*N+T*H+e[12],i[13]=h*F+y*N+E*H+e[13],i[14]=m*F+w*N+P*H+e[14],i[15]=p*F+M*N+R*H+e[15]),i},Gt.scale=function(i,e,n){var s=n[0],h=n[1],m=n[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*h,i[5]=e[5]*h,i[6]=e[6]*h,i[7]=e[7]*h,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},Gt.rotate=function(i,e,n,s){var h,m,p,b,y,w,M,T,E,P,R,F,N,H,J,ee,te,pe,he,ve,Ce,Ae,Ue,ze,Ye=s[0],rt=s[1],qe=s[2],et=Math.hypot(Ye,rt,qe);return et<En.EPSILON?null:(Ye*=et=1/et,rt*=et,qe*=et,h=Math.sin(n),m=Math.cos(n),y=e[1],w=e[2],M=e[3],E=e[5],P=e[6],R=e[7],N=e[9],H=e[10],J=e[11],ee=Ye*Ye*(p=1-m)+m,he=Ye*rt*p-qe*h,ve=rt*rt*p+m,Ce=qe*rt*p+Ye*h,Ae=Ye*qe*p+rt*h,Ue=rt*qe*p-Ye*h,ze=qe*qe*p+m,i[0]=(b=e[0])*ee+(T=e[4])*(te=rt*Ye*p+qe*h)+(F=e[8])*(pe=qe*Ye*p-rt*h),i[1]=y*ee+E*te+N*pe,i[2]=w*ee+P*te+H*pe,i[3]=M*ee+R*te+J*pe,i[4]=b*he+T*ve+F*Ce,i[5]=y*he+E*ve+N*Ce,i[6]=w*he+P*ve+H*Ce,i[7]=M*he+R*ve+J*Ce,i[8]=b*Ae+T*Ue+F*ze,i[9]=y*Ae+E*Ue+N*ze,i[10]=w*Ae+P*Ue+H*ze,i[11]=M*Ae+R*Ue+J*ze,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)},Gt.rotateX=function(i,e,n){var s=Math.sin(n),h=Math.cos(n),m=e[4],p=e[5],b=e[6],y=e[7],w=e[8],M=e[9],T=e[10],E=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*h+w*s,i[5]=p*h+M*s,i[6]=b*h+T*s,i[7]=y*h+E*s,i[8]=w*h-m*s,i[9]=M*h-p*s,i[10]=T*h-b*s,i[11]=E*h-y*s,i},Gt.rotateY=function(i,e,n){var s=Math.sin(n),h=Math.cos(n),m=e[0],p=e[1],b=e[2],y=e[3],w=e[8],M=e[9],T=e[10],E=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*h-w*s,i[1]=p*h-M*s,i[2]=b*h-T*s,i[3]=y*h-E*s,i[8]=m*s+w*h,i[9]=p*s+M*h,i[10]=b*s+T*h,i[11]=y*s+E*h,i},Gt.rotateZ=function(i,e,n){var s=Math.sin(n),h=Math.cos(n),m=e[0],p=e[1],b=e[2],y=e[3],w=e[4],M=e[5],T=e[6],E=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*h+w*s,i[1]=p*h+M*s,i[2]=b*h+T*s,i[3]=y*h+E*s,i[4]=w*h-m*s,i[5]=M*h-p*s,i[6]=T*h-b*s,i[7]=E*h-y*s,i},Gt.fromTranslation=function(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},Gt.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.fromRotation=function(i,e,n){var s,h,m,p=n[0],b=n[1],y=n[2],w=Math.hypot(p,b,y);return w<En.EPSILON?null:(p*=w=1/w,b*=w,y*=w,s=Math.sin(e),h=Math.cos(e),i[0]=p*p*(m=1-h)+h,i[1]=b*p*m+y*s,i[2]=y*p*m-b*s,i[3]=0,i[4]=p*b*m-y*s,i[5]=b*b*m+h,i[6]=y*b*m+p*s,i[7]=0,i[8]=p*y*m+b*s,i[9]=b*y*m-p*s,i[10]=y*y*m+h,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)},Gt.fromXRotation=function(i,e){var n=Math.sin(e),s=Math.cos(e);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=n,i[7]=0,i[8]=0,i[9]=-n,i[10]=s,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.fromYRotation=function(i,e){var n=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=0,i[2]=-n,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=n,i[9]=0,i[10]=s,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.fromZRotation=function(i,e){var n=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=n,i[2]=0,i[3]=0,i[4]=-n,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.fromRotationTranslation=$d,Gt.fromQuat2=function(i,e){var n=new En.ARRAY_TYPE(3),s=-e[0],h=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=s*s+h*h+m*m+p*p;return T>0?(n[0]=2*(b*p+M*s+y*m-w*h)/T,n[1]=2*(y*p+M*h+w*s-b*m)/T,n[2]=2*(w*p+M*m+b*h-y*s)/T):(n[0]=2*(b*p+M*s+y*m-w*h),n[1]=2*(y*p+M*h+w*s-b*m),n[2]=2*(w*p+M*m+b*h-y*s)),$d(i,e,n),i},Gt.getTranslation=function(i,e){return i[0]=e[12],i[1]=e[13],i[2]=e[14],i},Gt.getScaling=gc,Gt.getRotation=function(i,e){var n=new En.ARRAY_TYPE(3);gc(n,e);var s=1/n[0],h=1/n[1],m=1/n[2],p=e[0]*s,b=e[1]*h,y=e[2]*m,w=e[4]*s,M=e[5]*h,T=e[6]*m,E=e[8]*s,P=e[9]*h,R=e[10]*m,F=p+M+R,N=0;return F>0?(N=2*Math.sqrt(F+1),i[3]=.25*N,i[0]=(T-P)/N,i[1]=(E-y)/N,i[2]=(b-w)/N):p>M&&p>R?(N=2*Math.sqrt(1+p-M-R),i[3]=(T-P)/N,i[0]=.25*N,i[1]=(b+w)/N,i[2]=(E+y)/N):M>R?(N=2*Math.sqrt(1+M-p-R),i[3]=(E-y)/N,i[0]=(b+w)/N,i[1]=.25*N,i[2]=(T+P)/N):(N=2*Math.sqrt(1+R-p-M),i[3]=(b-w)/N,i[0]=(E+y)/N,i[1]=(T+P)/N,i[2]=.25*N),i},Gt.fromRotationTranslationScale=function(i,e,n,s){var h=e[0],m=e[1],p=e[2],b=e[3],y=h+h,w=m+m,M=p+p,T=h*y,E=h*w,P=h*M,R=m*w,F=m*M,N=p*M,H=b*y,J=b*w,ee=b*M,te=s[0],pe=s[1],he=s[2];return i[0]=(1-(R+N))*te,i[1]=(E+ee)*te,i[2]=(P-J)*te,i[3]=0,i[4]=(E-ee)*pe,i[5]=(1-(T+N))*pe,i[6]=(F+H)*pe,i[7]=0,i[8]=(P+J)*he,i[9]=(F-H)*he,i[10]=(1-(T+R))*he,i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i},Gt.fromRotationTranslationScaleOrigin=function(i,e,n,s,h){var m=e[0],p=e[1],b=e[2],y=e[3],w=m+m,M=p+p,T=b+b,E=m*w,P=m*M,R=m*T,F=p*M,N=p*T,H=b*T,J=y*w,ee=y*M,te=y*T,pe=s[0],he=s[1],ve=s[2],Ce=h[0],Ae=h[1],Ue=h[2],ze=(1-(F+H))*pe,Ye=(P+te)*pe,rt=(R-ee)*pe,qe=(P-te)*he,et=(1-(E+H))*he,We=(N+J)*he,tt=(R+ee)*ve,ct=(N-J)*ve,nt=(1-(E+F))*ve;return i[0]=ze,i[1]=Ye,i[2]=rt,i[3]=0,i[4]=qe,i[5]=et,i[6]=We,i[7]=0,i[8]=tt,i[9]=ct,i[10]=nt,i[11]=0,i[12]=n[0]+Ce-(ze*Ce+qe*Ae+tt*Ue),i[13]=n[1]+Ae-(Ye*Ce+et*Ae+ct*Ue),i[14]=n[2]+Ue-(rt*Ce+We*Ae+nt*Ue),i[15]=1,i},Gt.fromQuat=function(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=n+n,b=s+s,y=h+h,w=n*p,M=s*p,T=s*b,E=h*p,P=h*b,R=h*y,F=m*p,N=m*b,H=m*y;return i[0]=1-T-R,i[1]=M+H,i[2]=E-N,i[3]=0,i[4]=M-H,i[5]=1-w-R,i[6]=P+F,i[7]=0,i[8]=E+N,i[9]=P-F,i[10]=1-w-T,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.frustum=function(i,e,n,s,h,m,p){var b=1/(n-e),y=1/(h-s),w=1/(m-p);return i[0]=2*m*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*m*y,i[6]=0,i[7]=0,i[8]=(n+e)*b,i[9]=(h+s)*y,i[10]=(p+m)*w,i[11]=-1,i[12]=0,i[13]=0,i[14]=p*m*2*w,i[15]=0,i},Gt.perspectiveNO=_a,Gt.perspectiveZO=function(i,e,n,s,h){var m,p=1/Math.tan(e/2);return i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=h*(m=1/(s-h)),i[14]=h*s*m):(i[10]=-1,i[14]=-s),i},Gt.perspectiveFromFieldOfView=function(i,e,n,s){var h=Math.tan(e.upDegrees*Math.PI/180),m=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),b=Math.tan(e.rightDegrees*Math.PI/180),y=2/(p+b),w=2/(h+m);return i[0]=y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=w,i[6]=0,i[7]=0,i[8]=-(p-b)*y*.5,i[9]=(h-m)*w*.5,i[10]=s/(n-s),i[11]=-1,i[12]=0,i[13]=0,i[14]=s*n/(n-s),i[15]=0,i},Gt.orthoNO=ba,Gt.orthoZO=function(i,e,n,s,h,m,p){var b=1/(e-n),y=1/(s-h),w=1/(m-p);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=w,i[11]=0,i[12]=(e+n)*b,i[13]=(h+s)*y,i[14]=m*w,i[15]=1,i},Gt.lookAt=function(i,e,n,s){var h,m,p,b,y,w,M,T,E,P,R=e[0],F=e[1],N=e[2],H=s[0],J=s[1],ee=s[2],te=n[0],pe=n[1],he=n[2];return Math.abs(R-te)<En.EPSILON&&Math.abs(F-pe)<En.EPSILON&&Math.abs(N-he)<En.EPSILON?xu(i):(M=R-te,T=F-pe,E=N-he,h=J*(E*=P=1/Math.hypot(M,T,E))-ee*(T*=P),m=ee*(M*=P)-H*E,p=H*T-J*M,(P=Math.hypot(h,m,p))?(h*=P=1/P,m*=P,p*=P):(h=0,m=0,p=0),b=T*p-E*m,y=E*h-M*p,w=M*m-T*h,(P=Math.hypot(b,y,w))?(b*=P=1/P,y*=P,w*=P):(b=0,y=0,w=0),i[0]=h,i[1]=b,i[2]=M,i[3]=0,i[4]=m,i[5]=y,i[6]=T,i[7]=0,i[8]=p,i[9]=w,i[10]=E,i[11]=0,i[12]=-(h*R+m*F+p*N),i[13]=-(b*R+y*F+w*N),i[14]=-(M*R+T*F+E*N),i[15]=1,i)},Gt.targetTo=function(i,e,n,s){var h=e[0],m=e[1],p=e[2],b=s[0],y=s[1],w=s[2],M=h-n[0],T=m-n[1],E=p-n[2],P=M*M+T*T+E*E;P>0&&(M*=P=1/Math.sqrt(P),T*=P,E*=P);var R=y*E-w*T,F=w*M-b*E,N=b*T-y*M;return(P=R*R+F*F+N*N)>0&&(R*=P=1/Math.sqrt(P),F*=P,N*=P),i[0]=R,i[1]=F,i[2]=N,i[3]=0,i[4]=T*N-E*F,i[5]=E*R-M*N,i[6]=M*F-T*R,i[7]=0,i[8]=M,i[9]=T,i[10]=E,i[11]=0,i[12]=h,i[13]=m,i[14]=p,i[15]=1,i},Gt.str=function(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"},Gt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])},Gt.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i[6]=e[6]+n[6],i[7]=e[7]+n[7],i[8]=e[8]+n[8],i[9]=e[9]+n[9],i[10]=e[10]+n[10],i[11]=e[11]+n[11],i[12]=e[12]+n[12],i[13]=e[13]+n[13],i[14]=e[14]+n[14],i[15]=e[15]+n[15],i},Gt.subtract=Yd,Gt.multiplyScalar=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*n,i[9]=e[9]*n,i[10]=e[10]*n,i[11]=e[11]*n,i[12]=e[12]*n,i[13]=e[13]*n,i[14]=e[14]*n,i[15]=e[15]*n,i},Gt.multiplyScalarAndAdd=function(i,e,n,s){return i[0]=e[0]+n[0]*s,i[1]=e[1]+n[1]*s,i[2]=e[2]+n[2]*s,i[3]=e[3]+n[3]*s,i[4]=e[4]+n[4]*s,i[5]=e[5]+n[5]*s,i[6]=e[6]+n[6]*s,i[7]=e[7]+n[7]*s,i[8]=e[8]+n[8]*s,i[9]=e[9]+n[9]*s,i[10]=e[10]+n[10]*s,i[11]=e[11]+n[11]*s,i[12]=e[12]+n[12]*s,i[13]=e[13]+n[13]*s,i[14]=e[14]+n[14]*s,i[15]=e[15]+n[15]*s,i},Gt.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},Gt.equals=function(i,e){var n=i[0],s=i[1],h=i[2],m=i[3],p=i[4],b=i[5],y=i[6],w=i[7],M=i[8],T=i[9],E=i[10],P=i[11],R=i[12],F=i[13],N=i[14],H=i[15],J=e[0],ee=e[1],te=e[2],pe=e[3],he=e[4],ve=e[5],Ce=e[6],Ae=e[7],Ue=e[8],ze=e[9],Ye=e[10],rt=e[11],qe=e[12],et=e[13],We=e[14],tt=e[15];return Math.abs(n-J)<=En.EPSILON*Math.max(1,Math.abs(n),Math.abs(J))&&Math.abs(s-ee)<=En.EPSILON*Math.max(1,Math.abs(s),Math.abs(ee))&&Math.abs(h-te)<=En.EPSILON*Math.max(1,Math.abs(h),Math.abs(te))&&Math.abs(m-pe)<=En.EPSILON*Math.max(1,Math.abs(m),Math.abs(pe))&&Math.abs(p-he)<=En.EPSILON*Math.max(1,Math.abs(p),Math.abs(he))&&Math.abs(b-ve)<=En.EPSILON*Math.max(1,Math.abs(b),Math.abs(ve))&&Math.abs(y-Ce)<=En.EPSILON*Math.max(1,Math.abs(y),Math.abs(Ce))&&Math.abs(w-Ae)<=En.EPSILON*Math.max(1,Math.abs(w),Math.abs(Ae))&&Math.abs(M-Ue)<=En.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ue))&&Math.abs(T-ze)<=En.EPSILON*Math.max(1,Math.abs(T),Math.abs(ze))&&Math.abs(E-Ye)<=En.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ye))&&Math.abs(P-rt)<=En.EPSILON*Math.max(1,Math.abs(P),Math.abs(rt))&&Math.abs(R-qe)<=En.EPSILON*Math.max(1,Math.abs(R),Math.abs(qe))&&Math.abs(F-et)<=En.EPSILON*Math.max(1,Math.abs(F),Math.abs(et))&&Math.abs(N-We)<=En.EPSILON*Math.max(1,Math.abs(N),Math.abs(We))&&Math.abs(H-tt)<=En.EPSILON*Math.max(1,Math.abs(H),Math.abs(tt))},Gt.sub=Gt.mul=Gt.ortho=Gt.perspective=void 0;var En=function(i,e){if(i&&i.__esModule)return i;if(i===null||fc(i)!=="object"&&typeof i!="function")return{default:i};var n=vu(void 0);if(n&&n.has(i))return n.get(i);var s={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=h?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(s,m,p):s[m]=i[m]}return s.default=i,n&&n.set(i,s),s}(ht);function vu(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(vu=function(s){return s?n:e})(i)}function xu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function wu(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=e[9],P=e[10],R=e[11],F=e[12],N=e[13],H=e[14],J=e[15],ee=n[0],te=n[1],pe=n[2],he=n[3];return i[0]=ee*s+te*b+pe*T+he*F,i[1]=ee*h+te*y+pe*E+he*N,i[2]=ee*m+te*w+pe*P+he*H,i[3]=ee*p+te*M+pe*R+he*J,i[4]=(ee=n[4])*s+(te=n[5])*b+(pe=n[6])*T+(he=n[7])*F,i[5]=ee*h+te*y+pe*E+he*N,i[6]=ee*m+te*w+pe*P+he*H,i[7]=ee*p+te*M+pe*R+he*J,i[8]=(ee=n[8])*s+(te=n[9])*b+(pe=n[10])*T+(he=n[11])*F,i[9]=ee*h+te*y+pe*E+he*N,i[10]=ee*m+te*w+pe*P+he*H,i[11]=ee*p+te*M+pe*R+he*J,i[12]=(ee=n[12])*s+(te=n[13])*b+(pe=n[14])*T+(he=n[15])*F,i[13]=ee*h+te*y+pe*E+he*N,i[14]=ee*m+te*w+pe*P+he*H,i[15]=ee*p+te*M+pe*R+he*J,i}function $d(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=s+s,y=h+h,w=m+m,M=s*b,T=s*y,E=s*w,P=h*y,R=h*w,F=m*w,N=p*b,H=p*y,J=p*w;return i[0]=1-(P+F),i[1]=T+J,i[2]=E-H,i[3]=0,i[4]=T-J,i[5]=1-(M+F),i[6]=R+N,i[7]=0,i[8]=E+H,i[9]=R-N,i[10]=1-(M+P),i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i}function gc(i,e){var n=e[4],s=e[5],h=e[6],m=e[8],p=e[9],b=e[10];return i[0]=Math.hypot(e[0],e[1],e[2]),i[1]=Math.hypot(n,s,h),i[2]=Math.hypot(m,p,b),i}function _a(i,e,n,s,h){var m,p=1/Math.tan(e/2);return i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+s)*(m=1/(s-h)),i[14]=2*h*s*m):(i[10]=-1,i[14]=-2*s),i}function ba(i,e,n,s,h,m,p){var b=1/(e-n),y=1/(s-h),w=1/(m-p);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+n)*b,i[13]=(h+s)*y,i[14]=(p+m)*w,i[15]=1,i}function Yd(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i[4]=e[4]-n[4],i[5]=e[5]-n[5],i[6]=e[6]-n[6],i[7]=e[7]-n[7],i[8]=e[8]-n[8],i[9]=e[9]-n[9],i[10]=e[10]-n[10],i[11]=e[11]-n[11],i[12]=e[12]-n[12],i[13]=e[13]-n[13],i[14]=e[14]-n[14],i[15]=e[15]-n[15],i}Gt.perspective=_a,Gt.ortho=ba,Gt.mul=wu,Gt.sub=Yd;var Qt={},Jt={};function _c(i){return _c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_c(i)}Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.create=bc,Jt.clone=function(i){var e=new So.ARRAY_TYPE(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},Jt.length=yc,Jt.fromValues=function(i,e,n){var s=new So.ARRAY_TYPE(3);return s[0]=i,s[1]=e,s[2]=n,s},Jt.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i},Jt.set=function(i,e,n,s){return i[0]=e,i[1]=n,i[2]=s,i},Jt.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i},Jt.subtract=Zd,Jt.multiply=Vs,Jt.divide=vl,Jt.ceil=function(i,e){return i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i[2]=Math.ceil(e[2]),i},Jt.floor=function(i,e){return i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i[2]=Math.floor(e[2]),i},Jt.min=function(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i},Jt.max=function(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i},Jt.round=function(i,e){return i[0]=Math.round(e[0]),i[1]=Math.round(e[1]),i[2]=Math.round(e[2]),i},Jt.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i},Jt.scaleAndAdd=function(i,e,n,s){return i[0]=e[0]+n[0]*s,i[1]=e[1]+n[1]*s,i[2]=e[2]+n[2]*s,i},Jt.distance=vc,Jt.squaredDistance=Xd,Jt.squaredLength=xc,Jt.negate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i},Jt.inverse=function(i,e){return i[0]=1/e[0],i[1]=1/e[1],i[2]=1/e[2],i},Jt.normalize=function(i,e){var n=e[0],s=e[1],h=e[2],m=n*n+s*s+h*h;return m>0&&(m=1/Math.sqrt(m)),i[0]=e[0]*m,i[1]=e[1]*m,i[2]=e[2]*m,i},Jt.dot=wc,Jt.cross=function(i,e,n){var s=e[0],h=e[1],m=e[2],p=n[0],b=n[1],y=n[2];return i[0]=h*y-m*b,i[1]=m*p-s*y,i[2]=s*b-h*p,i},Jt.lerp=function(i,e,n,s){var h=e[0],m=e[1],p=e[2];return i[0]=h+s*(n[0]-h),i[1]=m+s*(n[1]-m),i[2]=p+s*(n[2]-p),i},Jt.hermite=function(i,e,n,s,h,m){var p=m*m,b=p*(2*m-3)+1,y=p*(m-2)+m,w=p*(m-1),M=p*(3-2*m);return i[0]=e[0]*b+n[0]*y+s[0]*w+h[0]*M,i[1]=e[1]*b+n[1]*y+s[1]*w+h[1]*M,i[2]=e[2]*b+n[2]*y+s[2]*w+h[2]*M,i},Jt.bezier=function(i,e,n,s,h,m){var p=1-m,b=p*p,y=m*m,w=b*p,M=3*m*b,T=3*y*p,E=y*m;return i[0]=e[0]*w+n[0]*M+s[0]*T+h[0]*E,i[1]=e[1]*w+n[1]*M+s[1]*T+h[1]*E,i[2]=e[2]*w+n[2]*M+s[2]*T+h[2]*E,i},Jt.random=function(i,e){e=e||1;var n=2*So.RANDOM()*Math.PI,s=2*So.RANDOM()-1,h=Math.sqrt(1-s*s)*e;return i[0]=Math.cos(n)*h,i[1]=Math.sin(n)*h,i[2]=s*e,i},Jt.transformMat4=function(i,e,n){var s=e[0],h=e[1],m=e[2],p=n[3]*s+n[7]*h+n[11]*m+n[15];return i[0]=(n[0]*s+n[4]*h+n[8]*m+n[12])/(p=p||1),i[1]=(n[1]*s+n[5]*h+n[9]*m+n[13])/p,i[2]=(n[2]*s+n[6]*h+n[10]*m+n[14])/p,i},Jt.transformMat3=function(i,e,n){var s=e[0],h=e[1],m=e[2];return i[0]=s*n[0]+h*n[3]+m*n[6],i[1]=s*n[1]+h*n[4]+m*n[7],i[2]=s*n[2]+h*n[5]+m*n[8],i},Jt.transformQuat=function(i,e,n){var s=n[0],h=n[1],m=n[2],p=e[0],b=e[1],y=e[2],w=h*y-m*b,M=m*p-s*y,T=s*b-h*p,E=h*T-m*M,P=m*w-s*T,R=s*M-h*w,F=2*n[3];return M*=F,T*=F,P*=2,R*=2,i[0]=p+(w*=F)+(E*=2),i[1]=b+M+P,i[2]=y+T+R,i},Jt.rotateX=function(i,e,n,s){var h=[],m=[];return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],m[0]=h[0],m[1]=h[1]*Math.cos(s)-h[2]*Math.sin(s),m[2]=h[1]*Math.sin(s)+h[2]*Math.cos(s),i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},Jt.rotateY=function(i,e,n,s){var h=[],m=[];return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],m[0]=h[2]*Math.sin(s)+h[0]*Math.cos(s),m[1]=h[1],m[2]=h[2]*Math.cos(s)-h[0]*Math.sin(s),i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},Jt.rotateZ=function(i,e,n,s){var h=[],m=[];return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],m[0]=h[0]*Math.cos(s)-h[1]*Math.sin(s),m[1]=h[0]*Math.sin(s)+h[1]*Math.cos(s),m[2]=h[2],i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},Jt.angle=function(i,e){var n=i[0],s=i[1],h=i[2],m=e[0],p=e[1],b=e[2],y=Math.sqrt(n*n+s*s+h*h)*Math.sqrt(m*m+p*p+b*b),w=y&&wc(i,e)/y;return Math.acos(Math.min(Math.max(w,-1),1))},Jt.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i},Jt.str=function(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"},Jt.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},Jt.equals=function(i,e){var n=i[0],s=i[1],h=i[2],m=e[0],p=e[1],b=e[2];return Math.abs(n-m)<=So.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-p)<=So.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(h-b)<=So.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))},Jt.forEach=Jt.sqrLen=Jt.len=Jt.sqrDist=Jt.dist=Jt.div=Jt.mul=Jt.sub=void 0;var So=function(i,e){if(i&&i.__esModule)return i;if(i===null||_c(i)!=="object"&&typeof i!="function")return{default:i};var n=yl(void 0);if(n&&n.has(i))return n.get(i);var s={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=h?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(s,m,p):s[m]=i[m]}return s.default=i,n&&n.set(i,s),s}(ht);function yl(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(yl=function(s){return s?n:e})(i)}function bc(){var i=new So.ARRAY_TYPE(3);return So.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function yc(i){return Math.hypot(i[0],i[1],i[2])}function Zd(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i}function Vs(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i}function vl(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i}function vc(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])}function Xd(i,e){var n=e[0]-i[0],s=e[1]-i[1],h=e[2]-i[2];return n*n+s*s+h*h}function xc(i){var e=i[0],n=i[1],s=i[2];return e*e+n*n+s*s}function wc(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}Jt.sub=Zd,Jt.mul=Vs,Jt.div=vl,Jt.dist=vc,Jt.sqrDist=Xd,Jt.len=yc,Jt.sqrLen=xc;var qo,Cu=(qo=bc(),function(i,e,n,s,h,m){var p,b;for(e||(e=3),n||(n=0),b=s?Math.min(s*e+n,i.length):i.length,p=n;p<b;p+=e)qo[0]=i[p],qo[1]=i[p+1],qo[2]=i[p+2],h(qo,qo,m),i[p]=qo[0],i[p+1]=qo[1],i[p+2]=qo[2];return i});Jt.forEach=Cu;var ei={};function Qd(i){return Qd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qd(i)}Object.defineProperty(ei,"__esModule",{value:!0}),ei.create=xl,ei.clone=function(i){var e=new Zn.ARRAY_TYPE(4);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e},ei.fromValues=function(i,e,n,s){var h=new Zn.ARRAY_TYPE(4);return h[0]=i,h[1]=e,h[2]=n,h[3]=s,h},ei.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},ei.set=function(i,e,n,s,h){return i[0]=e,i[1]=n,i[2]=s,i[3]=h,i},ei.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i},ei.subtract=za,ei.multiply=Ba,ei.divide=Kd,ei.ceil=function(i,e){return i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i[2]=Math.ceil(e[2]),i[3]=Math.ceil(e[3]),i},ei.floor=function(i,e){return i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i[2]=Math.floor(e[2]),i[3]=Math.floor(e[3]),i},ei.min=function(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i[3]=Math.min(e[3],n[3]),i},ei.max=function(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i[3]=Math.max(e[3],n[3]),i},ei.round=function(i,e){return i[0]=Math.round(e[0]),i[1]=Math.round(e[1]),i[2]=Math.round(e[2]),i[3]=Math.round(e[3]),i},ei.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},ei.scaleAndAdd=function(i,e,n,s){return i[0]=e[0]+n[0]*s,i[1]=e[1]+n[1]*s,i[2]=e[2]+n[2]*s,i[3]=e[3]+n[3]*s,i},ei.distance=js,ei.squaredDistance=Us,ei.length=Sc,ei.squaredLength=Mc,ei.negate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=-e[3],i},ei.inverse=function(i,e){return i[0]=1/e[0],i[1]=1/e[1],i[2]=1/e[2],i[3]=1/e[3],i},ei.normalize=function(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=n*n+s*s+h*h+m*m;return p>0&&(p=1/Math.sqrt(p)),i[0]=n*p,i[1]=s*p,i[2]=h*p,i[3]=m*p,i},ei.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},ei.cross=function(i,e,n,s){var h=n[0]*s[1]-n[1]*s[0],m=n[0]*s[2]-n[2]*s[0],p=n[0]*s[3]-n[3]*s[0],b=n[1]*s[2]-n[2]*s[1],y=n[1]*s[3]-n[3]*s[1],w=n[2]*s[3]-n[3]*s[2],M=e[0],T=e[1],E=e[2],P=e[3];return i[0]=T*w-E*y+P*b,i[1]=-M*w+E*p-P*m,i[2]=M*y-T*p+P*h,i[3]=-M*b+T*m-E*h,i},ei.lerp=function(i,e,n,s){var h=e[0],m=e[1],p=e[2],b=e[3];return i[0]=h+s*(n[0]-h),i[1]=m+s*(n[1]-m),i[2]=p+s*(n[2]-p),i[3]=b+s*(n[3]-b),i},ei.random=function(i,e){var n,s,h,m,p,b;e=e||1;do p=(n=2*Zn.RANDOM()-1)*n+(s=2*Zn.RANDOM()-1)*s;while(p>=1);do b=(h=2*Zn.RANDOM()-1)*h+(m=2*Zn.RANDOM()-1)*m;while(b>=1);var y=Math.sqrt((1-p)/b);return i[0]=e*n,i[1]=e*s,i[2]=e*h*y,i[3]=e*m*y,i},ei.transformMat4=function(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3];return i[0]=n[0]*s+n[4]*h+n[8]*m+n[12]*p,i[1]=n[1]*s+n[5]*h+n[9]*m+n[13]*p,i[2]=n[2]*s+n[6]*h+n[10]*m+n[14]*p,i[3]=n[3]*s+n[7]*h+n[11]*m+n[15]*p,i},ei.transformQuat=function(i,e,n){var s=e[0],h=e[1],m=e[2],p=n[0],b=n[1],y=n[2],w=n[3],M=w*s+b*m-y*h,T=w*h+y*s-p*m,E=w*m+p*h-b*s,P=-p*s-b*h-y*m;return i[0]=M*w+P*-p+T*-y-E*-b,i[1]=T*w+P*-b+E*-p-M*-y,i[2]=E*w+P*-y+M*-b-T*-p,i[3]=e[3],i},ei.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i},ei.str=function(i){return"vec4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},ei.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},ei.equals=function(i,e){var n=i[0],s=i[1],h=i[2],m=i[3],p=e[0],b=e[1],y=e[2],w=e[3];return Math.abs(n-p)<=Zn.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-b)<=Zn.EPSILON*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(h-y)<=Zn.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(m-w)<=Zn.EPSILON*Math.max(1,Math.abs(m),Math.abs(w))},ei.forEach=ei.sqrLen=ei.len=ei.sqrDist=ei.dist=ei.div=ei.mul=ei.sub=void 0;var Zn=function(i,e){if(i&&i.__esModule)return i;if(i===null||Qd(i)!=="object"&&typeof i!="function")return{default:i};var n=Cc(void 0);if(n&&n.has(i))return n.get(i);var s={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=h?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(s,m,p):s[m]=i[m]}return s.default=i,n&&n.set(i,s),s}(ht);function Cc(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Cc=function(s){return s?n:e})(i)}function xl(){var i=new Zn.ARRAY_TYPE(4);return Zn.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function za(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i}function Ba(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i}function Kd(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i[3]=e[3]/n[3],i}function js(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2],e[3]-i[3])}function Us(i,e){var n=e[0]-i[0],s=e[1]-i[1],h=e[2]-i[2],m=e[3]-i[3];return n*n+s*s+h*h+m*m}function Sc(i){return Math.hypot(i[0],i[1],i[2],i[3])}function Mc(i){var e=i[0],n=i[1],s=i[2],h=i[3];return e*e+n*n+s*s+h*h}ei.sub=za,ei.mul=Ba,ei.div=Kd,ei.dist=js,ei.sqrDist=Us,ei.len=Sc,ei.sqrLen=Mc;var Su=function(){var i=xl();return function(e,n,s,h,m,p){var b,y;for(n||(n=4),s||(s=0),y=h?Math.min(h*n+s,e.length):e.length,b=s;b<y;b+=n)i[0]=e[b],i[1]=e[b+1],i[2]=e[b+2],i[3]=e[b+3],m(i,i,p),e[b]=i[0],e[b+1]=i[1],e[b+2]=i[2],e[b+3]=i[3];return e}}();function kc(i){return kc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kc(i)}ei.forEach=Su,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.create=Ic,Qt.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i},Qt.setAxisAngle=Jd,Qt.getAxisAngle=function(i,e){var n=2*Math.acos(e[3]),s=Math.sin(n/2);return s>$o.EPSILON?(i[0]=e[0]/s,i[1]=e[1]/s,i[2]=e[2]/s):(i[0]=1,i[1]=0,i[2]=0),n},Qt.getAngle=function(i,e){var n=ye(i,e);return Math.acos(2*n*n-1)},Qt.multiply=Tc,Qt.rotateX=function(i,e,n){n*=.5;var s=e[0],h=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return i[0]=s*y+p*b,i[1]=h*y+m*b,i[2]=m*y-h*b,i[3]=p*y-s*b,i},Qt.rotateY=function(i,e,n){n*=.5;var s=e[0],h=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return i[0]=s*y-m*b,i[1]=h*y+p*b,i[2]=m*y+s*b,i[3]=p*y-h*b,i},Qt.rotateZ=function(i,e,n){n*=.5;var s=e[0],h=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return i[0]=s*y+h*b,i[1]=h*y-s*b,i[2]=m*y+p*b,i[3]=p*y-m*b,i},Qt.calculateW=function(i,e){var n=e[0],s=e[1],h=e[2];return i[0]=n,i[1]=s,i[2]=h,i[3]=Math.sqrt(Math.abs(1-n*n-s*s-h*h)),i},Qt.exp=Se,Qt.ln=G,Qt.pow=function(i,e,n){return G(i,e),be(i,i,n),Se(i,i),i},Qt.slerp=K,Qt.random=function(i){var e=$o.RANDOM(),n=$o.RANDOM(),s=$o.RANDOM(),h=Math.sqrt(1-e),m=Math.sqrt(e);return i[0]=h*Math.sin(2*Math.PI*n),i[1]=h*Math.cos(2*Math.PI*n),i[2]=m*Math.sin(2*Math.PI*s),i[3]=m*Math.cos(2*Math.PI*s),i},Qt.invert=function(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=n*n+s*s+h*h+m*m,b=p?1/p:0;return i[0]=-n*b,i[1]=-s*b,i[2]=-h*b,i[3]=m*b,i},Qt.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},Qt.fromMat3=ce,Qt.fromEuler=function(i,e,n,s){var h=.5*Math.PI/180;e*=h,n*=h,s*=h;var m=Math.sin(e),p=Math.cos(e),b=Math.sin(n),y=Math.cos(n),w=Math.sin(s),M=Math.cos(s);return i[0]=m*y*M-p*b*w,i[1]=p*b*M+m*y*w,i[2]=p*y*w-m*b*M,i[3]=p*y*M+m*b*w,i},Qt.str=function(i){return"quat("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},Qt.setAxes=Qt.sqlerp=Qt.rotationTo=Qt.equals=Qt.exactEquals=Qt.normalize=Qt.sqrLen=Qt.squaredLength=Qt.len=Qt.length=Qt.lerp=Qt.dot=Qt.scale=Qt.mul=Qt.add=Qt.set=Qt.copy=Qt.fromValues=Qt.clone=void 0;var $o=wl(ht),Ws=wl(Ei),Yo=wl(Jt),Vr=wl(ei);function Mu(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Mu=function(s){return s?n:e})(i)}function wl(i,e){if(i&&i.__esModule)return i;if(i===null||kc(i)!=="object"&&typeof i!="function")return{default:i};var n=Mu(e);if(n&&n.has(i))return n.get(i);var s={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=h?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(s,m,p):s[m]=i[m]}return s.default=i,n&&n.set(i,s),s}function Ic(){var i=new $o.ARRAY_TYPE(4);return $o.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Jd(i,e,n){n*=.5;var s=Math.sin(n);return i[0]=s*e[0],i[1]=s*e[1],i[2]=s*e[2],i[3]=Math.cos(n),i}function Tc(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=n[0],y=n[1],w=n[2],M=n[3];return i[0]=s*M+p*b+h*w-m*y,i[1]=h*M+p*y+m*b-s*w,i[2]=m*M+p*w+s*y-h*b,i[3]=p*M-s*b-h*y-m*w,i}function Se(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=Math.sqrt(n*n+s*s+h*h),b=Math.exp(m),y=p>0?b*Math.sin(p)/p:0;return i[0]=n*y,i[1]=s*y,i[2]=h*y,i[3]=b*Math.cos(p),i}function G(i,e){var n=e[0],s=e[1],h=e[2],m=e[3],p=Math.sqrt(n*n+s*s+h*h),b=p>0?Math.atan2(p,m)/p:0;return i[0]=n*b,i[1]=s*b,i[2]=h*b,i[3]=.5*Math.log(n*n+s*s+h*h+m*m),i}function K(i,e,n,s){var h,m,p,b,y,w=e[0],M=e[1],T=e[2],E=e[3],P=n[0],R=n[1],F=n[2],N=n[3];return(m=w*P+M*R+T*F+E*N)<0&&(m=-m,P=-P,R=-R,F=-F,N=-N),1-m>$o.EPSILON?(h=Math.acos(m),p=Math.sin(h),b=Math.sin((1-s)*h)/p,y=Math.sin(s*h)/p):(b=1-s,y=s),i[0]=b*w+y*P,i[1]=b*M+y*R,i[2]=b*T+y*F,i[3]=b*E+y*N,i}function ce(i,e){var n,s=e[0]+e[4]+e[8];if(s>0)n=Math.sqrt(s+1),i[3]=.5*n,i[0]=(e[5]-e[7])*(n=.5/n),i[1]=(e[6]-e[2])*n,i[2]=(e[1]-e[3])*n;else{var h=0;e[4]>e[0]&&(h=1),e[8]>e[3*h+h]&&(h=2);var m=(h+1)%3,p=(h+2)%3;n=Math.sqrt(e[3*h+h]-e[3*m+m]-e[3*p+p]+1),i[h]=.5*n,i[3]=(e[3*m+p]-e[3*p+m])*(n=.5/n),i[m]=(e[3*m+h]+e[3*h+m])*n,i[p]=(e[3*p+h]+e[3*h+p])*n}return i}Qt.clone=Vr.clone,Qt.fromValues=Vr.fromValues,Qt.copy=Vr.copy,Qt.set=Vr.set,Qt.add=Vr.add,Qt.mul=Tc;var be=Vr.scale;Qt.scale=be;var ye=Vr.dot;Qt.dot=ye,Qt.lerp=Vr.lerp;var De=Vr.length;Qt.length=De,Qt.len=De;var Ne=Vr.squaredLength;Qt.squaredLength=Ne,Qt.sqrLen=Ne;var Te=Vr.normalize;Qt.normalize=Te,Qt.exactEquals=Vr.exactEquals,Qt.equals=Vr.equals;var je,mt,st,Rt=(je=Yo.create(),mt=Yo.fromValues(1,0,0),st=Yo.fromValues(0,1,0),function(i,e,n){var s=Yo.dot(e,n);return s<-.999999?(Yo.cross(je,mt,e),Yo.len(je)<1e-6&&Yo.cross(je,st,e),Yo.normalize(je,je),Jd(i,je,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Yo.cross(je,e,n),i[0]=je[0],i[1]=je[1],i[2]=je[2],i[3]=1+s,Te(i,i))});Qt.rotationTo=Rt;var $t,fi,vi=($t=Ic(),fi=Ic(),function(i,e,n,s,h,m){return K($t,e,h,m),K(fi,n,s,m),K(i,$t,fi,2*m*(1-m)),i});Qt.sqlerp=vi;var oi,Di=(oi=Ws.create(),function(i,e,n,s){return oi[0]=n[0],oi[3]=n[1],oi[6]=n[2],oi[1]=s[0],oi[4]=s[1],oi[7]=s[2],oi[2]=-e[0],oi[5]=-e[1],oi[8]=-e[2],Te(i,ce(i,oi))});Qt.setAxes=Di;var At={};function Dn(i){return Dn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dn(i)}Object.defineProperty(At,"__esModule",{value:!0}),At.create=function(){var i=new en.ARRAY_TYPE(8);return en.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0),i[3]=1,i},At.clone=function(i){var e=new en.ARRAY_TYPE(8);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e},At.fromValues=function(i,e,n,s,h,m,p,b){var y=new en.ARRAY_TYPE(8);return y[0]=i,y[1]=e,y[2]=n,y[3]=s,y[4]=h,y[5]=m,y[6]=p,y[7]=b,y},At.fromRotationTranslationValues=function(i,e,n,s,h,m,p){var b=new en.ARRAY_TYPE(8);b[0]=i,b[1]=e,b[2]=n,b[3]=s;var y=.5*h,w=.5*m,M=.5*p;return b[4]=y*s+w*n-M*e,b[5]=w*s+M*i-y*n,b[6]=M*s+y*e-w*i,b[7]=-y*i-w*e-M*n,b},At.fromRotationTranslation=Xr,At.fromTranslation=function(i,e){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=.5*e[0],i[5]=.5*e[1],i[6]=.5*e[2],i[7]=0,i},At.fromRotation=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},At.fromMat4=function(i,e){var n=Ri.create();ar.getRotation(n,e);var s=new en.ARRAY_TYPE(3);return ar.getTranslation(s,e),Xr(i,n,s),i},At.copy=Qr,At.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},At.set=function(i,e,n,s,h,m,p,b,y){return i[0]=e,i[1]=n,i[2]=s,i[3]=h,i[4]=m,i[5]=p,i[6]=b,i[7]=y,i},At.getDual=function(i,e){return i[0]=e[4],i[1]=e[5],i[2]=e[6],i[3]=e[7],i},At.setDual=function(i,e){return i[4]=e[0],i[5]=e[1],i[6]=e[2],i[7]=e[3],i},At.getTranslation=function(i,e){var n=e[4],s=e[5],h=e[6],m=e[7],p=-e[0],b=-e[1],y=-e[2],w=e[3];return i[0]=2*(n*w+m*p+s*y-h*b),i[1]=2*(s*w+m*b+h*p-n*y),i[2]=2*(h*w+m*y+n*b-s*p),i},At.translate=function(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=.5*n[0],y=.5*n[1],w=.5*n[2],M=e[4],T=e[5],E=e[6],P=e[7];return i[0]=s,i[1]=h,i[2]=m,i[3]=p,i[4]=p*b+h*w-m*y+M,i[5]=p*y+m*b-s*w+T,i[6]=p*w+s*y-h*b+E,i[7]=-s*b-h*y-m*w+P,i},At.rotateX=function(i,e,n){var s=-e[0],h=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=b*p+M*s+y*m-w*h,E=y*p+M*h+w*s-b*m,P=w*p+M*m+b*h-y*s,R=M*p-b*s-y*h-w*m;return Ri.rotateX(i,e,n),i[4]=T*(p=i[3])+R*(s=i[0])+E*(m=i[2])-P*(h=i[1]),i[5]=E*p+R*h+P*s-T*m,i[6]=P*p+R*m+T*h-E*s,i[7]=R*p-T*s-E*h-P*m,i},At.rotateY=function(i,e,n){var s=-e[0],h=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=b*p+M*s+y*m-w*h,E=y*p+M*h+w*s-b*m,P=w*p+M*m+b*h-y*s,R=M*p-b*s-y*h-w*m;return Ri.rotateY(i,e,n),i[4]=T*(p=i[3])+R*(s=i[0])+E*(m=i[2])-P*(h=i[1]),i[5]=E*p+R*h+P*s-T*m,i[6]=P*p+R*m+T*h-E*s,i[7]=R*p-T*s-E*h-P*m,i},At.rotateZ=function(i,e,n){var s=-e[0],h=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=b*p+M*s+y*m-w*h,E=y*p+M*h+w*s-b*m,P=w*p+M*m+b*h-y*s,R=M*p-b*s-y*h-w*m;return Ri.rotateZ(i,e,n),i[4]=T*(p=i[3])+R*(s=i[0])+E*(m=i[2])-P*(h=i[1]),i[5]=E*p+R*h+P*s-T*m,i[6]=P*p+R*m+T*h-E*s,i[7]=R*p-T*s-E*h-P*m,i},At.rotateByQuatAppend=function(i,e,n){var s=n[0],h=n[1],m=n[2],p=n[3],b=e[0],y=e[1],w=e[2],M=e[3];return i[0]=b*p+M*s+y*m-w*h,i[1]=y*p+M*h+w*s-b*m,i[2]=w*p+M*m+b*h-y*s,i[3]=M*p-b*s-y*h-w*m,i[4]=(b=e[4])*p+(M=e[7])*s+(y=e[5])*m-(w=e[6])*h,i[5]=y*p+M*h+w*s-b*m,i[6]=w*p+M*m+b*h-y*s,i[7]=M*p-b*s-y*h-w*m,i},At.rotateByQuatPrepend=function(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=n[0],y=n[1],w=n[2],M=n[3];return i[0]=s*M+p*b+h*w-m*y,i[1]=h*M+p*y+m*b-s*w,i[2]=m*M+p*w+s*y-h*b,i[3]=p*M-s*b-h*y-m*w,i[4]=s*(M=n[7])+p*(b=n[4])+h*(w=n[6])-m*(y=n[5]),i[5]=h*M+p*y+m*b-s*w,i[6]=m*M+p*w+s*y-h*b,i[7]=p*M-s*b-h*y-m*w,i},At.rotateAroundAxis=function(i,e,n,s){if(Math.abs(s)<en.EPSILON)return Qr(i,e);var h=Math.hypot(n[0],n[1],n[2]);s*=.5;var m=Math.sin(s),p=m*n[0]/h,b=m*n[1]/h,y=m*n[2]/h,w=Math.cos(s),M=e[0],T=e[1],E=e[2],P=e[3];i[0]=M*w+P*p+T*y-E*b,i[1]=T*w+P*b+E*p-M*y,i[2]=E*w+P*y+M*b-T*p,i[3]=P*w-M*p-T*b-E*y;var R=e[4],F=e[5],N=e[6],H=e[7];return i[4]=R*w+H*p+F*y-N*b,i[5]=F*w+H*b+N*p-R*y,i[6]=N*w+H*y+R*b-F*p,i[7]=H*w-R*p-F*b-N*y,i},At.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i[6]=e[6]+n[6],i[7]=e[7]+n[7],i},At.multiply=Cl,At.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i},At.lerp=function(i,e,n,s){var h=1-s;return Ap(e,n)<0&&(s=-s),i[0]=e[0]*h+n[0]*s,i[1]=e[1]*h+n[1]*s,i[2]=e[2]*h+n[2]*s,i[3]=e[3]*h+n[3]*s,i[4]=e[4]*h+n[4]*s,i[5]=e[5]*h+n[5]*s,i[6]=e[6]*h+n[6]*s,i[7]=e[7]*h+n[7]*s,i},At.invert=function(i,e){var n=eh(e);return i[0]=-e[0]/n,i[1]=-e[1]/n,i[2]=-e[2]/n,i[3]=e[3]/n,i[4]=-e[4]/n,i[5]=-e[5]/n,i[6]=-e[6]/n,i[7]=e[7]/n,i},At.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i[4]=-e[4],i[5]=-e[5],i[6]=-e[6],i[7]=e[7],i},At.normalize=function(i,e){var n=eh(e);if(n>0){n=Math.sqrt(n);var s=e[0]/n,h=e[1]/n,m=e[2]/n,p=e[3]/n,b=e[4],y=e[5],w=e[6],M=e[7],T=s*b+h*y+m*w+p*M;i[0]=s,i[1]=h,i[2]=m,i[3]=p,i[4]=(b-s*T)/n,i[5]=(y-h*T)/n,i[6]=(w-m*T)/n,i[7]=(M-p*T)/n}return i},At.str=function(i){return"quat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+")"},At.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]},At.equals=function(i,e){var n=i[0],s=i[1],h=i[2],m=i[3],p=i[4],b=i[5],y=i[6],w=i[7],M=e[0],T=e[1],E=e[2],P=e[3],R=e[4],F=e[5],N=e[6],H=e[7];return Math.abs(n-M)<=en.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(s-T)<=en.EPSILON*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(h-E)<=en.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(m-P)<=en.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(p-R)<=en.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(b-F)<=en.EPSILON*Math.max(1,Math.abs(b),Math.abs(F))&&Math.abs(y-N)<=en.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(w-H)<=en.EPSILON*Math.max(1,Math.abs(w),Math.abs(H))},At.sqrLen=At.squaredLength=At.len=At.length=At.dot=At.mul=At.setReal=At.getReal=void 0;var en=br(ht),Ri=br(Qt),ar=br(Gt);function An(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(An=function(s){return s?n:e})(i)}function br(i,e){if(i&&i.__esModule)return i;if(i===null||Dn(i)!=="object"&&typeof i!="function")return{default:i};var n=An(e);if(n&&n.has(i))return n.get(i);var s={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=h?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(s,m,p):s[m]=i[m]}return s.default=i,n&&n.set(i,s),s}function Xr(i,e,n){var s=.5*n[0],h=.5*n[1],m=.5*n[2],p=e[0],b=e[1],y=e[2],w=e[3];return i[0]=p,i[1]=b,i[2]=y,i[3]=w,i[4]=s*w+h*y-m*b,i[5]=h*w+m*p-s*y,i[6]=m*w+s*b-h*p,i[7]=-s*p-h*b-m*y,i}function Qr(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i}function Cl(i,e,n){var s=e[0],h=e[1],m=e[2],p=e[3],b=n[4],y=n[5],w=n[6],M=n[7],T=e[4],E=e[5],P=e[6],R=e[7],F=n[0],N=n[1],H=n[2],J=n[3];return i[0]=s*J+p*F+h*H-m*N,i[1]=h*J+p*N+m*F-s*H,i[2]=m*J+p*H+s*N-h*F,i[3]=p*J-s*F-h*N-m*H,i[4]=s*M+p*b+h*w-m*y+T*J+R*F+E*H-P*N,i[5]=h*M+p*y+m*b-s*w+E*J+R*N+P*F-T*H,i[6]=m*M+p*w+s*y-h*b+P*J+R*H+T*N-E*F,i[7]=p*M-s*b-h*y-m*w+R*J-T*F-E*N-P*H,i}At.getReal=Ri.copy,At.setReal=Ri.copy,At.mul=Cl;var Ap=Ri.dot;At.dot=Ap;var b_=Ri.length;At.length=b_,At.len=b_;var eh=Ri.squaredLength;At.squaredLength=eh,At.sqrLen=eh;var hi={};function Pp(i){return Pp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pp(i)}Object.defineProperty(hi,"__esModule",{value:!0}),hi.create=Rp,hi.clone=function(i){var e=new Hs.ARRAY_TYPE(2);return e[0]=i[0],e[1]=i[1],e},hi.fromValues=function(i,e){var n=new Hs.ARRAY_TYPE(2);return n[0]=i,n[1]=e,n},hi.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i},hi.set=function(i,e,n){return i[0]=e,i[1]=n,i},hi.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i},hi.subtract=Lp,hi.multiply=Fp,hi.divide=zp,hi.ceil=function(i,e){return i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i},hi.floor=function(i,e){return i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i},hi.min=function(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i},hi.max=function(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i},hi.round=function(i,e){return i[0]=Math.round(e[0]),i[1]=Math.round(e[1]),i},hi.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i},hi.scaleAndAdd=function(i,e,n,s){return i[0]=e[0]+n[0]*s,i[1]=e[1]+n[1]*s,i},hi.distance=Bp,hi.squaredDistance=Np,hi.length=Vp,hi.squaredLength=jp,hi.negate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i},hi.inverse=function(i,e){return i[0]=1/e[0],i[1]=1/e[1],i},hi.normalize=function(i,e){var n=e[0],s=e[1],h=n*n+s*s;return h>0&&(h=1/Math.sqrt(h)),i[0]=e[0]*h,i[1]=e[1]*h,i},hi.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]},hi.cross=function(i,e,n){var s=e[0]*n[1]-e[1]*n[0];return i[0]=i[1]=0,i[2]=s,i},hi.lerp=function(i,e,n,s){var h=e[0],m=e[1];return i[0]=h+s*(n[0]-h),i[1]=m+s*(n[1]-m),i},hi.random=function(i,e){e=e||1;var n=2*Hs.RANDOM()*Math.PI;return i[0]=Math.cos(n)*e,i[1]=Math.sin(n)*e,i},hi.transformMat2=function(i,e,n){var s=e[0],h=e[1];return i[0]=n[0]*s+n[2]*h,i[1]=n[1]*s+n[3]*h,i},hi.transformMat2d=function(i,e,n){var s=e[0],h=e[1];return i[0]=n[0]*s+n[2]*h+n[4],i[1]=n[1]*s+n[3]*h+n[5],i},hi.transformMat3=function(i,e,n){var s=e[0],h=e[1];return i[0]=n[0]*s+n[3]*h+n[6],i[1]=n[1]*s+n[4]*h+n[7],i},hi.transformMat4=function(i,e,n){var s=e[0],h=e[1];return i[0]=n[0]*s+n[4]*h+n[12],i[1]=n[1]*s+n[5]*h+n[13],i},hi.rotate=function(i,e,n,s){var h=e[0]-n[0],m=e[1]-n[1],p=Math.sin(s),b=Math.cos(s);return i[0]=h*b-m*p+n[0],i[1]=h*p+m*b+n[1],i},hi.angle=function(i,e){var n=i[0],s=i[1],h=e[0],m=e[1],p=Math.sqrt(n*n+s*s)*Math.sqrt(h*h+m*m);return Math.acos(Math.min(Math.max(p&&(n*h+s*m)/p,-1),1))},hi.zero=function(i){return i[0]=0,i[1]=0,i},hi.str=function(i){return"vec2("+i[0]+", "+i[1]+")"},hi.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]},hi.equals=function(i,e){var n=i[0],s=i[1],h=e[0],m=e[1];return Math.abs(n-h)<=Hs.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(s-m)<=Hs.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))},hi.forEach=hi.sqrLen=hi.sqrDist=hi.dist=hi.div=hi.mul=hi.sub=hi.len=void 0;var Hs=function(i,e){if(i&&i.__esModule)return i;if(i===null||Pp(i)!=="object"&&typeof i!="function")return{default:i};var n=Op(void 0);if(n&&n.has(i))return n.get(i);var s={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=h?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(s,m,p):s[m]=i[m]}return s.default=i,n&&n.set(i,s),s}(ht);function Op(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Op=function(s){return s?n:e})(i)}function Rp(){var i=new Hs.ARRAY_TYPE(2);return Hs.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0),i}function Lp(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i}function Fp(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i}function zp(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i}function Bp(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1])}function Np(i,e){var n=e[0]-i[0],s=e[1]-i[1];return n*n+s*s}function Vp(i){return Math.hypot(i[0],i[1])}function jp(i){var e=i[0],n=i[1];return e*e+n*n}hi.len=Vp,hi.sub=Lp,hi.mul=Fp,hi.div=zp,hi.dist=Bp,hi.sqrDist=Np,hi.sqrLen=jp;var y_=function(){var i=Rp();return function(e,n,s,h,m,p){var b,y;for(n||(n=2),s||(s=0),y=h?Math.min(h*n+s,e.length):e.length,b=s;b<y;b+=n)i[0]=e[b],i[1]=e[b+1],m(i,i,p),e[b]=i[0],e[b+1]=i[1];return e}}();function Ec(i){return Ec=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ec(i)}hi.forEach=y_,Object.defineProperty(He,"__esModule",{value:!0}),t.aA=He.vec4=t._=He.vec3=He.vec2=He.quat2=t.av=He.quat=t.ad=He.mat4=t.bC=He.mat3=He.mat2d=t.aC=He.mat2=He.glMatrix=void 0;var ku=Na(ht);He.glMatrix=ku;var Iu=Na(Ct);t.aC=He.mat2=Iu;var v_=Na(Ci);He.mat2d=v_;var x_=Na(Ei);t.bC=He.mat3=x_;var w_=Na(Gt);t.ad=He.mat4=w_;var Dc=Na(Qt);t.av=He.quat=Dc;var Mi=Na(At);He.quat2=Mi;var Gv=Na(hi);He.vec2=Gv;var qv=Na(Jt);t._=He.vec3=qv;var $v=Na(ei);function Up(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Up=function(s){return s?n:e})(i)}function Na(i,e){if(i&&i.__esModule)return i;if(i===null||Ec(i)!=="object"&&typeof i!="function")return{default:i};var n=Up(e);if(n&&n.has(i))return n.get(i);var s={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=h?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(s,m,p):s[m]=i[m]}return s.default=i,n&&n.set(i,s),s}t.aA=He.vec4=$v;var Wp=th;function th(i,e,n,s){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=s}th.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,s=0;s<8;s++){var h=this.sampleCurveX(n)-i;if(Math.abs(h)<e)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=h/m}var p=0,b=1;for(n=i,s=0;s<20&&(h=this.sampleCurveX(n),!(Math.abs(h-i)<e));s++)i>h?p=n:b=n,n=.5*(b-p)+p;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var ih=Ge(Wp),Tu=Sl;function Sl(i,e){this.x=i,this.y=e}Sl.prototype={clone:function(){return new Sl(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(i,e){var n=Math.cos(i),s=Math.sin(i),h=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Sl.convert=function(i){return i instanceof Sl?i:Array.isArray(i)?new Sl(i[0],i[1]):i};var wt=Ge(Tu);let C_=Math.PI/180,nh=180/Math.PI;function Ai(i){return i*C_}function Kr(i){return i*nh}let S_=[[0,0],[1,0],[1,1],[0,1]];function Hp(i){if(i<=0)return 0;if(i>=1)return 1;let e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function rh(i,e,n,s){let h=new ih(i,e,n,s);return function(m){return h.solve(m)}}let Ac=rh(.25,.1,.25,1);function gi(i,e,n){return Math.min(n,Math.max(e,i))}function Ml(i,e,n){return(n=gi((n-i)/(e-i),0,1))*n*(3-2*n)}function kl(i,e,n){let s=n-e,h=((i-e)%s+s)%s+e;return h===e?n:h}function Pc(i,e,n){if(!i.length)return n(null,[]);let s=i.length,h=new Array(i.length),m=null;i.forEach((p,b)=>{e(p,(y,w)=>{y&&(m=y),h[b]=w,--s==0&&n(m,h)})})}function Zo(i){let e=[];for(let n in i)e.push(i[n]);return e}function Jr(i,...e){for(let n of e)for(let s in n)i[s]=n[s];return i}let Yv=1;function Eu(){return Yv++}function Du(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Gp(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function qp(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Au(i,e){i.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function oh(i,e){return i.indexOf(e,i.length-e.length)!==-1}function Oc(i,e,n){let s={};for(let h in i)s[h]=e.call(this,i[h],h,i);return s}function Il(i,e,n){let s={};for(let h in i)e.call(this,i[h],h,i)&&(s[h]=i[h]);return s}function Va(i){return Array.isArray(i)?i.map(Va):typeof i=="object"&&i?Oc(i,Va):i}let $p={};function sr(i){$p[i]||(typeof console<"u"&&console.warn(i),$p[i]=!0)}function ja(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function ro(i){let e=0;for(let n,s,h=0,m=i.length,p=m-1;h<m;p=h++)n=i[h],s=i[p],e+=(s.x-n.x)*(n.y+s.y);return e}function cs([i,e,n]){let s=Ai(e+90),h=Ai(n);return{x:i*Math.cos(s)*Math.sin(h),y:i*Math.sin(s)*Math.sin(h),z:i*Math.cos(h),azimuthal:e,polar:n}}function jr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Yp(i){let e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,h,m)=>{let p=h||m;return e[s]=!p||p.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Zp,Pu,Rc,ah,ds,sh,Ou=null;function Tl(i){try{let e=self[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function lh(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}function Xp(i,e,n,s){for(;e<n;){let h=e+n>>1;i[h]<s?e=h+1:n=h}return e}function M_(i,e,n,s){for(;e<n;){let h=e+n>>1;i[h]<=s?e=h+1:n=h}return e}function Ru(i){return i>0?1/(1.001-i):1+i}function Lu(i){return i>0?1-1/(1.001-i):-i}function Lc(){return Zp==null&&(Zp=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Zp}let Ur={now:()=>ah!==void 0?ah:performance.now(),setNow(i){ah=i},restoreNow(){ah=void 0},frame(i){let e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){let{width:n,height:s}=i;ds||(ds=document.createElement("canvas"));let h=ds.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(n>ds.width||s>ds.height)&&(ds.width=n,ds.height=s),h.clearRect(-e,-e,n+2*e,s+2*e),h.drawImage(i,0,0,n,s),h.getImageData(-e,-e,n+2*e,s+2*e)},resolveURL:i=>(Pu||(Pu=document.createElement("a")),Pu.href=i,Pu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Rc==null&&(Rc=window.matchMedia("(prefers-reduced-motion: reduce)")),Rc.matches)},hasCanvasFingerprintNoise(){if(sh!==void 0)return sh;if(!Lc())return sh=!1,!1;let i=new OffscreenCanvas(85,1),e=i.getContext("2d",{willReadFrequently:!0}),n=0;for(let h=0;h<i.width;++h)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(h,0,1,1);let s=e.getImageData(0,0,i.width,i.height);n=0;for(let h=0;h<s.data.length;++h)if(h%4!=3&&n++!==s.data[h])return sh=!0,!0;return sh=!1,!1}};function Fu(i,e){let n=i.indexOf("?");if(n<0)return`${i}?${new URLSearchParams(e).toString()}`;let s=new URLSearchParams(i.slice(n));for(let h in e)s.set(h,e[h]);return`${i.slice(0,n)}?${s.toString()}`}function Qp(i,e={persistentParams:[]}){let n=i.indexOf("?");if(n<0)return i;let s=new URLSearchParams,h=new URLSearchParams(i.slice(n));for(let p of e.persistentParams){let b=h.get(p);b&&s.set(p,b)}let m=s.toString();return`${i.slice(0,n)}${m.length>0?`?${m}`:""}`}let k_="mapbox-tiles",Kp=500,Jp=50,hs,zu;function I_(){try{return caches}catch{}}function ch(){let i=I_();i&&!hs&&(hs=i.open(k_))}let Bu=1/0,Nu={supported:!1,testSupport:function(i){!ef&&zc&&(tf?T_(i):Fc=i)}},Fc,zc,ef=!1,tf=!1,nf=typeof self<"u"?self:{};function T_(i){let e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,zc),i.isContextLost())return;Nu.supported=!0}catch{}i.deleteTexture(e),ef=!0}nf.document&&(zc=nf.document.createElement("img"),zc.onload=function(){Fc&&T_(Fc),Fc=null,tf=!0},zc.onerror=function(){ef=!0,Fc=null},zc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Vu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Vu);class rf extends Error{constructor(e,n,s){n===401&&O(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let ju=jr()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,dh=function(i,e){if(!(/^file:/.test(n=i.url)||/^file:/.test(ju())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,h){let m=new AbortController,p=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:ju(),referrerPolicy:s.referrerPolicy,signal:m.signal}),b=!1,y=!1,w=(M=p.url).indexOf("sku=")>0&&O(M);var M;s.type==="json"&&p.headers.set("Accept","application/json");let T=(P,R,F)=>{if(y)return;if(P&&P.message!=="SecurityError"&&sr(P.toString()),R&&F)return E(R);let N=Date.now();fetch(p).then(H=>{if(H.ok){let J=w?H.clone():null;return E(H,J,N)}return h(new rf(H.statusText,H.status,s.url))}).catch(H=>{H.name!=="AbortError"&&h(new Error(`${H.message} ${s.url}`))})},E=(P,R,F)=>{(s.type==="arrayBuffer"?P.arrayBuffer():s.type==="json"?P.json():P.text()).then(N=>{y||(R&&F&&function(H,J,ee){if(ch(),!hs)return;let te=Yp(J.headers.get("Cache-Control")||"");if(te["no-store"])return;let pe={status:J.status,statusText:J.statusText,headers:new Headers};J.headers.forEach((Ce,Ae)=>pe.headers.set(Ae,Ce)),te["max-age"]&&pe.headers.set("Expires",new Date(ee+1e3*te["max-age"]).toUTCString());let he=pe.headers.get("Expires");if(!he||new Date(he).getTime()-ee<42e4)return;let ve=Qp(H.url,{persistentParams:["language","worldview"]});if(J.status===206){let Ce=H.headers.get("Range");if(!Ce)return;pe.status=200,ve=Fu(ve,{range:Ce})}(function(Ce,Ae){if(zu===void 0)try{new Response(new ReadableStream),zu=!0}catch{zu=!1}zu?Ae(Ce.body):Ce.blob().then(Ae)})(J,Ce=>{let Ae=new Response((Ue=J.status)!==200&&Ue!==404&&[101,103,204,205,304].includes(Ue)?null:Ce,pe);var Ue;ch(),hs&&hs.then(ze=>ze.put(ve,Ae)).catch(ze=>sr(ze.message))})}(p,R,F),b=!0,h(null,N,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(N=>{y||h(new Error(N.message))})};return w?function(P,R){if(ch(),!hs)return R(null);hs.then(F=>{let N=Qp(P.url,{persistentParams:["language","worldview"]}),H=P.headers.get("Range");H&&(N=Fu(N,{range:H})),F.match(N).then(J=>{let ee=function(te){if(!te)return!1;let pe=new Date(te.headers.get("Expires")||0),he=Yp(te.headers.get("Cache-Control")||"");return pe>Date.now()&&!he["no-cache"]}(J);F.delete(N),ee&&F.put(N,J.clone()),R(null,J,ee)}).catch(R)}).catch(R)}(p,T):T(null,null),{cancel:()=>{y=!0,b||m.abort()}}}(i,e);if(jr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(s,h){let m=new XMLHttpRequest;m.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(let p in s.headers)m.setRequestHeader(p,s.headers[p]);return s.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=s.credentials==="include",m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let p=m.response;if(s.type==="json")try{p=JSON.parse(m.response)}catch(b){return h(b)}h(null,p,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else h(new rf(m.statusText,m.status,s.url))},m.send(s.body),{cancel:()=>m.abort()}}(i,e)},El=function(i,e){return dh(Jr(i,{type:"arrayBuffer"}),e)};function E_(i){let e=document.createElement("a");return e.href=i,e.protocol===location.protocol&&e.host===location.host}let of="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",hh,uh;hh=[],uh=0;let Gs=function(i,e){if(Nu.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),uh>=I.MAX_PARALLEL_IMAGE_REQUESTS){let m={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return hh.push(m),m}uh++;let n=!1,s=()=>{if(!n)for(n=!0,uh--;hh.length&&uh<I.MAX_PARALLEL_IMAGE_REQUESTS;){let m=hh.shift(),{requestParameters:p,callback:b,cancelled:y}=m;y||(m.cancel=Gs(p,b).cancel)}},h=El(i,(m,p,b,y)=>{s(),m?e(m):p&&(self.createImageBitmap?function(w,M){let T=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(T).then(E=>{M(null,E)}).catch(E=>{M(new Error(`Could not load image because of ${E.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(w,M)=>e(w,M,b,y)):function(w,M){let T=new Image;T.onload=()=>{M(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=of})},T.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let E=new Blob([new Uint8Array(w)],{type:"image/png"});T.src=w.byteLength?URL.createObjectURL(E):of}(p,(w,M)=>e(w,M,b,y)))});return{cancel:()=>{h.cancel(),s()}}},af="01",sf="NO_ACCESS_TOKEN",Zv=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ya(i){let e=i.match(Zv);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Bc(i){let e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}let Uu="mapbox.eventData";function D_(i){if(!i)return null;let e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class mh{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=D_(I.ACCESS_TOKEN),s="";return s=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(h,m)=>String.fromCharCode(+("0x"+m)))):I.ACCESS_TOKEN||"",e?`${Uu}.${e}:${s}`:`${Uu}:${s}`}fetchEventData(){let e=Tl("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{let h=localStorage.getItem(n);h&&(this.eventData=JSON.parse(h));let m=localStorage.getItem(s);m&&(this.anonId=m)}catch{sr("Unable to read from LocalStorage")}}saveEventData(){let e=Tl("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid"),h=this.anonId;if(e&&h)try{localStorage.setItem(s,h),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{sr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,h){if(!I.EVENTS_URL)return;let m=ya(I.EVENTS_URL);m.params.push(`access_token=${h||I.ACCESS_TOKEN||""}`);let p={event:this.type,created:new Date(e).toISOString()},b=n?Jr(p,n):p,y={url:Bc(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=function(w,M){return dh(Jr(w,{method:"POST"}),M)}(y,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(h)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let A_=new class extends mh{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){I.EVENTS_URL&&I.ACCESS_TOKEN&&Array.isArray(i)&&i.some(n=>z(n)||O(n))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=D_(I.ACCESS_TOKEN),n=e?e.u:I.ACCESS_TOKEN,s=n!==this.eventData.tokenU;qp(this.anonId)||(this.anonId=Du(),s=!0);let h=this.queue.shift();if(this.eventData.lastSuccess){let m=new Date(this.eventData.lastSuccess),p=new Date(h),b=(h-this.eventData.lastSuccess)/864e5;s=s||b>=1||b<-1||m.getDate()!==p.getDate()}else s=!0;s?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:g,skuId:af,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=h,this.eventData.tokenU=n)},i):this.processRequests()}},lf=A_.postTurnstileEvent.bind(A_),ph=new class extends mh{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,n,s){this.skuToken=e,this.errorCb=s,I.EVENTS_URL&&(n||I.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(sf)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),qp(this.anonId)||(this.anonId=Du()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:g,skuId:af,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},i))}remove(){this.errorCb=null}},P_=ph.postMapLoadEvent.bind(ph),O_=new class extends mh{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(i){let e=this.mapInstanceIdMap.get(i);return e||(e=Du(),this.mapInstanceIdMap.set(i,e)),e}getEventId(i){let e=this.eventIdPerMapInstanceMap.get(i)||0;return this.eventIdPerMapInstanceMap.set(i,e+1),e}postStyleLoadEvent(i,e){let{map:n,style:s,importedStyles:h}=e;if(!I.EVENTS_URL||!i&&!I.ACCESS_TOKEN)return;let m=this.getMapInstanceId(n),p={mapInstanceId:m,eventId:this.getEventId(m),style:s};h.length&&(p.importedStyles=h),this.queueRequest({timestamp:Date.now(),payload:p},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},i)}},Xv=O_.postStyleLoadEvent.bind(O_),Wu=new class extends mh{constructor(){super("gljs.performance")}postPerformanceEvent(i,e){I.EVENTS_URL&&(i||I.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),s=function(h){let m=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),b=function(P){let R={};if(P){for(let F in P)if(F!=="other")for(let N of P[F]){let H=`${F}ResolveRangeMin`,J=`${F}ResolveRangeMax`,ee=`${F}RequestCount`,te=`${F}RequestCachedCount`;R[H]=Math.min(R[H]||1/0,N.startTime),R[J]=Math.max(R[J]||-1/0,N.responseEnd);let pe=he=>{R[he]===void 0&&(R[he]=0),++R[he]};N.transferSize!==void 0&&N.transferSize===0&&pe(te),pe(ee)}}return R}(function(P,R){let F={};if(P)for(let N of P){let H=R(N);F[H]===void 0&&(F[H]=[]),F[H].push(N)}return F}(m,Me)),y=window.devicePixelRatio,w=navigator.connection||navigator.mozConnection||navigator.webkitConnection,M=w?w.effectiveType:void 0,T={counters:[],metadata:[],attributes:[]},E=(P,R,F)=>{F!=null&&P.push({name:R,value:F.toString()})};for(let P in b)E(T.counters,P,b[P]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(E(T.counters,"interactionRangeMin",h.interactionRange[0]),E(T.counters,"interactionRangeMax",h.interactionRange[1])),p)for(let P of Object.keys(xe)){let R=xe[P],F=p.find(N=>N.name===R);F&&E(T.counters,R,F.startTime)}return E(T.counters,"visibilityHidden",h.visibilityHidden),E(T.attributes,"style",function(P){if(P)for(let R of P){let F=R.name.split("?")[0];if(de(F)){let N=F.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(m)),E(T.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),E(T.attributes,"fogEnabled",h.fogEnabled?"true":"false"),E(T.attributes,"projection",h.projection),E(T.attributes,"zoom",h.zoom),E(T.metadata,"devicePixelRatio",y),E(T.metadata,"connectionEffectiveType",M),E(T.metadata,"navigatorUserAgent",navigator.userAgent),E(T.metadata,"screenWidth",window.screen.width),E(T.metadata,"screenHeight",window.screen.height),E(T.metadata,"windowWidth",window.innerWidth),E(T.metadata,"windowHeight",window.innerHeight),E(T.metadata,"mapWidth",h.width/y),E(T.metadata,"mapHeight",h.height/y),E(T.metadata,"webglRenderer",h.renderer),E(T.metadata,"webglVendor",h.vendor),E(T.metadata,"sdkVersion",g),E(T.metadata,"sdkIdentifier","mapbox-gl-js"),T}(n);for(let h of s.metadata);for(let h of s.counters);for(let h of s.attributes);this.postEvent(e,s,()=>{},i)}},Qv=Wu.postPerformanceEvent.bind(Wu),Nc=new class extends mh{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,n,s){if(!I.API_URL||!I.SESSION_PATH)return;let h=ya(I.API_URL+I.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${s||I.ACCESS_TOKEN||""}`);let m={url:Bc(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,b){return dh(Jr(p,{method:"GET"}),b)}(m,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(s)})}getSessionAPI(i,e,n,s){this.skuToken=e,this.errorCb=s,I.SESSION_PATH&&I.API_URL&&(n||I.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(sf)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},i)}remove(){this.errorCb=null}},Hu=Nc.getSessionAPI.bind(Nc),fh=new Set;var Dl={exports:{}},R_={exports:function(i,e){var n,s,h,m,p,b,y,w;for(s=i.length-(n=3&i.length),h=e,p=3432918353,b=461845907,w=0;w<s;)y=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24,++w,h=27492+(65535&(m=5*(65535&(h=(h^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*b+(((y>>>16)*b&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&i.charCodeAt(w+2))<<16;case 2:y^=(255&i.charCodeAt(w+1))<<8;case 1:h^=y=(65535&(y=(y=(65535&(y^=255&i.charCodeAt(w)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*b+(((y>>>16)*b&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}},Kv={exports:function(i,e){for(var n,s=i.length,h=e^s,m=0;s>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++m;switch(s){case 3:h^=(255&i.charCodeAt(m+2))<<16;case 2:h^=(255&i.charCodeAt(m+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(m)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}},L_=R_.exports,cf=Kv.exports;Dl.exports=L_,Dl.exports.murmur3=L_,Dl.exports.murmur2=cf;var Vc=Ge(Dl.exports);function df(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function jc(i,e,n){if(n&&n[i]){let s=n[i].indexOf(e);s!==-1&&n[i].splice(s,1)}}class fo{constructor(e,n={}){Jr(this,n),this.type=e}}class Gu extends fo{constructor(e,n={}){super("error",Jr({error:e},n))}}class Al{on(e,n){return this._listeners=this._listeners||{},df(e,n,this._listeners),this}off(e,n){return jc(e,n,this._listeners),jc(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},df(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){typeof e=="string"&&(e=new fo(e,n||{}));let s=e.type;if(this.listens(s)){e.target=this;let h=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(let b of h)b.call(this,e);let m=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(let b of m)jc(s,b,this._oneTimeListeners),b.call(this,e);let p=this._eventedParent;p&&(Jr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Gu&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}t.F=void 0;var F_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function qu(i){return(i=Math.round(i))<0?0:i>255?255:i}function hf(i){return qu(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function gh(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function _h(i,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?i+(e-i)*n*6:2*n<1?e:3*n<2?i+(e-i)*(2/3-n)*6:i}try{t.F={}.parseCSSColor=function(i){var e,n=i.replace(/ /g,"").toLowerCase();if(n in F_)return F_[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),h=n.indexOf(")");if(s!==-1&&h+1===n.length){var m=n.substr(0,s),p=n.substr(s+1,h-(s+1)).split(","),b=1;switch(m){case"rgba":if(p.length!==4)return null;b=gh(p.pop());case"rgb":return p.length!==3?null:[hf(p[0]),hf(p[1]),hf(p[2]),b];case"hsla":if(p.length!==4)return null;b=gh(p.pop());case"hsl":if(p.length!==3)return null;var y=(parseFloat(p[0])%360+360)%360/360,w=gh(p[1]),M=gh(p[2]),T=M<=.5?M*(w+1):M+w-M*w,E=2*M-T;return[qu(255*_h(E,T,y+1/3)),qu(255*_h(E,T,y)),qu(255*_h(E,T,y-1/3)),b];default:return null}}return null}}catch{}class Ni{constructor(e,n,s,h=1){this.r=e,this.g=n,this.b=s,this.a=h}static parse(e){if(!e)return;if(e instanceof Ni)return e;if(typeof e!="string")return;let n=t.F(e);return n?new Ni(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,s,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${h})`}toRenderColor(e){let{r:n,g:s,b:h,a:m}=this;return new Jv(e,n,s,h,m)}}class Jv{constructor(e,n,s,h,m){if(e){let p=e.image.height,b=p*p;n=m===0?0:n/m*(p-1),s=m===0?0:s/m*(p-1),h=m===0?0:h/m*(p-1);let y=Math.floor(n),w=Math.floor(s),M=Math.floor(h),T=Math.ceil(n),E=Math.ceil(s),P=Math.ceil(h),R=n-y,F=s-w,N=h-M,H=e.image.data,J=4*(y+w*b+M*p),ee=4*(y+w*b+P*p),te=4*(y+E*b+M*p),pe=4*(y+E*b+P*p),he=4*(T+w*b+M*p),ve=4*(T+w*b+P*p),Ce=4*(T+E*b+M*p),Ae=4*(T+E*b+P*p);if(J<0||Ae>=H.length)throw new Error("out of range");this.r=Ht(Ht(Ht(H[J],H[ee],N),Ht(H[te],H[pe],N),F),Ht(Ht(H[he],H[ve],N),Ht(H[Ce],H[Ae],N),F),R)/255*m,this.g=Ht(Ht(Ht(H[J+1],H[ee+1],N),Ht(H[te+1],H[pe+1],N),F),Ht(Ht(H[he+1],H[ve+1],N),Ht(H[Ce+1],H[Ae+1],N),F),R)/255*m,this.b=Ht(Ht(Ht(H[J+2],H[ee+2],N),Ht(H[te+2],H[pe+2],N),F),Ht(Ht(H[he+2],H[ve+2],N),Ht(H[Ce+2],H[Ae+2],N),F),R)/255*m,this.a=m}else this.r=n,this.g=s,this.b=h,this.a=m}toArray(){let{r:e,g:n,b:s,a:h}=this;return h===0?[0,0,0,0]:[255*e/h,255*n/h,255*s/h,h]}toArray01(){let{r:e,g:n,b:s,a:h}=this;return h===0?[0,0,0,0]:[e/h,n/h,s/h,h]}toArray01Scaled(e){let{r:n,g:s,b:h,a:m}=this;return m===0?[0,0,0]:[n/m*e,s/m*e,h/m*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:s,a:h}=this;return[e,n,s,h]}toArray01Linear(){let{r:e,g:n,b:s,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(e/h,2.2),Math.pow(n/h,2.2),Math.pow(s/h,2.2),h]}}function Ht(i,e,n){return i*(1-n)+e*n}function z_(i,e,n){return i.map((s,h)=>Ht(s,e[h],n))}Ni.black=new Ni(0,0,0,1),Ni.white=new Ni(1,1,1,1),Ni.transparent=new Ni(0,0,0,0),Ni.red=new Ni(1,0,0,1),Ni.blue=new Ni(0,0,1,1);var $u=Object.freeze({__proto__:null,array:z_,color:function(i,e,n){return new Ni(Ht(i.r,e.r,n),Ht(i.g,e.g,n),Ht(i.b,e.b,n),Ht(i.a,e.a,n))},number:Ht});function uf(i,...e){for(let n of e)for(let s in n)i[s]=n[s];return i}class Ua extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class mf{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[s,h]of n)this.bindings[s]=h}concat(e){return new mf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Uc={kind:"null"},Et={kind:"number"},Vi={kind:"string"},ji={kind:"boolean"},go={kind:"color"},Wc={kind:"object"},Fi={kind:"value"},va={kind:"collator"},Hc={kind:"formatted"},Wa={kind:"resolvedImage"};function Mo(i,e){return{kind:"array",itemType:i,N:e}}function lr(i){if(i.kind==="array"){let e=lr(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}let ex=[Uc,Et,Vi,ji,go,Hc,Wc,Mo(Fi),Wa];function bh(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!bh(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(let n of ex)if(!bh(n,e))return null}}return`Expected ${lr(i)} but found ${lr(e)} instead.`}function pf(i,e){return e.some(n=>n.kind===i.kind)}function Gc(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}class yh{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pl{constructor(e,n,s,h,m){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=h,this.textColor=m}}class eo{constructor(e){this.sections=e}static fromString(e){return new eo([new Pl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof eo?e:eo.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(s)}return e}}class _o{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new _o({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function B_(i,e,n,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,n,s]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bo(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ni||i instanceof yh||i instanceof eo||i instanceof _o)return!0;if(Array.isArray(i)){for(let e of i)if(!bo(e))return!1;return!0}if(typeof i=="object"){for(let e in i)if(!bo(i[e]))return!1;return!0}return!1}function yr(i){if(i===null)return Uc;if(typeof i=="string")return Vi;if(typeof i=="boolean")return ji;if(typeof i=="number")return Et;if(i instanceof Ni)return go;if(i instanceof yh)return va;if(i instanceof eo)return Hc;if(i instanceof _o)return Wa;if(Array.isArray(i)){let e=i.length,n;for(let s of i){let h=yr(s);if(n){if(n===h)continue;n=Fi;break}n=h}return Mo(n||Fi,e)}return Wc}function Xo(i){let e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Ni||i instanceof eo||i instanceof _o?i.toString():JSON.stringify(i)}class us{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!bo(e[1]))return n.error("invalid value");let s=e[1],h=yr(s),m=n.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new us(h,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ni?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof eo?this.value.serialize():this.value}}class Er{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let ff={string:Vi,number:Et,boolean:ji,object:Wc};class xa{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,h=1,m=e[0];if(m==="array"){let b,y;if(e.length>2){let w=e[1];if(typeof w!="string"||!(w in ff)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=ff[w],h++}else b=Fi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],h++}s=Mo(b,y)}else s=ff[m];let p=[];for(;h<e.length;h++){let b=n.parse(e[h],h,Fi);if(!b)return null;p.push(b)}return new xa(s,p)}evaluate(e){for(let n=0;n<this.args.length;n++){let s=this.args[n].evaluate(e);if(!bh(this.type,yr(s)))return s;if(n===this.args.length-1)throw new Er(`Expected value to be of type ${lr(this.type)}, but found ${lr(yr(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){n.push(s.kind);let h=e.N;(typeof h=="number"||this.args.length>1)&&n.push(h)}}return n.concat(this.args.map(s=>s.serialize()))}}class vh{constructor(e){this.type=Hc,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s=e[1];if(!Array.isArray(s)&&typeof s=="object")return n.error("First argument must be an image or text section.");let h=[],m=!1;for(let p=1;p<=e.length-1;++p){let b=e[p];if(m&&typeof b=="object"&&!Array.isArray(b)){m=!1;let y=null;if(b["font-scale"]&&(y=n.parse(b["font-scale"],1,Et),!y))return null;let w=null;if(b["text-font"]&&(w=n.parse(b["text-font"],1,Mo(Vi)),!w))return null;let M=null;if(b["text-color"]&&(M=n.parse(b["text-color"],1,go),!M))return null;let T=h[h.length-1];T.scale=y,T.font=w,T.textColor=M}else{let y=n.parse(e[p],1,Fi);if(!y)return null;let w=y.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:y,scale:null,font:null,textColor:null})}}return new vh(h)}evaluate(e){return new eo(this.sections.map(n=>{let s=n.content.evaluate(e);return yr(s)===Wa?new Pl("",s,null,null,null):new Pl(Xo(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class xh{constructor(e,n){this.type=Wa,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let s=n.parse(e[1],1,Vi);if(!s)return n.error("No image name provided.");if(e.length===2)return new xh(s);let h=n.parse(e[2],1,Vi);return h?new xh(s,h):n.error("Secondary image variant is not a string.")}evaluate(e){let n=_o.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Ol(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}let tx={"to-boolean":ji,"to-color":go,"to-number":Et,"to-string":Vi};class wa{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s=e[0],h=[],m=Uc;if(s==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);m=Mo(n.expectedType.itemType,p)}else{if(!(p>0&&bo(e[1][0])))return null;m=Mo(yr(e[1][0]),p)}for(let b=0;b<p;b++){let y=e[1][b],w;if(Ol(y)==="array")w=n.parse(y,void 0,m.itemType);else{let M=Ol(y);if(M!==m.itemType.kind)return n.error(`Expected ${m.itemType.kind} but found ${M}.`);w=n.registry.literal.parse(["literal",y===void 0?null:y],n)}if(!w)return null;h.push(w)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return n.error("Expected one argument.");m=tx[s];for(let p=1;p<e.length;p++){let b=n.parse(e[p],p,Fi);if(!b)return null;h.push(b)}}return new wa(m,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,s;for(let h of this.args){if(n=h.evaluate(e),s=null,n instanceof Ni)return n;if(typeof n=="string"){let m=e.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:B_(n[0],n[1],n[2],n[3]),!s))return new Ni(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Er(s||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let s of this.args){if(n=s.evaluate(e),n===null)return 0;let h=Number(n);if(!isNaN(h))return h}throw new Er(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?eo.fromString(Xo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?_o.fromString(Xo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Xo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new vh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new xh(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let N_=["Unknown","Point","LineString","Polygon"];class V_{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?N_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:s,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*n-e[0])+this.featureDistanceData.bearing[1]*(h*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Ni.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class oo{constructor(e,n,s,h,m){this.name=e,this.type=n,this._evaluate=s,this.args=h,this._overloadIndex=m}evaluate(e){if(!this._evaluate){let n=oo.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let s=e[0],h=oo.definitions[s];if(!h)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);let m=Array.isArray(h)?h[0]:h.type,p=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,b=[],y=null,w=-1;for(let[M,T]of p){if(Array.isArray(M)&&M.length!==e.length-1)continue;b.push(M),w++,y=new Q_(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let E=[],P=!1;for(let R=1;R<e.length;R++){let F=e[R],N=Array.isArray(M)?M[R-1]:M.type,H=y.parse(F,1+E.length,N);if(!H){P=!0;break}E.push(H)}if(!P)if(Array.isArray(M)&&M.length!==E.length)y.error(`Expected ${M.length} arguments, but found ${E.length} instead.`);else{for(let R=0;R<E.length;R++){let F=Array.isArray(M)?M[R]:M.type,N=E[R];y.concat(R+1).checkSubtype(F,N.type)}if(y.errors.length===0)return new oo(s,m,T,E,w)}}if(b.length===1)n.errors.push(...y.errors);else{let M=(b.length?b:p.map(([E])=>E)).map(gf).join(" | "),T=[];for(let E=1;E<e.length;E++){let P=n.parse(e[E],1+T.length);if(!P)return null;T.push(lr(P.type))}n.error(`Expected arguments of type ${M}, but found (${T.join(", ")}) instead.`)}return null}static register(e,n){oo.definitions=n;for(let s in n)e[s]=oo}}function gf(i){return Array.isArray(i)?`(${i.map(lr).join(", ")})`:`(${lr(i.type)}...)`}class qs{constructor(e,n,s){this.type=va,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let s=e[1];if(typeof s!="object"||Array.isArray(s))return n.error("Collator options argument must be an object.");let h=n.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,ji);if(!h)return null;let m=n.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,ji);if(!m)return null;let p=null;return s.locale&&(p=n.parse(s.locale,1,Vi),!p)?null:new qs(h,m,p)}evaluate(e){return new yh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var _f={exports:{}};_f.exports=function(){function i(s,h,m,p,b){for(;p>m;){if(p-m>600){var y=p-m+1,w=h-m+1,M=Math.log(y),T=.5*Math.exp(2*M/3),E=.5*Math.sqrt(M*T*(y-T)/y)*(w-y/2<0?-1:1);i(s,h,Math.max(m,Math.floor(h-w*T/y+E)),Math.min(p,Math.floor(h+(y-w)*T/y+E)),b)}var P=s[h],R=m,F=p;for(e(s,m,h),b(s[p],P)>0&&e(s,m,p);R<F;){for(e(s,R,F),R++,F--;b(s[R],P)<0;)R++;for(;b(s[F],P)>0;)F--}b(s[m],P)===0?e(s,m,F):e(s,++F,p),F<=h&&(m=F+1),h<=F&&(p=F-1)}}function e(s,h,m){var p=s[h];s[h]=s[m],s[m]=p}function n(s,h){return s<h?-1:s>h?1:0}return function(s,h,m,p,b){i(s,h,m||0,p||s.length-1,b||n)}}();var ix=Ge(_f.exports);function nx(i){let e=0;for(let n,s,h=0,m=i.length,p=m-1;h<m;p=h++)n=i[h],s=i[p],e+=(s.x-n.x)*(n.y+s.y);return e}function wh(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function qc(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function rx(i,e,n){let s=i[0]-e[0],h=i[1]-e[1],m=i[0]-n[0],p=i[1]-n[1];return s*p-m*h==0&&s*m<=0&&h*p<=0}function $c(i,e,n=!1){let s=!1;for(let b=0,y=e.length;b<y;b++){let w=e[b];for(let M=0,T=w.length,E=T-1;M<T;E=M++){let P=w[E],R=w[M];if(rx(i,P,R))return n;(m=P)[1]>(h=i)[1]!=(p=R)[1]>h[1]&&h[0]<(p[0]-m[0])*(h[1]-m[1])/(p[1]-m[1])+m[0]&&(s=!s)}}var h,m,p;return s}function bf(i,e,n,s){let h=s[0]-n[0],m=s[1]-n[1],p=(i[0]-n[0])*m-h*(i[1]-n[1]),b=(e[0]-n[0])*m-h*(e[1]-n[1]);return p>0&&b<0||p<0&&b>0}function Li(i,e,n,s){return(h=[s[0]-n[0],s[1]-n[1]])[0]*(m=[e[0]-i[0],e[1]-i[1]])[1]-h[1]*m[0]!=0&&!(!bf(i,e,n,s)||!bf(n,s,i,e));var h,m}let ms=8192;function j_(i,e){let n=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(n*h*ms),Math.round(s*h*ms)]}function ox(i,e){for(let n=0;n<e.length;n++)if($c(i,e[n]))return!0;return!1}function ax(i,e,n){for(let s of n)for(let h=0,m=s.length,p=m-1;h<m;p=h++)if(Li(i,e,s[p],s[h]))return!0;return!1}function Ch(i,e){for(let n=0;n<i.length;++n)if(!$c(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(ax(i[n],i[n+1],e))return!1;return!0}function Yu(i,e){for(let n=0;n<e.length;n++)if(Ch(i,e[n]))return!0;return!1}function Yc(i,e,n){let s=[];for(let h=0;h<i.length;h++){let m=[];for(let p=0;p<i[h].length;p++){let b=j_(i[h][p],n);wh(e,b),m.push(b)}s.push(m)}return s}function U_(i,e,n){let s=[];for(let h=0;h<i.length;h++){let m=Yc(i[h],e,n);s.push(m)}return s}function yf(i,e,n,s){if(i[0]<n[0]||i[0]>n[2]){let h=.5*s,m=i[0]-n[0]>h?-s:n[0]-i[0]>h?s:0;m===0&&(m=i[0]-n[2]>h?-s:n[2]-i[0]>h?s:0),i[0]+=m}wh(e,i)}function Ca(i,e,n,s){let h=Math.pow(2,s.z)*ms,m=[s.x*ms,s.y*ms],p=[];if(!i)return p;for(let b of i)for(let y of b){let w=[y.x+m[0],y.y+m[1]];yf(w,e,n,h),p.push(w)}return p}function W_(i,e,n,s){let h=Math.pow(2,s.z)*ms,m=[s.x*ms,s.y*ms],p=[];if(!i)return p;for(let y of i){let w=[];for(let M of y){let T=[M.x+m[0],M.y+m[1]];wh(e,T),w.push(T)}p.push(w)}if(e[2]-e[0]<=h/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(let y of p)for(let w of y)yf(w,e,n,h)}var b;return p}class $s{constructor(e,n){this.type=ji,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(bo(e[1])){let s=e[1];if(s.type==="FeatureCollection")for(let h=0;h<s.features.length;++h){let m=s.features[h].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new $s(s,s.features[h].geometry)}else if(s.type==="Feature"){let h=s.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new $s(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new $s(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,s){let h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(s.type==="Polygon"){let b=Yc(s.coordinates,m,p),y=Ca(n.geometry(),h,m,p);if(!qc(h,m))return!1;for(let w of y)if(!$c(w,b))return!1}if(s.type==="MultiPolygon"){let b=U_(s.coordinates,m,p),y=Ca(n.geometry(),h,m,p);if(!qc(h,m))return!1;for(let w of y)if(!ox(w,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,s){let h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(s.type==="Polygon"){let b=Yc(s.coordinates,m,p),y=W_(n.geometry(),h,m,p);if(!qc(h,m))return!1;for(let w of y)if(!Ch(w,b))return!1}if(s.type==="MultiPolygon"){let b=U_(s.coordinates,m,p),y=W_(n.geometry(),h,m,p);if(!qc(h,m))return!1;for(let w of y)if(!Yu(w,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let Ys={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Zu=1/298.257223563,H_=Zu*(2-Zu),Sh=Math.PI/180;class Mh{static fromTile(e,n,s){let h=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),m=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Sh;return new Mh(m,s)}static get units(){return Ys}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Ys[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Ys).join(", ")}`);let s=6378.137*Sh*(n?Ys[n]:1),h=Math.cos(e*Sh),m=1/(1-H_*(1-h*h)),p=Math.sqrt(m);this.kx=s*p*h,this.ky=s*p*m*(1-H_)}distance(e,n){let s=Qo(e[0]-n[0])*this.kx,h=(e[1]-n[1])*this.ky;return Math.sqrt(s*s+h*h)}bearing(e,n){let s=Qo(n[0]-e[0])*this.kx;return Math.atan2(s,(n[1]-e[1])*this.ky)/Sh}destination(e,n,s){let h=s*Sh;return this.offset(e,Math.sin(h)*n,Math.cos(h)*n)}offset(e,n,s){return[e[0]+n/this.kx,e[1]+s/this.ky]}lineDistance(e){let n=0;for(let s=0;s<e.length-1;s++)n+=this.distance(e[s],e[s+1]);return n}area(e){let n=0;for(let s=0;s<e.length;s++){let h=e[s];for(let m=0,p=h.length,b=p-1;m<p;b=m++)n+=Qo(h[m][0]-h[b][0])*(h[m][1]+h[b][1])*(s?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let s=0;if(n<=0)return e[0];for(let h=0;h<e.length-1;h++){let m=e[h],p=e[h+1],b=this.distance(m,p);if(s+=b,s>n)return kh(m,p,(n-(s-b))/b)}return e[e.length-1]}pointToSegmentDistance(e,n,s){let[h,m]=n,p=Qo(s[0]-h)*this.kx,b=(s[1]-m)*this.ky;if(p!==0||b!==0){let y=(Qo(e[0]-h)*this.kx*p+(e[1]-m)*this.ky*b)/(p*p+b*b);y>1?(h=s[0],m=s[1]):y>0&&(h+=p/this.kx*y,m+=b/this.ky*y)}return p=Qo(e[0]-h)*this.kx,b=(e[1]-m)*this.ky,Math.sqrt(p*p+b*b)}pointOnLine(e,n){let s=1/0,h=e[0][0],m=e[0][1],p=0,b=0;for(let y=0;y<e.length-1;y++){let w=e[y][0],M=e[y][1],T=Qo(e[y+1][0]-w)*this.kx,E=(e[y+1][1]-M)*this.ky,P=0;T===0&&E===0||(P=(Qo(n[0]-w)*this.kx*T+(n[1]-M)*this.ky*E)/(T*T+E*E),P>1?(w=e[y+1][0],M=e[y+1][1]):P>0&&(w+=T/this.kx*P,M+=E/this.ky*P)),T=Qo(n[0]-w)*this.kx,E=(n[1]-M)*this.ky;let R=T*T+E*E;R<s&&(s=R,h=w,m=M,p=y,b=P)}return{point:[h,m],index:p,t:Math.max(0,Math.min(1,b))}}lineSlice(e,n,s){let h=this.pointOnLine(s,e),m=this.pointOnLine(s,n);if(h.index>m.index||h.index===m.index&&h.t>m.t){let w=h;h=m,m=w}let p=[h.point],b=h.index+1,y=m.index;!vf(s[b],p[0])&&b<=y&&p.push(s[b]);for(let w=b+1;w<=y;w++)p.push(s[w]);return vf(s[y],m.point)||p.push(m.point),p}lineSliceAlong(e,n,s){let h=0,m=[];for(let p=0;p<s.length-1;p++){let b=s[p],y=s[p+1],w=this.distance(b,y);if(h+=w,h>e&&m.length===0&&m.push(kh(b,y,(e-(h-w))/w)),h>=n)return m.push(kh(b,y,(n-(h-w))/w)),m;h>e&&m.push(y)}return m}bufferPoint(e,n){let s=n/this.ky,h=n/this.kx;return[e[0]-h,e[1]-s,e[0]+h,e[1]+s]}bufferBBox(e,n){let s=n/this.ky,h=n/this.kx;return[e[0]-h,e[1]-s,e[2]+h,e[3]+s]}insideBBox(e,n){return Qo(e[0]-n[0])>=0&&Qo(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function vf(i,e){return i[0]===e[0]&&i[1]===e[1]}function kh(i,e,n){let s=Qo(e[0]-i[0]);return[i[0]+s*n,i[1]+(e[1]-i[1])*n]}function Qo(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}var Ih={exports:{}};(function(i,e){i.exports=function(){var n=function(h,m){if(h===void 0&&(h=[]),m===void 0&&(m=s),this.data=h,this.length=this.data.length,this.compare=m,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function s(h,m){return h<m?-1:h>m?1:0}return n.prototype.push=function(h){this.data.push(h),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var h=this.data[0],m=this.data.pop();return this.length--,this.length>0&&(this.data[0]=m,this._down(0)),h}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(h){for(var m=this.data,p=this.compare,b=m[h];h>0;){var y=h-1>>1,w=m[y];if(p(b,w)>=0)break;m[h]=w,h=y}m[h]=b},n.prototype._down=function(h){for(var m=this.data,p=this.compare,b=this.length>>1,y=m[h];h<b;){var w=1+(h<<1),M=m[w],T=w+1;if(T<this.length&&p(m[T],M)<0&&(w=T,M=m[T]),p(M,y)>=0)break;m[h]=M,h=w}m[h]=y},n}()})(Ih);var xf=Ge(Ih.exports),pt=8192;function G_(i,e){return e.dist-i.dist}let wf=100,Cf=50;function q_(i){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==i.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==i[n])return!1;return!0}function Xu(i){return i[1]-i[0]+1}function Ha(i,e){let n=i[1]>=i[0]&&i[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Zs(i,e){if(i[0]>i[1])return[null,null];let n=Xu(i);if(e){if(n===2)return[i,null];let s=Math.floor(n/2);return[[i[0],i[0]+s],[i[0]+s,i[1]]]}{if(n===1)return[i,null];let s=Math.floor(n/2)-1;return[[i[0],i[0]+s],[i[0]+s+1,i[1]]]}}function Rl(i,e){let n=[1/0,1/0,-1/0,-1/0];if(!Ha(e,i.length))return n;for(let s=e[0];s<=e[1];++s)wh(n,i[s]);return n}function Qu(i){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<i.length;++n)for(let s=0;s<i[n].length;++s)wh(e,i[n][s]);return e}function Xs(i,e,n){if(q_(i)||q_(e))return NaN;let s=0,h=0;return i[2]<e[0]&&(s=e[0]-i[2]),i[0]>e[2]&&(s=i[0]-e[2]),i[1]>e[3]&&(h=i[1]-e[3]),i[3]<e[1]&&(h=e[1]-i[3]),n.distance([0,0],[s,h])}function sx(i){return 360*i-180}function lx(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Sf(i,e){let n=Math.pow(2,e.z),s=(i.y/pt+e.y)/n;return[sx((i.x/pt+e.x)/n),lx(s)]}function cx(i,e){let n=[];for(let s=0;s<i.length;++s)n.push(Sf(i[s],e));return n}function $_(i,e,n){let s=n.pointOnLine(e,i).point;return n.distance(i,s)}function Qs(i,e,n,s,h){let m=n.slice(s[0],s[1]+1),p=1/0;for(let b=e[0];b<=e[1];++b)if((p=Math.min(p,$_(i[b],m,h)))===0)return 0;return p}function Mf(i,e,n,s,h){let m=Math.min(h.pointToSegmentDistance(i,n,s),h.pointToSegmentDistance(e,n,s)),p=Math.min(h.pointToSegmentDistance(n,i,e),h.pointToSegmentDistance(s,i,e));return Math.min(m,p)}function dx(i,e,n,s,h){if(!Ha(e,i.length)||!Ha(s,n.length))return NaN;let m=1/0;for(let p=e[0];p<e[1];++p)for(let b=s[0];b<s[1];++b){if(Li(i[p],i[p+1],n[b],n[b+1]))return 0;m=Math.min(m,Mf(i[p],i[p+1],n[b],n[b+1],h))}return m}function Y_(i,e,n,s,h){if(!Ha(e,i.length)||!Ha(s,n.length))return NaN;let m=1/0;for(let p=e[0];p<=e[1];++p)for(let b=s[0];b<=s[1];++b)if((m=Math.min(m,h.distance(i[p],n[b])))===0)return m;return m}function Z_(i,e,n){if($c(i,e,!0))return 0;let s=1/0;for(let h of e){let m=h.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[m-1]&&(s=Math.min(s,n.pointToSegmentDistance(i,h[m-1],h[0])))===0||(s=Math.min(s,$_(i,h,n)))===0)return s}return s}function Sa(i,e,n,s){if(!Ha(e,i.length))return NaN;for(let m=e[0];m<=e[1];++m)if($c(i[m],n,!0))return 0;let h=1/0;for(let m=e[0];m<e[1];++m)for(let p of n)for(let b=0,y=p.length,w=y-1;b<y;w=b++){if(Li(i[m],i[m+1],p[w],p[b]))return 0;h=Math.min(h,Mf(i[m],i[m+1],p[w],p[b],s))}return h}function kf(i,e){for(let n of i)for(let s=0;s<=n.length-1;++s)if($c(n[s],e,!0))return!0;return!1}function hx(i,e,n,s=1/0){let h=Qu(i),m=Qu(e);if(s!==1/0&&Xs(h,m,n)>=s)return s;if(qc(h,m)){if(kf(i,e))return 0}else if(kf(e,i))return 0;let p=s;for(let b of i)for(let y=0,w=b.length,M=w-1;y<w;M=y++)for(let T of e)for(let E=0,P=T.length,R=P-1;E<P;R=E++){if(Li(b[M],b[y],T[R],T[E]))return 0;p=Math.min(p,Mf(b[M],b[y],T[R],T[E],n))}return p}function Th(i,e,n,s,h,m,p){if(m===null||p===null)return;let b=Xs(Rl(s,m),Rl(h,p),n);b<e&&i.push({dist:b,range1:m,range2:p})}function Ku(i,e,n,s,h=1/0){let m=Math.min(s.distance(i[0],n[0][0]),h);if(m===0)return m;let p=new xf([{dist:0,range1:[0,i.length-1],range2:[0,0]}],G_),b=e?Cf:wf,y=Qu(n);for(;p.length;){let w=p.pop();if(w.dist>=m)continue;let M=w.range1;if(Xu(M)<=b){if(!Ha(M,i.length))return NaN;if(e){let T=Sa(i,M,n,s);if((m=Math.min(m,T))===0)return m}else for(let T=M[0];T<=M[1];++T){let E=Z_(i[T],n,s);if((m=Math.min(m,E))===0)return m}}else{let T=Zs(M,e);if(T[0]!==null){let E=Xs(Rl(i,T[0]),y,s);E<m&&p.push({dist:E,range1:T[0],range2:[0,0]})}if(T[1]!==null){let E=Xs(Rl(i,T[1]),y,s);E<m&&p.push({dist:E,range1:T[1],range2:[0,0]})}}}return m}function X_(i,e,n,s,h,m=1/0){let p=Math.min(m,h.distance(i[0],n[0]));if(p===0)return p;let b=new xf([{dist:0,range1:[0,i.length-1],range2:[0,n.length-1]}],G_),y=e?Cf:wf,w=s?Cf:wf;for(;b.length;){let M=b.pop();if(M.dist>=p)continue;let T=M.range1,E=M.range2;if(Xu(T)<=y&&Xu(E)<=w){if(!Ha(T,i.length)||!Ha(E,n.length))return NaN;if(e&&s?p=Math.min(p,dx(i,T,n,E,h)):e||s?e&&!s?p=Math.min(p,Qs(n,E,i,T,h)):!e&&s&&(p=Math.min(p,Qs(i,T,n,E,h))):p=Math.min(p,Y_(i,T,n,E,h)),p===0)return p}else{let P=Zs(T,e),R=Zs(E,s);Th(b,p,h,i,n,P[0],R[0]),Th(b,p,h,i,n,P[0],R[1]),Th(b,p,h,i,n,P[1],R[0]),Th(b,p,h,i,n,P[1],R[1])}}return p}function If(i,e,n,s,h=1/0){let m=h,p=Rl(i,[0,i.length-1]);for(let b of n)if(!(m!==1/0&&Xs(p,Rl(b,[0,b.length-1]),s)>=m)&&(m=Math.min(m,X_(i,e,b,!0,s,m)),m===0))return m;return m}function Ju(i,e,n,s,h=1/0){let m=h,p=Rl(i,[0,i.length-1]);for(let b of n){if(m!==1/0&&Xs(p,Qu(b),s)>=m)continue;let y=Ku(i,e,b,s,m);if(isNaN(y))return y;if((m=Math.min(m,y))===0)return m}return m}function Tf(i){return i==="Point"||i==="MultiPoint"||i==="LineString"||i==="MultiLineString"||i==="Polygon"||i==="MultiPolygon"}class Ll{constructor(e,n){this.type=Et,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(bo(e[1])){let s=e[1];if(s.type==="FeatureCollection"){for(let h=0;h<s.features.length;++h)if(Tf(s.features[h].geometry.type))return new Ll(s,s.features[h].geometry)}else if(s.type==="Feature"){if(Tf(s.geometry.type))return new Ll(s,s.geometry)}else if(Tf(s.type))return new Ll(s,s)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),s=e.canonicalID();if(n!=null&&s!=null){if(e.geometryType()==="Point")return function(h,m,p){let b=[];for(let w of h)for(let M of w)b.push(Sf(M,m));let y=new Mh(b[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?X_(b,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y):p.type==="MultiLineString"?If(b,!1,p.coordinates,y):p.type==="Polygon"||p.type==="MultiPolygon"?Ju(b,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,y):null}(n,s,this.geometries);if(e.geometryType()==="LineString")return function(h,m,p){let b=[];for(let w of h){let M=[];for(let T of w)M.push(Sf(T,m));b.push(M)}let y=new Mh(b[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return If(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b,y);if(p.type==="MultiLineString"){let w=1/0;for(let M=0;M<p.coordinates.length;M++){let T=If(p.coordinates[M],!0,b,y,w);if(isNaN(T))return T;if((w=Math.min(w,T))===0)return w}return w}if(p.type==="Polygon"||p.type==="MultiPolygon"){let w=1/0;for(let M=0;M<b.length;M++){let T=Ju(b[M],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,y,w);if(isNaN(T))return T;if((w=Math.min(w,T))===0)return w}return w}return null}(n,s,this.geometries);if(e.geometryType()==="Polygon")return function(h,m,p){let b=[];for(let w of function(M,T){let E=M.length;if(E<=1)return[M];let P=[],R,F;for(let N=0;N<E;N++){let H=nx(M[N]);H!==0&&(M[N].area=Math.abs(H),F===void 0&&(F=H<0),F===H<0?(R&&P.push(R),R=[M[N]]):R.push(M[N]))}return R&&P.push(R),P}(h)){let M=[];for(let T=0;T<w.length;++T)M.push(cx(w[T],m));b.push(M)}let y=new Mh(b[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Ju(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b,y);if(p.type==="MultiLineString"){let w=1/0;for(let M=0;M<p.coordinates.length;M++){let T=Ju(p.coordinates[M],!0,b,y,w);if(isNaN(T))return T;if((w=Math.min(w,T))===0)return w}return w}return p.type==="Polygon"||p.type==="MultiPolygon"?function(w,M,T){let E=1/0;for(let P of w)for(let R of M){let F=hx(P,R,T,E);if(isNaN(F))return F;if((E=Math.min(E,F))===0)return E}return E}(p.type==="Polygon"?[p.coordinates]:p.coordinates,b,y):null}(n,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Zc(i,e){switch(i){case"string":return Xo(e);case"number":return+e;case"boolean":return!!e;case"color":return Ni.parse(e);case"formatted":return eo.fromString(Xo(e));case"resolvedImage":return _o.fromString(Xo(e))}return e}function Eh(i,e,n,s){return s!==void 0&&(i=s*Math.round(i/s)),e!==void 0&&i<e&&(i=e),n!==void 0&&i>n&&(i=n),i}class Wr{constructor(e,n,s){this.type=e,this.key=n,this.scope=s}static parse(e,n){let s=n.expectedType;if(s==null&&(s=Fi),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let h=n.parse(e[1],1);if(!(h instanceof us))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let m=n.parse(e[2],2);return m instanceof us?new Wr(s,Xo(h.value),Xo(m.value)):n.error("Scope of 'config' expression must be a string literal.")}return new Wr(s,Xo(h.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),s=e.getConfig(n);if(!s)return null;let{type:h,value:m,values:p,minValue:b,maxValue:y,stepValue:w}=s,M=s.default.evaluate(e),T=M;if(m){let E=e.scope;e.scope=(E||"").split("").slice(1).join(""),T=m.evaluate(e),e.scope=E}return h&&(T=Zc(h,T)),T===void 0||b===void 0&&y===void 0&&w===void 0||(typeof T=="number"?T=Eh(T,b,y,w):Array.isArray(T)&&(T=T.map(E=>typeof E=="number"?Eh(E,b,y,w):E))),m!==void 0&&T!==void 0&&p&&!p.includes(T)&&(T=M,h&&(T=Zc(h,T))),(h&&h!==this.type||T!==void 0&&yr(T)!==this.type)&&(T=Zc(this.type.kind,T)),T}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Ks(i){if(i instanceof oo&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof $s||i instanceof Ll)return!1;let e=!0;return i.eachChild(n=>{e&&!Ks(n)&&(e=!1)}),e}function em(i){if(i instanceof oo&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!em(n)&&(e=!1)}),e}function Ef(i){if(i instanceof Wr)return!1;let e=!0;return i.eachChild(n=>{e&&!Ef(n)&&(e=!1)}),e}function Dh(i,e){if(i instanceof oo&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(s=>{n&&!Dh(s,e)&&(n=!1)}),n}class tm{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let s=e[1];return n.scope.has(s)?new tm(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ah{constructor(e,n=[],s,h=new mf,m=[],p,b){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=h,this.errors=m,this.expectedType=s,this._scope=p,this.options=b}parse(e,n,s,h,m={}){return n||s?this.concat(n,s,h)._parse(e,m):this._parse(e,m)}_parse(e,n){function s(h,m,p){return p==="assert"?new xa(m,[h]):p==="coerce"?new wa(m,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let m=h.parse(e,this);if(!m)return null;if(this.expectedType){let p=this.expectedType,b=m.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||b.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(p,b))return null}else m=s(m,p,n.typeAnnotation||"coerce");else m=s(m,p,n.typeAnnotation||"assert")}if(!(m instanceof us)&&m.type.kind!=="resolvedImage"&&Ph(m)){let p=new V_(this._scope,this.options);try{m=new us(m.type,m.evaluate(p))}catch(b){return this.error(b.message),null}}return m}return wa.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){let h=typeof e=="number"?this.path.concat(e):this.path,m=s?this.scope.concat(s):this.scope;return new Ah(this.registry,h,n||null,m,this.errors,this._scope,this.options)}error(e,...n){let s=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ua(s,e))}checkSubtype(e,n){let s=bh(e,n);return s&&this.error(s),s}}var Q_=Ah;function Ph(i){if(i instanceof tm)return Ph(i.boundExpression);if(i instanceof oo&&i.name==="error"||i instanceof qs||i instanceof $s||i instanceof Ll||i instanceof Wr)return!1;let e=i instanceof wa||i instanceof xa,n=!0;return i.eachChild(s=>{n=e?n&&Ph(s):n&&s instanceof us}),!!n&&Ks(i)&&Dh(i,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function im(i,e){let n=i.length-1,s,h,m=0,p=n,b=0;for(;m<=p;)if(b=Math.floor((m+p)/2),s=i[b],h=i[b+1],s<=e){if(b===n||e<h)return b;m=b+1}else{if(!(s>e))throw new Er("Input is not a number.");p=b-1}return 0}class Oh{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[h,m]of s)this.labels.push(h),this.outputs.push(m)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let s=n.parse(e[1],1,Et);if(!s)return null;let h=[],m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let p=1;p<e.length;p+=2){let b=p===1?-1/0:e[p],y=e[p+1],w=p,M=p+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(h.length&&h[h.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);let T=n.parse(y,M,m);if(!T)return null;m=m||T.type,h.push([b,T])}return new Oh(m,s,h)}evaluate(e){let n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);let h=this.input.evaluate(e);if(h<=n[0])return s[0].evaluate(e);let m=n.length;return h>=n[m-1]?s[m-1].evaluate(e):s[im(n,h)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let nm=.95047,K_=1.08883,Df=4/29,Fl=6/29,J_=3*Fl*Fl,Af=Fl*Fl*Fl,rm=Math.PI/180,e0=180/Math.PI;function Pf(i){return i>Af?Math.pow(i,1/3):i/J_+Df}function om(i){return i>Fl?i*i*i:J_*(i-Df)}function Of(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Rh(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function t0(i){let e=Rh(i.r),n=Rh(i.g),s=Rh(i.b),h=Pf((.4124564*e+.3575761*n+.1804375*s)/nm),m=Pf((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-Pf((.0193339*e+.119192*n+.9503041*s)/K_)),alpha:i.a}}function i0(i){let e=(i.l+16)/116,n=isNaN(i.a)?e:e+i.a/500,s=isNaN(i.b)?e:e-i.b/200;return e=1*om(e),n=nm*om(n),s=K_*om(s),new Ni(Of(3.2404542*n-1.5371385*e-.4985314*s),Of(-.969266*n+1.8760108*e+.041556*s),Of(.0556434*n-.2040259*e+1.0572252*s),i.alpha)}function ux(i,e,n){let s=e-i;return i+n*(s>180||s<-180?s-360*Math.round(s/360):s)}let Lh={forward:t0,reverse:i0,interpolate:function(i,e,n){return{l:Ht(i.l,e.l,n),a:Ht(i.a,e.a,n),b:Ht(i.b,e.b,n),alpha:Ht(i.alpha,e.alpha,n)}}},Xc={forward:function(i){let{l:e,a:n,b:s}=t0(i),h=Math.atan2(s,n)*e0;return{h:h<0?h+360:h,c:Math.sqrt(n*n+s*s),l:e,alpha:i.a}},reverse:function(i){let e=i.h*rm,n=i.c;return i0({l:i.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:i.alpha})},interpolate:function(i,e,n){return{h:ux(i.h,e.h,n),c:Ht(i.c,e.c,n),l:Ht(i.l,e.l,n),alpha:Ht(i.alpha,e.alpha,n)}}};var n0=Object.freeze({__proto__:null,hcl:Xc,lab:Lh});class Vo{constructor(e,n,s,h,m){this.type=e,this.operator=n,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(let[p,b]of m)this.labels.push(p),this.outputs.push(b)}static interpolationFactor(e,n,s,h){let m=0;if(e.name==="exponential")m=Rf(n,e.base,s,h);else if(e.name==="linear")m=Rf(n,1,s,h);else if(e.name==="cubic-bezier"){let p=e.controlPoints;m=new ih(p[0],p[1],p[2],p[3]).solve(Rf(n,1,s,h))}return m}static parse(e,n){let[s,h,m,...p]=e;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){let w=h[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:w}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{let w=h.slice(1);if(w.length!==4||w.some(M=>typeof M!="number"||M<0||M>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,Et),!m)return null;let b=[],y=null;s==="interpolate-hcl"||s==="interpolate-lab"?y=go:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let w=0;w<p.length;w+=2){let M=p[w],T=p[w+1],E=w+3,P=w+4;if(typeof M!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(b.length&&b[b.length-1][0]>=M)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',E);let R=n.parse(T,P,y);if(!R)return null;y=y||R.type,b.push([M,R])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Vo(y,s,h,m,b):n.error(`Type ${lr(y)} is not interpolatable.`)}evaluate(e){let n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);let h=this.input.evaluate(e);if(h<=n[0])return s[0].evaluate(e);let m=n.length;if(h>=n[m-1])return s[m-1].evaluate(e);let p=im(n,h),b=Vo.interpolationFactor(this.interpolation,h,n[p],n[p+1]),y=s[p].evaluate(e),w=s[p+1].evaluate(e);return this.operator==="interpolate"?$u[this.type.kind.toLowerCase()](y,w,b):this.operator==="interpolate-hcl"?Xc.reverse(Xc.interpolate(Xc.forward(y),Xc.forward(w),b)):Lh.reverse(Lh.interpolate(Lh.forward(y),Lh.forward(w),b))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function Rf(i,e,n,s){let h=s-n,m=i-n;return h===0?0:e===1?m/h:(Math.pow(e,m)-1)/(Math.pow(e,h)-1)}class am{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null,h=n.expectedType;h&&h.kind!=="value"&&(s=h);let m=[];for(let b of e.slice(1)){let y=n.parse(b,1+m.length,s,void 0,{typeAnnotation:"omit"});if(!y)return null;s=s||y.type,m.push(y)}let p=h&&m.some(b=>bh(h,b.type));return new am(p?Fi:s,m)}evaluate(e){let n,s=null,h=0;for(let m of this.args){if(h++,s=m.evaluate(e),s&&s instanceof _o&&!s.available&&(n||(n=s),s=null,h===this.args.length))return n;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class sm{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let s=[];for(let m=1;m<e.length-1;m+=2){let p=e[m];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,m);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);let b=n.parse(e[m+1],m+1);if(!b)return null;s.push([p,b])}let h=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return h?new sm(s,h):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}class Lf{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let s=n.parse(e[1],1,Et),h=n.parse(e[2],2,Mo(n.expectedType||Fi));return s&&h?new Lf(h.type.itemType,s,h):null}evaluate(e){let n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new Er(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new Er(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new Er(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ff{constructor(e,n){this.type=ji,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let s=n.parse(e[1],1,Fi),h=n.parse(e[2],2,Fi);return s&&h?pf(s.type,[ji,Vi,Et,Uc,Fi])?new Ff(s,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${lr(s.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!Gc(n,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${lr(yr(n))} instead.`);if(!Gc(s,["string","array"]))throw new Er(`Expected second argument to be of type array or string, but found ${lr(yr(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class lm{constructor(e,n,s){this.type=Et,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let s=n.parse(e[1],1,Fi),h=n.parse(e[2],2,Fi);if(!s||!h)return null;if(!pf(s.type,[ji,Vi,Et,Uc,Fi]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${lr(s.type)} instead`);if(e.length===4){let m=n.parse(e[3],3,Et);return m?new lm(s,h,m):null}return new lm(s,h)}evaluate(e){let n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Gc(n,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${lr(yr(n))} instead.`);if(!Gc(s,["string","array"]))throw new Er(`Expected second argument to be of type array or string, but found ${lr(yr(s))} instead.`);if(this.fromIndex){let h=this.fromIndex.evaluate(e);return s.indexOf(n,h)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Qc{constructor(e,n,s,h,m,p){this.inputType=e,this.type=n,this.input=s,this.cases=h,this.outputs=m,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);let m={},p=[];for(let w=2;w<e.length-1;w+=2){let M=e[w],T=e[w+1];Array.isArray(M)||(M=[M]);let E=n.concat(w);if(M.length===0)return E.error("Expected at least one branch label.");for(let R of M){if(typeof R!="number"&&typeof R!="string")return E.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return E.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return E.error("Numeric branch labels must be integer values.");if(s){if(E.checkSubtype(s,yr(R)))return null}else s=yr(R);if(m[String(R)]!==void 0)return E.error("Branch labels must be unique.");m[String(R)]=p.length}let P=n.parse(T,w,h);if(!P)return null;h=h||P.type,p.push(P)}let b=n.parse(e[1],1,Fi);if(!b)return null;let y=n.parse(e[e.length-1],e.length-1,h);return y?b.type.kind!=="value"&&n.concat(1).checkSubtype(s,b.type)?null:new Qc(s,h,b,m,p,y):null}evaluate(e){let n=this.input.evaluate(e);return(yr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],h={};for(let p of n){let b=h[this.cases[p]];b===void 0?(h[this.cases[p]]=s.length,s.push([this.cases[p],[p]])):s[b][1].push(p)}let m=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,b]of s)e.push(b.length===1?m(b[0]):b.map(m)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class zf{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);let h=[];for(let p=1;p<e.length-1;p+=2){let b=n.parse(e[p],p,ji);if(!b)return null;let y=n.parse(e[p+1],p+1,s);if(!y)return null;h.push([b,y]),s=s||y.type}let m=n.parse(e[e.length-1],e.length-1,s);return m?new zf(s,h,m):null}evaluate(e){for(let[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class cm{constructor(e,n,s,h){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=h}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let s=n.parse(e[1],1,Fi),h=n.parse(e[2],2,Et);if(!s||!h)return null;if(!pf(s.type,[Mo(Fi),Vi,Fi]))return n.error(`Expected first argument to be of type array or string, but found ${lr(s.type)} instead`);if(e.length===4){let m=n.parse(e[3],3,Et);return m?new cm(s.type,s,h,m):null}return new cm(s.type,s,h)}evaluate(e){let n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Gc(n,["string","array"]))throw new Er(`Expected first argument to be of type array or string, but found ${lr(yr(n))} instead.`);if(this.endIndex){let h=this.endIndex.evaluate(e);return n.slice(s,h)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Fh(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function r0(i,e,n,s){return s.compare(e,n)===0}function zl(i,e,n){let s=i!=="=="&&i!=="!=";return class XE{constructor(m,p,b){this.type=ji,this.lhs=m,this.rhs=p,this.collator=b,this.hasUntypedArgument=m.type.kind==="value"||p.type.kind==="value"}static parse(m,p){if(m.length!==3&&m.length!==4)return p.error("Expected two or three arguments.");let b=m[0],y=p.parse(m[1],1,Fi);if(!y)return null;if(!Fh(b,y.type))return p.concat(1).error(`"${b}" comparisons are not supported for type '${lr(y.type)}'.`);let w=p.parse(m[2],2,Fi);if(!w)return null;if(!Fh(b,w.type))return p.concat(2).error(`"${b}" comparisons are not supported for type '${lr(w.type)}'.`);if(y.type.kind!==w.type.kind&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${lr(y.type)}' and '${lr(w.type)}'.`);s&&(y.type.kind==="value"&&w.type.kind!=="value"?y=new xa(w.type,[y]):y.type.kind!=="value"&&w.type.kind==="value"&&(w=new xa(y.type,[w])));let M=null;if(m.length===4){if(y.type.kind!=="string"&&w.type.kind!=="string"&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(M=p.parse(m[3],3,va),!M)return null}return new XE(y,w,M)}evaluate(m){let p=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(s&&this.hasUntypedArgument){let y=yr(p),w=yr(b);if(y.kind!==w.kind||y.kind!=="string"&&y.kind!=="number")throw new Er(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){let y=yr(p),w=yr(b);if(y.kind!=="string"||w.kind!=="string")return e(m,p,b)}return this.collator?n(m,p,b,this.collator.evaluate(m)):e(m,p,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){let m=[i];return this.eachChild(p=>{m.push(p.serialize())}),m}}}let mx=zl("==",function(i,e,n){return e===n},r0),o0=zl("!=",function(i,e,n){return e!==n},function(i,e,n,s){return!r0(0,e,n,s)}),a0=zl("<",function(i,e,n){return e<n},function(i,e,n,s){return s.compare(e,n)<0}),s0=zl(">",function(i,e,n){return e>n},function(i,e,n,s){return s.compare(e,n)>0}),l0=zl("<=",function(i,e,n){return e<=n},function(i,e,n,s){return s.compare(e,n)<=0}),Bf=zl(">=",function(i,e,n){return e>=n},function(i,e,n,s){return s.compare(e,n)>=0});class zh{constructor(e,n,s,h,m,p){this.type=Vi,this.number=e,this.locale=n,this.currency=s,this.unit=h,this.minFractionDigits=m,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let s=n.parse(e[1],1,Et);if(!s)return null;let h=e[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=n.parse(h.locale,1,Vi),!m))return null;let p=null;if(h.currency&&(p=n.parse(h.currency,1,Vi),!p))return null;let b=null;if(h.unit&&(b=n.parse(h.unit,1,Vi),!b))return null;let y=null;if(h["min-fraction-digits"]&&(y=n.parse(h["min-fraction-digits"],1,Et),!y))return null;let w=null;return h["max-fraction-digits"]&&(w=n.parse(h["max-fraction-digits"],1,Et),!w)?null:new zh(s,m,p,b,y,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Nf{constructor(e){this.type=Et,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let s=n.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${lr(s.type)} instead.`):new Nf(s):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Er(`Expected value to be of type string or array, but found ${lr(yr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function c0(i){return function(){i=1831565813+(i|=0)|0;let e=Math.imul(i^i>>>15,1|i);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Bl={"==":mx,"!=":o0,">":s0,"<":a0,">=":Bf,"<=":l0,array:xa,at:Lf,boolean:xa,case:zf,coalesce:am,collator:qs,format:vh,image:xh,in:Ff,"index-of":lm,interpolate:Vo,"interpolate-hcl":Vo,"interpolate-lab":Vo,length:Nf,let:sm,literal:us,match:Qc,number:xa,"number-format":zh,object:xa,slice:cm,step:Oh,string:xa,"to-boolean":wa,"to-color":wa,"to-number":wa,"to-string":wa,var:tm,within:$s,distance:Ll,config:Wr};function d0(i,[e,n,s,h]){e=e.evaluate(i),n=n.evaluate(i),s=s.evaluate(i);let m=h?h.evaluate(i):1,p=B_(e,n,s,m);if(p)throw new Er(p);return new Ni(e/255*m,n/255*m,s/255*m,m)}function h0(i,[e,n,s,h]){e=e.evaluate(i),n=n.evaluate(i),s=s.evaluate(i);let m=h?h.evaluate(i):1,p=function(w,M,T,E){return typeof w=="number"&&w>=0&&w<=360?typeof M=="number"&&M>=0&&M<=100&&typeof T=="number"&&T>=0&&T<=100?E===void 0||typeof E=="number"&&E>=0&&E<=1?null:`Invalid hsla value [${[w,M,T,E].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof E=="number"?[w,M,T,E]:[w,M,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof E=="number"?[w,M,T,E]:[w,M,T]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,s,m);if(p)throw new Er(p);let b=`hsla(${e}, ${n}%, ${s}%, ${m})`,y=Ni.parse(b);if(!y)throw new Er(`Failed to parse HSLA color: ${b}`);return y}function u0(i,e){return i in e}function Vf(i,e){let n=e[i];return n===void 0?null:n}function Nl(i){return{type:i}}function m0(i){return{result:"success",value:i}}function Vl(i){return{result:"error",value:i}}function p0(i,e){return!!i&&!!i.parameters&&i.parameters.indexOf(e)>-1}function dm(i){return i["property-type"]==="data-driven"}function px(i){return p0(i.expression,"measure-light")}function f(i){return p0(i.expression,"zoom")}function a(i){return!!i.expression&&i.expression.interpolated}function u(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function _(i){return i}function v(i,e){let n=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",h=s||!(s||i.property!==void 0),m=i.type||(a(e)?"exponential":"interval");if(n&&((i=uf({},i)).stops&&(i.stops=i.stops.map(w=>[w[0],Ni.parse(w[1])])),i.default=Ni.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!n0[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,b,y;if(m==="exponential")p=D;else if(m==="interval")p=k;else if(m==="categorical"){p=S,b=Object.create(null);for(let w of i.stops)b[w[0]]=w[1];y=typeof i.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);p=A}if(s){let w={},M=[];for(let P=0;P<i.stops.length;P++){let R=i.stops[P],F=R[0].zoom;w[F]===void 0&&(w[F]={zoom:F,type:i.type,property:i.property,default:i.default,stops:[]},M.push(F)),w[F].stops.push([R[0].value,R[1]])}let T=[];for(let P of M)T.push([w[P].zoom,v(w[P],e)]);let E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:Vo.interpolationFactor.bind(void 0,E),zoomStops:T.map(P=>P[0]),evaluate:({zoom:P},R)=>D({stops:T,base:i.base},e,P).evaluate(P,R)}}if(h){let w=m==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Vo.interpolationFactor.bind(void 0,w),zoomStops:i.stops.map(M=>M[0]),evaluate:({zoom:M})=>p(i,e,M,b,y)}}return{kind:"source",evaluate(w,M){let T=M&&M.properties?M.properties[i.property]:void 0;return T===void 0?x(i.default,e.default):p(i,e,T,b,y)}}}function x(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function S(i,e,n,s,h){return x(typeof n===h?s[n]:void 0,i.default,e.default)}function k(i,e,n){if(Ol(n)!=="number")return x(i.default,e.default);let s=i.stops.length;if(s===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[s-1][0])return i.stops[s-1][1];let h=im(i.stops.map(m=>m[0]),n);return i.stops[h][1]}function D(i,e,n){let s=i.base!==void 0?i.base:1;if(Ol(n)!=="number")return x(i.default,e.default);let h=i.stops.length;if(h===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[h-1][0])return i.stops[h-1][1];let m=im(i.stops.map(M=>M[0]),n),p=function(M,T,E,P){let R=P-E,F=M-E;return R===0?0:T===1?F/R:(Math.pow(T,F)-1)/(Math.pow(T,R)-1)}(n,s,i.stops[m][0],i.stops[m+1][0]),b=i.stops[m][1],y=i.stops[m+1][1],w=$u[e.type]||_;if(i.colorSpace&&i.colorSpace!=="rgb"){let M=n0[i.colorSpace];w=(T,E)=>M.reverse(M.interpolate(M.forward(T),M.forward(E),p))}return typeof b.evaluate=="function"?{evaluate(...M){let T=b.evaluate.apply(void 0,M),E=y.evaluate.apply(void 0,M);if(T!==void 0&&E!==void 0)return w(T,E,p)}}:w(b,y,p)}function A(i,e,n){return e.type==="color"?n=Ni.parse(n):e.type==="formatted"?n=eo.fromString(n.toString()):e.type==="resolvedImage"?n=_o.fromString(n.toString()):Ol(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),x(n,i.default,e.default)}oo.register(Bl,{error:[{kind:"error"},[Vi],(i,[e])=>{throw new Er(e.evaluate(i))}],typeof:[Vi,[Fi],(i,[e])=>lr(yr(e.evaluate(i)))],"to-rgba":[Mo(Et,4),[go],(i,[e])=>e.evaluate(i).toRenderColor(null).toArray()],rgb:[go,[Et,Et,Et],d0],rgba:[go,[Et,Et,Et,Et],d0],hsl:[go,[Et,Et,Et],h0],hsla:[go,[Et,Et,Et,Et],h0],has:{type:ji,overloads:[[[Vi],(i,[e])=>u0(e.evaluate(i),i.properties())],[[Vi,Wc],(i,[e,n])=>u0(e.evaluate(i),n.evaluate(i))]]},get:{type:Fi,overloads:[[[Vi],(i,[e])=>Vf(e.evaluate(i),i.properties())],[[Vi,Wc],(i,[e,n])=>Vf(e.evaluate(i),n.evaluate(i))]]},"feature-state":[Fi,[Vi],(i,[e])=>Vf(e.evaluate(i),i.featureState||{})],properties:[Wc,[],i=>i.properties()],"geometry-type":[Vi,[],i=>i.geometryType()],id:[Fi,[],i=>i.id()],zoom:[Et,[],i=>i.globals.zoom],pitch:[Et,[],i=>i.globals.pitch||0],"distance-from-center":[Et,[],i=>i.distanceFromCenter()],"measure-light":[Et,[Vi],(i,[e])=>i.measureLight(e.evaluate(i))],"heatmap-density":[Et,[],i=>i.globals.heatmapDensity||0],"line-progress":[Et,[],i=>i.globals.lineProgress||0],"raster-value":[Et,[],i=>i.globals.rasterValue||0],"raster-particle-speed":[Et,[],i=>i.globals.rasterParticleSpeed||0],"sky-radial-progress":[Et,[],i=>i.globals.skyRadialProgress||0],accumulated:[Fi,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Et,Nl(Et),(i,e)=>{let n=0;for(let s of e)n+=s.evaluate(i);return n}],"*":[Et,Nl(Et),(i,e)=>{let n=1;for(let s of e)n*=s.evaluate(i);return n}],"-":{type:Et,overloads:[[[Et,Et],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[Et],(i,[e])=>-e.evaluate(i)]]},"/":[Et,[Et,Et],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[Et,[Et,Et],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[Et,[],()=>Math.LN2],pi:[Et,[],()=>Math.PI],e:[Et,[],()=>Math.E],"^":[Et,[Et,Et],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[Et,[Et],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Et,[Et],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Et,[Et],(i,[e])=>Math.log(e.evaluate(i))],log2:[Et,[Et],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Et,[Et],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Et,[Et],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Et,[Et],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Et,[Et],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Et,[Et],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Et,[Et],(i,[e])=>Math.atan(e.evaluate(i))],min:[Et,Nl(Et),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[Et,Nl(Et),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[Et,[Et],(i,[e])=>Math.abs(e.evaluate(i))],round:[Et,[Et],(i,[e])=>{let n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Et,[Et],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Et,[Et],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ji,[Vi,Fi],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[ji,[Fi],(i,[e])=>i.id()===e.value],"filter-type-==":[ji,[Vi],(i,[e])=>i.geometryType()===e.value],"filter-<":[ji,[Vi,Fi],(i,[e,n])=>{let s=i.properties()[e.value],h=n.value;return typeof s==typeof h&&s<h}],"filter-id-<":[ji,[Fi],(i,[e])=>{let n=i.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[ji,[Vi,Fi],(i,[e,n])=>{let s=i.properties()[e.value],h=n.value;return typeof s==typeof h&&s>h}],"filter-id->":[ji,[Fi],(i,[e])=>{let n=i.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[ji,[Vi,Fi],(i,[e,n])=>{let s=i.properties()[e.value],h=n.value;return typeof s==typeof h&&s<=h}],"filter-id-<=":[ji,[Fi],(i,[e])=>{let n=i.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[ji,[Vi,Fi],(i,[e,n])=>{let s=i.properties()[e.value],h=n.value;return typeof s==typeof h&&s>=h}],"filter-id->=":[ji,[Fi],(i,[e])=>{let n=i.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[ji,[Fi],(i,[e])=>e.value in i.properties()],"filter-has-id":[ji,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ji,[Mo(Vi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ji,[Mo(Fi)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ji,[Vi,Mo(Fi)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ji,[Vi,Mo(Fi)],(i,[e,n])=>function(s,h,m,p){for(;m<=p;){let b=m+p>>1;if(h[b]===s)return!0;h[b]>s?p=b-1:m=b+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:ji,overloads:[[[ji,ji],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[Nl(ji),(i,e)=>{for(let n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:ji,overloads:[[[ji,ji],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[Nl(ji),(i,e)=>{for(let n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[ji,[ji],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ji,[Vi],(i,[e])=>{let n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[Vi,[Vi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Vi,[Vi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Vi,Nl(Fi),(i,e)=>e.map(n=>Xo(n.evaluate(i))).join("")],"resolved-locale":[Vi,[va],(i,[e])=>e.evaluate(i).resolvedLocale()],random:[Et,[Et,Et,Fi],(i,e)=>{let[n,s,h]=e.map(p=>p.evaluate(i));if(n>s||n===s)return n;let m;if(typeof h=="string")m=function(p){let b=0;if(p.length===0)return b;for(let y=0;y<p.length;y++)b=(b<<5)-b+p.charCodeAt(y),b|=0;return b}(h);else{if(typeof h!="number")throw new Er(`Invalid seed input: ${h}`);m=h}return n+c0(m)()*(s-n)}]});class L{constructor(e,n,s,h){this.expression=e,this._warningHistory={},this._evaluator=new V_(s,h),this._defaultValue=n?function(m){return m.type==="color"&&(u(m.default)||Array.isArray(m.default))?new Ni(0,0,0,0):m.type==="color"?Ni.parse(m.default)||null:m.default===void 0?null:m.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,s,h,m,p,b,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,h,m,p,b,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=y||null;try{let w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Er(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function B(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Bl}function U(i,e,n,s){let h=new Q_(Bl,[],e?function(p){let b={color:go,string:Vi,number:Et,enum:Vi,boolean:ji,formatted:Hc,resolvedImage:Wa};return p.type==="array"?Mo(b[p.value]||Fi,p.length):b[p.type]}(e):void 0,void 0,void 0,n,s),m=h.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?m0(new L(m,e,n,s)):Vl(h.errors)}class W{constructor(e,n,s){this.kind=e,this._styleExpression=n,this.isLightConstant=s,this.isStateDependent=e!=="constant"&&!em(n.expression),this.isConfigDependent=!Ef(n.expression)}evaluateWithoutErrorHandling(e,n,s,h,m,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,h,m,p)}evaluate(e,n,s,h,m,p){return this._styleExpression.evaluate(e,n,s,h,m,p)}}class Y{constructor(e,n,s,h,m){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!em(n.expression),this.isLightConstant=m,this.isConfigDependent=!Ef(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,n,s,h,m,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,h,m,p)}evaluate(e,n,s,h,m,p){return this._styleExpression.evaluate(e,n,s,h,m,p)}interpolationFactor(e,n,s){return this.interpolationType?Vo.interpolationFactor(this.interpolationType,e,n,s):0}}function Z(i,e,n,s){if((i=U(i,e,n,s)).result==="error")return i;let h=i.value.expression,m=Ks(h);if(!m&&!dm(e))return Vl([new Ua("","data expressions not supported")]);let p=Dh(h,["zoom","pitch","distance-from-center"]);if(!p&&!f(e))return Vl([new Ua("","zoom expressions not supported")]);let b=Dh(h,["measure-light"]);if(!b&&!px(e))return Vl([new Ua("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,w=Q(h);return w||p||y?w instanceof Ua?Vl([w]):w instanceof Vo&&!a(e)?Vl([new Ua("",'"interpolate" expressions cannot be used with this property')]):m0(w?new Y(m?"camera":"composite",i.value,w.labels,w instanceof Vo?w.interpolation:void 0,b):new W(m?"constant":"source",i.value,b)):Vl([new Ua("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class X{constructor(e,n){this._parameters=e,this._specification=n,uf(this,v(this._parameters,this._specification))}static deserialize(e){return new X(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Q(i){let e=null;if(i instanceof sm)e=Q(i.result);else if(i instanceof am){for(let n of i.args)if(e=Q(n),e)break}else(i instanceof Oh||i instanceof Vo)&&i.input instanceof oo&&i.input.name==="zoom"&&(e=i);return e instanceof Ua||i.eachChild(n=>{let s=Q(n);s instanceof Ua?e=s:e&&s&&e!==s&&(e=new Ua("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var re=ae,oe=3;function ae(i,e,n){var s=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(e=h[1])+2*(n=h[2]);for(var m=0;m<this.d*this.d;m++){var p=h[oe+m],b=h[oe+m+1];s.push(p===b?null:h.subarray(p,b))}var y=h[oe+s.length+1];this.keys=h.subarray(h[oe+s.length],y),this.bboxes=h.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var w=0;w<this.d*this.d;w++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=n,this.scale=e/i,this.uid=0;var M=n/e*i;this.min=-M,this.max=i+M}ae.prototype.insert=function(i,e,n,s,h){this._forEachCell(e,n,s,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(h)},ae.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ae.prototype._insertCell=function(i,e,n,s,h,m){this.cells[h].push(m)},ae.prototype.query=function(i,e,n,s,h){var m=this.min,p=this.max;if(i<=m&&e<=m&&p<=n&&p<=s&&!h)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(i,e,n,s,this._queryCell,b,{},h),b},ae.prototype._queryCell=function(i,e,n,s,h,m,p,b){var y=this.cells[h];if(y!==null)for(var w=this.keys,M=this.bboxes,T=0;T<y.length;T++){var E=y[T];if(p[E]===void 0){var P=4*E;(b?b(M[P+0],M[P+1],M[P+2],M[P+3]):i<=M[P+2]&&e<=M[P+3]&&n>=M[P+0]&&s>=M[P+1])?(p[E]=!0,m.push(w[E])):p[E]=!1}}},ae.prototype._forEachCell=function(i,e,n,s,h,m,p,b){for(var y=this._convertToCellCoord(i),w=this._convertToCellCoord(e),M=this._convertToCellCoord(n),T=this._convertToCellCoord(s),E=y;E<=M;E++)for(var P=w;P<=T;P++){var R=this.d*P+E;if((!b||b(this._convertFromCellCoord(E),this._convertFromCellCoord(P),this._convertFromCellCoord(E+1),this._convertFromCellCoord(P+1)))&&h.call(this,i,e,n,s,R,m,p,b))return}},ae.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},ae.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},ae.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=oe+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var h=new Int32Array(e+n+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var m=e,p=0;p<i.length;p++){var b=i[p];h[oe+p]=m,h.set(b,m),m+=b.length}return h[oe+i.length]=m,h.set(this.keys,m),h[oe+i.length+1]=m+=this.keys.length,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer};var _e=Ge(re);let ge={};function ne(i,e,n={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writable:!1}),ge[e]={klass:i,omit:n.omit||[]}}ne(Object,"Object"),_e.serialize=function(i,e){let n=i.toArrayBuffer();return e&&e.add(n),{buffer:n}},_e.deserialize=function(i){return new _e(i.buffer)},Object.defineProperty(_e,"name",{value:"Grid"}),ne(_e,"Grid"),ne(Ni,"Color"),ne(Error,"Error"),ne(eo,"Formatted"),ne(Pl,"FormattedSection"),ne(rf,"AJAXError"),ne(_o,"ResolvedImage"),ne(X,"StylePropertyFunction"),ne(L,"StyleExpression",{omit:["_evaluator"]}),ne(Y,"ZoomDependentExpression"),ne(W,"ZoomConstantExpression"),ne(oo,"CompoundExpression",{omit:["_evaluate"]});for(let i in Bl)ge[Bl[i]._classRegistryKey]||ne(Bl[i],`Expression${i}`);function se(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function le(i){return self.ImageBitmap&&i instanceof ImageBitmap}function we(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(se(i)||le(i))return e&&e.add(i),i;if(ArrayBuffer.isView(i)){let n=i;return e&&e.add(n.buffer),n}if(i instanceof ImageData)return e&&e.add(i.data.buffer),i;if(Array.isArray(i)){let n=[];for(let s of i)n.push(we(s,e));return n}if(i instanceof Map){let n={$name:"Map"};for(let[s,h]of i.entries())n[s]=we(h);return n}if(typeof i=="object"){let n=i.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);let h=n.serialize?n.serialize(i,e):{};if(!n.serialize){for(let m in i)i.hasOwnProperty(m)&&(ge[s].omit.indexOf(m)>=0||(h[m]=we(i[m],e)));i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(h.$name=s),h}throw new Error("can't serialize object of type "+typeof i)}function Re(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||se(i)||le(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Re);if(typeof i=="object"){let e=i.$name||"Object";if(e==="Map"){let h=new Map;for(let m of Object.keys(i))m!=="$name"&&h.set(m,Re(i[m]));return h}let{klass:n}=ge[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);let s=Object.create(n.prototype);for(let h of Object.keys(i))h!=="$name"&&(s[h]=Re(i[h]));return s}throw new Error("can't deserialize object of type "+typeof i)}let me={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519,"CJK Unified Ideographs Extension B":i=>i>=131072&&i<=173791};function Le(i){for(let e of i)if(Je(e.charCodeAt(0)))return!0;return!1}function Be(i){for(let e of i)if(!Qe(e.charCodeAt(0)))return!1;return!0}function Qe(i){return!(me.Arabic(i)||me["Arabic Supplement"](i)||me["Arabic Extended-A"](i)||me["Arabic Presentation Forms-A"](i)||me["Arabic Presentation Forms-B"](i))}function Je(i){return!(i!==746&&i!==747&&(i<4352||!(me["Bopomofo Extended"](i)||me.Bopomofo(i)||me["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||me["CJK Compatibility Ideographs"](i)||me["CJK Compatibility"](i)||me["CJK Radicals Supplement"](i)||me["CJK Strokes"](i)||!(!me["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||me["CJK Unified Ideographs Extension A"](i)||me["CJK Unified Ideographs"](i)||me["Enclosed CJK Letters and Months"](i)||me["Hangul Compatibility Jamo"](i)||me["Hangul Jamo Extended-A"](i)||me["Hangul Jamo Extended-B"](i)||me["Hangul Jamo"](i)||me["Hangul Syllables"](i)||me.Hiragana(i)||me["Ideographic Description Characters"](i)||me.Kanbun(i)||me["Kangxi Radicals"](i)||me["Katakana Phonetic Extensions"](i)||me.Katakana(i)&&i!==12540||!(!me["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!me["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||me["Unified Canadian Aboriginal Syllabics"](i)||me["Unified Canadian Aboriginal Syllabics Extended"](i)||me["Vertical Forms"](i)||me["Yijing Hexagram Symbols"](i)||me["Yi Syllables"](i)||me["Yi Radicals"](i))))}function Xe(i){return!(Je(i)||function(e){return!!(me["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||me["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||me["Letterlike Symbols"](e)||me["Number Forms"](e)||me["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||me["Control Pictures"](e)&&e!==9251||me["Optical Character Recognition"](e)||me["Enclosed Alphanumerics"](e)||me["Geometric Shapes"](e)||me["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||me["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||me["CJK Symbols and Punctuation"](e)||me.Katakana(e)||me["Private Use Area"](e)||me["CJK Compatibility Forms"](e)||me["Small Form Variants"](e)||me["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Ee(i){return i>=1424&&i<=2303||me["Arabic Presentation Forms-A"](i)||me["Arabic Presentation Forms-B"](i)}function Ve(i,e){return!(!e&&Ee(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||me.Khmer(i))}function Ze(i){for(let e of i)if(Ee(e.charCodeAt(0)))return!0;return!1}let bt="deferred",vt="loading",It="loaded",xt=null,it="unavailable",$e=null,Dt=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(it="error"),xt&&xt(i)};function si(){ti.fire(new fo("pluginStateChange",{pluginStatus:it,pluginURL:$e}))}let ti=new Al,xi=function(){return it},Pi=function(){if(it!==bt||!$e)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");it=vt,si(),$e&&El({url:$e},i=>{i?Dt(i):(it=It,si())})},tn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>it===It||tn.applyArabicShaping!=null,isLoading:()=>it===vt,setState(i){it=i.pluginStatus,$e=i.pluginURL},isParsed:()=>tn.applyArabicShaping!=null&&tn.processBidirectionalText!=null&&tn.processStyledBidirectionalText!=null,getPluginURL:()=>$e};class Kt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,s){for(let h of n)if(!Ve(h.charCodeAt(0),s))return!1;return!0}(e,tn.isLoaded())}}class qi{constructor(e,n,s,h){this.property=e,this.value=n,this.expression=function(m,p,b,y){if(u(m))return new X(m,p);if(B(m)||Array.isArray(m)&&m.length>0){let w=Z(m,p,b,y);if(w.result==="error")throw new Error(w.value.map(M=>`${M.key}: ${M.message}`).join(", "));return w.value}{let w=m;return typeof m=="string"&&p.type==="color"&&(w=Ni.parse(m)),{kind:"constant",isConfigDependent:!1,evaluate:()=>w}}}(n===void 0?e.specification.default:n,e.specification,s,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class pn{constructor(e,n,s){this.property=e,this.value=new qi(e,void 0,n,s)}transitioned(e,n){return new Si(this.property,this.value,n,Jr({},e.transition,this.transition),e.now)}untransitioned(){return new Si(this.property,this.value,null,{},0)}}class Ji{constructor(e,n,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=s,this.isConfigDependent=!1}getValue(e){return Va(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new pn(this._values[e].property,this._scope,this._options)),this._values[e].value=new qi(this._values[e].property,n===null?void 0:Va(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let s=this._properties.properties;if(e)for(let h in e){let m=e[h];if(oh(h,"-transition")){let p=h.slice(0,-11);s[p]&&this.setTransition(p,m)}else s.hasOwnProperty(h)&&this.setValue(h,m)}}getTransition(e){return Va(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new pn(this._values[e].property)),this._values[e].transition=Va(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let s=this.getValue(n);s!==void 0&&(e[n]=s);let h=this.getTransition(n);h!==void 0&&(e[`${n}-transition`]=h)}return e}transitioned(e,n){let s=new ri(this._properties);for(let h of Object.keys(this._values))s._values[h]=this._values[h].transitioned(e,n._values[h]);return s}untransitioned(){let e=new ri(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Si{constructor(e,n,s,h,m){let p=h.delay||0,b=h.duration||0;m=m||0,this.property=e,this.value=n,this.begin=m+p,this.end=this.begin+b,e.specification.transition&&(h.delay||h.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){let h=e.now||0,m=this.value.possiblyEvaluate(e,n,s),p=this.prior;if(p){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return p.possiblyEvaluate(e,n,s);{let b=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,s),m,Hp(b))}}return m}}class ri{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){let h=new on(this._properties);for(let m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,n,s);return h}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class vn{constructor(e,n,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=s,this.isConfigDependent=!1}getValue(e){return Va(this._values[e].value)}setValue(e,n){this._values[e]=new qi(this._values[e].property,n===null?void 0:Va(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let s=this.getValue(n);s!==void 0&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){let h=new on(this._properties);for(let m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,n,s);return h}}class kn{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,s,h){return this.property.evaluate(this.value,this.parameters,e,n,s,h)}}class on{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ke{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){let h=$u[this.specification.type];return h?h(e,n,s):e}}class St{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,h){return new kn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},s,h)}:e.expression,n)}interpolate(e,n,s){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new kn(this,{kind:"constant",value:void 0},e.parameters);let h=$u[this.specification.type];return h?new kn(this,{kind:"constant",value:h(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,h,m,p){return e.kind==="constant"?e.value:e.evaluate(n,s,h,m,p)}}class zn{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,h){return!!e.expression.evaluate(n,null,{},s,h)}interpolate(){return!1}}class $i{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new Kt(0,{});for(let s in e){let h=e[s];h.specification.overridable&&this.overridableProperties.push(s);let m=this.defaultPropertyValues[s]=new qi(h,void 0),p=this.defaultTransitionablePropertyValues[s]=new pn(h);this.defaultTransitioningPropertyValues[s]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=m.possiblyEvaluate(n)}}}ne(St,"DataDrivenProperty"),ne(Ke,"DataConstantProperty"),ne(zn,"ColorRampProperty");var Pe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function jo(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Hr(i){if(Array.isArray(i))return i.map(Hr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let e={};for(let n in i)e[n]=Hr(i[n]);return e}return jo(i)}function ao(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let e of i.slice(1))if(!ao(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Dr(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ao(i)||(i=Ga(i));let n=i,s=!0;try{s=function(w){if(!Uo(w))return w;let M=Hr(w);return Ma(M),M=yo(M),M}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let h=Pe[`filter_${e}`],m=U(s,h),p=null;if(m.result==="error")throw new Error(m.value.map(w=>`${w.key}: ${w.message}`).join(", "));p=(w,M,T)=>m.value.evaluate(w,M,{},T);let b=null,y=null;if(s!==n){let w=U(n,h);if(w.result==="error")throw new Error(w.value.map(M=>`${M.key}: ${M.message}`).join(", "));b=(M,T,E,P,R)=>w.value.evaluate(M,T,{},E,void 0,void 0,P,R),y=!Ks(w.value.expression)}return{filter:p,dynamicFilter:b||void 0,needGeometry:ps(s),needFeature:!!y}}function yo(i){if(!Array.isArray(i))return i;let e=function(n){if(Js.has(n[0])){for(let s=1;s<n.length;s++)if(Uo(n[s]))return!0}return n}(i);return e===!0?e:e.map(n=>yo(n))}function Ma(i){let e=!1,n=[];if(i[0]==="case"){for(let s=1;s<i.length-1;s+=2)e=e||Uo(i[s]),n.push(i[s+1]);n.push(i[i.length-1])}else if(i[0]==="match"){e=e||Uo(i[1]);for(let s=2;s<i.length-1;s+=2)n.push(i[s+1]);n.push(i[i.length-1])}else if(i[0]==="step"){e=e||Uo(i[1]);for(let s=1;s<i.length-1;s+=2)n.push(i[s+1])}e&&(i.length=0,i.push("any",...n));for(let s=1;s<i.length;s++)Ma(i[s])}function Uo(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<i.length;n++)if(Uo(i[n]))return!0;return!1}let Js=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function el(i,e){return i<e?-1:i>e?1:0}function ps(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(ps(i[e]))return!0;return!1}function Ga(i){if(!i)return!0;let e=i[0];return i.length<=1?e!=="any":e==="=="?fs(i[1],i[2],"=="):e==="!="?jl(fs(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?fs(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(Ga))):e==="all"?["all"].concat(i.slice(1).map(Ga)):e==="none"?["all"].concat(i.slice(1).map(Ga).map(jl)):e==="in"?Kc(i[1],i.slice(2)):e==="!in"?jl(Kc(i[1],i.slice(2))):e==="has"?Jc(i[1]):e!=="!has"||jl(Jc(i[1]));var n}function fs(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Kc(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(el)]]:["filter-in-small",i,["literal",e]]}}function Jc(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function jl(i){return["!",i]}let ed="";function hm(i,e){return e?`${i}${ed}${e}`:i}let um="-transition",jf=new Set(["fill","line","background","hillshade","raster"]);class Sr extends Al{constructor(e,n,s,h,m){if(super(),this.id=e.id,this.fqid=hm(this.id,s),this.type=e.type,this.scope=s,this.lut=h,this.options=m,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new vn(n.layout,this.scope,m),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new Ji(n.paint,this.scope,m);for(let p in e.paint)this.setPaintProperty(p,e.paint[p]);for(let p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new on(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return jf.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,n),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return oh(e,um)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let s=this._transitionablePaint,h=s._properties.properties;if(oh(e,um)){let T=e.slice(0,-11);return h[T]&&s.setTransition(T,n||void 0),!1}if(!h[e])return!1;let m=s._values[e],p=m.value.isDataDriven(),b=m.value;s.setValue(e,n),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=s._values[e].value,w=y.isDataDriven(),M=oh(e,"pattern")||e==="line-dasharray";return w||p||M||this._handleOverridablePaintPropertyUpdate(e,b,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,s){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Il({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof kn&&dm(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Dr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,s,h,m,p,b,y,w){}queryIntersectsMatchingFeature(e,n,s,h){}}let Uf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class td{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Yi(i,e=1){let n=0,s=0;return{members:i.map(h=>{let m=Uf[h.type].BYTES_PER_ELEMENT,p=n=V2(n,Math.max(e,m)),b=h.components||1;return s=Math.max(s,m),n+=m*b,{name:h.name,type:h.type,components:b,offset:p}}),size:V2(n,Math.max(s,e)),alignment:e}}function V2(i,e){return Math.ceil(i/e)*e}class gs extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){let h=2*e;return this.int16[h+0]=n,this.int16[h+1]=s,e}}gs.prototype.bytesPerElement=4,ne(gs,"StructArrayLayout2i4");class f0 extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){let m=3*e;return this.int16[m+0]=n,this.int16[m+1]=s,this.int16[m+2]=h,e}}f0.prototype.bytesPerElement=6,ne(f0,"StructArrayLayout3i6");class id extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,h)}emplace(e,n,s,h,m){let p=4*e;return this.int16[p+0]=n,this.int16[p+1]=s,this.int16[p+2]=h,this.int16[p+3]=m,e}}id.prototype.bytesPerElement=8,ne(id,"StructArrayLayout4i8");class fx extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,s,h,m)}emplace(e,n,s,h,m,p){let b=5*e;return this.int16[b+0]=n,this.int16[b+1]=s,this.int16[b+2]=h,this.int16[b+3]=m,this.int16[b+4]=p,e}}fx.prototype.bytesPerElement=10,ne(fx,"StructArrayLayout5i10");class gx extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,h,m,p,b)}emplace(e,n,s,h,m,p,b,y){let w=6*e,M=12*e,T=3*e;return this.int16[w+0]=n,this.int16[w+1]=s,this.uint8[M+4]=h,this.uint8[M+5]=m,this.uint8[M+6]=p,this.uint8[M+7]=b,this.float32[T+2]=y,e}}gx.prototype.bytesPerElement=12,ne(gx,"StructArrayLayout2i4ub1f12");class nd extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,h)}emplace(e,n,s,h,m){let p=4*e;return this.float32[p+0]=n,this.float32[p+1]=s,this.float32[p+2]=h,this.float32[p+3]=m,e}}nd.prototype.bytesPerElement=16,ne(nd,"StructArrayLayout4f16");class rd extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){let m=3*e;return this.float32[m+0]=n,this.float32[m+1]=s,this.float32[m+2]=h,e}}rd.prototype.bytesPerElement=12,ne(rd,"StructArrayLayout3f12");class od extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,s,h,m)}emplace(e,n,s,h,m,p){let b=6*e,y=3*e;return this.uint16[b+0]=n,this.uint16[b+1]=s,this.uint16[b+2]=h,this.uint16[b+3]=m,this.float32[y+2]=p,e}}od.prototype.bytesPerElement=12,ne(od,"StructArrayLayout4ui1f12");class g0 extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,h)}emplace(e,n,s,h,m){let p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=s,this.uint16[p+2]=h,this.uint16[p+3]=m,e}}g0.prototype.bytesPerElement=8,ne(g0,"StructArrayLayout4ui8");class _0 extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m,p){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,s,h,m,p)}emplace(e,n,s,h,m,p,b){let y=6*e;return this.int16[y+0]=n,this.int16[y+1]=s,this.int16[y+2]=h,this.int16[y+3]=m,this.int16[y+4]=p,this.int16[y+5]=b,e}}_0.prototype.bytesPerElement=12,ne(_0,"StructArrayLayout6i12");class _x extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m,p,b,y,w,M,T,E){let P=this.length;return this.resize(P+1),this.emplace(P,e,n,s,h,m,p,b,y,w,M,T,E)}emplace(e,n,s,h,m,p,b,y,w,M,T,E,P){let R=12*e;return this.int16[R+0]=n,this.int16[R+1]=s,this.int16[R+2]=h,this.int16[R+3]=m,this.uint16[R+4]=p,this.uint16[R+5]=b,this.uint16[R+6]=y,this.uint16[R+7]=w,this.int16[R+8]=M,this.int16[R+9]=T,this.int16[R+10]=E,this.int16[R+11]=P,e}}_x.prototype.bytesPerElement=24,ne(_x,"StructArrayLayout4i4ui4i24");class bx extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m,p){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,s,h,m,p)}emplace(e,n,s,h,m,p,b){let y=10*e,w=5*e;return this.int16[y+0]=n,this.int16[y+1]=s,this.int16[y+2]=h,this.float32[w+2]=m,this.float32[w+3]=p,this.float32[w+4]=b,e}}bx.prototype.bytesPerElement=20,ne(bx,"StructArrayLayout3i3f20");class yx extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}yx.prototype.bytesPerElement=4,ne(yx,"StructArrayLayout1ul4");class Bh extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Bh.prototype.bytesPerElement=4,ne(Bh,"StructArrayLayout1f4");class ad extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){let h=2*e;return this.uint16[h+0]=n,this.uint16[h+1]=s,e}}ad.prototype.bytesPerElement=4,ne(ad,"StructArrayLayout2ui4");class vx extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m,p,b,y,w,M,T,E,P){let R=this.length;return this.resize(R+1),this.emplace(R,e,n,s,h,m,p,b,y,w,M,T,E,P)}emplace(e,n,s,h,m,p,b,y,w,M,T,E,P,R){let F=20*e,N=10*e;return this.int16[F+0]=n,this.int16[F+1]=s,this.int16[F+2]=h,this.int16[F+3]=m,this.int16[F+4]=p,this.float32[N+3]=b,this.float32[N+4]=y,this.float32[N+5]=w,this.float32[N+6]=M,this.int16[F+14]=T,this.uint32[N+8]=E,this.uint16[F+18]=P,this.uint16[F+19]=R,e}}vx.prototype.bytesPerElement=40,ne(vx,"StructArrayLayout5i4f1i1ul2ui40");class b0 extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,h,m,p,b)}emplace(e,n,s,h,m,p,b,y){let w=8*e;return this.int16[w+0]=n,this.int16[w+1]=s,this.int16[w+2]=h,this.int16[w+4]=m,this.int16[w+5]=p,this.int16[w+6]=b,this.int16[w+7]=y,e}}b0.prototype.bytesPerElement=16,ne(b0,"StructArrayLayout3i2i2i16");class xx extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,s,h,m)}emplace(e,n,s,h,m,p){let b=4*e,y=8*e;return this.float32[b+0]=n,this.float32[b+1]=s,this.float32[b+2]=h,this.int16[y+6]=m,this.int16[y+7]=p,e}}xx.prototype.bytesPerElement=16,ne(xx,"StructArrayLayout2f1f2i16");class wx extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,h)}emplace(e,n,s,h,m){let p=12*e,b=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=s,this.float32[b+1]=h,this.float32[b+2]=m,e}}wx.prototype.bytesPerElement=12,ne(wx,"StructArrayLayout2ub2f12");class Rr extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){let m=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=s,this.uint16[m+2]=h,e}}Rr.prototype.bytesPerElement=6,ne(Rr,"StructArrayLayout3ui6");class Cx extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m,p,b,y,w,M,T,E,P,R,F,N,H,J,ee,te,pe){let he=this.length;return this.resize(he+1),this.emplace(he,e,n,s,h,m,p,b,y,w,M,T,E,P,R,F,N,H,J,ee,te,pe)}emplace(e,n,s,h,m,p,b,y,w,M,T,E,P,R,F,N,H,J,ee,te,pe,he){let ve=30*e,Ce=15*e,Ae=60*e;return this.int16[ve+0]=n,this.int16[ve+1]=s,this.int16[ve+2]=h,this.float32[Ce+2]=m,this.float32[Ce+3]=p,this.uint16[ve+8]=b,this.uint16[ve+9]=y,this.uint32[Ce+5]=w,this.uint32[Ce+6]=M,this.uint32[Ce+7]=T,this.uint16[ve+16]=E,this.uint16[ve+17]=P,this.uint16[ve+18]=R,this.float32[Ce+10]=F,this.float32[Ce+11]=N,this.uint8[Ae+48]=H,this.uint8[Ae+49]=J,this.uint8[Ae+50]=ee,this.uint32[Ce+13]=te,this.int16[ve+28]=pe,this.uint8[Ae+58]=he,e}}Cx.prototype.bytesPerElement=60,ne(Cx,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Sx extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m,p,b,y,w,M,T,E,P,R,F,N,H,J,ee,te,pe,he,ve,Ce,Ae,Ue,ze,Ye,rt,qe,et,We,tt,ct){let nt=this.length;return this.resize(nt+1),this.emplace(nt,e,n,s,h,m,p,b,y,w,M,T,E,P,R,F,N,H,J,ee,te,pe,he,ve,Ce,Ae,Ue,ze,Ye,rt,qe,et,We,tt,ct)}emplace(e,n,s,h,m,p,b,y,w,M,T,E,P,R,F,N,H,J,ee,te,pe,he,ve,Ce,Ae,Ue,ze,Ye,rt,qe,et,We,tt,ct,nt){let kt=22*e,ot=44*e,ut=88*e;return this.float32[kt+0]=n,this.float32[kt+1]=s,this.int16[ot+4]=h,this.int16[ot+5]=m,this.int16[ot+6]=p,this.int16[ot+7]=b,this.int16[ot+8]=y,this.int16[ot+9]=w,this.int16[ot+10]=M,this.int16[ot+11]=T,this.int16[ot+12]=E,this.uint16[ot+13]=P,this.uint16[ot+14]=R,this.uint16[ot+15]=F,this.uint16[ot+16]=N,this.uint16[ot+17]=H,this.uint16[ot+18]=J,this.uint16[ot+19]=ee,this.uint16[ot+20]=te,this.uint16[ot+21]=pe,this.uint16[ot+22]=he,this.uint16[ot+23]=ve,this.uint16[ot+24]=Ce,this.uint16[ot+25]=Ae,this.uint16[ot+26]=Ue,this.uint16[ot+27]=ze,this.uint32[kt+14]=Ye,this.float32[kt+15]=rt,this.float32[kt+16]=qe,this.float32[kt+17]=et,this.float32[kt+18]=We,this.float32[kt+19]=tt,this.float32[kt+20]=ct,this.uint8[ut+84]=nt,e}}Sx.prototype.bytesPerElement=88,ne(Sx,"StructArrayLayout2f9i15ui1ul6f1ub88");class Nh extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,s,h,m)}emplace(e,n,s,h,m,p){let b=5*e;return this.float32[b+0]=n,this.float32[b+1]=s,this.float32[b+2]=h,this.float32[b+3]=m,this.float32[b+4]=p,e}}Nh.prototype.bytesPerElement=20,ne(Nh,"StructArrayLayout5f20");class Mx extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,h,m,p,b)}emplace(e,n,s,h,m,p,b,y){let w=7*e;return this.float32[w+0]=n,this.float32[w+1]=s,this.float32[w+2]=h,this.float32[w+3]=m,this.float32[w+4]=p,this.float32[w+5]=b,this.float32[w+6]=y,e}}Mx.prototype.bytesPerElement=28,ne(Mx,"StructArrayLayout7f28");class mm extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){let h=2*e;return this.float32[h+0]=n,this.float32[h+1]=s,e}}mm.prototype.bytesPerElement=8,ne(mm,"StructArrayLayout2f8");class kx extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,h)}emplace(e,n,s,h,m){let p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=s,this.uint16[p+3]=h,this.uint16[p+4]=m,e}}kx.prototype.bytesPerElement=12,ne(kx,"StructArrayLayout1ul3ui12");class Wf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Wf.prototype.bytesPerElement=2,ne(Wf,"StructArrayLayout1ui2");class Ix extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m,p,b,y,w,M,T,E,P,R,F,N){let H=this.length;return this.resize(H+1),this.emplace(H,e,n,s,h,m,p,b,y,w,M,T,E,P,R,F,N)}emplace(e,n,s,h,m,p,b,y,w,M,T,E,P,R,F,N,H){let J=16*e;return this.float32[J+0]=n,this.float32[J+1]=s,this.float32[J+2]=h,this.float32[J+3]=m,this.float32[J+4]=p,this.float32[J+5]=b,this.float32[J+6]=y,this.float32[J+7]=w,this.float32[J+8]=M,this.float32[J+9]=T,this.float32[J+10]=E,this.float32[J+11]=P,this.float32[J+12]=R,this.float32[J+13]=F,this.float32[J+14]=N,this.float32[J+15]=H,e}}Ix.prototype.bytesPerElement=64,ne(Ix,"StructArrayLayout16f64");class y0 extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,h,m,p,b)}emplace(e,n,s,h,m,p,b,y){let w=10*e,M=5*e;return this.uint16[w+0]=n,this.uint16[w+1]=s,this.uint16[w+2]=h,this.uint16[w+3]=m,this.float32[M+2]=p,this.float32[M+3]=b,this.float32[M+4]=y,e}}y0.prototype.bytesPerElement=20,ne(y0,"StructArrayLayout4ui3f20");class Tx extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}Tx.prototype.bytesPerElement=2,ne(Tx,"StructArrayLayout1i2");class Ex extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Ex.prototype.bytesPerElement=1,ne(Ex,"StructArrayLayout1ub1");class j2 extends td{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}j2.prototype.size=40;class Dx extends vx{get(e){return new j2(this,e)}}ne(Dx,"CollisionBoxArray");class U2 extends td{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}U2.prototype.size=60;class W2 extends Cx{get(e){return new U2(this,e)}}ne(W2,"PlacedSymbolArray");class H2 extends td{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}H2.prototype.size=88;class G2 extends Sx{get(e){return new H2(this,e)}}ne(G2,"SymbolInstanceArray");class q2 extends Bh{getoffsetX(e){return this.float32[1*e+0]}}ne(q2,"GlyphOffsetArray");class $2 extends gs{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ne($2,"SymbolLineVertexArray");class Y2 extends td{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Y2.prototype.size=12;class Z2 extends kx{get(e){return new Y2(this,e)}}ne(Z2,"FeatureIndexArray");class X2 extends ad{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ne(X2,"FillExtrusionCentroidArray");let LO=Yi([{name:"a_pos",components:2,type:"Int16"}],4),FO=Yi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Bn{constructor(e=[]){this.segments=e}_prepareSegment(e,n,s,h){let m=this.segments[this.segments.length-1];return e>Bn.MAX_VERTEX_ARRAY_LENGTH&&sr(`Max vertices per segment is ${Bn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Bn.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:n,primitiveOffset:s,vertexLength:0,primitiveLength:0},h!==void 0&&(m.sortKey=h),this.segments.push(m)),m}prepareSegment(e,n,s,h){return this._prepareSegment(e,n.length,s.length,h)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,h){return new Bn([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])}}function Q2(i,e){return 256*(i=gi(Math.floor(i),0,255))+gi(Math.floor(e),0,255)}Bn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ne(Bn,"SegmentVector");let zO=Yi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),BO=Yi([{name:"a_dash",components:4,type:"Uint16"}]);class Hf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,s,h){this.ids.push(K2(e)),this.positions.push(n,s,h)}eachPosition(e,n){let s=K2(e),h=0,m=this.ids.length-1;for(;h<m;){let p=h+m>>1;this.ids[p]>=s?m=p:h=p+1}for(;this.ids[h]===s;)n(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,n){let s=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Ax(s,h,0,s.length-1),n&&(n.add(s.buffer),n.add(h.buffer)),{ids:s,positions:h}}static deserialize(e){let n=new Hf,s;n.ids=e.ids,n.positions=e.positions;for(let h of n.ids)h!==s&&n.uniqueIds.push(h),s=h;return n.indexed=!0,n}}function K2(i){let e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Vc(String(i))}function Ax(i,e,n,s){for(;n<s;){let h=i[n+s>>1],m=n-1,p=s+1;for(;;){do m++;while(i[m]<h);do p--;while(i[p]>h);if(m>=p)break;v0(i,m,p),v0(e,3*m,3*p),v0(e,3*m+1,3*p+1),v0(e,3*m+2,3*p+2)}p-n<s-p?(Ax(i,e,n,p),n=p+1):(Ax(i,e,p+1,s),s=p)}}function v0(i,e,n){let s=i[e];i[e]=i[n],i[n]=s}ne(Hf,"FeaturePositionMap");class Ul{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class x0 extends Ul{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class ko extends Ul{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Wl extends Ul{constructor(e){super(e),this.current=[0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Px extends Ul{constructor(e){super(e),this.current=[0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Ox extends Ul{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class J2 extends Ul{constructor(e){super(e),this.current=Ni.transparent.toRenderColor(null)}set(e,n,s){this.fetchUniformLocation(e,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}let NO=new Float32Array(16);class Gf extends Ul{constructor(e){super(e),this.current=NO}set(e,n,s){if(this.fetchUniformLocation(e,n)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let h=1;h<16;h++)if(s[h]!==this.current[h]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}let VO=new Float32Array(9),jO=new Float32Array(4);class Rx extends Ul{constructor(e){super(e),this.current=jO}set(e,n,s){if(this.fetchUniformLocation(e,n)){for(let h=0;h<4;h++)if(s[h]!==this.current[h]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function Lx(i){return[Q2(255*i.r,255*i.g),Q2(255*i.b,255*i.a)]}class qf{constructor(e,n,s,h){this.value=e,this.uniformNames=n.map(m=>`u_${m}`),this.type=s,this.context=h}setUniform(e,n,s,h,m){let p=h.constantOr(this.value);n.set(e,m,p instanceof Ni?p.toRenderColor(this.context.lut):p)}getBinding(e,n){return this.type==="color"?new J2(e):new ko(e)}}class pm{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,s,h,m){let p=m==="u_pattern"||m==="u_dash"?this.pattern:m==="u_pixel_ratio"?this.pixelRatio:null;p&&n.set(e,m,p)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Ox(e):new ko(e)}}class Hl{constructor(e,n,s,h){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,n,s,h,m,p,b){let y=this.paintVertexArray.length,w=this.expression.evaluate(new Kt(0,{brightness:p}),n,{},m,h,b);this.paintVertexArray.resize(e),this._setPaintValue(y,e,w,this.context)}updatePaintArray(e,n,s,h,m,p,b){let y=this.expression.evaluate({zoom:0,brightness:b},s,h,void 0,m);this._setPaintValue(e,n,y,this.context)}_setPaintValue(e,n,s,h){if(this.type==="color"){let m=Lx(s.toRenderColor(h.lut));for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,m[0],m[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _s{constructor(e,n,s,h,m,p){this.expression=e,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=s,this.useIntegerZoom=h,this.context=m,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,s,h,m,p,b){let y=this.expression.evaluate(new Kt(this.context.zoom,{brightness:p}),n,{},m,h,b),w=this.expression.evaluate(new Kt(this.context.zoom+1,{brightness:p}),n,{},m,h,b),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,y,w,this.context)}updatePaintArray(e,n,s,h,m,p,b){let y=this.expression.evaluate({zoom:this.context.zoom,brightness:b},s,h,void 0,m),w=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b},s,h,void 0,m);this._setPaintValue(e,n,y,w,this.context)}_setPaintValue(e,n,s,h,m){if(this.type==="color"){let p=Lx(s.toRenderColor(m.lut)),b=Lx(s.toRenderColor(m.lut));for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,p[0],p[1],b[0],b[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,s,h,m){let p=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,b=gi(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);n.set(e,m,b)}getBinding(e,n){return new ko(e)}}class sd{constructor(e,n,s,h,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(s==="array"?BO:zO).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new h}populatePaintArray(e,n,s,h){let m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,h,m,p,b){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],p)}_setPaintValues(e,n,s,h){if(!h||!s)return;let m=h[s];if(!m)return;let{tl:p,br:b,pixelRatio:y}=m;for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,p[0],p[1],b[0],b[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vh{constructor(e,n,s=()=>!0){this.binders={},this._buffers=[],this.context=n;let h=[];for(let m in e.paint._values){let p=e.paint.get(m);if(!s(m)||!(p instanceof kn&&dm(p.property.specification)))continue;let b=WO(m,e.type),y=p.value,w=p.property.specification.type,M=!!p.property.useIntegerZoom,T=m==="line-dasharray"||m.endsWith("pattern"),E=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||E)if(y.kind==="source"||E||T){let P=eS(m,w,"source");this.binders[m]=T?new sd(y,b,w,P,e.id):new Hl(y,b,w,P),h.push(`/a_${m}`)}else{let P=eS(m,w,"composite");this.binders[m]=new _s(y,b,w,M,n,P),h.push(`/z_${m}`)}else this.binders[m]=T?new pm(y.value,b):new qf(y.value,b,w,n),h.push(`/u_${m}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof Hl||n instanceof _s?n.maxValue:0}populatePaintArrays(e,n,s,h,m,p,b){for(let y in this.binders){let w=this.binders[y];w.context=this.context,(w instanceof Hl||w instanceof _s||w instanceof sd)&&w.populatePaintArray(e,n,s,h,m,p,b)}}setConstantPatternPositions(e){for(let n in this.binders){let s=this.binders[n];s instanceof pm&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,n,s,h,m,p,b,y){let w=!1,M=Object.keys(e),T=M.length!==0,E=T?M:n.uniqueIds;this.context.lut=m.lut;for(let P in this.binders){let R=this.binders[P];if(R.context=this.context,(R instanceof Hl||R instanceof _s||R instanceof sd)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){let F=m.paint.get(P);R.expression=F.value;for(let N of E){let H=e[N.toString()];n.eachPosition(N,(J,ee,te)=>{let pe=h.feature(J);R.updatePaintArray(ee,te,pe,H,p,b,y)})}if(!T)for(let N of s.uniqueIds){let H=e[N.toString()];s.eachPosition(N,(J,ee,te)=>{let pe=h.feature(J);R.updatePaintArray(ee,te,pe,H,p,b,y)})}w=!0}}return w}defines(){let e=[];for(let n in this.binders){let s=this.binders[n];(s instanceof qf||s instanceof pm)&&e.push(...s.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let s=this.binders[n];if(s instanceof Hl||s instanceof _s||s instanceof sd)for(let h=0;h<s.paintVertexAttributes.length;h++)e.push(s.paintVertexAttributes[h].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let s=this.binders[n];if(s instanceof qf||s instanceof pm||s instanceof _s)for(let h of s.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let s in this.binders){let h=this.binders[s];if(h instanceof qf||h instanceof pm||h instanceof _s)for(let m of h.uniformNames)n.push({name:m,property:s,binding:h.getBinding(e,m)})}return n}setUniforms(e,n,s,h,m){for(let{name:p,property:b,binding:y}of s)this.binders[b].setUniform(e,y,m,h.get(b),p)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof Hl||n instanceof _s||n instanceof sd)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let s=this.binders[n];(s instanceof Hl||s instanceof _s||s instanceof sd)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof Hl||n instanceof _s||n instanceof sd)&&n.destroy()}}}class ld{constructor(e,n,s=()=>!0){this.programConfigurations={};for(let h of e)this.programConfigurations[h.id]=new Vh(h,n,s);this.needsUpload=!1,this._featureMap=new Hf,this._featureMapWithoutIds=new Hf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,s,h,m,p,b,y){for(let w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,n,h,m,p,b,y);n.id!==void 0?this._featureMap.add(n.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,h,m,p){for(let b of s)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,b,h,m,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let UO={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function WO(i,e){return UO[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}let HO={"line-pattern":{source:od,composite:od},"fill-pattern":{source:od,composite:od},"fill-extrusion-pattern":{source:od,composite:od},"line-dasharray":{source:g0,composite:g0}},GO={color:{source:mm,composite:nd},number:{source:Bh,composite:mm}};function eS(i,e,n){let s=HO[i];return s&&s[n]||GO[e][n]}ne(qf,"ConstantBinder"),ne(pm,"PatternConstantBinder"),ne(Hl,"SourceExpressionBinder"),ne(sd,"PatternCompositeBinder"),ne(_s,"CompositeExpressionBinder"),ne(Vh,"ProgramConfiguration",{omit:["_buffers"]}),ne(ld,"ProgramConfigurationSet");let Io=pt/Math.PI/2,Fx=5,tS=6,qO=16383,fm=64,zx=[fm,32,16],qa=-Io,$a=Io;function gm(i,e,n,s=Io){return n=Ai(n),[i*Math.sin(n)*s,-e*s,i*Math.cos(n)*s]}function jh(i,e,n){return gm(Math.cos(Ai(i)),Math.sin(Ai(i)),e,n)}let _m=63710088e-1,Bx=2*Math.PI*_m;class zi{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new zi(kl(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,s=this.lat*n,h=e.lat*n,m=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((e.lng-this.lng)*n);return _m*Math.acos(Math.min(m,1))}toBounds(e=0){let n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new cd({lng:this.lng-s,lat:this.lat-n},{lng:this.lng+s,lat:this.lat+n})}toEcef(e){return jh(this.lat,this.lng,Io+e*Io/_m)}static convert(e){if(e instanceof zi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new zi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new zi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class cd{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let s=e;this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]])}else{let s=e;this.setSouthWest(s[0]).setNorthEast(s[1])}}setNorthEast(e){return this._ne=e instanceof zi?new zi(e.lng,e.lat):zi.convert(e),this}setSouthWest(e){return this._sw=e instanceof zi?new zi(e.lng,e.lat):zi.convert(e),this}extend(e){let n=this._sw,s=this._ne,h,m;if(e instanceof zi)h=e,m=e;else{if(!(e instanceof cd))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(cd.convert(e)):this.extend(zi.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(zi.convert(e)):this;if(h=e._sw,m=e._ne,!h||!m)return this}return n||s?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),s.lng=Math.max(m.lng,s.lng),s.lat=Math.max(m.lat,s.lat)):(this._sw=new zi(h.lng,h.lat),this._ne=new zi(m.lng,m.lat)),this}getCenter(){return new zi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new zi(this.getWest(),this.getNorth())}getSouthEast(){return new zi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:s}=zi.convert(e),h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&h}static convert(e){return!e||e instanceof cd?e:new cd(e)}}var iS={};(function(i,e){(function(n){function s(m,p,b){var y=h(256*m,256*(p=Math.pow(2,b)-p-1),b),w=h(256*(m+1),256*(p+1),b);return y[0]+","+y[1]+","+w[0]+","+w[1]}function h(m,p,b){var y=2*Math.PI*6378137/256/Math.pow(2,b);return[m*y-2*Math.PI*6378137/2,p*y-2*Math.PI*6378137/2]}n.getURL=function(m,p,b,y,w,M){return M=M||{},m+"?"+["bbox="+s(b,y,w),"format="+(M.format||"image/png"),"service="+(M.service||"WMS"),"version="+(M.version||"1.1.1"),"request="+(M.request||"GetMap"),"srs="+(M.srs||"EPSG:3857"),"width="+(M.width||256),"height="+(M.height||256),"layers="+p].join("&")},n.getTileBBox=s,n.getMercCoords=h,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,iS);var $O=iS;class Uh{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=$f(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let s=$O.getTileBBox(this.x,this.y,this.z),h=function(m,p,b){let y,w="";for(let M=m;M>0;M--)y=1<<M-1,w+=(p&y?1:0)+(b&y?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class nS{constructor(e,n){this.wrap=e,this.canonical=n,this.key=$f(e,n.z,n.z,n.x,n.y)}}class Mr{constructor(e,n,s,h,m){this.overscaledZ=e,this.wrap=n,this.canonical=new Uh(s,+h,+m),this.key=n===0&&e===s?this.canonical.key:$f(n,e,s,h,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new Mr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Mr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return $f(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let s=this.canonical.z-e;return $f(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Mr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new Mr(n,this.wrap,n,s,h),new Mr(n,this.wrap,n,s+1,h),new Mr(n,this.wrap,n,s,h+1),new Mr(n,this.wrap,n,s+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Mr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Mr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new nS(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function $f(i,e,n,s,h){let m=1<<Math.min(n,22),p=m*(h%m)+s%m;return i&&n<22&&(p+=m*m*((i<0?-2*i-1:2*i)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}let YO=[i=>{let e=i.canonical.x-1,n=i.wrap;return e<0&&(e=(1<<i.canonical.z)-1,n--),new Mr(i.overscaledZ,n,i.canonical.z,e,i.canonical.y)},i=>{let e=i.canonical.x+1,n=i.wrap;return e===1<<i.canonical.z&&(e=0,n++),new Mr(i.overscaledZ,n,i.canonical.z,e,i.canonical.y)},i=>new Mr(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,(i.canonical.y===0?1<<i.canonical.z:i.canonical.y)-1),i=>new Mr(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y===(1<<i.canonical.z)-1?0:i.canonical.y+1)];ne(Uh,"CanonicalTileID"),ne(Mr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let ZO=0,XO=25.5;function Nx(i){return Bx*Math.cos(i*Math.PI/180)}function tl(i){return(180+i)/360}function il(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function To(i,e){return i/Nx(e)}function Wo(i){return 360*i-180}function Gr(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function rS(i,e){return i*Nx(Gr(e))}let cr=85.051129;function oS(i){return Math.cos(Ai(gi(i,-cr,cr)))}function Wh(i,e){let n=gi(e,ZO,XO),s=Math.pow(2,n);return oS(i)*Bx/(512*s)}function aS(i){return 1/Math.cos(i*Math.PI/180)}function w0(i,e=0){let n=Math.exp(Math.PI*(1-(i.y+e/pt)/(1<<i.z)*2));return 80150034*n/(n*n+1)/pt/(1<<i.z)}class so{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){let s=zi.convert(e);return new so(tl(s.lng),il(s.lat),To(n,s.lat))}toLngLat(){return new zi(Wo(this.x),Gr(this.y))}toAltitude(){return rS(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Bx*aS(Gr(this.y))}}function Vx(i,e,n,s,h,m,p,b,y){let w=(e+s)/2,M=(n+h)/2,T=new wt(w,M);b(T),function(E,P,R,F,N,H){let J=R-N,ee=F-H;return Math.abs((F-P)*J-(R-E)*ee)/Math.hypot(J,ee)}(T.x,T.y,m.x,m.y,p.x,p.y)>=y?(Vx(i,e,n,w,M,m,T,b,y),Vx(i,w,M,s,h,T,p,b,y)):i.push(p)}function sS(i,e,n){let s=i[0],h=s.x,m=s.y;e(s);let p=[s];for(let b=1;b<i.length;b++){let y=i[b],{x:w,y:M}=y;e(y),Vx(p,h,m,w,M,s,y,e,n),h=w,m=M,s=y}return p}function jx(i,e,n,s){if(s(e,n)){let h=e.add(n)._mult(.5);jx(i,e,h,s),jx(i,h,n,s)}else i.push(n)}function QO(i,e){let n=i[0],s=[n];for(let h=1;h<i.length;h++){let m=i[h];jx(s,n,m,e),n=m}return s}let Ux=Math.pow(2,14)-1,lS=-Ux-1;function KO(i,e){let n=Math.round(i.x*e),s=Math.round(i.y*e);return i.x=gi(n,lS,Ux),i.y=gi(s,lS,Ux),(n<i.x||n>i.x+1||s<i.y||s>i.y+1)&&sr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function bs(i,e,n){let s=i.loadGeometry(),h=i.extent,m=pt/h;if(e&&n&&n.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:b,x:y,y:w,projection:M}=n,T=E=>{let P=Wo((e.x+E.x/h)/p),R=Gr((e.y+E.y/h)/p),F=M.project(P,R);E.x=(F.x*b-y)*h,E.y=(F.y*b-w)*h};for(let E=0;E<s.length;E++)if(i.type!==1)s[E]=sS(s[E],T,1);else{let P=[];for(let R of s[E])R.x<0||R.x>=h||R.y<0||R.y>=h||(T(R),P.push(R));s[E]=P}}for(let p of s)for(let b of p)KO(b,m);return s}function Gl(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?bs(i):[]}}function C0(i,e,n,s,h){i.emplaceBack(2*e+(s+1)/2,2*n+(h+1)/2)}function S0(i,e,n){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Wx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new gs,this.indexArray=new Rr,this.segments=new Bn,this.programConfigurations=new ld(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,s,h){let m=this.layers[0],p=[],b=null;m.type==="circle"&&(b=m.layout.get("circle-sort-key"));for(let{feature:w,id:M,index:T,sourceLayerIndex:E}of e){let P=this.layers[0]._featureFilter.needGeometry,R=Gl(w,P);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),R,s))continue;let F=b?b.evaluate(R,{},s):void 0,N={id:M,properties:w.properties,type:w.type,sourceLayerIndex:E,index:T,geometry:P?R.geometry:bs(w,s,h),patterns:{},sortKey:F};p.push(N)}b&&p.sort((w,M)=>w.sortKey-M.sortKey);let y=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new _0,y=h.projection);for(let w of p){let{geometry:M,index:T,sourceLayerIndex:E}=w,P=e[T].feature;this.addFeature(w,M,T,n.availableImages,s,y,n.brightness),n.featureIndex.insert(P,M,T,E,this.index)}}update(e,n,s,h,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,s,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,LO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,FO.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,s,h,m,p,b){for(let y of n)for(let w of y){let M=w.x,T=w.y;if(M<0||M>=pt||T<0||T>=pt)continue;if(p){let R=p.projectTilePoint(M,T,m),F=p.upVector(m,M,T),N=this.globeExtVertexArray;S0(N,R,F),S0(N,R,F),S0(N,R,F),S0(N,R,F)}let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=E.vertexLength;C0(this.layoutVertexArray,M,T,-1,-1),C0(this.layoutVertexArray,M,T,1,-1),C0(this.layoutVertexArray,M,T,1,1),C0(this.layoutVertexArray,M,T,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},h,m,b)}}function Hx(i,e){for(let n=0;n<i.length;n++)if(dd(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(dd(i,e[n]))return!0;return!!Gx(i,e)}function JO(i,e,n){return!!dd(i,e)||!!qx(e,i,n)}function cS(i,e){if(i.length===1)return hS(e,i[0]);for(let n=0;n<e.length;n++){let s=e[n];for(let h=0;h<s.length;h++)if(dd(i,s[h]))return!0}for(let n=0;n<i.length;n++)if(hS(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Gx(i,e[n]))return!0;return!1}function eR(i,e,n){if(i.length>1){if(Gx(i,e))return!0;for(let s=0;s<e.length;s++)if(qx(e[s],i,n))return!0}for(let s=0;s<i.length;s++)if(qx(i[s],e,n))return!0;return!1}function Gx(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){let s=i[n],h=i[n+1];for(let m=0;m<e.length-1;m++)if(tR(s,h,e[m],e[m+1]))return!0}return!1}function tR(i,e,n,s){return ja(i,n,s)!==ja(e,n,s)&&ja(i,e,n)!==ja(i,e,s)}function qx(i,e,n){let s=n*n;if(e.length===1)return i.distSqr(e[0])<s;for(let h=1;h<e.length;h++)if(dS(i,e[h-1],e[h])<s)return!0;return!1}function dS(i,e,n){let s=e.distSqr(n);if(s===0)return i.distSqr(e);let h=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/s;return i.distSqr(h<0?e:h>1?n:n.sub(e)._mult(h)._add(e))}function hS(i,e){let n,s,h,m=!1;for(let p=0;p<i.length;p++){n=i[p];for(let b=0,y=n.length-1;b<n.length;y=b++)s=n[b],h=n[y],s.y>e.y!=h.y>e.y&&e.x<(h.x-s.x)*(e.y-s.y)/(h.y-s.y)+s.x&&(m=!m)}return m}function dd(i,e){let n=!1;for(let s=0,h=i.length-1;s<i.length;h=s++){let m=i[s],p=i[h];m.y>e.y!=p.y>e.y&&e.x<(p.x-m.x)*(e.y-m.y)/(p.y-m.y)+m.x&&(n=!n)}return n}function uS(i,e,n,s,h){for(let p of i)if(e<=p.x&&n<=p.y&&s>=p.x&&h>=p.y)return!0;let m=[new wt(e,n),new wt(e,h),new wt(s,h),new wt(s,n)];if(i.length>2){for(let p of m)if(dd(i,p))return!0}for(let p=0;p<i.length-1;p++)if(iR(i[p],i[p+1],m))return!0;return!1}function iR(i,e,n){let s=n[0],h=n[2];if(i.x<s.x&&e.x<s.x||i.x>h.x&&e.x>h.x||i.y<s.y&&e.y<s.y||i.y>h.y&&e.y>h.y)return!1;let m=ja(i,e,n[0]);return m!==ja(i,e,n[1])||m!==ja(i,e,n[2])||m!==ja(i,e,n[3])}function bm(i,e,n,s,h,m){let p=e.y-i.y,b=i.x-e.x;if(m=m||0){let y=p*p+b*b;if(y===0)return!0;let w=Math.sqrt(y);p/=w,b/=w}return!((n.x-i.x)*p+(n.y-i.y)*b-m<0||(s.x-i.x)*p+(s.y-i.y)*b-m<0||(h.x-i.x)*p+(h.y-i.y)*b-m<0)}function $x(i,e,n,s,h,m,p){return!(bm(i,e,s,h,m,p)||bm(e,n,s,h,m,p)||bm(n,i,s,h,m,p)||bm(s,h,i,e,n,p)||bm(h,m,i,e,n,p)||bm(m,s,i,e,n,p))}function ym(i,e,n){let s=e.paint.get(i).value;return s.kind==="constant"?s.value:n.programConfigurations.get(e.id).getMaxValue(i)}function M0(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function mS(i,e,n,s,h){if(!e[0]&&!e[1])return i;let m=wt.convert(e)._mult(h);n==="viewport"&&m._rotate(-s);let p=[];for(let b=0;b<i.length;b++)p.push(i[b].sub(m));return p}function pS(i,e,n,s){let h=wt.convert(i)._mult(s);return e==="viewport"&&h._rotate(-n),h}ne(Wx,"CircleBucket",{omit:["layers"]});let nR=new $i({"circle-sort-key":new St(Pe.layout_circle["circle-sort-key"]),visibility:new Ke(Pe.layout_circle.visibility)});var rR={paint:new $i({"circle-radius":new St(Pe.paint_circle["circle-radius"]),"circle-color":new St(Pe.paint_circle["circle-color"]),"circle-blur":new St(Pe.paint_circle["circle-blur"]),"circle-opacity":new St(Pe.paint_circle["circle-opacity"]),"circle-translate":new Ke(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ke(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ke(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ke(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new St(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new St(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new St(Pe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ke(Pe.paint_circle["circle-emissive-strength"])}),layout:nR};class Yx{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,s){let h=t._.dot(n,this.dir);if(Math.abs(h)<1e-6)return!1;let m=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/h;return s[0]=this.pos[0]+this.dir[0]*m,s[1]=this.pos[1]+this.dir[1]*m,s[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,n,s){if(t._.equals(this.pos,e)||n===0)return s[0]=s[1]=s[2]=0,!1;let[h,m,p]=this.dir,b=this.pos[0]-e[0],y=this.pos[1]-e[1],w=this.pos[2]-e[2],M=h*h+m*m+p*p,T=2*(b*h+y*m+w*p),E=T*T-4*M*(b*b+y*y+w*w-n*n);if(E<0){let P=Math.max(-T/2,0),R=b+h*P,F=y+m*P,N=w+p*P,H=Math.hypot(R,F,N);return s[0]=R*n/H,s[1]=F*n/H,s[2]=N*n/H,!1}{let P=(-T-Math.sqrt(E))/(2*M);if(P<0){let R=Math.hypot(b,y,w);return s[0]=b*n/R,s[1]=y*n/R,s[2]=w*n/R,!1}return s[0]=b+h*P,s[1]=y+m*P,s[2]=w+p*P,!0}}}class Zx{constructor(e,n,s,h,m){this.TL=e,this.TR=n,this.BR=s,this.BL=h,this.horizon=m}static fromInvProjectionMatrix(e,n,s){let h=[-1,1,1],m=[1,1,1],p=[1,-1,1],b=[-1,-1,1],y=t._.transformMat4(h,h,e),w=t._.transformMat4(m,m,e),M=t._.transformMat4(p,p,e),T=t._.transformMat4(b,b,e);return new Zx(y,w,M,T,n/s)}}function Yf(i,e,n){let s=1/0,h=-1/0,m=[];for(let p of i){t._.sub(m,p,e);let b=t._.dot(m,n);s=Math.min(s,b),h=Math.max(h,b)}return[s,h]}function fS(i,e){let n=!0;for(let s=0;s<i.planes.length;s++){let h=i.planes[s],m=0;for(let p=0;p<e.length;p++)m+=t._.dot(h,e[p])+h[3]>=0;if(m===0)return 0;m!==e.length&&(n=!1)}return n?2:1}function gS(i,e){for(let n of i.projections){let s=Yf(e,i.points[0],n.axis);if(n.projection[1]<s[0]||n.projection[0]>s[1])return 0}return 1}function _S(i,e){let n=0,s=[0,0,0,0];for(let h=0;h<i.length;h++)s[0]=i[h][0],s[1]=i[h][1],s[2]=i[h][2],s[3]=1,t.aA.dot(s,e)>=0&&n++;return n}class Xx{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Nn.fromPoints(this.points),this.projections=[],this.frustumEdges=[t._.sub([],this.points[2],this.points[3]),t._.sub([],this.points[0],this.points[3]),t._.sub([],this.points[4],this.points[0]),t._.sub([],this.points[5],this.points[1]),t._.sub([],this.points[6],this.points[2]),t._.sub([],this.points[7],this.points[3])];for(let s of this.frustumEdges){let h=[0,-s[2],s[1]],m=[s[2],0,-s[0]];this.projections.push({axis:h,projection:Yf(this.points,this.points[0],h)}),this.projections.push({axis:m,projection:Yf(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,n,s,h){let m=Math.pow(2,s),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{let M=t.aA.transformMat4([],w,e),T=1/M[3]/n*m;return t.aA.mul(M,M,[T,T,h?1/M[3]:T,T])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{let M=t._.sub([],p[w[0]],p[w[1]]),T=t._.sub([],p[w[2]],p[w[1]]),E=t._.normalize([],t._.cross([],M,T)),P=-t._.dot(E,p[w[1]]);return E.concat(P)}),y=[];for(let w=0;w<p.length;w++)y.push([p[w][0],p[w][1],p[w][2]]);return new Xx(y,b)}intersectsPrecise(e,n,s){for(let h=0;h<n.length;h++)if(!_S(e,n[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!_S(e,this.planes[h]))return 0;for(let h of s)for(let m of this.frustumEdges){let p=t._.cross([],h,m),b=t._.length(p);if(b===0)continue;t._.scale(p,p,1/b);let y=Yf(this.points,this.points[0],p),w=Yf(e,this.points[0],p);if(y[0]>w[1]||w[0]>y[1])return 0}return 1}}class Nn{static fromPoints(e){let n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(let h of e)t._.min(n,n,h),t._.max(s,s,h);return new Nn(n,s)}static fromTileIdAndHeight(e,n,s){let h=1<<e.canonical.z,m=e.canonical.x,p=e.canonical.y;return new Nn([m/h,p/h,n],[(m+1)/h,(p+1)/h,s])}static applyTransform(e,n){let s=e.getCorners();for(let h=0;h<s.length;++h)t._.transformMat4(s[h],s[h],n);return Nn.fromPoints(s)}static projectAabbCorners(e,n){let s=e.getCorners();for(let h=0;h<s.length;++h)t._.transformMat4(s[h],s[h],n);return s}constructor(e,n){this.min=e,this.max=n,this.center=t._.scale([],t._.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],s=t._.clone(this.min),h=t._.clone(this.max);for(let m=0;m<n.length;m++)s[m]=n[m]?this.min[m]:this.center[m],h[m]=n[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new Nn(s,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?fS(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?fS(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?gS(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?gS(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ne(Nn,"Aabb");let oR=Yi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:k0}=oR,bS=Yi([{name:"a_pos_3",components:3,type:"Int16"}]);var Zf=Yi([{name:"a_pos",type:"Int16",components:2}]);function I0(i){return i*Io/_m}let aR=[new Nn([qa,qa,qa],[$a,$a,$a]),new Nn([qa,qa,qa],[0,0,$a]),new Nn([0,qa,qa],[$a,0,$a]),new Nn([qa,0,qa],[0,$a,$a]),new Nn([0,0,qa],[$a,$a,$a])];function yS(i,e,n,s=!0){let h=t._.scale([],i._camera.position,i.worldSize),m=[e,n,1,1];t.aA.transformMat4(m,m,i.pixelMatrixInverse),t.aA.scale(m,m,1/m[3]);let p=t._.sub([],m,h),b=t._.normalize([],p),y=i.globeMatrix,w=[y[12],y[13],y[14]],M=t._.sub([],w,h),T=t._.length(M),E=t._.normalize([],M),P=i.worldSize/(2*Math.PI),R=t._.dot(E,b),F=Math.asin(P/T);if(F<Math.acos(R)){if(!s)return null;let ze=[],Ye=[];t._.scale(ze,b,T/R),t._.normalize(Ye,t._.sub(Ye,ze,M)),t._.normalize(b,t._.add(b,M,t._.scale(b,Ye,Math.tan(F)*T)))}let N=[];new Yx(h,b).closestPointOnSphere(w,P,N);let H=t._.normalize([],lh(y,0)),J=t._.normalize([],lh(y,1)),ee=t._.normalize([],lh(y,2)),te=t._.dot(H,N),pe=t._.dot(J,N),he=t._.dot(ee,N),ve=Kr(Math.asin(-pe/P)),Ce=Kr(Math.atan2(te,he));Ce=i.center.lng+function(ze,Ye){let rt=(Ye-ze+180)%360-180;return rt<-180?rt+360:rt}(i.center.lng,Ce);let Ae=tl(Ce),Ue=gi(il(ve),0,1);return new so(Ae,Ue)}class sR{constructor(e,n,s){this.a=t._.sub([],e,s),this.b=t._.sub([],n,s),this.center=s;let h=t._.normalize([],this.a),m=t._.normalize([],this.b);this.angle=Math.acos(t._.dot(h,m))}}function Qx(i,e){if(i.angle===0)return null;let n;return n=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),n<0||n>1?null:function(s,h,m,p){let b=Math.sin(m);return s*(Math.sin((1-p)*m)/b)+h*(Math.sin(p*m)/b)}(i.a[e],i.b[e],i.angle,gi(n,0,1))+i.center[e]}function nl(i){if(i.z<=1)return aR[i.z+2*i.y+i.x];let e=Kx(T0(i));return Nn.fromPoints(e)}function ql(i,e,n){return t._.scale(i,i,1-n),t._.scaleAndAdd(i,i,e,n)}function vS(i,e){let n=$l(e.zoom);if(n===0)return nl(i);let s=T0(i),h=Kx(s),m=tl(s.getWest())*e.worldSize,p=tl(s.getEast())*e.worldSize,b=il(s.getNorth())*e.worldSize,y=il(s.getSouth())*e.worldSize,w=[m,b,0],M=[p,b,0],T=[m,y,0],E=[p,y,0],P=t.ad.invert([],e.globeMatrix);return t._.transformMat4(w,w,P),t._.transformMat4(M,M,P),t._.transformMat4(T,T,P),t._.transformMat4(E,E,P),h[0]=ql(h[0],T,n),h[1]=ql(h[1],E,n),h[2]=ql(h[2],M,n),h[3]=ql(h[3],w,n),Nn.fromPoints(h)}function xS(i,e,n){for(let s of i)t._.transformMat4(s,s,e),t._.scale(s,s,n)}function wS(i,e,n,s){let h=e/i.worldSize,m=i.globeMatrix;if(n.z<=1){let Ae=nl(n).getCorners();return xS(Ae,m,h),Nn.fromPoints(Ae)}let p=T0(n,s),b=Kx(p,Io+I0(i._tileCoverLift));xS(b,m,h);let y=Number.MAX_VALUE,w=[-y,-y,-y],M=[y,y,y];if(p.contains(i.center)){for(let ze of b)t._.min(M,M,ze),t._.max(w,w,ze);w[2]=0;let Ae=i.point,Ue=[Ae.x*h,Ae.y*h,0];return t._.min(M,M,Ue),t._.max(w,w,Ue),new Nn(M,w)}if(i._tileCoverLift>0){for(let Ae of b)t._.min(M,M,Ae),t._.max(w,w,Ae);return new Nn(M,w)}let T=[m[12]*h,m[13]*h,m[14]*h],E=p.getCenter(),P=gi(i.center.lat,-cr,cr),R=gi(E.lat,-cr,cr),F=tl(i.center.lng),N=il(P),H=F-tl(E.lng),J=N-il(R);H>.5?H-=1:H<-.5&&(H+=1);let ee=0;if(Math.abs(H)>Math.abs(J))ee=H>=0?1:3;else{ee=J>=0?0:2;let Ae=[m[4]*h,m[5]*h,m[6]*h],Ue=-Math.sin(Ai(J>=0?p.getSouth():p.getNorth()))*Io;t._.scaleAndAdd(T,T,Ae,Ue)}let te=b[ee],pe=b[(ee+1)%4],he=new sR(te,pe,T),ve=[Qx(he,0)||te[0],Qx(he,1)||te[1],Qx(he,2)||te[2]],Ce=$l(i.zoom);if(Ce>0){let Ae=function({x:ze,y:Ye,z:rt},qe,et,We,tt){let ct=1/(1<<rt),nt=ze*ct,kt=nt+ct,ot=Ye*ct,ut=ot+ct,Vt=0,Lt=(nt+kt)/2-We;return Lt>.5?Vt=-1:Lt<-.5&&(Vt=1),nt=((nt+Vt)*qe-(We*=qe))*et+We,kt=((kt+Vt)*qe-We)*et+We,ot=(ot*qe-(tt*=qe))*et+tt,ut=(ut*qe-tt)*et+tt,[[nt,ut,0],[kt,ut,0],[kt,ot,0],[nt,ot,0]]}(n,e,i._pixelsPerMercatorPixel,F,N);for(let ze=0;ze<b.length;ze++)ql(b[ze],Ae[ze],Ce);let Ue=t._.add([],Ae[ee],Ae[(ee+1)%4]);t._.scale(Ue,Ue,.5),ql(ve,Ue,Ce)}for(let Ae of b)t._.min(M,M,Ae),t._.max(w,w,Ae);return M[2]=Math.min(te[2],pe[2]),t._.min(M,M,ve),t._.max(w,w,ve),new Nn(M,w)}function T0({x:i,y:e,z:n},s=!1){let h=1/(1<<n),m=new zi(Wo(i*h),e===(1<<n)-1&&s?-90:Gr((e+1)*h)),p=new zi(Wo((i+1)*h),e===0&&s?90:Gr(e*h));return new cd(m,p)}function Kx(i,e=Io){let n=Ai(i.getNorth()),s=Ai(i.getSouth()),h=Math.cos(n),m=Math.cos(s),p=Math.sin(n),b=Math.sin(s),y=i.getWest(),w=i.getEast();return[gm(m,b,y,e),gm(m,b,w,e),gm(h,p,w,e),gm(h,p,y,e)]}function Xf(i,e,n,s){let h=1<<n.z,m=(i/pt+n.x)/h;return jh(Gr((e/pt+n.y)/h),Wo(m),s)}function E0({min:i,max:e}){return qO/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}let CS=new Float64Array(16);function Qf(i){let e=E0(i),n=t.ad.fromScaling(CS,[e,e,e]);return t.ad.translate(n,n,t._.negate([],i.min))}function Jx(i){let e=t.ad.fromTranslation(CS,i.min),n=1/E0(i);return t.ad.scale(e,e,[n,n,n])}function e1(i){let e=pt/(2*Math.PI);return i/(2*Math.PI)/e}function SS(i,e){return pt/(512*Math.pow(2,i))*E0(nl(e))}function MS(i,e,n,s,h){let m=e1(n),p=[i,e,-n/(2*Math.PI)],b=t.ad.identity(new Float64Array(16));return t.ad.translate(b,b,p),t.ad.scale(b,b,[m,m,m]),t.ad.rotateX(b,b,Ai(-h)),t.ad.rotateY(b,b,Ai(-s)),b}function $l(i){return Ml(Fx,tS,i)}function kS(i,e){let n=jh(e.lat,e.lng),s=function(m){let p=jh(m._center.lat,m._center.lng),b=t._.fromValues(0,1,0),y=t._.cross([],b,p),w=t.ad.fromRotation([],-m.angle,p);y=t._.transformMat4(y,y,w),t.ad.fromRotation(w,-m._pitch,y);let M=t._.normalize([],p);return t._.scale(M,M,I0(m.cameraToCenterDistance/m.pixelsPerMeter)),t._.transformMat4(M,M,w),t._.add([],p,M)}(i),h=t._.subtract([],s,n);return t._.angle(h,n)}function t1(i,e){return kS(i,e)>Math.PI/2*1.01}let IS=Ai(85),lR=Math.cos(IS),cR=Math.sin(IS),dR=t.ad.create(),TS=i=>{let e=[];return i.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),i.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function ES(i,e,n,s,h,m,p,b,y){if(m&&i.queryGeometry.isAboveHorizon)return!1;m&&(y*=i.pixelToTileUnitsFactor);let w=i.tileID.canonical,M=n.projection.upVectorScale(w,n.center.lat,n.worldSize).metersToTile;for(let T of e)for(let E of T){let P=E.add(b),R=h&&n.elevation?n.elevation.exaggeration()*h.getElevationAt(P.x,P.y,!0):0,F=n.projection.projectTilePoint(P.x,P.y,w);if(R>0){let ee=n.projection.upVector(w,P.x,P.y);F.x+=ee[0]*M*R,F.y+=ee[1]*M*R,F.z+=ee[2]*M*R}let N=m?P:hR(F.x,F.y,F.z,s),H=m?i.tilespaceRays.map(ee=>mR(ee,R)):i.queryGeometry.screenGeometry,J=t.aA.transformMat4([],[F.x,F.y,F.z,1],s);if(!p&&m?y*=J[3]/n.cameraToCenterDistance:p&&!m&&(y*=n.cameraToCenterDistance/J[3]),m){let ee=Gr((E.y/pt+w.y)/(1<<w.z));y/=n.projection.pixelsPerMeter(ee,1)/To(1,ee)}if(JO(H,N,y))return!0}return!1}function hR(i,e,n,s){let h=t.aA.transformMat4([],[i,e,n,1],s);return new wt(h[0]/h[3],h[1]/h[3])}let DS=t._.fromValues(0,0,0),uR=t._.fromValues(0,0,1);function mR(i,e){let n=t._.create();return DS[2]=e,i.intersectsPlane(DS,uR,n),new wt(n[0],n[1])}class AS extends Wx{}function PS(i,{width:e,height:n},s,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*n*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*n*s);return i.width=e,i.height=n,i.data=h,i}function OS(i,e,n){let{width:s,height:h}=e;s===i.width&&h===i.height||(i1(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,s),height:Math.min(i.height,h)},n,null),i.width=s,i.height=h,i.data=e.data)}function i1(i,e,n,s,h,m,p,b){if(h.width===0||h.height===0)return e;if(h.width>i.width||h.height>i.height||n.x>i.width-h.width||n.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||s.x>e.width-h.width||s.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");let y=i.data,w=e.data,M=m===4&&b;for(let T=0;T<h.height;T++){let E=((n.y+T)*i.width+n.x)*m,P=((s.y+T)*e.width+s.x)*m;if(M)for(let R=0;R<h.width;R++){let F=E+R*m+3,N=P+R*m;w[N+0]=255,w[N+1]=255,w[N+2]=255,w[N+3]=y[F]}else if(p)for(let R=0;R<h.width;R++){let F=E+R*m,N=P+R*m,H=y[F+3],J=new Ni(y[F+0]/255*H,y[F+1]/255*H,y[F+2]/255*H,H).toRenderColor(p).toArray();w[N+0]=J[0],w[N+1]=J[1],w[N+2]=J[2],w[N+3]=J[3]}else for(let R=0;R<h.width*m;R++)w[P+R]=y[E+R]}return e}ne(AS,"HeatmapBucket",{omit:["layers"]});class hd{constructor(e,n){PS(this,e,1,n)}resize(e){OS(this,new hd(e),1)}clone(){return new hd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,h,m){i1(e,n,s,h,m,1,null)}}class ka{constructor(e,n){PS(this,e,4,n)}resize(e){OS(this,new ka(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ka({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,h,m,p,b){i1(e,n,s,h,m,4,p,b)}}class RS{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}ne(hd,"AlphaImage"),ne(ka,"RGBAImage");let pR=new $i({visibility:new Ke(Pe.layout_heatmap.visibility)});var fR={paint:new $i({"heatmap-radius":new St(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new St(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ke(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zn(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ke(Pe.paint_heatmap["heatmap-opacity"])}),layout:pR};function Kf(i){let e={},n=i.resolution||256,s=i.clips?i.clips.length:1,h=i.image||new ka({width:n,height:s}),m=(p,b,y)=>{e[i.evaluationKey]=y;let w=i.expression.evaluate(e);w&&(h.data[p+b+0]=Math.floor(255*w.r/w.a),h.data[p+b+1]=Math.floor(255*w.g/w.a),h.data[p+b+2]=Math.floor(255*w.b/w.a),h.data[p+b+3]=Math.floor(255*w.a))};if(i.clips)for(let p=0,b=0;p<s;++p,b+=4*n)for(let y=0,w=0;y<n;y++,w+=4){let M=y/(n-1),{start:T,end:E}=i.clips[p];m(b,w,T*(1-M)+E*M)}else for(let p=0,b=0;p<n;p++,b+=4)m(0,b,p/(n-1));return h}let gR=new $i({visibility:new Ke(Pe.layout_hillshade.visibility)});var _R={paint:new $i({"hillshade-illumination-direction":new Ke(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ke(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ke(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ke(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ke(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ke(Pe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ke(Pe.paint_hillshade["hillshade-emissive-strength"])}),layout:gR};let bR=Yi([{name:"a_pos",components:2,type:"Int16"}],4),{members:yR}=bR;function Jf(i,e,n=2){let s=e&&e.length,h=s?e[0]*n:i.length,m=LS(i,0,h,n,!0),p=[];if(!m||m.next===m.prev)return p;let b,y,w;if(s&&(m=function(M,T,E,P){let R=[];for(let F=0,N=T.length;F<N;F++){let H=LS(M,T[F]*P,F<N-1?T[F+1]*P:M.length,P,!1);H===H.next&&(H.steiner=!0),R.push(IR(H))}R.sort(SR);for(let F=0;F<R.length;F++)E=MR(R[F],E);return E}(i,e,m,n)),i.length>80*n){b=1/0,y=1/0;let M=-1/0,T=-1/0;for(let E=n;E<h;E+=n){let P=i[E],R=i[E+1];P<b&&(b=P),R<y&&(y=R),P>M&&(M=P),R>T&&(T=R)}w=Math.max(M-b,T-y),w=w!==0?32767/w:0}return eg(m,p,n,b,y,w,0),p}function LS(i,e,n,s,h){let m;if(h===function(p,b,y,w){let M=0;for(let T=b,E=y-w;T<y;T+=w)M+=(p[E]-p[T])*(p[T+1]+p[E+1]),E=T;return M}(i,e,n,s)>0)for(let p=e;p<n;p+=s)m=BS(p/s|0,i[p],i[p+1],m);else for(let p=n-s;p>=e;p-=s)m=BS(p/s|0,i[p],i[p+1],m);return m&&D0(m,m.next)&&(ig(m),m=m.next),m}function Hh(i,e){if(!i)return i;e||(e=i);let n,s=i;do if(n=!1,s.steiner||!D0(s,s.next)&&kr(s.prev,s,s.next)!==0)s=s.next;else{if(ig(s),s=e=s.prev,s===s.next)break;n=!0}while(n||s!==e);return e}function eg(i,e,n,s,h,m,p){if(!i)return;!p&&m&&function(y,w,M,T){let E=y;do E.z===0&&(E.z=n1(E.x,E.y,w,M,T)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next;while(E!==y);E.prevZ.nextZ=null,E.prevZ=null,function(P){let R,F=1;do{let N,H=P;P=null;let J=null;for(R=0;H;){R++;let ee=H,te=0;for(let he=0;he<F&&(te++,ee=ee.nextZ,ee);he++);let pe=F;for(;te>0||pe>0&&ee;)te!==0&&(pe===0||!ee||H.z<=ee.z)?(N=H,H=H.nextZ,te--):(N=ee,ee=ee.nextZ,pe--),J?J.nextZ=N:P=N,N.prevZ=J,J=N;H=ee}J.nextZ=null,F*=2}while(R>1)}(E)}(i,s,h,m);let b=i;for(;i.prev!==i.next;){let y=i.prev,w=i.next;if(m?xR(i,s,h,m):vR(i))e.push(y.i,i.i,w.i),ig(i),i=w.next,b=w.next;else if((i=w)===b){p?p===1?eg(i=wR(Hh(i),e),e,n,s,h,m,2):p===2&&CR(i,e,n,s,h,m):eg(Hh(i),e,n,s,h,m,1);break}}}function vR(i){let e=i.prev,n=i,s=i.next;if(kr(e,n,s)>=0)return!1;let h=e.x,m=n.x,p=s.x,b=e.y,y=n.y,w=s.y,M=h<m?h<p?h:p:m<p?m:p,T=b<y?b<w?b:w:y<w?y:w,E=h>m?h>p?h:p:m>p?m:p,P=b>y?b>w?b:w:y>w?y:w,R=s.next;for(;R!==e;){if(R.x>=M&&R.x<=E&&R.y>=T&&R.y<=P&&vm(h,b,m,y,p,w,R.x,R.y)&&kr(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function xR(i,e,n,s){let h=i.prev,m=i,p=i.next;if(kr(h,m,p)>=0)return!1;let b=h.x,y=m.x,w=p.x,M=h.y,T=m.y,E=p.y,P=b<y?b<w?b:w:y<w?y:w,R=M<T?M<E?M:E:T<E?T:E,F=b>y?b>w?b:w:y>w?y:w,N=M>T?M>E?M:E:T>E?T:E,H=n1(P,R,e,n,s),J=n1(F,N,e,n,s),ee=i.prevZ,te=i.nextZ;for(;ee&&ee.z>=H&&te&&te.z<=J;){if(ee.x>=P&&ee.x<=F&&ee.y>=R&&ee.y<=N&&ee!==h&&ee!==p&&vm(b,M,y,T,w,E,ee.x,ee.y)&&kr(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,te.x>=P&&te.x<=F&&te.y>=R&&te.y<=N&&te!==h&&te!==p&&vm(b,M,y,T,w,E,te.x,te.y)&&kr(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;ee&&ee.z>=H;){if(ee.x>=P&&ee.x<=F&&ee.y>=R&&ee.y<=N&&ee!==h&&ee!==p&&vm(b,M,y,T,w,E,ee.x,ee.y)&&kr(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;te&&te.z<=J;){if(te.x>=P&&te.x<=F&&te.y>=R&&te.y<=N&&te!==h&&te!==p&&vm(b,M,y,T,w,E,te.x,te.y)&&kr(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function wR(i,e){let n=i;do{let s=n.prev,h=n.next.next;!D0(s,h)&&FS(s,n,n.next,h)&&tg(s,h)&&tg(h,s)&&(e.push(s.i,n.i,h.i),ig(n),ig(n.next),n=i=h),n=n.next}while(n!==i);return Hh(n)}function CR(i,e,n,s,h,m){let p=i;do{let b=p.next.next;for(;b!==p.prev;){if(p.i!==b.i&&TR(p,b)){let y=zS(p,b);return p=Hh(p,p.next),y=Hh(y,y.next),eg(p,e,n,s,h,m,0),void eg(y,e,n,s,h,m,0)}b=b.next}p=p.next}while(p!==i)}function SR(i,e){return i.x-e.x}function MR(i,e){let n=function(h,m){let p=m,b=h.x,y=h.y,w,M=-1/0;do{if(y<=p.y&&y>=p.next.y&&p.next.y!==p.y){let F=p.x+(y-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(F<=b&&F>M&&(M=F,w=p.x<p.next.x?p:p.next,F===b))return w}p=p.next}while(p!==m);if(!w)return null;let T=w,E=w.x,P=w.y,R=1/0;p=w;do{if(b>=p.x&&p.x>=E&&b!==p.x&&vm(y<P?b:M,y,E,P,y<P?M:b,y,p.x,p.y)){let F=Math.abs(y-p.y)/(b-p.x);tg(p,h)&&(F<R||F===R&&(p.x>w.x||p.x===w.x&&kR(w,p)))&&(w=p,R=F)}p=p.next}while(p!==T);return w}(i,e);if(!n)return e;let s=zS(n,i);return Hh(s,s.next),Hh(n,n.next)}function kR(i,e){return kr(i.prev,i,e.prev)<0&&kr(e.next,i,i.next)<0}function n1(i,e,n,s,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function IR(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function vm(i,e,n,s,h,m,p,b){return(h-p)*(e-b)>=(i-p)*(m-b)&&(i-p)*(s-b)>=(n-p)*(e-b)&&(n-p)*(m-b)>=(h-p)*(s-b)}function TR(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,s){let h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==s.i&&h.next.i!==s.i&&FS(h,h.next,n,s))return!0;h=h.next}while(h!==n);return!1}(i,e)&&(tg(i,e)&&tg(e,i)&&function(n,s){let h=n,m=!1,p=(n.x+s.x)/2,b=(n.y+s.y)/2;do h.y>b!=h.next.y>b&&h.next.y!==h.y&&p<(h.next.x-h.x)*(b-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next;while(h!==n);return m}(i,e)&&(kr(i.prev,i,e.prev)||kr(i,e.prev,e))||D0(i,e)&&kr(i.prev,i,i.next)>0&&kr(e.prev,e,e.next)>0)}function kr(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function D0(i,e){return i.x===e.x&&i.y===e.y}function FS(i,e,n,s){let h=P0(kr(i,e,n)),m=P0(kr(i,e,s)),p=P0(kr(n,s,i)),b=P0(kr(n,s,e));return h!==m&&p!==b||!(h!==0||!A0(i,n,e))||!(m!==0||!A0(i,s,e))||!(p!==0||!A0(n,i,s))||!(b!==0||!A0(n,e,s))}function A0(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function P0(i){return i>0?1:i<0?-1:0}function tg(i,e){return kr(i.prev,i,i.next)<0?kr(i,e,i.next)>=0&&kr(i,i.prev,e)>=0:kr(i,e,i.prev)<0||kr(i,i.next,e)<0}function zS(i,e){let n=r1(i.i,i.x,i.y),s=r1(e.i,e.x,e.y),h=i.next,m=e.prev;return i.next=e,e.prev=i,n.next=h,h.prev=n,s.next=n,n.prev=s,m.next=s,s.prev=m,s}function BS(i,e,n,s){let h=r1(i,e,n);return s?(h.next=s.next,h.prev=s,s.next.prev=h,s.next=h):(h.prev=h,h.next=h),h}function ig(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function r1(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function O0(i,e){let n=i.length;if(n<=1)return[i];let s=[],h,m;for(let p=0;p<n;p++){let b=ro(i[p]);b!==0&&(i[p].area=Math.abs(b),m===void 0&&(m=b<0),m===b<0?(h&&s.push(h),h=[i[p]]):h.push(i[p]))}if(h&&s.push(h),e>1)for(let p=0;p<s.length;p++)s[p].length<=e||(ix(s[p],e,1,s[p].length-1,ER),s[p]=s[p].slice(0,e));return s}function ER(i,e){return e.area-i.area}function o1(i,e,n){let s=n.patternDependencies,h=!1;for(let m of e){let p=m.paint.get(`${i}-pattern`);p.isConstant()||(h=!0);let b=p.constantOr(null);b&&(h=!0,s[b]=!0)}return h}function a1(i,e,n,s,h){let m=h.patternDependencies;for(let p of e){let b=p.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let y=b.evaluate({zoom:s},n,{},h.availableImages);y=y&&y.name?y.name:y,m[y]=!0,n.patterns[p.id]=y}}return n}class R0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new gs,this.indexArray=new Rr,this.indexArray2=new ad,this.programConfigurations=new ld(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Bn,this.segments2=new Bn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,s,h){this.hasPattern=o1("fill",this.layers,n);let m=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:b,id:y,index:w,sourceLayerIndex:M}of e){let T=this.layers[0]._featureFilter.needGeometry,E=Gl(b,T);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),E,s))continue;let P=m?m.evaluate(E,{},s,n.availableImages):void 0,R={id:y,properties:b.properties,type:b.type,sourceLayerIndex:M,index:w,geometry:T?E.geometry:bs(b,s,h),patterns:{},sortKey:P};p.push(R)}m&&p.sort((b,y)=>b.sortKey-y.sortKey);for(let b of p){let{geometry:y,index:w,sourceLayerIndex:M}=b;if(this.hasPattern){let T=a1("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(T)}else this.addFeature(b,y,w,s,{},n.availableImages,n.brightness);n.featureIndex.insert(e[w].feature,y,w,M,this.index)}}update(e,n,s,h,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,s,h,m)}addFeatures(e,n,s,h,m,p){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,n,s,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yR),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,h,m,p=[],b){for(let y of O0(n,500)){let w=0;for(let F of y)w+=F.length;let M=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),T=M.vertexLength,E=[],P=[];for(let F of y){if(F.length===0)continue;F!==y[0]&&P.push(E.length/2);let N=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),H=N.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(H+F.length-1,H),E.push(F[0].x),E.push(F[0].y);for(let J=1;J<F.length;J++)this.layoutVertexArray.emplaceBack(F[J].x,F[J].y),this.indexArray2.emplaceBack(H+J-1,H+J),E.push(F[J].x),E.push(F[J].y);N.vertexLength+=F.length,N.primitiveLength+=F.length}let R=Jf(E,P);for(let F=0;F<R.length;F+=3)this.indexArray.emplaceBack(T+R[F],T+R[F+1],T+R[F+2]);M.vertexLength+=w,M.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,m,p,h,b)}}ne(R0,"FillBucket",{omit:["layers","patternFeatures"]});let DR=new $i({"fill-sort-key":new St(Pe.layout_fill["fill-sort-key"]),visibility:new Ke(Pe.layout_fill.visibility)});var AR={paint:new $i({"fill-antialias":new Ke(Pe.paint_fill["fill-antialias"]),"fill-opacity":new St(Pe.paint_fill["fill-opacity"]),"fill-color":new St(Pe.paint_fill["fill-color"]),"fill-outline-color":new St(Pe.paint_fill["fill-outline-color"]),"fill-translate":new Ke(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ke(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new St(Pe.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ke(Pe.paint_fill["fill-emissive-strength"])}),layout:DR};class s1{constructor(e,n,s,h){if(this.triangleCount=n.length/3,this.min=new wt(0,0),this.max=new wt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[m,p]=[e[0].clone(),e[0].clone()];for(let T=1;T<e.length;++T){let E=e[T];m.x=Math.min(m.x,E.x),m.y=Math.min(m.y,E.y),p.x=Math.max(p.x,E.x),p.y=Math.max(p.y,E.y)}if(h){let T=Math.ceil(Math.max(p.x-m.x,p.y-m.y)/h);s=Math.max(s,T)}if(s===0)return;this.min=m,this.max=p;let b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);let y=Math.max(b.x,b.y)/s;this.cellsX=Math.max(1,Math.ceil(b.x/y)),this.cellsY=Math.max(1,Math.ceil(b.y/y)),this.xScale=1/y,this.yScale=1/y;let w=[];for(let T=0;T<this.triangleCount;T++){let E=e[n[3*T+0]].sub(this.min),P=e[n[3*T+1]].sub(this.min),R=e[n[3*T+2]].sub(this.min),F=rl(Math.floor(Math.min(E.x,P.x,R.x)),this.xScale,this.cellsX),N=rl(Math.floor(Math.max(E.x,P.x,R.x)),this.xScale,this.cellsX),H=rl(Math.floor(Math.min(E.y,P.y,R.y)),this.yScale,this.cellsY),J=rl(Math.floor(Math.max(E.y,P.y,R.y)),this.yScale,this.cellsY),ee=new wt(0,0),te=new wt(0,0),pe=new wt(0,0),he=new wt(0,0);for(let ve=H;ve<=J;++ve){ee.y=te.y=ve*y,pe.y=he.y=(ve+1)*y;for(let Ce=F;Ce<=N;++Ce)ee.x=pe.x=Ce*y,te.x=he.x=(Ce+1)*y,($x(E,P,R,ee,te,he)||$x(E,P,R,ee,he,pe))&&w.push({cellIdx:ve*this.cellsX+Ce,triIdx:T})}}if(w.length===0)return;w.sort((T,E)=>T.cellIdx-E.cellIdx||T.triIdx-E.triIdx);let M=0;for(;M<w.length;){let T=w[M].cellIdx,E={start:this.payload.length,len:0};for(;M<w.length&&w[M].cellIdx===T;)++E.len,this.payload.push(w[M++].triIdx);this.cells[T]=E}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let s=rl(e.x-this.min.x,this.xScale,this.cellsX),h=rl(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[h*this.cellsX+s];if(m){this._lazyInitLookup();for(let p=0;p<m.len;p++){let b=this.payload[m.start+p],y=Math.floor(b/8),w=1<<b%8;if(!(this.lookup[y]&w)&&(this.lookup[y]|=w,n.push(b),n.length===this.triangleCount))return}}}query(e,n,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();let h=rl(e.x-this.min.x,this.xScale,this.cellsX),m=rl(n.x-this.min.x,this.xScale,this.cellsX),p=rl(e.y-this.min.y,this.yScale,this.cellsY),b=rl(n.y-this.min.y,this.yScale,this.cellsY);for(let y=p;y<=b;y++)for(let w=h;w<=m;w++){let M=this.cells[y*this.cellsX+w];if(M)for(let T=0;T<M.len;T++){let E=this.payload[M.start+T],P=Math.floor(E/8),R=1<<E%8;if(!(this.lookup[P]&R)&&(this.lookup[P]|=R,s.push(E),s.length===this.triangleCount))return}}}}function rl(i,e,n){return Math.max(0,Math.min(n-1,Math.floor(i*e)))}ne(s1,"TriangleGridIndex");class NS{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(let s of this.footprints)n.push({footprint:s,id:e})}populate(e,n,s,h){let m=[];for(let{feature:p,id:b,index:y,sourceLayerIndex:w}of e){let M=this.layers[0]._featureFilter.needGeometry,T=Gl(p,M);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),T,s))continue;let E={id:b,properties:p.properties,type:p.type,sourceLayerIndex:w,index:y,geometry:M?T.geometry:bs(p,s,h),patterns:{}};m.push(E)}for(let p of m){let{geometry:b,index:y,sourceLayerIndex:w}=p;this.addFeature(p,b,y,s,{},n.availableImages,n.brightness),n.featureIndex.insert(e[y].feature,b,y,w,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,s,h,m){}destroy(){}addFeature(e,n,s,h,m,p=[],b){for(let y of O0(n,2)){let w=[],M=[],T=[],E=new wt(1/0,1/0),P=new wt(-1/0,-1/0);for(let N of y)if(N.length!==0){N!==y[0]&&T.push(M.length/2);for(let H=0;H<N.length;H++)M.push(N[H].x),M.push(N[H].y),w.push(N[H]),E.x=Math.min(E.x,N[H].x),E.y=Math.min(E.y,N[H].y),P.x=Math.max(P.x,N[H].x),P.y=Math.max(P.y,N[H].y)}let R=Jf(M,T),F=new s1(w,R,8,256);this.footprints.push({vertices:w,indices:R,grid:F,min:E,max:P})}}}ne(NS,"ClipBucket",{omit:["layers"]});let PR=new $i({"clip-layer-types":new Ke(Pe.layout_clip["clip-layer-types"])});var OR={paint:new $i({}),layout:PR};let RR=Yi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),LR=Yi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),FR=Yi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),zR=Yi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),BR=Yi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:NR}=RR;var L0={},VR=Tu,VS=xm;function xm(i,e,n,s,h){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=h,i.readFields(jR,this,e)}function jR(i,e,n){i==1?e.id=n.readVarint():i==2?function(s,h){for(var m=s.readVarint()+s.pos;s.pos<m;){var p=h._keys[s.readVarint()],b=h._values[s.readVarint()];h.properties[p]=b}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function UR(i){for(var e,n,s=0,h=0,m=i.length,p=m-1;h<m;p=h++)s+=((n=i[p]).x-(e=i[h]).x)*(e.y+n.y);return s}xm.types=["Unknown","Point","LineString","Polygon"],xm.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,s=1,h=0,m=0,p=0,b=[];i.pos<n;){if(h<=0){var y=i.readVarint();s=7&y,h=y>>3}if(h--,s===1||s===2)m+=i.readSVarint(),p+=i.readSVarint(),s===1&&(e&&b.push(e),e=[]),e.push(new VR(m,p));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&b.push(e),b},xm.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,s=0,h=0,m=0,p=1/0,b=-1/0,y=1/0,w=-1/0;i.pos<e;){if(s<=0){var M=i.readVarint();n=7&M,s=M>>3}if(s--,n===1||n===2)(h+=i.readSVarint())<p&&(p=h),h>b&&(b=h),(m+=i.readSVarint())<y&&(y=m),m>w&&(w=m);else if(n!==7)throw new Error("unknown command "+n)}return[p,y,b,w]},xm.prototype.toGeoJSON=function(i,e,n){var s,h,m=this.extent*Math.pow(2,n),p=this.extent*i,b=this.extent*e,y=this.loadGeometry(),w=xm.types[this.type];function M(P){for(var R=0;R<P.length;R++){var F=P[R];P[R]=[360*(F.x+p)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(s=0;s<y.length;s++)T[s]=y[s][0];M(y=T);break;case 2:for(s=0;s<y.length;s++)M(y[s]);break;case 3:for(y=function(P){var R=P.length;if(R<=1)return[P];for(var F,N,H=[],J=0;J<R;J++){var ee=UR(P[J]);ee!==0&&(N===void 0&&(N=ee<0),N===ee<0?(F&&H.push(F),F=[P[J]]):F.push(P[J]))}return F&&H.push(F),H}(y),s=0;s<y.length;s++)for(h=0;h<y[s].length;h++)M(y[s][h])}y.length===1?y=y[0]:w="Multi"+w;var E={type:"Feature",geometry:{type:w,coordinates:y},properties:this.properties};return"id"in this&&(E.id=this.id),E};var WR=VS,jS=US;function US(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(HR,this,e),this.length=this._features.length}function HR(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(s){for(var h=null,m=s.readVarint()+s.pos;s.pos<m;){var p=s.readVarint()>>3;h=p===1?s.readString():p===2?s.readFloat():p===3?s.readDouble():p===4?s.readVarint64():p===5?s.readVarint():p===6?s.readSVarint():p===7?s.readBoolean():null}return h}(n))}US.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new WR(this._pbf,e,this.extent,this._keys,this._values)};var GR=jS;function qR(i,e,n){if(i===3){var s=new GR(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}var l1=L0.VectorTile=function(i,e){this.layers=i.readFields(qR,{},e)},F0=L0.VectorTileFeature=VS;L0.VectorTileLayer=jS;class Gh extends wt{constructor(e,n,s){super(e,n),this.z=s}}class WS extends Gh{constructor(e,n,s,h){super(e,n,s),this.w=h}}function z0(i,e,n,s){let h=[],m=s===0?(p,b,y,w,M,T)=>{p.push(new wt(T,y+(T-b)/(w-b)*(M-y)))}:(p,b,y,w,M,T)=>{p.push(new wt(b+(T-y)/(M-y)*(w-b),T))};for(let p of i){let b=[];for(let y of p){if(y.length<=2)continue;let w=[];for(let E=0;E<y.length-1;E++){let P=y[E].x,R=y[E].y,F=y[E+1].x,N=y[E+1].y,H=s===0?P:R,J=s===0?F:N;H<e?J>e&&m(w,P,R,F,N,e):H>n?J<n&&m(w,P,R,F,N,n):w.push(y[E]),J<e&&H>=e&&m(w,P,R,F,N,e),J>n&&H<=n&&m(w,P,R,F,N,n)}let M=y[y.length-1],T=s===0?M.x:M.y;T>=e&&T<=n&&w.push(M),w.length&&(M=w[w.length-1],w[0].x===M.x&&w[0].y===M.y||w.push(w[0]),b.push(w))}b.length&&h.push(b)}return h}function HS(i,e,n,s){let h=n==="x"?"y":"x",m=(s-i[n])/(e[n]-i[n]);i[h]=i[h]+(e[h]-i[h])*m,i[n]=s,i.hasOwnProperty("z")&&(i.z=Ht(i.z,e.z,m)),i.hasOwnProperty("w")&&(i.w=Ht(i.w,e.w,m))}function GS(i,e,n,s){let h=n,m=s;for(let p of["x","y"]){let b=i,y=e;b[p]>=y[p]&&(b=e,y=i),b[p]<h&&y[p]>h&&HS(b,y,p,h),b[p]<m&&y[p]>m&&HS(y,b,p,m)}}function B0(i,e){return i.x-e.x||i.y-e.y}function qS(i,e){return B0(i.min,e.min)===0&&B0(i.max,e.max)===0}function c1(i,e){return!(i.min.x>e.max.x||i.max.x<e.min.x||i.min.y>e.max.y||i.max.y<e.min.y)}function d1(i,e){if(i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(i[n].sourceId!==e[n].sourceId||!qS(i[n],e[n])||i[n].order!==e[n].order||i[n].clipMask!==e[n].clipMask)return!1;return!0}function $S(i,e,n){let s=1/pt,h=1/(1<<n.canonical.z),m=(e.x*s+n.canonical.x)*h+n.wrap,p=(e.y*s+n.canonical.y)*h;return{min:new wt((i.x*s+n.canonical.x)*h+n.wrap,(i.y*s+n.canonical.y)*h),max:new wt(m,p)}}function $R(i,e,n){let s=1<<n.canonical.z,h=((e.x-n.wrap)*s-n.canonical.x)*pt,m=(e.y*s-n.canonical.y)*pt;return{min:new wt(((i.x-n.wrap)*s-n.canonical.x)*pt,(i.y*s-n.canonical.y)*pt),max:new wt(h,m)}}function YS(i,e,n,s,h,m,p){let b=i.indices,y=i.vertices,w=[];for(let M=s;M<s+h;M+=3){let T=e[n[M+0]+m],E=e[n[M+1]+m],P=e[n[M+2]+m],R=Math.min(T.x,E.x,P.x),F=Math.max(T.x,E.x,P.x),N=Math.min(T.y,E.y,P.y),H=Math.max(T.y,E.y,P.y);w.length=0,i.grid.query(new wt(R,N),new wt(F,H),w);for(let J=0;J<w.length;J++){let ee=w[J];if($x(y[b[3*ee+0]],y[b[3*ee+1]],y[b[3*ee+2]],T,E,P,p))return!0}}return!1}function ZS(i,e,n,s){if(!i||!n)return!1;let h=i.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(n.vertices.length<i.vertices.length)return ZS(n,s,i,e);let m=e.canonical,p=s.canonical,b=Math.pow(2,p.z-m.z);h=i.vertices.map(y=>new wt((y.x+m.x*pt)*b-p.x*pt,(y.y+m.y*pt)*b-p.y*pt))}return YS(n,h,i.indices,0,i.indices.length,0,0)}function XS(i,e,n,s){let h=Math.pow(2,s.z-n.z);return new wt((i+n.x*pt)*h-s.x*pt,(e+n.y*pt)*h-s.y*pt)}function QS(i,e){let n=[];e.footprint.grid.queryPoint(i,n);let s=e.footprint.indices,h=e.footprint.vertices;for(let m=0;m<n.length;m++){let p=n[m];if(dd([h[s[3*p+0]],h[s[3*p+1]],h[s[3*p+2]]],i))return!0}return!1}class KS{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function JS(i,e,n,s){let h=0,m=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(s[p])<1e-15){if(n[p]<i[p]||n[p]>e[p])return null}else{let b=1/s[p],y=(i[p]-n[p])*b,w=(e[p]-n[p])*b;if(y>w){let M=y;y=w,w=M}if(y>h&&(h=y),w<m&&(m=w),h>m)return null}return h}function eM(i,e,n,s,h,m,p,b,y,w,M){let T=s-i,E=h-e,P=m-n,R=p-i,F=b-e,N=y-n,H=M[1]*N-M[2]*F,J=M[2]*R-M[0]*N,ee=M[0]*F-M[1]*R,te=T*H+E*J+P*ee;if(Math.abs(te)<1e-15)return null;let pe=1/te,he=w[0]-i,ve=w[1]-e,Ce=w[2]-n,Ae=(he*H+ve*J+Ce*ee)*pe;if(Ae<0||Ae>1)return null;let Ue=ve*P-Ce*E,ze=Ce*T-he*P,Ye=he*E-ve*T,rt=(M[0]*Ue+M[1]*ze+M[2]*Ye)*pe;return rt<0||Ae+rt>1?null:(R*Ue+F*ze+N*Ye)*pe}function tM(i,e,n){return(i-e)/(n-e)}function iM(i,e,n,s,h,m,p,b,y){let w=1<<n,M=m-s,T=p-h,E=(i+1)/w*M+s,P=(e+0)/w*T+h,R=(e+1)/w*T+h;b[0]=(i+0)/w*M+s,b[1]=P,y[0]=E,y[1]=R}class nM{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(m){let p=Math.ceil(Math.log2(m.dim/8)),b=[],y=Math.ceil(Math.pow(2,p)),w=1/y,M=(P,R,F,N,H)=>{let J=N?1:0,ee=(P+1)*F-J,te=R*F,pe=(R+1)*F-J;H[0]=P*F,H[1]=te,H[2]=ee,H[3]=pe},T=new KS(y),E=[];for(let P=0;P<y*y;P++){M(P%y,Math.floor(P/y),w,!1,E);let R=ud(E[0],E[1],m),F=ud(E[2],E[1],m),N=ud(E[2],E[3],m),H=ud(E[0],E[3],m);T.minimums.push(Math.min(R,F,N,H)),T.maximums.push(Math.max(R,F,N,H)),T.leaves.push(1)}for(b.push(T),y/=2;y>=1;y/=2){let P=b[b.length-1];T=new KS(y);for(let R=0;R<y*y;R++){M(R%y,Math.floor(R/y),2,!0,E);let F=P.getElevation(E[0],E[1]),N=P.getElevation(E[2],E[1]),H=P.getElevation(E[2],E[3]),J=P.getElevation(E[0],E[3]),ee=P.isLeaf(E[0],E[1]),te=P.isLeaf(E[2],E[1]),pe=P.isLeaf(E[2],E[3]),he=P.isLeaf(E[0],E[3]),ve=Math.min(F.min,N.min,H.min,J.min),Ce=Math.max(F.max,N.max,H.max,J.max),Ae=ee&&te&&pe&&he;T.maximums.push(Ce),T.minimums.push(ve),T.leaves.push(Ce-ve<=5&&Ae?1:0)}b.push(T)}return b}(this.dem),s=n.length-1,h=n[s];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,h,m,p,b=1){return JS([e,n,-100],[s,h,this.maximums[0]*b],m,p)}raycast(e,n,s,h,m,p,b=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,n,s,h,m,p,b);if(y==null)return null;let w=[],M=[],T=[],E=[],P=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;P.length>0;){let{idx:R,t:F,nodex:N,nodey:H,depth:J}=P.pop();if(this.leaves[R]){iM(N,H,J,e,n,s,h,T,E);let te=1<<J,pe=(N+0)/te,he=(N+1)/te,ve=(H+0)/te,Ce=(H+1)/te,Ae=ud(pe,ve,this.dem)*b,Ue=ud(he,ve,this.dem)*b,ze=ud(he,Ce,this.dem)*b,Ye=ud(pe,Ce,this.dem)*b,rt=eM(T[0],T[1],Ae,E[0],T[1],Ue,E[0],E[1],ze,m,p),qe=eM(E[0],E[1],ze,T[0],E[1],Ye,T[0],T[1],Ae,m,p),et=Math.min(rt!==null?rt:Number.MAX_VALUE,qe!==null?qe:Number.MAX_VALUE);if(et!==Number.MAX_VALUE)return et;{let We=t._.scaleAndAdd([],m,p,F);if(rM(Ae,Ue,Ye,ze,tM(We[0],T[0],E[0]),tM(We[1],T[1],E[1]))>=We[2])return F}continue}let ee=0;for(let te=0;te<this._siblingOffset.length;te++){iM((N<<1)+this._siblingOffset[te][0],(H<<1)+this._siblingOffset[te][1],J+1,e,n,s,h,T,E),T[2]=-100,E[2]=this.maximums[this.childOffsets[R]+te]*b;let pe=JS(T,E,m,p);if(pe!=null){let he=pe;w[te]=he;let ve=!1;for(let Ce=0;Ce<ee&&!ve;Ce++)he>=w[M[Ce]]&&(M.splice(Ce,0,te),ve=!0);ve||(M[ee]=te),ee++}}for(let te=0;te<ee;te++){let pe=M[te];P.push({idx:this.childOffsets[R]+pe,t:w[pe],nodex:(N<<1)+this._siblingOffset[pe][0],nodey:(H<<1)+this._siblingOffset[pe][1],depth:J+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,h,m){if(e[h].isLeaf(n,s)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);let p=h-1,b=e[p],y=0,w=0;for(let M=0;M<this._siblingOffset.length;M++){let T=2*n+this._siblingOffset[M][0],E=2*s+this._siblingOffset[M][1],P=b.getElevation(T,E),R=b.isLeaf(T,E),F=this._addNode(P.min,P.max,R);R&&(y|=1<<M),w||(w=F)}for(let M=0;M<this._siblingOffset.length;M++)y&1<<M||this._construct(e,2*n+this._siblingOffset[M][0],2*s+this._siblingOffset[M][1],p,w+M)}}function rM(i,e,n,s,h,m){return Ht(Ht(i,n,m),Ht(e,s,m),h)}function ud(i,e,n){let s=n.dim,h=gi(i*s-.5,0,s-1),m=gi(e*s-.5,0,s-1),p=Math.floor(h),b=Math.floor(m),y=Math.min(p+1,s-1),w=Math.min(b+1,s-1);return rM(n.get(p,b),n.get(y,b),n.get(p,w),n.get(y,w),h-p,m-b)}let YR={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function ZR(i,e,n){return(256*i*256+256*e+n)/10-1e4}function XR(i,e,n){return 256*i+e+n/256-32768}class N0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,h=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return sr(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let m=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let y=0;y<m;y++)p[this._idx(-1,y)]=p[this._idx(0,y)],p[this._idx(m,y)]=p[this._idx(m-1,y)],p[this._idx(y,-1)]=p[this._idx(y,0)],p[this._idx(y,m)]=p[this._idx(y,m-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(m,-1)]=p[this._idx(m-1,0)],p[this._idx(-1,m)]=p[this._idx(0,m-1)],p[this._idx(m,m)]=p[this._idx(m-1,m-1)]}let b=s==="terrarium"?XR:ZR;for(let y=0;y<p.length;++y){let w=4*y;this.floatView[y]=b(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=Ur.now()}_buildQuadTree(){this._tree=new nM(this)}get(e,n,s=!1){s&&(e=gi(e,-1,this.dim),n=gi(n,-1,this.dim));let h=this._idx(e,n);return this.floatView[h]}set(e,n,s){let h=this._idx(e,n),m=this.floatView[h];return this.floatView[h]=s,s-m}static getUnpackVector(e){return YR[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let s=[0,0,0,0],h=N0.getUnpackVector(n),m=Math.floor((e+h[3])/h[2]);return s[2]=m%256,m=Math.floor(m/256),s[1]=m%256,m=Math.floor(m/256),s[0]=m,s}getPixels(){return new RS({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,m=n*this.dim+this.dim,p=s*this.dim,b=s*this.dim+this.dim;switch(n){case-1:h=m-1;break;case 1:m=h+1}switch(s){case-1:p=b-1;break;case 1:b=p+1}let y=-n*this.dim,w=-s*this.dim;for(let M=p;M<b;M++)for(let T=h;T<m;T++){let E=4*this._idx(T,M),P=4*this._idx(T+y,M+w);this.pixels[E+0]=e.pixels[P+0],this.pixels[E+1]=e.pixels[P+1],this.pixels[E+2]=e.pixels[P+2],this.pixels[E+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ne(N0,"DEMData"),ne(nM,"DemMinMaxQuadTree",{omit:["dem"]});class wm{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){let h=s||e.findDEMTileFor(n);if(!h||!h.dem)return;let m=h.dem,p=h.tileID,b=1<<n.canonical.z-p.canonical.z;return new wm(h,m.dim/pt/b,[(n.canonical.x/b-p.canonical.x)*m.dim,(n.canonical.y/b-p.canonical.y)*m.dim])}tileCoordToPixel(e,n){let s=n*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),m=Math.floor(s);return new wt(h,m)}getElevationAt(e,n,s,h){let m=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],b=Math.floor(m),y=Math.floor(p),w=this._dem;return h=!!h,s?Ht(Ht(w.get(b,y,h),w.get(b,y+1,h),p-y),Ht(w.get(b+1,y,h),w.get(b+1,y+1,h),p-y),m-b):w.get(b,y,h)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*To(1,e)*this._dem.stride}}let oM={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},QR=F0.types,KR=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],JR=["fill-extrusion-flood-light-ground-radius"],e3=Math.pow(2,13),t3=Math.pow(2,15)-1,aM=new wt(0,1),md=2147483648;function ng(i,e,n,s,h,m,p,b){i.emplaceBack((e<<1)+p,(n<<1)+m,(Math.floor(s*e3)<<1)+h,Math.round(b))}function V0(i,e,n,s,h,m){i.emplaceBack(e.x,e.y,(n.x<<1)+s,(n.y<<1)+h,m)}function rg(i,e,n){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class sM{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class lM{constructor(){this.centroidXY=new wt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new wt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new wt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new wt(this.max.x-this.min.x,this.max.y-this.min.y)}}class cM{constructor(){this.acc=new wt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,s){this.accCount++,this.acc._add(n);let h=!!this.borders;n.x<e.min.x?(e.min.x=n.x,h=!0):n.x>e.max.x&&(e.max.x=n.x,h=!0),n.y<e.min.y?(e.min.y=n.y,h=!0):n.y>e.max.y&&(e.max.y=n.y,h=!0),((n.x===0||n.x===pt)&&n.x===s.x)!=((n.y===0||n.y===pt)&&n.y===s.y)&&this.processBorderOverlap(n,s),h&&this.checkBorderIntersection(n,s)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Ht(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>pt!=e.x>pt&&this.addBorderIntersection(1,Ht(n.y,e.y,(pt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Ht(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>pt!=e.y>pt&&this.addBorderIntersection(3,Ht(n.x,e.x,(pt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let s=e.x===0?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{let s=e.y===0?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new wt(0,0):new wt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function dM(i,e){let n=i.add(e)._unit(),s=gi(i.x*n.x+i.y*n.y,-1,1);var h,m,p;return h=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(h)))/4*t3*((m=i).x*(p=e).y-m.y*p.x<0?-1:1)}let i3=[i=>i.x<0,i=>i.x>pt,i=>i.y<0,i=>i.y>pt];function n3(i,e,n,s){let h=[4];if(s===0)return h;n._mult(s);let m=i.sub(n),p=e.sub(n),b=[i,e,m,p];for(let y=0;y<4;y++)for(let w of b)if(i3[y](w)){h.push(y);break}return h}class hM{constructor(e){this.vertexArray=new fx,this.indexArray=new Rr,this.programConfigurations=new ld(e.layers,{zoom:e.zoom,lut:e.lut},n=>JR.includes(n)),this._segments=new Bn,this.hiddenByLandmarkVertexArray=new Ex,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Bn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,s,h=!1){let m=e.length;if(m>2){let p=Math.max(0,this._segments.get().length-1),b=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),y;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let w=e[0],M=e[1];y=dM(w.sub(e[m-1])._perp()._unit(),M.sub(w)._perp()._unit())}for(let w=0;w<m;w++){let M=w===m-1?0:w+1,T=e[w],E=e[M],P=e[M===m-1?0:M+1],R=E.sub(T)._perp()._unit(),F=dM(R,P.sub(E)._perp()._unit()),N=y,H=F;if(h1(T,E,n)||h&&pM(T,n)&&pM(E,n)){y=F;continue}let J=b.vertexLength;V0(this.vertexArray,T,E,1,1,N),V0(this.vertexArray,T,E,1,0,N),V0(this.vertexArray,T,E,0,1,H),V0(this.vertexArray,T,E,0,0,H),b.vertexLength+=4;let ee=n3(T,E,R,s);for(let te of ee)this._segmentToGroundQuads[p].push({id:J,region:te}),this._segmentToRegionTriCounts[p][te]+=2,b.primitiveLength+=2;y=F}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let s=0;s<n;s++)this._segmentToGroundQuads[s].sort((h,m)=>h.region-m.region);for(let s=0;s<n;s++){let h=this._segmentToGroundQuads[s],m=e[s],p=this._segmentToRegionTriCounts[s];p.reduce((y,w)=>y+w,0);let b=0;for(let y=0;y<=4;y++){let w=p[y];if(w!==0){let M=this.regionSegments[y];M||(M=this.regionSegments[y]=new Bn);let T={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+b,vertexLength:m.vertexLength,primitiveLength:w};M.get().push(T)}b+=w}for(let y=0;y<h.length;y++){let w=h[y].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,s,h,m,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,s,h,m,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,LR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,s,h,m,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,s,h,m,p)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let s=e.flags&md?1:0;for(let h=e.groundVertexArrayOffset;h<n;++h)this.hiddenByLandmarkVertexArray.emplace(h,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,zR.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class j0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Rr,this.footprintVertices=new gs,this.footprintSegments=[],this.layoutVertexArray=new id,this.centroidVertexArray=new X2,this.indexArray=new Rr,this.programConfigurations=new ld(e.layers,{zoom:e.zoom,lut:e.lut},n=>KR.includes(n)),this.segments=new Bn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new hM(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,s,h){this.features=[],this.hasPattern=o1("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=w0(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:m,id:p,index:b,sourceLayerIndex:y}of e){let w=this.layers[0]._featureFilter.needGeometry,M=Gl(m,w);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),M,s))continue;let T={id:p,sourceLayerIndex:y,index:b,geometry:w?M.geometry:bs(m,s,h),properties:m.properties,type:m.type,patterns:{}},E=this.layoutVertexArray.length;this.hasPattern?this.features.push(a1("fill-extrusion",this.layers,T,this.zoom,n)):this.addFeature(T,T.geometry,b,s,{},n.availableImages,h,n.brightness),n.featureIndex.insert(m,T.geometry,b,y,this.index,E)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,s,h,m,p){for(let b of this.features){let{geometry:y}=b;this.addFeature(b,y,b.index,n,s,h,m,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,s,h,m){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let b=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,b,s,h,m),this.groundEffect.update(e,n,b,s,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,NR),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,BR.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,FR.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,h,m,p,b,y){let w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,M=[new wt(0,0),new wt(pt,pt)],T=b.projection,E=T.name==="globe",P=QR[e.type]==="Polygon",R=new cM;R.centroidDataIndex=this.centroidData.length;let F=new lM,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},h)<=0,H=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},h);F.height=H,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new _0);let J=O0(n,500);for(let Ce=J.length-1;Ce>=0;Ce--){let Ae=J[Ce];(Ae.length===0||(ee=Ae[0]).every(Ue=>Ue.x<=0)||ee.every(Ue=>Ue.x>=pt)||ee.every(Ue=>Ue.y<=0)||ee.every(Ue=>Ue.y>=pt))&&J.splice(Ce,1)}var ee;let te;if(E)te=bM(J,M,h);else{te=[];for(let Ce of J)te.push({polygon:Ce,bounds:M})}let pe=P?this.edgeRadius:0,he=pe>0&&this.zoom<17,ve=(Ce,Ae)=>{if(Ce.length===0)return!1;let Ue=Ce[Ce.length-1];return Ae.x===Ue.x&&Ae.y===Ue.y};for(let{polygon:Ce,bounds:Ae}of te){let Ue=0,ze=0;for(let et of Ce)P&&!et[0].equals(et[et.length-1])&&et.push(et[0]),ze+=P?et.length-1:et.length;let Ye=this.segments.prepareSegment((P?5:4)*ze,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);let rt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},qe=new sM;if(qe.vertexOffset=this.footprintVertices.length,qe.indexOffset=3*this.footprintIndices.length,qe.ringIndices=[],P){let et=[],We=[];Ue=Ye.vertexLength;for(let ct=0;ct<Ce.length;ct++){let nt=Ce[ct];nt.length&&ct!==0&&We.push(et.length/2);let kt=[],ot,ut;ot=nt[1].sub(nt[0])._perp()._unit(),qe.ringIndices.push(nt.length-1);for(let Vt=1;Vt<nt.length;Vt++){let Lt=nt[Vt],Ot=nt[Vt===nt.length-1?1:Vt+1],dt=Lt.clone();if(pe){ut=Ot.sub(Lt)._perp()._unit();let jt=ot.add(ut)._unit(),li=pe*Math.min(4,1/(ot.x*jt.x+ot.y*jt.y));dt.x+=li*jt.x,dt.y+=li*jt.y,dt.x=Math.round(dt.x),dt.y=Math.round(dt.y),ot=ut}!N||pe!==0&&!he||ve(kt,dt)||kt.push(dt),ng(this.layoutVertexArray,dt.x,dt.y,0,0,1,1,0),Ye.vertexLength++,this.footprintVertices.emplaceBack(Lt.x,Lt.y),et.push(Lt.x,Lt.y),E&&rg(this.layoutVertexExtArray,T.projectTilePoint(dt.x,dt.y,h),T.upVector(h,dt.x,dt.y))}N&&(pe===0||he)&&(kt.length!==0&&ve(kt,kt[0])&&kt.pop(),this.groundEffect.addData(kt,Ae,w))}let tt=Jf(et,We);for(let ct=0;ct<tt.length;ct+=3)this.footprintIndices.emplaceBack(qe.vertexOffset+tt[ct+0],qe.vertexOffset+tt[ct+1],qe.vertexOffset+tt[ct+2]),this.indexArray.emplaceBack(Ue+tt[ct],Ue+tt[ct+2],Ue+tt[ct+1]),Ye.primitiveLength++;qe.indexCount+=tt.length,qe.vertexCount+=this.footprintVertices.length-qe.vertexOffset}for(let et=0;et<Ce.length;et++){let We=Ce[et];R.startRing(F,We[0]);let tt=We.length>4&&fM(We[We.length-2],We[0],We[1]),ct=pe?r3(We[We.length-2],We[0],We[1],pe):0,nt=[],kt,ot,ut;ot=We[1].sub(We[0])._perp()._unit();let Vt=!0;for(let Lt=1,Ot=0;Lt<We.length;Lt++){let dt=We[Lt-1],jt=We[Lt],li=We[Lt===We.length-1?1:Lt+1];if(R.appendEdge(F,jt,dt),h1(jt,dt,Ae)){pe&&(ot=li.sub(jt)._perp()._unit(),Vt=!Vt);continue}let Zt=jt.sub(dt)._perp(),ui=Zt.x/(Math.abs(Zt.x)+Math.abs(Zt.y)),ci=Zt.y>0?1:0,wi=dt.dist(jt);if(Ot+wi>32768&&(Ot=0),pe){ut=li.sub(jt)._perp()._unit();let Ui=mM(dt,jt,li,uM(ot,ut),pe);isNaN(Ui)&&(Ui=0);let Oi=jt.sub(dt)._unit();dt=dt.add(Oi.mult(ct))._round(),jt=jt.add(Oi.mult(-Ui))._round(),ct=Ui,ot=ut,N&&this.zoom>=17&&(ve(nt,dt)||nt.push(dt),ve(nt,jt)||nt.push(jt))}let qt=Ye.vertexLength,sn=We.length>4&&fM(dt,jt,li),an=gM(Ot,tt,Vt);if(ng(this.layoutVertexArray,dt.x,dt.y,ui,ci,0,0,an),ng(this.layoutVertexArray,dt.x,dt.y,ui,ci,0,1,an),Ot+=wi,an=gM(Ot,sn,!Vt),tt=sn,ng(this.layoutVertexArray,jt.x,jt.y,ui,ci,0,0,an),ng(this.layoutVertexArray,jt.x,jt.y,ui,ci,0,1,an),Ye.vertexLength+=4,this.indexArray.emplaceBack(qt+0,qt+1,qt+2),this.indexArray.emplaceBack(qt+1,qt+3,qt+2),Ye.primitiveLength+=2,pe){let Ui=Ue+(Lt===1?We.length-2:Lt-2),Oi=Lt===1?Ue:Ui+1;if(this.indexArray.emplaceBack(qt+1,Ui,qt+3),this.indexArray.emplaceBack(Ui,Oi,qt+3),Ye.primitiveLength+=2,kt===void 0&&(kt=qt),!h1(li,We[Lt],Ae)){let Wi=Lt===We.length-1?kt:Ye.vertexLength;this.indexArray.emplaceBack(qt+2,qt+3,Wi),this.indexArray.emplaceBack(qt+3,Wi+1,Wi),this.indexArray.emplaceBack(qt+3,Oi,Wi+1),Ye.primitiveLength+=3}Vt=!Vt}if(E){let Ui=this.layoutVertexExtArray,Oi=T.projectTilePoint(dt.x,dt.y,h),Wi=T.projectTilePoint(jt.x,jt.y,h),xn=T.upVector(h,dt.x,dt.y),fn=T.upVector(h,jt.x,jt.y);rg(Ui,Oi,xn),rg(Ui,Oi,xn),rg(Ui,Wi,fn),rg(Ui,Wi,fn)}}P&&(Ue+=We.length-1),N&&pe&&this.zoom>=17&&(nt.length!==0&&ve(nt,nt[0])&&nt.pop(),this.groundEffect.addData(nt,Ae,w,pe>0))}this.footprintSegments.push(qe),rt.triangleCount=this.indexArray.length-rt.triangleArrayOffset,this.polygonSegments.push(rt),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=R.borders?aM:this.encodeCentroid(R,F),this.centroidData.push(F),R.borders){this.featuresOnBorder.push(R);let Ce=this.featuresOnBorder.length-1;for(let Ae=0;Ae<R.borders.length;Ae++)R.borders[Ae][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ae].push(Ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,m,p,h,y),this.groundEffect.addPaintPropertiesData(e,s,m,p,h,y),this.maxHeight=Math.max(this.maxHeight,H)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){let e=[];for(let b=0;b<this.centroidData.length;b++){let y=this.centroidData[b],w=+(y.min.y+y.max.y>pt),M=2*w+(+(y.min.x+y.max.x>pt)^w);for(let T=0;T<y.polygonSegLen;T++){let E=y.polygonSegIdx+T;e.push({centroidIdx:b,subtile:M,polygonSegmentIdx:E,triangleSegmentIdx:this.polygonSegments[E].triangleSegIdx})}}let n=new Rr;e.sort((b,y)=>b.triangleSegmentIdx===y.triangleSegmentIdx?b.subtile-y.subtile:b.triangleSegmentIdx-y.triangleSegmentIdx);let s=0,h=0,m=0;for(let b of e){if(b.triangleSegmentIdx!==s)break;m++}let p=e.length;for(;h!==e.length;){s=e[h].triangleSegmentIdx;let b=0,y=h,w=h;for(let M=y;M<m&&e[M].subtile===b;M++)w++;for(;y!==m;){let M=e[y];b=M.subtile;let T=this.centroidData[M.centroidIdx].min.clone(),E=this.centroidData[M.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=y;R<w;R++){let F=e[R],N=this.polygonSegments[F.polygonSegmentIdx],H=this.centroidData[F.centroidIdx].min,J=this.centroidData[F.centroidIdx].max,ee=this.indexArray.uint16;for(let te=N.triangleArrayOffset;te<N.triangleArrayOffset+N.triangleCount;te++)n.emplaceBack(ee[3*te],ee[3*te+1],ee[3*te+2]);P.primitiveLength+=N.triangleCount,T.x=Math.min(T.x,H.x),T.y=Math.min(T.y,H.y),E.x=Math.max(E.x,J.x),E.y=Math.max(E.y,J.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:T,max:E}),y=w;for(let R=y;R<m&&e[R].subtile===e[y].subtile;R++)w++}h=m;for(let M=h;M<p&&e[M].triangleSegmentIdx===e[h].triangleSegmentIdx;M++)m++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,s){let h=0,m=0,p=1<<e.canonical.z;if(n){let F=n.getMinMaxForTile(e);F&&(h=F.min,m=F.max)}m+=this.maxHeight;let b=e.toUnwrapped(),y,w=[b.canonical.x/p+b.wrap,b.canonical.y/p],M=[(b.canonical.x+1)/p+b.wrap,(b.canonical.y+1)/p],T=new Bn,E=(F,N,H)=>[F[0]*(1-H[0])+N[0]*H[0],F[1]*(1-H[1])+N[1]*H[1]],P=[],R=[];for(let F of this.triangleSubSegments){P[0]=F.min.x/pt,P[1]=F.min.y/pt,R[0]=F.max.x/pt,R[1]=F.max.y/pt;let N=E(w,M,P),H=E(w,M,R);if(new Nn([N[0],N[1],h],[H[0],H[1],m]).intersectsPrecise(s)===0){y&&(T.segments.push(y),y=void 0);continue}let J=F.segment;y&&y.vertexOffset!==J.vertexOffset&&(T.segments.push(y),y=void 0),y?(y.vertexLength+=J.vertexLength,y.primitiveLength+=J.primitiveLength):y={vertexOffset:J.vertexOffset,primitiveLength:J.primitiveLength,vertexLength:J.vertexLength,primitiveOffset:J.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&T.segments.push(y),T}encodeCentroid(e,n){let s=e.centroid(),h=n.span(),m=Math.min(7,Math.round(h.x*this.tileToMeter/10)),p=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new wt(gi(s.x,1,pt-1)<<3|m,gi(s.y,1,pt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new wt(0,0);let n=e.borders,s=Number.MAX_VALUE;if(n[0][0]!==s||n[1][0]!==s){let h=n[0][0]!==s?0:1;return new wt(6|(n[0][0]!==s?0:65528),(n[h][0]+n[h][1])/2<<3|6)}{let h=n[2][0]!==s?2:3;return new wt((n[h][0]+n[h][1])/2<<3|6,6|(n[2][0]!==s?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=md,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,h=e.flags&md?aM:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==h.y||m!==h.x){for(let p=n;p<s;++p)this.centroidVertexArray.emplace(p,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,s){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let h=n.getReplacementRegionsForTile(e.toUnwrapped());if(d1(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let p of this.centroidData)p.flags&=2147483647;let m=[];for(let p of this.activeReplacements){if(p.order<s)continue;let b=Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&md||p.min.x>y.max.x||y.min.x>p.max.x||p.min.y>y.max.y||y.min.y>p.max.y))for(let w=0;w<y.footprintSegLen;w++){let M=this.footprintSegments[y.footprintSegIdx+w];if(m.length=0,o3(this.footprintVertices,M.vertexOffset,M.vertexCount,p.footprintTileId.canonical,e.canonical,m),YS(p.footprint,m,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-b)){y.flags|=md;break}}}for(let p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,s){let h=!1;for(let m=0;m<s.footprintSegLen;m++){let p=this.footprintSegments[s.footprintSegIdx+m],b=0;for(let y of p.ringIndices){for(let w=b,M=y+b-1;w<y+b;M=w++){let T=this.footprintVertices.int16[2*(w+p.vertexOffset)+0],E=this.footprintVertices.int16[2*(w+p.vertexOffset)+1],P=this.footprintVertices.int16[2*(M+p.vertexOffset)+1];E>n!=P>n&&e<(this.footprintVertices.int16[2*(M+p.vertexOffset)+0]-T)*(n-E)/(P-E)+T&&(h=!h)}b=y}}return h}getHeightAtTileCoord(e,n){let s=Number.NEGATIVE_INFINITY,h=!0,m=4*(e+pt)*pt+(n+pt);if(this.partLookup.hasOwnProperty(m)){let p=this.partLookup[m];return p?{height:p.height,hidden:!!(p.flags&md)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||this.footprintContainsPoint(e,n,p)&&p&&p.height>s&&(s=p.height,this.partLookup[m]=p,h=!!(p.flags&md));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:h};this.partLookup[m]=void 0}}function uM(i,e){let n=i.add(e)._unit();return i.x*n.x+i.y*n.y}function r3(i,e,n,s){let h=e.sub(i)._perp()._unit(),m=n.sub(e)._perp()._unit();return mM(i,e,n,uM(h,m),s)}function mM(i,e,n,s,h){let m=Math.sqrt(1-s*s);return Math.min(i.dist(e)/3,e.dist(n)/3,h*m/s)}function h1(i,e,n){return i.x<n[0].x&&e.x<n[0].x||i.x>n[1].x&&e.x>n[1].x||i.y<n[0].y&&e.y<n[0].y||i.y>n[1].y&&e.y>n[1].y}function pM(i,e){return i.x<e[0].x||i.x>e[1].x||i.y<e[0].y||i.y>e[1].y}function fM(i,e,n){if(i.x<0||i.x>=pt||e.x<0||e.x>=pt||n.x<0||n.x>=pt)return!1;let s=n.sub(e),h=s.perp(),m=i.sub(e);return(s.x*m.x+s.y*m.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(m.x*m.x+m.y*m.y))>-.866&&h.x*m.x+h.y*m.y<0}function gM(i,e,n){let s=e?2|i:-3&i;return n?1|s:-2&s}function _M(){let i=Math.PI/32,e=Math.tan(i),n=_m;return n*Math.sqrt(1+2*e*e)-n}function bM(i,e,n){let s=1<<n.z,h=Wo(n.x/s),m=Wo((n.x+1)/s),p=Gr(n.y/s),b=Gr((n.y+1)/s);return function(y,w,M,T,E=0,P){let R=[];if(!y.length||!M||!T)return R;let F=(he,ve)=>{for(let Ce of he)R.push({polygon:Ce,bounds:ve})},N=Math.ceil(Math.log2(M)),H=Math.ceil(Math.log2(T)),J=N-H,ee=[];for(let he=0;he<Math.abs(J);he++)ee.push(J>0?0:1);for(let he=0;he<Math.min(N,H);he++)ee.push(0),ee.push(1);let te=y;if(te=z0(te,w[0].y-E,w[1].y+E,1),te=z0(te,w[0].x-E,w[1].x+E,0),!te.length)return R;let pe=[];for(ee.length?pe.push({polygons:te,bounds:w,depth:0}):F(te,w);pe.length;){let he=pe.pop(),ve=he.depth,Ce=ee[ve],Ae=he.bounds[0],Ue=he.bounds[1],ze=Ce===0?Ae.x:Ae.y,Ye=Ce===0?Ue.x:Ue.y,rt=P?P(Ce,ze,Ye):.5*(ze+Ye),qe=z0(he.polygons,ze-E,rt+E,Ce),et=z0(he.polygons,rt-E,Ye+E,Ce);if(qe.length){let We=[Ae,new wt(Ce===0?rt:Ue.x,Ce===1?rt:Ue.y)];ee.length>ve+1?pe.push({polygons:qe,bounds:We,depth:ve+1}):F(qe,We)}if(et.length){let We=[new wt(Ce===0?rt:Ae.x,Ce===1?rt:Ae.y),Ue];ee.length>ve+1?pe.push({polygons:et,bounds:We,depth:ve+1}):F(et,We)}}return R}(i,e,Math.ceil((m-h)/11.25),Math.ceil((p-b)/11.25),1,(y,w,M)=>{if(y===0)return .5*(w+M);{let T=Gr((n.y+w/pt)/s);return(il(.5*(Gr((n.y+M/pt)/s)+T))*s-n.y)*pt}})}function o3(i,e,n,s,h,m){let p=Math.pow(2,s.z-h.z);for(let b=0;b<n;b++){let y=i.int16[2*(b+e)+0],w=i.int16[2*(b+e)+1];y=(y+h.x*pt)*p-s.x*pt,w=(w+h.y*pt)*p-s.y*pt,m.push(new wt(y,w))}}ne(j0,"FillExtrusionBucket",{omit:["layers","features"]}),ne(lM,"PartData"),ne(sM,"FootprintSegment"),ne(cM,"BorderCentroidData"),ne(hM,"GroundEffect");let a3=new $i({visibility:new Ke(Pe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ke(Pe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var s3={paint:new $i({"fill-extrusion-opacity":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new St(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new St(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new St(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new St(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new St(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new St(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:a3};function og(i,e){return i.x*e.x+i.y*e.y}function yM(i,e){if(i.length===1){let n=0,s=e[n++],h;for(;!h||s.equals(h);)if(h=e[n++],!h)return 1/0;for(;n<e.length;n++){let m=e[n],p=i[0],b=h.sub(s),y=m.sub(s),w=p.sub(s),M=og(b,b),T=og(b,y),E=og(y,y),P=og(w,b),R=og(w,y),F=M*E-T*T,N=(E*P-T*R)/F,H=(M*R-T*P)/F,J=s.z*(1-N-H)+h.z*N+m.z*H;if(isFinite(J))return J}return 1/0}{let n=1/0;for(let s of e)n=Math.min(n,s.z);return n}}function vM(i,e,n,s,h,m,p,b){let y=p*h.getElevationAt(i,e,!0,!0),w=m[0]!==0,M=w?m[1]===0?p*(m[0]/7-450):p*function(T,E,P){let R=Math.floor(E[0]/8),F=Math.floor(E[1]/8),N=10*(E[0]-8*R),H=10*(E[1]-8*F),J=T.getElevationAt(R,F,!0,!0),ee=T.getMeterToDEM(P),te=Math.floor(.5*(N*ee-1)),pe=Math.floor(.5*(H*ee-1)),he=T.tileCoordToPixel(R,F),ve=2*te+1,Ce=2*pe+1,Ae=function(et,We,tt,ct,nt){return[et.getElevationAtPixel(We,tt,!0),et.getElevationAtPixel(We+nt,tt,!0),et.getElevationAtPixel(We,tt+nt,!0),et.getElevationAtPixel(We+ct,tt+nt,!0)]}(T,he.x-te,he.y-pe,ve,Ce),Ue=Math.abs(Ae[0]-Ae[1]),ze=Math.abs(Ae[2]-Ae[3]),Ye=Math.abs(Ae[0]-Ae[2])+Math.abs(Ae[1]-Ae[3]),rt=Math.min(.25,.5*ee*(Ue+ze)/ve),qe=Math.min(.25,.5*ee*Ye/Ce);return J+Math.max(rt*N,qe*H)}(h,m,b):y;return{base:y+(n===0)?-1:n,top:w?Math.max(M+s,y+n+2):y+s}}let l3=Yi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:c3}=l3,d3=Yi([{name:"a_packed",components:4,type:"Float32"}]),{members:h3}=d3,u3=Yi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:m3}=u3,p3=Yi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),f3=Yi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),g3=Yi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Yi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let u1=Yi([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),xM=Yi([{name:"a_z_offset",components:1,type:"Float32"}],4),_3=Yi([{name:"a_texb",components:2,type:"Uint16"}]),b3=Yi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),y3=Yi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Yi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let wM=Yi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),v3=Yi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Yi([{name:"triangle",components:3,type:"Uint16"}]),Yi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Yi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),Yi([{type:"Float32",name:"offsetX"}]),Yi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class CM{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new hd({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let s=this.getKey(e,n);return this.positions[s]}trim(){let e=this.width,n=this.height=Gp(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){let h=[],m=e.length%2==1?-e[e.length-1]*s:0,p=e[0]*s,b=!0;h.push({left:m,right:p,isDash:b,zeroLength:e[0]===0});let y=e[0];for(let w=1;w<e.length;w++){b=!b;let M=e[w];m=y*s,y+=M,p=y*s,h.push({left:m,right:p,isDash:b,zeroLength:M===0})}return h}addRoundDash(e,n,s){let h=n/2;for(let m=-s;m<=s;m++){let p=this.width*(this.nextRow+s+m),b=0,y=e[b];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++b]);let M=Math.abs(w-y.left),T=Math.abs(w-y.right),E=Math.min(M,T),P,R=m/s*(h+1);if(y.isDash){let F=h-Math.abs(R);P=Math.sqrt(E*E+F*F)}else P=h-Math.sqrt(E*E+R*R);this.image.data[p+w]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){let w=e[y],M=e[y+1];w.zeroLength?e.splice(y,1):M&&M.isDash===w.isDash&&(M.left=w.left,e.splice(y,1))}let s=e[0],h=e[e.length-1];s.isDash===h.isDash&&(s.left=h.left-this.width,h.right=s.right+this.width);let m=this.width*this.nextRow,p=0,b=e[p];for(let y=0;y<this.width;y++){y/b.right>1&&(b=e[++p]);let w=Math.abs(y-b.left),M=Math.abs(y-b.right),T=Math.min(w,M);this.image.data[m+y]=Math.max(0,Math.min(255,(b.isDash?T:-T)+n+128))}}addDash(e,n){let s=this.getKey(e,n);if(this.positions[s])return this.positions[s];let h=n==="round",m=h?7:0,p=2*m+1;if(this.nextRow+p>this.height)return sr("LineAtlas out of space"),null;e.length===0&&e.push(1);let b=0;for(let M=0;M<e.length;M++)e[M]<0&&(sr("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),b+=e[M];if(b!==0){let M=this.width/b,T=this.getDashRanges(e,this.width,M);h?this.addRoundDash(T,M,m):this.addRegularDash(T,n==="square"?.5*M:0)}let y=this.nextRow+m;this.nextRow+=p;let w={tl:[y,m],br:[b,0]};return this.positions[s]=w,w}}ne(CM,"LineAtlas");let x3=F0.types,w3=Math.cos(Math.PI/180*37.5),C3=Math.cos(Math.PI/180*5);class U0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new gx,this.layoutVertexArray2=new nd,this.patternVertexArray=new rd,this.indexArray=new Rr,this.programConfigurations=new ld(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Bn,this.maxLineLength=0,this.zOffsetVertexArray=new Bh,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:pt/64}updateFootprints(e,n){}populate(e,n,s,h){this.hasPattern=o1("line",this.layers,n);let m=this.layers[0].layout.get("line-sort-key"),p=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!p.isConstant()||!!p.constantOr(0);let b=[];for(let{feature:T,id:E,index:P,sourceLayerIndex:R}of e){let F=this.layers[0]._featureFilter.needGeometry,N=Gl(T,F);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),N,s))continue;let H=m?m.evaluate(N,{},s):void 0,J={id:E,properties:T.properties,type:T.type,sourceLayerIndex:R,index:P,geometry:F?N.geometry:bs(T,s,h),patterns:{},sortKey:H};b.push(J)}m&&b.sort((T,E)=>T.sortKey-E.sortKey);let{lineAtlas:y,featureIndex:w}=n,M=this.addConstantDashes(y);for(let T of b){let{geometry:E,index:P,sourceLayerIndex:R}=T;if(M&&this.addFeatureDashes(T,y),this.hasPattern){let F=a1("line",this.layers,T,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(T,E,P,s,y.positions,n.availableImages,n.brightness);w.insert(e[P].feature,E,P,R,this.index)}}addConstantDashes(e){let n=!1;for(let s of this.layers){let h=s.paint.get("line-dasharray").value,m=s.layout.get("line-cap").value;if(h.kind!=="constant"||m.kind!=="constant")n=!0;else{let p=m.value,b=h.value;if(!b)continue;e.addDash(b,p)}}return n}addFeatureDashes(e,n){let s=this.zoom;for(let h of this.layers){let m=h.paint.get("line-dasharray").value,p=h.layout.get("line-cap").value;if(m.kind==="constant"&&p.kind==="constant")continue;let b,y;if(m.kind==="constant"){if(b=m.value,!b)continue}else b=m.evaluate({zoom:s},e);y=p.kind==="constant"?p.value:p.evaluate({zoom:s},e),n.addDash(b,y),e.patterns[h.id]=n.getKey(b,y)}}update(e,n,s,h,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,s,h,m)}addFeatures(e,n,s,h,m,p){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,n,s,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,h3)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,m3)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,xM.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,c3),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,h,m,p,b){let y=this.layers[0].layout,w=y.get("line-join").evaluate(e,{}),M=y.get("line-cap").evaluate(e,{}),T=y.get("line-miter-limit"),E=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let P of n)this.addLine(P,e,h,w,M,T,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,m,p,h,b)}addLine(e,n,s,h,m,p,b){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let y={zoom:this.zoom,lineProgress:void 0},w=this.layers[0].layout,M=h==="none";if(this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<e.length-1;he++)this.totalDistance+=e[he].dist(e[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let T=x3[n.type]==="Polygon",E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let P=0;for(;P<E-1&&e[P].equals(e[P+1]);)P++;if(E<(T?3:2))return;h==="bevel"&&(p=1.05);let R=this.overscaling<=16?15*pt/(512*this.overscaling):0,F=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray),N,H,J,ee,te,pe;this.e1=this.e2=-1,T&&(N=e[E-2],te=e[P].sub(N)._unit()._perp());for(let he=P;he<E;he++){if(J=he===E-1?T?e[P+1]:void 0:e[he+1],J&&e[he].equals(J))continue;if(te&&(ee=te),N&&(H=N),N=e[he],this.hasZOffset){let We=w.get("line-z-offset").value;if(We.kind==="constant")pe=We.value;else{if(this.lineClips){let tt=this.totalDistance/(this.lineClips.end-this.lineClips.start);y.lineProgress=(tt*this.lineClips.start+this.distance+(H?H.dist(N):0))/tt}else sr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),y.lineProgress=0;pe=We.evaluate(y,n)}pe=pe||0}te=J?J.sub(N)._unit()._perp():ee,ee=ee||te;let ve=H&&J,Ce=ve?h:T||M?"butt":m,Ae=ee.x*te.x+ee.y*te.y;if(M){let We=function(tt){if(tt.patternJoinNone){let ct=tt.segmentPoints.length/2,nt=tt.lineSoFar-tt.segmentStart;for(let kt=0;kt<ct;++kt){let ot=tt.segmentPoints[2*kt+1],ut=Math.round(tt.segmentPoints[2*kt])+.5+.25*ot;tt.patternVertexArray.emplaceBack(ut,nt,tt.segmentStart),tt.patternVertexArray.emplaceBack(ut,nt,tt.segmentStart)}tt.segmentPoints.length=0}tt.e1=tt.e2=-1};if(ve&&Ae<C3){this.updateDistance(H,N),this.addCurrentVertex(N,ee,1,1,F,pe),We(this),this.addCurrentVertex(N,te,-1,-1,F,pe);continue}if(H){if(!J){this.updateDistance(H,N),this.addCurrentVertex(N,ee,1,1,F,pe),We(this);continue}Ce="miter"}}let Ue=ee.add(te);Ue.x===0&&Ue.y===0||Ue._unit();let ze=Ue.x*te.x+Ue.y*te.y,Ye=ze!==0?1/ze:1/0,rt=2*Math.sqrt(2-2*ze),qe=ze<w3&&H&&J,et=ee.x*te.y-ee.y*te.x>0;if(qe&&he>P){let We=N.dist(H);if(We>2*R){let tt=N.sub(N.sub(H)._mult(R/We)._round());this.updateDistance(H,tt),this.addCurrentVertex(tt,ee,0,0,F,pe),H=tt}}if(ve&&Ce==="round"&&(Ye<b?Ce="miter":Ye<=2&&(Ce="fakeround")),Ce==="miter"&&Ye>p&&(Ce="bevel"),Ce==="bevel"&&(Ye>2&&(Ce="flipbevel"),Ye<p&&(Ce="miter")),H&&this.updateDistance(H,N),Ce==="miter")Ue._mult(Ye),this.addCurrentVertex(N,Ue,0,0,F,pe);else if(Ce==="flipbevel"){if(Ye>100)Ue=te.mult(-1);else{let We=Ye*ee.add(te).mag()/ee.sub(te).mag();Ue._perp()._mult(We*(et?-1:1))}this.addCurrentVertex(N,Ue,0,0,F,pe),this.addCurrentVertex(N,Ue.mult(-1),0,0,F,pe)}else if(Ce==="bevel"||Ce==="fakeround"){let We=-Math.sqrt(Ye*Ye-1),tt=et?We:0,ct=et?0:We;if(H&&this.addCurrentVertex(N,ee,tt,ct,F,pe),Ce==="fakeround"){let nt=Math.round(180*rt/Math.PI/20);for(let kt=1;kt<nt;kt++){let ot=kt/nt;if(ot!==.5){let Vt=ot-.5;ot+=ot*Vt*(ot-1)*((1.0904+Ae*(Ae*(3.55645-1.43519*Ae)-3.2452))*Vt*Vt+(.848013+Ae*(.215638*Ae-1.06021)))}let ut=te.sub(ee)._mult(ot)._add(ee)._unit()._mult(et?-1:1);this.addHalfVertex(N,ut.x,ut.y,!1,et,0,F,pe)}}J&&this.addCurrentVertex(N,te,-tt,-ct,F,pe)}else Ce==="butt"?this.addCurrentVertex(N,Ue,0,0,F,pe):Ce==="square"?(H||this.addCurrentVertex(N,Ue,-1,-1,F,pe),this.addCurrentVertex(N,Ue,0,0,F,pe),H&&this.addCurrentVertex(N,Ue,1,1,F,pe)):Ce==="round"&&(H&&(this.addCurrentVertex(N,ee,0,0,F,pe),this.addCurrentVertex(N,ee,1,1,F,pe,!0)),J&&(this.addCurrentVertex(N,te,-1,-1,F,pe,!0),this.addCurrentVertex(N,te,0,0,F,pe)));if(qe&&he<E-1){let We=N.dist(J);if(We>2*R){let tt=N.add(J.sub(N)._mult(R/We)._round());this.updateDistance(N,tt),this.addCurrentVertex(tt,te,0,0,F,pe),N=tt}}}}addVerticesTo(e,n,s,h,m,p,b,y,w,M){let T=(n.w-e.w)/this.tessellationStep|0;if(T>1){this.lineSoFar=e.w;let E=(n.x-e.x)/T,P=(n.y-e.y)/T,R=(n.z-e.z)/T,F=(n.w-e.w)/T;for(let N=1;N<T;++N)e.x+=E,e.y+=P,e.z+=R,this.lineSoFar+=F,this.addHalfVertex(e,s,h,M,!1,b,w,e.z),this.addHalfVertex(e,m,p,M,!0,-y,w,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,s,h,M,!1,b,w,n.z),this.addHalfVertex(n,m,p,M,!0,-y,w,n.z)}addCurrentVertex(e,n,s,h,m,p,b=!1){let y=n.x+n.y*s,w=n.y-n.x*s,M=n.y*h-n.x,T=-n.y-n.x*h;if(p!=null){let P=pt+10,R=p,F=new WS(e.x,e.y,R,this.lineSoFar),N=SM(e,-10,P),H=this.lineSoFar;if(this.currentVertex)if(N){let J=this.currentVertexIsOutside,ee=this.currentVertex,te=new WS(e.x,e.y,R,this.lineSoFar);GS(ee,te,-10,P),SM(te,-10,P)||(J&&(this.e1=this.e2=-1,this.lineSoFar=ee.w,this.addHalfVertex(ee,y,w,b,!1,s,m,ee.z),this.addHalfVertex(ee,M,T,b,!0,-h,m,ee.z)),this.addVerticesTo(ee,te,y,w,M,T,s,h,m,b))}else{let J=this.currentVertex;this.currentVertexIsOutside&&(GS(J,F,-10,P),this.e1=this.e2=-1,this.lineSoFar=J.w,this.addHalfVertex(J,y,w,b,!1,s,m,J.z),this.addHalfVertex(J,M,T,b,!0,-h,m,J.z)),this.addVerticesTo(J,F,y,w,M,T,s,h,m,b)}else N||(this.addHalfVertex(e,y,w,b,!1,s,m,p),this.addHalfVertex(e,M,T,b,!0,-h,m,p));this.currentVertex=F,this.currentVertexIsOutside=N,this.lineSoFar=H}else this.addHalfVertex(e,y,w,b,!1,s,m,p),this.addHalfVertex(e,M,T,b,!0,-h,m,p)}addHalfVertex({x:e,y:n},s,h,m,p,b,y,w){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(n<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*h)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let M=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),y.primitiveLength++),p?this.e2=M:this.e1=M,w!=null&&this.zOffsetVertexArray.emplaceBack(w)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function SM(i,e,n){return i.x<e||i.x>n||i.y<e||i.y>n}ne(U0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let S3=new $i({"line-cap":new St(Pe.layout_line["line-cap"]),"line-join":new St(Pe.layout_line["line-join"]),"line-miter-limit":new Ke(Pe.layout_line["line-miter-limit"]),"line-round-limit":new Ke(Pe.layout_line["line-round-limit"]),"line-sort-key":new St(Pe.layout_line["line-sort-key"]),"line-z-offset":new St(Pe.layout_line["line-z-offset"]),visibility:new Ke(Pe.layout_line.visibility)});var W0={paint:new $i({"line-opacity":new St(Pe.paint_line["line-opacity"]),"line-color":new St(Pe.paint_line["line-color"]),"line-translate":new Ke(Pe.paint_line["line-translate"]),"line-translate-anchor":new Ke(Pe.paint_line["line-translate-anchor"]),"line-width":new St(Pe.paint_line["line-width"]),"line-gap-width":new St(Pe.paint_line["line-gap-width"]),"line-offset":new St(Pe.paint_line["line-offset"]),"line-blur":new St(Pe.paint_line["line-blur"]),"line-dasharray":new St(Pe.paint_line["line-dasharray"]),"line-pattern":new St(Pe.paint_line["line-pattern"]),"line-gradient":new zn(Pe.paint_line["line-gradient"]),"line-trim-offset":new Ke(Pe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ke(Pe.paint_line["line-trim-fade-range"]),"line-trim-color":new Ke(Pe.paint_line["line-trim-color"]),"line-emissive-strength":new Ke(Pe.paint_line["line-emissive-strength"]),"line-border-width":new St(Pe.paint_line["line-border-width"]),"line-border-color":new St(Pe.paint_line["line-border-color"]),"line-occlusion-opacity":new Ke(Pe.paint_line["line-occlusion-opacity"])}),layout:S3};function MM(i,e,n){return e*(pt/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function kM(i,e){return 1/MM(i,1,e.tileZoom)}function IM(i,e,n,s){return i.translatePosMatrix(s||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let TM=i=>{let e=[];EM(i)&&e.push("RENDER_LINE_DASH"),i.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=i.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),i.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let s=i.layout.get("line-join").constantOr("miter")==="none",h=!!i.paint.get("line-pattern").constantOr(1);return s&&h&&e.push("LINE_JOIN_NONE"),e};function EM(i){let e=i.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class DM{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var M3={read:function(i,e,n,s,h){var m,p,b=8*h-s-1,y=(1<<b)-1,w=y>>1,M=-7,T=n?h-1:0,E=n?-1:1,P=i[e+T];for(T+=E,m=P&(1<<-M)-1,P>>=-M,M+=b;M>0;m=256*m+i[e+T],T+=E,M-=8);for(p=m&(1<<-M)-1,m>>=-M,M+=s;M>0;p=256*p+i[e+T],T+=E,M-=8);if(m===0)m=1-w;else{if(m===y)return p?NaN:1/0*(P?-1:1);p+=Math.pow(2,s),m-=w}return(P?-1:1)*p*Math.pow(2,m-s)},write:function(i,e,n,s,h,m){var p,b,y,w=8*m-h-1,M=(1<<w)-1,T=M>>1,E=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=s?0:m-1,R=s?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,p=M):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+T>=1?E/y:E*Math.pow(2,1-T))*y>=2&&(p++,y/=2),p+T>=M?(b=0,p=M):p+T>=1?(b=(e*y-1)*Math.pow(2,h),p+=T):(b=e*Math.pow(2,T-1)*Math.pow(2,h),p=0));h>=8;i[n+P]=255&b,P+=R,b/=256,h-=8);for(p=p<<h|b,w+=h;w>0;i[n+P]=255&p,P+=R,p/=256,w-=8);i[n+P-R]|=128*F}},AM=On,H0=M3;function On(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}On.Varint=0,On.Fixed64=1,On.Bytes=2,On.Fixed32=5;var m1=4294967296,PM=1/m1,OM=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Yl(i){return i.type===On.Bytes?i.readVarint()+i.pos:i.pos+1}function Cm(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function RM(i,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var h=n.pos-1;h>=i;h--)n.buf[h+s]=n.buf[h]}function k3(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function I3(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function T3(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function E3(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function D3(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function A3(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function P3(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function O3(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function R3(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function G0(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Sm(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function LM(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}On.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),h=s>>3,m=this.pos;this.type=7&s,i(h,e,this),this.pos===m&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=G0(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=LM(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=G0(this.buf,this.pos)+G0(this.buf,this.pos+4)*m1;return this.pos+=8,i},readSFixed64:function(){var i=G0(this.buf,this.pos)+LM(this.buf,this.pos+4)*m1;return this.pos+=8,i},readFloat:function(){var i=H0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=H0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(h,m,p){var b,y,w=p.buf;if(b=(112&(y=w[p.pos++]))>>4,y<128||(b|=(127&(y=w[p.pos++]))<<3,y<128)||(b|=(127&(y=w[p.pos++]))<<10,y<128)||(b|=(127&(y=w[p.pos++]))<<17,y<128)||(b|=(127&(y=w[p.pos++]))<<24,y<128)||(b|=(1&(y=w[p.pos++]))<<31,y<128))return Cm(h,b,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&OM?function(n,s,h){return OM.decode(n.subarray(s,h))}(this.buf,e,i):function(n,s,h){for(var m="",p=s;p<h;){var b,y,w,M=n[p],T=null,E=M>239?4:M>223?3:M>191?2:1;if(p+E>h)break;E===1?M<128&&(T=M):E===2?(192&(b=n[p+1]))==128&&(T=(31&M)<<6|63&b)<=127&&(T=null):E===3?(y=n[p+2],(192&(b=n[p+1]))==128&&(192&y)==128&&((T=(15&M)<<12|(63&b)<<6|63&y)<=2047||T>=55296&&T<=57343)&&(T=null)):E===4&&(y=n[p+2],w=n[p+3],(192&(b=n[p+1]))==128&&(192&y)==128&&(192&w)==128&&((T=(15&M)<<18|(63&b)<<12|(63&y)<<6|63&w)<=65535||T>=1114112)&&(T=null)),T===null?(T=65533,E=1):T>65535&&(T-=65536,m+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),m+=String.fromCharCode(T),p+=E}return m}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==On.Bytes)return i.push(this.readVarint(e));var n=Yl(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==On.Bytes)return i.push(this.readSVarint());var e=Yl(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==On.Bytes)return i.push(this.readBoolean());var e=Yl(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==On.Bytes)return i.push(this.readFloat());var e=Yl(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==On.Bytes)return i.push(this.readDouble());var e=Yl(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==On.Bytes)return i.push(this.readFixed32());var e=Yl(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==On.Bytes)return i.push(this.readSFixed32());var e=Yl(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==On.Bytes)return i.push(this.readFixed64());var e=Yl(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==On.Bytes)return i.push(this.readSFixed64());var e=Yl(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===On.Varint)for(;this.buf[this.pos++]>127;);else if(e===On.Bytes)this.pos=this.readVarint()+this.pos;else if(e===On.Fixed32)this.pos+=4;else{if(e!==On.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Sm(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Sm(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Sm(this.buf,-1&i,this.pos),Sm(this.buf,Math.floor(i*PM),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Sm(this.buf,-1&i,this.pos),Sm(this.buf,Math.floor(i*PM),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var s,h;if(e>=0?(s=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,p,b){b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7)}(s,0,n),function(m,p){var b=(7&m)<<4;p.buf[p.pos++]|=b|((m>>>=3)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m)))))}(h,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,h,m){for(var p,b,y=0;y<h.length;y++){if((p=h.charCodeAt(y))>55295&&p<57344){if(!b){p>56319||y+1===h.length?(s[m++]=239,s[m++]=191,s[m++]=189):b=p;continue}if(p<56320){s[m++]=239,s[m++]=191,s[m++]=189,b=p;continue}p=b-55296<<10|p-56320|65536,b=null}else b&&(s[m++]=239,s[m++]=191,s[m++]=189,b=null);p<128?s[m++]=p:(p<2048?s[m++]=p>>6|192:(p<65536?s[m++]=p>>12|224:(s[m++]=p>>18|240,s[m++]=p>>12&63|128),s[m++]=p>>6&63|128),s[m++]=63&p|128)}return m}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&RM(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),H0.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),H0.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var s=this.pos-n;s>=128&&RM(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,n){this.writeTag(i,On.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,k3,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,I3,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,D3,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,T3,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,E3,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,A3,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,P3,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,O3,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,R3,e)},writeBytesField:function(i,e){this.writeTag(i,On.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,On.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,On.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,On.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,On.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,On.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,On.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,On.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,On.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,On.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Mm=Ge(AM);let L3=["id","tile","layer","source","sourceLayer","state"];class FM{constructor(e,n,s,h,m){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=s,this._y=h,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let n of L3)this[n]!==void 0&&(e[n]=this[n]);return e}}class F3{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,s){let h=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},Jr(this.stateChanges[e][h],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(let m in this.state[e])m!==h&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(let m in this.state[e][h])s[m]||(this.deletedStates[e][h][m]=null)}else for(let m in s)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][m]===null&&delete this.deletedStates[e][h][m]}removeFeatureState(e,n,s){if(this.deletedStates[e]===null)return;let h=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&n!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][s]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(s in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][s]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,n){let s=String(n),h=Jr({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let m=this.deletedStates[e][n];if(m===null)return{};for(let p in m)delete h[p]}return h}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let s={};for(let h in this.stateChanges){this.state[h]=this.state[h]||{};let m={};for(let p in this.stateChanges[h])this.state[h][p]||(this.state[h][p]={}),Jr(this.state[h][p],this.stateChanges[h][p]),m[p]=this.state[h][p];s[h]=m}for(let h in this.deletedStates){this.state[h]=this.state[h]||{};let m={};if(this.deletedStates[h]===null)for(let p in this.state[h])m[p]={},this.state[h][p]={};else for(let p in this.deletedStates[h]){if(this.deletedStates[h][p]===null)this.state[h][p]={};else if(this.state[h][p])for(let b of Object.keys(this.deletedStates[h][p]))delete this.state[h][p][b];m[p]=this.state[h][p]}s[h]=s[h]||{},Jr(s[h],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(let h in e)e[h].setFeatureState(s,n)}}class zM{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new _e(pt,16,0),this.featureIndexArray=new Z2,this.promoteId=n,this.is3DTile=!1}insert(e,n,s,h,m,p=0,b=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,m,p);let w=this.grid;for(let M=0;M<n.length;M++){let T=n[M],E=[1/0,1/0,-1/0,-1/0];for(let P=0;P<T.length;P++){let R=T[P];E[0]=Math.min(E[0],R.x),E[1]=Math.min(E[1],R.y),E[2]=Math.max(E[2],R.x),E[3]=Math.max(E[3],R.y)}b!==0&&(E[0]-=b,E[1]-=b,E[2]+=b,E[3]+=b),E[0]<pt&&E[1]<pt&&E[2]>=0&&E[3]>=0&&w.insert(y,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new l1(new Mm(this.rawTileData)).layers,this.sourceLayerCoder=new DM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,h){this.loadVTLayers();let m=e.params||{},p=Dr(m.filter),b=e.tileResult,y=e.transform,w=b.bufferedTilespaceBounds,M=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(R,F,N,H)=>uS(b.bufferedTilespaceGeometry,R,F,N,H));M.sort(z3);let T=null;y.elevation&&M.length>0&&(T=wm.create(y.elevation,this.tileID));let E={},P;for(let R=0;R<M.length;R++){let F=M[R];if(F===P)continue;P=F;let N=this.featureIndexArray.get(F),H=null;if(this.is3DTile){let J=this.bucketLayerIDs[0][0],ee=n[J];if(ee.type!=="model")continue;let{queryFeature:te,intersectionZ:pe}=ee.queryIntersectsMatchingFeature(b,N.featureIndex,p,y);te&&this.appendToResult(E,J,N.featureIndex,te,pe)}else this.loadMatchingFeature(E,N,p,m.layers,m.availableImages,n,s,h,(J,ee,te,pe=0)=>(H||(H=bs(J,this.tileID.canonical,e.tileTransform)),ee.queryIntersectsFeature(b,J,te,H,this.z,e.transform,e.pixelPosMatrix,T,pe)))}return E}loadMatchingFeature(e,n,s,h,m,p,b,y,w){let{featureIndex:M,bucketIndex:T,sourceLayerIndex:E,layoutVertexArrayOffset:P}=n,R=this.bucketLayerIDs[T];if(h&&!function(J,ee){for(let te=0;te<J.length;te++)if(ee.indexOf(J[te])>=0)return!0;return!1}(h,R))return;let F=this.sourceLayerCoder.decode(E),N=this.vtLayers[F].feature(M);if(s.needGeometry){let J=Gl(N,!0);if(!s.filter(new Kt(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!s.filter(new Kt(this.tileID.overscaledZ),N))return;let H=this.getId(N,F);for(let J=0;J<R.length;J++){let ee=R[J];if(h&&h.indexOf(ee)<0)continue;let te=p[ee];if(!te)continue;let pe={};H!==void 0&&y&&(pe=y.getState(te.sourceLayer||"_geojsonTileLayer",H));let he=!w||w(N,te,pe,P);if(!he)continue;let ve=new FM(N,this.z,this.x,this.y,H),Ce=Jr({},b[ee]);Ce.paint=BM(Ce.paint,te.paint,N,pe,m),Ce.layout=BM(Ce.layout,te.layout,N,pe,m),ve.layer=Ce,this.appendToResult(e,ee,M,ve,he)}}appendToResult(e,n,s,h,m){let p=e[n];p===void 0&&(p=e[n]=[]),p.push({featureIndex:s,feature:h,intersectionZ:m})}lookupSymbolFeatures(e,n,s,h,m,p,b,y){let w={};this.loadVTLayers();let M=Dr(m);for(let T of e)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:h,featureIndex:T,layoutVertexArrayOffset:0},M,p,b,y,n);return w}loadFeature(e){let{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();let h=this.sourceLayerCoder.decode(s),m=this.vtFeatures[h];if(m[n])return m[n];let p=this.vtLayers[h].feature(n);return m[n]=p,p}hasLayer(e){for(let n of this.bucketLayerIDs)for(let s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;if(this.promoteId){let h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];h!=null&&(s=e.properties[h]),typeof s=="boolean"&&(s=Number(s))}return s}}function BM(i,e,n,s,h){return Oc(i,(m,p)=>{let b=e instanceof on?e.get(p):null;return b&&b.evaluate?b.evaluate(n,s,h):b})}function z3(i,e){return e-i}ne(zM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var to=24;let ys=128;function p1(i,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Kt(i+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:s,interpolationType:h}=n,m=0;for(;m<s.length&&s[m]<=i;)m++;m=Math.max(0,m-1);let p=m;for(;p<s.length&&s[p]<i+1;)p++;p=Math.min(s.length-1,p);let b=s[m],y=s[p];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:y,interpolationType:h}:{kind:"camera",minZoom:b,maxZoom:y,minSize:n.evaluate(new Kt(b)),maxSize:n.evaluate(new Kt(y)),interpolationType:h}}}function q0(i,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:h}){return i.kind==="source"?s/ys:i.kind==="composite"?Ht(s/ys,h/ys,n):e}function km(i,e){let n=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){let{interpolationType:h,minZoom:m,maxZoom:p}=i,b=h?gi(Vo.interpolationFactor(h,e,m,p),0,1):0;i.kind==="camera"?s=Ht(i.minSize,i.maxSize,b):n=b}return{uSizeT:n,uSize:s}}var B3=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ys,evaluateSizeForFeature:q0,evaluateSizeForZoom:km,getSizeData:p1});function N3(i,e,n){return i.sections.forEach(s=>{s.text=function(h,m,p){let b=m.layout.get("text-transform").evaluate(p,{});return b==="uppercase"?h=h.toLocaleUpperCase():b==="lowercase"&&(h=h.toLocaleLowerCase()),tn.applyArabicShaping&&(h=tn.applyArabicShaping(h)),h}(s.text,e,n)}),i}let ag={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function V3(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function j3(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}let f1=3;function U3(i,e,n){e.glyphs=[],i===1&&n.readMessage(W3,e)}function W3(i,e,n){if(i===3){let{id:s,bitmap:h,width:m,height:p,left:b,top:y,advance:w}=n.readMessage(H3,{});e.glyphs.push({id:s,bitmap:new hd({width:m+2*f1,height:p+2*f1},h),metrics:{width:m,height:p,left:b,top:y,advance:w}})}else i===4?e.ascender=n.readSVarint():i===5&&(e.descender=n.readSVarint())}function H3(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}let NM=f1,Ia={horizontal:1,vertical:2,horizontalOnly:3};class sg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let s=new sg;return s.scale=e||1,s.fontStack=n,s}static forImage(e){let n=new sg;return n.imageName=e,n}}class Im{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let s=new Im;for(let h=0;h<e.sections.length;h++){let m=e.sections[h];m.image?s.addImageSection(m):s.addTextSection(m,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,s){let h="";for(let m=0;m<n.length;m++){let p=n.charCodeAt(m+1)||null,b=n.charCodeAt(m-1)||null;h+=!s&&(p&&Xe(p)&&!ag[n[m+1]]||b&&Xe(b)&&!ag[n[m-1]])||!ag[n[m]]?n[m]:ag[n[m]]}return h}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&$0[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&$0[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let s=new Im;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(sg.forText(e.scale,e.fontStack||n));let s=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(s)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void sr("Can't add FormattedSection with an empty image.");let s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(sg.forImage(n)),this.sectionIndex.push(this.sections.length-1)):sr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function g1(i,e,n,s,h,m,p,b,y,w,M,T,E,P,R){let F=Im.fromFeature(i,h);T===Ia.vertical&&F.verticalizePunctuation(E);let N=[],H=function(he,ve,Ce,Ae,Ue,ze){if(!he)return[];let Ye=[],rt=function(tt,ct,nt,kt,ot,ut){let Vt=0;for(let Lt=0;Lt<tt.length();Lt++){let Ot=tt.getSection(Lt);Vt+=VM(tt.getCodePoint(Lt),Ot,kt,ot,ct,ut)}return Vt/Math.max(1,Math.ceil(Vt/nt))}(he,ve,Ce,Ae,Ue,ze),qe=he.text.indexOf("\u200B")>=0,et=0;for(let tt=0;tt<he.length();tt++){let ct=he.getSection(tt),nt=he.getCodePoint(tt);if($0[nt]||(et+=VM(nt,ct,Ae,Ue,ve,ze)),tt<he.length()-1){let kt=!((We=nt)<11904||!(me["Bopomofo Extended"](We)||me.Bopomofo(We)||me["CJK Compatibility Forms"](We)||me["CJK Compatibility Ideographs"](We)||me["CJK Compatibility"](We)||me["CJK Radicals Supplement"](We)||me["CJK Strokes"](We)||me["CJK Symbols and Punctuation"](We)||me["CJK Unified Ideographs Extension A"](We)||me["CJK Unified Ideographs"](We)||me["Enclosed CJK Letters and Months"](We)||me["Halfwidth and Fullwidth Forms"](We)||me.Hiragana(We)||me["Ideographic Description Characters"](We)||me["Kangxi Radicals"](We)||me["Katakana Phonetic Extensions"](We)||me.Katakana(We)||me["Vertical Forms"](We)||me["Yi Radicals"](We)||me["Yi Syllables"](We)));(G3[nt]||kt||ct.imageName)&&Ye.push(UM(tt+1,et,rt,Ye,q3(nt,he.getCodePoint(tt+1),kt&&qe),!1))}}var We;return WM(UM(he.length(),et,rt,Ye,0,!0))}(F,w,m,e,s,P),{processBidirectionalText:J,processStyledBidirectionalText:ee}=tn;if(J&&F.sections.length===1){let he=J(F.toString(),H);for(let ve of he){let Ce=new Im;Ce.text=ve,Ce.sections=F.sections;for(let Ae=0;Ae<ve.length;Ae++)Ce.sectionIndex.push(0);N.push(Ce)}}else if(ee){let he=ee(F.text,F.sectionIndex,H);for(let ve of he){let Ce=new Im;Ce.text=ve[0],Ce.sectionIndex=ve[1],Ce.sections=F.sections,N.push(Ce)}}else N=function(he,ve){let Ce=[],Ae=he.text,Ue=0;for(let ze of ve)Ce.push(he.substring(Ue,ze)),Ue=ze;return Ue<Ae.length&&Ce.push(he.substring(Ue,Ae.length)),Ce}(F,H);let te=[],pe={positionedLines:te,text:F.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,ve,Ce,Ae,Ue,ze,Ye,rt,qe,et,We,tt){let ct=0,nt=0,kt=0,ot=rt==="right"?1:rt==="left"?0:.5,ut=!1;for(let li of Ue){let Zt=li.getSections();for(let ui of Zt){if(ui.imageName)continue;let ci=ve[ui.fontStack];if(ci&&(ut=ci.ascender!==void 0&&ci.descender!==void 0,!ut))break}if(!ut)break}let Vt=0;for(let li of Ue){li.trim();let Zt=li.getMaxScale(),ui=(Zt-1)*to,ci={positionedGlyphs:[],lineOffset:0};he.positionedLines[Vt]=ci;let wi=ci.positionedGlyphs,qt=0;if(!li.length()){nt+=ze,++Vt;continue}let sn=0,an=0;for(let Oi=0;Oi<li.length();Oi++){let Wi=li.getSection(Oi),xn=li.getSectionIndex(Oi),fn=li.getCodePoint(Oi),Gn=Wi.scale,Vn=null,lo=null,er=null,Rn=to,vr=0,qr=!(qe===Ia.horizontal||!We&&!Je(fn)||We&&($0[fn]||(Lt=fn,me.Arabic(Lt)||me["Arabic Supplement"](Lt)||me["Arabic Extended-A"](Lt)||me["Arabic Presentation Forms-A"](Lt)||me["Arabic Presentation Forms-B"](Lt))));if(Wi.imageName){let $r=Ae[Wi.imageName];if(!$r)continue;er=Wi.imageName,he.iconsInText=he.iconsInText||!0,lo=$r.paddedRect;let _n=$r.displaySize;Gn=Gn*to/tt,Vn={width:_n[0],height:_n[1],left:0,top:-NM,advance:qr?_n[1]:_n[0],localGlyph:!1},vr=ut?-Vn.height*Gn:Zt*to-17-_n[1]*Gn,Rn=Vn.advance;let Eo=(qr?_n[0]:_n[1])*Gn-to*Zt;Eo>0&&Eo>qt&&(qt=Eo)}else{let $r=Ce[Wi.fontStack];if(!$r)continue;$r[fn]&&(lo=$r[fn]);let _n=ve[Wi.fontStack];if(!_n)continue;let Eo=_n.glyphs[fn];if(!Eo)continue;if(Vn=Eo.metrics,Rn=fn!==8203?to:0,ut){let Xl=_n.ascender!==void 0?Math.abs(_n.ascender):0,Xa=_n.descender!==void 0?Math.abs(_n.descender):0,ks=(Xl+Xa)*Gn;sn<ks&&(sn=ks,an=(Xl-Xa)/2*Gn),vr=-Xl*Gn}else vr=(Zt-Gn)*to-17}qr?(he.verticalizable=!0,wi.push({glyph:fn,imageName:er,x:ct,y:nt+vr,vertical:qr,scale:Gn,localGlyph:Vn.localGlyph,fontStack:Wi.fontStack,sectionIndex:xn,metrics:Vn,rect:lo}),ct+=Rn*Gn+et):(wi.push({glyph:fn,imageName:er,x:ct,y:nt+vr,vertical:qr,scale:Gn,localGlyph:Vn.localGlyph,fontStack:Wi.fontStack,sectionIndex:xn,metrics:Vn,rect:lo}),ct+=Vn.advance*Gn+et)}wi.length!==0&&(kt=Math.max(ct-et,kt),ut?HM(wi,ot,qt,an,ze*Zt/2):HM(wi,ot,qt,0,ze/2)),ct=0;let Ui=ze*Zt+qt;ci.lineOffset=Math.max(qt,ui),nt+=Ui,++Vt}var Lt;let Ot=nt,{horizontalAlign:dt,verticalAlign:jt}=_1(Ye);(function(li,Zt,ui,ci,wi,qt){let sn=(Zt-ui)*wi,an=-qt*ci;for(let Ui of li)for(let Oi of Ui.positionedGlyphs)Oi.x+=sn,Oi.y+=an})(he.positionedLines,ot,dt,jt,kt,Ot),he.top+=-jt*Ot,he.bottom=he.top+Ot,he.left+=-dt*kt,he.right=he.left+kt,he.hasBaseline=ut}(pe,e,n,s,N,p,b,y,T,w,E,R),!function(he){for(let ve of he)if(ve.positionedGlyphs.length!==0)return!1;return!0}(te)&&pe}let $0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},G3={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function VM(i,e,n,s,h,m){if(e.imageName){let p=s[e.imageName];return p?p.displaySize[0]*e.scale*to/m+h:0}{let p=n[e.fontStack],b=p&&p.glyphs[i];return b?b.metrics.advance*e.scale+h:0}}function jM(i,e,n,s){let h=Math.pow(i-e,2);return s?i<e?h/2:2*h:h+Math.abs(n)*n}function q3(i,e,n){let s=0;return i===10&&(s-=1e4),n&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function UM(i,e,n,s,h,m){let p=null,b=jM(e,n,h,m);for(let y of s){let w=jM(e-y.x,n,h,m)+y.badness;w<=b&&(p=y,b=w)}return{index:i,x:e,priorBreak:p,badness:b}}function WM(i){return i?WM(i.priorBreak).concat(i.index):[]}function _1(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function HM(i,e,n,s,h){if(!(e||n||s||h))return;let m=i.length-1,p=i[m],b=(p.x+p.metrics.advance*p.scale)*e;for(let y=0;y<=m;y++)i[y].x-=b,i[y].y+=n+s+h}function $3(i,e,n,s){let{horizontalAlign:h,verticalAlign:m}=_1(s),p=n[0]-i.displaySize[0]*h,b=n[1]-i.displaySize[1]*m;return{imagePrimary:i,imageSecondary:e,top:b,bottom:b+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function GM(i,e,n,s,h,m){let p=i.imagePrimary,b;if(p.content){let N=p.content,H=p.pixelRatio||1;b=[N[0]/H,N[1]/H,p.displaySize[0]-N[2]/H,p.displaySize[1]-N[3]/H]}let y=e.left*m,w=e.right*m,M,T,E,P;n==="width"||n==="both"?(P=h[0]+y-s[3],T=h[0]+w+s[1]):(P=h[0]+(y+w-p.displaySize[0])/2,T=P+p.displaySize[0]);let R=e.top*m,F=e.bottom*m;return n==="height"||n==="both"?(M=h[1]+R-s[0],E=h[1]+F+s[2]):(M=h[1]+(R+F-p.displaySize[1])/2,E=M+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:M,right:T,bottom:E,left:P,collisionPadding:b}}class Zl extends wt{constructor(e,n,s,h,m){super(e,n),this.angle=h,this.z=s,m!==void 0&&(this.segment=m)}clone(){return new Zl(this.x,this.y,this.z,this.angle,this.segment)}}function qM(i,e,n,s,h){if(e.segment===void 0)return!0;let m=e,p=e.segment+1,b=0;for(;b>-n/2;){if(p--,p<0)return!1;b-=i[p].dist(m),m=i[p]}b+=i[p].dist(i[p+1]),p++;let y=[],w=0;for(;b<n/2;){let M=i[p],T=i[p+1];if(!T)return!1;let E=i[p-1].angleTo(M)-M.angleTo(T);for(E=Math.abs((E+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:b,angleDelta:E}),w+=E;b-y[0].distance>s;)w-=y.shift().angleDelta;if(w>h)return!1;p++,b+=M.dist(T)}return!0}function $M(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function YM(i,e,n){return i?.6*e*n:0}function ZM(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Y3(i,e,n,s,h,m){let p=YM(n,h,m),b=ZM(n,s)*m,y=0,w=$M(i)/2;for(let M=0;M<i.length-1;M++){let T=i[M],E=i[M+1],P=T.dist(E);if(y+P>w){let R=(w-y)/P,F=Ht(T.x,E.x,R),N=Ht(T.y,E.y,R),H=new Zl(F,N,0,E.angleTo(T),M);return!p||qM(i,H,b,p,e)?H:void 0}y+=P}}function Z3(i,e,n,s,h,m,p,b,y){let w=YM(s,m,p),M=ZM(s,h),T=M*p,E=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-T<e/4&&(e=T+e/4),XM(i,E?e/2*b%e:(M/2+2*m)*p*b%e,e,w,n,T,E,!1,y)}function XM(i,e,n,s,h,m,p,b,y){let w=m/2,M=$M(i),T=0,E=e-n,P=[];for(let R=0;R<i.length-1;R++){let F=i[R],N=i[R+1],H=F.dist(N),J=N.angleTo(F);for(;E+n<T+H;){E+=n;let ee=(E-T)/H,te=Ht(F.x,N.x,ee),pe=Ht(F.y,N.y,ee);if(te>=0&&te<y&&pe>=0&&pe<y&&E-w>=0&&E+w<=M){let he=new Zl(te,pe,0,J,R);s&&!qM(i,he,m,s,h)||P.push(he)}}T+=H}return b||P.length||p||(P=XM(i,T/2,n,s,h,m,p,!0,y)),P}function QM(i,e,n,s,h){let m=[];for(let p=0;p<i.length;p++){let b=i[p],y;for(let w=0;w<b.length-1;w++){let M=b[w],T=b[w+1];M.x<e&&T.x<e||(M.x<e?M=new wt(e,M.y+(e-M.x)/(T.x-M.x)*(T.y-M.y))._round():T.x<e&&(T=new wt(e,M.y+(e-M.x)/(T.x-M.x)*(T.y-M.y))._round()),M.y<n&&T.y<n||(M.y<n?M=new wt(M.x+(n-M.y)/(T.y-M.y)*(T.x-M.x),n)._round():T.y<n&&(T=new wt(M.x+(n-M.y)/(T.y-M.y)*(T.x-M.x),n)._round()),M.x>=s&&T.x>=s||(M.x>=s?M=new wt(s,M.y+(s-M.x)/(T.x-M.x)*(T.y-M.y))._round():T.x>=s&&(T=new wt(s,M.y+(s-M.x)/(T.x-M.x)*(T.y-M.y))._round()),M.y>=h&&T.y>=h||(M.y>=h?M=new wt(M.x+(h-M.y)/(T.y-M.y)*(T.x-M.x),h)._round():T.y>=h&&(T=new wt(M.x+(h-M.y)/(T.y-M.y)*(T.x-M.x),h)._round()),y&&M.equals(y[y.length-1])||(y=[M],m.push(y)),y.push(T)))))}}return m}function KM(i){let e=0,n=0;for(let p of i)e+=p.w*p.h,n=Math.max(n,p.w);i.sort((p,b)=>b.h-p.h);let s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],h=0,m=0;for(let p of i)for(let b=s.length-1;b>=0;b--){let y=s[b];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,m=Math.max(m,p.y+p.h),h=Math.max(h,p.x+p.w),p.w===y.w&&p.h===y.h){let w=s.pop();b<s.length&&(s[b]=w)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(s.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:h,h:m,fill:e/(h*m)||0}}ne(Zl,"Anchor");let Ko=1;class b1{constructor(e,{pixelRatio:n,version:s,stretchX:h,stretchY:m,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=h,this.stretchY=m,this.content=p,this.version=s}get tl(){return[this.paddedRect.x+Ko,this.paddedRect.y+Ko]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ko,this.paddedRect.y+this.paddedRect.h-Ko]}get displaySize(){return[(this.paddedRect.w-2*Ko)/this.pixelRatio,(this.paddedRect.h-2*Ko)/this.pixelRatio]}}class JM{constructor(e,n,s){let h={},m={};this.haveRenderCallbacks=[];let p=[];this.addImages(e,h,p),this.addImages(n,m,p);let{w:b,h:y}=KM(p),w=new ka({width:b||1,height:y||1});for(let M in e){let T=e[M],E=h[M].paddedRect;ka.copy(T.data,w,{x:0,y:0},{x:E.x+Ko,y:E.y+Ko},T.data,s,T.sdf)}for(let M in n){let T=n[M],E=m[M].paddedRect,P=E.x+Ko,R=E.y+Ko,F=T.data.width,N=T.data.height;ka.copy(T.data,w,{x:0,y:0},{x:P,y:R},T.data,s),ka.copy(T.data,w,{x:0,y:N-1},{x:P,y:R-1},{width:F,height:1},s),ka.copy(T.data,w,{x:0,y:0},{x:P,y:R+N},{width:F,height:1},s),ka.copy(T.data,w,{x:F-1,y:0},{x:P-1,y:R},{width:1,height:N},s),ka.copy(T.data,w,{x:0,y:0},{x:P+F,y:R},{width:1,height:N},s)}this.image=w,this.iconPositions=h,this.patternPositions=m}addImages(e,n,s){for(let h in e){let m=e[h],p={x:0,y:0,w:m.data.width+2*Ko,h:m.data.height+2*Ko};s.push(p),n[h]=new b1(p,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,n,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>e.hasImage(h,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(let h in e.getUpdatedImages(s))this.patchUpdatedImage(this.iconPositions[h],e.getImage(h,s),n),this.patchUpdatedImage(this.patternPositions[h],e.getImage(h,s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;let[h,m]=e.tl,p=!!Object.keys(this.patternPositions).length;s.update(n.data,{useMipmap:p},{x:h,y:m})}}ne(b1,"ImagePosition"),ne(JM,"ImageAtlas");let lg=1e20;function ek(i,e,n,s,h,m,p,b,y){for(let w=e;w<e+s;w++)tk(i,n*m+w,m,h,p,b,y);for(let w=n;w<n+h;w++)tk(i,w*m+e,1,s,p,b,y)}function tk(i,e,n,s,h,m,p){m[0]=0,p[0]=-lg,p[1]=lg,h[0]=i[e];for(let b=1,y=0,w=0;b<s;b++){h[b]=i[e+b*n];let M=b*b;do{let T=m[y];w=(h[b]-h[T]+M-T*T)/(b-T)/2}while(w<=p[y]&&--y>-1);y++,m[y]=b,p[y]=w,p[y+1]=lg}for(let b=0,y=0;b<s;b++){for(;p[y+1]<b;)y++;let w=m[y],M=b-w;i[e+b*n]=h[w]+M*M}}let vs=2,y1={none:0,ideographs:1,all:2};class Tm{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,s){let h=[],m=this.urls[n]||I.GLYPHS_URL;for(let p in e)for(let b of e[p])h.push({stack:p,id:b});Pc(h,({stack:p,id:b},y)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=w.glyphs[b];if(M!==void 0)return void y(null,{stack:p,id:b,glyph:M});if(M=this._tinySDF(w,p,b),M)return w.glyphs[b]=M,void y(null,{stack:p,id:b,glyph:M});let T=Math.floor(b/256);if(256*T>65535)return void y(new Error("glyphs > 65535 not supported"));if(w.ranges[T])return void y(null,{stack:p,id:b,glyph:M});let E=w.requests[T];E||(E=w.requests[T]=[],Tm.loadGlyphRange(p,T,m,this.requestManager,(P,R)=>{if(R){w.ascender=R.ascender,w.descender=R.descender;for(let F in R.glyphs)this._doesCharSupportLocalGlyph(+F)||(w.glyphs[+F]=R.glyphs[+F]);w.ranges[T]=!0}for(let F of E)F(P,R);delete w.requests[T]})),E.push((P,R)=>{P?y(P):R&&y(null,{stack:p,id:b,glyph:R.glyphs[b]||null})})},(p,b)=>{if(p)s(p);else if(b){let y={};for(let{stack:w,id:M,glyph:T}of b)y[w]===void 0&&(y[w]={}),y[w].glyphs===void 0&&(y[w].glyphs={}),y[w].glyphs[M]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},y[w].ascender=this.entries[w].ascender,y[w].descender=this.entries[w].descender;s(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==y1.none&&(this.localGlyphMode===y1.all?!!this.localFontFamily:!!this.localFontFamily&&(me["CJK Unified Ideographs"](e)||me["Hangul Syllables"](e)||me.Hiragana(e)||me.Katakana(e)||me["CJK Symbols and Punctuation"](e)||me["CJK Unified Ideographs Extension A"](e)||me["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,s){let h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(s))return;let m=e.tinySDF;if(!m){let F="400";/bold/i.test(n)?F="900":/medium/i.test(n)?F="500":/light/i.test(n)&&(F="200"),m=e.tinySDF=new Tm.TinySDF({fontFamily:h,fontWeight:F,fontSize:24*vs,buffer:3*vs,radius:8*vs}),m.fontWeight=F}if(this.localGlyphs[m.fontWeight][s])return this.localGlyphs[m.fontWeight][s];let p=String.fromCodePoint(s),{data:b,width:y,height:w,glyphWidth:M,glyphHeight:T,glyphLeft:E,glyphTop:P,glyphAdvance:R}=m.draw(p);return this.localGlyphs[m.fontWeight][s]={id:s,bitmap:new hd({width:y,height:w},b),metrics:{width:M/vs,height:T/vs,left:E/vs,top:P/vs-27,advance:R/vs,localGlyph:!0}}}}Tm.loadGlyphRange=function(i,e,n,s,h){let m=256*e,p=m+255,b=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",i).replace("{range}",`${m}-${p}`),Vu.Glyphs);El(b,(y,w)=>{if(y)h(y);else if(w){let M={},T=function(E){return new Mm(E).readFields(U3,{})}(w);for(let E of T.glyphs)M[E.id]=E;h(null,{glyphs:M,ascender:T.ascender,descender:T.descender})}})},Tm.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=n;let b=this.size=i+4*e,y=this._createCanvas(b),w=this.ctx=y.getContext("2d",{willReadFrequently:!0});w.font=`${p} ${m} ${i}px ${h}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(i){let e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(i),p=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),y=Math.min(this.size-this.buffer,p+Math.ceil(s)),w=b+2*this.buffer,M=y+2*this.buffer,T=Math.max(w*M,0),E=new Uint8ClampedArray(T),P={data:E,width:w,height:M,glyphWidth:b,glyphHeight:y,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(b===0||y===0)return P;let{ctx:R,buffer:F,gridInner:N,gridOuter:H}=this;R.clearRect(F,F,b,y),R.fillText(i,F,F+p);let J=R.getImageData(F,F,b,y);H.fill(lg,0,T),N.fill(0,0,T);for(let ee=0;ee<y;ee++)for(let te=0;te<b;te++){let pe=J.data[4*(ee*b+te)+3]/255;if(pe===0)continue;let he=(ee+F)*w+te+F;if(pe===1)H[he]=0,N[he]=lg;else{let ve=.5-pe;H[he]=ve>0?ve*ve:0,N[he]=ve<0?ve*ve:0}}ek(H,0,0,w,M,w,this.f,this.v,this.z),ek(N,F,F,b,y,w,this.f,this.v,this.z);for(let ee=0;ee<T;ee++){let te=Math.sqrt(H[ee])-Math.sqrt(N[ee]);E[ee]=Math.round(255-255*(te/this.radius+this.cutoff))}return P}};let pd=Ko;function ik(i,e,n,s){let h=[],m=i.imagePrimary,p=m.pixelRatio,b=m.paddedRect.w-2*pd,y=m.paddedRect.h-2*pd,w=i.right-i.left,M=i.bottom-i.top,T=m.stretchX||[[0,b]],E=m.stretchY||[[0,y]],P=(ze,Ye)=>ze+Ye[1]-Ye[0],R=T.reduce(P,0),F=E.reduce(P,0),N=b-R,H=y-F,J=0,ee=R,te=0,pe=F,he=0,ve=N,Ce=0,Ae=H;if(m.content&&s){let ze=m.content;J=Y0(T,0,ze[0]),te=Y0(E,0,ze[1]),ee=Y0(T,ze[0],ze[2]),pe=Y0(E,ze[1],ze[3]),he=ze[0]-J,Ce=ze[1]-te,ve=ze[2]-ze[0]-ee,Ae=ze[3]-ze[1]-pe}let Ue=(ze,Ye,rt,qe)=>{let et=Z0(ze.stretch-J,ee,w,i.left),We=X0(ze.fixed-he,ve,ze.stretch,R),tt=Z0(Ye.stretch-te,pe,M,i.top),ct=X0(Ye.fixed-Ce,Ae,Ye.stretch,F),nt=Z0(rt.stretch-J,ee,w,i.left),kt=X0(rt.fixed-he,ve,rt.stretch,R),ot=Z0(qe.stretch-te,pe,M,i.top),ut=X0(qe.fixed-Ce,Ae,qe.stretch,F),Vt=new wt(et,tt),Lt=new wt(nt,tt),Ot=new wt(nt,ot),dt=new wt(et,ot),jt=new wt(We/p,ct/p),li=new wt(kt/p,ut/p),Zt=e*Math.PI/180;if(Zt){let an=Math.sin(Zt),Ui=Math.cos(Zt),Oi=[Ui,-an,an,Ui];Vt._matMult(Oi),Lt._matMult(Oi),dt._matMult(Oi),Ot._matMult(Oi)}let ui=ze.stretch+ze.fixed,ci=rt.stretch+rt.fixed,wi=Ye.stretch+Ye.fixed,qt=qe.stretch+qe.fixed,sn=i.imageSecondary;return{tl:Vt,tr:Lt,bl:dt,br:Ot,texPrimary:{x:m.paddedRect.x+pd+ui,y:m.paddedRect.y+pd+wi,w:ci-ui,h:qt-wi},texSecondary:sn?{x:sn.paddedRect.x+pd+ui,y:sn.paddedRect.y+pd+wi,w:ci-ui,h:qt-wi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:jt,pixelOffsetBR:li,minFontScaleX:ve/p/w,minFontScaleY:Ae/p/M,isSDF:n}};if(s&&(m.stretchX||m.stretchY)){let ze=nk(T,N,R),Ye=nk(E,H,F);for(let rt=0;rt<ze.length-1;rt++){let qe=ze[rt],et=ze[rt+1];for(let We=0;We<Ye.length-1;We++)h.push(Ue(qe,Ye[We],et,Ye[We+1]))}}else h.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:y+1}));return h}function Y0(i,e,n){let s=0;for(let h of i)s+=Math.max(e,Math.min(n,h[1]))-Math.max(e,Math.min(n,h[0]));return s}function nk(i,e,n){let s=[{fixed:-pd,stretch:0}];for(let[h,m]of i){let p=s[s.length-1];s.push({fixed:h-p.stretch,stretch:p.stretch}),s.push({fixed:h-p.stretch,stretch:p.stretch+(m-h)})}return s.push({fixed:e+pd,stretch:n}),s}function Z0(i,e,n,s){return i/e*n+s}function X0(i,e,n,s){return i-e*n/s}function X3(i,e,n,s){let h=e+i.positionedLines[s].lineOffset;return s===0?n+h/2:n+(h+(e+i.positionedLines[s-1].lineOffset))/2}function Q3(i,e=1,n=!1){let s=1/0,h=1/0,m=-1/0,p=-1/0,b=i[0];for(let P=0;P<b.length;P++){let R=b[P];(!P||R.x<s)&&(s=R.x),(!P||R.y<h)&&(h=R.y),(!P||R.x>m)&&(m=R.x),(!P||R.y>p)&&(p=R.y)}let y=Math.min(m-s,p-h),w=y/2,M=new xf([],K3);if(y===0)return new wt(s,h);for(let P=s;P<m;P+=y)for(let R=h;R<p;R+=y)M.push(new Em(P+w,R+w,w,i));let T=function(P){let R=0,F=0,N=0,H=P[0];for(let J=0,ee=H.length,te=ee-1;J<ee;te=J++){let pe=H[J],he=H[te],ve=pe.x*he.y-he.x*pe.y;F+=(pe.x+he.x)*ve,N+=(pe.y+he.y)*ve,R+=3*ve}return new Em(F/R,N/R,0,P)}(i),E=M.length;for(;M.length;){let P=M.pop();(P.d>T.d||!T.d)&&(T=P,n&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,E)),P.max-T.d<=e||(w=P.h/2,M.push(new Em(P.p.x-w,P.p.y-w,w,i)),M.push(new Em(P.p.x+w,P.p.y-w,w,i)),M.push(new Em(P.p.x-w,P.p.y+w,w,i)),M.push(new Em(P.p.x+w,P.p.y+w,w,i)),E+=4)}return n&&(console.log(`num probes: ${E}`),console.log(`best distance: ${T.d}`)),T.p}function K3(i,e){return e.max-i.max}class Em{constructor(e,n,s,h){this.p=new wt(e,n),this.h=s,this.d=function(m,p){let b=!1,y=1/0;for(let w=0;w<p.length;w++){let M=p[w];for(let T=0,E=M.length,P=E-1;T<E;P=T++){let R=M[T],F=M[P];R.y>m.y!=F.y>m.y&&m.x<(F.x-R.x)*(m.y-R.y)/(F.y-R.y)+R.x&&(b=!b),y=Math.min(y,dS(m,R,F))}}return(b?1:-1)*Math.sqrt(y)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}let v1=Number.POSITIVE_INFINITY,J3=Math.sqrt(2);function rk(i,[e,n]){let s=0,h=0;if(n===v1){e<0&&(e=0);let m=e/J3;switch(i){case"top-right":case"top-left":h=m-7;break;case"bottom-right":case"bottom-left":h=7-m;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(i){case"top-right":case"bottom-right":s=-m;break;case"top-left":case"bottom-left":s=m;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),i){case"top-right":case"top-left":case"top":h=n-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-n}switch(i){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,h]}function x1(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function eL(i,e,n,s,h,m,p,b,y,w,M,T,E,P,R){let F=m.textMaxSize.evaluate(e,{},T);F===void 0&&(F=p);let N=i.layers[0].layout,H=N.get("icon-offset").evaluate(e,{},T),J=ak(n.horizontal)||n.vertical,ee=E.name==="globe",te=to,pe=p/te,he=i.tilePixelRatio*F/te,ve=(et=i.overscaling,i.zoom>18&&et>2&&(et>>=1),Math.max(pt/(512*et),1)*N.get("symbol-spacing")),Ce=N.get("text-padding")*i.tilePixelRatio,Ae=N.get("icon-padding")*i.tilePixelRatio,Ue=Ai(N.get("text-max-angle")),ze=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Ye=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",rt=N.get("symbol-placement"),qe=ve/2;var et;let We=N.get("icon-text-fit").evaluate(e,{},T),tt=N.get("icon-text-fit-padding").evaluate(e,{},T),ct=We!=="none",nt;i.hasAnyIconTextFit===!1&&ct&&(i.hasAnyIconTextFit=!0),s&&ct&&(i.allowVerticalPlacement&&n.vertical&&(nt=GM(s,n.vertical,We,tt,H,pe)),J&&(s=GM(s,J,We,tt,H,pe)));let kt=(ot,ut,Vt)=>{if(ut.x<0||ut.x>=pt||ut.y<0||ut.y>=pt)return;let Lt=null;if(ee){let{x:Ot,y:dt,z:jt}=E.projectTilePoint(ut.x,ut.y,Vt);Lt={anchor:new Zl(Ot,dt,jt,0,void 0),up:E.upVector(Vt,ut.x,ut.y)}}(function(Ot,dt,jt,li,Zt,ui,ci,wi,qt,sn,an,Ui,Oi,Wi,xn,fn,Gn,Vn,lo,er,Rn,vr,qr,$r,_n,Eo,Xl){let Xa=Ot.addToLineVertexArray(dt,li),ks,xd,wd,Qh,sI,lI,cI,dI=0,hI=0,uI=0,mI=0,X1=-1,Q1=-1,sl={},pI=Vc(""),Kh=jt?jt.anchor:dt,K1=qt.layout.get("icon-text-fit").evaluate(Rn,{},_n)!=="none",J1=0,ew=0;if(qt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[J1,ew]=qt.layout.get("text-offset").evaluate(Rn,{},_n).map(ea=>ea*to):(J1=qt.layout.get("text-radial-offset").evaluate(Rn,{},_n)*to,ew=v1),Ot.allowVerticalPlacement&&Zt.vertical){let ea=Zt.vertical;if(xn)lI=w1(ea),wi&&(cI=w1(wi));else{let ta=qt.layout.get("text-rotate").evaluate(Rn,{},_n)+90;wd=Q0(sn,Kh,dt,an,Ui,Oi,ea,Wi,ta,fn),wi&&(Qh=Q0(sn,Kh,dt,an,Ui,Oi,wi,Vn,ta))}}if(ui){let ea=qt.layout.get("icon-rotate").evaluate(Rn,{},_n),ta=ik(ui,ea,qr,K1),Bm=wi?ik(wi,ea,qr,K1):void 0;xd=Q0(sn,Kh,dt,an,Ui,Oi,ui,Vn,ea),dI=4*ta.length;let fI=Ot.iconSizeData,Jh=null;fI.kind==="source"?(Jh=[ys*qt.layout.get("icon-size").evaluate(Rn,{},_n)],Jh[0]>fd&&sr(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${cg}. Reduce your "icon-size".`)):fI.kind==="composite"&&(Jh=[ys*vr.compositeIconSizes[0].evaluate(Rn,{},_n),ys*vr.compositeIconSizes[1].evaluate(Rn,{},_n)],(Jh[0]>fd||Jh[1]>fd)&&sr(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${cg}. Reduce your "icon-size".`)),Ot.addSymbols(Ot.icon,ta,Jh,er,lo,Rn,!1,jt,dt,Xa.lineStartIndex,Xa.lineLength,-1,$r,_n,Eo,Xl),X1=Ot.icon.placedSymbolArray.length-1,Bm&&(hI=4*Bm.length,Ot.addSymbols(Ot.icon,Bm,Jh,er,lo,Rn,Ia.vertical,jt,dt,Xa.lineStartIndex,Xa.lineLength,-1,$r,_n,Eo,Xl),Q1=Ot.icon.placedSymbolArray.length-1)}for(let ea in Zt.horizontal){let ta=Zt.horizontal[ea];ks||(pI=Vc(ta.text),xn?sI=w1(ta):ks=Q0(sn,Kh,dt,an,Ui,Oi,ta,Wi,qt.layout.get("text-rotate").evaluate(Rn,{},_n),fn));let Bm=ta.positionedLines.length===1;if(uI+=ok(Ot,jt,dt,ta,ci,qt,xn,Rn,fn,Xa,Zt.vertical?Ia.horizontal:Ia.horizontalOnly,Bm?Object.keys(Zt.horizontal):[ea],sl,X1,vr,$r,_n,Eo),Bm)break}Zt.vertical&&(mI+=ok(Ot,jt,dt,Zt.vertical,ci,qt,xn,Rn,fn,Xa,Ia.vertical,["vertical"],sl,Q1,vr,$r,_n,Eo));let Cd=-1,tw=(ea,ta)=>ea?Math.max(ea,ta):ta;Cd=tw(sI,Cd),Cd=tw(lI,Cd),Cd=tw(cI,Cd);let yF=Cd>-1?1:0;Ot.glyphOffsetArray.length>=65535&&sr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Rn.sortKey!==void 0&&Ot.addToSortKeyRanges(Ot.symbolInstances.length,Rn.sortKey),Ot.symbolInstances.emplaceBack(dt.x,dt.y,Kh.x,Kh.y,Kh.z,sl.right>=0?sl.right:-1,sl.center>=0?sl.center:-1,sl.left>=0?sl.left:-1,sl.vertical>=0?sl.vertical:-1,X1,Q1,pI,ks!==void 0?ks:Ot.collisionBoxArray.length,ks!==void 0?ks+1:Ot.collisionBoxArray.length,wd!==void 0?wd:Ot.collisionBoxArray.length,wd!==void 0?wd+1:Ot.collisionBoxArray.length,xd!==void 0?xd:Ot.collisionBoxArray.length,xd!==void 0?xd+1:Ot.collisionBoxArray.length,Qh||Ot.collisionBoxArray.length,Qh?Qh+1:Ot.collisionBoxArray.length,an,uI,mI,dI,hI,yF,0,J1,ew,Cd,0,1,1,K1?1:0)})(i,ut,Lt,ot,n,s,h,nt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Ce,ze,y,0,Ae,Ye,H,e,m,w,M,T,P,R)};if(rt==="line")for(let ot of QM(e.geometry,0,0,pt,pt)){let ut=Z3(ot,ve,Ue,n.vertical||J,s,te,he,i.overscaling,pt);for(let Vt of ut)J&&tL(i,J.text,qe,Vt)||kt(ot,Vt,T)}else if(rt==="line-center"){for(let ot of e.geometry)if(ot.length>1){let ut=Y3(ot,Ue,n.vertical||J,s,te,he);ut&&kt(ot,ut,T)}}else if(e.type==="Polygon")for(let ot of O0(e.geometry,0)){let ut=Q3(ot,16);kt(ot[0],new Zl(ut.x,ut.y,0,0,void 0),T)}else if(e.type==="LineString")for(let ot of e.geometry)kt(ot,new Zl(ot[0].x,ot[0].y,0,0,void 0),T);else if(e.type==="Point")for(let ot of e.geometry)for(let ut of ot)kt([ut],new Zl(ut.x,ut.y,0,0,void 0),T)}let cg=255,fd=cg*ys;function ok(i,e,n,s,h,m,p,b,y,w,M,T,E,P,R,F,N,H){let J=function(pe,he,ve,Ce,Ae,Ue,ze,Ye){let rt=[];if(he.positionedLines.length===0)return rt;let qe=Ce.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,et=function(kt){let ot=kt[0],ut=kt[1],Vt=ot*ut;return Vt>0?[ot,-ut]:Vt<0?[-ot,ut]:ot===0?[ut,ot]:[ut,-ot]}(ve),We=Math.abs(he.top-he.bottom);for(let kt of he.positionedLines)We-=kt.lineOffset;let tt=he.positionedLines.length,ct=We/tt,nt=he.top-ve[1];for(let kt=0;kt<tt;++kt){let ot=he.positionedLines[kt];nt=X3(he,ct,nt,kt);for(let ut of ot.positionedGlyphs){if(!ut.rect)continue;let Vt=ut.rect||{},Lt=NM+1,Ot=!0,dt=1,jt=0;if(ut.imageName){let er=ze[ut.imageName];if(!er)continue;if(er.sdf){sr("SDF images are not supported in formatted text and will be ignored.");continue}Ot=!1,dt=er.pixelRatio,Lt=Ko/dt}let li=(Ae||Ye)&&ut.vertical,Zt=ut.metrics.advance*ut.scale/2,ui=ut.metrics,ci=ut.rect;if(ci===null)continue;Ye&&he.verticalizable&&(jt=ut.imageName?Zt-ut.metrics.width*ut.scale/2:0);let wi=Ae?[ut.x+Zt,ut.y]:[0,0],qt=[0,0],sn=[0,0],an=!1;Ae||(li?(sn=[ut.x+Zt+et[0],ut.y+et[1]-jt],an=!0):qt=[ut.x+Zt+ve[0],ut.y+ve[1]-jt]);let Ui=ci.w*ut.scale/(dt*(ut.localGlyph?vs:1)),Oi=ci.h*ut.scale/(dt*(ut.localGlyph?vs:1)),Wi,xn,fn,Gn;if(li){let er=ut.y-nt,Rn=new wt(-Zt,Zt-er),vr=-Math.PI/2,qr=new wt(...sn);Wi=new wt(-Zt+qt[0],qt[1]),Wi._rotateAround(vr,Rn)._add(qr),Wi.x+=-er+Zt,Wi.y-=(ui.left-Lt)*ut.scale;let $r=ut.imageName?ui.advance*ut.scale:to*ut.scale,_n=String.fromCodePoint(ut.glyph);V3(_n)?Wi.x+=(1-Lt)*ut.scale:j3(_n)?Wi.x+=$r-ui.height*ut.scale+(-Lt-1)*ut.scale:Wi.x+=ut.imageName||ui.width+2*Lt===ci.w&&ui.height+2*Lt===ci.h?($r-Oi)/2:($r-(ui.height+2*Lt)*ut.scale)/2,xn=new wt(Wi.x,Wi.y-Ui),fn=new wt(Wi.x+Oi,Wi.y),Gn=new wt(Wi.x+Oi,Wi.y-Ui)}else{let er=(ui.left-Lt)*ut.scale-Zt+qt[0],Rn=(-ui.top-Lt)*ut.scale+qt[1],vr=er+Ui,qr=Rn+Oi;Wi=new wt(er,Rn),xn=new wt(vr,Rn),fn=new wt(er,qr),Gn=new wt(vr,qr)}if(qe){let er;er=Ae?new wt(0,0):an?new wt(et[0],et[1]):new wt(ve[0],ve[1]),Wi._rotateAround(qe,er),xn._rotateAround(qe,er),fn._rotateAround(qe,er),Gn._rotateAround(qe,er)}let Vn=new wt(0,0),lo=new wt(0,0);rt.push({tl:Wi,tr:xn,bl:fn,br:Gn,texPrimary:Vt,texSecondary:void 0,writingMode:he.writingMode,glyphOffset:wi,sectionIndex:ut.sectionIndex,isSDF:Ot,pixelOffsetTL:Vn,pixelOffsetBR:lo,minFontScaleX:0,minFontScaleY:0})}}return rt}(0,s,y,m,p,b,h,i.allowVerticalPlacement),ee=i.textSizeData,te=null;ee.kind==="source"?(te=[ys*m.layout.get("text-size").evaluate(b,{},N)],te[0]>fd&&sr(`${i.layerIds[0]}: Value for "text-size" is >= ${cg}. Reduce your "text-size".`)):ee.kind==="composite"&&(te=[ys*R.compositeTextSizes[0].evaluate(b,{},N),ys*R.compositeTextSizes[1].evaluate(b,{},N)],(te[0]>fd||te[1]>fd)&&sr(`${i.layerIds[0]}: Value for "text-size" is >= ${cg}. Reduce your "text-size".`)),i.addSymbols(i.text,J,te,y,p,b,M,e,n,w.lineStartIndex,w.lineLength,P,F,N,H,!1);for(let pe of T)E[pe]=i.text.placedSymbolArray.length-1;return 4*J.length}function ak(i){for(let e in i)return i[e];return null}function Q0(i,e,n,s,h,m,p,b,y,w){let M=p.top,T=p.bottom,E=p.left,P=p.right,R=p.collisionPadding;if(R&&(E-=R[0],M-=R[1],P+=R[2],T+=R[3]),y){let F=new wt(E,M),N=new wt(P,M),H=new wt(E,T),J=new wt(P,T),ee=Ai(y),te=new wt(0,0);w&&(te=new wt(w[0],w[1])),F._rotateAround(ee,te),N._rotateAround(ee,te),H._rotateAround(ee,te),J._rotateAround(ee,te),E=Math.min(F.x,N.x,H.x,J.x),P=Math.max(F.x,N.x,H.x,J.x),M=Math.min(F.y,N.y,H.y,J.y),T=Math.max(F.y,N.y,H.y,J.y)}return i.emplaceBack(e.x,e.y,e.z,n.x,n.y,E,M,P,T,b,s,h,m),i.length-1}function w1(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);let e=i.bottom-i.top;return e>0?Math.max(10,e):null}function tL(i,e,n,s){let h=i.compareText;if(e in h){let m=h[e];for(let p=m.length-1;p>=0;p--)if(s.dist(m[p])<n)return!0}else h[e]=[];return h[e].push(s),!1}function sk(i,e){let n=i.fovAboveCenter,s=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,h=(i._camera.position[2]*i.worldSize-s)/Math.cos(i._pitch),m=Math.sin(n)*h/Math.sin(Math.max(Math.PI/2-i._pitch-n,.01)),p=Math.sin(i._pitch)*m+h;return Math.min(1.01*p,h*(1/i._horizonShift))}function qh(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};let n=Math.pow(2,-i.z),s=i.x*n,h=(i.x+1)*n,m=i.y*n,p=(i.y+1)*n,b=Wo(s),y=Wo(h),w=Gr(m),M=Gr(p),T=e.project(b,w),E=e.project(y,w),P=e.project(y,M),R=e.project(b,M),F=Math.min(T.x,E.x,P.x,R.x),N=Math.min(T.y,E.y,P.y,R.y),H=Math.max(T.x,E.x,P.x,R.x),J=Math.max(T.y,E.y,P.y,R.y),ee=n/16;function te(he,ve,Ce,Ae,Ue,ze){let Ye=(Ce+Ue)/2,rt=(Ae+ze)/2,qe=e.project(Wo(Ye),Gr(rt)),et=Math.max(0,F-qe.x,N-qe.y,qe.x-H,qe.y-J);F=Math.min(F,qe.x),H=Math.max(H,qe.x),N=Math.min(N,qe.y),J=Math.max(J,qe.y),et>ee&&(te(he,qe,Ce,Ae,Ye,rt),te(qe,ve,Ye,rt,Ue,ze))}te(T,E,s,m,h,m),te(E,P,h,m,h,p),te(P,R,h,p,s,p),te(R,T,s,p,s,m),F-=ee,N-=ee,H+=ee,J+=ee;let pe=1/Math.max(H-F,J-N);return{scale:pe,x:F*pe,y:N*pe,x2:H*pe,y2:J*pe,projection:e}}function lk(i,{x:e,y:n},s=0){return new wt(((e-s)*i.scale-i.x)*pt,(n*i.scale-i.y)*pt)}let iL=t.ad.identity(new Float32Array(16));class gd{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new zi(0,0)}projectTilePoint(e,n,s){return{x:e,y:n,z:0}}locationPoint(e,n,s=!0){return e._coordinatePoint(e.locationCoordinate(n),s)}pixelsPerMeter(e,n){return To(1,e)*n}pixelSpaceConversion(e,n,s){return 1}farthestPixelDistance(e){return sk(e,e.pixelsPerMeter)}pointCoordinate(e,n,s,h){let m=e.horizonLineFromTop(!1),p=new wt(n,Math.max(m,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,h))}pointCoordinate3D(e,n,s){let h=new wt(n,s);if(e.elevation)return e.elevation.pointCoordinate(h);{let m=this.pointCoordinate(e,h.x,h.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);let s=e.horizonLineFromTop();return n.y<s}createInversionMatrix(e,n){return iL}createTileMatrix(e,n,s){let h,m,p,b=s.canonical,y=t.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let w=qh(b,this);h=1,m=w.x+s.wrap*w.scale,p=w.y,t.ad.scale(y,y,[h/w.scale,h/w.scale,e.pixelsPerMeter/n])}else h=n/e.zoomScale(b.z),m=(b.x+Math.pow(2,b.z)*s.wrap)*h,p=b.y*h;return t.ad.translate(y,y,[m,p,0]),t.ad.scale(y,y,[h/pt,h/pt,1]),y}upVector(e,n,s){return[0,0,1]}upVectorScale(e,n,s){return{metersToTile:1}}}class nL extends gd{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,s]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(Ai(n));this.n=(h+Math.sin(Ai(s)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:s,c:h,r0:m}=this,p=Ai(e-this.center[0]),b=Ai(n),y=Math.sqrt(h-2*s*Math.sin(b))/s;return{x:y*Math.sin(p*s),y:y*Math.cos(p*s)-m,z:0}}unproject(e,n){let{n:s,c:h,r0:m}=this,p=m+n,b=Math.atan2(e,Math.abs(p))*Math.sign(p);p*s<0&&(b-=Math.PI*Math.sign(e)*Math.sign(p));let y=Ai(this.center[0])*s;b=kl(b,-Math.PI-y,Math.PI-y);let w=gi(Kr(b/s)+this.center[0],-180,180),M=Math.asin(gi((h-(e*e+p*p)*s*s)/(2*s),-1,1)),T=gi(Kr(M),-cr,cr);return new zi(w,T)}}let dg=1.340264,hg=-.081106,ug=893e-6,mg=.003796,K0=Math.sqrt(3)/2;class rL extends gd{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let s=Math.asin(K0*Math.sin(n)),h=s*s,m=h*h*h;return{x:.5*(e*Math.cos(s)/(K0*(dg+3*hg*h+m*(7*ug+9*mg*h)))/Math.PI+.5),y:1-.5*(s*(dg+hg*h+m*(ug+mg*h))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,h=s*s,m=h*h*h;for(let M,T,E,P=0;P<12&&(T=s*(dg+hg*h+m*(ug+mg*h))-n,E=dg+3*hg*h+m*(7*ug+9*mg*h),M=T/E,s=gi(s-M,-Math.PI/3,Math.PI/3),h=s*s,m=h*h*h,!(Math.abs(M)<1e-12));++P);let p=K0*e*(dg+3*hg*h+m*(7*ug+9*mg*h))/Math.cos(s),b=Math.asin(Math.sin(s)/K0),y=gi(180*p/Math.PI,-180,180),w=gi(180*b/Math.PI,-cr,cr);return new zi(y,w)}}class oL extends gd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let s=360*(e-.5),h=gi(360*(.5-n),-cr,cr);return new zi(s,h)}}let Dm=Math.PI/2;function J0(i){return Math.tan((Dm+i)/2)}class aL extends gd{constructor(e){super(e),this.center=e.center||[0,30];let[n,s]=this.parallels=e.parallels||[30,30],h=Ai(n),m=Ai(s);this.southernCenter=h+m<0,this.southernCenter&&(h=-h,m=-m);let p=Math.cos(h),b=J0(h);this.n=h===m?Math.sin(h):Math.log(p/Math.cos(m))/Math.log(J0(m)/b),this.f=p*Math.pow(J0(h),this.n)/this.n}project(e,n){n=Ai(n),this.southernCenter&&(n=-n),e=Ai(e-this.center[0]);let s=1e-6,{n:h,f:m}=this;m>0?n<-Dm+s&&(n=-Dm+s):n>Dm-s&&(n=Dm-s);let p=m/Math.pow(J0(n),h),b=p*Math.sin(h*e),y=m-p*Math.cos(h*e);return b=.5*(b/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:b,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:s,f:h}=this,m=h-n,p=Math.sign(m),b=Math.sign(s)*Math.sqrt(e*e+m*m),y=Math.atan2(e,Math.abs(m))*p;m*s<0&&(y-=Math.PI*Math.sign(e)*p);let w=gi(Kr(y/s)+this.center[0],-180,180),M=gi(Kr(2*Math.atan(Math.pow(h/b,1/s))-Dm),-cr,cr);return new zi(w,this.southernCenter?-M:M)}}class ck extends gd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:tl(e),y:il(n),z:0}}unproject(e,n){let s=Wo(e),h=Gr(n);return new zi(s,h)}}let dk=Ai(cr);class sL extends gd{project(e,n){let s=(n=Ai(n))*n,h=s*s;return{x:.5*((e=Ai(e))*(.8707-.131979*s+h*(h*(.003971*s-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+h*(.028874*s-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,h=25,m=0,p=s*s;do{p=s*s;let w=p*p;m=(s*(1.007226+p*(.015085+w*(.028874*p-.044475-.005916*w)))-n)/(1.007226+p*(.045255+w*(.259866*p-.311325-.005916*11*w))),s=gi(s-m,-dk,dk)}while(Math.abs(m)>1e-6&&--h>0);p=s*s;let b=gi(Kr(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),y=Kr(s);return new zi(b,y)}}let hk=Ai(cr);class lL extends gd{project(e,n){n=Ai(n),e=Ai(e);let s=Math.cos(n),h=2/Math.PI,m=Math.acos(s*Math.cos(e/2)),p=Math.sin(m)/m,b=.5*(e*h+2*s*Math.sin(e/2)/p)||0,y=.5*(n+Math.sin(n)/p)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let s=e=(2*e-.5)*Math.PI,h=n=(2*(1-n)-1)*Math.PI,m=25,p=1e-6,b=0,y=0;do{let w=Math.cos(h),M=Math.sin(h),T=2*M*w,E=M*M,P=w*w,R=Math.cos(s/2),F=Math.sin(s/2),N=2*R*F,H=F*F,J=1-P*R*R,ee=J?1/J:0,te=J?Math.acos(w*R)*Math.sqrt(1/J):0,pe=.5*(2*te*w*F+2*s/Math.PI)-e,he=.5*(te*M+h)-n,ve=.5*ee*(P*H+te*w*R*E)+1/Math.PI,Ce=ee*(N*T/4-te*M*F),Ae=.125*ee*(T*F-te*M*P*N),Ue=.5*ee*(E*R+te*H*w)+.5,ze=Ce*Ae-Ue*ve;b=(he*Ce-pe*Ue)/ze,y=(pe*Ae-he*ve)/ze,s=gi(s-b,-Math.PI,Math.PI),h=gi(h-y,-hk,hk)}while((Math.abs(b)>p||Math.abs(y)>p)&&--m>0);return new zi(Kr(s),Kr(h))}}class uk extends gd{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ai(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:s,cosPhi:h}=this;return{x:Ai(e)*h*s+.5,y:-Math.sin(Ai(n))/h*s+.5,z:0}}unproject(e,n){let{scale:s,cosPhi:h}=this,m=-(n-.5)/s,p=gi(Kr((e-.5)/s)/h,-180,180),b=Math.asin(gi(m*h,-1,1)),y=gi(Kr(b),-cr,cr);return new zi(p,y)}}class cL extends ck{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,s){let h=Xf(e,n,s),m=Qf(nl(s));return t._.transformMat4(h,h,m),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,n){let s=jh(n.lat,n.lng),h=t._.normalize([],s),m=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,p=To(1,0)*pt*m;t._.scaleAndAdd(s,s,h,p);let b=t.ad.identity(new Float64Array(16));return t.ad.multiply(b,e.pixelMatrix,e.globeMatrix),t._.transformMat4(s,s,b),new wt(s[0],s[1])}pixelsPerMeter(e,n){return To(1,0)*n}pixelSpaceConversion(e,n,s){let h=To(1,e)*n,m=Ht(To(1,45)*n,h,s);return this.pixelsPerMeter(e,n)/m}createTileMatrix(e,n,s){let h=Jx(nl(s.canonical));return t.ad.multiply(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,n){let{center:s}=e,h=Qf(nl(n));return t.ad.rotateY(h,h,Ai(s.lng)),t.ad.rotateX(h,h,Ai(s.lat)),t.ad.scale(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,n,s,h){return yS(e,n,s,!0)||new so(0,0)}pointCoordinate3D(e,n,s){let h=this.pointCoordinate(e,n,s,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,n){return!yS(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(h,m){let p=h.cameraToCenterDistance,b=h._centerAltitude*m,y=h._camera,w=h._camera.forward(),M=t._.add([],t._.scale([],w,-p),[0,0,b]),T=h.worldSize/(2*Math.PI),E=[0,0,-T],P=h.width/h.height,R=Math.tan(h.fovAboveCenter),F=t._.scale([],y.up(),R),N=t._.scale([],y.right(),R*P),H=t._.normalize([],t._.add([],t._.add([],w,F),N)),J=[],ee;if(new Yx(M,H).closestPointOnSphere(E,T,J)){let te=t._.add([],J,E),pe=t._.sub([],te,M);ee=Math.cos(h.fovAboveCenter)*t._.length(pe)}else{let te=t._.sub([],M,E),pe=t._.sub([],E,M);t._.normalize(pe,pe);let he=t._.length(te)-T;ee=Math.sqrt(he*(he+2*T));let ve=Math.acos(ee/(T+he))-Math.acos(t._.dot(w,pe));ee*=Math.cos(ve)}return 1.01*ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=$l(e.zoom);if(s>0){let h=sk(e,To(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ht(n,h+m*(1-Math.cos(p)),Math.pow(s,10))}return n}upVector(e,n,s){return Xf(n,s,e,1)}upVectorScale(e){return{metersToTile:I0(E0(nl(e)))}}}function mk(i){let e=i.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new ck(i);case"equirectangular":return new oL(i);case"naturalEarth":return new sL(i);case"equalEarth":return new rL(i);case"winkelTripel":return new lL(i);case"albers":return n?new uk(i):new nL(i);case"lambertConformalConic":return n?new uk(i):new aL(i);case"globe":return new cL(i)}throw new Error(`Invalid projection name: ${i.name}`)}let dL=(()=>{class i{constructor(n,s,h,m){this.id=i.uniqueIdxCounter,i.uniqueIdxCounter++,this.context=n;let p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||m||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=i.uniqueIdxCounter,i.uniqueIdxCounter++;let s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return i.uniqueIdxCounter=0,i})();class Am{constructor(e,n,s){this.func=e,this.mask=n,this.range=s}}Am.ReadOnly=!1,Am.ReadWrite=!0,Am.disabled=new Am(519,Am.ReadOnly,[0,1]);let C1=7680;class S1{constructor(e,n,s,h,m,p){this.test=e,this.ref=n,this.mask=s,this.fail=h,this.depthFail=m,this.pass=p}}S1.disabled=new S1({func:519,mask:0},0,0,C1,C1,C1);let pg=771;class Jo{constructor(e,n,s,h){this.blendFunction=e,this.blendColor=n,this.mask=s,this.blendEquation=h}}Jo.Replace=[1,0,1,0],Jo.disabled=new Jo(Jo.Replace,Ni.transparent,[!1,!1,!1,!1]),Jo.unblended=new Jo(Jo.Replace,Ni.transparent,[!0,!0,!0,!0]),Jo.alphaBlended=new Jo([1,pg,1,pg],Ni.transparent,[!0,!0,!0,!0]),Jo.alphaBlendedNonPremultiplied=new Jo([770,pg,770,pg],Ni.transparent,[!0,!0,!0,!0]),Jo.multiply=new Jo([774,0,774,0],Ni.transparent,[!0,!0,!0,!0]);let M1=1029,k1=2305;class xs{constructor(e,n,s){this.enable=e,this.mode=n,this.frontFace=s}}xs.disabled=new xs(!1,M1,k1),xs.backCCW=new xs(!0,M1,k1),xs.backCW=new xs(!0,M1,2304),xs.frontCW=new xs(!0,1028,2304),xs.frontCCW=new xs(!0,1028,k1);let hL=F0.types,uL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function eb(i,e,n,s,h,m,p,b,y,w,M,T,E){let P=b?Math.min(fd,Math.round(b[0])):0,R=b?Math.min(fd,Math.round(b[1])):0;i.emplaceBack(e,n,Math.round(32*s),Math.round(32*h),m,p,(P<<1)+(y?1:0),R,16*w,16*M,256*T,256*E)}function tb(i,e,n){i.emplaceBack(e,n)}function ib(i,e,n,s,h,m,p){i.emplaceBack(e,n,s,h,m,p)}function nb(i,e,n,s,h){i.emplaceBack(e,n,s,h),i.emplaceBack(e,n,s,h),i.emplaceBack(e,n,s,h),i.emplaceBack(e,n,s,h)}function mL(i){for(let e of i.sections)if(Ze(e.text))return!0;return!1}class I1{constructor(e){this.layoutVertexArray=new _x,this.indexArray=new Rr,this.programConfigurations=e,this.segments=new Bn,this.dynamicLayoutVertexArray=new nd,this.opacityVertexArray=new yx,this.occlusionQueryOpacityVertexArray=new Bh,this.placedSymbolArray=new W2,this.iconTransitioningVertexArray=new ad,this.globeExtVertexArray=new bx,this.zOffsetVertexArray=new Bh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,s,h,m){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,p3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,g3.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,uL,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,u1.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,_3.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,f3.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,xM.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ne(I1,"SymbolBuffers");class T1{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new Bn,this.collisionVertexArray=new wx,this.collisionVertexArrayExt=new nd}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,b3.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,y3.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ne(T1,"CollisionBuffers");class Pm{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=t.ad.identity([]),this.placementViewportMatrix=t.ad.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=p1(this.zoom,n["text-size"]),this.iconSizeData=p1(this.zoom,n["icon-size"]);let s=this.layers[0].layout,h=s.get("symbol-sort-key"),m=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(p=>Ia[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new I1(new ld(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new I1(new ld(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new q2,this.lineVertexArray=new $2,this.symbolInstances=new G2}calculateGlyphDependencies(e,n,s,h,m){for(let p=0;p<e.length;p++){let b=e.codePointAt(p);if(b===void 0)break;if(n[b]=!0,h&&m&&b<=65535){let y=ag[e.charAt(p)];y&&(n[y.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let s=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!d1(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}populate(e,n,s,h){let m=this.layers[0],p=m.layout,b=this.projection.name==="globe",y=p.get("text-font"),w=p.get("text-field"),M=p.get("icon-image"),T=(w.value.kind!=="constant"||w.value.value instanceof eo&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),E=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,P=p.get("symbol-sort-key");if(this.features=[],!T&&!E)return;let R=n.iconDependencies,F=n.glyphDependencies,N=n.availableImages,H=new Kt(this.zoom);for(let{feature:J,id:ee,index:te,sourceLayerIndex:pe}of e){let he=m._featureFilter.needGeometry,ve=Gl(J,he);if(!m._featureFilter.filter(H,ve,s))continue;if(he||(ve.geometry=bs(J,s,h)),b&&J.type!==1&&s.z<=5){let ze=ve.geometry,Ye=.98078528056,rt=(qe,et)=>{let We=Xf(qe.x,qe.y,s,1),tt=Xf(et.x,et.y,s,1);return t._.dot(We,tt)<Ye};for(let qe=0;qe<ze.length;qe++)ze[qe]=QO(ze[qe],rt)}let Ce,Ae;if(T){let ze=m.getValueAndResolveTokens("text-field",ve,s,N),Ye=eo.factory(ze);mL(Ye)&&(this.hasRTLText=!0),(!this.hasRTLText||xi()==="unavailable"||this.hasRTLText&&tn.isParsed())&&(Ce=N3(Ye,m,ve))}if(E){let ze=m.getValueAndResolveTokens("icon-image",ve,s,N);Ae=ze instanceof _o?ze:_o.fromString(ze)}if(!Ce&&!Ae)continue;let Ue=this.sortFeaturesByKey?P.evaluate(ve,{},s):void 0;if(this.features.push({id:ee,text:Ce,icon:Ae,index:te,sourceLayerIndex:pe,geometry:ve.geometry,properties:J.properties,type:hL[J.type],sortKey:Ue}),Ae&&(R[Ae.namePrimary]=!0,Ae.nameSecondary&&(R[Ae.nameSecondary]=!0)),Ce){let ze=y.evaluate(ve,{},s).join(","),Ye=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ia.vertical)>=0;for(let rt of Ce.sections)if(rt.image)R[rt.image.namePrimary]=!0;else{let qe=Le(Ce.toString()),et=rt.fontStack||ze,We=F[et]=F[et]||{};this.calculateGlyphDependencies(rt.text,We,Ye,this.allowVerticalPlacement,qe)}}}p.get("symbol-placement")==="line"&&(this.features=function(J){let ee={},te={},pe=[],he=0;function ve(ze){pe.push(J[ze]),he++}function Ce(ze,Ye,rt){let qe=te[ze];return delete te[ze],te[Ye]=qe,pe[qe].geometry[0].pop(),pe[qe].geometry[0]=pe[qe].geometry[0].concat(rt[0]),qe}function Ae(ze,Ye,rt){let qe=ee[Ye];return delete ee[Ye],ee[ze]=qe,pe[qe].geometry[0].shift(),pe[qe].geometry[0]=rt[0].concat(pe[qe].geometry[0]),qe}function Ue(ze,Ye,rt){let qe=rt?Ye[0][Ye[0].length-1]:Ye[0][0];return`${ze}:${qe.x}:${qe.y}`}for(let ze=0;ze<J.length;ze++){let Ye=J[ze],rt=Ye.geometry,qe=Ye.text?Ye.text.toString():null;if(!qe){ve(ze);continue}let et=Ue(qe,rt),We=Ue(qe,rt,!0);if(et in te&&We in ee&&te[et]!==ee[We]){let tt=Ae(et,We,rt),ct=Ce(et,We,pe[tt].geometry);delete ee[et],delete te[We],te[Ue(qe,pe[ct].geometry,!0)]=ct,pe[tt].geometry=null}else et in te?Ce(et,We,rt):We in ee?Ae(et,We,rt):(ve(ze),ee[et]=he-1,te[We]=he-1)}return pe.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ee)=>J.sortKey-ee.sortKey)}update(e,n,s,h,m){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let b=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,b,s,h,m),this.icon.programConfigurations.updatePaintArrays(e,n,b,s,h,m)}updateOcclusionOpacities(e,n,s){if(!n.useOcclusionQueries)return!1;let h=this;if(h.projection.name==="globe")return!1;let m=!1;h.hasTextData()&&(m=m||h.text.occlusionQueryOpacityVertexArray.length!==0),h.hasIconData()&&(m=m||h.icon.occlusionQueryOpacityVertexArray.length!==0);let p=h.layers[0].paint,b=p.get("icon-occlusion-opacity").constantOr(0),y=p.get("text-occlusion-opacity").constantOr(0);if(!h.layers[0].hasInitialOcclusionOpacityProperties||b===1&&y===1)return!1;let w=!m;for(let P=0;P<h.symbolInstances.length;P++){let R=h.symbolInstances.get(P),F=R.occlusionOpacity;R.occlusionOpacity+=(R.occlusionState>.5?1:-1)*n.fadeSpeed*s*.001,R.occlusionOpacity=gi(R.occlusionOpacity,0,1),w=w||R.occlusionOpacity!==F}if(!w)return!1;let M=0,T=0,E=(P,R,F,N)=>{let H=0,J=0;F?(H=T,T+=N,J=T):(H=M,M+=N,J=M),J>R.occlusionQueryOpacityVertexArray.length&&R.occlusionQueryOpacityVertexArray.resize(J);let ee=P.occlusionOpacity;for(let te=0;te<N;te++)R.occlusionQueryOpacityVertexArray.emplace(te+H,ee)};for(let P=0;P<h.symbolInstances.length;P++){let R=h.symbolInstances.get(P),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:N,numIconVertices:H}=R,J=H>0;if((F>0||N>0)&&(E(R,h.text,!1,F),E(R,h.text,!1,N)),J){let{placedIconSymbolIndex:ee,verticalPlacedIconSymbolIndex:te}=R;ee>=0&&E(R,h.icon,!0,H),te>=0&&E(R,h.icon,!0,R.numVerticalIconVertices)}}return h.hasTextData()&&h.text.occlusionQueryOpacityVertexBuffer&&(h.text.occlusionQueryOpacityVertexBuffer.length<h.text.occlusionQueryOpacityVertexArray.length?h.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(h.text.occlusionQueryOpacityVertexArray,u1.members,!0):h.text.occlusionQueryOpacityVertexBuffer.updateData(h.text.occlusionQueryOpacityVertexArray)),h.hasIconData()&&h.icon.occlusionQueryOpacityVertexBuffer&&(h.icon.occlusionQueryOpacityVertexBuffer.length<h.icon.occlusionQueryOpacityVertexArray.length?h.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(h.icon.occlusionQueryOpacityVertexArray,u1.members,!0):h.icon.occlusionQueryOpacityVertexBuffer.updateData(h.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(m,p,b)=>{s+=p,s>m.length&&m.resize(s);for(let y=-p;y<0;y++)m.emplace(y+s,b)},n=(m,p,b)=>{h+=p,h>m.length&&m.resize(h);for(let y=-p;y<0;y++)m.emplace(y+h,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,h=0;for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:y,numIconVertices:w}=p,M=p.zOffset,T=w>0;if((b>0||y>0)&&(e(this.text.zOffsetVertexArray,b,M),e(this.text.zOffsetVertexArray,y,M)),T){let{placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:P}=p;E>=0&&n(this.icon.zOffsetVertexArray,w,M),P>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=mk(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,n){let s=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:h,y:m}of n)this.lineVertexArray.emplaceBack(h,m);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,h,m,p,b,y,w,M,T,E,P,R,F,N){let H=e.indexArray,J=e.layoutVertexArray,ee=e.globeExtVertexArray,te=e.segments.prepareSegment(4*n.length,J,H,this.canOverlap?p.sortKey:void 0),pe=this.glyphOffsetArray.length,he=te.vertexLength,ve=this.allowVerticalPlacement&&b===Ia.vertical?Math.PI/2:0,Ce=p.text&&p.text.sections;for(let Ue=0;Ue<n.length;Ue++){let{tl:ze,tr:Ye,bl:rt,br:qe,texPrimary:et,texSecondary:We,pixelOffsetTL:tt,pixelOffsetBR:ct,minFontScaleX:nt,minFontScaleY:kt,glyphOffset:ot,isSDF:ut,sectionIndex:Vt}=n[Ue],Lt=te.vertexLength,Ot=ot[1];if(eb(J,w.x,w.y,ze.x,Ot+ze.y,et.x,et.y,s,ut,tt.x,tt.y,nt,kt),eb(J,w.x,w.y,Ye.x,Ot+Ye.y,et.x+et.w,et.y,s,ut,ct.x,tt.y,nt,kt),eb(J,w.x,w.y,rt.x,Ot+rt.y,et.x,et.y+et.h,s,ut,tt.x,ct.y,nt,kt),eb(J,w.x,w.y,qe.x,Ot+qe.y,et.x+et.w,et.y+et.h,s,ut,ct.x,ct.y,nt,kt),y){let{x:dt,y:jt,z:li}=y.anchor,[Zt,ui,ci]=y.up;ib(ee,dt,jt,li,Zt,ui,ci),ib(ee,dt,jt,li,Zt,ui,ci),ib(ee,dt,jt,li,Zt,ui,ci),ib(ee,dt,jt,li,Zt,ui,ci),nb(e.dynamicLayoutVertexArray,dt,jt,li,ve)}else nb(e.dynamicLayoutVertexArray,w.x,w.y,w.z,ve);if(N){let dt=We||et;tb(e.iconTransitioningVertexArray,dt.x,dt.y),tb(e.iconTransitioningVertexArray,dt.x+dt.w,dt.y),tb(e.iconTransitioningVertexArray,dt.x,dt.y+dt.h),tb(e.iconTransitioningVertexArray,dt.x+dt.w,dt.y+dt.h)}H.emplaceBack(Lt,Lt+1,Lt+2),H.emplaceBack(Lt+1,Lt+2,Lt+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ot[0]),Ue!==n.length-1&&Vt===n[Ue+1].sectionIndex||e.programConfigurations.populatePaintArrays(J.length,p,p.index,{},P,R,F,Ce&&Ce[Vt])}let Ae=y?y.anchor:w;e.placedSymbolArray.emplaceBack(Ae.x,Ae.y,Ae.z,w.x,w.y,pe,this.glyphOffsetArray.length-pe,he,M,T,w.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],b,0,!1,0,E,0)}_commitLayoutVertex(e,n,s,h,m,p,b){e.emplaceBack(n,s,h,m,p,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,n,s,h,m,p,b){let y=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=y.vertexLength,M=b.tileAnchorX,T=b.tileAnchorY;for(let P=0;P<4;P++)s.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,n,e.padding,b.zOffset),this._commitLayoutVertex(s.layoutVertexArray,h,m,p,M,T,new wt(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,m,p,M,T,new wt(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,m,p,M,T,new wt(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,h,m,p,M,T,new wt(e.x1,e.y2)),y.vertexLength+=4;let E=s.indexArray;E.emplaceBack(w,w+1),E.emplaceBack(w+1,w+2),E.emplaceBack(w+2,w+3),E.emplaceBack(w+3,w),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,h,m,p){for(let b=h;b<m;b++){let y=s.get(b),w=this.getSymbolInstanceTextSize(e,p,n,b);this._addCollisionDebugVertices(y,w,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,s,h,m,p){for(let b=h;b<m;b++){let y=s.get(b),w=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(y,w,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new T1(b0,wM.members,ad),this.iconCollisionBox=new T1(b0,wM.members,ad);let s=km(this.iconSizeData,e),h=km(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(h,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(h,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(s,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(s,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,s,h){let m=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:h),p=q0(this.textSizeData,e,m)/to;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,s){let h=this.icon.placedSymbolArray.get(s),m=q0(this.iconSizeData,e,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,n,s,h){e.emplaceBack(n,-s,-s,h),e.emplaceBack(n,s,-s,h),e.emplaceBack(n,s,s,h),e.emplaceBack(n,-s,s,h)}_updateTextDebugCollisionBoxes(e,n,s,h,m,p){for(let b=h;b<m;b++){let y=s.get(b),w=this.getSymbolInstanceTextSize(e,p,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,y.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,s,h,m,p){for(let b=h;b<m;b++){let y=s.get(b),w=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,y.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let s=km(this.iconSizeData,e),h=km(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(h,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(h,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(s,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(s,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,h,m,p,b,y,w){let M={};if(n<s){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:N,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:pe}=e.get(n);M.textBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:N,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.textFeatureIndex=pe}if(h<m){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:N,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:pe}=e.get(h);M.verticalTextBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:N,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.verticalTextFeatureIndex=pe}if(p<b){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:N,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:pe}=e.get(p);M.iconBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:N,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.iconFeatureIndex=pe}if(y<w){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:N,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:pe}=e.get(y);M.verticalIconBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:N,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.verticalIconFeatureIndex=pe}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let s=e.placedSymbolArray.get(n),h=s.vertexStartIndex+4*s.numGlyphs;for(let m=s.vertexStartIndex;m<h;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),s=Math.cos(e),h=[],m=[],p=[];for(let b=0;b<this.symbolInstances.length;++b){p.push(b);let y=this.symbolInstances.get(b);h.push(0|Math.round(n*y.tileAnchorX+s*y.tileAnchorY)),m.push(y.featureIndex)}return p.sort((b,y)=>h[b]-h[y]||m[y]-m[b]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);let{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:w}=s;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),p>=0&&p!==m&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ne(Pm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Pm.addDynamicAttributes=nb;class Ya{constructor(e,n,s,h){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,h)}update(e,n,s){let{width:h,height:m}=e,{context:p}=this,{gl:b}=p;if(b.bindTexture(b.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||n.premultiply!==!1)),s||this.size&&this.size[0]===h&&this.size[1]===m){let{x:y,y:w}=s||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)b.texSubImage2D(b.TEXTURE_2D,0,y,w,b.RGBA,b.UNSIGNED_BYTE,e);else{let M=this.format,T=b.UNSIGNED_BYTE;this.format===b.R32F&&(M=b.RED,T=b.FLOAT),b.texSubImage2D(b.TEXTURE_2D,0,y,w,h,m,M,T,e.data)}}else if(this.size=[h,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===b.R8&&(y=b.RED),b.texImage2D(b.TEXTURE_2D,0,this.format,y,b.UNSIGNED_BYTE,e)}else{let y=this.format,w=this.format,M=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(y=b.DEPTH_COMPONENT16,M=b.UNSIGNED_SHORT),this.format===b.R8&&(w=b.RED),this.format===b.R32F&&(M=b.FLOAT,w=b.RED),b.texImage2D(b.TEXTURE_2D,0,y,h,m,0,w,M,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,n,s=!1){let{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,n),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,s,h){let{context:m}=this,{gl:p}=m;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),this.wrapS=s),h!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class rb{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrapS=n)}}let Za=32,ol=33,_d=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,n=0,s=0,h=0,m=0,p=0,b=0;for(1&e?h=m=p=Za:n=s=b=Za;(e>>=1)>1;){let w=n+h>>1,M=s+m>>1;1&e?(h=n,m=s,n=p,s=b):(n=h,s=m,h=p,m=b),p=w,b=M}let y=4*i;_d[y+0]=n,_d[y+1]=s,_d[y+2]=h,_d[y+3]=m}let al=new Uint16Array(2178),bd=new Uint8Array(1089),ob=new Uint16Array(1089);function pk(i){return i===0?-.03125:i===32?.03125:0}var ab=Yi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),pL=Yi([{name:"a_index",type:"Int16",components:1}]);let fk={type:2,extent:pt,loadGeometry:()=>[[new wt(0,0),new wt(pt+1,0),new wt(pt+1,pt+1),new wt(0,pt+1),new wt(0,0)]]};class sb{constructor(e,n,s,h,m){this.tileID=e,this.uid=Eu(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,h&&h.style&&(this._lastUpdatedBrightness=h.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<Ur.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=qh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,m){let p={};if(!m)return p;for(let b of h){let y=b.layerIds.map(w=>m.getLayer(w)).filter(Boolean);if(y.length!==0){b.layers=y,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(w=>y.filter(M=>M.id===w)[0]));for(let w of y)p[w.fqid]=b}}return p}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let h in this.buckets){let m=this.buckets[h];if(m instanceof Pm){if(this.hasSymbolBuckets=!0,!s)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let h in this.buckets){let m=this.buckets[h];if(m instanceof Pm&&m.hasRTLText){this.hasRTLText=!0,tn.isLoading()||tn.isLoaded()||xi()!=="deferred"||Pi();break}}this.queryPadding=0;for(let h in this.buckets){let m=this.buckets[h],p=n.style.getOwnLayer(h);if(!p)continue;let b=p.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,b)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Dx}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let h in this.buckets){let m=this.buckets[h];m.uploadPending()&&m.upload(e)}let n=e.gl,s=this.imageAtlas;if(s&&!s.uploaded){let h=!!Object.keys(s.patternPositions).length;this.imageAtlasTexture=new Ya(e,s.image,n.RGBA,{useMipmap:h}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ya(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ya(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,s){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,s),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let h=n.style.getBrightness();(this._lastUpdatedBrightness||h)&&(this._lastUpdatedBrightness&&h&&Math.abs(this._lastUpdatedBrightness-h)<.001||(this._lastUpdatedBrightness=h,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,s,h,m,p,b,y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:b,transform:p,params:m,tileTransform:this.tileTransform},e,n,s):{}}querySourceFeatures(e,n){let s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;let h=s.loadVTLayers(),m=n?n.sourceLayer:"",p=h._geojsonTileLayer||h[m];if(!p)return;let b=Dr(n&&n.filter),{z:y,x:w,y:M}=this.tileID.canonical,T={z:y,x:w,y:M};for(let E=0;E<p.length;E++){let P=p.feature(E);if(b.needGeometry){let N=Gl(P,!0);if(!b.filter(new Kt(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!b.filter(new Kt(this.tileID.overscaledZ),P))continue;let R=s.getId(P,m),F=new FM(P,y,w,M,R);F.tile=T,e.push(F)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let s=Yp(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let s=Date.now(),h=!1;if(this.expirationTime>s)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{let m=this.expirationTime-n;m?this.expirationTime=s+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let s=this.latestFeatureIndex.loadVTLayers(),h=n.style.listImages(),m=n.style.getBrightness();for(let p in this.buckets){if(!n.style.hasLayer(p))continue;let b=this.buckets[p],y=b.layers[0].sourceLayer||"_geojsonTileLayer",w=s[y],M={};if(e&&(M=e[y],!w||!M||Object.keys(M).length===0))continue;if(b.update(M,w,h,this.imageAtlas&&this.imageAtlas.patternPositions||{},m),b instanceof U0||b instanceof R0){let E=n.style.getOwnSourceCache(b.layers[0].source);n._terrain&&n._terrain.enabled&&E&&b.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(E.id,this.tileID)}let T=n&&n.style&&n.style.getOwnLayer(p);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ur.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ur.now()+e}setTexture(e,n){let s=n.context,h=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Ya?this.texture.update(e,{useMipmap:!0}):(this.texture=new Ya(s,e,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(e,n){let s={};for(let h of n)s[h]=!0;this.dependencies[e]=s}hasDependency(e,n){for(let s of e){let h=this.dependencies[s];if(h){for(let m of n)if(h[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let s=bs(fk,this.tileID.canonical,this.tileTransform)[0],h=new gs,m=new Wf;for(let p=0;p<s.length;p++){let{x:b,y}=s[p];h.emplaceBack(b,y),m.emplaceBack(p)}m.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(m),this._tileDebugBuffer=e.createVertexBuffer(h,Zf.members),this._tileDebugSegments=Bn.simpleSegment(0,0,h.length,m.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let s=bs(fk,this.tileID.canonical,this.tileTransform)[0],h,m;if(this.isRaster){let p=function(b,y){let w=qh(b,y),M=Math.pow(2,b.z);for(let N=0;N<ol;N++)for(let H=0;H<ol;H++){let J=Wo((b.x+(H+pk(H))/Za)/M),ee=Gr((b.y+(N+pk(N))/Za)/M),te=y.project(J,ee),pe=N*ol+H;al[2*pe+0]=Math.round((te.x*w.scale-w.x)*pt),al[2*pe+1]=Math.round((te.y*w.scale-w.y)*pt)}bd.fill(0),ob.fill(0);for(let N=2045;N>=0;N--){let H=4*N,J=_d[H+0],ee=_d[H+1],te=_d[H+2],pe=_d[H+3],he=J+te>>1,ve=ee+pe>>1,Ce=he+ve-ee,Ae=ve+J-he,Ue=ee*ol+J,ze=pe*ol+te,Ye=ve*ol+he,rt=Math.hypot((al[2*Ue+0]+al[2*ze+0])/2-al[2*Ye+0],(al[2*Ue+1]+al[2*ze+1])/2-al[2*Ye+1])>=16;bd[Ye]=bd[Ye]||(rt?1:0),N<1022&&(bd[Ye]=bd[Ye]||bd[(ee+Ae>>1)*ol+(J+Ce>>1)]||bd[(pe+Ae>>1)*ol+(te+Ce>>1)])}let T=new id,E=new Rr,P=0;function R(N,H){let J=H*ol+N;return ob[J]===0&&(T.emplaceBack(al[2*J+0],al[2*J+1],N*pt/Za,H*pt/Za),ob[J]=++P),ob[J]-1}function F(N,H,J,ee,te,pe){let he=N+J>>1,ve=H+ee>>1;if(Math.abs(N-te)+Math.abs(H-pe)>1&&bd[ve*ol+he])F(te,pe,N,H,he,ve),F(J,ee,te,pe,he,ve);else{let Ce=R(N,H),Ae=R(J,ee),Ue=R(te,pe);E.emplaceBack(Ce,Ae,Ue)}}return F(0,0,Za,Za,Za,0),F(Za,Za,0,0,0,Za),{vertices:T,indices:E}}(this.tileID.canonical,n);h=p.vertices,m=p.indices}else{h=new id,m=new Rr;for(let{x:b,y}of s)h.emplaceBack(b,y,0,0);let p=Jf(h.int16,void 0,4);for(let b=0;b<p.length;b+=3)m.emplaceBack(p[b],p[b+1],p[b+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,ab.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(m),this._tileBoundsSegments=Bn.simpleSegment(0,0,h.length,m.length)}_makeGlobeTileDebugBuffers(e,n){let s=n.projection;if(!s||s.name!=="globe"||n.freezeTileCoverage)return;let h=this.tileID.canonical,m=Qf(vS(h,n)),p=$l(n.zoom),b;p>0&&(b=t.ad.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,h,n,m,b,p),this._makeGlobeTileDebugTextBuffer(e,h,n,m,b,p)}_globePoint(e,n,s,h,m,p,b){let y=Xf(e,n,s);if(p){let w=1<<s.z,M=tl(h.center.lng),T=il(h.center.lat),E=(s.x+.5)/w-M,P=0;E>.5?P=-1:E<-.5&&(P=1);let R=(e/pt+s.x)/w+P,F=(n/pt+s.y)/w;R=(R-M)*h._pixelsPerMercatorPixel+M,F=(F-T)*h._pixelsPerMercatorPixel+T;let N=[R*h.worldSize,F*h.worldSize,0];t._.transformMat4(N,N,p),y=ql(y,N,b)}return t._.transformMat4(y,y,m)}_makeGlobeTileDebugBorderBuffer(e,n,s,h,m,p){let b=new gs,y=new Wf,w=new f0,M=(E,P,R,F,N)=>{let H=(R-E)/(N-1),J=(F-P)/(N-1),ee=b.length;for(let te=0;te<N;te++){let pe=E+te*H,he=P+te*J;b.emplaceBack(pe,he);let ve=this._globePoint(pe,he,n,s,h,m,p);w.emplaceBack(ve[0],ve[1],ve[2]),y.emplaceBack(ee+te)}},T=pt;M(0,0,T,0,16),M(T,0,T,T,16),M(T,T,0,T,16),M(0,T,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(b,Zf.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(w,bS.members),this._tileDebugSegments=Bn.simpleSegment(0,0,b.length,y.length)}_makeGlobeTileDebugTextBuffer(e,n,s,h,m,p){let b=pt/4,y=new gs,w=new Rr,M=new f0,T=25;w.reserve(32),y.reserve(T),M.reserve(T);let E=(P,R)=>T*P+R;for(let P=0;P<T;P++){let R=P*b;for(let F=0;F<T;F++){let N=F*b;y.emplaceBack(N,R);let H=this._globePoint(N,R,n,s,h,m,p);M.emplaceBack(H[0],H[1],H[2])}}for(let P=0;P<4;P++)for(let R=0;R<4;R++){let F=E(P,R),N=E(P,R+1),H=E(P+1,R),J=E(P+1,R+1);w.emplaceBack(F,N,H),w.emplaceBack(H,N,J)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(y,Zf.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(M,bS.members),this._tileDebugTextSegments=Bn.simpleSegment(0,0,T,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Ya&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let ai={read:function(i,e){return i.readFields(ai._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(i,e,n){i===1?e.header_length=n.readFixed32():i===2?e.x=n.readVarint():i===3?e.y=n.readVarint():i===4?e.z=n.readVarint():i===5&&e.layers.push(ai.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};ai.Filter.read=function(i,e){return i.readFields(ai.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},ai.Filter._readField=function(i,e,n){i===1?(e.delta_filter=ai.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):i===2?(e.zigzag_filter=ai.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):i===3?(e.bitshuffle_filter=ai.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):i===4&&(e.byteshuffle_filter=ai.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},ai.Filter.Delta={},ai.Filter.Delta.read=function(i,e){return i.readFields(ai.Filter.Delta._readField,{block_size:0},e)},ai.Filter.Delta._readField=function(i,e,n){i===1&&(e.block_size=n.readVarint())},ai.Filter.Zigzag={},ai.Filter.Zigzag.read=function(i,e){return i.readFields(ai.Filter.Zigzag._readField,{},e)},ai.Filter.Zigzag._readField=function(i,e,n){},ai.Filter.BitShuffle={},ai.Filter.BitShuffle.read=function(i,e){return i.readFields(ai.Filter.BitShuffle._readField,{},e)},ai.Filter.BitShuffle._readField=function(i,e,n){},ai.Filter.ByteShuffle={},ai.Filter.ByteShuffle.read=function(i,e){return i.readFields(ai.Filter.ByteShuffle._readField,{},e)},ai.Filter.ByteShuffle._readField=function(i,e,n){},ai.Codec={},ai.Codec.read=function(i,e){return i.readFields(ai.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},ai.Codec._readField=function(i,e,n){i===1?(e.gzip_data=ai.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):i===2?(e.jpeg_image=ai.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):i===3?(e.webp_image=ai.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):i===4&&(e.png_image=ai.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},ai.Codec.GzipData={},ai.Codec.GzipData.read=function(i,e){return i.readFields(ai.Codec.GzipData._readField,{},e)},ai.Codec.GzipData._readField=function(i,e,n){},ai.Codec.JpegImage={},ai.Codec.JpegImage.read=function(i,e){return i.readFields(ai.Codec.JpegImage._readField,{},e)},ai.Codec.JpegImage._readField=function(i,e,n){},ai.Codec.WebpImage={},ai.Codec.WebpImage.read=function(i,e){return i.readFields(ai.Codec.WebpImage._readField,{},e)},ai.Codec.WebpImage._readField=function(i,e,n){},ai.Codec.PngImage={},ai.Codec.PngImage.read=function(i,e){return i.readFields(ai.Codec.PngImage._readField,{},e)},ai.Codec.PngImage._readField=function(i,e,n){},ai.DataIndexEntry={},ai.DataIndexEntry.read=function(i,e){return i.readFields(ai.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},ai.DataIndexEntry._readField=function(i,e,n){i===1?e.first_byte=n.readFixed64():i===2?e.last_byte=n.readFixed64():i===3?e.filters.push(ai.Filter.read(n,n.readVarint()+n.pos)):i===4?e.codec=ai.Codec.read(n,n.readVarint()+n.pos):i===5?e.offset=n.readFloat():i===6?e.scale=n.readFloat():i===7&&e.bands.push(n.readString())},ai.Layer={},ai.Layer.read=function(i,e){return i.readFields(ai.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},ai.Layer._readField=function(i,e,n){i===1?e.version=n.readVarint():i===2?e.name=n.readString():i===3?e.units=n.readString():i===4?e.tilesize=n.readVarint():i===5?e.buffer=n.readVarint():i===6?e.pixel_format=n.readVarint():i===7&&e.data_index.push(ai.DataIndexEntry.read(n,n.readVarint()+n.pos))};let ws={read:function(i,e){return i.readFields(ws._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(i,e,n){i===2?(e.uint32_values=ws.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):i===3&&(e.fixed32_values=ws.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};ws.Uint32Values.read=function(i,e){return i.readFields(ws.Uint32Values._readField,{values:[]},e)},ws.Uint32Values._readField=function(i,e,n){i===1&&(e.readValuesInto=function(s){if(s.type!==2)throw new Error(`Unsupported pbf type "${s.type}"`);let h=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(s),m=s.pos;return s.pos=h,function(p){s.pos=m;let b=0;for(;s.pos<h;){let y=s.readVarint();p[b++]=y}return p}}(n))},ws.Fixed32Values={},ws.Fixed32Values.read=function(i,e){return i.readFields(ws.Fixed32Values._readField,{values:[]},e)},ws.Fixed32Values._readField=function(i,e,n){throw new Error("Not implemented")};class fL{constructor(e=0,n=0,s=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=s,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let s=this.items[e];this.ttl>0&&s.expiry<=Date.now()?this.delete(e):(n=s.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,s=!1,h=this.resetTtl){let m;if(s||this.has(e)){if(m=this.items[e],m.value=n,s===!1&&h&&(m.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==m){let p=this.last,b=m.next,y=m.prev;this.first===m&&(this.first=m.next),m.next=null,m.prev=this.last,p.next=m,y!==null&&(y.next=b),b!==null&&(b.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),m=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=m:this.last.next=m;return this.last=m,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function gL(i,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let s=2;s>=1;s--){let h=s===1?1:0,m=s===2?1:0;for(let p=0;p<e[0];p++){let b=e[1]*p;for(let y=h;y<e[1];y++){let w=e[2]*(y+b);for(let M=m;M<e[2];M++){let T=e[3]*(M+w);for(let E=0;E<e[3];E++){let P=T+E;i[P]+=i[P-n]}}}}n*=e[s]}return i}function _L(i){for(let e=0,n=i.length;e<n;e++)i[e]=i[e]>>>1^-(1&i[e]);return i}function bL(i,e){switch(e){case"uint32":return i;case"uint16":for(let n=0;n<i.length;n+=2){let s=i[n],h=i[n+1];i[n]=(240&s)>>4|(61440&s)>>8|(240&h)<<4|61440&h,i[n+1]=15&s|(3840&s)>>4|(15&h)<<8|(3840&h)<<4}return i;case"uint8":for(let n=0;n<i.length;n+=4){let s=i[n],h=i[n+1],m=i[n+2],p=i[n+3];i[n+0]=(192&s)>>6|(192&h)>>4|(192&m)>>2|192&p,i[n+1]=(48&s)>>4|(48&h)>>2|48&m|(48&p)<<2,i[n+2]=(12&s)>>2|12&h|(12&m)<<2|(12&p)<<4,i[n+3]=3&s|(3&h)<<2|(3&m)<<4|(3&p)<<6}return i;default:throw new Error(`Invalid pixel format, "${e}"`)}}class yd extends Error{constructor(e){super(e),this.name="MRTError"}}var Ta=Uint8Array,Om=Uint16Array,yL=Int32Array,gk=new Ta([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_k=new Ta([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),vL=new Ta([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),bk=function(i,e){for(var n=new Om(31),s=0;s<31;++s)n[s]=e+=1<<i[s-1];var h=new yL(n[30]);for(s=1;s<30;++s)for(var m=n[s];m<n[s+1];++m)h[m]=m-n[s]<<5|s;return{b:n,r:h}},yk=bk(gk,2),vk=yk.b,xL=yk.r;vk[28]=258,xL[258]=28;for(var wL=bk(_k,0).b,E1=new Om(32768),fr=0;fr<32768;++fr){var Rm=(43690&fr)>>1|(21845&fr)<<1;E1[fr]=((65280&(Rm=(61680&(Rm=(52428&Rm)>>2|(13107&Rm)<<2))>>4|(3855&Rm)<<4))>>8|(255&Rm)<<8)>>1}var fg=function(i,e,n){for(var s=i.length,h=0,m=new Om(e);h<s;++h)i[h]&&++m[i[h]-1];var p,b=new Om(e);for(h=1;h<e;++h)b[h]=b[h-1]+m[h-1]<<1;if(n){p=new Om(1<<e);var y=15-e;for(h=0;h<s;++h)if(i[h])for(var w=h<<4|i[h],M=e-i[h],T=b[i[h]-1]++<<M,E=T|(1<<M)-1;T<=E;++T)p[E1[T]>>y]=w}else for(p=new Om(s),h=0;h<s;++h)i[h]&&(p[h]=E1[b[i[h]-1]++]>>15-i[h]);return p},gg=new Ta(288);for(fr=0;fr<144;++fr)gg[fr]=8;for(fr=144;fr<256;++fr)gg[fr]=9;for(fr=256;fr<280;++fr)gg[fr]=7;for(fr=280;fr<288;++fr)gg[fr]=8;var xk=new Ta(32);for(fr=0;fr<32;++fr)xk[fr]=5;var CL=fg(gg,9,1),SL=fg(xk,5,1),D1=function(i){for(var e=i[0],n=1;n<i.length;++n)i[n]>e&&(e=i[n]);return e},Cs=function(i,e,n){var s=e/8|0;return(i[s]|i[s+1]<<8)>>(7&e)&n},A1=function(i,e){var n=e/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(7&e)},ML=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ss=function(i,e,n){var s=new Error(e||ML[i]);if(s.code=i,Error.captureStackTrace&&Error.captureStackTrace(s,Ss),!n)throw s;return s},kL=new Ta(0),IL=typeof TextDecoder<"u"&&new TextDecoder;try{IL.decode(kL,{stream:!0})}catch{}let TL={gzip_data:"gzip"},EL={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},DL={uint32:1,uint16:2,uint8:4},AL={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class P1{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),s=new DataView(e);if(n[0]!==13)throw new yd("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),s=this.getHeaderLength(e);if(n.length<s)throw new yd(`Expected header with length >= ${s} but got buffer of length ${n.length}`);let h=new Mm(n.subarray(0,s)),m=ai.read(h);if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new yd(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(let p of m.layers)this.layers[p.name]=new PL(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],s=this.getLayer(e.layerName);for(let h=0;h<s.dataIndex.length;h++){let m=s.dataIndex[h],p=m.first_byte-e.firstByte,b=m.last_byte+1-e.firstByte;if(h<e.firstBlock||h>e.lastBlock||s._blocksInProgress.has(h))continue;let y={layerName:s.name,firstByte:p,lastByte:b,pixelFormat:s.pixelFormat,blockIndex:h,blockShape:[m.bands.length].concat(s.bandShape),buffer:s.buffer,codec:m.codec.codec,filters:m.filters.map(w=>w.filter)};s._blocksInProgress.add(h),n.push(y)}return new wk(n,()=>{n.forEach(h=>s._blocksInProgress.delete(h.blockIndex))},(h,m)=>{if(n.forEach(p=>s._blocksInProgress.delete(p.blockIndex)),h)throw h;m.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class PL{constructor({version:e,name:n,units:s,tilesize:h,pixel_format:m,buffer:p,data_index:b},y){if(this.version=e,this.version!==1)throw new yd(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=s,this.tileSize=h,this.buffer=p,this.pixelFormat=EL[m],this.dataIndex=b,this.bandShape=[h+2*p,h+2*p,DL[this.pixelFormat]],this._decodedBlocks=function(w=1e3,M=0,T=!1){if(isNaN(w)||w<0)throw new TypeError("Invalid max value");if(isNaN(M)||M<0)throw new TypeError("Invalid ttl value");if(typeof T!="boolean")throw new TypeError("Invalid resetTtl value");return new fL(w,M,T)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[s,h]of this.dataIndex.entries()){for(let[m,p]of h.bands.entries())if(p===e)return{bandIndex:n+m,blockIndex:s,blockBandIndex:m};n+=h.bands.length}break;case"number":for(let[s,h]of this.dataIndex.entries()){if(e>=n&&e<n+h.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-n};n+=h.bands.length}break;default:throw new yd(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new yd(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,s=-1/0,h=1/0,m=-1/0;for(let p of e){let{blockIndex:b}=this.getBlockForBand(p);if(b<0)throw new yd(`Invalid band: ${JSON.stringify(p)}`);let y=this.dataIndex[b];h=Math.min(h,b),m=Math.max(m,b),n=Math.min(n,y.first_byte),s=Math.max(s,y.last_byte)}return{layerName:this.name,firstByte:n,lastByte:s,firstBlock:h,lastBlock:m}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:s}=this.getBlockForBand(e),h=this._decodedBlocks.get(n.toString());if(!h)throw new yd(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let m=this.dataIndex[n],p=this.bandShape.reduce((w,M)=>w*M,1),b=s*p,y=h.subarray(b,b+p);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:m.offset,scale:m.scale}}}class wk{constructor(e,n,s){this.tasks=e,this._onCancel=n,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}P1.performDecoding=function(i,e){return Promise.all(e.tasks.map(n=>{let{layerName:s,firstByte:h,lastByte:m,pixelFormat:p,blockShape:b,blockIndex:y,filters:w,codec:M}=n,T=new Uint8Array(i).subarray(h,m+1),E=new Uint32Array(b[0]*b[1]*b[2]),P;if(M!=="gzip_data")throw new Error(`Unhandled codec: ${M}`);return P=function(R,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((ee=function(he){he[0]==31&&he[1]==139&&he[2]==8||Ss(6,"invalid gzip data");var ve=he[3],Ce=10;4&ve&&(Ce+=2+(he[10]|he[11]<<8));for(var Ae=(ve>>3&1)+(ve>>4&1);Ae>0;Ae-=!he[Ce++]);return Ce+(2&ve)}(J=R))+8>J.length&&Ss(6,"invalid gzip data"),function(he,ve,Ce,Ae){var Ue=he.length;if(!Ue||ve.f&&!ve.l)return Ce||new Ta(0);var ze=!Ce,Ye=ze||ve.i!=2,rt=ve.i;ze&&(Ce=new Ta(3*Ue));var qe,et,We=function(xd){var wd=Ce.length;if(xd>wd){var Qh=new Ta(Math.max(2*wd,xd));Qh.set(Ce),Ce=Qh}},tt=ve.f||0,ct=ve.p||0,nt=ve.b||0,kt=ve.l,ot=ve.d,ut=ve.m,Vt=ve.n,Lt=8*Ue;do{if(!kt){tt=Cs(he,ct,1);var Ot=Cs(he,ct+1,3);if(ct+=3,!Ot){var dt=he[(Oi=4+((ct+7)/8|0))-4]|he[Oi-3]<<8,jt=Oi+dt;if(jt>Ue){rt&&Ss(0);break}Ye&&We(nt+dt),Ce.set(he.subarray(Oi,jt),nt),ve.b=nt+=dt,ve.p=ct=8*jt,ve.f=tt;continue}if(Ot==1)kt=CL,ot=SL,ut=9,Vt=5;else if(Ot==2){var li=Cs(he,ct,31)+257,Zt=Cs(he,ct+10,15)+4,ui=li+Cs(he,ct+5,31)+1;ct+=14;for(var ci=new Ta(ui),wi=new Ta(19),qt=0;qt<Zt;++qt)wi[vL[qt]]=Cs(he,ct+3*qt,7);ct+=3*Zt;var sn=D1(wi),an=(1<<sn)-1,Ui=fg(wi,sn,1);for(qt=0;qt<ui;){var Oi,Wi=Ui[Cs(he,ct,an)];if(ct+=15&Wi,(Oi=Wi>>4)<16)ci[qt++]=Oi;else{var xn=0,fn=0;for(Oi==16?(fn=3+Cs(he,ct,3),ct+=2,xn=ci[qt-1]):Oi==17?(fn=3+Cs(he,ct,7),ct+=3):Oi==18&&(fn=11+Cs(he,ct,127),ct+=7);fn--;)ci[qt++]=xn}}var Gn=ci.subarray(0,li),Vn=ci.subarray(li);ut=D1(Gn),Vt=D1(Vn),kt=fg(Gn,ut,1),ot=fg(Vn,Vt,1)}else Ss(1);if(ct>Lt){rt&&Ss(0);break}}Ye&&We(nt+131072);for(var lo=(1<<ut)-1,er=(1<<Vt)-1,Rn=ct;;Rn=ct){var vr=(xn=kt[A1(he,ct)&lo])>>4;if((ct+=15&xn)>Lt){rt&&Ss(0);break}if(xn||Ss(2),vr<256)Ce[nt++]=vr;else{if(vr==256){Rn=ct,kt=null;break}var qr=vr-254;vr>264&&(qr=Cs(he,ct,(1<<(Eo=gk[qt=vr-257]))-1)+vk[qt],ct+=Eo);var $r=ot[A1(he,ct)&er],_n=$r>>4;if($r||Ss(3),ct+=15&$r,Vn=wL[_n],_n>3){var Eo=_k[_n];Vn+=A1(he,ct)&(1<<Eo)-1,ct+=Eo}if(ct>Lt){rt&&Ss(0);break}Ye&&We(nt+131072);var Xl=nt+qr;if(nt<Vn){var Xa=0-Vn,ks=Math.min(Vn,Xl);for(Xa+nt<0&&Ss(3);nt<ks;++nt)Ce[nt]=(void 0)[Xa+nt]}for(;nt<Xl;++nt)Ce[nt]=Ce[nt-Vn]}}ve.l=kt,ve.p=Rn,ve.b=nt,ve.f=tt,kt&&(tt=1,ve.m=ut,ve.d=ot,ve.n=Vt)}while(!tt);return nt!=Ce.length&&ze?(qe=Ce,((et=nt)==null||et>qe.length)&&(et=qe.length),new Ta(qe.subarray(0,et))):Ce.subarray(0,nt)}(J.subarray(ee,-8),{i:2},new Ta(((N=J)[(H=N.length)-4]|N[H-3]<<8|N[H-2]<<16|N[H-1]<<24)>>>0))));var N,H,J,ee;let te=TL[F];if(!te)throw new Error(`Unhandled codec: ${F}`);let pe=new globalThis.DecompressionStream(te);return new Response(new Blob([R]).stream().pipeThrough(pe)).arrayBuffer().then(he=>new Uint8Array(he))}(T,M).then(R=>{let F=ws.read(new Mm(R));if(F.values==="uint32_values")return F.uint32_values.readValuesInto(E),new AL[p](E.buffer);throw new Error(`Unhandled numeric data "${F.values}"`)}),P.then(R=>{for(let F=w.length-1;F>=0;F--)switch(w[F]){case"delta_filter":gL(R,b);break;case"zigzag_filter":_L(R);break;case"bitshuffle_filter":bL(R,p);break;default:throw new Error(`Unhandled filter "${w[F]}"`)}return{layerName:s,blockIndex:y,data:R}}).catch(R=>{throw R})}))};class Ck extends sb{constructor(e,n,s,h,m){super(e,n,s,h,m),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){let s=n.context,h=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Ya?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new Ya(s,e,h.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){let s=this._mrt=new P1(30),h=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=El(h,(m,p,b,y)=>{if(m)n(m);else try{let w=s.getHeaderLength(p);if(w>e)return void(this.request=this.fetchHeader(w,n));s.parseHeader(p),this._isHeaderLoaded=!0;let M=0;for(let T of Object.values(s.layers))M=Math.max(M,T.dataIndex[T.dataIndex.length-1].last_byte);p.byteLength>=M&&(this.entireBuffer=p),n(null,this.entireBuffer||p,b,y)}catch(w){n(w)}}),this.request}fetchBand(e,n,s){let h=this._mrt;if(!this._isHeaderLoaded||!h)return void s(new Error("Tile header is not ready"));let m=this.actor;if(!m)return void s(new Error("Can't fetch tile band without an actor"));let p,b=(T,E)=>{p.complete(T,E),T?s(T):(this.updateTextureDescriptor(e,n),s(null,this.textureDescriptor&&this.textureDescriptor.img))},y=(T,E)=>{if(T)return s(T);let P=m.send("decodeRasterArray",{buffer:E,task:p},b,void 0,!0);this._workQueue.push(()=>{P&&P.cancel(),p.cancel()})},w=h.getLayer(e);if(!w)return void s(new Error(`Unknown sourceLayer "${e}"`));if(w.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void s(null,this.textureDescriptor?this.textureDescriptor.img:null);let M=w.getDataRange([n]);if(p=h.createDecodingTask(M),!p||p.tasks.length)if(this.flushQueues(),this.entireBuffer)y(null,this.entireBuffer.slice(M.firstByte,M.lastByte+1));else{let T=Object.assign({},this.requestParams,{headers:{Range:`bytes=${M.firstByte}-${M.lastByte}`}}),E=El(T,y);this._fetchQueue.push(()=>{E.cancel(),p.cancel()})}else s(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,n){if(!this._mrt)return;let s=this._mrt.getLayer(e);if(!s||!s.hasBand(n)||!s.hasDataForBand(n))return;let{bytes:h,tileSize:m,buffer:p,offset:b,scale:y}=s.getBandView(n),w=m+2*p,M={data:h,width:w,height:w},T=this.texture;T&&T instanceof Ya&&T.update(M,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:M,buffer:p,offset:b,tileSize:m,format:s.pixelFormat,mix:[y,256*y,65536*y,16777216*y]}}}class OL{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,s){let h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);let m={value:n,timeout:void 0};if(s!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},s)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){let p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let s=e.wrapped().key,h=n===void 0?0:this.data[s].indexOf(n),m=this.data[s][h];return this.data[s].splice(h,1),m.timeout&&clearTimeout(m.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(m.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let s in this.data)for(let h of this.data[s])e(h.value)||n.push(h);for(let s of n)this.remove(s.value.tileID,s)}}class $h extends Al{constructor(e,n,s){super(),this.id=e,this._onlySymbols=s,n.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new OL(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new F3,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let s=this._tiles[n];s.upload(e),s.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Zo(this._tiles).map(e=>e.tileID).sort(Sk).map(e=>e.key)}getRenderableIds(e,n){let s=[];for(let h in this._tiles)this._isIdRenderable(+h,e,n)&&s.push(this._tiles[h]);return e?s.sort((h,m)=>{let p=h.tileID,b=m.tileID,y=new wt(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),w=new wt(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-b.overscaledZ||w.y-y.y||w.x-y.x}).map(h=>h.tileID.key):s.map(h=>h.tileID).sort(Sk).map(h=>h.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(s||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,e,n)))}_tileLoaded(e,n,s,h){if(h)if(e.state="errored",h.status!==404)this._source.fire(new Gu(h,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new fo("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Ur.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new fo("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let h=0;h<n.length;h++){let m=n[h];if(e.neighboringTiles&&e.neighboringTiles[m]){let p=this.getTileByID(m);s(e,p),s(p,e)}}function s(h,m){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let p=m.tileID.canonical.x-h.tileID.canonical.x,b=m.tileID.canonical.y-h.tileID.canonical.y,y=Math.pow(2,h.tileID.canonical.z),w=m.tileID.key;p===0&&b===0||Math.abs(b)>1||(Math.abs(p)>1&&(Math.abs(p+y)===1?p+=y:Math.abs(p-y)===1&&(p-=y)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,p,b),h.neighboringTiles&&h.neighboringTiles[w]&&(h.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,s,h){for(let m in this._tiles){let p=this._tiles[m];if(h[m]||!p.hasData()||p.tileID.overscaledZ<=n||p.tileID.overscaledZ>s)continue;let b=p.tileID;for(;p&&p.tileID.overscaledZ>n+1;){let w=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[w.key],p&&p.hasData()&&(b=w)}let y=b;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){h[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=e.overscaledZ-1;s>=n;s--){let h=e.scaledTo(s),m=this._getLoadedTile(h);if(m)return m}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let s=Math.ceil(e.width/n)+1,h=Math.ceil(e.height/n)+1,m=Math.floor(s*h*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(b)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let s={};for(let h in this._tiles){let m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),s[m.tileID.key]=m}this._tiles=s;for(let h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(let h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,n,s,h){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let m;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)m=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Mr(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y));else if(this.tileCoverLift!==0){let y=e.clone();y.tileCoverLift=this.tileCoverLift,m=y.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(m.push(new Mr(1,0,1,0,0)),m.push(new Mr(1,0,1,1,0)),m.push(new Mr(1,0,1,0,1)),m.push(new Mr(1,0,1,1,1)))}else if(m=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let y=this._source.hasTile.bind(this._source);m=m.filter(w=>y(w))}}else m=[];if(m.length>0&&this.castsShadows&&h&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!O1(this._source.type)){let y=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!s}),w=Math.min(y,this._source.maxzoom),M=e.extendTileCoverForShadows(m,h,w);for(let T of M)this._shadowCasterTiles[T.key]=!0,m.push(T)}let p=this._updateRetainedTiles(m);if(O1(this._source.type)&&m.length!==0){let y={},w={},M=Object.keys(p);for(let E of M){let P=p[E],R=this._tiles[E];if(!R||R.fadeEndTime&&R.fadeEndTime<=Ur.now())continue;let F=this.findLoadedParent(P,Math.max(P.overscaledZ-$h.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),y[F.tileID.key]=F.tileID),w[E]=P}let T=m[m.length-1].overscaledZ;for(let E in this._tiles){let P=this._tiles[E];if(p[E]||!P.hasData())continue;let R=P.tileID;for(;R.overscaledZ>T;){R=R.scaledTo(R.overscaledZ-1);let F=this._tiles[R.key];if(F&&F.hasData()&&w[R.key]){p[E]=P.tileID;break}}}for(let E in y)p[E]||(this._coveredTiles[E]=!0,p[E]=y[E])}for(let y in p)this._tiles[y].clearFadeHold();let b=function(y,w){let M=[];for(let T in y)T in w||M.push(T);return M}(this._tiles,p);for(let y of b){let w=this._tiles[y];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let s={},h=e.reduce((w,M)=>Math.min(w,M.overscaledZ),1/0),m=e[0].overscaledZ,p=Math.max(m-$h.maxOverzooming,this._source.minzoom),b=Math.max(m+$h.maxUnderzooming,this._source.minzoom),y={};for(let w of e){let M=this._addTile(w);n[w.key]=w,M.hasData()||h<this._source.maxzoom&&(y[w.key]=w)}this._retainLoadedChildren(y,h,b,n);for(let w of e){let M=this._tiles[w.key];if(M.hasData())continue;if(w.canonical.z>=this._source.maxzoom){let E=w.children(this._source.maxzoom)[0],P=this.getTile(E);if(P&&P.hasData()){n[E.key]=E;continue}}else{let E=w.children(this._source.maxzoom);if(n[E[0].key]&&n[E[1].key]&&n[E[2].key]&&n[E[3].key])continue}let T=M.wasRequested();for(let E=w.overscaledZ-1;E>=p;--E){let P=w.scaledTo(E);if(s[P.key]||(s[P.key]=!0,M=this.getTile(P),!M&&T&&(M=this._addTile(P)),M&&(n[P.key]=P,T=M.wasRequested(),M.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],s,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){s=this._loadedParentTiles[h.key];break}n.push(h.key);let m=h.scaledTo(h.overscaledZ-1);if(s=this._getLoadedTile(m),s)break;h=m}for(let m of n)this._loadedParentTiles[m]=s}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let s=!!n;if(!s){let h=this.map?this.map.painter:null,m=this._source.tileSize*e.overscaleFactor();n=this._source.type==="raster-array"?new Ck(e,m,this.transform.tileZoom,h,this._isRaster):new sb(e,m,this.transform.tileZoom,h,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,s||this._source.fire(new fo("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let s=n.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,s){let h=[],m=this.transform;if(!m)return h;let p=m.projection.name==="globe",b=tl(m.center.lng);for(let y in this._tiles){let w=this._tiles[y];if(s&&w.clearQueryDebugViz(),w.holdingForFade())continue;let M;if(p){let T=w.tileID.canonical;if(T.z===0){let E=[Math.abs(gi(b,..._g(T,-1))-b),Math.abs(gi(b,..._g(T,1))-b)];M=[0,2*E.indexOf(Math.min(...E))-1]}else{let E=[Math.abs(gi(b,..._g(T,-1))-b),Math.abs(gi(b,..._g(T,0))-b),Math.abs(gi(b,..._g(T,1))-b)];M=[E.indexOf(Math.min(...E))-1]}}else M=[0];for(let T of M){let E=e.containsTile(w,m,n,T);E&&h.push(E)}}return h}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let s=this.getRenderableIds(e,n).map(m=>this._tiles[m].tileID),h=this.transform.projection.name==="globe";for(let m of s)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=h?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return s}sortCoordinatesByDistance(e){let n=e.slice(),s=this.transform._camera.position,h=this.transform._camera.forward(),m={};for(let p of n){let b=1/(1<<p.canonical.z);m[p.key]=((p.canonical.x+.5)*b+p.wrap-s[0])*h[0]+((p.canonical.y+.5)*b-s[1])*h[1]-s[2]*h[2]}return n.sort((p,b)=>m[p.key]-m[b.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(O1(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Ur.now())return!0}return!1}setFeatureState(e,n,s){this._state.updateState(e=e||"_geojsonTileLayer",n,s)}removeFeatureState(e,n,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,s)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,s){let h=this._tiles[e];h&&h.setDependencies(n,s)}reloadTilesForDependencies(e,n){for(let s in this._tiles)this._tiles[s].hasDependency(e,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(e,n))};return void this._source.on("data",b)}let s=new Map,h=Array.isArray(e)?e:[e],m=this.map.painter.terrain,p=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(let b of h){let y=b.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let w of y)s.set(w.key,w);this.usedForTerrain&&b.updateElevation(!1)}Pc(Array.from(s.values()),(b,y)=>{let w=new sb(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,M=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),y(M,w)})},n)}}function Sk(i,e){let n=Math.abs(2*i.wrap)-+(i.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||s-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function O1(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function _g(i,e){let n=1<<i.z;return[i.x/n+e,(i.x+1)/n+e]}$h.maxOverzooming=10,$h.maxUnderzooming=3;let Mk=new class extends St{possiblyEvaluate(i,e){return e=new Kt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,n,s){return e=Jr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,n,s)}}(W0.paint.properties["line-width"].specification);function kk(i,e){return e>0?e+2*i:i}Mk.useIntegerZoom=!0;let RL=new $i({"symbol-placement":new Ke(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ke(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ke(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new St(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ke(Pe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ke(Pe.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Ke(Pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ke(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ke(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ke(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new St(Pe.layout_symbol["icon-size"]),"icon-text-fit":new St(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new St(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new St(Pe.layout_symbol["icon-image"]),"icon-rotate":new St(Pe.layout_symbol["icon-rotate"]),"icon-padding":new Ke(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ke(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new St(Pe.layout_symbol["icon-offset"]),"icon-anchor":new St(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ke(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ke(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ke(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new St(Pe.layout_symbol["text-field"]),"text-font":new St(Pe.layout_symbol["text-font"]),"text-size":new St(Pe.layout_symbol["text-size"]),"text-max-width":new St(Pe.layout_symbol["text-max-width"]),"text-line-height":new St(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new St(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new St(Pe.layout_symbol["text-justify"]),"text-radial-offset":new St(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ke(Pe.layout_symbol["text-variable-anchor"]),"text-anchor":new St(Pe.layout_symbol["text-anchor"]),"text-max-angle":new Ke(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ke(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new St(Pe.layout_symbol["text-rotate"]),"text-padding":new Ke(Pe.layout_symbol["text-padding"]),"text-keep-upright":new Ke(Pe.layout_symbol["text-keep-upright"]),"text-transform":new St(Pe.layout_symbol["text-transform"]),"text-offset":new St(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new Ke(Pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ke(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new Ke(Pe.layout_symbol["text-optional"]),visibility:new Ke(Pe.layout_symbol.visibility)});var R1={paint:new $i({"icon-opacity":new St(Pe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new St(Pe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new St(Pe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new St(Pe.paint_symbol["text-emissive-strength"]),"icon-color":new St(Pe.paint_symbol["icon-color"]),"icon-halo-color":new St(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new St(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new St(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ke(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ke(Pe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new St(Pe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new St(Pe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new St(Pe.paint_symbol["text-occlusion-opacity"]),"text-color":new St(Pe.paint_symbol["text-color"],{runtimeType:go,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new St(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new St(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new St(Pe.paint_symbol["text-halo-blur"]),"text-translate":new Ke(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new Ke(Pe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ke(Pe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ke(Pe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ke(Pe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ke(Pe.paint_symbol["icon-color-brightness-max"])}),layout:RL};class Ik{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Uc,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ne(Ik,"FormatSectionOverride",{omit:["defaultValue"]});class lb extends Sr{constructor(e,n,s,h){super(e,R1,n,s,h),this._colorAdjustmentMatrix=t.ad.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let s=this.layout.get("text-writing-mode");if(s){let h=[];for(let m of s)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,s,h){return this._saturation===e&&this._contrast===n&&this._brightnessMin===s&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(m,p,b,y){m=Lu(m),p=Ru(p);let w=t.ad.create(),M=m/3,T=1-2*M,E=[T,M,M,0,M,T,M,0,M,M,T,0,0,0,0,1],P=.5-.5*p,R=y-b;return t.ad.multiply(w,[R,0,0,0,0,R,0,0,0,0,R,0,b,b,b,1],[p,0,0,0,0,p,0,0,0,0,p,0,P,P,P,1]),t.ad.multiply(w,w,E),w}(e,n,s,h),this._saturation=e,this._contrast=n,this._brightnessMin=s,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,s,h){let m=this.layout.get(e).evaluate(n,{},s,h),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||B(p.value)||!m?m:function(b,y){return y.replace(/{([^{}]+)}/g,(w,M)=>M in b?String(b[M]):"")}(n.properties,m)}createBucket(e){return new Pm(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of R1.paint.overridableProperties){if(!lb.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),s=new Ik(n),h=new L(s,n.property.specification,this.scope,this.options),m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new W("source",h):new Y("composite",h,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new kn(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&lb.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let s=e.get("text-field"),h=R1.paint.properties[n],m=!1,p=b=>{for(let y of b)if(h.overrides&&h.overrides.hasOverride(y))return void(m=!0)};if(s.value.kind==="constant"&&s.value.value instanceof eo)p(s.value.value.sections);else if(s.value.kind==="source"){let b=w=>{m||(w instanceof us&&yr(w.value)===Hc?p(w.value.sections):w instanceof vh?p(w.sections):w.eachChild(b))},y=s.value;y._styleExpression&&b(y._styleExpression.expression)}return m}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,s=[];return e&&s.push("symbolIcon"),n&&s.push("symbolSDF"),s}getDefaultProgramParams(e,n,s){return{config:new Vh(this,{zoom:n,lut:s}),overrideFog:!1}}}let LL=new $i({visibility:new Ke(Pe.layout_background.visibility)});var FL={paint:new $i({"background-color":new Ke(Pe.paint_background["background-color"]),"background-pattern":new Ke(Pe.paint_background["background-pattern"]),"background-opacity":new Ke(Pe.paint_background["background-opacity"]),"background-emissive-strength":new Ke(Pe.paint_background["background-emissive-strength"])}),layout:LL};let zL=new $i({visibility:new Ke(Pe.layout_raster.visibility)});var BL={paint:new $i({"raster-opacity":new Ke(Pe.paint_raster["raster-opacity"]),"raster-color":new zn(Pe.paint_raster["raster-color"]),"raster-color-mix":new Ke(Pe.paint_raster["raster-color-mix"]),"raster-color-range":new Ke(Pe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ke(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ke(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ke(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ke(Pe.paint_raster["raster-saturation"]),"raster-contrast":new Ke(Pe.paint_raster["raster-contrast"]),"raster-resampling":new Ke(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ke(Pe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ke(Pe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ke(Pe.paint_raster["raster-array-band"]),"raster-elevation":new Ke(Pe.paint_raster["raster-elevation"])}),layout:zL};function cb(i,e,n,s,h,m,p,b){let y=[i,e,1,n,s,1,h,m,1],w=[p,b,1],M=t.bC.adjoint([],y),[T,E,P]=t._.transformMat3(w,w,M);return t.bC.multiply(y,y,[T,0,0,0,E,0,0,0,P])}function Tk(i,e,n,s,h,m,p,b){let y=function(w,M,T,E,P,R,F,N){let H=cb(0,0,1,0,1,1,0,1),J=cb(w,M,T,E,P,R,F,N),ee=t.bC.adjoint([],H);return t.bC.multiply(J,J,ee)}(i,e,n,s,h,m,p,b);return[y[2]/y[8]/pt,y[5]/y[8]/pt]}function db(i){return[i[0],Math.min(Math.max(i[1],-cr),cr)]}class Ek extends Al{constructor(e,n,s,h){super(),this.id=e,this.dispatcher=s,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new fo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Gs(this.map._requestManager.transformRequest(this.url,Vu.Image),(s,h)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new Gu(s)):h&&(this.image=h instanceof HTMLImageElement?Ur.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new rb(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new fo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof rb||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],s=e[0][1];for(let m of e)m[1]>s&&(s=m[1]),m[1]<n&&(n=m[1]);let h=(s+n)/2;if(h>cr?this.onNorthPole=!0:h<-cr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let m=e.map(so.fromLngLat);this.tileID=function(p){let b=1/0,y=1/0,w=-1/0,M=-1/0;for(let F of p)b=Math.min(b,F.x),y=Math.min(y,F.y),w=Math.max(w,F.x),M=Math.max(M,F.y);let T=Math.max(w-b,M-y),E=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),P=Math.pow(2,E),R=Math.floor((b+w)/2*P);return R>1&&(R-=1),new Uh(E,R,Math.floor((y+M)/2*P))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new fo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let N in this.tiles){let H=this.tiles[N];H.state!=="loaded"&&(H.state="loaded",H.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=qh(new Uh(0,0,0),this.map.transform.projection),s=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){let H=N[1].x-N[0].x,J=N[1].y-N[0].y,ee=N[2].x-N[1].x,te=N[2].y-N[1].y,pe=N[3].x-N[2].x,he=N[3].y-N[2].y,ve=N[0].x-N[3].x,Ce=N[0].y-N[3].y,Ae=H*te-ee*J,Ue=ee*he-pe*te,ze=pe*Ce-ve*he,Ye=ve*J-H*Ce;return Ae>0&&Ue>0&&ze>0&&Ye>0||Ae<0&&Ue<0&&ze<0&&Ye<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let h=qh(this.tileID,this.map.transform.projection),[m,p,b,y]=this.coordinates.map(N=>{let H=h.projection.project(N[0],N[1]);return lk(h,H)._round()});this.perspectiveTransform=Tk(m.x,m.y,p.x,p.y,b.x,b.y,y.x,y.y);let w=this._boundsArray=new id;w.emplaceBack(m.x,m.y,0,0),w.emplaceBack(p.x,p.y,pt,0),w.emplaceBack(y.x,y.y,0,pt),w.emplaceBack(b.x,b.y,pt,pt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,ab.members),this.boundsSegments=Bn.simpleSegment(0,0,4,2);let M=[],T=function(N){return[db(N[0]),db(N[1]),db(N[2]),db(N[3])]}(this.coordinates),[E,P,R,F]=function(N){let H=N[0][0],J=H,ee=N[0][1],te=ee;for(let pe=1;pe<N.length;pe++)N[pe][0]<H?H=N[pe][0]:N[pe][0]>J&&(J=N[pe][0]),N[pe][1]<ee?ee=N[pe][1]:N[pe][1]>te&&(te=N[pe][1]);return[H,ee,J-H,te-ee]}(T);{let N=new id,[H,J,ee,te]=function(We){let tt=We[0].x,ct=tt,nt=We[0].y,kt=nt;for(let ot=1;ot<We.length;ot++)We[ot].x<tt?tt=We[ot].x:We[ot].x>ct&&(ct=We[ot].x),We[ot].y<nt?nt=We[ot].y:We[ot].y>kt&&(kt=We[ot].y);return[tt,nt,ct-tt,kt-nt]}(s),pe=We=>[(We.x-H)/ee,(We.y-J)/te],[he,ve,Ce,Ae]=s.map(pe),Ue=function(We,tt,ct,nt,kt,ot,ut,Vt){let Lt=cb(0,0,1,0,1,1,0,1),Ot=cb(We,tt,ct,nt,kt,ot,ut,Vt),dt=t.bC.adjoint([],Ot);return t.bC.multiply(Lt,Lt,dt)}(he[0],he[1],ve[0],ve[1],Ce[0],Ce[1],Ae[0],Ae[1]);this.elevatedGlobePerspectiveTransform=Tk(he[0],he[1],ve[0],ve[1],Ce[0],Ce[1],Ae[0],Ae[1]);let ze=(We,tt)=>{M.push(We.lng);let ct=Math.round((We.lng-E)/R*pt),nt=Math.round((We.lat-P)/F*pt),kt=pe(tt),ot=t._.transformMat3([],[kt[0],kt[1],1],Ue),ut=Math.round(ot[0]/ot[2]*pt),Vt=Math.round(ot[1]/ot[2]*pt);N.emplaceBack(ct,nt,ut,Vt)},Ye=s[3].x-s[0].x,rt=s[3].y-s[0].y,qe=s[2].x-s[1].x,et=s[2].y-s[1].y;for(let We=0;We<65;We++){let tt=We/64,ct=[s[0].x+tt*Ye,s[0].y+tt*rt],nt=[s[1].x+tt*qe,s[1].y+tt*et],kt=nt[0]-ct[0],ot=nt[1]-ct[1];for(let ut=0;ut<65;ut++){let Vt=ut/64,Lt={x:ct[0]+kt*Vt,y:ct[1]+ot*Vt,z:0};ze(n.projection.unproject(Lt.x,Lt.y),Lt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(N,ab.members)}{this.maxLongitudeTriangleSize=0;let N=[],H=new Rr,J=(ee,te,pe)=>{H.emplaceBack(ee,te,pe);let he=M[ee],ve=M[te],Ce=M[pe],Ae=Math.min(Math.min(he,ve),Ce),Ue=Math.max(Math.max(he,ve),Ce)-Ae;Ue>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ue),N.push(Ae+Ue/2)};for(let ee=0;ee<64;ee++)for(let te=0;te<64;te++){let pe=65*ee+te,he=pe+1,ve=pe+65,Ce=ve+1;J(pe,ve,he),J(he,ve,Ce)}[N,H]=function(ee,te){let pe=Array.from({length:ee.length},(Ce,Ae)=>Ae);pe.sort((Ce,Ae)=>ee[Ce]-ee[Ae]);let he=[],ve=new Rr;for(let Ce=0;Ce<pe.length;Ce++){let Ae=pe[Ce];he.push(ee[Ae]);let Ue=3*Ae,ze=Ue+1;ve.emplaceBack(te.uint16[Ue],te.uint16[ze],te.uint16[ze+1])}return[he,ve]}(N,H),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(H)}this.elevatedGlobeSegments=Bn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/pt,0,F/pt,0,0,P,E,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,s=n.gl;!this._dirty||this.texture instanceof rb||(this.texture?this.texture.update(this.image):(this.texture=new Ya(n,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let s=this.elevatedGlobeTrianglesCenterLongitudes,h=(m=e+180)+360*Math.round((s[0]-m)/360);var m;let p=new Bn,b=(T,E)=>{p.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:n.segments[0].vertexLength,primitiveLength:E,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-h)<=y){let T=M_(s,0,s.length,h+y);return T===s.length||b(T,Xp(s,T+1,s.length,h+360-y)-T),p}h<s[0]&&(h+=360);let w=Xp(s,0,s.length,h-y);if(w===s.length)return b(0,s.length),p;b(0,w-0);let M=M_(s,w+1,s.length,h+y);return M!==s.length&&b(M,s.length-M),p}}let NL=(Math.pow(256,2)-1)/16907520;class Dk extends Sr{constructor(e,n,s,h){super(e,BL,n,s,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Ek&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[s,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(h)||s===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=Kf({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,h])}}let VL=new $i({visibility:new Ke(Pe["layout_raster-particle"].visibility)});var jL={paint:new $i({"raster-particle-array-band":new Ke(Pe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ke(Pe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new zn(Pe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ke(Pe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ke(Pe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ke(Pe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ke(Pe["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:VL};class Ak extends Sr{constructor(e,n,s,h){super(e,jL,n,s,h),this._updateColorRamp(),this.lastInvalidatedAt=Ur.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Kf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ur.now()}}class UL extends Sr{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let WL=new $i({visibility:new Ke(Pe.layout_sky.visibility)});var HL={paint:new $i({"sky-type":new Ke(Pe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ke(Pe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ke(Pe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ke(Pe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ke(Pe.paint_sky["sky-gradient-radius"]),"sky-gradient":new zn(Pe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ke(Pe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ke(Pe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ke(Pe.paint_sky["sky-opacity"])}),layout:WL};function L1(i,e,n){let s=[0,0,1],h=t.av.identity([]);return t.av.rotateY(h,h,n?-Ai(i)+Math.PI:Ai(i)),t.av.rotateX(h,h,-Ai(e)),t._.transformQuat(s,s,h),t._.normalize(s,s)}var GL={paint:new $i({})};function Pk(i,e){let n=hb(i.projection,i.zoom,i.width,i.height),s=function(m,p,b,y,w){let M=new zi(b.lng-180*vd,b.lat),T=new zi(b.lng+180*vd,b.lat),E=m.project(M.lng,M.lat),P=m.project(T.lng,T.lat),R=-Math.atan2(P.y-E.y,P.x-E.x),F=so.fromLngLat(b);F.y=gi(F.y,-1+vd,1-vd);let N=F.toLngLat(),H=m.project(N.lng,N.lat),J=so.fromLngLat(N);J.x+=vd;let ee=J.toLngLat(),te=m.project(ee.lng,ee.lat),pe=Lk(te.x-H.x,te.y-H.y,R),he=so.fromLngLat(N);he.y+=vd;let ve=he.toLngLat(),Ce=m.project(ve.lng,ve.lat),Ae=Lk(Ce.x-H.x,Ce.y-H.y,R),Ue=Math.abs(pe.x)/Math.abs(Ae.y),ze=t.ad.identity([]);t.ad.rotateZ(ze,ze,-R*(1-(w?0:y)));let Ye=t.ad.identity([]);return t.ad.scale(Ye,Ye,[1,1-(1-Ue)*y,1]),Ye[4]=-Ae.x/Ae.y*y,t.ad.rotateZ(Ye,Ye,R),t.ad.multiply(Ye,ze,Ye),Ye}(i.projection,0,i.center,n,e),h=Ok(i);return t.ad.scale(s,s,[h,h,1]),s}function Ok(i){let e=i.projection,n=hb(i.projection,i.zoom,i.width,i.height),s=Rk(e,i.center),h=Rk(e,zi.convert(e.center));return Math.pow(2,s*n+(1-n)*h)}function hb(i,e,n,s,h=1/0){let m=i.range;if(!m)return 0;let p=Math.min(h,Math.max(n,s)),b=Math.log(p/1024)/Math.LN2;return Ml(m[0]+b,m[1]+b,e)}let vd=1/4e4;function Rk(i,e){let n=gi(e.lat,-cr,cr),s=new zi(e.lng-180*vd,n),h=new zi(e.lng+180*vd,n),m=i.project(s.lng,n),p=i.project(h.lng,n),b=so.fromLngLat(s),y=so.fromLngLat(h),w=p.x-m.x,M=p.y-m.y,T=y.x-b.x,E=y.y-b.y,P=Math.sqrt((T*T+E*E)/(w*w+M*M));return Math.log(P)/Math.LN2}function Lk(i,e,n){let s=Math.cos(n),h=Math.sin(n);return{x:i*s-e*h,y:i*h+e*s}}function Fk(i,e,n){t.ad.identity(i),t.ad.rotateZ(i,i,Ai(e[2])),t.ad.rotateX(i,i,Ai(e[0])),t.ad.rotateY(i,i,Ai(e[1])),t.ad.scale(i,i,n),t.ad.multiply(i,i,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ub(i,e,n,s,h,m,p,b){let y=[n[0]-e[0],n[1]-e[1],0],w=[s[0]-e[0],s[1]-e[1],0];if(t._.length(y)<1e-12||t._.length(w)<1e-12)return t.av.identity(i);let M=t._.cross([],y,w);t._.normalize(M,M),t._.subtract(w,s,e),y[2]=(m-h)*b,w[2]=(p-h)*b;let T=y;return t._.cross(T,y,w),t._.normalize(T,T),t.av.rotationTo(i,M,T)}function F1(i,e,n=!1){let s=$l(e.zoom),h=function(m,p,b){let y=p.worldSize,w=[m[12],m[13],m[14]],M=Gr(w[1]/y),T=Wo(w[0]/y),E=t.ad.identity([]),P=To(1,M)*y,R=To(1,0)*y*Wh(M,p.zoom),F=1/e1(y),N=R*F;if(b){let te=hb(p.projection,p.zoom,p.width,p.height,1024);N=F*p.projection.pixelSpaceConversion(p.center.lat,y,te)}let H=jh(M,T);t._.add(H,H,t._.scale([],t._.normalize([],H),P*N*w[2]));let J=function(te){let pe=[te[0],te[1],te[2]],he=[0,1,0],ve=t._.cross([],he,pe);return t._.cross(he,pe,ve),t._.squaredLength(he)===0&&(he=[0,1,0],t._.cross(ve,pe,he)),t._.normalize(ve,ve),t._.normalize(he,he),t._.normalize(pe,pe),[ve[0],ve[1],ve[2],0,he[0],he[1],he[2],0,pe[0],pe[1],pe[2],0,te[0],te[1],te[2],1]}(H);t.ad.scale(E,E,[N,N,N*P]),t.ad.translate(E,E,[-w[0],-w[1],-w[2]]);let ee=t.ad.multiply([],p.globeMatrix,J);return t.ad.multiply(ee,ee,E),t.ad.multiply(ee,ee,m),ee}(i,e,n);if(s>0){let m=function(p,b){let y=b.worldSize,w=To(1,0)*y*Wh(b.center.lat,b.zoom)/e1(y),M=To(1,b.center.lat)*y,T=t.ad.identity([]);return t.ad.rotateY(T,T,Ai(b.center.lng)),t.ad.rotateX(T,T,Ai(b.center.lat)),t.ad.translate(T,T,[0,0,Io]),t.ad.scale(T,T,[w,w,w*M]),t.ad.translate(T,T,[b.point.x-.5*y,b.point.y-.5*y,0]),t.ad.multiply(T,T,p),t.ad.multiply(T,b.globeMatrix,T)}(i,e);return function(p,b,y){let w=(R,F,N)=>{let H=t._.length(R),J=t._.length(F),ee=ql(R,F,N);return t._.scale(ee,ee,1/t._.length(ee)*Ht(H,J,N))},M=w([p[0],p[1],p[2]],[b[0],b[1],b[2]],y),T=w([p[4],p[5],p[6]],[b[4],b[5],b[6]],y),E=w([p[8],p[9],p[10]],[b[8],b[9],b[10]],y),P=ql([p[12],p[13],p[14]],[b[12],b[13],b[14]],y);return[M[0],M[1],M[2],0,T[0],T[1],T[2],0,E[0],E[1],E[2],0,P[0],P[1],P[2],1]}(h,m,s)}return h}function zk(i,e,n,s){let h=Nn.projectAabbCorners(s,n),m=Number.MAX_VALUE,p=-1;for(let w=0;w<h.length;++w){let M=h[w];M[0]=(.5*M[0]+.5)*e.width,M[1]=(.5-.5*M[1])*e.height,M[2]<m&&(p=w,m=M[2])}let b=w=>new wt(h[w][0],h[w][1]),y;switch(p){case 0:case 6:y=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:y=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:y=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:y=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(Hx(i,y))return m}let qL=Yi([{name:"a_pos_3f",components:3,type:"Float32"}]),$L=Yi([{name:"a_color_3f",components:3,type:"Float32"}]),YL=Yi([{name:"a_color_4f",components:4,type:"Float32"}]),ZL=Yi([{name:"a_uv_2f",components:2,type:"Float32"}]),XL=Yi([{name:"a_normal_3f",components:3,type:"Float32"}]),QL=Yi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),KL=Yi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class mb{constructor(e,n,s,h){this.message=(e?`${e}: `:"")+s,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function Bk(i,e){let n=i.indexOf("://")===-1;try{return new URL(i,n&&e?"http://example.com":void 0),!0}catch{return!1}}class Nk{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Vk{constructor(){this.instancedDataArray=new Ix,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class z1{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,s,h){this.tileToMeter=w0(s);let m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:b,index:y,sourceLayerIndex:w}of e){let M=b??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),T=Gl(p,m);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),T,s))continue;let E={id:M,sourceLayerIndex:w,index:y,geometry:m?T.geometry:bs(p,s,h),properties:p.properties,type:p.type,patterns:{}},P=this.addFeature(E,E.geometry,T);P&&n.featureIndex.insert(p,E.geometry,y,w,this.index,this.instancesPerModel[P].instancedDataArray.length,pt/32)}this.lookup=null}update(e,n,s,h){for(let m in this.instancesPerModel){let p=this.instancesPerModel[m];for(let b in e)p.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(p.features[p.idToFeaturesIndex[b]],e[b],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let s=this.instancesPerModel[n];for(let h of s.features){let m=this.layers[0],p=h.feature,b=this.canonical,y=m.paint.get("model-rotation").evaluate(p,{},b),w=m.paint.get("model-scale").evaluate(p,{},b),M=m.paint.get("model-translation").evaluate(p,{},b);t._.exactEquals(h.rotation,y)&&t._.exactEquals(h.scale,w)&&t._.exactEquals(h.translation,M)||(this.evaluate(h,h.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,n,s){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let h=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(d1(this.activeReplacements,h))return!1;this.activeReplacements=h;let m=!1;for(let p in this.instancesPerModel){let b=this.instancesPerModel[p],y=b.instancedDataArray;for(let w of b.features){let M=w.instancedDataOffset,T=w.instancedDataCount;for(let E=0;E<T;E++){let P=16*(E+M),R=y.float32[P+0];R=R>pt?R-pt:R;let F=Math.floor(R),N=y.float32[P+1],H=!1;for(let J of this.activeReplacements)if(!(J.order<s||J.order===1/0)&&J.clipMask&oM.Model&&!(J.min.x>F||F>J.max.x||J.min.y>N||N>J.max.y)&&(H=QS(XS(F,N,e.canonical,J.footprintTileId.canonical),J),H))break;y.float32[P]=H?R+pt:R,m=m||H}}}return m}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let s=this.instancesPerModel[n];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,QL.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let s=this.instancesPerModel[n];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,s){let h=this.layers[0],m=h.layout.get("model-id").evaluate(s,{},this.canonical);if(!m)return sr(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),m;Bk(m,!1)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new Vk);let p=this.instancesPerModel[m],b=p.instancedDataArray,y=new Nk(s,b.length);for(let w of n)for(let M of w){if(M.x<0||M.x>=pt||M.y<0||M.y>=pt)continue;let T=(this.lookupDim-1)/pt,E=this.lookupDim*(M.y*T|0)+M.x*T|0;if(this.lookup){if(this.lookup[E]!==0)continue;this.lookup[E]=1}this.instanceCount++;let P=b.length;b.resize(P+1),p.instancesEvaluatedElevation.push(0),b.float32[16*P]=M.x,b.float32[16*P+1]=M.y}return y.instancedDataCount=p.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(y),this.evaluate(y,{},p,!1)),m}getModelUris(){return this.modelUris}evaluate(e,n,s,h){let m=this.layers[0],p=e.feature,b=this.canonical,y=e.rotation=m.paint.get("model-rotation").evaluate(p,n,b),w=e.scale=m.paint.get("model-scale").evaluate(p,n,b),M=e.translation=m.paint.get("model-translation").evaluate(p,n,b),T=m.paint.get("model-color").evaluate(p,n,b);T.a=m.paint.get("model-color-mix-intensity").evaluate(p,n,b);let E=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),Fk(E,y,w);let P=Math.round(100*T.a)+T.b/1.05;for(let R=0;R<e.instancedDataCount;++R){let F=e.instancedDataOffset+R,N=16*F,H=s.instancedDataArray.float32,J=0;h&&(J=H[N+6]-s.instancesEvaluatedElevation[F]);let ee=0|H[N+1];H[N]=(0|H[N])+T.r/1.05,H[N+1]=ee+T.g/1.05,H[N+2]=P,H[N+3]=1/(b.z>10?this.tileToMeter:w0(b,ee)),H[N+4]=M[0],H[N+5]=M[1],H[N+6]=M[2]+J,H[N+7]=E[0],H[N+8]=E[1],H[N+9]=E[2],H[N+10]=E[4],H[N+11]=E[5],H[N+12]=E[6],H[N+13]=E[8],H[N+14]=E[9],H[N+15]=E[10],s.instancesEvaluatedElevation[F]=M[2]}}}ne(z1,"ModelBucket",{omit:["layers"]}),ne(Vk,"PerModelAttributes"),ne(Nk,"ModelFeature");let JL=new $i({visibility:new Ke(Pe.layout_model.visibility),"model-id":new St(Pe.layout_model["model-id"])});var eF={paint:new $i({"model-opacity":new Ke(Pe.paint_model["model-opacity"]),"model-rotation":new St(Pe.paint_model["model-rotation"]),"model-scale":new St(Pe.paint_model["model-scale"]),"model-translation":new St(Pe.paint_model["model-translation"]),"model-color":new St(Pe.paint_model["model-color"]),"model-color-mix-intensity":new St(Pe.paint_model["model-color-mix-intensity"]),"model-type":new Ke(Pe.paint_model["model-type"]),"model-cast-shadows":new Ke(Pe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ke(Pe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ke(Pe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new St(Pe.paint_model["model-emissive-strength"]),"model-roughness":new St(Pe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new St(Pe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ke(Pe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ke(Pe.paint_model["model-front-cutoff"])}),layout:JL};let Yh=64,Lm={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function jk(i,e,n,s,h,m,p,b,y,w=!1){let M=n.zoom,T=n.project(s),E=Wh(s.lat,M),P=1/E;t.ad.identity(i),t.ad.translate(i,i,[T.x+p[0]*P,T.y+p[1]*P,p[2]]);let R=1,F=1,N=n.worldSize;if(w){if(n.projection.name==="mercator"){let te=0;n.elevation&&(te=n.elevation.getAtPointOrZero(new so(T.x/N,T.y/N),0));let pe=t.aA.transformMat4([],[T.x,T.y,te,1],n.projMatrix)[3]/n.cameraToCenterDistance;R=pe,F=pe*Wh(n.center.lat,M)}else if(n.projection.name==="globe"){let te=F1(i,n),pe=t.ad.multiply([],n.projMatrix,te),he=[0,0,0,1];t.aA.transformMat4(he,he,pe);let ve=he[3]/n.cameraToCenterDistance,Ce=$l(M),Ae=n.projection.pixelsPerMeter(s.lat,N)*Wh(s.lat,M),Ue=n.projection.pixelsPerMeter(n.center.lat,N)*Wh(n.center.lat,M);R=ve/Ht(Ae,oS(n.center.lat),Ce),F=ve*E/Ae,R*=Ue,F*=Ue}}else R=P;t.ad.scale(i,i,[R,R,F]);let H=[...i],J=e.orientation,ee=[];if(Fk(ee,[J[0]+h[0],J[1]+h[1],J[2]+h[2]],m),t.ad.multiply(i,H,ee),b&&n.elevation){let te=0,pe=[];if(y&&n.elevation){te=function(Ce,Ae,Ue,ze,Ye){let rt=Ae.elevation;if(!rt)return 0;let qe=Nn.projectAabbCorners(Ue,ze),et=To(1,Ye.lat)*Ae.worldSize,We=function(jt,li){let Zt=[0,0,1],ui=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let ci of ui){let wi=jt[ci.corners[0]],qt=jt[ci.corners[1]],sn=jt[ci.corners[2]],an=[qt[0]-wi[0],qt[1]-wi[1],li*(qt[2]-wi[2])],Ui=t._.cross(an,an,[sn[0]-wi[0],sn[1]-wi[1],li*(sn[2]-wi[2])]);t._.normalize(Ui,Ui),ci.dotProductWithUp=t._.dot(Ui,Zt)}return ui.sort((ci,wi)=>ci.dotProductWithUp-wi.dotProductWithUp),ui[0].corners}(qe,et),tt=qe[We[0]],ct=qe[We[1]],nt=qe[We[2]],kt=qe[We[3]],ot=rt.getAtPointOrZero(new so(tt[0]/Ae.worldSize,tt[1]/Ae.worldSize),0),ut=rt.getAtPointOrZero(new so(ct[0]/Ae.worldSize,ct[1]/Ae.worldSize),0),Vt=rt.getAtPointOrZero(new so(nt[0]/Ae.worldSize,nt[1]/Ae.worldSize),0),Lt=rt.getAtPointOrZero(new so(kt[0]/Ae.worldSize,kt[1]/Ae.worldSize),0),Ot=(ot+Lt)/2,dt=(ut+Vt)/2;return Ot>dt?ut<Vt?ub(Ce,ct,kt,tt,ut,Lt,ot,et):ub(Ce,nt,tt,kt,Vt,ot,Lt,et):ot<Lt?ub(Ce,tt,ct,nt,ot,ut,Vt,et):ub(Ce,kt,nt,ct,Lt,Vt,ut,et),Math.max(Ot,dt)}(pe,n,e.aabb,i,s);let he=t.ad.fromQuat([],pe),ve=t.ad.multiply([],he,ee);t.ad.multiply(i,H,ve)}else te=n.elevation.getAtPointOrZero(new so(T.x/N,T.y/N),0);te!==0&&(i[14]+=te)}}function bg(i,e,n=!1){i.uploaded||(i.gfxTexture=new Ya(e,i.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:i.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),i.uploaded=!0,i.image=null)}function tF(i,e,n){i.indexBuffer=e.createIndexBuffer(i.indexArray,!1,!0),i.vertexBuffer=e.createVertexBuffer(i.vertexArray,qL.members,!1,!0),i.normalArray&&(i.normalBuffer=e.createVertexBuffer(i.normalArray,XL.members,!1,!0)),i.texcoordArray&&(i.texcoordBuffer=e.createVertexBuffer(i.texcoordArray,ZL.members,!1,!0)),i.colorArray&&(i.colorBuffer=e.createVertexBuffer(i.colorArray,(i.colorArray.bytesPerElement===12?$L:YL).members,!1,!0)),i.featureArray&&(i.pbrBuffer=e.createVertexBuffer(i.featureArray,KL.members,!0)),i.segments=Bn.simpleSegment(0,0,i.vertexArray.length,i.indexArray.length);let s=i.material;s.pbrMetallicRoughness.baseColorTexture&&bg(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&bg(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&bg(s.normalTexture,e),s.occlusionTexture&&bg(s.occlusionTexture,e,n),s.emissionTexture&&bg(s.emissionTexture,e)}function B1(i,e,n){if(i.meshes)for(let s of i.meshes)tF(s,e,n);if(i.children)for(let s of i.children)B1(s,e,n)}function pb(i){if(i.meshes)for(let e of i.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(i.children)for(let e of i.children)pb(e)}function N1(i){if(i.meshes)for(let n of i.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(i.children)for(let n of i.children)N1(n)}class iF{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class nF{constructor(){this.tasks={},this.taskQueue=[],Au(["process"],this),this.invoker=new iF(this.process),this.nextId=0}add(e,n){let s=this.nextId++,h=function({type:m,isSymbolTile:p,zoom:b}){return b=b||0,m==="message"?0:m!=="maybePrepare"||p?m!=="parseTile"||p?m==="parseTile"&&p?300-b:m==="maybePrepare"&&p?400-b:500:200-b:100-b}(n);if(h===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:n,priority:h,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let h=0;h<this.taskQueue.length;h++){let m=this.tasks[this.taskQueue[h]];m.priority<n&&(n=m.priority,e=h)}if(e===null)return null;let s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Uk{constructor(e,n,s){this.target=e,this.parent=n,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Au(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new nF}send(e,n,s,h,m=!1,p){let b=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=p,this.callbacks[b]=s);let y=new Set;return this.target.postMessage({id:b,type:e,hasCallback:!!s,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:we(n,y)},y),{cancel:()=>{s&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){let n=e.data,s=n.id;if(s&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let h=this.cancelCallbacks[s];delete this.cancelCallbacks[s],h&&h.cancel()}else if(n.mustQueue||jr()){let h=this.callbacks[s],m=this.scheduler.add(()=>this.processTask(s,n),h&&h.metadata||{type:"message"});m&&(this.cancelCallbacks[s]=m)}else this.processTask(s,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let s=this.callbacks[e];delete this.callbacks[e],s&&(n.error?s(Re(n.error)):s(null,Re(n.data)))}else{let s=new Set,h=n.hasCallback?(p,b)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?we(p):null,data:we(b,s)},s)}:p=>{},m=Re(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,m,h);else if(this.parent.getWorkerSource){let p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],m.source,m.scope)[p[1]](m,h)}else h(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let V1=(()=>{class i{constructor(n,s){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Eu();let h=this.workerPool.acquire(this.id);for(let m=0;m<h.length;m++){let p=new i.Actor(h[m],s,this.id);p.name=`Worker ${m}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,s,h){Pc(this.actors,(m,p)=>{m.send(n,s,p)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return i.Actor=Uk,i})();var yg={workerUrl:"",workerClass:null,workerParams:void 0};function rF(){return yg.workerClass!=null?new yg.workerClass:new self.Worker(yg.workerUrl,yg.workerParams)}let j1="mapboxgl_preloaded_worker_pool";class vg{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<vg.workerCount;)this.workers.push(new rF);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[j1]}numActive(){return Object.keys(this.active).length}}let xg;function fb(){return xg||(xg=new vg),xg}vg.workerCount=2;let gb,U1,Ms,Fm,W1,zm=null;function Wk(){return jr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:U1||I.DRACO_URL}function Hk(){if(jr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Fm)return Fm;let i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Fm=WebAssembly.validate(i)?I.MESHOPT_SIMD_URL:I.MESHOPT_URL,Fm}let _b={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},oF={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},wg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Gk(i,e,n){let s=n.json.bufferViews.length,h=n.buffers.length;e.bufferView=s,n.json.bufferViews[s]={buffer:h,byteLength:i.byteLength},n.buffers[h]=i}let H1="KHR_draco_mesh_compression";function aF(i,e){let n=i.extensions&&i.extensions[H1];if(!n)return;let s=new Ms.Decoder,h=Zk(e,n.bufferView),m=new Ms.Mesh;if(!s.DecodeArrayToMesh(h,h.byteLength,m))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[i.indices],b=_b[p.componentType],y=p.count*b.BYTES_PER_ELEMENT,w=Ms._malloc(y);b===Uint16Array?s.GetTrianglesUInt16Array(m,y,w):s.GetTrianglesUInt32Array(m,y,w),Gk(Ms.memory.buffer.slice(w,w+y),p,e),Ms._free(w);for(let M of Object.keys(n.attributes)){let T=s.GetAttributeByUniqueId(m,n.attributes[M]),E=e.json.accessors[i.attributes[M]],P=oF[E.componentType],R=E.count*wg[E.type]*_b[E.componentType].BYTES_PER_ELEMENT,F=Ms._malloc(R);s.GetAttributeDataArrayForAllPoints(m,T,Ms[P],R,F),Gk(Ms.memory.buffer.slice(F,F+R),E,e),Ms._free(F)}s.destroy(),m.destroy(),delete i.extensions[H1]}let bb="EXT_meshopt_compression";function sF(i,e){if(!i.extensions||!i.extensions[bb])return;let n=i.extensions[bb],s=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),h=new Uint8Array(n.count*n.byteStride);W1.decodeGltfBuffer(h,n.count,n.byteStride,s,n.mode,n.filter),i.buffer=e.buffers.length,i.byteOffset=0,e.buffers[i.buffer]=h.buffer,delete i.extensions[bb]}let qk=1179937895,$k=new TextDecoder("utf8");function Yk(i,e){return new URL(i,e).href}function lF(i,e,n,s){return fetch(Yk(i.uri,s)).then(h=>h.arrayBuffer()).then(h=>{e.buffers[n]=h})}function Zk(i,e){let n=i.json.bufferViews[e];return new Uint8Array(i.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function cF(i,e,n,s){if(i.uri){let h=Yk(i.uri,s);return fetch(h).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{e.images[n]=m})}if(i.bufferView!==void 0){let h=Zk(e,i.bufferView),m=new Blob([h],{type:i.mimeType});return createImageBitmap(m).then(p=>{e.images[n]=p})}}function Xk(i,e=0,n){let s={json:null,images:[],buffers:[]};if(new Uint32Array(i,e,1)[0]===qk){let M=new Uint32Array(i,e),T=2,E=(M[T++]>>2)-3,P=M[T++]>>2;if(T++,s.json=JSON.parse($k.decode(M.subarray(T,T+P))),T+=P,T<E){let R=M[T++];T++;let F=e+(T<<2);s.buffers[0]=i.slice(F,F+R)}}else s.json=JSON.parse($k.decode(new Uint8Array(i,e)));let{buffers:h,images:m,meshes:p,extensionsUsed:b,bufferViews:y}=s.json,w=Promise.resolve();if(h){let M=[];for(let T=0;T<h.length;T++){let E=h[T];E.uri?M.push(lF(E,s,T,n)):s.buffers[T]||(s.buffers[T]=null)}w=Promise.all(M)}return w.then(()=>{let M=[],T=b&&b.includes(H1),E=b&&b.includes(bb);if(T&&M.push(function(){if(!Ms)return gb||(gb=function(P){let R,F=null;function N(){R=new Uint8Array(F.buffer)}function H(){throw new Error("Unexpected Draco error.")}let J={a:{a:H,d:function(ee,te,pe){return R.copyWithin(ee,te,te+pe)},c:function(ee){let te=R.length,pe=Math.max(ee>>>0,Math.ceil(1.2*te)),he=Math.ceil((pe-te)/65536);try{return F.grow(he),N(),!0}catch{return!1}},b:H}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,J):P.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,J))).then(ee=>{let{Rb:te,Qb:pe,P:he,T:ve,X:Ce,Ja:Ae,La:Ue,Qa:ze,Va:Ye,Wa:rt,eb:qe,jb:et,f:We,e:tt,yb:ct,zb:nt,Ab:kt,Bb:ot,Db:ut,Gb:Vt}=ee.instance.exports;F=tt;let Lt=(()=>{let Ot=0,dt=0,jt=0,li=0;return Zt=>{jt&&(te(li),te(Ot),dt+=jt,jt=Ot=0),Ot||(dt+=128,Ot=pe(dt));let ui=Zt.length+7&-8,ci=Ot;ui>=dt&&(jt=ui,ci=li=pe(ui));for(let wi=0;wi<Zt.length;wi++)R[ci+wi]=Zt[wi];return ci}})();return N(),We(),{memory:tt,_free:te,_malloc:pe,Mesh:class{constructor(){this.ptr=he()}destroy(){ve(this.ptr)}},Decoder:class{constructor(){this.ptr=Ae()}destroy(){et(this.ptr)}DecodeArrayToMesh(Ot,dt,jt){let li=Lt(Ot),Zt=Ue(this.ptr,li,dt,jt.ptr);return!!Ce(Zt)}GetAttributeByUniqueId(Ot,dt){return{ptr:ze(this.ptr,Ot.ptr,dt)}}GetTrianglesUInt16Array(Ot,dt,jt){Ye(this.ptr,Ot.ptr,dt,jt)}GetTrianglesUInt32Array(Ot,dt,jt){rt(this.ptr,Ot.ptr,dt,jt)}GetAttributeDataArrayForAllPoints(Ot,dt,jt,li,Zt){qe(this.ptr,Ot.ptr,dt.ptr,jt,li,Zt)}},DT_INT8:ct(),DT_UINT8:nt(),DT_INT16:kt(),DT_UINT16:ot(),DT_UINT32:ut(),DT_FLOAT32:Vt()}})}(fetch(Wk())),gb.then(P=>{Ms=P,gb=void 0}))}()),E&&M.push(function(){if(W1)return;let P=function(R){let F,N=WebAssembly.instantiateStreaming(R,{}).then(ee=>{F=ee.instance,F.exports.__wasm_call_ctors()}),H={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},J={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:N,supported:!0,decodeGltfBuffer(ee,te,pe,he,ve,Ce){(function(Ae,Ue,ze,Ye,rt,qe,et){let We=Ae.exports.sbrk,tt=Ye+3&-4,ct=We(tt*rt),nt=We(qe.length),kt=new Uint8Array(Ae.exports.memory.buffer);kt.set(qe,nt);let ot=Ue(ct,Ye,rt,nt,qe.length);if(ot===0&&et&&et(ct,tt,rt),ze.set(kt.subarray(ct,ct+Ye*rt)),We(ct-We(0)),ot!==0)throw new Error(`Malformed buffer data: ${ot}`)})(F,F.exports[J[ve]],ee,te,pe,he,F.exports[H[Ce]])}}}(fetch(Hk()));return P.ready.then(()=>{W1=P})}()),m)for(let P=0;P<m.length;P++)M.push(cF(m[P],s,P,n));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(T&&p)for(let{primitives:P}of p)for(let R of P)aF(R,s);if(E&&p&&y)for(let P of y)sF(P,s);return s})})}function Zh(i,e){let n=i.json.bufferViews[e.bufferView],s=_b[e.componentType];return new s(i.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==wg[e.type]*s.BYTES_PER_ELEMENT?n.byteStride/s.BYTES_PER_ELEMENT:wg[e.type]))}function G1(i,e,n,s){let h=_b[e.componentType],m=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),p=i.json.bufferViews[e.bufferView],b=p.byteStride?p.byteStride/h.BYTES_PER_ELEMENT:wg[e.type],y=n.float32,w=y.length/n.capacity;for(let M=0,T=0;M<e.count*b;M+=b,T+=w)for(let E=0;E<w;E++)y[T+E]=s[M+E]*m;n._trim()}function dF(i,e,n){let s=i.indices,h=i.attributes,m={};m.indexArray=new Rr;let p=e.json.accessors[s],b=p.count/3;m.indexArray.reserve(b);let y=Zh(e,p);for(let E=0;E<b;E++)m.indexArray.emplaceBack(y[3*E],y[3*E+1],y[3*E+2]);m.indexArray._trim(),m.vertexArray=new rd;let w=e.json.accessors[h.POSITION];m.vertexArray.reserve(w.count);let M=Zh(e,w);for(let E=0;E<w.count;E++)m.vertexArray.emplaceBack(M[3*E],M[3*E+1],M[3*E+2]);if(m.vertexArray._trim(),m.aabb=new Nn(w.min,w.max),m.centroid=function(E,P){let R=[0,0,0],F=E.length;if(F>0){for(let N=0;N<F;N++){let H=3*E[N];R[0]+=P[H],R[1]+=P[H+1],R[2]+=P[H+2]}R[0]/=F,R[1]/=F,R[2]/=F}return R}(y,M),h.COLOR_0!==void 0){let E=e.json.accessors[h.COLOR_0],P=wg[E.type],R=Zh(e,E);m.colorArray=P===3?new rd:new nd,m.colorArray.resize(E.count),G1(e,E,m.colorArray,R)}if(h.NORMAL!==void 0){m.normalArray=new rd;let E=e.json.accessors[h.NORMAL];m.normalArray.resize(E.count);let P=Zh(e,E);G1(e,E,m.normalArray,P)}if(h.TEXCOORD_0!==void 0&&n.length>0){m.texcoordArray=new mm;let E=e.json.accessors[h.TEXCOORD_0];m.texcoordArray.resize(E.count);let P=Zh(e,E);G1(e,E,m.texcoordArray,P)}if(h._FEATURE_ID_RGBA4444!==void 0){let E=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Zh(e,E))}h._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Zh(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));let T=i.material;return m.material=function(E,P){let{emissiveFactor:R=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:N=.5,normalTexture:H,occlusionTexture:J,emissiveTexture:ee,doubleSided:te}=E,{baseColorFactor:pe=[1,1,1,1],metallicFactor:he=1,roughnessFactor:ve=1,baseColorTexture:Ce,metallicRoughnessTexture:Ae}=E.pbrMetallicRoughness||{},Ue=J?P[J.index]:void 0;if(J&&J.extensions&&J.extensions.KHR_texture_transform&&Ue){let ze=J.extensions.KHR_texture_transform;Ue.offsetScale=[ze.offset[0],ze.offset[1],ze.scale[0],ze.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ni(...pe),metallicFactor:he,roughnessFactor:ve,baseColorTexture:Ce?P[Ce.index]:void 0,metallicRoughnessTexture:Ae?P[Ae.index]:void 0},doubleSided:te,emissiveFactor:R,alphaMode:F,alphaCutoff:N,normalTexture:H?P[H.index]:void 0,occlusionTexture:Ue,emissionTexture:ee?P[ee.index]:void 0,defined:E.defined===void 0}}(T!==void 0?e.json.materials[T]:{defined:!1},n),m}function Qk(i,e,n){let{matrix:s,rotation:h,translation:m,scale:p,mesh:b,extras:y,children:w}=i,M={};if(M.matrix=s||t.ad.fromRotationTranslationScale([],h||[0,0,0,1],m||[0,0,0],p||[1,1,1]),b!==void 0){M.meshes=n[b];let T=M.anchor=[0,0];for(let E of M.meshes){let{min:P,max:R}=E.aabb;T[0]+=P[0]+R[0],T[1]+=P[1]+R[1]}T[0]=Math.floor(T[0]/M.meshes.length/2),T[1]=Math.floor(T[1]/M.meshes.length/2)}if(y&&(y.id&&(M.id=y.id),y.lights&&(M.lights=function(T){if(!T.length)return[];let E=function(H){let J=atob(H),ee=new Uint8Array(J.length);for(let te=0;te<J.length;te++)ee[te]=J.codePointAt(te);return ee}(T),P=[],R=E.length/24,F=new Uint16Array(E.buffer),N=new Float32Array(E.buffer);for(let H=0;H<R;H++){let J=F[2*H*6]/30,ee=F[2*H*6+1]/30,te=F[2*H*6+10]/100,pe=N[6*H+1],he=N[6*H+2],ve=N[6*H+3],Ce=N[6*H+4],Ae=ve-pe,Ue=Ce-he,ze=Math.hypot(Ae,Ue);P.push({pos:[pe+.5*Ae,he+.5*Ue,ee],normal:[Ue/ze,-Ae/ze,0],width:ze,height:J,depth:te,points:[pe,he,ve,Ce]})}return P}(y.lights))),w){let T=[];for(let E of w)T.push(Qk(e.json.nodes[E],e,n));M.children=T}return M}function hF(i){if(i.vertices.length===0||i.indices.length===0)return null;let e=new s1(i.vertices,i.indices,8,256),[n,s]=[e.min.clone(),e.max.clone()];return{vertices:i.vertices,indices:i.indices,grid:e,min:n,max:s}}function uF(i){if(!i.extras||!i.extras.ground)return null;let e=i.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let s=[];for(let p of n){if(!Array.isArray(p)||p.length!==2)continue;let b=p[0],y=p[1];typeof b=="number"&&typeof y=="number"&&s.push(new wt(b,y))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let h=0;for(let p=0;p<s.length;p++){let b=s[p],y=s[(p+1)%s.length],w=s[(p+2)%s.length];h+=(b.x-y.x)*(w.y-y.y)-(w.x-y.x)*(b.y-y.y)}h>0&&s.reverse();let m=Jf(s.flatMap(p=>[p.x,p.y]),[]);return m.length===0?null:{vertices:s,indices:m}}function mF(i,e){let n=[],s=[],h=0,m=[];for(let p of i){h=n.length;let b=p.vertexArray.float32,y=p.indexArray.uint16;for(let w=0;w<p.vertexArray.length;w++)m[0]=b[3*w+0],m[1]=b[3*w+1],m[2]=b[3*w+2],t._.transformMat4(m,m,e),n.push(new wt(m[0],m[1]));for(let w=0;w<3*p.indexArray.length;w++)s.push(y[w]+h)}if(s.length%3!=0)return null;for(let p=0;p<s.length;p+=3){let b=n[s[p+0]],y=n[s[p+1]],w=n[s[p+2]];(b.x-y.x)*(w.y-y.y)-(w.x-y.x)*(b.y-y.y)>0&&([s[p+1],s[p+2]]=[s[p+2],s[p+1]])}return{vertices:n,indices:s}}function Kk(i){let e=function(y,w){let M=[],T=WebGL2RenderingContext;if(y.json.textures)for(let E of y.json.textures){let P={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};E.sampler!==void 0&&Object.assign(P,y.json.samplers[E.sampler]),M.push({image:w[E.source],sampler:P,uploaded:!1})}return M}(i,i.images),n=function(y,w){let M=[];for(let T of y.json.meshes){let E=[];for(let P of T.primitives)E.push(dF(P,y,w));M.push(E)}return M}(i,e),{scenes:s,scene:h,nodes:m}=i.json,p=s?s[h||0].nodes:m,b=[];for(let y of p)b.push(Qk(m[y],i,n));return function(y,w,M){let T={},E=new Set;for(let P=0;P<y.length;P++){let R=M[w[P]];if(!R.extras)continue;let F=R.extras["mapbox:footprint:version"],N=R.extras["mapbox:footprint:id"];(F||N)&&E.add(P),F==="1.0.0"&&N&&(T[N]=P)}for(let P=0;P<y.length;P++){if(E.has(P))continue;let R=y[P],F=M[w[P]];if(!F.extras)continue;let N=null;R.id in T&&(N=mF(y[T[R.id]].meshes,R.matrix)),N||(N=uF(F)),N&&(R.footprint=hF(N))}if(E.size>0){let P=Array.from(E.values()).sort((R,F)=>R-F);for(let R=P.length-1;R>=0;R--)y.splice(P[R],1)}}(b,p,i.json.nodes),b}function pF(i){i.heightmap=new Float32Array(4096),i.heightmap.fill(-1);let e=i.vertexArray.float32,n=i.aabb.min[0]-1,s=i.aabb.min[1]-1,h=Yh/(i.aabb.max[0]-n+2),m=Yh/(i.aabb.max[1]-s+2);for(let p=0;p<e.length;p+=3){let b=e[p+2],y=(e[p+0]-n)*h|0,w=(e[p+1]-s)*m|0;b>i.heightmap[w*Yh+y]&&(i.heightmap[w*Yh+y]=b)}}function fF(i,e){let n={};n.indexArray=new Rr,n.indexArray.reserve(4*i.length),n.vertexArray=new rd,n.vertexArray.reserve(10*i.length),n.colorArray=new nd,n.vertexArray.reserve(10*i.length);let s=0;for(let p of i){let b=Math.min(10,Math.max(4,1.3*p.height))*e,y=[-p.normal[1],p.normal[0],0],w=Math.min(.29,.1*p.width/p.depth),M=p.width-2*p.depth*e*(w+.01),T=t._.scaleAndAdd([],p.pos,y,M/2),E=t._.scaleAndAdd([],p.pos,y,-M/2),P=[T[0],T[1],T[2]+p.height],R=[E[0],E[1],E[2]+p.height],F=t._.scaleAndAdd([],p.normal,y,w);t._.scale(F,F,b);let N=t._.scaleAndAdd([],p.normal,y,-w);t._.scale(N,N,b),t._.add(F,T,F),t._.add(N,E,N),T[2]+=.1,E[2]+=.1,n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(N[0],N[1],N[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(N[0],N[1],N[2]);let H=M/b/2;n.colorArray.emplaceBack(-H-w,-1,H,.8),n.colorArray.emplaceBack(H+w,-1,H,.8),n.colorArray.emplaceBack(-H,0,H,1.3),n.colorArray.emplaceBack(H,0,H,1.3),n.colorArray.emplaceBack(H+w,-.8,H,.7),n.colorArray.emplaceBack(H+w,-.8,H,.7),n.colorArray.emplaceBack(0,0,H,1.3),n.colorArray.emplaceBack(0,0,H,1.3),n.colorArray.emplaceBack(H+w,-1.2,H,.8),n.colorArray.emplaceBack(H+w,-1.2,H,.8),n.indexArray.emplaceBack(6+s,4+s,8+s),n.indexArray.emplaceBack(7+s,9+s,5+s),n.indexArray.emplaceBack(0+s,1+s,2+s),n.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}let h={defined:!0,emissiveFactor:[0,0,0]},m={};return m.baseColorFactor=Ni.white,h.pbrMetallicRoughness=m,n.material=h,n.aabb=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}let q1=new Float32Array(262144),Xh=new Uint8Array(262144);function Jk(i){let e=0;if(i.meshes)for(let n of i.meshes)e=Math.max(e,n.aabb.max[2]);if(i.children)for(let n of i.children)e=Math.max(e,Jk(n));return e}function eI(i,e,n){if(i.meshes)for(let s of i.meshes)s.aabb.min[0]!==1/0&&n.insert(e,s.aabb.min[0],s.aabb.min[1],s.aabb.max[0],s.aabb.max[1]);if(i.children)for(let s of i.children)eI(s,e,n)}let tI=["","wall","door","roof","window","lamp","logo"];class iI{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Jk(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=Nn.applyTransform(s.aabb,this.node.matrix),n.encapsulate(s.transformedAabb)),e++;this.aabb=n}return this.aabb}}class yb{constructor(e,n,s,h,m,p){this.id=n,this.modelTraits|=Lm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,s&&(this.modelTraits|=Lm.HasMapboxMeshFeatures),h&&(this.modelTraits|=Lm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let b of e)this.nodesInfo.push(new iI(b)),eI(b,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(let s of this.getNodesInfo()){let h=s.node;h.footprint&&n.push({footprint:h.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let s of n){let h=s.node;this.uploaded?this.updatePbrBuffer(h):B1(h,e,!0)}for(let s of n)pb(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),n=!0);return n}needsReEvaluation(e,n,s){let h=e.transform.projectionOptions,m=e.style.getBrightness(),p=this.brightness!==m;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||Cg(s.paint.get("model-color").value,p)||Cg(s.paint.get("model-color-mix-intensity").value,p)||Cg(s.paint.get("model-roughness").value,p)||Cg(s.paint.get("model-emissive-strength").value,p)||Cg(s.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=h,this.brightness=m,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let s=this.getNodesInfo(),h=this.id.canonical;for(let m of s){let p=m.feature;m.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},h)}}evaluate(e){let n=this.getNodesInfo();for(let s of n){if(!s.node.meshes)continue;let h=s.feature,m=s.node.meshes&&s.node.meshes[0].featureData,p=s.evaluatedColor[2],b=s.evaluatedRMEA[2],y=this.id.canonical;if(s.hasTranslucentParts=!1,m){for(let w=0;w<tI.length;w++){let M=tI[w];M.length&&(h.properties.part=M);let T=e.paint.get("model-color").evaluate(h,{},y).toRenderColor(null),E=e.paint.get("model-color-mix-intensity").evaluate(h,{},y);s.evaluatedColor[w]=[T.r,T.g,T.b,E],s.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(h,{},y),s.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(h,{},y),s.evaluatedRMEA[w][3]=T.a,s.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},y),!s.hasTranslucentParts&&T.a<1&&(s.hasTranslucentParts=!0)}delete h.properties.part,_F(s,p!==s.evaluatedColor[2]||b!==s.evaluatedRMEA[2],this.modelTraits)}else s.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(h,{},y);s.evaluatedScale=e.paint.get("model-scale").evaluate(h,{},y),this.updatePbrBuffer(s.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,s,h){let m=e.findDEMTileFor(s);if(m&&(m.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;let p=wm.create(e,s,m);if(!p)return;this.modelTraits&Lm.HasMapboxMeshFeatures&&this.updateDEM(e,p,s,h);for(let b of this.getNodesInfo()){let y=b.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let w=y.footprint.vertices,M=p.getElevationAt(w[0].x,w[0].y,!0,!0);for(let T=1;T<w.length;T++)M=Math.min(M,p.getElevationAt(w[T].x,w[T].y,!0,!0));y.elevation=M}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,s,h){let m=n._dem._modifiedForSources[h];if(m===void 0&&(n._dem._modifiedForSources[h]=[],m=n._dem._modifiedForSources[h]),m.includes(s.canonical))return;let p=n._dem.dim;m.push(s.canonical);let b=!1;for(let y of this.getNodesInfo()){let w=y.node;if(!w.footprint||!w.footprint.grid)continue;let M=w.footprint.grid,T=n.tileCoordToPixel(M.min.x,M.min.y),E=n.tileCoordToPixel(M.max.x,M.max.y),P=Math.min(Math.min(p-E.y,T.x),Math.min(T.y,p-E.x));if(P<0)continue;let R=gi(P,2,5),F=Math.max(0,T.x-R),N=Math.max(0,T.y-R),H=Math.min(E.x+R,p-1),J=Math.min(E.y+R,p-1);for(let he=N;he<=J;++he)for(let ve=F;ve<=H;++ve)Xh[he*p+ve]=255;let ee=0,te=0;for(let he=0;he<M.cellsY;++he)for(let ve=0;ve<M.cellsX;++ve){if(!M.cells[he*M.cellsX+ve])continue;let Ce=n.tileCoordToPixel(M.min.x+ve/M.xScale,M.min.y+he/M.yScale),Ae=n.tileCoordToPixel(M.min.x+(ve+1)/M.xScale,M.min.y+(he+1)/M.yScale);for(let Ue=Ce.y;Ue<=Math.min(Ae.y+1,p-1);++Ue)for(let ze=Ce.x;ze<=Math.min(Ae.x+1,p-1);++ze)Xh[Ue*p+ze]===255&&(Xh[Ue*p+ze]=0,ee+=n.getElevationAtPixel(ze,Ue),te++)}let pe=ee/te;F=Math.max(1,T.x-R),N=Math.max(1,T.y-R),H=Math.min(E.x+R,p-2),J=Math.min(E.y+R,p-2),b=!0;for(let he=N;he<=J;++he)for(let ve=F;ve<=H;++ve)Xh[he*p+ve]===0&&(q1[he*p+ve]=n._dem.set(ve,he,pe));for(let he=1;he<R;++he){F=Math.max(1,T.x-he),N=Math.max(1,T.y-he),H=Math.min(E.x+he,p-2),J=Math.min(E.y+he,p-2);for(let ve=N;ve<=J;++ve)for(let Ce=F;Ce<=H;++Ce){let Ae=ve*p+Ce;if(Xh[Ae]===255){let Ue=0,ze=0,Ye=-1,rt=-1;for(let qe=-1;qe<=1;++qe)for(let et=-1;et<=1;++et){let We=(ve+qe)*p+Ce+et;if(Xh[We]>=he)continue;let tt=q1[We],ct=Math.abs(tt);ct>ze&&(Ue=tt,ze=ct,Ye=et,rt=qe)}if(ze>.1){let qe=1-(he+.5*Math.abs(Ye*rt))/R,et=n._dem.get(Ce,ve)+Ue*qe,We=n._dem.get(Ce+Ye,ve+rt),tt=n._dem.get(Ce-Ye,ve-rt,!0);(et-We)*(et-tt)>0&&(et=(We+tt)/2),q1[Ae]=n._dem.set(Ce,ve,et),Xh[Ae]=he}}}}}b&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Ur.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)pb(n.node),N1(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let s=n.getReplacementRegionsForTile(e.toUnwrapped()),h=this.getNodesInfo();for(let m=0;m<this.nodesInfo.length;m++){let p=h[m].node;h[m].hiddenByReplacement=!!p.footprint&&!s.find(b=>b.footprint===p.footprint)}}getHeightAtTileCoord(e,n){let s=this.getNodesInfo(),h=[],m=[0,0,0],p=t.ad.identity([]);for(let b=0;b<this.nodesInfo.length;b++){let y=s[b],w=y.node.meshes[0],M=w.transformedAabb;if(e<M.min[0]||n<M.min[1]||e>M.max[0]||n>M.max[1])continue;if(y.node.hidden===!0)return{height:0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};t.ad.invert(p,y.node.matrix),m[0]=e,m[1]=n,t._.transformMat4(m,m,p);let T=(m[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*Yh|0,E=Math.min(63,(m[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*Yh|0)*Yh+Math.min(63,T),P=w.heightmap[E];if(!(P<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:P,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new wt(e,n),new wt(e,n),h),h.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function Cg(i,e){return!i.isLightConstant&&e}function gF(i,e,n,s,h,m,p,b){let y=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;n[3]>0&&(y=Ht(y,255*n[0],n[3]),w=Ht(w,255*n[1],n[3]),M=Ht(M,255*n[2],n[3]));let T=y<<8|w,E=M<<8|Math.floor(255*s[3]),P=function(he){let ve=gi(he,0,2);return Math.min(Math.round(.5*ve*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],R=gi(h[0],0,1),F=gi(h[1],0,1),N=gi(h[2],0,1),H=gi(h[3],0,1),J,ee,te,pe;if(R!==F&&p!==m&&F!==R){let he=p-m;ee=1/(he*(F-R)),te=-(m+he*R)/(he*(F-R));let ve=gi(h[4],-1,1);pe=Math.pow(10,ve),J=255*N<<8|255*H}else J=65535,ee=0,te=1,pe=1;if(i.emplaceBack(T,E,P,J,ee,te,pe),b){let he=b.length;b.clear();for(let ve=0;ve<he;ve++)b.emplaceBack(T,E,P,J,ee,te,pe)}}function _F(i,e,n){let s=i.node,h=0,m=n&Lm.HasMeshoptCompression;for(let p of s.meshes){if(s.lights&&s.lightMeshIndex===h||!p.featureData)continue;p.featureArray=new y0,p.featureArray.reserve(p.featureData.length);let b=e;for(let y of p.featureData){let w=m?65535&y:y>>16&65535,M=m?y>>16&65535:65535&y,T=(15&M)<8?15&M:0,E=i.evaluatedRMEA[T],P=i.evaluatedColor[T],R=i.emissionHeightBasedParams[T],F;if(b&&T===2&&s.lights&&(F=new y0,F.resize(10*s.lights.length)),gF(p.featureArray,w,P,E,R,p.aabb.min[2],p.aabb.max[2],F),F&&b){b=!1;let N=s.meshes[s.lightMeshIndex];N.featureArray=F,N.featureArray._trim()}}p.featureArray._trim(),h++}}function nI(i,e,n,s){let h=1<<i.z;e.lat=Gr((s/pt+i.y)/h),e.lng=Wo((n/pt+i.x)/h)}ne(yb,"Tiled3dModelBucket",{omit:["layers"]}),ne(iI,"Tiled3dModelFeature");let bF={circle:class extends Sr{constructor(i,e,n,s){super(i,rR,e,n,s)}createBucket(i){return new Wx(i)}queryRadius(i){let e=i;return ym("circle-radius",this,e)+ym("circle-stroke-width",this,e)+M0(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,n,s,h,m,p,b){let y=pS(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return ES(i,s,m,p,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(i,e,n){let s=TS(this);return{config:new Vh(this,{zoom:e,lut:n}),defines:s,overrideFog:!1}}},heatmap:class extends Sr{createBucket(i){return new AS(i)}constructor(i,e,n,s){super(i,fR,e,n,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Kf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return ym("heatmap-radius",this,i)}queryIntersectsFeature(i,e,n,s,h,m,p,b){let y=this.paint.get("heatmap-radius").evaluate(e,n);return ES(i,s,m,p,b,!0,!0,new wt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(i,e,n){return i==="heatmap"?{config:new Vh(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Sr{constructor(i,e,n,s){super(i,_R,e,n,s)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(i,e,n){return{overrideFog:!1}}},fill:class extends Sr{constructor(i,e,n,s){super(i,AR,e,n,s)}getProgramIds(){let i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(i,e,n){return{config:new Vh(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(i,e){super.recalculate(i,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new R0(i)}queryRadius(){return M0(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,n,s,h,m){return!i.queryGeometry.isAboveHorizon&&cS(mS(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Sr{constructor(i,e,n,s){super(i,s3,e,n,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new j0(i)}queryRadius(){return M0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(i,e,n,s,h,m,p,b,y){let w=pS(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,n),T=this.paint.get("fill-extrusion-base").evaluate(e,n),E=[0,0],P=b&&m.elevation,R=m.elevation?m.elevation.exaggeration():1,F=i.tile.getBucket(this);if(P&&F instanceof j0){let te=F.centroidVertexArray,pe=y+1;pe<te.length&&(E[0]=te.geta_centroid_pos0(pe),E[1]=te.geta_centroid_pos1(pe))}if(E[0]===0&&E[1]===1)return!1;m.projection.name==="globe"&&(s=bM([s],[new wt(0,0),new wt(pt,pt)],i.tileID.canonical).map(te=>te.polygon).flat());let N=P?b:null,[H,J]=function(te,pe,he,ve,Ce,Ae,Ue,ze,Ye,rt,qe){return te.projection.name==="globe"?function(et,We,tt,ct,nt,kt,ot,ut,Vt,Lt,Ot){let dt=[],jt=[],li=et.projection.upVectorScale(Ot,et.center.lat,et.worldSize).metersToTile,Zt=[0,0,0,1],ui=[0,0,0,1],ci=(qt,sn,an,Ui)=>{qt[0]=sn,qt[1]=an,qt[2]=Ui,qt[3]=1},wi=_M();tt>0&&(tt+=wi),ct+=wi;for(let qt of We){let sn=[],an=[];for(let Ui of qt){let Oi=Ui.x+nt.x,Wi=Ui.y+nt.y,xn=et.projection.projectTilePoint(Oi,Wi,Ot),fn=et.projection.upVector(Ot,Ui.x,Ui.y),Gn=tt,Vn=ct;if(ot){let lo=vM(Oi,Wi,tt,ct,ot,ut,Vt,Lt);Gn+=lo.base,Vn+=lo.top}tt!==0?ci(Zt,xn.x+fn[0]*li*Gn,xn.y+fn[1]*li*Gn,xn.z+fn[2]*li*Gn):ci(Zt,xn.x,xn.y,xn.z),ci(ui,xn.x+fn[0]*li*Vn,xn.y+fn[1]*li*Vn,xn.z+fn[2]*li*Vn),t._.transformMat4(Zt,Zt,kt),t._.transformMat4(ui,ui,kt),sn.push(new Gh(Zt[0],Zt[1],Zt[2])),an.push(new Gh(ui[0],ui[1],ui[2]))}dt.push(sn),jt.push(an)}return[dt,jt]}(te,pe,he,ve,Ce,Ae,Ue,ze,Ye,rt,qe):Ue?function(et,We,tt,ct,nt,kt,ot,ut,Vt){let Lt=[],Ot=[],dt=[0,0,0,1];for(let jt of et){let li=[],Zt=[];for(let ui of jt){let ci=ui.x+ct.x,wi=ui.y+ct.y,qt=vM(ci,wi,We,tt,kt,ot,ut,Vt);dt[0]=ci,dt[1]=wi,dt[2]=qt.base,dt[3]=1,t.aA.transformMat4(dt,dt,nt),dt[3]=Math.max(dt[3],1e-5);let sn=new Gh(dt[0]/dt[3],dt[1]/dt[3],dt[2]/dt[3]);dt[0]=ci,dt[1]=wi,dt[2]=qt.top,dt[3]=1,t.aA.transformMat4(dt,dt,nt),dt[3]=Math.max(dt[3],1e-5);let an=new Gh(dt[0]/dt[3],dt[1]/dt[3],dt[2]/dt[3]);li.push(sn),Zt.push(an)}Lt.push(li),Ot.push(Zt)}return[Lt,Ot]}(pe,he,ve,Ce,Ae,Ue,ze,Ye,rt):function(et,We,tt,ct,nt){let kt=[],ot=[],ut=nt[8]*We,Vt=nt[9]*We,Lt=nt[10]*We,Ot=nt[11]*We,dt=nt[8]*tt,jt=nt[9]*tt,li=nt[10]*tt,Zt=nt[11]*tt;for(let ui of et){let ci=[],wi=[];for(let qt of ui){let sn=qt.x+ct.x,an=qt.y+ct.y,Ui=nt[0]*sn+nt[4]*an+nt[12],Oi=nt[1]*sn+nt[5]*an+nt[13],Wi=nt[2]*sn+nt[6]*an+nt[14],xn=nt[3]*sn+nt[7]*an+nt[15],fn=Ui+ut,Gn=Oi+Vt,Vn=Wi+Lt,lo=Math.max(xn+Ot,1e-5),er=Ui+dt,Rn=Oi+jt,vr=Wi+li,qr=Math.max(xn+Zt,1e-5);ci.push(new Gh(fn/lo,Gn/lo,Vn/lo)),wi.push(new Gh(er/qr,Rn/qr,vr/qr))}kt.push(ci),ot.push(wi)}return[kt,ot]}(pe,he,ve,Ce,Ae)}(m,s,T,M,w,p,N,E,R,m.center.lat,i.tileID.canonical),ee=i.queryGeometry;return function(te,pe,he){let ve=1/0;cS(he,pe)&&(ve=yM(he,pe[0]));for(let Ce=0;Ce<pe.length;Ce++){let Ae=pe[Ce],Ue=te[Ce];for(let ze=0;ze<Ae.length-1;ze++){let Ye=Ae[ze],rt=[Ye,Ae[ze+1],Ue[ze+1],Ue[ze],Ye];Hx(he,rt)&&(ve=Math.min(ve,yM(he,rt)))}}return ve!==1/0&&ve}(H,J,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends Sr{constructor(i,e,n,s){super(i,W0,e,n,s),W0.layout&&(this.layout=new on(W0.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Oh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Mk.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new U0(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(i,e,n){let s=TM(this);return{config:new Vh(this,{zoom:e,lut:n}),defines:s,overrideFog:!1}}queryRadius(i){let e=i,n=kk(ym("line-width",this,e),ym("line-gap-width",this,e)),s=ym("line-offset",this,e);return n/2+Math.abs(s)+M0(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,n,s,h,m){if(i.queryGeometry.isAboveHorizon)return!1;let p=mS(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),b=i.pixelToTileUnitsFactor/2*kk(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(s=function(w,M){let T=[],E=new wt(0,0);for(let P=0;P<w.length;P++){let R=w[P],F=[];for(let N=0;N<R.length;N++){let H=R[N],J=R[N+1],ee=N===0?E:H.sub(R[N-1])._unit()._perp(),te=N===R.length-1?E:J.sub(H)._unit()._perp(),pe=ee._add(te)._unit();pe._mult(1/(pe.x*te.x+pe.y*te.y)),F.push(pe._mult(M)._add(H))}T.push(F)}return T}(s,y*i.pixelToTileUnitsFactor)),function(w,M,T){for(let E=0;E<M.length;E++){let P=M[E];if(w.length>=3){for(let R=0;R<P.length;R++)if(dd(w,P[R]))return!0}if(eR(w,P,T))return!0}return!1}(p,s,b)}isTileClipped(){return!0}isDraped(i){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:lb,background:class extends Sr{constructor(i,e,n,s){super(i,FL,e,n,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(i,e,n){return{overrideFog:!1}}},raster:Dk,"raster-particle":Ak,sky:class extends Sr{constructor(i,e,n,s){super(i,HL,e,n,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Kf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){let s=this.paint.get("sky-atmosphere-sun"),h=!s,m=i.style.light,p=m.properties.get("position");return h&&m.properties.get("anchor")==="viewport"&&sr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?L1(p.azimuthal,90-p.polar,e):L1(s[0],90-s[1],e)}let n=this.paint.get("sky-gradient-center");return L1(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}},slot:class extends Sr{constructor(i,e,n,s){super(i,GL,e,null)}},model:class extends Sr{constructor(i,e,n,s){super(i,eF,e,n,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new z1(i)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(i){return i instanceof yb?pt-1:0}queryIntersectsFeature(i,e,n,s,h,m){if(!this.modelManager)return!1;let p=this.modelManager,b=i.tile.getBucket(this);if(!(b&&b instanceof z1))return!1;let y=b;for(let w in y.instancesPerModel){let M=y.instancesPerModel[w],T=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty(T)){let E=M.features[M.idToFeaturesIndex[T]],P=p.getModel(w,this.scope);if(!P)return!1;let R=t.ad.create(),F=new zi(0,0),N=y.canonical,H=Number.MAX_VALUE;for(let J=0;J<E.instancedDataCount;++J){let ee=16*(E.instancedDataOffset+J),te=M.instancedDataArray.float32,pe=[te[ee+4],te[ee+5],te[ee+6]];nI(N,F,te[ee],0|te[ee+1]),jk(R,P,m,F,E.rotation,E.scale,pe,!1,!1,!1),m.projection.name==="globe"&&(R=F1(R,m));let he=t.ad.multiply([],m.projMatrix,R),ve=i.queryGeometry,Ce=zk(ve.isPointQuery()?ve.screenBounds:ve.screenGeometry,m,he,P.aabb);Ce!=null&&(H=Math.min(Ce,H))}return H!==Number.MAX_VALUE&&H}}return!1}_handleOverridablePaintPropertyUpdate(i,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||i!=="model-color"&&i!=="model-color-mix-intensity"&&i!=="model-rotation"&&i!=="model-scale"&&i!=="model-translation"&&i!=="model-emissive-strength")}_isPropertyZoomDependent(i){let e=this._transitionablePaint._values[i];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Y}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(i,e,n,s){let h=i.tile,m=h.getBucket(this),p=null,b=Number.MAX_VALUE;if(!(m&&m instanceof yb))return{queryFeature:p,intersectionZ:b};let y=m.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!n.filter(new Kt(h.tileID.overscaledZ),y.feature,h.tileID.canonical))return{queryFeature:p,intersectionZ:b};let w=y.node,M=s.calculatePosMatrix(h.tileID.toUnwrapped(),s.worldSize),T=y.evaluatedScale,E=0;s.elevation&&w.elevation&&(E=w.elevation*s.elevation.exaggeration()),t.ad.translate(M,M,[(w.anchor?w.anchor[0]:0)*(T[0]-1),(w.anchor?w.anchor[1]:0)*(T[1]-1),E]),t.ad.scale(M,M,T),t.ad.multiply(M,M,w.matrix);let P=i.queryGeometry,R=P.isPointQuery()?P.screenBounds:P.screenGeometry,F=function(H){let J=t.ad.multiply([],M,H.matrix),ee=t.ad.multiply(J,s.expandedFarZProjMatrix,J);for(let te=0;te<H.meshes.length;++te){let pe=H.meshes[te];if(te===H.lightMeshIndex)continue;let he=zk(R,s,ee,pe.aabb);he!=null&&(b=Math.min(he,b))}if(H.children)for(let te of H.children)F(te)};if(F(w),b===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:b};let N=new zi(0,0);return nI(h.tileID.canonical,N,y.node.anchor[0],y.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[N.lng,N.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:b}}},clip:class extends Sr{constructor(i,e,n,s){super(i,OR,e,n,s)}recalculate(i,e){super.recalculate(i,e)}createBucket(i){return new NS(i)}isTileClipped(){return!0}is3D(){return!0}}};ne(wk,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let rI=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,s]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let h=s>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);let m=rI[15&s];if(!m)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new $1(b,p,m,e)}constructor(e,n=64,s=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let m=rI.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${s}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+b+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=n,s}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Y1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,s,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:p,nodeSize:b}=this,y=[0,m.length-1,0],w=[];for(;y.length;){let M=y.pop()||0,T=y.pop()||0,E=y.pop()||0;if(T-E<=b){for(let N=E;N<=T;N++){let H=p[2*N],J=p[2*N+1];H>=e&&H<=s&&J>=n&&J<=h&&w.push(m[N])}continue}let P=E+T>>1,R=p[2*P],F=p[2*P+1];R>=e&&R<=s&&F>=n&&F<=h&&w.push(m[P]),(M===0?e<=R:n<=F)&&(y.push(E),y.push(P-1),y.push(1-M)),(M===0?s>=R:h>=F)&&(y.push(P+1),y.push(T),y.push(1-M))}return w}within(e,n,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:h,coords:m,nodeSize:p}=this,b=[0,h.length-1,0],y=[],w=s*s;for(;b.length;){let M=b.pop()||0,T=b.pop()||0,E=b.pop()||0;if(T-E<=p){for(let N=E;N<=T;N++)aI(m[2*N],m[2*N+1],e,n)<=w&&y.push(h[N]);continue}let P=E+T>>1,R=m[2*P],F=m[2*P+1];aI(R,F,e,n)<=w&&y.push(h[P]),(M===0?e-s<=R:n-s<=F)&&(b.push(E),b.push(P-1),b.push(1-M)),(M===0?e+s>=R:n+s>=F)&&(b.push(P+1),b.push(T),b.push(1-M))}return y}}function Y1(i,e,n,s,h,m){if(h-s<=n)return;let p=s+h>>1;oI(i,e,p,s,h,m),Y1(i,e,n,s,p-1,1-m),Y1(i,e,n,p+1,h,1-m)}function oI(i,e,n,s,h,m){for(;h>s;){if(h-s>600){let w=h-s+1,M=n-s+1,T=Math.log(w),E=.5*Math.exp(2*T/3),P=.5*Math.sqrt(T*E*(w-E)/w)*(M-w/2<0?-1:1);oI(i,e,n,Math.max(s,Math.floor(n-M*E/w+P)),Math.min(h,Math.floor(n+(w-M)*E/w+P)),m)}let p=e[2*n+m],b=s,y=h;for(Sg(i,e,s,n),e[2*h+m]>p&&Sg(i,e,s,h);b<y;){for(Sg(i,e,b,y),b++,y--;e[2*b+m]<p;)b++;for(;e[2*y+m]>p;)y--}e[2*s+m]===p?Sg(i,e,s,y):(y++,Sg(i,e,y,h)),y<=n&&(s=y+1),n<=y&&(h=y-1)}}function Sg(i,e,n,s){Z1(i,n,s),Z1(e,2*n,2*s),Z1(e,2*n+1,2*s+1)}function Z1(i,e,n){let s=i[e];i[e]=i[n],i[n]=s}function aI(i,e,n,s){let h=i-n,m=e-s;return h*h+m*m}t.$=Ml,t.A=Dh,t.B=Ks,t.C=Ni,t.D=oo,t.E=Al,t.G=ao,t.H=u,t.I=dL,t.J=px,t.K=function(i){let e=i.value,n=[];if(!e)return n;let s=Ol(e);return s!=="string"?(n=n.concat([new mb(i.key,e,`string expected, "${s}" found`)]),n):(Bk(e,!0)||(n=n.concat([new mb(i.key,e,`invalid url "${e}"`)])),n)},t.L=Pe,t.M=class{constructor(i,e,n,s){this.id=i,this.position=e!=null?new zi(e[0],e[1]):new zi(0,0),this.orientation=n??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,e){if(t.ad.multiply(i.matrix,e,i.matrix),i.meshes)for(let n of i.meshes){let s=Nn.applyTransform(n.aabb,i.matrix);this.aabb.encapsulate(s)}if(i.children)for(let n of i.children)this._applyTransformations(n,i.matrix)}computeBoundsAndApplyParent(){let i=t.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,i)}computeModelMatrix(i,e,n,s,h,m,p=!1){jk(this.matrix,this,i.transform,this.position,e,n,s,h,m,p)}upload(i){if(!this.uploaded){for(let e of this.nodes)B1(e,i);for(let e of this.nodes)pb(e);this.uploaded=!0}}destroy(){for(let i of this.nodes)N1(i)}},t.N=$i,t.O=Ke,t.P=wt,t.Q=class{constructor(i){this.specification=i}possiblyEvaluate(i,e){return cs(i.expression.evaluate(e))}interpolate(i,e,n){return{x:Ht(i.x,e.x,n),y:Ht(i.y,e.y,n),z:Ht(i.z,e.z,n),azimuthal:Ht(i.azimuthal,e.azimuthal,n),polar:Ht(i.polar,e.polar,n)}}},t.R=Vu,t.S=Tx,t.T=Ya,t.U=Ji,t.V=mb,t.W=Jr,t.X=Kt,t.Y=so,t.Z=Y,t.a=Jo,t.a$=function(i){let{x:e,y:n}=i.point,{lng:s,lat:h}=i._center;return MS(e,n,i.worldSize,s,h)},t.a0=on,t.a1=$l,t.a2=Ht,t.a3=pt,t.a4=z_,t.a5=class{constructor(i){this.specification=i}possiblyEvaluate(i,e){return function([n,s]){let h=cs([1,n,s]);return{x:h.x,y:h.y,z:h.z}}(i.expression.evaluate(e))}interpolate(i,e,n){return{x:Ht(i.x,e.x,n),y:Ht(i.y,e.y,n),z:Ht(i.z,e.z,n)}}},t.a6=Gf,t.a7=x0,t.a8=Wl,t.a9=J2,t.aB=function(i,e){let{x:n,y:s}=i.point,h=MS(n,s,i.worldSize/i._pixelsPerMercatorPixel,0,0);return t.ad.multiply(h,h,Jx(nl(e)))},t.aD=km,t.aE=Ia,t.aF=q0,t.aG=function(i,e,n,s,h){let m=5*e+2;i.float32[m+0]=n,i.float32[m+1]=s,i.float32[m+2]=h},t.aH=nb,t.aI=zi,t.aJ=mk,t.aK=nS,t.aL=Mr,t.aM=Xx,t.aN=Ok,t.aO=Uh,t.aP=wS,t.aQ=function(i,e,n,s,h,m,p,b,y){if(y.name==="globe")return wS(i,e,new Uh(n,s,h),!1);let w=qh({z:n,x:s,y:h},y);return new Nn([(m+w.x/w.scale)*e,e*(w.y/w.scale),p],[(m+w.x2/w.scale)*e,e*(w.y2/w.scale),b])},t.aR=function(i,e,n){let s=0;for(let h=0;h<2;++h)i[h]>0&&(s+=(i[h]-0)*(i[h]-0)),e[h]<0&&(s+=(0-e[h])*(0-e[h]));return s},t.aS=cr,t.aT=Yx,t.aU=tS,t.aV=function(i){let e=t.ad.identity(new Float64Array(16));t.ad.multiply(e,i.pixelMatrix,i.globeMatrix);let n=[0,qa,0],s=[0,$a,0];return t._.transformMat4(n,n,e),t._.transformMat4(s,s,e),[n[0]>0&&n[0]<=i.width&&n[1]>0&&n[1]<=i.height&&!t1(i,new zi(i.center.lat,90)),s[0]>0&&s[0]<=i.width&&s[1]>0&&s[1]<=i.height&&!t1(i,new zi(i.center.lat,-90))]},t.aW=function(i,e){let{scale:n}=i.tileTransform,s=n*pt/(i.tileSize*Math.pow(2,e.zoom-i.tileID.overscaledZ+i.tileID.canonical.z));return t.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},t.aX=hb,t.aY=Pk,t.aZ=function(i){let e=Pk(i,!0);return t.aC.invert([],[e[0],e[1],e[4],e[5]])},t.a_=Zx,t.aa=ko,t.ab=Ai,t.ac=function(i,e,n){let s=Math.sqrt(i*i+e*e+n*n),h=s>0?Math.acos(n/s)*nh:0,m=i!==0||e!==0?Math.atan2(-e,-i)*nh+90:0;return m<0&&(m+=360),[s,m,h]},t.ae=Am,t.af=xs,t.ag=S1,t.ah=function(i,e){let n={};for(let s=0;s<e.length;s++){let h=e[s];h in i&&(n[h]=i[h])}return n},t.ai=cd,t.aj=tl,t.ak=il,t.al=hm,t.am=function(i){Bu++,Bu>Jp&&(i.getActor().send("enforceCacheSizeLimit",Kp),Bu=0)},t.an=lf,t.ao=class{constructor(i){this.entries={},this.scheduler=i}request(i,e,n,s){let h=this.entries[i]=this.entries[i]||{callbacks:[]};if(h.result){let[m,p]=h.result;return this.scheduler?this.scheduler.add(()=>{s(m,p)},e):s(m,p),()=>{}}return h.callbacks.push(s),h.cancel||(h.cancel=n((m,p)=>{h.result=[m,p];for(let b of h.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,p)},e):b(m,p);setTimeout(()=>delete this.entries[i],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(m=>m!==s),h.callbacks.length||(h.cancel(),delete this.entries[i]))}}},t.ap=function(i,e,n){let s=JSON.stringify(i.request);return i.data&&(this.deduped.entries[s]={result:[null,i.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{let m=El(i.request,(p,b,y,w)=>{p?h(p):b&&h(null,{vectorTile:n?void 0:new l1(new Mm(b)),rawData:b,cacheControl:y,expires:w})});return()=>{m.cancel(),h()}},e)},t.aq=Px,t.ar=class extends Ul{constructor(i){super(i),this.current=VO}set(i,e,n){if(this.fetchUniformLocation(i,e)){for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},t.as=Ox,t.at=gi,t.au=kl,t.aw=lh,t.ax=To,t.ay=Gr,t.az=function(i,e,n){i[4*e+0]=n[0],i[4*e+1]=n[1],i[4*e+2]=n[2],i[4*e+3]=n[3]},t.b=Bn,t.b$=md,t.b0=Kr,t.b1=Fx,t.b2=function(i){let e=Math.round((i+45+360)%360/90)%4;return S_[e]},t.b3=45,t.b4=Nx,t.b5=w0,t.b6=Nn,t.b7=cs,t.b8=function(i){return[Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)]},t.b9=Hp,t.bA=function(i,e){return[Math.pow(i[0],2.2)*e,Math.pow(i[1],2.2)*e,Math.pow(i[2],2.2)*e]},t.bB=MM,t.bD=SS,t.bE=Lu,t.bF=Ru,t.bG=256,t.bH=function(i,e){let n=[0,0,0],s=Qf(nl(e.canonical));return t._.transformMat4(n,n,s),t._.transformMat4(n,n,i),n},t.bI=i=>({u_camera_to_center_distance:new ko(i),u_extrude_scale:new Rx(i),u_device_pixel_ratio:new ko(i),u_matrix:new Gf(i),u_inv_rot_matrix:new Gf(i),u_merc_center:new Wl(i),u_tile_id:new Px(i),u_zoom_transition:new ko(i),u_up_dir:new Px(i),u_emissive_strength:new ko(i)}),t.bJ=i=>({u_matrix:new Gf(i),u_pixels_to_tile_units:new Rx(i),u_device_pixel_ratio:new ko(i),u_units_to_pixels:new Wl(i),u_dash_image:new x0(i),u_gradient_image:new x0(i),u_image_height:new ko(i),u_texsize:new Wl(i),u_tile_units_to_pixels:new ko(i),u_alpha_discard_threshold:new ko(i),u_trim_offset:new Wl(i),u_trim_fade_range:new Wl(i),u_trim_color:new Ox(i),u_emissive_strength:new ko(i)}),t.bK=i=>({u_matrix:new Gf(i),u_texsize:new Wl(i),u_pixels_to_tile_units:new Rx(i),u_device_pixel_ratio:new ko(i),u_image:new x0(i),u_units_to_pixels:new Wl(i),u_tile_units_to_pixels:new ko(i),u_alpha_discard_threshold:new ko(i),u_trim_offset:new Wl(i)}),t.bL=xx,t.bM=v3,t.bN=to,t.bO=B3,t.bP=rk,t.bQ=_1,t.bR=TS,t.bS=(i,e,n,s,h,m)=>{let p=i.transform,b=p.projection.name==="globe",y;if(m.paint.get("circle-pitch-alignment")==="map")if(b){let M=SS(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;y=Float32Array.from([M,0,0,M])}else y=p.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let w={u_camera_to_center_distance:i.transform.getCameraToCenterDistance(p.projection),u_matrix:i.translatePosMatrix(e.projMatrix,n,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ur.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:dR,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(b){w.u_inv_rot_matrix=s,w.u_merc_center=h,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=$l(p.zoom);let M=h[0]*pt,T=h[1]*pt;w.u_up_dir=p.projection.upVector(new Uh(0,0,0),M,T)}return w},t.bT=TM,t.bU=(i,e,n,s,h,m)=>{let p=i.transform;return{u_matrix:IM(i,e,n,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:kM(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:m}},t.bV=(i,e,n,s,h,m,p)=>{let b=i.transform,y=b.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:IM(i,e,n,s),u_pixels_to_tile_units:y,u_device_pixel_ratio:m,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:EM(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:kM(e,i.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},t.bW=Gp,t.bX=Kf,t.bY=_M,t.bZ=YO,t.b_=j0,t.ba=function(i,e,n){let s=$l(n.zoom),h=i.style.map._antialias,m=e.options.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return s===0&&!h&&!m},t.bb=function(i){let e=i.pixelsPerMeter,n=e/To(1,i.center.lat),s=t.ad.identity(new Float64Array(16));return t.ad.translate(s,s,[i.point.x,i.point.y,0]),t.ad.scale(s,s,[n,n,e]),Float32Array.from(s)},t.bc=T0,t.bd=function(i){let e=cr-5;i=gi(i,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(Ai(i))),3);return Math.round(n*(zx.length-1))},t.be=function(i,e,n,s){let h=e.getNorth(),m=e.getSouth(),p=e.getWest(),b=e.getEast(),y=1<<i.z,w=b-p,M=h-m,T=w/fm,E=-M/zx[n],P=[0,T,0,E,0,0,h,p,0];if(i.z>0){let R=180/s;t.bC.multiply(P,P,[R/w+1,0,0,0,R/M+1,0,-.5*R/T,.5*R/E,1])}return P[2]=y,P[5]=i.x,P[8]=i.y,P},t.bf=Qf,t.bg=nl,t.bh=function(i,e,n){let s=t.ad.identity(new Float64Array(16)),h=(e/(1<<i)-.5)*Math.PI*2;return t.ad.rotateY(s,n.globeMatrix,h),Float32Array.from(s)},t.bi=Lc,t.bj=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},t.bk=Dk,t.bl=Ak,t.bm=Ek,t.bn=function(i,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<i.length;s++){let h=document.createElement("source");E_(i[s])||(n.crossOrigin="Anonymous"),h.src=i[s],n.appendChild(h)}return{cancel:()=>{}}},t.bo=rb,t.bp=Au,t.bq=class{isDataAvailableAtPoint(i){let e=this._source();if(this.isUsingMockSource()||!e||i.y<0||i.y>1)return!1;let n=e.getSource().maxzoom,s=1<<n,h=Math.floor(i.x),m=Math.floor((i.x-h)*s),p=Math.floor(i.y*s),b=this.findDEMTileFor(new Mr(n,h,n,m,p));return!(!b||!b.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let s=this._source();if(!s||i.y<0||i.y>1)return e;let h=s.getSource().maxzoom,m=1<<h,p=Math.floor(i.x),b=i.x-p,y=new Mr(h,p,h,Math.floor(b*m),Math.floor(i.y*m)),w=this.findDEMTileFor(y);if(!w||!w.dem)return e;let M=w.dem,T=1<<w.tileID.canonical.z,E=(b*T-w.tileID.canonical.x)*M.dim,P=(i.y*T-w.tileID.canonical.y)*M.dim,R=Math.floor(E),F=Math.floor(P);return(n?this.exaggeration():1)*Ht(Ht(M.get(R,F),M.get(R,F+1),P-F),Ht(M.get(R+1,F),M.get(R+1,F+1),P-F),E-R)}getAtTileOffset(i,e,n){let s=1<<i.canonical.z;return this.getAtPointOrZero(new so(i.wrap+(i.canonical.x+e/pt)/s,(i.canonical.y+n/pt)/s))}getAtTileOffsetFunc(i,e,n,s){return h=>{let m=this.getAtTileOffset(i,h.x,h.y),p=s.upVector(i.canonical,h.x,h.y),b=s.upVectorScale(i.canonical,e,n).metersToTile;return t._.scale(p,p,m*b),p}}getForTilePoints(i,e,n,s){if(this.isUsingMockSource())return!1;let h=wm.create(this,i,s);return!!h&&(e.forEach(m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],n)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(i);if(!e||!e.dem)return null;let n=e.dem.tree,s=e.tileID,h=1<<i.canonical.z-s.canonical.z,m=i.canonical.x/h-s.canonical.x,p=i.canonical.y/h-s.canonical.y,b=0;for(let y=0;y<i.canonical.z-s.canonical.z&&!n.leaves[b];y++){m*=2,p*=2;let w=2*Math.floor(p)+Math.floor(m);b=n.childOffsets[b]+w,m%=1,p%=1}return{min:this.exaggeration()*n.minimums[b],max:this.exaggeration()*n.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let i=this.visibleDemTiles;if(i.length===0)return null;let e=!1,n=Number.MAX_VALUE,s=Number.MIN_VALUE;for(let h of i){let m=this.getMinMaxForTile(h.tileID);m&&(n=Math.min(n,m.min),s=Math.max(s,m.max),e=!0)}return e?{min:n,max:s}:null}},t.br=Zf,t.bs=I0,t.bt=gs,t.bu=Rr,t.bv=$h,t.bw=V1,t.bx=fb,t.by=sb,t.bz=RS,t.c=Kk,t.c$=dh,t.c0=450,t.c1=7,t.c2=NL,t.c3=Ck,t.c4=256,t.c5=vS,t.c6=Jx,t.c7=Yi,t.c8=rd,t.c9=Nh,t.cA=function(i){let e=1/0,n=1/0,s=-1/0,h=-1/0;for(let m of i)e=Math.min(e,m.x),n=Math.min(n,m.y),s=Math.max(s,m.x),h=Math.max(h,m.y);return{min:new wt(e,n),max:new wt(s,h)}},t.cB=dd,t.cC=sS,t.cD=Io,t.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.cF=QM,t.cG=Hx,t.cH=XS,t.cI=QS,t.cJ=x1,t.cK=$1,t.cL=function(i){return i({pluginStatus:it,pluginURL:$e}),ti.on("pluginStateChange",i),i},t.cM=Tm,t.cN=y1,t.cO=ju,t.cP=Dt,t.cQ=z,t.cR=Qp,t.cS=Vc,t.cT=Va,t.cU=function(i){let e=i.indexOf(ed);return e>=0?i.slice(0,e):i},t.cV=function(i){return i.indexOf(ed)>=0},t.cW=function(i){let e=i.indexOf(ed);return e>=0?i.slice(e+1):""},t.cX=function(i){let e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},t.cY=function(i,e,n,s){return i.type==="custom"?new UL(i,e):new bF[i.type](i,e,n,s)},t.cZ=Il,t.c_=ti,t.ca=1,t.cb=pg,t.cc=0,t.cd=Mx,t.ce=function(i,e,n,s,h){return gi((i-e)/(n-e)*(h-s)+s,s,h)},t.cf=c0,t.cg=Wh,t.ch=class{constructor(i,e,n,s){this.context=i,this.format=s,this.size=n,this.texture=i.gl.createTexture();let[h,m,p]=this.size,{gl:b}=i;b.bindTexture(b.TEXTURE_3D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(!1);let y=this.format,w=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(y=b.DEPTH_COMPONENT16,w=b.UNSIGNED_SHORT),this.format===b.R8&&(s=b.RED),this.format===b.R32F&&(w=b.FLOAT,s=b.RED),b.texImage3D(b.TEXTURE_3D,0,y,h,m,p,0,s,w,e.data)}bind(i,e){let{context:n}=this,{gl:s}=n;s.bindTexture(s.TEXTURE_3D,this.texture),i!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,i),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,i),this.minFilter=i),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}},t.ci=F1,t.cj=[1,1,1],t.ck=wm,t.cl=Lm,t.cm=ad,t.cn=mm,t.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new wt(1/0,1/0),max:new wt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(i,e=!1){let n=$S(new wt(0,0),new wt(pt,pt),i),s=[];if(e&&!c1(n,this._globalClipBounds))return s;for(let h of this._activeRegions){if(h.hiddenByOverlap||!c1(n,h))continue;let m=$R(h.min,h.max,i);s.push({min:m.min,max:m.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask})}return s}setSources(i){this._setSources(i.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let s of e.cache.getVisibleCoordinates()){let h=e.cache.getTile(s).buckets[e.layer];h&&h.updateFootprints(s.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(i){let e=i.getFootprints();if(e.length===0)return;let n=i.getOrder(),s=i.getClipMask();for(let h of e){if(!h.footprint)continue;let m=$S(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:n,clipMask:s})}this._sourceIds.push(i.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||B0(e.min,n.min)||B0(e.max,n.max));let i=this._activeRegions.length!==this._prevRegions.length;if(!i){let e=0;for(;!i&&e!==this._activeRegions.length;){let n=this._activeRegions[e],s=this._prevRegions[e];i=n.priority!==s.priority||!qS(n,s)||n.order!==s.order||n.clipMask!==s.clipMask,++e}}if(i){++this._updateTime;for(let n of this._activeRegions)n.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));let e=n=>{let s=this._activeRegions;if(n>=s.length)return n;let h=s[n].priority;for(;n<s.length&&s[n].priority===h;)++n;return n};if(this._sourceIds.length>1){let n=0,s=e(n);for(;n!==s;){let h=n,m=n;for(;h!==s;){let p=this._activeRegions[h];p.hiddenByOverlap=!1;for(let b=0;b<m;b++){let y=this._activeRegions[b];if(!y.hiddenByOverlap&&p.order===1/0&&c1(p,y)&&(p.hiddenByOverlap=ZS(p.footprint,p.tileId,y.footprint,y.tileId),p.hiddenByOverlap))break}++h}n=s,s=e(n)}}}}_setSources(i){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=i.length-1;e>=0;e--)this._addSource(i[e]);this._computeReplacement()}},t.cp=id,t.cq=ab,t.cr=Wf,t.cs=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let i of this._poleSegments)i.destroy();for(let i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy()}_fillGridMeshWithLods(i,e){let n=new gs,s=new Rr,h=[],m=i+1+2,p=e[0]+1,b=e[0]+1+(1+e.length),y=(w,M,T)=>{let E=w===m-1?w-2:w===0?w:w-1;return E+=T?24575:0,[E,M]};for(let w=0;w<m;++w)n.emplaceBack(...y(w,0,!0));for(let w=0;w<p;++w)for(let M=0;M<m;++M)n.emplaceBack(...y(M,w,(M===0||M===m-1)&&!0));for(let w=0;w<e.length;++w){let M=e[w];for(let T=0;T<m;++T)n.emplaceBack(...y(T,M,!0))}for(let w=0;w<e.length;++w){let M=s.length,T=e[w]+1+2,E=new Rr;for(let F=0;F<T-1;F++){let N=F===T-2,H=N?m*(b-e.length+w-F):m;for(let J=0;J<m-1;J++){let ee=F*m+J;F===0||N||J===0||J===m-2?(E.emplaceBack(ee+1,ee,ee+H),E.emplaceBack(ee+H,ee+H+1,ee+1)):(s.emplaceBack(ee+1,ee,ee+H),s.emplaceBack(ee+H,ee+H+1,ee+1))}}let P=Bn.simpleSegment(0,M,n.length,s.length-M);for(let F=0;F<E.uint16.length;F+=3)s.emplaceBack(E.uint16[F],E.uint16[F+1],E.uint16[F+2]);let R=Bn.simpleSegment(0,M,n.length,s.length-M);h.push({withoutSkirts:P,withSkirts:R})}return{vertices:n,indices:s,segments:h}}_createGrid(i){let e=this._fillGridMeshWithLods(fm,zx);this._gridSegments=e.segments,this._gridBuffer=i.createVertexBuffer(e.vertices,Zf.members),this._gridIndexBuffer=i.createIndexBuffer(e.indices,!0)}_createPoles(i){let e=new Rr;for(let p=0;p<=fm;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);let n=new Nh,s=new Nh,h=new Nh,m=new Nh;this._poleSegments=[];for(let p=0,b=0;p<Fx;p++){let y=360/(1<<p);n.emplaceBack(0,-Io,0,.5,0),s.emplaceBack(0,-Io,0,.5,1),h.emplaceBack(0,-Io,0,.5,.5),m.emplaceBack(0,-Io,0,.5,.5);for(let w=0;w<=fm;w++){let M=w/fm,T=0,E=Ht(0,y,M),[P,R,F]=gm(lR,cR,E,Io);n.emplaceBack(P,R,F,M,T),s.emplaceBack(P,R,F,M,1-T);let N=Ai(E);M=.5+.5*Math.sin(N),T=.5+.5*Math.cos(N),h.emplaceBack(P,R,F,M,T),m.emplaceBack(P,R,F,M,1-T)}this._poleSegments.push(Bn.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(n,k0,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(s,k0,!1),this._texturedPoleNorthVertexBuffer=i.createVertexBuffer(h,k0,!1),this._texturedPoleSouthVertexBuffer=i.createVertexBuffer(m,k0,!1)}getGridBuffers(i,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}},t.ct=function(i){return fh.has(i)},t.cu=oM,t.cv=function(i,e,n=0,s=!0){let h=new wt(n,n),m=i.sub(h),p=e.add(h),b=[m,new wt(p.x,m.y),p,new wt(m.x,p.y)];return s&&b.push(m.clone()),b},t.cw=function(i,e){let n=[];for(let s=0;s<i.length;s++){let h=kl(s-1,-1,i.length-1),m=kl(s+1,-1,i.length-1),p=i[s],b=i[m],y=i[h].sub(p).unit(),w=b.sub(p).unit(),M=w.angleWithSep(y.x,y.y),T=y.add(w).unit().mult(-1*e/Math.sin(M/2));n.push(p.add(T))}return n},t.cx=lk,t.cy=uS,t.cz=function(i,e,n=0){return t._.fromValues(((e.x-n)*i.scale-i.x)*pt,(e.y*i.scale-i.y)*pt,rS(e.z,e.y))},t.d=Gu,t.d$=Tu,t.d0=rh,t.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},t.d2=Ac,t.d3=aS,t.d4=jh,t.d5=function([i,e,n]){let s=Math.hypot(i,e,n),h=Math.atan2(i,n),m=.5*Math.PI-Math.acos(-e/s);return new zi(Kr(h),Kr(m))},t.d6=Wo,t.d7=_m,t.d8=I,t.d9=t1,t.dA=function(i){let e=I_();if(!e)return;let n=e.delete(k_);i&&n.catch(i).then(()=>i())},t.dB=yg,t.dC=Wk,t.dD=function(i){U1=Ur.resolveURL(i),zm||(zm=new V1(fb(),new Al)),zm.broadcast("setDracoUrl",U1)},t.dE=Hk,t.dF=function(i){Fm=Ur.resolveURL(i),zm||(zm=new V1(fb(),new Al)),zm.broadcast("setMeshoptUrl",Fm)},t.dG=Zo,t.dH=ne,t.dI=hd,t.dJ=vs,t.dK=qh,t.dL=Dx,t.dM=DM,t.dN=zM,t.dO=CM,t.dP=Oc,t.dQ=JM,t.dR=Pm,t.dS=function(i,e,n,s,h,m,p,b,y,w,M){i.createArrays(),i.tilePixelRatio=pt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;let T=i.layers[0].layout,E=i.layers[0]._unevaluatedLayout._values,P={};if(i.textSizeData.kind==="composite"){let{minZoom:H,maxZoom:J}=i.textSizeData;P.compositeTextSizes=[E["text-size"].possiblyEvaluate(new Kt(H),b),E["text-size"].possiblyEvaluate(new Kt(J),b)]}if(i.iconSizeData.kind==="composite"){let{minZoom:H,maxZoom:J}=i.iconSizeData;P.compositeIconSizes=[E["icon-size"].possiblyEvaluate(new Kt(H),b),E["icon-size"].possiblyEvaluate(new Kt(J),b)]}P.layoutTextSize=E["text-size"].possiblyEvaluate(new Kt(y+1),b),P.layoutIconSize=E["icon-size"].possiblyEvaluate(new Kt(y+1),b),P.textMaxSize=E["text-size"].possiblyEvaluate(new Kt(18),b);let R=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",F=T.get("text-size"),N=!1;for(let H of i.features)if(H.icon&&H.icon.nameSecondary){N=!0;break}for(let H of i.features){let J=T.get("text-font").evaluate(H,{},b).join(","),ee=F.evaluate(H,{},b),te=P.layoutTextSize.evaluate(H,{},b),pe=(P.layoutIconSize.evaluate(H,{},b),{horizontal:{},vertical:void 0}),he=H.text,ve,Ce=[0,0];if(he){let ze=he.toString(),Ye=T.get("text-letter-spacing").evaluate(H,{},b)*to,rt=T.get("text-line-height").evaluate(H,{},b)*to,qe=Be(ze)?Ye:0,et=T.get("text-anchor").evaluate(H,{},b),We=T.get("text-variable-anchor");if(!We){let ot=T.get("text-radial-offset").evaluate(H,{},b);Ce=ot?rk(et,[ot*to,v1]):T.get("text-offset").evaluate(H,{},b).map(ut=>ut*to)}let tt=R?"center":T.get("text-justify").evaluate(H,{},b),ct=T.get("symbol-placement")==="point",nt=ct?T.get("text-max-width").evaluate(H,{},b)*to:1/0,kt=ot=>{i.allowVerticalPlacement&&Le(ze)&&(pe.vertical=g1(he,e,n,h,J,nt,rt,et,ot,qe,Ce,Ia.vertical,!0,te,ee))};if(!R&&We){let ot=tt==="auto"?We.map(Vt=>x1(Vt)):[tt],ut=!1;for(let Vt=0;Vt<ot.length;Vt++){let Lt=ot[Vt];if(!pe.horizontal[Lt])if(ut)pe.horizontal[Lt]=pe.horizontal[0];else{let Ot=g1(he,e,n,h,J,nt,rt,"center",Lt,qe,Ce,Ia.horizontal,!1,te,ee);Ot&&(pe.horizontal[Lt]=Ot,ut=Ot.positionedLines.length===1)}}kt("left")}else{if(tt==="auto"&&(tt=x1(et)),ct||T.get("text-writing-mode").indexOf("horizontal")>=0||!Le(ze)){let ot=g1(he,e,n,h,J,nt,rt,et,tt,qe,Ce,Ia.horizontal,!1,te,ee);ot&&(pe.horizontal[tt]=ot)}kt(ct?"left":tt)}}let Ae=!1;if(H.icon&&H.icon.namePrimary){let ze=s[H.icon.namePrimary];ze&&(ve=$3(h[H.icon.namePrimary],H.icon.nameSecondary?h[H.icon.nameSecondary]:void 0,T.get("icon-offset").evaluate(H,{},b),T.get("icon-anchor").evaluate(H,{},b)),Ae=ze.sdf,i.sdfIcons===void 0?i.sdfIcons=ze.sdf:i.sdfIcons!==ze.sdf&&sr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ze.pixelRatio!==i.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}let Ue=ak(pe.horizontal)||pe.vertical;i.iconsInText||(i.iconsInText=!!Ue&&Ue.iconsInText),(Ue||ve)&&eL(i,H,pe,ve,s,P,te,0,Ce,Ae,p,b,w,M,N)}m&&i.generateCollisionDebugBuffers(y,i.collisionBoxArray)},t.dT=U0,t.dU=R0,t.dV=l1,t.dW=Mm,t.dX=N0,t.dY=P1,t.dZ=F0,t.d_=L0,t.da=kS,t.db=function(i){let e=[0,0,0],n=t.ad.identity(new Float64Array(16));return t.ad.multiply(n,i.pixelMatrix,i.globeMatrix),t._.transformMat4(e,e,n),new wt(e[0],e[1])},t.dc=Ie,t.dd=xe,t.de=function(i){let e=i.navigator?i.navigator.userAgent:null;return!!function(n){if(Ou==null){let s=n.navigator?n.navigator.userAgent:null;Ou=!!n.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Ou}(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.df=Eu,t.dg=class{constructor(i,e,n){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let i=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",af,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!z(i))return i;let n=ya(i);return n.params.push(`sdk=js-${g}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!z(i))return i;let n=ya(i);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(i,e){if(!z(i))return i;let n=ya(i);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(i,e,n,s){if(!z(i))return i;let h=ya(i);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),n&&h.params.push(`language=${n}`),s&&h.params.push(`worldview=${s}`),this._makeAPIURL(h,this._customAccessToken||e)}normalizeSpriteURL(i,e,n,s){let h=ya(i);return z(i)?(h.path=`/styles/v1${h.path}/sprite${e}${n}`,this._makeAPIURL(h,this._customAccessToken||s)):(h.path+=`${e}${n}`,Bc(h))}normalizeTileURL(i,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!z(i))return i;let s=ya(i);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&s.authority!=="raster"&&n===512?"@2x":""}${Nu.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${I.RASTER_URL_PREFIX}${s.path}`:s.authority==="rasterarrays"?s.path=`/${I.RASTERARRAYS_URL_PREFIX}${s.path}`:s.authority==="3dtiles"?s.path=`/${I.TILES3D_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${I.TILE_URL_VERSION}${s.path}`);let h=this._customAccessToken||function(m){for(let p of m){let b=p.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(s.params)||I.ACCESS_TOKEN;return I.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,h)}canonicalizeTileURL(i,e){let n=ya(i);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return i;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${I.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?s+=`rasterarrays/${n.path.replace(`/${I.RASTERARRAYS_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${I.TILE_URL_VERSION}/`,"")}`;let h=n.params;return e&&(h=h.filter(m=>!m.match(/^access_token=/))),h.length&&(s+=`?${h.join("&")}`),s}canonicalizeTileset(i,e){let n=!!e&&z(e),s=[];for(let h of i.tiles||[])O(h)?s.push(this.canonicalizeTileURL(h,n)):s.push(h);return s}_makeAPIURL(i,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=ya(I.API_URL);if(i.protocol=s.protocol,i.authority=s.authority,i.protocol==="http"){let h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if(s.path!=="/"&&(i.path=`${s.path}${i.path}`),!I.REQUIRE_ACCESS_TOKEN)return Bc(i);if(e=e||I.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return i.params=i.params.filter(h=>h.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),Bc(i)}},t.dh=function(i,e){e?fh.add(i):fh.delete(i)},t.di=Nu,t.dj=Qv,t.dk=Hu,t.dl=sf,t.dm=P_,t.dn=Xv,t.dp=function(i){fh.delete(i)},t.dq=Nc,t.dr=ph,t.ds=Pc,t.dt=g,t.du=function(i,e){Kp=i,Jp=e},t.dv=function(i,e,n=!1){if(it===bt||it===vt||it===It)throw new Error("setRTLTextPlugin cannot be called multiple times.");$e=Ur.resolveURL(i),it=bt,xt=e,si(),n||Pi()},t.dw=xi,t.dx=function(){fb().acquire(j1)},t.dy=function(){let i=xg;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(j1),xg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.dz=vg,t.e=Ur,t.e0=AM,t.e1=Ge,t.e2=El,t.e3=function(i){let e=0;if(new Uint32Array(i,0,1)[0]!==qk){let n=new Uint32Array(i,0,7),[,,s,h,m,p]=n;e=n.byteLength+h+m+p+m,(s!==i.byteLength||e>=i.byteLength)&&sr("Invalid b3dm header information.")}return Xk(i,e)},t.e4=function(i,e){let n=Kk(i);for(let s of n){for(let h of s.meshes)pF(h);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(fF(s.lights,e)))}return n},t.e5=yb,t.e6=Uk,t.e7=tn,t.e8=function(i){ch(),hs&&hs.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-i;s++)e.delete(n[s])})})},t.f=fo,t.g=function(i,e){return dh(Jr(i,{type:"json"}),e)},t.h=Gs,t.i=ka,t.j=KM,t.k=b1,t.l=function(i){return fetch(i).then(e=>e.arrayBuffer()).then(e=>Xk(e,0,i))},t.m=class extends mb{},t.n=Ol,t.o=uf,t.p=pL,t.q=dm,t.r=f,t.s=a,t.t=B,t.u=jo,t.v=Hr,t.w=sr,t.x=Z,t.y=U,t.z=em}),r(["./shared"],function(t){function g(Se){let G=Se?Se.url.toString():void 0;return G?performance.getEntriesByName(G):[]}function C(Se){if(typeof Se=="number"||typeof Se=="boolean"||typeof Se=="string"||Se==null)return JSON.stringify(Se);if(Array.isArray(Se)){let K="[";for(let ce of Se)K+=`${C(ce)},`;return`${K}]`}let G="{";for(let K of Object.keys(Se).sort())G+=`${K}:${C(Se[K])},`;return`${G}}`}function I(Se){let G="";for(let K of t.cE)G+=`/${C(Se[K])}`;return G}class O{constructor(G){this.keyCache={},this._layers={},this._layerConfigs={},G&&this.replace(G)}replace(G,K){this._layerConfigs={},this._layers={},this.update(G,[],K)}update(G,K,ce){this._options=ce;for(let ye of G)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=t.cY(ye,this.scope,null,this._options)).compileFilter(),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(let ye of K)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};let be=function(ye,De){let Ne={};for(let je=0;je<ye.length;je++){let mt=De&&De[ye[je].id]||I(ye[je]);De&&(De[ye[je].id]=mt);let st=Ne[mt];st||(st=Ne[mt]=[]),st.push(ye[je])}let Te=[];for(let je in Ne)Te.push(Ne[je]);return Te}(t.dG(this._layerConfigs),this.keyCache);for(let ye of be){let De=ye.map(Rt=>this._layers[Rt.id]),Ne=De[0];if(Ne.visibility==="none")continue;let Te=Ne.source||"",je=this.familiesBySource[Te];je||(je=this.familiesBySource[Te]={});let mt=Ne.sourceLayer||"_geojsonTileLayer",st=je[mt];st||(st=je[mt]=[]),st.push(De)}}}let z=1*t.dJ;class q{constructor(G){let K={},ce=[];for(let Ne in G){let Te=G[Ne],je=K[Ne]={};for(let mt in Te.glyphs){let st=Te.glyphs[+mt];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;let Rt=st.metrics.localGlyph?z:1,$t={x:0,y:0,w:st.bitmap.width+2*Rt,h:st.bitmap.height+2*Rt};ce.push($t),je[mt]=$t}}let{w:be,h:ye}=t.j(ce),De=new t.dI({width:be||1,height:ye||1});for(let Ne in G){let Te=G[Ne];for(let je in Te.glyphs){let mt=Te.glyphs[+je];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;let st=K[Ne][je],Rt=mt.metrics.localGlyph?z:1;t.dI.copy(mt.bitmap,De,{x:0,y:0},{x:st.x+Rt,y:st.y+Rt},mt.bitmap)}}this.image=De,this.positions=K}}t.dH(q,"GlyphAtlas");class ie{constructor(G){this.tileID=new t.aL(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.lut=G.lut,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.scope=G.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.promoteId=G.promoteId,this.isSymbolTile=G.isSymbolTile,this.tileTransform=t.dK(G.tileID.canonical,G.projection),this.projection=G.projection,this.brightness=G.brightness,this.extraShadowCaster=!!G.extraShadowCaster,this.tessellationStep=G.tessellationStep}parse(G,K,ce,be,ye){this.status="parsing",this.data=G,this.collisionBoxArray=new t.dL;let De=new t.dM(Object.keys(G.layers).sort()),Ne=new t.dN(this.tileID,this.promoteId);Ne.bucketLayerIDs=[];let Te={},je=new t.dO(256,256),mt={featureIndex:Ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:je,availableImages:ce,brightness:this.brightness},st=K.familiesBySource[this.source];for(let At in st){let Dn=G.layers[At];if(!Dn)continue;let en=!1,Ri=!1,ar=!1;for(let Xr of st[At])Xr[0].type==="symbol"?en=!0:Ri=!0,Xr[0].is3D()&&Xr[0].type!=="model"&&(ar=!0);if(this.extraShadowCaster&&!ar||this.isSymbolTile===!0&&!en||this.isSymbolTile===!1&&!Ri)continue;Dn.version===1&&t.w(`Vector tile source "${this.source}" layer "${At}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let An=De.encode(At),br=[];for(let Xr=0;Xr<Dn.length;Xr++){let Qr=Dn.feature(Xr),Cl=Ne.getId(Qr,At);br.push({feature:Qr,id:Cl,index:Xr,sourceLayerIndex:An})}for(let Xr of st[At]){let Qr=Xr[0];(!this.extraShadowCaster||Qr.is3D()&&Qr.type!=="model")&&(this.isSymbolTile!==void 0&&Qr.type==="symbol"!==this.isSymbolTile||Qr.minzoom&&this.zoom<Math.floor(Qr.minzoom)||Qr.maxzoom&&this.zoom>=Qr.maxzoom||Qr.visibility!=="none"&&(de(Xr,this.zoom,mt.brightness,ce),(Te[Qr.id]=Qr.createBucket({index:Ne.bucketLayerIDs.length,layers:Xr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:An,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(br,mt,this.tileID.canonical,this.tileTransform),Ne.bucketLayerIDs.push(Xr.map(Cl=>Cl.id))))}}let Rt,$t,fi,vi;je.trim();let oi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Di=()=>{if(Rt)return this.status="done",ye(Rt);if(this.extraShadowCaster)this.status="done",ye(null,{buckets:t.dG(Te).filter(At=>!At.isEmpty()),featureIndex:Ne,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:mt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if($t&&fi&&vi){let At=new q($t),Dn=new t.dQ(fi,vi,this.lut);for(let en in Te){let Ri=Te[en];Ri instanceof t.dR?(de(Ri.layers,this.zoom,mt.brightness,ce),t.dS(Ri,$t,At.positions,fi,Dn.iconPositions,this.showCollisionBoxes,ce,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Ri.hasPattern&&(Ri instanceof t.dT||Ri instanceof t.dU||Ri instanceof t.b_)&&(de(Ri.layers,this.zoom,mt.brightness,ce),Ri.addFeatures(mt,this.tileID.canonical,Dn.patternPositions,ce,this.tileTransform,this.brightness))}this.status="done",ye(null,{buckets:t.dG(Te).filter(en=>!en.isEmpty()),featureIndex:Ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:At.image,lineAtlas:je,imageAtlas:Dn,brightness:mt.brightness})}};if(!this.extraShadowCaster){let At=t.dP(mt.glyphDependencies,Ri=>Object.keys(Ri).map(Number));Object.keys(At).length?be.send("getGlyphs",{uid:this.uid,stacks:At,scope:this.scope},(Ri,ar)=>{Rt||(Rt=Ri,$t=ar,Di())},void 0,!1,oi):$t={};let Dn=Object.keys(mt.iconDependencies);Dn.length?be.send("getImages",{icons:Dn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ri,ar)=>{Rt||(Rt=Ri,fi=ar,Di())},void 0,!1,oi):fi={};let en=Object.keys(mt.patternDependencies);en.length?be.send("getImages",{icons:en,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ri,ar)=>{Rt||(Rt=Ri,vi=ar,Di())},void 0,!1,oi):vi={}}Di()}}function de(Se,G,K,ce){let be=new t.X(G,{brightness:K});for(let ye of Se)ye.recalculate(be,ce)}class xe extends t.E{constructor(G,K,ce,be,ye,De){super(),this.actor=G,this.layerIndex=K,this.availableImages=ce,this.loadVectorData=ye||t.ap,this.loading={},this.loaded={},this.deduped=new t.ao(G.scheduler),this.isSpriteLoaded=be,this.scheduler=G.scheduler,this.brightness=De}loadTile(G,K){let ce=G.uid,be=G&&G.request,ye=be&&be.collectResourceTiming,De=this.loading[ce]=new ie(G);De.abort=this.loadVectorData(G,(Ne,Te)=>{let je=!this.loading[ce];if(delete this.loading[ce],je||Ne||!Te)return De.status="done",je||(this.loaded[ce]=De),K(Ne);let mt=Te.rawData,st={};Te.expires&&(st.expires=Te.expires),Te.cacheControl&&(st.cacheControl=Te.cacheControl),De.vectorTile=Te.vectorTile||new t.dV(new t.dW(mt));let Rt=()=>{De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,($t,fi)=>{if($t||!fi)return K($t);let vi={};if(ye){let oi=g(be);oi.length>0&&(vi.resourceTiming=JSON.parse(JSON.stringify(oi)))}K(null,t.W({rawTileData:mt.slice(0)},fi,st,vi))})};this.isSpriteLoaded?Rt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Rt,{type:"parseTile",isSymbolTile:G.isSymbolTile,zoom:G.tileZoom}):Rt()}),this.loaded=this.loaded||{},this.loaded[ce]=De})}reloadTile(G,K){let ce=this.loaded,be=G.uid;if(ce&&ce[be]){let ye=ce[be];ye.showCollisionBoxes=G.showCollisionBoxes,ye.projection=G.projection,ye.brightness=G.brightness,ye.tileTransform=t.dK(G.tileID.canonical,G.projection),ye.extraShadowCaster=G.extraShadowCaster,ye.lut=G.lut;let De=(Ne,Te)=>{let je=ye.reloadCallback;je&&(delete ye.reloadCallback,ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,je)),K(Ne,Te)};ye.status==="parsing"?ye.reloadCallback=De:ye.status==="done"&&(ye.vectorTile?ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,De):De())}else K(null,void 0)}abortTile(G,K){let ce=G.uid,be=this.loading[ce];be&&(be.abort&&be.abort(),delete this.loading[ce]),K()}removeTile(G,K){let ce=this.loaded,be=G.uid;ce&&ce[be]&&delete ce[be],K()}}class Ie{loadTile(G,K){let{uid:ce,encoding:be,rawImageData:ye,padding:De}=G,Ne=ImageBitmap&&ye instanceof ImageBitmap?this.getImageData(ye,De):ye;K(null,new t.dX(ce,Ne,be,De<1))}getImageData(G,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);let ce=this.offscreenCanvasContext.getImageData(-K,-K,G.width+2*K,G.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}class Me{decodeRasterArray({task:G,buffer:K},ce){t.dY.performDecoding(K,G).then(be=>{ce(null,be)},be=>{ce(be)})}}let Ge=t.dZ.prototype.toGeoJSON,He=class{constructor(Se){this._feature=Se,this.extent=t.a3,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){let Se=[];for(let G of this._feature.geometry)Se.push([new t.P(G[0],G[1])]);return Se}{let Se=[];for(let G of this._feature.geometry){let K=[];for(let ce of G)K.push(new t.P(ce[0],ce[1]));Se.push(K)}return Se}}toGeoJSON(Se,G,K){return Ge.call(this,Se,G,K)}},ht=class{constructor(Se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.a3,this.length=Se.length,this._features=Se}feature(Se){return new He(this._features[Se])}},Mt=64/4096;class yt{constructor(){this.features=new Map}clear(){this.features.clear()}load(G=[],K){for(let ce of G){let be=ce.id;if(be==null)continue;let ye=this.features.get(be);ye&&this.updateCache(ye,K),ce.geometry?(ye=Wt(ce),this.updateCache(ye,K),this.features.set(be,ye)):this.features.delete(be),this.updateCache(ye,K)}}updateCache(G,K){for(let{canonical:ce,uid:be}of Object.values(K)){let{z:ye,x:De,y:Ne}=ce;Tt(G,Math.pow(2,ye),De,Ne)&&delete K[be]}}getTile(G,K,ce){let be=Math.pow(2,G),ye=[];for(let De of this.features.values())Tt(De,be,K,ce)&&ye.push(Ti(De,be,K,ce));return{features:ye}}getFeatures(){return[...this.features.values()]}}function Tt({minX:Se,minY:G,maxX:K,maxY:ce},be,ye,De){return Se<(ye+1+Mt)/be&&G<(De+1+Mt)/be&&K>(ye-Mt)/be&&ce>(De-Mt)/be}function Wt(Se){let{id:G,geometry:K,properties:ce}=Se;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:be,coordinates:ye}=K,De={id:G,type:1,geometry:[],tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ne=De.geometry;if(be==="Point")Ct(ye,Ne,De);else if(be==="MultiPoint")for(let Te of ye)Ct(Te,Ne,De);else if(be==="LineString")De.type=2,Yt(ye,Ne,De);else if(be==="MultiLineString")De.type=2,zt(ye,Ne,De);else if(be==="Polygon")De.type=3,zt(ye,Ne,De,!0);else{if(be!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");De.type=3;for(let Te of ye)zt(Te,Ne,De,!0)}return De}function Ct([Se,G],K,ce){let be=t.aj(Se),ye=t.ak(G);ye=ye<0?0:ye>1?1:ye,K.push(be,ye),ce.minX=Math.min(ce.minX,be),ce.minY=Math.min(ce.minY,ye),ce.maxX=Math.max(ce.maxX,be),ce.maxY=Math.max(ce.maxY,ye)}function Yt(Se,G,K,ce=!1,be=!1){let ye=[];for(let De of Se)Ct(De,ye,K);G.push(ye),ce&&function(De,Ne){let Te=0;for(let je=0,mt=De.length,st=mt-2;je<mt;st=je,je+=2)Te+=(De[je]-De[st])*(De[je+1]+De[st+1]);if(Te>0===Ne)for(let je=0,mt=De.length;je<mt/2;je+=2){let st=De[je],Rt=De[je+1];De[je]=De[mt-2-je],De[je+1]=De[mt-1-je],De[mt-2-je]=st,De[mt-1-je]=Rt}}(ye,be)}function zt(Se,G,K,ce=!1){for(let be=0;be<Se.length;be++)Yt(Se[be],G,K,ce,be===0)}function Ti(Se,G,K,ce){let{id:be,type:ye,geometry:De,tags:Ne}=Se,Te=[];if(ye===1)Hi(De,G,K,ce,Te);else for(let je of De)Te.push(Hi(je,G,K,ce));return{id:be,type:ye,geometry:Te,tags:Ne}}function Hi(Se,G,K,ce,be=[]){for(let ye=0;ye<Se.length;ye+=2)be.push(_r(Se[ye],Se[ye+1],G,K,ce));return be}function _r(Se,G,K,ce,be){return[Math.round(t.a3*(Se*K-ce)),Math.round(t.a3*(G*K-be))]}var Ci={exports:{}},mn=t.d$,rn=t.d_.VectorTileFeature,Yn=Zr;function Zr(Se,G){this.options=G||{},this.features=Se,this.length=Se.length}function rr(Se,G){this.id=typeof Se.id=="number"?Se.id:void 0,this.type=Se.type,this.rawGeometry=Se.type===1?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=G||4096}Zr.prototype.feature=function(Se){return new rr(this.features[Se],this.options.extent)},rr.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var G=0;G<Se.length;G++){for(var K=Se[G],ce=[],be=0;be<K.length;be++)ce.push(new mn(K[be][0],K[be][1]));this.geometry.push(ce)}return this.geometry},rr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,G=1/0,K=-1/0,ce=1/0,be=-1/0,ye=0;ye<Se.length;ye++)for(var De=Se[ye],Ne=0;Ne<De.length;Ne++){var Te=De[Ne];G=Math.min(G,Te.x),K=Math.max(K,Te.x),ce=Math.min(ce,Te.y),be=Math.max(be,Te.y)}return[G,ce,K,be]},rr.prototype.toGeoJSON=rn.prototype.toGeoJSON;var Ei=t.e0,ga=Yn;function or(Se){var G=new Ei;return function(K,ce){for(var be in K.layers)ce.writeMessage(3,La,K.layers[be])}(Se,G),G.finish()}function La(Se,G){var K;G.writeVarintField(15,Se.version||1),G.writeStringField(1,Se.name||""),G.writeVarintField(5,Se.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<Se.length;K++)ce.feature=Se.feature(K),G.writeMessage(2,Go,ce);var be=ce.keys;for(K=0;K<be.length;K++)G.writeStringField(3,be[K]);var ye=ce.values;for(K=0;K<ye.length;K++)G.writeMessage(4,vu,ye[K])}function Go(Se,G){var K=Se.feature;K.id!==void 0&&G.writeVarintField(1,K.id),G.writeMessage(2,Fa,Se),G.writeVarintField(3,K.type),G.writeMessage(4,En,K)}function Fa(Se,G){var K=Se.feature,ce=Se.keys,be=Se.values,ye=Se.keycache,De=Se.valuecache;for(var Ne in K.properties){var Te=K.properties[Ne],je=ye[Ne];if(Te!==null){je===void 0&&(ce.push(Ne),ye[Ne]=je=ce.length-1),G.writeVarint(je);var mt=typeof Te;mt!=="string"&&mt!=="boolean"&&mt!=="number"&&(Te=JSON.stringify(Te));var st=mt+":"+Te,Rt=De[st];Rt===void 0&&(be.push(Te),De[st]=Rt=be.length-1),G.writeVarint(Rt)}}}function Gt(Se,G){return(G<<3)+(7&Se)}function fc(Se){return Se<<1^Se>>31}function En(Se,G){for(var K=Se.loadGeometry(),ce=Se.type,be=0,ye=0,De=K.length,Ne=0;Ne<De;Ne++){var Te=K[Ne],je=1;ce===1&&(je=Te.length),G.writeVarint(Gt(1,je));for(var mt=ce===3?Te.length-1:Te.length,st=0;st<mt;st++){st===1&&ce!==1&&G.writeVarint(Gt(2,mt-1));var Rt=Te[st].x-be,$t=Te[st].y-ye;G.writeVarint(fc(Rt)),G.writeVarint(fc($t)),be+=Rt,ye+=$t}ce===3&&G.writeVarint(Gt(7,1))}}function vu(Se,G){var K=typeof Se;K==="string"?G.writeStringField(1,Se):K==="boolean"?G.writeBooleanField(7,Se):K==="number"&&(Se%1!=0?G.writeDoubleField(3,Se):Se<0?G.writeSVarintField(6,Se):G.writeVarintField(5,Se))}Ci.exports=or,Ci.exports.fromVectorTileJs=or,Ci.exports.fromGeojsonVt=function(Se,G){G=G||{};var K={};for(var ce in Se)K[ce]=new ga(Se[ce].features,G),K[ce].name=ce,K[ce].version=G.version,K[ce].extent=G.extent;return or({layers:K})},Ci.exports.GeoJSONWrapper=ga;var xu=t.e1(Ci.exports);let wu={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},$d=Math.fround||(gc=new Float32Array(1),Se=>(gc[0]=+Se,gc[0]));var gc;let _a=3,ba=5,Yd=6;class Qt{constructor(G){this.options=Object.assign(Object.create(wu),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){let{log:K,minZoom:ce,maxZoom:be}=this.options;K&&console.time("total time");let ye=`prepare ${G.length} points`;K&&console.time(ye),this.points=G;let De=[];for(let Te=0;Te<G.length;Te++){let je=G[Te];if(!je.geometry)continue;let[mt,st]=je.geometry.coordinates,Rt=$d(So(mt)),$t=$d(yl(st));De.push(Rt,$t,1/0,Te,-1,1),this.options.reduce&&De.push(0)}let Ne=this.trees[be+1]=this._createTree(De);K&&console.timeEnd(ye);for(let Te=be;Te>=ce;Te--){let je=+Date.now();Ne=this.trees[Te]=this._createTree(this._cluster(Ne,Te)),K&&console.log("z%d: %d clusters in %dms",Te,Ne.numItems,+Date.now()-je)}return K&&console.timeEnd("total time"),this}getClusters(G,K){let ce=((G[0]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,G[1])),ye=G[2]===180?180:((G[2]+180)%360+360)%360-180,De=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ce=-180,ye=180;else if(ce>ye){let st=this.getClusters([ce,be,180,De],K),Rt=this.getClusters([-180,be,ye,De],K);return st.concat(Rt)}let Ne=this.trees[this._limitZoom(K)],Te=Ne.range(So(ce),yl(De),So(ye),yl(be)),je=Ne.data,mt=[];for(let st of Te){let Rt=this.stride*st;mt.push(je[Rt+ba]>1?Jt(je,Rt,this.clusterProps):this.points[je[Rt+_a]])}return mt}getChildren(G){let K=this._getOriginId(G),ce=this._getOriginZoom(G),be="No cluster with the specified id.",ye=this.trees[ce];if(!ye)throw new Error(be);let De=ye.data;if(K*this.stride>=De.length)throw new Error(be);let Ne=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Te=ye.within(De[K*this.stride],De[K*this.stride+1],Ne),je=[];for(let mt of Te){let st=mt*this.stride;De[st+4]===G&&je.push(De[st+ba]>1?Jt(De,st,this.clusterProps):this.points[De[st+_a]])}if(je.length===0)throw new Error(be);return je}getLeaves(G,K,ce){let be=[];return this._appendLeaves(be,G,K=K||10,ce=ce||0,0),be}getTile(G,K,ce){let be=this.trees[this._limitZoom(G)],ye=Math.pow(2,G),{extent:De,radius:Ne}=this.options,Te=Ne/De,je=(ce-Te)/ye,mt=(ce+1+Te)/ye,st={features:[]};return this._addTileFeatures(be.range((K-Te)/ye,je,(K+1+Te)/ye,mt),be.data,K,ce,ye,st),K===0&&this._addTileFeatures(be.range(1-Te/ye,je,1,mt),be.data,ye,ce,ye,st),K===ye-1&&this._addTileFeatures(be.range(0,je,Te/ye,mt),be.data,-1,ce,ye,st),st.features.length?st:null}getClusterExpansionZoom(G){let K=this._getOriginZoom(G)-1;for(;K<=this.options.maxZoom;){let ce=this.getChildren(G);if(K++,ce.length!==1)break;G=ce[0].properties.cluster_id}return K}_appendLeaves(G,K,ce,be,ye){let De=this.getChildren(K);for(let Ne of De){let Te=Ne.properties;if(Te&&Te.cluster?ye+Te.point_count<=be?ye+=Te.point_count:ye=this._appendLeaves(G,Te.cluster_id,ce,be,ye):ye<be?ye++:G.push(Ne),G.length===ce)break}return ye}_createTree(G){let K=new t.cK(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<G.length;ce+=this.stride)K.add(G[ce],G[ce+1]);return K.finish(),K.data=G,K}_addTileFeatures(G,K,ce,be,ye,De){for(let Ne of G){let Te=Ne*this.stride,je=K[Te+ba]>1,mt,st,Rt;if(je)mt=_c(K,Te,this.clusterProps),st=K[Te],Rt=K[Te+1];else{let vi=this.points[K[Te+_a]];mt=vi.properties;let[oi,Di]=vi.geometry.coordinates;st=So(oi),Rt=yl(Di)}let $t={type:1,geometry:[[Math.round(this.options.extent*(st*ye-ce)),Math.round(this.options.extent*(Rt*ye-be))]],tags:mt},fi;fi=je||this.options.generateId?K[Te+_a]:this.points[K[Te+_a]].id,fi!==void 0&&($t.id=fi),De.features.push($t)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,K){let{radius:ce,extent:be,reduce:ye,minPoints:De}=this.options,Ne=ce/(be*Math.pow(2,K)),Te=G.data,je=[],mt=this.stride;for(let st=0;st<Te.length;st+=mt){if(Te[st+2]<=K)continue;Te[st+2]=K;let Rt=Te[st],$t=Te[st+1],fi=G.within(Te[st],Te[st+1],Ne),vi=Te[st+ba],oi=vi;for(let Di of fi){let At=Di*mt;Te[At+2]>K&&(oi+=Te[At+ba])}if(oi>vi&&oi>=De){let Di,At=Rt*vi,Dn=$t*vi,en=-1,Ri=(st/mt<<5)+(K+1)+this.points.length;for(let ar of fi){let An=ar*mt;if(Te[An+2]<=K)continue;Te[An+2]=K;let br=Te[An+ba];At+=Te[An]*br,Dn+=Te[An+1]*br,Te[An+4]=Ri,ye&&(Di||(Di=this._map(Te,st,!0),en=this.clusterProps.length,this.clusterProps.push(Di)),ye(Di,this._map(Te,An)))}Te[st+4]=Ri,je.push(At/oi,Dn/oi,1/0,Ri,-1,oi),ye&&je.push(en)}else{for(let Di=0;Di<mt;Di++)je.push(Te[st+Di]);if(oi>1)for(let Di of fi){let At=Di*mt;if(!(Te[At+2]<=K)){Te[At+2]=K;for(let Dn=0;Dn<mt;Dn++)je.push(Te[At+Dn])}}}}return je}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,K,ce){if(G[K+ba]>1){let De=this.clusterProps[G[K+Yd]];return ce?Object.assign({},De):De}let be=this.points[G[K+_a]].properties,ye=this.options.map(be);return ce&&ye===be?Object.assign({},ye):ye}}function Jt(Se,G,K){return{type:"Feature",id:Se[G+_a],properties:_c(Se,G,K),geometry:{type:"Point",coordinates:[(ce=Se[G],360*(ce-.5)),bc(Se[G+1])]}};var ce}function _c(Se,G,K){let ce=Se[G+ba],be=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,ye=Se[G+Yd],De=ye===-1?{}:Object.assign({},K[ye]);return Object.assign(De,{cluster:!0,cluster_id:Se[G+_a],point_count:ce,point_count_abbreviated:be})}function So(Se){return Se/360+.5}function yl(Se){let G=Math.sin(Se*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function bc(Se){let G=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function yc(Se,G,K,ce){let be=ce,ye=G+(K-G>>1),De,Ne=K-G,Te=Se[G],je=Se[G+1],mt=Se[K],st=Se[K+1];for(let Rt=G+3;Rt<K;Rt+=3){let $t=Zd(Se[Rt],Se[Rt+1],Te,je,mt,st);if($t>be)De=Rt,be=$t;else if($t===be){let fi=Math.abs(Rt-ye);fi<Ne&&(De=Rt,Ne=fi)}}be>ce&&(De-G>3&&yc(Se,G,De,ce),Se[De+2]=be,K-De>3&&yc(Se,De,K,ce))}function Zd(Se,G,K,ce,be,ye){let De=be-K,Ne=ye-ce;if(De!==0||Ne!==0){let Te=((Se-K)*De+(G-ce)*Ne)/(De*De+Ne*Ne);Te>1?(K=be,ce=ye):Te>0&&(K+=De*Te,ce+=Ne*Te)}return De=Se-K,Ne=G-ce,De*De+Ne*Ne}function Vs(Se,G,K,ce){let be={id:Se??null,type:G,geometry:K,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")vl(be,K);else if(G==="Polygon")vl(be,K[0]);else if(G==="MultiLineString")for(let ye of K)vl(be,ye);else if(G==="MultiPolygon")for(let ye of K)vl(be,ye[0]);return be}function vl(Se,G){for(let K=0;K<G.length;K+=3)Se.minX=Math.min(Se.minX,G[K]),Se.minY=Math.min(Se.minY,G[K+1]),Se.maxX=Math.max(Se.maxX,G[K]),Se.maxY=Math.max(Se.maxY,G[K+1])}function vc(Se,G,K,ce){if(!G.geometry)return;let be=G.geometry.coordinates;if(be&&be.length===0)return;let ye=G.geometry.type,De=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),Ne=[],Te=G.id;if(K.promoteId?Te=G.properties[K.promoteId]:K.generateId&&(Te=ce||0),ye==="Point")Xd(be,Ne);else if(ye==="MultiPoint")for(let je of be)Xd(je,Ne);else if(ye==="LineString")xc(be,Ne,De,!1);else if(ye==="MultiLineString"){if(K.lineMetrics){for(let je of be)Ne=[],xc(je,Ne,De,!1),Se.push(Vs(Te,"LineString",Ne,G.properties));return}wc(be,Ne,De,!1)}else if(ye==="Polygon")wc(be,Ne,De,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(let je of G.geometry.geometries)vc(Se,{id:Te,geometry:je,properties:G.properties},K,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let je of be){let mt=[];wc(je,mt,De,!0),Ne.push(mt)}}Se.push(Vs(Te,ye,Ne,G.properties))}function Xd(Se,G){G.push(qo(Se[0]),Cu(Se[1]),0)}function xc(Se,G,K,ce){let be,ye,De=0;for(let Te=0;Te<Se.length;Te++){let je=qo(Se[Te][0]),mt=Cu(Se[Te][1]);G.push(je,mt,0),Te>0&&(De+=ce?(be*mt-je*ye)/2:Math.sqrt(Math.pow(je-be,2)+Math.pow(mt-ye,2))),be=je,ye=mt}let Ne=G.length-3;G[2]=1,yc(G,0,Ne,K),G[Ne+2]=1,G.size=Math.abs(De),G.start=0,G.end=G.size}function wc(Se,G,K,ce){for(let be=0;be<Se.length;be++){let ye=[];xc(Se[be],ye,K,ce),G.push(ye)}}function qo(Se){return Se/360+.5}function Cu(Se){let G=Math.sin(Se*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function ei(Se,G,K,ce,be,ye,De,Ne){if(ce/=G,ye>=(K/=G)&&De<ce)return Se;if(De<K||ye>=ce)return null;let Te=[];for(let je of Se){let mt=je.geometry,st=je.type,Rt=be===0?je.minX:je.minY,$t=be===0?je.maxX:je.maxY;if(Rt>=K&&$t<ce){Te.push(je);continue}if($t<K||Rt>=ce)continue;let fi=[];if(st==="Point"||st==="MultiPoint")Qd(mt,fi,K,ce,be);else if(st==="LineString")Zn(mt,fi,K,ce,be,!1,Ne.lineMetrics);else if(st==="MultiLineString")xl(mt,fi,K,ce,be,!1);else if(st==="Polygon")xl(mt,fi,K,ce,be,!0);else if(st==="MultiPolygon")for(let vi of mt){let oi=[];xl(vi,oi,K,ce,be,!0),oi.length&&fi.push(oi)}if(fi.length){if(Ne.lineMetrics&&st==="LineString"){for(let vi of fi)Te.push(Vs(je.id,st,vi,je.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(fi.length===1?(st="LineString",fi=fi[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=fi.length===3?"Point":"MultiPoint"),Te.push(Vs(je.id,st,fi,je.tags))}}return Te.length?Te:null}function Qd(Se,G,K,ce,be){for(let ye=0;ye<Se.length;ye+=3){let De=Se[ye+be];De>=K&&De<=ce&&za(G,Se[ye],Se[ye+1],Se[ye+2])}}function Zn(Se,G,K,ce,be,ye,De){let Ne=Cc(Se),Te=be===0?Ba:Kd,je,mt,st=Se.start;for(let oi=0;oi<Se.length-3;oi+=3){let Di=Se[oi],At=Se[oi+1],Dn=Se[oi+2],en=Se[oi+3],Ri=Se[oi+4],ar=be===0?Di:At,An=be===0?en:Ri,br=!1;De&&(je=Math.sqrt(Math.pow(Di-en,2)+Math.pow(At-Ri,2))),ar<K?An>K&&(mt=Te(Ne,Di,At,en,Ri,K),De&&(Ne.start=st+je*mt)):ar>ce?An<ce&&(mt=Te(Ne,Di,At,en,Ri,ce),De&&(Ne.start=st+je*mt)):za(Ne,Di,At,Dn),An<K&&ar>=K&&(mt=Te(Ne,Di,At,en,Ri,K),br=!0),An>ce&&ar<=ce&&(mt=Te(Ne,Di,At,en,Ri,ce),br=!0),!ye&&br&&(De&&(Ne.end=st+je*mt),G.push(Ne),Ne=Cc(Se)),De&&(st+=je)}let Rt=Se.length-3,$t=Se[Rt],fi=Se[Rt+1],vi=be===0?$t:fi;vi>=K&&vi<=ce&&za(Ne,$t,fi,Se[Rt+2]),Rt=Ne.length-3,ye&&Rt>=3&&(Ne[Rt]!==Ne[0]||Ne[Rt+1]!==Ne[1])&&za(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&G.push(Ne)}function Cc(Se){let G=[];return G.size=Se.size,G.start=Se.start,G.end=Se.end,G}function xl(Se,G,K,ce,be,ye){for(let De of Se)Zn(De,G,K,ce,be,ye,!1)}function za(Se,G,K,ce){Se.push(G,K,ce)}function Ba(Se,G,K,ce,be,ye){let De=(ye-G)/(ce-G);return za(Se,ye,K+(be-K)*De,1),De}function Kd(Se,G,K,ce,be,ye){let De=(ye-K)/(be-K);return za(Se,G+(ce-G)*De,ye,1),De}function js(Se,G){let K=[];for(let ce=0;ce<Se.length;ce++){let be=Se[ce],ye=be.type,De;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")De=Us(be.geometry,G);else if(ye==="MultiLineString"||ye==="Polygon"){De=[];for(let Ne of be.geometry)De.push(Us(Ne,G))}else if(ye==="MultiPolygon"){De=[];for(let Ne of be.geometry){let Te=[];for(let je of Ne)Te.push(Us(je,G));De.push(Te)}}K.push(Vs(be.id,ye,De,be.tags))}return K}function Us(Se,G){let K=[];K.size=Se.size,Se.start!==void 0&&(K.start=Se.start,K.end=Se.end);for(let ce=0;ce<Se.length;ce+=3)K.push(Se[ce]+G,Se[ce+1],Se[ce+2]);return K}function Sc(Se,G){if(Se.transformed)return Se;let K=1<<Se.z,ce=Se.x,be=Se.y;for(let ye of Se.features){let De=ye.geometry,Ne=ye.type;if(ye.geometry=[],Ne===1)for(let Te=0;Te<De.length;Te+=2)ye.geometry.push(Mc(De[Te],De[Te+1],G,K,ce,be));else for(let Te=0;Te<De.length;Te++){let je=[];for(let mt=0;mt<De[Te].length;mt+=2)je.push(Mc(De[Te][mt],De[Te][mt+1],G,K,ce,be));ye.geometry.push(je)}}return Se.transformed=!0,Se}function Mc(Se,G,K,ce,be,ye){return[Math.round(K*(Se*ce-be)),Math.round(K*(G*ce-ye))]}function Su(Se,G,K,ce,be){let ye=G===be.maxZoom?0:be.tolerance/((1<<G)*be.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:Se.length,source:null,x:K,y:ce,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ne of Se)kc(De,Ne,ye,be);return De}function kc(Se,G,K,ce){let be=G.geometry,ye=G.type,De=[];if(Se.minX=Math.min(Se.minX,G.minX),Se.minY=Math.min(Se.minY,G.minY),Se.maxX=Math.max(Se.maxX,G.maxX),Se.maxY=Math.max(Se.maxY,G.maxY),ye==="Point"||ye==="MultiPoint")for(let Ne=0;Ne<be.length;Ne+=3)De.push(be[Ne],be[Ne+1]),Se.numPoints++,Se.numSimplified++;else if(ye==="LineString")$o(De,be,Se,K,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let Ne=0;Ne<be.length;Ne++)$o(De,be[Ne],Se,K,ye==="Polygon",Ne===0);else if(ye==="MultiPolygon")for(let Ne=0;Ne<be.length;Ne++){let Te=be[Ne];for(let je=0;je<Te.length;je++)$o(De,Te[je],Se,K,!0,je===0)}if(De.length){let Ne=G.tags||null;if(ye==="LineString"&&ce.lineMetrics){Ne={};for(let je in G.tags)Ne[je]=G.tags[je];Ne.mapbox_clip_start=be.start/be.size,Ne.mapbox_clip_end=be.end/be.size}let Te={geometry:De,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Ne};G.id!==null&&(Te.id=G.id),Se.features.push(Te)}}function $o(Se,G,K,ce,be,ye){let De=ce*ce;if(ce>0&&G.size<(be?De:ce))return void(K.numPoints+=G.length/3);let Ne=[];for(let Te=0;Te<G.length;Te+=3)(ce===0||G[Te+2]>De)&&(K.numSimplified++,Ne.push(G[Te],G[Te+1])),K.numPoints++;be&&function(Te,je){let mt=0;for(let st=0,Rt=Te.length,$t=Rt-2;st<Rt;$t=st,st+=2)mt+=(Te[st]-Te[$t])*(Te[st+1]+Te[$t+1]);if(mt>0===je)for(let st=0,Rt=Te.length;st<Rt/2;st+=2){let $t=Te[st],fi=Te[st+1];Te[st]=Te[Rt-2-st],Te[st+1]=Te[Rt-1-st],Te[Rt-2-st]=$t,Te[Rt-1-st]=fi}}(Ne,ye),Se.push(Ne)}let Ws={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Yo{constructor(G,K){let ce=(K=this.options=function(ye,De){for(let Ne in De)ye[Ne]=De[Ne];return ye}(Object.create(Ws),K)).debug;if(ce&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let be=function(ye,De){let Ne=[];if(ye.type==="FeatureCollection")for(let Te=0;Te<ye.features.length;Te++)vc(Ne,ye.features[Te],De,Te);else vc(Ne,ye.type==="Feature"?ye:{geometry:ye},De);return Ne}(G,K);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),be=function(ye,De){let Ne=De.buffer/De.extent,Te=ye,je=ei(ye,1,-1-Ne,Ne,0,-1,2,De),mt=ei(ye,1,1-Ne,2+Ne,0,-1,2,De);return(je||mt)&&(Te=ei(ye,1,-Ne,1+Ne,0,-1,2,De)||[],je&&(Te=js(je,1).concat(Te)),mt&&(Te=Te.concat(js(mt,-1)))),Te}(be,K),be.length&&this.splitTile(be,0,0,0),ce&&(be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,K,ce,be,ye,De,Ne){let Te=[G,K,ce,be],je=this.options,mt=je.debug;for(;Te.length;){be=Te.pop(),ce=Te.pop(),K=Te.pop(),G=Te.pop();let st=1<<K,Rt=Vr(K,ce,be),$t=this.tiles[Rt];if(!$t&&(mt>1&&console.time("creation"),$t=this.tiles[Rt]=Su(G,K,ce,be,je),this.tileCoords.push({z:K,x:ce,y:be}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ce,be,$t.numFeatures,$t.numPoints,$t.numSimplified),console.timeEnd("creation"));let br=`z${K}`;this.stats[br]=(this.stats[br]||0)+1,this.total++}if($t.source=G,ye==null){if(K===je.indexMaxZoom||$t.numPoints<=je.indexMaxPoints)continue}else{if(K===je.maxZoom||K===ye)continue;if(ye!=null){let br=ye-K;if(ce!==De>>br||be!==Ne>>br)continue}}if($t.source=null,G.length===0)continue;mt>1&&console.time("clipping");let fi=.5*je.buffer/je.extent,vi=.5-fi,oi=.5+fi,Di=1+fi,At=null,Dn=null,en=null,Ri=null,ar=ei(G,st,ce-fi,ce+oi,0,$t.minX,$t.maxX,je),An=ei(G,st,ce+vi,ce+Di,0,$t.minX,$t.maxX,je);G=null,ar&&(At=ei(ar,st,be-fi,be+oi,1,$t.minY,$t.maxY,je),Dn=ei(ar,st,be+vi,be+Di,1,$t.minY,$t.maxY,je),ar=null),An&&(en=ei(An,st,be-fi,be+oi,1,$t.minY,$t.maxY,je),Ri=ei(An,st,be+vi,be+Di,1,$t.minY,$t.maxY,je),An=null),mt>1&&console.timeEnd("clipping"),Te.push(At||[],K+1,2*ce,2*be),Te.push(Dn||[],K+1,2*ce,2*be+1),Te.push(en||[],K+1,2*ce+1,2*be),Te.push(Ri||[],K+1,2*ce+1,2*be+1)}}getTile(G,K,ce){G=+G,K=+K,ce=+ce;let be=this.options,{extent:ye,debug:De}=be;if(G<0||G>24)return null;let Ne=1<<G,Te=Vr(G,K=K+Ne&Ne-1,ce);if(this.tiles[Te])return Sc(this.tiles[Te],ye);De>1&&console.log("drilling down to z%d-%d-%d",G,K,ce);let je,mt=G,st=K,Rt=ce;for(;!je&&mt>0;)mt--,st>>=1,Rt>>=1,je=this.tiles[Vr(mt,st,Rt)];return je&&je.source?(De>1&&(console.log("found parent tile z%d-%d-%d",mt,st,Rt),console.time("drilling down")),this.splitTile(je.source,mt,st,Rt,G,K,ce),De>1&&console.timeEnd("drilling down"),this.tiles[Te]?Sc(this.tiles[Te],ye):null):null}}function Vr(Se,G,K){return 32*((1<<Se)*K+G)+Se}function Mu(Se,G){let K=Se.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);let ce=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ce)return G(null,null);let be=new ht(ce.features),ye=xu(be);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),G(null,{vectorTile:be,rawData:ye.buffer})}class wl extends xe{constructor(G,K,ce,be,ye,De){super(G,K,ce,be,Mu,De),ye&&(this.loadGeoJSON=ye),this._dynamicIndex=new yt}loadData(G,K){let ce=G&&G.request,be=ce&&ce.collectResourceTiming;this.loadGeoJSON(G,(ye,De)=>{if(ye||!De)return K(ye);if(typeof De!="object")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{try{if(G.filter){let Te=t.y(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Te.result==="error")throw new Error(Te.value.map(je=>`${je.key}: ${je.message}`).join(", "));De.features=De.features.filter(je=>Te.value.evaluate({zoom:0},je))}G.dynamic?(De.type==="Feature"&&(De={type:"FeatureCollection",features:[De]}),G.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(De.features,this.loaded),G.cluster&&(De.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=G.cluster?new Qt(function({superclusterOptions:Te,clusterProperties:je}){if(!je||!Te)return Te;let mt={},st={},Rt={accumulated:null,zoom:0},$t={properties:null},fi=Object.keys(je);for(let vi of fi){let[oi,Di]=je[vi],At=t.y(Di),Dn=t.y(typeof oi=="string"?[oi,["accumulated"],["get",vi]]:oi);mt[vi]=At.value,st[vi]=Dn.value}return Te.map=vi=>{$t.properties=vi;let oi={};for(let Di of fi)oi[Di]=mt[Di].evaluate(Rt,$t);return oi},Te.reduce=(vi,oi)=>{$t.properties=oi;for(let Di of fi)Rt.accumulated=vi[Di],vi[Di]=st[Di].evaluate(Rt,$t)},Te}(G)).load(De.features):G.dynamic?this._dynamicIndex:function(Te,je){return new Yo(Te,je)}(De,G.geojsonVtOptions)}catch(Te){return K(Te)}let Ne={};if(be){let Te=g(ce);Te&&(Ne.resourceTiming={},Ne.resourceTiming[G.source]=JSON.parse(JSON.stringify(Te)))}K(null,Ne)}})}reloadTile(G,K){let ce=this.loaded;return ce&&ce[G.uid]?G.partial?K(null,void 0):super.reloadTile(G,K):this.loadTile(G,K)}loadGeoJSON(G,K){if(G.request)t.g(G.request,K);else{if(typeof G.data!="string")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(G.data))}catch{return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(ce){K(ce)}}getClusterChildren(G,K){try{K(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(ce){K(ce)}}getClusterLeaves(G,K){try{K(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(ce){K(ce)}}}class Ic{constructor(G,K){this.tileID=new t.aL(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=G.projection,this.brightness=K}parse(G,K,ce,be){this.status="parsing";let ye=new t.aL(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),De={},Ne=K.familiesBySource[ce.source],Te=new t.dN(ye,ce.promoteId);return Te.bucketLayerIDs=[],Te.is3DTile=!0,t.e3(G).then(je=>{if(!je)return be(new Error("Could not parse tile"));let mt=t.e4(je,1/t.b5(ce.tileID.canonical)),st=je.json.extensionsUsed&&je.json.extensionsUsed.includes("MAPBOX_mesh_features")||je.json.asset.extras&&je.json.asset.extras.MAPBOX_mesh_features,Rt=je.json.extensionsUsed&&je.json.extensionsUsed.includes("EXT_meshopt_compression"),$t=new t.X(this.zoom,{brightness:this.brightness});for(let fi in Ne)for(let vi of Ne[fi]){let oi=vi[0];Te.bucketLayerIDs.push(vi.map(At=>At.id)),oi.recalculate($t,[]);let Di=new t.e5(mt,ye,st,Rt,this.brightness,Te);st||(Di.needsUpload=!0),De[oi.fqid]=Di,Di.evaluate(oi)}this.status="done",be(null,{buckets:De,featureIndex:Te})}).catch(je=>be(new Error(je.message)))}}class Jd{constructor(G,K,ce,be,ye,De){this.actor=G,this.layerIndex=K,this.brightness=De,this.loading={},this.loaded={}}loadTile(G,K){let ce=G.uid,be=this.loading[ce]=new Ic(G,this.brightness);t.e2(G.request,(ye,De)=>{let Ne=!this.loading[ce];return delete this.loading[ce],Ne||ye?(be.status="done",Ne||(this.loaded[ce]=be),K(ye)):De&&De.byteLength!==0?void be.parse(De,this.layerIndex,G,(Te,je)=>{be.status="done",this.loaded=this.loaded||{},this.loaded[ce]=be,Te||!je?K(Te):K(null,je)}):(be.status="done",this.loaded[ce]=be,K())})}reloadTile(G,K){let ce=this.loaded,be=G.uid;if(ce&&ce[be]){let ye=ce[be];ye.projection=G.projection,ye.brightness=G.brightness;let De=(Ne,Te)=>{ye.reloadCallback&&(delete ye.reloadCallback,this.loadTile(G,K)),K(Ne,Te)};ye.status==="parsing"?ye.reloadCallback=De:ye.status==="done"&&this.loadTile(G,K)}}abortTile(G,K){let ce=G.uid;this.loading[ce]&&delete this.loading[ce],K()}removeTile(G,K){let ce=this.loaded,be=G.uid;ce&&ce[be]&&delete ce[be],K()}}class Tc{constructor(G){this.self=G,this.actor=new t.e6(G,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.aJ({name:"mercator"}),this.workerSourceTypes={vector:xe,geojson:wl,"batched-model":Jd},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,ce)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ce},this.self.registerRTLTextPlugin=K=>{if(t.e7.isParsed())throw new Error("RTL text plugin already registered.");t.e7.applyArabicShaping=K.applyArabicShaping,t.e7.processBidirectionalText=K.processBidirectionalText,t.e7.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(G,K,ce){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],delete this.rasterArrayWorkerSource,ce()}checkIfReady(G,K,ce){ce()}setReferrer(G,K){this.referrer=K}spriteLoaded(G,{scope:K,isLoaded:ce}){if(this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),this.isSpriteLoaded[G][K]=ce,this.workerSources[G]&&this.workerSources[G][K])for(let be in this.workerSources[G][K]){let ye=this.workerSources[G][K][be];for(let De in ye){let Ne=ye[De];Ne instanceof xe&&(Ne.isSpriteLoaded=ce,Ne.fire(new t.f("isSpriteLoaded")))}}}setImages(G,{scope:K,images:ce},be){if(this.availableImages[G]||(this.availableImages[G]={}),this.availableImages[G][K]=ce,this.workerSources[G]&&this.workerSources[G][K]){for(let ye in this.workerSources[G][K]){let De=this.workerSources[G][K][ye];for(let Ne in De)De[Ne].availableImages=ce}be()}else be()}setProjection(G,K){this.projections[G]=t.aJ(K)}setBrightness(G,K,ce){this.brightness=K,ce()}setLayers(G,K,ce){this.getLayerIndex(G,K.scope).replace(K.layers,K.options),ce()}updateLayers(G,K,ce){this.getLayerIndex(G,K.scope).update(K.layers,K.removedIds,K.options),ce()}loadTile(G,K,ce){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).loadTile(K,ce)}loadDEMTile(G,K,ce){this.getDEMWorkerSource(G,K.source,K.scope).loadTile(K,ce)}decodeRasterArray(G,K,ce){this.getRasterArrayWorkerSource().decodeRasterArray(K,ce)}reloadTile(G,K,ce){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).reloadTile(K,ce)}abortTile(G,K,ce){this.getWorkerSource(G,K.type,K.source,K.scope).abortTile(K,ce)}removeTile(G,K,ce){this.getWorkerSource(G,K.type,K.source,K.scope).removeTile(K,ce)}removeSource(G,K,ce){if(!(this.workerSources[G]&&this.workerSources[G][K.scope]&&this.workerSources[G][K.scope][K.type]&&this.workerSources[G][K.scope][K.type][K.source]))return;let be=this.workerSources[G][K.scope][K.type][K.source];delete this.workerSources[G][K.scope][K.type][K.source],be.removeSource!==void 0?be.removeSource(K,ce):ce()}loadWorkerSource(G,K,ce){try{this.self.importScripts(K.url),ce()}catch(be){ce(be.toString())}}syncRTLPluginState(G,K,ce){try{t.e7.setState(K);let be=t.e7.getPluginURL();if(t.e7.isLoaded()&&!t.e7.isParsed()&&be!=null){this.self.importScripts(be);let ye=t.e7.isParsed();ce(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${be}`),ye)}}catch(be){ce(be.toString())}}setDracoUrl(G,K){this.dracoUrl=K}getAvailableImages(G,K){this.availableImages[G]||(this.availableImages[G]={});let ce=this.availableImages[G][K];return ce||(ce=[]),ce}getLayerIndex(G,K){this.layerIndexes[G]||(this.layerIndexes[G]={});let ce=this.layerIndexes[G][K];return ce||(ce=this.layerIndexes[G][K]=new O,ce.scope=K),ce}getWorkerSource(G,K,ce,be){return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][be]||(this.workerSources[G][be]={}),this.workerSources[G][be][K]||(this.workerSources[G][be][K]={}),this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),this.workerSources[G][be][K][ce]||(this.workerSources[G][be][K][ce]=new this.workerSourceTypes[K]({send:(ye,De,Ne,Te,je,mt)=>{this.actor.send(ye,De,Ne,G,je,mt)},scheduler:this.actor.scheduler},this.getLayerIndex(G,be),this.getAvailableImages(G,be),this.isSpriteLoaded[G][be],void 0,this.brightness)),this.workerSources[G][be][K][ce]}getDEMWorkerSource(G,K,ce){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][ce]||(this.demWorkerSources[G][ce]={}),this.demWorkerSources[G][ce][K]||(this.demWorkerSources[G][ce][K]=new Ie),this.demWorkerSources[G][ce][K]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Me),this.rasterArrayWorkerSource}enforceCacheSizeLimit(G,K){t.e8(K)}getWorkerPerformanceMetrics(G,K,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Tc(self)),Tc}),r(["./shared"],function(t){function g(f,a){if(Array.isArray(f)){if(!Array.isArray(a)||f.length!==a.length)return!1;for(let u=0;u<f.length;u++)if(!g(f[u],a[u]))return!1;return!0}if(typeof f=="object"&&f!==null&&a!==null){if(typeof a!="object"||Object.keys(f).length!==Object.keys(a).length)return!1;for(let u in f)if(!g(f[u],a[u]))return!1;return!0}return f===a}var C=I;function I(f){return!function(a){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,v,x=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(x);try{v=new Worker(S),_=!0}catch{_=!1}return v&&v.terminate(),URL.revokeObjectURL(S),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var v=_.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===_.width}()?(O[u=a&&a.failIfMajorPerformanceCaveat]===void 0&&(O[u]=function(_){var v,x=function(S){var k=document.createElement("canvas"),D=Object.create(I.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=S,k.getContext("webgl2",D)}(_);if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),x.getShaderParameter(v,x.COMPILE_STATUS)===!0)}(u)),O[u]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var u}(f)}var O={};function z(f,a,u){let _=document.createElement(f);return a!=null&&(_.className=a),u&&u.appendChild(_),_}function q(f,a,u){let _=document.createElementNS("http://www.w3.org/2000/svg",f);for(let v of Object.keys(a))_.setAttributeNS(null,v,String(a[v]));return u&&u.appendChild(_),_}I.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let ie=typeof document<"u"?document.documentElement&&document.documentElement.style:null,de=ie&&ie.userSelect!==void 0?"userSelect":"WebkitUserSelect",xe;function Ie(){ie&&de&&(xe=ie[de],ie[de]="none")}function Me(){ie&&de&&(ie[de]=xe)}function Ge(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Ge,!0)}function He(){window.addEventListener("click",Ge,!0),window.setTimeout(()=>{window.removeEventListener("click",Ge,!0)},0)}function ht(f,a){let u=f.getBoundingClientRect();return Tt(f,u,a)}function Mt(f,a){let u=f.getBoundingClientRect(),_=[];for(let v=0;v<a.length;v++)_.push(Tt(f,u,a[v]));return _}function yt(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function Tt(f,a,u){let _=f.offsetWidth===a.width?1:f.offsetWidth/a.width;return new t.P((u.clientX-a.left)*_,(u.clientY-a.top)*_)}class Wt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(a,u){this._updatedSourceCaches[a]=u,this.setDirty()}discardSourceCacheUpdate(a){delete this._updatedSourceCaches[a]}updateLayer(a){let u=a.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(a.id),this.setDirty()}removeLayer(a){let u=a.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][a.id]=a,this._updatedLayers[u].delete(a.id),this._updatedPaintProps.delete(a.fqid),this.setDirty()}getRemovedLayer(a){return this._removedLayers[a.scope]?this._removedLayers[a.scope][a.id]:null}discardLayerRemoval(a){this._removedLayers[a.scope]&&delete this._removedLayers[a.scope][a.id]}getLayerUpdatesByScope(){let a={};for(let u in this._updatedLayers)a[u]=a[u]||{},a[u].updatedIds=Array.from(this._updatedLayers[u].values());for(let u in this._removedLayers)a[u]=a[u]||{},a[u].removedIds=Object.keys(this._removedLayers[u]);return a}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(a){this._updatedPaintProps.add(a.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(a){this._updatedImages.add(a),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let Ct={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yt{constructor(a,u,_,v,x,S){this.length=u.length,this.attributes=_,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.instanceCount=S,this.context=a;let k=a.gl;this.buffer=k.createBuffer(),a.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||x||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){let u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,u){for(let _=0;_<this.attributes.length;_++){let v=u.attributes[this.attributes[_].name];v!==void 0&&a.enableVertexAttribArray(v)}}setVertexAttribPointers(a,u,_){for(let v=0;v<this.attributes.length;v++){let x=this.attributes[v],S=u.attributes[x.name];S!==void 0&&a.vertexAttribPointer(S,x.components,a[Ct[x.type]],!1,this.itemSize,x.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(a,u,_){for(let v=0;v<this.attributes.length;v++){let x=u.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&a.vertexAttribDivisor(x,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zt{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ti extends zt{getDefault(){return t.C.transparent}set(a){let u=this.current;(a.r!==u.r||a.g!==u.g||a.b!==u.b||a.a!==u.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Hi extends zt{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class _r extends zt{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Ci extends zt{getDefault(){return[!0,!0,!0,!0]}set(a){let u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class mn extends zt{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class rn extends zt{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Yn extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){let u=this.current;(a.func!==u.func||a.ref!==u.ref||a.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Zr extends zt{getDefault(){let a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){let u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class rr extends zt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;a?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=a,this.dirty=!1}}class Ei extends zt{getDefault(){return[0,1]}set(a){let u=this.current;(a[0]!==u[0]||a[1]!==u[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class ga extends zt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;a?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=a,this.dirty=!1}}class or extends zt{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class La extends zt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;a?u.enable(u.BLEND):u.disable(u.BLEND),this.current=a,this.dirty=!1}}class Go extends zt{getDefault(){let a=this.gl;return[a.ONE,a.ZERO,a.ONE,a.ZERO]}set(a){let u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Fa extends zt{getDefault(){return t.C.transparent}set(a){let u=this.current;(a.r!==u.r||a.g!==u.g||a.b!==u.b||a.a!==u.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Gt extends zt{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(a,a),this.current=a,this.dirty=!1)}}class fc extends zt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;a?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=a,this.dirty=!1}}class En extends zt{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class vu extends zt{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let xu=class extends zt{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class wu extends zt{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class $d extends zt{getDefault(){let a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){let u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class gc extends zt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class _a extends zt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class ba extends zt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.bindTexture(u.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class Yd extends zt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Qt extends zt{getDefault(){return null}set(a){let u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Jt extends zt{getDefault(){return null}set(a){this.gl&&(a!==this.current||this.dirty)&&(this.gl.bindVertexArray(a),this.current=a,this.dirty=!1)}}class _c extends zt{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class So extends zt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class yl extends zt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class bc extends zt{constructor(a,u){super(a),this.context=a,this.parent=u}getDefault(){return null}}class yc extends bc{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Zd extends bc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Vs extends bc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class vl extends Zd{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class vc{constructor(a,u,_,v,x){this.context=a,this.width=u,this.height=_;let S=this.framebuffer=a.gl.createFramebuffer();v&&(this.colorAttachment=new yc(a,S)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new Zd(a,S):new Vs(a,S))}destroy(){let a=this.context.gl;if(this.colorAttachment){let u=this.colorAttachment.get();u&&a.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let u=this.depthAttachment.get();u&&a.deleteRenderbuffer(u)}else{let u=this.depthAttachment.get();u&&a.deleteTexture(u)}a.deleteFramebuffer(this.framebuffer)}}class Xd{constructor(a,u){this.gl=a,this.clearColor=new Ti(this),this.clearDepth=new Hi(this),this.clearStencil=new _r(this),this.colorMask=new Ci(this),this.depthMask=new mn(this),this.stencilMask=new rn(this),this.stencilFunc=new Yn(this),this.stencilOp=new Zr(this),this.stencilTest=new rr(this),this.depthRange=new Ei(this),this.depthTest=new ga(this),this.depthFunc=new or(this),this.blend=new La(this),this.blendFunc=new Go(this),this.blendColor=new Fa(this),this.blendEquation=new Gt(this),this.cullFace=new fc(this),this.cullFaceSide=new En(this),this.frontFace=new vu(this),this.program=new xu(this),this.activeTexture=new wu(this),this.viewport=new $d(this),this.bindFramebuffer=new gc(this),this.bindRenderbuffer=new _a(this),this.bindTexture=new ba(this),this.bindVertexBuffer=new Yd(this),this.bindElementBuffer=new Qt(this),this.bindVertexArrayOES=new Jt(this),this.pixelStoreUnpack=new _c(this),this.pixelStoreUnpackPremultiplyAlpha=new So(this),this.pixelStoreUnpackFlipY=new yl(this),this.options=u?Xi({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=a.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),this.maxPointSize=a.getParameter(a.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,u,_){return new t.I(this,a,u,_)}createVertexBuffer(a,u,_,v,x){return new Yt(this,a,u,_,v,x)}createRenderbuffer(a,u,_){let v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,a,u,_),this.bindRenderbuffer.set(null),x}createFramebuffer(a,u,_,v){return new vc(this,a,u,_,v)}clear({color:a,depth:u,stencil:_,colorMask:v}){let x=this.gl,S=0;a&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set(v||[!0,!0,!0,!0])),u!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),_!==void 0&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(S)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){g(a.blendFunction,t.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor),a.blendEquation?this.blendEquation.set(a.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(a.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class xc{constructor(a){this._gl=a.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let a=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,a}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class wc{constructor(a){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,a.registerParameter(this,["Symbols"],"useOcclusionQueries"),a.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),a.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),a.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),a.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),a.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class qo{constructor(a,u,_,v){let x={width:_[0],height:_[1],data:null},S=a.gl;this.targetColorTexture=new t.T(a,x,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new t.T(a,x,S.RGBA,{useMipmap:!1}),this.context=a,this.updateParticleTexture(u,v),this.lastInvalidatedAt=0}updateParticleTexture(a,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let _=this.context.gl,v=u.width*u.height;this.particleTexture0=new t.T(this.context,u,_.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new t.T(this.context,u,_.RGBA,{premultiply:!1,useMipmap:!1});let x=new t.S;x.reserve(v);for(let S=0;S<v;S++)x.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(x,t.p.members,!0),this.particleSegment=t.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(a){return!(this.lastInvalidatedAt<a&&(this.lastInvalidatedAt=t.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class Cu extends t.E{constructor(a){super(),this.requestManager=a,this.models={"":{}},this.numModelsLoading={}}loadModel(a,u){return t.l(this.requestManager.transformRequest(u,t.R.Model).url).then(_=>{if(!_)return;let v=t.c(_),x=new t.M(a,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(_=>{if(_&&_.status===404)return null;this.fire(new t.d(new Error(`Could not load model ${a} from ${u}: ${_.message}`)))})}load(a,u){this.models[u]||(this.models[u]={});let _=Object.keys(a);this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+_.length;let v=[];for(let x of _)v.push(this.loadModel(x,a[x]));Promise.allSettled(v).then(x=>{for(let S=0;S<x.length;S++){let{status:k,value:D}=x[S];k==="fulfilled"&&D&&(this.models[u][_[S]]={model:D,numReferences:1})}this.numModelsLoading[u]-=_.length,this.fire(new t.f("data",{dataType:"style"}))}).catch(x=>{this.fire(new t.d(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(let a in this.numModelsLoading)if(this.numModelsLoading[a]>0)return!1;return!0}hasModel(a,u){return!!this.getModel(a,u)}getModel(a,u){return this.models[u]||(this.models[u]={}),this.models[u][a]?this.models[u][a].model:void 0}addModel(a,u,_){this.models[_]||(this.models[_]={}),this.hasModel(a,_)&&this.models[_][a].numReferences++,this.load({[a]:this.requestManager.normalizeModelURL(u)},_)}addModels(a,u){this.models[u]||(this.models[u]={});let _={};for(let v in a)this.models[u][v]={},_[v]=this.requestManager.normalizeModelURL(a[v]);this.load(_,u)}addModelsFromBucket(a,u){this.models[u]||(this.models[u]={});let _={};for(let v of a)this.hasModel(v,u)?this.models[u][v].numReferences++:_[v]=this.requestManager.normalizeModelURL(v);this.load(_,u)}removeModel(a,u){if(this.models[u]&&this.models[u][a]&&(this.models[u][a].numReferences--,this.models[u][a].numReferences===0)){let _=this.models[u][a].model;delete this.models[u][a],_.destroy()}}listModels(a){return this.models[a]||(this.models[a]={}),Object.keys(this.models[a])}upload(a,u){this.models[u]||(this.models[u]={});for(let _ in this.models[u])this.models[u][_].model&&this.models[u][_].model.upload(a.context)}}function ei(f){let{userImage:a}=f;return!!(a&&a.render&&a.render())&&(f.data.replace(new Uint8Array(a.data.buffer)),!0)}class Qd extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(a){this.images[a]={},this.loaded[a]=!1,this.updatedImages[a]={},this.patterns[a]={},this.callbackDispatchedThisFrame[a]={},this.atlasImage[a]=new t.i({width:1,height:1})}isLoaded(){for(let a in this.loaded)if(!this.loaded[a])return!1;return!0}setLoaded(a,u){if(this.loaded[u]!==a&&(this.loaded[u]=a,a)){for(let{ids:_,callback:v}of this.requestors)this._notify(_,u,v);this.requestors=[]}}hasImage(a,u){return!!this.getImage(a,u)}getImage(a,u){return this.images[u][a]}addImage(a,u,_){this._validate(a,_)&&(this.images[u][a]=_)}_validate(a,u){let _=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new t.d(new Error(`Image "${a}" has invalid "stretchX" value`))),_=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new t.d(new Error(`Image "${a}" has invalid "stretchY" value`))),_=!1),this._validateContent(u.content,u)||(this.fire(new t.d(new Error(`Image "${a}" has invalid "content" value`))),_=!1),_}_validateStretch(a,u){if(!a)return!0;let _=0;for(let v of a){if(v[0]<_||v[1]<v[0]||u<v[1])return!1;_=v[1]}return!0}_validateContent(a,u){return!(a&&(a.length!==4||a[0]<0||u.data.width<a[0]||a[1]<0||u.data.height<a[1]||a[2]<0||u.data.width<a[2]||a[3]<0||u.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,u,_){_.version=this.images[u][a].version+1,this.images[u][a]=_,this.updatedImages[u][a]=!0}removeImage(a,u){let _=this.images[u][a];delete this.images[u][a],delete this.patterns[u][a],_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(a){return Object.keys(this.images[a])}getImages(a,u,_){let v=!0,x=!!this.loaded[u];if(!x)for(let S of a)this.images[u][S]||(v=!1);x||v?this._notify(a,u,_):this.requestors.push({ids:a,scope:u,callback:_})}getUpdatedImages(a){return this.updatedImages[a]}_notify(a,u,_){let v={};for(let x of a){this.images[u][x]||this.fire(new t.f("styleimagemissing",{id:x}));let S=this.images[u][x];S?v[x]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:t.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}_(null,v)}getPixelSize(a){let{width:u,height:_}=this.atlasImage[a];return{width:u,height:_}}getPattern(a,u,_){let v=this.patterns[u][a],x=this.getImage(a,u);if(!x)return null;if(v&&v.position.version===x.version)return v.position;if(v)v.position.version=x.version;else{let S={w:x.data.width+2,h:x.data.height+2,x:0,y:0},k=new t.k(S,x);this.patterns[u][a]={bin:S,position:k}}return this._updatePatternAtlas(u,_),this.patterns[u][a].position}bind(a,u){let _=a.gl,v=this.atlasTexture[u];v?this.dirty&&(v.update(this.atlasImage[u]),this.dirty=!1):(v=new t.T(a,this.atlasImage[u],_.RGBA),this.atlasTexture[u]=v),v.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(a,u){let _=[];for(let k in this.patterns[a])_.push(this.patterns[a][k].bin);let{w:v,h:x}=t.j(_),S=this.atlasImage[a];S.resize({width:v||1,height:x||1});for(let k in this.patterns[a]){let{bin:D}=this.patterns[a][k],A=D.x+1,L=D.y+1,B=this.images[a][k].data,U=B.width,W=B.height;t.i.copy(B,S,{x:0,y:0},{x:A,y:L},{width:U,height:W},u),t.i.copy(B,S,{x:0,y:W-1},{x:A,y:L-1},{width:U,height:1},u),t.i.copy(B,S,{x:0,y:0},{x:A,y:L+W},{width:U,height:1},u),t.i.copy(B,S,{x:U-1,y:0},{x:A-1,y:L},{width:1,height:W},u),t.i.copy(B,S,{x:0,y:0},{x:A+U,y:L},{width:1,height:W},u)}this.dirty=!0}beginFrame(){for(let a in this.images)this.callbackDispatchedThisFrame[a]={}}dispatchRenderCallbacks(a,u){for(let _ of a){if(this.callbackDispatchedThisFrame[u][_])continue;this.callbackDispatchedThisFrame[u][_]=!0;let v=this.images[u][_];ei(v)&&this.updateImage(_,u,v)}}}function Zn(f){let a=f.key,u=f.value,_=f.valueSpec||{},v=f.objectElementValidators||{},x=f.style,S=f.styleSpec,k=[],D=t.n(u);if(D!=="object")return[new t.V(a,u,`object expected, ${D} found`)];for(let A in u){let L=A.split(".")[0],B;v[L]?B=v[L]:_[L]?B=G:v["*"]?B=v["*"]:_["*"]&&(B=G),B?k=k.concat(B({key:(a&&`${a}.`)+A,value:u[A],valueSpec:_[L]||_["*"],style:x,styleSpec:S,object:u,objectKey:A},u)):k.push(new t.m(a,u[A],`unknown property "${A}"`))}for(let A in _)v[A]||_[A].required&&_[A].default===void 0&&u[A]===void 0&&k.push(new t.V(a,u,`missing required property "${A}"`));return k}function Cc(f){let a=f.value,u=f.valueSpec,_=f.style,v=f.styleSpec,x=f.key,S=f.arrayElementValidator||G;if(t.n(a)!=="array")return[new t.V(x,a,`array expected, ${t.n(a)} found`)];if(u.length&&a.length!==u.length)return[new t.V(x,a,`array length ${u.length} expected, length ${a.length} found`)];if(u["min-length"]&&a.length<u["min-length"])return[new t.V(x,a,`array length at least ${u["min-length"]} expected, length ${a.length} found`)];let k={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};v.$version<7&&(k.function=u.function),t.n(u.value)==="object"&&(k=u.value);let D=[];for(let A=0;A<a.length;A++)D=D.concat(S({array:a,arrayIndex:A,value:a[A],valueSpec:k,style:_,styleSpec:v,key:`${x}[${A}]`},!0));return D}function xl(f){let a=f.key,u=f.value,_=f.valueSpec,v=t.n(u);if(v==="number"&&u!=u&&(v="NaN"),v!=="number")return[new t.V(a,u,`number expected, ${v} found`)];if("minimum"in _){let x=_.minimum;if(t.n(_.minimum)==="array"&&(x=_.minimum[f.arrayIndex]),u<x)return[new t.V(a,u,`${u} is less than the minimum value ${x}`)]}if("maximum"in _){let x=_.maximum;if(t.n(_.maximum)==="array"&&(x=_.maximum[f.arrayIndex]),u>x)return[new t.V(a,u,`${u} is greater than the maximum value ${x}`)]}return[]}function za(f){let a=f.valueSpec,u=t.u(f.value.type),_,v,x,S={},k=u!=="categorical"&&f.value.property===void 0,D=!k,A=t.n(f.value.stops)==="array"&&t.n(f.value.stops[0])==="array"&&t.n(f.value.stops[0][0])==="object",L=Zn({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(W){if(u==="identity")return[new t.V(W.key,W.value,'identity function may not have a "stops" property')];let Y=[],Z=W.value;return Y=Y.concat(Cc({key:W.key,value:Z,valueSpec:W.valueSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:B})),t.n(Z)==="array"&&Z.length===0&&Y.push(new t.V(W.key,Z,"array must have at least one stop")),Y},default:function(W){return G({key:W.key,value:W.value,valueSpec:a,style:W.style,styleSpec:W.styleSpec})}}});return u==="identity"&&k&&L.push(new t.V(f.key,f.value,'missing required property "property"')),u==="identity"||f.value.stops||L.push(new t.V(f.key,f.value,'missing required property "stops"')),u==="exponential"&&f.valueSpec.expression&&!t.s(f.valueSpec)&&L.push(new t.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(D&&!t.q(f.valueSpec)?L.push(new t.V(f.key,f.value,"property functions not supported")):k&&!t.r(f.valueSpec)&&L.push(new t.V(f.key,f.value,"zoom functions not supported"))),u!=="categorical"&&!A||f.value.property!==void 0||L.push(new t.V(f.key,f.value,'"property" property is required')),L;function B(W){let Y=[],Z=W.value,X=W.key;if(t.n(Z)!=="array")return[new t.V(X,Z,`array expected, ${t.n(Z)} found`)];if(Z.length!==2)return[new t.V(X,Z,`array length 2 expected, length ${Z.length} found`)];if(A){if(t.n(Z[0])!=="object")return[new t.V(X,Z,`object expected, ${t.n(Z[0])} found`)];if(Z[0].zoom===void 0)return[new t.V(X,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new t.V(X,Z,"object stop key must have value")];let Q=t.u(Z[0].zoom);if(typeof Q!="number")return[new t.V(X,Z[0].zoom,"stop zoom values must be numbers")];if(x&&x>Q)return[new t.V(X,Z[0].zoom,"stop zoom values must appear in ascending order")];Q!==x&&(x=Q,v=void 0,S={}),Y=Y.concat(Zn({key:`${X}[0]`,value:Z[0],valueSpec:{zoom:{}},style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:xl,value:U}}))}else Y=Y.concat(U({key:`${X}[0]`,value:Z[0],valueSpec:{},style:W.style,styleSpec:W.styleSpec},Z));return t.t(t.v(Z[1]))?Y.concat([new t.V(`${X}[1]`,Z[1],"expressions are not allowed in function stops.")]):Y.concat(G({key:`${X}[1]`,value:Z[1],valueSpec:a,style:W.style,styleSpec:W.styleSpec}))}function U(W,Y){let Z=t.n(W.value),X=t.u(W.value),Q=W.value!==null?W.value:Y;if(_){if(Z!==_)return[new t.V(W.key,Q,`${Z} stop domain type must match previous stop domain type ${_}`)]}else _=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new t.V(W.key,Q,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&u!=="categorical"){let re=`number expected, ${Z} found`;return t.q(a)&&u===void 0&&(re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new t.V(W.key,Q,re)]}return u!=="categorical"||Z!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?u!=="categorical"&&Z==="number"&&typeof X=="number"&&typeof v=="number"&&v!==void 0&&X<v?[new t.V(W.key,Q,"stop domain values must appear in ascending order")]:(v=X,u==="categorical"&&X in S?[new t.V(W.key,Q,"stop domain values must be unique")]:(S[X]=!0,[])):[new t.V(W.key,Q,`integer expected, found ${String(X)}`)]}}function Ba(f){let a=(f.expressionContext==="property"?t.x:t.y)(t.v(f.value),f.valueSpec);if(a.result==="error")return a.value.map(_=>new t.V(`${f.key}${_.key}`,f.value,_.message));let u=a.value.expression||a.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!u.outputDefined())return[new t.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!t.z(u))return[new t.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Kd(u,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!t.A(u,["zoom","feature-state"]))return[new t.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!t.B(u))return[new t.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kd(f,a){let u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(a.valueSpec&&a.valueSpec.expression)for(let v of a.valueSpec.expression.parameters)u.delete(v);if(u.size===0)return[];let _=[];return f instanceof t.D&&u.has(f.name)?[new t.V(a.key,a.value,`["${f.name}"] expression is not supported in a filter for a ${a.object.type} layer with id: ${a.object.id}`)]:(f.eachChild(v=>{_.push(...Kd(v,a))}),_)}function js(f){let a=f.key,u=f.value,_=f.valueSpec,v=[];return Array.isArray(_.values)?_.values.indexOf(t.u(u))===-1&&v.push(new t.V(a,u,`expected one of [${_.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(_.values).indexOf(t.u(u))===-1&&v.push(new t.V(a,u,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(u)} found`)),v}function Us(f){return t.G(t.v(f.value))?Ba(t.o({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Sc(f)}function Sc(f){let a=f.value,u=f.key;if(t.n(a)!=="array")return[new t.V(u,a,`array expected, ${t.n(a)} found`)];let _=f.styleSpec,v,x=[];if(a.length<1)return[new t.V(u,a,"filter array must have at least 1 element")];switch(x=x.concat(js({key:`${u}[0]`,value:a[0],valueSpec:_.filter_operator,style:f.style,styleSpec:f.styleSpec})),t.u(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&t.u(a[1])==="$type"&&x.push(new t.V(u,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&x.push(new t.V(u,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(v=t.n(a[1]),v!=="string"&&x.push(new t.V(`${u}[1]`,a[1],`string expected, ${v} found`)));for(let S=2;S<a.length;S++)v=t.n(a[S]),t.u(a[1])==="$type"?x=x.concat(js({key:`${u}[${S}]`,value:a[S],valueSpec:_.geometry_type,style:f.style,styleSpec:f.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new t.V(`${u}[${S}]`,a[S],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let S=1;S<a.length;S++)x=x.concat(Sc({key:`${u}[${S}]`,value:a[S],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":v=t.n(a[1]),a.length!==2?x.push(new t.V(u,a,`filter array for "${a[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new t.V(`${u}[1]`,a[1],`string expected, ${v} found`))}return x}function Mc(f,a){let u=f.key,_=f.style,v=f.layer,x=f.styleSpec,S=f.value,k=f.objectKey,D=x[`${a}_${f.layerType}`];if(!D)return[];let A=k.match(/^(.*)-transition$/);if(a==="paint"&&A&&D[A[1]]&&D[A[1]].transition)return G({key:u,value:S,valueSpec:x.transition,style:_,styleSpec:x});let L=f.valueSpec||D[k];if(!L)return[new t.m(u,S,`unknown property "${k}"`)];let B;if(t.n(S)==="string"&&t.q(L)&&!L.tokens&&(B=/^{([^}]+)}$/.exec(S))){let W=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new t.V(u,S,`"${k}" does not support interpolation syntax
Use an identity property function instead: ${W}.`)]}let U=[];if(f.layerType==="symbol")k!=="text-field"||!_||_.glyphs||_.imports||U.push(new t.V(u,S,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&t.H(t.v(S))&&t.u(S.type)==="identity"&&U.push(new t.V(u,S,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&a==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&t.q(L)&&(t.J(L)||t.r(L))){let W=t.x(t.v(S),L),Y=W.value.expression||W.value._styleExpression.expression;Y&&!t.A(Y,["measure-light"])&&(k==="model-emissive-strength"&&t.B(Y)&&t.z(Y)||U.push(new t.V(u,S,`${k} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat(G({key:f.key,value:S,valueSpec:L,style:_,styleSpec:x,expressionContext:"property",propertyType:a,propertyKey:k}))}function Su(f){return Mc(f,"paint")}function kc(f){return Mc(f,"layout")}function $o(f){let a=[],u=f.value,_=f.key,v=f.style,x=f.styleSpec;u.type||u.ref||a.push(new t.V(_,u,'either "type" or "ref" is required'));let S=t.u(u.type),k=t.u(u.ref);if(u.id){let D=t.u(u.id);for(let A=0;A<f.arrayIndex;A++){let L=v.layers[A];t.u(L.id)===D&&a.push(new t.V(_,u.id,`duplicate layer id "${u.id}", previously used at line ${L.id.__line__}`))}}if("ref"in u){let D;["type","source","source-layer","filter","layout"].forEach(A=>{A in u&&a.push(new t.V(_,u[A],`"${A}" is prohibited for ref layers`))}),v.layers.forEach(A=>{t.u(A.id)===k&&(D=A)}),D?D.ref?a.push(new t.V(_,u.ref,"ref cannot reference another ref layer")):S=t.u(D.type):typeof k=="string"&&a.push(new t.V(_,u.ref,`ref layer "${k}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(u.source){let D=v.sources&&v.sources[u.source],A=D&&t.u(D.type);D?A==="vector"&&S==="raster"?a.push(new t.V(_,u.source,`layer "${u.id}" requires a raster source`)):A==="raster"&&S!=="raster"?a.push(new t.V(_,u.source,`layer "${u.id}" requires a vector source`)):A!=="vector"||u["source-layer"]?A==="raster-dem"&&S!=="hillshade"?a.push(new t.V(_,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||A==="geojson"&&D.lineMetrics?S==="raster-particle"&&A!=="raster-array"&&a.push(new t.V(_,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):a.push(new t.V(_,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new t.V(_,u.source,"raster-array source can only be used with layer type 'raster'.")):a.push(new t.V(_,u,`layer "${u.id}" must specify a "source-layer"`)):a.push(new t.V(_,u.source,`source "${u.source}" not found`))}else a.push(new t.V(_,u,'missing required property "source"'));return a=a.concat(Zn({key:_,value:u,valueSpec:x.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>G({key:`${_}.type`,value:u.type,valueSpec:x.layer.type,style:f.style,styleSpec:f.styleSpec,object:u,objectKey:"type"}),filter:D=>Us(t.o({layerType:S},D)),layout:D=>Zn({layer:u,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":A=>kc(t.o({layerType:S},A))}}),paint:D=>Zn({layer:u,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":A=>Su(t.o({layerType:S,layer:u},A))}})}})),a}function Ws(f){let a=f.value,u=f.key,_=t.n(a);return _!=="string"?[new t.V(u,a,`string expected, ${_} found`)]:[]}let Yo={promoteId:function({key:f,value:a}){if(t.n(a)==="string")return Ws({key:f,value:a});{let u=[];for(let _ in a)u.push(...Ws({key:`${f}.${_}`,value:a[_]}));return u}}};function Vr(f){let a=f.value,u=f.key,_=f.styleSpec,v=f.style;if(!a.type)return[new t.V(u,a,'"type" is required')];let x=t.u(a.type),S=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(a.url||a.tiles||S.push(new t.m(u,a,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(Zn({key:u,value:a,valueSpec:_[`source_${x.replace("-","_")}`],style:f.style,styleSpec:_,objectElementValidators:Yo})),S;case"geojson":if(S=Zn({key:u,value:a,valueSpec:_.source_geojson,style:v,styleSpec:_,objectElementValidators:Yo}),a.cluster)for(let k in a.clusterProperties){let[D,A]=a.clusterProperties[k],L=typeof D=="string"?[D,["accumulated"],["get",k]]:D;S.push(...Ba({key:`${u}.${k}.map`,value:A,expressionContext:"cluster-map"})),S.push(...Ba({key:`${u}.${k}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return S;case"video":return Zn({key:u,value:a,valueSpec:_.source_video,style:v,styleSpec:_});case"image":return Zn({key:u,value:a,valueSpec:_.source_image,style:v,styleSpec:_});case"canvas":return[new t.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return js({key:`${u}.type`,value:a.type,valueSpec:{values:Mu(_)},style:v,styleSpec:_})}}function Mu(f){return f.source.reduce((a,u)=>{let _=f[u];return _.type.type==="enum"&&(a=a.concat(Object.keys(_.type.values))),a},[])}function wl(f){let a=f.value,u=f.styleSpec,_=u.light,v=f.style,x=[],S=t.n(a);if(a===void 0)return x;if(S!=="object")return x=x.concat([new t.V("light",a,`object expected, ${S} found`)]),x;for(let k in a){let D=k.match(/^(.*)-transition$/);x=x.concat(D&&_[D[1]]&&_[D[1]].transition?G({key:k,value:a[k],valueSpec:u.transition,style:v,styleSpec:u}):_[k]?G({key:k,value:a[k],valueSpec:_[k],style:v,styleSpec:u}):[new t.V(k,a[k],`unknown property "${k}"`)])}return x}function Ic(f){let a=f.value,u=[];if(!a)return u;let _=t.n(a);if(_!=="object")return u=u.concat([new t.V("light-3d",a,`object expected, ${_} found`)]),u;let v=f.styleSpec,x=v["light-3d"],S=f.key,k=f.style,D=f.style.lights;for(let B of["type","id"])if(!(B in a))return u=u.concat([new t.V("light-3d",a,`missing property ${B} on light`)]),u;if(a.type&&D)for(let B=0;B<f.arrayIndex;B++){let U=t.u(a.type),W=D[B];t.u(W.type)===U&&u.push(new t.V(S,a.id,`duplicate light type "${a.type}", previously defined at line ${W.id.__line__}`))}let A=`properties_light_${a.type}`;if(!(A in v))return u=u.concat([new t.V("light-3d",a,`Invalid light type ${a.type}`)]),u;let L=v[A];for(let B in a)if(B==="properties"){let U=a[B],W=t.n(U);if(W!=="object")return u=u.concat([new t.V("properties",U,`object expected, ${W} found`)]),u;for(let Y in U)u=u.concat(L[Y]?G({key:Y,value:U[Y],valueSpec:L[Y],style:k,styleSpec:v}):[new t.m(f.key,U[Y],`unknown property "${Y}"`)])}else{let U=B.match(/^(.*)-transition$/);u=u.concat(U&&x[U[1]]&&x[U[1]].transition?G({key:B,value:a[B],valueSpec:v.transition,style:k,styleSpec:v}):x[B]?G({key:B,value:a[B],valueSpec:x[B],style:k,styleSpec:v}):[new t.m(B,a[B],`unknown property "${B}"`)])}return u}function Jd(f){let a=f.value,u=f.key,_=f.style,v=f.styleSpec,x=v.terrain,S=[],k=t.n(a);if(a===void 0||k==="null")return S;if(k!=="object")return S=S.concat([new t.V("terrain",a,`object expected, ${k} found`)]),S;for(let D in a){let A=D.match(/^(.*)-transition$/);S=S.concat(A&&x[A[1]]&&x[A[1]].transition?G({key:D,value:a[D],valueSpec:v.transition,style:_,styleSpec:v}):x[D]?G({key:D,value:a[D],valueSpec:x[D],style:_,styleSpec:v}):[new t.m(D,a[D],`unknown property "${D}"`)])}if(a.source){let D=_.sources&&_.sources[a.source],A=D&&t.u(D.type);D?A!=="raster-dem"&&S.push(new t.V(u,a.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):S.push(new t.V(u,a.source,`source "${a.source}" not found`))}else S.push(new t.V(u,a,'terrain is missing required property "source"'));return S}function Tc(f){let a=f.value,u=f.style,_=f.styleSpec,v=_.fog,x=[],S=t.n(a);if(a===void 0)return x;if(S!=="object")return x=x.concat([new t.V("fog",a,`object expected, ${S} found`)]),x;for(let k in a){let D=k.match(/^(.*)-transition$/);x=x.concat(D&&v[D[1]]&&v[D[1]].transition?G({key:k,value:a[k],valueSpec:_.transition,style:u,styleSpec:_}):v[k]?G({key:k,value:a[k],valueSpec:v[k],style:u,styleSpec:_}):[new t.m(k,a[k],`unknown property "${k}"`)])}return x}let Se={"*":()=>[],array:Cc,boolean:function(f){let a=f.value,u=f.key,_=t.n(a);return _!=="boolean"?[new t.V(u,a,`boolean expected, ${_} found`)]:[]},number:xl,color:function(f){let a=f.key,u=f.value,_=t.n(u);return _!=="string"?[new t.V(a,u,`color expected, ${_} found`)]:t.F(u)===null?[new t.V(a,u,`color expected, "${u}" found`)]:[]},enum:js,filter:Us,function:za,layer:$o,object:Zn,source:Vr,model:t.K,light:wl,"light-3d":Ic,terrain:Jd,fog:Tc,string:Ws,formatted:function(f){return Ws(f).length===0?[]:Ba(f)},resolvedImage:function(f){return Ws(f).length===0?[]:Ba(f)},projection:function(f){let a=f.value,u=f.styleSpec,_=u.projection,v=f.style,x=[],S=t.n(a);if(S==="object")for(let k in a)x=x.concat(G({key:k,value:a[k],valueSpec:_[k],style:v,styleSpec:u}));else S!=="string"&&(x=x.concat([new t.V("projection",a,`object or string expected, ${S} found`)]));return x},import:function(f){let{value:a,styleSpec:u}=f,S=a,{data:_}=S,v=gI(S,["data"]);Object.defineProperty(v,"__line__",{value:a.__line__,enumerable:!1});let x=Zn(t.o({},f,{value:v,valueSpec:u.import}));return t.u(v.id)===""&&x.push(new t.V(`${f.key}.id`,v,"import id can't be an empty string")),_&&(x=x.concat(ce(_,u,{key:`${f.key}.data`}))),x}};function G(f,a=!1){let u=f.value,_=f.valueSpec,v=f.styleSpec;if(_.expression&&t.H(t.u(u)))return za(f);if(_.expression&&t.t(t.v(u)))return Ba(f);if(_.type&&Se[_.type]){let x=Se[_.type](f);return a===!0&&x.length>0&&t.n(f.value)==="array"?Ba(f):x}return Zn(t.o({},f,{valueSpec:_.type?v[_.type]:_}))}function K(f){let a=f.value,u=f.key,_=Ws(f);return _.length||(a.indexOf("{fontstack}")===-1&&_.push(new t.V(u,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&_.push(new t.V(u,a,'"glyphs" url must include a "{range}" token'))),_}function ce(f,a=t.L,u={}){return G({key:u.key||"",value:f,valueSpec:a.$root,styleSpec:a,style:f,objectElementValidators:{glyphs:K,"*":()=>[]}})}function be(f,a=t.L){return vi(ce(f,a))}let ye=f=>vi(Vr(f)),De=f=>vi(wl(f)),Ne=f=>vi(Ic(f)),Te=f=>vi(Jd(f)),je=f=>vi(Tc(f)),mt=f=>vi($o(f)),st=f=>vi(Us(f)),Rt=f=>vi(Su(f)),$t=f=>vi(kc(f)),fi=f=>vi(t.K(f));function vi(f){return f.slice().sort((a,u)=>a.line&&u.line?a.line-u.line:0)}function oi(f,a){let u=!1;if(a&&a.length)for(let _ of a)_ instanceof t.m?t.w(_.message):(f.fire(new t.d(new Error(_.message))),u=!0);return u}let Di=new t.N({anchor:new t.O(t.L.light.anchor),position:new t.Q(t.L.light.position),color:new t.O(t.L.light.color),intensity:new t.O(t.L.light.intensity)});class At extends t.E{constructor(a,u="flat"){super(),this._transitionable=new t.U(Di),this.setLight(a,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,u,_={}){this._validate(De,a,_)||(this._transitionable.setTransitionOrValue(a),this.id=u)}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,u,_){return(!_||_.validate!==!1)&&oi(this,a.call(be,t.W({value:u,style:{glyphs:!0,sprite:!0},styleSpec:t.L})))}}let Dn=new t.N({source:new t.O(t.L.terrain.source),exaggeration:new t.O(t.L.terrain.exaggeration)}),en=class extends t.E{constructor(f,a,u,_){super(),this.scope=u,this._transitionable=new t.U(Dn,u,_),this._transitionable.setTransitionOrValue(f,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(f,a){this._transitionable.setTransitionOrValue(f,a)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new t.X(f)).get("exaggeration")}isZoomDependent(){let f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof t.Z}},Ri=45,ar=65,An=.05;function br(f,a,u,_){let v=t.$(Ri,ar,u),[x,S]=Xr(f,_),k=1-Math.min(1,Math.exp((a-x)/(S-x)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*v*f.alpha}function Xr(f,a){let u=.5/Math.tan(.5*a);return[f.range[0]+u,f.range[1]+u]}function Qr(f,a,u,_,v){let x=t._.transformMat4([],[a,u,_],v.mercatorFogMatrix);return br(f,t._.length(x),v.pitch,v._fov)}function Cl(f,a,u,_,v,x,S){let k=[[u,_,0],[v,_,0],[v,x,0],[u,x,0]],D=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let L of k){let B=t._.transformMat4([],L,a),U=t._.length(B);D=Math.min(D,U),A=Math.max(A,U)}return[br(f,D,S.pitch,S._fov),br(f,A,S.pitch,S._fov)]}let Ap=new t.N({range:new t.O(t.L.fog.range),color:new t.O(t.L.fog.color),"high-color":new t.O(t.L.fog["high-color"]),"space-color":new t.O(t.L.fog["space-color"]),"horizon-blend":new t.O(t.L.fog["horizon-blend"]),"star-intensity":new t.O(t.L.fog["star-intensity"]),"vertical-range":new t.O(t.L.fog["vertical-range"])});class b_ extends t.E{constructor(a,u,_,v){super(),this._transitionable=new t.U(Ap,_,new Map(v)),this.set(a,v),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new t.a0(Ap),this.scope=_}get state(){let a=this._transform,u=a.projection.name==="globe",_=t.a1(a.zoom),v=this.properties.get("range"),x=[.5,3];return{range:u?[t.a2(x[0],v[0],_),t.a2(x[1],v[1],_)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,u,_={}){if(this._validate(je,a,_))return;let v=t.W({},a);for(let x of Object.keys(t.L.fog))v[x]===void 0&&(v[x]=t.L.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;let u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:t.$(Ri,ar,a))*u.a}getOpacityAtLatLng(a,u){return this._transform.projection.supportsFog?function(_,v,x){let S=t.Y.fromLngLat(v),k=x.elevation?x.elevation.getAtPointOrZero(S):0;return Qr(_,S.x,S.y,k,x)}(this.state,a,u):0}getOpacityForTile(a){if(!this._transform.projection.supportsFog)return[1,1];let u=this._transform.calculateFogTileMatrix(a.toUnwrapped());return Cl(this.state,u,0,0,t.a3,t.a3,this._transform)}getOpacityForBounds(a,u,_,v,x){return this._transform.projection.supportsFog?Cl(this.state,a,u,_,v,x,this._transform):[1,1]}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Xr(this.state,a):[0,1]}isVisibleOnFrustum(a){if(!this._transform.projection.supportsFog)return!1;let u=[4,5,6,7];for(let _ of u){let v=a.points[_],x;if(v[2]>=0)x=v;else{let S=a.points[_-4];x=t.a4(S,v,S[2]/(S[2]-v[2]))}if(Qr(this.state,x[0],x[1],0,this._transform)>=An)return!0}return!1}updateConfig(a){this._transitionable.setTransitionOrValue(this._options,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,u,_){return(!_||_.validate!==!1)&&oi(this,a.call(be,t.W({value:u,style:{glyphs:!0,sprite:!0},styleSpec:t.L})))}}class eh extends t.E{constructor(a,u,_,v){super(),this.scope=_,this._options=a,this.properties=new t.a0(u),this._transitionable=new t.U(u,_,new Map(v)),this._transitionable.setTransitionOrValue(a.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(a){this._transitionable.setTransitionOrValue(this._options.properties,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(a,u){this._options=a,this._transitionable.setTransitionOrValue(a.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let hi=new t.N({color:new t.O(t.L.properties_light_ambient.color),intensity:new t.O(t.L.properties_light_ambient.intensity)}),Pp=new t.N({direction:new t.a5(t.L.properties_light_directional.direction),color:new t.O(t.L.properties_light_directional.color),intensity:new t.O(t.L.properties_light_directional.intensity),"cast-shadows":new t.O(t.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new t.O(t.L.properties_light_directional["shadow-intensity"])});var Hs=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Op=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Rp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Lp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Fp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,zp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Bp=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Np=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Vp=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,jp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,y_=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Ec=[];Dc(Hs,Ec),Dc(Rp,Ec),Dc(Op,Ec);let ku={"_prelude_fog.vertex.glsl":zp,"_prelude_terrain.vertex.glsl":Fp,"_prelude_shadow.vertex.glsl":jp,"_prelude_fog.fragment.glsl":Bp,"_prelude_shadow.fragment.glsl":y_,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Np,"_prelude_raster_particle.glsl":Vp},Iu={};Mi("",Fp),Mi(Bp,zp),Mi(y_,jp),Mi(Np,""),Mi(Vp,"");let v_=Mi(Op,Rp),x_=Hs;var w_={background:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Mi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Mi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Mi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Mi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Mi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Mi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Mi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Mi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Mi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Mi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Mi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Mi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Mi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Mi(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:Mi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Mi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Mi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Mi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Lp),skyboxGradient:Mi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Lp),skyboxCapture:Mi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Mi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Mi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Mi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Mi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Dc(f,a){let u=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of u)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let v=_.split(" ");for(let x of v)a.includes(x)||a.push(x)}}function Mi(f,a){let u=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v=a.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(A=>{let L=A.split(" ");return L[L.length-1]}),v=[...new Set(v)]);let x={},S=[],k=[];if(f=f.replace(u,(A,L)=>(k.push(L),"")),(a=a.replace(u,(A,L)=>(S.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...Ec];Dc(f,D),Dc(a,D);for(let A of[...S,...k])ku[A]||console.error(`Undefined include: ${A}`),Iu[A]||(Iu[A]=[],Dc(ku[A],Iu[A])),D=[...D,...Iu[A]];return{fragmentSource:f=f.replace(_,(A,L,B,U,W)=>(x[W]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${W}
in ${B} ${U} ${W};
#else
uniform ${B} ${U} u_${W};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${W}
    ${B} ${U} ${W} = u_${W};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    in ${B} ${U} ${W};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:a=a.replace(_,(A,L,B,U,W)=>{let Y=U==="float"?"vec2":U,Z=W.match(/color/)?"color":Y;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${W}
in ${B} ${U} a_${W};
#endif
`:x[W]?L==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${B} ${Y} a_${W};
out ${B} ${U} ${W};
#else
uniform ${B} ${U} u_${W};
#endif
`:L==="initialize"?Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${B} ${U} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${Z}(a_${W}, u_${W}_t);
#else
    ${B} ${U} ${W} = u_${W};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    in ${B} ${U} a_${W};
    out ${B} ${U} ${W};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    ${W} = a_${W};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${B} ${Y} a_${W};
#else
uniform ${B} ${U} u_${W};
#endif
`:L==="define-instanced"?Z==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${W}0;
in vec4 a_${W}1;
in vec4 a_${W}2;
in vec4 a_${W}3;
#else
uniform ${B} ${U} u_${W};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${B} ${Y} a_${W};
#else
uniform ${B} ${U} u_${W};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    ${B} ${U} ${W} = a_${W};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${B} ${U} ${W} = a_${W};
#else
    ${B} ${U} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${B} ${U} ${W} = unpack_mix_${Z}(a_${W}, u_${W}_t);
#else
    ${B} ${U} ${W} = u_${W};
#endif
`}),staticAttributes:v,usedDefines:D,vertexIncludes:S,fragmentIncludes:k}}class Gv{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,u,_,v,x,S,k,D){this.context=a;let A=this.boundPaintVertexBuffers.length!==v.length;for(let B=0;!A&&B<v.length;B++)this.boundPaintVertexBuffers[B]!==v[B]&&(A=!0);let L=this.boundDynamicVertexBuffers.length!==k.length;for(let B=0;!L&&B<k.length;B++)this.boundDynamicVertexBuffers[B]!==k[B]&&(L=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==_||A||L||this.boundIndexBuffer!==x||this.boundVertexOffset!==S)this.freshBind(u,_,v,x,S,k,D);else{a.bindVertexArrayOES.set(this.vao);for(let B of k)B&&(B.bind(),D&&B.instanceCount&&B.setVertexAttribDivisor(a.gl,u,D));x&&x.dynamicDraw&&x.bind()}}freshBind(a,u,_,v,x,S,k){let D=a.numAttributes,A=this.context,L=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=S,u.enableAttributes(L,a),u.bind(),u.setVertexAttribPointers(L,a,x);for(let B of _)B.enableAttributes(L,a),B.bind(),B.setVertexAttribPointers(L,a,x);for(let B of S)B&&(B.enableAttributes(L,a),B.bind(),B.setVertexAttribPointers(L,a,x),k&&B.instanceCount&&B.setVertexAttribDivisor(L,a,k));v&&v.bind(),A.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function qv(f,a){let u=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new t.Y(0,_/u).toLngLat().lat,new t.Y(0,(_+1)/u).toLngLat().lat]}function $v(f,a,u,_,v,x,S){let k=f.context,D=k.gl,A=u.hillshadeFBO;if(!A)return;f.prepareDrawTile();let L=f.isTileAffectedByFog(a),B=f.getOrCreateProgram("hillshade",{overrideFog:L});k.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,A.colorAttachment.get());let U=((X,Q,re,oe)=>{let ae=re.paint.get("hillshade-shadow-color"),_e=re.paint.get("hillshade-highlight-color"),ge=re.paint.get("hillshade-accent-color"),ne=re.paint.get("hillshade-emissive-strength"),se=t.ab(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")se-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){let we=X.style.directionalLight.properties.get("direction"),Re=t.ac(we.x,we.y,we.z);se=t.ab(Re[1])}let le=!X.options.moving;return{u_matrix:oe||X.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),le),u_image:0,u_latrange:qv(0,Q.tileID),u_light:[re.paint.get("hillshade-exaggeration"),se],u_shadow:ae.toRenderColor(re.lut),u_highlight:_e.toRenderColor(re.lut),u_emissive_strength:ne,u_accent:ge.toRenderColor(re.lut)}})(f,u,_,f.terrain?a.projMatrix:null);f.uploadCommonUniforms(k,B,a.toUnwrapped());let{tileBoundsBuffer:W,tileBoundsIndexBuffer:Y,tileBoundsSegments:Z}=f.getTileBoundsBuffers(u);B.draw(f,D.TRIANGLES,v,x,S,t.af.disabled,U,_.id,W,Y,Z)}function Up(f,a,u){if(!a.needsDEMTextureUpload)return;let _=f.context,v=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||f.getTileTexture(u.stride);let x=u.getPixels();a.demTexture?a.demTexture.update(x,{premultiply:!1}):a.demTexture=new t.T(_,x,v.R32F,{premultiply:!1}),a.needsDEMTextureUpload=!1}function Na(f,a,u){let _=f.context,v=_.gl;if(!a.dem)return;let x=a.dem;if(_.activeTexture.set(v.TEXTURE1),Up(f,a,x),!a.demTexture)return;a.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);let S=x.dim;_.activeTexture.set(v.TEXTURE0);let k=a.hillshadeFBO;if(!k){let U=new t.T(_,{width:S,height:S,data:null},v.RGBA);U.bind(v.LINEAR,v.CLAMP_TO_EDGE),k=a.hillshadeFBO=_.createFramebuffer(S,S,!0,"renderbuffer"),k.colorAttachment.set(U.texture)}_.bindFramebuffer.set(k.framebuffer),_.viewport.set([0,0,S,S]);let{tileBoundsBuffer:D,tileBoundsIndexBuffer:A,tileBoundsSegments:L}=f.getMercatorTileBoundsBuffers(),B=[];f.linearFloatFilteringSupported()&&B.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:B}).draw(f,v.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.disabled,((U,W)=>{let Y=W.stride,Z=t.ad.create();return t.ad.ortho(Z,0,t.a3,-t.a3,0,0,1),t.ad.translate(Z,Z,[0,-t.a3,0]),{u_matrix:Z,u_image:1,u_dimension:[Y,Y],u_zoom:U.overscaledZ}})(a.tileID,x),u.id,D,A,L),a.needsHillshadePrepare=!1}function Wp(f,a,u,_,v){let x=function(S,k){if(S)return v(S);if(k){if(f.url&&k.tiles&&f.tiles&&delete f.tiles,k.variants){if(!Array.isArray(k.variants))return v(new Error("variants must be an array"));for(let A of k.variants){if(A==null||typeof A!="object"||A.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(A.capabilities))return v(new Error("capabilities must be an array"));if(A.capabilities.length===1&&A.capabilities[0]==="meshopt"){k=t.W(k,A);break}}}let D=t.ah(t.W(k,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(D.vectorLayers=k.vector_layers,D.vectorLayerIds=D.vectorLayers.map(A=>A.id)),k.raster_layers&&(D.rasterLayers=k.raster_layers,D.rasterLayerIds=D.rasterLayers.map(A=>A.id)),D.tiles=a.canonicalizeTileset(D,f.url),v(null,D)}};return f.url?t.g(a.transformRequest(a.normalizeSourceURL(f.url,null,u,_),t.R.Source),x):t.e.frame(()=>x(null,f))}class th{constructor(a,u,_){this.bounds=t.ai.convert(this.validateBounds(a)),this.minzoom=u||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){let u=Math.pow(2,a.z),_=Math.floor(t.aj(this.bounds.getWest())*u),v=Math.floor(t.ak(this.bounds.getNorth())*u),x=Math.ceil(t.aj(this.bounds.getEast())*u),S=Math.ceil(t.ak(this.bounds.getSouth())*u);return a.x>=_&&a.x<x&&a.y>=v&&a.y<S}}class ih extends t.E{constructor(a,u,_,v){super(),this.id=a,this.dispatcher=_,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.W({type:"raster"},u),t.W(this,t.ah(u,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"})),this._tileJSONRequest=Wp(this._options,this.map._requestManager,null,null,(u,_)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new t.d(u)):_&&(t.W(this,_),_.bounds&&(this.tileBounds=new th(_.bounds,this.minzoom,this.maxzoom)),t.an(_.tiles),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),a&&a(u)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();let a=t.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return t.W({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,u){let _=t.e.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);a.request=t.h(this.map._requestManager.transformRequest(v,t.R.Tile),(x,S,k,D)=>(delete a.request,a.aborted?(a.state="unloaded",u(null)):x?(a.state="errored",u(x)):S?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:k,expires:D}),a.setTexture(S,this.map.painter),a.state="loaded",t.am(this.dispatcher),void u(null)):u(null)))}abortTile(a,u){a.request&&(a.request.cancel(),delete a.request),u&&u()}unloadTile(a,u){a.texture&&a.texture instanceof t.T?(a.destroy(!0),a.texture&&a.texture instanceof t.T&&this.map.painter.saveTileTexture(a.texture)):a.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Tu extends t.E{constructor(a,u,_,v){if(super(),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.W(this,t.ah(u,["url","scheme","tileSize","promoteId"])),this._options=t.W({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new t.ao}load(a){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"}));let u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=Wp(this._options,this.map._requestManager,u,_,(v,x)=>{this._tileJSONRequest=null,this._loaded=!0,v?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new t.d(v))):x&&(t.W(this,x),x.bounds&&(this.tileBounds=new th(x.bounds,this.minzoom,this.maxzoom)),t.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),a&&a(v)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();let a=t.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return t.W({},this._options)}loadTile(a,u){let _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),v=this.map._requestManager.transformRequest(_,t.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,S={request:v,data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,lut:x?{image:x.image.clone()}:null,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:t.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:a.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=u:a.request=a.actor.send("reloadTile",S,k.bind(this));else if(a.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",S,k.bind(this),void 0,!0);else{let D=t.ap.call({deduped:this._deduped},S,(A,L)=>{A||!L?k.call(this,A):(S.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},a.actor&&a.actor.send("loadTile",S,k.bind(this),void 0,!0))},!0);a.request={cancel:D}}function k(D,A){return delete a.request,a.aborted?u(null):D&&D.status!==404?u(D):(A&&A.resourceTiming&&(a.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&a.setExpiryData(A),a.loadVectorData(A,this.map.painter),t.am(this.dispatcher),u(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,u){a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope}),a.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Sl=f=>({u_matrix:new t.a6(f),u_image0:new t.a7(f),u_skirt_height:new t.aa(f),u_ground_shadow_factor:new t.aq(f)}),wt=(f,a,u)=>({u_matrix:f,u_image0:0,u_skirt_height:a,u_ground_shadow_factor:u}),C_=(f,a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:u,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:S,u_frustum_tr:k,u_frustum_br:D,u_frustum_bl:A,u_globe_pos:L,u_globe_radius:B,u_viewport:U,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:W,u_far_z_cutoff:Y});class nh{constructor(a=0,u=0,_=0,v=0){if(isNaN(a)||a<0||isNaN(u)||u<0||isNaN(_)||_<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=u,this.left=_,this.right=v}interpolate(a,u,_){return u.top!=null&&a.top!=null&&(this.top=t.a2(a.top,u.top,_)),u.bottom!=null&&a.bottom!=null&&(this.bottom=t.a2(a.bottom,u.bottom,_)),u.left!=null&&a.left!=null&&(this.left=t.a2(a.left,u.left,_)),u.right!=null&&a.right!=null&&(this.right=t.a2(a.right,u.right,_)),this}getCenter(a,u){let _=t.at((this.left+a-this.right)/2,0,a),v=t.at((this.top+u-this.bottom)/2,0,u);return new t.P(_,v)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new nh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ai(f,a){let u=t.aw(f,3);t.ad.fromQuat(f,a),t.az(f,3,u)}function Kr(f,a){let u=t.av.identity([]);return t.av.rotateZ(u,u,-a),t.av.rotateX(u,u,-f),u}function S_(f,a){let u=[f[0],f[1],0],_=[a[0],a[1],0];if(t._.length(u)>=1e-15){let S=t._.normalize([],u);t._.scale(_,S,t._.dot(_,S)),a[0]=_[0],a[1]=_[1]}let v=t._.cross([],a,f);if(t._.len(v)<1e-15)return null;let x=Math.atan2(-v[1],v[0]);return Kr(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}class Hp{constructor(a,u){this.position=a,this.orientation=u}get position(){return this._position}set position(a){if(a){let u=a instanceof t.Y?a:new t.Y(a[0],a[1],a[2]);this._renderWorldCopies&&(u.x=t.au(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(a,u){if(this.orientation=null,!this.position)return;let _=this.position,v=this._elevation?this._elevation.getAtPointOrZero(t.Y.fromLngLat(a)):0,x=t.Y.fromLngLat(a,v),S=[x.x-_.x,x.y-_.y,x.z-_.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=S_(S,u)}setPitchBearing(a,u){this.orientation=Kr(t.ab(a),t.ab(-u))}}class rh{constructor(a,u){this._transform=t.ad.identity([]),this.orientation=u,this.position=a}get mercatorPosition(){let a=this.position;return new t.Y(a[0],a[1],a[2])}get position(){let a=t.aw(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var u;a&&t.az(this._transform,3,[(u=a)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||t.av.identity([]),a&&Ai(this._transform,this._orientation)}getPitchBearing(){let a=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,u){this._orientation=Kr(a,u),Ai(this._transform,this._orientation)}forward(){let a=t.aw(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){let a=t.aw(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){let a=t.aw(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,u){let _=new Float64Array(16);return t.ad.invert(_,this.getWorldToCamera(a,u)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(a,u,_){let v=this.position;t._.scale(v,v,-a);let x=new Float64Array(16);return t.ad.fromScaling(x,[_,_,_]),t.ad.translate(x,x,v),x[10]*=u,x}getWorldToCamera(a,u){let _=new Float64Array(16),v=new Float64Array(4),x=this.position;return t.av.conjugate(v,this._orientation),t._.scale(x,x,-a),t.ad.fromQuat(_,v),t.ad.translate(_,_,x),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=u,_[9]*=u,_[10]*=u,_[11]*=u,_}getCameraToClipPerspective(a,u,_,v){let x=new Float64Array(16);return t.ad.perspective(x,a,u,_,v),x}getCameraToClipOrthographic(a,u,_,v,x,S){let k=new Float64Array(16);return t.ad.ortho(k,a,u,_,v,x,S),k}getDistanceToElevation(a,u=!1){let _=a===0?0:t.ax(a,u?t.ay(this.position[1]):this.position[1]),v=this.forward();return(_-this.position[2])/v[2]}clone(){return new rh([...this.position],[...this.orientation])}}let Ac={unknown:0,flipRequired:1,flipNotRequired:2},gi=Math.tan(85*Math.PI/180);function Ml(f,a,u,_,v,x,S){let k=t.ad.create();if(u)if(x.name==="globe"){let D=t.aB(v,a);t.ad.multiply(k,k,D)}else{let D=t.aC.invert([],S);k[0]=D[0],k[1]=D[1],k[4]=D[2],k[5]=D[3],_||t.ad.rotateZ(k,k,v.angle)}else t.ad.multiply(k,v.labelPlaneMatrix,f);return k}function kl(f,a,u,_,v,x,S){let k=Ml(f,a,u,_,v,x,S);return x.name==="globe"&&u||(k[2]=k[6]=k[10]=k[14]=0),k}function Pc(f,a,u,_,v,x,S){if(u){if(x.name==="globe"){let k=Ml(f,a,u,_,v,x,S);return t.ad.invert(k,k),t.ad.multiply(k,f,k),k}{let k=t.ad.clone(f),D=t.ad.identity([]);return D[0]=S[0],D[1]=S[1],D[4]=S[2],D[5]=S[3],t.ad.multiply(k,k,D),_||t.ad.rotateZ(k,k,-v.angle),k}}return v.glCoordMatrix}function Zo(f,a,u,_){let v=[f,a,u,1];u?t.aA.transformMat4(v,v,_):Va(v,v,_);let x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function Jr(f,a){return Math.min(.5+f/a*.5,1.5)}function Yv(f,a){let u=f[0]/f[3],_=f[1]/f[3];return u>=-a[0]&&u<=a[0]&&_>=-a[1]&&_<=a[1]}function Eu(f,a,u,_,v,x,S,k,D,A){let L=u.transform,B=_?f.textSizeData:f.iconSizeData,U=t.aD(B,u.transform.zoom),W=L.projection.name==="globe",Y=[256/u.width*2+1,256/u.height*2+1],Z=_?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Z.clear();let X=null;W&&(X=_?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);let Q=f.lineVertexArray,re=_?f.text.placedSymbolArray:f.icon.placedSymbolArray,oe=u.transform.width/u.transform.height,ae,_e=!1;for(let ge=0;ge<re.length;ge++){let ne=re.get(ge),{numGlyphs:se,writingMode:le}=ne;if(le!==t.aE.vertical||_e||ae===t.aE.horizontal||(_e=!0),ae=le,(ne.hidden||le===t.aE.vertical)&&!_e){Il(se,Z);continue}_e=!1;let we=new t.P(ne.tileAnchorX,ne.tileAnchorY),{x:Re,y:me,z:Le}=L.projection.projectTilePoint(we.x,we.y,A.canonical);if(D){let[It,xt,it]=D(we);Re+=It,me+=xt,Le+=it}let Be=[Re,me,Le,1];if(t.aA.transformMat4(Be,Be,a),!Yv(Be,Y)){Il(se,Z);continue}let Qe=Be[3],Je=Jr(u.transform.getCameraToCenterDistance(L.projection),Qe),Xe=t.aF(B,U,ne),Ee=S?Xe/Je:Xe*Je,Ve=Zo(Re,me,Le,v);if(Ve[3]<=0){Il(se,Z);continue}let Ze={},bt=S?null:D,vt=qp(ne,Ee,!1,k,a,v,x,f.glyphOffsetArray,Q,Z,X,Ve,we,Ze,oe,bt,L.projection,A,S);_e=vt.useVertical,bt&&vt.needsFlipping&&(Ze={}),(vt.notEnoughRoom||_e||vt.needsFlipping&&qp(ne,Ee,!0,k,a,v,x,f.glyphOffsetArray,Q,Z,X,Ve,we,Ze,oe,bt,L.projection,A,S).notEnoughRoom)&&Il(se,Z)}_?(f.text.dynamicLayoutVertexBuffer.updateData(Z),X&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(X)):(f.icon.dynamicLayoutVertexBuffer.updateData(Z),X&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(X))}function Du(f,a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z){let{lineStartIndex:X,glyphStartIndex:Q,segment:re}=k,oe=Q+k.numGlyphs,ae=X+k.lineLength,_e=a.getoffsetX(Q),ge=a.getoffsetX(oe-1),ne=Oc(f*_e,u,_,v,x,S,re,X,ae,D,A,L,B,U,!0,W,Y,Z);if(!ne)return null;let se=Oc(f*ge,u,_,v,x,S,re,X,ae,D,A,L,B,U,!0,W,Y,Z);return se?{first:ne,last:se}:null}function Gp(f,a,u,_){return f===t.aE.horizontal&&Math.abs(_)>Math.abs(u)?{useVertical:!0}:f===t.aE.vertical?_>0?{needsFlipping:!0}:null:a!==Ac.unknown&&function(v,x){return v===0||Math.abs(x/v)>gi}(u,_)?a===Ac.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function qp(f,a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z,X,Q,re){let oe=a/24,ae=f.lineOffsetX*oe,_e=f.lineOffsetY*oe,{lineStartIndex:ge,glyphStartIndex:ne,numGlyphs:se,segment:le,writingMode:we,flipState:Re}=f,me=ge+f.lineLength,Le=Be=>{if(L){let[Ee,Ve,Ze]=Be.up,bt=A.length;t.aG(L,bt+0,Ee,Ve,Ze),t.aG(L,bt+1,Ee,Ve,Ze),t.aG(L,bt+2,Ee,Ve,Ze),t.aG(L,bt+3,Ee,Ve,Ze)}let[Qe,Je,Xe]=Be.point;t.aH(A,Qe,Je,Xe,Be.angle)};if(se>1){let Be=Du(oe,k,ae,_e,u,B,U,f,D,x,W,Z,!1,X,Q,re);if(!Be)return{notEnoughRoom:!0};if(_&&!u){let[Qe,Je,Xe]=Be.first.point,[Ee,Ve,Ze]=Be.last.point;[Qe,Je]=Zo(Qe,Je,Xe,S),[Ee,Ve]=Zo(Ee,Ve,Ze,S);let bt=Gp(we,Re,(Ee-Qe)*Y,Ve-Je);if(f.flipState=bt&&bt.needsFlipping?Ac.flipRequired:Ac.flipNotRequired,bt)return bt}Le(Be.first);for(let Qe=ne+1;Qe<ne+se-1;Qe++){let Je=Oc(oe*k.getoffsetX(Qe),ae,_e,u,B,U,le,ge,me,D,x,W,Z,!1,!1,X,Q,re);if(!Je)return A.length-=4*(Qe-ne),{notEnoughRoom:!0};Le(Je)}Le(Be.last)}else{if(_&&!u){let Qe=Zo(U.x,U.y,0,v),Je=ge+le+1,Xe=new t.P(D.getx(Je),D.gety(Je)),Ee=Zo(Xe.x,Xe.y,0,v),Ve=Ee[3]>0?Ee:oh(U,Xe,Qe,1,v,void 0,X,Q.canonical),Ze=Gp(we,Re,(Ve[0]-Qe[0])*Y,Ve[1]-Qe[1]);if(f.flipState=Ze&&Ze.needsFlipping?Ac.flipRequired:Ac.flipNotRequired,Ze)return Ze}let Be=Oc(oe*k.getoffsetX(ne),ae,_e,u,B,U,le,ge,me,D,x,W,Z,!1,!1,X,Q,re);if(!Be)return{notEnoughRoom:!0};Le(Be)}return{}}function Au(f,a,u,_,v){let{x,y:S,z:k}=_.projectTilePoint(f.x,f.y,a);if(!v)return Zo(x,S,k,u);let[D,A,L]=v(f);return Zo(x+D,S+A,k+L,u)}function oh(f,a,u,_,v,x,S,k){let D=Au(f.sub(a)._unit()._add(f),k,v,S,x);return t._.sub(D,u,D),t._.normalize(D,D),t._.scaleAndAdd(D,u,D,_)}function Oc(f,a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z,X,Q){let re=_?f-a:f+a,oe=re>0?1:-1,ae=0;_&&(oe*=-1,ae=Math.PI),oe<0&&(ae+=Math.PI);let _e=k+S+(oe>0?0:1)|0,ge=v,ne=v,se=0,le=0,we=Math.abs(re),Re=[],me=[],Le=x,Be=Le,Qe=()=>oh(Be,Le,ne,we-se+1,L,U,Z,X.canonical);for(;se+le<=we;){if(_e+=oe,_e<k||_e>=D)return null;if(ne=ge,Be=Le,Re.push(ne),W&&me.push(Be),Le=new t.P(A.getx(_e),A.gety(_e)),ge=B[_e],!ge){let xt=Au(Le,X.canonical,L,Z,U);ge=xt[3]>0?B[_e]=xt:Qe()}se+=le,le=t._.distance(ne,ge)}Y&&U&&(B[_e]&&(ge=Qe(),le=t._.distance(ne,ge)),B[_e]=ge);let Je=(we-se)/le,Xe=Le.sub(Be)._mult(Je)._add(Be),Ee=t._.sub([],ge,ne),Ve=t._.scaleAndAdd([],ne,Ee,Je),Ze=[0,0,1],bt=Ee[0],vt=Ee[1];if(Q&&(Ze=Z.upVector(X.canonical,Xe.x,Xe.y),Ze[0]!==0||Ze[1]!==0||Ze[2]!==1)){let xt=[Ze[2],0,-Ze[0]],it=t._.cross([],Ze,xt);t._.normalize(xt,xt),t._.normalize(it,it),bt=t._.dot(Ee,xt),vt=t._.dot(Ee,it)}if(u){let xt=t._.cross([],Ze,Ee);t._.normalize(xt,xt),t._.scaleAndAdd(Ve,Ve,xt,u*oe)}let It=ae+Math.atan2(vt,bt);return Re.push(Ve),W&&me.push(Xe),{point:Ve,angle:It,path:Re,tilePath:me,up:Ze}}function Il(f,a){let u=a.length,_=u+4*f;a.resize(_),a.float32.fill(-1/0,4*u,4*_)}function Va(f,a,u){let _=a[0],v=a[1];return f[0]=u[0]*_+u[4]*v+u[12],f[1]=u[1]*_+u[5]*v+u[13],f[3]=u[3]*_+u[7]*v+u[15],f}let $p=(f,a,u)=>(1-u)*f+u*a,sr=f=>f*f*f*f*f;class ja{constructor(a,u,_,v,x,S,k){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=a||0,this._maxZoom=u||22,this._minPitch=_??0,this._maxPitch=v??60,this.setProjection(S),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new t.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new nh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new rh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let a=new ja(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(a,u=!1){let _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(a||_)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return t.ah(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};let u=this.projection?this.getProjection():void 0;this.projection=t.aJ(this.projectionOptions);let _=!g(u,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(a){return this._orthographicProjectionAtLowPitch!==a&&(this._orthographicProjectionAtLowPitch=a,this._calcMatrices(),!0)}setMercatorFromTransition(){let a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.aJ({name:"mercator"});let u=a!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){let a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return t.au(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){let u=-a*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=t.aC.create(),t.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){let u=t.at(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=t.ab(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){let u=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(a){this._tileCoverLift!==a&&(this._tileCoverLift=a)}_updateCameraOnTerrain(){let a=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&a===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||a===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let _=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=a||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let a=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop(),v=0,x=0;for(let S=0;S<u.length;S++){let k=new t.P(u[S][0]*this.width,_+u[S][1]*(this.height-_)),D=a.pointCoordinate(k);if(!D)continue;let A=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);v+=D[3]*A,x+=A}return x===0?NaN:v/x}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let a=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*u,v=this._mercatorZfromZoom(a),x=this._mercatorZfromZoom(this._maxZoom),S=Math.max(v-_,x);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){let u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude())),_;_=a.z<this._camera.position[2]?[u.x,u.y,u.z]:[a.x,a.y,a.z];let v=t._.length(t._.sub([],this._camera.position,_));return t.at(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let u=!1;if(a.orientation&&!t.av.exactEquals(a.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(a.orientation)),a.position){let _=[a.position.x,a.position.y,a.position.z];t._.exactEquals(_,this._camera.position)||(this._setCameraPosition(_),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let a=this._camera.position,u=new Hp;return u.position=new t.Y(a[0],a[1],a[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(a){if(!t.av.length(a))return!1;t.av.normalize(a,a);let u=t._.transformQuat([],[0,0,-1],a),_=t._.transformQuat([],[0,-1,0],a);if(_[2]<0)return!1;let v=S_(u,_);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(a){let u=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;a[2]=t.at(a[2],v/_,v/u),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,u,_){this._unmodified=!1,this._edgeInsets.interpolate(a,u,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){let u=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(a){let u=[new t.aK(0,a)];if(this.renderWorldCopies){let _=this.pointCoordinate(new t.P(0,0)),v=this.pointCoordinate(new t.P(this.width,0)),x=this.pointCoordinate(new t.P(this.width,this.height)),S=this.pointCoordinate(new t.P(0,this.height)),k=Math.floor(Math.min(_.x,v.x,x.x,S.x)),D=Math.floor(Math.max(_.x,v.x,x.x,S.x)),A=1;for(let L=k-A;L<=D+A;L++)L!==0&&u.push(new t.aK(L,a))}return u}isLODDisabled(a){return(!a||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(a,u,_){let v=[];if(u[0]===0&&u[1]===0)return v;for(let S of a){let k=S.canonical,D=S.overscaledZ,A=S.wrap,L=1<<k.z,B=k.x+1<L,U=k.x>0,W=k.y+1<L,Y=k.y>0,Z=S.wrap-(U?0:1),X=S.wrap+(B?0:1),Q=U?k.x-1:L-1,re=B?k.x+1:0;u[0]<0?(v.push(new t.aL(D,X,k.z,re,k.y)),u[1]<0&&W&&(v.push(new t.aL(D,A,k.z,k.x,k.y+1)),v.push(new t.aL(D,X,k.z,re,k.y+1))),u[1]>0&&Y&&(v.push(new t.aL(D,A,k.z,k.x,k.y-1)),v.push(new t.aL(D,X,k.z,re,k.y-1)))):u[0]>0?(v.push(new t.aL(D,Z,k.z,Q,k.y)),u[1]<0&&W&&(v.push(new t.aL(D,A,k.z,k.x,k.y+1)),v.push(new t.aL(D,Z,k.z,Q,k.y+1))),u[1]>0&&Y&&(v.push(new t.aL(D,A,k.z,k.x,k.y-1)),v.push(new t.aL(D,Z,k.z,Q,k.y-1)))):u[1]<0&&W?v.push(new t.aL(D,A,k.z,k.x,k.y+1)):Y&&v.push(new t.aL(D,A,k.z,k.x,k.y-1))}if(v.length>1){v.sort((D,A)=>D.overscaledZ-A.overscaledZ||D.wrap-A.wrap||D.canonical.z-A.canonical.z||D.canonical.x-A.canonical.x||D.canonical.y-A.canonical.y);let S=0,k=0;for(;k<v.length;)v[k].equals(v[S])?++k:v[++S]=v[k++];v.length=S+1}let x=[];for(let S of v)v.some(k=>S.isChildOf(k))||x.push(S);return v=x.filter(S=>!a.some(k=>!!(S.overscaledZ<_&&k.isChildOf(S))||S.equals(k)||S.isChildOf(k))),v}coveringTiles(a){let u=this.coveringZoomLevel(a),_=u,v=this.elevation&&this.elevation.exaggeration(),x=v&&!a.isTerrainDEM,S=this.projection.name==="mercator";if(a.minzoom!==void 0&&u<a.minzoom)return[];a.maxzoom!==void 0&&u>a.maxzoom&&(u=a.maxzoom);let k=this.locationCoordinate(this.center),D=this.center.lat,A=1<<u,L=[A*k.x,A*k.y,0],B=this.projection.name==="globe",U=!B,W=t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,U),Y=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=A*t.ax(1,this.center.lat),X=this._camera.position[2]/t.ax(1,this.center.lat),Q=[A*Y.x,A*Y.y,X*(U?1:Z)],re=B||v,oe=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),ae=this.isLODDisabled(!0)?u:0,_e;if(this._elevation&&a.isTerrainDEM)_e=1e4*this._elevation.exaggeration();else if(this._elevation){let Ee=this._elevation.getMinMaxForVisibleTiles();_e=Ee?Ee.max:this._centerAltitude}else _e=this._centerAltitude;let ge=a.isTerrainDEM?-_e:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=this.projection.isReprojectedInTileSpace?t.aN(this):1,se=Ee=>{let Ze=new t.Y(Ee.x+25e-6,Ee.y,Ee.z),bt=new t.Y(Ee.x,Ee.y+25e-6,Ee.z),vt=Ee.toLngLat(),It=Ze.toLngLat(),xt=bt.toLngLat(),it=this.locationCoordinate(vt),$e=this.locationCoordinate(It),Dt=this.locationCoordinate(xt),si=Math.hypot($e.x-it.x,$e.y-it.y),ti=Math.hypot(Dt.x-it.x,Dt.y-it.y);return Math.sqrt(si*ti)*ne/25e-6},le=Ee=>{let Ve=_e,Ze=ge;return{aabb:t.aQ(this,A,0,0,0,Ee,Ze,Ve,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:Ve,wrap:Ee,fullyVisible:!1}},we=[],Re=[],me=u,Le=a.reparseOverscaled?_:u,Be=Ee=>Ee*Ee,Qe=Be((X-this._centerAltitude)*Z),Je=Ee=>{if(!this._elevation||!Ee.tileID||!S)return;let Ve=this._elevation.getMinMaxForTile(Ee.tileID),Ze=Ee.aabb;Ve?(Ze.min[2]=Ve.min,Ze.max[2]=Ve.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(Ee.shouldSplit=Xe(Ee),Ee.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},Xe=Ee=>{if(Ee.zoom<ae)return!0;if(Ee.zoom===me)return!1;if(Ee.shouldSplit!=null)return Ee.shouldSplit;let Ve=Ee.aabb.distanceX(Q),Ze=Ee.aabb.distanceY(Q),bt=Qe,vt=1;if(B){bt=Be(Ee.aabb.distanceZ(Q));let it=Math.pow(2,Ee.zoom),$e=t.ay((Ee.y+1)/it),Dt=t.ay(Ee.y/it),si=Math.min(Math.max(D,$e),Dt),ti=t.b4(si)/t.b4(D);if(vt=si===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ti/this._mercatorScaleRatio),this.zoom<=t.b1&&Ee.zoom===me-1&&ti>=.9)return!0}else if(x&&(bt=Be(Ee.aabb.distanceZ(Q)*Z)),this.projection.isReprojectedInTileSpace&&_<=5){let it=Math.pow(2,Ee.zoom),$e=se(new t.Y((Ee.x+.5)/it,(Ee.y+.5)/it));vt=$e>.85?1:$e}let It=Ve*Ve+Ze*Ze+bt,xt=Be((1<<me-Ee.zoom)*oe*vt*((it,$e)=>{if($e*Be(.707)<it)return 1;let Dt=Math.sqrt($e/it);return Dt/(1.4144271570014144+(Math.pow(1.1,Dt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(bt,Qe),It));return It<xt};if(this.renderWorldCopies)for(let Ee=1;Ee<=3;Ee++)we.push(le(-Ee)),we.push(le(Ee));for(we.push(le(0));we.length>0;){let Ee=we.pop(),Ve=Ee.x,Ze=Ee.y,bt=Ee.fullyVisible,vt=()=>this.projection.name==="globe"&&(Ee.y===0||Ee.y===(1<<Ee.zoom)-1);if(!bt){let It=re?Ee.aabb.intersects(W):Ee.aabb.intersectsFlat(W);if(It===0&&vt()){let xt=new t.aO(Ee.zoom,Ve,Ze);It=t.aP(this,A,xt,!0).intersects(W)}if(It===0)continue;bt=It===2}if(Ee.zoom!==me&&Xe(Ee))for(let It=0;It<4;It++){let xt=(Ve<<1)+It%2,it=(Ze<<1)+(It>>1),$e={aabb:S?Ee.aabb.quadrant(It):t.aQ(this,A,Ee.zoom+1,xt,it,Ee.wrap,Ee.minZ,Ee.maxZ,this.projection),zoom:Ee.zoom+1,x:xt,y:it,wrap:Ee.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:Ee.minZ,maxZ:Ee.maxZ};x&&!B&&($e.tileID=new t.aL(Ee.zoom+1===me?Le:Ee.zoom+1,Ee.wrap,Ee.zoom+1,xt,it),Je($e)),we.push($e)}else{let It=Ee.zoom===me?Le:Ee.zoom;if(a.minzoom&&a.minzoom>It)continue;if(!bt){let Dt=re?Ee.aabb.intersectsPrecise(W):Ee.aabb.intersectsPreciseFlat(W);if(Dt===0&&vt()){let si=new t.aO(Ee.zoom,Ve,Ze);Dt=t.aP(this,A,si,!0).intersectsPrecise(W)}if(Dt===0)continue}let xt=L[0]-(.5+Ve+(Ee.wrap<<Ee.zoom))*(1<<u-Ee.zoom),it=L[1]-.5-Ze,$e=Ee.tileID?Ee.tileID:new t.aL(It,Ee.wrap,Ee.zoom,Ve,Ze);Re.push({tileID:$e,distanceSq:xt*xt+it*it})}}if(this.fogCullDistSq){let Ee=this.fogCullDistSq,Ve=this.horizonLineFromTop();Re=Re.filter(Ze=>{let bt=[0,0,0,1],vt=[t.a3,t.a3,0,1],It=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());t.aA.transformMat4(bt,bt,It),t.aA.transformMat4(vt,vt,It);let xt=t.aA.min([],bt,vt),it=t.aA.max([],bt,vt),$e=t.aR(xt,it);if($e===0)return!0;let Dt=!1,si=this._elevation;if(si&&$e>Ee&&Ve!==0){let ti=this.calculateProjMatrix(Ze.tileID.toUnwrapped()),xi;a.isTerrainDEM||(xi=si.getMinMaxForTile(Ze.tileID)),xi||(xi={min:ge,max:_e});let Pi=t.b2(this.rotation),tn=[Pi[0]*t.a3,Pi[1]*t.a3,xi.max];t._.transformMat4(tn,tn,ti),Dt=(1-tn[1])*this.height*.5<Ve}return $e<Ee||Dt})}return Re.sort((Ee,Ve)=>Ee.distanceSq-Ve.distanceSq).map(Ee=>Ee.tileID)}resize(a,u){this.width=a,this.height=u,this.pixelsToGLUnits=[2/a,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){let u=t.at(a.lat,-t.aS,t.aS),_=this.projection.project(a.lng,u);return new t.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,u){let _,v,x=this.centerPoint;if(this.projection.name==="globe"){let k=this.worldSize;_=(u.x-x.x)/k,v=(u.y-x.y)/k}else{let k=this.pointCoordinate(u),D=this.pointCoordinate(x);_=k.x-D.x,v=k.y-D.y}let S=this.locationCoordinate(a);this.setLocation(new t.Y(S.x-_,S.y-v))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,u){let _=u?t.ax(u,a.lat):void 0,v=this.projection.project(a.lng,a.lat);return new t.Y(v.x,v.y,_)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,u){let _=u??this._centerAltitude,v=[a.x,a.y,0,1],x=[a.x,a.y,1,1];t.aA.transformMat4(v,v,this.pixelMatrixInverse),t.aA.transformMat4(x,x,this.pixelMatrixInverse);let S=x[3];t.aA.scale(v,v,1/v[3]),t.aA.scale(x,x,1/S);let k=v[2],D=x[2];return{p0:v,p1:x,t:k===D?0:(_-k)/(D-k)}}screenPointToMercatorRay(a){let u=[a.x,a.y,0,1],_=[a.x,a.y,1,1];return t.aA.transformMat4(u,u,this.pixelMatrixInverse),t.aA.transformMat4(_,_,this.pixelMatrixInverse),t.aA.scale(u,u,1/u[3]),t.aA.scale(_,_,1/_[3]),u[2]=t.ax(u[2],this._center.lat)*this.worldSize,_[2]=t.ax(_[2],this._center.lat)*this.worldSize,t.aA.scale(u,u,1/this.worldSize),t.aA.scale(_,_,1/this.worldSize),new t.aT([u[0],u[1],u[2]],t._.normalize([],t._.sub([],_,u)))}rayIntersectionCoordinate(a){let{p0:u,p1:_,t:v}=a,x=t.ax(u[2],this._center.lat),S=t.ax(_[2],this._center.lat);return new t.Y(t.a2(u[0],_[0],v)/this.worldSize,t.a2(u[1],_[1],v)/this.worldSize,t.a2(x,S,v))}pointCoordinate(a,u=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,u)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let u=this.projection.pointCoordinate3D(this,a.x,a.y);if(u)return new t.Y(u[0],u[1],u[2]);let _=0,v=this.horizonLineFromTop();if(a.y>v)return this.pointCoordinate(a);let x=.02*v,S=a.clone();for(let k=0;k<10&&v-_>x;k++){S.y=t.a2(_,v,.66);let D=this.projection.pointCoordinate3D(this,S.x,S.y);D?(v=S.y,u=D):_=S.y}return u?new t.Y(u[0],u[1],u[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=t.aU)return!this.isPointAboveHorizon(a);let u=this.pointCoordinate(a);return u.y>=0&&u.y<=1}_coordinatePoint(a,u){let _=u&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,v=[a.x*this.worldSize,a.y*this.worldSize,_+a.toAltitude(),1];return t.aA.transformMat4(v,v,this.pixelMatrix),v[3]>0?new t.P(v[0]/v[3],v[1]/v[3]):new t.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:a,left:u}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new t.P(u,a)),S=this.pointLocation3D(new t.P(v,a)),k=this.pointLocation3D(new t.P(v,_)),D=this.pointLocation3D(new t.P(u,_)),A=Math.min(x.lng,S.lng,k.lng,D.lng),L=Math.max(x.lng,S.lng,k.lng,D.lng),B=Math.min(x.lat,S.lat,k.lat,D.lat),U=Math.max(x.lat,S.lat,k.lat,D.lat),W=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,Z=(X,Q,re,oe,ae)=>{let _e=(X+re)/2,ge=(Q+oe)/2,ne=new t.P(_e,ge),{lng:se,lat:le}=this.pointLocation3D(ne),we=Math.max(0,A-se,B-le,se-L,le-U);A=Math.min(A,se),L=Math.max(L,se),B=Math.min(B,le),U=Math.max(U,le),(ae<Y||we>W)&&(Z(X,Q,_e,ge,ae+1),Z(_e,ge,re,oe,ae+1))};if(Z(u,a,v,a,1),Z(v,a,v,_,1),Z(v,_,u,_,1),Z(u,_,u,a,1),this.projection.name==="globe"){let[X,Q]=t.aV(this);X?(U=90,L=180,A=-180):Q&&(B=-90,L=180,A=-180)}return new t.ai(new t.aI(A,B),new t.aI(L,U))}_getBoundsRectangular(a,u){let{top:_,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,k=new t.P(v,_),D=new t.P(S,_),A=new t.P(S,x),L=new t.P(v,x),B=this.pointCoordinate(k,a),U=this.pointCoordinate(D,a),W=this.pointCoordinate(A,u),Y=this.pointCoordinate(L,u),Z=(X,Q)=>(Q.y-X.y)/(Q.x-X.x);return B.y>1&&U.y>=0?B=new t.Y((1-Y.y)/Z(Y,B)+Y.x,1):B.y<0&&U.y<=1&&(B=new t.Y(-Y.y/Z(Y,B)+Y.x,0)),U.y>1&&B.y>=0?U=new t.Y((1-W.y)/Z(W,U)+W.x,1):U.y<0&&B.y<=1&&(U=new t.Y(-W.y/Z(W,U)+W.x,0)),new t.ai().extend(this.coordinateLocation(B)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(W))}_getBoundsRectangularTerrain(){let a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);let u=a.visibleDemTiles.reduce((_,v)=>{if(v.dem){let x=v.dem.tree;_.min=Math.min(_.min,x.minimums[0]),_.max=Math.max(_.max,x.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*a.exaggeration(),u.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){let u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-u*(1-this._horizonShift);return a?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-t.aS,this.maxLat=t.aS,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.aj(this.minLng)*this.tileSize,this.worldMaxX=t.aj(this.maxLng)*this.tileSize,this.worldMinY=t.ak(this.maxLat)*this.tileSize,this.worldMaxY=t.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,u){return this.projection.createTileMatrix(this,u,a)}calculateDistanceTileData(a){let u=a.key,_=this._distanceTileDataCache;if(_[u])return _[u];let v=a.canonical,x=1/this.height,S=this.cameraWorldSize,k=S/this.zoomScale(v.z),D=(v.x+Math.pow(2,v.z)*a.wrap)*k,A=v.y*k,L=this.point;L.x*=S/this.worldSize,L.y*=S/this.worldSize;let B=this.angle,U=Math.sin(-B),W=-Math.cos(-B);return _[u]={bearing:[U,W],center:[(L.x-D)*x,(L.y-A)*x],scale:k/t.a3*x},_[u]}calculateFogTileMatrix(a){let u=a.key,_=this._fogTileMatrixCache;if(_[u])return _[u];let v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return t.ad.multiply(v,this.worldToFogMatrix,v),_[u]=new Float32Array(v),_[u]}calculateProjMatrix(a,u=!1,_=!1){let v=a.key,x;if(x=_?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];let S=this.calculatePosMatrix(a,this.worldSize),k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,t.ad.multiply(S,k,S),x[v]=new Float32Array(S),x[v]}calculatePixelsToTileUnitsMatrix(a){let u=a.tileID.key,_=this._pixelsToTileUnitsCache;if(_[u])return _[u];let v=t.aW(a,this);return _[u]=v,_[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let a=1/this.worldSize,u=t.ad.fromScaling([],[a,a,a]);return t.ad.multiply(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let a=this._elevation;this._updateCameraState();let u=t.ax(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(u),v=this._camera.forward(),x=t.ax(1,this._center.lat);_[2]/=x,v[2]/=x,t._.normalize(v,v);let S=a.raycast(_,v,a.exaggeration());if(S){let k=t._.scaleAndAdd([],_,v,S),D=new t.Y(k[0],k[1],t.ax(k[2],t.ay(k[1]))),A=(D.z+t._.length([D.x-_[0],D.y-_[1],D.z-_[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(A),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;let u=this._elevation,_=t.ax(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(_),x=u.getAtPointOrZero(new t.Y(...v)),S=this.pixelsPerMeter/this.worldSize*x,k=this._minimumHeightOverTerrain(),D=v[2]-S;if(D<=k)if(D<0||a){let A=this.locationCoordinate(this._center,this._centerAltitude),L=[v[0],v[1],A.z-v[2]],B=t._.length(L);L[2]-=(k-D)/this._pixelsPerMercatorPixel;let U=t._.length(L);if(U===0)return;t._.scale(L,L,B/U*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],A.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){let U=this.center;return U.lat=t.at(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(U.lng=t.at(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}let u=this._unmodified,{x:_,y:v}=this.point,x=0,S=_,k=v,D=this.width/2,A=this.height/2,L=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(v-A<L&&(k=L+A),v+A>B&&(k=B-A),B-L<this.height&&(x=Math.max(x,this.height/(B-L)),k=(B+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let U=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,Y=this.worldSize/2-(U+W)/2;S=(_+Y+this.worldSize)%this.worldSize-Y,S-D<U&&(S=U+D),S+D>W&&(S=W-D),W-U<this.width&&(x=Math.max(x,this.width/(W-U)),S=(W+U)/2)}S===_&&k===v||(this.center=this.unproject(new t.P(S,k))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let a=this.centerOffset,u=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=t.ax(1,this.center.lat)/t.ax(1,t.b3));let v=t.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let x=this.projection.zAxisUnit==="meters"?_:1,S=this._camera.getWorldToCamera(this.worldSize,x),k,D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-a.x/this.width,D[9]=2*a.y/this.height,this.isOrthographic){let le=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),we=le*this.aspect,Re=-we,me=-le;we-=a.x,Re-=a.x,le+=a.y,me+=a.y,k=this._camera.getCameraToClipOrthographic(Re,we,me,le,this._nearZ,this._farZ),((Le,Be,Qe,Je)=>{for(let Xe=0;Xe<16;Xe++)Le[Xe]=$p(Be[Xe],Qe[Xe],Je)})(k,k,D,sr(this.pitch>=15?1:this.pitch/15))}else k=D;let A=t.ad.mul([],D,S),L=t.ad.mul([],k,S);if(this.projection.isReprojectedInTileSpace){let le=this.locationCoordinate(this.center),we=t.ad.identity([]);t.ad.translate(we,we,[le.x*this.worldSize,le.y*this.worldSize,0]),t.ad.multiply(we,we,t.aY(this)),t.ad.translate(we,we,[-le.x*this.worldSize,-le.y*this.worldSize,0]),t.ad.multiply(L,L,we),t.ad.multiply(A,A,we),this.inverseAdjustmentMatrix=t.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=t.ad.scale([],L,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=L,this.invProjMatrix=t.ad.invert(new Float64Array(16),this.projMatrix),u){let le=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);le[8]=2*-a.x/this.width,le[9]=2*a.y/this.height,this.expandedFarZProjMatrix=t.ad.mul([],le,S)}else this.expandedFarZProjMatrix=this.projMatrix;let B=t.ad.invert([],k);this.frustumCorners=t.a_.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height),this.cameraFrustum=t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);let U=new Float32Array(16);t.ad.identity(U),t.ad.scale(U,U,[1,-1,1]),t.ad.rotateX(U,U,this._pitch),t.ad.rotateZ(U,U,this.angle);let W=t.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=t.ad.clone(W);let Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;W[8]=2*-a.x/this.width,W[9]=2*(a.y+Y)/this.height,this.skyboxMatrix=t.ad.multiply(U,W,U);let Z=this.point,X=Z.x,Q=Z.y,re=this.width%2/2,oe=this.height%2/2,ae=Math.cos(this.angle),_e=Math.sin(this.angle),ge=X-Math.round(X)+ae*re+_e*oe,ne=Q-Math.round(Q)+ae*oe+_e*re,se=new Float64Array(L);if(t.ad.translate(se,se,[ge>.5?ge-1:ge,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=se,L=t.ad.create(),t.ad.scale(L,L,[this.width/2,-this.height/2,1]),t.ad.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=t.ad.create(),t.ad.scale(L,L,[1,-1,1]),t.ad.translate(L,L,[-1,-1,0]),t.ad.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=t.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,A),this._calcFogMatrices(),this._distanceTileDataCache={},L=t.ad.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=t.a$(this);let le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t._.transformMat4(le,le,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let a=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,_=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[a,a,u];t._.scale(x,x,v),t._.scale(_,_,-1),t._.multiply(_,_,x);let S=t.ad.create();t.ad.translate(S,S,_),t.ad.scale(S,S,x),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,u,v)}_computeCameraPosition(a){let u=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-a/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-_[0]*x,v.y/this.worldSize-_[1]*x,a/this.worldSize*this._centerAltitude-_[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){let u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],v=a[2],x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((u-_)/v,1)),this._camera.position=t._.scaleAndAdd([],this._camera.position,a,x),this._updateStateFromCamera()}_updateStateFromCamera(){let a=this._camera.position,u=this._camera.forward(),{pitch:_,bearing:v}=this._camera.getPitchBearing(),x=t.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.ab(this._maxPitch)),k=Math.max((a[2]-x)/Math.cos(_),S),D=this._zoomFromMercatorZ(k);t._.scaleAndAdd(a,a,u,k),this._pitch=t.at(_,t.ab(this.minPitch),t.ab(this.maxPitch)),this.angle=t.au(v,-Math.PI,Math.PI),this._setZoom(t.at(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.Y(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){let a=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let u=0,_=t.aU,v=0,x=1/0;for(;_-u>1e-6&&_>u;){let S=u+.5*(_-u),k=this.tileSize*Math.pow(2,S),D=this.getCameraToCenterDistance(this.projection,S,k),A=this.scaleZoom(D/(a*this.tileSize)),L=Math.abs(S-A);L<x&&(x=L,v=S),S<A?u=S:_=S}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,u){let _=Math.min(a.x,u.x),v=Math.max(a.x,u.x),x=Math.min(a.y,u.y),S=Math.max(a.y,u.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let k=[new t.P(_,x),new t.P(v,S),new t.P(_,S),new t.P(v,x)],D=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(let L of k){let B=this.pointRayIntersection(L);if(B.t<0)return!0;let U=this.rayIntersectionCoordinate(B);if(U.x<D||U.y<0||U.x>A||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.P(0,0),new t.P(this.width,this.height))}zoomDeltaToMovement(a,u){let _=t._.length(t._.sub([],this._camera.position,a)),v=this._zoomFromMercatorZ(_)+u;return _-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){let a=function([u,_,v],x){let S=[u,_,v,1];t.aA.transformMat4(S,S,x);let k=S[3]=Math.max(S[3],1e-6);return S[0]/=k,S[1]/=k,S[2]/=k,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.P(a[0],a[1])}{let a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,a))}}getCameraToCenterDistance(a,u=this.zoom,_=this.worldSize){let v=t.aX(a,u,this.width,this.height,1024),x=a.pixelSpaceConversion(this.center.lat,_,v),S=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(S=$p(1,S,sr(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){let a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&t.ad.multiply(a,a,this.globeMatrix),a}getFrustum(a){return t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,this.projection.zAxisUnit==="meters")}}let ro={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},cs=(f,a)=>{if(a>0&&f.terrain&&t.w("Cutoff is currently disabled on terrain"),a<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let u=f.transform,_=Math.max(Math.abs(u._zoom-(f.minCutoffZoom-1)),1),v=u.isLODDisabled(!1)?t.$(60,45,u.pitch):t.$(30,15,u.pitch),x=u._farZ-u._nearZ,S=a*u.height,k=((1-(D=v))*u.cameraToCenterDistance+D*(u._farZ+S))*_;var D;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(k-u._nearZ)/x,(k-S-u._nearZ)/x]}}},jr={cascadeCount:2,shadowMapResolution:2048};class Yp{constructor(a,u){this.aabb=a,this.lastCascade=u}}class Zp{add(a,u){let _=this.receivers[a.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],u.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],u.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],u.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],u.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],u.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],u.max[2])):this.receivers[a.key]=new Yp(u,null)}clear(){this.receivers={}}get(a){return this.receivers[a.key]}computeRequiredCascades(a,u,_){let v=t.b6.fromPoints(a.points),x=0;for(let S in this.receivers){let k=this.receivers[S];if(!k||!v.intersectsAabb(k.aabb))continue;k.aabb.min=v.closestPoint(k.aabb.min),k.aabb.max=v.closestPoint(k.aabb.max);let D=k.aabb.getCorners();for(let A=0;A<_.length;A++){let L=!0;for(let B of D){let U=[B[0]*u,B[1]*u,B[2]];if(t._.transformMat4(U,U,_[A].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){L=!1;break}}if(k.lastCascade=A,x=Math.max(x,A),L)break}}return x+1}}class Pu{constructor(a){this.painter=a,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Zp,this._depthMode=new t.ae(a.context.gl.LEQUAL,t.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,a.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),a.tp.registerParameter(jr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),a.tp.registerParameter(jr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),a.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let a of this._cascades)a.texture.destroy(),a.framebuffer.destroy();this._cascades=[]}updateShadowParameters(a,u){let _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;let v=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||v<=0||(this._shadowLayerCount=_.style.order.reduce((Y,Z)=>{let X=_.style._mergedLayers[Z];return Y+(X.hasShadowPass()&&!X.isHidden(a.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let x=_.context,S=jr.shadowMapResolution,k=jr.shadowMapResolution;if(this._cascades.length===0||jr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Y=0;Y<jr.cascadeCount;++Y){let Z=_._shadowMapDebug,X=x.gl,Q=x.createFramebuffer(S,k,Z,"texture"),re=new t.T(x,{width:S,height:k,data:null},X.DEPTH_COMPONENT);if(Q.depthAttachment.set(re.texture),Z){let oe=new t.T(x,{width:S,height:k,data:null},X.RGBA);Q.colorAttachment.set(oe.texture)}this._cascades.push({framebuffer:Q,texture:re,matrix:[],far:0,boundingSphereRadius:0,frustum:new t.aM,scale:0})}}this.shadowDirection=ah(u);let D=0;if(a.elevation){let Y=a.elevation,Z=[1e4,-1e4];Y.visibleDemTiles.filter(X=>X.dem).forEach(X=>{let Q=X.dem.tree;Z[0]=Math.min(Z[0],Q.minimums[0]),Z[1]=Math.max(Z[1],Q.maximums[0])}),Z[0]!==1e4&&(D=(Z[1]-Z[0])*Y.exaggeration())}let A=1.5*a.cameraToCenterDistance,L=3*A,B=new Float64Array(16);for(let Y=0;Y<this._cascades.length;++Y){let Z=this._cascades[Y],X=a.height/50,Q=1;jr.cascadeCount===1?Q=L:Y===0?Q=A:(X=A,Q=L);let[re,oe]=sh(a,this.shadowDirection,X,Q,jr.shadowMapResolution,D);Z.scale=a.scale,Z.matrix=re,Z.boundingSphereRadius=oe,t.ad.invert(B,Z.matrix),Z.frustum=t.aM.fromInvProjectionMatrix(B,1,0,!0),Z.far=Q}let U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/jr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=jr.shadowMapResolution,this._uniformValues.u_shadowmap_0=ro.ShadowMap0,this._uniformValues.u_shadowmap_1=ro.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let W=_.transform.elevation;for(let Y of this._groundShadowTiles){let Z={min:0,max:0};if(W){let X=W.getMinMaxForTile(Y);X&&(Z=X)}this.addShadowReceiver(Y.toUnwrapped(),Z.min,Z.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(a){this._enabled=a}drawShadowPass(a,u){if(!this.enabled)return;let _=this.painter,v=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),v.viewport.set([0,0,jr.shadowMapResolution,jr.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){_.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:t.C.white,depth:1});for(let S of a.order){let k=a._mergedLayers[S];if(!k.hasShadowPass()||k.isHidden(_.transform.zoom))continue;let D=a.getLayerSourceCache(k),A=D?u[D.id]:void 0;(k.type==="model"||A&&A.length)&&_.renderLayer(_,D,k,A)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let a=this.painter,u=a.style,_=a.context,v=u.directionalLight,x=u.ambientLight;if(!v||!x)return;let S=[],k=cs(a,a.longestCutoffRange);k.shouldRenderCutoff&&S.push("RENDER_CUTOFF");let D=ds(u,v,x),A=new t.ae(_.gl.LEQUAL,t.ae.ReadOnly,a.depthRangeFor3D);for(let L of this._groundShadowTiles){let B=L.toUnwrapped(),U=a.isTileAffectedByFog(L),W=a.getOrCreateProgram("groundShadow",{defines:S,overrideFog:U});this.setupShadows(B,W),a.uploadCommonUniforms(_,W,B,null,k);let Y={u_matrix:a.transform.calculateProjMatrix(B),u_ground_shadow_factor:D};W.draw(a,_.gl.TRIANGLES,A,t.ag.disabled,t.a.multiply,t.af.disabled,Y,"ground_shadow",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments,{},a.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?t.a.unblended:t.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(a){let u=this.painter.transform,_=u.calculatePosMatrix(a,u.worldSize);return t.ad.multiply(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(a){return t.ad.multiply(a,this._cascades[this.painter.currentShadowCascade].matrix,a),Float32Array.from(a)}setupShadows(a,u,_,v=0){if(!this.enabled)return;let x=this.painter.transform,S=this.painter.context,k=S.gl,D=this._uniformValues,A=new Float64Array(16),L=x.calculatePosMatrix(a,x.worldSize);for(let B=0;B<this._cascades.length;B++)t.ad.multiply(A,this._cascades[B].matrix,L),D[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),S.activeTexture.set(k.TEXTURE0+ro.ShadowMap0+B),this._cascades[B].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!_,this.useNormalOffset){let B=t.b5(a.canonical),U=2/x.tileSize*t.a3/jr.shadowMapResolution,W=U*this._cascades[0].boundingSphereRadius,Y=U*this._cascades[this._cascades.length-1].boundingSphereRadius,Z=(_==="vector-tile"?1:3)/Math.pow(2,v-a.canonical.z-(1-x.zoom+Math.floor(x.zoom)));D.u_shadow_normal_offset=[B,W*Z,Y*Z],D.u_shadow_bias=[6e-5,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(S,D)}setupShadowsFromMatrix(a,u,_=!1){if(!this.enabled)return;let v=this.painter.context,x=v.gl,S=this._uniformValues,k=new Float64Array(16);for(let D=0;D<jr.cascadeCount;D++)t.ad.multiply(k,this._cascades[D].matrix,a),S[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),v.activeTexture.set(x.TEXTURE0+ro.ShadowMap0+D),this._cascades[D].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);this.useNormalOffset=_,_?(S.u_shadow_normal_offset=[1,5,5],S.u_shadow_bias=[6e-5,.0012,.012]):S.u_shadow_bias=[36e-5,.0012,.012],u.setShadowUniformValues(v,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(a,u,_,v){if(v[2]>=0)return{};let x=function(D,A,L){let B=L/(1<<D.canonical.z);return new t.b6([D.canonical.x*B+D.wrap*L,D.canonical.y*B+D.wrap*L,0],[(D.canonical.x+1)*B+D.wrap*L,(D.canonical.y+1)*B+D.wrap*L,A])}(a,u,_).getCorners(),S=u/-v[2];v[0]<0?(t._.add(x[0],x[0],[v[0]*S,0,0]),t._.add(x[3],x[3],[v[0]*S,0,0])):v[0]>0&&(t._.add(x[1],x[1],[v[0]*S,0,0]),t._.add(x[2],x[2],[v[0]*S,0,0])),v[1]<0?(t._.add(x[0],x[0],[0,v[1]*S,0]),t._.add(x[1],x[1],[0,v[1]*S,0])):v[1]>0&&(t._.add(x[2],x[2],[0,v[1]*S,0]),t._.add(x[3],x[3],[0,v[1]*S,0]));let k={};return k.vertices=x,k.planes=[Rc(x[1],x[0],x[4]),Rc(x[2],x[1],x[5]),Rc(x[3],x[2],x[6]),Rc(x[0],x[3],x[7])],k}addShadowReceiver(a,u,_){this._receivers.add(a,t.b6.fromTileIdAndHeight(a,u,_))}getMaxCascadeForTile(a){let u=this._receivers.get(a);return u&&u.lastCascade?u.lastCascade:0}}function Rc(f,a,u){let _=t._.sub([],u,a),v=t._.sub([],f,a),x=t._.cross([],_,v),S=t._.length(x);return S===0?[0,0,1,0]:(t._.scale(x,x,1/S),[x[0],x[1],x[2],-t._.dot(x,a)])}function ah(f){let a=f.properties.get("direction"),u=t.ac(a.x,a.y,a.z);u[2]=t.at(u[2],0,75);let _=t.b7([u[0],u[1],u[2]]);return t._.fromValues(_.x,_.y,_.z)}function ds(f,a,u){let _=a.properties.get("color"),v=a.properties.get("intensity"),x=a.properties.get("direction"),S=[x.x,x.y,x.z],k=u.properties.get("color"),D=u.properties.get("intensity"),A=Math.max(t._.dot([0,0,1],S),0),L=[0,0,0];t._.scale(L,k.toRenderColor(f.getLut(a.scope)).toArray01Linear().slice(0,3),D);let B=[0,0,0];return t._.scale(B,_.toRenderColor(f.getLut(u.scope)).toArray01Linear().slice(0,3),A*v),t.b8([L[0]>0?L[0]/(L[0]+B[0]):0,L[1]>0?L[1]/(L[1]+B[1]):0,L[2]>0?L[2]/(L[2]+B[2]):0])}function sh(f,a,u,_,v,x){let S=f.zoom,k=f.scale,D=f.worldSize,A=1/D,L=f.aspect,B=Math.sqrt(1+L*L)*Math.tan(.5*f.fovX),U=B*B,W=_-u,Y=_+u,Z,X;U>W/Y?(Z=_,X=_*B):(Z=.5*Y*(1+U),X=.5*Math.sqrt(W*W+2*(_*_+u*u)*U+Y*Y*U*U));let Q=f.projection.pixelsPerMeter(f.center.lat,D),re=f._camera.getCameraToWorldMercator(),oe=[0,0,-Z*A];t._.transformMat4(oe,oe,re);let ae=X*A,_e=f._edgeInsets;if(!(_e.left===0&&_e.top===0&&_e.right===0&&_e.bottom===0||_e.left===_e.right&&_e.top===_e.bottom)){let bt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?Q:1),vt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,u,_);vt[8]=2*-f.centerOffset.x/f.width,vt[9]=2*f.centerOffset.y/f.height;let It=new Float64Array(16);t.ad.mul(It,vt,bt);let xt=new Float64Array(16);t.ad.invert(xt,It);let it=t.aM.fromInvProjectionMatrix(xt,D,S,!0);for(let $e of it.points){let Dt=((ge=$e)[0]/=k,ge[1]/=k,ge[2]=t.ax(ge[2],f._center.lat),ge);ae=Math.max(ae,t._.len(t._.subtract([],oe,Dt)))}}var ge;ae*=v/(v-1);let ne=Math.acos(a[2]),se=Math.atan2(-a[0],-a[1]),le=new rh;le.position=oe,le.setPitchBearing(ne,se);let we=le.getWorldToCamera(D,Q),Re=ae*D,me=Math.min(f._mercatorZfromZoom(17)*D*-2,-2*Re),Le=le.getCameraToClipOrthographic(-Re,Re,-Re,Re,me,(Re+x*Q)/a[2]),Be=new Float64Array(16);t.ad.multiply(Be,Le,we);let Qe=t._.fromValues(Math.floor(1e6*oe[0])/1e6*D,Math.floor(1e6*oe[1])/1e6*D,0),Je=.5*v,Xe=[0,0,0];t._.transformMat4(Xe,Qe,Be),t._.scale(Xe,Xe,Je);let Ee=[Math.floor(Xe[0]),Math.floor(Xe[1]),Math.floor(Xe[2])],Ve=[0,0,0];t._.sub(Ve,Xe,Ee),t._.scale(Ve,Ve,-1/Je);let Ze=new Float64Array(16);return t.ad.identity(Ze),t.ad.translate(Ze,Ze,Ve),t.ad.multiply(Be,Ze,Be),[Be,Re]}function Ou(f,a){return f!=null&&a!=null&&!(!f.hasData()||!a.hasData())&&f.demTexture!=null&&a.demTexture!=null&&f.tileID.key!==a.tileID.key}let Tl=new class{constructor(){this.operations={}}newMorphing(f,a,u,_,v){if(f in this.operations){let x=this.operations[f];x.to.tileID.key!==u.tileID.key&&(x.queued=u)}else this.operations[f]={startTime:_,phase:0,duration:v,from:a,to:u,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;let a=this.operations[f];return{from:a.from,to:a.to,phase:a.phase}}update(f){for(let a in this.operations){let u=this.operations[a];for(u.phase=(f-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,f)){delete this.operations[a];break}}}_nextOp(f,a){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=a,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},lh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Xp(f,a,u){if(a===0)return 0;let _=a<1&&u===514?.25/a:1;return 6*Math.pow(1.5,22-f)*Math.max(a,1)*_}function M_(f,a){let u=1<<f.z;return!a&&(f.x===0||f.x===u-1)||f.y===0||f.y===u-1}let Ru=f=>({u_matrix:f});function Lu(f,a,u,_,v){if(v>0){let x=t.e.now(),S=(x-f.timeAdded)/v,k=a?(x-a.timeAdded)/v:-1,D=u.getSource(),A=_.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),L=!a||Math.abs(a.tileID.overscaledZ-A)>Math.abs(f.tileID.overscaledZ-A),B=L&&f.refreshedUponExpiration?1:t.at(L?S:1-k,0,1);return f.refreshedUponExpiration&&S>=1&&(f.refreshedUponExpiration=!1),a?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class Lc extends ih{constructor(a,u,_,v){super(a,u,_,v),this.type="raster-array",this.maxzoom=22,this._options=t.W({type:"raster-array"},u)}triggerRepaint(a){let u=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);u&&u.enabled&&_&&u._clearRenderCacheForTile(_.id,a.tileID),this.map.triggerRepaint()}loadTile(a,u){let _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(_,t.R.Tile);a.requestParams=v,a.actor||(a.actor=this.dispatcher.getActor()),a.request=a.fetchHeader(void 0,(x,S,k,D)=>{if(delete a.request,a.aborted)return a.state="unloaded",u(null);if(x)return x.code===20?void 0:(a.state="errored",u(x));this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:k,expires:D}),a.state="empty",u(null)})}unloadTile(a,u){let _=a.texture;_&&_ instanceof t.T?(a.destroy(!0),this.map.painter.saveTileTexture(_)):(a.destroy(),a.flushQueues(),a._isHeaderLoaded=!1,delete a._mrt,delete a.textureDescriptor),a.fbo&&(a.fbo.destroy(),delete a.fbo),delete a.request,delete a.requestParams,delete a.neighboringTiles,a.state="unloaded"}prepareTile(a,u,_){a._isHeaderLoaded&&(a.state!=="empty"&&(a.state="reloading"),a.fetchBand(u,_,(v,x)=>{if(v)return a.state="errored",this.fire(new t.d(v)),void this.triggerRepaint(a);x&&(a.setTexture(x,this.map.painter),a.state="loaded",this.triggerRepaint(a))}))}getInitialBand(a){if(!this.rasterLayers)return 0;let u=this.rasterLayers.find(({id:x})=>x===a),_=u&&u.fields,v=_&&_.bands&&_.bands;return v?v[0]:0}getTextureDescriptor(a,u,_){if(!a)return;let v=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;u instanceof t.bk?x=u.paint.get("raster-array-band"):u instanceof t.bl&&(x=u.paint.get("raster-particle-array-band"));let S=x||this.getInitialBand(v);if(S!=null)if(a.textureDescriptor){if(!a.updateNeeded(v,S)||_)return Object.assign({},a.textureDescriptor,{texture:a.texture})}else this.prepareTile(a,v,S)}}let Ur={vector:Tu,raster:ih,"raster-dem":class extends ih{constructor(f,a,u,_){super(f,a,u,_),this.type="raster-dem",this.maxzoom=22,this._options=t.W({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(f,a){let u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(v,x){v&&(f.state="errored",a(v)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",a(null))}f.request=t.h(this.map._requestManager.transformRequest(u,t.R.Tile),(function(v,x,S,k){if(delete f.request,f.aborted)f.state="unloaded",a(null);else if(v)f.state="errored",a(v);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:S,expires:k});let D=ImageBitmap&&x instanceof ImageBitmap&&t.bi(),A=1-(x.width-t.bj(x.width))/2;A<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));let L=D?x:t.e.getImageData(x,A),B={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:A};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",B,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){let a=f.canonical,u=Math.pow(2,a.z),_=(a.x-1+u)%u,v=a.x===0?f.wrap-1:f.wrap,x=(a.x+1+u)%u,S=a.x+1===u?f.wrap+1:f.wrap,k={};return k[new t.aL(f.overscaledZ,v,a.z,_,a.y).key]={backfilled:!1},k[new t.aL(f.overscaledZ,S,a.z,x,a.y).key]={backfilled:!1},a.y>0&&(k[new t.aL(f.overscaledZ,v,a.z,_,a.y-1).key]={backfilled:!1},k[new t.aL(f.overscaledZ,f.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},k[new t.aL(f.overscaledZ,S,a.z,x,a.y-1).key]={backfilled:!1}),a.y+1<u&&(k[new t.aL(f.overscaledZ,v,a.z,_,a.y+1).key]={backfilled:!1},k[new t.aL(f.overscaledZ,f.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},k[new t.aL(f.overscaledZ,S,a.z,x,a.y+1).key]={backfilled:!1}),k}},"raster-array":Lc,geojson:class extends t.E{constructor(f,a,u,_){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(_),this._data=a.data,this._options=t.W({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.minzoom!==void 0&&(this.minzoom=a.minzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;let v=t.a3/this.tileSize;this.workerOptions=t.W({source:this.id,scope:this.scope,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*v,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*v,extent:t.a3,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:t.a3,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*v,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter,dynamic:a.dynamic},a.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){return this._options.dynamic?typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection")?this.fire(new t.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...f.features):this._data=f,this._updateWorkerData(!0),this):this.fire(new t.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(f,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},a),this}getClusterChildren(f,a){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},a),this}getClusterLeaves(f,a,u,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:a,offset:u},_),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.f("dataloading",{dataType:"source"})),this._loaded=!1;let a=t.W({append:f},this.workerOptions);a.scope=this.scope;let u=this._data;typeof u=="string"?(a.request=this.map._requestManager.transformRequest(t.e.resolveURL(u),t.R.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,a,(_,v)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new t.d(_));else{let x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new t.f("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,a){let u=f.actor?"reloadTile":"loadTile";f.actor=this.actor;let _=this.map.style?this.map.style.getLut(this.scope):null,v=this._partialReload,x={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_?{image:_.image.clone()}:null,scope:this.scope,pixelRatio:t.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:v};f.request=this.actor.send(u,x,(S,k)=>v&&!k?(f.state="loaded",a(null)):(delete f.request,f.destroy(),f.aborted?a(null):S?a(S):(f.loadVectorData(k,this.map.painter,u==="reloadTile"),a(null))),void 0,u==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,a){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends t.bm{constructor(f,a,u,_){super(f,a,u,_),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;let f=this.options;this.urls=[];for(let a of f.urls)this.urls.push(this.map._requestManager.transformRequest(a,t.R.Source).url);t.bn(this.urls,(a,u)=>{this._loaded=!0,a?this.fire(new t.d(a)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){let a=this.video.seekable;f<a.start(0)||f>a.end(0)?this.fire(new t.d(new t.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let f=this.map.painter.context,a=f.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(f,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:t.bm,model:class extends t.E{constructor(f,a,u,_){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=a}load(){let f=[];for(let a in this._options.models){let u=this._options.models[a],_=t.l(this.map._requestManager.transformRequest(u.uri,t.R.Model).url).then(v=>{if(!v)return;let x=t.c(v),S=new t.M(a,u.position,u.orientation,x);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(v=>{this.fire(new t.d(new Error(`Could not load model ${a} from ${u.uri}: ${v.message}`)))});f.push(_)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this.fire(new t.d(new Error(`Could not load models: ${a.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,a){}serialize(){return{type:"model"}}},"batched-model":class extends t.E{constructor(f,a,u,_){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=a,this.tiles=this._options.tiles,this.maxzoom=a.maxzoom||19,this.minzoom=a.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"}));let a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=Wp(this._options,this.map._requestManager,a,u,(_,v)=>{this._tileJSONRequest=null,this._loaded=!0,_?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new t.d(_))):v&&(t.W(this,v),v.bounds&&(this.tileBounds=new th(v.bounds,this.minzoom,this.maxzoom)),t.an(v.tiles,this.map._requestManager._customAccessToken),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),f&&f(_)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,a){let u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(u,t.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=a;else{if(f.buckets){let x=Object.values(f.buckets);for(let S of x)S.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",_,v.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",_,v.bind(this),void 0,!0);function v(x,S){return f.aborted?a(null):x&&x.status!==404?a(x):(S&&(S.resourceTiming&&(f.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&f.setExpiryData(S),f.buckets=Xi(Xi({},f.buckets),S.buckets),S.featureIndex&&(f.latestFeatureIndex=S.featureIndex)),f.state="loaded",void a(null))}}serialize(){return t.W({},this._options)}},canvas:class extends t.bm{constructor(f,a,u,_){super(f,a,u,_),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new t.d(new t.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.d(new t.V(`sources.${f}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new t.d(new t.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new t.d(new t.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.d(new t.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let a=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof t.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends t.E{constructor(f,a,u,_){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=a,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new th(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),t.W(this,t.ah(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){let{x:a,y:u,z:_}=f.canonical;return this._implementation.hasTile({x:a,y:u,z:_})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,a){let{x:u,y:_,z:v}=f.tileID.canonical,x=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:u,y:_,z:v},{signal:x.signal})).then((function(S){return delete f.request,f.aborted?(f.state="unloaded",a(null)):S===void 0?(f.state="errored",a(null)):S===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",a(null)):function(k){return k instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement}(S)?(this.loadTileData(f,S),f.state="loaded",void a(null)):(f.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(f.state="errored",a(S))}),f.request.cancel=()=>x.abort()}loadTileData(f,a){f.setTexture(a,this._map.painter)}unloadTile(f,a){if(f.texture&&f.texture instanceof t.T?(f.destroy(!0),f.texture&&f.texture instanceof t.T&&this._map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){let{x:u,y:_,z:v}=f.tileID.canonical;this._implementation.unloadTile({x:u,y:_,z:v})}a&&a()}abortTile(f,a){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),a&&a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){let f=t.al(this.id,this.scope);this._map.style.clearSource(f)}_update(){this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))}}},Fu=function(f,a,u,_){let v=new Ur[a.type](f,a,u,_);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return t.bp(["load","abort","unload","serialize","prepare"],v),v};class Qp extends t.bv{constructor(a){let u={type:"raster-dem",maxzoom:a.transform.maxZoom},_=new t.bw(t.bx(),null),v=Fu("mock-dem",u,_,a.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,u){a.state="loaded",u(null)}}class k_ extends t.bv{constructor(a){let u=Fu("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new t.bw(t.bx(),null),a.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,u,_){if(a.freezeTileCoverage)return;this.transform=a;let v=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,S)=>{if(x[S.key]="",!this._tiles[S.key]){let k=new t.by(S,this._source.tileSize*S.overscaleFactor(),a.tileZoom);k.state="loaded",this._tiles[S.key]=k}return x},{});for(let x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(a){let u=this.proxyCachedFBO[a];if(u!==void 0){let _=Object.values(u);this.renderCachePool.push(..._),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Kp extends t.aL{constructor(a,u,_){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=u,this.projMatrix=_}}class Jp extends t.bq{constructor(a,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},a.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[_,v,x]=function(D){let A=new t.bt,L=new t.bu,B=131;A.reserve(17161),L.reserve(33800);let U=t.a3/128,W=t.a3+U/2,Y=W+U;for(let X=-U;X<Y;X+=U)for(let Q=-U;Q<Y;Q+=U){let re=Q<0||Q>W||X<0||X>W?24575:0,oe=t.at(Math.round(Q),0,t.a3),ae=t.at(Math.round(X),0,t.a3);A.emplaceBack(oe+re,ae)}let Z=(X,Q)=>{let re=Q*B+X;L.emplaceBack(re+1,re,re+B),L.emplaceBack(re+B,re+B+1,re+1)};for(let X=1;X<129;X++)for(let Q=1;Q<129;Q++)Z(Q,X);return[0,129].forEach(X=>{for(let Q=0;Q<130;Q++)Z(Q,X),Z(X,Q)}),[A,L,32768]}(),S=a.context;this.gridBuffer=S.createVertexBuffer(_,t.br.members),this.gridIndexBuffer=S.createIndexBuffer(v),this.gridSegments=t.b.simpleSegment(0,0,_.length,v.length),this.gridNoSkirtSegments=t.b.simpleSegment(0,0,_.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new k_(u.map),this.orthoMatrix=t.ad.create(),t.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,t.a3,0,t.a3,0,1);let k=S.gl;this._overlapStencilMode=new t.ag({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qp(u.map),this._pendingGroundEffectLayers=[]}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),this._style=a,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,u,_){if(a&&a.terrain){this._style!==a&&(this.style=a,this._evaluationZoom=void 0);let v=a.terrain.properties,x=a.terrain.drapeRenderMode===0,S=a.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=t.e.now();let k=a.terrain&&a.terrain.scope,D=v.get("source"),A=x?this._mockSourceCache:a.getSourceCache(D,k);if(!A)return void t.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=A,this._exaggeration=S?this.calculateExaggeration(u):v.get("exaggeration"),!u.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;let L=()=>{this.sourceCache.used&&t.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let B=this.getScaledDemTileSize();this.sourceCache.update(u,B,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),u.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(a){let u=this._previousCameraAltitude,_=a.getFreeCameraOptions().position.z/a.pixelsPerMeter*a.worldSize;this._previousCameraAltitude=_;let v=u!=null?_-u:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;let x=a.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(x);let k=x-this._previousZoom,D=this._previousUpdateTimestamp,A=x;this._evaluationZoom!=null&&(A=this._evaluationZoom,Math.abs(x-A)>.5&&(k=.5*(x-A+k)),k*v<0&&(A+=k)),this._evaluationZoom=A;let L=S.getExaggeration(A),B=L===S.getExaggeration(Math.max(0,A-.1));if(B&&Math.abs(L-this._exaggeration)<.01)return L;let U=Math.min(.1,.00375*(this._updateTimestamp-D));return(B||L<.1||Math.abs(k)<1e-4)&&(U=Math.min(.2,4*U)),t.a2(this._exaggeration,L,U)}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let a in this._style._mergedSourceCaches)this._style._mergedSourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let u=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(t.Y.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let v=this.proxyCoords=u.getIds().map(D=>{let A=u.getTileByID(D).tileID;return A.projMatrix=_.calculateProjMatrix(A.toUnwrapped()),A});(function(D,A){let L=A.transform.pointCoordinate(A.transform.getCameraPoint()),B=new t.P(L.x,L.y);D.sort((U,W)=>{if(W.overscaledZ-U.overscaledZ)return W.overscaledZ-U.overscaledZ;let Y=new t.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Z=new t.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),X=B.mult(1<<U.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(Y)-X.distSqr(Z)})})(v,this.painter);let x=this.proxyToSource||{};this.proxyToSource={},v.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};let S=this._style._mergedSourceCaches;for(let D in S){let A=S[D];if(!A.used||(A!==this.sourceCache&&this.resetTileLookupCache(A.id),this._setupProxiedCoordsForOrtho(A,a[D],x),A.usedForTerrain))continue;let L=a[D];A.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[u.id]=v.map(D=>new Kp(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;let k={};this._visibleDemTiles=[];for(let D of this.proxyCoords){let A=this.terrainTileForTile[D.key];if(!A)continue;let L=A.tileID.key;L in k||(this._visibleDemTiles.push(A),k[L]=L)}}_assignTerrainTiles(a){this._initializing||a.forEach(u=>{if(this.terrainTileForTile[u.key])return;let _=this._findTileCoveringTileID(u,this.sourceCache);_&&(this.terrainTileForTile[u.key]=_)})}_prepareDEMTextures(){let a=this.painter.context,u=a.gl;for(let _ in this.terrainTileForTile){let v=this.terrainTileForTile[_],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(a.activeTexture.set(u.TEXTURE1),Up(this.painter,v,x))}}_prepareDemTileUniforms(a,u,_,v){if(!u||u.demTexture==null)return!1;let x=a.tileID.canonical,S=Math.pow(2,u.tileID.canonical.z-x.z),k=v||"";return _[`u_dem_tl${k}`]=[x.x*S%1,x.y*S%1],_[`u_dem_scale${k}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let a=this.painter.context,u=a.gl;if(!this._emptyDepthBufferTexture){let _=new t.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.T(a,_,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let a=0,u=this._visibleDemTiles.reduce((_,v)=>{if(!v.dem)return _;let x=v.dem.tree.minimums[0];return x>0&&a++,_+x},0);return a?u/a:0}_updateEmptyDEMTexture(){let a=this.painter.context,u=a.gl;a.activeTexture.set(u.TEXTURE2);let _=this._getLoadedAreaMinimum(),[v,x]=(()=>{let k=new t.bz({width:1,height:1},new Float32Array([_]));return[u.R32F,k]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(x,{premultiply:!1}):S=this._emptyDEMTexture=new t.T(a,x,v,{premultiply:!1}),S}setupElevationDraw(a,u,_){let v=this.painter.context,x=v.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};S.u_exaggeration=this.exaggeration();let k=null,D=null,A=1;if(_&&_.morphing&&this._useVertexMorphing){let W=_.morphing.srcDemTile,Y=_.morphing.dstDemTile;A=_.morphing.phase,W&&Y&&(this._prepareDemTileUniforms(a,W,S,"_prev")&&(D=W),this._prepareDemTileUniforms(a,Y,S)&&(k=Y))}let L=W=>W&&W.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST,B=null;var U;if(this.enabled?D&&k?(B=k.demTexture,v.activeTexture.set(x.TEXTURE4),D.demTexture.bind(L(D),x.CLAMP_TO_EDGE),S.u_dem_lerp=A):(k=this.terrainTileForTile[a.tileID.key],B=this._prepareDemTileUniforms(a,k,S)?k.demTexture:this.emptyDEMTexture):B=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),B&&(S.u_dem_size=(U=B).size[0]===1?1:U.size[0]-2,B.bind(L(k),x.CLAMP_TO_EDGE)),v.activeTexture.set(x.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&k){let W=(1<<k.tileID.canonical.z)*t.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=W}if(_&&_.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),u.setTerrainUniformValues(v,S),this.painter.transform.projection.name==="globe"){let W=this.globeUniformValues(this.painter.transform,a.tileID.canonical,_&&_.useDenormalizedUpVectorScale);u.setGlobeUniformValues(v,W)}}globeUniformValues(a,u,_){let v=a.projection;return{u_tile_tl_up:v.upVector(u,0,0),u_tile_tr_up:v.upVector(u,t.a3,0),u_tile_br_up:v.upVector(u,t.a3,t.a3),u_tile_bl_up:v.upVector(u,0,t.a3),u_tile_up_scale:_?t.bs(1):v.upVectorScale(u,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){let u=this.painter,_=this.painter.context;a.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,S,k,D){if(v.transform.projection.name==="globe")(function(A,L,B,U,W){let Y=A.context,Z=Y.gl,X,Q,re=A.transform,oe=t.ba(A,Y,re),ae=(Le,Be)=>{if(Q===Be)return;let Qe=[lh[Be],"PROJECTION_GLOBE_VIEW"];oe&&Qe.push("CUSTOM_ANTIALIASING");let Je=A.isTileAffectedByFog(Le);X=A.getOrCreateProgram("globeRaster",{defines:Qe,overrideFog:Je}),Q=Be},_e=A.colorModeForRenderPass(),ge=new t.ae(Z.LEQUAL,t.ae.ReadWrite,A.depthRangeFor3D);Tl.update(W);let ne=t.bb(re),se=[t.aj(re.center.lng),t.ak(re.center.lat)],le=A.globeSharedBuffers,we=[re.width*t.e.devicePixelRatio,re.height*t.e.devicePixelRatio],Re=Float32Array.from(re.globeMatrix),me={useDenormalizedUpVectorScale:!0};{let Le=A.transform,Be=Xp(Le.zoom,L.exaggeration(),L.sourceCache._source.tileSize);Q=-1;let Qe=Z.TRIANGLES;for(let Je of U){let Xe=B.getTile(Je),Ee=t.ag.disabled,Ve=L.prevTerrainTileForTile[Je.key],Ze=L.terrainTileForTile[Je.key];Ou(Ve,Ze)&&Tl.newMorphing(Je.key,Ve,Ze,W,250),Y.activeTexture.set(Z.TEXTURE0),Xe.texture&&Xe.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let bt=Tl.getMorphValuesForProxy(Je.key),vt=bt?1:0;bt&&t.o(me,{morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:t.b9(bt.phase)}});let It=t.bc(Je.canonical),xt=t.bd(It.getCenter().lat),it=t.be(Je.canonical,It,xt,Le.worldSize/Le._pixelsPerMercatorPixel),$e=t.bf(t.bg(Je.canonical)),Dt=C_(Le.expandedFarZProjMatrix,Re,ne,$e,t.a1(Le.zoom),se,Le.frustumCorners.TL,Le.frustumCorners.TR,Le.frustumCorners.BR,Le.frustumCorners.BL,Le.globeCenterInViewSpace,Le.globeRadius,we,Be,Le._farZ,it);if(ae(Je,vt),X&&(L.setupElevationDraw(Xe,X,me),A.uploadCommonUniforms(Y,X,Je.toUnwrapped()),le)){let[si,ti,xi]=le.getGridBuffers(xt,Be!==0);X.draw(A,Qe,ge,Ee,_e,t.af.backCCW,Dt,"globe_raster",si,ti,xi)}}}if(le&&(A.renderDefaultNorthPole||A.renderDefaultSouthPole)){let Le=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&Le.push("CUSTOM_ANTIALIASING"),X=A.getOrCreateProgram("globeRaster",{defines:Le});for(let Be of U){let{x:Qe,y:Je,z:Xe}=Be.canonical,Ee=Je===0,Ve=Je===(1<<Xe)-1,[Ze,bt,vt,It]=le.getPoleBuffers(Xe,!1);if(It&&(Ee||Ve)){let xt=B.getTile(Be);Y.activeTexture.set(Z.TEXTURE0),xt.texture&&xt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let it=t.bh(Xe,Qe,re),$e=t.bf(t.bg(Be.canonical)),Dt=(si,ti)=>si.draw(A,Z.TRIANGLES,ge,t.ag.disabled,_e,t.af.disabled,C_(re.expandedFarZProjMatrix,it,it,$e,0,se,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,we,0,re._farZ),"globe_pole_raster",ti,vt,It);L.setupElevationDraw(xt,X,me),A.uploadCommonUniforms(Y,X,Be.toUnwrapped()),Ee&&A.renderDefaultNorthPole&&Dt(X,Ze),Ve&&A.renderDefaultSouthPole&&(it=t.ad.scale(t.ad.create(),it,[1,-1,1]),Dt(X,bt))}}}})(v,x,S,k,D);else{let A=v.context,L=A.gl,B,U,W=v.shadowRenderer,Y=cs(v,v.longestCutoffRange),Z=_e=>{if(U===_e)return;let ge=[];ge.push(lh[_e]),Y.shouldRenderCutoff&&ge.push("RENDER_CUTOFF"),B=v.getOrCreateProgram("terrainRaster",{defines:ge}),U=_e},X=v.colorModeForRenderPass(),Q=new t.ae(L.LEQUAL,t.ae.ReadWrite,v.depthRangeFor3D);Tl.update(D);let re=v.transform,oe=Xp(re.zoom,x.exaggeration(),x.sourceCache._source.tileSize),ae=[0,0,0];if(W){let _e=v.style.directionalLight,ge=v.style.ambientLight;_e&&ge&&(ae=ds(v.style,_e,ge))}{U=-1;let _e=L.TRIANGLES,[ge,ne]=[x.gridIndexBuffer,x.gridSegments];for(let se of k){let le=S.getTile(se),we=t.ag.disabled,Re=x.prevTerrainTileForTile[se.key],me=x.terrainTileForTile[se.key];Ou(Re,me)&&Tl.newMorphing(se.key,Re,me,D,250),A.activeTexture.set(L.TEXTURE0),le.texture&&le.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);let Le=Tl.getMorphValuesForProxy(se.key),Be=Le?1:0,Qe;Le&&(Qe={morphing:{srcDemTile:Le.from,dstDemTile:Le.to,phase:t.b9(Le.phase)}});let Je=wt(se.projMatrix,M_(se.canonical,re.renderWorldCopies)?oe/10:oe,ae);if(Z(Be),!B)continue;x.setupElevationDraw(le,B,Qe);let Xe=se.toUnwrapped();W&&W.setupShadows(Xe,B),v.uploadCommonUniforms(A,B,Xe,null,Y),B.draw(v,_e,Q,we,X,t.af.backCCW,Je,"terrain_raster",x.gridBuffer,ge,ne)}}}}(u,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;let u=this.painter,_=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],S=this._drapedRenderBatches.shift(),k=u.style.order,D=[],A=0;for(let L of x){let B=v.getTileByID(L.proxyTileKey),U=v.proxyCachedFBO[L.key]?v.proxyCachedFBO[L.key][a]:void 0,W=U!==void 0?v.renderCache[U]:this.pool[A++],Y=U!==void 0;if(B.texture=W.tex,Y&&!W.dirty){D.push(B.tileID);continue}let Z;_.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(_.clear({color:t.C.transparent,stencil:0}),W.dirty=!1);for(let X=S.start;X<=S.end;++X){let Q=u.style._mergedLayers[k[X]];if(Q.isHidden(u.transform.zoom))continue;let re=u.style.getLayerSourceCache(Q),oe=re?this.proxyToSource[L.key][re.id]:[L];if(!oe)continue;let ae=oe;_.viewport.set([0,0,W.fb.width,W.fb.height]),Z!==(re?re.id:null)&&(this._setupStencil(W,oe,Q,re),Z=re?re.id:null),u.renderLayer(u,re,Q,ae)}if(this._drapedRenderBatches.length===0)for(let X of this._pendingGroundEffectLayers){let Q=u.style._mergedLayers[k[X]];if(Q.isHidden(u.transform.zoom))continue;let re=u.style.getLayerSourceCache(Q),oe=re?this.proxyToSource[L.key][re.id]:[L];if(!oe)continue;let ae=oe;_.viewport.set([0,0,W.fb.width,W.fb.height]),Z!==(re?re.id:null)&&(this._setupStencil(W,oe,Q,re),Z=re?re.id:null),u.renderLayer(u,re,Q,ae)}this.renderedToTile?(W.dirty=!0,D.push(B.tileID)):Y||--A,A===5&&(A=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,u.width,u.height]),S.end+1}postRender(){}isLayerOrderingCorrect(a){let u=a.order.length,_=-1,v=u;for(let x=0;x<u;++x)this._style.isLayerDraped(a._mergedLayers[a.order[x]])?_=Math.max(_,x):v=Math.min(v,x);return v>_}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{a=Math.min(a,u.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,u,_){if(!this._visibleDemTiles)return null;let v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{let S=x.tileID,k=1<<S.overscaledZ,{x:D,y:A}=S.canonical,L=D/k,B=(D+1)/k,U=A/k,W=(A+1)/k;return{minx:L,miny:U,maxx:B,maxy:W,t:x.dem.tree.raycastRoot(L,U,B,W,a,u,_),tile:x}});v.sort((x,S)=>(x.t!==null?x.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(let x of v){if(x.t==null)return null;let S=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,a,u,_);if(S!=null)return S}return null}_createFBO(){let a=this.painter.context,u=a.gl,_=this.drapeBufferSize;a.activeTexture.set(u.TEXTURE0);let v=new t.T(a,{width:_[0],height:_[1],data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);let x=a.createFramebuffer(_[0],_[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new vl(a,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let a in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{let u=this._style._mergedLayers[a],_=u.isHidden(this.painter.transform.zoom);return u.type==="custom"?!_&&u.shouldRedrape():!_&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(let _ of this._style.getSources())if(_ instanceof Tu){a=!0;break}if(!a)return;let u={};for(let _=0;_<this._style.order.length;++_){let v=this._style._mergedLayers[this._style.order[_]],x=this._style.getLayerSourceCache(v);if(x&&!u[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof t.Z){u[x.id]=!0;for(let S of this.proxyCoords){let k=this.proxyToSource[S.key][x.id];if(k)for(let D of k)this._clearRenderCacheForTile(x.id,D)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(let _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof ih){a=!0;break}if(!a)return;let u={};for(let _=0;_<this._style.order.length;++_){let v=this._style._mergedLayers[this._style.order[_]],x=this._style.getLayerSourceCache(v);if(!x||u[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;let S=v.paint.get("raster-fade-duration");for(let k of this.proxyCoords){let D=this.proxyToSource[k.key][x.id];if(D)for(let A of D){let L=Lu(x.getTile(A),x.findLoadedParent(A,0),x,this.painter.transform,S);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(x.id,A)}}}}_setupDrapedRenderBatches(){let a=this._style.order,u=a.length;if(u===0)return;let _=[];this._pendingGroundEffectLayers=[];let v,x=0,S=this._style._mergedLayers[a[x]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++x<u;)S=this._style._mergedLayers[a[x]];for(;x<u;++x){let k=this._style._mergedLayers[a[x]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?v===void 0&&(v=x):(k.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(_.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&_.push({start:v,end:x-1}),_.length!==0){let k=_[_.length-1];this._pendingGroundEffectLayers.every(D=>D>k.end)||t.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(a){let u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){let S=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let k=0;k<S.length;++k){let D=Object.values(S[k]);u.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();let _=this.proxyCoords,v=this._tilesDirty;for(let S=_.length-1;S>=0;S--){let k=_[S];if(u.getTileByID(k.key),u.proxyCachedFBO[k.key]!==void 0){let D=a[k.key],A=this.proxyToSource[k.key],L=0;for(let B in A){let U=A[B],W=D[B];if(!W||W.length!==U.length||U.some((Y,Z)=>Y!==W[Z]||v[B]&&v[B].hasOwnProperty(Y.key))){L=-1;break}++L}for(let B in u.proxyCachedFBO[k.key])u.renderCache[u.proxyCachedFBO[k.key][B]].dirty=L<0||L!==Object.values(D).length}}let x=[...this._drapedRenderBatches];x.sort((S,k)=>k.end-k.start-(S.end-S.start));for(let S of x)for(let k of _){if(u.proxyCachedFBO[k.key])continue;let D=u.renderCachePool.pop();D===void 0&&u.renderCache.length<50&&(D=u.renderCache.length,u.renderCache.push(this._createFBO())),D!==void 0&&(u.proxyCachedFBO[k.key]={},u.proxyCachedFBO[k.key][S.start]=D,u.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(a,u,_,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let x=this.painter.context,S=x.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let k;if(_.isTileClipped())k=u.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):t.ag.disabled}_renderTileClippingMasks(a,u){let _=this.painter,v=this.painter.context,x=v.gl;_._tileClippingMaskIDs={},v.setColorMode(t.a.disabled),v.setDepthMode(t.ae.disabled);let S=_.getOrCreateProgram("clippingMask");for(let k of a){let D=_._tileClippingMaskIDs[k.key]=--u;S.draw(_,x.TRIANGLES,t.ae.disabled,new t.ag({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),t.a.disabled,t.af.disabled,Ru(k.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(a){let u=this.painter.transform;if(a.x<0||a.x>u.width||a.y<0||a.y>u.height)return null;let _=[a.x,a.y,1,1];t.aA.transformMat4(_,_,u.pixelMatrixInverse),t.aA.scale(_,_,1/_[3]),_[0]/=u.worldSize,_[1]/=u.worldSize;let v=u._camera.position,x=t.ax(1,u.center.lat),S=[v[0],v[1],v[2]/x,0],k=t._.subtract([],_.slice(0,3),S);t._.normalize(k,k);let D=this.raycast(S,k,this._exaggeration);return D!==null&&D?(t._.scaleAndAdd(S,S,k,D),S[3]=S[2],S[2]*=x,S):null}drawDepth(){let a=this.painter,u=a.context,_=this.proxySourceCache,v=Math.ceil(a.width),x=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let S=u.gl,k=u.createFramebuffer(v,x,!0,"renderbuffer");u.activeTexture.set(S.TEXTURE0);let D=new t.T(u,{width:v,height:x,data:null},S.RGBA);D.bind(S.NEAREST,S.CLAMP_TO_EDGE),k.colorAttachment.set(D.texture);let A=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,v,x);k.depthAttachment.set(A),this._depthFBO=k,this._depthTexture=D}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,v,x]),function(S,k,D,A){if(S.transform.projection.name==="globe")return;let L=S.context,B=L.gl;L.clear({depth:1});let U=S.getOrCreateProgram("terrainDepth"),W=new t.ae(B.LESS,t.ae.ReadWrite,S.depthRangeFor3D);for(let Y of A){let Z=D.getTile(Y),X=wt(Y.projMatrix,0,[0,0,0]);k.setupElevationDraw(Z,U),U.draw(S,B.TRIANGLES,W,t.ag.disabled,t.a.unblended,t.af.backCCW,X,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(a,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,u,_){if(a.getSource()instanceof t.bm)return this._setupProxiedCoordsForImageSource(a,u,_);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};let v=this.proxiedCoords[a.id]=[],x=this.proxyCoords;for(let D=0;D<x.length;D++){let A=x[D],L=this._findTileCoveringTileID(A,a);if(L){let B=this._createProxiedId(A,L,_[A.key]&&_[A.key][a.id]);v.push(B),this.proxyToSource[A.key][a.id]=[B]}}let S=!1,k=new Set;for(let D=0;D<u.length;D++){let A=a.getTile(u[D]);if(!A||!A.hasData())continue;let L=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==A.tileID.canonical.z){let B=this.proxyToSource[L.tileID.key][a.id],U=this._createProxiedId(L.tileID,A,_[L.tileID.key]&&_[L.tileID.key][a.id]);B?B.splice(B.length-1,0,U):this.proxyToSource[L.tileID.key][a.id]=[U];let W=this.proxyToSource[L.tileID.key][a.id];k.has(W)||k.add(W),v.push(U),S=!0}}if(this._sourceTilesOverlap[a.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(let D of k)D.sort((A,L)=>L.overscaledZ-A.overscaledZ)}_setupProxiedCoordsForImageSource(a,u,_){if(!a.getSource().loaded())return;let v=this.proxiedCoords[a.id]=[],x=this.proxyCoords,S=a.getSource(),k=S.tileID;if(!k)return;let D=new t.P(k.x,k.y)._div(1<<k.z),A=S.coordinates.map(t.Y.fromLngLat).reduce((B,U)=>(B.min.x=Math.min(B.min.x,U.x-D.x),B.min.y=Math.min(B.min.y,U.y-D.y),B.max.x=Math.max(B.max.x,U.x-D.x),B.max.y=Math.max(B.max.y,U.y-D.y),B),{min:new t.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(B,U)=>{let W=B.wrap+B.canonical.x/(1<<B.canonical.z),Y=B.canonical.y/(1<<B.canonical.z),Z=t.a3/(1<<B.canonical.z),X=U.wrap+U.canonical.x/(1<<U.canonical.z),Q=U.canonical.y/(1<<U.canonical.z);return W+Z<X+A.min.x||W>X+A.max.x||Y+Z<Q+A.min.y||Y>Q+A.max.y};for(let B=0;B<x.length;B++){let U=x[B];for(let W=0;W<u.length;W++){let Y=a.getTile(u[W]);if(!Y||!Y.hasData()||L(U,Y.tileID))continue;let Z=this._createProxiedId(U,Y,_[U.key]&&_[U.key][a.id]),X=this.proxyToSource[U.key][a.id];X?X.push(Z):this.proxyToSource[U.key][a.id]=[Z],v.push(Z)}}}_createProxiedId(a,u,_){let v=this.orthoMatrix;if(_){let x=_.find(S=>S.key===u.tileID.key);if(x)return x}if(u.tileID.key!==a.key){let x=a.canonical.z-u.tileID.canonical.z,S,k,D;v=t.ad.create();let A=u.tileID.wrap-a.wrap<<a.overscaledZ;x>0?(S=t.a3>>x,k=S*((u.tileID.canonical.x<<x)-a.canonical.x+A),D=S*((u.tileID.canonical.y<<x)-a.canonical.y)):(S=t.a3<<-x,k=t.a3*(u.tileID.canonical.x-(a.canonical.x+A<<-x)),D=t.a3*(u.tileID.canonical.y-(a.canonical.y<<-x))),t.ad.ortho(v,0,S,0,S,0,1),t.ad.translate(v,v,[k,D,0])}return new Kp(u.tileID,a.key,v)}_findTileCoveringTileID(a,u){let _=u.getTile(a);if(_&&_.hasData())return _;let v=this._findCoveringTileCache[u.id],x=v[a.key];if(_=x?u.getTileByID(x):null,_&&_.hasData()||x===null)return _;let S=_?_.tileID:a,k=S.overscaledZ,D=u.getSource().minzoom,A=[];if(!x){let B=u.getSource().maxzoom;if(a.canonical.z>=B){let U=a.canonical.z-B;u.getSource().reparseOverscaled?(k=Math.max(a.canonical.z+2,u.transform.tileZoom),S=new t.aL(k,a.wrap,B,a.canonical.x>>U,a.canonical.y>>U)):U!==0&&(k=B,S=new t.aL(k,a.wrap,B,a.canonical.x>>U,a.canonical.y>>U))}S.key!==a.key&&(A.push(S.key),_=u.getTile(S))}let L=B=>{A.forEach(U=>{v[U]=B}),A.length=0};for(k-=1;k>=D&&(!_||!_.hasData());k--){_&&L(_.tileID.key);let B=S.calculateScaledKey(k);if(_=u.getTileByID(B),_&&_.hasData())break;let U=v[B];if(U===null)break;U===void 0?A.push(B):_=u.getTileByID(U)}return L(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,u){let _=this._tilesDirty[a];_||(_=this._tilesDirty[a]={}),_[u.key]=!0}}function hs(f,a,u){let _=function(k,D,A){let L=t._.dot(D,k),B=t._.dot(A,[.2126,.7152,.0722]),U=(Y,Z,X)=>(1-X)*Y+X*Z,W=U(1-.3*Math.min(B,1),1,Math.min(L+1,1));return U(.92,1,Math.asin(t.at(D[2],-1,1))/Math.PI+.5)*W}(f,[0,0,1],a),v=[0,0,0];t._.scale(v,u.slice(0,3),_);let x=[0,0,0];t._.scale(x,a.slice(0,3),f[2]);let S=[0,0,0];return t._.add(S,v,x),t.b8(S)}let zu=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],I_=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class ch{static cacheKey(a,u,_,v){let x=`${u}${v?v.cacheKey:""}`;for(let S of _)a.usedDefines.includes(S)&&(x+=`/${S}`);return x}constructor(a,u,_,v,x,S){let k=a.gl;this.program=k.createProgram(),this.configuration=v,this.name=u,this.fixedDefines=[...S];let D=v?v.getBinderAttributes():[],A=(_.staticAttributes||[]).concat(D),L=v?v.defines():[];L=L.concat(S.map(X=>`#define ${X}`));let B=`#version 300 es
`,U=B+L.concat("precision mediump float;",x_,v_.fragmentSource).join(`
`);for(let X of _.fragmentIncludes)U+=`
${ku[X]}`;U+=`
${_.fragmentSource}`;let W=B+L.concat("precision highp float;",x_,v_.vertexSource).join(`
`);for(let X of _.vertexIncludes)W+=`
${ku[X]}`;W+=`
${_.vertexSource}`;let Y=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(Y,U),k.compileShader(Y),k.attachShader(this.program,Y);let Z=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(Z,W),k.compileShader(Z),k.attachShader(this.program,Z),this.attributes={},this.numAttributes=A.length;for(let X=0;X<this.numAttributes;X++)if(A[X]){let Q=A[X].startsWith("a_")?A[X]:`a_${A[X]}`;k.bindAttribLocation(this.program,X,Q),this.attributes[Q]=X}k.linkProgram(this.program),k.deleteShader(Z),k.deleteShader(Y),this.fixedUniforms=x(a),this.binderUniforms=v?v.getUniforms(a):[],S.includes("TERRAIN")&&(this.terrainUniforms=(X=>({u_dem:new t.a7(X),u_dem_prev:new t.a7(X),u_dem_tl:new t.a8(X),u_dem_scale:new t.aa(X),u_dem_tl_prev:new t.a8(X),u_dem_scale_prev:new t.aa(X),u_dem_size:new t.aa(X),u_dem_lerp:new t.aa(X),u_exaggeration:new t.aa(X),u_depth:new t.a7(X),u_depth_size_inv:new t.a8(X),u_meter_to_dem:new t.aa(X),u_label_plane_matrix_inv:new t.a6(X)}))(a)),S.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new t.aq(X),u_tile_tr_up:new t.aq(X),u_tile_br_up:new t.aq(X),u_tile_bl_up:new t.aq(X),u_tile_up_scale:new t.aa(X)}))(a)),S.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new t.a6(X),u_fog_range:new t.a8(X),u_fog_color:new t.as(X),u_fog_horizon_blend:new t.aa(X),u_fog_vertical_limit:new t.a8(X),u_fog_temporal_offset:new t.aa(X),u_frustum_tl:new t.aq(X),u_frustum_tr:new t.aq(X),u_frustum_br:new t.aq(X),u_frustum_bl:new t.aq(X),u_globe_pos:new t.aq(X),u_globe_radius:new t.aa(X),u_globe_transition:new t.aa(X),u_is_globe:new t.a7(X),u_viewport:new t.a8(X)}))(a)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new t.as(X)}))(a)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new t.aq(X),u_lighting_directional_dir:new t.aq(X),u_lighting_directional_color:new t.aq(X),u_ground_radiance:new t.aq(X)}))(a)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new t.a6(X),u_light_matrix_1:new t.a6(X),u_fade_range:new t.a8(X),u_shadow_normal_offset:new t.aq(X),u_shadow_intensity:new t.aa(X),u_shadow_texel_size:new t.aa(X),u_shadow_map_resolution:new t.aa(X),u_shadow_direction:new t.aq(X),u_shadow_bias:new t.aq(X),u_shadowmap_0:new t.a7(X),u_shadowmap_1:new t.a7(X)}))(a))}}setTerrainUniformValues(a,u){if(!this.terrainUniforms)return;let _=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let v in u)_[v]&&_[v].set(this.program,v,u[v])}}setGlobeUniformValues(a,u){if(!this.globeUniforms)return;let _=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let v in u)_[v]&&_[v].set(this.program,v,u[v])}}setFogUniformValues(a,u){if(!this.fogUniforms)return;let _=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let v in u)_[v].set(this.program,v,u[v])}}setCutoffUniformValues(a,u){if(!this.cutoffUniforms)return;let _=this.cutoffUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let v in u)_[v].set(this.program,v,u[v])}}setLightsUniformValues(a,u){if(!this.lightsUniforms)return;let _=this.lightsUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let v in u)_[v].set(this.program,v,u[v])}}setShadowUniformValues(a,u){if(this.failedToCreate||!this.shadowUniforms)return;let _=this.shadowUniforms;a.program.set(this.program);for(let v in u)_[v].set(this.program,v,u[v])}_drawDebugWireframe(a,u,_,v,x,S,k,D,A,L){let B=a.options.wireframe;if(B.terrain===!1&&B.layers2D===!1&&B.layers3D===!1)return;let U=a.context;if(!(!(!B.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!B.layers2D||a._terrain&&a._terrain.renderingToTexture||!zu.includes(this.name))||!(!B.layers3D||!I_.includes(this.name))))return;let W=U.gl,Y=a.wireframeDebugCache.getLinesFromTrianglesBuffer(a.frameCounter,x,U);if(!Y)return;let Z=[...this.fixedDefines];Z.push("DEBUG_WIREFRAME");let X=a.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});U.program.set(X.program);let Q=(ae,_e,ge)=>{if(_e[ae]&&ge[ae])for(let ne in _e[ae])ge[ae][ne]&&ge[ae][ne].set(ge.program,ne,_e[ae][ne].current)};A&&A.setUniforms(X.program,U,X.binderUniforms,k,{zoom:D}),Q("fixedUniforms",this,X),Q("terrainUniforms",this,X),Q("globeUniforms",this,X),Q("fogUniforms",this,X),Q("lightsUniforms",this,X),Q("shadowUniforms",this,X),Y.bind(),U.setColorMode(new t.a([W.ONE,W.ONE_MINUS_SRC_ALPHA,W.ZERO,W.ONE],t.C.transparent,[!0,!0,!0,!1])),U.setDepthMode(new t.ae(u.func===W.LESS?W.LEQUAL:u.func,t.ae.ReadOnly,u.range)),U.setStencilMode(t.ag.disabled);let re=3*S.primitiveLength*2,oe=3*S.primitiveOffset*2*2;L&&L>1?W.drawElementsInstanced(W.LINES,re,W.UNSIGNED_SHORT,oe,L):W.drawElements(W.LINES,re,W.UNSIGNED_SHORT,oe),x.bind(),U.program.set(this.program),U.setDepthMode(u),U.setStencilMode(_),U.setColorMode(v)}draw(a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z,X){let Q=a.context,re=Q.gl;if(this.failedToCreate)return;Q.program.set(this.program),Q.setDepthMode(_),Q.setStencilMode(v),Q.setColorMode(x),Q.setCullFace(S);for(let _e of Object.keys(this.fixedUniforms))this.fixedUniforms[_e].set(this.program,_e,k[_e]);Y&&Y.setUniforms(this.program,Q,this.binderUniforms,U,{zoom:W});let oe={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[u],ae=X&&X>0?1:void 0;for(let _e of B.get()){let ge=_e.vaos||(_e.vaos={});(ge[D]||(ge[D]=new Gv)).bind(Q,this,A,Y?Y.getPaintVertexBuffers():[],L,_e.vertexOffset,Z||[],ae),X&&X>1?re.drawElementsInstanced(u,_e.primitiveLength*oe,re.UNSIGNED_SHORT,_e.primitiveOffset*oe*2,X):L?re.drawElements(u,_e.primitiveLength*oe,re.UNSIGNED_SHORT,_e.primitiveOffset*oe*2):re.drawArrays(u,_e.vertexOffset,_e.vertexLength),u===re.TRIANGLES&&L&&this._drawDebugWireframe(a,_,v,x,L,_e,U,W,Y,X)}}}function Bu(f,a){let u=Math.pow(2,a.tileID.overscaledZ),_=a.tileSize*Math.pow(2,f.transform.tileZoom)/u,v=_*(a.tileID.canonical.x+a.tileID.wrap*u),x=_*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/t.bB(a,1,f.transform.tileZoom),u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}let Nu=t.ad.create(),Fc=(f,a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z)=>{let X=a.style.light,Q=X.properties.get("position"),re=[Q.x,Q.y,Q.z],oe=t.bC.create();X.properties.get("anchor")==="viewport"&&(t.bC.fromRotation(oe,-a.transform.angle),t._.transformMat3(re,re,oe));let ae=X.properties.get("color"),_e=a.transform,ge={u_matrix:f,u_lightpos:re,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_vertical_gradient:+u,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Nu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:x,u_flood_light_color:B,u_vertical_scale:U,u_flood_light_intensity:W,u_ground_shadow_factor:Y,u_emissive_strength:Z};return _e.projection.name==="globe"&&(ge.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],ge.u_zoom_transition=D,ge.u_inv_rot_matrix=L,ge.u_merc_center=A,ge.u_up_dir=_e.projection.upVector(new t.aO(0,0,0),A[0]*t.a3,A[1]*t.a3),ge.u_height_lift=k),ge},zc=(f,a,u)=>({u_matrix:f,u_edge_radius:a,u_vertical_scale:u}),ef=(f,a,u,_,v,x,S,k,D,A,L,B,U,W)=>{let Y=Fc(f,a,u,_,v,x,S,D,A,L,B,U,W,1,[0,0,0],0),Z={u_height_factor:-Math.pow(2,S.overscaledZ)/k.tileSize/8};return t.W(Y,Bu(a,k),Z)},tf=(f,a)=>({u_matrix:f,u_emissive_strength:a}),nf=(f,a,u,_)=>t.W(tf(f,a),Bu(u,_)),T_=(f,a,u)=>({u_matrix:f,u_world:u,u_emissive_strength:a}),Vu=(f,a,u,_,v)=>t.W(nf(f,a,u,_),{u_world:v}),rf=(f,a,u,_)=>{let v=t.a3/u.tileSize;return{u_matrix:f,u_camera_to_center_distance:a.getCameraToCenterDistance(_),u_extrude_scale:[a.pixelsToGLUnits[0]/v,a.pixelsToGLUnits[1]/v]}},ju=(f,a,u=1)=>({u_matrix:f,u_color:a.toRenderColor(null),u_overlay:0,u_overlay_scale:u}),dh=t.ad.create(),El=(f,a,u,_,v,x,S)=>{let k=f.transform,D=k.projection.name==="globe",A=D?t.bD(k.zoom,a.canonical)*k._pixelsPerMercatorPixel:t.bB(u,1,x),L={u_matrix:a.projMatrix,u_extrude_scale:A,u_intensity:S,u_inv_rot_matrix:dh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){L.u_inv_rot_matrix=_,L.u_merc_center=v,L.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],L.u_zoom_transition=t.a1(k.zoom);let B=v[0]*t.a3,U=v[1]*t.a3;L.u_up_dir=k.projection.upVector(new t.aO(0,0,0),B,U)}return L};function E_(f,[a,u,_,v],[x,S]){if(x===S)return[0,0,0,0];let k=255*(f-1)/(f*(S-x));return[a*k,u*k,_*k,v*k]}function of(f,a,[u,_]){return u===_?0:.5/f+(a-u)*(f-1)/(f*(_-u))}let hh=(f,a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z,X,Q,re,oe,ae)=>({u_matrix:f,u_normalize_matrix:a,u_globe_matrix:u,u_merc_matrix:_,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:A,u_fade_t:L.mix,u_opacity:L.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:t.bE(B.paint.get("raster-saturation")),u_contrast_factor:t.bF(B.paint.get("raster-contrast")),u_spin_weights:uh(B.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:W,u_zoom_transition:S,u_merc_center:k,u_cutoff_params:D,u_colorization_mix:E_(t.bG,Z,Q),u_colorization_offset:of(t.bG,X,Q),u_color_ramp:Y,u_texture_offset:[oe/(re+2*oe),re/(re+2*oe)],u_texture_res:[re+2*oe,re+2*oe],u_emissive_strength:ae});function uh(f){f*=Math.PI/180;let a=Math.sin(f),u=Math.cos(f);return[(2*u+1)/3,(-Math.sqrt(3)*a-u+1)/3,(Math.sqrt(3)*a-u+1)/3]}let Gs=.15,af=(f,a,u,_,v,x,S,k,D,A,L,B)=>({u_matrix:f,u_normalize_matrix:a,u_globe_matrix:u,u_merc_matrix:_,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:A,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:B,u_zoom_transition:S,u_merc_center:k,u_cutoff_params:D}),sf=(f,a,u,_,v,x,S,k,D,A)=>({u_particle_texture:f,u_particle_texture_side_len:a,u_tile_offset:u,u_velocity:_,u_color_ramp:x,u_velocity_res:v,u_max_speed:S,u_uv_offset:k,u_data_scale:D,u_data_offset:A,u_particle_pos_scale:1.3,u_particle_pos_offset:[Gs,Gs]}),Zv=(f,a,u,_,v,x,S,k,D,A)=>({u_particle_texture:f,u_particle_texture_side_len:a,u_velocity:u,u_velocity_res:_,u_max_speed:v,u_speed_factor:x,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:k,u_data_scale:D,u_data_offset:A,u_particle_pos_scale:1.3,u_particle_pos_offset:[Gs,Gs]}),ya=t.ad.create(),Bc=(f,a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z,X,Q)=>{let re=v.transform,oe={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:re.getCameraToCenterDistance(Z),u_rotate_symbol:+u,u_aspect_ratio:re.width/re.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:S,u_coord_matrix:k,u_is_text:+D,u_pitch_with_map:+_,u_texsize:A,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ya,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ya,u_up_vector:[0,-1,0],u_color_adj_mat:X,u_icon_transition:Q||0};return Z.name==="globe"&&(oe.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],oe.u_zoom_transition=B,oe.u_inv_rot_matrix=W,oe.u_merc_center=U,oe.u_camera_forward=re._camera.forward(),oe.u_ecef_origin=t.bH(re.globeMatrix,L.toUnwrapped()),oe.u_tile_matrix=Float32Array.from(re.globeMatrix),oe.u_up_vector=Y),oe},Uu=(f,a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z,X)=>t.W(Bc(f,a,u,_,v,x,S,k,D,A,B,U,W,Y,Z,X),{u_gamma_scale:_?v.transform.getCameraToCenterDistance(X)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:t.e.devicePixelRatio,u_is_halo:+L,undefined:void 0}),D_=(f,a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z)=>t.W(Uu(f,a,u,_,v,x,S,k,!0,D,!0,L,B,U,W,Y,Z),{u_texsize_icon:A,u_texture_icon:1}),mh=(f,a,u,_)=>({u_matrix:f,u_emissive_strength:a,u_opacity:u,u_color:_}),A_=(f,a,u,_,v,x,S,k)=>t.W(function(D,A,L,B,U){let{width:W,height:Y}=B.imageManager.getPixelSize(A),Z=Math.pow(2,U.tileID.overscaledZ),X=U.tileSize*Math.pow(2,B.transform.tileZoom)/Z,Q=X*(U.tileID.canonical.x+U.tileID.wrap*Z),re=X*U.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[W,Y],u_pattern_size:L.displaySize,u_tile_units_to_pixels:1/t.bB(U,1,B.transform.tileZoom),u_pixel_coord_upper:[Q>>16,re>>16],u_pixel_coord_lower:[65535&Q,65535&re]}}(0,x,S,_,k),{u_matrix:f,u_emissive_strength:a,u_opacity:u}),lf=new Float32Array(t.ad.identity([])),ph=(f,a,u,_,v,x,S,k,D,A,L,B,U,W=[0,0,0],Y)=>{let Z=v.style.light,X=Z.properties.get("position"),Q=[-X.x,-X.y,X.z],re=t.bC.create();Z.properties.get("anchor")==="viewport"&&(t.bC.fromRotation(re,-v.transform.angle),t._.transformMat3(Q,Q,re));let oe=L.alphaMode==="MASK",ae=Z.properties.get("color").toRenderColor(null),_e=U.paint.get("model-ambient-occlusion-intensity"),ge=U.paint.get("model-color").constantOr(t.C.white).toRenderColor(null),ne=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:a,u_normal_matrix:u,u_node_matrix:_||lf,u_lightpos:Q,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_camera_pos:W,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+oe,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[k[0],k[1],k[2],1],u_metallicFactor:D,u_roughnessFactor:A,u_baseColorTexture:ro.BaseColor,u_metallicRoughnessTexture:ro.MetallicRoughness,u_normalTexture:ro.Normal,u_occlusionTexture:ro.Occlusion,u_emissionTexture:ro.Emission,u_lutTexture:ro.LUT,u_color_mix:[ge.r,ge.g,ge.b,ne],u_aoIntensity:_e,u_emissive_strength:B,u_occlusionTextureTransform:Y||[0,0,0,0]}},P_=(f,a=lf,u=lf)=>({u_matrix:f,u_instance:a,u_node_matrix:u}),O_=(f,a,u,_,v)=>({u_matrix:Float32Array.from(f),u_anchorPos:a,u_screenSizePx:u,u_occluderSizePx:_,u_color:v}),Xv={fillExtrusion:f=>({u_matrix:new t.a6(f),u_lightpos:new t.aq(f),u_lightintensity:new t.aa(f),u_lightcolor:new t.aq(f),u_vertical_gradient:new t.aa(f),u_opacity:new t.aa(f),u_edge_radius:new t.aa(f),u_ao:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_up_dir:new t.aq(f),u_height_lift:new t.aa(f),u_flood_light_color:new t.aq(f),u_vertical_scale:new t.aa(f),u_flood_light_intensity:new t.aa(f),u_ground_shadow_factor:new t.aq(f),u_emissive_strength:new t.aa(f)}),fillExtrusionDepth:f=>({u_matrix:new t.a6(f),u_edge_radius:new t.aa(f),u_vertical_scale:new t.aa(f)}),fillExtrusionPattern:f=>({u_matrix:new t.a6(f),u_lightpos:new t.aq(f),u_lightintensity:new t.aa(f),u_lightcolor:new t.aq(f),u_vertical_gradient:new t.aa(f),u_height_factor:new t.aa(f),u_edge_radius:new t.aa(f),u_ao:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_up_dir:new t.aq(f),u_height_lift:new t.aa(f),u_image:new t.a7(f),u_texsize:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f),u_opacity:new t.aa(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new t.a6(f),u_opacity:new t.aa(f),u_ao_pass:new t.aa(f),u_meter_to_tile:new t.aa(f),u_ao:new t.a8(f),u_flood_light_intensity:new t.aa(f),u_flood_light_color:new t.aq(f),u_attenuation:new t.aa(f),u_edge_radius:new t.aa(f),u_fb:new t.a7(f),u_fb_size:new t.aa(f)}),fill:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f)}),fillPattern:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_image:new t.a7(f),u_texsize:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f)}),fillOutline:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_world:new t.a8(f)}),fillOutlinePattern:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_world:new t.a8(f),u_image:new t.a7(f),u_texsize:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f)}),circle:t.bI,collisionBox:f=>({u_matrix:new t.a6(f),u_camera_to_center_distance:new t.aa(f),u_extrude_scale:new t.a8(f)}),collisionCircle:f=>({u_matrix:new t.a6(f),u_inv_matrix:new t.a6(f),u_camera_to_center_distance:new t.aa(f),u_viewport_size:new t.a8(f)}),debug:f=>({u_color:new t.a9(f),u_matrix:new t.a6(f),u_overlay:new t.a7(f),u_overlay_scale:new t.aa(f)}),clippingMask:f=>({u_matrix:new t.a6(f)}),heatmap:f=>({u_extrude_scale:new t.aa(f),u_intensity:new t.aa(f),u_matrix:new t.a6(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_up_dir:new t.aq(f)}),heatmapTexture:f=>({u_image:new t.a7(f),u_color_ramp:new t.a7(f),u_opacity:new t.aa(f)}),hillshade:f=>({u_matrix:new t.a6(f),u_image:new t.a7(f),u_latrange:new t.a8(f),u_light:new t.a8(f),u_shadow:new t.a9(f),u_highlight:new t.a9(f),u_emissive_strength:new t.aa(f),u_accent:new t.a9(f)}),hillshadePrepare:f=>({u_matrix:new t.a6(f),u_image:new t.a7(f),u_dimension:new t.a8(f),u_zoom:new t.aa(f)}),line:t.bJ,linePattern:t.bK,raster:f=>({u_matrix:new t.a6(f),u_normalize_matrix:new t.a6(f),u_globe_matrix:new t.a6(f),u_merc_matrix:new t.a6(f),u_grid_matrix:new t.ar(f),u_tl_parent:new t.a8(f),u_scale_parent:new t.aa(f),u_fade_t:new t.aa(f),u_opacity:new t.aa(f),u_image0:new t.a7(f),u_image1:new t.a7(f),u_brightness_low:new t.aa(f),u_brightness_high:new t.aa(f),u_saturation_factor:new t.aa(f),u_contrast_factor:new t.aa(f),u_spin_weights:new t.aq(f),u_perspective_transform:new t.a8(f),u_raster_elevation:new t.aa(f),u_zoom_transition:new t.aa(f),u_merc_center:new t.a8(f),u_cutoff_params:new t.as(f),u_colorization_mix:new t.as(f),u_colorization_offset:new t.aa(f),u_color_ramp:new t.a7(f),u_texture_offset:new t.a8(f),u_texture_res:new t.a8(f),u_emissive_strength:new t.aa(f)}),rasterParticle:f=>({u_matrix:new t.a6(f),u_normalize_matrix:new t.a6(f),u_globe_matrix:new t.a6(f),u_merc_matrix:new t.a6(f),u_grid_matrix:new t.ar(f),u_tl_parent:new t.a8(f),u_scale_parent:new t.aa(f),u_fade_t:new t.aa(f),u_opacity:new t.aa(f),u_image0:new t.a7(f),u_image1:new t.a7(f),u_raster_elevation:new t.aa(f),u_zoom_transition:new t.aa(f),u_merc_center:new t.a8(f),u_cutoff_params:new t.as(f)}),rasterParticleTexture:f=>({u_texture:new t.a7(f),u_opacity:new t.aa(f)}),rasterParticleDraw:f=>({u_particle_texture:new t.a7(f),u_particle_texture_side_len:new t.aa(f),u_tile_offset:new t.a8(f),u_velocity:new t.a7(f),u_color_ramp:new t.a7(f),u_velocity_res:new t.a8(f),u_max_speed:new t.aa(f),u_uv_offset:new t.a8(f),u_data_scale:new t.as(f),u_data_offset:new t.aa(f),u_particle_pos_scale:new t.aa(f),u_particle_pos_offset:new t.a8(f)}),rasterParticleUpdate:f=>({u_particle_texture:new t.a7(f),u_particle_texture_side_len:new t.aa(f),u_velocity:new t.a7(f),u_velocity_res:new t.a8(f),u_max_speed:new t.aa(f),u_speed_factor:new t.aa(f),u_reset_rate:new t.aa(f),u_rand_seed:new t.aa(f),u_uv_offset:new t.a8(f),u_data_scale:new t.as(f),u_data_offset:new t.aa(f),u_particle_pos_scale:new t.aa(f),u_particle_pos_offset:new t.a8(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new t.a7(f),u_is_size_feature_constant:new t.a7(f),u_size_t:new t.aa(f),u_size:new t.aa(f),u_camera_to_center_distance:new t.aa(f),u_rotate_symbol:new t.a7(f),u_aspect_ratio:new t.aa(f),u_fade_change:new t.aa(f),u_matrix:new t.a6(f),u_label_plane_matrix:new t.a6(f),u_coord_matrix:new t.a6(f),u_is_text:new t.a7(f),u_pitch_with_map:new t.a7(f),u_texsize:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_camera_forward:new t.aq(f),u_tile_matrix:new t.a6(f),u_up_vector:new t.aq(f),u_ecef_origin:new t.aq(f),u_texture:new t.a7(f),u_icon_transition:new t.aa(f),u_color_adj_mat:new t.a6(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new t.a7(f),u_is_size_feature_constant:new t.a7(f),u_size_t:new t.aa(f),u_size:new t.aa(f),u_camera_to_center_distance:new t.aa(f),u_rotate_symbol:new t.a7(f),u_aspect_ratio:new t.aa(f),u_fade_change:new t.aa(f),u_matrix:new t.a6(f),u_label_plane_matrix:new t.a6(f),u_coord_matrix:new t.a6(f),u_is_text:new t.a7(f),u_pitch_with_map:new t.a7(f),u_texsize:new t.a8(f),u_texture:new t.a7(f),u_gamma_scale:new t.aa(f),u_device_pixel_ratio:new t.aa(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_camera_forward:new t.aq(f),u_tile_matrix:new t.a6(f),u_up_vector:new t.aq(f),u_ecef_origin:new t.aq(f),u_is_halo:new t.a7(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new t.a7(f),u_is_size_feature_constant:new t.a7(f),u_size_t:new t.aa(f),u_size:new t.aa(f),u_camera_to_center_distance:new t.aa(f),u_rotate_symbol:new t.a7(f),u_aspect_ratio:new t.aa(f),u_fade_change:new t.aa(f),u_matrix:new t.a6(f),u_label_plane_matrix:new t.a6(f),u_coord_matrix:new t.a6(f),u_is_text:new t.a7(f),u_pitch_with_map:new t.a7(f),u_texsize:new t.a8(f),u_texsize_icon:new t.a8(f),u_texture:new t.a7(f),u_texture_icon:new t.a7(f),u_gamma_scale:new t.aa(f),u_device_pixel_ratio:new t.aa(f),u_is_halo:new t.a7(f)}),background:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_opacity:new t.aa(f),u_color:new t.a9(f)}),backgroundPattern:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_opacity:new t.aa(f),u_image:new t.a7(f),u_pattern_tl:new t.a8(f),u_pattern_br:new t.a8(f),u_texsize:new t.a8(f),u_pattern_size:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f)}),terrainRaster:Sl,terrainDepth:Sl,skybox:f=>({u_matrix:new t.a6(f),u_sun_direction:new t.aq(f),u_cubemap:new t.a7(f),u_opacity:new t.aa(f),u_temporal_offset:new t.aa(f)}),skyboxGradient:f=>({u_matrix:new t.a6(f),u_color_ramp:new t.a7(f),u_center_direction:new t.aq(f),u_radius:new t.aa(f),u_opacity:new t.aa(f),u_temporal_offset:new t.aa(f)}),skyboxCapture:f=>({u_matrix_3f:new t.ar(f),u_sun_direction:new t.aq(f),u_sun_intensity:new t.aa(f),u_color_tint_r:new t.as(f),u_color_tint_m:new t.as(f),u_luminance:new t.aa(f)}),globeRaster:f=>({u_proj_matrix:new t.a6(f),u_globe_matrix:new t.a6(f),u_normalize_matrix:new t.a6(f),u_merc_matrix:new t.a6(f),u_zoom_transition:new t.aa(f),u_merc_center:new t.a8(f),u_image0:new t.a7(f),u_grid_matrix:new t.ar(f),u_skirt_height:new t.aa(f),u_far_z_cutoff:new t.aa(f),u_frustum_tl:new t.aq(f),u_frustum_tr:new t.aq(f),u_frustum_br:new t.aq(f),u_frustum_bl:new t.aq(f),u_globe_pos:new t.aq(f),u_globe_radius:new t.aa(f),u_viewport:new t.a8(f)}),globeAtmosphere:f=>({u_frustum_tl:new t.aq(f),u_frustum_tr:new t.aq(f),u_frustum_br:new t.aq(f),u_frustum_bl:new t.aq(f),u_horizon:new t.aa(f),u_transition:new t.aa(f),u_fadeout_range:new t.aa(f),u_color:new t.as(f),u_high_color:new t.as(f),u_space_color:new t.as(f),u_temporal_offset:new t.aa(f),u_horizon_angle:new t.aa(f)}),model:f=>({u_matrix:new t.a6(f),u_lighting_matrix:new t.a6(f),u_normal_matrix:new t.a6(f),u_node_matrix:new t.a6(f),u_lightpos:new t.aq(f),u_lightintensity:new t.aa(f),u_lightcolor:new t.aq(f),u_camera_pos:new t.aq(f),u_opacity:new t.aa(f),u_baseColorFactor:new t.as(f),u_emissiveFactor:new t.as(f),u_metallicFactor:new t.aa(f),u_roughnessFactor:new t.aa(f),u_baseTextureIsAlpha:new t.a7(f),u_alphaMask:new t.a7(f),u_alphaCutoff:new t.aa(f),u_baseColorTexture:new t.a7(f),u_metallicRoughnessTexture:new t.a7(f),u_normalTexture:new t.a7(f),u_occlusionTexture:new t.a7(f),u_emissionTexture:new t.a7(f),u_lutTexture:new t.a7(f),u_color_mix:new t.as(f),u_aoIntensity:new t.aa(f),u_emissive_strength:new t.aa(f),u_occlusionTextureTransform:new t.as(f)}),modelDepth:f=>({u_matrix:new t.a6(f),u_instance:new t.a6(f),u_node_matrix:new t.a6(f)}),groundShadow:f=>({u_matrix:new t.a6(f),u_ground_shadow_factor:new t.aq(f)}),stars:f=>({u_matrix:new t.a6(f),u_up:new t.aq(f),u_right:new t.aq(f),u_intensity_multiplier:new t.aa(f)}),occlusion:f=>({u_matrix:new t.a6(f),u_anchorPos:new t.aq(f),u_screenSizePx:new t.a8(f),u_occluderSizePx:new t.a8(f),u_color:new t.as(f)})};function Wu(f,a,u){let _=a.createTileMatrix(f,f.worldSize,u.toUnwrapped());return t.ad.multiply(new Float32Array(16),f.projMatrix,_)}function Qv(f,a,u){if(a.projection.name===u.projection.name)return f.projMatrix;let _=u.clone();return _.setProjection(a.projection),Wu(_,a.getProjection(),f)}function Nc(f,a,u){return a.name===u.projection.name?f.projMatrix:Wu(u,a,f)}let Hu;function fh(f,a,u,_,v,x,S){let k=f.context,D=k.gl,A=f.transform,L=f.getOrCreateProgram("collisionBox"),B=[],U=0,W=0;for(let ae=0;ae<_.length;ae++){let _e=_[ae],ge=a.getTile(_e),ne=ge.getBucket(u);if(!ne)continue;let se=Qv(_e,ne,A),le=se;v[0]===0&&v[1]===0||(le=f.translatePosMatrix(se,ge,v,x));let we=S?ne.textCollisionBox:ne.iconCollisionBox,Re=ne.collisionCircleArray;if(Re.length>0){let me=t.ad.create(),Le=le;t.ad.mul(me,ne.placementInvProjMatrix,A.glCoordMatrix),t.ad.mul(me,me,ne.placementViewportMatrix),B.push({circleArray:Re,circleOffset:W,transform:Le,invTransform:me,projection:ne.getProjection()}),U+=Re.length/4,W=U}we&&(f.terrain&&f.terrain.setupElevationDraw(ge,L),L.draw(f,D.LINES,t.ae.disabled,t.ag.disabled,f.colorModeForRenderPass(),t.af.disabled,rf(le,A,ge,ne.getProjection()),u.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,A.zoom,null,[we.collisionVertexBuffer,we.collisionVertexBufferExt]))}if(!S||!B.length)return;let Y=f.getOrCreateProgram("collisionCircle"),Z=new t.bL;Z.resize(4*U),Z._trim();let X=0;for(let ae of B)for(let _e=0;_e<ae.circleArray.length/4;_e++){let ge=4*_e,ne=ae.circleArray[ge+0],se=ae.circleArray[ge+1],le=ae.circleArray[ge+2],we=ae.circleArray[ge+3];Z.emplace(X++,ne,se,le,we,0),Z.emplace(X++,ne,se,le,we,1),Z.emplace(X++,ne,se,le,we,2),Z.emplace(X++,ne,se,le,we,3)}(!Hu||Hu.length<2*U)&&(Hu=function(ae){let _e=2*ae,ge=new t.bu;ge.resize(_e),ge._trim();for(let ne=0;ne<_e;ne++){let se=6*ne;ge.uint16[se+0]=4*ne+0,ge.uint16[se+1]=4*ne+1,ge.uint16[se+2]=4*ne+2,ge.uint16[se+3]=4*ne+2,ge.uint16[se+4]=4*ne+3,ge.uint16[se+5]=4*ne+0}return ge}(U));let Q=k.createIndexBuffer(Hu,!0),re=k.createVertexBuffer(Z,t.bM.members,!0);for(let ae of B){let _e={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(oe=A).getCameraToCenterDistance(ae.projection),u_viewport_size:[oe.width,oe.height]};Y.draw(f,D.TRIANGLES,t.ae.disabled,t.ag.disabled,f.colorModeForRenderPass(),t.af.disabled,_e,u.id,re,Q,t.b.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,A.zoom)}var oe;re.destroy(),Q.destroy()}let Dl=t.ad.create();function R_(f){let a=f._camera.getWorldToCamera(f.worldSize,1),u=t.ad.multiply([],a,f.globeMatrix);t.ad.invert(u,u);let _=[0,0,0],v=[0,1,0,0];return t.aA.transformMat4(v,v,u),_[0]=v[0],_[1]=v[1],_[2]=v[2],t._.normalize(_,_),_}function Kv({width:f,height:a,anchor:u,textOffset:_,textScale:v},x){let{horizontalAlign:S,verticalAlign:k}=t.bQ(u),D=-(S-.5)*f,A=-(k-.5)*a,L=t.bP(u,_);return new t.P((D/v+L[0])*x,(A/v+L[1])*x)}function L_(f,a,u,_,v,x,S,k,D,A,L){let B=f.text.placedSymbolArray,U=f.text.dynamicLayoutVertexArray,W=f.icon.dynamicLayoutVertexArray,Y={},Z=f.getProjection(),X=Nc(k,Z,x),Q=x.elevation,re=Z.upVectorScale(k.canonical,x.center.lat,x.worldSize).metersToTile;U.clear();for(let oe=0;oe<B.length;oe++){let ae=B.get(oe),{tileAnchorX:_e,tileAnchorY:ge,numGlyphs:ne}=ae,se=ae.hidden||!ae.crossTileID||f.allowVerticalPlacement&&!ae.placedOrientation?null:_[ae.crossTileID];if(se){let le=0,we=0,Re=0;if(Q){let Ze=Q?Q.getAtTileOffset(k,_e,ge):0,[bt,vt,It]=Z.upVector(k.canonical,_e,ge);le=Ze*bt*re,we=Ze*vt*re,Re=Ze*It*re}let[me,Le,Be,Qe]=Zo(ae.projectedAnchorX+le,ae.projectedAnchorY+we,ae.projectedAnchorZ+Re,u?X:S),Je=Jr(x.getCameraToCenterDistance(Z),Qe),Xe=v.evaluateSizeForFeature(f.textSizeData,A,ae)*Je/t.bN;u&&(Xe*=f.tilePixelRatio/D);let Ee=Kv(se,Xe);u?({x:me,y:Le,z:Be}=Z.projectTilePoint(_e+Ee.x,ge+Ee.y,k.canonical),[me,Le,Be]=Zo(me+le,Le+we,Be+Re,S)):(a&&Ee._rotate(-x.angle),me+=Ee.x,Le+=Ee.y,Be=0);let Ve=f.allowVerticalPlacement&&ae.placedOrientation===t.aE.vertical?Math.PI/2:0;for(let Ze=0;Ze<ne;Ze++)t.aH(U,me,Le,Be,Ve);L&&ae.associatedIconIndex>=0&&(Y[ae.associatedIconIndex]={x:me,y:Le,z:Be,angle:Ve})}else Il(ne,U)}if(L){W.clear();let oe=f.icon.placedSymbolArray;for(let ae=0;ae<oe.length;ae++){let _e=oe.get(ae),{numGlyphs:ge}=_e,ne=Y[ae];if(_e.hidden||!ne)Il(ge,W);else{let{x:se,y:le,z:we,angle:Re}=ne;for(let me=0;me<ge;me++)t.aH(W,se,le,we,Re)}}f.icon.dynamicLayoutVertexBuffer.updateData(W)}f.text.dynamicLayoutVertexBuffer.updateData(U)}function cf(f,a,u,_,v,x,S={}){let k=u.paint.get("icon-translate"),D=u.paint.get("text-translate"),A=u.paint.get("icon-translate-anchor"),L=u.paint.get("text-translate-anchor"),B=u.layout.get("icon-rotation-alignment"),U=u.layout.get("text-rotation-alignment"),W=u.layout.get("icon-pitch-alignment"),Y=u.layout.get("text-pitch-alignment"),Z=u.layout.get("icon-keep-upright"),X=u.layout.get("text-keep-upright"),Q=u.paint.get("icon-color-saturation"),re=u.paint.get("icon-color-contrast"),oe=u.paint.get("icon-color-brightness-min"),ae=u.paint.get("icon-color-brightness-max"),_e=u.paint.get("icon-occlusion-opacity").constantOr(0),ge=u.paint.get("text-occlusion-opacity").constantOr(0),ne=f.context,se=ne.gl,le=f.transform,we=B==="map",Re=U==="map",me=W==="map",Le=Y==="map",Be=_e!==1,Qe=ge!==1,Je=u.layout.get("symbol-sort-key").constantOr(1)!==void 0,Xe=!1,Ee=f.depthModeForSublayer(0,t.ae.ReadOnly),Ve=[t.aj(le.center.lng),t.ak(le.center.lat)],Ze=u.layout.get("text-variable-anchor"),bt=le.projection.name==="globe",vt=[],It=[0,-1,0];for(let xt of _){let it=a.getTile(xt),$e=it.getBucket(u);if(!$e||$e.projection.name==="mercator"&&bt||$e.fullyClipped)continue;let Dt=$e.projection.name==="globe",si=Dt?t.a1(le.zoom):0,ti=Nc(xt,$e.getProjection(),le),xi=le.calculatePixelsToTileUnitsMatrix(it),Pi=Ze&&$e.hasTextData(),tn=$e.hasIconTextFit()&&Pi&&$e.hasIconData(),Kt=$e.getProjection().createInversionMatrix(le,xt.canonical),qi=()=>{let Ke=we&&u.layout.get("symbol-placement")!=="point",St=[];u.hasInitialOcclusionOpacityProperties&&Be&&f.symbolParams.useOcclusionQueries&&!Dt&&!bt&&St.push("OCCLUSION_QUERIES"),u.hasInitialOcclusionOpacityProperties||St.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH");let zn=Ke||tn,$i=u.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&me&&St.push("PITCH_WITH_MAP_TERRAIN"),Dt&&(St.push("PROJECTION_GLOBE_VIEW"),zn&&St.push("PROJECTED_POS_ON_VIEWPORT")),$i>0&&St.push("ICON_TRANSITION"),$e.icon.zOffsetVertexBuffer&&St.push("Z_OFFSET"),Q===0&&re===0&&oe===0&&ae===1||St.push("COLOR_ADJUSTMENT");let Pe=$e.icon.programConfigurations.get(u.id),jo=f.getOrCreateProgram($e.sdfIcons?"symbolSDF":"symbolIcon",{config:Pe,defines:St}),Hr,ao=it.imageAtlasTexture?it.imageAtlasTexture.size:[0,0],Dr=$e.iconSizeData,yo=t.aD(Dr,le.zoom),Ma=me||le.pitch!==0,Uo=Ml(ti,it.tileID.canonical,me,we,le,$e.getProjection(),xi),Js=Pc(ti,it.tileID.canonical,me,we,le,$e.getProjection(),xi),el=f.translatePosMatrix(Js,it,k,A,!0),ps=f.translatePosMatrix(ti,it,k,A),Ga=zn?Dl:Uo,fs=we&&!me&&!Ke,Kc=It;!bt&&!le.mercatorFromTransition||we||(Kc=R_(le));let Jc=Dt?Kc:It;if($e.sdfIcons&&!$e.iconsInText)Hr=Uu(Dr.kind,yo,fs,me,f,ps,Ga,el,!1,ao,!0,xt,si,Ve,Kt,Jc,$e.getProjection());else{let Sr=u.getColorAdjustmentMatrix(Q,re,oe,ae);Hr=Bc(Dr.kind,yo,fs,me,f,ps,Ga,el,!1,ao,xt,si,Ve,Kt,Jc,$e.getProjection(),Sr,$i)}let jl=it.imageAtlasTexture?it.imageAtlasTexture:null,ed=u.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear,hm=$e.sdfIcons||f.options.rotating||f.options.zooming||ed||Ma?se.LINEAR:se.NEAREST,um=$e.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,jf=f.terrain&&me&&Ke?t.ad.invert(t.ad.create(),Uo):Dl;if(Ke&&$e.icon){let Sr=le.elevation,Uf=Sr?Sr.getAtTileOffsetFunc(xt,le.center.lat,le.worldSize,$e.getProjection()):null,td=kl(ti,it.tileID.canonical,me,we,le,$e.getProjection(),xi);Eu($e,ti,f,!1,td,Js,me,Z,Uf,xt)}return{program:jo,buffers:$e.icon,uniformValues:Hr,atlasTexture:jl,atlasTextureIcon:null,atlasInterpolation:hm,atlasInterpolationIcon:null,isSDF:$e.sdfIcons,hasHalo:um,tile:it,labelPlaneMatrixInv:jf}},pn=()=>{let Ke=Re&&u.layout.get("symbol-placement")!=="point",St=[],zn=Ke||Ze||tn;u.hasInitialOcclusionOpacityProperties&&Qe&&f.symbolParams.useOcclusionQueries&&!Dt&&!bt&&St.push("OCCLUSION_QUERIES"),u.hasInitialOcclusionOpacityProperties||St.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH"),f.terrainRenderModeElevated()&&Le&&St.push("PITCH_WITH_MAP_TERRAIN"),Dt&&(St.push("PROJECTION_GLOBE_VIEW"),zn&&St.push("PROJECTED_POS_ON_VIEWPORT")),$e.text.zOffsetVertexBuffer&&St.push("Z_OFFSET");let $i=$e.text.programConfigurations.get(u.id),Pe=f.getOrCreateProgram($e.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:$i,defines:St}),jo,Hr=[0,0],ao=null,Dr=$e.textSizeData;$e.iconsInText&&(Hr=it.imageAtlasTexture?it.imageAtlasTexture.size:[0,0],ao=it.imageAtlasTexture?it.imageAtlasTexture:null,jo=Le||le.pitch!==0||f.options.rotating||f.options.zooming||Dr.kind==="composite"||Dr.kind==="camera"?se.LINEAR:se.NEAREST);let yo=it.glyphAtlasTexture?it.glyphAtlasTexture.size:[0,0],Ma=t.aD(Dr,le.zoom),Uo=Ml(ti,it.tileID.canonical,Le,Re,le,$e.getProjection(),xi),Js=Pc(ti,it.tileID.canonical,Le,Re,le,$e.getProjection(),xi),el=f.translatePosMatrix(Js,it,D,L,!0),ps=f.translatePosMatrix(ti,it,D,L),Ga=zn?Dl:Uo,fs=Re&&!Le&&!Ke,Kc=It;!bt&&!le.mercatorFromTransition||Re||(Kc=R_(le));let Jc=Dt?Kc:It,jl;jl=$e.iconsInText?D_(Dr.kind,Ma,fs,Le,f,ps,Ga,el,yo,Hr,xt,si,Ve,Kt,Jc,$e.getProjection()):Uu(Dr.kind,Ma,fs,Le,f,ps,Ga,el,!0,yo,!0,xt,si,Ve,Kt,Jc,$e.getProjection());let ed=it.glyphAtlasTexture?it.glyphAtlasTexture:null,hm=se.LINEAR,um=u.paint.get("text-halo-width").constantOr(1)!==0,jf=f.terrain&&Le&&Ke?t.ad.invert(t.ad.create(),Uo):Dl;if(Ke&&$e.text){let Sr=le.elevation,Uf=Sr?Sr.getAtTileOffsetFunc(xt,le.center.lat,le.worldSize,$e.getProjection()):null,td=kl(ti,it.tileID.canonical,Le,Re,le,$e.getProjection(),xi);Eu($e,ti,f,!0,td,Js,Le,X,Uf,xt)}return{program:Pe,buffers:$e.text,uniformValues:jl,atlasTexture:ed,atlasTextureIcon:ao,atlasInterpolation:hm,atlasInterpolationIcon:jo,isSDF:!0,hasHalo:um,tile:it,labelPlaneMatrixInv:jf}},Ji=$e.icon.segments.get().length,Si=$e.text.segments.get().length,ri=Ji&&!S.onlyText?qi():null,vn=Si&&!S.onlyIcons?pn():null,kn=u.paint.get("icon-opacity").constantOr(1),on=u.paint.get("text-opacity").constantOr(1);if(Je&&$e.canOverlap){Xe=!0;let Ke=kn&&!S.onlyText?$e.icon.segments.get():[],St=on&&!S.onlyIcons?$e.text.segments.get():[];for(let zn of Ke)vt.push({segments:new t.b([zn]),sortKey:zn.sortKey,state:ri});for(let zn of St)vt.push({segments:new t.b([zn]),sortKey:zn.sortKey,state:vn})}else S.onlyText||vt.push({segments:kn?$e.icon.segments:new t.b([]),sortKey:0,state:ri}),S.onlyIcons||vt.push({segments:on?$e.text.segments:new t.b([]),sortKey:0,state:vn})}Xe&&vt.sort((xt,it)=>xt.sortKey-it.sortKey);for(let xt of vt){let it=xt.state;if(it)if(f.terrain&&f.terrain.setupElevationDraw(it.tile,it.program,{useDepthForOcclusion:!u.hasInitialOcclusionOpacityProperties&&le.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:it.labelPlaneMatrixInv}),ne.activeTexture.set(se.TEXTURE0),it.atlasTexture&&it.atlasTexture.bind(it.atlasInterpolation,se.CLAMP_TO_EDGE,!0),it.atlasTextureIcon&&(ne.activeTexture.set(se.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,se.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,it.program),it.hasHalo){let $e=it.uniformValues;$e.u_is_halo=1,Vc(it.buffers,xt.segments,u,f,it.program,Ee,v,x,$e,2),$e.u_is_halo=0}else{if(it.isSDF){let $e=it.uniformValues;it.hasHalo&&($e.u_is_halo=1,Vc(it.buffers,xt.segments,u,f,it.program,Ee,v,x,$e,1)),$e.u_is_halo=0}Vc(it.buffers,xt.segments,u,f,it.program,Ee,v,x,it.uniformValues,1)}}}function Vc(f,a,u,_,v,x,S,k,D,A){let L=_.context.gl,B=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];f.occlusionQueryOpacityVertexBuffer.length>0&&B.push(f.occlusionQueryOpacityVertexBuffer),v.draw(_,L.TRIANGLES,x,S,k,t.af.disabled,D,u.id,f.layoutVertexBuffer,f.indexBuffer,a,u.paint,_.transform.zoom,f.programConfigurations.get(u.id),B,A)}function df(f,a,u,_,v,x,S){let k=f.context.gl,D=u.paint.get("fill-pattern"),A=D&&D.constantOr(1),L,B,U,W,Y;S?(B=A&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=k.LINES):(B=A?"fillPattern":"fill",L=k.TRIANGLES);for(let Z of _){let X=a.getTile(Z);if(A&&!X.patternsLoaded())continue;let Q=X.getBucket(u);if(!Q)continue;f.prepareDrawTile();let re=Q.programConfigurations.get(u.id),oe=f.isTileAffectedByFog(Z),ae=f.getOrCreateProgram(B,{config:re,overrideFog:oe});A&&(f.context.activeTexture.set(k.TEXTURE0),X.imageAtlasTexture&&X.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),re.updatePaintBuffers());let _e=D.constantOr(null);if(_e&&X.imageAtlas){let se=X.imageAtlas.patternPositions[_e.toString()];se&&re.setConstantPatternPositions(se)}let ge=f.translatePosMatrix(Z.projMatrix,X,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),ne=u.paint.get("fill-emissive-strength");if(S){W=Q.indexBuffer2,Y=Q.segments2;let se=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];U=B==="fillOutlinePattern"&&A?Vu(ge,ne,f,X,se):T_(ge,ne,se)}else W=Q.indexBuffer,Y=Q.segments,U=A?nf(ge,ne,f,X):tf(ge,ne);f.uploadCommonUniforms(f.context,ae,Z.toUnwrapped()),ae.draw(f,L,v,f.stencilModeForClipping(Z),x,t.af.disabled,U,u.id,Q.layoutVertexBuffer,W,Y,u.paint,f.transform.zoom,re,void 0)}}function jc(f,a,u,_,v,x,S,k){u.resetLayerRenderingStats(f);let D=f.context,A=D.gl,L=f.transform,B=u.paint.get("fill-extrusion-pattern"),U=B.constantOr(1),W=u.paint.get("fill-extrusion-opacity"),Y=f.style.enable3dLights(),Z=u.paint.get(Y&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),X=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],Q=u.layout.get("fill-extrusion-edge-radius"),re=Q>0&&!u.paint.get("fill-extrusion-rounded-roof"),oe=re?0:Q,ae=L.projection.name==="globe"?t.bY():0,_e=L.projection.name==="globe",ge=_e?t.a1(L.zoom):0,ne=[t.aj(L.center.lng),t.ak(L.center.lat)],se=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(u.lut).toArray01().slice(0,3),le=u.paint.get("fill-extrusion-flood-light-intensity"),we=u.paint.get("fill-extrusion-vertical-scale"),Re=cs(f,u.paint.get("fill-extrusion-cutoff-fade-range")),me=u.paint.get("fill-extrusion-emissive-strength"),Le=[],Be;_e&&Le.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&Le.push("FAUX_AO"),re&&Le.push("ZERO_ROOF_RADIUS"),k&&Le.push("HAS_CENTROID"),le>0&&Le.push("FLOOD_LIGHT"),Re.shouldRenderCutoff&&Le.push("RENDER_CUTOFF");let Qe=f.renderPass==="shadow",Je=f.shadowRenderer,Xe=Qe&&!!Je;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Ee=[0,0,0];if(Je){let bt=f.style.directionalLight,vt=f.style.ambientLight;bt&&vt&&(Ee=ds(f.style,bt,vt)),Be=Le.concat(["SHADOWS_SINGLE_CASCADE"])}let Ve=Xe?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",Ze=u.getLayerRenderingStats();for(let bt of _){let vt=a.getTile(bt),It=vt.getBucket(u);if(!It||It.projection.name!==L.projection.name)continue;let xt=!1;Je&&(xt=Je.getMaxCascadeForTile(bt.toUnwrapped())===0);let it=f.isTileAffectedByFog(bt),$e=It.programConfigurations.get(u.id),Dt=f.getOrCreateProgram(Ve,{config:$e,defines:xt?Be:Le,overrideFog:it});if(f.terrain&&f.terrain.setupElevationDraw(vt,Dt,{useMeterToDem:!0}),!It.centroidVertexBuffer){let Kt=Dt.attributes.a_centroid_pos;Kt!==void 0&&A.vertexAttrib2f(Kt,0,0)}!Qe&&Je&&Je.setupShadows(vt.tileID.toUnwrapped(),Dt,"vector-tile",vt.tileID.overscaledZ),U&&(f.context.activeTexture.set(A.TEXTURE0),vt.imageAtlasTexture&&vt.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),$e.updatePaintBuffers());let si=B.constantOr(null);if(si&&vt.imageAtlas){let Kt=vt.imageAtlas.patternPositions[si.toString()];Kt&&$e.setConstantPatternPositions(Kt)}let ti=u.paint.get("fill-extrusion-vertical-gradient"),xi;if(Qe&&Je){if(hf(vt.tileID,It,f))continue;let Kt=Je.calculateShadowPassMatrixFromTile(vt.tileID.toUnwrapped());xi=zc(Kt,oe,we)}else{let Kt=f.translatePosMatrix(bt.expandedProjMatrix,vt,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),qi=L.projection.createInversionMatrix(L,bt.canonical);xi=U?ef(Kt,f,ti,W,X,oe,bt,vt,ae,ge,ne,qi,se,we):Fc(Kt,f,ti,W,X,oe,bt,ae,ge,ne,qi,se,we,le,Ee,me)}f.uploadCommonUniforms(D,Dt,bt.toUnwrapped(),null,Re);let Pi=It.segments;if(L.projection.name==="mercator"&&!Qe&&(Pi=It.getVisibleSegments(vt.tileID,f.terrain,f.transform.getFrustum(0)),!Pi.get().length))continue;if(Ze)if(Qe)for(let Kt of Pi.get())Ze.numRenderedVerticesInShadowPass+=Kt.primitiveLength;else for(let Kt of Pi.get())Ze.numRenderedVerticesInTransparentPass+=Kt.primitiveLength;let tn=[];(f.terrain||k)&&tn.push(It.centroidVertexBuffer),_e&&tn.push(It.layoutVertexExtBuffer),Dt.draw(f,D.gl.TRIANGLES,v,x,S,t.af.backCCW,xi,u.id,It.layoutVertexBuffer,It.indexBuffer,Pi,u.paint,f.transform.zoom,$e,tn)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function fo(f,a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z,X,Q,re){let oe=f.context,ae=oe.gl,_e=f.transform,ge=f.transform.zoom,ne=[],se=cs(f,u.paint.get("fill-extrusion-cutoff-fade-range"));A==="clear"?(ne.push("CLEAR_SUBPASS"),re&&(ne.push("CLEAR_FROM_TEXTURE"),oe.activeTexture.set(ae.TEXTURE0),re.bind(ae.LINEAR,ae.CLAMP_TO_EDGE))):A==="sdf"&&ne.push("SDF_SUBPASS"),X&&ne.push("HAS_CENTROID"),se.shouldRenderCutoff&&ne.push("RENDER_CUTOFF");let le=u.layout.get("fill-extrusion-edge-radius"),we=(Re,me,Le,Be,Qe)=>{let Je=me.programConfigurations.get(u.id),Xe=f.isTileAffectedByFog(Re),Ee=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:Je,defines:ne,overrideFog:Xe}),Ve=((bt,vt,It,xt,it,$e,Dt,si,ti,xi,Pi)=>({u_matrix:vt,u_opacity:It,u_ao_pass:xt?1:0,u_meter_to_tile:it,u_ao:$e,u_flood_light_intensity:Dt,u_flood_light_color:si,u_attenuation:ti,u_edge_radius:xi,u_fb:0,u_fb_size:Pi}))(0,Be,L,D,Qe,[B,U*Qe],W,Y,Z,ge>=17?0:le*Qe,re?re.size[0]:0),Ze=[];X&&Ze.push(me.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(oe,Ee,Re.toUnwrapped(),null,se),Ee.draw(f,oe.gl.TRIANGLES,v,x,S,k,Ve,u.id,me.vertexBuffer,me.indexBuffer,Le,u.paint,ge,Je,Ze)};for(let Re of _){let me=a.getTile(Re),Le=me.getBucket(u);if(!Le||Le.projection.name!==_e.projection.name||!Le.groundEffect||Le.groundEffect&&!Le.groundEffect.hasData())continue;let Be=Le.groundEffect,Qe=1/Le.tileToMeter;{let Je=f.translatePosMatrix(Re.projMatrix,me,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Xe=Be.getDefaultSegment();we(Re,Be,Xe,Je,Qe)}if(Q)for(let Je=0;Je<4;Je++){let Xe=t.bZ[Je](Re),Ee=a.getTile(Xe);if(!Ee)continue;let Ve=Ee.getBucket(u);if(!Ve||Ve.projection.name!==_e.projection.name||!Ve.groundEffect||Ve.groundEffect&&!Ve.groundEffect.hasData())continue;let Ze=Ve.groundEffect,bt,vt;Je===0?(bt=[-t.a3,0,0],vt=1):Je===1?(bt=[t.a3,0,0],vt=0):Je===2?(bt=[0,-t.a3,0],vt=3):(bt=[0,t.a3,0],vt=2);let It=Ze.regionSegments[vt];if(!It)continue;let xt=new Float32Array(16);t.ad.translate(xt,Re.projMatrix,bt),we(Re,Ze,It,f.translatePosMatrix(xt,me,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Qe)}}}function Gu(f,a,u,_,v,x,S){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();let k=x?x.findDEMTileFor(u):null;if(!(k&&k.dem||S))return;let D=Q=>new t.P(Math.ceil((Q+t.c0)*t.c1),0),A=Q=>{let re=a.getSource().minzoom,oe=_e=>{let ge=a.getTileByID(_e);if(ge&&ge.hasData())return ge.getBucket(v)},ae=[0,-1,1];for(let _e of ae){if(Q.overscaledZ+_e<re)continue;let ge=oe(Q.calculateScaledKey(Q.overscaledZ+_e));if(ge)return ge}},L=[0,0,0],B=(Q,re)=>(L[0]=Math.min(Q.min.y,re.min.y),L[1]=Math.max(Q.max.y,re.max.y),L[2]=t.a3-re.min.x>Q.max.x?re.min.x-t.a3:Q.max.x,L),U=(Q,re)=>(L[0]=Math.min(Q.min.x,re.min.x),L[1]=Math.max(Q.max.x,re.max.x),L[2]=t.a3-re.min.y>Q.max.y?re.min.y-t.a3:Q.max.y,L),W=[(Q,re)=>B(Q,re),(Q,re)=>B(re,Q),(Q,re)=>U(Q,re),(Q,re)=>U(re,Q)],Y=(Q,re,oe,ae,_e,ge,ne)=>{if(!x)return 0;let se=[[ge?oe:Q,ge?Q:oe,0],[ge?oe:re,ge?re:oe,0]],le=ne<0?t.a3+ne:ne,we=[ge?le:(Q+re)/2,ge?(Q+re)/2:le,0];return oe===0&&ne<0||oe!==0&&ne>0?x.getForTilePoints(_e,[we],!0,ae):se.push(we),x.getForTilePoints(u,se,!0,k),Math.max(se[0][2],se[1][2],we[2])/x.exaggeration()};for(let Q=0;Q<4;Q++){let re=_.borderFeatureIndices[Q];if(re.length===0)continue;let oe=t.bZ[Q](u),ae=A(oe);if(!(ae&&ae instanceof t.b_)||_.borderDoneWithNeighborZ[Q]===ae.canonical.z)continue;ae.centroidVertexArray.length===0&&ae.createCentroidsBuffer();let _e=x?x.findDEMTileFor(oe):null;if(!(_e&&_e.dem||S))continue;let ge=(Q<2?1:5)-Q,ne=ae.borderDoneWithNeighborZ[ge]!==_.canonical.z,se=ae.borderFeatureIndices[ge],le=0;if(_.canonical.z!==ae.canonical.z){for(let we of re)_.showCentroid(_.featuresOnBorder[we]);if(ne)for(let we of se)ae.showCentroid(ae.featuresOnBorder[we]);_.borderDoneWithNeighborZ[Q]=ae.canonical.z,ae.borderDoneWithNeighborZ[ge]=_.canonical.z}for(let we of re){let Re=_.featuresOnBorder[we],me=_.centroidData[Re.centroidDataIndex],Le=Re.borders[Q],Be;for(;le<se.length;){Be=ae.featuresOnBorder[se[le]];let Qe=Be.borders[ge];if(Qe[1]>Le[0]+3||Qe[0]>Le[0]-3)break;ae.showCentroid(Be),le++}if(Be&&le<se.length){let Qe=le,Je=0;for(;!(Be.borders[ge][0]>Le[1]-3)&&(Je++,++le!==se.length);)Be=ae.featuresOnBorder[se[le]];if(Be=ae.featuresOnBorder[se[Qe]],Je>1){let Ve=Be.borders[ge];Math.abs(Le[0]-Ve[0])<3&&Math.abs(Le[1]-Ve[1])<3&&(Je=1,le=Qe+1)}else if(Je===0){_.showCentroid(Re);continue}let Xe=ae.centroidData[Be.centroidDataIndex];S&&Je===1&&(((Z=me).flags|(X=Xe).flags)&t.b$?(Z.flags|=t.b$,X.flags|=t.b$):(Z.flags&=~t.b$,X.flags&=~t.b$));let Ee=Re.intersectsCount()>1||Be.intersectsCount()>1;if(Je>1)le=Qe,me.centroidXY=Xe.centroidXY=new t.P(0,0);else if(_e&&_e.dem&&!Ee){let Ve=W[Q](me,Xe),Ze=Q%2?t.a3-1:0,bt=Y(Ve[0],Math.min(t.a3-1,Ve[1]),Ze,_e,oe,Q<2,Ve[2]);me.centroidXY=Xe.centroidXY=D(bt)}else Ee?me.centroidXY=Xe.centroidXY=new t.P(0,0):(me.centroidXY=_.encodeBorderCentroid(Re),Xe.centroidXY=ae.encodeBorderCentroid(Be));_.writeCentroidToBuffer(me),ae.writeCentroidToBuffer(Xe)}else _.showCentroid(Re)}_.borderDoneWithNeighborZ[Q]=ae.canonical.z,ae.borderDoneWithNeighborZ[ge]=_.canonical.z}var Z,X;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(f)}let Al=[1,0,0],F_=[0,1,0],qu=[0,0,1];function hf(f,a,u){let _=u.transform,v=u.shadowRenderer;if(!v)return!0;let x=f.toUnwrapped(),S=_.tileSize*v._cascades[u.currentShadowCascade].scale,k=a.maxHeight;if(_.elevation){let Z=_.elevation.getMinMaxForTile(f);Z&&(k+=Z.max)}let D=[...v.shadowDirection];D[2]=-D[2];let A=v.computeSimplifiedTileShadowVolume(x,k,S,D);if(!A)return!1;let L=[Al,F_,qu,D,[D[0],0,D[2]],[0,D[1],D[2]]],B=_.projection.name==="globe",U=_.scaleZoom(S),W=t.aM.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,U,!B),Y=v.getCurrentCascadeFrustum();return W.intersectsPrecise(A.vertices,A.planes,L)===0||Y.intersectsPrecise(A.vertices,A.planes,L)===0}function gh(f){return[f[0]*t.c2,f[1]*t.c2,f[2]*t.c2,0]}function _h(f,a,u,_,v,x,S,k,D){let A=_.getSource(),L=u.globeSharedBuffers;if(!L)return;let B,U,W;if(a&&(B=_.getTile(a)),A instanceof t.bm?(U=A.texture,W=t.bh(0,0,u.transform)):B&&a&&(U=B.texture,W=t.bh(a.canonical.z,a.canonical.x,u.transform)),!U||!W)return;f||(W=t.ad.scale(t.ad.create(),W,[1,-1,1]));let Y=u.context,Z=Y.gl,X=v.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,Q=u.colorModeForDrapableLayerRenderPass(x),re=S.defines;re.push("GLOBE_POLES");let oe=new t.ae(Z.LEQUAL,t.ae.ReadWrite,u.depthRangeFor3D),ae=Float32Array.from(u.transform.expandedFarZProjMatrix),_e=Float32Array.from(t.bf(t.bg(new t.aO(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),Y.activeTexture.set(Z.TEXTURE0),U.bind(X,Z.CLAMP_TO_EDGE),Y.activeTexture.set(Z.TEXTURE1),U.bind(X,Z.CLAMP_TO_EDGE),U.useMipmap&&Y.extTextureFilterAnisotropic&&u.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);let[ge,ne,se,le]=a?L.getPoleBuffers(a.canonical.z,!1):L.getPoleBuffers(0,!0),we=v.paint.get("raster-elevation"),Re;f?(Re=ge,u.renderDefaultNorthPole=we!==0):(Re=ne,u.renderDefaultSouthPole=we!==0);let me=gh(S.mix),Le=((Qe,Je,Xe,Ee,Ve,Ze,bt,vt,It,xt,it,$e,Dt)=>hh(Qe,Je,Xe,new Float32Array(16),new Float32Array(9),[0,0],Ee,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],vt,2,xt,it,$e,1,0,Dt))(ae,_e,W,t.a1(u.transform.zoom),0,v,0,we,0,me,S.offset,S.range,x),Be=u.getOrCreateProgram("raster",{defines:re});u.uploadCommonUniforms(Y,Be,null),Be.draw(u,Z.TRIANGLES,oe,D,Q,k,Le,v.id,Re,se,le)}function Ni(f){let a=f._nearZ,u=f.projection.farthestPixelDistance(f),_=u-a,v=.2*f.height,x=a+v;return[a,u,(x-v-a)/_,(x-a)/_]}function Jv(f,a,u,_){if(f)return a instanceof Lc&&f instanceof t.c3?a.getTextureDescriptor(f,u,!0):{texture:f.texture,mix:gh(_.mix),offset:_.offset,buffer:0,tileSize:1}}function Ht(f,a,u){if(!f)return null;let _=a.getTextureDescriptor(f,u,!0);if(!_)return null;let{texture:v,mix:x,offset:S,tileSize:k,buffer:D,format:A}=_;if(!v||!A)return null;let L=!1;return A==="uint32"&&(L=!0,x[3]=0,x=E_(t.c4,x,[0,u.paint.get("raster-particle-max-speed")]),S=of(t.c4,S,[0,u.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[D/(k+2*D),k/(k+2*D)],tileSize:k,scalarData:L,scale:x,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[A]]}}function z_(f){let a=f._nearZ,u=f.projection.farthestPixelDistance(f),_=u-a,v=.2*f.height,x=a+v;return[a,u,(x-v-a)/_,(x-a)/_]}let $u=new t.C(1,0,0,1),uf=new t.C(0,1,0,1),Ua=new t.C(0,0,1,1),mf=new t.C(1,0,1,1),Uc=new t.C(0,1,1,1);function Et(f,a,u,_,v,x,S){let k=f.context,D=f.transform,A=k.gl,L=D.projection.name==="globe",B=L?["PROJECTION_GLOBE_VIEW"]:[],U=t.ad.clone(u.projMatrix);if(L&&t.a1(D.zoom)>0){let me=t.c5(u.canonical,D),Le=t.c6(me);U=t.ad.multiply(new Float32Array(16),D.globeMatrix,Le),t.ad.multiply(U,D.projMatrix,U)}let W=t.ad.create();W[12]+=2*v/(t.e.devicePixelRatio*D.width),W[13]+=2*x/(t.e.devicePixelRatio*D.height),t.ad.multiply(U,W,U);let Y=f.getOrCreateProgram("debug",{defines:B}),Z=a.getTileByID(u.key);f.terrain&&f.terrain.setupElevationDraw(Z,Y);let X=t.ae.disabled,Q=t.ag.disabled,re=f.colorModeForRenderPass(),oe="$debug";k.activeTexture.set(A.TEXTURE0),f.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),L?Z._makeGlobeTileDebugBuffers(f.context,D):Z._makeDebugTileBoundsBuffers(f.context,D.projection);let ae=Z._tileDebugBuffer||f.debugBuffer,_e=Z._tileDebugIndexBuffer||f.debugIndexBuffer,ge=Z._tileDebugSegments||f.debugSegments;if(Y.draw(f,A.LINE_STRIP,X,Q,re,t.af.disabled,ju(U,_),oe,ae,_e,ge,null,null,null,[Z._globeTileDebugBorderBuffer]),S){let me=Z.latestRawTileData,Le=Math.floor((me&&me.byteLength||0)/1024),Be=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Be+=` => ${u.overscaledZ}`),Be+=` ${Z.state}`,Be+=` ${Le}kb`,function(Qe,Je){Qe.initDebugOverlayCanvas();let Xe=Qe.debugOverlayCanvas,Ee=Qe.context.gl,Ve=Qe.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,Xe.width,Xe.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(Je,5,5),Ve.strokeText(Je,5,5),Qe.debugOverlayTexture.update(Xe),Qe.debugOverlayTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}(f,Be)}let ne=a.getTile(u).tileSize,se=512/Math.min(ne,512)*(u.overscaledZ/D.zoom)*.5,le=Z._tileDebugTextBuffer||f.debugBuffer,we=Z._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Re=Z._tileDebugTextSegments||f.debugSegments;Y.draw(f,A.TRIANGLES,X,Q,t.a.alphaBlended,t.af.disabled,ju(U,t.C.transparent,se),oe,le,we,Re,null,null,null,[Z._globeTileDebugTextBuffer])}function Vi(f,a,u,_){go(f,0,a+u/2,f.transform.width,u,_)}function ji(f,a,u,_){go(f,a-u/2,0,u,f.transform.height,_)}function go(f,a,u,_,v,x){let S=f.context,k=S.gl;k.enable(k.SCISSOR_TEST),k.scissor(a*t.e.devicePixelRatio,u*t.e.devicePixelRatio,_*t.e.devicePixelRatio,v*t.e.devicePixelRatio),S.clear({color:x}),k.disable(k.SCISSOR_TEST)}let Wc=t.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Fi}=Wc;function va(f,a,u,_){f.emplaceBack(a,u,_)}class Hc{constructor(a){this.vertexArray=new t.c8,this.indices=new t.bu,va(this.vertexArray,-1,-1,1),va(this.vertexArray,1,-1,1),va(this.vertexArray,-1,1,1),va(this.vertexArray,1,1,1),va(this.vertexArray,-1,-1,-1),va(this.vertexArray,1,-1,-1),va(this.vertexArray,-1,1,-1),va(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Fi),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=t.b.simpleSegment(0,0,36,12)}}function Wa(f,a,u,_,v,x){let S=f.context.gl,k=a.paint.get("sky-atmosphere-color"),D=a.paint.get("sky-atmosphere-halo-color"),A=a.paint.get("sky-atmosphere-sun-intensity"),L=((B,U,W,Y,Z)=>({u_matrix_3f:B,u_sun_direction:U,u_sun_intensity:W,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(t.bC.fromMat4(t.bC.create(),_),v,A,k,D);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+x,a.skyboxTexture,0),u.draw(f,S.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.frontCW,L,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}let Mo=t.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class lr{constructor(a){let u=new t.c9;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);let _=new t.bu;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(u,Mo.members),this.indexBuffer=a.createIndexBuffer(_),this.segments=t.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let ex=t.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class bh{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class pf{constructor(a){this.colorModeAlphaBlendedWriteRGB=new t.a([t.ca,t.cb,t.ca,t.cb],t.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new t.a([t.ca,t.cc,t.ca,t.cc],t.C.transparent,[!1,!1,!1,!0]),this.params=new bh,this.updateNeeded=!0,a.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),a.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(a){let u=a.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new lr(u);let _=this.params.sizeRange,v=this.params.intensityRange,x=function(L){let B=t.cf(30),U=[];for(let W=0;W<L;++W){let Y=2*Math.PI*B(),Z=Math.acos(1-2*B())-.5*Math.PI;U.push(t._.fromValues(Math.cos(Z)*Math.cos(Y),Math.cos(Z)*Math.sin(Y),Math.sin(Z)))}return U}(this.params.starsCount),S=t.cf(300),k=new t.cd,D=new t.bu,A=0;for(let L=0;L<x.length;++L){let B=t._.scale([],x[L],200),U=Math.max(0,1+.01*_*(1*S()-.5)),W=Math.max(0,1+.01*v*(1*S()-.5));k.emplaceBack(B[0],B[1],B[2],-1,-1,U,W),k.emplaceBack(B[0],B[1],B[2],1,-1,U,W),k.emplaceBack(B[0],B[1],B[2],1,1,U,W),k.emplaceBack(B[0],B[1],B[2],-1,1,U,W),D.emplaceBack(A+0,A+1,A+2),D.emplaceBack(A+0,A+2,A+3),A+=4}this.starsVx=u.createVertexBuffer(k,ex.members),this.starsIdx=u.createIndexBuffer(D),this.starsSegments=t.b.simpleSegment(0,0,k.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(a,u){let _=a.context,v=_.gl,x=a.transform,S=new t.ae(v.LEQUAL,t.ae.ReadOnly,[0,1]),k=t.a1(x.zoom),D=a.style.getLut(u.scope),A=u.properties.get("color").toRenderColor(D).toArray01(),L=u.properties.get("high-color").toRenderColor(D).toArray01(),B=u.properties.get("space-color").toRenderColor(D).toArray01PremultipliedAlpha(),U=5e-4,W=t.ce(u.properties.get("horizon-blend"),0,1,U,.25),Y=t.ba(a,_,x)&&W===U?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,Z=a.frameCounter/1e3%1,X=t._.length(x.globeCenterInViewSpace),Q=Math.sqrt(Math.pow(X,2)-Math.pow(Y,2)),re=Math.acos(Q/X),oe=ae=>{let _e=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ae&&_e.push("ALPHA_PASS");let ge=a.getOrCreateProgram("globeAtmosphere",{defines:_e}),ne=((le,we,Re,me,Le,Be,Qe,Je,Xe,Ee,Ve,Ze)=>({u_frustum_tl:le,u_frustum_tr:we,u_frustum_br:Re,u_frustum_bl:me,u_horizon:Le,u_transition:Be,u_fadeout_range:Qe,u_color:Je,u_high_color:Xe,u_space_color:Ee,u_temporal_offset:Ve,u_horizon_angle:Ze}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,k,W,A,L,B,Z,re);a.uploadCommonUniforms(_,ge);let se=this.atmosphereBuffer;se&&ge.draw(a,v.TRIANGLES,S,t.ag.disabled,ae?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,t.af.backCW,ne,ae?"atmosphere_glow_alpha":"atmosphere_glow",se.vertexBuffer,se.indexBuffer,se.segments)};oe(!1),oe(!0)}drawStars(a,u){let _=t.at(u.properties.get("star-intensity"),0,1);if(_===0)return;let v=a.context,x=v.gl,S=a.transform,k=a.getOrCreateProgram("stars"),D=t.av.identity([]);t.av.rotateX(D,D,-S._pitch),t.av.rotateZ(D,D,-S.angle),t.av.rotateX(D,D,t.ab(S._center.lat)),t.av.rotateY(D,D,-t.ab(S._center.lng));let A=t.ad.fromQuat(new Float32Array(16),D),L=t.ad.multiply([],S.starsProjMatrix,A),B=t.bC.fromMat4([],A),U=t.bC.invert([],B),W=[0,1,0];t._.transformMat3(W,W,U),t._.scale(W,W,this.params.sizeMultiplier);let Y=[1,0,0];t._.transformMat3(Y,Y,U),t._.scale(Y,Y,this.params.sizeMultiplier);let Z=(X=W,Q=Y,re=_,{u_matrix:Float32Array.from(L),u_up:X,u_right:Q,u_intensity_multiplier:re});var X,Q,re;a.uploadCommonUniforms(v,k),this.starsVx&&this.starsIdx&&k.draw(a,x.TRIANGLES,t.ae.disabled,t.ag.disabled,this.colorModeAlphaBlendedWriteRGB,t.af.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Gc(f,a){let u=[...f],_=a.cameraWorldSizeForFog/a.worldSize,v=t.ad.identity([]);return t.ad.scale(v,v,[_,_,1]),t.ad.multiply(u,v,u),t.ad.multiply(u,a.worldToFogMatrix,u),u}function yh(f,a,u,_,v){let x=u.material,S=_.context,{baseColorTexture:k,metallicRoughnessTexture:D}=x.pbrMetallicRoughness,{normalTexture:A,occlusionTexture:L,emissionTexture:B}=x;function U(W,Y,Z){if(W&&(f.push(Y),S.activeTexture.set(S.gl.TEXTURE0+Z),W.gfxTexture)){let{minFilter:X,magFilter:Q,wrapS:re,wrapT:oe}=W.sampler;W.gfxTexture.bindExtraParam(X,Q,re,oe)}}U(k,"HAS_TEXTURE_u_baseColorTexture",ro.BaseColor),U(D,"HAS_TEXTURE_u_metallicRoughnessTexture",ro.MetallicRoughness),U(A,"HAS_TEXTURE_u_normalTexture",ro.Normal),U(L,"HAS_TEXTURE_u_occlusionTexture",ro.Occlusion),U(B,"HAS_TEXTURE_u_emissionTexture",ro.Emission),v&&(v.texture||(v.texture=new t.ch(_.context,v.image,[v.image.height,v.image.height,v.image.height],S.gl.RGBA)),S.activeTexture.set(S.gl.TEXTURE0+ro.LUT),v.texture&&v.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),a.push(u.texcoordBuffer)),u.colorBuffer&&(f.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),a.push(u.colorBuffer)),u.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),a.push(u.normalBuffer)),u.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),a.push(u.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES")}function Pl(f,a,u,_,v,x){let S=u.paint.get("model-opacity"),k=a.context,D=new t.ae(a.context.gl.LEQUAL,t.ae.ReadWrite,a.depthRangeFor3D),A=a.transform,L=f.mesh,B=L.material,U=B.pbrMetallicRoughness,W=a.style.fog,Y;Y=a.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:t.ad.multiply([],_.zScaleMatrix,f.nodeModelMatrix),t.ad.multiply(Y,_.negCameraPosMatrix,Y);let Z=t.ad.invert([],Y);t.ad.transpose(Z,Z);let X=u.paint.get("model-emissive-strength").constantOr(0),Q=ph(new Float32Array(f.worldViewProjection),new Float32Array(Y),new Float32Array(Z),null,a,S,U.baseColorFactor.toRenderColor(null),B.emissiveFactor,U.metallicFactor,U.roughnessFactor,B,X,u),re={defines:[]},oe=[];yh(re.defines,oe,L,a,u.lut);let ae=a.shadowRenderer;ae&&(ae.useNormalOffset=!1);let _e=null;if(W){let se=Gc(f.nodeModelMatrix,a.transform);if(_e=new Float32Array(se),A.projection.name!=="globe"){let le=L.aabb.min,we=L.aabb.max,[Re,me]=W.getOpacityForBounds(se,le[0],le[1],we[0],we[1]);re.overrideFog=Re>=An||me>=An}}let ge=cs(a,u.paint.get("model-cutoff-fade-range"));ge.shouldRenderCutoff&&re.defines.push("RENDER_CUTOFF");let ne=a.getOrCreateProgram("model",re);a.uploadCommonUniforms(k,ne,null,_e,ge),a.renderPass!=="shadow"&&ae&&ae.setupShadowsFromMatrix(f.nodeModelMatrix,ne),ne.draw(a,k.gl.TRIANGLES,D,v,x,L.material.doubleSided?t.af.disabled:t.af.backCCW,Q,u.id,L.vertexBuffer,L.indexBuffer,L.segments,u.paint,a.transform.zoom,void 0,oe)}function eo(f,a,u,_,v,x,S){let k;k=f.projection.name==="globe"?t.ci(u,f):[...u],t.ad.multiply(k,k,a.matrix);let D=t.ad.multiply([],_,k);if(a.meshes)for(let A of a.meshes){if(A.material.alphaMode!=="BLEND"){S.push({mesh:A,depth:0,modelIndex:v,worldViewProjection:D,nodeModelMatrix:k});continue}let L=t._.transformMat4([],A.centroid,D);L[2]>0&&x.push({mesh:A,depth:L[2],modelIndex:v,worldViewProjection:D,nodeModelMatrix:k})}if(a.children)for(let A of a.children)eo(f,A,u,_,v,x,S)}function _o(f,a,u,_){let v=u.shadowRenderer;if(!v)return;let x=v.getShadowPassDepthMode(),S=v.getShadowPassColorMode(),k=v.calculateShadowPassMatrixFromMatrix(a),D=P_(k);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,x,t.ag.disabled,S,t.af.backCCW,D,_.id,f.vertexBuffer,f.indexBuffer,f.segments,_.paint,u.transform.zoom,void 0,void 0)}function B_(f,a,u){let _=a.updateZoomBasedPaintProperties(),v=function(x,S,k){let D,A,L,B=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&B>0){let U=x.terrain,W=U.findDEMTileFor(k);W&&W.dem?D=t.ck.create(U,k,W):B=0}if(B===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),B===S.validForExaggeration&&(B===0||D&&D._demTile&&D._demTile.tileID===S.validForDEMTile.id&&D._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(let U in S.instancesPerModel){let W=S.instancesPerModel[U];for(let Y=0;Y<W.instancedDataArray.length;++Y){let Z=(D?B*D.getElevationAt(0|W.instancedDataArray.float32[16*Y],0|W.instancedDataArray.float32[16*Y+1],!0,!0):0)+W.instancesEvaluatedElevation[Y];W.instancedDataArray.float32[16*Y+6]=Z,A=A?Math.min(S.terrainElevationMin,Z):Z,L=L?Math.max(S.terrainElevationMax,Z):Z}}return S.terrainElevationMin=A||0,S.terrainElevationMax=L||0,S.validForExaggeration=B,S.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,a,u);(_||v)&&(a.uploaded=!1,a.upload(f.context))}let bo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new t.b6([0,0,0],[t.a3,t.a3,0])};function yr(f,a){let u=1<<f.canonical.z,_=a.getFreeCameraOptions().position,v=a.elevation,x=f.canonical.x/u,S=(f.canonical.x+1)/u,k=f.canonical.y/u,D=(f.canonical.y+1)/u,A=a._centerAltitude;if(v){let W=v.getMinMaxForTile(f);W&&W.max>A&&(A=W.max)}let L=t.at(_.x,x,S)-_.x,B=t.at(_.y,k,D)-_.y,U=t.ax(A,a.center.lat)-_.z;return a._zoomFromMercatorZ(Math.sqrt(L*L+B*B+U*U))}function Xo(f,a,u,_,v,x,S){let k=f.context,D=f.renderPass==="shadow",A=f.shadowRenderer,L=D&&A?A.getShadowPassDepthMode():new t.ae(k.gl.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D),B=f.isTileAffectedByFog(x);if(u.meshes)for(let U of u.meshes){let W=["MODEL_POSITION_ON_GPU"],Y=[],Z,X,Q;_.instancedDataArray.length>20&&W.push("INSTANCED_ARRAYS");let re=cs(f,a.paint.get("model-cutoff-fade-range"));if(re.shouldRenderCutoff&&W.push("RENDER_CUTOFF"),D&&A)Z=f.getOrCreateProgram("modelDepth",{defines:W}),X=P_(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(u.matrix)),Q=A.getShadowPassColorMode();else{yh(W,Y,U,f,a.lut),Z=f.getOrCreateProgram("model",{defines:W,overrideFog:B});let ae=U.material,_e=ae.pbrMetallicRoughness,ge=a.paint.get("model-opacity"),ne=a.paint.get("model-emissive-strength").constantOr(0);X=ph(x.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),null,f,ge,_e.baseColorFactor.toRenderColor(null),ae.emissiveFactor,_e.metallicFactor,_e.roughnessFactor,ae,ne,a,v),A&&(S.shadowUniformsInitialized?Z.setShadowUniformValues(k,A.getShadowUniformValues()):(A.setupShadows(x.toUnwrapped(),Z,"model-tile",x.overscaledZ),S.shadowUniformsInitialized=!0)),Q=re.shouldRenderCutoff||ge<1||ae.alphaMode!=="OPAQUE"?t.a.alphaBlended:t.a.unblended}f.uploadCommonUniforms(k,Z,x.toUnwrapped(),null,re);let oe=U.material.doubleSided?t.af.disabled:t.af.backCCW;if(_.instancedDataArray.length>20)Y.push(_.instancedDataBuffer),Z.draw(f,k.gl.TRIANGLES,L,t.ag.disabled,Q,oe,X,a.id,U.vertexBuffer,U.indexBuffer,U.segments,a.paint,f.transform.zoom,void 0,Y,_.instancedDataArray.length);else{let ae=D?"u_instance":"u_normal_matrix";for(let _e=0;_e<_.instancedDataArray.length;++_e)X[ae]=new Float32Array(_.instancedDataArray.arrayBuffer,64*_e,16),Z.draw(f,k.gl.TRIANGLES,L,t.ag.disabled,Q,oe,X,a.id,U.vertexBuffer,U.indexBuffer,U.segments,a.paint,f.transform.zoom,void 0,Y)}}if(u.children)for(let U of u.children)Xo(f,a,U,_,v,x,S)}let us=[1,-1,1];function Er(f,a,u,_){if(!u.modelManager)return!0;let v=u.modelManager;if(!u.shadowRenderer)return!0;let x=u.shadowRenderer,S=a.aabb,k=!0,D=f.maxHeight;if(D===0){let L=0;for(let B in f.instancesPerModel){let U=v.getModel(B,_);U?L=Math.max(L,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):k=!1}D=f.maxScale*L*1.41+f.maxVerticalOffset,k&&(f.maxHeight=D)}S.max[2]=D,S.min[2]+=f.terrainElevationMin,S.max[2]+=f.terrainElevationMax,t._.transformMat4(S.min,S.min,a.tileMatrix),t._.transformMat4(S.max,S.max,a.tileMatrix);let A=S.intersects(x.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=A===2),A===0}function ff(f,a){let u=f.uniformValues.u_cutoff_params[0],_=f.uniformValues.u_cutoff_params[1],v=f.uniformValues.u_cutoff_params[2],x=f.uniformValues.u_cutoff_params[3];return _===u||x===v?1:t.at(((a-u)/(_-u)-v)/(x-v),0,1)}function xa(f,a,u,_){if(a.pitch<20)return 1;let v=a.getWorldToCameraMatrix(),x=t.ad.multiply([],v,f),S=[...u.min,1],k=t.aA.transformMat4([],S,x),D=k,A=k;S[1]=u.max[1],k=t.aA.transformMat4([],S,x),D=k[1]<D[1]?k:D,A=k[1]>A[1]?k:A,S[0]=u.max[0],k=t.aA.transformMat4([],S,x),D=k[1]<D[1]?k:D,A=k[1]>A[1]?k:A,S[1]=u.min[1],k=t.aA.transformMat4([],S,x),D=k[1]<D[1]?k:D,A=k[1]>A[1]?k:A;let L=t.at(_[0],0,1),B=100*a.pixelsPerMeter*t.at(_[1],0,1),U=t.at(_[2],0,1),W=t._.lerp([],D,A,L),Y=Math.tan(.5*a.fovX),Z=-W[2]*Y;if(B===0)return W[1]<-Math.abs(Z)?U:1;let X=(-Math.abs(Z)-W[1])/B,Q=(oe,ae,_e)=>(1-_e)*oe+_e*ae,re=t.at(Q(1,U,X),U,1);return Q(1,re,t.at((a.pitch-20)/20,0,1))}class vh{}class xh{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(a,u,_){{let B=this._storage.get(u.id);if(B)return B.lastUsedFrameIdx=a,B.buf}let v=_.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),S=new ArrayBuffer(x),k=new Int16Array(S);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));let D=new t.cm;for(let B=0;B<x/2;B+=3){let U=k[B],W=k[B+1],Y=k[B+2];D.emplaceBack(U,W),D.emplaceBack(W,Y),D.emplaceBack(Y,U)}let A=_.bindVertexArrayOES.current,L=new vh;return L.buf=new t.I(_,D),L.lastUsedFrameIdx=a,this._storage.set(u.id,L),_.bindVertexArrayOES.set(A),L.buf}update(a){for(let[u,_]of this._storage)a-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(u))}destroy(){for(let[a,u]of this._storage)u.buf.destroy(),this._storage.delete(a)}}let Ol=t.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class tx{constructor(a){let u=new t.cn,_=new t.bu;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1),_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),this.segments=t.b.simpleSegment(0,0,u.length,_.length),this.vx=a.createVertexBuffer(u,Ol.members),this.idx=a.createIndexBuffer(_)}destroy(){this.vx.destroy(),this.idx.destroy()}}let wa={symbol:function(f,a,u,_,v){if(f.renderPass!=="translucent")return;let x=t.ag.disabled,S=f.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(A,L,B,U,W,Y,Z){let X=L.transform,Q=W==="map",re=Y==="map";for(let oe of A){let ae=U.getTile(oe),_e=ae.getBucket(B);if(!_e||!_e.text||!_e.text.segments.get().length)continue;let ge=t.aD(_e.textSizeData,X.zoom),ne=Nc(oe,_e.getProjection(),X),se=X.calculatePixelsToTileUnitsMatrix(ae),le=Ml(ne,ae.tileID.canonical,re,Q,X,_e.getProjection(),se),we=_e.hasIconTextFit()&&_e.hasIconData();if(ge){let Re=Math.pow(2,X.zoom-ae.tileID.overscaledZ);L_(_e,Q,re,Z,t.bO,X,le,oe,Re,ge,we)}}}(_,f,u,a,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v);let k=u.paint.get("icon-opacity").constantOr(1)!==0,D=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||D)?cf(f,a,u,_,x,S):(k&&cf(f,a,u,_,x,S,{onlyIcons:!0}),D&&cf(f,a,u,_,x,S,{onlyText:!0}),function(A,L,B,U){if(!A.symbolParams.useOcclusionQueries)return;let W=A.context.gl,Y=A.transform,Z=B.paint,X=Z.get("icon-occlusion-opacity").constantOr(0),Q=Z.get("text-occlusion-opacity").constantOr(0);if(!B.hasInitialOcclusionOpacityProperties||X===1&&Q===1)return;let re=Y.projection.name==="globe";for(let oe of U){let ae=L.getTile(oe),_e=ae.getBucket(B);if(!_e||_e.projection.name==="mercator"&&re||_e.fullyClipped)continue;if(_e.projection.name==="globe"){t.w(`Occlusion not supported for globe mode. Layer: ${B.type}`);continue}let ge=Nc(oe,_e.getProjection(),Y),ne=t.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,A.symbolParams.depthOffset,1),se=t.ad.multiply([],ne,ge),le=A.symbolParams.visualizeOcclusions!=="none"?1:A.symbolParams.occlusionQueryFrameWindow;for(let we=0;we<_e.symbolInstances.length;we++){let Re=_e.symbolInstances.get(we),me=A.style.placement.opacities[Re.crossTileID];if(me&&me.isHidden()||(A.frameCounter+we)%le!=0)continue;let Le=Re.tileAnchorX,Be=Re.tileAnchorY,Qe=Re.zOffset,Je;if(A.symbolParams.visualizeOcclusions==="none"){let bt=_e.queries.get(we);if(bt){if(!bt.isFree()){if(!bt.isResultAvailable())continue;let vt=bt.consumeResult();Re.occlusionState=vt===0?0:1;continue}Je=bt}else Je=new xc(A.context),_e.queries.set(we,Je)}let Xe=A.getOrCreateProgram("occlusion"),Ee=A.symbolParams.occluderSize,Ve=O_(se,[Le,Be,Qe],[Y.width,Y.height],[Ee,Ee],A.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);A.terrain&&A.terrain.setupElevationDraw(ae,Xe,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),A.symbolParams.visualizeOcclusions==="none"&&Je&&Je.begin();let Ze=new t.ae(A.symbolParams.visualizeOcclusions==="zPass"?A.context.gl.ALWAYS:A.context.gl.LEQUAL,t.ae.ReadOnly,A.depthRangeFor3D);Xe.draw(A,W.TRIANGLES,Ze,t.ag.disabled,A.symbolParams.visualizeOcclusions!=="none"?t.a.alphaBlendedNonPremultiplied:t.a.disabled,t.af.disabled,Ve,"occlusion",A.occlusionBuffers.vx,A.occlusionBuffers.idx,A.occlusionBuffers.segments),A.symbolParams.visualizeOcclusions==="none"&&Je&&Je.end()}}}(f,a,u,_)),a.map.showCollisionBoxes&&(fh(f,a,u,_,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),fh(f,a,u,_,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(f,a,u,_){if(f.renderPass!=="translucent")return;let v=u.paint.get("circle-opacity"),x=u.paint.get("circle-stroke-width"),S=u.paint.get("circle-stroke-opacity"),k=u.layout.get("circle-sort-key").constantOr(1)!==void 0,D=u.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||S.constantOr(1)===0))return;let A=f.context,L=A.gl,B=f.transform,U=f.depthModeForSublayer(0,t.ae.ReadOnly),W=t.ag.disabled,Y=f.colorModeForDrapableLayerRenderPass(D),Z=B.projection.name==="globe",X=[t.aj(B.center.lng),t.ak(B.center.lat)],Q=[];for(let oe=0;oe<_.length;oe++){let ae=_[oe],_e=a.getTile(ae),ge=_e.getBucket(u);if(!ge||ge.projection.name!==B.projection.name)continue;let ne=ge.programConfigurations.get(u.id),se=t.bR(u),le=f.isTileAffectedByFog(ae);Z&&se.push("PROJECTION_GLOBE_VIEW");let we=f.getOrCreateProgram("circle",{config:ne,defines:se,overrideFog:le}),Re=ge.layoutVertexBuffer,me=ge.globeExtVertexBuffer,Le=ge.indexBuffer,Be=B.projection.createInversionMatrix(B,ae.canonical),Qe={programConfiguration:ne,program:we,layoutVertexBuffer:Re,globeExtVertexBuffer:me,indexBuffer:Le,uniformValues:t.bS(f,ae,_e,Be,X,u),tile:_e};if(k){let Je=ge.segments.get();for(let Xe of Je)Q.push({segments:new t.b([Xe]),sortKey:Xe.sortKey,state:Qe})}else Q.push({segments:ge.segments,sortKey:0,state:Qe})}k&&Q.sort((oe,ae)=>oe.sortKey-ae.sortKey);let re={useDepthForOcclusion:B.depthOcclusionForSymbolsAndCircles};for(let oe of Q){let{programConfiguration:ae,program:_e,layoutVertexBuffer:ge,globeExtVertexBuffer:ne,indexBuffer:se,uniformValues:le,tile:we}=oe.state,Re=oe.segments;f.terrain&&f.terrain.setupElevationDraw(we,_e,re),f.uploadCommonUniforms(A,_e,we.tileID.toUnwrapped()),_e.draw(f,L.TRIANGLES,U,W,Y,t.af.disabled,le,u.id,ge,se,Re,u.paint,B.zoom,ae,[ne])}},heatmap:function(f,a,u,_){if(u.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){let v=f.context,x=v.gl,S=t.ag.disabled,k=new t.a([x.ONE,x.ONE,x.ONE,x.ONE],t.C.transparent,[!0,!0,!0,!0]);(function(W,Y,Z,X){let Q=W.gl,re=Y.width*X,oe=Y.height*X;W.activeTexture.set(Q.TEXTURE1),W.viewport.set([0,0,re,oe]);let ae=Z.heatmapFbo;if(!ae||ae&&(ae.width!==re||ae.height!==oe)){ae&&ae.destroy();let _e=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,_e),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),ae=Z.heatmapFbo=W.createFramebuffer(re,oe,!0,null),function(ge,ne,se,le,we,Re){let me=ge.gl;me.texImage2D(me.TEXTURE_2D,0,ge.extRenderToTextureHalfFloat?me.RGBA16F:me.RGBA,we,Re,0,me.RGBA,ge.extRenderToTextureHalfFloat?me.HALF_FLOAT:me.UNSIGNED_BYTE,null),le.colorAttachment.set(se)}(W,0,_e,ae,re,oe)}else Q.bindTexture(Q.TEXTURE_2D,ae.colorAttachment.get()),W.bindFramebuffer.set(ae.framebuffer)})(v,f,u,f.transform.projection.name==="globe"?.5:.25),v.clear({color:t.C.transparent});let D=f.transform,A=D.projection.name==="globe",L=A?["PROJECTION_GLOBE_VIEW"]:[],B=A?t.af.frontCCW:t.af.disabled,U=[t.aj(D.center.lng),t.ak(D.center.lat)];for(let W=0;W<_.length;W++){let Y=_[W];if(a.hasRenderableParent(Y))continue;let Z=a.getTile(Y),X=Z.getBucket(u);if(!X||X.projection.name!==D.projection.name)continue;let Q=f.isTileAffectedByFog(Y),re=X.programConfigurations.get(u.id),oe=f.getOrCreateProgram("heatmap",{config:re,defines:L,overrideFog:Q}),{zoom:ae}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Z,oe),f.uploadCommonUniforms(v,oe,Y.toUnwrapped());let _e=D.projection.createInversionMatrix(D,Y.canonical);oe.draw(f,x.TRIANGLES,t.ae.disabled,S,k,B,El(f,Y,Z,_e,U,ae,u.paint.get("heatmap-intensity")),u.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,u.paint,f.transform.zoom,re,A?[X.globeExtVertexBuffer]:null)}v.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,x){let S=v.context,k=S.gl,D=x.heatmapFbo;if(!D)return;S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,D.colorAttachment.get()),S.activeTexture.set(k.TEXTURE1);let A=x.colorRampTexture;A||(A=x.colorRampTexture=new t.T(S,x.colorRamp,k.RGBA)),A.bind(k.LINEAR,k.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,k.TRIANGLES,t.ae.disabled,t.ag.disabled,v.colorModeForRenderPass(),t.af.disabled,((L,B,U,W)=>({u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(f,u))},line:function(f,a,u,_){if(f.renderPass!=="translucent")return;let v=u.paint.get("line-opacity"),x=u.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;let S=u.paint.get("line-emissive-strength"),k=u.paint.get("line-occlusion-opacity"),D=f.context,A=D.gl,L=u.layout.get("line-z-offset"),B=!L.isConstant()||!!L.constantOr(0),U=B?new t.ae(f.depthOcclusion?A.GREATER:A.LEQUAL,t.ae.ReadOnly,f.depthRangeFor3D):f.depthModeForSublayer(0,t.ae.ReadOnly),W=f.colorModeForDrapableLayerRenderPass(S),Y=f.terrain&&f.terrain.renderingToTexture,Z=Y?1:t.e.devicePixelRatio,X=u.paint.get("line-dasharray"),Q=X.constantOr(1),re=u.layout.get("line-cap"),oe=X.constantOr(null),ae=re.constantOr(null),_e=u.paint.get("line-pattern"),ge=_e.constantOr(1),ne=_e.constantOr(null),se=u.paint.get("line-opacity").constantOr(1),le=!ge&&se!==1||f.depthOcclusion&&k>0&&k<1,we=u.paint.get("line-gradient"),Re=ge?"linePattern":"line",me=t.bT(u),Le;if(Y&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(le=!1),k!==0&&f.depthOcclusion){let Qe=u.paint._values["line-opacity"];Qe&&Qe.value&&Qe.value.kind==="constant"?Le=Qe.value:t.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}if(B&&(f.forceTerrainMode=!0),!B&&k!==0&&f.terrain&&!Y)return void t.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let Be=le&&B?f.stencilModeFor3D():t.ag.disabled;for(let Qe of _){let Je=a.getTile(Qe);if(ge&&!Je.patternsLoaded())continue;let Xe=Je.getBucket(u);if(!Xe)continue;f.prepareDrawTile();let Ee=Xe.programConfigurations.get(u.id),Ve=f.isTileAffectedByFog(Qe),Ze=f.getOrCreateProgram(Re,{config:Ee,defines:B?[...me,"ELEVATED"]:me,overrideFog:Ve});if(ne&&Je.imageAtlas){let $e=Je.imageAtlas.patternPositions[ne.toString()];$e&&Ee.setConstantPatternPositions($e)}if(!ge&&oe&&ae&&Je.lineAtlas){let $e=Je.lineAtlas.getDash(oe,ae);$e&&Ee.setConstantPatternPositions($e)}let[bt,vt]=u.paint.get("line-trim-offset");(ae==="round"||ae==="square")&&bt!==vt&&(bt===0&&(bt-=1),vt===1&&(vt+=1));let It=Y?Qe.projMatrix:null,xt=ge?t.bU(f,Je,u,It,Z,[bt,vt]):t.bV(f,Je,u,It,Xe.lineClipsArray.length,Z,[bt,vt]);if(we){let $e=Xe.gradients[u.id],Dt=$e.texture;if(u.gradientVersion!==$e.version){let si=256;if(u.stepInterpolant){let ti=a.getSource().maxzoom,xi=Qe.canonical.z===ti?Math.ceil(1<<f.transform.maxZoom-Qe.canonical.z):1;si=t.at(t.bW(Xe.maxLineLength/t.a3*1024*xi),256,D.maxTextureSize)}$e.gradient=t.bX({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:si,image:$e.gradient||void 0,clips:Xe.lineClipsArray}),$e.texture?$e.texture.update($e.gradient):$e.texture=new t.T(D,$e.gradient,A.RGBA),$e.version=u.gradientVersion,Dt=$e.texture}D.activeTexture.set(A.TEXTURE1),Dt.bind(u.stepInterpolant?A.NEAREST:A.LINEAR,A.CLAMP_TO_EDGE)}Q&&(D.activeTexture.set(A.TEXTURE0),Je.lineAtlasTexture&&Je.lineAtlasTexture.bind(A.LINEAR,A.REPEAT),Ee.updatePaintBuffers()),ge&&(D.activeTexture.set(A.TEXTURE0),Je.imageAtlasTexture&&Je.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Ee.updatePaintBuffers()),B&&f.terrain.setupElevationDraw(Je,Ze),f.uploadCommonUniforms(D,Ze,Qe.toUnwrapped());let it=$e=>{Le!=null&&(Le.value=se*k),Ze.draw(f,A.TRIANGLES,U,$e,W,t.af.disabled,xt,u.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,u.paint,f.transform.zoom,Ee,[Xe.layoutVertexBuffer2,Xe.patternVertexBuffer,Xe.zOffsetVertexBuffer]),Le!=null&&(Le.value=se)};if(le&&!B){let $e=f.stencilModeForClipping(Qe).ref;$e===0&&Y&&D.clear({stencil:0});let Dt={func:A.EQUAL,mask:255};xt.u_alpha_discard_threshold=.8,it(new t.ag(Dt,$e,255,A.KEEP,A.KEEP,A.INVERT)),xt.u_alpha_discard_threshold=0,it(new t.ag(Dt,$e,255,A.KEEP,A.KEEP,A.KEEP))}else le&&B&&(xt.u_alpha_discard_threshold=.001),it(B?Be:f.stencilModeForClipping(Qe))}le&&(f.resetStencilClippingMasks(),Y&&D.clear({stencil:0})),k===0||f.depthOcclusion||Y||f.layersWithOcclusionOpacity.push(f.currentLayer),B&&(f.forceTerrainMode=!1)},fill:function(f,a,u,_){let v=u.paint.get("fill-color"),x=u.paint.get("fill-opacity");if(x.constantOr(1)===0)return;let S=u.paint.get("fill-emissive-strength"),k=f.colorModeForDrapableLayerRenderPass(S),D=u.paint.get("fill-pattern"),A=f.opaquePassEnabledForLayer()&&!D.constantOr(1)&&v.constantOr(t.C.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===A){let L=f.depthModeForSublayer(1,f.renderPass==="opaque"?t.ae.ReadWrite:t.ae.ReadOnly);df(f,a,u,_,L,k,!1)}if(f.renderPass==="translucent"&&u.paint.get("fill-antialias")){let L=f.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,t.ae.ReadOnly);df(f,a,u,_,L,k,!0)}},"fill-extrusion":function(f,a,u,_){let v=u.paint.get("fill-extrusion-opacity"),x=f.context,S=x.gl,k=f.terrain,D=k&&k.renderingToTexture;if(v===0)return;let A=f.conflationActive&&f.style.isLayerClipped(u,a.getSource()),L=f.style.order.indexOf(u.fqid);if(A&&function(B,U,W,Y,Z){for(let X of Y){let Q=U.getTile(X).getBucket(W);Q&&(Q.updateReplacement(X,B.replacementSource,Z),Q.uploadCentroid(B.context))}}(f,a,u,_,L),k||A)for(let B of _){let U=a.getTile(B).getBucket(u);U&&Gu(f.context,a,B,U,u,k,A)}if(f.renderPass==="shadow"&&f.shadowRenderer){let B=f.shadowRenderer;if(k&&v<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof t.Z)return;let U=B.getShadowPassDepthMode(),W=B.getShadowPassColorMode();jc(f,a,u,_,U,t.ag.disabled,W,A)}else if(f.renderPass==="translucent"){let B=!u.paint.get("fill-extrusion-pattern").constantOr(1),U=u.paint.get("fill-extrusion-color").constantOr(t.C.white);if(!D&&U.a!==0){let W=new t.ae(f.context.gl.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D);v===1&&B?jc(f,a,u,_,W,t.ag.disabled,t.a.unblended,A):(jc(f,a,u,_,W,t.ag.disabled,t.a.disabled,A),jc(f,a,u,_,W,f.stencilModeFor3D(),f.colorModeForRenderPass(),A),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&B&&(!k&&f.transform.projection.name!=="globe"||D)){let W=u.paint.get("fill-extrusion-opacity"),Y=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=u.paint.get("fill-extrusion-flood-light-intensity"),Q=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(u.lut).toArray01().slice(0,3),re=Y>0&&Z>0,oe=X>0,ae=(ge,ne,se)=>(1-se)*ge+se*ne,_e=ge=>{let ne=f.depthModeForSublayer(1,t.ae.ReadOnly,S.LEQUAL,!0),se=u.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),le=ae(.1,3,se),we=f._showOverdrawInspector;if(!we){let Re=new t.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),me=new t.a([S.ONE,S.ONE,S.ONE,S.ONE],t.C.transparent,[!1,!1,!1,!0],S.MIN);fo(f,a,u,_,ne,Re,me,t.af.disabled,ge,"sdf",W,Y,Z,X,Q,le,A,!1)}{let Re=we?t.ag.disabled:new t.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),me=we?f.colorModeForRenderPass():new t.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],t.C.transparent,[!0,!0,!0,!0]);fo(f,a,u,_,ne,Re,me,t.af.disabled,ge,"color",W,Y,Z,X,Q,le,A,!1)}};if(D){let ge=(ne,se,le)=>{let we=f.depthModeForSublayer(1,t.ae.ReadOnly,S.LEQUAL,!1),Re=u.paint.get(ne?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),me=ae(.1,3,Re);{let Le=new t.a([S.ONE,S.ONE,S.ONE,S.ONE],t.C.transparent,[!1,!1,!1,!0]);fo(f,a,u,_,we,t.ag.disabled,Le,t.af.disabled,ne,"clear",W,Y,Z,X,Q,me,A,se)}{let Le=new t.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Be=new t.a([S.ONE,S.ONE,S.ONE,S.ONE],t.C.transparent,[!1,!1,!1,!0],S.MIN);fo(f,a,u,_,we,Le,Be,t.af.disabled,ne,"sdf",W,Y,Z,X,Q,me,A,se)}{let Le=ne?S.ZERO:S.ONE_MINUS_DST_ALPHA,Be=new t.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Qe=new t.a([Le,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],t.C.transparent,[!0,!0,!0,!0]);fo(f,a,u,_,we,Be,Qe,t.af.disabled,ne,"color",W,Y,Z,X,Q,me,A,se)}{let Le=new t.a([S.ONE,S.ONE,S.ONE,ne?S.ZERO:S.ONE],t.C.transparent,[!1,!1,!1,!0],ne?S.FUNC_ADD:S.MAX);fo(f,a,u,_,we,t.ag.disabled,Le,t.af.disabled,ne,"clear",W,Y,Z,X,Q,me,A,se,le)}};if(re||oe){let ne;if(f.prepareDrawTile(),k){let se=k.drapeBufferSize[0],le=k.drapeBufferSize[1];ne=k.framebufferCopyTexture,ne&&(!ne||ne.size[0]===se&&ne.size[1]===le)||(ne&&ne.destroy(),ne=k.framebufferCopyTexture=new t.T(x,new t.i({width:se,height:le}),S.RGBA)),ne.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,se,le,0)}re&&ge(!0,!1,ne),oe&&ge(!1,!0,ne)}}else re&&_e(!0),oe&&_e(!1)}}},hillshade:function(f,a,u,_){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;let v=f.context,x=f.terrain&&f.terrain.renderingToTexture,[S,k]=f.renderPass!=="translucent"||x?[{},_]:f.stencilConfigForOverlap(_);for(let D of k){let A=a.getTile(D);if(A.needsHillshadePrepare&&f.renderPass==="offscreen")Na(f,A,u);else if(f.renderPass==="translucent"){let L=f.depthModeForSublayer(0,t.ae.ReadOnly),B=u.paint.get("hillshade-emissive-strength"),U=f.colorModeForDrapableLayerRenderPass(B),W=x&&f.terrain?f.terrain.stencilModeForRTTOverlap(D):S[D.overscaledZ];$v(f,D,A,u,L,W,U)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,a,u,_,v,x){if(f.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;let S=f.transform.projection.name==="globe",k=u.paint.get("raster-elevation")!==0,D=k&&S;if(f.renderElevatedRasterBackface&&!D)return;let A=f.context,L=A.gl,B=a.getSource(),U=function(ge,ne,se,le){let we=ne.paint.get("raster-color"),Re=ge.type==="raster-array",me=[],Le=ne.paint.get("raster-resampling"),Be=ne.paint.get("raster-color-mix"),Qe=ne.paint.get("raster-color-range"),Je=[Be[0],Be[1],Be[2],0],Xe=Be[3],Ee=Le==="nearest"?le.NEAREST:le.LINEAR;if(Re&&(me.push("RASTER_ARRAY"),we||me.push("RASTER_COLOR"),Le==="linear"&&me.push("RASTER_ARRAY_LINEAR"),Ee=le.NEAREST,!Qe&&ge.rasterLayers)){let Ve=ge.rasterLayers.find(({id:Ze})=>Ze===ne.sourceLayer);Ve&&Ve.fields&&Ve.fields.range&&(Qe=Ve.fields.range)}if(Qe=Qe||[0,1],we){me.push("RASTER_COLOR"),se.activeTexture.set(le.TEXTURE2),ne.updateColorRamp(Qe);let Ve=ne.colorRampTexture;Ve||(Ve=ne.colorRampTexture=new t.T(se,ne.colorRamp,le.RGBA)),Ve.bind(le.LINEAR,le.CLAMP_TO_EDGE)}return{mix:Je,range:Qe,offset:Xe,defines:me,resampling:Ee}}(B,u,A,L);if(B instanceof t.bm&&!_.length&&!S)return;let W=u.paint.get("raster-emissive-strength"),Y=f.colorModeForDrapableLayerRenderPass(W),Z=f.terrain&&f.terrain.renderingToTexture,X=!f.options.moving,Q=u.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(B instanceof t.bm&&!_.length&&(B.onNorthPole||B.onSouthPole)){let ge=k?f.stencilModeFor3D():t.ag.disabled;return void _h(!!B.onNorthPole,null,f,a,u,W,U,t.af.disabled,ge)}if(!_.length)return;let[re,oe]=B instanceof t.bm||Z?[{},_]:f.stencilConfigForOverlap(_),ae=oe[oe.length-1].overscaledZ;D&&U.defines.push("PROJECTION_GLOBE_VIEW"),k&&U.defines.push("RENDER_CUTOFF");let _e=(ge,ne,se)=>{for(let le of ge){let we=le.toUnwrapped(),Re=a.getTile(le);if(Z&&(!Re||!Re.hasData()))continue;A.activeTexture.set(L.TEXTURE0);let me=Jv(Re,B,u,U);if(!me||!me.texture)continue;let{texture:Le,mix:Be,offset:Qe,tileSize:Je,buffer:Xe}=me,Ee,Ve;Z?(Ee=t.ae.disabled,Ve=le.projMatrix):k?(Ee=new t.ae(L.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D),Ve=S?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(we,X)):(Ee=f.depthModeForSublayer(le.overscaledZ-ae,u.paint.get("raster-opacity")===1?t.ae.ReadWrite:t.ae.ReadOnly,L.LESS),Ve=f.transform.calculateProjMatrix(we,X));let Ze=f.terrain&&Z?f.terrain.stencilModeForRTTOverlap(le):re[le.overscaledZ],bt=x?0:u.paint.get("raster-fade-duration");Re.registerFadeDuration(bt);let vt=a.findLoadedParent(le,0),It=Lu(Re,vt,a,f.transform,bt),xt,it;f.terrain&&f.terrain.prepareDrawTile(),A.activeTexture.set(L.TEXTURE0),Le.bind(Q,L.CLAMP_TO_EDGE),A.activeTexture.set(L.TEXTURE1),vt?(vt.texture&&vt.texture.bind(Q,L.CLAMP_TO_EDGE),xt=Math.pow(2,vt.tileID.overscaledZ-Re.tileID.overscaledZ),it=[Re.tileID.canonical.x*xt%1,Re.tileID.canonical.y*xt%1]):Le.bind(Q,L.CLAMP_TO_EDGE),Le.useMipmap&&A.extTextureFilterAnisotropic&&f.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);let $e=f.transform,Dt,si=k?Ni($e):[0,0,0,0],ti,xi,Pi,tn,Kt,qi=0;if(D&&B instanceof t.bm&&B.coordinates.length>3)ti=Float32Array.from(t.bf(t.bg(new t.aO(0,0,0)))),xi=Float32Array.from($e.globeMatrix),Pi=Float32Array.from(t.bb($e)),tn=[t.aj($e.center.lng),t.ak($e.center.lat)],Dt=B.elevatedGlobePerspectiveTransform,Kt=B.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){let ri=t.bc(le.canonical);qi=t.bd(ri.getCenter().lat),ti=Float32Array.from(t.bf(t.bg(le.canonical))),xi=Float32Array.from($e.globeMatrix),Pi=Float32Array.from(t.bb($e)),tn=[t.aj($e.center.lng),t.ak($e.center.lat)],Dt=[0,0],Kt=Float32Array.from(t.be(le.canonical,ri,qi,$e.worldSize/$e._pixelsPerMercatorPixel))}else Dt=B instanceof t.bm?B.perspectiveTransform:[0,0],ti=new Float32Array(16),xi=new Float32Array(9),Pi=new Float32Array(16),tn=[0,0],Kt=new Float32Array(9);let pn=hh(Ve,ti,xi,Pi,Kt,it||[0,0],t.a1(f.transform.zoom),tn,si,xt||1,It,u,Dt,k?u.paint.get("raster-elevation"):0,2,Be,Qe,U.range,Je,Xe,W),Ji=f.isTileAffectedByFog(le),Si=f.getOrCreateProgram("raster",{defines:U.defines,overrideFog:Ji});if(f.uploadCommonUniforms(A,Si,we),B instanceof t.bm){let ri=B.elevatedGlobeVertexBuffer,vn=B.elevatedGlobeIndexBuffer;if(Z||!S)B.boundsBuffer&&B.boundsSegments&&Si.draw(f,L.TRIANGLES,Ee,t.ag.disabled,Y,t.af.disabled,pn,u.id,B.boundsBuffer,f.quadTriangleIndexBuffer,B.boundsSegments);else if(ri&&vn){let kn=$e.zoom<=t.b1?B.elevatedGlobeSegments:B.getSegmentsForLongitude($e.center.lng);kn&&Si.draw(f,L.TRIANGLES,Ee,t.ag.disabled,Y,ne,pn,u.id,ri,vn,kn)}}else if(D){Ee=new t.ae(L.LEQUAL,t.ae.ReadOnly,f.depthRangeFor3D);let ri=f.globeSharedBuffers;if(ri){let[vn,kn,on]=ri.getGridBuffers(qi,!1);Si.draw(f,L.TRIANGLES,Ee,se||Ze,f.colorModeForRenderPass(),ne,pn,u.id,vn,kn,on)}}else{let{tileBoundsBuffer:ri,tileBoundsIndexBuffer:vn,tileBoundsSegments:kn}=f.getTileBoundsBuffers(Re);Si.draw(f,L.TRIANGLES,Ee,Ze,Y,t.af.disabled,pn,u.id,ri,vn,kn)}}if(!(B instanceof t.bm)&&D)for(let le of ge){let we=le.canonical.y===(1<<le.canonical.z)-1;le.canonical.y===0&&_h(!0,le,f,a,u,W,U,ne,se||t.ag.disabled),we&&_h(!1,le,f,a,u,W,U,ne===t.af.frontCW?t.af.backCW:t.af.frontCW,se||t.ag.disabled)}};D?_e(oe,f.renderElevatedRasterBackface?t.af.backCW:t.af.frontCW,f.stencilModeFor3D()):_e(oe,t.af.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,a,u,_,v,x){f.renderPass==="offscreen"&&function(S,k,D,A){if(!A.length)return;let L=S.context,B=L.gl,U=k.getSource();if(!(U instanceof Lc))return;let W=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count"))),Y=D.particlePositionRGBAImage;if(!Y||Y.width!==W){let oe=function(ae){let _e=ae*ae,ge=new Uint8Array(4*_e),ne=function(le){return le|=0,le=Math.imul(2747636419^le,2654435769),le=Math.imul(le^le>>>16,2654435769),((le=Math.imul(le^le>>>16,2654435769))>>>0)/4294967296},se=1/1.3;for(let le=0;le<_e;le++){let we=se*(ne(2*le+0)+Gs),Re=se*(ne(2*le+1)+Gs),me=255*we%1,Le=255*Re%1,Be=me,Qe=Re-Le/255,Je=Le;ge[4*le+0]=255*(we-me/255),ge[4*le+1]=255*Be,ge[4*le+2]=255*Qe,ge[4*le+3]=255*Je}return ge}(W);Y=D.particlePositionRGBAImage=new t.i({width:W,height:W},oe)}let Z=D.particleFramebuffer;Z?Z.width!==W&&(Z.destroy(),Z=D.particleFramebuffer=L.createFramebuffer(W,W,!0,null)):Z=D.particleFramebuffer=L.createFramebuffer(W,W,!0,null);let X=[];for(let oe of A){let ae=k.getTile(oe);if(!(ae instanceof t.c3))continue;let _e=Ht(ae,U,D);if(!_e)continue;let ge=[ae.tileSize,ae.tileSize],ne=D.tileFramebuffer;ne||(ne=D.tileFramebuffer=L.createFramebuffer(ge[0],ge[1],!0,null));let se=ae.rasterParticleState;se||(se=ae.rasterParticleState=new qo(L,oe,ge,Y));let le=se.update(D.lastInvalidatedAt);se.particleTextureDimension!==W&&se.updateParticleTexture(oe,Y);let we=se.targetColorTexture;se.targetColorTexture=se.backgroundColorTexture,se.backgroundColorTexture=we;let Re=se.particleTexture0;se.particleTexture0=se.particleTexture1,se.particleTexture1=Re,X.push([oe,_e,se,le])}if(X.length===0)return;let Q=t.e.now(),re=D.previousDrawTimestamp?.001*(Q-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=Q,D.hasColorMap()){L.activeTexture.set(B.TEXTURE0+2);let oe=D.colorRampTexture;oe||(oe=D.colorRampTexture=new t.T(L,D.colorRamp,B.RGBA)),oe.bind(B.LINEAR,B.CLAMP_TO_EDGE)}L.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(oe,ae,_e){let ge=oe.context,ne=ge.gl,se=ae.tileFramebuffer;ge.activeTexture.set(ne.TEXTURE0);let le={u_texture:0,u_opacity:1.05*(Re=ae.paint.get("raster-particle-fade-opacity-factor"))/(Re+.05)},we=oe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Re;for(let me of _e){let[,,Le,Be]=me;se.colorAttachment.set(Le.targetColorTexture.texture),ge.viewport.set([0,0,se.width,se.height]),ge.clear({color:t.C.transparent}),Be&&(Le.backgroundColorTexture.bind(ne.NEAREST,ne.CLAMP_TO_EDGE),we.draw(oe,ne.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.alphaBlended,t.af.disabled,le,ae.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments))}}(S,D,X),function(oe,ae,_e,ge){let ne=oe.context,se=ne.gl,le=_e.tileFramebuffer,we=oe.transform.projection.name==="globe",Re=_e.paint.get("raster-particle-max-speed");for(let me of ge){let[Le,Be,Qe]=me;ne.activeTexture.set(se.TEXTURE0+0),Be.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE),le.colorAttachment.set(Qe.targetColorTexture.texture);let Je=oe.getOrCreateProgram("rasterParticleDraw",{defines:Be.defines,overrideFog:!1});ne.activeTexture.set(se.TEXTURE0+1);let Xe=Be.scalarData?[]:[0,1,2,3].map(Ze=>t.bZ[Ze](Le));Xe.push(Le);let Ee=Le.canonical.x,Ve=Le.canonical.y;for(let Ze of Xe){let bt=ae.getTile(we?Ze.wrapped():Ze);if(!bt)continue;let vt=bt.rasterParticleState;if(!vt)continue;let It=Ze.canonical.x+(1<<Ze.canonical.z)*(Ze.wrap-Le.wrap),xt=Ze.canonical.y;vt.particleTexture0.bind(se.NEAREST,se.CLAMP_TO_EDGE);let it=sf(1,vt.particleTexture0.size[0],[It-Ee,xt-Ve],0,Be.texture.size,2,Re,Be.textureOffset,Be.scale,Be.offset);Je.draw(oe,se.POINTS,t.ae.disabled,t.ag.disabled,t.a.alphaBlended,t.af.disabled,it,_e.id,vt.particleIndexBuffer,void 0,vt.particleSegment)}}}(S,k,D,X),L.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(oe,ae,_e,ge){let ne=oe.context,se=ne.gl,le=ae.paint.get("raster-particle-max-speed"),we=ge*ae.paint.get("raster-particle-speed-factor")*.15,Re=function(Le){return Math.pow(Le,6)}(.01+1*ae.paint.get("raster-particle-reset-rate-factor")),me=ae.particleFramebuffer;ne.viewport.set([0,0,me.width,me.height]);for(let Le of _e){let[,Be,Qe]=Le;ne.activeTexture.set(se.TEXTURE0+0),Be.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE),ne.activeTexture.set(se.TEXTURE0+1);let Je=Qe.particleTexture0;Je.bind(se.NEAREST,se.CLAMP_TO_EDGE);let Xe=Zv(1,Je.size[0],0,Be.texture.size,le,we,Re,Be.textureOffset,Be.scale,Be.offset);me.colorAttachment.set(Qe.particleTexture1.texture),ne.clear({color:t.C.transparent}),oe.getOrCreateProgram("rasterParticleUpdate",{defines:Be.defines}).draw(oe,se.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.disabled,Xe,ae.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments)}}(S,D,X,re)}(f,a,u,_),f.renderPass==="translucent"&&(function(S,k,D,A,L){let B=S.context,U=B.gl,W=!S.options.moving,Y=S.transform.projection.name==="globe";if(!A.length)return;let[Z,X]=S.stencilConfigForOverlap(A),Q=[];Y&&Q.push("PROJECTION_GLOBE_VIEW");let re=S.stencilModeFor3D();for(let oe of X){let ae=oe.toUnwrapped(),_e=k.getTile(oe);if(!_e.rasterParticleState)continue;let ge=_e.rasterParticleState,ne=100;_e.registerFadeDuration(ne);let se=k.findLoadedParent(oe,0),le=Lu(_e,se,k,S.transform,ne),we,Re;S.terrain&&S.terrain.prepareDrawTile(),B.activeTexture.set(U.TEXTURE0),ge.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),B.activeTexture.set(U.TEXTURE1),se&&se.rasterParticleState?(se.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),we=Math.pow(2,se.tileID.overscaledZ-_e.tileID.overscaledZ),Re=[_e.tileID.canonical.x*we%1,_e.tileID.canonical.y*we%1]):ge.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let me=Y?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(ae,W),Le=S.transform,Be=z_(Le),Qe=t.bc(oe.canonical),Je=t.bd(Qe.getCenter().lat),Xe,Ee,Ve,Ze,bt;Y?(Xe=Float32Array.from(t.bf(t.bg(oe.canonical))),Ee=Float32Array.from(Le.globeMatrix),Ve=Float32Array.from(t.bb(Le)),Ze=[t.aj(Le.center.lng),t.ak(Le.center.lat)],bt=Float32Array.from(t.be(oe.canonical,Qe,Je,Le.worldSize/Le._pixelsPerMercatorPixel))):(Xe=new Float32Array(16),Ee=new Float32Array(9),Ve=new Float32Array(16),Ze=[0,0],bt=new Float32Array(9));let vt=af(me,Xe,Ee,Ve,bt,Re||[0,0],t.a1(S.transform.zoom),Ze,Be,we||1,le,250),It=S.isTileAffectedByFog(oe),xt=S.getOrCreateProgram("rasterParticle",{defines:Q,overrideFog:It});if(S.uploadCommonUniforms(B,xt,ae),Y){let it=new t.ae(U.LEQUAL,t.ae.ReadWrite,S.depthRangeFor3D),$e=0,Dt=S.globeSharedBuffers;if(Dt){let[si,ti,xi]=Dt.getGridBuffers(Je,$e!==0);xt.draw(S,U.TRIANGLES,it,re,t.a.alphaBlended,t.af.backCCW,vt,D.id,si,ti,xi)}}else{let it=S.depthModeForSublayer(0,t.ae.ReadOnly),$e=Z[oe.overscaledZ],{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:si,tileBoundsSegments:ti}=S.getTileBoundsBuffers(_e);xt.draw(S,U.TRIANGLES,it,$e,t.a.alphaBlended,t.af.disabled,vt,D.id,Dt,si,ti)}}S.resetStencilClippingMasks()}(f,a,u,_),f.style.map.triggerRepaint())},background:function(f,a,u,_){let v=u.paint.get("background-color"),x=u.paint.get("background-opacity"),S=u.paint.get("background-emissive-strength");if(x===0)return;let k=f.context,D=k.gl,A=f.transform,L=A.tileSize,B=u.paint.get("background-pattern"),U;if(B!==void 0&&(B===null||(U=f.imageManager.getPattern(B.toString(),u.scope,f.style.getLut(u.scope)),!U)))return;let W=!B&&v.a===1&&x===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==W)return;let Y=t.ag.disabled,Z=f.depthModeForSublayer(0,W==="opaque"?t.ae.ReadWrite:t.ae.ReadOnly),X=f.colorModeForDrapableLayerRenderPass(S),Q=B?"backgroundPattern":"background",re,oe=_;oe||(re=f.getBackgroundTiles(),oe=Object.values(re).map(ae=>ae.tileID)),B&&(k.activeTexture.set(D.TEXTURE0),f.imageManager.bind(f.context,u.scope));for(let ae of oe){let _e=f.isTileAffectedByFog(ae),ge=f.getOrCreateProgram(Q,{overrideFog:_e}),ne=ae.toUnwrapped(),se=_?ae.projMatrix:f.transform.calculateProjMatrix(ne);f.prepareDrawTile();let le=a?a.getTile(ae):re?re[ae.key]:new t.by(ae,L,A.zoom,f),we=B?A_(se,S,x,f,0,u.scope,U,{tileID:ae,tileSize:L}):mh(se,S,x,v.toRenderColor(u.lut));f.uploadCommonUniforms(k,ge,ne);let{tileBoundsBuffer:Re,tileBoundsIndexBuffer:me,tileBoundsSegments:Le}=f.getTileBoundsBuffers(le);ge.draw(f,D.TRIANGLES,Z,Y,X,t.af.disabled,we,u.id,Re,me,Le)}},sky:function(f,a,u){let _=f._atmosphere?t.a1(f.transform.zoom):1,v=u.paint.get("sky-opacity")*_;if(v===0)return;let x=f.context,S=u.paint.get("sky-type"),k=new t.ae(x.gl.LEQUAL,t.ae.ReadOnly,[0,1]),D=f.frameCounter/1e3%1;S==="atmosphere"?f.renderPass==="offscreen"?u.needsSkyboxCapture(f)&&(function(A,L,B,U){let W=A.context,Y=W.gl,Z=L.skyboxFbo;if(!Z){Z=L.skyboxFbo=W.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Hc(W),L.skyboxTexture=W.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,L.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let oe=0;oe<6;++oe)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(Z.framebuffer),W.viewport.set([0,0,32,32]);let X=L.getCenter(A,!0),Q=A.getOrCreateProgram("skyboxCapture"),re=new Float64Array(16);t.ad.identity(re),t.ad.rotateY(re,re,.5*-Math.PI),Wa(A,L,Q,re,X,0),t.ad.identity(re),t.ad.rotateY(re,re,.5*Math.PI),Wa(A,L,Q,re,X,1),t.ad.identity(re),t.ad.rotateX(re,re,.5*-Math.PI),Wa(A,L,Q,re,X,2),t.ad.identity(re),t.ad.rotateX(re,re,.5*Math.PI),Wa(A,L,Q,re,X,3),t.ad.identity(re),Wa(A,L,Q,re,X,4),t.ad.identity(re),t.ad.rotateY(re,re,Math.PI),Wa(A,L,Q,re,X,5),W.viewport.set([0,0,A.width,A.height])}(f,u),u.markSkyboxValid(f)):f.renderPass==="sky"&&function(A,L,B,U,W){let Y=A.context,Z=Y.gl,X=A.transform,Q=A.getOrCreateProgram("skybox");Y.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,L.skyboxTexture);let re=((oe,ae,_e,ge,ne)=>({u_matrix:oe,u_sun_direction:ae,u_cubemap:0,u_opacity:ge,u_temporal_offset:ne}))(X.skyboxMatrix,L.getCenter(A,!1),0,U,W);A.uploadCommonUniforms(Y,Q),Q.draw(A,Z.TRIANGLES,B,t.ag.disabled,A.colorModeForRenderPass(),t.af.backCW,re,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,u,k,v,D):S==="gradient"&&f.renderPass==="sky"&&function(A,L,B,U,W){let Y=A.context,Z=Y.gl,X=A.transform,Q=A.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Hc(Y)),Y.activeTexture.set(Z.TEXTURE0);let re=L.colorRampTexture;re||(re=L.colorRampTexture=new t.T(Y,L.colorRamp,Z.RGBA)),re.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let oe=((ae,_e,ge,ne,se)=>({u_matrix:ae,u_color_ramp:0,u_center_direction:_e,u_radius:t.ab(ge),u_opacity:ne,u_temporal_offset:se}))(X.skyboxMatrix,L.getCenter(A,!1),L.paint.get("sky-gradient-radius"),U,W);A.uploadCommonUniforms(Y,Q),Q.draw(A,Z.TRIANGLES,B,t.ag.disabled,A.colorModeForRenderPass(),t.af.backCW,oe,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,u,k,v,D)},debug:function(f,a,u,_,v,x){for(let S=0;S<u.length;S++)if(v){let A=new t.C(_.r*.8,_.g*.8,_.b*.8,1);Et(f,a,u[S],_,-1,-1,x),Et(f,a,u[S],_,-1,1,x),Et(f,a,u[S],_,1,1,x),Et(f,a,u[S],_,1,-1,x),Et(f,a,u[S],A,0,0,x)}else Et(f,a,u[S],_,0,0,x)},custom:function(f,a,u,_){let v=f.context,x=u.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&u.isDraped(a)){if(f.renderPass==="offscreen"){let S=x.prerender;if(S){if(f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){let k=f.transform.pointMerc;S.call(x,v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),t.a1(f.transform.zoom),[k.x,k.y],f.transform.pixelsPerMeterRatio)}else S.call(x,v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){let k=x.renderToTile;if(k){let D=_[0].canonical,A=new t.Y(D.x+_[0].wrap*(1<<D.z),D.y,D.z);v.setDepthMode(t.ae.disabled),v.setStencilMode(t.ag.disabled),v.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),k.call(x,v.gl,A),v.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),v.setStencilMode(t.ag.disabled);let S=x.renderingMode==="3d"?new t.ae(f.context.gl.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,t.ae.ReadOnly);if(v.setDepthMode(S),f.transform.projection.name==="globe"){let k=f.transform.pointMerc;x.render(v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),t.a1(f.transform.zoom),[k.x,k.y],f.transform.pixelsPerMeterRatio)}else x.render(v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState(),v.bindFramebuffer.set(null)}}else t.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,a,u,_){if(f.renderPass==="opaque")return;let v=u.paint.get("model-opacity");if(v===0)return;let x=u.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!x||f.terrain&&v<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof t.Z))return;let S=f.shadowRenderer,k=u.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,k||(S.enabled=!1));let D=()=>{S&&(S.useNormalOffset=!0,k||(S.enabled=!0))},A=a.getSource();if(f.renderPass==="light-beam"&&A.type!=="batched-model")return;if(A.type==="vector"||A.type==="geojson")return function(Q,re,oe,ae,_e){let ge=Q.transform;if(ge.projection.name!=="mercator")return void t.w(`Drawing 3D models for ${ge.projection.name} projection is not yet implemented`);let ne=ge.getFreeCameraOptions().position;if(!Q.modelManager)return;let se=Q.modelManager;oe.modelManager=se;let le=Q.shadowRenderer;if(!oe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let we=oe._unevaluatedLayout._values["model-id"],Re=Xi({},oe.layout.get("model-id").parameters),me=Q.style.order.indexOf(oe.fqid);for(let Le of ae){let Be=re.getTile(Le).getBucket(oe);if(!Be||Be.projection.name!==ge.projection.name)continue;let Qe=Be.getModelUris();Qe&&!Be.modelsRequested&&(se.addModelsFromBucket(Qe,_e),Be.modelsRequested=!0);let Je=yr(Le,ge);Re.zoom=Je;let Xe=we.possiblyEvaluate(Re);if(B_(Q,Be,Le),bo.shadowUniformsInitialized=!1,bo.useSingleShadowCascade=!!le&&le.getMaxCascadeForTile(Le.toUnwrapped())===0,Q.renderPass==="shadow"&&le){if(Q.currentShadowCascade===1&&Be.isInsideFirstShadowMapFrustum)continue;let Ze=ge.calculatePosMatrix(Le.toUnwrapped(),ge.worldSize);if(bo.tileMatrix.set(Ze),bo.shadowTileMatrix=Float32Array.from(le.calculateShadowPassMatrixFromMatrix(Ze)),bo.aabb.min.fill(0),bo.aabb.max[0]=bo.aabb.max[1]=t.a3,bo.aabb.max[2]=0,Er(Be,bo,Q,oe.scope))continue}let Ee=1<<Le.canonical.z,Ve=[((ne.x-Le.wrap)*Ee-Le.canonical.x)*t.a3,(ne.y*Ee-Le.canonical.y)*t.a3,ne.z*Ee*t.a3];Q.conflationActive&&Object.keys(Be.instancesPerModel).length>0&&Q.style.isLayerClipped(oe,re.getSource())&&Be.updateReplacement(Le,Q.replacementSource,me)&&(Be.uploaded=!1,Be.upload(Q.context));for(let Ze in Be.instancesPerModel){let bt=Be.instancesPerModel[Ze];bt.features.length>0&&(Ze=Xe.evaluate(bt.features[0].feature,{}));let vt=se.getModel(Ze,_e);if(vt&&vt.uploaded)for(let It of vt.nodes)Xo(Q,oe,It,bt,Ve,Le,bo)}}}(f,a,u,_,A.type==="vector"?u.scope:""),void D();if(!A.loaded())return;if(A.type==="batched-model")return function(Q,re,oe,ae){oe.resetLayerRenderingStats(Q);let _e=Q.context,ge=Q.transform,ne=Q.style.fog,se=Q.shadowRenderer;if(ge.projection.name!=="mercator")return void t.w(`Drawing 3D landmark models for ${ge.projection.name} projection is not yet implemented`);let le=Q.transform.getFreeCameraOptions().position,we=t._.scale([],[le.x,le.y,le.z],Q.transform.worldSize);t._.negate(we,we);let Re=t.ad.identity([]),me=t.cg(ge.center.lat,ge.zoom),Le=t.ad.fromScaling([],[1,1,1/me]);t.ad.translate(Re,Re,we);let Be=oe.paint.get("model-opacity"),Qe=new t.ae(_e.gl.LEQUAL,t.ae.ReadWrite,Q.depthRangeFor3D),Je=new t.ae(_e.gl.LEQUAL,t.ae.ReadOnly,Q.depthRangeFor3D),Xe=new t.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ee=Q.renderPass==="shadow",Ve=Ee&&se?se.getCurrentCascadeFrustum():ge.getFrustum(ge.scaleZoom(ge.worldSize)),Ze=oe.paint.get("model-front-cutoff"),bt=Ze[2]<1,vt=cs(Q,oe.paint.get("model-cutoff-fade-range")),It=oe.getLayerRenderingStats();(function(xt,it,$e,Dt){let si=xt.terrain?xt.terrain.exaggeration():0,ti=xt.transform.zoom;for(let xi of Dt){let Pi=it.getTile(xi).getBucket($e);Pi&&(xt.conflationActive&&Pi.updateReplacement(xi,xt.replacementSource),Pi.evaluateScale(xt,$e),xt.terrain&&si>0&&Pi.elevationUpdate(xt.terrain,si,xi,$e.source),Pi.needsReEvaluation(xt,ti,$e)&&Pi.evaluate($e))}})(Q,re,oe,ae),function(){let xt,it,$e;bt?(xt=ae.length-1,it=-1,$e=-1):(xt=0,it=ae.length,$e=1);for(let Dt=xt;Dt!==it;Dt+=$e){let si=ae[Dt],ti=re.getTile(si).getBucket(oe);if(!ti||!ti.uploaded)continue;let xi=!1;se&&(xi=se.getMaxCascadeForTile(si.toUnwrapped())===0);let Pi=ge.calculatePosMatrix(si.toUnwrapped(),ge.worldSize),tn=ti.modelTraits,Kt=[];for(let qi of ti.getNodesInfo()){if(qi.hiddenByReplacement||!qi.node.meshes)continue;let pn=qi.node,Ji=0;Q.terrain&&pn.elevation&&(Ji=pn.elevation*Q.terrain.exaggeration());let Si=qi.evaluatedScale;if(Si[0]<=1&&Si[1]<=1&&Si[2]<=1&&(()=>{let Pe=qi.aabb;return Xe.min=[...Pe.min],Xe.max=[...Pe.max],Xe.min[2]+=Ji,Xe.max[2]+=Ji,t._.transformMat4(Xe.min,Xe.min,Pi),t._.transformMat4(Xe.max,Xe.max,Pi),Xe})().intersects(Ve)===0)continue;let ri=[...Pi],vn=pn.anchor?pn.anchor[0]:0,kn=pn.anchor?pn.anchor[1]:0;t.ad.translate(ri,ri,[vn*(Si[0]-1),kn*(Si[1]-1),Ji]),t._.exactEquals(Si,t.cj)||t.ad.scale(ri,ri,Si);let on=t.ad.multiply([],ri,pn.matrix),Ke=t.ad.multiply([],ge.expandedFarZProjMatrix,on),St=t.ad.multiply([],ge.expandedFarZProjMatrix,ri),zn=t.aA.transformMat4([],[vn,kn,Ji,1],Ke)[2];pn.hidden=!1;let $i=Be;Ee||(bt&&($i*=xa(ri,ge,qi.aabb,Ze)),$i*=ff(vt,zn)),$i!==0?Kt.push({nodeInfo:qi,depth:zn,opacity:$i,wvpForNode:Ke,wvpForTile:St,nodeModelMatrix:on,tileModelMatrix:ri}):pn.hidden=!0}Ee||Kt.sort((qi,pn)=>!bt||qi.opacity===1&&pn.opacity===1?qi.depth<pn.depth?-1:1:qi.opacity===1?-1:pn.opacity===1?1:qi.depth>pn.depth?-1:1);for(let qi of Kt){let pn=qi.nodeInfo,Ji=pn.node,Si=t.ad.multiply([],Le,qi.tileModelMatrix);t.ad.multiply(Si,Re,Si);let ri=t.ad.invert([],Si);t.ad.transpose(ri,ri),t.ad.scale(ri,ri,us),Si=t.ad.multiply(Si,Si,Ji.matrix);let vn=Q.renderPass==="light-beam",kn=tn&t.cl.HasMapboxMeshFeatures,on=kn?0:pn.evaluatedRMEA[0][2];for(let Ke=0;Ke<Ji.meshes.length;++Ke){let St=Ji.meshes[Ke],zn=Ke===Ji.lightMeshIndex,$i=qi.wvpForNode;if(zn){if(!vn&&!Q.terrain&&Q.shadowRenderer){Q.currentLayer<Q.firstLightBeamLayer&&(Q.firstLightBeamLayer=Q.currentLayer);continue}$i=qi.wvpForTile}else if(vn)continue;let Pe={defines:[]},jo=[];if(yh(Pe.defines,jo,St,Q,oe.lut),kn||Pe.defines.push("DIFFUSE_SHADED"),xi&&Pe.defines.push("SHADOWS_SINGLE_CASCADE"),It&&(Ee?It.numRenderedVerticesInShadowPass+=St.vertexArray.length:It.numRenderedVerticesInTransparentPass+=St.vertexArray.length),Ee){_o(St,qi.nodeModelMatrix,Q,oe);continue}let Hr=null;if(ne){let Js=Gc(qi.nodeModelMatrix,Q.transform);if(Hr=new Float32Array(Js),ge.projection.name!=="globe"){let el=St.aabb.min,ps=St.aabb.max,[Ga,fs]=ne.getOpacityForBounds(Js,el[0],el[1],ps[0],ps[1]);Pe.overrideFog=Ga>=An||fs>=An}}let ao=St.material,Dr;ao.occlusionTexture&&ao.occlusionTexture.offsetScale&&(Dr=ao.occlusionTexture.offsetScale,Pe.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Ee&&se&&(se.useNormalOffset=!!St.normalBuffer);let yo=Q.getOrCreateProgram("model",Pe);!Ee&&se&&se.setupShadowsFromMatrix(qi.tileModelMatrix,yo,se.useNormalOffset),Q.uploadCommonUniforms(_e,yo,null,Hr);let Ma=ao.pbrMetallicRoughness;Ma.metallicFactor=.9,Ma.roughnessFactor=.5;let Uo=ph(new Float32Array($i),new Float32Array(Si),new Float32Array(ri),new Float32Array(Ji.matrix),Q,qi.opacity,Ma.baseColorFactor.toRenderColor(null),ao.emissiveFactor,Ma.metallicFactor,Ma.roughnessFactor,ao,on,oe,[0,0,0],Dr);!zn&&(pn.hasTranslucentParts||qi.opacity<1)&&yo.draw(Q,_e.gl.TRIANGLES,Qe,t.ag.disabled,t.a.disabled,t.af.backCCW,Uo,oe.id,St.vertexBuffer,St.indexBuffer,St.segments,oe.paint,Q.transform.zoom,void 0,jo),yo.draw(Q,_e.gl.TRIANGLES,zn?Je:Qe,t.ag.disabled,zn||qi.opacity<1||pn.hasTranslucentParts?t.a.alphaBlended:t.a.unblended,t.af.backCCW,Uo,oe.id,St.vertexBuffer,St.indexBuffer,St.segments,oe.paint,Q.transform.zoom,void 0,jo)}}}}()}(f,a,u,_),void D();let L=A.getModels(),B=[],U=f.transform.getFreeCameraOptions().position,W=t._.scale([],[U.x,U.y,U.z],f.transform.worldSize);t._.negate(W,W);let Y=[],Z=[],X=0;for(let Q of L){let re=u.paint.get("model-rotation").constantOr(null),oe=u.paint.get("model-scale").constantOr(null),ae=u.paint.get("model-translation").constantOr(null);Q.computeModelMatrix(f,re,oe,ae,!0,!0,!1);let _e=t.ad.identity([]),ge=t.cg(Q.position.lat,f.transform.zoom),ne=t.ad.fromScaling([],[1,1,1/ge]);t.ad.translate(_e,_e,W),B.push({zScaleMatrix:ne,negCameraPosMatrix:_e});for(let se of Q.nodes)eo(f.transform,se,Q.matrix,f.transform.expandedFarZProjMatrix,X,Y,Z);X++}if(Y.sort((Q,re)=>re.depth-Q.depth),f.renderPass!=="shadow"){if(v===1)for(let Q of Z)Pl(Q,f,u,B[Q.modelIndex],t.ag.disabled,f.colorModeForRenderPass());else{for(let Q of Z)Pl(Q,f,u,B[Q.modelIndex],t.ag.disabled,t.a.disabled);for(let Q of Z)Pl(Q,f,u,B[Q.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(let Q of Y)Pl(Q,f,u,B[Q.modelIndex],t.ag.disabled,f.colorModeForRenderPass());D()}else{for(let Q of Z)_o(Q.mesh,Q.nodeModelMatrix,f,u);for(let Q of Y)_o(Q.mesh,Q.nodeModelMatrix,f,u);D()}}},N_={model:function(f,a,u){let _=a.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,_.type==="vector"?f.scope:""));if(_.type==="batched-model")return;let v=_.getModels();for(let x of v)x.upload(u.context)},raster:function(f,a,u){let _=a.getSource();if(!(_ instanceof Lc&&_.loaded()))return;let v=f.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!v)return;let x=f.paint.get("raster-array-band")||_.getInitialBand(v);if(x==null)return;let S=a.getIds().map(k=>a.getTileByID(k));for(let k of S)k.updateNeeded(v,x)&&_.prepareTile(k,v,x)},"raster-particle":function(f,a,u){let _=a.getSource();if(!(_ instanceof Lc&&_.loaded()))return;let v=f.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!v)return;let x=f.paint.get("raster-particle-array-band")||_.getInitialBand(v);if(x==null)return;let S=a.getIds().map(k=>a.getTileByID(k));for(let k of S)k.updateNeeded(v,x)&&_.prepareTile(k,v,x)}};class V_{constructor(a,u,_,v){this.context=new Xd(a,u),this.occlusionBuffers=new tx(this.context),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=t.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let S of x)this._debugParams.enabledLayers[S]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let S of x)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],S);this.symbolParams=new wc(v),this.setup(),this.numSublayers=t.bv.maxUnderzooming+t.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new t.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Pu(this),this._wireframeDebugCache=new xh,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(a,u){let _=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Jp(this,a));let v=this._terrain;this.transform.elevation=_?v:null,v.update(a,this.transform,u),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(a){let u=a.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[_,v]=u.getFovAdjustedRange(this.transform._fov);if(_>v)return void(this.transform.fogCullDistSq=null);let x=_+.78*(v-_);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(a){a&&!this._terrain&&(this._terrain=new Jp(this,this.style)),this._forceTerrainMode=a}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(a,u){if(this.width=a*t.e.devicePixelRatio,this.height=u*t.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){let a=this.context,u=new t.bt;u.emplaceBack(0,0),u.emplaceBack(t.a3,0),u.emplaceBack(0,t.a3),u.emplaceBack(t.a3,t.a3),this.tileExtentBuffer=a.createVertexBuffer(u,t.br.members),this.tileExtentSegments=t.b.simpleSegment(0,0,4,2);let _=new t.bt;_.emplaceBack(0,0),_.emplaceBack(t.a3,0),_.emplaceBack(0,t.a3),_.emplaceBack(t.a3,t.a3),this.debugBuffer=a.createVertexBuffer(_,t.br.members),this.debugSegments=t.b.simpleSegment(0,0,4,5);let v=new t.bt;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(v,t.br.members),this.viewportSegments=t.b.simpleSegment(0,0,4,2);let x=new t.cp;x.emplaceBack(0,0,0,0),x.emplaceBack(t.a3,0,t.a3,0),x.emplaceBack(0,t.a3,0,t.a3),x.emplaceBack(t.a3,t.a3,t.a3,t.a3),this.mercatorBoundsBuffer=a.createVertexBuffer(x,t.cq.members),this.mercatorBoundsSegments=t.b.simpleSegment(0,0,4,2);let S=new t.bu;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(S);let k=new t.cr;for(let A of[0,1,3,2,0])k.emplaceBack(A);this.debugIndexBuffer=a.createIndexBuffer(k),this.emptyTexture=new t.T(a,new t.i({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=t.ad.create();let D=this.context.gl;this.stencilClearMode=new t.ag({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let a=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,a.TRIANGLES,t.ae.disabled,this.stencilClearMode,t.a.disabled,t.af.disabled,Ru(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,u,_){if(!u||this.currentStencilSource===u.id||!a.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(let D of _)if(this._tileClippingMaskIDs[D.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=u.id;let v=this.context,x=v.gl;this.nextStencilID+_.length>256&&this.clearStencil(),v.setColorMode(t.a.disabled),v.setDepthMode(t.ae.disabled);let S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let k of _){let D=u.getTile(k),A=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:B,tileBoundsSegments:U}=this.getTileBoundsBuffers(D);S.draw(this,x.TRIANGLES,t.ae.disabled,new t.ag({func:x.ALWAYS,mask:0},A,255,x.KEEP,x.KEEP,x.REPLACE),t.a.disabled,t.af.disabled,Ru(k.projMatrix),"$clipping",L,B,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let a=this.nextStencilID++,u=this.context.gl;return new t.ag({func:u.NOTEQUAL,mask:255},a,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);let u=this.context.gl;return new t.ag({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(a){let u=this.context.gl,_=a.sort((S,k)=>k.overscaledZ-S.overscaledZ),v=_[_.length-1].overscaledZ,x=_[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();let S={};for(let k=0;k<x;k++)S[k+v]=new t.ag({func:u.GEQUAL,mask:255},k+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=x,[S,_]}return[{[v]:t.ag.disabled},_]}colorModeForRenderPass(){let a=this.context.gl;return this._showOverdrawInspector?new t.a([a.CONSTANT_COLOR,a.ONE,a.CONSTANT_COLOR,a.ONE],new t.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?t.a.unblended:t.a.alphaBlended}colorModeForDrapableLayerRenderPass(a){let u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new t.a([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new t.C(0,0,0,a===void 0?0:a),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(a,u,_,v=!1){if(this.depthOcclusion)return new t.ae(this.context.gl.GREATER,t.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return t.ae.disabled;let x=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new t.ae(_||this.context.gl.LEQUAL,u,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((a,u)=>a+u/this._fpsHistory.length,0))}render(a,u){let _=t.e.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=a.map.repaint,this.style=a,this.options=u;let v=this.style._mergedLayers,x=this.style.order.filter(se=>{let le=v[se];return!(le.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[le.type]}),S=x.map(se=>v[se]),k=this.style._mergedSourceCaches;this.imageManager=a.imageManager,this.modelManager=a.modelManager,this.symbolFadeChange=a.placement.symbolFadeChange(t.e.now()),this.imageManager.beginFrame();let D=0,A=!1;for(let se in k){let le=k[se];le.used&&(le.prepare(this.context),le.getSource().usedInConflation&&++D)}let L=!1;for(let se of S)se.isHidden(this.transform.zoom)||(se.type==="clip"&&(L=!0),this.prepareLayer(se));let B={},U={},W={},Y={},Z={};for(let se in k){let le=k[se];B[se]=le.getVisibleCoordinates(),U[se]=B[se].slice().reverse(),W[se]=le.getVisibleCoordinates(!0).reverse(),Y[se]=le.getShadowCasterCoordinates(),Z[se]=le.sortCoordinatesByDistance(B[se])}let X=se=>{let le=this.style.getLayerSourceCache(se);return le&&le.used?le.getSource():null};if(D||L){let se=[],le=[],we=0;for(let Re of S)this.isSourceForClippingOrConflation(Re,X(Re))&&(se.push(Re),le.push(we)),we++;if(se&&(L||se.length>1)){let Re=[];for(let me=0;me<se.length;me++){let Le=se[me],Be=le[me],Qe=this.style.getLayerSourceCache(Le);if(!Qe||!Qe.used||!Qe.getSource().usedInConflation&&Le.type!=="clip")continue;let Je=1/0,Xe=t.cu.None;if(Le.type==="clip"){Je=Be;for(let Ee of Le.layout.get("clip-layer-types"))Xe|=Ee==="model"?t.cu.Model:Ee==="symbol"?t.cu.Symbol:t.cu.FillExtrusion}Re.push({layer:Le.fqid,cache:Qe,order:Je,clipMask:Xe})}this.replacementSource.setSources(Re),A=!0}}A||this.replacementSource.clear(),this.conflationActive=A,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let se=0;se<S.length;se++){let le=S[se],we=le.cutoffRange();if(this.longestCutoffRange=Math.max(we,this.longestCutoffRange),we>0){let Re=X(le);Re&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom)),le.minzoom&&(this.minCutoffZoom=Math.max(le.minzoom,this.minCutoffZoom))}le.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=se),this._lastOcclusionLayer=se)}let Q=this.style&&this.style.fog;Q?(this._fogVisible=Q.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Q.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(W),this.opaquePassCutoff=0);let re=this._shadowRenderer;if(re){re.updateShadowParameters(this.transform,this.style.directionalLight);for(let se in k)for(let le of B[se]){let we={min:0,max:0};this.terrain&&(we=this.terrain.getMinMaxForTile(le)||we),re.addShadowReceiver(le.toUnwrapped(),we.min,we.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new t.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new pf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!t.ct(this.context.gl))return;this.renderPass="offscreen";for(let se of S){let le=a.getLayerSourceCache(se);if(!se.hasOffscreenPass()||se.isHidden(this.transform.zoom))continue;let we=le?U[le.id]:void 0;(se.type==="custom"||se.type==="raster"||se.type==="raster-particle"||se.isSky()||we&&we.length)&&this.renderLayer(this,le,se,we)}this.depthRangeFor3D=[0,1-(S.length+2)*this.numSublayers*this.depthEpsilon];let oe=this.terrain;oe&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&oe.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Y)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),_e=(()=>{if(u.showOverdrawInspector)return t.C.black;let se=this.style.fog;if(se&&this.transform.projection.supportsFog){let le=this.style.getLut(se.scope);if(!ae){let we=se.properties.get("color").toRenderColor(le).toArray01();return new t.C(...we)}if(ae){let we=se.properties.get("space-color").toRenderColor(le).toArray01();return new t.C(...we)}}return t.C.transparent})();if(this.context.clear({color:_e,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){let se=S[this.currentLayer],le=a.getLayerSourceCache(se);if(se.isSky())continue;let we=le?(se.is3D()?Z:U)[le.id]:void 0;this._renderTileClippingMasks(se,le,we),this.renderLayer(this,le,se,we)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||t.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){let se=S[this.currentLayer],le=a.getLayerSourceCache(se);se.isSky()&&this.renderLayer(this,le,se,le?U[le.id]:void 0)}function ge(se,le){let we;return le&&(we=(se.type==="symbol"?W:se.is3D()?Z:U)[le.id]),we}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){let se=S[this.currentLayer];if(se.type==="raster"){let le=a.getLayerSourceCache(se);this.renderLayer(this,le,se,ge(se,le))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ne=0;for(re&&(ne=re.getShadowCastingLayerCount());this.currentLayer<x.length;){let se=S[this.currentLayer],le=a.getLayerSourceCache(se);if(se.isSky())++this.currentLayer;else if(oe&&this.style.isLayerDraped(se)){if(se.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=oe.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(se.is3D()||this.terrain||this._renderTileClippingMasks(se,le,le?B[le.id]:void 0),this.renderLayer(this,le,se,ge(se,le)),!oe&&re&&ne>0&&se.hasShadowPass()&&--ne==0&&(re.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let we=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=we;this.currentLayer++){let Re=S[this.currentLayer];if(!Re.hasLightBeamPass())continue;let me=a.getLayerSourceCache(Re);this.renderLayer(this,me,Re,me?U[me.id]:void 0)}this.currentLayer=we,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let we=this.currentLayer;this.depthOcclusion=!0;for(let Re of this.layersWithOcclusionOpacity){this.currentLayer=Re;let me=S[this.currentLayer],Le=a.getLayerSourceCache(me),Be=Le?U[Le.id]:void 0;me.is3D()||this.terrain||this._renderTileClippingMasks(me,Le,Le?B[Le.id]:void 0),this.renderLayer(this,Le,me,Be)}this.depthOcclusion=!1,this.currentLayer=we,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let se=null;S.forEach(le=>{let we=a.getLayerSourceCache(le);we&&!le.isHidden(this.transform.zoom)&&we.getVisibleCoordinates().length&&(!se||se.getSource().maxzoom<we.getSource().maxzoom)&&(se=we)}),se&&this.options.showTileBoundaries&&wa.debug(this,se,se.getVisibleCoordinates(),t.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&wa.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new t.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(se){let le=se.transform.padding;Vi(se,se.transform.height-(le.top||0),3,$u),Vi(se,le.bottom||0,3,uf),ji(se,le.left||0,3,Ua),ji(se,se.transform.width-(le.right||0),3,mf);let we=se.transform.centerPoint;(function(Re,me,Le,Be){go(Re,me-1,Le-10,2,20,Be),go(Re,me-10,Le-1,20,2,Be)})(se,we.x,se.transform.height-we.y,Uc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),A||(this.conflationActive=!1)}prepareLayer(a){this.gpuTimingStart(a);let{unsupportedLayers:u}=this.transform.projection,_=!u||!u.includes(a.type);if(N_[a.type]&&(_||this.terrain&&a.type==="custom")){let v=this.style.getLayerSourceCache(a);N_[a.type](a,v,this)}this.gpuTimingEnd()}renderLayer(a,u,_,v){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||_.type==="raster-particle"||v&&v.length)&&(this.id=_.id,this.gpuTimingStart(_),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(_.type)&&(!a.terrain||_.type!=="custom")||_.type==="clip"||wa[_.type](a,u,_,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;let u=this.context.extTimerQuery,_=this.context.gl,v=this.gpuTimers[a.id];v||(v=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:_.createQuery()}),v.calls++,_.beginQuery(u.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let a=this.context.extTimerQuery,u=this.context.gl,_=u.createQuery();this.deferredRenderGpuTimeQueries.push(_),u.beginQuery(a.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){let a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){let u={};for(let _ in a){let v=a[_],x=this.context.extTimerQuery,S=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),u[_]=S}return u}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;let u=this.context.extTimerQuery,_=this.context.gl,v=0;for(let x of a)v+=u.getQueryParameter(x,_.QUERY_RESULT)/1e6,u.deleteQueryEXT(x);return v}translatePosMatrix(a,u,_,v,x){if(!_[0]&&!_[1])return a;let S=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(S){let A=Math.sin(S),L=Math.cos(S);_=[_[0]*L-_[1]*A,_[0]*A+_[1]*L]}let k=[x?_[0]:t.bB(u,_[0],this.transform.zoom),x?_[1]:t.bB(u,_[1],this.transform.zoom),0],D=new Float32Array(16);return t.ad.translate(D,a,k),D}saveTileTexture(a){let u=a.size[0],_=this._tileTextures[u];_?_.push(a):this._tileTextures[u]=[a]}getTileTexture(a){let u=this._tileTextures[a];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(a,u,_){let v=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,x=[];return this.style&&this.style.enable3dLights()&&(a==="globeRaster"||a==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||u!==void 0&&!u||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(a,u){this.cache=this.cache||{};let _=u&&u.defines||[],v=u&&u.config,x=this.currentGlobalDefines(a,u&&u.overrideFog,u&&u.overrideRtt).concat(_),S=ch.cacheKey(w_[a],a,x,v);return this.cache[S]||(this.cache[S]=new ch(this.context,a,w_[a],v,Xv[a],x)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(a,u){if(this.style.enable3dLights()){let _=this.style.directionalLight,v=this.style.ambientLight;if(_&&v){let x=((S,k,D)=>{let A=S.properties.get("direction"),L=S.properties.get("color").toRenderColor(D.getLut(S.scope)).toArray01(),B=S.properties.get("intensity"),U=k.properties.get("color").toRenderColor(D.getLut(k.scope)).toArray01(),W=k.properties.get("intensity"),Y=[A.x,A.y,A.z],Z=t.bA(U,W),X=t.bA(L,B);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:Y,u_lighting_directional_color:X,u_ground_radiance:hs(Y,X,Z)}})(_,v,this.style);u.setLightsUniformValues(a,x)}}}uploadCommonUniforms(a,u,_,v,x){if(this.uploadCommonLightUniforms(a,u),this.terrain&&this.terrain.renderingToTexture)return;let S=this.style.fog;if(S){let k=S.getOpacity(this.transform.pitch),D=((A,L,B,U,W,Y,Z,X,Q,re,oe,ae)=>{let _e=A.transform,ge=L.properties.get("color").toRenderColor(A.style.getLut(L.scope)).toArray01();ge[3]=U;let ne=A.frameCounter/1e3%1,[se,le]=L.properties.get("vertical-range");return{u_fog_matrix:B?_e.calculateFogTileMatrix(B):ae||A.identityMat,u_fog_range:L.getFovAdjustedRange(_e._fov),u_fog_color:ge,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(se,le),le],u_fog_temporal_offset:ne,u_frustum_tl:W,u_frustum_tr:Y,u_frustum_br:Z,u_frustum_bl:X,u_globe_pos:Q,u_globe_radius:re,u_viewport:oe,u_globe_transition:t.a1(_e.zoom),u_is_globe:+(_e.projection.name==="globe")}})(this,S,_,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.e.devicePixelRatio,this.transform.height*t.e.devicePixelRatio],v);u.setFogUniformValues(a,D)}x&&u.setCutoffUniformValues(a,x.uniformValues)}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){let a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){let a=this.context.gl,u=a.createTexture();return a.bindTexture(a.TEXTURE_2D,u),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let a=this._backgroundTiles,u=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(let v of _)u[v.key]=a[v.key]||new t.by(v,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(a,u){return!(!a.is3D()||a.minzoom&&a.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||a.sourceLayer!=="building")&&a.type!=="clip"&&(!u||u.type!=="batched-model"))}isTileAffectedByFog(a){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[a.key];return u||(this._cachedTileFogOpacities[a.key]=u=this.style.fog.getOpacityForTile(a)),u[0]>=An||u[1]>=An}}class oo{constructor(a,u,_,v){this.screenBounds=a,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(a,u){let _,v;if(a instanceof t.P||typeof a[0]=="number"){let x=t.P.convert(a);_=[x],v=u.isPointAboveHorizon(x)}else{let x=t.P.convert(a[0]),S=t.P.convert(a[1]);_=[x,S],v=t.cv(x,S).every(k=>u.isPointAboveHorizon(k))}return new oo(_,u.getCameraPoint(),v,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return t.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){let u=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],v=t.cv(u,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<_.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),t.cw(v,a)}bufferedCameraGeometryGlobe(a){let u=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],v=t.cv(u,_,a),x=this.cameraPoint.clone();switch(3*((x.y>u.y)+(x.y>_.y))+((x.x>u.x)+(x.x>_.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(a,u,_,v=0){let x=a.queryPadding/u._pixelsPerMercatorPixel+1,S=_?this._bufferedCameraMercator(x,u):this._bufferedScreenMercator(x,u),k=a.tileID.wrap+(S.unwrapped?v:0),D=S.polygon.map(X=>t.cx(a.tileTransform,X,k));if(!t.cy(D,0,0,t.a3,t.a3))return;k=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);let A=this.screenGeometryMercator.polygon.map(X=>t.cz(a.tileTransform,X,k)),L=A.map(X=>new t.P(X[0],X[1])),B=u.getFreeCameraOptions().position||new t.Y(0,0,0),U=t.cz(a.tileTransform,B,k),W=A.map(X=>{let Q=t._.sub(X,X,U);return t._.normalize(Q,Q),new t.aT(U,Q)}),Y=t.bB(a,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:W,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(Z=t.cA(D),Z.min.x=t.at(Z.min.x,0,t.a3),Z.min.y=t.at(Z.min.y,0,t.a3),Z.max.x=t.at(Z.max.x,0,t.a3),Z.max.y=t.at(Z.max.y,0,t.a3),Z),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:Y};var Z}_bufferedScreenMercator(a,u){let _=_f(a);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let v;return v=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),u):{polygon:this.bufferedScreenGeometry(a).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[_]=v,v}}_bufferedCameraMercator(a,u){let _=_f(a);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let v;return v=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),u):{polygon:this.bufferedCameraGeometry(a).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[_]=v,v}}_projectAndResample(a,u){let _=function(x,S){let k=t.ad.multiply([],S.pixelMatrix,S.globeMatrix),D=[0,-t.cD,0,1],A=[0,t.cD,0,1],L=[0,0,0,1];t.aA.transformMat4(D,D,k),t.aA.transformMat4(A,A,k),t.aA.transformMat4(L,L,k);let B=new t.P(D[0]/D[3],D[1]/D[3]),U=new t.P(A[0]/A[3],A[1]/A[3]),W=t.cB(x,B)&&D[3]<L[3],Y=t.cB(x,U)&&A[3]<L[3];if(!W&&!Y)return null;let Z=function(ne,se,le){for(let we=1;we<ne.length;we++){let Re=qs(se.pointCoordinate3D(ne[we-1]).x),me=qs(se.pointCoordinate3D(ne[we]).x);if(le<0){if(Re<me)return{idx:we,t:-Re/(me-1-Re)}}else if(me<Re)return{idx:we,t:(1-Re)/(me+1-Re)}}return null}(x,S,W?-1:1);if(!Z)return null;let{idx:X,t:Q}=Z,re=X>1?gf(x.slice(0,X),S):[],oe=X<x.length?gf(x.slice(X),S):[];re=re.map(ne=>new t.P(qs(ne.x),ne.y)),oe=oe.map(ne=>new t.P(qs(ne.x),ne.y));let ae=[...re];ae.length===0&&ae.push(oe[oe.length-1]);let _e=t.a2(ae[ae.length-1].y,(oe.length===0?re[0]:oe[0]).y,Q),ge;return ge=W?[new t.P(0,_e),new t.P(0,0),new t.P(1,0),new t.P(1,_e)]:[new t.P(1,_e),new t.P(1,1),new t.P(0,1),new t.P(0,_e)],ae.push(...ge),oe.length===0?ae.push(re[0]):ae.push(...oe),{polygon:ae.map(ne=>new t.Y(ne.x,ne.y)),unwrapped:!1}}(a,u);if(_)return _;let v=function(x,S){let k=!1,D=-1/0,A=0;for(let B=0;B<x.length-1;B++)x[B].x>D&&(D=x[B].x,A=B);for(let B=0;B<x.length-1;B++){let U=(A+B)%(x.length-1),W=x[U],Y=x[U+1];Math.abs(W.x-Y.x)>.5&&(W.x<Y.x?(W.x+=1,U===0&&(x[x.length-1].x+=1)):(Y.x+=1,U+1===x.length-1&&(x[0].x+=1)),k=!0)}let L=t.aj(S.center.lng);return k&&L<Math.abs(L-1)&&x.forEach(B=>{B.x-=1}),{polygon:x,unwrapped:k}}(gf(a,u).map(x=>new t.P(qs(x.x),x.y)),u);return{polygon:v.polygon.map(x=>new t.Y(x.x,x.y)),unwrapped:v.unwrapped}}}function gf(f,a){return t.cC(f,u=>{let _=a.pointCoordinate3D(u);u.x=_.x,u.y=_.y},1/256)}function qs(f){return f<0?1+f%1:f%1}function _f(f){return 100*f|0}function ix(f,a){let u=t.ad.identity([]);return t.ad.scale(u,u,[.5*f.width,.5*-f.height,1]),t.ad.translate(u,u,[1,-1,0]),t.ad.multiply(u,u,f.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(u)}function nx(f,a,u,_,v,x,S,k=!1){let D=f.tilesIn(_,S,k);D.sort(qc);let A=[];for(let B of D)A.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(a,u,f._state,B,v,x,ix(f.transform,B.tile.tileID),k)});let L=function(B){let U={},W={};for(let Y of B){let Z=Y.queryResults,X=Y.wrappedTileID,Q=W[X]=W[X]||{};for(let re in Z){let oe=Z[re],ae=Q[re]=Q[re]||{},_e=U[re]=U[re]||[];for(let ge of oe)ae[ge.featureIndex]||(ae[ge.featureIndex]=!0,_e.push(ge))}}return U}(A);for(let B in L)L[B].forEach(U=>{let W=U.feature,Y=W.layer;Y&&Y.type!=="background"&&Y.type!=="sky"&&Y.type!=="slot"&&(W.source=Y.source,Y["source-layer"]&&(W.sourceLayer=Y["source-layer"]),W.state=W.id!==void 0?f.getFeatureState(Y["source-layer"],W.id):{})});return L}function wh(f,a){let u=f.getRenderableIds().map(x=>f.getTileByID(x)),_=[],v={};for(let x=0;x<u.length;x++){let S=u[x],k=S.tileID.canonical.key;v[k]||(v[k]=!0,S.querySourceFeatures(_,a))}return _}function qc(f,a){let u=f.tileID,_=a.tileID;return u.overscaledZ-_.overscaledZ||u.canonical.y-_.canonical.y||u.wrap-_.wrap||u.canonical.x-_.canonical.x}class rx{constructor(a){this.style=a,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let a=!1,u=!1;for(let _ in this.style._mergedLayers){let v=this.style._mergedLayers[_];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:a,visibilityChanged:u});else if(v.type==="model"){let x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:a,visibilityChanged:u})}}}onNewFrame(a){this.layersGotHidden=!1;for(let u of this.layers){let _=u.layer,v=!1;_.type==="fill-extrusion"?v=!_.isHidden(a)&&_.paint.get("fill-extrusion-opacity")>0:_.type==="model"&&(v=!_.isHidden(a)&&_.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&u.visible,u.visible=v}}updateZOffset(a,u){this.currentBuildingBuckets=[];for(let v of this.layers){let x=v.layer,S=this.style.getLayerSourceCache(x),k=1;x.type==="fill-extrusion"&&(k=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let D=S?S.getTile(u):null;if(!D&&S&&u.canonical.z>S.getSource().minzoom){let A=u.scaledTo(Math.min(S.getSource().maxzoom,u.overscaledZ-1));for(;A.overscaledZ>=S.getSource().minzoom&&(D=S.getTile(A),!D&&A.overscaledZ!==0);)A=A.scaledTo(A.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:D?D.getBucket(x):null,tileID:D?D.tileID:u,verticalScale:k})}a.hasAnyZOffset=!1;let _=!1;for(let v=0;v<a.symbolInstances.length;v++){let x=a.symbolInstances.get(v),S=x.zOffset,k=this._getHeightAtTileOffset(u,x.tileAnchorX,x.tileAnchorY);x.zOffset=k!==Number.NEGATIVE_INFINITY?k:S,_||S===x.zOffset||(_=!0),a.hasAnyZOffset||x.zOffset===0||(a.hasAnyZOffset=!0)}_&&(a.zOffsetBuffersNeedUpload=!0,a.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(a,u,_,v){let x=u,S=_;if(a.canonical.z!==v.canonical.z){let k=v.canonical,D=1/(1<<a.canonical.z-k.z);x=(u+a.canonical.x*t.a3)*D-k.x*t.a3|0,S=(_+a.canonical.y*t.a3)*D-k.y*t.a3|0}return{tileX:x,tileY:S}}_getHeightAtTileOffset(a,u,_){let v,x;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;let{bucket:k,tileID:D,verticalScale:A}=this.currentBuildingBuckets[S];if(!k)continue;let{tileX:L,tileY:B}=this._mapCoordToOverlappingTile(a,u,_,D),U=k.getHeightAtTileCoord(L,B);U&&U.height!==void 0&&(U.hidden?v=U.height:x=Math.max(U.height*A,x||0))}if(x!==void 0)return x;for(let S=0;S<this.layers.length;++S){let k=this.layers[S];if(k.layer.type!=="model"||!k.visible)continue;let{bucket:D,tileID:A}=this.currentBuildingBuckets[S];if(!D)continue;let{tileX:L,tileY:B}=this._mapCoordToOverlappingTile(a,u,_,A),U=D.getHeightAtTileCoord(L,B);if(U&&!U.hidden)return U.height===void 0&&v!==void 0?Math.min(U.maxHeight,v)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function $c(f,a){let u={};for(let _ in f)_!=="ref"&&(u[_]=f[_]);return t.cE.forEach(_=>{_ in a&&(u[_]=a[_])}),u}function bf(f){f=f.slice();let a=Object.create(null);for(let u=0;u<f.length;u++)a[f[u].id]=f[u];for(let u=0;u<f.length;u++)"ref"in f[u]&&(f[u]=$c(f[u],a[f[u].ref]));return f}let Li={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function ms(f,a,u){u.push({command:Li.addSource,args:[f,a[f]]})}function j_(f,a,u){a.push({command:Li.removeSource,args:[f]}),u[f]=!0}function ox(f,a,u,_){j_(f,u,_),ms(f,a,u)}function ax(f,a,u){let _;for(_ in f[u])if(f[u].hasOwnProperty(_)&&_!=="data"&&!g(f[u][_],a[u][_]))return!1;for(_ in a[u])if(a[u].hasOwnProperty(_)&&_!=="data"&&!g(f[u][_],a[u][_]))return!1;return!0}function Ch(f,a,u,_,v,x){let S;for(S in a=a||{},f=f||{})f.hasOwnProperty(S)&&(g(f[S],a[S])||u.push({command:x,args:[_,S,a[S],v]}));for(S in a)a.hasOwnProperty(S)&&!f.hasOwnProperty(S)&&(g(f[S],a[S])||u.push({command:x,args:[_,S,a[S],v]}))}function Yu(f){return f.id}function Yc(f,a){return f[a.id]=a,f}class U_{constructor(a,u){this.reset(a,u)}reset(a,u){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=t.at(a,0,1);let u=1,_=this._distances[u],v=a*this.paddedLength+this.padding;for(;_<v&&u<this._distances.length;)_=this._distances[++u];let x=u-1,S=this._distances[x],k=_-S,D=k>0?(v-S)/k:0;return this.points[x].mult(1-D).add(this.points[u].mult(D))}}class yf{constructor(a,u,_){let v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(u/_);for(let S=0;S<this.xCellCount*this.yCellCount;S++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=u,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,u,_,v,x){this._forEachCell(u,_,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(u),this.bboxes.push(_),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(a,u,_,v){this._forEachCell(u-v,_-v,u+v,_+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(u),this.circles.push(_),this.circles.push(v)}_insertBoxCell(a,u,_,v,x,S){this.boxCells[x].push(S)}_insertCircleCell(a,u,_,v,x,S){this.circleCells[x].push(S)}_query(a,u,_,v,x,S){if(_<0||a>this.width||v<0||u>this.height)return!x&&[];let k=[];if(a<=0&&u<=0&&this.width<=_&&this.height<=v){if(x)return!0;for(let D=0;D<this.boxKeys.length;D++)k.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){let A=this.circles[3*D],L=this.circles[3*D+1],B=this.circles[3*D+2];k.push({key:this.circleKeys[D],x1:A-B,y1:L-B,x2:A+B,y2:L+B})}return S?k.filter(S):k}return this._forEachCell(a,u,_,v,this._queryCell,k,{hitTest:x,seenUids:{box:{},circle:{}}},S),x?k.length>0:k}_queryCircle(a,u,_,v,x){let S=a-_,k=a+_,D=u-_,A=u+_;if(k<0||S>this.width||A<0||D>this.height)return!v&&[];let L=[];return this._forEachCell(S,D,k,A,this._queryCellCircle,L,{hitTest:v,circle:{x:a,y:u,radius:_},seenUids:{box:{},circle:{}}},x),v?L.length>0:L}query(a,u,_,v,x){return this._query(a,u,_,v,!1,x)}hitTest(a,u,_,v,x){return this._query(a,u,_,v,!0,x)}hitTestCircle(a,u,_,v){return this._queryCircle(a,u,_,!0,v)}_queryCell(a,u,_,v,x,S,k,D){let A=k.seenUids,L=this.boxCells[x];if(L!==null){let U=this.bboxes;for(let W of L)if(!A.box[W]){A.box[W]=!0;let Y=4*W;if(a<=U[Y+2]&&u<=U[Y+3]&&_>=U[Y+0]&&v>=U[Y+1]&&(!D||D(this.boxKeys[W]))){if(k.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[W],x1:U[Y],y1:U[Y+1],x2:U[Y+2],y2:U[Y+3]})}}}let B=this.circleCells[x];if(B!==null){let U=this.circles;for(let W of B)if(!A.circle[W]){A.circle[W]=!0;let Y=3*W;if(this._circleAndRectCollide(U[Y],U[Y+1],U[Y+2],a,u,_,v)&&(!D||D(this.circleKeys[W]))){if(k.hitTest)return S.push(!0),!0;{let Z=U[Y],X=U[Y+1],Q=U[Y+2];S.push({key:this.circleKeys[W],x1:Z-Q,y1:X-Q,x2:Z+Q,y2:X+Q})}}}}}_queryCellCircle(a,u,_,v,x,S,k,D){let A=k.circle,L=k.seenUids,B=this.boxCells[x];if(B!==null){let W=this.bboxes;for(let Y of B)if(!L.box[Y]){L.box[Y]=!0;let Z=4*Y;if(this._circleAndRectCollide(A.x,A.y,A.radius,W[Z+0],W[Z+1],W[Z+2],W[Z+3])&&(!D||D(this.boxKeys[Y])))return S.push(!0),!0}}let U=this.circleCells[x];if(U!==null){let W=this.circles;for(let Y of U)if(!L.circle[Y]){L.circle[Y]=!0;let Z=3*Y;if(this._circlesCollide(W[Z],W[Z+1],W[Z+2],A.x,A.y,A.radius)&&(!D||D(this.circleKeys[Y])))return S.push(!0),!0}}}_forEachCell(a,u,_,v,x,S,k,D){let A=this._convertToXCellCoord(a),L=this._convertToYCellCoord(u),B=this._convertToXCellCoord(_),U=this._convertToYCellCoord(v);for(let W=A;W<=B;W++)for(let Y=L;Y<=U;Y++)if(x.call(this,a,u,_,v,this.xCellCount*Y+W,S,k,D))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,u,_,v,x,S){let k=v-a,D=x-u,A=_+S;return A*A>k*k+D*D}_circleAndRectCollide(a,u,_,v,x,S,k){let D=(S-v)/2,A=Math.abs(a-(v+D));if(A>D+_)return!1;let L=(k-x)/2,B=Math.abs(u-(x+L));if(B>L+_)return!1;if(A<=D||B<=L)return!0;let U=A-D,W=B-L;return U*U+W*W<=_*_}}let Ca=100;class W_{constructor(a,u,_=new yf(a.width+200,a.height+200,25),v=new yf(a.width+200,a.height+200,25)){this.transform=a,this.grid=_,this.ignoredGrid=v,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Ca,this.screenBottomBoundary=a.height+Ca,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=u}placeCollisionBox(a,u,_,v,x,S,k,D){let A=_.projectedAnchorX,L=_.projectedAnchorY,B=_.projectedAnchorZ,U=_.elevation,W=_.tileID,Y=a.getProjection();if(U&&W){let[ge,ne,se]=Y.upVector(W.canonical,_.tileAnchorX,_.tileAnchorY),le=Y.upVectorScale(W.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=ge*U*le,L+=ne*U*le,B+=se*U*le}let Z=this.projectAndGetPerspectiveRatio(k,A,L,B,_.tileID,Y.name==="globe"||!!U||this.transform.pitch>0,Y),X=S*Z.perspectiveRatio,Q=(_.x1*u+v.x-_.padding)*X+Z.point.x,re=(_.y1*u+v.y-_.padding)*X+Z.point.y,oe=(_.x2*u+v.x+_.padding)*X+Z.point.x,ae=(_.y2*u+v.y+_.padding)*X+Z.point.y,_e=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(Q,re,oe,ae)||!x&&this.grid.hitTest(Q,re,oe,ae,D)||_e?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[Q,re,oe,ae],offscreen:this.isOffscreen(Q,re,oe,ae),occluded:!1}}placeCollisionCircles(a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z){let X=[],Q=this.transform.elevation,re=a.getProjection(),oe=Q?Q.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,re):null,ae=new t.P(_.tileAnchorX,_.tileAnchorY),{x:_e,y:ge,z:ne}=re.projectTilePoint(ae.x,ae.y,Z.canonical);if(oe){let[Xe,Ee,Ve]=oe(ae);_e+=Xe,ge+=Ee,ne+=Ve}let se=re.name==="globe",le=this.projectAndGetPerspectiveRatio(k,_e,ge,ne,Z,se||!!Q||this.transform.pitch>0,re),{perspectiveRatio:we}=le,Re=(B?S/we:S*we)/t.bN,me=Zo(_e,ge,ne,D),Le=le.signedDistanceFromCamera>0?Du(Re,x,_.lineOffsetX*Re,_.lineOffsetY*Re,!1,me,ae,_,v,D,{},Q&&!B?oe:null,B&&!!Q,re,Z,B):null,Be=!1,Qe=!1,Je=!0;if(Le&&!le.occluded){let Xe=.5*W*we+Y,Ee=new t.P(-100,-100),Ve=new t.P(this.screenRightBoundary,this.screenBottomBoundary),Ze=new U_,{first:bt,last:vt}=Le,It=bt.path.length,xt=[];for(let Dt=It-1;Dt>=1;Dt--)xt.push(bt.path[Dt]);for(let Dt=1;Dt<vt.path.length;Dt++)xt.push(vt.path[Dt]);let it=2.5*Xe;A&&(xt=xt.map(([Dt,si,ti],xi)=>(oe&&!se&&(ti=oe(xi<It-1?bt.tilePath[It-1-xi]:vt.tilePath[xi-It+2])[2]),Zo(Dt,si,ti,A))),xt.some(Dt=>Dt[3]<=0)&&(xt=[]));let $e=[];if(xt.length>0){let Dt=1/0,si=-1/0,ti=1/0,xi=-1/0;for(let Pi of xt)Dt=Math.min(Dt,Pi[0]),ti=Math.min(ti,Pi[1]),si=Math.max(si,Pi[0]),xi=Math.max(xi,Pi[1]);si>=Ee.x&&Dt<=Ve.x&&xi>=Ee.y&&ti<=Ve.y&&($e=[xt.map(Pi=>new t.P(Pi[0],Pi[1]))],(Dt<Ee.x||si>Ve.x||ti<Ee.y||xi>Ve.y)&&($e=t.cF($e,Ee.x,Ee.y,Ve.x,Ve.y)))}for(let Dt of $e){Ze.reset(Dt,.25*Xe);let si=0;si=Ze.length<=.5*Xe?1:Math.ceil(Ze.paddedLength/it)+1;for(let ti=0;ti<si;ti++){let xi=ti/Math.max(si-1,1),Pi=Ze.lerp(xi),tn=Pi.x+Ca,Kt=Pi.y+Ca;X.push(tn,Kt,Xe,0);let qi=tn-Xe,pn=Kt-Xe,Ji=tn+Xe,Si=Kt+Xe;if(Je=Je&&this.isOffscreen(qi,pn,Ji,Si),Qe=Qe||this.isInsideGrid(qi,pn,Ji,Si),!u&&this.grid.hitTestCircle(tn,Kt,Xe,U)&&(Be=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Be,occluded:!1}}}}return{circles:!L&&Be||!Qe?[]:X,offscreen:Je,collisionDetected:Be,occluded:le.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let u=[],_=1/0,v=1/0,x=-1/0,S=-1/0;for(let L of a){let B=new t.P(L.x+Ca,L.y+Ca);_=Math.min(_,B.x),v=Math.min(v,B.y),x=Math.max(x,B.x),S=Math.max(S,B.y),u.push(B)}let k=this.grid.query(_,v,x,S).concat(this.ignoredGrid.query(_,v,x,S)),D={},A={};for(let L of k){let B=L.key;if(D[B.bucketInstanceId]===void 0&&(D[B.bucketInstanceId]={}),D[B.bucketInstanceId][B.featureIndex])continue;let U=[new t.P(L.x1,L.y1),new t.P(L.x2,L.y1),new t.P(L.x2,L.y2),new t.P(L.x1,L.y2)];t.cG(u,U)&&(D[B.bucketInstanceId][B.featureIndex]=!0,A[B.bucketInstanceId]===void 0&&(A[B.bucketInstanceId]=[]),A[B.bucketInstanceId].push(B.featureIndex))}return A}insertCollisionBox(a,u,_,v,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:v,collisionGroupID:x},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,u,_,v,x){let S=u?this.ignoredGrid:this.grid,k={bucketInstanceId:_,featureIndex:v,collisionGroupID:x};for(let D=0;D<a.length;D+=4)S.insertCircle(k,a[D],a[D+1],a[D+2])}projectAndGetPerspectiveRatio(a,u,_,v,x,S,k){let D=[u,_,v,1],A=!1;v||this.transform.pitch>0?(t.aA.transformMat4(D,D,a),this.fogState&&x&&k.name!=="globe"&&(A=function(U,W,Y,Z,X,Q){let re=Q.calculateFogTileMatrix(X),oe=[W,Y,Z];return t._.transformMat4(oe,oe,re),br(U,t._.length(oe),Q.pitch,Q._fov)}(this.fogState,u,_,v,x.toUnwrapped(),this.transform)>.9)):Va(D,D,a);let L=D[3];return{point:new t.P((D[0]/L+1)/2*this.transform.width+Ca,(-D[1]/L+1)/2*this.transform.height+Ca),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/L*.5,1.5),signedDistanceFromCamera:L,occluded:S&&D[2]>L||A}}isOffscreen(a,u,_,v){return _<Ca||a>=this.screenRightBoundary||v<Ca||u>this.screenBottomBoundary}isInsideGrid(a,u,_,v){return _>=0&&a<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){let a=t.ad.identity([]);return t.ad.translate(a,a,[-100,-100,0]),a}}class $s{constructor(a,u,_,v){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?u:-u))):v&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Ys{constructor(a,u,_,v,x,S=!1){this.text=new $s(a?a.text:null,u,_,x),this.icon=new $s(a?a.icon:null,u,v,x),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Zu{constructor(a,u,_,v=!1){this.text=a,this.icon=u,this.skipFade=_,this.clipped=v}}class H_{constructor(){this.invProjMatrix=t.ad.create(),this.viewportMatrix=t.ad.create(),this.circles=[]}}class Sh{constructor(a,u,_,v,x){this.bucketInstanceId=a,this.featureIndex=u,this.sourceLayerIndex=_,this.bucketIndex=v,this.tileID=x}}class Mh{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){let u=++this.maxGroupID;this.collisionGroups[a]={ID:u,predicate:_=>_.collisionGroupID===u}}return this.collisionGroups[a]}}function vf(f,a,u,_,v){let{horizontalAlign:x,verticalAlign:S}=t.bQ(f),k=-(x-.5)*a,D=-(S-.5)*u,A=t.bP(f,_);return new t.P(k+A[0]*v,D+A[1]*v)}function kh(f,a,u,_,v){let x=new t.P(f,a);return u&&x._rotate(_?v:-v),x}class Qo{constructor(a,u,_,v,x,S){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new W_(this.transform,x),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Mh(_),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,u,_,v){let x=_.getBucket(u),S=_.latestFeatureIndex;if(!x||!S||u.fqid!==x.layerIds[0])return;let k=x.layers[0].layout,D=_.collisionBoxArray,A=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),L=_.tileSize/t.a3,B=_.tileID.toUnwrapped();this.transform.setProjection(x.projection);let U=(W=_.tileID,Y=x.getProjection(),Z=this.transform,Y.name===this.projection?Z.calculateProjMatrix(W.toUnwrapped()):Wu(Z,Y,W));var W,Y,Z;let X=k.get("text-pitch-alignment")==="map",Q=k.get("text-rotation-alignment")==="map";u.compileFilter();let re=u.dynamicFilter(),oe=u.dynamicFilterNeedsFeature(),ae=this.transform.calculatePixelsToTileUnitsMatrix(_),_e=kl(U,_.tileID.canonical,X,Q,this.transform,x.getProjection(),ae),ge=null;if(X){let le=Pc(U,_.tileID.canonical,X,Q,this.transform,x.getProjection(),ae);ge=t.ad.multiply([],this.transform.labelPlaneMatrix,le)}let ne=null;re&&_.latestFeatureIndex&&(ne={unwrappedTileID:B,dynamicFilter:re,dynamicFilterNeedsFeature:oe,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Sh(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,_.tileID);let se={bucket:x,layout:k,posMatrix:U,textLabelPlaneMatrix:_e,labelToScreenMatrix:ge,clippingData:ne,scale:A,textPixelRatio:L,holdingForFade:_.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:t.aD(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.aD(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(let le of x.sortKeyRanges){let{sortKey:we,symbolInstanceStart:Re,symbolInstanceEnd:me}=le;a.push({sortKey:we,symbolInstanceStart:Re,symbolInstanceEnd:me,parameters:se})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:se})}attemptAnchorPlacement(a,u,_,v,x,S,k,D,A,L,B,U,W,Y,Z,X,Q,re){let{textOffset0:oe,textOffset1:ae,crossTileID:_e}=U,ge=[oe,ae],ne=vf(a,_,v,ge,x),se=this.collisionIndex.placeCollisionBox(Y,x,u,kh(ne.x,ne.y,S,k,this.transform.angle),B,D,A,L.predicate);if(X){let le=Y.getSymbolInstanceIconSize(re,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,le,X,kh(ne.x,ne.y,S,k,this.transform.angle),B,D,A,L.predicate).box.length===0)return}if(se.box.length>0){let le;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e]&&this.prevPlacement.placements[_e]&&this.prevPlacement.placements[_e].text&&(le=this.prevPlacement.variableOffsets[_e].anchor),this.variableOffsets[_e]={textOffset:ge,width:_,height:v,anchor:a,textScale:x,prevAnchor:le},this.markUsedJustification(Y,a,U,Z),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,Z,U),this.placedOrientations[_e]=Z),{shift:ne,placedGlyphBoxes:se}}}placeLayerBucketPart(a,u,_,v){let{bucket:x,layout:S,posMatrix:k,textLabelPlaneMatrix:D,labelToScreenMatrix:A,clippingData:L,textPixelRatio:B,holdingForFade:U,collisionBoxArray:W,partiallyEvaluatedTextSize:Y,partiallyEvaluatedIconSize:Z,collisionGroup:X}=a.parameters,Q=S.get("text-optional"),re=S.get("icon-optional"),oe=S.get("text-allow-overlap"),ae=S.get("icon-allow-overlap"),_e=S.get("text-rotation-alignment")==="map",ge=S.get("text-pitch-alignment")==="map",ne=S.get("symbol-z-order")==="viewport-y",se=S.get("symbol-z-elevate");this.transform.setProjection(x.projection);let le=oe&&(ae||!x.hasIconData()||re),we=ae&&(oe||!x.hasTextData()||Q);!x.collisionArrays&&W&&x.deserializeCollisionBoxes(W),_&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,W);let Re=(me,Le,Be)=>{let{crossTileID:Qe,numVerticalGlyphVertices:Je}=me;if(L){let Ji={zoom:this.transform.zoom,pitch:this.transform.pitch},Si=null;if(L.dynamicFilterNeedsFeature){let ri=this.retainedQueryData[x.bucketInstanceId];Si=L.featureIndex.loadFeature({featureIndex:me.featureIndex,bucketIndex:ri.bucketIndex,sourceLayerIndex:ri.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Ji,Si,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new t.P(me.tileAnchorX,me.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Qe]=new Zu(!1,!1,!1,!0),void u.add(Qe)}if(u.has(Qe))return;if(U)return void(this.placements[Qe]=new Zu(!1,!1,!1));let Xe=!1,Ee=!1,Ve=!0,Ze=!1,bt=!1,vt=null,It={box:null,offscreen:null,occluded:null},xt={box:null,offscreen:null,occluded:null},it=null,$e=null,Dt=null,si=0,ti=0,xi=0;Be.textFeatureIndex?si=Be.textFeatureIndex:me.useRuntimeCollisionCircles&&(si=me.featureIndex),Be.verticalTextFeatureIndex&&(ti=Be.verticalTextFeatureIndex);let Pi=Ji=>{Ji.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let Si=this.transform.elevation;Ji.elevation=me.zOffset+(Si?Si.getAtTileOffset(Ji.tileID,Ji.tileAnchorX,Ji.tileAnchorY):0)},tn=Be.textBox;if(tn){Pi(tn);let Ji=ri=>{let vn=t.aE.horizontal;if(x.allowVerticalPlacement&&!ri&&this.prevPlacement){let kn=this.prevPlacement.placedOrientations[Qe];kn&&(this.placedOrientations[Qe]=kn,vn=kn,this.markUsedOrientation(x,vn,me))}return vn},Si=(ri,vn)=>{if(x.allowVerticalPlacement&&Je>0&&Be.verticalTextBox){for(let kn of x.writingModes)if(kn===t.aE.vertical?(It=vn(),xt=It):It=ri(),It&&It.box&&It.box.length)break}else It=ri()};if(S.get("text-variable-anchor")){let ri=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Qe]){let on=this.prevPlacement.variableOffsets[Qe];ri.indexOf(on.anchor)>0&&(ri=ri.filter(Ke=>Ke!==on.anchor),ri.unshift(on.anchor))}let vn=(on,Ke,St)=>{let zn=x.getSymbolInstanceTextSize(Y,me,this.transform.zoom,Le),$i=(on.x2-on.x1)*zn+2*on.padding,Pe=(on.y2-on.y1)*zn+2*on.padding,jo=me.hasIconTextFit&&!ae?Ke:null;jo&&Pi(jo);let Hr={box:[],offscreen:!1,occluded:!1},ao=oe?2*ri.length:ri.length;for(let Dr=0;Dr<ao;++Dr){let yo=this.attemptAnchorPlacement(ri[Dr%ri.length],on,$i,Pe,zn,_e,ge,B,k,X,Dr>=ri.length,me,Le,x,St,jo,Y,Z);if(yo&&(Hr=yo.placedGlyphBoxes,Hr&&Hr.box&&Hr.box.length)){Xe=!0,vt=yo.shift;break}}return Hr};Si(()=>vn(tn,Be.iconBox,t.aE.horizontal),()=>{let on=Be.verticalTextBox;return on&&Pi(on),x.allowVerticalPlacement&&!(It&&It.box&&It.box.length)&&Je>0&&on?vn(on,Be.verticalIconBox,t.aE.vertical):{box:null,offscreen:null,occluded:null}}),It&&(Xe=It.box,Ve=It.offscreen,Ze=It.occluded);let kn=Ji(!(!It||!It.box));if(!Xe&&this.prevPlacement){let on=this.prevPlacement.variableOffsets[Qe];on&&(this.variableOffsets[Qe]=on,this.markUsedJustification(x,on.anchor,me,kn))}}else{let ri=(vn,kn)=>{let on=x.getSymbolInstanceTextSize(Y,me,this.transform.zoom,Le),Ke=this.collisionIndex.placeCollisionBox(x,on,vn,new t.P(0,0),oe,B,k,X.predicate);return Ke&&Ke.box&&Ke.box.length&&(this.markUsedOrientation(x,kn,me),this.placedOrientations[Qe]=kn),Ke};Si(()=>ri(tn,t.aE.horizontal),()=>{let vn=Be.verticalTextBox;return x.allowVerticalPlacement&&Je>0&&vn?(Pi(vn),ri(vn,t.aE.vertical)):{box:null,offscreen:null,occluded:null}}),Ji(!!(It&&It.box&&It.box.length))}}if(it=It,Xe=it&&it.box&&it.box.length>0,Ve=it&&it.offscreen,Ze=it&&it.occluded,me.useRuntimeCollisionCircles){let Ji=x.text.placedSymbolArray.get(me.centerJustifiedTextSymbolIndex>=0?me.centerJustifiedTextSymbolIndex:me.verticalPlacedTextSymbolIndex),Si=t.aF(x.textSizeData,Y,Ji),ri=S.get("text-padding");$e=this.collisionIndex.placeCollisionCircles(x,oe,Ji,x.lineVertexArray,x.glyphOffsetArray,Si,k,D,A,_,ge,X.predicate,me.collisionCircleDiameter*Si/t.bN,ri,this.retainedQueryData[x.bucketInstanceId].tileID),Xe=oe||$e.circles.length>0&&!$e.collisionDetected,Ve=Ve&&$e.offscreen,Ze=$e.occluded}if(Be.iconFeatureIndex&&(xi=Be.iconFeatureIndex),Be.iconBox){let Ji=Si=>{Pi(Si);let ri=me.hasIconTextFit&&vt?kh(vt.x,vt.y,_e,ge,this.transform.angle):new t.P(0,0),vn=x.getSymbolInstanceIconSize(Z,this.transform.zoom,me.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,vn,Si,ri,ae,B,k,X.predicate)};xt&&xt.box&&xt.box.length&&Be.verticalIconBox?(Dt=Ji(Be.verticalIconBox),Ee=Dt.box.length>0):(Dt=Ji(Be.iconBox),Ee=Dt.box.length>0),Ve=Ve&&Dt.offscreen,bt=Dt.occluded}let Kt=Q||me.numHorizontalGlyphVertices===0&&Je===0,qi=re||me.numIconVertices===0;if(Kt||qi?qi?Kt||(Ee=Ee&&Xe):Xe=Ee&&Xe:Ee=Xe=Ee&&Xe,Xe&&it&&it.box&&this.collisionIndex.insertCollisionBox(it.box,S.get("text-ignore-placement"),x.bucketInstanceId,xt&&xt.box&&ti?ti:si,X.ID),Ee&&Dt&&this.collisionIndex.insertCollisionBox(Dt.box,S.get("icon-ignore-placement"),x.bucketInstanceId,xi,X.ID),$e&&(Xe&&this.collisionIndex.insertCollisionCircles($e.circles,S.get("text-ignore-placement"),x.bucketInstanceId,si,X.ID),_)){let Ji=x.bucketInstanceId,Si=this.collisionCircleArrays[Ji];Si===void 0&&(Si=this.collisionCircleArrays[Ji]=new H_);for(let ri=0;ri<$e.circles.length;ri+=4)Si.circles.push($e.circles[ri+0]),Si.circles.push($e.circles[ri+1]),Si.circles.push($e.circles[ri+2]),Si.circles.push($e.collisionDetected?1:0)}let pn=x.projection.name!=="globe";le=le&&(pn||!Ze),we=we&&(pn||!bt),this.placements[Qe]=new Zu(Xe||le,Ee||we,Ve||x.justReloaded),u.add(Qe)};if(se&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),ne){let me=x.getSortedSymbolIndexes(this.transform.angle);for(let Le=me.length-1;Le>=0;--Le){let Be=me[Le];Re(x.symbolInstances.get(Be),Be,x.collisionArrays[Be])}x.hasAnyZOffset&&t.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let me=x.getSortedIndexesByZOffset();for(let Le=0;Le<me.length;++Le){let Be=me[Le];Re(x.symbolInstances.get(Be),Be,x.collisionArrays[Be])}}else for(let me=a.symbolInstanceStart;me<a.symbolInstanceEnd;me++)Re(x.symbolInstances.get(me),me,x.collisionArrays[me]);if(_&&x.bucketInstanceId in this.collisionCircleArrays){let me=this.collisionCircleArrays[x.bucketInstanceId];t.ad.invert(me.invProjMatrix,k),me.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(a,u,_,v){let{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:D,crossTileID:A}=_,L=t.cJ(u),B=v===t.aE.vertical?D:L==="left"?x:L==="center"?S:L==="right"?k:-1;x>=0&&(a.text.placedSymbolArray.get(x).crossTileID=B>=0&&x!==B?0:A),S>=0&&(a.text.placedSymbolArray.get(S).crossTileID=B>=0&&S!==B?0:A),k>=0&&(a.text.placedSymbolArray.get(k).crossTileID=B>=0&&k!==B?0:A),D>=0&&(a.text.placedSymbolArray.get(D).crossTileID=B>=0&&D!==B?0:A)}markUsedOrientation(a,u,_){let v=u===t.aE.horizontal||u===t.aE.horizontalOnly?u:0,x=u===t.aE.vertical?u:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:A}=_,L=a.text.placedSymbolArray;S>=0&&(L.get(S).placedOrientation=v),k>=0&&(L.get(k).placedOrientation=v),D>=0&&(L.get(D).placedOrientation=v),A>=0&&(L.get(A).placedOrientation=x)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;let u=this.prevPlacement,_=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;let v=u?u.symbolFadeChange(a):1,x=u?u.opacities:{},S=u?u.variableOffsets:{},k=u?u.placedOrientations:{};for(let D in this.placements){let A=this.placements[D],L=x[D];L?(this.opacities[D]=new Ys(L,v,A.text,A.icon,null,A.clipped),_=_||A.text!==L.text.placed||A.icon!==L.icon.placed):(this.opacities[D]=new Ys(null,v,A.text,A.icon,A.skipFade,A.clipped),_=_||A.text||A.icon)}for(let D in x){let A=x[D];if(!this.opacities[D]){let L=new Ys(A,v,!1,!1);L.isHidden()||(this.opacities[D]=L,_=_||A.text.placed||A.icon.placed)}}for(let D in S)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=S[D]);for(let D in k)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=k[D]);_?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:a)}updateLayerOpacities(a,u,_,v){let x=new Set;for(let S of u){let k=S.getBucket(a);k&&S.latestFeatureIndex&&a.fqid===k.layerIds[0]&&(this.updateBucketOpacities(k,x,S.collisionBoxArray,_,v,S.tileID),k.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(k,S.tileID),k.updateZOffset()))}}updateBucketOpacities(a,u,_,v,x,S){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();let k=a.layers[0].layout,D=!!a.layers[0].dynamicFilter(),A=new Ys(null,0,!1,!1,!0),L=k.get("text-allow-overlap"),B=k.get("icon-allow-overlap"),U=k.get("text-variable-anchor"),W=k.get("text-rotation-alignment")==="map",Y=k.get("text-pitch-alignment")==="map",Z=new Ys(null,0,L&&(B||!a.hasIconData()||k.get("icon-optional")),B&&(L||!a.hasTextData()||k.get("text-optional")),!0);!a.collisionArrays&&_&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(_);let X=(re,oe,ae)=>{for(let _e=0;_e<oe/4;_e++)re.opacityVertexArray.emplaceBack(ae)},Q=0;x&&a.updateReplacement(S,x);for(let re=0;re<a.symbolInstances.length;re++){let oe=a.symbolInstances.get(re),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:_e,crossTileID:ge,numIconVertices:ne,tileAnchorX:se,tileAnchorY:le}=oe,we=u.has(ge),Re=this.opacities[ge];we?Re=A:Re||(Re=Z,this.opacities[ge]=Re),u.add(ge);let me=ae>0||_e>0,Le=ne>0,Be=this.placedOrientations[ge],Qe=Be===t.aE.vertical,Je=Be===t.aE.horizontal||Be===t.aE.horizontalOnly;!me&&!Le||Re.isHidden()||Q++;let Xe=!1;if((me||Le)&&x)for(let Ee of a.activeReplacements){if(Ee.order<v||Ee.order===1/0||!(Ee.clipMask&t.cu.Symbol)||Ee.min.x>se||se>Ee.max.x||Ee.min.y>le||le>Ee.max.y)continue;let Ve=t.cH(se,le,S.canonical,Ee.footprintTileId.canonical);if(Xe=t.cI(Ve,Ee),Xe)break}if(me){let Ee=Xe?Zs:Ha(Re.text);X(a.text,ae,Qe?Zs:Ee),X(a.text,_e,Je?Zs:Ee);let Ve=Re.text.isHidden(),{leftJustifiedTextSymbolIndex:Ze,centerJustifiedTextSymbolIndex:bt,rightJustifiedTextSymbolIndex:vt,verticalPlacedTextSymbolIndex:It}=oe,xt=a.text.placedSymbolArray,it=Ve||Qe?1:0;Ze>=0&&(xt.get(Ze).hidden=it),bt>=0&&(xt.get(bt).hidden=it),vt>=0&&(xt.get(vt).hidden=it),It>=0&&(xt.get(It).hidden=Ve||Je?1:0);let $e=this.variableOffsets[ge];$e&&this.markUsedJustification(a,$e.anchor,oe,Be);let Dt=this.placedOrientations[ge];Dt&&(this.markUsedJustification(a,"left",oe,Dt),this.markUsedOrientation(a,Dt,oe))}if(Le){let Ee=Xe?Zs:Ha(Re.icon),{placedIconSymbolIndex:Ve,verticalPlacedIconSymbolIndex:Ze}=oe,bt=a.icon.placedSymbolArray,vt=Re.icon.isHidden()?1:0;Ve>=0&&(X(a.icon,ne,Qe?Zs:Ee),bt.get(Ve).hidden=vt),Ze>=0&&(X(a.icon,oe.numVerticalIconVertices,Je?Zs:Ee),bt.get(Ze).hidden=vt)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){let Ee=a.collisionArrays[re];if(Ee){let Ve=new t.P(0,0),Ze=!0;if(Ee.textBox||Ee.verticalTextBox){if(U){let vt=this.variableOffsets[ge];vt?(Ve=vf(vt.anchor,vt.width,vt.height,vt.textOffset,vt.textScale),W&&Ve._rotate(Y?this.transform.angle:-this.transform.angle)):Ze=!1}D&&(Ze=!Re.clipped),Ee.textBox&&Ih(a.textCollisionBox.collisionVertexArray,Re.text.placed,!Ze||Qe,Ve.x,Ve.y),Ee.verticalTextBox&&Ih(a.textCollisionBox.collisionVertexArray,Re.text.placed,!Ze||Je,Ve.x,Ve.y)}let bt=Ze&&!!(!Je&&Ee.verticalIconBox);Ee.iconBox&&Ih(a.iconCollisionBox.collisionVertexArray,Re.icon.placed,bt,oe.hasIconTextFit?Ve.x:0,oe.hasIconTextFit?Ve.y:0),Ee.verticalIconBox&&Ih(a.iconCollisionBox.collisionVertexArray,Re.icon.placed,!bt,oe.hasIconTextFit?Ve.x:0,oe.hasIconTextFit?Ve.y:0)}}}if(a.fullyClipped=Q===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){let re=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=re.invProjMatrix,a.placementViewportMatrix=re.viewportMatrix,a.collisionCircleArray=re.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,u){let _=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function Ih(f,a,u,_,v){f.emplaceBack(a?1:0,u?1:0,_||0,v||0),f.emplaceBack(a?1:0,u?1:0,_||0,v||0),f.emplaceBack(a?1:0,u?1:0,_||0,v||0),f.emplaceBack(a?1:0,u?1:0,_||0,v||0)}let xf=Math.pow(2,25),pt=Math.pow(2,24),G_=Math.pow(2,17),wf=Math.pow(2,16),Cf=Math.pow(2,9),q_=Math.pow(2,8),Xu=Math.pow(2,1);function Ha(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let a=f.placed?1:0,u=Math.floor(127*f.opacity);return u*xf+a*pt+u*G_+a*wf+u*Cf+a*q_+u*Xu+a}let Zs=0;class Rl{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,u,_,v,x){let S=this._bucketParts;for(;this._currentTileIndex<a.length;)if(u.getBucketParts(S,v,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((k,D)=>k.sortKey-D.sortKey));this._currentPartIndex<S.length;){let k=S[this._currentPartIndex];if(u.placeLayerBucketPart(k,this._seenCrossTileIDs,_,k.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Qu{constructor(a,u,_,v,x,S,k,D,A){this.placement=new Qo(a,x,S,k,D,A),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(a,u,_,v){let x=t.e.now(),S=()=>{let k=t.e.now()-x;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){let k=u[a[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=D)&&(!k.maxzoom||k.maxzoom>D)){let A=k,L=A.layout.get("symbol-z-elevate"),B=this._inProgressLayer=this._inProgressLayer||new Rl(A),U=t.al(k.source,k.scope);if(B.continuePlacement(L?v[U]:_[U],this.placement,this._showCollisionBoxes,k,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}let Xs=512/t.a3/2;class sx{constructor(a,u,_){this.tileID=a,this.bucketInstanceId=_,this.index=new t.cK(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let v=a.canonical.x*t.a3,x=a.canonical.y*t.a3;for(let S=0;S<u.length;S++){let{key:k,crossTileID:D,tileAnchorX:A,tileAnchorY:L}=u.get(S),B=Math.floor((v+A)*Xs),U=Math.floor((x+L)*Xs);this.index.add(B,U),this.keys.push(k),this.crossTileIDs.push(D)}this.index.finish()}findMatches(a,u,_){let v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),x=Xs/Math.pow(2,u.canonical.z-this.tileID.canonical.z),S=u.canonical.x*t.a3,k=u.canonical.y*t.a3;for(let D=0;D<a.length;D++){let A=a.get(D);if(A.crossTileID)continue;let{key:L,tileAnchorX:B,tileAnchorY:U}=A,W=Math.floor((S+B)*x),Y=Math.floor((k+U)*x),Z=this.index.range(W-v,Y-v,W+v,Y+v);for(let X of Z){let Q=this.crossTileIDs[X];if(this.keys[X]===L&&!_.has(Q)){_.add(Q),A.crossTileID=Q;break}}}}}class lx{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Sf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){let u=Math.round((a-this.lng)/360);if(u!==0)for(let _ in this.indexes){let v=this.indexes[_],x={};for(let S in v){let k=v[S];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+u),x[k.tileID.key]=k}this.indexes[_]=x}this.lng=a}addBucket(a,u,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let x=0;x<u.symbolInstances.length;x++)u.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);let v=this.usedCrossTileIDs[a.overscaledZ];for(let x in this.indexes){let S=this.indexes[x];if(Number(x)>a.overscaledZ)for(let k in S){let D=S[k];D.tileID.isChildOf(a)&&D.findMatches(u.symbolInstances,a,v)}else{let k=S[a.scaledTo(Number(x)).key];k&&k.findMatches(u.symbolInstances,a,v)}}for(let x=0;x<u.symbolInstances.length;x++){let S=u.symbolInstances.get(x);S.crossTileID||(S.crossTileID=_.generate(),v.add(S.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new sx(a,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(a,u){for(let _ of u.crossTileIDs)this.usedCrossTileIDs[a].delete(_)}removeStaleBuckets(a){let u=!1;for(let _ in this.indexes){let v=this.indexes[_];for(let x in v)a[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,v[x]),delete v[x],u=!0)}return u}}class cx{constructor(){this.layerIndexes={},this.crossTileIDs=new lx,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,u,_,v){let x=this.layerIndexes[a.fqid];x===void 0&&(x=this.layerIndexes[a.fqid]=new Sf);let S=!1,k={};v.name!=="globe"&&x.handleWrapJump(_);for(let D of u){let A=D.getBucket(a);A&&a.fqid===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(D.tileID,A,this.crossTileIDs)&&(S=!0),k[A.bucketInstanceId]=!0)}return x.removeStaleBuckets(k)&&(S=!0),S}pruneUnusedLayers(a){let u={};a.forEach(_=>{u[_]=!0});for(let _ in this.layerIndexes)u[_]||delete this.layerIndexes[_]}}let $_=new t.N({data:new t.O(t.L.colorTheme.data)}),Qs=(f,a)=>oi(f,a&&a.filter(u=>u.identifier!=="source.canvas")),Mf=t.ah(Li,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),dx=t.ah(Li,["setCenter","setZoom","setBearing","setPitch"]),Y_={version:8,layers:[],sources:{}},Z_={duration:300,delay:0};class Sa extends t.E{constructor(a,u={}){super(),this.map=a,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=t.W({},Z_),this._buildingIndex=new rx(this),this.crossTileSymbolIndex=new cx,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new Wt,this.dispatcher=u.dispatcher?u.dispatcher:new t.bw(t.bx(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new Qd,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new t.cM(a._requestManager,u.localFontFamily?t.cN.all:u.localIdeographFontFamily?t.cN.ideographs:t.cN.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new Cu(a._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",t.cO());let _=this;this._rtlTextPluginCallback=Sa.registerForPluginStateChange(v=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,S)=>{if(t.cP(x),S&&S.every(k=>k))for(let k in _._sourceCaches){let D=_._sourceCaches[k],A=D.getSource().type;A!=="vector"&&A!=="geojson"||D.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(let S in this._layers){let k=this._layers[S];k.source===x.id&&this._validateLayer(k)}})}load(a){return a?(typeof a=="string"?this.loadURL(a):this.loadJSON(a),this):this}_getGlobalId(a){if(!a)return null;if(typeof a=="string"){if(t.cQ(a))return a;let u=t.cR(a);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${t.cS(JSON.stringify(a))}`}_diffStyle(a,u,_){this.globalId=this._getGlobalId(a);let v=(x,S)=>{try{S(null,this.setState(x,_))}catch(k){S(k,!1)}};if(typeof a=="string"){let x=this.map._requestManager.normalizeStyleURL(a),S=this.map._requestManager.transformRequest(x,t.R.Style);t.g(S,(k,D)=>{k?this.fire(new t.d(k)):D&&v(D,u)})}else typeof a=="object"&&v(a,u)}loadURL(a,u={}){this.fire(new t.f("dataloading",{dataType:"style"}));let _=typeof u.validate=="boolean"?u.validate:!t.cQ(a);this.globalId=this._getGlobalId(a),a=this.map._requestManager.normalizeStyleURL(a,u.accessToken),this.resolvedImports.add(a);let v=this.importsCache.get(a);if(v)return this._load(v,_);let x=this.map._requestManager.transformRequest(a,t.R.Style);this._request=t.g(x,(S,k)=>{if(this._request=null,S)this.fire(new t.d(S));else if(k)return this.importsCache.set(a,k),this._load(k,_)})}loadJSON(a,u={}){this.fire(new t.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(a),this._request=t.e.frame(()=>{this._request=null,this._load(a,u.validate!==!1)})}loadEmpty(){this.fire(new t.f("dataloading",{dataType:"style"})),this._load(Y_,!1)}_loadImports(a,u,_){if(this.importDepth>=4)return t.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let v=[];for(let x of a){let S=this._createFragmentStyle(x),k=new Promise(L=>{S.once("style.import.load",L),S.once("error",L)}).then(()=>this.mergeAll());if(v.push(k),this.resolvedImports.has(x.url)){S.loadEmpty();continue}let D=x.data||this.importsCache.get(x.url);D?(S.loadJSON(D,{validate:u}),this._isInternalStyle(D)&&(S.globalId=null)):x.url?S.loadURL(x.url,{validate:u}):S.loadEmpty();let A={style:S,id:x.id,config:x.config};if(_){let L=this.fragments.findIndex(({id:B})=>B===_);this.fragments=this.fragments.slice(0,L).concat(A).concat(this.fragments.slice(L))}else this.fragments.push(A)}return Promise.allSettled(v)}getImportGlobalIds(a=this,u=new Set){for(let _ of a.fragments)_.style.globalId&&u.add(_.style.globalId),this.getImportGlobalIds(_.style,u);return[...u.values()]}_createFragmentStyle(a){let u=this.scope?t.al(a.id,this.scope):a.id,_,v=this._initialConfig&&this._initialConfig[u];(a.config||v)&&(_=t.W({},a.config,v));let x=new Sa(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(a){return this.isRootStyle()&&(a.fragment||!!a.schema&&a.fragment!==!1)}_load(a,u){let _=a.schema;if(this._isInternalStyle(a)){let S=t.W({},Y_,{imports:[{id:"basemap",data:a,url:""}]});return void this._load(S,u)}if(this.updateConfig(this._config,_),u&&Qs(this,be(a)))return;this._loaded=!0,this.stylesheet=t.cT(a);let v=()=>{for(let A in a.sources)this.addSource(A,a.sources[A],{validate:!1,isInitialLoad:!0});a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(a.glyphs,this.scope);let S=bf(this.stylesheet.layers);if(this._order=S.map(A=>A.id),this.stylesheet.light&&t.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let A=this.stylesheet.lights[0];this.light=new At(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new At(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let A of S){let L=t.cY(A,this.scope,this._styleColorTheme.lut,this.options);L.isConfigDependent&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L,this._serializedLayers[L.id]=L.serialize();let B=this.getOwnLayerSourceCache(L),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&L.canCastShadows()&&U&&(B.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new t.f("data",{dataType:"style"}));let D=this.isRootStyle();a.imports?this._loadImports(a.imports,u).then(()=>{this._reloadImports(),this.fire(new t.f(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new t.f(D?"style.load":"style.import.load")))},x=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=x,x){let S=this._evaluateColorThemeData(x);this._loadColorTheme(S).then(()=>{v()}).catch(k=>{t.w(`Couldn't load color theme from the stylesheet: ${k}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let a,u,_,v,x,S,k,D,A={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(L=>{if(L.stylesheet){if(L.light!=null&&(a=L.light),L.stylesheet.lights)for(let B of L.stylesheet.lights)B.type==="ambient"&&L.ambientLight!=null&&(u=L.ambientLight),B.type==="directional"&&L.directionalLight!=null&&(_=L.directionalLight);v=this._prioritizeTerrain(v,L.terrain,L.stylesheet.terrain),L.stylesheet.fog&&L.fog!=null&&(x=L.fog),L.stylesheet.camera!=null&&(D=L.stylesheet.camera),L.stylesheet.projection!=null&&(S=L.stylesheet.projection),L.stylesheet.transition!=null&&(k=L.stylesheet.transition),A[L.scope]=L._styleColorTheme}}),this.light=a,this.ambientLight=u,this.directionalLight=_,this.fog=x,this._styleColorThemeForScope=A,v===null?delete this.terrain:this.terrain=v,this.camera=D||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=t.W({},Z_,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(a){let u=_=>{for(let v of _.fragments)u(v.style);a(_)};u(this)}_prioritizeTerrain(a,u,_){let v=a&&a.drapeRenderMode===0;return _===null?u&&u.drapeRenderMode===0?u:v?a:null:u!=null&&(!a||v||u&&u.drapeRenderMode===1)?u:a}mergeTerrain(){let a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{a=this._prioritizeTerrain(a,u.terrain,u.stylesheet.terrain)}),a===null?delete this.terrain:this.terrain=a}mergeProjection(){let a;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(a=u.stylesheet.projection)}),this.projection=a||{name:"mercator"}}mergeSources(){let a={},u={},_={};this.forEachFragmentStyle(v=>{for(let x in v._sourceCaches){let S=t.al(x,v.scope);a[S]=v._sourceCaches[x]}for(let x in v._otherSourceCaches){let S=t.al(x,v.scope);u[S]=v._otherSourceCaches[x]}for(let x in v._symbolSourceCaches){let S=t.al(x,v.scope);_[S]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=a,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=_}mergeLayers(){let a={},u=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(let k of S._order){let D=S._layers[k];if(D.type==="slot"){let A=t.cU(k);if(a[A])continue;a[A]=[]}D.slot&&a[D.slot]?a[D.slot].push(D):u.push(D)}}),this._mergedOrder=[],this._clipLayerIndices=[];let v=0,x=(S=[])=>{for(let k of S)if(k.type==="slot"){let D=t.cU(k.id);a[D]&&x(a[D]),this._mergedSlots.push(D)}else{let D=t.al(k.id,k.scope);this._mergedOrder.push(D),_[D]=k,k.is3D()&&(this._has3DLayers=!0),k.type==="circle"&&(this._hasCircleLayers=!0),k.type==="symbol"&&(this._hasSymbolLayers=!0),k.type==="clip"&&this._clipLayerIndices.push(v),v++}};x(u),this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(a){return this.stylesheet.camera=t.W({},this.stylesheet.camera,a),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(a){return a.data?function(u,_,v){let x=t.W({},_);for(let k of Object.keys(t.L.colorTheme))x[k]===void 0&&(x[k]=t.L.colorTheme[k].default);let S=new t.U($_,u,new Map(v));return S.setTransitionOrValue(x,v),S.untransitioned().possiblyEvaluate(new t.X(0))}(this.scope,a,this.options).get("data"):null}_loadColorTheme(a){return this._styleColorTheme.lutLoading=!0,new Promise((u,_)=>{let v="data:image/png;base64,";if(a.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();a.startsWith(v)||(a=v+a);let x="mapbox-reserved-lut",S=new Image;S.src=a,S.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},S.onload=()=>{this._styleColorTheme.lutLoading=!1;let{width:k,height:D,data:A}=t.e.getImageData(S);if(D>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(k!==D*D)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(x)&&this.removeImage(x),this.addImage(x,{data:new t.i({width:k,height:D},A),pixelRatio:1,sdf:!1,version:0});let L=this.imageManager.getImage(x,this.scope);L?(this._styleColorTheme.lut={image:L.data,data:a},u()):_(new Error("Missing LUT image."))}})}getLut(a){let u=this._styleColorThemeForScope[a];return u?u.lut:null}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(a){this._spriteRequest=function(u,_,v){let x,S,k,D=t.e.devicePixelRatio>1?"@2x":"",A=t.g(_.transformRequest(_.normalizeSpriteURL(u,D,".json"),t.R.SpriteJSON),(U,W)=>{A=null,k||(k=U,x=W,B())}),L=t.h(_.transformRequest(_.normalizeSpriteURL(u,D,".png"),t.R.SpriteImage),(U,W)=>{L=null,k||(k=U,S=W,B())});function B(){if(k)v(k);else if(x&&S){let U=t.e.getImageData(S),W={};for(let Y in x){let{width:Z,height:X,x:Q,y:re,sdf:oe,pixelRatio:ae,stretchX:_e,stretchY:ge,content:ne}=x[Y],se=new t.i({width:Z,height:X});t.i.copy(U,se,{x:Q,y:re},{x:0,y:0},{width:Z,height:X},null),W[Y]={data:se,pixelRatio:ae,sdf:oe,stretchX:_e,stretchY:ge,content:ne}}v(null,W)}}return{cancel(){A&&(A.cancel(),A=null),L&&(L.cancel(),L=null)}}}(a,this.map._requestManager,(u,_)=>{if(this._spriteRequest=null,u)this.fire(new t.d(u));else if(_)for(let v in _)this.imageManager.addImage(v,this.scope,_[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.f("data",{dataType:"style"}))})}_validateLayer(a){let u=this.getOwnSource(a.source);if(!u)return;let _=a.sourceLayer;_&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(_)===-1)&&this.fire(new t.d(new Error(`Source layer "${_}" does not exist on source "${u.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:a}of this.fragments)if(!a.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((a,u)=>{let _=this.fragments[u];return _&&_.style&&(a.data=_.style.serialize()),a})}_serializeSources(){let a={};for(let u in this._sourceCaches){let _=this._sourceCaches[u].getSource();a[_.id]||(a[_.id]=_.serialize())}return a}_serializeLayers(a){let u=[];for(let _ of a){let v=this._layers[_];v&&v.type!=="custom"&&u.push(v.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(let a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(a){return!!this.terrain&&a.isDraped(this.getLayerSourceCache(a))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(a){let u=this.getOwnLayer(a);if(u)return u;this.fire(new t.d(new Error(`The layer '${a}' does not exist in the map's style.`)))}_checkSource(a){let u=this.getOwnSource(a);if(u)return u;this.fire(new t.d(new Error(`The source '${a}' does not exist in the map's style.`)))}update(a){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(a),this.directionalLight&&this.directionalLight.recalculate(a);let u=this.calculateLightsBrightness();a.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u));let _=this._changes.isDirty(),v=!1;if(this._changes.isDirty()){let S=this._changes.getLayerUpdatesByScope();for(let k in S){let{updatedIds:D,removedIds:A}=S[k];(D||A)&&(this._updateWorkerLayers(k,D,A),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(a),this.light&&this.light.updateTransitions(a),this.ambientLight&&this.ambientLight.updateTransitions(a),this.directionalLight&&this.directionalLight.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._changes.reset()}let x={};for(let S in this._mergedSourceCaches){let k=this._mergedSourceCaches[S];x[S]=k.used,k.used=!1,k.tileCoverLift=0}for(let S of this._mergedOrder){let k=this._mergedLayers[S];if(k.recalculate(a,this._availableImages),!k.isHidden(a.zoom)){let D=this.getLayerSourceCache(k);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,k.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let D=k.minzoom||0;D<(k.maxzoom||25.5);D++){let A=this.map.painter;if(A){let L=k.getProgramIds();if(!L)continue;for(let B of L){let U=k.getDefaultProgramParams(B,a.zoom,this._styleColorTheme.lut);U&&(A.style=this,this.fog&&(A._fogVisible=!0,U.overrideFog=!0,A.getOrCreateProgram(B,U)),A._fogVisible=!1,U.overrideFog=!1,A.getOrCreateProgram(B,U),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(U.overrideRtt=!0,A.getOrCreateProgram(B,U)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(let S in x){let k=this._mergedSourceCaches[S];x[S]!==k.used&&k.getSource().fire(new t.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light&&this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),_&&this.fire(new t.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let a=this._changes.getUpdatedImages();if(a.length){for(let u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],a);this._changes.resetUpdatedImages()}}_updateWorkerLayers(a,u,_){let v=this.getFragmentStyle(a);v&&this.dispatcher.broadcast("updateLayers",{layers:u?v._serializeLayers(u):[],scope:a,removedIds:_||[],options:v.options})}setState(a,u){if(this._checkLoaded(),Qs(this,be(a)))return!1;(a=t.cT(a)).layers=bf(a.layers);let _=function(S,k){if(!S)return[{command:Li.setStyle,args:[k]}];let D=[];try{if(!g(S.version,k.version))return[{command:Li.setStyle,args:[k]}];if(g(S.center,k.center)||D.push({command:Li.setCenter,args:[k.center]}),g(S.zoom,k.zoom)||D.push({command:Li.setZoom,args:[k.zoom]}),g(S.bearing,k.bearing)||D.push({command:Li.setBearing,args:[k.bearing]}),g(S.pitch,k.pitch)||D.push({command:Li.setPitch,args:[k.pitch]}),g(S.sprite,k.sprite)||D.push({command:Li.setSprite,args:[k.sprite]}),g(S.glyphs,k.glyphs)||D.push({command:Li.setGlyphs,args:[k.glyphs]}),g(S.imports,k.imports)||function(W=[],Y=[],Z){Y=Y||[];let X=(W=W||[]).map(Yu),Q=Y.map(Yu),re=W.reduce(Yc,{}),oe=Y.reduce(Yc,{}),ae=X.slice(),_e,ge,ne,se;for(_e=0,ge=0;_e<X.length;_e++)ne=X[_e],oe.hasOwnProperty(ne)?ge++:(Z.push({command:Li.removeImport,args:[ne]}),ae.splice(ae.indexOf(ne,ge),1));for(_e=0,ge=0;_e<Q.length;_e++)ne=Q[Q.length-1-_e],ae[ae.length-1-_e]!==ne&&(re.hasOwnProperty(ne)?(Z.push({command:Li.removeImport,args:[ne]}),ae.splice(ae.lastIndexOf(ne,ae.length-ge),1)):ge++,se=ae[ae.length-_e],Z.push({command:Li.addImport,args:[oe[ne],se]}),ae.splice(ae.length-_e,0,ne));for(let le of Y){let we=re[le.id];we&&!g(we,le)&&Z.push({command:Li.updateImport,args:[le.id,le]})}}(S.imports,k.imports,D),g(S.transition,k.transition)||D.push({command:Li.setTransition,args:[k.transition]}),g(S.light,k.light)||D.push({command:Li.setLight,args:[k.light]}),g(S.fog,k.fog)||D.push({command:Li.setFog,args:[k.fog]}),g(S.projection,k.projection)||D.push({command:Li.setProjection,args:[k.projection]}),g(S.lights,k.lights)||D.push({command:Li.setLights,args:[k.lights]}),g(S.camera,k.camera)||D.push({command:Li.setCamera,args:[k.camera]}),!g(S["color-theme"],k["color-theme"]))return[{command:Li.setStyle,args:[k]}];let A={},L=[];(function(W,Y,Z,X){let Q;for(Q in Y=Y||{},W=W||{})W.hasOwnProperty(Q)&&(Y.hasOwnProperty(Q)||j_(Q,Z,X));for(Q in Y){if(!Y.hasOwnProperty(Q))continue;let re=Y[Q];W.hasOwnProperty(Q)?g(W[Q],re)||(W[Q].type==="geojson"&&re.type==="geojson"&&ax(W,Y,Q)?Z.push({command:Li.setGeoJSONSourceData,args:[Q,re.data]}):ox(Q,Y,Z,X)):ms(Q,Y,Z)}})(S.sources,k.sources,L,A);let B=[];S.layers&&S.layers.forEach(W=>{W.source&&A[W.source]?D.push({command:Li.removeLayer,args:[W.id]}):B.push(W)});let U=S.terrain;U&&A[U.source]&&(D.push({command:Li.setTerrain,args:[void 0]}),U=void 0),D=D.concat(L),g(U,k.terrain)||D.push({command:Li.setTerrain,args:[k.terrain]}),function(W,Y,Z){Y=Y||[];let X=(W=W||[]).map(Yu),Q=Y.map(Yu),re=W.reduce(Yc,{}),oe=Y.reduce(Yc,{}),ae=X.slice(),_e=Object.create(null),ge,ne,se,le,we,Re,me;for(ge=0,ne=0;ge<X.length;ge++)se=X[ge],oe.hasOwnProperty(se)?ne++:(Z.push({command:Li.removeLayer,args:[se]}),ae.splice(ae.indexOf(se,ne),1));for(ge=0,ne=0;ge<Q.length;ge++)se=Q[Q.length-1-ge],ae[ae.length-1-ge]!==se&&(re.hasOwnProperty(se)?(Z.push({command:Li.removeLayer,args:[se]}),ae.splice(ae.lastIndexOf(se,ae.length-ne),1)):ne++,Re=ae[ae.length-ge],Z.push({command:Li.addLayer,args:[oe[se],Re]}),ae.splice(ae.length-ge,0,se),_e[se]=!0);for(ge=0;ge<Q.length;ge++)if(se=Q[ge],le=re[se],we=oe[se],!_e[se]&&!g(le,we))if(g(le.source,we.source)&&g(le["source-layer"],we["source-layer"])&&g(le.type,we.type)){for(me in Ch(le.layout,we.layout,Z,se,null,Li.setLayoutProperty),Ch(le.paint,we.paint,Z,se,null,Li.setPaintProperty),g(le.slot,we.slot)||Z.push({command:Li.setSlot,args:[se,we.slot]}),g(le.filter,we.filter)||Z.push({command:Li.setFilter,args:[se,we.filter]}),g(le.minzoom,we.minzoom)&&g(le.maxzoom,we.maxzoom)||Z.push({command:Li.setLayerZoomRange,args:[se,we.minzoom,we.maxzoom]}),le)le.hasOwnProperty(me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&me!=="slot"&&(me.indexOf("paint.")===0?Ch(le[me],we[me],Z,se,me.slice(6),Li.setPaintProperty):g(le[me],we[me])||Z.push({command:Li.setLayerProperty,args:[se,me,we[me]]}));for(me in we)we.hasOwnProperty(me)&&!le.hasOwnProperty(me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&me!=="slot"&&(me.indexOf("paint.")===0?Ch(le[me],we[me],Z,se,me.slice(6),Li.setPaintProperty):g(le[me],we[me])||Z.push({command:Li.setLayerProperty,args:[se,me,we[me]]}))}else Z.push({command:Li.removeLayer,args:[se]}),Re=ae[ae.lastIndexOf(se)+1],Z.push({command:Li.addLayer,args:[we,Re]})}(B,k.layers,D)}catch(A){console.warn("Unable to compute style diff:",A),D=[{command:Li.setStyle,args:[k]}]}return D}(this.serialize(),a).filter(S=>!(S.command in dx));if(_.length===0)return!1;let v=_.filter(S=>!(S.command in Mf));if(v.length>0)throw new Error(`Unimplemented: ${v.map(S=>S.command).join(", ")}.`);let x=[];return _.forEach(S=>{x.push(this[S.command].apply(this,S.args))}),u&&Promise.all(x).then(u),this.stylesheet=a,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(a,u){return this.getImage(a)?this.fire(new t.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,this.scope,u),this._afterImageUpdated(a),this)}updateImage(a,u){this.imageManager.updateImage(a,this.scope,u)}getImage(a){return this.imageManager.getImage(a,this.scope)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a,this.scope),this._afterImageUpdated(a),this):this.fire(new t.d(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(a),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new t.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(a,u,_={}){return this._checkLoaded(),this._validate(fi,`models.${a}`,u,null,_)||(this.modelManager.addModel(a,u,this.scope),this._changes.setDirty()),this}hasModel(a){return this.modelManager.hasModel(a,this.scope)}removeModel(a){return this.hasModel(a)?(this.modelManager.removeModel(a,this.scope),this):this.fire(new t.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(a,u,_={}){if(this._checkLoaded(),this.getOwnSource(a)!==void 0)throw new Error(`There is already a source with ID "${a}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(ye,`sources.${a}`,u,null,_))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);let v=Fu(a,u,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));let x=S=>{let k=(S?"symbol:":"other:")+v.id,D=t.al(k,this.scope),A=this._sourceCaches[k]=new t.bv(D,v,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=A,A.onAdd(this.map)};x(!1),u.type!=="vector"&&u.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(a){this._checkLoaded();let u=this.getOwnSource(a);if(!u)throw new Error("There is no source with this ID");for(let v in this._layers)if(this._layers[v].source===a)return this.fire(new t.d(new Error(`Source "${a}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===a)return this.fire(new t.d(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));let _=this.getOwnSourceCaches(a);for(let v of _){let x=t.cU(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new t.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(a,u){this._checkLoaded(),this.getOwnSource(a).setData(u),this._changes.setDirty()}getOwnSource(a){let u=this.getOwnSourceCache(a);return u&&u.getSource()}getOwnSources(){let a=[];for(let u in this._otherSourceCaches){let _=this.getOwnSourceCache(u);_&&a.push(_.getSource())}return a}areTilesLoaded(){let a=this._mergedSourceCaches;for(let u in a){let _=a[u]._tiles;for(let v in _){let x=_[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(a){if(this._checkLoaded(),!a)return delete this.ambientLight,void delete this.directionalLight;let u=this._getTransitionParameters();for(let v of a){if(this._validate(Ne,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(v),x.updateTransitions(u)}else this.ambientLight=new eh(v,hi,this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(v),x.updateTransitions(u)}else this.directionalLight=new eh(v,Pp,this.scope,this.options)}}let _=new t.X(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let a=this.directionalLight,u=this.ambientLight;if(!a||!u)return;let _=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),v=a.properties.get("color").toRenderColor(null).toArray01(),x=a.properties.get("intensity"),S=a.properties.get("direction"),k=1-t.ac(S.x,S.y,S.z)[2]/90,D=_(v)*x*k,A=u.properties.get("color").toRenderColor(null).toArray01(),L=u.properties.get("intensity");return(D+_(A)*L)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let a=[];return this.directionalLight&&a.push(this.directionalLight.get()),this.ambientLight&&a.push(this.ambientLight.get()),a}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(a){if(!a)return this;if(t.cV(a)){let u=t.cW(a),_=this.fragments.find(({id:x})=>x===u);if(!_)throw new Error(`Style import not found: ${a}`);let v=t.cU(a);return _.style.getFragmentStyle(v)}{let u=this.fragments.find(({id:_})=>_===a);if(!u)throw new Error(`Style import not found: ${a}`);return u.style}}getConfigProperty(a,u){let _=this.getFragmentStyle(a);if(!_)return null;let v=t.al(u,_.scope),x=_.options.get(v),S=x?x.value||x.default:null;return S?S.serialize():null}setConfigProperty(a,u,_){let v=this.getFragmentStyle(a);if(!v)return;let x=v.stylesheet.schema;if(!x||!x[u])return;let S=t.y(_);if(S.result!=="success")return void Qs(this,S.value);let k=S.value.expression,D=t.al(u,v.scope),A=v.options.get(D);if(!A)return;let L,{minValue:B,maxValue:U,stepValue:W,type:Y,values:Z}=x[u],X=t.y(x[u].default);X.result==="success"&&(L=X.value.expression),L?(this.options.set(D,ia(Xi({},A),{value:k,default:L,minValue:B,maxValue:U,stepValue:W,type:Y,values:Z})),this.updateConfigDependencies()):this.fire(new t.d(new Error(`No schema defined for the config option "${u}" in the "${a}" fragment.`)))}getConfig(a){let u=this.getFragmentStyle(a);if(!u)return null;let _=u.stylesheet.schema;if(!_)return null;let v={};for(let x in _){let S=t.al(x,u.scope),k=u.options.get(S),D=k?k.value||k.default:null;v[x]=D?D.serialize():null}return v}setConfig(a,u){let _=this.getFragmentStyle(a);_&&(_.updateConfig(u,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(a){let u=this.getFragmentStyle(a);return u?u.stylesheet.schema:null}setSchema(a,u){let _=this.getFragmentStyle(a);_&&(_.stylesheet.schema=u,_.updateConfig(_._config,u),this.updateConfigDependencies())}updateConfig(a,u){if(this._config=a,a||u)if(u)for(let _ in u){let v,x,S=t.y(u[_].default);if(S.result==="success"&&(v=S.value.expression),a&&a[_]!==void 0){let U=t.y(a[_]);U.result==="success"&&(x=U.value.expression)}let{minValue:k,maxValue:D,stepValue:A,type:L,values:B}=u[_];if(v){let U=t.al(_,this.scope);this.options.set(U,{default:v,value:x,minValue:k,maxValue:D,stepValue:A,type:L,values:B})}else this.fire(new t.d(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new t.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let a of this._configDependentLayers){let u=this.getLayer(a);u&&(u.possiblyEvaluateVisibility(),this._updateLayer(u))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(a=>{if(a._styleColorTheme.colorTheme){let u=a._evaluateColorThemeData(a._styleColorTheme.colorTheme);(!a._styleColorTheme.lut||a._styleColorTheme.lut&&u!==a._styleColorTheme.lut.data)&&a.setColorTheme(a._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(a,u,_={}){this._checkLoaded();let v=a.id;if(this._layers[v])return void this.fire(new t.d(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(a.type==="custom"){if(Qs(this,t.cX(a)))return;x=t.cY(a,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof a.source=="object"&&(this.addSource(v,a.source),a=t.cT(a),a=t.W(a,{source:v})),this._validate(mt,`layers.${v}`,a,{arrayIndex:-1},_))return;x=t.cY(a,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize()}x.isConfigDependent&&this._configDependentLayers.add(x.fqid);let S=this._order.length;if(u){let L=this._order.indexOf(u);if(L===-1)return void this.fire(new t.d(new Error(`Layer with id "${u}" does not exist on this map.`)));x.slot===this._layers[u].slot?S=L:t.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,v),this._layerOrderChanged=!0,this._layers[v]=x;let k=this.getOwnLayerSourceCache(x),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&x.canCastShadows()&&D&&(k.castsShadows=!0);let A=this._changes.getRemovedLayer(x);if(A&&x.source&&k&&x.type!=="custom"){this._changes.discardLayerRemoval(x);let L=t.al(x.source,x.scope);A.type!==x.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),k.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(a,u){this._checkLoaded();let _=this._checkLayer(a);if(!_||a===u)return;let v=this._order.indexOf(a);this._order.splice(v,1);let x=this._order.length;if(u){let S=this._order.indexOf(u);if(S===-1)return void this.fire(new t.d(new Error(`Layer with id "${u}" does not exist on this map.`)));_.slot===this._layers[u].slot?x=S:t.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,a),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(a){this._checkLoaded();let u=this._checkLayer(a);if(!u)return;u.setEventedParent(null);let _=this._order.indexOf(a);this._order.splice(_,1),delete this._layers[a],delete this._serializedLayers[a],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);let v=this.getOwnLayerSourceCache(u);if(v&&v.castsShadows){let x=!1;for(let S in this._layers)if(this._layers[S].source===u.source&&this._layers[S].canCastShadows()){x=!0;break}v.castsShadows=x}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(a){return this._layers[a]}hasLayer(a){return a in this._mergedLayers}hasLayerType(a){for(let u in this._layers)if(this._layers[u].type===a)return!0;return!1}setLayerZoomRange(a,u,_){this._checkLoaded();let v=this._checkLayer(a);v&&(v.minzoom===u&&v.maxzoom===_||(u!=null&&(v.minzoom=u),_!=null&&(v.maxzoom=_),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(a,u){this._checkLoaded();let _=this._checkLayer(a);_&&_.slot!==u&&(_.slot=u,this._updateLayer(_))}setFilter(a,u,_={}){this._checkLoaded();let v=this._checkLayer(a);if(v&&!g(v.filter,u))return u==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(st,`layers.${v.id}.filter`,u,{layerType:v.type},_)||(v.filter=t.cT(u),this._updateLayer(v)))}getFilter(a){let u=this._checkLayer(a);if(u)return t.cT(u.filter)}setLayoutProperty(a,u,_,v={}){this._checkLoaded();let x=this._checkLayer(a);if(x&&!g(x.getLayoutProperty(u),_)){if(_!=null&&(!v||v.validate!==!1)&&Qs(x,$t.call(be,{key:`layers.${a}.layout.${u}`,layerType:x.type,objectKey:u,value:_,styleSpec:t.L,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(u,_),x.isConfigDependent&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(a,u){let _=this._checkLayer(a);if(_)return _.getLayoutProperty(u)}setPaintProperty(a,u,_,v={}){this._checkLoaded();let x=this._checkLayer(a);if(!x||g(x.getPaintProperty(u),_)||_!=null&&(!v||v.validate!==!1)&&Qs(x,Rt.call(be,{key:`layers.${a}.paint.${u}`,layerType:x.type,objectKey:u,value:_,styleSpec:t.L})))return;let S=x.setPaintProperty(u,_);x.isConfigDependent&&this._configDependentLayers.add(x.fqid),S&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(a,u){let _=this._checkLayer(a);if(_)return _.getPaintProperty(u)}setFeatureState(a,u){this._checkLoaded();let _=a.source,v=a.sourceLayer,x=this._checkSource(_);if(!x)return;let S=x.type;if(S==="geojson"&&v)return void this.fire(new t.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!v)return void this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new t.d(new Error("The feature id parameter must be provided.")));let k=this.getOwnSourceCaches(_);for(let D of k)D.setFeatureState(v,a.id,u)}removeFeatureState(a,u){this._checkLoaded();let _=a.source,v=this._checkSource(_);if(!v)return;let x=v.type,S=x==="vector"?a.sourceLayer:void 0;if(x==="vector"&&!S)return void this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new t.d(new Error("A feature id is required to remove its specific state property.")));let k=this.getOwnSourceCaches(_);for(let D of k)D.removeFeatureState(S,a.id,u)}getFeatureState(a){this._checkLoaded();let u=a.source,_=a.sourceLayer,v=this._checkSource(u);if(v){if(v.type!=="vector"||_)return a.id===void 0&&this.fire(new t.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(_,a.id);this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(a){return this.stylesheet.transition=t.W({},this.stylesheet.transition,a),this.transition=this.stylesheet.transition,this}getTransition(){return t.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let a=this.getTerrain(),u=a&&this.terrain&&this.terrain.scope===this.scope?a:this.stylesheet.terrain;return t.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateLayer(a){this._changes.updateLayer(a);let u=this.getLayerSourceCache(a),_=t.al(a.source,a.scope),v=this._changes.getUpdatedSourceCaches();a.source&&!v[_]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),u.pause()),a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){let u=k=>this._mergedLayers[k].type==="fill-extrusion"||this._mergedLayers[k].type==="model",_=this.order,v={},x=[];for(let k=_.length-1;k>=0;k--){let D=_[k];if(u(D)){v[D]=k;for(let A of a){let L=A[D];if(L)for(let B of L)x.push(B)}}}x.sort((k,D)=>D.intersectionZ-k.intersectionZ);let S=[];for(let k=_.length-1;k>=0;k--){let D=_[k];if(u(D))for(let A=x.length-1;A>=0;A--){let L=x[A].feature;if(L.layer&&v[L.layer.id]<k)break;S.push(L),x.pop()}else for(let A of a){let L=A[D];if(L)for(let B of L)S.push(B.feature)}}return S}queryRenderedFeatures(a,u,_){u&&u.filter&&this._validate(st,"queryRenderedFeatures.filter",u.filter,null,u),u.scope=this.scope,u.availableImages=this._availableImages,u.serializedLayers=this._serializedLayers;let v={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new t.d(new Error("parameters.layers must be an Array."))),[];for(let A of u.layers){let L=this._mergedLayers[A];if(!L)return this.fire(new t.d(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];v[L.source]=!0}}let x=[],S=u.serializedLayers||{},k=u&&u.layers?u.layers.some(A=>{let L=this.getLayer(A);return L&&L.is3D()}):this.has3DLayers(),D=oo.createFromScreenPoints(a,_);for(let A in this._mergedSourceCaches){let L=this._mergedSourceCaches[A].getSource();if(!L||L.scope!==u.scope)continue;let B=this._mergedSourceCaches[A].getSource().id;u.layers&&!v[B]||x.push(nx(this._mergedSourceCaches[A],this._mergedLayers,S,D,u,_,k,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(A,L,B,U,W,Y,Z){let X={},Q=Y.queryRenderedSymbols(U),re=[];for(let oe of Object.keys(Q).map(Number))re.push(Z[oe]);re.sort(qc);for(let oe of re){let ae=oe.featureIndex.lookupSymbolFeatures(Q[oe.bucketInstanceId],L,oe.bucketIndex,oe.sourceLayerIndex,W.filter,W.layers,W.availableImages,A);for(let _e in ae){let ge=X[_e]=X[_e]||[],ne=ae[_e];ne.sort((se,le)=>{let we=oe.featureSortOrder;if(we){let Re=we.indexOf(se.featureIndex);return we.indexOf(le.featureIndex)-Re}return le.featureIndex-se.featureIndex});for(let se of ne)ge.push(se)}}for(let oe in X)X[oe].forEach(ae=>{let _e=ae.feature,ge=B(A[oe]);if(!ge)return;let ne=ge.getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=ne});return X}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),D.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(a,u){u&&u.filter&&this._validate(st,"querySourceFeatures.filter",u.filter,null,u);let _=this.getOwnSourceCaches(a),v=[];for(let x of _)v=v.concat(wh(x,u));return v}addSourceType(a,u,_){return Sa.getSourceType(a)?_(new Error(`A source type called "${a}" already exists.`)):(Sa.setSourceType(a,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:u.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(a,u,_={}){this._checkLoaded();let v=this.light.getLight(),x=!1;for(let k in a)if(!g(a[k],v[k])){x=!0;break}if(!x)return;let S=this._getTransitionParameters();this.light.setLight(a,u,_),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=t.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&t.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(a,u=1){if(this._checkLoaded(),!a)return this.terrainSetForDrapingOnly()&&u!==0||delete this.terrain,a===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=a,v=a.source==null;if(u===1){if(this.disableElevatedTerrain)return;if(typeof _.source=="object"){let k="terrain-dem-src";this.addSource(k,_.source),_=t.cT(_),_=t.W(_,{source:k})}let x=t.W({},_),S={};if(this.terrain&&v){x.source=this.terrain.get().source;let k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(S.style=k.serialize())}if(this._validate(Te,"terrain",x,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&u!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,u),this.fire(new t.f("data",{dataType:"style"}))}else{let x=this.terrain,S=x.get();for(let k of Object.keys(t.L.terrain))!_.hasOwnProperty(k)&&t.L.terrain[k].default&&(_[k]=t.L.terrain[k].default);for(let k in a)if(!g(a[k],S[k])){x.set(a,this.options),this.stylesheet.terrain=a;let D=this._getTransitionParameters({duration:0});x.updateTransitions(D),this.fire(new t.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){let u=this.fog=new b_(a,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();let _=this._getTransitionParameters({duration:0});u.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let u=this.fog;if(!g(u.get(),a)){u.set(a,this.options),this.stylesheet.fog=u.get();let _=this._getTransitionParameters({duration:0});u.updateTransitions(_)}}else this._createFog(a);this._markersNeedUpdate=!0}setColorTheme(a){this._checkLoaded();let u=()=>{for(let v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(let v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=a,!a)return this._styleColorTheme.lut=null,void u();let _=this._evaluateColorThemeData(a);this._loadColorTheme(_).then(()=>{u()}).catch(v=>{t.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(a){return{now:t.e.now(),transition:t.W(this.transition,a)}}updateDrapeFirstLayers(){if(!this.terrain)return;let a=[],u=[];for(let _ in this._mergedLayers)this.isLayerDraped(this._mergedLayers[_])?a.push(_):u.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...u)}_createTerrain(a,u){let _=this.terrain=new en(a,u,this.scope,this.options);u===1&&(this.stylesheet.terrain=a),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let v=this._getTransitionParameters({duration:0});_.updateTransitions(v)}_force3DLayerUpdate(){for(let a in this._layers){let u=this._layers[a];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(let a in this._layers){let u=this._layers[a];u.type==="symbol"&&this._updateLayer(u)}}_validate(a,u,_,v,x={}){if(x&&x.validate===!1)return!1;let S=t.W({},this.serialize());return Qs(this,a.call(be,t.W({key:u,style:S,value:_,styleSpec:t.L},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let a in this._mergedLayers)this._mergedLayers[a].setEventedParent(null);for(let a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles(),this._mergedSourceCaches[a].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(a){let u=this.getSourceCaches(a);for(let _ of u)_.clearTiles()}clearSources(){for(let a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles()}reloadSource(a){let u=this.getSourceCaches(a);for(let _ of u)_.resume(),_.reload()}reloadSources(){for(let a of this.getSources())a.reload&&a.reload()}updateSources(a){let u;this.directionalLight&&(u=ah(this.directionalLight));for(let _ in this._mergedSourceCaches)this._mergedSourceCaches[_].update(a,void 0,void 0,u)}_generateCollisionBoxes(){for(let a in this._sourceCaches){let u=this._sourceCaches[a];u.resume(),u.reload()}}_updatePlacement(a,u,_,v,x,S,k=!1){let D=!1,A=!1,L={},B={};for(let W of this._mergedOrder){let Y=this._mergedLayers[W];if(Y.type!=="symbol")continue;let Z=t.al(Y.source,Y.scope),X=L[Z];if(!X){let re=this.getLayerSourceCache(Y);if(!re)continue;let oe=re.getRenderableIds(!0).map(ae=>re.getTileByID(ae));B[Z]=oe.slice(),X=L[Z]=oe.sort((ae,_e)=>_e.tileID.overscaledZ-ae.tileID.overscaledZ||(ae.tileID.isLessThan(_e.tileID)?-1:1))}let Q=this.crossTileSymbolIndex.addLayer(Y,X,u.center.lng,u.projection);D=D||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),k=k||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new t.f("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.e.now(),u.zoom))&&(this.pauseablePlacement=new Qu(u,this._mergedOrder,k,_,v,x,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.e.now()),A=!0),D&&this.pauseablePlacement.placement.setStale()),A||D){this._buildingIndex.onNewFrame(u.zoom);for(let W=0;W<this._mergedOrder.length;W++){let Y=this._mergedLayers[this._mergedOrder[W]];if(Y.type!=="symbol")continue;let Z=this.isLayerClipped(Y)&&this._clipLayerIndices.some(X=>W<X);this.placement.updateLayerOpacities(Y,L[t.al(Y.source,Y.scope)],W,Z?S:null)}}let U=!1;for(let W of this._mergedOrder){let Y=this._mergedLayers[W];if(Y.type!=="symbol")continue;let Z=L[t.al(Y.source,Y.scope)];for(let X of Z){let Q=X.getBucket(Y);Q&&X.latestFeatureIndex&&Y.fqid===Q.layerIds[0]&&(U=Q.updateOcclusionOpacities(a.context,a.symbolParams,a._dt)||U)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.e.now())||U,occlusionQueryBasedOpacityChanged:U}}_releaseSymbolFadeTiles(){for(let a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}addImport(a,u){this._checkLoaded();let _=this.stylesheet.imports=this.stylesheet.imports||[];if(_.findIndex(({id:x})=>x===a.id)!==-1)return void this.fire(new t.d(new Error(`Import with id '${a.id}' already exists in the map's style.`)));if(!u)return _.push(a),this._loadImports([a],!0);let v=_.findIndex(({id:x})=>x===u);return v===-1&&this.fire(new t.d(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,v).concat(a).concat(_.slice(v)),this._loadImports([a],!0,u)}updateImport(a,u){this._checkLoaded();let _=this.stylesheet.imports||[],v=this.getImportIndex(a);return v===-1?this:typeof u=="string"?(this.setImportUrl(a,u),this):(u.url&&u.url!==_[v].url&&this.setImportUrl(a,u.url),g(u.config,_[v].config)||this.setImportConfig(a,u.config),g(u.data,_[v].data)||this.setImportData(a,u.data),this)}moveImport(a,u){this._checkLoaded();let _=this.stylesheet.imports||[],v=this.getImportIndex(a);if(v===-1)return this;let x=this.getImportIndex(u);if(x===-1)return this;let S=_[v],k=this.fragments[v];return _=_.filter(({id:D})=>D!==a),this.fragments=this.fragments.filter(({id:D})=>D!==a),this.stylesheet.imports=_.slice(0,x).concat(S).concat(_.slice(x)),this.fragments=this.fragments.slice(0,x).concat(k).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(a,u){this._checkLoaded();let _=this.stylesheet.imports||[],v=this.getImportIndex(a);if(v===-1)return this;_[v].url=u;let x=this.fragments[v];return x.style=this._createFragmentStyle(_[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(u),this}setImportData(a,u){this._checkLoaded();let _=this.getImportIndex(a),v=this.stylesheet.imports||[];return _===-1?this:u?(this.fragments[_].style.setState(u),this._reloadImports(),this):(delete v[_].data,this.setImportUrl(a,v[_].url))}setImportConfig(a,u){this._checkLoaded();let _=this.getImportIndex(a),v=this.stylesheet.imports||[];if(_===-1)return this;u?v[_].config=u:delete v[_].config;let x=this.fragments[_],S=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=u,x.style.updateConfig(u,S),this.updateConfigDependencies(),this}removeImport(a){this._checkLoaded();let u=this.stylesheet.imports||[],_=this.getImportIndex(a);_!==-1&&(u.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(a){let u=(this.stylesheet.imports||[]).findIndex(_=>_.id===a);return u===-1&&this.fire(new t.d(new Error(`Import '${a}' does not exist in the map's style and cannot be updated.`))),u}getLayer(a){return this._mergedLayers[a]}getSources(){let a=[];for(let u in this._mergedOtherSourceCaches){let _=this._mergedOtherSourceCaches[u];_&&a.push(_.getSource())}return a}getSource(a,u){let _=this.getSourceCache(a,u);return _&&_.getSource()}getLayerSource(a){let u=this.getLayerSourceCache(a);return u&&u.getSource()}getSourceCache(a,u){let _=t.al(a,u);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(a){let u=t.al(a.source,a.scope);return a.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(a){if(a==null)return Object.values(this._mergedSourceCaches);let u=[];return this._mergedOtherSourceCaches[a]&&u.push(this._mergedOtherSourceCaches[a]),this._mergedSymbolSourceCaches[a]&&u.push(this._mergedSymbolSourceCaches[a]),u}updateSourceCaches(){let a=this._changes.getUpdatedSourceCaches();for(let u in a){let _=a[u];_==="reload"?this.reloadSource(u):_==="clear"&&this.clearSource(u)}}updateLayers(a){let u=this._changes.getUpdatedPaintProperties();for(let _ of u){let v=this.getLayer(_);v&&v.updateTransitions(a)}}getImages(a,u,_){this.imageManager.getImages(u.icons,u.scope,_),this._updateTilesForChangedImages();let v=x=>{x&&x.setDependencies(u.tileID.key,u.type,u.icons)};v(this._otherSourceCaches[u.source]),v(this._symbolSourceCaches[u.source])}getGlyphs(a,u,_){this.glyphManager.getGlyphs(u.stacks,u.scope,_)}getResource(a,u,_){return t.c$(u,_)}getOwnSourceCache(a){return this._otherSourceCaches[a]}getOwnLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}getOwnSourceCaches(a){let u=[];return this._otherSourceCaches[a]&&u.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&u.push(this._symbolSourceCaches[a]),u}_isSourceCacheLoaded(a){let u=this.getOwnSourceCaches(a);return u.length===0?(this.fire(new t.d(new Error(`There is no source with ID '${a}'`))),!1):u.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(a,u){if(this._clipLayerIndices.length===0&&a.type!=="fill-extrusion")return!1;let _=a.type==="fill-extrusion"&&a.sourceLayer==="building",v=0;if(a.is3D()){if(_||u&&u.type==="batched-model")return!0;a.type==="model"&&(v=t.cu.Model)}else a.type==="symbol"&&(v=t.cu.Symbol);for(let x of this._clipLayerIndices){let S=this._mergedLayers[this._mergedOrder[x]];if(!S)continue;let k=[];for(let D of S.layout.get("clip-layer-types"))k.push(D==="model"?t.cu.Model:D==="symbol"?t.cu.Symbol:t.cu.FillExtrusion);for(let D of k)if(v&D)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(a=>{a.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function kf(f,a){let u=!1,_=null,v=()=>{_=null,u&&(f(),_=setTimeout(v,a),u=!1)};return()=>(u=!0,_||v(),_)}Sa.getSourceType=function(f){return Ur[f]},Sa.setSourceType=function(f,a){Ur[f]=a},Sa.registerForPluginStateChange=t.cL;class hx{constructor(a){this._hashName=a&&encodeURIComponent(a),t.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=kf(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let a=this._map;if(!a)return"";let u=Th(a);if(this._hashName){let _=this._hashName,v=!1,x=location.hash.slice(1).split("&").map(S=>{let k=S.split("=")[0];return k===_?(v=!0,`${k}=${u}`):S}).filter(S=>S);return v||x.push(`${_}=${u}`),`#${x.join("&")}`}return`#${u}`}_getCurrentHash(){let a=location.hash.replace("#","");if(this._hashName){let u;return a.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(u=_)}),(u&&u[1]||"").split("/")}return a.split("/")}_onHashChange(){let a=this._map;if(!a)return!1;let u=this._getCurrentHash();if(u.length>=3&&!u.some(_=>isNaN(_))){let _=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(u[3]||0):a.getBearing();return a.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:_,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Th(f,a){let u=f.getCenter(),_=Math.round(100*f.getZoom())/100,v=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),S=Math.round(u.lng*x)/x,k=Math.round(u.lat*x)/x,D=f.getBearing(),A=f.getPitch(),L=a?`/${S}/${k}/${_}`:`${_}/${k}/${S}`;return(D||A)&&(L+="/"+Math.round(10*D)/10),A&&(L+=`/${Math.round(A)}`),L}let Ku={linearity:.3,easing:t.d0(0,0,.3,1)},X_=t.W({deceleration:2500,maxSpeed:1400},Ku),If=t.W({deceleration:20,maxSpeed:1400},Ku),Ju=t.W({deceleration:1e3,maxSpeed:360},Ku),Tf=t.W({deceleration:1e3,maxSpeed:90},Ku);class Ll{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.e.now(),settings:a})}_drainInertiaBuffer(){let a=this._inertiaBuffer,u=t.e.now();for(;a.length>0&&u-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let u={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:x}of this._inertiaBuffer)u.zoom+=x.zoomDelta||0,u.bearing+=x.bearingDelta||0,u.pitch+=x.pitchDelta||0,x.panDelta&&u.pan._add(x.panDelta),x.around&&(u.around=x.around),x.pinchAround&&(u.pinchAround=x.pinchAround);let _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){let x=Eh(u.pan.mag(),_,t.W({},X_,a||{}));v.offset=u.pan.mult(x.amount/u.pan.mag()),v.center=this._map.transform.center,Zc(v,x)}if(u.zoom){let x=Eh(u.zoom,_,If);v.zoom=this._map.transform.zoom+x.amount,Zc(v,x)}if(u.bearing){let x=Eh(u.bearing,_,Ju);v.bearing=this._map.transform.bearing+t.at(x.amount,-179,179),Zc(v,x)}if(u.pitch){let x=Eh(u.pitch,_,Tf);v.pitch=this._map.transform.pitch+x.amount,Zc(v,x)}if(v.zoom||v.bearing){let x=u.pinchAround===void 0?u.around:u.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Zc(f,a){(!f.duration||f.duration<a.duration)&&(f.duration=a.duration,f.easing=a.easing)}function Eh(f,a,u){let{maxSpeed:_,linearity:v,deceleration:x}=u,S=t.at(f*v/(a/1e3),-_,_),k=Math.abs(S)/(x*v);return{easing:u.easing,duration:1e3*k,amount:S*(k/2)}}class Wr extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,_,v={}){let x=ht(u.getCanvasContainer(),_),S=u.unproject(x);super(a,t.W({point:x,lngLat:S,originalEvent:_},v)),this._defaultPrevented=!1,this.target=u}}class Ks extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,_){let v=a==="touchend"?_.changedTouches:_.touches,x=Mt(u.getCanvasContainer(),v),S=x.map(D=>u.unproject(D)),k=x.reduce((D,A,L,B)=>D.add(A.div(B.length)),new t.P(0,0));super(a,{points:x,point:k,lngLats:S,lngLat:u.unproject(k),originalEvent:_}),this._defaultPrevented=!1}}class em extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,_){super(a,{originalEvent:_}),this._defaultPrevented=!1}}class Ef{constructor(a,u){this._map=a,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new em(a.type,this._map,a))}mousedown(a,u){return this._mousedownPos=u,this._firePreventable(new Wr(a.type,this._map,a))}mouseup(a){this._map.fire(new Wr(a.type,this._map,a))}preclick(a){let u=t.W({},a);u.type="preclick",this._map.fire(new Wr(u.type,this._map,u))}click(a,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Wr(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Wr(a.type,this._map,a))}mouseover(a){this._map.fire(new Wr(a.type,this._map,a))}mouseout(a){this._map.fire(new Wr(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Ks(a.type,this._map,a))}touchmove(a){this._map.fire(new Ks(a.type,this._map,a))}touchend(a){this._map.fire(new Ks(a.type,this._map,a))}touchcancel(a){this._map.fire(new Ks(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Dh{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Wr(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Wr(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tm{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,u){this.isEnabled()&&a.shiftKey&&a.button===0&&(Ie(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(a,u){if(!this._active)return;let _=u,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(_)||!this._box&&_.dist(v)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));let S=Math.min(v.x,_.x),k=Math.max(v.x,_.x),D=Math.min(v.y,_.y),A=Math.max(v.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${D}px)`,this._box.style.width=k-S+"px",this._box.style.height=A-D+"px")})}mouseupWindow(a,u){if(!this._active)return;let _=this._startPos,v=u;if(_&&a.button===0){if(this.reset(),He(),_.x!==v.x||_.y!==v.y)return this._map.fire(new t.f("boxzoomend",{originalEvent:a})),{cameraAnimation:x=>x.fitScreenCoordinates(_,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Me(),delete this._startPos,delete this._lastPos}_fireEvent(a,u){return this._map.fire(new t.f(a,{originalEvent:u}))}}function Ah(f,a){let u={};for(let _=0;_<f.length;_++)u[f[_].identifier]=a[_];return u}class Q_{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,u,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(v){let x=new t.P(0,0);for(let S of v)x._add(S);return x.div(v.length)}(u),this.touches=Ah(_,u)))}touchmove(a,u,_){if(this.aborted||!this.centroid)return;let v=Ah(_,u);for(let x in this.touches){let S=v[x];(!S||S.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(a,u,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Ph{constructor(a){this.singleTap=new Q_(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,u,_){this.singleTap.touchstart(a,u,_)}touchmove(a,u,_){this.singleTap.touchmove(a,u,_)}touchend(a,u,_){let v=this.singleTap.touchend(a,u,_);if(v){let x=a.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(v)<30;if(x&&S||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class im{constructor(){this._zoomIn=new Ph({numTouches:1,numTaps:2}),this._zoomOut=new Ph({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,u,_){this._zoomIn.touchstart(a,u,_),this._zoomOut.touchstart(a,u,_)}touchmove(a,u,_){this._zoomIn.touchmove(a,u,_),this._zoomOut.touchmove(a,u,_)}touchend(a,u,_){let v=this._zoomIn.touchend(a,u,_),x=this._zoomOut.touchend(a,u,_);return v?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(v)},{originalEvent:a})}):x?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(x)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Oh={0:1,2:2};class nm{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,u){return!1}_move(a,u){return{}}mousedown(a,u){if(this._lastPoint)return;let _=yt(a);this._correctButton(a,_)&&(this._lastPoint=u,this._eventButton=_)}mousemoveWindow(a,u){let _=this._lastPoint;if(_){if(a.preventDefault(),this._eventButton!=null&&function(v,x){let S=Oh[x];return v.buttons===void 0||(v.buttons&S)!==S}(a,this._eventButton))this.reset();else if(this._moved||!(u.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(_,u)}}mouseupWindow(a){this._lastPoint&&yt(a)===this._eventButton&&(this._moved&&He(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class K_ extends nm{mousedown(a,u){super.mousedown(a,u),this._lastPoint&&(this._active=!0)}_correctButton(a,u){return u===0&&!a.ctrlKey}_move(a,u){return{around:u,panDelta:u.sub(a)}}}class Df extends nm{_correctButton(a,u){return u===0&&a.ctrlKey||u===2}_move(a,u){let _=.8*(u.x-a.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(a){a.preventDefault()}}class Fl extends nm{_correctButton(a,u){return u===0&&a.ctrlKey||u===2}_move(a,u){let _=-.5*(u.y-a.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(a){a.preventDefault()}}class J_{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),t.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}touchstart(a,u,_){return this._calculateTransform(a,u,_)}touchmove(a,u,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!t.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,u,_)}}touchend(a,u,_){this._calculateTransform(a,u,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,u,_){_.length>0&&(this._active=!0);let v=Ah(_,u),x=new t.P(0,0),S=new t.P(0,0),k=0;for(let A in v){let L=v[A],B=this._touches[A];B&&(x._add(L),S._add(L.sub(B)),k++,v[A]=L)}if(this._touches=v,k<this._minTouches||!S.mag())return;let D=S.div(k);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(k),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Af{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,u,_){return{}}touchstart(a,u,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([u[0],u[1]]))}touchmove(a,u,_){let v=this._firstTwoTouches;if(!v)return;a.preventDefault();let[x,S]=v,k=rm(_,u,x),D=rm(_,u,S);if(!k||!D)return;let A=this._aroundCenter?null:k.add(D).div(2);return this._move([k,D],A,a)}touchend(a,u,_){if(!this._firstTwoTouches)return;let[v,x]=this._firstTwoTouches,S=rm(_,u,v),k=rm(_,u,x);S&&k||(this._active&&He(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function rm(f,a,u){for(let _=0;_<f.length;_++)if(f[_].identifier===u)return a[_]}function e0(f,a){return Math.log(f/a)/Math.LN2}class Pf extends Af{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,u){let _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(e0(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:e0(this._distance,_),pinchAround:u}}}function om(f,a){return 180*f.angleWith(a)/Math.PI}class Of extends Af{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,u){let _=this._vector;if(this._vector=a[0].sub(a[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:om(this._vector,_),pinchAround:u}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());let u=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;let v=om(a,_);return Math.abs(v)<u}}function Rh(f){return Math.abs(f.y)>Math.abs(f.x)}class t0 extends Af{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Rh(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,u,_){let v=this._lastPoints;if(!v)return;let x=a[0].sub(v[0]),S=a[1].sub(v[1]);return this._map._cooperativeGestures&&!t.d1()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(x,S,_.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(x.y+S.y)/2*-.5})}gestureBeginsVertically(a,u,_){if(this._valid!==void 0)return this._valid;let v=a.mag()>=2,x=u.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;let S=a.y>0==u.y>0;return Rh(a)&&Rh(u)&&S}}let i0={panStep:100,bearingStep:15,pitchStep:10};class ux{constructor(){let a=i0;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let u=0,_=0,v=0,x=0,S=0;switch(a.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),x=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),x=1);break;case 38:a.shiftKey?v=1:(a.preventDefault(),S=-1);break;case 40:a.shiftKey?v=-1:(a.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(_=0,v=0),{cameraAnimation:k=>{let D=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Lh,zoom:u?Math.round(D)+u*(a.shiftKey?2:1):D,bearing:k.getBearing()+_*this._bearingStep,pitch:k.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-S*this._panStep],center:k.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Lh(f){return f*(2-f)}let Xc=4.000244140625,n0=1/450;class Vo{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=n0,t.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||t.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY,_=t.e.now(),v=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,u!==0&&u%Xc==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),a.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=a,this._delta-=u,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let u=ht(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let u=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){let A=this._type==="wheel"&&Math.abs(this._delta)>Xc?this._wheelZoomRate:this._defaultZoomRate,L=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&L!==0&&(L=1/L);let B=u(),U=Math.pow(2,B),W=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(W*L))),this._type==="wheel"&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let _=typeof this._targetZoom=="number"?this._targetZoom:u(),v=this._startZoom,x=this._easing,S,k=!1;if(this._type==="wheel"&&v&&x){let A=Math.min((t.e.now()-this._lastWheelEventTime)/200,1),L=x(A);S=t.a2(v,_,L),A<1?this._frameId||(this._frameId=!0):k=!0}else S=_,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=S-u();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let u=t.d2;if(this._prevEase){let _=this._prevEase,v=(t.e.now()-_.start)/_.duration,x=_.easing(v+.01)-_.easing(v),S=.27/Math.sqrt(x*x+1e-4)*.01,k=Math.sqrt(.0729-S*S);u=t.d0(S,k,.25,1)}return this._prevEase={start:t.e.now(),duration:a,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Rf{constructor(a,u){this._clickZoom=a,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class am{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,u){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(a.shiftKey?-1:1),around:_.unproject(u)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sm{constructor(){this._tap=new Ph({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,u,_){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=u[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(a,u,_))}touchmove(a,u,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;let v=u[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,a.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(a,u,_)}touchend(a,u,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(a,u,_)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lf{constructor(a,u,_){this._el=a,this._mousePan=u,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ff{constructor(a,u,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=u,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class lm{constructor(a,u,_,v){this._el=a,this._touchZoom=u,this._touchRotate=_,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Qc=f=>f.zoom||f.drag||f.pitch||f.rotate;class zf extends t.f{}class cm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,u){let _=t._.sub([],u,a);this.radius=t._.length(_[2]<0?t._.div([],_,this.constants):[_[0],_[1],0])}projectRay(a){t._.div(a,a,this.constants),t._.normalize(a,a),t._.mul(a,a,this.constants);let u=t._.scale([],a,this.radius);if(u[2]>0){let _=t._.scale([],[0,0,1],t._.dot(u,[0,0,1])),v=t._.scale([],t._.normalize([],[u[0],u[1],0]),this.radius),x=t._.add([],u,t._.scale([],t._.sub([],t._.add([],v,_),u),2));u[0]=x[0],u[1]=x[1]}return u}}function Fh(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class r0{constructor(a,u){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ll(a),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),t.bp(["handleEvent","handleWindowEvent"],this);let _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,x,S]of this._listeners){let k=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,k,S)}}destroy(){for(let[a,u,_]of this._listeners){let v=a===document?this.handleWindowEvent:this.handleEvent;a.removeEventListener(u,v,_)}}_addDefaultHandlers(a){let u=this._map,_=u.getCanvasContainer();this._add("mapEvent",new Ef(u,a));let v=u.boxZoom=new tm(u,a);this._add("boxZoom",v);let x=new im,S=new am;u.doubleClickZoom=new Rf(S,x),this._add("tapZoom",x),this._add("clickZoom",S);let k=new sm;this._add("tapDragZoom",k);let D=u.touchPitch=new t0(u);this._add("touchPitch",D);let A=new Df(a),L=new Fl(a);u.dragRotate=new Ff(a,A,L),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);let B=new K_(a),U=new J_(u,a);u.dragPan=new Lf(_,B,U),this._add("mousePan",B),this._add("touchPan",U,["touchZoom","touchRotate"]);let W=new Of,Y=new Pf;u.touchZoomRotate=new lm(_,Y,W,k),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Dh(u));let Z=u.scrollZoom=new Vo(u,this);this._add("scrollZoom",Z,["mousePan"]);let X=u.keyboard=new ux;this._add("keyboard",X);for(let Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[Q]&&u[Q].enable(a[Q])}_add(a,u,_){this._handlers.push({handlerName:a,handler:u,allowed:_}),this._handlersById[a]=u}stop(a){if(!this._updatingCamera){for(let{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,u,_){for(let v in a)if(v!==_&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){let u=[];for(let _ of a)this._el.contains(_.target)&&u.push(_);return u}handleEvent(a,u){this._updatingCamera=!0;let _=a.type==="renderFrame",v=_?void 0:a,x={needsRenderFrame:!1},S={},k={},D=a.touches?this._getMapTouches(a.touches):void 0,A=D?Mt(this._el,D):_?void 0:ht(this._el,a);for(let{handlerName:U,handler:W,allowed:Y}of this._handlers){if(!W.isEnabled())continue;let Z;this._blockedByActive(k,Y,U)?W.reset():W[u||a.type]&&(Z=W[u||a.type](a,A,D),this.mergeHandlerResult(x,S,Z,U,v),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||W.isActive())&&(k[U]=W)}let L={};for(let U in this._previousActiveHandlers)k[U]||(L[U]=v);this._previousActiveHandlers=k,(Object.keys(L).length||Fh(x))&&(this._changes.push([x,S,L]),this._triggerRenderFrame()),(Object.keys(k).length||Fh(x))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:B}=x;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(a,u,_,v,x){if(!_)return;t.W(a,_);let S={handlerName:v,originalEvent:_.originalEvent||x};_.zoomDelta!==void 0&&(u.zoom=S),_.panDelta!==void 0&&(u.drag=S),_.pitchDelta!==void 0&&(u.pitch=S),_.bearingDelta!==void 0&&(u.rotate=S)}_applyChanges(){let a={},u={},_={};for(let[v,x,S]of this._changes)v.panDelta&&(a.panDelta=(a.panDelta||new t.P(0,0))._add(v.panDelta)),v.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(a.around=v.around),v.aroundCoord!==void 0&&(a.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(a.pinchAround=v.pinchAround),v.noInertia&&(a.noInertia=v.noInertia),t.W(u,x),t.W(_,S);this._updateMapTransform(a,u,_),this._changes=[]}_updateMapTransform(a,u,_){let v=this._map,x=v.transform,S=re=>[re.x,re.y,re.z];if((re=>{let oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!Fh(a)){let re=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),re!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!Fh(a))return void this._fireEvents(u,_,!0);let{panDelta:k,zoomDelta:D,bearingDelta:A,pitchDelta:L,around:B,aroundCoord:U,pinchAround:W}=a;x._isCameraConstrained&&(D>0&&(D=0),x._isCameraConstrained=!1),W!==void 0&&(B=W),(D||(re=>u[re]&&!this._eventsInProgress[re])("drag"))&&B&&(this._dragOrigin=S(x.pointCoordinate3D(B)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),B=B||v.transform.centerPoint,A&&(x.bearing+=A),L&&(x.pitch+=L),x._updateCameraState();let Y=[0,0,0];if(k)if(x.projection.name==="mercator"){let re=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(B).dir),oe=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(B.sub(k)).dir);Y[0]=oe[0]-re[0],Y[1]=oe[1]-re[1]}else{let re=x.pointCoordinate(B);if(x.projection.name==="globe"){k=k.rotate(-x.angle);let oe=x._pixelsPerMercatorPixel/x.worldSize;Y[0]=-k.x*t.d3(t.ay(re.y))*oe,Y[1]=-k.y*t.d3(x.center.lat)*oe}else{let oe=x.pointCoordinate(B.sub(k));re&&oe&&(Y[0]=oe.x-re.x,Y[1]=oe.y-re.y)}}let Z=x.zoom,X=[0,0,0];if(D){let re=S(U||x.pointCoordinate3D(B)),oe={dir:t._.normalize([],t._.sub([],re,x._camera.position))};if(oe.dir[2]<0){let ae=x.zoomDeltaToMovement(re,D);t._.scale(X,oe.dir,ae)}}let Q=t._.add(Y,Y,X);x._translateCameraConstrained(Q),D&&Math.abs(x.zoom-Z)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(u,_,!0)}_fireEvents(a,u,_){let v=Qc(this._eventsInProgress),x=Qc(a),S={};for(let L in a){let{originalEvent:B}=a[L];this._eventsInProgress[L]||(S[`${L}start`]=B),this._eventsInProgress[L]=a[L]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(let L in S)this._fireEvent(L,S[L]);x&&this._fireEvent("move",x.originalEvent);for(let L in a){let{originalEvent:B}=a[L];this._fireEvent(L,B)}let k={},D;for(let L in this._eventsInProgress){let{handlerName:B,originalEvent:U}=this._eventsInProgress[L];this._handlersById[B].isActive()||(delete this._eventsInProgress[L],D=u[B]||U,k[`${L}end`]=D)}for(let L in k)this._fireEvent(L,k[L]);let A=Qc(this._eventsInProgress);if(_&&(v||x)&&!A){this._updatingCamera=!0;let L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;L?(B(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:D})):(this._map.fire(new t.f("moveend",{originalEvent:D})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,u){this._map.fire(new t.f(a,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new zf("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let zl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class mx extends t.E{constructor(a,u){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,t.bp(["_renderFrameCallback"],this)}getCenter(){return new t.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(a,u){return this.jumpTo({center:a},u)}panBy(a,u,_){return a=t.P.convert(a).mult(-1),this.panTo(this.transform.center,t.W({offset:a},u),_)}panTo(a,u,_){return this.easeTo(t.W({center:a},u),_)}getZoom(){return this.transform.zoom}setZoom(a,u){return this.jumpTo({zoom:a},u),this}zoomTo(a,u,_){return this.easeTo(t.W({zoom:a},u),_)}zoomIn(a,u){return this.zoomTo(this.getZoom()+1,a,u),this}zoomOut(a,u){return this.zoomTo(this.getZoom()-1,a,u),this}getBearing(){return this.transform.bearing}setBearing(a,u){return this.jumpTo({bearing:a},u),this}getPadding(){return this.transform.padding}setPadding(a,u){return this.jumpTo({padding:a},u),this}rotateTo(a,u,_){return this.easeTo(t.W({bearing:a},u),_)}resetNorth(a,u){return this.rotateTo(0,t.W({duration:1e3},a),u),this}resetNorthPitch(a,u){return this.easeTo(t.W({bearing:0,pitch:0,duration:1e3},a),u),this}snapToNorth(a,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,u):this}getPitch(){return this.transform.pitch}setPitch(a,u){return this.jumpTo({pitch:a},u),this}cameraForBounds(a,u){a=t.ai.convert(a);let _=u&&u.bearing||0,v=u&&u.pitch||0,x=a.getNorthWest(),S=a.getSouthEast();return this._cameraForBounds(this.transform,x,S,_,v,u)}_extendPadding(a){let u={top:0,right:0,bottom:0,left:0};return a==null?t.W({},u,this.transform.padding):typeof a=="number"?{top:a,bottom:a,right:a,left:a}:t.W({},u,a)}_extendCameraOptions(a){return(a=t.W({offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=this._extendPadding(a.padding),a}_minimumAABBFrustumDistance(a,u){let _=u.max[0]-u.min[0],v=u.max[1]-u.min[1];return _/v>a.aspect?_/(2*Math.tan(.5*a.fovX)*a.aspect):v/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,u,_,v,x,S){let k=a.clone(),D=this._extendCameraOptions(S);k.bearing=v,k.pitch=x;let A=t.aI.convert(u),L=t.aI.convert(_),B=.5*(A.lat+L.lat),U=.5*(A.lng+L.lng),W=t.d4(B,U),Y=t._.normalize([],W),Z=t._.normalize([],t._.cross([],Y,[0,1,0])),X=t._.cross([],Z,Y),Q=[Z[0],Z[1],Z[2],0,X[0],X[1],X[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],re=[W,t.d4(A.lat,A.lng),t.d4(L.lat,A.lng),t.d4(L.lat,L.lng),t.d4(A.lat,L.lng),t.d4(B,A.lng),t.d4(B,L.lng),t.d4(A.lat,U),t.d4(L.lat,U)],oe=t.b6.fromPoints(re.map(Ze=>[t._.dot(Z,Ze),t._.dot(X,Ze),t._.dot(Y,Ze)])),ae=t._.transformMat4([],oe.center,Q);t._.squaredLength(ae)===0&&t._.set(ae,0,0,1),t._.normalize(ae,ae),t._.scale(ae,ae,t.cD),k.center=t.d5(ae);let _e=k.getWorldToCameraMatrix(),ge=t.ad.invert(new Float64Array(16),_e);oe=t.b6.applyTransform(oe,t.ad.multiply([],_e,Q));let ne=this._extendAABB(oe,k,D,v);if(!ne)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=ne,t._.transformMat4(ae,ae,_e);let se=.5*(oe.max[2]-oe.min[2]),le=this._minimumAABBFrustumDistance(k,oe),we=t._.scale([],[0,0,1],se),Re=t._.add(we,ae,we),me=le+(k.pitch===0?0:t._.distance(ae,Re)),Le=k.globeCenterInViewSpace,Be=t._.sub([],ae,[Le[0],Le[1],Le[2]]);t._.normalize(Be,Be),t._.scale(Be,Be,me);let Qe=t._.add([],ae,Be);t._.transformMat4(Qe,Qe,ge);let Je=t.d7/t.cD,Xe=t._.length(Qe),Ee=t.ax(Math.max(Xe*Je-t.d7,Number.EPSILON),0),Ve=Math.min(k.zoomFromMercatorZAdjusted(Ee),D.maxZoom);return Ve>.5*(t.b1+t.aU)?(k.setProjection({name:"mercator"}),k.zoom=Ve,this._cameraForBounds(k,u,_,v,x,S)):{center:k.center,zoom:Ve,bearing:v,pitch:x}}_extendAABB(a,u,_,v){let x=.5*((_.padding.left||0)+(_.padding.right||0)),S=.5*((_.padding.top||0)+(_.padding.bottom||0)),k=S,D=x,A=x,L=S,B=u.width-(D+A),U=u.height-(k+L),W=t._.sub([],a.max,a.min),Y=Math.min(B/W[0],U/W[1]),Z=Math.min(u.scaleZoom(u.scale*Y),_.maxZoom);if(isNaN(Z))return null;let X=u.scale/u.zoomScale(Z),Q=new t.b6([a.min[0]-D*X,a.min[1]-L*X,a.min[2]],[a.max[0]+A*X,a.max[1]+k*X,a.max[2]]),re=(typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new t.P(_.offset.x,_.offset.y):t.P.convert(_.offset)).rotate(-t.ab(v));return Q.center[0]-=re.x*X,Q.center[1]+=re.y*X,Q}queryTerrainElevation(a,u){let _=this.transform.elevation;return _?(u=t.W({},{exaggerated:!0},u),_.getAtPoint(t.Y.fromLngLat(a),null,u.exaggerated)):null}_cameraForBounds(a,u,_,v,x,S){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,u,_,v,x,S);let k=a.clone(),D=this._extendCameraOptions(S);k.bearing=v,k.pitch=x;let A=t.aI.convert(u),L=t.aI.convert(_),B=new t.aI(A.lng,L.lat),U=new t.aI(L.lng,A.lat),W=k.project(A),Y=k.project(L),Z=this.queryTerrainElevation(A),X=this.queryTerrainElevation(L),Q=this.queryTerrainElevation(B),re=this.queryTerrainElevation(U),oe=[[W.x,W.y,Math.min(Z||0,X||0,Q||0,re||0)],[Y.x,Y.y,Math.max(Z||0,X||0,Q||0,re||0)]],ae=t.b6.fromPoints(oe),_e=k.getWorldToCameraMatrix(),ge=t.ad.invert(new Float64Array(16),_e);ae=t.b6.applyTransform(ae,_e);let ne=this._extendAABB(ae,k,D,v);if(!ne)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=ne;let se=.5*t._.sub([],ae.max,ae.min)[2],le=this._minimumAABBFrustumDistance(k,ae),we=[0,0,1,0];t.aA.transformMat4(we,we,_e),t.aA.normalize(we,we);let Re=t._.scale([],we,le+se),me=t._.add([],ae.center,Re);t._.transformMat4(ae.center,ae.center,ge),t._.transformMat4(me,me,ge);let Le=[ae.center[0],ae.center[1],me[2]*k.pixelsPerMeter];t._.scale(Le,Le,1/k.worldSize);let Be=t.d6(Le[0]),Qe=t.ay(Le[1]),Je=Math.min(k._zoomFromMercatorZ(Le[2]),D.maxZoom),Xe=new t.aI(Be,Qe);return k.mercatorFromTransition&&Je<.5*(t.b1+t.aU)?(k.setProjection({name:"globe"}),k.zoom=Je,this._cameraForBounds(k,u,_,v,x,S)):{center:Xe,zoom:Je,bearing:v,pitch:x}}fitBounds(a,u,_){let v=this.cameraForBounds(a,u);return this._fitInternal(v,u,_)}fitScreenCoordinates(a,u,_,v,x){let S=t.P.convert(a),k=t.P.convert(u),D=new t.P(Math.min(S.x,k.x),Math.min(S.y,k.y)),A=new t.P(Math.max(S.x,k.x),Math.max(S.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,k))return this;let L=this.transform.pointLocation3D(D),B=this.transform.pointLocation3D(A),U=this.transform.pointLocation3D(new t.P(D.x,A.y)),W=this.transform.pointLocation3D(new t.P(A.x,D.y)),Y=[Math.min(L.lng,B.lng,U.lng,W.lng),Math.min(L.lat,B.lat,U.lat,W.lat)],Z=[Math.max(L.lng,B.lng,U.lng,W.lng),Math.max(L.lat,B.lat,U.lat,W.lat)],X=v&&v.pitch?v.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,Y,Z,_,X,v);return this._fitInternal(Q,v,x)}_fitInternal(a,u,_){return a?(u=t.W(a,u)).linear?this.easeTo(u,_):this.flyTo(u,_):this}jumpTo(a,u){this.stop();let _=a.preloadOnly?this.transform.clone():this.transform,v=!1,x=!1,S=!1;return"zoom"in a&&_.zoom!==+a.zoom&&(v=!0,_.zoom=+a.zoom),a.center!==void 0&&(_.center=t.aI.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(x=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(S=!0,_.pitch=+a.pitch),a.padding==null||_.isPaddingEqual(a.padding)||(_.padding=a.padding),a.preloadOnly?(this._preloadTiles(_),this):(this.fire(new t.f("movestart",u)).fire(new t.f("move",u)),v&&this.fire(new t.f("zoomstart",u)).fire(new t.f("zoom",u)).fire(new t.f("zoomend",u)),x&&this.fire(new t.f("rotatestart",u)).fire(new t.f("rotate",u)).fire(new t.f("rotateend",u)),S&&this.fire(new t.f("pitchstart",u)).fire(new t.f("pitch",u)).fire(new t.f("pitchend",u)),this.fire(new t.f("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.w(zl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,u){let _=this.transform;if(!_.projection.supportsFreeCamera)return t.w(zl),this;this.stop();let v=_.zoom,x=_.pitch,S=_.bearing;_.setFreeCameraOptions(a);let k=v!==_.zoom,D=x!==_.pitch,A=S!==_.bearing;return this.fire(new t.f("movestart",u)).fire(new t.f("move",u)),k&&this.fire(new t.f("zoomstart",u)).fire(new t.f("zoom",u)).fire(new t.f("zoomend",u)),A&&this.fire(new t.f("rotatestart",u)).fire(new t.f("rotate",u)).fire(new t.f("rotateend",u)),D&&this.fire(new t.f("pitchstart",u)).fire(new t.f("pitch",u)).fire(new t.f("pitchend",u)),this.fire(new t.f("moveend",u)),this}easeTo(a,u){this._stop(!1,a.easeId),((a=t.W({offset:[0,0],duration:500,easing:t.d2},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);let _=this.transform,v=this.getZoom(),x=this.getBearing(),S=this.getPitch(),k=this.getPadding(),D="zoom"in a?+a.zoom:v,A="bearing"in a?this._normalizeBearing(a.bearing,x):x,L="pitch"in a?+a.pitch:S,B=this._extendPadding(a.padding),U=t.P.convert(a.offset),W,Y,Z;if(_.projection.name==="globe"){let le=t.Y.fromLngLat(_.center),we=U.rotate(-_.angle);le.x+=we.x/_.worldSize,le.y+=we.y/_.worldSize;let Re=le.toLngLat(),me=t.aI.convert(a.center||Re);this._normalizeCenter(me),W=_.centerPoint.add(we),Y=new t.P(le.x,le.y).mult(_.worldSize),Z=new t.P(t.aj(me.lng),t.ak(me.lat)).mult(_.worldSize).sub(Y)}else{W=_.centerPoint.add(U);let le=_.pointLocation(W),we=t.aI.convert(a.center||le);this._normalizeCenter(we),Y=_.project(le),Z=_.project(we).sub(Y)}let X=_.zoomScale(D-v),Q,re;a.around&&(Q=t.aI.convert(a.around),re=_.locationPoint(Q));let oe=this._zooming||D!==v,ae=this._rotating||x!==A,_e=this._pitching||L!==S,ge=!_.isPaddingEqual(B),ne=le=>we=>{if(oe&&(le.zoom=t.a2(v,D,we)),ae&&(le.bearing=t.a2(x,A,we)),_e&&(le.pitch=t.a2(S,L,we)),ge&&(le.interpolatePadding(k,B,we),W=le.centerPoint.add(U)),Q)le.setLocationAtPoint(Q,re);else{let Re=le.zoomScale(le.zoom-v),me=D>v?Math.min(2,X):Math.max(.5,X),Le=Math.pow(me,1-we),Be=le.unproject(Y.add(Z.mult(we*Le)).mult(Re));le.setLocationAtPoint(le.renderWorldCopies?Be.wrap():Be,W)}return a.preloadOnly||this._fireMoveEvents(u),le};if(a.preloadOnly){let le=this._emulate(ne,a.duration,_);return this._preloadTiles(le),this}let se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=ae,this._pitching=_e,this._padding=ge,this._easeId=a.easeId,this._prepareEase(u,a.noMoveStart,se),this._ease(ne(_),le=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(u,le)},a),this}_prepareEase(a,u,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||_.moving||this.fire(new t.f("movestart",a)),this._zooming&&!_.zooming&&this.fire(new t.f("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new t.f("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new t.f("pitchstart",a))}_fireMoveEvents(a){this.fire(new t.f("move",a)),this._zooming&&this.fire(new t.f("zoom",a)),this._rotating&&this.fire(new t.f("rotate",a)),this._pitching&&this.fire(new t.f("pitch",a))}_afterEase(a,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let _=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new t.f("zoomend",a)),v&&this.fire(new t.f("rotateend",a)),x&&this.fire(new t.f("pitchend",a)),this.fire(new t.f("moveend",a))}flyTo(a,u){if(this._prefersReducedMotion(a)){let Ve=t.ah(a,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Ve,u)}this.stop(),a=t.W({offset:[0,0],speed:1.2,curve:1.42,easing:t.d2},a);let _=this.transform,v=this.getZoom(),x=this.getBearing(),S=this.getPitch(),k=this.getPadding(),D="zoom"in a?t.at(+a.zoom,_.minZoom,_.maxZoom):v,A="bearing"in a?this._normalizeBearing(a.bearing,x):x,L="pitch"in a?+a.pitch:S,B=this._extendPadding(a.padding),U=_.zoomScale(D-v),W=t.P.convert(a.offset),Y=_.centerPoint.add(W),Z=_.pointLocation(Y),X=t.aI.convert(a.center||Z);this._normalizeCenter(X);let Q=_.project(Z),re=_.project(X).sub(Q),oe=a.curve,ae=Math.max(_.width,_.height),_e=ae/U,ge=re.mag();if("minZoom"in a){let Ve=t.at(Math.min(a.minZoom,v,D),_.minZoom,_.maxZoom),Ze=ae/_.zoomScale(Ve-v);oe=Math.sqrt(Ze/ge*2)}let ne=oe*oe;function se(Ve){let Ze=(_e*_e-ae*ae+(Ve?-1:1)*ne*ne*ge*ge)/(2*(Ve?_e:ae)*ne*ge);return Math.log(Math.sqrt(Ze*Ze+1)-Ze)}function le(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function we(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}let Re=se(0),me=function(Ve){return we(Re)/we(Re+oe*Ve)},Le=function(Ve){return ae*((we(Re)*(le(Ze=Re+oe*Ve)/we(Ze))-le(Re))/ne)/ge;var Ze},Be=(se(1)-Re)/oe;if(Math.abs(ge)<1e-6||!isFinite(Be)){if(Math.abs(ae-_e)<1e-6)return this.easeTo(a,u);let Ve=_e<ae?-1:1;Be=Math.abs(Math.log(_e/ae))/oe,Le=function(){return 0},me=function(Ze){return Math.exp(Ve*oe*Ze)}}a.duration="duration"in a?+a.duration:1e3*Be/("screenSpeed"in a?+a.screenSpeed/oe:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);let Qe=x!==A,Je=L!==S,Xe=!_.isPaddingEqual(B),Ee=Ve=>Ze=>{let bt=Ze*Be,vt=1/me(bt);Ve.zoom=Ze===1?D:v+Ve.scaleZoom(vt),Qe&&(Ve.bearing=t.a2(x,A,Ze)),Je&&(Ve.pitch=t.a2(S,L,Ze)),Xe&&(Ve.interpolatePadding(k,B,Ze),Y=Ve.centerPoint.add(W));let It=Ze===1?X:Ve.unproject(Q.add(re.mult(Le(bt))).mult(vt));return Ve.setLocationAtPoint(Ve.renderWorldCopies?It.wrap():It,Y),Ve._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(u),Ve};if(a.preloadOnly){let Ve=this._emulate(Ee,a.duration,_);return this._preloadTiles(Ve),this}return this._zooming=!0,this._rotating=Qe,this._pitching=Je,this._padding=Xe,this._prepareEase(u,!1),this._ease(Ee(_),()=>this._afterEase(u),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(a){}_cancelRenderFrame(a){}_stop(a,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,u)}if(!a){let _=this.handlers;_&&_.stop(!1)}return this}_ease(a,u,_){_.animate===!1||_.duration===0?(a(1),u()):(this._easeStart=t.e.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let a=Math.min((t.e.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,u){a=t.au(a,-180,180);let _=Math.abs(a-u);return Math.abs(a-360-u)<_&&(a-=360),Math.abs(a+360-u)<_&&(a+=360),a}_normalizeCenter(a){let u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;let _=a.lng-u.center.lng;a.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&t.e.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,u,_){let v=Math.ceil(15*u/1e3),x=[],S=a(_.clone());for(let k=0;k<=v;k++){let D=S(k/v);x.push(D.clone())}return x}_preloadTiles(a,u){}}class o0{constructor(a={}){this.options=a,t.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){let u=this.options&&this.options.compact;return this._map=a,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=z("button","mapboxgl-ctrl-attrib-button",this._container),z("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,u){let _=this._map._getUIString(`AttributionControl.${u}`);a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));let u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.d8.ACCESS_TOKEN}];if(a){let _=u.reduce((v,x,S)=>(x.value&&(v+=`${x.key}=${x.value}${S<u.length-1?"&":""}`),v),"?");a.href=`${t.d8.FEEDBACK_URL}/${_}#${Th(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let u=this._map.style._mergedSourceCaches;for(let v in u){let x=u[v];if(x.used){let S=x.getSource();S.attribution&&a.indexOf(S.attribution)<0&&a.push(S.attribution)}}a.sort((v,x)=>v.length-x.length),a=a.filter((v,x)=>{for(let S=x+1;S<a.length;S++)if(a[S].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));let _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class a0{constructor(){t.bp(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=z("div","mapboxgl-ctrl");let u=z("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(let u in a){let _=a[u].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){let a=this._container.children;if(a.length){let u=a[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class s0{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){let u=++this._id;return this._queue.push({callback:a,id:u,cancelled:!1}),u}remove(a){let u=this._currentlyRunning,_=u?this._queue.concat(u):this._queue;for(let v of _)if(v.id===a)return void(v.cancelled=!0)}run(a=0){let u=this._currentlyRunning=this._queue;this._queue=[];for(let _ of u)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function l0(f,a,u){if(f=new t.aI(f.lng,f.lat),a){let _=new t.aI(f.lng-360,f.lat),v=new t.aI(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-u.center.lng)/360),S=u.locationPoint(f).distSqr(a),k=a.x<0||a.y<0||a.x>u.width||a.y>u.height;u.locationPoint(_).distSqr(a)<S&&(k||Math.abs(_.lng-u.center.lng)<x)?f=_:u.locationPoint(v).distSqr(a)<S&&(k||Math.abs(v.lng-u.center.lng)<x)&&(f=v)}for(;Math.abs(f.lng-u.center.lng)>180;){let _=u.locationPoint(f);if(_.x>=0&&_.y>=0&&_.x<=u.width&&_.y<=u.height)break;f.lng>u.center.lng?f.lng-=360:f.lng+=360}return f}let Bf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class zh extends t.E{constructor(a,u){if(super(),(a instanceof HTMLElement||u)&&(a=t.W({element:a},u)),t.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=t.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=z("div");let x=41,S=27,k=q("svg",{display:"block",height:x*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${x}`},this._element),D=q("radialGradient",{id:"shadowGradient"},q("defs",{},k));q("stop",{offset:"10%","stop-opacity":.4},D),q("stop",{offset:"100%","stop-opacity":.05},D),q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=t.P.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});let _=this._element.classList;for(let x in Bf)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`);let v=a&&a.className?a.className.trim().split(/\s+/):[];_.add(...v),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){let a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=t.aI.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){let v=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){let u=a.code,_=a.charCode||a.keyCode;u!=="Space"&&u!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(a){let u=a.originalEvent.target,_=this._element;this._popup&&(u===_||_.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let a=this._map,u=this._pos;if(!a||!u)return!1;let _=a.unproject(u),v=a.getFreeCameraOptions();if(!v.position)return!1;let x=v.position.toLngLat();return x.distanceTo(_)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){let a=this._map;if(!a)return;let u=this._pos;if(!u||u.x<0||u.x>a.transform.width||u.y<0||u.y>a.transform.height)return void this._clearFadeTimer();let _=a.unproject(u),v;a._showingGlobe()&&t.d9(a.transform,this._lngLat)?v=0:(v=1-a._queryFogOpacity(_),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let a=this._pos;if(!a||!this._map)return;let u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${Bf[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){let a=this._pos,u=this._map,_=this.getPitchAlignment();if(!u||!a||_!=="map")return"";if(!u._showingGlobe()){let D=u.getPitch();return D?`rotateX(${D}deg)`:""}let v=t.b0(t.da(u.transform,this._lngLat)),x=a.sub(t.db(u.transform)),S=Math.abs(x.x)+Math.abs(x.y);if(S===0)return"";let k=v/S;return`rotateX(${-x.y*k}deg) rotateY(${x.x*k}deg)`}_calculateZTransform(){let a=this._pos,u=this._map;if(!u||!a)return"";let _=0,v=this.getRotationAlignment();if(v==="map")if(u._showingGlobe()){let x=u.project(new t.aI(this._lngLat.lng,this._lngLat.lat+.001)),S=u.project(new t.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);_=t.b0(Math.atan2(S.y,S.x))-90}else _=-u.getBearing();else if(v==="horizon"){let x=t.$(4,6,u.getZoom()),S=t.db(u.transform);S.y+=x*u.transform.height;let k=a.sub(S),D=t.b0(Math.atan2(k.y,k.x));_=(D>90?D-270:D+90)*(1-x)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(a){cancelAnimationFrame(this._updateFrameId);let u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=l0(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),a===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=t.P.convert(a),this._update(),this}addClassName(a){return this._element.classList.add(a),this}removeClassName(a){return this._element.classList.remove(a),this}toggleClassName(a){return this._element.classList.toggle(a)}_onMove(a){let u=this._map;if(!u)return;let _=this._pointerdownPos,v=this._positionDelta;if(_&&v){if(!this._isDragging){let x=this._clickTolerance||u._clickTolerance;if(a.point.dist(_)<x)return;this._isDragging=!0}this._pos=a.point.sub(v),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new t.f("dragstart"))),this.fire(new t.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new t.f("dragend")),this._state="inactive"}_addDragHandler(a){let u=this._map,_=this._pos;u&&_&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(_),this._pointerdownPos=a.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;let u=this._map;return u&&(a?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Nf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},c0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Bl(f=new t.P(0,0),a="bottom"){if(typeof f=="number"){let u=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(a){case"top":return new t.P(0,f);case"top-left":return new t.P(u,u);case"top-right":return new t.P(-u,u);case"bottom":return new t.P(0,-f);case"bottom-left":return new t.P(u,-u);case"bottom-right":return new t.P(-u,-u);case"left":return new t.P(f,0);case"right":return new t.P(-f,0)}return new t.P(0,0)}return f instanceof t.P||Array.isArray(f)?t.P.convert(f):t.P.convert(f[a]||[0,0])}class d0{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;let u=t.b9((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,u,_){this._start=this.getValue(u),this._end=a,this._startTime=u,this._endTime=u+_}}let h0={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class u0{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let Vf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},Nl={showCompass:!0,showZoom:!0,visualizePitch:!1};class m0{constructor(a,u,_=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new Df({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,_&&(this.mousePitch=new Fl({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),t.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(a,u){this.mouseRotate.mousedown(a,u),this.mousePitch&&this.mousePitch.mousedown(a,u),Ie()}move(a,u){let _=this.map,v=this.mouseRotate.mousemoveWindow(a,u),x=v&&v.bearingDelta;if(x&&_.setBearing(_.getBearing()+x),this.mousePitch){let S=this.mousePitch.mousemoveWindow(a,u),k=S&&S.pitchDelta;k&&_.setPitch(_.getPitch()+k)}}off(){let a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Me(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(t.W({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),ht(this.element,a)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,ht(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Mt(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=Mt(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Vl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},p0={maxWidth:100,unit:"metric"},dm={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:t.dt,supported:C,setRTLTextPlugin:t.dv,getRTLTextPluginStatus:t.dw,Map:class extends mx{constructor(f){t.dc.mark(t.dd.create);let a=f;if((f=t.W({},Vf,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&t.de(window)&&(f.antialias=!1,t.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ja(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new s0,this._domRenderTaskQueue=new s0,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.df(),this._locale=t.W({},h0,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new d0(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new t.dg(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Xi({},f.contextCreateOptions):{},typeof f.container=="string"){let u=document.getElementById(f.container);if(!u)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=u}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&t.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),t.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new u0),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new r0(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||t.d8.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new hx(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){a.center==null&&a.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});let u=f.bounds;u&&(this.resize(),this.fitBounds(u,t.W({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new o0({customAttribution:f.customAttribution})),this._logoControl=new a0,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new t.f(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new t.f(`${u.dataType}dataloading`,u))})}_getMapId(){return this._mapId}addControl(f,a){if(a===void 0&&(a=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new t.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let u=f.onAdd(this);this._controls.push(f);let _=this._controlPositions[a];return a.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new t.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let a=this._controls.indexOf(f);return a>-1&&this._controls.splice(a,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let a=!this._moving;return a&&this.fire(new t.f("movestart",f)).fire(new t.f("move",f)),this.fire(new t.f("resize",f)),a&&this.fire(new t.f("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(t.ai.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new t.f("zoomstart")).fire(new t.f("zoom")).fire(new t.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new t.f("zoomstart")).fire(new t.f("zoom")).fire(new t.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new t.f("pitchstart")).fire(new t.f("pitch")).fire(new t.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new t.f("pitchstart")).fire(new t.f("pitch")).fire(new t.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(a=>a==="auto"?navigator.language:a):f}setLanguage(f){let a=this._parseLanguage(f);if(!this.style||a===this._language)return this;this._language=a,this.style.reloadSources();for(let u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let f=this.transform,a=f.projection.name,u;a==="globe"&&f.zoom>=t.aU?(f.setMercatorFromTransition(),u=!0):a==="mercator"&&f.zoom<t.aU&&(f.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,a){return this._updateProjection(f||a||{name:"mercator"})}_updateProjection(f){let a;return a=f.name==="globe"&&this.transform.zoom>=t.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),a&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(t.aI.convert(f))}unproject(f){return this.transform.pointLocation3D(t.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,a,u){if(f==="mouseenter"||f==="mouseover"){let _=!1,v=S=>{let k=a.filter(A=>this.getLayer(A)),D=k.length?this.queryRenderedFeatures(S.point,{layers:k}):[];D.length?_||(_=!0,u.call(this,new Wr(f,this,S.originalEvent,{features:D}))):_=!1},x=()=>{_=!1};return{layers:new Set(a),listener:u,delegates:{mousemove:v,mouseout:x}}}if(f==="mouseleave"||f==="mouseout"){let _=!1,v=S=>{let k=a.filter(D=>this.getLayer(D));(k.length?this.queryRenderedFeatures(S.point,{layers:k}):[]).length?_=!0:_&&(_=!1,u.call(this,new Wr(f,this,S.originalEvent)))},x=S=>{_&&(_=!1,u.call(this,new Wr(f,this,S.originalEvent)))};return{layers:new Set(a),listener:u,delegates:{mousemove:v,mouseout:x}}}{let _=v=>{let x=a.filter(k=>this.getLayer(k)),S=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];S.length&&(v.features=S,u.call(this,v),delete v.features)};return{layers:new Set(a),listener:u,delegates:{[f]:_}}}}on(f,a,u){if(typeof a=="function"||u===void 0)return super.on(f,a);if(Array.isArray(a)||(a=[a]),a){for(let v of a)if(!this._isValidId(v))return this}let _=this._createDelegatedListener(f,a,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(_);for(let v in _.delegates)this.on(v,_.delegates[v]);return this}once(f,a,u){if(typeof a=="function"||u===void 0)return super.once(f,a);if(Array.isArray(a)||(a=[a]),a){for(let v of a)if(!this._isValidId(v))return this}let _=this._createDelegatedListener(f,a,u);for(let v in _.delegates)this.once(v,_.delegates[v]);return this}off(f,a,u){if(typeof a=="function"||u===void 0)return super.off(f,a);let _=new Set(Array.isArray(a)?a:[a]);for(let S of _)if(!this._isValidId(S))return this;let v=(S,k)=>{if(S.size!==k.size)return!1;for(let D of S)if(!k.has(D))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[f]:void 0;return x&&(S=>{for(let k=0;k<S.length;k++){let D=S[k];if(D.listener===u&&v(D.layers,_)){for(let A in D.delegates)this.off(A,D.delegates[A]);return S.splice(k,1),this}}})(x),this}queryRenderedFeatures(f,a){if(!this.style)return[];if(a!==void 0||f===void 0||f instanceof t.P||Array.isArray(f)||(a=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],(a=a||{}).layers&&Array.isArray(a.layers)){for(let u of a.layers)if(!this._isValidId(u))return[]}return this.style.queryRenderedFeatures(f,a,this.transform)}querySourceFeatures(f,a){return this._isValidId(f)?this.style.querySourceFeatures(f,a):[]}isPointOnSurface(f){let{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&t.w(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.P.convert(f))}setStyle(f,a){return a=t.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a),this.style&&f&&a.diff!==!1&&a.localFontFamily===this._localFontFamily&&a.localIdeographFontFamily===this._localIdeographFontFamily&&!a.config?(this.style._diffStyle(f,(u,_)=>{u?(t.w(`Unable to perform style diff: ${String(u.message||u.error||u)}. Rebuilding the style from scratch.`),this._updateStyle(f,a)):_&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(f,a))}_getUIString(f){let a=this._locale[f];if(a==null)throw new Error(`Missing UI string '${f}'`);return a}_updateStyle(f,a){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){let u=t.W({},a);a&&a.config&&(u.initialConfig=a.config,delete u.config),this.style=new Sa(this,u).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Sa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new t.d(new Error("IDs can't be empty."))),!1):!t.cV(f)||(this.fire(new t.d(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}addSource(f,a){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,a),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,a,u){this._lazyInitEmptyStyle(),this.style.addSourceType(f,a,u)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,a,{pixelRatio:u=1,sdf:_=!1,stretchX:v,stretchY:x,content:S}={}){if(this._lazyInitEmptyStyle(),a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap){let{width:k,height:D,data:A}=t.e.getImageData(a);this.style.addImage(f,{data:new t.i({width:k,height:D},A),pixelRatio:u,stretchX:v,stretchY:x,content:S,sdf:_,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new t.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:k,height:D}=a,A=a;this.style.addImage(f,{data:new t.i({width:k,height:D},new Uint8Array(A.data)),pixelRatio:u,stretchX:v,stretchY:x,content:S,sdf:_,version:0,userImage:A}),A.onAdd&&A.onAdd(this,f)}}updateImage(f,a){this._lazyInitEmptyStyle();let u=this.style.getImage(f);if(!u)return void this.fire(new t.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap?t.e.getImageData(a):a,{width:v,height:x,data:S}=_;if(v===void 0||x===void 0)return void this.fire(new t.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==u.data.width||x!==u.data.height)return void this.fire(new t.d(new Error(`The width and height of the updated image (${v}, ${x})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));let k=!(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap);u.data.replace(S,k),this.style.updateImage(f,u)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new t.d(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,a){t.h(this._requestManager.transformRequest(f,t.R.Image),(u,_)=>{a(u,_ instanceof HTMLImageElement?t.e.getImageData(_):_)})}listImages(){return this.style.listImages()}addModel(f,a){this._lazyInitEmptyStyle(),this.style.addModel(f,a)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new t.d(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,a){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,a),this._update(!0)):this}getSlot(f){let a=this.getLayer(f);return a&&a.slot||null}setSlot(f,a){return this.style.setSlot(f,a),this.style.mergeLayers(),this._update(!0)}addImport(f,a){return this.style.addImport(f,a),this}updateImport(f,a){return typeof a!="string"&&a.id!==f?(this.removeImport(f),this.addImport(a)):(this.style.updateImport(f,a),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,a){return this.style.moveImport(f,a),this._update(!0)}moveLayer(f,a){return this._isValidId(f)?(this.style.moveLayer(f,a),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){return this._isValidId(f)?this.style.getOwnLayer(f):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,a,u){return this._isValidId(f)?(this.style.setLayerZoomRange(f,a,u),this._update(!0)):this}setFilter(f,a,u={}){return this._isValidId(f)?(this.style.setFilter(f,a,u),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,a,u,_={}){return this._isValidId(f)?(this.style.setPaintProperty(f,a,u,_),this._update(!0)):this}getPaintProperty(f,a){return this._isValidId(f)?this.style.getPaintProperty(f,a):null}setLayoutProperty(f,a,u,_={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,a,u,_),this._update(!0)):this}getLayoutProperty(f,a){return this._isValidId(f)?this.style.getLayoutProperty(f,a):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,a){return this.style.setSchema(f,a),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,a){return this.style.setConfig(f,a),this._update(!0)}getConfigProperty(f,a){return this.style.getConfigProperty(f,a)}setConfigProperty(f,a,u){return this.style.setConfigProperty(f,a,u),this._update(!0)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){let a=f[0];a.properties?this.style.setFlatLight(a.properties,a.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,a={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.aI.convert(f),this.transform):0}setFeatureState(f,a){return this._isValidId(f.source)?(this.style.setFeatureState(f,a),this._update()):this}removeFeatureState(f,a){return this._isValidId(f.source)?(this.style.removeFeatureState(f,a),this._update()):this}getFeatureState(f){return this._isValidId(f.source)?this.style.getFeatureState(f):null}_updateContainerDimensions(){if(!this._container)return;let f=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300,u,_,v,x=this._container;for(;x&&(!_||!v);){let S=window.getComputedStyle(x).transform;S&&S!=="none"&&(u=S.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(_=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(v=u[3])),x=x.parentElement}this._containerWidth=_?Math.abs(f/_):f,this._containerHeight=v?Math.abs(a/v):a}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&t.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=z("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();let a=this._canvasContainer=z("div","mapboxgl-canvas-container",f);this._canvas=z("canvas","mapboxgl-canvas",a),this._interactive&&(a.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let u=this._controlContainer=z("div","mapboxgl-control-container",f),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{_[v]=z("div",`mapboxgl-ctrl-${v}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,a){let u=t.e.devicePixelRatio||1;this._canvas.width=u*Math.ceil(f),this._canvas.height=u*Math.ceil(a),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${a}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){let a=this._markers.indexOf(f);a!==-1&&this._markers.splice(a,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){let a=this._popups.indexOf(f);a!==-1&&this._popups.splice(a,1)}_setupPainter(){let f=t.W({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl2",f);a?(t.dh(a,!0),this.painter=new V_(a,this._contextCreateOptions,this.transform,this._tp),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),t.di.testSupport(a)):this.fire(new t.d(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.f("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new t.f("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let a;this.fire(new t.f("renderstart")),++this._frameId;let u=this.painter.context.extTimerQuery,_=t.e.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(a=v.createQuery(),v.beginQuery(u.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();let x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let A=this.transform.zoom,L=this.transform.pitch,B=t.e.now(),U=new t.X(A,{now:B,fadeDuration:x,pitch:L,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(_),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(_);let k=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource);if(k&&(this._placementDirty=k.needsRerender,this._occlusionOpacityChanged=k.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.dc.mark(t.dd.load),this.fire(new t.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){let A=t.e.now()-_;v.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{let L=v.getQueryParameter(a,v.QUERY_RESULT)/1e6;v.deleteQuery(a),this.fire(new t.f("gpu-timing-frame",{cpuTime:A,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){let A=this.painter.collectGpuTimers();setTimeout(()=>{let L=this.painter.queryGpuTimers(A);this.fire(new t.f("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){let A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let L=this.painter.queryGpuTimeDeferredRender(A);this.fire(new t.f("gpu-timing-deferred-render",{gpuTime:L}))},50)}let D=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||S;if((this._sourcesDirty||this._styleDirty||S||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),D||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let A=!this.isMoving()&&this.loaded();if(A&&(S=this._updateAverageElevation(_,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new t.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let L=this._calculateSpeedIndex();this.fire(new t.f("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!D&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,t.dc.mark(t.dd.fullLoad),this._performanceMetricsCollection&&t.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(let a of this._markers)f&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(let a of this._popups)!f||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(f,a=!1){let u=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);let _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(a||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){let v=this.transform.averageElevation,x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=f;let S=Math.abs(v-x);if(S>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(x),u(x);this._averageElevation.easeTo(x,f,300)}else if(S>1e-4)return this._averageElevation.jumpTo(x),u(x)}return!!this._averageElevation.isEasing(f)&&u(this._averageElevation.getValue(f))}_authenticate(){t.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===t.dl||f.status===401)){let a=this.painter.context.gl;t.dh(a,!1),this._logoControl instanceof a0&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),t.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&t.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){let f=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());let u=this.painter.context.gl,_=u.createFramebuffer();function v(x){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,x,0);let S=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,S),S}return u.bindFramebuffer(u.FRAMEBUFFER,_),this._canvasPixelComparison(v(f),a.canvasCopies.map(v),a.timeStamps)}_canvasPixelComparison(f,a,u){let _=u[1]-u[0],v=f.length/4;for(let x=0;x<a.length;x++){let S=a[x],k=0;for(let D=0;D<S.length;D+=4)S[D]===f[D]&&S[D+1]===f[D+1]&&S[D+2]===f[D+2]&&S[D+3]===f[D+3]&&(k+=1);_+=(u[x+2]-u[x+1])*(1-k/v)}return _}remove(){this._hash&&this._hash.remove();for(let a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),t.dp(this.painter.context.gl),t.dq.remove(),t.dr.remove(),this._removed=!0,this.fire(new t.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=t.e.frame(a=>{let u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(a)}))}_preloadTiles(f){let a=this.style?this.style.getSourceCaches():[];return t.ds(a,(u,_)=>u._preloadTiles(f,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,a){t.du(f,a)}_occlusionCriteriaSatisfied(){let f=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&f&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return t.dt}},NavigationControl:class{constructor(f){this.options=t.W({},Nl,f),this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(t.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{let u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:a}):u.resetNorth({},{originalEvent:a}))}),this._compassIcon=z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let f=this._map;if(!f)return;let a=f.getZoom(),u=a===f.getMaxZoom(),_=a===f.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){let f=this._map;if(!f)return;let a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new m0(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){let f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,a){let u=z("button",f,this._container);return u.type="button",u.addEventListener("click",a),u}_setButtonTitle(f,a){if(!this._map)return;let u=this._map._getUIString(`NavigationControl.${a}`);f.setAttribute("aria-label",u),f.firstElementChild&&f.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends t.E{constructor(f){super();let a=navigator.geolocation;this.options=t.W({geolocation:a},Vl,f),t.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=kf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){let a=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,f(u)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>a(u.state!=="denied")).catch(()=>a()):a()}_isOutOfMapMaxBounds(f){let a=this._map.getMaxBounds(),u=f.coords;return!!a&&(u.longitude<a.getWest()||u.longitude>a.getEast()||u.latitude<a.getSouth()||u.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new t.f("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.f("geolocate",f)),this._finish()}}_updateCamera(f){let a=new t.aI(f.coords.longitude,f.coords.latitude),u=f.coords.accuracy,_=this._map.getBearing(),v=t.W({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(u),v,{geolocateSource:!0})}_updateMarker(f){if(f){let a=new t.aI(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let f=this._map.transform,a=t.ax(1,f._center.lat)*f.worldSize,u=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.f("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=z("button","mapboxgl-ctrl-geolocate",this._container),z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{let a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z("div","mapboxgl-user-location"),this._dotElement.appendChild(z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new zh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.f("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:o0,ScaleControl:class{constructor(f){this.options=t.W({},p0,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),t.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let f=this.options.maxWidth||100,a=this._map,u=a._containerHeight/2,_=a._containerWidth/2-f/2,v=a.unproject([_,u]),x=a.unproject([_+f,u]),S=v.distanceTo(x);if(this.options.unit==="imperial"){let k=3.2808*S;k>5280?this._setScale(f,k/5280,"mile"):this._setScale(f,k,"foot")}else this.options.unit==="nautical"?this._setScale(f,S/1852,"nautical-mile"):S>=1e3?this._setScale(f,S/1e3,"kilometer"):this._setScale(f,S,"meter")}_setScale(f,a,u){this._map._requestDomTask(()=>{let _=function(x){let S=Math.pow(10,`${Math.floor(x)}`.length-1),k=x/S;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(D){let A=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*A)/A}(k),S*k}(a),v=_/a;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(_):`${_}&nbsp;${dm[u]}`,this._container.style.width=f*v+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:t.w("Full screen control 'container' must be a DOM element.")),t.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let f=this._fullscreenButton=z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);z("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.E{constructor(f){super(),this.options=t.W(Object.create(Nf),f),t.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new t.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new t.f("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=t.aI.convert(f),this._pos=null,this._trackPointer=!1,this._update();let a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){let a=document.createDocumentFragment(),u=document.createElement("body"),_;for(u.innerHTML=f;_=u.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=z("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(f),this.options.closeButton){let u=this._closeButton=z("button","mapboxgl-popup-close-button",a);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let a;return this._classList.delete(f)?a=!1:(this._classList.add(f),a=!0),this._updateClassList(),a}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;let a=this._map,u=this._container,_=this._pos;if(!a||!u||!_)return"bottom";let v=u.offsetWidth,x=u.offsetHeight,S=_.x<v/2,k=_.x>a.transform.width-v/2;if(_.y+f<x)return S?"top-left":k?"top-right":"top";if(_.y>a.transform.height-x){if(S)return"bottom-left";if(k)return"bottom-right"}return S?"left":k?"right":"bottom"}_updateClassList(){let f=this._container;if(!f)return;let a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),f.className=a.join(" ")}_update(f){let a=this._map,u=this._content;if(!a||!this._lngLat&&!this._trackPointer||!u)return;let _=this._container;if(_||(_=this._container=z("div","mapboxgl-popup",a.getContainer()),this._tip=z("div","mapboxgl-popup-tip",_),_.appendChild(u)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=l0(this._lngLat,this._pos,a.transform)),!this._trackPointer||f){let v=this._pos=this._trackPointer&&f?f:a.project(this._lngLat),x=Bl(this.options.offset),S=this._anchor=this._getAnchor(x.y),k=Bl(this.options.offset,S),D=v.add(k).round();a._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Bf[S]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&a._showingGlobe()){let v=t.d9(a.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(c0);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:zh,Style:Sa,LngLat:t.aI,LngLatBounds:t.ai,Point:t.P,MercatorCoordinate:t.Y,FreeCameraOptions:Hp,Evented:t.E,config:t.d8,prewarm:t.dx,clearPrewarmedResources:t.dy,get accessToken(){return t.d8.ACCESS_TOKEN},set accessToken(f){t.d8.ACCESS_TOKEN=f},get baseApiUrl(){return t.d8.API_URL},set baseApiUrl(f){t.d8.API_URL=f},get workerCount(){return t.dz.workerCount},set workerCount(f){t.dz.workerCount=f},get maxParallelImageRequests(){return t.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){t.d8.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){t.dA(f)},get workerUrl(){return t.dB.workerUrl},set workerUrl(f){t.dB.workerUrl=f},get workerClass(){return t.dB.workerClass},set workerClass(f){t.dB.workerClass=f},get workerParams(){return t.dB.workerParams},set workerParams(f){t.dB.workerParams=f},get dracoUrl(){return t.dC()},set dracoUrl(f){t.dD(f)},get meshoptUrl(){return t.dE()},set meshoptUrl(f){t.dF(f)},setNow:t.e.setNow,restoreNow:t.e.restoreNow}});var l=c;return l})});var xF=(()=>{let o=class o extends Fb{constructor(r,l,t){super(r,l,t,Tn(Mb,{optional:!0}))}ngOnDestroy(){this.flush()}};o.\u0275fac=function(l){return new(l||o)(at(gn),at(Ag),at(Lb))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac});let d=o;return d})();function wF(){return new aT}function CF(d,o,c){return new lT(d,o,c)}var pT=[{provide:Lb,useFactory:wF},{provide:Fb,useClass:xF},{provide:kb,useFactory:CF,deps:[Pb,Fb,Bi]}],mT=[{provide:Ag,useFactory:()=>new sT},{provide:co,useValue:"BrowserAnimations"},...pT],SF=[{provide:Ag,useClass:oT},{provide:co,useValue:"NoopAnimations"},...pT],fT=(()=>{let o=class o{static withConfig(r){return{ngModule:o,providers:r.disableAnimations?SF:mT}}};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({providers:mT,imports:[Ob]});let d=o;return d})();var vw;try{vw=typeof Intl<"u"&&Intl.v8BreakIterator}catch{vw=!1}var ir=(()=>{let o=class o{constructor(r){this._platformId=r,this.isBrowser=this._platformId?qI(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||vw)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};o.\u0275fac=function(l){return new(l||o)(at(Md))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var Pg;function MF(){if(Pg==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Pg=!0}))}finally{Pg=Pg||!1}return Pg}function dl(d){return MF()?d:!!d.capture}var nu;function gT(){if(nu==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return nu=!1,nu;if("scrollBehavior"in document.documentElement.style)nu=!0;else{let d=Element.prototype.scrollTo;d?nu=!/\{\s*\[native code\]\s*\}/.test(d.toString()):nu=!1}}return nu}var yw;function kF(){if(yw==null){let d=typeof document<"u"?document.head:null;yw=!!(d&&(d.createShadowRoot||d.attachShadow))}return yw}function _T(d){if(kF()){let o=d.getRootNode?d.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&o instanceof ShadowRoot)return o}return null}function ru(){let d=typeof document<"u"&&document?document.activeElement:null;for(;d&&d.shadowRoot;){let o=d.shadowRoot.activeElement;if(o===d)break;d=o}return d}function Os(d){return d.composedPath?d.composedPath()[0]:d.target}function Og(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function $m(d,...o){return o.length?o.some(c=>d[c]):d.altKey||d.shiftKey||d.ctrlKey||d.metaKey}function Rg(d,o=0){return IF(d)?Number(d):o}function IF(d){return!isNaN(parseFloat(d))&&!isNaN(Number(d))}function Ym(d){return Array.isArray(d)?d:[d]}function Br(d){return d==null?"":typeof d=="string"?d:`${d}px`}function tc(d){return d instanceof hn?d.nativeElement:d}var TF=(()=>{let o=class o{create(r){return typeof MutationObserver>"u"?null:new MutationObserver(r)}};o.\u0275fac=function(l){return new(l||o)},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var Ub=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({providers:[TF]});let d=o;return d})();var bT=new Set,ou,EF=(()=>{let o=class o{constructor(r,l){this._platform=r,this._nonce=l,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):AF}matchMedia(r){return(this._platform.WEBKIT||this._platform.BLINK)&&DF(r,this._nonce),this._matchMedia(r)}};o.\u0275fac=function(l){return new(l||o)(at(ir),at(DI,8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();function DF(d,o){if(!bT.has(d))try{ou||(ou=document.createElement("style"),o&&ou.setAttribute("nonce",o),ou.setAttribute("type","text/css"),document.head.appendChild(ou)),ou.sheet&&(ou.sheet.insertRule(`@media ${d} {body{ }}`,0),bT.add(d))}catch(c){console.error(c)}}function AF(d){return{matches:d==="all"||d==="",media:d,addListener:()=>{},removeListener:()=>{}}}var vT=(()=>{let o=class o{constructor(r,l){this._mediaMatcher=r,this._zone=l,this._queries=new Map,this._destroySubject=new Ln}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(r){return yT(Ym(r)).some(t=>this._registerQuery(t).mql.matches)}observe(r){let t=yT(Ym(r)).map(C=>this._registerQuery(C).observable),g=wI(t);return g=vb(g.pipe(Qa(1)),g.pipe(wb(1),nw(0))),g.pipe(Nm(C=>{let I={matches:!1,breakpoints:{}};return C.forEach(({matches:O,query:z})=>{I.matches=I.matches||O,I.breakpoints[z]=O}),I}))}_registerQuery(r){if(this._queries.has(r))return this._queries.get(r);let l=this._mediaMatcher.matchMedia(r),g={observable:new vo(C=>{let I=O=>this._zone.run(()=>C.next(O));return l.addListener(I),()=>{l.removeListener(I)}}).pipe(Ts(l),Nm(({matches:C})=>({query:r,matches:C})),tu(this._destroySubject)),mql:l};return this._queries.set(r,g),g}};o.\u0275fac=function(l){return new(l||o)(at(EF),at(Bi))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();function yT(d){return d.map(o=>o.split(",")).reduce((o,c)=>o.concat(c)).map(o=>o.trim())}var Lg=(()=>{let o=class o{constructor(r){this._platform=r}isDisabled(r){return r.hasAttribute("disabled")}isVisible(r){return OF(r)&&getComputedStyle(r).visibility==="visible"}isTabbable(r){if(!this._platform.isBrowser)return!1;let l=PF(jF(r));if(l&&(xT(l)===-1||!this.isVisible(l)))return!1;let t=r.nodeName.toLowerCase(),g=xT(r);return r.hasAttribute("contenteditable")?g!==-1:t==="iframe"||t==="object"||this._platform.WEBKIT&&this._platform.IOS&&!NF(r)?!1:t==="audio"?r.hasAttribute("controls")?g!==-1:!1:t==="video"?g===-1?!1:g!==null?!0:this._platform.FIREFOX||r.hasAttribute("controls"):r.tabIndex>=0}isFocusable(r,l){return VF(r)&&!this.isDisabled(r)&&(l?.ignoreVisibility||this.isVisible(r))}};o.\u0275fac=function(l){return new(l||o)(at(ir))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();function PF(d){try{return d.frameElement}catch{return null}}function OF(d){return!!(d.offsetWidth||d.offsetHeight||typeof d.getClientRects=="function"&&d.getClientRects().length)}function RF(d){let o=d.nodeName.toLowerCase();return o==="input"||o==="select"||o==="button"||o==="textarea"}function LF(d){return zF(d)&&d.type=="hidden"}function FF(d){return BF(d)&&d.hasAttribute("href")}function zF(d){return d.nodeName.toLowerCase()=="input"}function BF(d){return d.nodeName.toLowerCase()=="a"}function ST(d){if(!d.hasAttribute("tabindex")||d.tabIndex===void 0)return!1;let o=d.getAttribute("tabindex");return!!(o&&!isNaN(parseInt(o,10)))}function xT(d){if(!ST(d))return null;let o=parseInt(d.getAttribute("tabindex")||"",10);return isNaN(o)?-1:o}function NF(d){let o=d.nodeName.toLowerCase(),c=o==="input"&&d.type;return c==="text"||c==="password"||o==="select"||o==="textarea"}function VF(d){return LF(d)?!1:RF(d)||FF(d)||d.hasAttribute("contenteditable")||ST(d)}function jF(d){return d.ownerDocument&&d.ownerDocument.defaultView||window}var ww=class{get enabled(){return this._enabled}set enabled(o){this._enabled=o,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(o,this._startAnchor),this._toggleAnchorTabIndex(o,this._endAnchor))}constructor(o,c,r,l,t=!1){this._element=o,this._checker=c,this._ngZone=r,this._document=l,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,t||this.attachAnchors()}destroy(){let o=this._startAnchor,c=this._endAnchor;o&&(o.removeEventListener("focus",this.startAnchorListener),o.remove()),c&&(c.removeEventListener("focus",this.endAnchorListener),c.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(o){return new Promise(c=>{this._executeOnStable(()=>c(this.focusInitialElement(o)))})}focusFirstTabbableElementWhenReady(o){return new Promise(c=>{this._executeOnStable(()=>c(this.focusFirstTabbableElement(o)))})}focusLastTabbableElementWhenReady(o){return new Promise(c=>{this._executeOnStable(()=>c(this.focusLastTabbableElement(o)))})}_getRegionBoundary(o){let c=this._element.querySelectorAll(`[cdk-focus-region-${o}], [cdkFocusRegion${o}], [cdk-focus-${o}]`);return o=="start"?c.length?c[0]:this._getFirstTabbableElement(this._element):c.length?c[c.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(o){let c=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(c){if(!this._checker.isFocusable(c)){let r=this._getFirstTabbableElement(c);return r?.focus(o),!!r}return c.focus(o),!0}return this.focusFirstTabbableElement(o)}focusFirstTabbableElement(o){let c=this._getRegionBoundary("start");return c&&c.focus(o),!!c}focusLastTabbableElement(o){let c=this._getRegionBoundary("end");return c&&c.focus(o),!!c}hasAttached(){return this._hasAttached}_getFirstTabbableElement(o){if(this._checker.isFocusable(o)&&this._checker.isTabbable(o))return o;let c=o.children;for(let r=0;r<c.length;r++){let l=c[r].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(c[r]):null;if(l)return l}return null}_getLastTabbableElement(o){if(this._checker.isFocusable(o)&&this._checker.isTabbable(o))return o;let c=o.children;for(let r=c.length-1;r>=0;r--){let l=c[r].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(c[r]):null;if(l)return l}return null}_createAnchor(){let o=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,o),o.classList.add("cdk-visually-hidden"),o.classList.add("cdk-focus-trap-anchor"),o.setAttribute("aria-hidden","true"),o}_toggleAnchorTabIndex(o,c){o?c.setAttribute("tabindex","0"):c.removeAttribute("tabindex")}toggleAnchors(o){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(o,this._startAnchor),this._toggleAnchorTabIndex(o,this._endAnchor))}_executeOnStable(o){this._ngZone.isStable?o():this._ngZone.onStable.pipe(Qa(1)).subscribe(o)}},Fg=(()=>{let o=class o{constructor(r,l,t){this._checker=r,this._ngZone=l,this._document=t}create(r,l=!1){return new ww(r,this._checker,this._ngZone,this._document,l)}};o.\u0275fac=function(l){return new(l||o)(at(Lg),at(Bi),at(gn))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),MT=(()=>{let o=class o{get enabled(){return this.focusTrap?.enabled||!1}set enabled(r){this.focusTrap&&(this.focusTrap.enabled=r)}constructor(r,l,t){this._elementRef=r,this._focusTrapFactory=l,this._previouslyFocusedElement=null,Tn(ir).isBrowser&&(this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0))}ngOnDestroy(){this.focusTrap?.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap?.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap&&!this.focusTrap.hasAttached()&&this.focusTrap.attachAnchors()}ngOnChanges(r){let l=r.autoCapture;l&&!l.firstChange&&this.autoCapture&&this.focusTrap?.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=ru(),this.focusTrap?.focusInitialElementWhenReady()}};o.\u0275fac=function(l){return new(l||o)(fe(hn),fe(Fg),fe(gn))},o.\u0275dir=dr({type:o,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:[Qi.HasDecoratorInputTransform,"cdkTrapFocus","enabled",ho],autoCapture:[Qi.HasDecoratorInputTransform,"cdkTrapFocusAutoCapture","autoCapture",ho]},exportAs:["cdkTrapFocus"],standalone:!0,features:[Ao,Do]});let d=o;return d})();function Cw(d){return d.buttons===0||d.detail===0}function Sw(d){let o=d.touches&&d.touches[0]||d.changedTouches&&d.changedTouches[0];return!!o&&o.identifier===-1&&(o.radiusX==null||o.radiusX===1)&&(o.radiusY==null||o.radiusY===1)}var UF=new bn("cdk-input-modality-detector-options"),WF={ignoreKeys:[18,17,224,91,16]},kT=650,Zm=dl({passive:!0,capture:!0}),HF=(()=>{let o=class o{get mostRecentModality(){return this._modality.value}constructor(r,l,t,g){this._platform=r,this._mostRecentTarget=null,this._modality=new Mg(null),this._lastTouchMs=0,this._onKeydown=C=>{this._options?.ignoreKeys?.some(I=>I===C.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Os(C))},this._onMousedown=C=>{Date.now()-this._lastTouchMs<kT||(this._modality.next(Cw(C)?"keyboard":"mouse"),this._mostRecentTarget=Os(C))},this._onTouchstart=C=>{if(Sw(C)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Os(C)},this._options=Xi(Xi({},WF),g),this.modalityDetected=this._modality.pipe(wb(1)),this.modalityChanged=this.modalityDetected.pipe(rw()),r.isBrowser&&l.runOutsideAngular(()=>{t.addEventListener("keydown",this._onKeydown,Zm),t.addEventListener("mousedown",this._onMousedown,Zm),t.addEventListener("touchstart",this._onTouchstart,Zm)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Zm),document.removeEventListener("mousedown",this._onMousedown,Zm),document.removeEventListener("touchstart",this._onTouchstart,Zm))}};o.\u0275fac=function(l){return new(l||o)(at(ir),at(Bi),at(gn),at(UF,8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var Hb=function(d){return d[d.IMMEDIATE=0]="IMMEDIATE",d[d.EVENTUAL=1]="EVENTUAL",d}(Hb||{}),GF=new bn("cdk-focus-monitor-default-options"),Wb=dl({passive:!0,capture:!0}),ic=(()=>{let o=class o{constructor(r,l,t,g,C){this._ngZone=r,this._platform=l,this._inputModalityDetector=t,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Ln,this._rootNodeFocusAndBlurListener=I=>{let O=Os(I);for(let z=O;z;z=z.parentElement)I.type==="focus"?this._onFocus(I,z):this._onBlur(I,z)},this._document=g,this._detectionMode=C?.detectionMode||Hb.IMMEDIATE}monitor(r,l=!1){let t=tc(r);if(!this._platform.isBrowser||t.nodeType!==1)return tr();let g=_T(t)||this._getDocument(),C=this._elementInfo.get(t);if(C)return l&&(C.checkChildren=!0),C.subject;let I={checkChildren:l,subject:new Ln,rootNode:g};return this._elementInfo.set(t,I),this._registerGlobalListeners(I),I.subject}stopMonitoring(r){let l=tc(r),t=this._elementInfo.get(l);t&&(t.subject.complete(),this._setClasses(l),this._elementInfo.delete(l),this._removeGlobalListeners(t))}focusVia(r,l,t){let g=tc(r),C=this._getDocument().activeElement;g===C?this._getClosestElementsInfo(g).forEach(([I,O])=>this._originChanged(I,l,O)):(this._setOrigin(l),typeof g.focus=="function"&&g.focus(t))}ngOnDestroy(){this._elementInfo.forEach((r,l)=>this.stopMonitoring(l))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(r){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(r)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:r&&this._isLastInteractionFromInputLabel(r)?"mouse":"program"}_shouldBeAttributedToTouch(r){return this._detectionMode===Hb.EVENTUAL||!!r?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(r,l){r.classList.toggle("cdk-focused",!!l),r.classList.toggle("cdk-touch-focused",l==="touch"),r.classList.toggle("cdk-keyboard-focused",l==="keyboard"),r.classList.toggle("cdk-mouse-focused",l==="mouse"),r.classList.toggle("cdk-program-focused",l==="program")}_setOrigin(r,l=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=r,this._originFromTouchInteraction=r==="touch"&&l,this._detectionMode===Hb.IMMEDIATE){clearTimeout(this._originTimeoutId);let t=this._originFromTouchInteraction?kT:1;this._originTimeoutId=setTimeout(()=>this._origin=null,t)}})}_onFocus(r,l){let t=this._elementInfo.get(l),g=Os(r);!t||!t.checkChildren&&l!==g||this._originChanged(l,this._getFocusOrigin(g),t)}_onBlur(r,l){let t=this._elementInfo.get(l);!t||t.checkChildren&&r.relatedTarget instanceof Node&&l.contains(r.relatedTarget)||(this._setClasses(l),this._emitOrigin(t,null))}_emitOrigin(r,l){r.subject.observers.length&&this._ngZone.run(()=>r.subject.next(l))}_registerGlobalListeners(r){if(!this._platform.isBrowser)return;let l=r.rootNode,t=this._rootNodeFocusListenerCount.get(l)||0;t||this._ngZone.runOutsideAngular(()=>{l.addEventListener("focus",this._rootNodeFocusAndBlurListener,Wb),l.addEventListener("blur",this._rootNodeFocusAndBlurListener,Wb)}),this._rootNodeFocusListenerCount.set(l,t+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(tu(this._stopInputModalityDetector)).subscribe(g=>{this._setOrigin(g,!0)}))}_removeGlobalListeners(r){let l=r.rootNode;if(this._rootNodeFocusListenerCount.has(l)){let t=this._rootNodeFocusListenerCount.get(l);t>1?this._rootNodeFocusListenerCount.set(l,t-1):(l.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Wb),l.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Wb),this._rootNodeFocusListenerCount.delete(l))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(r,l,t){this._setClasses(r,l),this._emitOrigin(t,l),this._lastFocusOrigin=l}_getClosestElementsInfo(r){let l=[];return this._elementInfo.forEach((t,g)=>{(g===r||t.checkChildren&&g.contains(r))&&l.push([g,t])}),l}_isLastInteractionFromInputLabel(r){let{_mostRecentTarget:l,mostRecentModality:t}=this._inputModalityDetector;if(t!=="mouse"||!l||l===r||r.nodeName!=="INPUT"&&r.nodeName!=="TEXTAREA"||r.disabled)return!1;let g=r.labels;if(g){for(let C=0;C<g.length;C++)if(g[C].contains(l))return!0}return!1}};o.\u0275fac=function(l){return new(l||o)(at(Bi),at(ir),at(HF),at(gn,8),at(GF,8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),IT=(()=>{let o=class o{constructor(r,l){this._elementRef=r,this._focusMonitor=l,this._focusOrigin=null,this.cdkFocusChange=new ln}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){let r=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(r,r.nodeType===1&&r.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(l=>{this._focusOrigin=l,this.cdkFocusChange.emit(l)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}};o.\u0275fac=function(l){return new(l||o)(fe(hn),fe(ic))},o.\u0275dir=dr({type:o,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"],standalone:!0});let d=o;return d})(),au=function(d){return d[d.NONE=0]="NONE",d[d.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",d[d.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",d}(au||{}),wT="cdk-high-contrast-black-on-white",CT="cdk-high-contrast-white-on-black",xw="cdk-high-contrast-active",Mw=(()=>{let o=class o{constructor(r,l){this._platform=r,this._document=l,this._breakpointSubscription=Tn(vT).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return au.NONE;let r=this._document.createElement("div");r.style.backgroundColor="rgb(1,2,3)",r.style.position="absolute",this._document.body.appendChild(r);let l=this._document.defaultView||window,t=l&&l.getComputedStyle?l.getComputedStyle(r):null,g=(t&&t.backgroundColor||"").replace(/ /g,"");switch(r.remove(),g){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return au.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return au.BLACK_ON_WHITE}return au.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let r=this._document.body.classList;r.remove(xw,wT,CT),this._hasCheckedHighContrastMode=!0;let l=this.getHighContrastMode();l===au.BLACK_ON_WHITE?r.add(xw,wT):l===au.WHITE_ON_BLACK&&r.add(xw,CT)}}};o.\u0275fac=function(l){return new(l||o)(at(ir),at(gn))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),Gb=(()=>{let o=class o{constructor(r){r._applyBodyHighContrastModeCssClasses()}};o.\u0275fac=function(l){return new(l||o)(at(Mw))},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[Ub]});let d=o;return d})();var qF=new bn("cdk-dir-doc",{providedIn:"root",factory:$F});function $F(){return Tn(gn)}var YF=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function ZF(d){let o=d?.toLowerCase()||"";return o==="auto"&&typeof navigator<"u"&&navigator?.language?YF.test(navigator.language)?"rtl":"ltr":o==="rtl"?"rtl":"ltr"}var nc=(()=>{let o=class o{constructor(r){if(this.value="ltr",this.change=new ln,r){let l=r.body?r.body.dir:null,t=r.documentElement?r.documentElement.dir:null;this.value=ZF(l||t||"ltr")}}ngOnDestroy(){this.change.complete()}};o.\u0275fac=function(l){return new(l||o)(at(qF,8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var Dd=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({});let d=o;return d})();var XF=["mat-internal-form-field",""],QF=["*"];function KF(){return!0}var JF=new bn("mat-sanity-checks",{providedIn:"root",factory:KF}),qn=(()=>{let o=class o{constructor(r,l,t){this._sanityChecks=l,this._document=t,this._hasDoneGlobalChecks=!1,r._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(r){return Og()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[r]}};o.\u0275fac=function(l){return new(l||o)(at(Mw),at(JF,8),at(gn))},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[Dd,Dd]});let d=o;return d})();var ET=new bn("MAT_DATE_LOCALE",{providedIn:"root",factory:ez});function ez(){return Tn(jI)}var sa=class{constructor(){this._localeChanges=new Ln,this.localeChanges=this._localeChanges}getValidDateOrNull(o){return this.isDateInstance(o)&&this.isValid(o)?o:null}deserialize(o){return o==null||this.isDateInstance(o)&&this.isValid(o)?o:this.invalid()}setLocale(o){this.locale=o,this._localeChanges.next()}compareDate(o,c){return this.getYear(o)-this.getYear(c)||this.getMonth(o)-this.getMonth(c)||this.getDate(o)-this.getDate(c)}sameDate(o,c){if(o&&c){let r=this.isValid(o),l=this.isValid(c);return r&&l?!this.compareDate(o,c):r==l}return o==c}clampDate(o,c,r){return c&&this.compareDate(o,c)<0?c:r&&this.compareDate(o,r)>0?r:o}},Xm=new bn("mat-date-formats"),tz=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function kw(d,o){let c=Array(d);for(let r=0;r<d;r++)c[r]=o(r);return c}var iz=(()=>{let o=class o extends sa{constructor(r){super(),this.useUtcForDisplay=!1,this._matDateLocale=Tn(ET,{optional:!0}),r!==void 0&&(this._matDateLocale=r),super.setLocale(this._matDateLocale)}getYear(r){return r.getFullYear()}getMonth(r){return r.getMonth()}getDate(r){return r.getDate()}getDayOfWeek(r){return r.getDay()}getMonthNames(r){let l=new Intl.DateTimeFormat(this.locale,{month:r,timeZone:"utc"});return kw(12,t=>this._format(l,new Date(2017,t,1)))}getDateNames(){let r=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return kw(31,l=>this._format(r,new Date(2017,0,l+1)))}getDayOfWeekNames(r){let l=new Intl.DateTimeFormat(this.locale,{weekday:r,timeZone:"utc"});return kw(7,t=>this._format(l,new Date(2017,0,t+1)))}getYearName(r){let l=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(l,r)}getFirstDayOfWeek(){return 0}getNumDaysInMonth(r){return this.getDate(this._createDateWithOverflow(this.getYear(r),this.getMonth(r)+1,0))}clone(r){return new Date(r.getTime())}createDate(r,l,t){let g=this._createDateWithOverflow(r,l,t);return g.getMonth()!=l,g}today(){return new Date}parse(r,l){return typeof r=="number"?new Date(r):r?new Date(Date.parse(r)):null}format(r,l){if(!this.isValid(r))throw Error("NativeDateAdapter: Cannot format invalid date.");let t=new Intl.DateTimeFormat(this.locale,ia(Xi({},l),{timeZone:"utc"}));return this._format(t,r)}addCalendarYears(r,l){return this.addCalendarMonths(r,l*12)}addCalendarMonths(r,l){let t=this._createDateWithOverflow(this.getYear(r),this.getMonth(r)+l,this.getDate(r));return this.getMonth(t)!=((this.getMonth(r)+l)%12+12)%12&&(t=this._createDateWithOverflow(this.getYear(t),this.getMonth(t),0)),t}addCalendarDays(r,l){return this._createDateWithOverflow(this.getYear(r),this.getMonth(r),this.getDate(r)+l)}toIso8601(r){return[r.getUTCFullYear(),this._2digit(r.getUTCMonth()+1),this._2digit(r.getUTCDate())].join("-")}deserialize(r){if(typeof r=="string"){if(!r)return null;if(tz.test(r)){let l=new Date(r);if(this.isValid(l))return l}}return super.deserialize(r)}isDateInstance(r){return r instanceof Date}isValid(r){return!isNaN(r.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(r,l,t){let g=new Date;return g.setFullYear(r,l,t),g.setHours(0,0,0,0),g}_2digit(r){return("00"+r).slice(-2)}_format(r,l){let t=new Date;return t.setUTCFullYear(l.getFullYear(),l.getMonth(),l.getDate()),t.setUTCHours(l.getHours(),l.getMinutes(),l.getSeconds(),l.getMilliseconds()),r.format(t)}};o.\u0275fac=function(l){return new(l||o)(at(ET,8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac});let d=o;return d})(),nz={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};var BT=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({providers:[rz()]});let d=o;return d})();function rz(d=nz){return[{provide:sa,useClass:iz},{provide:Xm,useValue:d}]}var ts=function(d){return d[d.FADING_IN=0]="FADING_IN",d[d.VISIBLE=1]="VISIBLE",d[d.FADING_OUT=2]="FADING_OUT",d[d.HIDDEN=3]="HIDDEN",d}(ts||{}),Ew=class{constructor(o,c,r,l=!1){this._renderer=o,this.element=c,this.config=r,this._animationForciblyDisabledThroughCss=l,this.state=ts.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},DT=dl({passive:!0,capture:!0}),Dw=class{constructor(){this._events=new Map,this._delegateEventHandler=o=>{let c=Os(o);c&&this._events.get(o.type)?.forEach((r,l)=>{(l===c||l.contains(c))&&r.forEach(t=>t.handleEvent(o))})}}addHandler(o,c,r,l){let t=this._events.get(c);if(t){let g=t.get(r);g?g.add(l):t.set(r,new Set([l]))}else this._events.set(c,new Map([[r,new Set([l])]])),o.runOutsideAngular(()=>{document.addEventListener(c,this._delegateEventHandler,DT)})}removeHandler(o,c,r){let l=this._events.get(o);if(!l)return;let t=l.get(c);t&&(t.delete(r),t.size===0&&l.delete(c),l.size===0&&(this._events.delete(o),document.removeEventListener(o,this._delegateEventHandler,DT)))}},AT={enterDuration:225,exitDuration:150},oz=800,PT=dl({passive:!0,capture:!0}),OT=["mousedown","touchstart"],RT=["mouseup","mouseleave","touchend","touchcancel"],zg=class zg{constructor(o,c,r,l){this._target=o,this._ngZone=c,this._platform=l,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,l.isBrowser&&(this._containerElement=tc(r))}fadeInRipple(o,c,r={}){let l=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),t=Xi(Xi({},AT),r.animation);r.centered&&(o=l.left+l.width/2,c=l.top+l.height/2);let g=r.radius||az(o,c,l),C=o-l.left,I=c-l.top,O=t.enterDuration,z=document.createElement("div");z.classList.add("mat-ripple-element"),z.style.left=`${C-g}px`,z.style.top=`${I-g}px`,z.style.height=`${g*2}px`,z.style.width=`${g*2}px`,r.color!=null&&(z.style.backgroundColor=r.color),z.style.transitionDuration=`${O}ms`,this._containerElement.appendChild(z);let q=window.getComputedStyle(z),ie=q.transitionProperty,de=q.transitionDuration,xe=ie==="none"||de==="0s"||de==="0s, 0s"||l.width===0&&l.height===0,Ie=new Ew(this,z,r,xe);z.style.transform="scale3d(1, 1, 1)",Ie.state=ts.FADING_IN,r.persistent||(this._mostRecentTransientRipple=Ie);let Me=null;return!xe&&(O||t.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Ge=()=>this._finishRippleTransition(Ie),He=()=>this._destroyRipple(Ie);z.addEventListener("transitionend",Ge),z.addEventListener("transitioncancel",He),Me={onTransitionEnd:Ge,onTransitionCancel:He}}),this._activeRipples.set(Ie,Me),(xe||!O)&&this._finishRippleTransition(Ie),Ie}fadeOutRipple(o){if(o.state===ts.FADING_OUT||o.state===ts.HIDDEN)return;let c=o.element,r=Xi(Xi({},AT),o.config.animation);c.style.transitionDuration=`${r.exitDuration}ms`,c.style.opacity="0",o.state=ts.FADING_OUT,(o._animationForciblyDisabledThroughCss||!r.exitDuration)&&this._finishRippleTransition(o)}fadeOutAll(){this._getActiveRipples().forEach(o=>o.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(o=>{o.config.persistent||o.fadeOut()})}setupTriggerEvents(o){let c=tc(o);!this._platform.isBrowser||!c||c===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=c,OT.forEach(r=>{zg._eventManager.addHandler(this._ngZone,r,c,this)}))}handleEvent(o){o.type==="mousedown"?this._onMousedown(o):o.type==="touchstart"?this._onTouchStart(o):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{RT.forEach(c=>{this._triggerElement.addEventListener(c,this,PT)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(o){o.state===ts.FADING_IN?this._startFadeOutTransition(o):o.state===ts.FADING_OUT&&this._destroyRipple(o)}_startFadeOutTransition(o){let c=o===this._mostRecentTransientRipple,{persistent:r}=o.config;o.state=ts.VISIBLE,!r&&(!c||!this._isPointerDown)&&o.fadeOut()}_destroyRipple(o){let c=this._activeRipples.get(o)??null;this._activeRipples.delete(o),this._activeRipples.size||(this._containerRect=null),o===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),o.state=ts.HIDDEN,c!==null&&(o.element.removeEventListener("transitionend",c.onTransitionEnd),o.element.removeEventListener("transitioncancel",c.onTransitionCancel)),o.element.remove()}_onMousedown(o){let c=Cw(o),r=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+oz;!this._target.rippleDisabled&&!c&&!r&&(this._isPointerDown=!0,this.fadeInRipple(o.clientX,o.clientY,this._target.rippleConfig))}_onTouchStart(o){if(!this._target.rippleDisabled&&!Sw(o)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let c=o.changedTouches;if(c)for(let r=0;r<c.length;r++)this.fadeInRipple(c[r].clientX,c[r].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(o=>{let c=o.state===ts.VISIBLE||o.config.terminateOnPointerUp&&o.state===ts.FADING_IN;!o.config.persistent&&c&&o.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let o=this._triggerElement;o&&(OT.forEach(c=>zg._eventManager.removeHandler(c,o,this)),this._pointerUpEventsRegistered&&(RT.forEach(c=>o.removeEventListener(c,this,PT)),this._pointerUpEventsRegistered=!1))}};zg._eventManager=new Dw;var Aw=zg;function az(d,o,c){let r=Math.max(Math.abs(d-c.left),Math.abs(d-c.right)),l=Math.max(Math.abs(o-c.top),Math.abs(o-c.bottom));return Math.sqrt(r*r+l*l)}var Pw=new bn("mat-ripple-global-options"),Yb=(()=>{let o=class o{get disabled(){return this._disabled}set disabled(r){r&&this.fadeOutAllNonPersistent(),this._disabled=r,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(r){this._trigger=r,this._setupTriggerEventsIfEnabled()}constructor(r,l,t,g,C){this._elementRef=r,this._animationMode=C,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=g||{},this._rippleRenderer=new Aw(this,l,r,t)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Xi(Xi(Xi({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(r,l=0,t){return typeof r=="number"?this._rippleRenderer.fadeInRipple(r,l,Xi(Xi({},this.rippleConfig),t)):this._rippleRenderer.fadeInRipple(0,0,Xi(Xi({},this.rippleConfig),r))}};o.\u0275fac=function(l){return new(l||o)(fe(hn),fe(Bi),fe(ir),fe(Pw,8),fe(co,8))},o.\u0275dir=dr({type:o,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(l,t){l&2&&ki("mat-ripple-unbounded",t.unbounded)},inputs:{color:[Qi.None,"matRippleColor","color"],unbounded:[Qi.None,"matRippleUnbounded","unbounded"],centered:[Qi.None,"matRippleCentered","centered"],radius:[Qi.None,"matRippleRadius","radius"],animation:[Qi.None,"matRippleAnimation","animation"],disabled:[Qi.None,"matRippleDisabled","disabled"],trigger:[Qi.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let d=o;return d})(),NT=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[qn,qn]});let d=o;return d})();var LT={capture:!0},FT=["focus","click","mouseenter","touchstart"],Iw="mat-ripple-loader-uninitialized",Tw="mat-ripple-loader-class-name",zT="mat-ripple-loader-centered",$b="mat-ripple-loader-disabled",VT=(()=>{let o=class o{constructor(){this._document=Tn(gn,{optional:!0}),this._animationMode=Tn(co,{optional:!0}),this._globalRippleOptions=Tn(Pw,{optional:!0}),this._platform=Tn(ir),this._ngZone=Tn(Bi),this._hosts=new Map,this._onInteraction=r=>{if(!(r.target instanceof HTMLElement))return;let t=r.target.closest(`[${Iw}]`);t&&this._createRipple(t)},this._ngZone.runOutsideAngular(()=>{for(let r of FT)this._document?.addEventListener(r,this._onInteraction,LT)})}ngOnDestroy(){let r=this._hosts.keys();for(let l of r)this.destroyRipple(l);for(let l of FT)this._document?.removeEventListener(l,this._onInteraction,LT)}configureRipple(r,l){r.setAttribute(Iw,""),(l.className||!r.hasAttribute(Tw))&&r.setAttribute(Tw,l.className||""),l.centered&&r.setAttribute(zT,""),l.disabled&&r.setAttribute($b,"")}getRipple(r){return this._hosts.get(r)||this._createRipple(r)}setDisabled(r,l){let t=this._hosts.get(r);if(t){t.disabled=l;return}l?r.setAttribute($b,""):r.removeAttribute($b)}_createRipple(r){if(!this._document)return;let l=this._hosts.get(r);if(l)return l;r.querySelector(".mat-ripple")?.remove();let t=this._document.createElement("span");t.classList.add("mat-ripple",r.getAttribute(Tw)),r.append(t);let g=new Yb(new hn(t),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return g._isInitialized=!0,g.trigger=r,g.centered=r.hasAttribute(zT),g.disabled=r.hasAttribute($b),this.attachRipple(r,g),g}attachRipple(r,l){r.removeAttribute(Iw),this._hosts.set(r,l)}destroyRipple(r){let l=this._hosts.get(r);l&&(l.ngOnDestroy(),this._hosts.delete(r))}};o.\u0275fac=function(l){return new(l||o)},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),jT=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275cmp=ft({type:o,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(l,t){l&2&&ki("mdc-form-field--align-end",t.labelPosition==="before")},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[Qn],attrs:XF,ngContentSelectors:QF,decls:1,vars:0,template:function(l,t){l&1&&(na(),Po(0))},styles:[".mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-form-field{font-family:var(--mdc-form-field-label-text-font);line-height:var(--mdc-form-field-label-text-line-height);font-size:var(--mdc-form-field-label-text-size);font-weight:var(--mdc-form-field-label-text-weight);letter-spacing:var(--mdc-form-field-label-text-tracking);color:var(--mdc-form-field-label-text-color)}.mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}"],encapsulation:2,changeDetection:0});let d=o;return d})();var UT=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[qn]});let d=o;return d})();var WT=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({});let d=o;return d})();var Ow=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[qn,ll,Ub,qn]});let d=o;return d})();var HT=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[qn,Ow,Ow,WT,qn]});let d=o;return d})();var GT=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[qn,ll,qn]});let d=o;return d})();var qT=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[ll,qn]});let d=o;return d})();var Bg=class{attach(o){return this._attachedHost=o,o.attach(this)}detach(){let o=this._attachedHost;o!=null&&(this._attachedHost=null,o.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(o){this._attachedHost=o}},Ad=class extends Bg{constructor(o,c,r,l,t){super(),this.component=o,this.viewContainerRef=c,this.injector=r,this.componentFactoryResolver=l,this.projectableNodes=t}},su=class extends Bg{constructor(o,c,r,l){super(),this.templateRef=o,this.viewContainerRef=c,this.context=r,this.injector=l}get origin(){return this.templateRef.elementRef}attach(o,c=this.context){return this.context=c,super.attach(o)}detach(){return this.context=void 0,super.detach()}},Rw=class extends Bg{constructor(o){super(),this.element=o instanceof hn?o.nativeElement:o}},Qm=class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(o){if(o instanceof Ad)return this._attachedPortal=o,this.attachComponentPortal(o);if(o instanceof su)return this._attachedPortal=o,this.attachTemplatePortal(o);if(this.attachDomPortal&&o instanceof Rw)return this._attachedPortal=o,this.attachDomPortal(o)}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(o){this._disposeFn=o}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var Zb=class extends Qm{constructor(o,c,r,l,t){super(),this.outletElement=o,this._componentFactoryResolver=c,this._appRef=r,this._defaultInjector=l,this.attachDomPortal=g=>{this._document;let C=g.element;C.parentNode;let I=this._document.createComment("dom-portal");C.parentNode.insertBefore(I,C),this.outletElement.appendChild(C),this._attachedPortal=g,super.setDisposeFn(()=>{I.parentNode&&I.parentNode.replaceChild(C,I)})},this._document=t}attachComponentPortal(o){let r=(o.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(o.component),l;return o.viewContainerRef?(l=o.viewContainerRef.createComponent(r,o.viewContainerRef.length,o.injector||o.viewContainerRef.injector,o.projectableNodes||void 0),this.setDisposeFn(()=>l.destroy())):(l=r.create(o.injector||this._defaultInjector||Ka.NULL),this._appRef.attachView(l.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(l.hostView),l.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(l)),this._attachedPortal=o,l}attachTemplatePortal(o){let c=o.viewContainerRef,r=c.createEmbeddedView(o.templateRef,o.context,{injector:o.injector});return r.rootNodes.forEach(l=>this.outletElement.appendChild(l)),r.detectChanges(),this.setDisposeFn(()=>{let l=c.indexOf(r);l!==-1&&c.remove(l)}),this._attachedPortal=o,r}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(o){return o.hostView.rootNodes[0]}};var Pd=(()=>{let o=class o extends Qm{constructor(r,l,t){super(),this._componentFactoryResolver=r,this._viewContainerRef=l,this._isInitialized=!1,this.attached=new ln,this.attachDomPortal=g=>{this._document;let C=g.element;C.parentNode;let I=this._document.createComment("dom-portal");g.setAttachedHost(this),C.parentNode.insertBefore(I,C),this._getRootNode().appendChild(C),this._attachedPortal=g,super.setDisposeFn(()=>{I.parentNode&&I.parentNode.replaceChild(C,I)})},this._document=t}get portal(){return this._attachedPortal}set portal(r){this.hasAttached()&&!r&&!this._isInitialized||(this.hasAttached()&&super.detach(),r&&super.attach(r),this._attachedPortal=r||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(r){r.setAttachedHost(this);let l=r.viewContainerRef!=null?r.viewContainerRef:this._viewContainerRef,g=(r.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(r.component),C=l.createComponent(g,l.length,r.injector||l.injector,r.projectableNodes||void 0);return l!==this._viewContainerRef&&this._getRootNode().appendChild(C.hostView.rootNodes[0]),super.setDisposeFn(()=>C.destroy()),this._attachedPortal=r,this._attachedRef=C,this.attached.emit(C),C}attachTemplatePortal(r){r.setAttachedHost(this);let l=this._viewContainerRef.createEmbeddedView(r.templateRef,r.context,{injector:r.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=r,this._attachedRef=l,this.attached.emit(l),l}_getRootNode(){let r=this._viewContainerRef.element.nativeElement;return r.nodeType===r.ELEMENT_NODE?r:r.parentNode}};o.\u0275fac=function(l){return new(l||o)(fe(Ig),fe(Wm),fe(gn))},o.\u0275dir=dr({type:o,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[Qi.None,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],standalone:!0,features:[Ho]});let d=o;return d})();var rc=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({});let d=o;return d})();var cz=20,$T=(()=>{let o=class o{constructor(r,l,t){this._ngZone=r,this._platform=l,this._scrolled=new Ln,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=t}register(r){this.scrollContainers.has(r)||this.scrollContainers.set(r,r.elementScrolled().subscribe(()=>this._scrolled.next(r)))}deregister(r){let l=this.scrollContainers.get(r);l&&(l.unsubscribe(),this.scrollContainers.delete(r))}scrolled(r=cz){return this._platform.isBrowser?new vo(l=>{this._globalSubscription||this._addGlobalListener();let t=r>0?this._scrolled.pipe(iw(r)).subscribe(l):this._scrolled.subscribe(l);return this._scrolledCount++,()=>{t.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):tr()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((r,l)=>this.deregister(l)),this._scrolled.complete()}ancestorScrolled(r,l){let t=this.getAncestorScrollContainers(r);return this.scrolled(l).pipe(Ea(g=>!g||t.indexOf(g)>-1))}getAncestorScrollContainers(r){let l=[];return this.scrollContainers.forEach((t,g)=>{this._scrollableContainsElement(g,r)&&l.push(g)}),l}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(r,l){let t=tc(l),g=r.getElementRef().nativeElement;do if(t==g)return!0;while(t=t.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let r=this._getWindow();return SI(r.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};o.\u0275fac=function(l){return new(l||o)(at(Bi),at(ir),at(gn,8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var dz=20,Lw=(()=>{let o=class o{constructor(r,l,t){this._platform=r,this._change=new Ln,this._changeListener=g=>{this._change.next(g)},this._document=t,l.runOutsideAngular(()=>{if(r.isBrowser){let g=this._getWindow();g.addEventListener("resize",this._changeListener),g.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let r=this._getWindow();r.removeEventListener("resize",this._changeListener),r.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let r={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),r}getViewportRect(){let r=this.getViewportScrollPosition(),{width:l,height:t}=this.getViewportSize();return{top:r.top,left:r.left,bottom:r.top+t,right:r.left+l,height:t,width:l}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let r=this._document,l=this._getWindow(),t=r.documentElement,g=t.getBoundingClientRect(),C=-g.top||r.body.scrollTop||l.scrollY||t.scrollTop||0,I=-g.left||r.body.scrollLeft||l.scrollX||t.scrollLeft||0;return{top:C,left:I}}change(r=dz){return r>0?this._change.pipe(iw(r)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let r=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:r.innerWidth,height:r.innerHeight}:{width:0,height:0}}};o.\u0275fac=function(l){return new(l||o)(at(ir),at(Bi),at(gn,8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var Xb=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({});let d=o;return d})(),Fw=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[Dd,Xb,Dd,Xb]});let d=o;return d})();var YT=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[qn,qn]});let d=o;return d})();var uz=["switch"],mz=["*"];function pz(d,o){d&1&&(V(0,"div",10),Sd(),V(1,"svg",12),ke(2,"path",13),j(),V(3,"svg",14),ke(4,"path",15),j()())}var fz=new bn("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1})}),gz={provide:XI,useExisting:Cb(()=>ZT),multi:!0},Qb=class{constructor(o,c){this.source=o,this.checked=c}},_z=0,ZT=(()=>{let o=class o{_createChangeEvent(r){return new Qb(this,r)}get buttonId(){return`${this.id||this._uniqueId}-button`}focus(){this._switchElement.nativeElement.focus()}get checked(){return this._checked}set checked(r){this._checked=r,this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(r,l,t,g,C,I){this._elementRef=r,this._focusMonitor=l,this._changeDetectorRef=t,this.defaults=C,this._onChange=O=>{},this._onTouched=()=>{},this._validatorOnChange=()=>{},this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.change=new ln,this.toggleChange=new ln,this.tabIndex=parseInt(g)||0,this.color=C.color||"accent",this._noopAnimations=I==="NoopAnimations",this.id=this._uniqueId=`mat-mdc-slide-toggle-${++_z}`,this.hideIcon=C.hideIcon??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(r=>{r==="keyboard"||r==="program"?(this._focused=!0,this._changeDetectorRef.markForCheck()):r||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(r){r.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(r){this.checked=!!r}registerOnChange(r){this._onChange=r}registerOnTouched(r){this._onTouched=r}validate(r){return this.required&&r.value!==!0?{required:!0}:null}registerOnValidatorChange(r){this._validatorOnChange=r}setDisabledState(r){this.disabled=r,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new Qb(this,this.checked)))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}};o.\u0275fac=function(l){return new(l||o)(fe(hn),fe(ic),fe(xo),jm("tabindex"),fe(fz),fe(co,8))},o.\u0275cmp=ft({type:o,selectors:[["mat-slide-toggle"]],viewQuery:function(l,t){if(l&1&&yi(uz,5),l&2){let g;_i(g=bi())&&(t._switchElement=g.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(l,t){l&2&&(ec("id",t.id),wn("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),Ds(t.color?"mat-"+t.color:""),ki("mat-mdc-slide-toggle-focused",t._focused)("mat-mdc-slide-toggle-checked",t.checked)("_mat-animation-noopable",t._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[Qi.None,"aria-label","ariaLabel"],ariaLabelledby:[Qi.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[Qi.None,"aria-describedby","ariaDescribedby"],required:[Qi.HasDecoratorInputTransform,"required","required",ho],color:"color",disabled:[Qi.HasDecoratorInputTransform,"disabled","disabled",ho],disableRipple:[Qi.HasDecoratorInputTransform,"disableRipple","disableRipple",ho],tabIndex:[Qi.HasDecoratorInputTransform,"tabIndex","tabIndex",r=>r==null?0:pw(r)],checked:[Qi.HasDecoratorInputTransform,"checked","checked",ho],hideIcon:[Qi.HasDecoratorInputTransform,"hideIcon","hideIcon",ho]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],standalone:!0,features:[As([gz,{provide:QI,useExisting:o,multi:!0}]),Ao,Do,Qn],ngContentSelectors:mz,decls:13,vars:24,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(l,t){if(l&1){let g=Xt();na(),V(0,"div",1)(1,"button",2,0),Oe("click",function(){return gt(g),_t(t._handleClick())}),ke(3,"div",3),V(4,"div",4)(5,"div",5)(6,"div",6),ke(7,"div",7),j(),V(8,"div",8),ke(9,"div",9),j(),Nt(10,pz,5,0,"div",10),j()()(),V(11,"label",11),Oe("click",function(I){return gt(g),_t(I.stopPropagation())}),Po(12),j()()}if(l&2){let g=Da(2);Fe("labelPosition",t.labelPosition),ue(),ki("mdc-switch--selected",t.checked)("mdc-switch--unselected",!t.checked)("mdc-switch--checked",t.checked)("mdc-switch--disabled",t.disabled),Fe("tabIndex",t.disabled?-1:t.tabIndex)("disabled",t.disabled),wn("id",t.buttonId)("name",t.name)("aria-label",t.ariaLabel)("aria-labelledby",t._getAriaLabelledBy())("aria-describedby",t.ariaDescribedby)("aria-required",t.required||null)("aria-checked",t.checked),ue(8),Fe("matRippleTrigger",g)("matRippleDisabled",t.disableRipple||t.disabled)("matRippleCentered",!0),ue(),Xn(10,t.hideIcon?-1:10),ue(),Fe("for",t.buttonId),wn("id",t._labelId)}},dependencies:[Yb,jT],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1);background-color:var(--mdc-elevation-overlay-color)}.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative}.mdc-switch[hidden]{display:none}.mdc-switch:disabled{cursor:default;pointer-events:none}.mdc-switch__track{overflow:hidden;position:relative;width:100%}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%}@media screen and (forced-colors: active){.mdc-switch__track::before,.mdc-switch__track::after{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(-100%)}[dir=rtl] .mdc-switch__track::after,.mdc-switch__track[dir=rtl]::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track[dir=rtl]::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0)}[dir=rtl] .mdc-switch__handle-track,.mdc-switch__handle-track[dir=rtl]{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track,.mdc-switch--selected .mdc-switch__handle-track[dir=rtl]{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto}[dir=rtl] .mdc-switch__handle,.mdc-switch__handle[dir=rtl]{left:auto;right:0}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media screen and (forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-elevation-overlay{bottom:0;left:0;right:0;top:0}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1}.mdc-switch:disabled .mdc-switch__ripple{display:none}.mdc-switch__icons{height:100%;position:relative;width:100%;z-index:1}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}.mdc-switch{width:var(--mdc-switch-track-width)}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color)}.mdc-switch.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color)}.mdc-switch .mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation)}.mdc-switch .mdc-switch__focus-ring-wrapper,.mdc-switch .mdc-switch__handle{height:var(--mdc-switch-handle-height)}.mdc-switch .mdc-switch__handle{border-radius:var(--mdc-switch-handle-shape)}.mdc-switch .mdc-switch__handle{width:var(--mdc-switch-handle-width)}.mdc-switch .mdc-switch__handle-track{width:calc(100% - var(--mdc-switch-handle-width))}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__icon{fill:var(--mdc-switch-selected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__icon{fill:var(--mdc-switch-unselected-icon-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size)}.mdc-switch.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-hover-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-focus-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-pressed-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-hover-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-focus-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-pressed-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-selected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-selected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-unselected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-unselected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch .mdc-switch__ripple{height:var(--mdc-switch-state-layer-size);width:var(--mdc-switch-state-layer-size)}.mdc-switch .mdc-switch__track{height:var(--mdc-switch-track-height)}.mdc-switch:disabled .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch:enabled .mdc-switch__track::after{background:var(--mdc-switch-selected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color)}.mdc-switch:enabled .mdc-switch__track::before{background:var(--mdc-switch-unselected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color)}.mdc-switch .mdc-switch__track{border-radius:var(--mdc-switch-track-shape)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mat-mdc-slide-toggle{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle .mdc-switch__ripple::after{content:"";opacity:0}.mat-mdc-slide-toggle .mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:opacity 75ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-elevation-overlay,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mdc-switch__handle{transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size);height:var(--mat-switch-unselected-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size);height:var(--mat-switch-selected-handle-size)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size);height:var(--mat-switch-with-icon-handle-size)}.mat-mdc-slide-toggle:active .mdc-switch:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size);height:var(--mat-switch-pressed-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{margin:var(--mat-switch-selected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{margin:var(--mat-switch-unselected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--selected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--unselected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin)}.mdc-switch__track::after,.mdc-switch__track::before{border-width:var(--mat-switch-track-outline-width);border-color:var(--mat-switch-track-outline-color)}.mdc-switch--selected .mdc-switch__track::after,.mdc-switch--selected .mdc-switch__track::before{border-width:var(--mat-switch-selected-track-outline-width)}.mdc-switch--disabled .mdc-switch__track::after,.mdc-switch--disabled .mdc-switch__track::before{border-width:var(--mat-switch-disabled-unselected-track-outline-width);border-color:var(--mat-switch-disabled-unselected-track-outline-color)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity)}'],encapsulation:2,changeDetection:0});let d=o;return d})();var XT=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[ZT,qn,qn]});let d=o;return d})();var QT=gT(),zw=class{constructor(o,c){this._viewportRuler=o,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=c}attach(){}enable(){if(this._canBeEnabled()){let o=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=o.style.left||"",this._previousHTMLStyles.top=o.style.top||"",o.style.left=Br(-this._previousScrollPosition.left),o.style.top=Br(-this._previousScrollPosition.top),o.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let o=this._document.documentElement,c=this._document.body,r=o.style,l=c.style,t=r.scrollBehavior||"",g=l.scrollBehavior||"";this._isEnabled=!1,r.left=this._previousHTMLStyles.left,r.top=this._previousHTMLStyles.top,o.classList.remove("cdk-global-scrollblock"),QT&&(r.scrollBehavior=l.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),QT&&(r.scrollBehavior=t,l.scrollBehavior=g)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let c=this._document.body,r=this._viewportRuler.getViewportSize();return c.scrollHeight>r.height||c.scrollWidth>r.width}};var Bw=class{constructor(o,c,r,l){this._scrollDispatcher=o,this._ngZone=c,this._viewportRuler=r,this._config=l,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(o){this._overlayRef,this._overlayRef=o}enable(){if(this._scrollSubscription)return;let o=this._scrollDispatcher.scrolled(0).pipe(Ea(c=>!c||!this._overlayRef.overlayElement.contains(c.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=o.subscribe(()=>{let c=this._viewportRuler.getViewportScrollPosition().top;Math.abs(c-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=o.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},Kb=class{enable(){}disable(){}attach(){}};function Nw(d,o){return o.some(c=>{let r=d.bottom<c.top,l=d.top>c.bottom,t=d.right<c.left,g=d.left>c.right;return r||l||t||g})}function KT(d,o){return o.some(c=>{let r=d.top<c.top,l=d.bottom>c.bottom,t=d.left<c.left,g=d.right>c.right;return r||l||t||g})}var Vw=class{constructor(o,c,r,l){this._scrollDispatcher=o,this._viewportRuler=c,this._ngZone=r,this._config=l,this._scrollSubscription=null}attach(o){this._overlayRef,this._overlayRef=o}enable(){if(!this._scrollSubscription){let o=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(o).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let c=this._overlayRef.overlayElement.getBoundingClientRect(),{width:r,height:l}=this._viewportRuler.getViewportSize();Nw(c,[{width:r,height:l,bottom:l,right:r,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},bz=(()=>{let o=class o{constructor(r,l,t,g){this._scrollDispatcher=r,this._viewportRuler=l,this._ngZone=t,this.noop=()=>new Kb,this.close=C=>new Bw(this._scrollDispatcher,this._ngZone,this._viewportRuler,C),this.block=()=>new zw(this._viewportRuler,this._document),this.reposition=C=>new Vw(this._scrollDispatcher,this._viewportRuler,this._ngZone,C),this._document=g}};o.\u0275fac=function(l){return new(l||o)(at($T),at(Lw),at(Bi),at(gn))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),Km=class{constructor(o){if(this.scrollStrategy=new Kb,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,o){let c=Object.keys(o);for(let r of c)o[r]!==void 0&&(this[r]=o[r])}}};var jw=class{constructor(o,c){this.connectionPair=o,this.scrollableViewProperties=c}};var nE=(()=>{let o=class o{constructor(r){this._attachedOverlays=[],this._document=r}ngOnDestroy(){this.detach()}add(r){this.remove(r),this._attachedOverlays.push(r)}remove(r){let l=this._attachedOverlays.indexOf(r);l>-1&&this._attachedOverlays.splice(l,1),this._attachedOverlays.length===0&&this.detach()}};o.\u0275fac=function(l){return new(l||o)(at(gn))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),yz=(()=>{let o=class o extends nE{constructor(r,l){super(r),this._ngZone=l,this._keydownListener=t=>{let g=this._attachedOverlays;for(let C=g.length-1;C>-1;C--)if(g[C]._keydownEvents.observers.length>0){let I=g[C]._keydownEvents;this._ngZone?this._ngZone.run(()=>I.next(t)):I.next(t);break}}}add(r){super.add(r),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}};o.\u0275fac=function(l){return new(l||o)(at(gn),at(Bi,8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),vz=(()=>{let o=class o extends nE{constructor(r,l,t){super(r),this._platform=l,this._ngZone=t,this._cursorStyleIsSet=!1,this._pointerDownListener=g=>{this._pointerDownEventTarget=Os(g)},this._clickListener=g=>{let C=Os(g),I=g.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:C;this._pointerDownEventTarget=null;let O=this._attachedOverlays.slice();for(let z=O.length-1;z>-1;z--){let q=O[z];if(q._outsidePointerEvents.observers.length<1||!q.hasAttached())continue;if(q.overlayElement.contains(C)||q.overlayElement.contains(I))break;let ie=q._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>ie.next(g)):ie.next(g)}}}add(r){if(super.add(r),!this._isAttached){let l=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(l)):this._addEventListeners(l),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=l.style.cursor,l.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let r=this._document.body;r.removeEventListener("pointerdown",this._pointerDownListener,!0),r.removeEventListener("click",this._clickListener,!0),r.removeEventListener("auxclick",this._clickListener,!0),r.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(r.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(r){r.addEventListener("pointerdown",this._pointerDownListener,!0),r.addEventListener("click",this._clickListener,!0),r.addEventListener("auxclick",this._clickListener,!0),r.addEventListener("contextmenu",this._clickListener,!0)}};o.\u0275fac=function(l){return new(l||o)(at(gn),at(ir),at(Bi,8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),Jm=(()=>{let o=class o{constructor(r,l){this._platform=l,this._document=r}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let r="cdk-overlay-container";if(this._platform.isBrowser||Og()){let t=this._document.querySelectorAll(`.${r}[platform="server"], .${r}[platform="test"]`);for(let g=0;g<t.length;g++)t[g].remove()}let l=this._document.createElement("div");l.classList.add(r),Og()?l.setAttribute("platform","test"):this._platform.isBrowser||l.setAttribute("platform","server"),this._document.body.appendChild(l),this._containerElement=l}};o.\u0275fac=function(l){return new(l||o)(at(gn),at(ir))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),oc=class{constructor(o,c,r,l,t,g,C,I,O,z=!1){this._portalOutlet=o,this._host=c,this._pane=r,this._config=l,this._ngZone=t,this._keyboardDispatcher=g,this._document=C,this._location=I,this._outsideClickDispatcher=O,this._animationsDisabled=z,this._backdropElement=null,this._backdropClick=new Ln,this._attachments=new Ln,this._detachments=new Ln,this._locationChanges=Is.EMPTY,this._backdropClickHandler=q=>this._backdropClick.next(q),this._backdropTransitionendHandler=q=>{this._disposeBackdrop(q.target)},this._keydownEvents=new Ln,this._outsidePointerEvents=new Ln,l.scrollStrategy&&(this._scrollStrategy=l.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=l.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(o){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let c=this._portalOutlet.attach(o);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Qa(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof c?.onDestroy=="function"&&c.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),c}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let o=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),o}dispose(){let o=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,o&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(o){o!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=o,this.hasAttached()&&(o.attach(this),this.updatePosition()))}updateSize(o){this._config=Xi(Xi({},this._config),o),this._updateElementSize()}setDirection(o){this._config=ia(Xi({},this._config),{direction:o}),this._updateElementDirection()}addPanelClass(o){this._pane&&this._toggleClasses(this._pane,o,!0)}removePanelClass(o){this._pane&&this._toggleClasses(this._pane,o,!1)}getDirection(){let o=this._config.direction;return o?typeof o=="string"?o:o.value:"ltr"}updateScrollStrategy(o){o!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=o,this.hasAttached()&&(o.attach(this),o.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let o=this._pane.style;o.width=Br(this._config.width),o.height=Br(this._config.height),o.minWidth=Br(this._config.minWidth),o.minHeight=Br(this._config.minHeight),o.maxWidth=Br(this._config.maxWidth),o.maxHeight=Br(this._config.maxHeight)}_togglePointerEvents(o){this._pane.style.pointerEvents=o?"":"none"}_attachBackdrop(){let o="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(o)})}):this._backdropElement.classList.add(o)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let o=this._backdropElement;if(o){if(this._animationsDisabled){this._disposeBackdrop(o);return}o.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{o.addEventListener("transitionend",this._backdropTransitionendHandler)}),o.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(o)},500))}}_toggleClasses(o,c,r){let l=Ym(c||[]).filter(t=>!!t);l.length&&(r?o.classList.add(...l):o.classList.remove(...l))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{let o=this._ngZone.onStable.pipe(tu(eu(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),o.unsubscribe())})})}_disposeScrollStrategy(){let o=this._scrollStrategy;o&&(o.disable(),o.detach&&o.detach())}_disposeBackdrop(o){o&&(o.removeEventListener("click",this._backdropClickHandler),o.removeEventListener("transitionend",this._backdropTransitionendHandler),o.remove(),this._backdropElement===o&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},JT="cdk-overlay-connected-position-bounding-box",xz=/([A-Za-z%]+)$/,Jb=class{get positions(){return this._preferredPositions}constructor(o,c,r,l,t){this._viewportRuler=c,this._document=r,this._platform=l,this._overlayContainer=t,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Ln,this._resizeSubscription=Is.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(o)}attach(o){this._overlayRef&&this._overlayRef,this._validatePositions(),o.hostElement.classList.add(JT),this._overlayRef=o,this._boundingBox=o.hostElement,this._pane=o.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let o=this._originRect,c=this._overlayRect,r=this._viewportRect,l=this._containerRect,t=[],g;for(let C of this._preferredPositions){let I=this._getOriginPoint(o,l,C),O=this._getOverlayPoint(I,c,C),z=this._getOverlayFit(O,c,r,C);if(z.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(C,I);return}if(this._canFitWithFlexibleDimensions(z,O,r)){t.push({position:C,origin:I,overlayRect:c,boundingBoxRect:this._calculateBoundingBoxRect(I,C)});continue}(!g||g.overlayFit.visibleArea<z.visibleArea)&&(g={overlayFit:z,overlayPoint:O,originPoint:I,position:C,overlayRect:c})}if(t.length){let C=null,I=-1;for(let O of t){let z=O.boundingBoxRect.width*O.boundingBoxRect.height*(O.position.weight||1);z>I&&(I=z,C=O)}this._isPushed=!1,this._applyPosition(C.position,C.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(g.position,g.originPoint);return}this._applyPosition(g.position,g.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&lu(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(JT),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let o=this._lastPosition;if(o){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let c=this._getOriginPoint(this._originRect,this._containerRect,o);this._applyPosition(o,c)}else this.apply()}withScrollableContainers(o){return this._scrollables=o,this}withPositions(o){return this._preferredPositions=o,o.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(o){return this._viewportMargin=o,this}withFlexibleDimensions(o=!0){return this._hasFlexibleDimensions=o,this}withGrowAfterOpen(o=!0){return this._growAfterOpen=o,this}withPush(o=!0){return this._canPush=o,this}withLockedPosition(o=!0){return this._positionLocked=o,this}setOrigin(o){return this._origin=o,this}withDefaultOffsetX(o){return this._offsetX=o,this}withDefaultOffsetY(o){return this._offsetY=o,this}withTransformOriginOn(o){return this._transformOriginSelector=o,this}_getOriginPoint(o,c,r){let l;if(r.originX=="center")l=o.left+o.width/2;else{let g=this._isRtl()?o.right:o.left,C=this._isRtl()?o.left:o.right;l=r.originX=="start"?g:C}c.left<0&&(l-=c.left);let t;return r.originY=="center"?t=o.top+o.height/2:t=r.originY=="top"?o.top:o.bottom,c.top<0&&(t-=c.top),{x:l,y:t}}_getOverlayPoint(o,c,r){let l;r.overlayX=="center"?l=-c.width/2:r.overlayX==="start"?l=this._isRtl()?-c.width:0:l=this._isRtl()?0:-c.width;let t;return r.overlayY=="center"?t=-c.height/2:t=r.overlayY=="top"?0:-c.height,{x:o.x+l,y:o.y+t}}_getOverlayFit(o,c,r,l){let t=tE(c),{x:g,y:C}=o,I=this._getOffset(l,"x"),O=this._getOffset(l,"y");I&&(g+=I),O&&(C+=O);let z=0-g,q=g+t.width-r.width,ie=0-C,de=C+t.height-r.height,xe=this._subtractOverflows(t.width,z,q),Ie=this._subtractOverflows(t.height,ie,de),Me=xe*Ie;return{visibleArea:Me,isCompletelyWithinViewport:t.width*t.height===Me,fitsInViewportVertically:Ie===t.height,fitsInViewportHorizontally:xe==t.width}}_canFitWithFlexibleDimensions(o,c,r){if(this._hasFlexibleDimensions){let l=r.bottom-c.y,t=r.right-c.x,g=eE(this._overlayRef.getConfig().minHeight),C=eE(this._overlayRef.getConfig().minWidth),I=o.fitsInViewportVertically||g!=null&&g<=l,O=o.fitsInViewportHorizontally||C!=null&&C<=t;return I&&O}return!1}_pushOverlayOnScreen(o,c,r){if(this._previousPushAmount&&this._positionLocked)return{x:o.x+this._previousPushAmount.x,y:o.y+this._previousPushAmount.y};let l=tE(c),t=this._viewportRect,g=Math.max(o.x+l.width-t.width,0),C=Math.max(o.y+l.height-t.height,0),I=Math.max(t.top-r.top-o.y,0),O=Math.max(t.left-r.left-o.x,0),z=0,q=0;return l.width<=t.width?z=O||-g:z=o.x<this._viewportMargin?t.left-r.left-o.x:0,l.height<=t.height?q=I||-C:q=o.y<this._viewportMargin?t.top-r.top-o.y:0,this._previousPushAmount={x:z,y:q},{x:o.x+z,y:o.y+q}}_applyPosition(o,c){if(this._setTransformOrigin(o),this._setOverlayElementStyles(c,o),this._setBoundingBoxStyles(c,o),o.panelClass&&this._addPanelClasses(o.panelClass),this._positionChanges.observers.length){let r=this._getScrollVisibility();if(o!==this._lastPosition||!this._lastScrollVisibility||!wz(this._lastScrollVisibility,r)){let l=new jw(o,r);this._positionChanges.next(l)}this._lastScrollVisibility=r}this._lastPosition=o,this._isInitialRender=!1}_setTransformOrigin(o){if(!this._transformOriginSelector)return;let c=this._boundingBox.querySelectorAll(this._transformOriginSelector),r,l=o.overlayY;o.overlayX==="center"?r="center":this._isRtl()?r=o.overlayX==="start"?"right":"left":r=o.overlayX==="start"?"left":"right";for(let t=0;t<c.length;t++)c[t].style.transformOrigin=`${r} ${l}`}_calculateBoundingBoxRect(o,c){let r=this._viewportRect,l=this._isRtl(),t,g,C;if(c.overlayY==="top")g=o.y,t=r.height-g+this._viewportMargin;else if(c.overlayY==="bottom")C=r.height-o.y+this._viewportMargin*2,t=r.height-C+this._viewportMargin;else{let de=Math.min(r.bottom-o.y+r.top,o.y),xe=this._lastBoundingBoxSize.height;t=de*2,g=o.y-de,t>xe&&!this._isInitialRender&&!this._growAfterOpen&&(g=o.y-xe/2)}let I=c.overlayX==="start"&&!l||c.overlayX==="end"&&l,O=c.overlayX==="end"&&!l||c.overlayX==="start"&&l,z,q,ie;if(O)ie=r.width-o.x+this._viewportMargin*2,z=o.x-this._viewportMargin;else if(I)q=o.x,z=r.right-o.x;else{let de=Math.min(r.right-o.x+r.left,o.x),xe=this._lastBoundingBoxSize.width;z=de*2,q=o.x-de,z>xe&&!this._isInitialRender&&!this._growAfterOpen&&(q=o.x-xe/2)}return{top:g,left:q,bottom:C,right:ie,width:z,height:t}}_setBoundingBoxStyles(o,c){let r=this._calculateBoundingBoxRect(o,c);!this._isInitialRender&&!this._growAfterOpen&&(r.height=Math.min(r.height,this._lastBoundingBoxSize.height),r.width=Math.min(r.width,this._lastBoundingBoxSize.width));let l={};if(this._hasExactPosition())l.top=l.left="0",l.bottom=l.right=l.maxHeight=l.maxWidth="",l.width=l.height="100%";else{let t=this._overlayRef.getConfig().maxHeight,g=this._overlayRef.getConfig().maxWidth;l.height=Br(r.height),l.top=Br(r.top),l.bottom=Br(r.bottom),l.width=Br(r.width),l.left=Br(r.left),l.right=Br(r.right),c.overlayX==="center"?l.alignItems="center":l.alignItems=c.overlayX==="end"?"flex-end":"flex-start",c.overlayY==="center"?l.justifyContent="center":l.justifyContent=c.overlayY==="bottom"?"flex-end":"flex-start",t&&(l.maxHeight=Br(t)),g&&(l.maxWidth=Br(g))}this._lastBoundingBoxSize=r,lu(this._boundingBox.style,l)}_resetBoundingBoxStyles(){lu(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){lu(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(o,c){let r={},l=this._hasExactPosition(),t=this._hasFlexibleDimensions,g=this._overlayRef.getConfig();if(l){let z=this._viewportRuler.getViewportScrollPosition();lu(r,this._getExactOverlayY(c,o,z)),lu(r,this._getExactOverlayX(c,o,z))}else r.position="static";let C="",I=this._getOffset(c,"x"),O=this._getOffset(c,"y");I&&(C+=`translateX(${I}px) `),O&&(C+=`translateY(${O}px)`),r.transform=C.trim(),g.maxHeight&&(l?r.maxHeight=Br(g.maxHeight):t&&(r.maxHeight="")),g.maxWidth&&(l?r.maxWidth=Br(g.maxWidth):t&&(r.maxWidth="")),lu(this._pane.style,r)}_getExactOverlayY(o,c,r){let l={top:"",bottom:""},t=this._getOverlayPoint(c,this._overlayRect,o);if(this._isPushed&&(t=this._pushOverlayOnScreen(t,this._overlayRect,r)),o.overlayY==="bottom"){let g=this._document.documentElement.clientHeight;l.bottom=`${g-(t.y+this._overlayRect.height)}px`}else l.top=Br(t.y);return l}_getExactOverlayX(o,c,r){let l={left:"",right:""},t=this._getOverlayPoint(c,this._overlayRect,o);this._isPushed&&(t=this._pushOverlayOnScreen(t,this._overlayRect,r));let g;if(this._isRtl()?g=o.overlayX==="end"?"left":"right":g=o.overlayX==="end"?"right":"left",g==="right"){let C=this._document.documentElement.clientWidth;l.right=`${C-(t.x+this._overlayRect.width)}px`}else l.left=Br(t.x);return l}_getScrollVisibility(){let o=this._getOriginRect(),c=this._pane.getBoundingClientRect(),r=this._scrollables.map(l=>l.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:KT(o,r),isOriginOutsideView:Nw(o,r),isOverlayClipped:KT(c,r),isOverlayOutsideView:Nw(c,r)}}_subtractOverflows(o,...c){return c.reduce((r,l)=>r-Math.max(l,0),o)}_getNarrowedViewportRect(){let o=this._document.documentElement.clientWidth,c=this._document.documentElement.clientHeight,r=this._viewportRuler.getViewportScrollPosition();return{top:r.top+this._viewportMargin,left:r.left+this._viewportMargin,right:r.left+o-this._viewportMargin,bottom:r.top+c-this._viewportMargin,width:o-2*this._viewportMargin,height:c-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(o,c){return c==="x"?o.offsetX==null?this._offsetX:o.offsetX:o.offsetY==null?this._offsetY:o.offsetY}_validatePositions(){}_addPanelClasses(o){this._pane&&Ym(o).forEach(c=>{c!==""&&this._appliedPanelClasses.indexOf(c)===-1&&(this._appliedPanelClasses.push(c),this._pane.classList.add(c))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(o=>{this._pane.classList.remove(o)}),this._appliedPanelClasses=[])}_getOriginRect(){let o=this._origin;if(o instanceof hn)return o.nativeElement.getBoundingClientRect();if(o instanceof Element)return o.getBoundingClientRect();let c=o.width||0,r=o.height||0;return{top:o.y,bottom:o.y+r,left:o.x,right:o.x+c,height:r,width:c}}};function lu(d,o){for(let c in o)o.hasOwnProperty(c)&&(d[c]=o[c]);return d}function eE(d){if(typeof d!="number"&&d!=null){let[o,c]=d.split(xz);return!c||c==="px"?parseFloat(o):null}return d||null}function tE(d){return{top:Math.floor(d.top),right:Math.floor(d.right),bottom:Math.floor(d.bottom),left:Math.floor(d.left),width:Math.floor(d.width),height:Math.floor(d.height)}}function wz(d,o){return d===o?!0:d.isOriginClipped===o.isOriginClipped&&d.isOriginOutsideView===o.isOriginOutsideView&&d.isOverlayClipped===o.isOverlayClipped&&d.isOverlayOutsideView===o.isOverlayOutsideView}var iE="cdk-global-overlay-wrapper",Uw=class{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(o){let c=o.getConfig();this._overlayRef=o,this._width&&!c.width&&o.updateSize({width:this._width}),this._height&&!c.height&&o.updateSize({height:this._height}),o.hostElement.classList.add(iE),this._isDisposed=!1}top(o=""){return this._bottomOffset="",this._topOffset=o,this._alignItems="flex-start",this}left(o=""){return this._xOffset=o,this._xPosition="left",this}bottom(o=""){return this._topOffset="",this._bottomOffset=o,this._alignItems="flex-end",this}right(o=""){return this._xOffset=o,this._xPosition="right",this}start(o=""){return this._xOffset=o,this._xPosition="start",this}end(o=""){return this._xOffset=o,this._xPosition="end",this}width(o=""){return this._overlayRef?this._overlayRef.updateSize({width:o}):this._width=o,this}height(o=""){return this._overlayRef?this._overlayRef.updateSize({height:o}):this._height=o,this}centerHorizontally(o=""){return this.left(o),this._xPosition="center",this}centerVertically(o=""){return this.top(o),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let o=this._overlayRef.overlayElement.style,c=this._overlayRef.hostElement.style,r=this._overlayRef.getConfig(),{width:l,height:t,maxWidth:g,maxHeight:C}=r,I=(l==="100%"||l==="100vw")&&(!g||g==="100%"||g==="100vw"),O=(t==="100%"||t==="100vh")&&(!C||C==="100%"||C==="100vh"),z=this._xPosition,q=this._xOffset,ie=this._overlayRef.getConfig().direction==="rtl",de="",xe="",Ie="";I?Ie="flex-start":z==="center"?(Ie="center",ie?xe=q:de=q):ie?z==="left"||z==="end"?(Ie="flex-end",de=q):(z==="right"||z==="start")&&(Ie="flex-start",xe=q):z==="left"||z==="start"?(Ie="flex-start",de=q):(z==="right"||z==="end")&&(Ie="flex-end",xe=q),o.position=this._cssPosition,o.marginLeft=I?"0":de,o.marginTop=O?"0":this._topOffset,o.marginBottom=this._bottomOffset,o.marginRight=I?"0":xe,c.justifyContent=Ie,c.alignItems=O?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let o=this._overlayRef.overlayElement.style,c=this._overlayRef.hostElement,r=c.style;c.classList.remove(iE),r.justifyContent=r.alignItems=o.marginTop=o.marginBottom=o.marginLeft=o.marginRight=o.position="",this._overlayRef=null,this._isDisposed=!0}},Cz=(()=>{let o=class o{constructor(r,l,t,g){this._viewportRuler=r,this._document=l,this._platform=t,this._overlayContainer=g}global(){return new Uw}flexibleConnectedTo(r){return new Jb(r,this._viewportRuler,this._document,this._platform,this._overlayContainer)}};o.\u0275fac=function(l){return new(l||o)(at(Lw),at(gn),at(ir),at(Jm))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),Sz=0,la=(()=>{let o=class o{constructor(r,l,t,g,C,I,O,z,q,ie,de,xe){this.scrollStrategies=r,this._overlayContainer=l,this._componentFactoryResolver=t,this._positionBuilder=g,this._keyboardDispatcher=C,this._injector=I,this._ngZone=O,this._document=z,this._directionality=q,this._location=ie,this._outsideClickDispatcher=de,this._animationsModuleType=xe}create(r){let l=this._createHostElement(),t=this._createPaneElement(l),g=this._createPortalOutlet(t),C=new Km(r);return C.direction=C.direction||this._directionality.value,new oc(g,l,t,C,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations")}position(){return this._positionBuilder}_createPaneElement(r){let l=this._document.createElement("div");return l.id=`cdk-overlay-${Sz++}`,l.classList.add("cdk-overlay-pane"),r.appendChild(l),l}_createHostElement(){let r=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(r),r}_createPortalOutlet(r){return this._appRef||(this._appRef=this._injector.get(VI)),new Zb(r,this._componentFactoryResolver,this._appRef,this._injector,this._document)}};o.\u0275fac=function(l){return new(l||o)(at(bz),at(Jm),at(Ig),at(Cz),at(yz),at(Ka),at(Bi),at(gn),at(nc),at(ii),at(vz),at(co,8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var Mz=new bn("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let d=Tn(la);return()=>d.scrollStrategies.reposition()}});function kz(d){return()=>d.scrollStrategies.reposition()}var Iz={provide:Mz,deps:[la],useFactory:kz},ep=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({providers:[la,Iz],imports:[Dd,rc,Fw,Fw]});let d=o;return d})();var Tz=["mat-button",""],Ez=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],Dz=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var Az=".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}";var Pz=["mat-icon-button",""],Oz=["*"];var Rz=new bn("MAT_BUTTON_CONFIG");var Lz=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],oE=(()=>{let o=class o{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(r){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,r)}get disableRipple(){return this._disableRipple}set disableRipple(r){this._disableRipple=r,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(r){this._disabled=r,this._updateRippleDisabled()}constructor(r,l,t,g){this._elementRef=r,this._platform=l,this._ngZone=t,this._animationMode=g,this._focusMonitor=Tn(ic),this._rippleLoader=Tn(VT),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let C=Tn(Rz,{optional:!0}),I=r.nativeElement,O=I.classList;this.disabledInteractive=C?.disabledInteractive??!1,this._rippleLoader?.configureRipple(I,{className:"mat-mdc-button-ripple"});for(let{attribute:z,mdcClasses:q}of Lz)I.hasAttribute(z)&&O.add(...q)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(r="program",l){r?this._focusMonitor.focusVia(this._elementRef.nativeElement,r,l):this._elementRef.nativeElement.focus(l)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};o.\u0275fac=function(l){Um()},o.\u0275dir=dr({type:o,inputs:{color:"color",disableRipple:[Qi.HasDecoratorInputTransform,"disableRipple","disableRipple",ho],disabled:[Qi.HasDecoratorInputTransform,"disabled","disabled",ho],ariaDisabled:[Qi.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",ho],disabledInteractive:[Qi.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",ho]},features:[Ao]});let d=o;return d})();var Ww=(()=>{let o=class o extends oE{constructor(r,l,t,g){super(r,l,t,g)}};o.\u0275fac=function(l){return new(l||o)(fe(hn),fe(ir),fe(Bi),fe(co,8))},o.\u0275cmp=ft({type:o,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(l,t){l&2&&(wn("disabled",t._getDisabledAttribute())("aria-disabled",t._getAriaDisabled()),Ds(t.color?"mat-"+t.color:""),ki("mat-mdc-button-disabled",t.disabled)("mat-mdc-button-disabled-interactive",t.disabledInteractive)("_mat-animation-noopable",t._animationMode==="NoopAnimations")("mat-unthemed",!t.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Ho,Qn],attrs:Tz,ngContentSelectors:Dz,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(l,t){l&1&&(na(Ez),ke(0,"span",0),Po(1),V(2,"span",1),Po(3,1),j(),Po(4,2),ke(5,"span",2)(6,"span",3)),l&2&&ki("mdc-button__ripple",!t._isFab)("mdc-fab__ripple",t._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let d=o;return d})();var Hw=(()=>{let o=class o extends oE{constructor(r,l,t,g){super(r,l,t,g),this._rippleLoader.configureRipple(this._elementRef.nativeElement,{centered:!0})}};o.\u0275fac=function(l){return new(l||o)(fe(hn),fe(ir),fe(Bi),fe(co,8))},o.\u0275cmp=ft({type:o,selectors:[["button","mat-icon-button",""]],hostVars:14,hostBindings:function(l,t){l&2&&(wn("disabled",t._getDisabledAttribute())("aria-disabled",t._getAriaDisabled()),Ds(t.color?"mat-"+t.color:""),ki("mat-mdc-button-disabled",t.disabled)("mat-mdc-button-disabled-interactive",t.disabledInteractive)("_mat-animation-noopable",t._animationMode==="NoopAnimations")("mat-unthemed",!t.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Ho,Qn],attrs:Pz,ngContentSelectors:Oz,decls:4,vars:0,consts:[[1,"mat-mdc-button-persistent-ripple","mdc-icon-button__ripple"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(l,t){l&1&&(na(),ke(0,"span",0),Po(1),ke(2,"span",1)(3,"span",2))},styles:['.mdc-icon-button{display:inline-block;position:relative;box-sizing:border-box;border:none;outline:none;background-color:rgba(0,0,0,0);fill:currentColor;color:inherit;text-decoration:none;cursor:pointer;user-select:none;z-index:0;overflow:visible}.mdc-icon-button .mdc-icon-button__touch{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}@media screen and (forced-colors: active){.mdc-icon-button.mdc-ripple-upgraded--background-focused .mdc-icon-button__focus-ring,.mdc-icon-button:not(.mdc-ripple-upgraded):focus .mdc-icon-button__focus-ring{display:block}}.mdc-icon-button:disabled{cursor:default;pointer-events:none}.mdc-icon-button[hidden]{display:none}.mdc-icon-button--display-flex{align-items:center;display:inline-flex;justify-content:center}.mdc-icon-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%;display:none}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring{border-color:CanvasText}}.mdc-icon-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring::after{border-color:CanvasText}}.mdc-icon-button__icon{display:inline-block}.mdc-icon-button__icon.mdc-icon-button__icon--on{display:none}.mdc-icon-button--on .mdc-icon-button__icon{display:none}.mdc-icon-button--on .mdc-icon-button__icon.mdc-icon-button__icon--on{display:inline-block}.mdc-icon-button__link{height:100%;left:0;outline:none;position:absolute;top:0;width:100%}.mat-mdc-icon-button{color:var(--mdc-icon-button-icon-color)}.mat-mdc-icon-button .mdc-button__icon{font-size:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button svg,.mat-mdc-icon-button img{width:var(--mdc-icon-button-icon-size);height:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button:disabled{color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button{border-radius:50%;flex-shrink:0;text-align:center;width:var(--mdc-icon-button-state-layer-size, 48px);height:var(--mdc-icon-button-state-layer-size, 48px);padding:calc(calc(var(--mdc-icon-button-state-layer-size, 48px) - var(--mdc-icon-button-icon-size, 24px)) / 2);font-size:var(--mdc-icon-button-icon-size);-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-icon-button svg{vertical-align:baseline}.mat-mdc-icon-button[disabled],.mat-mdc-icon-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-icon-button .mat-mdc-button-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-icon-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-icon-button .mdc-button__label{z-index:1}.mat-mdc-icon-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-icon-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-icon-button .mat-ripple-element{background-color:var(--mat-icon-button-ripple-color)}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-state-layer-color)}.mat-mdc-icon-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-disabled-state-layer-color)}.mat-mdc-icon-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-hover-state-layer-opacity)}.mat-mdc-icon-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-focus-state-layer-opacity)}.mat-mdc-icon-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-pressed-state-layer-opacity)}.mat-mdc-icon-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-icon-button-touch-target-display)}.mat-mdc-icon-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple{border-radius:50%}.mat-mdc-icon-button.mat-unthemed:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-primary:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-accent:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-warn:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}',Az],encapsulation:2,changeDetection:0});let d=o;return d})();var aE=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[qn,NT,qn]});let d=o;return d})();var Fz=["mat-calendar-body",""];function zz(d,o){if(d&1&&(V(0,"tr",0)(1,"td",3),$(2),j()()),d&2){let c=lt();ue(),Ja("padding-top",c._cellPadding)("padding-bottom",c._cellPadding),wn("colspan",c.numCols),ue(),Ii(" ",c.label," ")}}function Bz(d,o){if(d&1&&(V(0,"td",3),$(1),j()),d&2){let c=lt(2);Ja("padding-top",c._cellPadding)("padding-bottom",c._cellPadding),wn("colspan",c._firstRowOffset),ue(),Ii(" ",c._firstRowOffset>=c.labelMinRequiredCells?c.label:""," ")}}function Nz(d,o){if(d&1){let c=Xt();V(0,"td",6)(1,"button",7),Oe("click",function(l){let t=gt(c).$implicit,g=lt(2);return _t(g._cellClicked(t,l))})("focus",function(l){let t=gt(c).$implicit,g=lt(2);return _t(g._emitActiveDateChange(t,l))}),V(2,"span",8),$(3),j(),ke(4,"span",9),j()()}if(d&2){let c=o.$implicit,r=o.$index,l=lt().$index,t=lt();Ja("width",t._cellWidth)("padding-top",t._cellPadding)("padding-bottom",t._cellPadding),wn("data-mat-row",l)("data-mat-col",r),ue(),ki("mat-calendar-body-disabled",!c.enabled)("mat-calendar-body-active",t._isActiveCell(l,r))("mat-calendar-body-range-start",t._isRangeStart(c.compareValue))("mat-calendar-body-range-end",t._isRangeEnd(c.compareValue))("mat-calendar-body-in-range",t._isInRange(c.compareValue))("mat-calendar-body-comparison-bridge-start",t._isComparisonBridgeStart(c.compareValue,l,r))("mat-calendar-body-comparison-bridge-end",t._isComparisonBridgeEnd(c.compareValue,l,r))("mat-calendar-body-comparison-start",t._isComparisonStart(c.compareValue))("mat-calendar-body-comparison-end",t._isComparisonEnd(c.compareValue))("mat-calendar-body-in-comparison-range",t._isInComparisonRange(c.compareValue))("mat-calendar-body-preview-start",t._isPreviewStart(c.compareValue))("mat-calendar-body-preview-end",t._isPreviewEnd(c.compareValue))("mat-calendar-body-in-preview",t._isInPreview(c.compareValue)),Fe("ngClass",c.cssClasses)("tabindex",t._isActiveCell(l,r)?0:-1),wn("aria-label",c.ariaLabel)("aria-disabled",!c.enabled||null)("aria-pressed",t._isSelected(c.compareValue))("aria-current",t.todayValue===c.compareValue?"date":null)("aria-describedby",t._getDescribedby(c.compareValue)),ue(),ki("mat-calendar-body-selected",t._isSelected(c.compareValue))("mat-calendar-body-comparison-identical",t._isComparisonIdentical(c.compareValue))("mat-calendar-body-today",t.todayValue===c.compareValue),ue(),Ii(" ",c.displayValue," ")}}function Vz(d,o){if(d&1&&(V(0,"tr",1),Nt(1,Bz,2,6,"td",4),xr(2,Nz,5,48,"td",5,Tg),j()),d&2){let c=o.$implicit,r=o.$index,l=lt();ue(),Xn(1,r===0&&l._firstRowOffset?1:-1),ue(),wr(c)}}function jz(d,o){if(d&1&&(V(0,"th",2)(1,"span",6),$(2),j(),V(3,"span",3),$(4),j()()),d&2){let c=o.$implicit;ue(2),Ft(c.long),ue(2),Ft(c.narrow)}}var Uz=["*"];function Wz(d,o){}function Hz(d,o){if(d&1){let c=Xt();V(0,"mat-month-view",2),zr("activeDateChange",function(l){gt(c);let t=lt();return Fr(t.activeDate,l)||(t.activeDate=l),_t(l)}),Oe("_userSelection",function(l){gt(c);let t=lt();return _t(t._dateSelected(l))})("dragStarted",function(l){gt(c);let t=lt();return _t(t._dragStarted(l))})("dragEnded",function(l){gt(c);let t=lt();return _t(t._dragEnded(l))}),j()}if(d&2){let c=lt();Lr("activeDate",c.activeDate),Fe("selected",c.selected)("dateFilter",c.dateFilter)("maxDate",c.maxDate)("minDate",c.minDate)("dateClass",c.dateClass)("comparisonStart",c.comparisonStart)("comparisonEnd",c.comparisonEnd)("startDateAccessibleName",c.startDateAccessibleName)("endDateAccessibleName",c.endDateAccessibleName)("activeDrag",c._activeDrag)}}function Gz(d,o){if(d&1){let c=Xt();V(0,"mat-year-view",3),zr("activeDateChange",function(l){gt(c);let t=lt();return Fr(t.activeDate,l)||(t.activeDate=l),_t(l)}),Oe("monthSelected",function(l){gt(c);let t=lt();return _t(t._monthSelectedInYearView(l))})("selectedChange",function(l){gt(c);let t=lt();return _t(t._goToDateInView(l,"month"))}),j()}if(d&2){let c=lt();Lr("activeDate",c.activeDate),Fe("selected",c.selected)("dateFilter",c.dateFilter)("maxDate",c.maxDate)("minDate",c.minDate)("dateClass",c.dateClass)}}function qz(d,o){if(d&1){let c=Xt();V(0,"mat-multi-year-view",4),zr("activeDateChange",function(l){gt(c);let t=lt();return Fr(t.activeDate,l)||(t.activeDate=l),_t(l)}),Oe("yearSelected",function(l){gt(c);let t=lt();return _t(t._yearSelectedInMultiYearView(l))})("selectedChange",function(l){gt(c);let t=lt();return _t(t._goToDateInView(l,"year"))}),j()}if(d&2){let c=lt();Lr("activeDate",c.activeDate),Fe("selected",c.selected)("dateFilter",c.dateFilter)("maxDate",c.maxDate)("minDate",c.minDate)("dateClass",c.dateClass)}}function $z(d,o){}var Yz=["button"],Zz=[[["","matDatepickerToggleIcon",""]]],Xz=["[matDatepickerToggleIcon]"];function Qz(d,o){d&1&&(Sd(),V(0,"svg",2),ke(1,"path",3),j())}var Ug=(()=>{let o=class o{constructor(){this.changes=new Ln,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(r,l){return`${r} \u2013 ${l}`}formatYearRangeLabel(r,l){return`${r} to ${l}`}};o.\u0275fac=function(l){return new(l||o)},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),Vg=class{constructor(o,c,r,l,t={},g=o,C){this.value=o,this.displayValue=c,this.ariaLabel=r,this.enabled=l,this.cssClasses=t,this.compareValue=g,this.rawValue=C}},Kz=1,sE=dl({passive:!1,capture:!0}),Od=dl({passive:!0,capture:!0}),ey=dl({passive:!0}),np=(()=>{let o=class o{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(r,l){this._elementRef=r,this._ngZone=l,this._platform=Tn(ir),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new ln,this.previewChange=new ln,this.activeDateChange=new ln,this.dragStarted=new ln,this.dragEnded=new ln,this._didDragSinceMouseDown=!1,this._enterHandler=t=>{if(this._skipNextFocus&&t.type==="focus"){this._skipNextFocus=!1;return}if(t.target&&this.isRange){let g=this._getCellFromElement(t.target);g&&this._ngZone.run(()=>this.previewChange.emit({value:g.enabled?g:null,event:t}))}},this._touchmoveHandler=t=>{if(!this.isRange)return;let g=lE(t),C=g?this._getCellFromElement(g):null;g!==t.target&&(this._didDragSinceMouseDown=!0),qw(t.target)&&t.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:C?.enabled?C:null,event:t}))},this._leaveHandler=t=>{this.previewEnd!==null&&this.isRange&&(t.type!=="blur"&&(this._didDragSinceMouseDown=!0),t.target&&this._getCellFromElement(t.target)&&!(t.relatedTarget&&this._getCellFromElement(t.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:t})))},this._mousedownHandler=t=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;let g=t.target&&this._getCellFromElement(t.target);!g||!this._isInRange(g.compareValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:g.rawValue,event:t})})},this._mouseupHandler=t=>{if(!this.isRange)return;let g=qw(t.target);if(!g){this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:t})});return}g.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{let C=this._getCellFromElement(g);this.dragEnded.emit({value:C?.rawValue??null,event:t})})},this._touchendHandler=t=>{let g=lE(t);g&&this._mouseupHandler({target:g})},this._id=`mat-calendar-body-${Kz++}`,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,l.runOutsideAngular(()=>{let t=r.nativeElement;t.addEventListener("touchmove",this._touchmoveHandler,sE),t.addEventListener("mouseenter",this._enterHandler,Od),t.addEventListener("focus",this._enterHandler,Od),t.addEventListener("mouseleave",this._leaveHandler,Od),t.addEventListener("blur",this._leaveHandler,Od),t.addEventListener("mousedown",this._mousedownHandler,ey),t.addEventListener("touchstart",this._mousedownHandler,ey),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(r,l){this._didDragSinceMouseDown||r.enabled&&this.selectedValueChange.emit({value:r.value,event:l})}_emitActiveDateChange(r,l){r.enabled&&this.activeDateChange.emit({value:r.value,event:l})}_isSelected(r){return this.startValue===r||this.endValue===r}ngOnChanges(r){let l=r.numCols,{rows:t,numCols:g}=this;(r.rows||l)&&(this._firstRowOffset=t&&t.length&&t[0].length?g-t[0].length:0),(r.cellAspectRatio||l||!this._cellPadding)&&(this._cellPadding=`${50*this.cellAspectRatio/g}%`),(l||!this._cellWidth)&&(this._cellWidth=`${100/g}%`)}ngOnDestroy(){let r=this._elementRef.nativeElement;r.removeEventListener("touchmove",this._touchmoveHandler,sE),r.removeEventListener("mouseenter",this._enterHandler,Od),r.removeEventListener("focus",this._enterHandler,Od),r.removeEventListener("mouseleave",this._leaveHandler,Od),r.removeEventListener("blur",this._leaveHandler,Od),r.removeEventListener("mousedown",this._mousedownHandler,ey),r.removeEventListener("touchstart",this._mousedownHandler,ey),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(r,l){let t=r*this.numCols+l;return r&&(t-=this._firstRowOffset),t==this.activeCell}_focusActiveCell(r=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(Qa(1)).subscribe(()=>{setTimeout(()=>{let l=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");l&&(r||(this._skipNextFocus=!0),l.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(r){return $w(r,this.startValue,this.endValue)}_isRangeEnd(r){return Yw(r,this.startValue,this.endValue)}_isInRange(r){return Zw(r,this.startValue,this.endValue,this.isRange)}_isComparisonStart(r){return $w(r,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(r,l,t){if(!this._isComparisonStart(r)||this._isRangeStart(r)||!this._isInRange(r))return!1;let g=this.rows[l][t-1];if(!g){let C=this.rows[l-1];g=C&&C[C.length-1]}return g&&!this._isRangeEnd(g.compareValue)}_isComparisonBridgeEnd(r,l,t){if(!this._isComparisonEnd(r)||this._isRangeEnd(r)||!this._isInRange(r))return!1;let g=this.rows[l][t+1];if(!g){let C=this.rows[l+1];g=C&&C[0]}return g&&!this._isRangeStart(g.compareValue)}_isComparisonEnd(r){return Yw(r,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(r){return Zw(r,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(r){return this.comparisonStart===this.comparisonEnd&&r===this.comparisonStart}_isPreviewStart(r){return $w(r,this.previewStart,this.previewEnd)}_isPreviewEnd(r){return Yw(r,this.previewStart,this.previewEnd)}_isInPreview(r){return Zw(r,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(r){return this.isRange?this.startValue===r&&this.endValue===r?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===r?this._startDateLabelId:this.endValue===r?this._endDateLabelId:null:null}_getCellFromElement(r){let l=qw(r);if(l){let t=l.getAttribute("data-mat-row"),g=l.getAttribute("data-mat-col");if(t&&g)return this.rows[parseInt(t)][parseInt(g)]}return null}};o.\u0275fac=function(l){return new(l||o)(fe(hn),fe(Bi))},o.\u0275cmp=ft({type:o,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],standalone:!0,features:[Do,Qn],attrs:Fz,decls:7,vars:5,consts:[["aria-hidden","true"],["role","row"],[1,"mat-calendar-body-hidden-label",3,"id"],[1,"mat-calendar-body-label"],[1,"mat-calendar-body-label",3,"paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"click","focus","ngClass","tabindex"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"]],template:function(l,t){l&1&&(Nt(0,zz,3,6,"tr",0),xr(1,Vz,4,1,"tr",1,Tg),V(3,"label",2),$(4),j(),V(5,"label",2),$(6),j()),l&2&&(Xn(0,t._firstRowOffset<t.labelMinRequiredCells?0:-1),ue(),wr(t.rows),ue(2),Fe("id",t._startDateLabelId),ue(),Ii(" ",t.startDateAccessibleName,`
`),ue(),Fe("id",t._endDateLabelId),ue(),Ii(" ",t.endDateAccessibleName,`
`))},dependencies:[Oo],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:start;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}'],encapsulation:2,changeDetection:0});let d=o;return d})();function Gw(d){return d?.nodeName==="TD"}function qw(d){let o;return Gw(d)?o=d:Gw(d.parentNode)?o=d.parentNode:Gw(d.parentNode?.parentNode)&&(o=d.parentNode.parentNode),o?.getAttribute("data-mat-row")!=null?o:null}function $w(d,o,c){return c!==null&&o!==c&&d<c&&d===o}function Yw(d,o,c){return o!==null&&o!==c&&d>=o&&d===c}function Zw(d,o,c,r){return r&&o!==null&&c!==null&&o!==c&&d>=o&&d<=c}function lE(d){let o=d.changedTouches[0];return document.elementFromPoint(o.clientX,o.clientY)}var is=class{constructor(o,c){this.start=o,this.end=c}},ty=(()=>{let o=class o{constructor(r,l){this.selection=r,this._adapter=l,this._selectionChanged=new Ln,this.selectionChanged=this._selectionChanged,this.selection=r}updateSelection(r,l){let t=this.selection;this.selection=r,this._selectionChanged.next({selection:r,source:l,oldValue:t})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(r){return this._adapter.isDateInstance(r)&&this._adapter.isValid(r)}};o.\u0275fac=function(l){Um()},o.\u0275prov=Ut({token:o,factory:o.\u0275fac});let d=o;return d})(),Jz=(()=>{let o=class o extends ty{constructor(r){super(null,r)}add(r){super.updateSelection(r,this)}isValid(){return this.selection!=null&&this._isValidDateInstance(this.selection)}isComplete(){return this.selection!=null}clone(){let r=new o(this._adapter);return r.updateSelection(this.selection,this),r}};o.\u0275fac=function(l){return new(l||o)(at(sa))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac});let d=o;return d})();function e5(d,o){return d||new Jz(o)}var t5={provide:ty,deps:[[new Sb,new TI,ty],sa],useFactory:e5};var mE=new bn("MAT_DATE_RANGE_SELECTION_STRATEGY");var Xw=7,cE=(()=>{let o=class o{get activeDate(){return this._activeDate}set activeDate(r){let l=this._activeDate,t=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),this._hasSameMonthAndYear(l,this._activeDate)||this._init()}get selected(){return this._selected}set selected(r){r instanceof is?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,l,t,g,C){this._changeDetectorRef=r,this._dateFormats=l,this._dateAdapter=t,this._dir=g,this._rangeStrategy=C,this._rerenderSubscription=Is.EMPTY,this.activeDrag=null,this.selectedChange=new ln,this._userSelection=new ln,this.dragStarted=new ln,this.dragEnded=new ln,this.activeDateChange=new ln,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Ts(null)).subscribe(()=>this._init())}ngOnChanges(r){let l=r.comparisonStart||r.comparisonEnd;l&&!l.firstChange&&this._setRanges(this.selected),r.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(r){let l=r.value,t=this._getDateFromDayOfMonth(l),g,C;this._selected instanceof is?(g=this._getDateInCurrentMonth(this._selected.start),C=this._getDateInCurrentMonth(this._selected.end)):g=C=this._getDateInCurrentMonth(this._selected),(g!==l||C!==l)&&this.selectedChange.emit(t),this._userSelection.emit({value:t,event:r.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(r){let l=r.value,t=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(l),this._dateAdapter.compareDate(t,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(r){let l=this._activeDate,t=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,t?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,t?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=r.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=r.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:this._selectionKeyPressed=!0,this._canSelect(this._activeDate)&&r.preventDefault();return;case 27:this._previewEnd!=null&&!$m(r)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:r}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:r})),r.preventDefault(),r.stopPropagation());return;default:return}this._dateAdapter.compareDate(l,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let r=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(Xw+this._dateAdapter.getDayOfWeek(r)-this._dateAdapter.getFirstDayOfWeek())%Xw,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(r){this._matCalendarBody._focusActiveCell(r)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:r,value:l}){if(this._rangeStrategy){let t=l?l.rawValue:null,g=this._rangeStrategy.createPreview(t,this.selected,r);if(this._previewStart=this._getCellCompareValue(g.start),this._previewEnd=this._getCellCompareValue(g.end),this.activeDrag&&t){let C=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,t,r);C&&(this._previewStart=this._getCellCompareValue(C.start),this._previewEnd=this._getCellCompareValue(C.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(r){if(this.activeDrag)if(r.value){let l=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,r.value,r.event);this.dragEnded.emit({value:l??null,event:r.event})}else this.dragEnded.emit({value:null,event:r.event})}_getDateFromDayOfMonth(r){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r)}_initWeekdays(){let r=this._dateAdapter.getFirstDayOfWeek(),l=this._dateAdapter.getDayOfWeekNames("narrow"),g=this._dateAdapter.getDayOfWeekNames("long").map((C,I)=>({long:C,narrow:l[I]}));this._weekdays=g.slice(r).concat(g.slice(0,r))}_createWeekCells(){let r=this._dateAdapter.getNumDaysInMonth(this.activeDate),l=this._dateAdapter.getDateNames();this._weeks=[[]];for(let t=0,g=this._firstWeekOffset;t<r;t++,g++){g==Xw&&(this._weeks.push([]),g=0);let C=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),t+1),I=this._shouldEnableDate(C),O=this._dateAdapter.format(C,this._dateFormats.display.dateA11yLabel),z=this.dateClass?this.dateClass(C,"month"):void 0;this._weeks[this._weeks.length-1].push(new Vg(t+1,l[t],O,I,z,this._getCellCompareValue(C),C))}}_shouldEnableDate(r){return!!r&&(!this.minDate||this._dateAdapter.compareDate(r,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(r,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(r))}_getDateInCurrentMonth(r){return r&&this._hasSameMonthAndYear(r,this.activeDate)?this._dateAdapter.getDate(r):null}_hasSameMonthAndYear(r,l){return!!(r&&l&&this._dateAdapter.getMonth(r)==this._dateAdapter.getMonth(l)&&this._dateAdapter.getYear(r)==this._dateAdapter.getYear(l))}_getCellCompareValue(r){if(r){let l=this._dateAdapter.getYear(r),t=this._dateAdapter.getMonth(r),g=this._dateAdapter.getDate(r);return new Date(l,t,g).getTime()}return null}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setRanges(r){r instanceof is?(this._rangeStart=this._getCellCompareValue(r.start),this._rangeEnd=this._getCellCompareValue(r.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(r),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(r){return!this.dateFilter||this.dateFilter(r)}_clearPreview(){this._previewStart=this._previewEnd=null}};o.\u0275fac=function(l){return new(l||o)(fe(xo),fe(Xm,8),fe(sa,8),fe(nc,8),fe(mE,8))},o.\u0275cmp=ft({type:o,selectors:[["mat-month-view"]],viewQuery:function(l,t){if(l&1&&yi(np,5),l&2){let g;_i(g=bi())&&(t._matCalendarBody=g.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],standalone:!0,features:[Do,Qn],decls:8,vars:14,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["scope","col"],["aria-hidden","true"],["colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown","label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName"],[1,"cdk-visually-hidden"]],template:function(l,t){l&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),xr(3,jz,5,2,"th",2,Tg),j(),V(5,"tr",3),ke(6,"th",4),j()(),V(7,"tbody",5),Oe("selectedValueChange",function(C){return t._dateSelected(C)})("activeDateChange",function(C){return t._updateActiveDate(C)})("previewChange",function(C){return t._previewChanged(C)})("dragStarted",function(C){return t.dragStarted.emit(C)})("dragEnded",function(C){return t._dragEnded(C)})("keyup",function(C){return t._handleCalendarBodyKeyup(C)})("keydown",function(C){return t._handleCalendarBodyKeydown(C)}),j()()),l&2&&(ue(3),wr(t._weekdays),ue(4),Fe("label",t._monthLabel)("rows",t._weeks)("todayValue",t._todayDate)("startValue",t._rangeStart)("endValue",t._rangeEnd)("comparisonStart",t._comparisonRangeStart)("comparisonEnd",t._comparisonRangeEnd)("previewStart",t._previewStart)("previewEnd",t._previewEnd)("isRange",t._isRange)("labelMinRequiredCells",3)("activeCell",t._dateAdapter.getDate(t.activeDate)-1)("startDateAccessibleName",t.startDateAccessibleName)("endDateAccessibleName",t.endDateAccessibleName))},dependencies:[np],encapsulation:2,changeDetection:0});let d=o;return d})(),Pa=24,Qw=4,dE=(()=>{let o=class o{get activeDate(){return this._activeDate}set activeDate(r){let l=this._activeDate,t=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),pE(this._dateAdapter,l,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(r){r instanceof is?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setSelectedYear(r)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,l,t){this._changeDetectorRef=r,this._dateAdapter=l,this._dir=t,this._rerenderSubscription=Is.EMPTY,this.selectedChange=new ln,this.yearSelected=new ln,this.activeDateChange=new ln,this._dateAdapter,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Ts(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());let l=this._dateAdapter.getYear(this._activeDate)-Ng(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let t=0,g=[];t<Pa;t++)g.push(l+t),g.length==Qw&&(this._years.push(g.map(C=>this._createCellForYear(C))),g=[]);this._changeDetectorRef.markForCheck()}_yearSelected(r){let l=r.value,t=this._dateAdapter.createDate(l,0,1),g=this._getDateFromYear(l);this.yearSelected.emit(t),this.selectedChange.emit(g)}_updateActiveDate(r){let l=r.value,t=this._activeDate;this.activeDate=this._getDateFromYear(l),this._dateAdapter.compareDate(t,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(r){let l=this._activeDate,t=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-Qw);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,Qw);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-Ng(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,Pa-Ng(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?-Pa*10:-Pa);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?Pa*10:Pa);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(l,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_getActiveCell(){return Ng(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(r){let l=this._dateAdapter.getMonth(this.activeDate),t=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(r,l,1));return this._dateAdapter.createDate(r,l,Math.min(this._dateAdapter.getDate(this.activeDate),t))}_createCellForYear(r){let l=this._dateAdapter.createDate(r,0,1),t=this._dateAdapter.getYearName(l),g=this.dateClass?this.dateClass(l,"multi-year"):void 0;return new Vg(r,t,t,this._shouldEnableYear(r),g)}_shouldEnableYear(r){if(r==null||this.maxDate&&r>this._dateAdapter.getYear(this.maxDate)||this.minDate&&r<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;let l=this._dateAdapter.createDate(r,0,1);for(let t=l;this._dateAdapter.getYear(t)==r;t=this._dateAdapter.addCalendarDays(t,1))if(this.dateFilter(t))return!0;return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedYear(r){if(this._selectedYear=null,r instanceof is){let l=r.start||r.end;l&&(this._selectedYear=this._dateAdapter.getYear(l))}else r&&(this._selectedYear=this._dateAdapter.getYear(r))}};o.\u0275fac=function(l){return new(l||o)(fe(xo),fe(sa,8),fe(nc,8))},o.\u0275cmp=ft({type:o,selectors:[["mat-multi-year-view"]],viewQuery:function(l,t){if(l&1&&yi(np,5),l&2){let g;_i(g=bi())&&(t._matCalendarBody=g.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],standalone:!0,features:[Qn],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell"]],template:function(l,t){l&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),ke(3,"th",2),j()(),V(4,"tbody",3),Oe("selectedValueChange",function(C){return t._yearSelected(C)})("activeDateChange",function(C){return t._updateActiveDate(C)})("keyup",function(C){return t._handleCalendarBodyKeyup(C)})("keydown",function(C){return t._handleCalendarBodyKeydown(C)}),j()()),l&2&&(ue(4),Fe("rows",t._years)("todayValue",t._todayYear)("startValue",t._selectedYear)("endValue",t._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",t._getActiveCell()))},dependencies:[np],encapsulation:2,changeDetection:0});let d=o;return d})();function pE(d,o,c,r,l){let t=d.getYear(o),g=d.getYear(c),C=fE(d,r,l);return Math.floor((t-C)/Pa)===Math.floor((g-C)/Pa)}function Ng(d,o,c,r){let l=d.getYear(o);return i5(l-fE(d,c,r),Pa)}function fE(d,o,c){let r=0;return c?r=d.getYear(c)-Pa+1:o&&(r=d.getYear(o)),r}function i5(d,o){return(d%o+o)%o}var hE=(()=>{let o=class o{get activeDate(){return this._activeDate}set activeDate(r){let l=this._activeDate,t=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),this._dateAdapter.getYear(l)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(r){r instanceof is?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setSelectedMonth(r)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,l,t,g){this._changeDetectorRef=r,this._dateFormats=l,this._dateAdapter=t,this._dir=g,this._rerenderSubscription=Is.EMPTY,this.selectedChange=new ln,this.monthSelected=new ln,this.activeDateChange=new ln,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Ts(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(r){let l=r.value,t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),l,1);this.monthSelected.emit(t);let g=this._getDateFromMonth(l);this.selectedChange.emit(g)}_updateActiveDate(r){let l=r.value,t=this._activeDate;this.activeDate=this._getDateFromMonth(l),this._dateAdapter.compareDate(t,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(r){let l=this._activeDate,t=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,t?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,t?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(l,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let r=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(l=>l.map(t=>this._createCellForMonth(t,r[t]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(r){return r&&this._dateAdapter.getYear(r)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(r):null}_getDateFromMonth(r){let l=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,1),t=this._dateAdapter.getNumDaysInMonth(l);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,Math.min(this._dateAdapter.getDate(this.activeDate),t))}_createCellForMonth(r,l){let t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,1),g=this._dateAdapter.format(t,this._dateFormats.display.monthYearA11yLabel),C=this.dateClass?this.dateClass(t,"year"):void 0;return new Vg(r,l.toLocaleUpperCase(),g,this._shouldEnableMonth(r),C)}_shouldEnableMonth(r){let l=this._dateAdapter.getYear(this.activeDate);if(r==null||this._isYearAndMonthAfterMaxDate(l,r)||this._isYearAndMonthBeforeMinDate(l,r))return!1;if(!this.dateFilter)return!0;let t=this._dateAdapter.createDate(l,r,1);for(let g=t;this._dateAdapter.getMonth(g)==r;g=this._dateAdapter.addCalendarDays(g,1))if(this.dateFilter(g))return!0;return!1}_isYearAndMonthAfterMaxDate(r,l){if(this.maxDate){let t=this._dateAdapter.getYear(this.maxDate),g=this._dateAdapter.getMonth(this.maxDate);return r>t||r===t&&l>g}return!1}_isYearAndMonthBeforeMinDate(r,l){if(this.minDate){let t=this._dateAdapter.getYear(this.minDate),g=this._dateAdapter.getMonth(this.minDate);return r<t||r===t&&l<g}return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedMonth(r){r instanceof is?this._selectedMonth=this._getMonthInCurrentYear(r.start)||this._getMonthInCurrentYear(r.end):this._selectedMonth=this._getMonthInCurrentYear(r)}};o.\u0275fac=function(l){return new(l||o)(fe(xo),fe(Xm,8),fe(sa,8),fe(nc,8))},o.\u0275cmp=ft({type:o,selectors:[["mat-year-view"]],viewQuery:function(l,t){if(l&1&&yi(np,5),l&2){let g;_i(g=bi())&&(t._matCalendarBody=g.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],standalone:!0,features:[Qn],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell"]],template:function(l,t){l&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),ke(3,"th",2),j()(),V(4,"tbody",3),Oe("selectedValueChange",function(C){return t._monthSelected(C)})("activeDateChange",function(C){return t._updateActiveDate(C)})("keyup",function(C){return t._handleCalendarBodyKeyup(C)})("keydown",function(C){return t._handleCalendarBodyKeydown(C)}),j()()),l&2&&(ue(4),Fe("label",t._yearLabel)("rows",t._months)("todayValue",t._todayMonth)("startValue",t._selectedMonth)("endValue",t._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",t._dateAdapter.getMonth(t.activeDate)))},dependencies:[np],encapsulation:2,changeDetection:0});let d=o;return d})(),n5=1,gE=(()=>{let o=class o{constructor(r,l,t,g,C){this._intl=r,this.calendar=l,this._dateAdapter=t,this._dateFormats=g,this._id=`mat-calendar-header-${n5++}`,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>C.markForCheck())}get periodButtonText(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return this.calendar.currentView=="month"?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView=this.calendar.currentView=="month"?"multi-year":"month"}previousClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?-1:-Pa)}nextClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?1:Pa)}previousEnabled(){return this.calendar.minDate?!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate):!0}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(r,l){return this.calendar.currentView=="month"?this._dateAdapter.getYear(r)==this._dateAdapter.getYear(l)&&this._dateAdapter.getMonth(r)==this._dateAdapter.getMonth(l):this.calendar.currentView=="year"?this._dateAdapter.getYear(r)==this._dateAdapter.getYear(l):pE(this._dateAdapter,r,l,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){let l=this._dateAdapter.getYear(this.calendar.activeDate)-Ng(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),t=l+Pa-1,g=this._dateAdapter.getYearName(this._dateAdapter.createDate(l,0,1)),C=this._dateAdapter.getYearName(this._dateAdapter.createDate(t,0,1));return[g,C]}};o.\u0275fac=function(l){return new(l||o)(fe(Ug),fe(Cb(()=>Kw)),fe(sa,8),fe(Xm,8),fe(xo))},o.\u0275cmp=ft({type:o,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],standalone:!0,features:[Qn],ngContentSelectors:Uz,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],[1,"cdk-visually-hidden",3,"id"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"click","disabled"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"click","disabled"]],template:function(l,t){l&1&&(na(),V(0,"div",0)(1,"div",1)(2,"label",2),$(3),j(),V(4,"button",3),Oe("click",function(){return t.currentPeriodClicked()}),V(5,"span",4),$(6),j(),Sd(),V(7,"svg",5),ke(8,"polygon",6),j()(),lw(),ke(9,"div",7),Po(10),V(11,"button",8),Oe("click",function(){return t.previousClicked()}),j(),V(12,"button",9),Oe("click",function(){return t.nextClicked()}),j()()()),l&2&&(ue(2),Fe("id",t._periodButtonLabelId),ue(),Ft(t.periodButtonDescription),ue(),wn("aria-label",t.periodButtonLabel)("aria-describedby",t._periodButtonLabelId),ue(2),Ft(t.periodButtonText),ue(),ki("mat-calendar-invert",t.calendar.currentView!=="month"),ue(4),Fe("disabled",!t.previousEnabled()),wn("aria-label",t.prevButtonLabel),ue(),Fe("disabled",!t.nextEnabled()),wn("aria-label",t.nextButtonLabel))},dependencies:[Ww,Hw],encapsulation:2,changeDetection:0});let d=o;return d})(),Kw=(()=>{let o=class o{get startAt(){return this._startAt}set startAt(r){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get selected(){return this._selected}set selected(r){r instanceof is?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get activeDate(){return this._clampedActiveDate}set activeDate(r){this._clampedActiveDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(r){let l=this._currentView!==r?r:null;this._currentView=r,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),l&&this.viewChanged.emit(l)}constructor(r,l,t,g){this._dateAdapter=l,this._dateFormats=t,this._changeDetectorRef=g,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new ln,this.yearSelected=new ln,this.monthSelected=new ln,this.viewChanged=new ln(!0),this._userSelection=new ln,this._userDragDrop=new ln,this._activeDrag=null,this.stateChanges=new Ln,this._intlChanges=r.changes.subscribe(()=>{g.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new Ad(this.headerComponent||gE),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(r){let l=r.minDate&&!this._dateAdapter.sameDate(r.minDate.previousValue,r.minDate.currentValue)?r.minDate:void 0,t=r.maxDate&&!this._dateAdapter.sameDate(r.maxDate.previousValue,r.maxDate.currentValue)?r.maxDate:void 0,g=l||t||r.dateFilter;if(g&&!g.firstChange){let C=this._getCurrentViewComponent();C&&(this._changeDetectorRef.detectChanges(),C._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(r){let l=r.value;(this.selected instanceof is||l&&!this._dateAdapter.sameDate(l,this.selected))&&this.selectedChange.emit(l),this._userSelection.emit(r)}_yearSelectedInMultiYearView(r){this.yearSelected.emit(r)}_monthSelectedInYearView(r){this.monthSelected.emit(r)}_goToDateInView(r,l){this.activeDate=r,this.currentView=l}_dragStarted(r){this._activeDrag=r}_dragEnded(r){this._activeDrag&&(r.value&&this._userDragDrop.emit(r),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}};o.\u0275fac=function(l){return new(l||o)(fe(Ug),fe(sa,8),fe(Xm,8),fe(xo))},o.\u0275cmp=ft({type:o,selectors:[["mat-calendar"]],viewQuery:function(l,t){if(l&1&&(yi(cE,5),yi(hE,5),yi(dE,5)),l&2){let g;_i(g=bi())&&(t.monthView=g.first),_i(g=bi())&&(t.yearView=g.first),_i(g=bi())&&(t.multiYearView=g.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],standalone:!0,features:[As([t5]),Do,Qn],decls:5,vars:2,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content"],[3,"activeDateChange","_userSelection","dragStarted","dragEnded","activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag"],[3,"activeDateChange","monthSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"],[3,"activeDateChange","yearSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"]],template:function(l,t){if(l&1&&(Nt(0,Wz,0,0,"ng-template",0),V(1,"div",1),Nt(2,Hz,1,11)(3,Gz,1,6)(4,qz,1,6),j()),l&2){let g;Fe("cdkPortalOutlet",t._calendarHeaderPortal),ue(2),Xn(2,(g=t.currentView)==="month"?2:g==="year"?3:g==="multi-year"?4:-1)}},dependencies:[Pd,IT,cE,hE,dE],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight);--mdc-text-button-label-text-color:var(--mat-datepicker-calendar-period-button-text-color)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button:not(.mat-mdc-button-disabled),.mat-datepicker-content .mat-calendar-next-button:not(.mat-mdc-button-disabled){color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let d=o;return d})(),uE={transformPanel:fw("transformPanel",[Dg("void => enter-dropdown",Eg("120ms cubic-bezier(0, 0, 0.2, 1)",_w([Td({opacity:0,transform:"scale(1, 0.8)"}),Td({opacity:1,transform:"scale(1, 1)"})]))),Dg("void => enter-dialog",Eg("150ms cubic-bezier(0, 0, 0.2, 1)",_w([Td({opacity:0,transform:"scale(0.7)"}),Td({transform:"none",opacity:1})]))),Dg("* => void",Eg("100ms linear",Td({opacity:0})))]),fadeInCalendar:fw("fadeInCalendar",[gw("void",Td({opacity:0})),gw("enter",Td({opacity:1})),Dg("void => *",Eg("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])};var r5=new bn("mat-datepicker-scroll-strategy",{providedIn:"root",factory:()=>{let d=Tn(la);return()=>d.scrollStrategies.reposition()}});function o5(d){return()=>d.scrollStrategies.reposition()}var a5={provide:r5,deps:[la],useFactory:o5},s5=(()=>{let o=class o{constructor(r,l,t,g,C,I){this._elementRef=r,this._changeDetectorRef=l,this._globalModel=t,this._dateAdapter=g,this._rangeSelectionStrategy=C,this._subscriptions=new Is,this._animationDone=new Ln,this._isAnimating=!1,this._actionsPortal=null,this._closeButtonText=I.closeCalendarLabel}ngOnInit(){this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(r){let l=this._model.selection,t=r.value,g=l instanceof is;if(g&&this._rangeSelectionStrategy){let C=this._rangeSelectionStrategy.selectionFinished(t,l,r.event);this._model.updateSelection(C,this)}else t&&(g||!this._dateAdapter.sameDate(t,l))&&this._model.add(t);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(r){this._model.updateSelection(r.value,this)}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_handleAnimationEvent(r){this._isAnimating=r.phaseName==="start",this._isAnimating||this._animationDone.next()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(r,l){this._model=r?this._globalModel.clone():this._globalModel,this._actionsPortal=r,l&&this._changeDetectorRef.detectChanges()}};o.\u0275fac=function(l){return new(l||o)(fe(hn),fe(xo),fe(ty),fe(sa),fe(mE,8),fe(Ug))},o.\u0275cmp=ft({type:o,selectors:[["mat-datepicker-content"]],viewQuery:function(l,t){if(l&1&&yi(Kw,5),l&2){let g;_i(g=bi())&&(t._calendar=g.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:5,hostBindings:function(l,t){l&1&&OI("@transformPanel.start",function(C){return t._handleAnimationEvent(C)})("@transformPanel.done",function(C){return t._handleAnimationEvent(C)}),l&2&&(PI("@transformPanel",t._animationState),Ds(t.color?"mat-"+t.color:""),ki("mat-datepicker-content-touch",t.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],standalone:!0,features:[Qn],decls:5,vars:27,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop","id","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"focus","blur","click","color"]],template:function(l,t){if(l&1&&(V(0,"div",0)(1,"mat-calendar",1),Oe("yearSelected",function(C){return t.datepicker._selectYear(C)})("monthSelected",function(C){return t.datepicker._selectMonth(C)})("viewChanged",function(C){return t.datepicker._viewChanged(C)})("_userSelection",function(C){return t._handleUserSelection(C)})("_userDragDrop",function(C){return t._handleUserDragDrop(C)}),j(),Nt(2,$z,0,0,"ng-template",2),V(3,"button",3),Oe("focus",function(){return t._closeButtonFocused=!0})("blur",function(){return t._closeButtonFocused=!1})("click",function(){return t.datepicker.close()}),$(4),j()()),l&2){let g;ki("mat-datepicker-content-container-with-custom-header",t.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",t._actionsPortal),wn("aria-modal",!0)("aria-labelledby",(g=t._dialogLabelId)!==null&&g!==void 0?g:void 0),ue(),Ds(t.datepicker.panelClass),Fe("id",t.datepicker.id)("startAt",t.datepicker.startAt)("startView",t.datepicker.startView)("minDate",t.datepicker._getMinDate())("maxDate",t.datepicker._getMaxDate())("dateFilter",t.datepicker._getDateFilter())("headerComponent",t.datepicker.calendarHeaderComponent)("selected",t._getSelected())("dateClass",t.datepicker.dateClass)("comparisonStart",t.comparisonStart)("comparisonEnd",t.comparisonEnd)("@fadeInCalendar","enter")("startDateAccessibleName",t.startDateAccessibleName)("endDateAccessibleName",t.endDateAccessibleName),ue(),Fe("cdkPortalOutlet",t._actionsPortal),ue(),ki("cdk-visually-hidden",!t._closeButtonFocused),Fe("color",t.color||"primary"),ue(),Ft(t._closeButtonText)}},dependencies:[MT,Kw,Pd,Ww],styles:[".mat-datepicker-content{display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color);color:var(--mat-datepicker-calendar-container-text-color);box-shadow:var(--mat-datepicker-calendar-container-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-shape)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;box-shadow:var(--mat-datepicker-calendar-container-touch-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-touch-shape);position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}"],encapsulation:2,data:{animation:[uE.transformPanel,uE.fadeInCalendar]},changeDetection:0});let d=o;return d})();var l5=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275dir=dr({type:o,selectors:[["","matDatepickerToggleIcon",""]],standalone:!0});let d=o;return d})(),c5=(()=>{let o=class o{get disabled(){return this._disabled===void 0&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(r){this._disabled=r}constructor(r,l,t){this._intl=r,this._changeDetectorRef=l,this._stateChanges=Is.EMPTY;let g=Number(t);this.tabIndex=g||g===0?g:null}ngOnChanges(r){r.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(r){this.datepicker&&!this.disabled&&(this.datepicker.open(),r.stopPropagation())}_watchStateChanges(){let r=this.datepicker?this.datepicker.stateChanges:tr(),l=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:tr(),t=this.datepicker?eu(this.datepicker.openedStream,this.datepicker.closedStream):tr();this._stateChanges.unsubscribe(),this._stateChanges=eu(this._intl.changes,r,l,t).subscribe(()=>this._changeDetectorRef.markForCheck())}};o.\u0275fac=function(l){return new(l||o)(fe(Ug),fe(xo),jm("tabindex"))},o.\u0275cmp=ft({type:o,selectors:[["mat-datepicker-toggle"]],contentQueries:function(l,t,g){if(l&1&&Ib(g,l5,5),l&2){let C;_i(C=bi())&&(t._customIcon=C.first)}},viewQuery:function(l,t){if(l&1&&yi(Yz,5),l&2){let g;_i(g=bi())&&(t._button=g.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(l,t){l&1&&Oe("click",function(C){return t._open(C)}),l&2&&(wn("tabindex",null)("data-mat-calendar",t.datepicker?t.datepicker.id:null),ki("mat-datepicker-toggle-active",t.datepicker&&t.datepicker.opened)("mat-accent",t.datepicker&&t.datepicker.color==="accent")("mat-warn",t.datepicker&&t.datepicker.color==="warn"))},inputs:{datepicker:[Qi.None,"for","datepicker"],tabIndex:"tabIndex",ariaLabel:[Qi.None,"aria-label","ariaLabel"],disabled:[Qi.HasDecoratorInputTransform,"disabled","disabled",ho],disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],standalone:!0,features:[Ao,Do,Qn],ngContentSelectors:Xz,decls:4,vars:6,consts:[["button",""],["mat-icon-button","","type","button",3,"disabled","disableRipple"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(l,t){l&1&&(na(Zz),V(0,"button",1,0),Nt(2,Qz,2,0,":svg:svg",2),Po(3),j()),l&2&&(Fe("disabled",t.disabled)("disableRipple",t.disableRipple),wn("aria-haspopup",t.datepicker?"dialog":null)("aria-label",t.ariaLabel||t._intl.openCalendarLabel)("tabindex",t.disabled?-1:t.tabIndex),ue(2),Xn(2,t._customIcon?-1:2))},dependencies:[Hw],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color)}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color)}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}"],encapsulation:2,changeDetection:0});let d=o;return d})();var _E=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({providers:[Ug,a5],imports:[ll,aE,ep,Gb,rc,qn,s5,c5,gE,Xb]});let d=o;return d})();function d5(d,o){}var cu=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}};var lC=(()=>{let o=class o extends Qm{constructor(r,l,t,g,C,I,O,z){super(),this._elementRef=r,this._focusTrapFactory=l,this._config=g,this._interactivityChecker=C,this._ngZone=I,this._overlayRef=O,this._focusMonitor=z,this._platform=Tn(ir),this._focusTrap=null,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this._changeDetectorRef=Tn(xo),this.attachDomPortal=q=>{this._portalOutlet.hasAttached();let ie=this._portalOutlet.attachDomPortal(q);return this._contentAttached(),ie},this._document=t,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(r){this._ariaLabelledByQueue.push(r),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(r){let l=this._ariaLabelledByQueue.indexOf(r);l>-1&&(this._ariaLabelledByQueue.splice(l,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(r){this._portalOutlet.hasAttached();let l=this._portalOutlet.attachComponentPortal(r);return this._contentAttached(),l}attachTemplatePortal(r){this._portalOutlet.hasAttached();let l=this._portalOutlet.attachTemplatePortal(r);return this._contentAttached(),l}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(r,l){this._interactivityChecker.isFocusable(r)||(r.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let t=()=>{r.removeEventListener("blur",t),r.removeEventListener("mousedown",t),r.removeAttribute("tabindex")};r.addEventListener("blur",t),r.addEventListener("mousedown",t)})),r.focus(l)}_focusByCssSelector(r,l){let t=this._elementRef.nativeElement.querySelector(r);t&&this._forceFocus(t,l)}_trapFocus(){let r=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||r.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElementWhenReady().then(l=>{l||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}}_restoreFocus(){let r=this._config.restoreFocus,l=null;if(typeof r=="string"?l=this._document.querySelector(r):typeof r=="boolean"?l=r?this._elementFocusedBeforeDialogWasOpened:null:r&&(l=r),this._config.restoreFocus&&l&&typeof l.focus=="function"){let t=ru(),g=this._elementRef.nativeElement;(!t||t===this._document.body||t===g||g.contains(t))&&(this._focusMonitor?(this._focusMonitor.focusVia(l,this._closeInteractionType),this._closeInteractionType=null):l.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let r=this._elementRef.nativeElement,l=ru();return r===l||r.contains(l)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=ru()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}};o.\u0275fac=function(l){return new(l||o)(fe(hn),fe(Fg),fe(gn,8),fe(cu),fe(Lg),fe(Bi),fe(oc),fe(ic))},o.\u0275cmp=ft({type:o,selectors:[["cdk-dialog-container"]],viewQuery:function(l,t){if(l&1&&yi(Pd,7),l&2){let g;_i(g=bi())&&(t._portalOutlet=g.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(l,t){l&2&&wn("id",t._config.id||null)("role",t._config.role)("aria-modal",t._config.ariaModal)("aria-labelledby",t._config.ariaLabel?null:t._ariaLabelledByQueue[0])("aria-label",t._config.ariaLabel)("aria-describedby",t._config.ariaDescribedBy||null)},standalone:!0,features:[Ho,Qn],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(l,t){l&1&&Nt(0,d5,0,0,"ng-template",0)},dependencies:[Pd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2});let d=o;return d})(),Wg=class{constructor(o,c){this.overlayRef=o,this.config=c,this.closed=new Ln,this.disableClose=c.disableClose,this.backdropClick=o.backdropClick(),this.keydownEvents=o.keydownEvents(),this.outsidePointerEvents=o.outsidePointerEvents(),this.id=c.id,this.keydownEvents.subscribe(r=>{r.keyCode===27&&!this.disableClose&&!$m(r)&&(r.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=o.detachments().subscribe(()=>{c.closeOnOverlayDetachments!==!1&&this.close()})}close(o,c){if(this.containerInstance){let r=this.closed;this.containerInstance._closeInteractionType=c?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),r.next(o),r.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(o="",c=""){return this.overlayRef.updateSize({width:o,height:c}),this}addPanelClass(o){return this.overlayRef.addPanelClass(o),this}removePanelClass(o){return this.overlayRef.removePanelClass(o),this}},h5=new bn("DialogScrollStrategy",{providedIn:"root",factory:()=>{let d=Tn(la);return()=>d.scrollStrategies.block()}}),u5=new bn("DialogData"),m5=new bn("DefaultDialogConfig");var p5=0,cC=(()=>{let o=class o{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(r,l,t,g,C,I){this._overlay=r,this._injector=l,this._defaultOptions=t,this._parentDialog=g,this._overlayContainer=C,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Ln,this._afterOpenedAtThisLevel=new Ln,this._ariaHiddenElements=new Map,this.afterAllClosed=xb(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Ts(void 0))),this._scrollStrategy=I}open(r,l){let t=this._defaultOptions||new cu;l=Xi(Xi({},t),l),l.id=l.id||`cdk-dialog-${p5++}`,l.id&&this.getDialogById(l.id);let g=this._getOverlayConfig(l),C=this._overlay.create(g),I=new Wg(C,l),O=this._attachContainer(C,I,l);return I.containerInstance=O,this._attachDialogContent(r,I,O,l),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(I),I.closed.subscribe(()=>this._removeOpenDialog(I,!0)),this.afterOpened.next(I),I}closeAll(){sC(this.openDialogs,r=>r.close())}getDialogById(r){return this.openDialogs.find(l=>l.id===r)}ngOnDestroy(){sC(this._openDialogsAtThisLevel,r=>{r.config.closeOnDestroy===!1&&this._removeOpenDialog(r,!1)}),sC(this._openDialogsAtThisLevel,r=>r.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(r){let l=new Km({positionStrategy:r.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:r.scrollStrategy||this._scrollStrategy(),panelClass:r.panelClass,hasBackdrop:r.hasBackdrop,direction:r.direction,minWidth:r.minWidth,minHeight:r.minHeight,maxWidth:r.maxWidth,maxHeight:r.maxHeight,width:r.width,height:r.height,disposeOnNavigation:r.closeOnNavigation});return r.backdropClass&&(l.backdropClass=r.backdropClass),l}_attachContainer(r,l,t){let g=t.injector||t.viewContainerRef?.injector,C=[{provide:cu,useValue:t},{provide:Wg,useValue:l},{provide:oc,useValue:r}],I;t.container?typeof t.container=="function"?I=t.container:(I=t.container.type,C.push(...t.container.providers(t))):I=lC;let O=new Ad(I,t.viewContainerRef,Ka.create({parent:g||this._injector,providers:C}),t.componentFactoryResolver);return r.attach(O).instance}_attachDialogContent(r,l,t,g){if(r instanceof iu){let C=this._createInjector(g,l,t,void 0),I={$implicit:g.data,dialogRef:l};g.templateContext&&(I=Xi(Xi({},I),typeof g.templateContext=="function"?g.templateContext():g.templateContext)),t.attachTemplatePortal(new su(r,null,I,C))}else{let C=this._createInjector(g,l,t,this._injector),I=t.attachComponentPortal(new Ad(r,g.viewContainerRef,C,g.componentFactoryResolver));l.componentRef=I,l.componentInstance=I.instance}}_createInjector(r,l,t,g){let C=r.injector||r.viewContainerRef?.injector,I=[{provide:u5,useValue:r.data},{provide:Wg,useValue:l}];return r.providers&&(typeof r.providers=="function"?I.push(...r.providers(l,r,t)):I.push(...r.providers)),r.direction&&(!C||!C.get(nc,null,{optional:!0}))&&I.push({provide:nc,useValue:{value:r.direction,change:tr()}}),Ka.create({parent:C||g,providers:I})}_removeOpenDialog(r,l){let t=this.openDialogs.indexOf(r);t>-1&&(this.openDialogs.splice(t,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((g,C)=>{g?C.setAttribute("aria-hidden",g):C.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),l&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let r=this._overlayContainer.getContainerElement();if(r.parentElement){let l=r.parentElement.children;for(let t=l.length-1;t>-1;t--){let g=l[t];g!==r&&g.nodeName!=="SCRIPT"&&g.nodeName!=="STYLE"&&!g.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(g,g.getAttribute("aria-hidden")),g.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let r=this._parentDialog;return r?r._getAfterAllClosed():this._afterAllClosedAtThisLevel}};o.\u0275fac=function(l){return new(l||o)(at(la),at(Ka),at(m5,8),at(o,12),at(Jm),at(h5))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();function sC(d,o){let c=d.length;for(;c--;)o(d[c])}var bE=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({providers:[cC],imports:[ep,rc,Gb,rc]});let d=o;return d})();function f5(d,o){}var Hg=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}},dC="mdc-dialog--open",yE="mdc-dialog--opening",vE="mdc-dialog--closing",g5=150,_5=75,b5=(()=>{let o=class o extends lC{constructor(r,l,t,g,C,I,O,z,q){super(r,l,t,g,C,I,O,q),this._animationMode=z,this._animationStateChanged=new ln,this._animationsEnabled=this._animationMode!=="NoopAnimations",this._actionSectionCount=0,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?wE(this._config.enterAnimationDuration)??g5:0,this._exitAnimationDuration=this._animationsEnabled?wE(this._config.exitAnimationDuration)??_5:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(xE,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(yE,dC)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(dC),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(dC),this._animationsEnabled?(this._hostElement.style.setProperty(xE,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(vE)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(r){this._actionSectionCount+=r,this._changeDetectorRef.markForCheck()}_clearAnimationClasses(){this._hostElement.classList.remove(yE,vE)}_waitForAnimationToComplete(r,l){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(l,r)}_requestAnimationFrame(r){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(r):r()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(r){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:r})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(r){let l=super.attachComponentPortal(r);return l.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),l}};o.\u0275fac=function(l){return new(l||o)(fe(hn),fe(Fg),fe(gn,8),fe(Hg),fe(Lg),fe(Bi),fe(oc),fe(co,8),fe(ic))},o.\u0275cmp=ft({type:o,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(l,t){l&2&&(ec("id",t._config.id),wn("aria-modal",t._config.ariaModal)("role",t._config.role)("aria-labelledby",t._config.ariaLabel?null:t._ariaLabelledByQueue[0])("aria-label",t._config.ariaLabel)("aria-describedby",t._config.ariaDescribedBy||null),ki("_mat-animation-noopable",!t._animationsEnabled)("mat-mdc-dialog-container-with-actions",t._actionSectionCount>0))},standalone:!0,features:[Ho,Qn],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1),Nt(2,f5,0,0,"ng-template",2),j()())},dependencies:[Pd],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0;transform:scale(0.8)}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--closing .mdc-dialog__surface{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{opacity:1}.mdc-dialog--open .mdc-dialog__surface{transform:none}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{width:100%;height:100%}.mat-mdc-dialog-component-host{display:contents}.mat-mdc-dialog-container{--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition:opacity linear var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container .mdc-dialog__surface{transition:transform var(--mat-dialog-transition-duration, 0ms) 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container,.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__surface{transition:none}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 80vw);min-width:var(--mat-dialog-container-min-width, 0)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, 80vw)}}.mat-mdc-dialog-title{padding:var(--mat-dialog-headline-padding, 0 24px 9px)}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{padding:var(--mat-dialog-actions-padding, 8px);justify-content:var(--mat-dialog-actions-alignment, start)}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2});let d=o;return d})(),xE="--mat-dialog-transition-duration";function wE(d){return d==null?null:typeof d=="number"?d:d.endsWith("ms")?Rg(d.substring(0,d.length-2)):d.endsWith("s")?Rg(d.substring(0,d.length-1))*1e3:d==="0"?0:null}var iy=function(d){return d[d.OPEN=0]="OPEN",d[d.CLOSING=1]="CLOSING",d[d.CLOSED=2]="CLOSED",d}(iy||{}),rp=class{constructor(o,c,r){this._ref=o,this._containerInstance=r,this._afterOpened=new Ln,this._beforeClosed=new Ln,this._state=iy.OPEN,this.disableClose=c.disableClose,this.id=o.id,o.addPanelClass("mat-mdc-dialog-panel"),r._animationStateChanged.pipe(Ea(l=>l.state==="opened"),Qa(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),r._animationStateChanged.pipe(Ea(l=>l.state==="closed"),Qa(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),o.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),eu(this.backdropClick(),this.keydownEvents().pipe(Ea(l=>l.keyCode===27&&!this.disableClose&&!$m(l)))).subscribe(l=>{this.disableClose||(l.preventDefault(),y5(this,l.type==="keydown"?"keyboard":"mouse"))})}close(o){this._result=o,this._containerInstance._animationStateChanged.pipe(Ea(c=>c.state==="closing"),Qa(1)).subscribe(c=>{this._beforeClosed.next(o),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),c.totalTime+100)}),this._state=iy.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(o){let c=this._ref.config.positionStrategy;return o&&(o.left||o.right)?o.left?c.left(o.left):c.right(o.right):c.centerHorizontally(),o&&(o.top||o.bottom)?o.top?c.top(o.top):c.bottom(o.bottom):c.centerVertically(),this._ref.updatePosition(),this}updateSize(o="",c=""){return this._ref.updateSize(o,c),this}addPanelClass(o){return this._ref.addPanelClass(o),this}removePanelClass(o){return this._ref.removePanelClass(o),this}getState(){return this._state}_finishDialogClose(){this._state=iy.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function y5(d,o,c){return d._closeInteractionType=o,d.close(c)}var hC=new bn("MatMdcDialogData"),v5=new bn("mat-mdc-dialog-default-options"),x5=new bn("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let d=Tn(la);return()=>d.scrollStrategies.block()}});var w5=0,op=(()=>{let o=class o{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let r=this._parentDialog;return r?r._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(r,l,t,g,C,I,O,z){this._overlay=r,this._defaultOptions=g,this._scrollStrategy=C,this._parentDialog=I,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Ln,this._afterOpenedAtThisLevel=new Ln,this.dialogConfigClass=Hg,this.afterAllClosed=xb(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Ts(void 0))),this._dialog=l.get(cC),this._dialogRefConstructor=rp,this._dialogContainerType=b5,this._dialogDataToken=hC}open(r,l){let t;l=Xi(Xi({},this._defaultOptions||new Hg),l),l.id=l.id||`mat-mdc-dialog-${w5++}`,l.scrollStrategy=l.scrollStrategy||this._scrollStrategy();let g=this._dialog.open(r,ia(Xi({},l),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:l},{provide:cu,useValue:l}]},templateContext:()=>({dialogRef:t}),providers:(C,I,O)=>(t=new this._dialogRefConstructor(C,l,O),t.updatePosition(l?.position),[{provide:this._dialogContainerType,useValue:O},{provide:this._dialogDataToken,useValue:I.data},{provide:this._dialogRefConstructor,useValue:t}])}));return t.componentRef=g.componentRef,t.componentInstance=g.componentInstance,this.openDialogs.push(t),this.afterOpened.next(t),t.afterClosed().subscribe(()=>{let C=this.openDialogs.indexOf(t);C>-1&&(this.openDialogs.splice(C,1),this.openDialogs.length||this._getAfterAllClosed().next())}),t}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(r){return this.openDialogs.find(l=>l.id===r)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(r){let l=r.length;for(;l--;)r[l].close()}};o.\u0275fac=function(l){return new(l||o)(at(la),at(Ka),at(ii,8),at(v5,8),at(x5),at(o,12),at(Jm),at(co,8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),C5=0;var CE=(()=>{let o=class o{constructor(r,l,t){this._dialogRef=r,this._elementRef=l,this._dialog=t}ngOnInit(){this._dialogRef||(this._dialogRef=S5(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{this._onAdd()})}ngOnDestroy(){this._dialogRef?._containerInstance&&Promise.resolve().then(()=>{this._onRemove()})}};o.\u0275fac=function(l){return new(l||o)(fe(rp,8),fe(hn),fe(op))},o.\u0275dir=dr({type:o,standalone:!0});let d=o;return d})(),SE=(()=>{let o=class o extends CE{constructor(){super(...arguments),this.id=`mat-mdc-dialog-title-${C5++}`}_onAdd(){this._dialogRef._containerInstance?._addAriaLabelledBy?.(this.id)}_onRemove(){this._dialogRef?._containerInstance?._removeAriaLabelledBy?.(this.id)}};o.\u0275fac=(()=>{let r;return function(t){return(r||(r=Vm(o)))(t||o)}})(),o.\u0275dir=dr({type:o,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-mdc-dialog-title","mdc-dialog__title"],hostVars:1,hostBindings:function(l,t){l&2&&ec("id",t.id)},inputs:{id:"id"},exportAs:["matDialogTitle"],standalone:!0,features:[Ho]});let d=o;return d})(),ME=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275dir=dr({type:o,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],standalone:!0});let d=o;return d})(),kE=(()=>{let o=class o extends CE{_onAdd(){this._dialogRef._containerInstance?._updateActionSectionCount?.(1)}_onRemove(){this._dialogRef._containerInstance?._updateActionSectionCount?.(-1)}};o.\u0275fac=(()=>{let r;return function(t){return(r||(r=Vm(o)))(t||o)}})(),o.\u0275dir=dr({type:o,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:6,hostBindings:function(l,t){l&2&&ki("mat-mdc-dialog-actions-align-start",t.align==="start")("mat-mdc-dialog-actions-align-center",t.align==="center")("mat-mdc-dialog-actions-align-end",t.align==="end")},inputs:{align:"align"},standalone:!0,features:[Ho]});let d=o;return d})();function S5(d,o){let c=d.nativeElement.parentElement;for(;c&&!c.classList.contains("mat-mdc-dialog-container");)c=c.parentElement;return c?o.find(r=>r.id===c.id):null}var IE=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({providers:[op],imports:[bE,ep,rc,qn,qn]});let d=o;return d})();var Cn="https://appsvc-apibackend-dev.azurewebsites.net/v1.0/";var ac=Ed("PushNotifications",{});var M5="firebase",k5="10.12.4";hT(M5,k5,"app");var Gg=new uw("ANGULARFIRE2_VERSION");var ny=class{zone;delegate;constructor(o,c=yI){this.zone=o,this.delegate=c}now(){return this.delegate.now()}schedule(o,c,r){let l=this.zone,t=function(g){l.runGuarded(()=>{o.apply(this,[g])})};return this.delegate.schedule(t,c,r)}};var TE=(()=>{class d{ngZone;outsideAngular;insideAngular;constructor(c){this.ngZone=c,this.outsideAngular=c.runOutsideAngular(()=>new ny(Zone.current)),this.insideAngular=c.run(()=>new ny(Zone.current,bI)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||d)(at(Bi))};static \u0275prov=Ut({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})();var T5="firebase",E5="10.12.4";Ps.registerVersion(T5,E5,"app-compat");var D5=["ngOnDestroy"],DE=(d,o,c,r={})=>new Proxy(d,{get:(l,t)=>c.runOutsideAngular(()=>{if(d[t])return r?.spy?.get&&r.spy.get(t,d[t]),d[t];if(D5.indexOf(t)>-1)return()=>{};let g=o.toPromise().then(C=>{let I=C?.[t];return typeof I=="function"?I.bind(C):I?.then?I.then(O=>c.run(()=>O)):c.run(()=>I)});return new Proxy(()=>{},{get:(C,I)=>g[I],apply:(C,I,O)=>g.then(z=>{let q=z?.(...O);return r?.spy?.apply&&r.spy.apply(t,O,q),q})})})});var ry=class{constructor(o){return o}},oy=new bn("angularfire2.app.options"),ay=new bn("angularfire2.app.name");function mC(d,o,c){let r=typeof c=="string"&&c||"[DEFAULT]",l=typeof c=="object"&&c||{};l.name=l.name||r;let g=Ps.apps.filter(C=>C&&C.name===l.name)[0]||o.runOutsideAngular(()=>Ps.initializeApp(d,l));try{if(JSON.stringify(d)!==JSON.stringify(g.options)){let C=!!module.hot;A5("error",`${g.name} Firebase App already initialized with different options${C?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new ry(g)}var A5=(d,...o)=>{mw()&&typeof console<"u"&&console[d](...o)},P5={provide:ry,useFactory:mC,deps:[oy,Bi,[new Sb,ay]]},AE=(()=>{class d{static initializeApp(c,r){return{ngModule:d,providers:[{provide:oy,useValue:c},{provide:ay,useValue:r}]}}constructor(c){Ps.registerVersion("angularfire",Gg.full,"core"),Ps.registerVersion("angularfire",Gg.full,"app-compat"),Ps.registerVersion("angular",NI.full,c.toString())}static \u0275fac=function(r){return new(r||d)(at(Md))};static \u0275mod=pi({type:d});static \u0275inj=mi({providers:[P5]})}return d})();function PE(d,o,c,r,l){let[,t,g]=globalThis.\u0275AngularfireInstanceCache.find(C=>C[0]===d)||[];if(t)return O5(l,g)||(EE("error",`${o} was already initialized on the ${c} Firebase App with different settings.${R5?" You may need to reload as Firebase is not HMR aware.":""}`),EE("warn",{is:l,was:g})),t;{let C=r();return globalThis.\u0275AngularfireInstanceCache.push([d,C,l]),C}}function O5(d,o){try{return d.toString()===o.toString()}catch{return d===o}}var R5=typeof module<"u"&&!!module.hot,EE=(d,...o)=>{mw()&&typeof console<"u"&&console[d](...o)};globalThis.\u0275AngularfireInstanceCache||=[];var L5=new bn("angularfire2.messaging.vapid-key"),F5=new bn("angularfire2.messaging.service-worker-registeration"),pC=(()=>{class d{requestPermission;getToken;tokenChanges;messages;requestToken;deleteToken;constructor(c,r,l,t,g,C,I){let O=I,z=tr(void 0).pipe(Kl(g.outsideAngular),Ql(g.insideAngular),Es(uT),Es(de=>de?import("./chunk-WCJOXY6X.js"):vI),Nm(()=>mC(c,t,r)),Es(de=>PE(`${de.name}.messaging`,"AngularFireMessaging",de.name,()=>tr(de.messaging()),[])),aw({bufferSize:1,refCount:!1}));this.requestPermission=z.pipe(Kl(g.outsideAngular),Ql(g.insideAngular),Es(()=>Notification.requestPermission())),this.getToken=z.pipe(Kl(g.outsideAngular),Ql(g.insideAngular),Es(de=>jn(this,null,function*(){if(Notification.permission==="granted"){let xe=O?yield O:null;return yield de.getToken({vapidKey:C,serviceWorkerRegistration:xe})}else return null})));let q=new vo(de=>{navigator.permissions.query({name:"notifications"}).then(xe=>{xe.onchange=()=>de.next()})}),ie=z.pipe(Kl(g.outsideAngular),Ql(g.insideAngular),sw(q),sw(this.getToken));return this.tokenChanges=z.pipe(Kl(g.outsideAngular),Ql(g.insideAngular),Es(()=>vb(this.getToken,ie))),this.messages=z.pipe(Kl(g.outsideAngular),Ql(g.insideAngular),Es(de=>new vo(xe=>de.onMessage(xe)))),this.requestToken=z.pipe(Kl(g.outsideAngular),Ql(g.insideAngular),Es(()=>this.requestPermission),Jl(()=>tr(null)),CI(()=>this.tokenChanges)),this.deleteToken=()=>z.pipe(Kl(g.outsideAngular),Ql(g.insideAngular),Es(de=>de.deleteToken()),MI(!1)),DE(this,z,t)}static \u0275fac=function(r){return new(r||d)(at(oy),at(ay,8),at(Md),at(Bi),at(TE),at(L5,8),at(F5,8))};static \u0275prov=Ut({token:d,factory:d.\u0275fac,providedIn:"any"})}return d})(),OE=(()=>{class d{constructor(){Ps.registerVersion("angularfire",Gg.full,"fcm-compat")}static \u0275fac=function(r){return new(r||d)};static \u0275mod=pi({type:d});static \u0275inj=mi({providers:[pC]})}return d})();var ap=(()=>{let o=class o{constructor(r,l,t,g){this.afMessaging=r,this.http=l,this.router=t,this.location=g,this.orderId=null,this.apiUrl=Cn,this.listenForMessages()}requestPermission(){cT.isNativePlatform()?ac.requestPermissions().then(r=>{r.receive==="granted"&&(ac.register(),ac.addListener("registration",l=>{console.log("Push registration success, token: "+l.value),this.token=l.value,this.sendTokenToBackend(l.value)}),ac.addListener("pushNotificationReceived",l=>{this.handleInAppNotification(l),console.log("Push received: ",l)}),ac.addListener("pushNotificationActionPerformed",l=>{console.log("Push action performed: ",l),this.handleNotificationClick(l)}))}):this.afMessaging.requestToken.subscribe({next:r=>{console.log("FCM token:",r),this.token=r,this.sendTokenToBackend(r)},error:r=>{console.error("Error getting token",r)}})}listenForMessages(){this.afMessaging.messages.subscribe(r=>{console.log(r);let l=r.notification?.title,t=r.data?.orderId;l==="New Order"&&t&&this.router.navigate(["getOrder",t],{replaceUrl:!0}).then(()=>{this.location.replaceState("home")})},r=>{console.log(r)})}sendTokenToBackend(r){alert(r);let l=this.apiUrl+"providers/provider-token",t={providerId:localStorage.getItem("providerId"),token:r};alert(t.providerId),alert(t.token),this.http.post(l,t).subscribe({next:g=>{console.log(g),alert("token send sucessfully")},error:g=>{console.log(g),alert("error"),alert(g.error.message)}})}handleInAppNotification(r){alert("inapp notification");let l=r.notification?.title||r.title,t=r.notification?.body||r.body,g=r.data;l&&t&&(alert(l),l==="New Order"&&(alert(g.orderId),setTimeout(()=>{this.router.navigate(["getOrder",g.orderId]).then(()=>{this.location.replaceState("home")})},3e3)))}handleNotificationClick(r){let l=r.data?.orderId,t=r.notification?.title,g=r.notification?.body;t&&t==="New Order"&&(alert("inside nav"),setTimeout(()=>{alert(l),this.router.navigate(["getOrder",l])},3e3))}setOrderId(r){this.orderId=r}getOrderId(){return this.orderId}clearOrderId(){this.orderId=null}};o.\u0275fac=function(l){return new(l||o)(at(pC),at(Gi),at(Bt),at(ii))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var RE=(()=>{let o=class o{constructor(r,l){this.router=r,this.getOrderService=l,this.getOrderService.getOrderId()?this.router.navigate(["getOrder",this.getOrderService.getOrderId]):setTimeout(()=>{this.router.navigate(["started"])},4e3)}};o.\u0275fac=function(l){return new(l||o)(fe(Bt),fe(ap))},o.\u0275cmp=ft({type:o,selectors:[["app-landing-page"]],decls:3,vars:0,consts:[["gifElement",""],[1,"container"],["src","assets/new/ti.gif","alt","Loading...",1,"gif-loader"]],template:function(l,t){l&1&&(V(0,"div",1),ke(1,"img",2,0),j())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}"]});let d=o;return d})();var LE=(()=>{let o=class o{constructor(r){this.location=r}ngAfterViewInit(){this.loadGoogleTranslateScript()}loadGoogleTranslateScript(){if(!document.getElementById("google-translate-script")){let l=document.createElement("script");l.type="text/javascript",l.src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit",l.id="google-translate-script",document.body.appendChild(l)}}navToBack(){this.location.back()}};o.\u0275fac=function(l){return new(l||o)(fe(ii))},o.\u0275cmp=ft({type:o,selectors:[["app-language"]],decls:8,vars:0,consts:[[1,"container"],[1,"sub-container"],[1,"tittlee"],[1,"material-symbols-outlined","notranslate",3,"click"],["id","google_translate_element",1,"trans"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2)(3,"span",3),Oe("click",function(){return t.navToBack()}),$(4," keyboard_backspace "),j(),V(5,"span"),$(6,"Select Language"),j()(),ke(7,"div",4),j()())},styles:['.goog-te-banner-frame.skiptranslate[_ngcontent-%COMP%]{display:none!important}body[_ngcontent-%COMP%]{top:0!important}.goog-logo-link[_ngcontent-%COMP%]{display:none!important}.goog-te-gadget[_ngcontent-%COMP%]{font-size:0}select[_ngcontent-%COMP%]{padding:8px;font-size:16px;border-radius:4px;border:1px solid #ccc;margin-top:10px}.container[_ngcontent-%COMP%]{width:100%;height:100vh;margin-bottom:1rem}.sub-container[_ngcontent-%COMP%]{width:95%;position:relative;top:3%;left:2.5%;display:flex;flex-direction:column;gap:2rem;padding-bottom:3rem}.tittlee[_ngcontent-%COMP%]{display:flex;text-align:center;align-items:center;gap:10px}.tittlee[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.2rem;font-family:"Roboto" sans-serif;font-weight:500}.trans[_ngcontent-%COMP%]   .goog-te-combo[_ngcontent-%COMP%]{width:100%;height:2rem;margin:0;border:1px solid rgb(208,32,32)}']});let d=o;return d})();var FE=(()=>{let o=class o{constructor(r){this.http=r,this.apiUrl=Cn,this.api=this.apiUrl+"providers/provider-auth/signup"}setLog(r){console.log(r);let l={phone:r};console.log(l),this.http.post(this.api,l).subscribe(t=>{console.log(t)},t=>{console.log(t)})}setDefult(){this.api="",this.apiUrl=""}};o.\u0275fac=function(l){return new(l||o)(at(Gi))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var sy=(()=>{let o=class o{constructor(r,l){this.dialogRef=r,this.data=l,this.content="",this.content=l.content,setTimeout(()=>{this.onNoClick()},3e3)}onNoClick(){this.dialogRef.close()}};o.\u0275fac=function(l){return new(l||o)(fe(rp),fe(hC))},o.\u0275cmp=ft({type:o,selectors:[["app-demo"]],inputs:{content:"content"},decls:3,vars:1,consts:[[1,"mat-dialog-container","bottom-dialog-container"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"p"),$(2),j()()),l&2&&(ue(2),Ft(t.content))},styles:[".mat-dialog-container[_ngcontent-%COMP%]{position:fixed;bottom:2rem;left:5%;width:90%;height:auto;border-radius:16px;color:#fff;background-color:#0d0c0cad;padding:8px;display:flex;align-items:center;justify-content:center}"]});let d=o;return d})();var Wn=(()=>{let o=class o{constructor(r){this.dialog=r}openDialog(r){let l={content:r};this.dialog.open(sy,{width:"100%",height:"auto",panelClass:"bottom-dialog-container",data:l})}};o.\u0275fac=function(l){return new(l||o)(at(op))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var Kn=(()=>{let o=class o{constructor(r,l,t){this.http=r,this.router=l,this.dialogService=t,this.apiUrl=Cn,this.userDetails=[],this.workDetails=[],this.alreadyHasAccount=!1,this.isAccountVerify=!0,this.api="",this.name="",this.experience=0,this.selectedSubCategories="",this.userFromServer=[]}setLogInApi(){this.api=this.apiUrl+"providers/provider-auth/login",console.log(this.api)}setSignUpApi(){this.api=this.apiUrl+"providers/provider-auth/signup",console.log(this.api)}setLog(r){console.log(r),console.log(this.api);let l={phone:r};console.log(l),this.http.post(this.api,l).subscribe(t=>{console.log(t),this.responseOtp=t,this.userNumber=r,this.router.navigate(["verify"])},t=>{console.log(t),console.log(t.error),console.log(t.error.message),t.error.message==="User does not exist. Please sign up first."?(alert("Account was not found. Please signUp first."),this.router.navigate(["selectAccount"])):alert("something went wrong.Please retry again")})}showOtp(){alert(this.responseOtp.otp)}resendOtp(){console.log(this.userNumber),console.log(this.api);let r={phone:this.userNumber};console.log(r),this.http.post(this.api,r).subscribe(l=>{console.log(l)},l=>{console.log(l)})}verifyOtp(r){let l={otp:r,phone:this.userNumber},t=this.apiUrl+"providers/provider-auth/verify-otp";return this.http.post(t,l)}setUserInLocalStroage(r){localStorage.setItem("providerId",r)}setUser(r){this.userDetails.push({number:this.userNumber}),console.log(this.userDetails),localStorage.setItem("providerId",r),this.userId=localStorage.getItem("providerId")}getUserId(){let r=localStorage.getItem("providerId");return console.log(r),tr(r)}removeUser(){localStorage.removeItem("providerId")}setWork(r,l){this.workName=r,this.workId=l}setSubCat(r){this.selectedSubCategories=r,console.log(this.selectedSubCategories)}setservices(r){console.log("serviceId",r),this.selectedServiceId=r}setAge(r){console.log(r),this.age=r,console.log(this.age)}setExperiance(r){console.log(r),this.experience=r}setWorkDetails(){this.workDetails=[],console.log(this.selectedSubCategories);let r=[{categoryId:this.workId,experience:this.experience,subcategoryId:this.selectedSubCategories,serviceId:this.selectedServiceId}];this.workDetails=r,console.log(this.workDetails)}getSubCategory(){let r=this.apiUrl+`core/sub-categories/category/${this.categoryId}`;return this.http.get(r)}getServices(r,l){let t=`${this.apiUrl}/core/services/filter/${r}/${l}`;return this.http.get(t)}sendWorkDetails(){let r=this.apiUrl+"providers/provider-work",l=this.workDetails,g={providerId:localStorage.getItem("providerId"),works:l};return console.log(g),this.http.post(r,g)}UserDetails(r){let l=[];r.forEach((g,C)=>{l.push(C=g)}),console.log(l),console.log(r);let t=this.apiUrl+"providers/provider-details";this.http.post(t,r).subscribe(g=>{console.log("Success",g),this.userFromServer=g,this.router.navigate(["aadharVerify"])},g=>{console.error("Error",g),g.error instanceof ErrorEvent?alert("A network error occurred. Please try again later."):alert("An error occurred. Please try again later."),console.error(`Backend returned code ${g.status}, body was: `,g.error)})}formatingResponse(r){console.log(r.work),console.log(r.work);let t=JSON.parse(r.work).flat();this.userFromServer.work=t,console.log(this.userFromServer)}updateUserWork(r,l){console.log(r);let t=localStorage.getItem("providerId");console.log(l);let g={providerId:t,works:r};console.log("work in service",g);let C=this.apiUrl+"providers/provider-work";this.http.post(C,g).subscribe(I=>{console.log(I),this.dialogService.openDialog("Service has been updated"),this.router.navigate(["home"])},I=>{console.log(I)})}getPhoneNumber(){let r=localStorage.getItem("providerId"),l=this.apiUrl+`providers/provider-auth/${r}`;return this.http.get(l).subscribe(t=>{this.userNumber=t.phone,console.log(this.userNumber)},t=>{console.log(t)}),this.userNumber}setDefult(){this.userDetails=[],this.workDetails=[],this.userNumber=null,this.userId="",this.alreadyHasAccount=!1,this.isAccountVerify=!0,this.api="",this.responseOtp="",this.name="",this.pincode="",this.radius=void 0,this.workName="",this.workId="",this.age="",this.gender="",this.experience=0,this.selectedSubCategories="",this.categoryId="",this.userFromServer=[]}};o.\u0275fac=function(l){return new(l||o)(at(Gi),at(Bt),at(Wn))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var ns=d=>({"full-screen":d}),N5=(d,o)=>({"border-radius":d,"background-color":o}),V5=(d,o,c,r)=>({"border-top-color":d,"border-right-color":o,"border-bottom-color":c,"border-left-color":r}),gr=d=>({"background-color":d}),j5=d=>({color:d});function U5(d,o){if(d&1&&ke(0,"div",14),d&2){let c=lt(2);Fe("ngClass",di(2,ns,c.config.fullScreenBackdrop===!0))("ngStyle",FI(4,V5,c.config.secondaryColour,c.config.secondaryColour,c.config.secondaryColour,c.config.primaryColour))}}function W5(d,o){if(d&1&&(V(0,"div",15),ke(1,"div",16)(2,"div",17)(3,"div",18)(4,"div",19)(5,"div",20)(6,"div",21)(7,"div",22)(8,"div",23)(9,"div",24),j()),d&2){let c=lt(2);Fe("ngClass",di(10,ns,c.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",di(12,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(14,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(16,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(18,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(20,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(22,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(24,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(26,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(28,gr,c.config.primaryColour))}}function H5(d,o){if(d&1&&ke(0,"div",25),d&2){let c=lt(2);Fe("ngStyle",di(2,gr,c.config.primaryColour))("ngClass",di(4,ns,c.config.fullScreenBackdrop===!0))}}function G5(d,o){if(d&1&&(V(0,"div",26),ke(1,"div",27)(2,"div",28)(3,"div",29)(4,"div",30)(5,"div",31),j()),d&2){let c=lt(2);Fe("ngClass",di(6,ns,c.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",di(8,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(10,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(12,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(14,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(16,gr,c.config.primaryColour))}}function q5(d,o){if(d&1&&(V(0,"div",32),ke(1,"div",33)(2,"div",34),j()),d&2){let c=lt(2);Fe("ngClass",di(3,ns,c.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",di(5,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(7,gr,c.config.secondaryColour))}}function $5(d,o){if(d&1&&(V(0,"div",35),ke(1,"div",36)(2,"div",37),j()),d&2){let c=lt(2);Fe("ngClass",di(3,ns,c.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",di(5,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(7,gr,c.config.secondaryColour))}}function Y5(d,o){if(d&1&&ke(0,"div",38),d&2){let c=lt(2);Fe("ngClass",di(2,ns,c.config.fullScreenBackdrop===!0))("ngStyle",di(4,gr,c.config.primaryColour))}}function Z5(d,o){if(d&1&&(V(0,"div",39),ke(1,"div",40)(2,"div",41),j()),d&2){let c=lt(2);Fe("ngClass",di(3,ns,c.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",di(5,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(7,gr,c.config.secondaryColour))}}function X5(d,o){if(d&1&&ke(0,"div",42),d&2){let c=lt(2);Fe("ngClass",di(2,ns,c.config.fullScreenBackdrop===!0))("ngStyle",di(4,j5,c.config.primaryColour))}}function Q5(d,o){if(d&1&&ke(0,"div",43),d&2){let c=lt(2);Fe("ngClass",di(1,ns,c.config.fullScreenBackdrop===!0))}}function K5(d,o){if(d&1&&(V(0,"div",44),ke(1,"div",45)(2,"div",46)(3,"div",47),j()),d&2){let c=lt(2);Fe("ngClass",di(4,ns,c.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",di(6,gr,c.config.primaryColour)),ue(),Fe("ngStyle",di(8,gr,c.config.secondaryColour)),ue(),Fe("ngStyle",di(10,gr,c.config.tertiaryColour))}}function J5(d,o){d&1&&dw(0)}function e4(d,o){if(d&1&&(kd(0),Nt(1,J5,1,0,"ng-container",48),Id()),d&2){let c=lt(2);ue(),Fe("ngTemplateOutlet",c.template)}}function t4(d,o){if(d&1&&(V(0,"div"),ke(1,"div",1),V(2,"div",2),Nt(3,U5,1,9,"div",3)(4,W5,10,30,"div",4)(5,H5,1,6,"div",5)(6,G5,6,18,"div",6)(7,q5,3,9,"div",7)(8,$5,3,9,"div",8)(9,Y5,1,6,"div",9)(10,Z5,3,9,"div",10)(11,X5,1,6,"div",11)(12,Q5,1,3,"div",12)(13,K5,4,12,"div",13)(14,e4,2,1,"ng-container",0),j()()),d&2){let c=lt();ue(),Fe("ngClass",di(14,ns,c.config.fullScreenBackdrop===!0))("ngStyle",hw(16,N5,c.config.backdropBorderRadius,c.config.backdropBackgroundColour)),ue(),Fe("ngSwitch",c.config.animationType),ue(),Fe("ngSwitchCase",c.ngxLoadingAnimationTypes.circle),ue(),Fe("ngSwitchCase",c.ngxLoadingAnimationTypes.cubeGrid),ue(),Fe("ngSwitchCase",c.ngxLoadingAnimationTypes.rotatingPlane),ue(),Fe("ngSwitchCase",c.ngxLoadingAnimationTypes.rectangleBounce),ue(),Fe("ngSwitchCase",c.ngxLoadingAnimationTypes.wanderingCubes),ue(),Fe("ngSwitchCase",c.ngxLoadingAnimationTypes.doubleBounce),ue(),Fe("ngSwitchCase",c.ngxLoadingAnimationTypes.pulse),ue(),Fe("ngSwitchCase",c.ngxLoadingAnimationTypes.chasingDots),ue(),Fe("ngSwitchCase",c.ngxLoadingAnimationTypes.circleSwish),ue(),Fe("ngSwitchCase",c.ngxLoadingAnimationTypes.none),ue(2),Fe("ngIf",c.template)}}var ly=class{constructor(o={}){this.backdropBorderRadius=o.backdropBorderRadius,this.backdropBackgroundColour=o.backdropBackgroundColour,this.fullScreenBackdrop=o.fullScreenBackdrop,this.animationType=o.animationType,this.primaryColour=o.primaryColour,this.secondaryColour=o.secondaryColour,this.tertiaryColour=o.tertiaryColour}},zE={chasingDots:"chasing-dots",circle:"sk-circle",circleSwish:"circleSwish",cubeGrid:"sk-cube-grid",doubleBounce:"double-bounce",none:"none",pulse:"pulse",rectangleBounce:"rectangle-bounce",rotatingPlane:"rotating-plane",threeBounce:"three-bounce",wanderingCubes:"wandering-cubes"},i4=(()=>{let o=class o{constructor(r){this.config=r,this.loadingConfig=this.config||new ly}};o.\u0275fac=function(l){return new(l||o)(at("loadingConfig",8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),cy=(()=>{let o=class o{constructor(r){this.LoadingService=r,this.show=!1,this.config=new ly,this.defaultConfig={animationType:zE.threeBounce,backdropBackgroundColour:"rgba(0, 0, 0, 0.3)",backdropBorderRadius:"0px",fullScreenBackdrop:!1,primaryColour:"#ffffff",secondaryColour:"#ffffff",tertiaryColour:"#ffffff"},this.ngxLoadingAnimationTypes=zE}ngOnInit(){this.setupConfig()}setupConfig(){for(let r in this.defaultConfig)this.config[r]==null&&(this.config[r]=this.LoadingService.loadingConfig[r]!=null?this.LoadingService.loadingConfig[r]:this.defaultConfig[r])}};o.\u0275fac=function(l){return new(l||o)(fe(i4))},o.\u0275cmp=ft({type:o,selectors:[["ngx-loading"]],inputs:{show:"show",config:"config",template:"template"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"backdrop",3,"ngClass","ngStyle"],[3,"ngSwitch"],["class","spinner-circle",3,"ngClass","ngStyle",4,"ngSwitchCase"],["class","sk-cube-grid",3,"ngClass",4,"ngSwitchCase"],["class","spinner-sk-rotateplane",3,"ngStyle","ngClass",4,"ngSwitchCase"],["class","spinner-rectangle-bounce",3,"ngClass",4,"ngSwitchCase"],["class","spinner-wandering-cubes",3,"ngClass",4,"ngSwitchCase"],["class","spinner-double-bounce",3,"ngClass",4,"ngSwitchCase"],["class","spinner-pulse",3,"ngClass","ngStyle",4,"ngSwitchCase"],["class","spinner-chasing-dots",3,"ngClass",4,"ngSwitchCase"],["class","spinner-circle-swish",3,"ngClass","ngStyle",4,"ngSwitchCase"],[3,"ngClass",4,"ngSwitchCase"],["class","spinner-three-bounce",3,"ngClass",4,"ngSwitchDefault"],[1,"spinner-circle",3,"ngClass","ngStyle"],[1,"sk-cube-grid",3,"ngClass"],[1,"sk-cube","sk-cube1",3,"ngStyle"],[1,"sk-cube","sk-cube2",3,"ngStyle"],[1,"sk-cube","sk-cube3",3,"ngStyle"],[1,"sk-cube","sk-cube4",3,"ngStyle"],[1,"sk-cube","sk-cube5",3,"ngStyle"],[1,"sk-cube","sk-cube6",3,"ngStyle"],[1,"sk-cube","sk-cube7",3,"ngStyle"],[1,"sk-cube","sk-cube8",3,"ngStyle"],[1,"sk-cube","sk-cube9",3,"ngStyle"],[1,"spinner-sk-rotateplane",3,"ngStyle","ngClass"],[1,"spinner-rectangle-bounce",3,"ngClass"],[1,"rect1",3,"ngStyle"],[1,"rect2",3,"ngStyle"],[1,"rect3",3,"ngStyle"],[1,"rect4",3,"ngStyle"],[1,"rect5",3,"ngStyle"],[1,"spinner-wandering-cubes",3,"ngClass"],[1,"cube1",3,"ngStyle"],[1,"cube2",3,"ngStyle"],[1,"spinner-double-bounce",3,"ngClass"],[1,"double-bounce1",3,"ngStyle"],[1,"double-bounce2",3,"ngStyle"],[1,"spinner-pulse",3,"ngClass","ngStyle"],[1,"spinner-chasing-dots",3,"ngClass"],[1,"dot1",3,"ngStyle"],[1,"dot2",3,"ngStyle"],[1,"spinner-circle-swish",3,"ngClass","ngStyle"],[3,"ngClass"],[1,"spinner-three-bounce",3,"ngClass"],[1,"bounce1",3,"ngStyle"],[1,"bounce2",3,"ngStyle"],[1,"bounce3",3,"ngStyle"],[4,"ngTemplateOutlet"]],template:function(l,t){l&1&&Nt(0,t4,15,19,"div",0),l&2&&Fe("ngIf",t.show)},dependencies:[Oo,Cr,Ab,Db,UI,WI,HI],styles:['.backdrop[_ngcontent-%COMP%]{z-index:1999;position:absolute;inset:0;background-color:#0000004d}.spinner-circle[_ngcontent-%COMP%], .spinner-circle[_ngcontent-%COMP%]:after{border-radius:50%;width:10em;height:10em}.spinner-circle[_ngcontent-%COMP%]{font-size:6px;border-top:1.1em solid rgba(255,255,255,.2);border-right:1.1em solid rgba(255,255,255,.2);border-bottom:1.1em solid rgba(255,255,255,.2);border-left:1.1em solid #ffffff;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:_ngcontent-%COMP%_load8 1.1s infinite linear;animation:_ngcontent-%COMP%_load8 1.1s infinite linear}@-webkit-keyframes _ngcontent-%COMP%_load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.spinner-circle-swish[_ngcontent-%COMP%]{font-size:60px;overflow:hidden;width:1em;height:1em;border-radius:50%;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:_ngcontent-%COMP%_load6 1.7s infinite ease;animation:_ngcontent-%COMP%_load6 1.7s infinite ease}@-webkit-keyframes _ngcontent-%COMP%_load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;-webkit-transform:rotate(0deg)}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}to{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;-webkit-transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;transform:rotate(0)}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}to{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;transform:rotate(360deg)}}.sk-cube-grid[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube[_ngcontent-%COMP%]{width:33%;height:33%;background-color:#333;float:left;-webkit-animation:_ngcontent-%COMP%_sk-cubeGridScaleDelay 1.3s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-cubeGridScaleDelay 1.3s infinite ease-in-out}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube1[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube2[_ngcontent-%COMP%]{-webkit-animation-delay:.3s;animation-delay:.3s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube3[_ngcontent-%COMP%]{-webkit-animation-delay:.4s;animation-delay:.4s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube4[_ngcontent-%COMP%]{-webkit-animation-delay:.1s;animation-delay:.1s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube5[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube6[_ngcontent-%COMP%]{-webkit-animation-delay:.3s;animation-delay:.3s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube7[_ngcontent-%COMP%]{-webkit-animation-delay:0s;animation-delay:0s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube8[_ngcontent-%COMP%]{-webkit-animation-delay:.1s;animation-delay:.1s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube9[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}@-webkit-keyframes _ngcontent-%COMP%_sk-cubeGridScaleDelay{0%,70%,to{-webkit-transform:scale3D(1,1,1);transform:scaleZ(1)}35%{-webkit-transform:scale3D(0,0,1);transform:scale3D(0,0,1)}}@keyframes _ngcontent-%COMP%_sk-cubeGridScaleDelay{0%,70%,to{-webkit-transform:scale3D(1,1,1);transform:scaleZ(1)}35%{-webkit-transform:scale3D(0,0,1);transform:scale3D(0,0,1)}}.spinner-double-bounce[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.double-bounce1[_ngcontent-%COMP%], .double-bounce2[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;background-color:#333;opacity:.6;position:absolute;top:0;left:0;-webkit-animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out}.double-bounce2[_ngcontent-%COMP%]{-webkit-animation-delay:-1s;animation-delay:-1s}.spinner-pulse[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#333;position:absolute;inset:0;margin:auto;z-index:2000;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-scaleout 1s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-scaleout 1s infinite ease-in-out}@-webkit-keyframes _ngcontent-%COMP%_sk-scaleout{0%{-webkit-transform:scale(0)}to{-webkit-transform:scale(1);opacity:0}}@keyframes _ngcontent-%COMP%_sk-scaleout{0%{-webkit-transform:scale(0);transform:scale(0)}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.spinner-three-bounce[_ngcontent-%COMP%]{width:70px;text-align:center;position:absolute;inset:0;height:20px;margin:auto;z-index:2000}.spinner-three-bounce[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:18px;height:18px;background-color:#fff;border-radius:100%;display:inline-block;-webkit-animation:_ngcontent-%COMP%_sk-bouncedelay 1.4s infinite ease-in-out both;animation:_ngcontent-%COMP%_sk-bouncedelay 1.4s infinite ease-in-out both}.spinner-three-bounce[_ngcontent-%COMP%]   .bounce1[_ngcontent-%COMP%]{-webkit-animation-delay:-.32s;animation-delay:-.32s}.spinner-three-bounce[_ngcontent-%COMP%]   .bounce2[_ngcontent-%COMP%]{-webkit-animation-delay:-.16s;animation-delay:-.16s}@-webkit-keyframes _ngcontent-%COMP%_sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0)}40%{-webkit-transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.spinner-sk-rotateplane[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#fff;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-animation:_ngcontent-%COMP%_sk-rotateplane 1.2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-rotateplane 1.2s infinite ease-in-out}@-webkit-keyframes _ngcontent-%COMP%_sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}to{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes _ngcontent-%COMP%_sk-rotateplane{0%{transform:perspective(120px) rotateX(0) rotateY(0);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}to{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}.spinner-rectangle-bounce[_ngcontent-%COMP%]{width:50px;height:40px;font-size:10px;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000}.spinner-rectangle-bounce[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background-color:#fff;height:100%;width:6px;display:inline-block;-webkit-animation:_ngcontent-%COMP%_sk-stretchdelay 1.2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-stretchdelay 1.2s infinite ease-in-out}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect2[_ngcontent-%COMP%]{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect3[_ngcontent-%COMP%]{-webkit-animation-delay:-1s;animation-delay:-1s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect4[_ngcontent-%COMP%]{-webkit-animation-delay:-.9s;animation-delay:-.9s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect5[_ngcontent-%COMP%]{-webkit-animation-delay:-.8s;animation-delay:-.8s}@-webkit-keyframes _ngcontent-%COMP%_sk-stretchdelay{0%,40%,to{-webkit-transform:scaleY(.4)}20%{-webkit-transform:scaleY(1)}}@keyframes _ngcontent-%COMP%_sk-stretchdelay{0%,40%,to{transform:scaleY(.4);-webkit-transform:scaleY(.4)}20%{transform:scaleY(1);-webkit-transform:scaleY(1)}}.spinner-wandering-cubes[_ngcontent-%COMP%]{width:60px;height:58px;font-size:10px;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000}.cube1[_ngcontent-%COMP%], .cube2[_ngcontent-%COMP%]{background-color:#fff;width:15px;height:15px;position:absolute;top:0;left:0;-webkit-animation:_ngcontent-%COMP%_sk-cubemove 1.8s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-cubemove 1.8s infinite ease-in-out}.cube2[_ngcontent-%COMP%]{-webkit-animation-delay:-.9s;animation-delay:-.9s}@-webkit-keyframes _ngcontent-%COMP%_sk-cubemove{25%{-webkit-transform:translateX(42px) rotate(-90deg) scale(.5)}50%{-webkit-transform:translateX(42px) translateY(42px) rotate(-180deg)}75%{-webkit-transform:translateX(0px) translateY(42px) rotate(-270deg) scale(.5)}to{-webkit-transform:rotate(-360deg)}}@keyframes _ngcontent-%COMP%_sk-cubemove{25%{transform:translate(42px) rotate(-90deg) scale(.5);-webkit-transform:translateX(42px) rotate(-90deg) scale(.5)}50%{transform:translate(42px) translateY(42px) rotate(-179deg);-webkit-transform:translateX(42px) translateY(42px) rotate(-179deg)}50.1%{transform:translate(42px) translateY(42px) rotate(-180deg);-webkit-transform:translateX(42px) translateY(42px) rotate(-180deg)}75%{transform:translate(0) translateY(42px) rotate(-270deg) scale(.5);-webkit-transform:translateX(0px) translateY(42px) rotate(-270deg) scale(.5)}to{transform:rotate(-360deg);-webkit-transform:rotate(-360deg)}}.sk-circle[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.sk-circle[_ngcontent-%COMP%]   .sk-child[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;left:0;top:0}.sk-circle[_ngcontent-%COMP%]   .sk-child[_ngcontent-%COMP%]:before{content:"";display:block;margin:0 auto;width:15%;height:15%;background-color:#333;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-circleBounceDelay 1.2s infinite ease-in-out both;animation:_ngcontent-%COMP%_sk-circleBounceDelay 1.2s infinite ease-in-out both}.sk-circle[_ngcontent-%COMP%]   .sk-circle2[_ngcontent-%COMP%]{-webkit-transform:rotate(30deg);-ms-transform:rotate(30deg);transform:rotate(30deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle3[_ngcontent-%COMP%]{-webkit-transform:rotate(60deg);-ms-transform:rotate(60deg);transform:rotate(60deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle4[_ngcontent-%COMP%]{-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle5[_ngcontent-%COMP%]{-webkit-transform:rotate(120deg);-ms-transform:rotate(120deg);transform:rotate(120deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle6[_ngcontent-%COMP%]{-webkit-transform:rotate(150deg);-ms-transform:rotate(150deg);transform:rotate(150deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle7[_ngcontent-%COMP%]{-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle8[_ngcontent-%COMP%]{-webkit-transform:rotate(210deg);-ms-transform:rotate(210deg);transform:rotate(210deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle9[_ngcontent-%COMP%]{-webkit-transform:rotate(240deg);-ms-transform:rotate(240deg);transform:rotate(240deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle10[_ngcontent-%COMP%]{-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle11[_ngcontent-%COMP%]{-webkit-transform:rotate(300deg);-ms-transform:rotate(300deg);transform:rotate(300deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle12[_ngcontent-%COMP%]{-webkit-transform:rotate(330deg);-ms-transform:rotate(330deg);transform:rotate(330deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle2[_ngcontent-%COMP%]:before{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.sk-circle[_ngcontent-%COMP%]   .sk-circle3[_ngcontent-%COMP%]:before{-webkit-animation-delay:-1s;animation-delay:-1s}.sk-circle[_ngcontent-%COMP%]   .sk-circle4[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.9s;animation-delay:-.9s}.sk-circle[_ngcontent-%COMP%]   .sk-circle5[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.8s;animation-delay:-.8s}.sk-circle[_ngcontent-%COMP%]   .sk-circle6[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.7s;animation-delay:-.7s}.sk-circle[_ngcontent-%COMP%]   .sk-circle7[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.6s;animation-delay:-.6s}.sk-circle[_ngcontent-%COMP%]   .sk-circle8[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.5s;animation-delay:-.5s}.sk-circle[_ngcontent-%COMP%]   .sk-circle9[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.4s;animation-delay:-.4s}.sk-circle[_ngcontent-%COMP%]   .sk-circle10[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.3s;animation-delay:-.3s}.sk-circle[_ngcontent-%COMP%]   .sk-circle11[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.2s;animation-delay:-.2s}.sk-circle[_ngcontent-%COMP%]   .sk-circle12[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.1s;animation-delay:-.1s}@-webkit-keyframes _ngcontent-%COMP%_sk-circleBounceDelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-circleBounceDelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.spinner-chasing-dots[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000;text-align:center;-webkit-animation:_ngcontent-%COMP%_sk-rotate 2s infinite linear;animation:_ngcontent-%COMP%_sk-rotate 2s infinite linear}.dot1[_ngcontent-%COMP%], .dot2[_ngcontent-%COMP%]{width:60%;height:60%;display:inline-block;position:absolute;top:0;background-color:#333;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out}.dot2[_ngcontent-%COMP%]{top:auto;bottom:0;-webkit-animation-delay:-1s;animation-delay:-1s}@-webkit-keyframes _ngcontent-%COMP%_sk-rotate{to{-webkit-transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_sk-rotate{to{transform:rotate(360deg);-webkit-transform:rotate(360deg)}}@-webkit-keyframes _ngcontent-%COMP%_sk-bounce{0%,to{-webkit-transform:scale(0)}50%{-webkit-transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-bounce{0%,to{transform:scale(0);-webkit-transform:scale(0)}50%{transform:scale(1);-webkit-transform:scale(1)}}.full-screen[_ngcontent-%COMP%]{position:fixed;position:-ms-page}']});let d=o;return d})(),BE=(()=>{let o=class o{static forRoot(r){return{ngModule:o,providers:[{provide:"loadingConfig",useValue:r}]}}};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[ll]});let d=o;return d})();var n4=d=>({disabled:d}),r4=()=>({backdropBorderRadius:"3px",backdropBackgroundColour:"rgba(0, 0, 0, 0.5)"});function o4(d,o){d&1&&(V(0,"div",16)(1,"p",17),$(2,"***Please enter a valid 10-digit phone number."),j()())}function a4(d,o){if(d&1&&ke(0,"ngx-loading",15),d&2){let c=lt();Fe("show",c.loading)("config",Eb(2,r4))}}var VE=(()=>{let o=class o{constructor(r,l,t,g,C){this.router=r,this.fb=l,this.auth=t,this.http=g,this.logInService=C,this.loading=!1,this.showError=!1,this.myForm=this.fb.group({phoneNumber:[null,[po.required,po.pattern("^[0-9]{10}$")]]})}validate(){this.myForm.value.phoneNumber.length===10?this.showError=!1:this.showError=!0}login(){this.loading=!0,this.logInService.setLog(this.myForm.value.phoneNumber),this.loading=!1}};o.\u0275fac=function(l){return new(l||o)(fe(Bt),fe(aa),fe(FE),fe(Gi),fe(Kn))},o.\u0275cmp=ft({type:o,selectors:[["app-log-in"]],decls:29,vars:7,consts:[[1,"container"],[1,"sub-container"],[1,"banner-div"],[1,"banner"],[3,"submit","input","formGroup"],[1,"phone-div"],[1,"num"],[1,"line"],["type","tel","formControlName","phoneNumber",1,"input-box"],["class","error",4,"ngIf"],[1,"update-div"],["type","checkbox"],["src","assets\\logo\\wts up .png"],[1,"btn"],[3,"disabled","ngClass"],[3,"show","config"],[1,"error"],[1,"error-message",2,"color","red"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span"),$(5,"Earn more"),j(),ke(6,"br"),V(7,"p"),$(8,"fill your dreams"),j()()(),V(9,"form",4),Oe("submit",function(){return t.login()})("input",function(){return t.validate()}),V(10,"div",5)(11,"div")(12,"span",6),$(13,"+91"),j(),ke(14,"span",7)(15,"input",8),j()(),Nt(16,o4,3,0,"div",9),V(17,"div",10),ke(18,"input",11),V(19,"span"),$(20,"Get update on \xA0"),ke(21,"img",12),$(22," whatsapp"),j()(),ke(23,"br")(24,"br"),V(25,"div",13)(26,"button",14),$(27,"Get OTP"),j()()()()(),Nt(28,a4,1,3,"ngx-loading",15)),l&2&&(ue(9),Fe("formGroup",t.myForm),ue(7),Fe("ngIf",t.showError),ue(10),Fe("disabled",!t.myForm.valid)("ngClass",di(5,n4,!t.myForm.valid)),ue(2),Xn(28,t.loading?28:-1))},dependencies:[Oo,Cr,Lo,mo,hr,Ro,oa,es,cy],styles:['.container[_ngcontent-%COMP%]{width:99vw;max-width:450px;height:100vh;display:flex;flex-direction:column;align-items:center}.sub-container[_ngcontent-%COMP%]{width:100%;position:relative;top:3%;display:grid;grid-gap:1.2rem;align-items:center}.banner-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}.banner[_ngcontent-%COMP%]{width:90%;max-width:450px;height:26rem;background-image:url("./media/Rectangle 25-RGNGM5F3.png");background-size:cover;background-repeat:no-repeat;background-position:center;display:flex;flex-direction:column;justify-content:center;text-align:center}.banner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:42px;font-family:Inter,sans-serif;font-weight:600;color:#fff}.banner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:26px;font-family:Inter,sans-serif;font-weight:600;color:#fff}.phone-div[_ngcontent-%COMP%]{width:90%;align-items:start;border-radius:.5rem;height:3.5rem;border:1px solid rgba(0,0,0,1);position:relative;left:5%}.phone-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:flex;position:relative;top:30%;left:5%;font-size:1.3rem}.phone-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:26px;height:17px}.num[_ngcontent-%COMP%]{font-size:1.4rem}.line[_ngcontent-%COMP%]{margin-top:-.2rem;font-size:2.2rem}.input-box[_ngcontent-%COMP%]{float:left;margin-top:-.4rem;width:70%;height:2rem;outline:0;border-width:0 0 0;font-size:1.5rem}input[type=checkbox][_ngcontent-%COMP%]{accent-color:#D16611}.update-div[_ngcontent-%COMP%]{width:80%;height:1.6rem;margin-left:5%;margin-top:.4rem;align-items:center;display:flex}.update-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;background-color:#d70d09}.update-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.1rem;font-family:inter;font-weight:400;line-height:1.4rem}.btn[_ngcontent-%COMP%]{width:90%;align-items:center;margin-left:5%}button[_ngcontent-%COMP%]{width:100%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}.disabled[_ngcontent-%COMP%]{background-color:#838180}.error[_ngcontent-%COMP%]{width:90%;margin-left:5%}']});let d=o;return d})();var Ar=(()=>{let o=class o{constructor(r,l,t){this.http=r,this.router=l,this.dialogService=t,this.providerRating=0,this.apiUrl=Cn,this.userId=localStorage.getItem("provider"),this.isVerify=!1,this.checkingDetails=!1,this.items=[],this.selectedJob=[],this.userName="",this.workDetails=[],this.getServices()}setCheckingDetails(r){this.checkingDetails=r}getcheckingDetails(){return this.checkingDetails}selectedJobDetails(r){console.log(r),this.selectedJob=r}getSelectedJob(){return console.log(this.selectedJob),this.selectedJob}getUserDetails(r){let l=this.apiUrl+`providers/provider-details/${r}`;return new vo(t=>{this.http.get(l).subscribe(g=>{console.log(g),console.log("response",g),this.isVerify=g.isVerified,this.userDetails=g,this.formatingResponse(this.userDetails),t.next(!1),t.complete()},g=>{console.log(g),g.error.message=="No items found for this user"?(console.log("not found"),t.next(!0)):(t.error(g),this.checkingDetails||(this.dialogService.openDialog("Please add the details"),this.checkingDetails=!0,this.router.navigate(["aboutUser"]))),t.complete()})})}getRating(){let r=localStorage.getItem("providerId");if(this.providerRating>0)return tr(this.providerRating);{let l=`${this.apiUrl}users/user-feedback/provider/${r}`;return new vo(t=>{this.http.get(l).subscribe({next:g=>{console.log(g),this.providerRating=g,t.next(this.providerRating)},error:g=>{console.log(g)}})})}}formatingResponse(r){try{typeof r.work=="string"&&(this.workDetails=r.work);let t=r.work;this.workDetails=t,console.log(this.workDetails)}catch(l){console.error("Error processing response.work",l)}}flattenArray(r){return r.reduce((l,t)=>Array.isArray(t)?l.concat(this.flattenArray(t)):l.concat(t),[])}getServices(){let r=this.apiUrl+"core/categories";this.http.get(r).subscribe(l=>{console.log(l),this.formattingServices(l)},l=>{console.log(l)})}formattingServices(r){r.forEach(l=>{this.items.push({id:l._id,names:l.name,checked:!1,image:l.imageKey})})}getAvailability(){let r=this.apiUrl+`providers/provider-date/${localStorage.getItem("providerId")}`;return this.http.get(r)}setDefault(){this.items=[],this.selectedJob=[],this.userDetails="",this.userName=""}};o.\u0275fac=function(l){return new(l||o)(at(Gi),at(Bt),at(Wn))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var s4=["input1"],l4=["input2"],c4=["input3"],d4=["input4"];function h4(d,o){if(d&1){let c=Xt();V(0,"u",16),Oe("click",function(){gt(c);let l=lt();return _t(l.resend())}),$(1,"Resend"),j()}}function u4(d,o){if(d&1&&(V(0,"div",17)(1,"p"),$(2),j()()),d&2){let c=lt();ue(2),Aa("",c.minutes," : ",c.seconds,"")}}var jE=(()=>{let o=class o{constructor(r,l,t,g,C,I,O){this.form=r,this.logInService=l,this.jobDetailsService=t,this.loginServices=g,this.router=C,this.dialogeService=I,this.http=O,this.apiUrl=Cn,this.userNumber=0,this.resendToggling="resend",this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}ngOnInit(){this.userNumber=this.logInService.userNumber,this.logInService.showOtp()}onInput(r,l){if(r.target.value.length===1)switch(l){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}onKeyDown(r,l){console.log("called",r,l);let t=r.target;if(console.log("input :",t.value),console.log(l==1),r.key==="Backspace"&&!t.value&&l>1){let g=l-1;if(console.log("previous input",`#input${l-1}`),g)switch(g){case 3:this.input3.nativeElement.focus();break;case 2:this.input2.nativeElement.focus();break;case 1:this.input1.nativeElement.focus();break;default:console.log("something went wrong")}}}login(){return jn(this,null,function*(){let r=this.otp.value,l=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log("OTP:",this.otp.value),console.log(l),this.logInService.verifyOtp(l).subscribe(t=>jn(this,null,function*(){console.log("log in done",t),console.log(t.providerId),yield this.logInService.setUser(t.providerId),this.storeUserData(),yield this.chekingUser()}),t=>{console.log("error",t),alert(t.error.message)})})}storeUserData(){}resend(){this.logInService.resendOtp(),this.resendToggling="countdown",this.startCountdown()}startCountdown(){let r=120;this.updateDisplay(r),this.countdownInterval=setInterval(()=>{r-=1,r<=0?(this.stopCountdown(),this.resendToggling="resend"):this.updateDisplay(r)},1e3)}stopCountdown(){clearInterval(this.countdownInterval)}ngOnDestroy(){this.stopCountdown()}updateDisplay(r){this.minutes=Math.floor(r/60),this.seconds=r%60}chekingUser(){return jn(this,null,function*(){let r=localStorage.getItem("providerId"),l=`${this.apiUrl}providers/provider-details/${r}`;this.http.get(l).subscribe(t=>{console.log("response",t),console.log(t.providerName),this.logInService.alreadyHasAccount=!0,this.navTo()},t=>{console.log(t),this.dialogeService.openDialog("Please add your Details"),this.router.navigate(["aboutUser"])})})}navTo(){this.logInService.alreadyHasAccount?this.router.navigate(["home"]):(this.dialogeService.openDialog("Please add your Details"),this.router.navigate(["aboutUser"]))}};o.\u0275fac=function(l){return new(l||o)(fe(aa),fe(Kn),fe(Ar),fe(Kn),fe(Bt),fe(Wn),fe(Gi))},o.\u0275cmp=ft({type:o,selectors:[["app-verify"]],viewQuery:function(l,t){if(l&1&&(yi(s4,5),yi(l4,5),yi(c4,5),yi(d4,5)),l&2){let g;_i(g=bi())&&(t.input1=g.first),_i(g=bi())&&(t.input2=g.first),_i(g=bi())&&(t.input3=g.first),_i(g=bi())&&(t.input4=g.first)}},decls:27,vars:3,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"info-text"],[3,"ngSubmit","formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputTwo",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputThree",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputFour",3,"input","keydown"],[1,"resend-div"],["type","submit",1,"login-btn",3,"click"],[1,"resend",3,"click"],[1,"resend"]],template:function(l,t){if(l&1){let g=Xt();V(0,"div",4)(1,"div",5)(2,"span",6),$(3,"Enter OTP "),j(),ke(4,"br"),V(5,"span",7),$(6,"Please enter the code we just send to"),j(),V(7,"p",7),$(8),j(),ke(9,"br"),V(10,"form",8),Oe("ngSubmit",function(){return gt(g),_t(t.login())}),V(11,"div",9)(12,"input",10,0),Oe("input",function(I){return gt(g),_t(t.onInput(I,1))})("keydown",function(I){return gt(g),_t(t.onKeyDown(I,1))}),j(),V(14,"input",11,1),Oe("input",function(I){return gt(g),_t(t.onInput(I,2))})("keydown",function(I){return gt(g),_t(t.onKeyDown(I,2))}),j(),V(16,"input",12,2),Oe("input",function(I){return gt(g),_t(t.onInput(I,3))})("keydown",function(I){return gt(g),_t(t.onKeyDown(I,3))}),j(),V(18,"input",13,3),Oe("input",function(I){return gt(g),_t(t.onInput(I,4))})("keydown",function(I){return gt(g),_t(t.onKeyDown(I,4))}),j()(),V(20,"div",14)(21,"span"),$(22,"Didn\u2019t receive OTP? "),Nt(23,h4,2,0)(24,u4,3,2),j()(),V(25,"button",15),Oe("click",function(){return gt(g),_t(t.login())}),$(26,"Verify"),j()()()()}if(l&2){let g;ue(8),Ii("+91 ",t.userNumber,""),ue(2),Fe("formGroup",t.otp),ue(13),Xn(23,(g=t.resendToggling)==="resend"?23:g==="countdown"?24:-1)}},dependencies:[Lo,mo,hr,Ro,Gm,oa,es],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;text-align:center;align-items:center}.sub-container[_ngcontent-%COMP%]{position:relative;top:10%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:2.1rem}.info-text[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.3rem;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:2.5rem;font-weight:300;align-items:center}.resend-div[_ngcontent-%COMP%]{margin-top:3rem;width:90%;height:4rem;display:grid;align-items:center;row-gap:0}.resend-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer;font-size:1.1rem;font-family:Roboto,sans-serif;font-weight:400;color:#000}.resend[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#000}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}@media screen and (min-width: 600px){.container[_ngcontent-%COMP%]{align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:30%;border:1px solid black;position:relative;left:35%}}"]});let d=o;return d})();var Jn=(()=>{let o=class o{constructor(r){this.http=r,this.workResponse=[],this.api=Cn}getUserDetails(r){let l=this.api+`providers/provider-details/${r}`;return this.providerDetails?tr(this.providerDetails):new vo(t=>{this.http.get(l).subscribe(g=>{console.log(g),this.providerDetails=g,t.next(this.providerDetails),t.complete()},g=>{console.log(g),t.error(g)})})}selectWork(r){return r}getBanners(){let r=`${this.api}admin/provider-banners`;return this.http.get(r)}getWork(r){let l=this.api+`providers/provider-work/${r}`;return console.log(l),this.http.get(l)}deleteServiceWork(r,l){let t=`${this.api}providers/provider-work/delete`,C={body:{providerId:localStorage.getItem("providerId"),workId:r,serviceId:l}};return this.http.delete(t,C)}deleteWork(r){let l=`${this.api}providers/provider-work/delete-work`,t={body:r};return this.http.delete(l,t)}getFinancialDetails(){let r=this.api+`providers/provider-finance/${localStorage.getItem("providerId")}`;return this.http.get(r)}getPackages(){let r=`${this.api}admin/admin-provider-package`;return this.http.get(r)}buyingPackages(r){let l=`${this.api}providers/provider-package`;return this.http.post(l,r)}getPurchasedPackages(r){let l=`${this.api}providers/provider-package/${r}`;return this.http.get(l)}getCertificated(r){let l=this.api+`providers/provider-certificate/${r}`;return this.http.get(l)}setDefult(){this.workResponseId="",this.workResponse=[],this.currentLocation="",this.currentCordinates="",this.userRegistered="",this.api=""}};o.\u0275fac=function(l){return new(l||o)(at(Gi))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var hl=(()=>{let o=class o{constructor(r){this.http=r,this.apiUrl=Cn,this.mapStatus=!1,this.currentLocation$=new Mg(null),this.onlineStatus=!1,this.directionsService=new google.maps.DirectionsService,this.directionsRenderer=new google.maps.DirectionsRenderer}setonlineStatus(r,l){this.onlineStatus=r,localStorage.setItem("onlineStatus",r.toString()),localStorage.setItem("onlineText",l)}getonlineStatus(){let r=localStorage.getItem("onlineStatus"),l=localStorage.getItem("onlineText");return{status:r==="true",text:l||"Go"}}getCoordinates(){return navigator.geolocation.getCurrentPosition(r=>{let l={lat:r.coords.latitude,lng:r.coords.longitude};this.currentLocation$.next(l)},r=>{console.log(r)}),this.currentLocation$.asObservable()}sendCordinates(r){let l=this.apiUrl+"providers/provider-cordinates",t=localStorage.getItem("providerId");console.log(r);let g={providerId:t,longitude:r.location.lng,latitude:r.location.lat};return console.log(g),this.http.post(l,g)}getCoordinatesFromPlaceName(r){let l=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(r)}&key=AIzaSyCJQHv3pYfnPd6F3ju1DXZ7jm46PJbncuk`;return this.http.get(l)}getPlaceNameFromCoordinates(r,l){let t=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${r},${l}&key=AIzaSyCJQHv3pYfnPd6F3ju1DXZ7jm46PJbncuk`;return this.http.get(t)}addDestinationMarker(r){new google.maps.Marker({position:{lat:r[1],lng:r[0]},map:this.map,title:"Destination"})}initializeMap(r,l){this.map=new google.maps.Map(l,{center:{lat:r.lat,lng:r.lng},zoom:15})}addProviderMarker(r){this.providerMarker=new google.maps.Marker({position:r,map:this.map,title:"Provider Location"})}addUserMarker(r){new google.maps.Marker({position:r,map:this.map,title:"User Location",icon:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}),this.directionsRenderer.setMap(this.map)}updateProviderMarker(r){this.providerMarker&&this.providerMarker.setPosition(r)}showDirections(r,l){if(!r||!l){console.error("Invalid origin or destination for directions.");return}let t={origin:new google.maps.LatLng(r.lat,r.lng),destination:new google.maps.LatLng(l.lat,l.lng),travelMode:google.maps.TravelMode.DRIVING};this.directionsService.route(t,(g,C)=>{C==="OK"?this.directionsRenderer.setDirections(g):console.error("Error fetching directions:",C)})}trackProviderLocation(){let r=new Mg(null);return navigator.geolocation.watchPosition(l=>{let t={lat:l.coords.latitude,lng:l.coords.longitude};r.next(t)},l=>{console.log("Tracking error:",l)}),r.asObservable()}calculateDistance(r,l,t,g){let C=de=>de*Math.PI/180,O=C(t-r),z=C(g-l),q=Math.sin(O/2)*Math.sin(O/2)+Math.cos(C(r))*Math.cos(C(t))*Math.sin(z/2)*Math.sin(z/2);return 6371e3*(2*Math.atan2(Math.sqrt(q),Math.sqrt(1-q)))}setDefult(){}};o.\u0275fac=function(l){return new(l||o)(at(Gi))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();function m4(d,o){if(d&1){let c=Xt();V(0,"div",5)(1,"label",8),$(2,"what work do you do?"),j(),ke(3,"br"),V(4,"input",33),Oe("click",function(){gt(c);let l=lt();return _t(l.navTo())}),j(),ke(5,"i",34),j()}if(d&2){let c=lt();ue(4),Fe("ngModel",c.selectedWork)}}function p4(d,o){d&1&&ke(0,"img",35)}function f4(d,o){if(d&1&&ke(0,"img",36),d&2){let c=lt();Fe("src",c.imagePreview,Un)}}var UE=(()=>{let o=class o{constructor(r,l,t,g,C,I){this.fb=r,this.router=l,this.location=t,this.loginService=g,this.userDetailsService=C,this.googleMapService=I,this.selectedFile=null,this.imagePreview=null,this.workAdded=!0,this.aboutProvider=this.fb.group({userId:localStorage.getItem("providerId"),providerName:["",po.required],work:["",po.required],pincode:["",po.required],phone:[this.loginService.userNumber,po.required],age:[this.loginService.age,po.required],gender:["",po.required],houseNo:"",landmark:"",address:["",po.required],city:"",state:"",image:[""]});let O=this.loginService.workDetails.flat();this.aboutProvider.controls.work.setValue(O),console.log(O),console.log("inform",this.aboutProvider.value.work),this.selectedWork=this.loginService.workDetails.flatMap(z=>z.flatMap(q=>q.nameOfService)).join(", ")}ngOnInit(){this.getNumber(),this.getWork()}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r),r.works.length>0&&(this.workAdded=!1)},error:r=>{console.log(r)}})}getNumber(){return jn(this,null,function*(){let r=this.loginService.getPhoneNumber();console.log(r),this.userNumber=yield this.loginService.userNumber,console.log(this.userNumber)})}flattenWorkDetails(r){return r.flatMap(l=>l.flatMap(t=>t.nameOfService))}onFileSelected(r){let l=r.target;if(l.files&&l.files.length>0){this.selectedFile=l.files[0];let t=new FileReader;t.onload=()=>{this.imagePreview=t.result},t.readAsDataURL(this.selectedFile)}}navTo(){this.router.navigate(["selectWork"])}getCoordinates(){let r=`${this.aboutProvider.value.houseNo} ${this.aboutProvider.value.landmark} ${this.aboutProvider.value.address} ${this.aboutProvider.value.city} ${this.aboutProvider.value.state} ${this.aboutProvider.value.pincode}`;console.log(r),this.googleMapService.getCoordinatesFromPlaceName(r).subscribe({next:l=>{console.log(l),this.googleMapService.sendCordinates(l.results[0].geometry).subscribe({next:t=>{console.log(t),alert("coordinates are updated")},error:t=>{console.log(t)}})},error:l=>{console.log(l)}})}submit(){this.getCoordinates();let r=new FormData;r.append("providerName",this.aboutProvider.value.providerName),r.append("age",this.aboutProvider.value.age),r.append("pincode",this.aboutProvider.value.pincode),r.append("providerId",this.aboutProvider.value.userId),r.append("gender",this.aboutProvider.value.gender),r.append("address",this.aboutProvider.value.address),r.append("phone",this.loginService.userNumber),r.append("houseNo",this.aboutProvider.value.houseNo),r.append("landMark",this.aboutProvider.value.landmark),r.append("city",this.aboutProvider.value.city),r.append("state",this.aboutProvider.value.state),this.selectedFile&&r.append("image",this.selectedFile,this.selectedFile.name),r.forEach((l,t)=>{console.log(`${t}: ${l}`)}),this.loginService.UserDetails(r)}navToBack(){console.log("back"),this.location.back()}};o.\u0275fac=function(l){return new(l||o)(fe(aa),fe(Bt),fe(ii),fe(Kn),fe(Jn),fe(hl))},o.\u0275cmp=ft({type:o,selectors:[["app-about-user"]],decls:67,vars:4,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[3,"formGroup"],[1,"form-div"],[2,"position","relative"],["for","name"],["type","text","placeholder","Name","formControlName","providerName","id","names","required",""],["for","work"],["for","name","formControlName","gender"],["value","","disabled","","selected",""],["value","Male"],["value","Female"],["value","Others"],["for","houseNo"],["type","text","formControlName","houseNo","required","","placeholder","Address"],["for","landmark"],["type","text","formControlName","landmark","required","","placeholder","Address"],["for","address"],["type","text","formControlName","address","required","","placeholder","Address"],["for","city"],["type","text","formControlName","city","required","","placeholder","Address"],["for","state"],["type","text","formControlName","state","required","","placeholder","Address"],["for","pincode"],["type","text","formControlName","pincode","required","","placeholder","Address"],["for","file",1,"image-label"],[1,"file-input-container"],["for","file-input",1,"file-label"],["src","assets/documents/Group.png","alt","Upload image","class","placeholder-image",4,"ngIf"],["alt","Selected image","class","preview-image",3,"src",4,"ngIf"],["type","file","id","file-input","formControlName","image","required","",1,"file-input",3,"change"],["type","submit",1,"login-btn",3,"click"],["formControlName","work","id","providerType","required","","placeholder","please select the Work ",3,"click","ngModel"],[1,"fa","fa-angle-down",2,"font-size","36px","position","absolute","right","10px","top","75%","transform","translateY(-50%)","pointer-events","none"],["src","assets/documents/Group.png","alt","Upload image",1,"placeholder-image"],["alt","Selected image",1,"preview-image",3,"src"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Tell us about yourself"),j(),ke(4,"br"),V(5,"form",3)(6,"div",4),Nt(7,m4,6,1,"div",5),V(8,"div")(9,"label",6),$(10,"what's your Name"),j(),ke(11,"br")(12,"input",7),j(),V(13,"div")(14,"label",8),$(15,"Select your Gender"),j(),ke(16,"br"),V(17,"select",9)(18,"option",10),$(19,"Select"),j(),V(20,"option",11),$(21,"Male"),j(),V(22,"option",12),$(23,"Female"),j(),V(24,"option",13),$(25,"Others"),j()(),ke(26,"br"),j(),V(27,"div")(28,"label",14),$(29," H no "),j(),ke(30,"br")(31,"input",15),j(),V(32,"div")(33,"label",16),$(34," Landmark "),j(),ke(35,"br")(36,"input",17),j(),V(37,"div")(38,"label",18),$(39," Address "),j(),ke(40,"br")(41,"input",19),j(),V(42,"div")(43,"label",20),$(44," City"),j(),ke(45,"br")(46,"input",21),j(),V(47,"div")(48,"label",22),$(49," State "),j(),ke(50,"br")(51,"input",23),j(),V(52,"div")(53,"label",24),$(54," Pincode "),j(),ke(55,"br")(56,"input",25),j(),V(57,"label",26),$(58," Upload image "),j(),V(59,"div",27)(60,"label",28),Nt(61,p4,1,0,"img",29)(62,f4,1,1,"img",30),j(),V(63,"input",31),Oe("change",function(C){return t.onFileSelected(C)}),j()(),V(64,"button",32),Oe("click",function(){return t.submit()}),$(65,"Continue"),j()()()()(),ke(66,"br")),l&2&&(ue(5),Fe("formGroup",t.aboutProvider),ue(2),Xn(7,t.workAdded?7:-1),ue(54),Fe("ngIf",!t.selectedFile),ue(),Fe("ngIf",t.selectedFile))},dependencies:[Cr,Lo,eT,tT,mo,JI,hr,Ro,iT,oa,es],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;top:10%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.form-div[_ngcontent-%COMP%]{width:100%;display:grid;grid-gap:1rem}.form-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:grid;text-align:left}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;height:3rem;border:1px solid black;border-radius:.8rem;font-size:1rem}input[_ngcontent-%COMP%]::placeholder{padding-left:.5rem}label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:400;font-family:inter;line-height:19px}#providerType[_ngcontent-%COMP%]   option[value=""][disabled][_ngcontent-%COMP%]{display:none}.file-input-container[_ngcontent-%COMP%]{position:relative;width:200px;height:200px;border:.25px solid #ccc;display:flex;align-items:center;justify-content:center;border-radius:.5rem}.file-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:60%;cursor:pointer;position:relative}.placeholder-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.preview-image[_ngcontent-%COMP%]{width:10rem;height:8rem}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.image-label[_ngcontent-%COMP%]{float:left;text-align:left}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:100%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;margin-bottom:3rem}']});let d=o;return d})();var WE=(()=>{let o=class o{constructor(r){this.router=r,this.currentUrl=this.router.url,this.router.events.pipe(Ea(l=>l instanceof zb),ow()).subscribe(l=>{this.previousUrl=l[0].url,this.currentUrl=l[1].url})}getPreviousUrl(){return this.previousUrl}};o.\u0275fac=function(l){return new(l||o)(at(Bt))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();function _4(d,o){if(d&1){let c=Xt();V(0,"div",8)(1,"div",10),Oe("click",function(){let l=gt(c).$implicit,t=lt();return _t(t.selectedCat(l))}),ke(2,"img",11),$(3),j(),V(4,"div")(5,"input",12),zr("ngModelChange",function(l){let t=gt(c).$implicit;return Fr(t.checked,l)||(t.checked=l),_t(l)}),Oe("change",function(l){let t=gt(c).$implicit,g=lt();return _t(g.onChange(l,t))}),j()()()}if(d&2){let c=o.$implicit;ue(2),Fe("src",c.image,Un),ue(),Ii(" ",c.names,""),ue(2),Lr("ngModel",c.checked)}}function b4(d,o){if(d&1){let c=Xt();V(0,"div",8)(1,"div",10),Oe("click",function(){let l=gt(c).$implicit,t=lt();return _t(t.selectedCat(l))}),ke(2,"img",11),$(3),j(),V(4,"div")(5,"input",12),zr("ngModelChange",function(l){let t=gt(c).$implicit;return Fr(t.checked,l)||(t.checked=l),_t(l)}),Oe("change",function(l){let t=gt(c).$implicit,g=lt();return _t(g.onChange(l,t))}),j()()()}if(d&2){let c=o.$implicit;ue(2),Fe("src",c.image,Un),ue(),Ii(" ",c.names,""),ue(2),Lr("ngModel",c.checked)}}var HE=(()=>{let o=class o{ngOnInit(){this.previousUrl=this.routeTrackingService.getPreviousUrl(),this.items=this.jobDetails.items,this.getWork(),console.log(this.items)}constructor(r,l,t,g,C,I){this.router=r,this.logInservice=l,this.jobDetails=t,this.routeTrackingService=g,this.userDetailsService=C,this.dialogeService=I,this.searchQuery="",this.workSeleceted=[],this.items=[],this.workForSending=[]}onInputChange(r){console.log(this.searchQuery);let l=this.jobDetails.items.filter(t=>t.names.toLowerCase().includes(this.searchQuery.toLowerCase()));console.log(l),this.items=l}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works,this.autoCheckServices()},r=>{console.log(r)})}onChange(r,l){let t=r.target;if(t&&t.checked){let C=this.items.indexOf(l);this.jobDetails.items[C].checked=!0,console.log("Item checked:",this.items.indexOf(l)),console.log("Item checked:",l.names),console.log("categoryId",l.id),this.logInservice.categoryId=l.id,this.logInservice.setWork(l.names,l.id),this.router.navigate(["subServices"])}}selectedCat(r){console.log("clciked");let l=this.items.indexOf(r);this.jobDetails.items[l].checked=!0,console.log("Item checked:",this.items.indexOf(r)),console.log("Item checked:",r.names),console.log("categoryId",r.id),this.logInservice.categoryId=r.id,this.logInservice.setWork(r.names,r.id),this.router.navigate(["subServices"])}autoCheckServices(){this.workSeleceted.forEach(r=>{let l=this.items.find(t=>t.names===r.categoryId.name);console.log(l),l&&l&&(l.checked=!0)})}send(){this.jobDetails?.userDetails?.providerName&&this.jobDetails.userDetails?.providerName!==void 0?this.router.navigate(["manageServices"]):this.router.navigate(["aboutUser"])}UpdatingUserWork(r){console.log(r);let l=this.userDetailsService.workResponseId;console.log("work before",this.userDetailsService.workResponse),console.log("id before",l),this.workForSending.push(this.userDetailsService.workResponse),this.workForSending.push(r),console.log(this.workForSending.flat()),this.logInservice.updateUserWork(this.workForSending.flat(),l)}};o.\u0275fac=function(l){return new(l||o)(fe(Bt),fe(Kn),fe(Ar),fe(WE),fe(Jn),fe(Wn))},o.\u0275cmp=ft({type:o,selectors:[["app-select-work"]],decls:22,vars:2,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"search-container"],["type","text","placeholder","Search for Service",1,"search-input",3,"ngModelChange","input","ngModel"],[1,"material-symbols-outlined","notranslate",3,"hidden"],[1,"serivce"],[1,"tittle2"],[1,"service-div"],["type","submit",1,"login-btn",3,"click"],[1,"names",3,"click"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"what work do you do?"),j(),ke(4,"br"),V(5,"div",3)(6,"input",4),zr("ngModelChange",function(C){return Fr(t.searchQuery,C)||(t.searchQuery=C),C}),Oe("input",function(C){return t.onInputChange(C)}),j(),V(7,"span",5),$(8,"search"),j()(),V(9,"div",6)(10,"span",7),$(11,"Popular categories"),j(),ke(12,"br"),xr(13,_4,6,3,"div",8,io),V(15,"span",7),$(16,"All categories"),j(),ke(17,"br"),xr(18,b4,6,3,"div",8,io),j()(),V(20,"button",9),Oe("click",function(){return t.send()}),$(21,"Continue"),j()()),l&2&&(ue(6),Lr("ngModel",t.searchQuery),ue(),Fe("hidden",t.searchQuery),ue(6),wr(t.items),ue(5),wr(t.items))},dependencies:[mo,cl,hr,ra],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-container[_ngcontent-%COMP%]{position:relative}.search-container[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{padding-right:30px;width:70%;height:2.5rem;border-radius:.8rem;font-size:1.5rem}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.search-container[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{position:absolute;top:50%;left:7%;transform:translateY(-50%);cursor:pointer;pointer-events:none;font-size:32px;margin:0}.tittle2[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:500;line-height:24px;display:flex;align-items:start}.serivce[_ngcontent-%COMP%]{height:70vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.7rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2rem;height:2rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let d=o;return d})();var GE=(()=>{let o=class o{constructor(r,l,t){this.router=r,this.dialogeService=l,this.loginService=t,this.selectedExperiance="",this.selectedAge="",this.workSelected=this.loginService.workName,this.selectedCheckbox=null}sendResponse(){console.log(this.selectedAge,this.selectedExperiance),this.loginService.sendWorkDetails().subscribe(r=>{console.log(r),this.loginService.workId="",this.loginService.selectedSubCategories="",this.loginService.selectedServiceId="",console.log(this.loginService.workId,this.loginService.selectedServiceId,this.loginService.selectedSubCategories),this.dialogeService.openDialog("Service has been added"),this.router.navigate(["selectWork"])},r=>{console.log(r),this.dialogeService.openDialog(r.error.message)})}expSelected(r){this.selectedExperiance===r?this.selectedExperiance=null:this.selectedExperiance=r,console.log(this.selectedExperiance),this.selectedExperiance==="yes"?this.router.navigate(["workExperiance"]):(this.loginService.setExperiance("0"),this.loginService.setWorkDetails())}onCheckboxChange(r){this.selectedAge===r?this.selectedAge=null:this.selectedAge=r,console.log("Selected Checkbox:",this.selectedAge),this.loginService.setAge(this.selectedAge)}};o.\u0275fac=function(l){return new(l||o)(fe(Bt),fe(Wn),fe(Kn))},o.\u0275cmp=ft({type:o,selectors:[["app-about-work"]],decls:44,vars:6,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["type","checkbox",3,"change","checked"],[2,"padding","0.5rem"],[1,"select-div"],[1,"conditions"],["type","checkbox"],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Tell us about your work!"),j(),ke(4,"br")(5,"br"),V(6,"div",3)(7,"pre"),$(8,"What is your age?"),j(),ke(9,"hr"),V(10,"div")(11,"span"),$(12,"16 - 18"),j(),V(13,"input",4),Oe("change",function(){return t.onCheckboxChange("16-18")}),j()(),ke(14,"hr"),V(15,"div")(16,"span"),$(17,"18 - 40"),j(),V(18,"input",4),Oe("change",function(){return t.onCheckboxChange("18-40")}),j()(),ke(19,"hr"),V(20,"div")(21,"span"),$(22,"More than 40"),j(),V(23,"input",4),Oe("change",function(){return t.onCheckboxChange("more than 40")}),j()()(),V(24,"div",3)(25,"p",5),$(26),j(),ke(27,"hr"),V(28,"div",6)(29,"span"),$(30,"Yes"),j(),V(31,"input",4),Oe("change",function(){return t.expSelected("yes")}),j()(),ke(32,"hr"),V(33,"div")(34,"span"),$(35,"No"),j(),V(36,"input",4),Oe("change",function(){return t.expSelected("no")}),j()()(),V(37,"div",7),ke(38,"input",8),$(39," \xA0 Agree with Terms & conditions"),j(),ke(40,"br")(41,"br"),V(42,"button",9),Oe("click",function(){return t.sendResponse()}),$(43,"Continue"),j()()()),l&2&&(ue(13),Fe("checked",t.selectedAge==="16-18"),ue(5),Fe("checked",t.selectedAge==="18-40"),ue(5),Fe("checked",t.selectedAge==="more than 40"),ue(3),Ii("Do you have any experience in ",t.workSelected," services?"),ue(5),Fe("checked",t.selectedExperiance==="yes"),ue(5),Fe("checked",t.selectedExperiance==="no"))},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content;border:1px solid black;margin-bottom:5%;border-radius:1rem}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5%;display:flex;justify-content:space-between}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:95%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611}.conditions[_ngcontent-%COMP%]{width:max-content;font-size:1.2rem;font-family:inter,sans-serif;font-weight:400;line-height:1.4rem;float:left;display:flex;justify-content:space-around}.conditions[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}.sub-div1[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1rem}"]});let d=o;return d})();var qE=(()=>{let o=class o{constructor(r,l,t){this.logInservice=r,this.router=l,this.dialogeService=t,this.experiance=""}onCheckboxChange(r){this.experiance===r?this.experiance=null:this.experiance=r,console.log("Selected Checkbox:",this.experiance)}sendResponse(){this.logInservice.setExperiance(this.experiance),this.logInservice.setWorkDetails(),this.logInservice.sendWorkDetails().subscribe(r=>{console.log(r),this.dialogeService.openDialog("Service has been added"),this.logInservice.workId="",this.logInservice.setSubCat(""),this.logInservice.setservices([]),this.router.navigate(["selectWork"])},r=>{console.log(r),this.dialogeService.openDialog(r.error.message)})}};o.\u0275fac=function(l){return new(l||o)(fe(Kn),fe(Bt),fe(Wn))},o.\u0275cmp=ft({type:o,selectors:[["app-work-experiance"]],decls:30,vars:4,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["type","checkbox",3,"change","checked"],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Tell us about your work!"),j(),ke(4,"br")(5,"br"),V(6,"div",3)(7,"div")(8,"span"),$(9,"0-1 Years"),j(),V(10,"input",4),Oe("change",function(){return t.onCheckboxChange("0-1")}),j()(),ke(11,"hr"),V(12,"div")(13,"span"),$(14,"2-4 Years"),j(),V(15,"input",4),Oe("change",function(){return t.onCheckboxChange("2-4")}),j()(),ke(16,"hr"),V(17,"div")(18,"span"),$(19,"3-5 Years"),j(),V(20,"input",4),Oe("change",function(){return t.onCheckboxChange("3-5")}),j()(),ke(21,"hr"),V(22,"div")(23,"span"),$(24,"More than 5 Years"),j(),V(25,"input",4),Oe("change",function(){return t.onCheckboxChange("more than 5")}),j()()()(),ke(26,"br")(27,"br"),V(28,"button",5),Oe("click",function(){return t.sendResponse()}),$(29,"Continue"),j()()),l&2&&(ue(10),Fe("checked",t.experiance==="0-1"),ue(5),Fe("checked",t.experiance==="2-4"),ue(5),Fe("checked",t.experiance==="3-5"),ue(5),Fe("checked",t.experiance==="moreThan5"))},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content;border:1px solid black;margin-bottom:5%;border-radius:1rem}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5%;display:flex;justify-content:space-between}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:95%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611}"]});let d=o;return d})();var $E=(()=>{let o=class o{constructor(r){this.router=r}verify(){console.log("inside"),this.router.navigate(["pancard"])}};o.\u0275fac=function(l){return new(l||o)(fe(Bt))},o.\u0275cmp=ft({type:o,selectors:[["app-aadhar-verification"]],decls:24,vars:0,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["for","name"],["type","number","placeholder","name","id","names","required",""],["type","number","placeholder","OTP","id","names","required",""],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Lets Get the Documentation Done....!!"),j(),ke(4,"br")(5,"br"),V(6,"div",3)(7,"div")(8,"label",4),$(9,"Adhar Number"),j(),ke(10,"br")(11,"input",5),j(),ke(12,"br"),V(13,"button"),$(14,"Verify"),j(),V(15,"div")(16,"label",4),$(17,"OTP"),j(),ke(18,"br")(19,"input",6),j()(),V(20,"button",7),Oe("click",function(){return t.verify()}),$(21,"Verify"),j()(),ke(22,"br")(23,"br"),j())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.6rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:grid;text-align:left}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;height:3rem;border:1px solid black;border-radius:.8rem;font-size:1rem}input[_ngcontent-%COMP%]::placeholder{padding-left:.5rem}label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:400;font-family:inter,sans-serif;line-height:19px}.sub-div1[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:4rem;height:1.4rem;background-color:#d16611;color:#fff;font-size:.8rem;font-family:inter;float:right;border:none;border-radius:.4rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}"]});let d=o;return d})();var YE=(()=>{let o=class o{constructor(r){this.router=r}skip(){this.router.navigate(["bankDetails"])}submit(){this.router.navigate(["bankDetails"])}};o.\u0275fac=function(l){return new(l||o)(fe(Bt))},o.\u0275cmp=ft({type:o,selectors:[["app-pancard"]],decls:21,vars:0,consts:[[1,"container"],[1,"skip-btn",3,"click"],[1,"sub-container"],[1,"tittle"],[1,"tittle1"],[1,"pan"],["src","assets\\documents\\pancard.png"],[1,"input"],["type","number","placeholder","PAN Number","id","Enter GST Number","required",""],["type","number","placeholder","Enter GST Number","id","Enter GST Number","required",""],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"button",1),Oe("click",function(){return t.skip()}),$(2,"skip"),j(),V(3,"div",2)(4,"div")(5,"span",3),$(6,"PAN Number"),j(),ke(7,"br")(8,"br"),V(9,"span",4),$(10,"Please Input your PAN number"),j(),ke(11,"br")(12,"br"),j(),V(13,"div",5),ke(14,"img",6),j(),V(15,"div",7),ke(16,"input",8)(17,"br")(18,"input",9),j(),V(19,"button",10),Oe("click",function(){return t.submit()}),$(20,"Submit"),j()()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.skip-btn[_ngcontent-%COMP%]{width:max-content;height:max-content;float:right;margin:1rem;margin-bottom:0;background-color:transparent;border:none;font-family:"Inter" sans-serif;color:#00000080;font-size:16px;font-weight:400;line-height:16.94px;text-align:left}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:0%;left:5%;display:grid;grid-template-rows:auto auto auto;row-gap:30px;align-items:center;text-align:center;justify-content:center}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.6rem;font-weight:600;line-height:24px}.tittle1[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1rem;font-weight:400;line-height:19px}.pan[_ngcontent-%COMP%]{width:19rem;height:11.5rem}.pan[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.input[_ngcontent-%COMP%]{width:100%;height:7rem}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-top:1rem;width:98%;height:2rem;border-radius:.9rem;font-size:1rem;text-align:center}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{text-align:center;font-size:1rem;font-weight:600;color:#000}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:89%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}']});let d=o;return d})();var ZE=(()=>{let o=class o{constructor(r,l,t){this.fb=r,this.router=l,this.http=t,this.apiUrl=Cn,this.bankDetails=this.fb.group({accountName:["",po.required],accountNumber:["",po.required],PANNumber:["",po.required],bankName:["",po.required],IFSC:["",po.required],branch:["",po.required],aadhaarNumber:532268448050})}submit(){let r=`${this.apiUrl}providers/provider-finance`,l=new FormData;l.append("accountName",this.bankDetails.value.accountName),l.append("providerId",localStorage.getItem("providerId")||""),l.append("aadhaarNumber",this.bankDetails.value.aadhaarNumber),l.append("accountNumber",this.bankDetails.value.accountNumber),l.append("pan",this.bankDetails.value.PANNumber),l.append("bankName",this.bankDetails.value.bankName),l.append("ifscCode",this.bankDetails.value.IFSC),l.append("branch",this.bankDetails.value.branch),this.http.post(r,l).subscribe(t=>{console.log(t),this.router.navigate(["induction"])},t=>{console.log(t),t.error.error==='E11000 duplicate key error collection: test.finances index: pan_1 dup key: { pan: "cggpc1173E" }'&&alert("Pancard is already registered")})}skip(){this.router.navigate(["induction"])}};o.\u0275fac=function(l){return new(l||o)(fe(aa),fe(Bt),fe(Gi))},o.\u0275cmp=ft({type:o,selectors:[["app-bank-details"]],decls:50,vars:1,consts:[[1,"skip-btn",3,"click"],[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],[1,"form-main",3,"formGroup"],[1,"form-div-section"],["for","accountName"],["type","text","id","accountName","formControlName","accountName"],["for","accountNumber"],["type","number","id","accountNumber","formControlName","accountNumber"],["for","PANNumber"],["type","text","id","PANNumber","formControlName","PANNumber"],["for","bankName"],["type","text","id","bankName","formControlName","bankName"],["for","IFSC"],["type","text","id","IFSC","formControlName","IFSC"],["for","branch"],["type","text","id","branch","formControlName","branch"],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){l&1&&(V(0,"button",0),Oe("click",function(){return t.skip()}),$(1,"skip"),j(),V(2,"div",1)(3,"div",2)(4,"span",3),$(5,"Banking details"),j(),ke(6,"br")(7,"br"),V(8,"div",4)(9,"form",5)(10,"div",6)(11,"fieldset")(12,"legend",7),$(13," Account Name \xA0"),j(),ke(14,"input",8)(15,"br"),j()(),V(16,"div",6)(17,"fieldset")(18,"legend",9),$(19," Account Number \xA0"),j(),ke(20,"input",10)(21,"br"),j()(),V(22,"div",6)(23,"fieldset")(24,"legend",11),$(25," PAN Number \xA0"),j(),ke(26,"input",12)(27,"br"),j()(),V(28,"div",6)(29,"fieldset")(30,"legend",13),$(31," Bank name \xA0"),j(),ke(32,"input",14)(33,"br"),j()(),V(34,"div",6)(35,"fieldset")(36,"legend",15),$(37," IFSC \xA0"),j(),ke(38,"input",16)(39,"br"),j()(),V(40,"div",6)(41,"fieldset")(42,"legend",17),$(43," Branch \xA0"),j(),ke(44,"input",18)(45,"br"),j()()()(),V(46,"button",19),Oe("click",function(){return t.submit()}),$(47,"Submit"),j()(),ke(48,"br")(49,"br"),j()),l&2&&(ue(9),Fe("formGroup",t.bankDetails))},dependencies:[Lo,mo,Rb,hr,Ro,oa,es],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;justify-content:center;align-items:center;text-align:center}.skip-btn[_ngcontent-%COMP%]{width:max-content;height:max-content;float:right;margin:1rem;margin-bottom:0;background-color:transparent;border:none;font-family:"Inter" sans-serif;color:#00000080;font-size:16px;font-weight:400;line-height:16.94px;text-align:left}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:0%;left:0%;display:grid;grid-template-rows:max-content max-content;align-items:start;text-align:left}.tittle[_ngcontent-%COMP%]{float:left;font-family:Inter,sans-serif;font-size:1.6rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content}.form-main[_ngcontent-%COMP%]{width:90%;height:max-content;display:flex;flex-direction:column;gap:.9rem}fieldset[_ngcontent-%COMP%]{width:100%;height:2.5rem;border-radius:.5rem}fieldset[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{font-size:.9rem;font-family:Inter,sans-serif;font-weight:400;line-height:1rem;flex-shrink:0;margin-right:10px;color:#030b33b3}input[_ngcontent-%COMP%]{flex-grow:1;outline:0;border-width:0 0 0 0;border-color:#000;font-size:1.1rem;padding:5px 0}.login-btn[_ngcontent-%COMP%]{height:3rem;width:90%;font-size:1.3rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:3rem;border:none;background-color:#d16611;position:fixed;top:90%;left:5%}.mat-mdc-text-field-wrapper.mdc-text-field.mdc-text-field--filled[_ngcontent-%COMP%]{background-color:transparent;height:5rem}']});let d=o;return d})();var sp=(()=>{let o=class o{constructor(r){this.http=r,this.apiUrl=Cn,this.apiForVideo=this.apiUrl+"admin"}getingVideos(){return this.http.get(`${this.apiForVideo}/training`)}gettingInductionVeideos(){return this.http.get(`${this.apiForVideo}/induction`)}getVideosByIds(r){let l=r.map(t=>this.http.get(`${this.apiForVideo}/training/${t}`).pipe(Jl(g=>(console.error(`Error fetching video for ID ${t}:`,g),tr(null)))));return kg(l)}getInductionVideosByIds(r){let l=r.map(t=>this.http.get(`${this.apiForVideo}/induction/${t}`).pipe(Jl(g=>(console.error(`Error fetching video for ID ${t}:`,g),tr(null)))));return kg(l)}};o.\u0275fac=function(l){return new(l||o)(at(Gi))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var zo=(()=>{let o=class o{constructor(r,l){this.http=r,this.location=l,this.apiUrl=Cn,this.userId=localStorage.getItem("providerId"),this.userCredit=0}payWithRazorpay(r,l,t){let g={key:"rzp_test_b8XfUOQ4u8dlSq",amount:r*100,currency:t,name:"Coolie no.1",description:"Test Transaction",image:"assets/location/logo-v3 3.png",handler:I=>{console.log(I),this.addingCredit(r)},prefill:{name:"Customer Name",email:"customer@example.com",contact:"9999999999"},notes:{address:"Razorpay Corporate Office"},theme:{color:"#3399cc"},modal:{ondismiss:function(){console.log("Checkout form closed")},escape:!1,backdropclose:!1,handleback:!0}};new Razorpay(g).open()}createOrder(r){let l=new $I({"Content-Type":"application/json"}),t={amount:r,currency:"INR",receipt:`receipt_${Date.now()}`},g=`${this.apiUrl}core/razor-pay/create-order`;return this.http.post(g,t,{headers:l})}addingCredit(r){let l=this.apiUrl+"providers/provider-credits/recharge",t={providerId:this.userId,amount:r};return this.http.post(l,t).subscribe(g=>{console.log(g),this.getNow()},g=>{console.log(g)})}getCredits(){let r=this.apiUrl+`providers/provider-credits/${this.userId}`;return this.http.get(r)}getNow(){this.getCredits().subscribe(r=>{console.log(r),this.userCredit=r.credits,this.location.back()},r=>{console.log(r)})}getCreditHistory(){let r=this.apiUrl+`providers/provider-credits/${this.userId}`;return this.http.get}setDefault(){this.userId="",this.userCredit=0}};o.\u0275fac=function(l){return new(l||o)(at(Gi),at(ii))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var Ls=_I(yC());var lp=(()=>{let o=class o{setonlineStatus(r,l){this.onlineStatus=r,localStorage.setItem("onlineStatus",r.toString()),localStorage.setItem("onlineText",l)}getonlineStatus(){let r=localStorage.getItem("onlineStatus"),l=localStorage.getItem("onlineText");return{status:r==="true",text:l||"Go"}}constructor(r,l){this.platformId=r,this.http=l,this.apiUrl=Cn,this.destinationInput="",this.currentLocation=[0,0],this.directionsLayerId="directions",this.userCordinates=[0,0],this.onlineStatus=!1,Ls.default.accessToken="pk.eyJ1IjoiY29vbGllbm8xLWFkbWluIiwiYSI6ImNsdWZjZGR1ZzBtZHcybnJvaHBiYTd2NzMifQ.TQ6FrqUIUUWv7J7n75A3tQ"}ngOnInit(){this.initializeMap()}ngOnDestroy(){this.watchId&&navigator.geolocation.clearWatch(this.watchId)}initializeMap(){navigator.geolocation.getCurrentPosition(r=>{this.currentLocation=[r.coords.longitude,r.coords.latitude],console.log(this.currentLocation,"currect location"),this.map=new Ls.default.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:this.currentLocation,zoom:12}),this.map.addControl(new Ls.default.NavigationControl),this.userMarker=new Ls.default.Marker({color:"blue"}).setLngLat(this.currentLocation).setPopup(new Ls.default.Popup().setText("You are here")).addTo(this.map),this.watchId=navigator.geolocation.watchPosition(l=>{let t=[l.coords.longitude,l.coords.latitude];this.currentLocation=t,this.userMarker&&this.userMarker.setLngLat(t),this.userCordinates[0]!=0&&this.addDestinationMarker(this.userCordinates)},l=>{console.error("Error watching position:",l)})})}navigateToPlace(){if(!this.destinationInput){console.error("Please enter the destination address or coordinates.");return}if(/^(-?\d+(\.\d+)?),\s*(-?\d+(\.\d+)?)$/.test(this.destinationInput)){let[l,t]=this.destinationInput.split(",").map(g=>parseFloat(g.trim()));this.addDestinationMarker([l,t])}else fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(this.destinationInput)}.json?access_token=${Ls.default.accessToken}`).then(l=>{if(!l.ok)throw new Error("Network response was not ok");return l.json()}).then(l=>{if(l.features.length===0)throw new Error("No results found");let t=l.features[0].geometry.coordinates;this.addDestinationMarker(t)}).catch(l=>{console.error("Error fetching destination coordinates:",l),alert("Error: Could not find the location. Please check your input.")})}addDestinationMarker(r){console.log(r),this.destinationMarker&&this.destinationMarker.remove(),this.destinationMarker=new Ls.default.Marker({color:"red"}).setLngLat(r).setPopup(new Ls.default.Popup().setText(this.destinationInput)).addTo(this.map),this.map.flyTo({center:r,zoom:12}),this.getDirections(r)}getDirections(r){let l=`https://api.mapbox.com/directions/v5/mapbox/driving/${this.currentLocation[0]},${this.currentLocation[1]};${r[0]},${r[1]}?alternatives=true&geometries=geojson&steps=true&access_token=${Ls.default.accessToken}`;fetch(l).then(t=>{if(!t.ok)throw new Error("NoRoute");return t.json()}).then(t=>{if(console.log("Directions data:",t),t.routes.length===0)throw new Error("No routes found");this.map.getSource(this.directionsLayerId)&&(this.map.removeLayer(this.directionsLayerId),this.map.removeSource(this.directionsLayerId)),this.map.addSource(this.directionsLayerId,{type:"geojson",data:{type:"Feature",properties:{},geometry:t.routes[0].geometry}}),this.map.addLayer({id:this.directionsLayerId,type:"line",source:this.directionsLayerId,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"red","line-width":5}});let g=new Ls.default.LngLatBounds;t.routes[0].geometry.coordinates.forEach(C=>{g.extend(C)}),this.map.fitBounds(g,{padding:50})}).catch(t=>{console.error("Error fetching directions:",t),alert("Error: Could not find a route.")})}getCurrentLocation(){return new vo(r=>{navigator.geolocation.getCurrentPosition(l=>{let t=[l.coords.longitude,l.coords.latitude];console.log("current location inside getcurrent location",t),alert(t),this.getPlaceNameFromCoordinates(t),r.next(t),r.complete()},l=>{r.error(l)})})}getPlaceNameFromCoordinates(r){let t=`https://api.mapbox.com/geocoding/v5/mapbox.places/${r[0]},${r[1]}.json?access_token=pk.eyJ1IjoiY29vbGllbm8xLWFkbWluIiwiYSI6ImNsdWZjZGR1ZzBtZHcybnJvaHBiYTd2NzMifQ.TQ6FrqUIUUWv7J7n75A3tQ`;return new vo(g=>{fetch(t).then(C=>{if(!C.ok)throw console.error("Network response was not ok:",C.status,C.statusText),new Error(`Network response was not ok: ${C.status} ${C.statusText}`);return C.json()}).then(C=>{if(C.features.length===0)throw console.error("No results found:",C),new Error("No results found");let I=C.features[0].place_name;g.next(I),g.complete()}).catch(C=>{console.error("Error fetching place name:",C),g.error(C)})})}sendCordinates(r){let l=this.apiUrl+"providers/provider-cordinates",g={providerId:localStorage.getItem("providerId"),longitude:r[0],latitude:r[1]};return console.log(g),this.http.post(l,g)}};o.\u0275fac=function(l){return new(l||o)(at(Md),at(Gi))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var Pr=(()=>{let o=class o{constructor(r){this.http=r,this.oredrDetails=[],this.apiUrl=Cn}getOrder(r){let l=this.apiUrl+`users/order/category/${r}`;return this.http.get(l)}getOrderDetails(r){return this.http.get("")}accept(r,l,t){let g={orderId:r,price:l,userId:t,providerId:localStorage.getItem("providerId")};console.log(g);let C=this.apiUrl+"users/order-history/accept-order";return this.http.post(C,g)}verifyOtp(){let r=this.apiUrl+"users/order-history/verify-start-order",l={orderId:this.orderIds};return this.http.post(r,l)}verifyStartOrder(r){let l=`${this.apiUrl}users/order-history/verify-start-order`;return this.http.post(l,r)}cancelOrder(){let r=this.apiUrl+"users/order-history/cancel-order",l={orderHistoryId:this.orderIds,providerId:localStorage.getItem("providerId"),reason:"nothing"};return console.log(l),this.http.post(r,l)}sendingImageBeforeWork(r){let l=`${this.apiUrl}users/order-history/before-work-upload-image`;return this.http.post(l,r)}completeOrder(r){let l=this.apiUrl+"users/order-history/order-completed-generateotp";return this.http.post(l,r)}verifyAfterComplete(r,l,t){let g=this.apiUrl+"users/order-history/order-completed-verify",C={orderHistoryId:l,orderId:t,otp:r};return console.log(C),this.http.post(g,C)}orderHistory(){let r=localStorage.getItem("providerId"),l=this.apiUrl+`users/order-history/provider/${r}`;return this.http.get(l)}setDefult(){this.orderIds="",this.oredrDetails=[],this.userFullAddress=""}};o.\u0275fac=function(l){return new(l||o)(at(Gi))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var dy=d=>({active:d}),ul=(()=>{let o=class o{constructor(r){this.router=r,this.activeIcon="home"}ngOnInit(){this.router.events.subscribe(r=>{r instanceof zb&&this.setActiveIcon(r.urlAfterRedirects)}),this.setActiveIcon(this.router.url)}changeColor(r,l){this.activeIcon=r,this.router.navigate([l])}setActiveIcon(r){r.includes("home")?this.activeIcon="home":r.includes("ongoing")?this.activeIcon="Services":r.includes("earnings")?this.activeIcon="Activity":r.includes("target")&&(this.activeIcon="Account")}};o.\u0275fac=function(l){return new(l||o)(fe(Bt))},o.\u0275cmp=ft({type:o,selectors:[["app-fotter"]],decls:25,vars:12,consts:[[1,"fottersss"],[1,"sub-fotterss",3,"click","ngClass"],[1,"material-symbols-outlined","notranslate"],[1,"names"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1),Oe("click",function(){return t.changeColor("home","home")}),V(2,"i",2),$(3,"home"),j(),$(4," \xA0 "),V(5,"span",3),$(6,"Home"),j()(),V(7,"div",1),Oe("click",function(){return t.changeColor("Services","ongoing")}),V(8,"i",2),$(9,"work_history"),j(),$(10,"\xA0 "),V(11,"span",3),$(12,"Ongoing"),j()(),V(13,"div",1),Oe("click",function(){return t.changeColor("Activity","earnings")}),V(14,"i",2),$(15,"payments"),j(),$(16,"\xA0 "),V(17,"span",3),$(18,"Earnings"),j()(),V(19,"div",1),Oe("click",function(){return t.changeColor("Account","target")}),V(20,"i",2),$(21,"ads_click"),j(),$(22,"\xA0 "),V(23,"span",3),$(24,"Target"),j()()()),l&2&&(ue(),Fe("ngClass",di(4,dy,t.activeIcon==="home")),ue(6),Fe("ngClass",di(6,dy,t.activeIcon==="Services")),ue(6),Fe("ngClass",di(8,dy,t.activeIcon==="Activity")),ue(6),Fe("ngClass",di(10,dy,t.activeIcon==="Account")))},dependencies:[Oo],styles:[".fottersss[_ngcontent-%COMP%]{border:0;width:100%;display:flex;justify-content:space-around;position:fixed;bottom:0;text-align:center;padding-top:.5rem;padding-bottom:.5rem;background-color:#fff}.sub-fotterss[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{font-size:2rem;color:#00000080}.names[_ngcontent-%COMP%]{display:none}.active[_ngcontent-%COMP%]{background-color:#d16611;border-radius:25px;padding:.5rem 1rem}.active[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{color:#fff}.active[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]{display:block;color:#fff}"]});let d=o;return d})();var y4=["footer"],v4=()=>({backdropBorderRadius:"3px",backdropBackgroundColour:"rgba(0, 0, 0, 0.5)"});function x4(d,o){if(d&1&&(V(0,"div")(1,"div",25),ke(2,"img",26),j()()),d&2){let c=o.$implicit;ue(2),Fe("src",c.image,Un)}}function w4(d,o){if(d&1&&(V(0,"div")(1,"span"),$(2),j(),V(3,"span"),ke(4,"i",30),$(5),j()()),d&2){let c=o.$implicit;ue(2),Tb("",c.day,", ",c.month," ",c.date,""),ue(3),Ii(" ",c.isWorking,"")}}function C4(d,o){if(d&1){let c=Xt();V(0,"div",27),Nt(1,w4,6,4,"div",11),V(2,"div",28),Oe("click",function(){gt(c);let l=lt();return _t(l.navToCal())}),V(3,"pre",29),$(4,"calendar_today"),j()()()}if(d&2){let c=lt();ue(),Fe("ngForOf",c.nextWorking)}}function S4(d,o){d&1&&(V(0,"span"),$(1,"No more jobs today"),j())}function M4(d,o){if(d&1&&(V(0,"span"),$(1),j()),d&2){let c=lt();ue(),Ii("",c.noOfPendingOrders," more jobs today")}}function k4(d,o){if(d&1&&(V(0,"div")(1,"div",32)(2,"video",33),ke(3,"source",34),j()()()),d&2){let c=o.$implicit,r=lt(2);ue(3),Fe("src","https://"+r.bucketName+".s3."+r.region+".amazonaws.com/"+c.videoKey,Un)}}function I4(d,o){if(d&1&&(V(0,"div",31),Nt(1,k4,4,1,"div",11),j()),d&2){let c=lt();ue(),Fe("ngForOf",c.data)}}function T4(d,o){if(d&1&&ke(0,"ngx-loading",24),d&2){let c=lt();Fe("show",c.loading)("config",Eb(2,v4))}}var QE=(()=>{let o=class o{ngOnInit(){let r=localStorage.getItem("onlineStatus"),l=localStorage.getItem("onlineText");r!==null&&(this.online=r==="true"),l!==null&&(this.onlineText=l),this.isAccountVerify=this.logInService.isAccountVerify,this.trainingService.getingVideos().subscribe(t=>{console.log(t),this.data=t},t=>{console.log(t)})}toggleDrawer(){this.isDrawerOpen=!this.isDrawerOpen,this.router.navigate(["menu"])}navToCredit(){this.router.navigate(["credits"])}navToNotification(){this.router.navigate(["notification"])}navToCal(){this.router.navigate(["calender"])}constructor(r,l,t,g,C,I,O,z,q,ie,de){this.router=r,this.http=l,this.trainingService=t,this.logInService=g,this.userDetailsService=C,this.jobDetailsService=I,this.razorpayService=O,this.mapboxService=z,this.orderService=q,this.dialogService=ie,this.googleMapService=de,this.isDrawerOpen=!1,this.data=[],this.bucketName="coolie1-dev",this.region="ap-south-1",this.nextWorking=[],this.loading=!1,this.ads=[{src:"assets/demo/ad.png"},{src:"assets/demo/ad.png"},{src:"assets/demo/ad.png"},{src:"assets/documents/pancard.png"}],this.dates=[],this.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.credits=0,this.online=!1,this.onlineText="Go",this.noOfPendingOrders=0,console.log(this.nextWorking.length),this.getBanners(),this.getProviderDetails(),this.workingDates(),this.getAvalibility(),this.getWork(),this.getCredit(),this.getPendingOrders()}getProviderDetails(){return jn(this,null,function*(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")),setTimeout(()=>{this.navToAboutUser()},2e3)})}navToAboutUser(){localStorage.getItem("providerId")||this.router.navigate(["selectAccount"]);let r;this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")).subscribe(l=>{console.log(l),r=l,r&&!this.jobDetailsService.getcheckingDetails()&&(console.log("inside",this.jobDetailsService.getcheckingDetails()),this.dialogService.openDialog("Please add the details"),this.jobDetailsService.setCheckingDetails(!0),this.router.navigate(["aboutUser"]))}),console.log(r)}workingDates(){this.nextWorking=this.dates.splice(0,2),console.log(this.nextWorking)}getAvalibility(){this.jobDetailsService.getAvailability().subscribe(r=>{console.log(r),this.formattingAvailbility(r)},r=>{console.log(r)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),console.log(r._id),this.userDetailsService.workResponse=r.works,this.userDetailsService.workResponseId=r._id},r=>{console.log(r)})}formattingAvailbility(r){let l=new Date;for(let t=0;t<r.length;t++){let C=r[t].slotTime.date.split("T")[0],I=new Date(C),O=this.dayNames[I.getDay()],z=this.monthNames[I.getMonth()],q=I.getFullYear(),ie=I.getDate();(I>=l||I.toDateString()===l.toDateString())&&(this.dates.some(xe=>xe.date===ie&&xe.day===O&&xe.month===z&&xe.year===q)||(this.dates.push({date:ie,day:O,month:z,year:q,isWorking:"working"}),this.dates.sort((xe,Ie)=>{let Me=this.monthNames.indexOf(xe.month),Ge=this.monthNames.indexOf(Ie.month);if(Me===-1||Ge===-1)return 0;let He=new Date(xe.year,Me,xe.date),ht=new Date(Ie.year,Ge,Ie.date);return He.getTime()-ht.getTime()})))}this.workingDates()}getCredit(){this.razorpayService.getCredits().subscribe(r=>{console.log(r),this.razorpayService.userCredit=r.creditBalance,this.credits=r.credits},r=>{console.log(r)})}getBanners(){this.userDetailsService.getBanners().subscribe({next:r=>{console.log(r),this.ads=r},error:r=>{console.log(r)}})}onlineStatus(){try{this.loading=!0;let r=this.jobDetailsService.isVerify;console.log(r),this.online=!this.online,this.onlineText=this.online?"Off":"Go",this.googleMapService.onlineStatus=this.online,this.googleMapService.setonlineStatus(this.online,this.onlineText),localStorage.setItem("onlineStatus",this.online.toString()),localStorage.setItem("onlineText",this.onlineText),this.online&&this.googleMapService.getCoordinates().subscribe(l=>{console.log("Current Location:",l),this.sendCordinates(l),this.getname(l),alert(l?.lat),this.loading=!1},l=>{console.error("Error getting current location:",l),alert(l.error.message),this.loading=!1})}catch(r){console.error("Error in onlineStatus method:",r)}console.log(this.online)}getname(r){this.mapboxService.getPlaceNameFromCoordinates(r).subscribe(l=>{console.log("Place Name:",l),this.userDetailsService.currentCordinates=r,this.userDetailsService.currentLocation=l,this.mapboxService.placeName=l},l=>{console.error("Error getting place name:",l)})}sendCordinates(r){this.googleMapService.sendCordinates(r).subscribe({next:l=>{console.log(l),alert(l.message)},error:l=>{console.log(l),alert(l.errors.message)}})}sendTokens(){let r="",l={};this.http.post(r,l).subscribe(t=>{console.log(t)},t=>{console.log(t)})}getPendingOrders(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r);let t=new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-"),g="Accepted",C=r.data.filter(I=>{let O=I.orderId.items[0].scheduledDate.split(" ")[0];return console.log("scheduleee================",O),I.status.toLowerCase().includes(g.toLowerCase())&&O===t});console.log("filtered",C),this.noOfPendingOrders=C.length},error:r=>{console.log(r)}})}};o.\u0275fac=function(l){return new(l||o)(fe(Bt),fe(Gi),fe(sp),fe(Kn),fe(Jn),fe(Ar),fe(zo),fe(lp),fe(Pr),fe(Wn),fe(hl))},o.\u0275cmp=ft({type:o,selectors:[["app-home"]],viewQuery:function(l,t){if(l&1&&yi(y4,5),l&2){let g;_i(g=bi())&&(t.footer=g.first)}},decls:60,vars:12,consts:[[1,"container"],[1,"header"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets/logo/credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined","notranslate"],[1,"sub-container"],[1,"ads-div"],[1,"wrapperrr"],[4,"ngFor","ngForOf"],[1,"sub-divs"],["class","availability-div",4,"ngIf"],[1,"new-jobs"],[1,"text-div"],[1,"icon-div"],[1,"more-jobs"],[1,"text-div1"],[1,"pending-task-div"],[1,"quick-links"],["routerLinkActive","help",1,"helps",3,"routerLink"],["id","video-div",4,"ngIf"],[2,"height","5rem"],[3,"show","config"],[1,"slidesss"],[3,"src"],[1,"availability-div"],[3,"click"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],[1,"fa","fa-circle",2,"font-size","10px"],["id","video-div"],["id","video-slidess"],["controls","","id","videoss"],["type","video/mp4",3,"src"]],template:function(l,t){l&1&&(V(0,"div",0),ke(1,"br"),V(2,"div",1)(3,"div",2),Oe("click",function(){return t.toggleDrawer()}),$(4,"\u2630"),j(),V(5,"div",3)(6,"div",4),Oe("click",function(){return t.navToCredit()}),ke(7,"img",5),V(8,"pre"),$(9),zI(10,"number"),j()(),V(11,"div",6),Oe("click",function(){return t.navToNotification()}),V(12,"span",7),$(13,"notifications"),j()()()(),ke(14,"br"),V(15,"div",8)(16,"div",9)(17,"div",10),Nt(18,x4,3,1,"div",11),j()(),V(19,"div",12),Nt(20,C4,5,1,"div",13),V(21,"div")(22,"div",14)(23,"div",15)(24,"span"),$(25,"No new jobs"),j(),V(26,"span"),$(27,"5 jobs missed recently"),j()(),V(28,"div",16)(29,"span",7),$(30,"arrow_forward_ios"),j()()(),ke(31,"br"),V(32,"div",17)(33,"div",18),Nt(34,S4,2,0,"span")(35,M4,2,1),j(),V(36,"div",16)(37,"span",7),$(38,"arrow_forward_ios"),j()()()(),V(39,"div",19)(40,"span"),$(41,"Pending Tasks"),j(),ke(42,"br")(43,"br"),V(44,"p"),$(45," 80 subscription jobs . 4days left to buy job pack now "),j(),V(46,"p"),$(47," Only 50 credits left.Recharge credits to get new jobs "),j()(),V(48,"div",20)(49,"div")(50,"span"),$(51,"Quick links"),j()(),V(52,"div",21)(53,"span"),$(54,"Help?"),j()()(),Nt(55,I4,2,1,"div",22),j()()(),ke(56,"div",23)(57,"router-outlet")(58,"app-fotter"),Nt(59,T4,1,3,"ngx-loading",24)),l&2&&(ki("overlap",t.isDrawerOpen),ue(9),Ft(t.credits%1===0?t.credits:BI(10,9,t.credits,"1.2-2")),ue(9),Fe("ngForOf",t.ads),ue(2),Fe("ngIf",t.nextWorking.length!=0),ue(14),Xn(34,t.noOfPendingOrders===0?34:35),ue(18),Fe("routerLink","/help"),ue(3),Fe("ngIf",t.isAccountVerify),ue(4),Xn(59,t.loading?59:-1))},dependencies:[uo,Cr,Bb,Nb,Vb,cy,ul,GI],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%;transition:padding-left .3s ease;margin-top:0}#drawer[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000;color:red;padding:20px;box-sizing:border-box;transition:transform .3s ease;transform:translate(-100%);z-index:2}#drawer.open[_ngcontent-%COMP%]{transform:translate(0);overlay:auto}.header[_ngcontent-%COMP%]{margin-top:0rem;width:90%;display:flex;justify-content:space-between}#menu-button[_ngcontent-%COMP%]{cursor:pointer;z-index:2;color:#d16611;font-size:24px}.list-menu[_ngcontent-%COMP%]{list-style-type:none;font-size:1rem;font-weight:400;font-family:Roboto Condensed}.bell-credit[_ngcontent-%COMP%]{width:max-content;height:2.5rem;display:flex;justify-content:space-between;gap:.5rem;border-radius:.2rem}.package[_ngcontent-%COMP%]{width:max-content;padding:0 .5rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.credit[_ngcontent-%COMP%]{width:max-content;padding:0 .5rem;display:flex;justify-content:space-evenly;align-items:center;gap:.3rem;border:1px solid black;border-radius:.4rem}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .package[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%], .package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center;border-radius:.4rem}.sub-container[_ngcontent-%COMP%]{width:95%;height:90vh;overflow-y:auto;scroll-snap-type:y;scroll-behavior:smooth;scrollbar-width:none}.sub-divs[_ngcontent-%COMP%]{margin-top:1rem;display:grid;row-gap:1.4rem}.ads-div[_ngcontent-%COMP%]{display:flex;height:7rem;width:100%}.wrapperrr[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;grid-gap:.5rem;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}.slidesss[_ngcontent-%COMP%]{width:100%;height:100%}.slidesss[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:auto;object-fit:cover}.availability-div[_ngcontent-%COMP%]{width:98%;height:max-content;display:flex;column-gap:4%;row-gap:0;align-items:center;margin-left:.5rem;justify-content:space-between}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:22px;text-align:left}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:22px;text-align:left}.new-jobs[_ngcontent-%COMP%]{width:100%;height:5rem;background-color:#d70d09;border-radius:1.3rem;color:#f5f5f5;display:flex;justify-content:space-between;align-items:center}.text-div[_ngcontent-%COMP%]{width:max-content;height:4rem;display:grid;justify-content:center;row-gap:0rem;text-align:left;align-items:center;padding-left:2rem}.text-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(1), .pending-task-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .quick-links[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .text-div1[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-size:1.4rem;font-weight:500}.text-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(2){font-family:Inter,sans-serif;font-size:.95rem;font-weight:400}.icon-div[_ngcontent-%COMP%]{width:30%;display:flex;justify-content:center;align-items:center}.more-jobs[_ngcontent-%COMP%]{width:100%;height:4rem;background-color:#d70d09;border-radius:1.3rem;color:#fff;display:flex;align-items:center;justify-content:space-between}.text-div1[_ngcontent-%COMP%]{width:max-content;height:4rem;display:grid;justify-content:center;align-items:center;padding-left:2rem}.pending-task-div[_ngcontent-%COMP%]{text-align:left}.pending-task-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:15px;font-weight:400;line-height:16.94px;letter-spacing:.05em;text-align:left}.quick-links[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.helps[_ngcontent-%COMP%]{width:6rem;height:3rem;background-color:#20193f;color:#fff;display:flex;justify-content:center;align-items:center;border-radius:1.8rem}#video-div[_ngcontent-%COMP%]{width:100%;height:10rem;display:flex;grid-gap:.5rem;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}video[_ngcontent-%COMP%]{width:100vw;height:10rem;object-fit:cover;cursor:pointer}.online[_ngcontent-%COMP%]{background-color:#d16611;width:6rem;height:6rem;border-radius:50%;position:fixed;bottom:70px;left:40%;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:500;color:#fff;overflow:hidden}.online[_ngcontent-%COMP%]:before{content:"";position:absolute;width:50%;height:50%;border:.2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_wave 1.9s ease-out infinite;pointer-events:none}@keyframes _ngcontent-%COMP%_wave{50%{transform:scale(1);width:50%;height:50%}60%{transform:scale(1.5);width:60%;height:60%}70%{transform:scale(2);width:70%;height:70%}to{transform:scale(2.5);width:100%;height:100%}}']});let d=o;return d})();var E4=d=>({active:d});function D4(d,o){if(d&1){let c=Xt();V(0,"button",14),Oe("click",function(){let l=gt(c).$implicit,t=lt();return _t(t.setActiveButton(l))}),$(1),j()}if(d&2){let c=o.$implicit,r=lt();Fe("ngClass",di(2,E4,r.activeButton===c)),ue(),Ii(" ",c," ")}}function A4(d,o){if(d&1&&(V(0,"div",15)(1,"span",16)(2,"span",17),$(3),j(),V(4,"span",18),$(5),j()(),V(6,"span",18),$(7),j()(),ke(8,"div",19)),d&2){let c=o.$implicit;ue(3),Ft(c.date),ue(2),Ft(c.details),ue(2),Ft(c.amount)}}var KE=(()=>{let o=class o{navBack(){this.location.back()}navToAddCredit(){this.router.navigate(["addCredit"])}constructor(r,l,t){this.location=r,this.router=l,this.razorpayServie=t,this.buttons=["All","Recharge","Expenses","Penalties"],this.activeButton="All",this.history=[],this.filteredCreditHistory=[],this.credits=this.razorpayServie.userCredit,console.log(this.razorpayServie.userCredit),this.getCredit()}setActiveButton(r){this.activeButton=r,this.filter(this.activeButton)}getCredit(){this.razorpayServie.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits,this.history=r.transactions,this.filteredCreditHistory=this.history},error:r=>{console.log(r)}})}filter(r){let l=this.history,t;r!="All"?(t=l.filter(g=>g.type.toLowerCase().includes(r.toLowerCase())),this.filteredCreditHistory=t):this.filteredCreditHistory=l,console.log(this.filteredCreditHistory)}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(Bt),fe(zo))},o.\u0275cmp=ft({type:o,selectors:[["app-credit"]],decls:24,vars:2,consts:[[1,"container"],[1,"header"],[1,"arrow_back",3,"click"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],[1,"logo"],["src","assets\\documents\\credit bg.png"],[1,"credit"],[1,"credit-details"],[3,"click"],[1,"sub-container"],[1,"cat"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"content"],[1,"content-div"],[3,"click","ngClass"],[1,"sub-content-div"],[1,"span-div"],[1,"highlight"],[1,"normal-text"],[1,"line"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2),Oe("click",function(){return t.navBack()}),V(3,"span",3),$(4,"arrow_back"),j()(),V(5,"div",4),ke(6,"img",5),j()(),V(7,"div",6)(8,"div",7)(9,"span"),$(10,"Credit balance :"),j(),$(11,"\xA0 "),V(12,"span"),$(13),j()(),V(14,"div")(15,"button",8),Oe("click",function(){return t.navToAddCredit()}),$(16,"Add+"),j()()(),V(17,"div",9)(18,"div",10),Nt(19,D4,2,4,"button",11),j(),V(20,"div",12)(21,"div",13),xr(22,A4,9,3,null,null,io),j()()()()),l&2&&(ue(13),Ft(t.credits),ue(6),Fe("ngForOf",t.buttons),ue(3),wr(t.filteredCreditHistory))},dependencies:[Oo,uo],styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh;align-items:center;text-align:center;display:grid;grid-template-rows:max-content max-content auto;row-gap:2rem;gap:2rem;grid-gap:2rem}.header[_ngcontent-%COMP%]{border:1px solid black;width:90%;height:10rem;display:flex;position:relative;left:5%;top:10%;border-radius:.8rem}.arrow_back[_ngcontent-%COMP%]{width:10%;position:relative;top:8%;left:2%}.logo[_ngcontent-%COMP%]{width:90%;display:flex;justify-content:center;align-items:center}.credit[_ngcontent-%COMP%]{width:90%;height:max-content;display:flex;justify-content:space-between;position:relative;left:5%}.credit-details[_ngcontent-%COMP%]{float:left;text-align:left}.credit-details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:1rem;font-family:"Inter" sans-serif;font-weight:500;line-height:1.2rem}.credit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:4rem;height:2rem;background-color:#5ba36b;color:#fff;border:none;border-radius:.6rem}.sub-container[_ngcontent-%COMP%]{width:90%;height:70vh;position:relative;left:5%}.cat[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px;border-bottom:2px solid transparent;cursor:pointer}.cat[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-bottom:2px solid #f40905}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:border-bottom .3s}.content[_ngcontent-%COMP%]{width:100%;margin-top:.8rem}.content-div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-content-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.span-div[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.highlight[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:16.94px;text-align:left}.normal-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:14.52px;text-align:left}.line[_ngcontent-%COMP%]{margin-top:.5rem;border:none;border-bottom:.25px solid black}']});let d=o;return d})();function P4(d,o){d&1&&(V(0,"span"),$(1,"Name"),j())}function O4(d,o){if(d&1&&(V(0,"span"),$(1),j()),d&2){let c=lt();ue(),Ft(c.userName)}}function R4(d,o){if(d&1){let c=Xt();ke(0,"br"),V(1,"div",12),Oe("click",function(){let l=gt(c).$implicit,t=lt();return _t(t.navTo(l.name))}),V(2,"div",12),Oe("click",function(){let l=gt(c).$implicit,t=lt();return _t(t.navTo(l.name))}),V(3,"span",11),$(4),j(),$(5," \xA0 \xA0 "),V(6,"span"),$(7),j()(),V(8,"span",11),$(9,"arrow_forward_ios"),j()(),ke(10,"hr")}if(d&2){let c=o.$implicit;ue(4),Ft(c.icon),ue(3),Ft(c.name)}}var JE=(()=>{let o=class o{constructor(r,l,t,g,C,I,O,z){this.location=r,this.router=l,this.loginService=t,this.jobDetailsService=g,this.ordersService=C,this.razorpayService=I,this.userDetals=O,this.dialougeService=z,this.userName="",this.userImage="",this.whatsAppStaus="on",this.providerRating="",this.options=[{icon:"calendar_today",name:"Calendar"},{icon:"work",name:"Job History"},{icon:"poker_chip",name:"Credits"},{icon:"tv_gen",name:"Training"},{icon:"featured_seasonal_and_gifts",name:"Invite a friend"},{icon:"question_mark",name:"Help Center"},{icon:"emoji_events",name:"Certificate & documents"}]}ngOnInit(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")),this.getUsername(),this.getProviderRating()}getProviderRating(){this.jobDetailsService.getRating().subscribe({next:r=>{console.log(r),this.providerRating=r.averageRating},error:r=>{console.log(r)}})}getUsername(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r)},complete:()=>{this.userName=this.jobDetailsService.userDetails?.providerName,this.userImage=this.jobDetailsService.userDetails?.image,console.log(this.jobDetailsService.userDetails),console.log(this.userName),this.apiSubscription?.unsubscribe()}})}navTo(r){switch(console.log(r),r){case"Calendar":this.router.navigate(["calender"]);break;case"Job History":this.router.navigate(["jobHistory"]);break;case"Credits":console.log("inside"),this.router.navigate(["credits"]);break;case"Training":this.router.navigate(["training"]);break;case"Invite a friend":this.router.navigate(["referAndEarn"]);break;case"Help Center":this.router.navigate(["help"]);break;case"Certificate & documents":this.router.navigate(["awards"]);break;case"packages":this.router.navigate(["packages"]);break;default:console.log("No matching case found")}}navToFinancial(){this.router.navigate(["financialDetails"])}navBack(){this.location.back()}navToVisiting(){let r=localStorage.getItem("providerId");this.userDetals.getUserDetails(r).subscribe({next:l=>{console.log(l),this.router.navigate(["visitingCard"])},error:l=>{console.log(l),this.dialougeService.openDialog("Provider details are missing"),this.router.navigate(["aboutUser"])}})}logOut(){this.jobDetailsService.setDefault(),this.loginService.setDefult(),this.ordersService.setDefult(),this.razorpayService.setDefault(),this.userDetals.setDefult(),this.loginService.removeUser(),this.router.navigate(["selectAccount"]),localStorage.clear()}statusChange(){this.whatsAppStaus==="on"?this.whatsAppStaus="off":(this.whatsAppStaus="off")&&(this.whatsAppStaus="on")}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(Bt),fe(Kn),fe(Ar),fe(Pr),fe(zo),fe(Jn),fe(Wn))},o.\u0275cmp=ft({type:o,selectors:[["app-menu"]],decls:66,vars:5,consts:[[1,"material-symbols-outlined","notranslate",3,"click"],[1,"container"],[1,"sub-container"],[1,"profile"],[1,"image"],[1,"profile-img",3,"src"],[1,"details"],[1,"details-div"],[1,"package",3,"click"],["src","assets/packages/silver coin 1.png",1,"package-img"],[1,"rating"],[1,"material-symbols-outlined","notranslate"],[3,"click"],[1,"category"],[1,"updates"],[1,"finacial",3,"click"],[1,"iconss"],[1,"finacial"],[1,"fa","fa-whatsapp"],["routerLinkActive","language",1,"finacial",3,"routerLink"],[1,"btn",3,"click"]],template:function(l,t){l&1&&(ke(0,"br")(1,"br"),$(2,"\xA0\xA0 \xA0"),V(3,"span",0),Oe("click",function(){return t.navBack()}),$(4,"arrow_back"),j(),ke(5,"br")(6,"br"),V(7,"div",1)(8,"div",2)(9,"div",3)(10,"div",4),ke(11,"img",5),j(),V(12,"div",6)(13,"div",7),Nt(14,P4,2,0,"span")(15,O4,2,1),V(16,"span",8),Oe("click",function(){return t.navTo("packages")}),ke(17,"img",9),$(18,"\xA0 "),V(19,"pre"),$(20,"Silver"),j()()(),V(21,"div",10)(22,"span",11),$(23,"star"),j(),$(24),j(),V(25,"button",12),Oe("click",function(){return t.navToVisiting()}),$(26,"View more"),j()()(),ke(27,"br"),V(28,"div",13),xr(29,R4,11,2,null,null,io),j(),ke(31,"br"),V(32,"div",14)(33,"div",15),Oe("click",function(){return t.navToFinancial()}),V(34,"div",16)(35,"span",11),$(36,"currency_rupee"),j()(),V(37,"div")(38,"span"),$(39,"Financial details"),j(),ke(40,"br"),$(41," GST,PAN and bank information "),j()(),V(42,"div",17)(43,"div",16),ke(44,"span",18),j(),V(45,"div")(46,"span"),$(47,"Send whatsApp updates"),j(),ke(48,"br"),V(49,"span",12),Oe("click",function(){return t.statusChange()}),$(50),j()()(),V(51,"div",19)(52,"div",16)(53,"span",11),$(54,"g_translate"),j()(),V(55,"div")(56,"span"),$(57,"Change language"),j(),ke(58,"br"),$(59," English "),j()()(),ke(60,"br"),V(61,"div",20),Oe("click",function(){return t.logOut()}),V(62,"button")(63,"span",11),$(64,"power_settings_new"),j(),$(65,"\xA0 Logout"),j()()()()),l&2&&(ue(11),Fe("src",t.userImage?t.userImage:"assets/logo/profile.png",Un),ue(3),Xn(14,t.userName===""?14:15),ue(10),Ft(t.providerRating),ue(5),wr(t.options),ue(21),Ft(t.whatsAppStaus),ue(),Fe("routerLink","/language"))},dependencies:[Nb,Vb],styles:['.container[_ngcontent-%COMP%]{width:90%;height:100vh;padding:1rem}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;left:5%}.profile[_ngcontent-%COMP%]{width:100%;height:9rem;display:flex;align-items:center;justify-content:space-evenly;border:.25px solid black;border-radius:.5rem}.image[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.profile-img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.details[_ngcontent-%COMP%]{width:70%;display:flex;flex-direction:column;text-align:left;gap:.5rem}.details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.5rem;font-family:"Inter" sans-serif;font-weight:500}.details-div[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.package[_ngcontent-%COMP%]{width:max-content;height:2rem;padding:0 .3rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.package-img[_ngcontent-%COMP%]{width:1.3rem;height:1.3rem}.package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1rem;line-height:1.7rem}.details[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:18px;border:none;background-color:transparent;width:max-content;border-bottom:2px solid black;display:flex;align-items:center}.rating[_ngcontent-%COMP%]{display:flex;width:max-content;height:max-content;align-items:center}.category[_ngcontent-%COMP%]{width:100%}.category[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.category[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .finacial[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:500}.updates[_ngcontent-%COMP%]{border:.25px solid black;width:100%;height:11.5rem;border-radius:.5rem;display:flex;flex-direction:column;align-items:center;justify-content:center}.finacial[_ngcontent-%COMP%]{display:flex;width:100%;height:3.2rem}.iconss[_ngcontent-%COMP%]{width:20%;display:flex;justify-content:center;align-items:center;text-align:center}.iconss[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px}.btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:18px;border:none;background-color:transparent;display:flex;align-items:center}.btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;color:red}']});let d=o;return d})();function L4(d,o){d&1&&(V(0,"span"),$(1,"Name"),j())}function F4(d,o){if(d&1&&(V(0,"span"),$(1),j()),d&2){let c=lt();ue(),Ft(c.userName)}}function z4(d,o){if(d&1&&$(0),d&2){let c=lt().$implicit;Ii(" ",c.categoryId.name," ")}}function B4(d,o){if(d&1&&(V(0,"span"),Nt(1,z4,1,1),j()),d&2){let c=o.index;ue(),Xn(1,c<2?1:-1)}}function N4(d,o){if(d&1&&Nt(0,B4,2,1,"span",19),d&2){let c=lt();Fe("ngForOf",c.workSeleceted)}}var eD=(()=>{let o=class o{constructor(r,l,t,g,C){this.router=r,this.location=l,this.jobDetailsService=t,this.logInService=g,this.userService=C,this.userImage="",this.userName="",this.userId=localStorage.getItem("providerId"),this.workSeleceted=this.jobDetailsService?.userDetails?.work,this.providerRating="",this.certificateImages=[{images:"assets/demo/awards.png"},{images:"assets/demo/certificate2.png"}]}ngOnInit(){this.signingDetails(),this.getWork(),this.getCertificates(),this.getProviderRating()}getProviderRating(){this.jobDetailsService.getRating().subscribe({next:r=>{console.log(r),this.providerRating=r.averageRating},error:r=>{console.log(r)}})}signingDetails(){this.phoneNumber=this.jobDetailsService.userDetails?.phone,this.userName=this.jobDetailsService.userDetails?.providerName,this.userImage=this.jobDetailsService.userDetails?.image}getWork(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works.filter((l,t,g)=>t===g.findIndex(C=>C.categoryId.name===l.categoryId.name))},r=>{console.log(r)})}getCertificates(){let r=localStorage.getItem("providerId");this.userService.getCertificated(r).subscribe({next:l=>{console.log(l);let t=[];for(let g=0;g<l.length;g++){let C=l[g];t.push({images:C.image})}this.certificateImages=t},error:l=>{console.log(l)},complete:()=>{this.apiSubscription?.unsubscribe()}})}navTo(){this.router.navigate(["manageServices"])}navToBack(){this.location.back()}navToVerification(){this.logInService.isAccountVerify?this.router.navigate(["identityVerification"]):this.router.navigate(["aadharVerify"])}navToCertificates(){this.router.navigate(["awards"])}};o.\u0275fac=function(l){return new(l||o)(fe(Bt),fe(ii),fe(Ar),fe(Kn),fe(Jn))},o.\u0275cmp=ft({type:o,selectors:[["app-visiting-card"]],decls:67,vars:8,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"sub-container"],[1,"profile"],[1,"image"],["alt","User Image",3,"src"],[1,"details"],[1,"rating"],[1,"category"],[1,"ids"],[1,"tittle"],[1,"ids",3,"click"],[3,"click"],[1,"tittle2"],[1,"material-symbols-outlined","notranslate"],[1,"awards-div"],[1,"awards"],[3,"src"],[2,"height","3rem"],[4,"ngFor","ngForOf"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"span",1),Oe("click",function(){return t.navToBack()}),$(2,"arrow_back"),j(),ke(3,"br"),V(4,"div",2)(5,"div",3)(6,"div",4),ke(7,"img",5),j(),V(8,"div",6),Nt(9,L4,2,0,"span")(10,F4,2,1),V(11,"div",7),$(12),j(),Nt(13,N4,1,1,"span"),j()(),V(14,"div",8)(15,"div")(16,"div",9)(17,"span",10),$(18,"My Id"),j(),V(19,"span",10),$(20),j()(),ke(21,"hr"),j(),V(22,"div")(23,"div",11),Oe("click",function(){return t.navTo()}),V(24,"span",10),$(25,"Manage Service"),j(),V(26,"span",10),$(27,"+"),j()(),ke(28,"hr"),j(),V(29,"div")(30,"div",9)(31,"div",12),Oe("click",function(){return t.navToVerification()}),V(32,"span",10),$(33,"Identity verification"),j(),ke(34,"br"),V(35,"span",13),$(36,"Identity Proof and Personal details"),j()(),V(37,"span",14),$(38,"arrow_forward_ios"),j()()()(),V(39,"div",15)(40,"span"),$(41,"Award and certificate "),j(),V(42,"div",16)(43,"div"),ke(44,"img",17),j(),V(45,"div"),ke(46,"img",17),j()(),V(47,"span",12),Oe("click",function(){return t.navToCertificates()}),$(48,"View More"),j()(),V(49,"div",15)(50,"span"),$(51,"Contact Details"),j(),V(52,"div"),ke(53,"hr"),j(),V(54,"div")(55,"pre"),$(56,"Phone"),j(),V(57,"span"),$(58),j()(),V(59,"div")(60,"pre"),$(61,"Email"),j(),V(62,"span"),$(63,"abcdgmail.com"),j()()()()(),ke(64,"br")(65,"br")(66,"div",18)),l&2&&(ue(7),Fe("src",t.userImage?t.userImage:"assets/logo/profile.png",Un),ue(2),Xn(9,t.userName===""?9:10),ue(3),Ii(" \u2605 ",t.providerRating," "),ue(),Xn(13,t.workSeleceted?13:-1),ue(7),Ft(t.userId),ue(24),Fe("src",t.certificateImages[0].images,Un),ue(2),Fe("src",t.certificateImages[0].images,Un),ue(12),Ft(t.phoneNumber))},dependencies:[uo],styles:['.container[_ngcontent-%COMP%]{width:100%;margin-bottom:3rem}.material-symbols-outlined[_ngcontent-%COMP%]{margin:1rem}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;left:5%;display:grid;row-gap:2rem}.profile[_ngcontent-%COMP%]{width:100%;height:8rem;display:flex;align-items:center;justify-content:space-evenly;border:.25px solid black;border-radius:.5rem}.image[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.profile[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.details[_ngcontent-%COMP%]{width:70%;height:5rem}.details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:500}.rating[_ngcontent-%COMP%]{display:flex;width:max-content;height:1.3rem;align-items:center;text-align:left}.category[_ngcontent-%COMP%]{width:100%;padding:.5rem;display:flex;flex-direction:column;gap:.8rem}.work-names[_ngcontent-%COMP%]{border:1px solid red;width:100%;display:flex;flex-direction:row}.ids[_ngcontent-%COMP%]{width:100%;height:max-content;display:flex;justify-content:space-between;margin-top:.5rem;margin-bottom:.5rem}.tittle[_ngcontent-%COMP%], .awards-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter"sans-serif;font-weight:500}.tittle2[_ngcontent-%COMP%], pre[_ngcontent-%COMP%]{font-size:1rem;font-family:"Inter"sans-serif;font-weight:400}.awards-div[_ngcontent-%COMP%]{display:grid;row-gap:1rem;border:.25px solid black;border-radius:.5rem;padding:1rem}.awards[_ngcontent-%COMP%]{width:100%;border:1px solid black;display:flex;justify-content:space-between}.awards[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:48%;height:141px}.awards[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}hr[_ngcontent-%COMP%]{color:#000}']});let d=o;return d})();var tD=(()=>{let o=class o{navToBack(){this.location.back()}constructor(r){this.location=r}};o.\u0275fac=function(l){return new(l||o)(fe(ii))},o.\u0275cmp=ft({type:o,selectors:[["app-refer-and-earn"]],decls:54,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"refer-div"],[1,"refer"],[1,"tittle1"],["src","assets\\documents\\invite.png"],[1,"dot"],[1,"line"],[1,"links"],["src","assets\\logo\\whatsup.png"],[1,"material-symbols-outlined","notranslate"],[1,"how"],[1,"steps-div"],[1,"steps"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0 "),V(5,"span",3),$(6,"Refer and Earn"),j()(),V(7,"div",4)(8,"div",5)(9,"div",6)(10,"div")(11,"span",7),$(12,"Refer and get FREE services "),j(),V(13,"p"),$(14,"Invite your to our company off.You win \u20B9 500 once they take services.They get instant \u20B9 500 "),j()(),V(15,"div"),ke(16,"img",8),j()(),V(17,"div",9),ke(18,"div",10),V(19,"span"),$(20,"Refer via"),j(),ke(21,"div",10),j(),V(22,"div",11)(23,"div"),ke(24,"img",12)(25,"br"),V(26,"span"),$(27,"Whatsapp"),j()(),V(28,"div")(29,"span",13),$(30,"link"),j(),ke(31,"br"),V(32,"span"),$(33,"Link"),j()()()(),V(34,"div",14)(35,"span",7),$(36,"How it works?"),j(),ke(37,"br"),V(38,"div",15)(39,"div",16)(40,"div"),$(41,"1"),j(),V(42,"span"),$(43,"Invite your friends & get rewarded"),j()(),V(44,"div",16)(45,"div"),$(46,"2"),j(),V(47,"span"),$(48,"They get free service on first order"),j()(),V(49,"div",16)(50,"div"),$(51,"3"),j(),V(52,"span"),$(53,"You get reward once their service is completed"),j()()()()()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-rows:auto auto auto;row-gap:30px;align-items:center;text-align:center;justify-content:center}.tittle[_ngcontent-%COMP%]{float:left;font-family:inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:24px}.refer-div[_ngcontent-%COMP%]{border:.25px solid black;border-radius:.5rem}.refer[_ngcontent-%COMP%]{padding:1rem;width:90%;height:max-content;display:flex;border-radius:.4rem}.refer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:92px;height:92px}.dot[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto max-content auto}.dot[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1rem;font-weight:500;line-height:14.52px}.line[_ngcontent-%COMP%]{margin-top:8px;border:none;border-top:1.2px dashed rgb(91,90,90)}.links[_ngcontent-%COMP%]{display:flex;justify-content:space-around;padding:1rem}.tittle1[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:500;line-height:24px}.how[_ngcontent-%COMP%]{width:90%;height:max-content;padding:1rem;border:.25px solid black;border-radius:.5rem;display:grid;text-align:left}.how[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.steps-div[_ngcontent-%COMP%]{display:grid;row-gap:1.5rem}.steps[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background-color:#49a010;color:#fff;align-items:center}.steps[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:80%}']});let d=o;return d})();function V4(d,o){d&1&&(V(0,"div",13)(1,"span"),$(2,"+"),j(),V(3,"span"),$(4,"Add Photo"),j()())}function j4(d,o){if(d&1&&ke(0,"img",14),d&2){let c=lt();Fe("src",c.imagePreview,Un)}}function U4(d,o){d&1&&(V(0,"div",13)(1,"span"),$(2,"+"),j(),V(3,"span"),$(4,"Add Documents"),j()())}function W4(d,o){if(d&1&&ke(0,"img",14),d&2){let c=lt();Fe("src",c.documentPreview,Un)}}function H4(d,o){if(d&1&&(V(0,"div",12),ke(1,"img",15),j()),d&2){let c=o.$implicit;ue(),Fe("src",c.image,Un)}}var iD=(()=>{let o=class o{navToBack(){this.location.back()}constructor(r,l,t,g){this.location=r,this.http=l,this.fb=t,this.userDetalsService=g,this.apiUrl=Cn,this.items=[],this.bucketName="coolie1-dev",this.region="ap-south-1",this.userId=localStorage.getItem("providerId"),this.selectedFile=null,this.selectedDocument=null,this.base64Image=null,this.imagePreview=null,this.documentPreview=null,this.getCertificates(),this.imageForm=this.fb.group({image:"",user:this.userId,isverified:!1}),console.log(this.items)}onFileSelected(r){let l=r.target;if(l.files&&l.files.length>0){this.selectedFile=l.files[0],this.imagePreview=l.files[0];let t=l.files[0],g=new FileReader;g.onload=()=>{this.imagePreview=g.result},g.readAsDataURL(this.selectedFile),console.log("image",this.imagePreview),this.imageForm.value.image=t}this.sending()}onDocumentSelected(r){let l=r.target;if(l.files&&l.files.length>0){this.selectedDocument=l.files[0],this.imagePreview=l.files[0];let t=l.files[0],g=new FileReader;g.onload=()=>{this.imagePreview=g.result},g.readAsDataURL(this.selectedDocument),console.log("image",this.imagePreview),this.imageForm.value.image=t}this.sending()}sending(){console.log("sending doc");let r=new FormData;r.append("image",this.imageForm.value.image),r.append("isVerified",this.imageForm.value.isverified),r.append("providerId",this.imageForm.value.user);let l=this.apiUrl+"providers/provider-certificate";this.http.post(l,r).subscribe({next:t=>{console.log(t),this.getCertificates()},error:t=>{console.log(t)}})}getCertificates(){this.userDetalsService.getCertificated(this.userId).subscribe({next:r=>{console.log(r),this.items=r,console.log(this.items[0].image)},error:r=>{console.log(r)},complete:()=>{this.apiSubscription?.unsubscribe()}})}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(Gi),fe(aa),fe(Jn))},o.\u0275cmp=ft({type:o,selectors:[["app-awards"]],decls:22,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"addPhoto"],["for","file-input",1,"file-label"],["class","placeholder-image",4,"ngIf"],["alt","Selected image","class","preview-image",3,"src",4,"ngIf"],[3,"formGroup"],["type","file","id","file-input","required","",1,"file-input",3,"change"],["type","file","id","document-inputs","required","",1,"file-input",3,"change"],[1,"awards"],[1,"placeholder-image"],["alt","Selected image",1,"preview-image",3,"src"],["alt","Image from AWS S3",3,"src"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0\xA0 "),V(5,"span",3),$(6,"Certificate and Documents"),j()(),V(7,"div",4)(8,"div",5)(9,"label",6),Nt(10,V4,5,0,"div",7)(11,j4,1,1,"img",8),j(),V(12,"form",9)(13,"input",10),Oe("change",function(C){return t.onFileSelected(C)}),j()()(),V(14,"div",5)(15,"label",6),Nt(16,U4,5,0,"div",7)(17,W4,1,1,"img",8),j(),V(18,"form",9)(19,"input",11),Oe("change",function(C){return t.onDocumentSelected(C)}),j()()(),xr(20,H4,2,1,"div",12,io),j()()),l&2&&(ue(10),Fe("ngIf",!t.selectedFile),ue(),Fe("ngIf",t.selectedFile),ue(),Fe("formGroup",t.imageForm),ue(4),Fe("ngIf",!t.selectedDocument),ue(),Fe("ngIf",t.selectedDocument),ue(),Fe("formGroup",t.imageForm),ue(2),wr(t.items))},dependencies:[Cr,Lo,Ro,oa],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-columns:auto auto;row-gap:30px;column-gap:30px;align-items:center;text-align:center;justify-content:space-around}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:24px}.addPhoto[_ngcontent-%COMP%]{width:8.5rem;height:8rem;display:grid;align-items:center;border:1px dashed black}span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:600;line-height:19px}.awards[_ngcontent-%COMP%]{width:8.5rem;height:8rem}.awards[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.file-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:60%;cursor:pointer;position:relative}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.placeholder-image[_ngcontent-%COMP%]{display:grid;row-gap:1rem}.preview-image[_ngcontent-%COMP%]{width:10rem;height:8rem}']});let d=o;return d})();var G4=["path"],q4=Math.PI/180,$4=(()=>{let o=class o{constructor(r){this.supportsSvg=!!(r&&r.createElementNS&&r.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect),this.base=r&&r.head.querySelector("base"),this.hasPerf=typeof window<"u"&&window.performance&&window.performance.now&&typeof window.performance.now()=="number"}resolveColor(r){if(this.base&&this.base.href){let l=r.indexOf("#");if(l>-1&&r.indexOf("url")>-1)return r.slice(0,l)+location.href+r.slice(l)}return r}getTimestamp(){return this.hasPerf?window.performance.now():Date.now()}getArc(r,l,t,g,C=!1){let I=Math.max(0,Math.min(r||0,l)),O=C?180:359.9999,z=l===0?O:I/l*O,q=this._polarToCartesian(g,t,z),ie=this._polarToCartesian(g,t,0),de=z<=180?0:1;return`M ${q} A ${t} ${t} 0 ${de} 0 ${ie}`}_polarToCartesian(r,l,t){let g=(t-90)*q4,C=r+l*Math.cos(g),I=r+l*Math.sin(g);return C+" "+I}};o.\u0275fac=function(l){return new(l||o)(at(gn,8))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),nD={radius:125,animation:"easeOutCubic",animationDelay:void 0,duration:500,stroke:15,color:"#45CCCE",background:"#EAEAEA",responsive:!1,clockwise:!0,semicircle:!1,rounded:!1},rD=new bn("ROUND_PROGRESS_DEFAULTS",{providedIn:"root",factory:()=>nD}),Y4={provide:rD,useValue:nD},Z4=(()=>{let o=class o{linearEase(r,l,t,g){return t*r/g+l}easeInQuad(r,l,t,g){return t*(r/=g)*r+l}easeOutQuad(r,l,t,g){return-t*(r/=g)*(r-2)+l}easeInOutQuad(r,l,t,g){return(r/=g/2)<1?t/2*r*r+l:-t/2*(--r*(r-2)-1)+l}easeInCubic(r,l,t,g){return t*(r/=g)*r*r+l}easeOutCubic(r,l,t,g){return t*((r=r/g-1)*r*r+1)+l}easeInOutCubic(r,l,t,g){return(r/=g/2)<1?t/2*r*r*r+l:t/2*((r-=2)*r*r+2)+l}easeInQuart(r,l,t,g){return t*(r/=g)*r*r*r+l}easeOutQuart(r,l,t,g){return-t*((r=r/g-1)*r*r*r-1)+l}easeInOutQuart(r,l,t,g){return(r/=g/2)<1?t/2*r*r*r*r+l:-t/2*((r-=2)*r*r*r-2)+l}easeInQuint(r,l,t,g){return t*(r/=g)*r*r*r*r+l}easeOutQuint(r,l,t,g){return t*((r=r/g-1)*r*r*r*r+1)+l}easeInOutQuint(r,l,t,g){return(r/=g/2)<1?t/2*r*r*r*r*r+l:t/2*((r-=2)*r*r*r*r+2)+l}easeInSine(r,l,t,g){return-t*Math.cos(r/g*(Math.PI/2))+t+l}easeOutSine(r,l,t,g){return t*Math.sin(r/g*(Math.PI/2))+l}easeInOutSine(r,l,t,g){return-t/2*(Math.cos(Math.PI*r/g)-1)+l}easeInExpo(r,l,t,g){return r===0?l:t*Math.pow(2,10*(r/g-1))+l}easeOutExpo(r,l,t,g){return r===g?l+t:t*(-Math.pow(2,-10*r/g)+1)+l}easeInOutExpo(r,l,t,g){return r===0?l:r===g?l+t:(r/=g/2)<1?t/2*Math.pow(2,10*(r-1))+l:t/2*(-Math.pow(2,-10*--r)+2)+l}easeInCirc(r,l,t,g){return-t*(Math.sqrt(1-(r/=g)*r)-1)+l}easeOutCirc(r,l,t,g){return t*Math.sqrt(1-(r=r/g-1)*r)+l}easeInOutCirc(r,l,t,g){return(r/=g/2)<1?-t/2*(Math.sqrt(1-r*r)-1)+l:t/2*(Math.sqrt(1-(r-=2)*r)+1)+l}easeInElastic(r,l,t,g){let C=g*.3,I=1.70158,O=t;return r===0?l:(r/=g)===1?l+t:(O<Math.abs(t)?(O=t,I=C/4):I=C/(2*Math.PI)*Math.asin(t/O),-(O*Math.pow(2,10*r--)*Math.sin((r*g-I)*(2*Math.PI)/C))+l)}easeOutElastic(r,l,t,g){let C=g*.3,I=1.70158,O=t;return r===0?l:(r/=g)===1?l+t:(O<Math.abs(t)?(O=t,I=C/4):I=C/(2*Math.PI)*Math.asin(t/O),O*Math.pow(2,-10*r)*Math.sin((r*g-I)*(2*Math.PI)/C)+t+l)}easeInOutElastic(r,l,t,g){let C=g*.44999999999999996,I=1.70158,O=t;return r===0?l:(r/=g/2)===2?l+t:(O<Math.abs(t)?(O=t,I=C/4):I=C/(2*Math.PI)*Math.asin(t/O),r<1?-.5*(O*Math.pow(2,10*(r-=1))*Math.sin((r*g-I)*(2*Math.PI)/C))+l:O*Math.pow(2,-10*(r-=1))*Math.sin((r*g-I)*(2*Math.PI)/C)*.5+t+l)}easeInBack(r,l,t,g,C=1.70158){return t*(r/=g)*r*((C+1)*r-C)+l}easeOutBack(r,l,t,g,C=1.70158){return t*((r=r/g-1)*r*((C+1)*r+C)+1)+l}easeInOutBack(r,l,t,g,C=1.70158){return(r/=g/2)<1?t/2*(r*r*(((C*=1.525)+1)*r-C))+l:t/2*((r-=2)*r*(((C*=1.525)+1)*r+C)+2)+l}easeInBounce(r,l,t,g){return t-this.easeOutBounce(g-r,0,t,g)+l}easeOutBounce(r,l,t,g){return(r/=g)<1/2.75?t*(7.5625*r*r)+l:r<2/2.75?t*(7.5625*(r-=1.5/2.75)*r+.75)+l:r<2.5/2.75?t*(7.5625*(r-=2.25/2.75)*r+.9375)+l:t*(7.5625*(r-=2.625/2.75)*r+.984375)+l}easeInOutBounce(r,l,t,g){return r<g/2?this.easeInBounce(r*2,0,t,g)*.5+l:this.easeOutBounce(r*2-g,0,t,g)*.5+t*.5+l}};o.\u0275fac=function(l){return new(l||o)},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})(),uy=(()=>{let o=class o{constructor(r,l,t,g){this.service=r,this.easing=l,this.defaults=t,this.ngZone=g,this.currentLinecap="",this.current=0,this.max=0,this.radius=this.defaults.radius,this.animation=this.defaults.animation,this.animationDelay=this.defaults.animationDelay,this.duration=this.defaults.duration,this.stroke=this.defaults.stroke,this.color=this.defaults.color,this.background=this.defaults.background,this.responsive=this.defaults.responsive,this.clockwise=this.defaults.clockwise,this.semicircle=this.defaults.semicircle,this.rounded=this.defaults.rounded,this.onRender=new ln,this.lastAnimationId=0}_animateChange(r,l){typeof r!="number"&&(r=0),l=this._clamp(l),r=this._clamp(r);let t=this,g=l-r,C=t.duration;t.ngZone.runOutsideAngular(()=>{let I=()=>{let O=t.service.getTimestamp(),z=++t.lastAnimationId;requestAnimationFrame(function q(){let ie=Math.min(t.service.getTimestamp()-O,C),de=t.easing[t.animation],xe=de(ie,r,g,C);t._updatePath(xe),t.onRender.observers.length>0&&t.onRender.emit(xe),z===t.lastAnimationId&&ie<C&&requestAnimationFrame(q)})};this.animationDelay>0?setTimeout(I,this.animationDelay):I()})}_updatePath(r){if(this.path){let l=this.service.getArc(r,this.max,this.radius-this.stroke/2,this.radius,this.semicircle),t=this.path.nativeElement,g=this.rounded&&r>0?"round":"";g!==this.currentLinecap&&(this.currentLinecap=g,t.style.strokeLinecap=g),t.setAttribute("d",l)}}_clamp(r){return Math.max(0,Math.min(r||0,this.max))}getPathTransform(){let r=this._getDiameter();return this.semicircle?this.clockwise?`translate(0, ${r}) rotate(-90)`:`translate(${r+","+r}) rotate(90) scale(-1, 1)`:this.clockwise?null:`scale(-1, 1) translate(-${r} 0)`}resolveColor(r){return this.service.resolveColor(r)}ngOnChanges(r){r.current?this._animateChange(r.current.previousValue,r.current.currentValue):this._updatePath(this.current)}_getDiameter(){return this.radius*2}_getElementHeight(){return this.responsive?null:(this.semicircle?this.radius:this._getDiameter())+"px"}_getViewBox(){let r=this._getDiameter();return`0 0 ${r} ${this.semicircle?this.radius:r}`}_getPaddingBottom(){return this.responsive?this.semicircle?"50%":"100%":null}};o.\u0275fac=function(l){return new(l||o)(fe($4),fe(Z4),fe(rD),fe(Bi))},o.\u0275cmp=ft({type:o,selectors:[["round-progress"]],viewQuery:function(l,t){if(l&1&&yi(G4,5),l&2){let g;_i(g=bi())&&(t.path=g.first)}},hostAttrs:["role","progressbar"],hostVars:11,hostBindings:function(l,t){l&2&&(wn("aria-valuemin",0)("aria-valuemax",t.max)("aria-valuenow",t.current),Ja("width",t.responsive?"":t._getDiameter()+"px")("height",t._getElementHeight())("padding-bottom",t._getPaddingBottom()),ki("responsive",t.responsive))},inputs:{current:"current",max:"max",radius:"radius",animation:"animation",animationDelay:"animationDelay",duration:"duration",stroke:"stroke",color:"color",background:"background",responsive:"responsive",clockwise:"clockwise",semicircle:"semicircle",rounded:"rounded"},outputs:{onRender:"onRender"},standalone:!0,features:[Do,Qn],decls:4,vars:13,consts:[["path",""],["xmlns","http://www.w3.org/2000/svg"],["fill","none"]],template:function(l,t){l&1&&(Sd(),V(0,"svg",1),ke(1,"circle",2)(2,"path",2,0),j()),l&2&&(wn("viewBox",t._getViewBox()),ue(),Ja("stroke",t.resolveColor(t.background))("stroke-width",t.stroke),wn("cx",t.radius)("cy",t.radius)("r",t.radius-t.stroke/2),ue(),Ja("stroke-width",t.stroke)("stroke",t.resolveColor(t.color)),wn("transform",t.getPathTransform()))},styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden}.responsive[_nghost-%COMP%]{width:100%;padding-bottom:100%}.responsive[_nghost-%COMP%] > svg[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0}"],changeDetection:0});let d=o;return d})(),oD=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({providers:[Y4]});let d=o;return d})();var sD=d=>({color:d}),lD=(()=>{let o=class o{constructor(r,l,t,g){this.http=r,this.router=l,this.razorpayService=t,this.jobDetailsService=g,this.apiUrl=Cn,this.enteredValue=0,this.maxValue=5,this.minTarget=0,this.min=80,this.divColor="black",this.providerRating=0,this.creditBalance=50,this.isDrawerOpen=!1,this.current=0,this.max=5,this.radius=150,this.semicircle=!0,this.color="black",this.background="#eaeaea",this.cancelRate=0,this.workingHours=0,this.credits=0,this.colorChange(),this.getTarget(),this.getCredits(),this.getProviderRating(),this.getData()}getCredits(){this.razorpayService.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits},error:r=>{console.log(r)}})}getProviderRating(){this.jobDetailsService.getRating().subscribe({next:r=>{console.log(r),this.providerRating=parseInt(r.averageRating)},error:r=>{console.log(r)}})}colorChange(){this.minTarget<this.min&&(this.divColor="red")}calculateProgress(r,l){let t=r+5;return l===0?0:t/l*100}toggleDrawer(){this.isDrawerOpen=!this.isDrawerOpen,this.router.navigate(["menu"])}increment(r=1){this.current+=r}getOverlayStyle(){let r=this.semicircle,l=(r?"":"translateY(-50%) ")+"translateX(-50%)";return{top:r?"auto":"50%",bottom:r?"5%":"auto",left:"50%",transform:l,"font-size":this.radius/3.5+"px"}}getTarget(){let r=localStorage.getItem("providerId"),l=`${this.apiUrl}providers/service-provider-targets/${r}`;this.http.get(l).subscribe(t=>{console.log(t),this.current=t.specialRating,this.minTarget=t.responseRate,this.cancelRate=t.cancellationRate,this.workingHours=t.totalWorkingHours},t=>{console.log(t)})}getData(){let l=["6701477d6cdbd8a62eb1bafd","6701477d6cdbd8a62eb1bb0","6701477d6cdbd8a62eb1bb03"].map(t=>this.http.get(`${this.apiUrl}admin/admin-provider-promotions/${t}`).pipe(Jl(g=>(console.error(`Error fetching data for ID ${t}:`,g),tr(null)))));kg(l).subscribe(t=>{let g=t.filter(C=>C!==null);console.log(g)})}navTo(r){switch(r){case"credit":this.router.navigate(["credits"]);break;case"notification":this.router.navigate(["notification"]);break;case"buyNow":this.router.navigate(["addCredit"])}}navToDetails(){this.router.navigate(["credits"])}};o.\u0275fac=function(l){return new(l||o)(fe(Gi),fe(Bt),fe(zo),fe(Ar))},o.\u0275cmp=ft({type:o,selectors:[["app-target"]],decls:70,vars:21,consts:[[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined","notranslate"],[1,"sub-container"],[1,"container-target"],[1,"progress-wrapper"],[1,"current",3,"ngStyle"],[3,"current","max","color","background","radius","semicircle","rounded","stroke"],[1,"progress-content"],[1,"fa","fa-star"],[1,"section-div"],[1,"section"],[1,"info"],[1,"sub-info"],[1,"material-symbols-outlined","notranslate",3,"ngStyle"],[2,"font-size","1.4rem",3,"ngStyle"],[1,"material-symbols-outlined","notranslate",2,"color","red","font-size","28px"],[1,"credit-balance-div"],[3,"click"],[2,"height","10rem"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1),Oe("click",function(){return t.toggleDrawer()}),$(2,"\u2630"),j(),V(3,"div",2)(4,"div",3),Oe("click",function(){return t.navTo("credit")}),ke(5,"img",4),V(6,"pre"),$(7),j()(),V(8,"div",5),Oe("click",function(){return t.navTo("notification")}),V(9,"span",6),$(10,"notifications"),j()()(),V(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10),$(15),j(),ke(16,"round-progress",11),V(17,"div",12),ke(18,"br"),V(19,"div"),ke(20,"span",13),V(21,"span"),$(22,"Min : 4.7"),j()()()()(),V(23,"div",14)(24,"div",15)(25,"span",6),$(26,"schedule"),j(),ke(27,"br")(28,"br"),V(29,"span",16),$(30),j(),ke(31,"br"),V(32,"span",17),$(33,"Weekend hours"),j()(),V(34,"div",15)(35,"span",18),$(36,"draft"),j(),$(37," \xA0"),V(38,"span",19),$(39,"Min:80%"),j(),ke(40,"br")(41,"br"),V(42,"span",16),$(43),j(),ke(44,"br"),V(45,"span",17),$(46,"Response rate"),j()(),V(47,"div",15)(48,"span",20),$(49,"privacy_tip"),j(),ke(50,"br")(51,"br"),V(52,"span",16),$(53),j(),ke(54,"br"),V(55,"span",17),$(56,"Cancellation"),j()()(),ke(57,"br"),V(58,"div",21)(59,"span",17),$(60),j(),ke(61,"br")(62,"br"),V(63,"div")(64,"button",22),Oe("click",function(){return t.navTo("buyNow")}),$(65,"Buy now"),j(),V(66,"button",22),Oe("click",function(){return t.navToDetails()}),$(67,"See details"),j()()()()(),ke(68,"div",23)(69,"app-fotter")),l&2&&(ue(7),Ft(t.credits),ue(7),Fe("ngStyle",t.getOverlayStyle()),ue(),Ii("",t.providerRating,"%"),ue(),Fe("current",t.providerRating)("max",t.max)("color",t.color)("background",t.background)("radius",t.radius)("semicircle",t.semicircle)("rounded",!0)("stroke",20),ue(14),Ii("",t.workingHours," HRS"),ue(5),Fe("ngStyle",di(17,sD,t.divColor)),ue(3),Fe("ngStyle",di(19,sD,t.divColor)),ue(5),Ii("",t.minTarget,"%"),ue(10),Ft(t.cancelRate),ue(7),Ii("Credit Balance ",t.credits,""))},dependencies:[Db,uy,ul],styles:['.left-half-spinner-container[_ngcontent-%COMP%]{position:relative;width:100px;height:100px;overflow:hidden;transform:rotate(90deg)}.left-half-spinner-container[_ngcontent-%COMP%]   .mat-progress-spinner[_ngcontent-%COMP%]{width:100px;height:100px}.left-half-spinner-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;right:0;width:50%;height:100%;background:#fff;z-index:1}.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%;margin-bottom:5rem}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#000;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:9rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:6rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border:1px solid black;width:2.3rem;border-radius:.4rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh}.section-div[_ngcontent-%COMP%]{display:grid;grid-template-columns:45% 45%;column-gap:2%;width:100%;height:max-content;justify-content:space-around}.section[_ngcontent-%COMP%]{border:.25px solid black;border-radius:.4rem;height:7rem;margin-top:2rem;padding:2rem 1rem 1rem;text-align:left}.info[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:600;line-height:19.36px}.sub-info[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:16.94px}.credit-balance-div[_ngcontent-%COMP%]{width:88%;height:5.5rem;border:.25px solid black;text-align:left;padding:1rem;padding-left:6%;border-radius:.8rem}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:max-content;height:2rem;display:flex;align-items:center;justify-content:center;font-family:"Inter" sans-serif;font-size:14px;font-weight:500;line-height:16.94px;border-radius:.5rem}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#3cc04b;color:#fff;border:none}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:transparent;border:.25 solid black}.credit-balance-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%;display:grid;grid-template-columns:auto auto;column-gap:1rem}cf[_ngcontent-%COMP%]:before, .cf[_ngcontent-%COMP%]:after{content:" ";display:table}.cf[_ngcontent-%COMP%]:after{clear:both}.progress-wrapper[_ngcontent-%COMP%]{position:relative;margin:20px auto;font-size:40px}.current[_ngcontent-%COMP%]{position:absolute;color:#bbb;font-weight:100;line-height:1}round-progress[_ngcontent-%COMP%]{margin:auto}.container-target[_ngcontent-%COMP%]{width:100%;margin:40px auto 80px;text-align:center;padding-bottom:40px;background:#fff;border:solid 1px #ccc;border-radius:4px}button[_ngcontent-%COMP%]{display:inline-block;padding:10px 20px;background:#45ccce;color:#fff;font-size:16px;border:none;cursor:pointer;border-radius:4px;text-align:center;margin:0 5px 5px 0}button[_ngcontent-%COMP%]:nth-child(2){color:#000;border:.25px solid black;border-radius:4px;display:inline-block;text-align:center}form[_ngcontent-%COMP%]{text-align:left;max-width:350px;margin:30px auto}form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:15px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{float:right;padding:5px;width:150px}input[type=checkbox][_ngcontent-%COMP%]{width:auto}input[type=color][_ngcontent-%COMP%]{height:30px}.back[_ngcontent-%COMP%]{position:fixed;top:5px;right:5px}.progress-container[_ngcontent-%COMP%]   round-progress[_ngcontent-%COMP%]{position:relative;z-index:1}.progress-content[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(-50%,-50%);text-align:center;font-size:1.1rem;font-weight:400;line-height:1.2;z-index:2}.progress-content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;top:.5rem;display:flex;flex-direction:column}@media (max-width: 650px){.back[_ngcontent-%COMP%]{position:static;display:block;text-align:center}h2[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]{margin-bottom:20px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;margin-top:5px;float:none}}']});let d=o;return d})();function Zg(d){return d+.5|0}var Ld=(d,o,c)=>Math.max(Math.min(d,c),o);function $g(d){return Ld(Zg(d*2.55),0,255)}function Fd(d){return Ld(Zg(d*255),0,255)}function sc(d){return Ld(Zg(d/2.55)/100,0,1)}function cD(d){return Ld(Zg(d*100),0,100)}var rs={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},wC=[..."0123456789ABCDEF"],X4=d=>wC[d&15],Q4=d=>wC[(d&240)>>4]+wC[d&15],my=d=>(d&240)>>4===(d&15),K4=d=>my(d.r)&&my(d.g)&&my(d.b)&&my(d.a);function J4(d){var o=d.length,c;return d[0]==="#"&&(o===4||o===5?c={r:255&rs[d[1]]*17,g:255&rs[d[2]]*17,b:255&rs[d[3]]*17,a:o===5?rs[d[4]]*17:255}:(o===7||o===9)&&(c={r:rs[d[1]]<<4|rs[d[2]],g:rs[d[3]]<<4|rs[d[4]],b:rs[d[5]]<<4|rs[d[6]],a:o===9?rs[d[7]]<<4|rs[d[8]]:255})),c}var eB=(d,o)=>d<255?o(d):"";function tB(d){var o=K4(d)?X4:Q4;return d?"#"+o(d.r)+o(d.g)+o(d.b)+eB(d.a,o):void 0}var iB=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function mD(d,o,c){let r=o*Math.min(c,1-c),l=(t,g=(t+d/30)%12)=>c-r*Math.max(Math.min(g-3,9-g,1),-1);return[l(0),l(8),l(4)]}function nB(d,o,c){let r=(l,t=(l+d/60)%6)=>c-c*o*Math.max(Math.min(t,4-t,1),0);return[r(5),r(3),r(1)]}function rB(d,o,c){let r=mD(d,1,.5),l;for(o+c>1&&(l=1/(o+c),o*=l,c*=l),l=0;l<3;l++)r[l]*=1-o-c,r[l]+=o;return r}function oB(d,o,c,r,l){return d===l?(o-c)/r+(o<c?6:0):o===l?(c-d)/r+2:(d-o)/r+4}function CC(d){let c=d.r/255,r=d.g/255,l=d.b/255,t=Math.max(c,r,l),g=Math.min(c,r,l),C=(t+g)/2,I,O,z;return t!==g&&(z=t-g,O=C>.5?z/(2-t-g):z/(t+g),I=oB(c,r,l,z,t),I=I*60+.5),[I|0,O||0,C]}function SC(d,o,c,r){return(Array.isArray(o)?d(o[0],o[1],o[2]):d(o,c,r)).map(Fd)}function MC(d,o,c){return SC(mD,d,o,c)}function aB(d,o,c){return SC(rB,d,o,c)}function sB(d,o,c){return SC(nB,d,o,c)}function pD(d){return(d%360+360)%360}function lB(d){let o=iB.exec(d),c=255,r;if(!o)return;o[5]!==r&&(c=o[6]?$g(+o[5]):Fd(+o[5]));let l=pD(+o[2]),t=+o[3]/100,g=+o[4]/100;return o[1]==="hwb"?r=aB(l,t,g):o[1]==="hsv"?r=sB(l,t,g):r=MC(l,t,g),{r:r[0],g:r[1],b:r[2],a:c}}function cB(d,o){var c=CC(d);c[0]=pD(c[0]+o),c=MC(c),d.r=c[0],d.g=c[1],d.b=c[2]}function dB(d){if(!d)return;let o=CC(d),c=o[0],r=cD(o[1]),l=cD(o[2]);return d.a<255?`hsla(${c}, ${r}%, ${l}%, ${sc(d.a)})`:`hsl(${c}, ${r}%, ${l}%)`}var dD={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},hD={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function hB(){let d={},o=Object.keys(hD),c=Object.keys(dD),r,l,t,g,C;for(r=0;r<o.length;r++){for(g=C=o[r],l=0;l<c.length;l++)t=c[l],C=C.replace(t,dD[t]);t=parseInt(hD[g],16),d[C]=[t>>16&255,t>>8&255,t&255]}return d}var py;function uB(d){py||(py=hB(),py.transparent=[0,0,0,0]);let o=py[d.toLowerCase()];return o&&{r:o[0],g:o[1],b:o[2],a:o.length===4?o[3]:255}}var mB=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function pB(d){let o=mB.exec(d),c=255,r,l,t;if(o){if(o[7]!==r){let g=+o[7];c=o[8]?$g(g):Ld(g*255,0,255)}return r=+o[1],l=+o[3],t=+o[5],r=255&(o[2]?$g(r):Ld(r,0,255)),l=255&(o[4]?$g(l):Ld(l,0,255)),t=255&(o[6]?$g(t):Ld(t,0,255)),{r,g:l,b:t,a:c}}}function fB(d){return d&&(d.a<255?`rgba(${d.r}, ${d.g}, ${d.b}, ${sc(d.a)})`:`rgb(${d.r}, ${d.g}, ${d.b})`)}var xC=d=>d<=.0031308?d*12.92:Math.pow(d,1/2.4)*1.055-.055,cp=d=>d<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4);function gB(d,o,c){let r=cp(sc(d.r)),l=cp(sc(d.g)),t=cp(sc(d.b));return{r:Fd(xC(r+c*(cp(sc(o.r))-r))),g:Fd(xC(l+c*(cp(sc(o.g))-l))),b:Fd(xC(t+c*(cp(sc(o.b))-t))),a:d.a+c*(o.a-d.a)}}function fy(d,o,c){if(d){let r=CC(d);r[o]=Math.max(0,Math.min(r[o]+r[o]*c,o===0?360:1)),r=MC(r),d.r=r[0],d.g=r[1],d.b=r[2]}}function fD(d,o){return d&&Object.assign(o||{},d)}function uD(d){var o={r:0,g:0,b:0,a:255};return Array.isArray(d)?d.length>=3&&(o={r:d[0],g:d[1],b:d[2],a:255},d.length>3&&(o.a=Fd(d[3]))):(o=fD(d,{r:0,g:0,b:0,a:1}),o.a=Fd(o.a)),o}function _B(d){return d.charAt(0)==="r"?pB(d):lB(d)}var Yg=class d{constructor(o){if(o instanceof d)return o;let c=typeof o,r;c==="object"?r=uD(o):c==="string"&&(r=J4(o)||uB(o)||_B(o)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var o=fD(this._rgb);return o&&(o.a=sc(o.a)),o}set rgb(o){this._rgb=uD(o)}rgbString(){return this._valid?fB(this._rgb):void 0}hexString(){return this._valid?tB(this._rgb):void 0}hslString(){return this._valid?dB(this._rgb):void 0}mix(o,c){if(o){let r=this.rgb,l=o.rgb,t,g=c===t?.5:c,C=2*g-1,I=r.a-l.a,O=((C*I===-1?C:(C+I)/(1+C*I))+1)/2;t=1-O,r.r=255&O*r.r+t*l.r+.5,r.g=255&O*r.g+t*l.g+.5,r.b=255&O*r.b+t*l.b+.5,r.a=g*r.a+(1-g)*l.a,this.rgb=r}return this}interpolate(o,c){return o&&(this._rgb=gB(this._rgb,o._rgb,c)),this}clone(){return new d(this.rgb)}alpha(o){return this._rgb.a=Fd(o),this}clearer(o){let c=this._rgb;return c.a*=1-o,this}greyscale(){let o=this._rgb,c=Zg(o.r*.3+o.g*.59+o.b*.11);return o.r=o.g=o.b=c,this}opaquer(o){let c=this._rgb;return c.a*=1+o,this}negate(){let o=this._rgb;return o.r=255-o.r,o.g=255-o.g,o.b=255-o.b,this}lighten(o){return fy(this._rgb,2,o),this}darken(o){return fy(this._rgb,2,-o),this}saturate(o){return fy(this._rgb,1,o),this}desaturate(o){return fy(this._rgb,1,-o),this}rotate(o){return cB(this._rgb,o),this}};function fl(){}var kD=(()=>{let d=0;return()=>d++})();function Sn(d){return d===null||typeof d>"u"}function ur(d){if(Array.isArray&&Array.isArray(d))return!0;let o=Object.prototype.toString.call(d);return o.slice(0,7)==="[object"&&o.slice(-6)==="Array]"}function un(d){return d!==null&&Object.prototype.toString.call(d)==="[object Object]"}function Ir(d){return(typeof d=="number"||d instanceof Number)&&isFinite(+d)}function ua(d,o){return Ir(d)?d:o}function Zi(d,o){return typeof d>"u"?o:d}var ID=(d,o)=>typeof d=="string"&&d.endsWith("%")?parseFloat(d)/100:+d/o,EC=(d,o)=>typeof d=="string"&&d.endsWith("%")?parseFloat(d)/100*o:+d;function nr(d,o,c){if(d&&typeof d.call=="function")return d.apply(c,o)}function Hn(d,o,c,r){let l,t,g;if(ur(d))if(t=d.length,r)for(l=t-1;l>=0;l--)o.call(c,d[l],l);else for(l=0;l<t;l++)o.call(c,d[l],l);else if(un(d))for(g=Object.keys(d),t=g.length,l=0;l<t;l++)o.call(c,d[g[l]],g[l])}function Kg(d,o){let c,r,l,t;if(!d||!o||d.length!==o.length)return!1;for(c=0,r=d.length;c<r;++c)if(l=d[c],t=o[c],l.datasetIndex!==t.datasetIndex||l.index!==t.index)return!1;return!0}function yy(d){if(ur(d))return d.map(yy);if(un(d)){let o=Object.create(null),c=Object.keys(d),r=c.length,l=0;for(;l<r;++l)o[c[l]]=yy(d[c[l]]);return o}return d}function TD(d){return["__proto__","prototype","constructor"].indexOf(d)===-1}function bB(d,o,c,r){if(!TD(d))return;let l=o[d],t=c[d];un(l)&&un(t)?hp(l,t,r):o[d]=yy(t)}function hp(d,o,c){let r=ur(o)?o:[o],l=r.length;if(!un(d))return d;c=c||{};let t=c.merger||bB,g;for(let C=0;C<l;++C){if(g=r[C],!un(g))continue;let I=Object.keys(g);for(let O=0,z=I.length;O<z;++O)t(I[O],d,g,c)}return d}function mp(d,o){return hp(d,o,{merger:yB})}function yB(d,o,c){if(!TD(d))return;let r=o[d],l=c[d];un(r)&&un(l)?mp(r,l):Object.prototype.hasOwnProperty.call(o,d)||(o[d]=yy(l))}var gD={"":d=>d,x:d=>d.x,y:d=>d.y};function vB(d){let o=d.split("."),c=[],r="";for(let l of o)r+=l,r.endsWith("\\")?r=r.slice(0,-1)+".":(c.push(r),r="");return c}function xB(d){let o=vB(d);return c=>{for(let r of o){if(r==="")break;c=c&&c[r]}return c}}function dc(d,o){return(gD[o]||(gD[o]=xB(o)))(d)}function Cy(d){return d.charAt(0).toUpperCase()+d.slice(1)}var pp=d=>typeof d<"u",lc=d=>typeof d=="function",DC=(d,o)=>{if(d.size!==o.size)return!1;for(let c of d)if(!o.has(c))return!1;return!0};function ED(d){return d.type==="mouseup"||d.type==="click"||d.type==="contextmenu"}var mr=Math.PI,pr=2*mr,wB=pr+mr,vy=Number.POSITIVE_INFINITY,CB=mr/180,Or=mr/2,du=mr/4,_D=mr*2/3,cc=Math.log10,zs=Math.sign;function fp(d,o,c){return Math.abs(d-o)<c}function AC(d){let o=Math.round(d);d=fp(d,o,d/1e3)?o:d;let c=Math.pow(10,Math.floor(cc(d))),r=d/c;return(r<=1?1:r<=2?2:r<=5?5:10)*c}function DD(d){let o=[],c=Math.sqrt(d),r;for(r=1;r<c;r++)d%r===0&&(o.push(r),o.push(d/r));return c===(c|0)&&o.push(c),o.sort((l,t)=>l-t).pop(),o}function mu(d){return!isNaN(parseFloat(d))&&isFinite(d)}function AD(d,o){let c=Math.round(d);return c-o<=d&&c+o>=d}function PC(d,o,c){let r,l,t;for(r=0,l=d.length;r<l;r++)t=d[r][c],isNaN(t)||(o.min=Math.min(o.min,t),o.max=Math.max(o.max,t))}function os(d){return d*(mr/180)}function Sy(d){return d*(180/mr)}function OC(d){if(!Ir(d))return;let o=1,c=0;for(;Math.round(d*o)/o!==d;)o*=10,c++;return c}function RC(d,o){let c=o.x-d.x,r=o.y-d.y,l=Math.sqrt(c*c+r*r),t=Math.atan2(r,c);return t<-.5*mr&&(t+=pr),{angle:t,distance:l}}function xy(d,o){return Math.sqrt(Math.pow(o.x-d.x,2)+Math.pow(o.y-d.y,2))}function SB(d,o){return(d-o+wB)%pr-mr}function ha(d){return(d%pr+pr)%pr}function gp(d,o,c,r){let l=ha(d),t=ha(o),g=ha(c),C=ha(t-l),I=ha(g-l),O=ha(l-t),z=ha(l-g);return l===t||l===g||r&&t===g||C>I&&O<z}function no(d,o,c){return Math.max(o,Math.min(c,d))}function PD(d){return no(d,-32768,32767)}function gl(d,o,c,r=1e-6){return d>=Math.min(o,c)-r&&d<=Math.max(o,c)+r}function My(d,o,c){c=c||(g=>d[g]<o);let r=d.length-1,l=0,t;for(;r-l>1;)t=l+r>>1,c(t)?l=t:r=t;return{lo:l,hi:r}}var ml=(d,o,c,r)=>My(d,c,r?l=>{let t=d[l][o];return t<c||t===c&&d[l+1][o]===c}:l=>d[l][o]<c),OD=(d,o,c)=>My(d,c,r=>d[r][o]>=c);function RD(d,o,c){let r=0,l=d.length;for(;r<l&&d[r]<o;)r++;for(;l>r&&d[l-1]>c;)l--;return r>0||l<d.length?d.slice(r,l):d}var LD=["push","pop","shift","splice","unshift"];function FD(d,o){if(d._chartjs){d._chartjs.listeners.push(o);return}Object.defineProperty(d,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[o]}}),LD.forEach(c=>{let r="_onData"+Cy(c),l=d[c];Object.defineProperty(d,c,{configurable:!0,enumerable:!1,value(...t){let g=l.apply(this,t);return d._chartjs.listeners.forEach(C=>{typeof C[r]=="function"&&C[r](...t)}),g}})})}function LC(d,o){let c=d._chartjs;if(!c)return;let r=c.listeners,l=r.indexOf(o);l!==-1&&r.splice(l,1),!(r.length>0)&&(LD.forEach(t=>{delete d[t]}),delete d._chartjs)}function FC(d){let o=new Set(d);return o.size===d.length?d:Array.from(o)}var zC=function(){return typeof window>"u"?function(d){return d()}:window.requestAnimationFrame}();function BC(d,o){let c=[],r=!1;return function(...l){c=l,r||(r=!0,zC.call(window,()=>{r=!1,d.apply(o,c)}))}}function zD(d,o){let c;return function(...r){return o?(clearTimeout(c),c=setTimeout(d,o,r)):d.apply(this,r),o}}var ky=d=>d==="start"?"left":d==="end"?"right":"center",wo=(d,o,c)=>d==="start"?o:d==="end"?c:(o+c)/2,BD=(d,o,c,r)=>d===(r?"left":"right")?c:d==="center"?(o+c)/2:o;function NC(d,o,c){let r=o.length,l=0,t=r;if(d._sorted){let{iScale:g,_parsed:C}=d,I=g.axis,{min:O,max:z,minDefined:q,maxDefined:ie}=g.getUserBounds();q&&(l=no(Math.min(ml(C,I,O).lo,c?r:ml(o,I,g.getPixelForValue(O)).lo),0,r-1)),ie?t=no(Math.max(ml(C,g.axis,z,!0).hi+1,c?0:ml(o,I,g.getPixelForValue(z),!0).hi+1),l,r)-l:t=r-l}return{start:l,count:t}}function VC(d){let{xScale:o,yScale:c,_scaleRanges:r}=d,l={xmin:o.min,xmax:o.max,ymin:c.min,ymax:c.max};if(!r)return d._scaleRanges=l,!0;let t=r.xmin!==o.min||r.xmax!==o.max||r.ymin!==c.min||r.ymax!==c.max;return Object.assign(r,l),t}var gy=d=>d===0||d===1,bD=(d,o,c)=>-(Math.pow(2,10*(d-=1))*Math.sin((d-o)*pr/c)),yD=(d,o,c)=>Math.pow(2,-10*d)*Math.sin((d-o)*pr/c)+1,dp={linear:d=>d,easeInQuad:d=>d*d,easeOutQuad:d=>-d*(d-2),easeInOutQuad:d=>(d/=.5)<1?.5*d*d:-.5*(--d*(d-2)-1),easeInCubic:d=>d*d*d,easeOutCubic:d=>(d-=1)*d*d+1,easeInOutCubic:d=>(d/=.5)<1?.5*d*d*d:.5*((d-=2)*d*d+2),easeInQuart:d=>d*d*d*d,easeOutQuart:d=>-((d-=1)*d*d*d-1),easeInOutQuart:d=>(d/=.5)<1?.5*d*d*d*d:-.5*((d-=2)*d*d*d-2),easeInQuint:d=>d*d*d*d*d,easeOutQuint:d=>(d-=1)*d*d*d*d+1,easeInOutQuint:d=>(d/=.5)<1?.5*d*d*d*d*d:.5*((d-=2)*d*d*d*d+2),easeInSine:d=>-Math.cos(d*Or)+1,easeOutSine:d=>Math.sin(d*Or),easeInOutSine:d=>-.5*(Math.cos(mr*d)-1),easeInExpo:d=>d===0?0:Math.pow(2,10*(d-1)),easeOutExpo:d=>d===1?1:-Math.pow(2,-10*d)+1,easeInOutExpo:d=>gy(d)?d:d<.5?.5*Math.pow(2,10*(d*2-1)):.5*(-Math.pow(2,-10*(d*2-1))+2),easeInCirc:d=>d>=1?d:-(Math.sqrt(1-d*d)-1),easeOutCirc:d=>Math.sqrt(1-(d-=1)*d),easeInOutCirc:d=>(d/=.5)<1?-.5*(Math.sqrt(1-d*d)-1):.5*(Math.sqrt(1-(d-=2)*d)+1),easeInElastic:d=>gy(d)?d:bD(d,.075,.3),easeOutElastic:d=>gy(d)?d:yD(d,.075,.3),easeInOutElastic(d){return gy(d)?d:d<.5?.5*bD(d*2,.1125,.45):.5+.5*yD(d*2-1,.1125,.45)},easeInBack(d){return d*d*((1.70158+1)*d-1.70158)},easeOutBack(d){return(d-=1)*d*((1.70158+1)*d+1.70158)+1},easeInOutBack(d){let o=1.70158;return(d/=.5)<1?.5*(d*d*(((o*=1.525)+1)*d-o)):.5*((d-=2)*d*(((o*=1.525)+1)*d+o)+2)},easeInBounce:d=>1-dp.easeOutBounce(1-d),easeOutBounce(d){return d<1/2.75?7.5625*d*d:d<2/2.75?7.5625*(d-=1.5/2.75)*d+.75:d<2.5/2.75?7.5625*(d-=2.25/2.75)*d+.9375:7.5625*(d-=2.625/2.75)*d+.984375},easeInOutBounce:d=>d<.5?dp.easeInBounce(d*2)*.5:dp.easeOutBounce(d*2-1)*.5+.5};function jC(d){if(d&&typeof d=="object"){let o=d.toString();return o==="[object CanvasPattern]"||o==="[object CanvasGradient]"}return!1}function UC(d){return jC(d)?d:new Yg(d)}function kC(d){return jC(d)?d:new Yg(d).saturate(.5).darken(.1).hexString()}var MB=["x","y","borderWidth","radius","tension"],kB=["color","borderColor","backgroundColor"];function IB(d){d.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),d.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:o=>o!=="onProgress"&&o!=="onComplete"&&o!=="fn"}),d.set("animations",{colors:{type:"color",properties:kB},numbers:{type:"number",properties:MB}}),d.describe("animations",{_fallback:"animation"}),d.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:o=>o|0}}}})}function TB(d){d.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}var vD=new Map;function EB(d,o){o=o||{};let c=d+JSON.stringify(o),r=vD.get(c);return r||(r=new Intl.NumberFormat(d,o),vD.set(c,r)),r}function _p(d,o,c){return EB(o,c).format(d)}var ND={values(d){return ur(d)?d:""+d},numeric(d,o,c){if(d===0)return"0";let r=this.chart.options.locale,l,t=d;if(c.length>1){let O=Math.max(Math.abs(c[0].value),Math.abs(c[c.length-1].value));(O<1e-4||O>1e15)&&(l="scientific"),t=DB(d,c)}let g=cc(Math.abs(t)),C=isNaN(g)?1:Math.max(Math.min(-1*Math.floor(g),20),0),I={notation:l,minimumFractionDigits:C,maximumFractionDigits:C};return Object.assign(I,this.options.ticks.format),_p(d,r,I)},logarithmic(d,o,c){if(d===0)return"0";let r=c[o].significand||d/Math.pow(10,Math.floor(cc(d)));return[1,2,3,5,10,15].includes(r)||o>.8*c.length?ND.numeric.call(this,d,o,c):""}};function DB(d,o){let c=o.length>3?o[2].value-o[1].value:o[1].value-o[0].value;return Math.abs(c)>=1&&d!==Math.floor(d)&&(c=d-Math.floor(d)),c}var Jg={formatters:ND};function AB(d){d.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(o,c)=>c.lineWidth,tickColor:(o,c)=>c.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Jg.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),d.route("scale.ticks","color","","color"),d.route("scale.grid","color","","borderColor"),d.route("scale.border","color","","borderColor"),d.route("scale.title","color","","color"),d.describe("scale",{_fallback:!1,_scriptable:o=>!o.startsWith("before")&&!o.startsWith("after")&&o!=="callback"&&o!=="parser",_indexable:o=>o!=="borderDash"&&o!=="tickBorderDash"&&o!=="dash"}),d.describe("scales",{_fallback:"scale"}),d.describe("scale.ticks",{_scriptable:o=>o!=="backdropPadding"&&o!=="callback",_indexable:o=>o!=="backdropPadding"})}var Bd=Object.create(null),Iy=Object.create(null);function Xg(d,o){if(!o)return d;let c=o.split(".");for(let r=0,l=c.length;r<l;++r){let t=c[r];d=d[t]||(d[t]=Object.create(null))}return d}function IC(d,o,c){return typeof o=="string"?hp(Xg(d,o),c):hp(Xg(d,""),o)}var TC=class{constructor(o,c){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,l)=>kC(l.backgroundColor),this.hoverBorderColor=(r,l)=>kC(l.borderColor),this.hoverColor=(r,l)=>kC(l.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(o),this.apply(c)}set(o,c){return IC(this,o,c)}get(o){return Xg(this,o)}describe(o,c){return IC(Iy,o,c)}override(o,c){return IC(Bd,o,c)}route(o,c,r,l){let t=Xg(this,o),g=Xg(this,r),C="_"+c;Object.defineProperties(t,{[C]:{value:t[c],writable:!0},[c]:{enumerable:!0,get(){let I=this[C],O=g[l];return un(I)?Object.assign({},O,I):Zi(I,O)},set(I){this[C]=I}}})}apply(o){o.forEach(c=>c(this))}},Tr=new TC({_scriptable:d=>!d.startsWith("on"),_indexable:d=>d!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[IB,TB,AB]);function PB(d){return!d||Sn(d.size)||Sn(d.family)?null:(d.style?d.style+" ":"")+(d.weight?d.weight+" ":"")+d.size+"px "+d.family}function Qg(d,o,c,r,l){let t=o[l];return t||(t=o[l]=d.measureText(l).width,c.push(l)),t>r&&(r=t),r}function VD(d,o,c,r){r=r||{};let l=r.data=r.data||{},t=r.garbageCollect=r.garbageCollect||[];r.font!==o&&(l=r.data={},t=r.garbageCollect=[],r.font=o),d.save(),d.font=o;let g=0,C=c.length,I,O,z,q,ie;for(I=0;I<C;I++)if(q=c[I],q!=null&&!ur(q))g=Qg(d,l,t,g,q);else if(ur(q))for(O=0,z=q.length;O<z;O++)ie=q[O],ie!=null&&!ur(ie)&&(g=Qg(d,l,t,g,ie));d.restore();let de=t.length/2;if(de>c.length){for(I=0;I<de;I++)delete l[t[I]];t.splice(0,de)}return g}function Nd(d,o,c){let r=d.currentDevicePixelRatio,l=c!==0?Math.max(c/2,.5):0;return Math.round((o-l)*r)/r+l}function WC(d,o){!o&&!d||(o=o||d.getContext("2d"),o.save(),o.resetTransform(),o.clearRect(0,0,d.width,d.height),o.restore())}function Ty(d,o,c,r){HC(d,o,c,r,null)}function HC(d,o,c,r,l){let t,g,C,I,O,z,q,ie,de=o.pointStyle,xe=o.rotation,Ie=o.radius,Me=(xe||0)*CB;if(de&&typeof de=="object"&&(t=de.toString(),t==="[object HTMLImageElement]"||t==="[object HTMLCanvasElement]")){d.save(),d.translate(c,r),d.rotate(Me),d.drawImage(de,-de.width/2,-de.height/2,de.width,de.height),d.restore();return}if(!(isNaN(Ie)||Ie<=0)){switch(d.beginPath(),de){default:l?d.ellipse(c,r,l/2,Ie,0,0,pr):d.arc(c,r,Ie,0,pr),d.closePath();break;case"triangle":z=l?l/2:Ie,d.moveTo(c+Math.sin(Me)*z,r-Math.cos(Me)*Ie),Me+=_D,d.lineTo(c+Math.sin(Me)*z,r-Math.cos(Me)*Ie),Me+=_D,d.lineTo(c+Math.sin(Me)*z,r-Math.cos(Me)*Ie),d.closePath();break;case"rectRounded":O=Ie*.516,I=Ie-O,g=Math.cos(Me+du)*I,q=Math.cos(Me+du)*(l?l/2-O:I),C=Math.sin(Me+du)*I,ie=Math.sin(Me+du)*(l?l/2-O:I),d.arc(c-q,r-C,O,Me-mr,Me-Or),d.arc(c+ie,r-g,O,Me-Or,Me),d.arc(c+q,r+C,O,Me,Me+Or),d.arc(c-ie,r+g,O,Me+Or,Me+mr),d.closePath();break;case"rect":if(!xe){I=Math.SQRT1_2*Ie,z=l?l/2:I,d.rect(c-z,r-I,2*z,2*I);break}Me+=du;case"rectRot":q=Math.cos(Me)*(l?l/2:Ie),g=Math.cos(Me)*Ie,C=Math.sin(Me)*Ie,ie=Math.sin(Me)*(l?l/2:Ie),d.moveTo(c-q,r-C),d.lineTo(c+ie,r-g),d.lineTo(c+q,r+C),d.lineTo(c-ie,r+g),d.closePath();break;case"crossRot":Me+=du;case"cross":q=Math.cos(Me)*(l?l/2:Ie),g=Math.cos(Me)*Ie,C=Math.sin(Me)*Ie,ie=Math.sin(Me)*(l?l/2:Ie),d.moveTo(c-q,r-C),d.lineTo(c+q,r+C),d.moveTo(c+ie,r-g),d.lineTo(c-ie,r+g);break;case"star":q=Math.cos(Me)*(l?l/2:Ie),g=Math.cos(Me)*Ie,C=Math.sin(Me)*Ie,ie=Math.sin(Me)*(l?l/2:Ie),d.moveTo(c-q,r-C),d.lineTo(c+q,r+C),d.moveTo(c+ie,r-g),d.lineTo(c-ie,r+g),Me+=du,q=Math.cos(Me)*(l?l/2:Ie),g=Math.cos(Me)*Ie,C=Math.sin(Me)*Ie,ie=Math.sin(Me)*(l?l/2:Ie),d.moveTo(c-q,r-C),d.lineTo(c+q,r+C),d.moveTo(c+ie,r-g),d.lineTo(c-ie,r+g);break;case"line":g=l?l/2:Math.cos(Me)*Ie,C=Math.sin(Me)*Ie,d.moveTo(c-g,r-C),d.lineTo(c+g,r+C);break;case"dash":d.moveTo(c,r),d.lineTo(c+Math.cos(Me)*(l?l/2:Ie),r+Math.sin(Me)*Ie);break;case!1:d.closePath();break}d.fill(),o.borderWidth>0&&d.stroke()}}function pl(d,o,c){return c=c||.5,!o||d&&d.x>o.left-c&&d.x<o.right+c&&d.y>o.top-c&&d.y<o.bottom+c}function e_(d,o){d.save(),d.beginPath(),d.rect(o.left,o.top,o.right-o.left,o.bottom-o.top),d.clip()}function t_(d){d.restore()}function jD(d,o,c,r,l){if(!o)return d.lineTo(c.x,c.y);if(l==="middle"){let t=(o.x+c.x)/2;d.lineTo(t,o.y),d.lineTo(t,c.y)}else l==="after"!=!!r?d.lineTo(o.x,c.y):d.lineTo(c.x,o.y);d.lineTo(c.x,c.y)}function UD(d,o,c,r){if(!o)return d.lineTo(c.x,c.y);d.bezierCurveTo(r?o.cp1x:o.cp2x,r?o.cp1y:o.cp2y,r?c.cp2x:c.cp1x,r?c.cp2y:c.cp1y,c.x,c.y)}function OB(d,o){o.translation&&d.translate(o.translation[0],o.translation[1]),Sn(o.rotation)||d.rotate(o.rotation),o.color&&(d.fillStyle=o.color),o.textAlign&&(d.textAlign=o.textAlign),o.textBaseline&&(d.textBaseline=o.textBaseline)}function RB(d,o,c,r,l){if(l.strikethrough||l.underline){let t=d.measureText(r),g=o-t.actualBoundingBoxLeft,C=o+t.actualBoundingBoxRight,I=c-t.actualBoundingBoxAscent,O=c+t.actualBoundingBoxDescent,z=l.strikethrough?(I+O)/2:O;d.strokeStyle=d.fillStyle,d.beginPath(),d.lineWidth=l.decorationWidth||2,d.moveTo(g,z),d.lineTo(C,z),d.stroke()}}function LB(d,o){let c=d.fillStyle;d.fillStyle=o.color,d.fillRect(o.left,o.top,o.width,o.height),d.fillStyle=c}function Vd(d,o,c,r,l,t={}){let g=ur(o)?o:[o],C=t.strokeWidth>0&&t.strokeColor!=="",I,O;for(d.save(),d.font=l.string,OB(d,t),I=0;I<g.length;++I)O=g[I],t.backdrop&&LB(d,t.backdrop),C&&(t.strokeColor&&(d.strokeStyle=t.strokeColor),Sn(t.strokeWidth)||(d.lineWidth=t.strokeWidth),d.strokeText(O,c,r,t.maxWidth)),d.fillText(O,c,r,t.maxWidth),RB(d,c,r,O,t),r+=Number(l.lineHeight);d.restore()}function bp(d,o){let{x:c,y:r,w:l,h:t,radius:g}=o;d.arc(c+g.topLeft,r+g.topLeft,g.topLeft,1.5*mr,mr,!0),d.lineTo(c,r+t-g.bottomLeft),d.arc(c+g.bottomLeft,r+t-g.bottomLeft,g.bottomLeft,mr,Or,!0),d.lineTo(c+l-g.bottomRight,r+t),d.arc(c+l-g.bottomRight,r+t-g.bottomRight,g.bottomRight,Or,0,!0),d.lineTo(c+l,r+g.topRight),d.arc(c+l-g.topRight,r+g.topRight,g.topRight,0,-Or,!0),d.lineTo(c+g.topLeft,r)}var FB=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,zB=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function BB(d,o){let c=(""+d).match(FB);if(!c||c[1]==="normal")return o*1.2;switch(d=+c[2],c[3]){case"px":return d;case"%":d/=100;break}return o*d}var NB=d=>+d||0;function Ey(d,o){let c={},r=un(o),l=r?Object.keys(o):o,t=un(d)?r?g=>Zi(d[g],d[o[g]]):g=>d[g]:()=>d;for(let g of l)c[g]=NB(t(g));return c}function GC(d){return Ey(d,{top:"y",right:"x",bottom:"y",left:"x"})}function jd(d){return Ey(d,["topLeft","topRight","bottomLeft","bottomRight"])}function Co(d){let o=GC(d);return o.width=o.left+o.right,o.height=o.top+o.bottom,o}function Yr(d,o){d=d||{},o=o||Tr.font;let c=Zi(d.size,o.size);typeof c=="string"&&(c=parseInt(c,10));let r=Zi(d.style,o.style);r&&!(""+r).match(zB)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);let l={family:Zi(d.family,o.family),lineHeight:BB(Zi(d.lineHeight,o.lineHeight),c),size:c,style:r,weight:Zi(d.weight,o.weight),string:""};return l.string=PB(l),l}function yp(d,o,c,r){let l=!0,t,g,C;for(t=0,g=d.length;t<g;++t)if(C=d[t],C!==void 0&&(o!==void 0&&typeof C=="function"&&(C=C(o),l=!1),c!==void 0&&ur(C)&&(C=C[c%C.length],l=!1),C!==void 0))return r&&!l&&(r.cacheable=!1),C}function WD(d,o,c){let{min:r,max:l}=d,t=EC(o,(l-r)/2),g=(C,I)=>c&&C===0?0:C+I;return{min:g(r,-Math.abs(t)),max:g(l,t)}}function hc(d,o){return Object.assign(Object.create(d),o)}function Dy(d,o=[""],c,r,l=()=>d[0]){let t=c||d;typeof r>"u"&&(r=qD("_fallback",d));let g={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:d,_rootScopes:t,_fallback:r,_getTarget:l,override:C=>Dy([C,...d],o,t,r)};return new Proxy(g,{deleteProperty(C,I){return delete C[I],delete C._keys,delete d[0][I],!0},get(C,I){return HD(C,I,()=>$B(I,o,d,C))},getOwnPropertyDescriptor(C,I){return Reflect.getOwnPropertyDescriptor(C._scopes[0],I)},getPrototypeOf(){return Reflect.getPrototypeOf(d[0])},has(C,I){return wD(C).includes(I)},ownKeys(C){return wD(C)},set(C,I,O){let z=C._storage||(C._storage=l());return C[I]=z[I]=O,delete C._keys,!0}})}function uu(d,o,c,r){let l={_cacheable:!1,_proxy:d,_context:o,_subProxy:c,_stack:new Set,_descriptors:qC(d,r),setContext:t=>uu(d,t,c,r),override:t=>uu(d.override(t),o,c,r)};return new Proxy(l,{deleteProperty(t,g){return delete t[g],delete d[g],!0},get(t,g,C){return HD(t,g,()=>jB(t,g,C))},getOwnPropertyDescriptor(t,g){return t._descriptors.allKeys?Reflect.has(d,g)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(d,g)},getPrototypeOf(){return Reflect.getPrototypeOf(d)},has(t,g){return Reflect.has(d,g)},ownKeys(){return Reflect.ownKeys(d)},set(t,g,C){return d[g]=C,delete t[g],!0}})}function qC(d,o={scriptable:!0,indexable:!0}){let{_scriptable:c=o.scriptable,_indexable:r=o.indexable,_allKeys:l=o.allKeys}=d;return{allKeys:l,scriptable:c,indexable:r,isScriptable:lc(c)?c:()=>c,isIndexable:lc(r)?r:()=>r}}var VB=(d,o)=>d?d+Cy(o):o,$C=(d,o)=>un(o)&&d!=="adapters"&&(Object.getPrototypeOf(o)===null||o.constructor===Object);function HD(d,o,c){if(Object.prototype.hasOwnProperty.call(d,o)||o==="constructor")return d[o];let r=c();return d[o]=r,r}function jB(d,o,c){let{_proxy:r,_context:l,_subProxy:t,_descriptors:g}=d,C=r[o];return lc(C)&&g.isScriptable(o)&&(C=UB(o,C,d,c)),ur(C)&&C.length&&(C=WB(o,C,d,g.isIndexable)),$C(o,C)&&(C=uu(C,l,t&&t[o],g)),C}function UB(d,o,c,r){let{_proxy:l,_context:t,_subProxy:g,_stack:C}=c;if(C.has(d))throw new Error("Recursion detected: "+Array.from(C).join("->")+"->"+d);C.add(d);let I=o(t,g||r);return C.delete(d),$C(d,I)&&(I=YC(l._scopes,l,d,I)),I}function WB(d,o,c,r){let{_proxy:l,_context:t,_subProxy:g,_descriptors:C}=c;if(typeof t.index<"u"&&r(d))return o[t.index%o.length];if(un(o[0])){let I=o,O=l._scopes.filter(z=>z!==I);o=[];for(let z of I){let q=YC(O,l,d,z);o.push(uu(q,t,g&&g[d],C))}}return o}function GD(d,o,c){return lc(d)?d(o,c):d}var HB=(d,o)=>d===!0?o:typeof d=="string"?dc(o,d):void 0;function GB(d,o,c,r,l){for(let t of o){let g=HB(c,t);if(g){d.add(g);let C=GD(g._fallback,c,l);if(typeof C<"u"&&C!==c&&C!==r)return C}else if(g===!1&&typeof r<"u"&&c!==r)return null}return!1}function YC(d,o,c,r){let l=o._rootScopes,t=GD(o._fallback,c,r),g=[...d,...l],C=new Set;C.add(r);let I=xD(C,g,c,t||c,r);return I===null||typeof t<"u"&&t!==c&&(I=xD(C,g,t,I,r),I===null)?!1:Dy(Array.from(C),[""],l,t,()=>qB(o,c,r))}function xD(d,o,c,r,l){for(;c;)c=GB(d,o,c,r,l);return c}function qB(d,o,c){let r=d._getTarget();o in r||(r[o]={});let l=r[o];return ur(l)&&un(c)?c:l||{}}function $B(d,o,c,r){let l;for(let t of o)if(l=qD(VB(t,d),c),typeof l<"u")return $C(d,l)?YC(c,r,d,l):l}function qD(d,o){for(let c of o){if(!c)continue;let r=c[d];if(typeof r<"u")return r}}function wD(d){let o=d._keys;return o||(o=d._keys=YB(d._scopes)),o}function YB(d){let o=new Set;for(let c of d)for(let r of Object.keys(c).filter(l=>!l.startsWith("_")))o.add(r);return Array.from(o)}function ZC(d,o,c,r){let{iScale:l}=d,{key:t="r"}=this._parsing,g=new Array(r),C,I,O,z;for(C=0,I=r;C<I;++C)O=C+c,z=o[O],g[C]={r:l.parse(dc(z,t),O)};return g}var ZB=Number.EPSILON||1e-14,up=(d,o)=>o<d.length&&!d[o].skip&&d[o],$D=d=>d==="x"?"y":"x";function XB(d,o,c,r){let l=d.skip?o:d,t=o,g=c.skip?o:c,C=xy(t,l),I=xy(g,t),O=C/(C+I),z=I/(C+I);O=isNaN(O)?0:O,z=isNaN(z)?0:z;let q=r*O,ie=r*z;return{previous:{x:t.x-q*(g.x-l.x),y:t.y-q*(g.y-l.y)},next:{x:t.x+ie*(g.x-l.x),y:t.y+ie*(g.y-l.y)}}}function QB(d,o,c){let r=d.length,l,t,g,C,I,O=up(d,0);for(let z=0;z<r-1;++z)if(I=O,O=up(d,z+1),!(!I||!O)){if(fp(o[z],0,ZB)){c[z]=c[z+1]=0;continue}l=c[z]/o[z],t=c[z+1]/o[z],C=Math.pow(l,2)+Math.pow(t,2),!(C<=9)&&(g=3/Math.sqrt(C),c[z]=l*g*o[z],c[z+1]=t*g*o[z])}}function KB(d,o,c="x"){let r=$D(c),l=d.length,t,g,C,I=up(d,0);for(let O=0;O<l;++O){if(g=C,C=I,I=up(d,O+1),!C)continue;let z=C[c],q=C[r];g&&(t=(z-g[c])/3,C[`cp1${c}`]=z-t,C[`cp1${r}`]=q-t*o[O]),I&&(t=(I[c]-z)/3,C[`cp2${c}`]=z+t,C[`cp2${r}`]=q+t*o[O])}}function JB(d,o="x"){let c=$D(o),r=d.length,l=Array(r).fill(0),t=Array(r),g,C,I,O=up(d,0);for(g=0;g<r;++g)if(C=I,I=O,O=up(d,g+1),!!I){if(O){let z=O[o]-I[o];l[g]=z!==0?(O[c]-I[c])/z:0}t[g]=C?O?zs(l[g-1])!==zs(l[g])?0:(l[g-1]+l[g])/2:l[g-1]:l[g]}QB(d,l,t),KB(d,t,o)}function _y(d,o,c){return Math.max(Math.min(d,c),o)}function eN(d,o){let c,r,l,t,g,C=pl(d[0],o);for(c=0,r=d.length;c<r;++c)g=t,t=C,C=c<r-1&&pl(d[c+1],o),t&&(l=d[c],g&&(l.cp1x=_y(l.cp1x,o.left,o.right),l.cp1y=_y(l.cp1y,o.top,o.bottom)),C&&(l.cp2x=_y(l.cp2x,o.left,o.right),l.cp2y=_y(l.cp2y,o.top,o.bottom)))}function YD(d,o,c,r,l){let t,g,C,I;if(o.spanGaps&&(d=d.filter(O=>!O.skip)),o.cubicInterpolationMode==="monotone")JB(d,l);else{let O=r?d[d.length-1]:d[0];for(t=0,g=d.length;t<g;++t)C=d[t],I=XB(O,C,d[Math.min(t+1,g-(r?0:1))%g],o.tension),C.cp1x=I.previous.x,C.cp1y=I.previous.y,C.cp2x=I.next.x,C.cp2y=I.next.y,O=C}o.capBezierPoints&&eN(d,c)}function Ay(){return typeof window<"u"&&typeof document<"u"}function Py(d){let o=d.parentNode;return o&&o.toString()==="[object ShadowRoot]"&&(o=o.host),o}function wy(d,o,c){let r;return typeof d=="string"?(r=parseInt(d,10),d.indexOf("%")!==-1&&(r=r/100*o.parentNode[c])):r=d,r}var Oy=d=>d.ownerDocument.defaultView.getComputedStyle(d,null);function tN(d,o){return Oy(d).getPropertyValue(o)}var iN=["top","right","bottom","left"];function hu(d,o,c){let r={};c=c?"-"+c:"";for(let l=0;l<4;l++){let t=iN[l];r[t]=parseFloat(d[o+"-"+t+c])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}var nN=(d,o,c)=>(d>0||o>0)&&(!c||!c.shadowRoot);function rN(d,o){let c=d.touches,r=c&&c.length?c[0]:d,{offsetX:l,offsetY:t}=r,g=!1,C,I;if(nN(l,t,d.target))C=l,I=t;else{let O=o.getBoundingClientRect();C=r.clientX-O.left,I=r.clientY-O.top,g=!0}return{x:C,y:I,box:g}}function Ud(d,o){if("native"in d)return d;let{canvas:c,currentDevicePixelRatio:r}=o,l=Oy(c),t=l.boxSizing==="border-box",g=hu(l,"padding"),C=hu(l,"border","width"),{x:I,y:O,box:z}=rN(d,c),q=g.left+(z&&C.left),ie=g.top+(z&&C.top),{width:de,height:xe}=o;return t&&(de-=g.width+C.width,xe-=g.height+C.height),{x:Math.round((I-q)/de*c.width/r),y:Math.round((O-ie)/xe*c.height/r)}}function oN(d,o,c){let r,l;if(o===void 0||c===void 0){let t=d&&Py(d);if(!t)o=d.clientWidth,c=d.clientHeight;else{let g=t.getBoundingClientRect(),C=Oy(t),I=hu(C,"border","width"),O=hu(C,"padding");o=g.width-O.width-I.width,c=g.height-O.height-I.height,r=wy(C.maxWidth,t,"clientWidth"),l=wy(C.maxHeight,t,"clientHeight")}}return{width:o,height:c,maxWidth:r||vy,maxHeight:l||vy}}var by=d=>Math.round(d*10)/10;function ZD(d,o,c,r){let l=Oy(d),t=hu(l,"margin"),g=wy(l.maxWidth,d,"clientWidth")||vy,C=wy(l.maxHeight,d,"clientHeight")||vy,I=oN(d,o,c),{width:O,height:z}=I;if(l.boxSizing==="content-box"){let ie=hu(l,"border","width"),de=hu(l,"padding");O-=de.width+ie.width,z-=de.height+ie.height}return O=Math.max(0,O-t.width),z=Math.max(0,r?O/r:z-t.height),O=by(Math.min(O,g,I.maxWidth)),z=by(Math.min(z,C,I.maxHeight)),O&&!z&&(z=by(O/2)),(o!==void 0||c!==void 0)&&r&&I.height&&z>I.height&&(z=I.height,O=by(Math.floor(z*r))),{width:O,height:z}}function XC(d,o,c){let r=o||1,l=Math.floor(d.height*r),t=Math.floor(d.width*r);d.height=Math.floor(d.height),d.width=Math.floor(d.width);let g=d.canvas;return g.style&&(c||!g.style.height&&!g.style.width)&&(g.style.height=`${d.height}px`,g.style.width=`${d.width}px`),d.currentDevicePixelRatio!==r||g.height!==l||g.width!==t?(d.currentDevicePixelRatio=r,g.height=l,g.width=t,d.ctx.setTransform(r,0,0,r,0,0),!0):!1}var XD=function(){let d=!1;try{let o={get passive(){return d=!0,!1}};Ay()&&(window.addEventListener("test",null,o),window.removeEventListener("test",null,o))}catch{}return d}();function QC(d,o){let c=tN(d,o),r=c&&c.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function zd(d,o,c,r){return{x:d.x+c*(o.x-d.x),y:d.y+c*(o.y-d.y)}}function QD(d,o,c,r){return{x:d.x+c*(o.x-d.x),y:r==="middle"?c<.5?d.y:o.y:r==="after"?c<1?d.y:o.y:c>0?o.y:d.y}}function KD(d,o,c,r){let l={x:d.cp2x,y:d.cp2y},t={x:o.cp1x,y:o.cp1y},g=zd(d,l,c),C=zd(l,t,c),I=zd(t,o,c),O=zd(g,C,c),z=zd(C,I,c);return zd(O,z,c)}var aN=function(d,o){return{x(c){return d+d+o-c},setWidth(c){o=c},textAlign(c){return c==="center"?c:c==="right"?"left":"right"},xPlus(c,r){return c-r},leftForLtr(c,r){return c-r}}},sN=function(){return{x(d){return d},setWidth(d){},textAlign(d){return d},xPlus(d,o){return d+o},leftForLtr(d,o){return d}}};function pu(d,o,c){return d?aN(o,c):sN()}function KC(d,o){let c,r;(o==="ltr"||o==="rtl")&&(c=d.canvas.style,r=[c.getPropertyValue("direction"),c.getPropertyPriority("direction")],c.setProperty("direction",o,"important"),d.prevTextDirection=r)}function JC(d,o){o!==void 0&&(delete d.prevTextDirection,d.canvas.style.setProperty("direction",o[0],o[1]))}function JD(d){return d==="angle"?{between:gp,compare:SB,normalize:ha}:{between:gl,compare:(o,c)=>o-c,normalize:o=>o}}function CD({start:d,end:o,count:c,loop:r,style:l}){return{start:d%c,end:o%c,loop:r&&(o-d+1)%c===0,style:l}}function lN(d,o,c){let{property:r,start:l,end:t}=c,{between:g,normalize:C}=JD(r),I=o.length,{start:O,end:z,loop:q}=d,ie,de;if(q){for(O+=I,z+=I,ie=0,de=I;ie<de&&g(C(o[O%I][r]),l,t);++ie)O--,z--;O%=I,z%=I}return z<O&&(z+=I),{start:O,end:z,loop:q,style:d.style}}function e2(d,o,c){if(!c)return[d];let{property:r,start:l,end:t}=c,g=o.length,{compare:C,between:I,normalize:O}=JD(r),{start:z,end:q,loop:ie,style:de}=lN(d,o,c),xe=[],Ie=!1,Me=null,Ge,He,ht,Mt=()=>I(l,ht,Ge)&&C(l,ht)!==0,yt=()=>C(t,Ge)===0||I(t,ht,Ge),Tt=()=>Ie||Mt(),Wt=()=>!Ie||yt();for(let Ct=z,Yt=z;Ct<=q;++Ct)He=o[Ct%g],!He.skip&&(Ge=O(He[r]),Ge!==ht&&(Ie=I(Ge,l,t),Me===null&&Tt()&&(Me=C(Ge,l)===0?Ct:Yt),Me!==null&&Wt()&&(xe.push(CD({start:Me,end:Ct,loop:ie,count:g,style:de})),Me=null),Yt=Ct,ht=Ge));return Me!==null&&xe.push(CD({start:Me,end:q,loop:ie,count:g,style:de})),xe}function t2(d,o){let c=[],r=d.segments;for(let l=0;l<r.length;l++){let t=e2(r[l],d.points,o);t.length&&c.push(...t)}return c}function cN(d,o,c,r){let l=0,t=o-1;if(c&&!r)for(;l<o&&!d[l].skip;)l++;for(;l<o&&d[l].skip;)l++;for(l%=o,c&&(t+=l);t>l&&d[t%o].skip;)t--;return t%=o,{start:l,end:t}}function dN(d,o,c,r){let l=d.length,t=[],g=o,C=d[o],I;for(I=o+1;I<=c;++I){let O=d[I%l];O.skip||O.stop?C.skip||(r=!1,t.push({start:o%l,end:(I-1)%l,loop:r}),o=g=O.stop?I:null):(g=I,C.skip&&(o=I)),C=O}return g!==null&&t.push({start:o%l,end:g%l,loop:r}),t}function eA(d,o){let c=d.points,r=d.options.spanGaps,l=c.length;if(!l)return[];let t=!!d._loop,{start:g,end:C}=cN(c,l,t,r);if(r===!0)return SD(d,[{start:g,end:C,loop:t}],c,o);let I=C<g?C+l:C,O=!!d._fullLoop&&g===0&&C===l-1;return SD(d,dN(c,g,I,O),c,o)}function SD(d,o,c,r){return!r||!r.setContext||!c?o:hN(d,o,c,r)}function hN(d,o,c,r){let l=d._chart.getContext(),t=MD(d.options),{_datasetIndex:g,options:{spanGaps:C}}=d,I=c.length,O=[],z=t,q=o[0].start,ie=q;function de(xe,Ie,Me,Ge){let He=C?-1:1;if(xe!==Ie){for(xe+=I;c[xe%I].skip;)xe-=He;for(;c[Ie%I].skip;)Ie+=He;xe%I!==Ie%I&&(O.push({start:xe%I,end:Ie%I,loop:Me,style:Ge}),z=Ge,q=Ie%I)}}for(let xe of o){q=C?q:xe.start;let Ie=c[q%I],Me;for(ie=q+1;ie<=xe.end;ie++){let Ge=c[ie%I];Me=MD(r.setContext(hc(l,{type:"segment",p0:Ie,p1:Ge,p0DataIndex:(ie-1)%I,p1DataIndex:ie%I,datasetIndex:g}))),uN(Me,z)&&de(q,ie-1,xe.loop,z),Ie=Ge,z=Me}q<ie-1&&de(q,ie-1,xe.loop,z)}return O}function MD(d){return{backgroundColor:d.backgroundColor,borderCapStyle:d.borderCapStyle,borderDash:d.borderDash,borderDashOffset:d.borderDashOffset,borderJoinStyle:d.borderJoinStyle,borderWidth:d.borderWidth,borderColor:d.borderColor}}function uN(d,o){if(!o)return!1;let c=[],r=function(l,t){return jC(t)?(c.includes(t)||c.push(t),c.indexOf(t)):t};return JSON.stringify(d,r)!==JSON.stringify(o,r)}var h2=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(o,c,r,l){let t=c.listeners[l],g=c.duration;t.forEach(C=>C({chart:o,initial:c.initial,numSteps:g,currentStep:Math.min(r-c.start,g)}))}_refresh(){this._request||(this._running=!0,this._request=zC.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(o=Date.now()){let c=0;this._charts.forEach((r,l)=>{if(!r.running||!r.items.length)return;let t=r.items,g=t.length-1,C=!1,I;for(;g>=0;--g)I=t[g],I._active?(I._total>r.duration&&(r.duration=I._total),I.tick(o),C=!0):(t[g]=t[t.length-1],t.pop());C&&(l.draw(),this._notify(l,r,o,"progress")),t.length||(r.running=!1,this._notify(l,r,o,"complete"),r.initial=!1),c+=t.length}),this._lastDate=o,c===0&&(this._running=!1)}_getAnims(o){let c=this._charts,r=c.get(o);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},c.set(o,r)),r}listen(o,c,r){this._getAnims(o).listeners[c].push(r)}add(o,c){!c||!c.length||this._getAnims(o).items.push(...c)}has(o){return this._getAnims(o).items.length>0}start(o){let c=this._charts.get(o);c&&(c.running=!0,c.start=Date.now(),c.duration=c.items.reduce((r,l)=>Math.max(r,l._duration),0),this._refresh())}running(o){if(!this._running)return!1;let c=this._charts.get(o);return!(!c||!c.running||!c.items.length)}stop(o){let c=this._charts.get(o);if(!c||!c.items.length)return;let r=c.items,l=r.length-1;for(;l>=0;--l)r[l].cancel();c.items=[],this._notify(o,c,Date.now(),"complete")}remove(o){return this._charts.delete(o)}},uc=new h2,tA="transparent",mN={boolean(d,o,c){return c>.5?o:d},color(d,o,c){let r=UC(d||tA),l=r.valid&&UC(o||tA);return l&&l.valid?l.mix(r,c).hexString():o},number(d,o,c){return d+(o-d)*c}},u2=class{constructor(o,c,r,l){let t=c[r];l=yp([o.to,l,t,o.from]);let g=yp([o.from,t,l]);this._active=!0,this._fn=o.fn||mN[o.type||typeof g],this._easing=dp[o.easing]||dp.linear,this._start=Math.floor(Date.now()+(o.delay||0)),this._duration=this._total=Math.floor(o.duration),this._loop=!!o.loop,this._target=c,this._prop=r,this._from=g,this._to=l,this._promises=void 0}active(){return this._active}update(o,c,r){if(this._active){this._notify(!1);let l=this._target[this._prop],t=r-this._start,g=this._duration-t;this._start=r,this._duration=Math.floor(Math.max(g,o.duration)),this._total+=t,this._loop=!!o.loop,this._to=yp([o.to,c,l,o.from]),this._from=yp([o.from,l,c])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(o){let c=o-this._start,r=this._duration,l=this._prop,t=this._from,g=this._loop,C=this._to,I;if(this._active=t!==C&&(g||c<r),!this._active){this._target[l]=C,this._notify(!0);return}if(c<0){this._target[l]=t;return}I=c/r%2,I=g&&I>1?2-I:I,I=this._easing(Math.min(1,Math.max(0,I))),this._target[l]=this._fn(t,C,I)}wait(){let o=this._promises||(this._promises=[]);return new Promise((c,r)=>{o.push({res:c,rej:r})})}_notify(o){let c=o?"res":"rej",r=this._promises||[];for(let l=0;l<r.length;l++)r[l][c]()}},Wy=class{constructor(o,c){this._chart=o,this._properties=new Map,this.configure(c)}configure(o){if(!un(o))return;let c=Object.keys(Tr.animation),r=this._properties;Object.getOwnPropertyNames(o).forEach(l=>{let t=o[l];if(!un(t))return;let g={};for(let C of c)g[C]=t[C];(ur(t.properties)&&t.properties||[l]).forEach(C=>{(C===l||!r.has(C))&&r.set(C,g)})})}_animateOptions(o,c){let r=c.options,l=fN(o,r);if(!l)return[];let t=this._createAnimations(l,r);return r.$shared&&pN(o.options.$animations,r).then(()=>{o.options=r},()=>{}),t}_createAnimations(o,c){let r=this._properties,l=[],t=o.$animations||(o.$animations={}),g=Object.keys(c),C=Date.now(),I;for(I=g.length-1;I>=0;--I){let O=g[I];if(O.charAt(0)==="$")continue;if(O==="options"){l.push(...this._animateOptions(o,c));continue}let z=c[O],q=t[O],ie=r.get(O);if(q)if(ie&&q.active()){q.update(ie,z,C);continue}else q.cancel();if(!ie||!ie.duration){o[O]=z;continue}t[O]=q=new u2(ie,o,O,z),l.push(q)}return l}update(o,c){if(this._properties.size===0){Object.assign(o,c);return}let r=this._createAnimations(o,c);if(r.length)return uc.add(this._chart,r),!0}};function pN(d,o){let c=[],r=Object.keys(o);for(let l=0;l<r.length;l++){let t=d[r[l]];t&&t.active()&&c.push(t.wait())}return Promise.all(c)}function fN(d,o){if(!o)return;let c=d.options;if(!c){d.options=o;return}return c.$shared&&(d.options=c=Object.assign({},c,{$shared:!1,$animations:{}})),c}function iA(d,o){let c=d&&d.options||{},r=c.reverse,l=c.min===void 0?o:0,t=c.max===void 0?o:0;return{start:r?t:l,end:r?l:t}}function gN(d,o,c){if(c===!1)return!1;let r=iA(d,c),l=iA(o,c);return{top:l.end,right:r.end,bottom:l.start,left:r.start}}function _N(d){let o,c,r,l;return un(d)?(o=d.top,c=d.right,r=d.bottom,l=d.left):o=c=r=l=d,{top:o,right:c,bottom:r,left:l,disabled:d===!1}}function iP(d,o){let c=[],r=d._getSortedDatasetMetas(o),l,t;for(l=0,t=r.length;l<t;++l)c.push(r[l].index);return c}function nA(d,o,c,r={}){let l=d.keys,t=r.mode==="single",g,C,I,O;if(o!==null){for(g=0,C=l.length;g<C;++g){if(I=+l[g],I===c){if(r.all)continue;break}O=d.values[I],Ir(O)&&(t||o===0||zs(o)===zs(O))&&(o+=O)}return o}}function bN(d,o){let{iScale:c,vScale:r}=o,l=c.axis==="x"?"x":"y",t=r.axis==="x"?"x":"y",g=Object.keys(d),C=new Array(g.length),I,O,z;for(I=0,O=g.length;I<O;++I)z=g[I],C[I]={[l]:z,[t]:d[z]};return C}function rA(d,o){let c=d&&d.options.stacked;return c||c===void 0&&o.stack!==void 0}function yN(d,o,c){return`${d.id}.${o.id}.${c.stack||c.type}`}function vN(d){let{min:o,max:c,minDefined:r,maxDefined:l}=d.getUserBounds();return{min:r?o:Number.NEGATIVE_INFINITY,max:l?c:Number.POSITIVE_INFINITY}}function xN(d,o,c){let r=d[o]||(d[o]={});return r[c]||(r[c]={})}function oA(d,o,c,r){for(let l of o.getMatchingVisibleMetas(r).reverse()){let t=d[l.index];if(c&&t>0||!c&&t<0)return l.index}return null}function aA(d,o){let{chart:c,_cachedMeta:r}=d,l=c._stacks||(c._stacks={}),{iScale:t,vScale:g,index:C}=r,I=t.axis,O=g.axis,z=yN(t,g,r),q=o.length,ie;for(let de=0;de<q;++de){let xe=o[de],{[I]:Ie,[O]:Me}=xe,Ge=xe._stacks||(xe._stacks={});ie=Ge[O]=xN(l,z,Ie),ie[C]=Me,ie._top=oA(ie,g,!0,r.type),ie._bottom=oA(ie,g,!1,r.type);let He=ie._visualValues||(ie._visualValues={});He[C]=Me}}function i2(d,o){let c=d.scales;return Object.keys(c).filter(r=>c[r].axis===o).shift()}function wN(d,o){return hc(d,{active:!1,dataset:void 0,datasetIndex:o,index:o,mode:"default",type:"dataset"})}function CN(d,o,c){return hc(d,{active:!1,dataIndex:o,parsed:void 0,raw:void 0,element:c,index:o,mode:"default",type:"data"})}function i_(d,o){let c=d.controller.index,r=d.vScale&&d.vScale.axis;if(r){o=o||d._parsed;for(let l of o){let t=l._stacks;if(!t||t[r]===void 0||t[r][c]===void 0)return;delete t[r][c],t[r]._visualValues!==void 0&&t[r]._visualValues[c]!==void 0&&delete t[r]._visualValues[c]}}}var n2=d=>d==="reset"||d==="none",sA=(d,o)=>o?d:Object.assign({},d),SN=(d,o,c)=>d&&!o.hidden&&o._stacked&&{keys:iP(c,!0),values:null},Hd=(()=>{class d{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(c,r){this.chart=c,this._ctx=c.ctx,this.index=r,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){let c=this._cachedMeta;this.configure(),this.linkScales(),c._stacked=rA(c.vScale,c),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(c){this.index!==c&&i_(this._cachedMeta),this.index=c}linkScales(){let c=this.chart,r=this._cachedMeta,l=this.getDataset(),t=(ie,de,xe,Ie)=>ie==="x"?de:ie==="r"?Ie:xe,g=r.xAxisID=Zi(l.xAxisID,i2(c,"x")),C=r.yAxisID=Zi(l.yAxisID,i2(c,"y")),I=r.rAxisID=Zi(l.rAxisID,i2(c,"r")),O=r.indexAxis,z=r.iAxisID=t(O,g,C,I),q=r.vAxisID=t(O,C,g,I);r.xScale=this.getScaleForId(g),r.yScale=this.getScaleForId(C),r.rScale=this.getScaleForId(I),r.iScale=this.getScaleForId(z),r.vScale=this.getScaleForId(q)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(c){return this.chart.scales[c]}_getOtherScale(c){let r=this._cachedMeta;return c===r.iScale?r.vScale:r.iScale}reset(){this._update("reset")}_destroy(){let c=this._cachedMeta;this._data&&LC(this._data,this),c._stacked&&i_(c)}_dataCheck(){let c=this.getDataset(),r=c.data||(c.data=[]),l=this._data;if(un(r)){let t=this._cachedMeta;this._data=bN(r,t)}else if(l!==r){if(l){LC(l,this);let t=this._cachedMeta;i_(t),t._parsed=[]}r&&Object.isExtensible(r)&&FD(r,this),this._syncList=[],this._data=r}}addElements(){let c=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(c.dataset=new this.datasetElementType)}buildOrUpdateElements(c){let r=this._cachedMeta,l=this.getDataset(),t=!1;this._dataCheck();let g=r._stacked;r._stacked=rA(r.vScale,r),r.stack!==l.stack&&(t=!0,i_(r),r.stack=l.stack),this._resyncElements(c),(t||g!==r._stacked)&&aA(this,r._parsed)}configure(){let c=this.chart.config,r=c.datasetScopeKeys(this._type),l=c.getOptionScopes(this.getDataset(),r,!0);this.options=c.createResolver(l,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(c,r){let{_cachedMeta:l,_data:t}=this,{iScale:g,_stacked:C}=l,I=g.axis,O=c===0&&r===t.length?!0:l._sorted,z=c>0&&l._parsed[c-1],q,ie,de;if(this._parsing===!1)l._parsed=t,l._sorted=!0,de=t;else{ur(t[c])?de=this.parseArrayData(l,t,c,r):un(t[c])?de=this.parseObjectData(l,t,c,r):de=this.parsePrimitiveData(l,t,c,r);let xe=()=>ie[I]===null||z&&ie[I]<z[I];for(q=0;q<r;++q)l._parsed[q+c]=ie=de[q],O&&(xe()&&(O=!1),z=ie);l._sorted=O}C&&aA(this,de)}parsePrimitiveData(c,r,l,t){let{iScale:g,vScale:C}=c,I=g.axis,O=C.axis,z=g.getLabels(),q=g===C,ie=new Array(t),de,xe,Ie;for(de=0,xe=t;de<xe;++de)Ie=de+l,ie[de]={[I]:q||g.parse(z[Ie],Ie),[O]:C.parse(r[Ie],Ie)};return ie}parseArrayData(c,r,l,t){let{xScale:g,yScale:C}=c,I=new Array(t),O,z,q,ie;for(O=0,z=t;O<z;++O)q=O+l,ie=r[q],I[O]={x:g.parse(ie[0],q),y:C.parse(ie[1],q)};return I}parseObjectData(c,r,l,t){let{xScale:g,yScale:C}=c,{xAxisKey:I="x",yAxisKey:O="y"}=this._parsing,z=new Array(t),q,ie,de,xe;for(q=0,ie=t;q<ie;++q)de=q+l,xe=r[de],z[q]={x:g.parse(dc(xe,I),de),y:C.parse(dc(xe,O),de)};return z}getParsed(c){return this._cachedMeta._parsed[c]}getDataElement(c){return this._cachedMeta.data[c]}applyStack(c,r,l){let t=this.chart,g=this._cachedMeta,C=r[c.axis],I={keys:iP(t,!0),values:r._stacks[c.axis]._visualValues};return nA(I,C,g.index,{mode:l})}updateRangeFromParsed(c,r,l,t){let g=l[r.axis],C=g===null?NaN:g,I=t&&l._stacks[r.axis];t&&I&&(t.values=I,C=nA(t,g,this._cachedMeta.index)),c.min=Math.min(c.min,C),c.max=Math.max(c.max,C)}getMinMax(c,r){let l=this._cachedMeta,t=l._parsed,g=l._sorted&&c===l.iScale,C=t.length,I=this._getOtherScale(c),O=SN(r,l,this.chart),z={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:q,max:ie}=vN(I),de,xe;function Ie(){xe=t[de];let Me=xe[I.axis];return!Ir(xe[c.axis])||q>Me||ie<Me}for(de=0;de<C&&!(!Ie()&&(this.updateRangeFromParsed(z,c,xe,O),g));++de);if(g){for(de=C-1;de>=0;--de)if(!Ie()){this.updateRangeFromParsed(z,c,xe,O);break}}return z}getAllParsedValues(c){let r=this._cachedMeta._parsed,l=[],t,g,C;for(t=0,g=r.length;t<g;++t)C=r[t][c.axis],Ir(C)&&l.push(C);return l}getMaxOverflow(){return!1}getLabelAndValue(c){let r=this._cachedMeta,l=r.iScale,t=r.vScale,g=this.getParsed(c);return{label:l?""+l.getLabelForValue(g[l.axis]):"",value:t?""+t.getLabelForValue(g[t.axis]):""}}_update(c){let r=this._cachedMeta;this.update(c||"default"),r._clip=_N(Zi(this.options.clip,gN(r.xScale,r.yScale,this.getMaxOverflow())))}update(c){}draw(){let c=this._ctx,r=this.chart,l=this._cachedMeta,t=l.data||[],g=r.chartArea,C=[],I=this._drawStart||0,O=this._drawCount||t.length-I,z=this.options.drawActiveElementsOnTop,q;for(l.dataset&&l.dataset.draw(c,g,I,O),q=I;q<I+O;++q){let ie=t[q];ie.hidden||(ie.active&&z?C.push(ie):ie.draw(c,g))}for(q=0;q<C.length;++q)C[q].draw(c,g)}getStyle(c,r){let l=r?"active":"default";return c===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(l):this.resolveDataElementOptions(c||0,l)}getContext(c,r,l){let t=this.getDataset(),g;if(c>=0&&c<this._cachedMeta.data.length){let C=this._cachedMeta.data[c];g=C.$context||(C.$context=CN(this.getContext(),c,C)),g.parsed=this.getParsed(c),g.raw=t.data[c],g.index=g.dataIndex=c}else g=this.$context||(this.$context=wN(this.chart.getContext(),this.index)),g.dataset=t,g.index=g.datasetIndex=this.index;return g.active=!!r,g.mode=l,g}resolveDatasetElementOptions(c){return this._resolveElementOptions(this.datasetElementType.id,c)}resolveDataElementOptions(c,r){return this._resolveElementOptions(this.dataElementType.id,r,c)}_resolveElementOptions(c,r="default",l){let t=r==="active",g=this._cachedDataOpts,C=c+"-"+r,I=g[C],O=this.enableOptionSharing&&pp(l);if(I)return sA(I,O);let z=this.chart.config,q=z.datasetElementScopeKeys(this._type,c),ie=t?[`${c}Hover`,"hover",c,""]:[c,""],de=z.getOptionScopes(this.getDataset(),q),xe=Object.keys(Tr.elements[c]),Ie=()=>this.getContext(l,t,r),Me=z.resolveNamedOptions(de,xe,Ie,ie);return Me.$shared&&(Me.$shared=O,g[C]=Object.freeze(sA(Me,O))),Me}_resolveAnimations(c,r,l){let t=this.chart,g=this._cachedDataOpts,C=`animation-${r}`,I=g[C];if(I)return I;let O;if(t.options.animation!==!1){let q=this.chart.config,ie=q.datasetAnimationScopeKeys(this._type,r),de=q.getOptionScopes(this.getDataset(),ie);O=q.createResolver(de,this.getContext(c,l,r))}let z=new Wy(t,O&&O.animations);return O&&O._cacheable&&(g[C]=Object.freeze(z)),z}getSharedOptions(c){if(c.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},c))}includeOptions(c,r){return!r||n2(c)||this.chart._animationsDisabled}_getSharedOptions(c,r){let l=this.resolveDataElementOptions(c,r),t=this._sharedOptions,g=this.getSharedOptions(l),C=this.includeOptions(r,g)||g!==t;return this.updateSharedOptions(g,r,l),{sharedOptions:g,includeOptions:C}}updateElement(c,r,l,t){n2(t)?Object.assign(c,l):this._resolveAnimations(r,t).update(c,l)}updateSharedOptions(c,r,l){c&&!n2(r)&&this._resolveAnimations(void 0,r).update(c,l)}_setStyle(c,r,l,t){c.active=t;let g=this.getStyle(r,t);this._resolveAnimations(r,l,t).update(c,{options:!t&&this.getSharedOptions(g)||g})}removeHoverStyle(c,r,l){this._setStyle(c,l,"active",!1)}setHoverStyle(c,r,l){this._setStyle(c,l,"active",!0)}_removeDatasetHoverStyle(){let c=this._cachedMeta.dataset;c&&this._setStyle(c,void 0,"active",!1)}_setDatasetHoverStyle(){let c=this._cachedMeta.dataset;c&&this._setStyle(c,void 0,"active",!0)}_resyncElements(c){let r=this._data,l=this._cachedMeta.data;for(let[I,O,z]of this._syncList)this[I](O,z);this._syncList=[];let t=l.length,g=r.length,C=Math.min(g,t);C&&this.parse(0,C),g>t?this._insertElements(t,g-t,c):g<t&&this._removeElements(g,t-g)}_insertElements(c,r,l=!0){let t=this._cachedMeta,g=t.data,C=c+r,I,O=z=>{for(z.length+=r,I=z.length-1;I>=C;I--)z[I]=z[I-r]};for(O(g),I=c;I<C;++I)g[I]=new this.dataElementType;this._parsing&&O(t._parsed),this.parse(c,r),l&&this.updateElements(g,c,r,"reset")}updateElements(c,r,l,t){}_removeElements(c,r){let l=this._cachedMeta;if(this._parsing){let t=l._parsed.splice(c,r);l._stacked&&i_(l,t)}l.data.splice(c,r)}_sync(c){if(this._parsing)this._syncList.push(c);else{let[r,l,t]=c;this[r](l,t)}this.chart._dataChanges.push([this.index,...c])}_onDataPush(){let c=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-c,c])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(c,r){r&&this._sync(["_removeElements",c,r]);let l=arguments.length-2;l&&this._sync(["_insertElements",c,l])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return d})();function MN(d,o){if(!d._cache.$bar){let c=d.getMatchingVisibleMetas(o),r=[];for(let l=0,t=c.length;l<t;l++)r=r.concat(c[l].controller.getAllParsedValues(d));d._cache.$bar=FC(r.sort((l,t)=>l-t))}return d._cache.$bar}function kN(d){let o=d.iScale,c=MN(o,d.type),r=o._length,l,t,g,C,I=()=>{g===32767||g===-32768||(pp(C)&&(r=Math.min(r,Math.abs(g-C)||r)),C=g)};for(l=0,t=c.length;l<t;++l)g=o.getPixelForValue(c[l]),I();for(C=void 0,l=0,t=o.ticks.length;l<t;++l)g=o.getPixelForTick(l),I();return r}function IN(d,o,c,r){let l=c.barThickness,t,g;return Sn(l)?(t=o.min*c.categoryPercentage,g=c.barPercentage):(t=l*r,g=1),{chunk:t/r,ratio:g,start:o.pixels[d]-t/2}}function TN(d,o,c,r){let l=o.pixels,t=l[d],g=d>0?l[d-1]:null,C=d<l.length-1?l[d+1]:null,I=c.categoryPercentage;g===null&&(g=t-(C===null?o.end-o.start:C-t)),C===null&&(C=t+t-g);let O=t-(t-Math.min(g,C))/2*I;return{chunk:Math.abs(C-g)/2*I/r,ratio:c.barPercentage,start:O}}function EN(d,o,c,r){let l=c.parse(d[0],r),t=c.parse(d[1],r),g=Math.min(l,t),C=Math.max(l,t),I=g,O=C;Math.abs(g)>Math.abs(C)&&(I=C,O=g),o[c.axis]=O,o._custom={barStart:I,barEnd:O,start:l,end:t,min:g,max:C}}function nP(d,o,c,r){return ur(d)?EN(d,o,c,r):o[c.axis]=c.parse(d,r),o}function lA(d,o,c,r){let l=d.iScale,t=d.vScale,g=l.getLabels(),C=l===t,I=[],O,z,q,ie;for(O=c,z=c+r;O<z;++O)ie=o[O],q={},q[l.axis]=C||l.parse(g[O],O),I.push(nP(ie,q,t,O));return I}function r2(d){return d&&d.barStart!==void 0&&d.barEnd!==void 0}function DN(d,o,c){return d!==0?zs(d):(o.isHorizontal()?1:-1)*(o.min>=c?1:-1)}function AN(d){let o,c,r,l,t;return d.horizontal?(o=d.base>d.x,c="left",r="right"):(o=d.base<d.y,c="bottom",r="top"),o?(l="end",t="start"):(l="start",t="end"),{start:c,end:r,reverse:o,top:l,bottom:t}}function PN(d,o,c,r){let l=o.borderSkipped,t={};if(!l){d.borderSkipped=t;return}if(l===!0){d.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}let{start:g,end:C,reverse:I,top:O,bottom:z}=AN(d);l==="middle"&&c&&(d.enableBorderRadius=!0,(c._top||0)===r?l=O:(c._bottom||0)===r?l=z:(t[cA(z,g,C,I)]=!0,l=O)),t[cA(l,g,C,I)]=!0,d.borderSkipped=t}function cA(d,o,c,r){return r?(d=ON(d,o,c),d=dA(d,c,o)):d=dA(d,o,c),d}function ON(d,o,c){return d===o?c:d===c?o:d}function dA(d,o,c){return d==="start"?o:d==="end"?c:d}function RN(d,{inflateAmount:o},c){d.inflateAmount=o==="auto"?c===1?.33:0:o}var LN=(()=>{class d extends Hd{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(c,r,l,t){return lA(c,r,l,t)}parseArrayData(c,r,l,t){return lA(c,r,l,t)}parseObjectData(c,r,l,t){let{iScale:g,vScale:C}=c,{xAxisKey:I="x",yAxisKey:O="y"}=this._parsing,z=g.axis==="x"?I:O,q=C.axis==="x"?I:O,ie=[],de,xe,Ie,Me;for(de=l,xe=l+t;de<xe;++de)Me=r[de],Ie={},Ie[g.axis]=g.parse(dc(Me,z),de),ie.push(nP(dc(Me,q),Ie,C,de));return ie}updateRangeFromParsed(c,r,l,t){super.updateRangeFromParsed(c,r,l,t);let g=l._custom;g&&r===this._cachedMeta.vScale&&(c.min=Math.min(c.min,g.min),c.max=Math.max(c.max,g.max))}getMaxOverflow(){return 0}getLabelAndValue(c){let r=this._cachedMeta,{iScale:l,vScale:t}=r,g=this.getParsed(c),C=g._custom,I=r2(C)?"["+C.start+", "+C.end+"]":""+t.getLabelForValue(g[t.axis]);return{label:""+l.getLabelForValue(g[l.axis]),value:I}}initialize(){this.enableOptionSharing=!0,super.initialize();let c=this._cachedMeta;c.stack=this.getDataset().stack}update(c){let r=this._cachedMeta;this.updateElements(r.data,0,r.data.length,c)}updateElements(c,r,l,t){let g=t==="reset",{index:C,_cachedMeta:{vScale:I}}=this,O=I.getBasePixel(),z=I.isHorizontal(),q=this._getRuler(),{sharedOptions:ie,includeOptions:de}=this._getSharedOptions(r,t);for(let xe=r;xe<r+l;xe++){let Ie=this.getParsed(xe),Me=g||Sn(Ie[I.axis])?{base:O,head:O}:this._calculateBarValuePixels(xe),Ge=this._calculateBarIndexPixels(xe,q),He=(Ie._stacks||{})[I.axis],ht={horizontal:z,base:Me.base,enableBorderRadius:!He||r2(Ie._custom)||C===He._top||C===He._bottom,x:z?Me.head:Ge.center,y:z?Ge.center:Me.head,height:z?Ge.size:Math.abs(Me.size),width:z?Math.abs(Me.size):Ge.size};de&&(ht.options=ie||this.resolveDataElementOptions(xe,c[xe].active?"active":t));let Mt=ht.options||c[xe].options;PN(ht,Mt,He,C),RN(ht,Mt,q.ratio),this.updateElement(c[xe],xe,ht,t)}}_getStacks(c,r){let{iScale:l}=this._cachedMeta,t=l.getMatchingVisibleMetas(this._type).filter(O=>O.controller.options.grouped),g=l.options.stacked,C=[],I=O=>{let z=O.controller.getParsed(r),q=z&&z[O.vScale.axis];if(Sn(q)||isNaN(q))return!0};for(let O of t)if(!(r!==void 0&&I(O))&&((g===!1||C.indexOf(O.stack)===-1||g===void 0&&O.stack===void 0)&&C.push(O.stack),O.index===c))break;return C.length||C.push(void 0),C}_getStackCount(c){return this._getStacks(void 0,c).length}_getStackIndex(c,r,l){let t=this._getStacks(c,l),g=r!==void 0?t.indexOf(r):-1;return g===-1?t.length-1:g}_getRuler(){let c=this.options,r=this._cachedMeta,l=r.iScale,t=[],g,C;for(g=0,C=r.data.length;g<C;++g)t.push(l.getPixelForValue(this.getParsed(g)[l.axis],g));let I=c.barThickness;return{min:I||kN(r),pixels:t,start:l._startPixel,end:l._endPixel,stackCount:this._getStackCount(),scale:l,grouped:c.grouped,ratio:I?1:c.categoryPercentage*c.barPercentage}}_calculateBarValuePixels(c){let{_cachedMeta:{vScale:r,_stacked:l,index:t},options:{base:g,minBarLength:C}}=this,I=g||0,O=this.getParsed(c),z=O._custom,q=r2(z),ie=O[r.axis],de=0,xe=l?this.applyStack(r,O,l):ie,Ie,Me;xe!==ie&&(de=xe-ie,xe=ie),q&&(ie=z.barStart,xe=z.barEnd-z.barStart,ie!==0&&zs(ie)!==zs(z.barEnd)&&(de=0),de+=ie);let Ge=!Sn(g)&&!q?g:de,He=r.getPixelForValue(Ge);if(this.chart.getDataVisibility(c)?Ie=r.getPixelForValue(de+xe):Ie=He,Me=Ie-He,Math.abs(Me)<C){Me=DN(Me,r,I)*C,ie===I&&(He-=Me/2);let ht=r.getPixelForDecimal(0),Mt=r.getPixelForDecimal(1),yt=Math.min(ht,Mt),Tt=Math.max(ht,Mt);He=Math.max(Math.min(He,Tt),yt),Ie=He+Me,l&&!q&&(O._stacks[r.axis]._visualValues[t]=r.getValueForPixel(Ie)-r.getValueForPixel(He))}if(He===r.getPixelForValue(I)){let ht=zs(Me)*r.getLineWidthForValue(I)/2;He+=ht,Me-=ht}return{size:Me,base:He,head:Ie,center:Ie+Me/2}}_calculateBarIndexPixels(c,r){let l=r.scale,t=this.options,g=t.skipNull,C=Zi(t.maxBarThickness,1/0),I,O;if(r.grouped){let z=g?this._getStackCount(c):r.stackCount,q=t.barThickness==="flex"?TN(c,r,t,z):IN(c,r,t,z),ie=this._getStackIndex(this.index,this._cachedMeta.stack,g?c:void 0);I=q.start+q.chunk*ie+q.chunk/2,O=Math.min(C,q.chunk*q.ratio)}else I=l.getPixelForValue(this.getParsed(c)[l.axis],c),O=Math.min(C,r.min*r.ratio);return{base:I-O/2,head:I+O/2,center:I,size:O}}draw(){let c=this._cachedMeta,r=c.vScale,l=c.data,t=l.length,g=0;for(;g<t;++g)this.getParsed(g)[r.axis]!==null&&!l[g].hidden&&l[g].draw(this._ctx)}}return d})(),FN=(()=>{class d extends Hd{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(c,r,l,t){let g=super.parsePrimitiveData(c,r,l,t);for(let C=0;C<g.length;C++)g[C]._custom=this.resolveDataElementOptions(C+l).radius;return g}parseArrayData(c,r,l,t){let g=super.parseArrayData(c,r,l,t);for(let C=0;C<g.length;C++){let I=r[l+C];g[C]._custom=Zi(I[2],this.resolveDataElementOptions(C+l).radius)}return g}parseObjectData(c,r,l,t){let g=super.parseObjectData(c,r,l,t);for(let C=0;C<g.length;C++){let I=r[l+C];g[C]._custom=Zi(I&&I.r&&+I.r,this.resolveDataElementOptions(C+l).radius)}return g}getMaxOverflow(){let c=this._cachedMeta.data,r=0;for(let l=c.length-1;l>=0;--l)r=Math.max(r,c[l].size(this.resolveDataElementOptions(l))/2);return r>0&&r}getLabelAndValue(c){let r=this._cachedMeta,l=this.chart.data.labels||[],{xScale:t,yScale:g}=r,C=this.getParsed(c),I=t.getLabelForValue(C.x),O=g.getLabelForValue(C.y),z=C._custom;return{label:l[c]||"",value:"("+I+", "+O+(z?", "+z:"")+")"}}update(c){let r=this._cachedMeta.data;this.updateElements(r,0,r.length,c)}updateElements(c,r,l,t){let g=t==="reset",{iScale:C,vScale:I}=this._cachedMeta,{sharedOptions:O,includeOptions:z}=this._getSharedOptions(r,t),q=C.axis,ie=I.axis;for(let de=r;de<r+l;de++){let xe=c[de],Ie=!g&&this.getParsed(de),Me={},Ge=Me[q]=g?C.getPixelForDecimal(.5):C.getPixelForValue(Ie[q]),He=Me[ie]=g?I.getBasePixel():I.getPixelForValue(Ie[ie]);Me.skip=isNaN(Ge)||isNaN(He),z&&(Me.options=O||this.resolveDataElementOptions(de,xe.active?"active":t),g&&(Me.options.radius=0)),this.updateElement(xe,de,Me,t)}}resolveDataElementOptions(c,r){let l=this.getParsed(c),t=super.resolveDataElementOptions(c,r);t.$shared&&(t=Object.assign({},t,{$shared:!1}));let g=t.radius;return r!=="active"&&(t.radius=0),t.radius+=Zi(l&&l._custom,g),t}}return d})();function zN(d,o,c){let r=1,l=1,t=0,g=0;if(o<pr){let C=d,I=C+o,O=Math.cos(C),z=Math.sin(C),q=Math.cos(I),ie=Math.sin(I),de=(ht,Mt,yt)=>gp(ht,C,I,!0)?1:Math.max(Mt,Mt*c,yt,yt*c),xe=(ht,Mt,yt)=>gp(ht,C,I,!0)?-1:Math.min(Mt,Mt*c,yt,yt*c),Ie=de(0,O,q),Me=de(Or,z,ie),Ge=xe(mr,O,q),He=xe(mr+Or,z,ie);r=(Ie-Ge)/2,l=(Me-He)/2,t=-(Ie+Ge)/2,g=-(Me+He)/2}return{ratioX:r,ratioY:l,offsetX:t,offsetY:g}}var P2=(()=>{class d extends Hd{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:c=>c!=="spacing",_indexable:c=>c!=="spacing"&&!c.startsWith("borderDash")&&!c.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(c){let r=c.data;if(r.labels.length&&r.datasets.length){let{labels:{pointStyle:l,color:t}}=c.legend.options;return r.labels.map((g,C)=>{let O=c.getDatasetMeta(0).controller.getStyle(C);return{text:g,fillStyle:O.backgroundColor,strokeStyle:O.borderColor,fontColor:t,lineWidth:O.borderWidth,pointStyle:l,hidden:!c.getDataVisibility(C),index:C}})}return[]}},onClick(c,r,l){l.chart.toggleDataVisibility(r.index),l.chart.update()}}}};constructor(c,r){super(c,r),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(c,r){let l=this.getDataset().data,t=this._cachedMeta;if(this._parsing===!1)t._parsed=l;else{let g=O=>+l[O];if(un(l[c])){let{key:O="value"}=this._parsing;g=z=>+dc(l[z],O)}let C,I;for(C=c,I=c+r;C<I;++C)t._parsed[C]=g(C)}}_getRotation(){return os(this.options.rotation-90)}_getCircumference(){return os(this.options.circumference)}_getRotationExtents(){let c=pr,r=-pr;for(let l=0;l<this.chart.data.datasets.length;++l)if(this.chart.isDatasetVisible(l)&&this.chart.getDatasetMeta(l).type===this._type){let t=this.chart.getDatasetMeta(l).controller,g=t._getRotation(),C=t._getCircumference();c=Math.min(c,g),r=Math.max(r,g+C)}return{rotation:c,circumference:r-c}}update(c){let r=this.chart,{chartArea:l}=r,t=this._cachedMeta,g=t.data,C=this.getMaxBorderWidth()+this.getMaxOffset(g)+this.options.spacing,I=Math.max((Math.min(l.width,l.height)-C)/2,0),O=Math.min(ID(this.options.cutout,I),1),z=this._getRingWeight(this.index),{circumference:q,rotation:ie}=this._getRotationExtents(),{ratioX:de,ratioY:xe,offsetX:Ie,offsetY:Me}=zN(ie,q,O),Ge=(l.width-C)/de,He=(l.height-C)/xe,ht=Math.max(Math.min(Ge,He)/2,0),Mt=EC(this.options.radius,ht),yt=Math.max(Mt*O,0),Tt=(Mt-yt)/this._getVisibleDatasetWeightTotal();this.offsetX=Ie*Mt,this.offsetY=Me*Mt,t.total=this.calculateTotal(),this.outerRadius=Mt-Tt*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Tt*z,0),this.updateElements(g,0,g.length,c)}_circumference(c,r){let l=this.options,t=this._cachedMeta,g=this._getCircumference();return r&&l.animation.animateRotate||!this.chart.getDataVisibility(c)||t._parsed[c]===null||t.data[c].hidden?0:this.calculateCircumference(t._parsed[c]*g/pr)}updateElements(c,r,l,t){let g=t==="reset",C=this.chart,I=C.chartArea,z=C.options.animation,q=(I.left+I.right)/2,ie=(I.top+I.bottom)/2,de=g&&z.animateScale,xe=de?0:this.innerRadius,Ie=de?0:this.outerRadius,{sharedOptions:Me,includeOptions:Ge}=this._getSharedOptions(r,t),He=this._getRotation(),ht;for(ht=0;ht<r;++ht)He+=this._circumference(ht,g);for(ht=r;ht<r+l;++ht){let Mt=this._circumference(ht,g),yt=c[ht],Tt={x:q+this.offsetX,y:ie+this.offsetY,startAngle:He,endAngle:He+Mt,circumference:Mt,outerRadius:Ie,innerRadius:xe};Ge&&(Tt.options=Me||this.resolveDataElementOptions(ht,yt.active?"active":t)),He+=Mt,this.updateElement(yt,ht,Tt,t)}}calculateTotal(){let c=this._cachedMeta,r=c.data,l=0,t;for(t=0;t<r.length;t++){let g=c._parsed[t];g!==null&&!isNaN(g)&&this.chart.getDataVisibility(t)&&!r[t].hidden&&(l+=Math.abs(g))}return l}calculateCircumference(c){let r=this._cachedMeta.total;return r>0&&!isNaN(c)?pr*(Math.abs(c)/r):0}getLabelAndValue(c){let r=this._cachedMeta,l=this.chart,t=l.data.labels||[],g=_p(r._parsed[c],l.options.locale);return{label:t[c]||"",value:g}}getMaxBorderWidth(c){let r=0,l=this.chart,t,g,C,I,O;if(!c){for(t=0,g=l.data.datasets.length;t<g;++t)if(l.isDatasetVisible(t)){C=l.getDatasetMeta(t),c=C.data,I=C.controller;break}}if(!c)return 0;for(t=0,g=c.length;t<g;++t)O=I.resolveDataElementOptions(t),O.borderAlign!=="inner"&&(r=Math.max(r,O.borderWidth||0,O.hoverBorderWidth||0));return r}getMaxOffset(c){let r=0;for(let l=0,t=c.length;l<t;++l){let g=this.resolveDataElementOptions(l);r=Math.max(r,g.offset||0,g.hoverOffset||0)}return r}_getRingWeightOffset(c){let r=0;for(let l=0;l<c;++l)this.chart.isDatasetVisible(l)&&(r+=this._getRingWeight(l));return r}_getRingWeight(c){return Math.max(Zi(this.chart.data.datasets[c].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return d})(),BN=(()=>{class d extends Hd{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(c){let r=this._cachedMeta,{dataset:l,data:t=[],_dataset:g}=r,C=this.chart._animationsDisabled,{start:I,count:O}=NC(r,t,C);this._drawStart=I,this._drawCount=O,VC(r)&&(I=0,O=t.length),l._chart=this.chart,l._datasetIndex=this.index,l._decimated=!!g._decimated,l.points=t;let z=this.resolveDatasetElementOptions(c);this.options.showLine||(z.borderWidth=0),z.segment=this.options.segment,this.updateElement(l,void 0,{animated:!C,options:z},c),this.updateElements(t,I,O,c)}updateElements(c,r,l,t){let g=t==="reset",{iScale:C,vScale:I,_stacked:O,_dataset:z}=this._cachedMeta,{sharedOptions:q,includeOptions:ie}=this._getSharedOptions(r,t),de=C.axis,xe=I.axis,{spanGaps:Ie,segment:Me}=this.options,Ge=mu(Ie)?Ie:Number.POSITIVE_INFINITY,He=this.chart._animationsDisabled||g||t==="none",ht=r+l,Mt=c.length,yt=r>0&&this.getParsed(r-1);for(let Tt=0;Tt<Mt;++Tt){let Wt=c[Tt],Ct=He?Wt:{};if(Tt<r||Tt>=ht){Ct.skip=!0;continue}let Yt=this.getParsed(Tt),zt=Sn(Yt[xe]),Ti=Ct[de]=C.getPixelForValue(Yt[de],Tt),Hi=Ct[xe]=g||zt?I.getBasePixel():I.getPixelForValue(O?this.applyStack(I,Yt,O):Yt[xe],Tt);Ct.skip=isNaN(Ti)||isNaN(Hi)||zt,Ct.stop=Tt>0&&Math.abs(Yt[de]-yt[de])>Ge,Me&&(Ct.parsed=Yt,Ct.raw=z.data[Tt]),ie&&(Ct.options=q||this.resolveDataElementOptions(Tt,Wt.active?"active":t)),He||this.updateElement(Wt,Tt,Ct,t),yt=Yt}}getMaxOverflow(){let c=this._cachedMeta,r=c.dataset,l=r.options&&r.options.borderWidth||0,t=c.data||[];if(!t.length)return l;let g=t[0].size(this.resolveDataElementOptions(0)),C=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(l,g,C)/2}draw(){let c=this._cachedMeta;c.dataset.updateControlPoints(this.chart.chartArea,c.iScale.axis),super.draw()}}return d})(),rP=(()=>{class d extends Hd{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(c){let r=c.data;if(r.labels.length&&r.datasets.length){let{labels:{pointStyle:l,color:t}}=c.legend.options;return r.labels.map((g,C)=>{let O=c.getDatasetMeta(0).controller.getStyle(C);return{text:g,fillStyle:O.backgroundColor,strokeStyle:O.borderColor,fontColor:t,lineWidth:O.borderWidth,pointStyle:l,hidden:!c.getDataVisibility(C),index:C}})}return[]}},onClick(c,r,l){l.chart.toggleDataVisibility(r.index),l.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(c,r){super(c,r),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(c){let r=this._cachedMeta,l=this.chart,t=l.data.labels||[],g=_p(r._parsed[c].r,l.options.locale);return{label:t[c]||"",value:g}}parseObjectData(c,r,l,t){return ZC.bind(this)(c,r,l,t)}update(c){let r=this._cachedMeta.data;this._updateRadius(),this.updateElements(r,0,r.length,c)}getMinMax(){let c=this._cachedMeta,r={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return c.data.forEach((l,t)=>{let g=this.getParsed(t).r;!isNaN(g)&&this.chart.getDataVisibility(t)&&(g<r.min&&(r.min=g),g>r.max&&(r.max=g))}),r}_updateRadius(){let c=this.chart,r=c.chartArea,l=c.options,t=Math.min(r.right-r.left,r.bottom-r.top),g=Math.max(t/2,0),C=Math.max(l.cutoutPercentage?g/100*l.cutoutPercentage:1,0),I=(g-C)/c.getVisibleDatasetCount();this.outerRadius=g-I*this.index,this.innerRadius=this.outerRadius-I}updateElements(c,r,l,t){let g=t==="reset",C=this.chart,O=C.options.animation,z=this._cachedMeta.rScale,q=z.xCenter,ie=z.yCenter,de=z.getIndexAngle(0)-.5*mr,xe=de,Ie,Me=360/this.countVisibleElements();for(Ie=0;Ie<r;++Ie)xe+=this._computeAngle(Ie,t,Me);for(Ie=r;Ie<r+l;Ie++){let Ge=c[Ie],He=xe,ht=xe+this._computeAngle(Ie,t,Me),Mt=C.getDataVisibility(Ie)?z.getDistanceFromCenterForValue(this.getParsed(Ie).r):0;xe=ht,g&&(O.animateScale&&(Mt=0),O.animateRotate&&(He=ht=de));let yt={x:q,y:ie,innerRadius:0,outerRadius:Mt,startAngle:He,endAngle:ht,options:this.resolveDataElementOptions(Ie,Ge.active?"active":t)};this.updateElement(Ge,Ie,yt,t)}}countVisibleElements(){let c=this._cachedMeta,r=0;return c.data.forEach((l,t)=>{!isNaN(this.getParsed(t).r)&&this.chart.getDataVisibility(t)&&r++}),r}_computeAngle(c,r,l){return this.chart.getDataVisibility(c)?os(this.resolveDataElementOptions(c,r).angle||l):0}}return d})(),NN=(()=>{class d extends P2{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}return d})(),VN=(()=>{class d extends Hd{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(c){let r=this._cachedMeta.vScale,l=this.getParsed(c);return{label:r.getLabels()[c],value:""+r.getLabelForValue(l[r.axis])}}parseObjectData(c,r,l,t){return ZC.bind(this)(c,r,l,t)}update(c){let r=this._cachedMeta,l=r.dataset,t=r.data||[],g=r.iScale.getLabels();if(l.points=t,c!=="resize"){let C=this.resolveDatasetElementOptions(c);this.options.showLine||(C.borderWidth=0);let I={_loop:!0,_fullLoop:g.length===t.length,options:C};this.updateElement(l,void 0,I,c)}this.updateElements(t,0,t.length,c)}updateElements(c,r,l,t){let g=this._cachedMeta.rScale,C=t==="reset";for(let I=r;I<r+l;I++){let O=c[I],z=this.resolveDataElementOptions(I,O.active?"active":t),q=g.getPointPositionForValue(I,this.getParsed(I).r),ie=C?g.xCenter:q.x,de=C?g.yCenter:q.y,xe={x:ie,y:de,angle:q.angle,skip:isNaN(ie)||isNaN(de),options:z};this.updateElement(O,I,xe,t)}}}return d})(),jN=(()=>{class d extends Hd{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(c){let r=this._cachedMeta,l=this.chart.data.labels||[],{xScale:t,yScale:g}=r,C=this.getParsed(c),I=t.getLabelForValue(C.x),O=g.getLabelForValue(C.y);return{label:l[c]||"",value:"("+I+", "+O+")"}}update(c){let r=this._cachedMeta,{data:l=[]}=r,t=this.chart._animationsDisabled,{start:g,count:C}=NC(r,l,t);if(this._drawStart=g,this._drawCount=C,VC(r)&&(g=0,C=l.length),this.options.showLine){this.datasetElementType||this.addElements();let{dataset:I,_dataset:O}=r;I._chart=this.chart,I._datasetIndex=this.index,I._decimated=!!O._decimated,I.points=l;let z=this.resolveDatasetElementOptions(c);z.segment=this.options.segment,this.updateElement(I,void 0,{animated:!t,options:z},c)}else this.datasetElementType&&(delete r.dataset,this.datasetElementType=!1);this.updateElements(l,g,C,c)}addElements(){let{showLine:c}=this.options;!this.datasetElementType&&c&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(c,r,l,t){let g=t==="reset",{iScale:C,vScale:I,_stacked:O,_dataset:z}=this._cachedMeta,q=this.resolveDataElementOptions(r,t),ie=this.getSharedOptions(q),de=this.includeOptions(t,ie),xe=C.axis,Ie=I.axis,{spanGaps:Me,segment:Ge}=this.options,He=mu(Me)?Me:Number.POSITIVE_INFINITY,ht=this.chart._animationsDisabled||g||t==="none",Mt=r>0&&this.getParsed(r-1);for(let yt=r;yt<r+l;++yt){let Tt=c[yt],Wt=this.getParsed(yt),Ct=ht?Tt:{},Yt=Sn(Wt[Ie]),zt=Ct[xe]=C.getPixelForValue(Wt[xe],yt),Ti=Ct[Ie]=g||Yt?I.getBasePixel():I.getPixelForValue(O?this.applyStack(I,Wt,O):Wt[Ie],yt);Ct.skip=isNaN(zt)||isNaN(Ti)||Yt,Ct.stop=yt>0&&Math.abs(Wt[xe]-Mt[xe])>He,Ge&&(Ct.parsed=Wt,Ct.raw=z.data[yt]),de&&(Ct.options=ie||this.resolveDataElementOptions(yt,Tt.active?"active":t)),ht||this.updateElement(Tt,yt,Ct,t),Mt=Wt}this.updateSharedOptions(ie,t,q)}getMaxOverflow(){let c=this._cachedMeta,r=c.data||[];if(!this.options.showLine){let I=0;for(let O=r.length-1;O>=0;--O)I=Math.max(I,r[O].size(this.resolveDataElementOptions(O))/2);return I>0&&I}let l=c.dataset,t=l.options&&l.options.borderWidth||0;if(!r.length)return t;let g=r[0].size(this.resolveDataElementOptions(0)),C=r[r.length-1].size(this.resolveDataElementOptions(r.length-1));return Math.max(t,g,C)/2}}return d})(),UN=Object.freeze({__proto__:null,BarController:LN,BubbleController:FN,DoughnutController:P2,LineController:BN,PieController:NN,PolarAreaController:rP,RadarController:VN,ScatterController:jN});function fu(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var m2=class d{static override(o){Object.assign(d.prototype,o)}options;constructor(o){this.options=o||{}}init(){}formats(){return fu()}parse(){return fu()}format(){return fu()}add(){return fu()}diff(){return fu()}startOf(){return fu()}endOf(){return fu()}},WN={_date:m2};function HN(d,o,c,r){let{controller:l,data:t,_sorted:g}=d,C=l._cachedMeta.iScale;if(C&&o===C.axis&&o!=="r"&&g&&t.length){let I=C._reversePixels?OD:ml;if(r){if(l._sharedOptions){let O=t[0],z=typeof O.getRange=="function"&&O.getRange(o);if(z){let q=I(t,o,c-z),ie=I(t,o,c+z);return{lo:q.lo,hi:ie.hi}}}}else return I(t,o,c)}return{lo:0,hi:t.length-1}}function u_(d,o,c,r,l){let t=d.getSortedVisibleDatasetMetas(),g=c[o];for(let C=0,I=t.length;C<I;++C){let{index:O,data:z}=t[C],{lo:q,hi:ie}=HN(t[C],o,g,l);for(let de=q;de<=ie;++de){let xe=z[de];xe.skip||r(xe,O,de)}}}function GN(d){let o=d.indexOf("x")!==-1,c=d.indexOf("y")!==-1;return function(r,l){let t=o?Math.abs(r.x-l.x):0,g=c?Math.abs(r.y-l.y):0;return Math.sqrt(Math.pow(t,2)+Math.pow(g,2))}}function o2(d,o,c,r,l){let t=[];return!l&&!d.isPointInArea(o)||u_(d,c,o,function(C,I,O){!l&&!pl(C,d.chartArea,0)||C.inRange(o.x,o.y,r)&&t.push({element:C,datasetIndex:I,index:O})},!0),t}function qN(d,o,c,r){let l=[];function t(g,C,I){let{startAngle:O,endAngle:z}=g.getProps(["startAngle","endAngle"],r),{angle:q}=RC(g,{x:o.x,y:o.y});gp(q,O,z)&&l.push({element:g,datasetIndex:C,index:I})}return u_(d,c,o,t),l}function $N(d,o,c,r,l,t){let g=[],C=GN(c),I=Number.POSITIVE_INFINITY;function O(z,q,ie){let de=z.inRange(o.x,o.y,l);if(r&&!de)return;let xe=z.getCenterPoint(l);if(!(!!t||d.isPointInArea(xe))&&!de)return;let Me=C(o,xe);Me<I?(g=[{element:z,datasetIndex:q,index:ie}],I=Me):Me===I&&g.push({element:z,datasetIndex:q,index:ie})}return u_(d,c,o,O),g}function a2(d,o,c,r,l,t){return!t&&!d.isPointInArea(o)?[]:c==="r"&&!r?qN(d,o,c,l):$N(d,o,c,r,l,t)}function hA(d,o,c,r,l){let t=[],g=c==="x"?"inXRange":"inYRange",C=!1;return u_(d,c,o,(I,O,z)=>{I[g](o[c],l)&&(t.push({element:I,datasetIndex:O,index:z}),C=C||I.inRange(o.x,o.y,l))}),r&&!C?[]:t}var YN={evaluateInteractionItems:u_,modes:{index(d,o,c,r){let l=Ud(o,d),t=c.axis||"x",g=c.includeInvisible||!1,C=c.intersect?o2(d,l,t,r,g):a2(d,l,t,!1,r,g),I=[];return C.length?(d.getSortedVisibleDatasetMetas().forEach(O=>{let z=C[0].index,q=O.data[z];q&&!q.skip&&I.push({element:q,datasetIndex:O.index,index:z})}),I):[]},dataset(d,o,c,r){let l=Ud(o,d),t=c.axis||"xy",g=c.includeInvisible||!1,C=c.intersect?o2(d,l,t,r,g):a2(d,l,t,!1,r,g);if(C.length>0){let I=C[0].datasetIndex,O=d.getDatasetMeta(I).data;C=[];for(let z=0;z<O.length;++z)C.push({element:O[z],datasetIndex:I,index:z})}return C},point(d,o,c,r){let l=Ud(o,d),t=c.axis||"xy",g=c.includeInvisible||!1;return o2(d,l,t,r,g)},nearest(d,o,c,r){let l=Ud(o,d),t=c.axis||"xy",g=c.includeInvisible||!1;return a2(d,l,t,c.intersect,r,g)},x(d,o,c,r){let l=Ud(o,d);return hA(d,l,"x",c.intersect,r)},y(d,o,c,r){let l=Ud(o,d);return hA(d,l,"y",c.intersect,r)}}},oP=["left","top","right","bottom"];function n_(d,o){return d.filter(c=>c.pos===o)}function uA(d,o){return d.filter(c=>oP.indexOf(c.pos)===-1&&c.box.axis===o)}function r_(d,o){return d.sort((c,r)=>{let l=o?r:c,t=o?c:r;return l.weight===t.weight?l.index-t.index:l.weight-t.weight})}function ZN(d){let o=[],c,r,l,t,g,C;for(c=0,r=(d||[]).length;c<r;++c)l=d[c],{position:t,options:{stack:g,stackWeight:C=1}}=l,o.push({index:c,box:l,pos:t,horizontal:l.isHorizontal(),weight:l.weight,stack:g&&t+g,stackWeight:C});return o}function XN(d){let o={};for(let c of d){let{stack:r,pos:l,stackWeight:t}=c;if(!r||!oP.includes(l))continue;let g=o[r]||(o[r]={count:0,placed:0,weight:0,size:0});g.count++,g.weight+=t}return o}function QN(d,o){let c=XN(d),{vBoxMaxWidth:r,hBoxMaxHeight:l}=o,t,g,C;for(t=0,g=d.length;t<g;++t){C=d[t];let{fullSize:I}=C.box,O=c[C.stack],z=O&&C.stackWeight/O.weight;C.horizontal?(C.width=z?z*r:I&&o.availableWidth,C.height=l):(C.width=r,C.height=z?z*l:I&&o.availableHeight)}return c}function KN(d){let o=ZN(d),c=r_(o.filter(O=>O.box.fullSize),!0),r=r_(n_(o,"left"),!0),l=r_(n_(o,"right")),t=r_(n_(o,"top"),!0),g=r_(n_(o,"bottom")),C=uA(o,"x"),I=uA(o,"y");return{fullSize:c,leftAndTop:r.concat(t),rightAndBottom:l.concat(I).concat(g).concat(C),chartArea:n_(o,"chartArea"),vertical:r.concat(l).concat(I),horizontal:t.concat(g).concat(C)}}function mA(d,o,c,r){return Math.max(d[c],o[c])+Math.max(d[r],o[r])}function aP(d,o){d.top=Math.max(d.top,o.top),d.left=Math.max(d.left,o.left),d.bottom=Math.max(d.bottom,o.bottom),d.right=Math.max(d.right,o.right)}function JN(d,o,c,r){let{pos:l,box:t}=c,g=d.maxPadding;if(!un(l)){c.size&&(d[l]-=c.size);let q=r[c.stack]||{size:0,count:1};q.size=Math.max(q.size,c.horizontal?t.height:t.width),c.size=q.size/q.count,d[l]+=c.size}t.getPadding&&aP(g,t.getPadding());let C=Math.max(0,o.outerWidth-mA(g,d,"left","right")),I=Math.max(0,o.outerHeight-mA(g,d,"top","bottom")),O=C!==d.w,z=I!==d.h;return d.w=C,d.h=I,c.horizontal?{same:O,other:z}:{same:z,other:O}}function eV(d){let o=d.maxPadding;function c(r){let l=Math.max(o[r]-d[r],0);return d[r]+=l,l}d.y+=c("top"),d.x+=c("left"),c("right"),c("bottom")}function tV(d,o){let c=o.maxPadding;function r(l){let t={left:0,top:0,right:0,bottom:0};return l.forEach(g=>{t[g]=Math.max(o[g],c[g])}),t}return r(d?["left","right"]:["top","bottom"])}function s_(d,o,c,r){let l=[],t,g,C,I,O,z;for(t=0,g=d.length,O=0;t<g;++t){C=d[t],I=C.box,I.update(C.width||o.w,C.height||o.h,tV(C.horizontal,o));let{same:q,other:ie}=JN(o,c,C,r);O|=q&&l.length,z=z||ie,I.fullSize||l.push(C)}return O&&s_(l,o,c,r)||z}function Ry(d,o,c,r,l){d.top=c,d.left=o,d.right=o+r,d.bottom=c+l,d.width=r,d.height=l}function pA(d,o,c,r){let l=c.padding,{x:t,y:g}=o;for(let C of d){let I=C.box,O=r[C.stack]||{count:1,placed:0,weight:1},z=C.stackWeight/O.weight||1;if(C.horizontal){let q=o.w*z,ie=O.size||I.height;pp(O.start)&&(g=O.start),I.fullSize?Ry(I,l.left,g,c.outerWidth-l.right-l.left,ie):Ry(I,o.left+O.placed,g,q,ie),O.start=g,O.placed+=q,g=I.bottom}else{let q=o.h*z,ie=O.size||I.width;pp(O.start)&&(t=O.start),I.fullSize?Ry(I,t,l.top,ie,c.outerHeight-l.bottom-l.top):Ry(I,t,o.top+O.placed,ie,q),O.start=t,O.placed+=q,t=I.right}}o.x=t,o.y=g}var Bo={addBox(d,o){d.boxes||(d.boxes=[]),o.fullSize=o.fullSize||!1,o.position=o.position||"top",o.weight=o.weight||0,o._layers=o._layers||function(){return[{z:0,draw(c){o.draw(c)}}]},d.boxes.push(o)},removeBox(d,o){let c=d.boxes?d.boxes.indexOf(o):-1;c!==-1&&d.boxes.splice(c,1)},configure(d,o,c){o.fullSize=c.fullSize,o.position=c.position,o.weight=c.weight},update(d,o,c,r){if(!d)return;let l=Co(d.options.layout.padding),t=Math.max(o-l.width,0),g=Math.max(c-l.height,0),C=KN(d.boxes),I=C.vertical,O=C.horizontal;Hn(d.boxes,Ie=>{typeof Ie.beforeLayout=="function"&&Ie.beforeLayout()});let z=I.reduce((Ie,Me)=>Me.box.options&&Me.box.options.display===!1?Ie:Ie+1,0)||1,q=Object.freeze({outerWidth:o,outerHeight:c,padding:l,availableWidth:t,availableHeight:g,vBoxMaxWidth:t/2/z,hBoxMaxHeight:g/2}),ie=Object.assign({},l);aP(ie,Co(r));let de=Object.assign({maxPadding:ie,w:t,h:g,x:l.left,y:l.top},l),xe=QN(I.concat(O),q);s_(C.fullSize,de,q,xe),s_(I,de,q,xe),s_(O,de,q,xe)&&s_(I,de,q,xe),eV(de),pA(C.leftAndTop,de,q,xe),de.x+=de.w,de.y+=de.h,pA(C.rightAndBottom,de,q,xe),d.chartArea={left:de.left,top:de.top,right:de.left+de.w,bottom:de.top+de.h,height:de.h,width:de.w},Hn(C.chartArea,Ie=>{let Me=Ie.box;Object.assign(Me,d.chartArea),Me.update(de.w,de.h,{left:0,top:0,right:0,bottom:0})})}},Hy=class{acquireContext(o,c){}releaseContext(o){return!1}addEventListener(o,c,r){}removeEventListener(o,c,r){}getDevicePixelRatio(){return 1}getMaximumSize(o,c,r,l){return c=Math.max(0,c||o.width),r=r||o.height,{width:c,height:Math.max(0,l?Math.floor(c/l):r)}}isAttached(o){return!0}updateConfig(o){}},p2=class extends Hy{acquireContext(o){return o&&o.getContext&&o.getContext("2d")||null}updateConfig(o){o.options.animation=!1}},jy="$chartjs",iV={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},fA=d=>d===null||d==="";function nV(d,o){let c=d.style,r=d.getAttribute("height"),l=d.getAttribute("width");if(d[jy]={initial:{height:r,width:l,style:{display:c.display,height:c.height,width:c.width}}},c.display=c.display||"block",c.boxSizing=c.boxSizing||"border-box",fA(l)){let t=QC(d,"width");t!==void 0&&(d.width=t)}if(fA(r))if(d.style.height==="")d.height=d.width/(o||2);else{let t=QC(d,"height");t!==void 0&&(d.height=t)}return d}var sP=XD?{passive:!0}:!1;function rV(d,o,c){d&&d.addEventListener(o,c,sP)}function oV(d,o,c){d&&d.canvas&&d.canvas.removeEventListener(o,c,sP)}function aV(d,o){let c=iV[d.type]||d.type,{x:r,y:l}=Ud(d,o);return{type:c,chart:o,native:d,x:r!==void 0?r:null,y:l!==void 0?l:null}}function Gy(d,o){for(let c of d)if(c===o||c.contains(o))return!0}function sV(d,o,c){let r=d.canvas,l=new MutationObserver(t=>{let g=!1;for(let C of t)g=g||Gy(C.addedNodes,r),g=g&&!Gy(C.removedNodes,r);g&&c()});return l.observe(document,{childList:!0,subtree:!0}),l}function lV(d,o,c){let r=d.canvas,l=new MutationObserver(t=>{let g=!1;for(let C of t)g=g||Gy(C.removedNodes,r),g=g&&!Gy(C.addedNodes,r);g&&c()});return l.observe(document,{childList:!0,subtree:!0}),l}var c_=new Map,gA=0;function lP(){let d=window.devicePixelRatio;d!==gA&&(gA=d,c_.forEach((o,c)=>{c.currentDevicePixelRatio!==d&&o()}))}function cV(d,o){c_.size||window.addEventListener("resize",lP),c_.set(d,o)}function dV(d){c_.delete(d),c_.size||window.removeEventListener("resize",lP)}function hV(d,o,c){let r=d.canvas,l=r&&Py(r);if(!l)return;let t=BC((C,I)=>{let O=l.clientWidth;c(C,I),O<l.clientWidth&&c()},window),g=new ResizeObserver(C=>{let I=C[0],O=I.contentRect.width,z=I.contentRect.height;O===0&&z===0||t(O,z)});return g.observe(l),cV(d,t),g}function s2(d,o,c){c&&c.disconnect(),o==="resize"&&dV(d)}function uV(d,o,c){let r=d.canvas,l=BC(t=>{d.ctx!==null&&c(aV(t,d))},d);return rV(r,o,l),l}var f2=class extends Hy{acquireContext(o,c){let r=o&&o.getContext&&o.getContext("2d");return r&&r.canvas===o?(nV(o,c),r):null}releaseContext(o){let c=o.canvas;if(!c[jy])return!1;let r=c[jy].initial;["height","width"].forEach(t=>{let g=r[t];Sn(g)?c.removeAttribute(t):c.setAttribute(t,g)});let l=r.style||{};return Object.keys(l).forEach(t=>{c.style[t]=l[t]}),c.width=c.width,delete c[jy],!0}addEventListener(o,c,r){this.removeEventListener(o,c);let l=o.$proxies||(o.$proxies={}),g={attach:sV,detach:lV,resize:hV}[c]||uV;l[c]=g(o,c,r)}removeEventListener(o,c){let r=o.$proxies||(o.$proxies={}),l=r[c];if(!l)return;({attach:s2,detach:s2,resize:s2}[c]||oV)(o,c,l),r[c]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(o,c,r,l){return ZD(o,c,r,l)}isAttached(o){let c=o&&Py(o);return!!(c&&c.isConnected)}};function mV(d){return!Ay()||typeof OffscreenCanvas<"u"&&d instanceof OffscreenCanvas?p2:f2}var Bs=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(o){let{x:c,y:r}=this.getProps(["x","y"],o);return{x:c,y:r}}hasValue(){return mu(this.x)&&mu(this.y)}getProps(o,c){let r=this.$animations;if(!c||!r)return this;let l={};return o.forEach(t=>{l[t]=r[t]&&r[t].active()?r[t]._to:this[t]}),l}};function pV(d,o){let c=d.options.ticks,r=fV(d),l=Math.min(c.maxTicksLimit||r,r),t=c.major.enabled?_V(o):[],g=t.length,C=t[0],I=t[g-1],O=[];if(g>l)return bV(o,O,t,g/l),O;let z=gV(t,o,l);if(g>0){let q,ie,de=g>1?Math.round((I-C)/(g-1)):null;for(Ly(o,O,z,Sn(de)?0:C-de,C),q=0,ie=g-1;q<ie;q++)Ly(o,O,z,t[q],t[q+1]);return Ly(o,O,z,I,Sn(de)?o.length:I+de),O}return Ly(o,O,z),O}function fV(d){let o=d.options.offset,c=d._tickSize(),r=d._length/c+(o?0:1),l=d._maxLength/c;return Math.floor(Math.min(r,l))}function gV(d,o,c){let r=yV(d),l=o.length/c;if(!r)return Math.max(l,1);let t=DD(r);for(let g=0,C=t.length-1;g<C;g++){let I=t[g];if(I>l)return I}return Math.max(l,1)}function _V(d){let o=[],c,r;for(c=0,r=d.length;c<r;c++)d[c].major&&o.push(c);return o}function bV(d,o,c,r){let l=0,t=c[0],g;for(r=Math.ceil(r),g=0;g<d.length;g++)g===t&&(o.push(d[g]),l++,t=c[l*r])}function Ly(d,o,c,r,l){let t=Zi(r,0),g=Math.min(Zi(l,d.length),d.length),C=0,I,O,z;for(c=Math.ceil(c),l&&(I=l-r,c=I/Math.floor(I/c)),z=t;z<0;)C++,z=Math.round(t+C*c);for(O=Math.max(t,0);O<g;O++)O===z&&(o.push(d[O]),C++,z=Math.round(t+C*c))}function yV(d){let o=d.length,c,r;if(o<2)return!1;for(r=d[0],c=1;c<o;++c)if(d[c]-d[c-1]!==r)return!1;return r}var vV=d=>d==="left"?"right":d==="right"?"left":d,_A=(d,o,c)=>o==="top"||o==="left"?d[o]+c:d[o]-c,bA=(d,o)=>Math.min(o||d,d);function yA(d,o){let c=[],r=d.length/o,l=d.length,t=0;for(;t<l;t+=r)c.push(d[Math.floor(t)]);return c}function xV(d,o,c){let r=d.ticks.length,l=Math.min(o,r-1),t=d._startPixel,g=d._endPixel,C=1e-6,I=d.getPixelForTick(l),O;if(!(c&&(r===1?O=Math.max(I-t,g-I):o===0?O=(d.getPixelForTick(1)-I)/2:O=(I-d.getPixelForTick(l-1))/2,I+=l<o?O:-O,I<t-C||I>g+C)))return I}function wV(d,o){Hn(d,c=>{let r=c.gc,l=r.length/2,t;if(l>o){for(t=0;t<l;++t)delete c.data[r[t]];r.splice(0,l)}})}function o_(d){return d.drawTicks?d.tickLength:0}function vA(d,o){if(!d.display)return 0;let c=Yr(d.font,o),r=Co(d.padding);return(ur(d.text)?d.text.length:1)*c.lineHeight+r.height}function CV(d,o){return hc(d,{scale:o,type:"scale"})}function SV(d,o,c){return hc(d,{tick:c,index:o,type:"tick"})}function MV(d,o,c){let r=ky(d);return(c&&o!=="right"||!c&&o==="right")&&(r=vV(r)),r}function kV(d,o,c,r){let{top:l,left:t,bottom:g,right:C,chart:I}=d,{chartArea:O,scales:z}=I,q=0,ie,de,xe,Ie=g-l,Me=C-t;if(d.isHorizontal()){if(de=wo(r,t,C),un(c)){let Ge=Object.keys(c)[0],He=c[Ge];xe=z[Ge].getPixelForValue(He)+Ie-o}else c==="center"?xe=(O.bottom+O.top)/2+Ie-o:xe=_A(d,c,o);ie=C-t}else{if(un(c)){let Ge=Object.keys(c)[0],He=c[Ge];de=z[Ge].getPixelForValue(He)-Me+o}else c==="center"?de=(O.left+O.right)/2-Me+o:de=_A(d,c,o);xe=wo(r,g,l),q=c==="left"?-Or:Or}return{titleX:de,titleY:xe,maxWidth:ie,rotation:q}}var _u=class d extends Bs{constructor(o){super(),this.id=o.id,this.type=o.type,this.options=void 0,this.ctx=o.ctx,this.chart=o.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(o){this.options=o.setContext(this.getContext()),this.axis=o.axis,this._userMin=this.parse(o.min),this._userMax=this.parse(o.max),this._suggestedMin=this.parse(o.suggestedMin),this._suggestedMax=this.parse(o.suggestedMax)}parse(o,c){return o}getUserBounds(){let{_userMin:o,_userMax:c,_suggestedMin:r,_suggestedMax:l}=this;return o=ua(o,Number.POSITIVE_INFINITY),c=ua(c,Number.NEGATIVE_INFINITY),r=ua(r,Number.POSITIVE_INFINITY),l=ua(l,Number.NEGATIVE_INFINITY),{min:ua(o,r),max:ua(c,l),minDefined:Ir(o),maxDefined:Ir(c)}}getMinMax(o){let{min:c,max:r,minDefined:l,maxDefined:t}=this.getUserBounds(),g;if(l&&t)return{min:c,max:r};let C=this.getMatchingVisibleMetas();for(let I=0,O=C.length;I<O;++I)g=C[I].controller.getMinMax(this,o),l||(c=Math.min(c,g.min)),t||(r=Math.max(r,g.max));return c=t&&c>r?r:c,r=l&&c>r?c:r,{min:ua(c,ua(r,c)),max:ua(r,ua(c,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let o=this.chart.data;return this.options.labels||(this.isHorizontal()?o.xLabels:o.yLabels)||o.labels||[]}getLabelItems(o=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(o))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){nr(this.options.beforeUpdate,[this])}update(o,c,r){let{beginAtZero:l,grace:t,ticks:g}=this.options,C=g.sampleSize;this.beforeUpdate(),this.maxWidth=o,this.maxHeight=c,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=WD(this,t,l),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let I=C<this.ticks.length;this._convertTicksToLabels(I?yA(this.ticks,C):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),g.display&&(g.autoSkip||g.source==="auto")&&(this.ticks=pV(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),I&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let o=this.options.reverse,c,r;this.isHorizontal()?(c=this.left,r=this.right):(c=this.top,r=this.bottom,o=!o),this._startPixel=c,this._endPixel=r,this._reversePixels=o,this._length=r-c,this._alignToPixels=this.options.alignToPixels}afterUpdate(){nr(this.options.afterUpdate,[this])}beforeSetDimensions(){nr(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){nr(this.options.afterSetDimensions,[this])}_callHooks(o){this.chart.notifyPlugins(o,this.getContext()),nr(this.options[o],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){nr(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(o){let c=this.options.ticks,r,l,t;for(r=0,l=o.length;r<l;r++)t=o[r],t.label=nr(c.callback,[t.value,r,o],this)}afterTickToLabelConversion(){nr(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){nr(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let o=this.options,c=o.ticks,r=bA(this.ticks.length,o.ticks.maxTicksLimit),l=c.minRotation||0,t=c.maxRotation,g=l,C,I,O;if(!this._isVisible()||!c.display||l>=t||r<=1||!this.isHorizontal()){this.labelRotation=l;return}let z=this._getLabelSizes(),q=z.widest.width,ie=z.highest.height,de=no(this.chart.width-q,0,this.maxWidth);C=o.offset?this.maxWidth/r:de/(r-1),q+6>C&&(C=de/(r-(o.offset?.5:1)),I=this.maxHeight-o_(o.grid)-c.padding-vA(o.title,this.chart.options.font),O=Math.sqrt(q*q+ie*ie),g=Sy(Math.min(Math.asin(no((z.highest.height+6)/C,-1,1)),Math.asin(no(I/O,-1,1))-Math.asin(no(ie/O,-1,1)))),g=Math.max(l,Math.min(t,g))),this.labelRotation=g}afterCalculateLabelRotation(){nr(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){nr(this.options.beforeFit,[this])}fit(){let o={width:0,height:0},{chart:c,options:{ticks:r,title:l,grid:t}}=this,g=this._isVisible(),C=this.isHorizontal();if(g){let I=vA(l,c.options.font);if(C?(o.width=this.maxWidth,o.height=o_(t)+I):(o.height=this.maxHeight,o.width=o_(t)+I),r.display&&this.ticks.length){let{first:O,last:z,widest:q,highest:ie}=this._getLabelSizes(),de=r.padding*2,xe=os(this.labelRotation),Ie=Math.cos(xe),Me=Math.sin(xe);if(C){let Ge=r.mirror?0:Me*q.width+Ie*ie.height;o.height=Math.min(this.maxHeight,o.height+Ge+de)}else{let Ge=r.mirror?0:Ie*q.width+Me*ie.height;o.width=Math.min(this.maxWidth,o.width+Ge+de)}this._calculatePadding(O,z,Me,Ie)}}this._handleMargins(),C?(this.width=this._length=c.width-this._margins.left-this._margins.right,this.height=o.height):(this.width=o.width,this.height=this._length=c.height-this._margins.top-this._margins.bottom)}_calculatePadding(o,c,r,l){let{ticks:{align:t,padding:g},position:C}=this.options,I=this.labelRotation!==0,O=C!=="top"&&this.axis==="x";if(this.isHorizontal()){let z=this.getPixelForTick(0)-this.left,q=this.right-this.getPixelForTick(this.ticks.length-1),ie=0,de=0;I?O?(ie=l*o.width,de=r*c.height):(ie=r*o.height,de=l*c.width):t==="start"?de=c.width:t==="end"?ie=o.width:t!=="inner"&&(ie=o.width/2,de=c.width/2),this.paddingLeft=Math.max((ie-z+g)*this.width/(this.width-z),0),this.paddingRight=Math.max((de-q+g)*this.width/(this.width-q),0)}else{let z=c.height/2,q=o.height/2;t==="start"?(z=0,q=o.height):t==="end"&&(z=c.height,q=0),this.paddingTop=z+g,this.paddingBottom=q+g}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){nr(this.options.afterFit,[this])}isHorizontal(){let{axis:o,position:c}=this.options;return c==="top"||c==="bottom"||o==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(o){this.beforeTickToLabelConversion(),this.generateTickLabels(o);let c,r;for(c=0,r=o.length;c<r;c++)Sn(o[c].label)&&(o.splice(c,1),r--,c--);this.afterTickToLabelConversion()}_getLabelSizes(){let o=this._labelSizes;if(!o){let c=this.options.ticks.sampleSize,r=this.ticks;c<r.length&&(r=yA(r,c)),this._labelSizes=o=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return o}_computeLabelSizes(o,c,r){let{ctx:l,_longestTextCache:t}=this,g=[],C=[],I=Math.floor(c/bA(c,r)),O=0,z=0,q,ie,de,xe,Ie,Me,Ge,He,ht,Mt,yt;for(q=0;q<c;q+=I){if(xe=o[q].label,Ie=this._resolveTickFontOptions(q),l.font=Me=Ie.string,Ge=t[Me]=t[Me]||{data:{},gc:[]},He=Ie.lineHeight,ht=Mt=0,!Sn(xe)&&!ur(xe))ht=Qg(l,Ge.data,Ge.gc,ht,xe),Mt=He;else if(ur(xe))for(ie=0,de=xe.length;ie<de;++ie)yt=xe[ie],!Sn(yt)&&!ur(yt)&&(ht=Qg(l,Ge.data,Ge.gc,ht,yt),Mt+=He);g.push(ht),C.push(Mt),O=Math.max(ht,O),z=Math.max(Mt,z)}wV(t,c);let Tt=g.indexOf(O),Wt=C.indexOf(z),Ct=Yt=>({width:g[Yt]||0,height:C[Yt]||0});return{first:Ct(0),last:Ct(c-1),widest:Ct(Tt),highest:Ct(Wt),widths:g,heights:C}}getLabelForValue(o){return o}getPixelForValue(o,c){return NaN}getValueForPixel(o){}getPixelForTick(o){let c=this.ticks;return o<0||o>c.length-1?null:this.getPixelForValue(c[o].value)}getPixelForDecimal(o){this._reversePixels&&(o=1-o);let c=this._startPixel+o*this._length;return PD(this._alignToPixels?Nd(this.chart,c,0):c)}getDecimalForPixel(o){let c=(o-this._startPixel)/this._length;return this._reversePixels?1-c:c}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:o,max:c}=this;return o<0&&c<0?c:o>0&&c>0?o:0}getContext(o){let c=this.ticks||[];if(o>=0&&o<c.length){let r=c[o];return r.$context||(r.$context=SV(this.getContext(),o,r))}return this.$context||(this.$context=CV(this.chart.getContext(),this))}_tickSize(){let o=this.options.ticks,c=os(this.labelRotation),r=Math.abs(Math.cos(c)),l=Math.abs(Math.sin(c)),t=this._getLabelSizes(),g=o.autoSkipPadding||0,C=t?t.widest.width+g:0,I=t?t.highest.height+g:0;return this.isHorizontal()?I*r>C*l?C/r:I/l:I*l<C*r?I/r:C/l}_isVisible(){let o=this.options.display;return o!=="auto"?!!o:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(o){let c=this.axis,r=this.chart,l=this.options,{grid:t,position:g,border:C}=l,I=t.offset,O=this.isHorizontal(),q=this.ticks.length+(I?1:0),ie=o_(t),de=[],xe=C.setContext(this.getContext()),Ie=xe.display?xe.width:0,Me=Ie/2,Ge=function(rn){return Nd(r,rn,Ie)},He,ht,Mt,yt,Tt,Wt,Ct,Yt,zt,Ti,Hi,_r;if(g==="top")He=Ge(this.bottom),Wt=this.bottom-ie,Yt=He-Me,Ti=Ge(o.top)+Me,_r=o.bottom;else if(g==="bottom")He=Ge(this.top),Ti=o.top,_r=Ge(o.bottom)-Me,Wt=He+Me,Yt=this.top+ie;else if(g==="left")He=Ge(this.right),Tt=this.right-ie,Ct=He-Me,zt=Ge(o.left)+Me,Hi=o.right;else if(g==="right")He=Ge(this.left),zt=o.left,Hi=Ge(o.right)-Me,Tt=He+Me,Ct=this.left+ie;else if(c==="x"){if(g==="center")He=Ge((o.top+o.bottom)/2+.5);else if(un(g)){let rn=Object.keys(g)[0],Yn=g[rn];He=Ge(this.chart.scales[rn].getPixelForValue(Yn))}Ti=o.top,_r=o.bottom,Wt=He+Me,Yt=Wt+ie}else if(c==="y"){if(g==="center")He=Ge((o.left+o.right)/2);else if(un(g)){let rn=Object.keys(g)[0],Yn=g[rn];He=Ge(this.chart.scales[rn].getPixelForValue(Yn))}Tt=He-Me,Ct=Tt-ie,zt=o.left,Hi=o.right}let Ci=Zi(l.ticks.maxTicksLimit,q),mn=Math.max(1,Math.ceil(q/Ci));for(ht=0;ht<q;ht+=mn){let rn=this.getContext(ht),Yn=t.setContext(rn),Zr=C.setContext(rn),rr=Yn.lineWidth,Ei=Yn.color,ga=Zr.dash||[],or=Zr.dashOffset,La=Yn.tickWidth,Go=Yn.tickColor,Fa=Yn.tickBorderDash||[],Gt=Yn.tickBorderDashOffset;Mt=xV(this,ht,I),Mt!==void 0&&(yt=Nd(r,Mt,rr),O?Tt=Ct=zt=Hi=yt:Wt=Yt=Ti=_r=yt,de.push({tx1:Tt,ty1:Wt,tx2:Ct,ty2:Yt,x1:zt,y1:Ti,x2:Hi,y2:_r,width:rr,color:Ei,borderDash:ga,borderDashOffset:or,tickWidth:La,tickColor:Go,tickBorderDash:Fa,tickBorderDashOffset:Gt}))}return this._ticksLength=q,this._borderValue=He,de}_computeLabelItems(o){let c=this.axis,r=this.options,{position:l,ticks:t}=r,g=this.isHorizontal(),C=this.ticks,{align:I,crossAlign:O,padding:z,mirror:q}=t,ie=o_(r.grid),de=ie+z,xe=q?-z:de,Ie=-os(this.labelRotation),Me=[],Ge,He,ht,Mt,yt,Tt,Wt,Ct,Yt,zt,Ti,Hi,_r="middle";if(l==="top")Tt=this.bottom-xe,Wt=this._getXAxisLabelAlignment();else if(l==="bottom")Tt=this.top+xe,Wt=this._getXAxisLabelAlignment();else if(l==="left"){let mn=this._getYAxisLabelAlignment(ie);Wt=mn.textAlign,yt=mn.x}else if(l==="right"){let mn=this._getYAxisLabelAlignment(ie);Wt=mn.textAlign,yt=mn.x}else if(c==="x"){if(l==="center")Tt=(o.top+o.bottom)/2+de;else if(un(l)){let mn=Object.keys(l)[0],rn=l[mn];Tt=this.chart.scales[mn].getPixelForValue(rn)+de}Wt=this._getXAxisLabelAlignment()}else if(c==="y"){if(l==="center")yt=(o.left+o.right)/2-de;else if(un(l)){let mn=Object.keys(l)[0],rn=l[mn];yt=this.chart.scales[mn].getPixelForValue(rn)}Wt=this._getYAxisLabelAlignment(ie).textAlign}c==="y"&&(I==="start"?_r="top":I==="end"&&(_r="bottom"));let Ci=this._getLabelSizes();for(Ge=0,He=C.length;Ge<He;++Ge){ht=C[Ge],Mt=ht.label;let mn=t.setContext(this.getContext(Ge));Ct=this.getPixelForTick(Ge)+t.labelOffset,Yt=this._resolveTickFontOptions(Ge),zt=Yt.lineHeight,Ti=ur(Mt)?Mt.length:1;let rn=Ti/2,Yn=mn.color,Zr=mn.textStrokeColor,rr=mn.textStrokeWidth,Ei=Wt;g?(yt=Ct,Wt==="inner"&&(Ge===He-1?Ei=this.options.reverse?"left":"right":Ge===0?Ei=this.options.reverse?"right":"left":Ei="center"),l==="top"?O==="near"||Ie!==0?Hi=-Ti*zt+zt/2:O==="center"?Hi=-Ci.highest.height/2-rn*zt+zt:Hi=-Ci.highest.height+zt/2:O==="near"||Ie!==0?Hi=zt/2:O==="center"?Hi=Ci.highest.height/2-rn*zt:Hi=Ci.highest.height-Ti*zt,q&&(Hi*=-1),Ie!==0&&!mn.showLabelBackdrop&&(yt+=zt/2*Math.sin(Ie))):(Tt=Ct,Hi=(1-Ti)*zt/2);let ga;if(mn.showLabelBackdrop){let or=Co(mn.backdropPadding),La=Ci.heights[Ge],Go=Ci.widths[Ge],Fa=Hi-or.top,Gt=0-or.left;switch(_r){case"middle":Fa-=La/2;break;case"bottom":Fa-=La;break}switch(Wt){case"center":Gt-=Go/2;break;case"right":Gt-=Go;break;case"inner":Ge===He-1?Gt-=Go:Ge>0&&(Gt-=Go/2);break}ga={left:Gt,top:Fa,width:Go+or.width,height:La+or.height,color:mn.backdropColor}}Me.push({label:Mt,font:Yt,textOffset:Hi,options:{rotation:Ie,color:Yn,strokeColor:Zr,strokeWidth:rr,textAlign:Ei,textBaseline:_r,translation:[yt,Tt],backdrop:ga}})}return Me}_getXAxisLabelAlignment(){let{position:o,ticks:c}=this.options;if(-os(this.labelRotation))return o==="top"?"left":"right";let l="center";return c.align==="start"?l="left":c.align==="end"?l="right":c.align==="inner"&&(l="inner"),l}_getYAxisLabelAlignment(o){let{position:c,ticks:{crossAlign:r,mirror:l,padding:t}}=this.options,g=this._getLabelSizes(),C=o+t,I=g.widest.width,O,z;return c==="left"?l?(z=this.right+t,r==="near"?O="left":r==="center"?(O="center",z+=I/2):(O="right",z+=I)):(z=this.right-C,r==="near"?O="right":r==="center"?(O="center",z-=I/2):(O="left",z=this.left)):c==="right"?l?(z=this.left+t,r==="near"?O="right":r==="center"?(O="center",z-=I/2):(O="left",z-=I)):(z=this.left+C,r==="near"?O="left":r==="center"?(O="center",z+=I/2):(O="right",z=this.right)):O="right",{textAlign:O,x:z}}_computeLabelArea(){if(this.options.ticks.mirror)return;let o=this.chart,c=this.options.position;if(c==="left"||c==="right")return{top:0,left:this.left,bottom:o.height,right:this.right};if(c==="top"||c==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:o.width}}drawBackground(){let{ctx:o,options:{backgroundColor:c},left:r,top:l,width:t,height:g}=this;c&&(o.save(),o.fillStyle=c,o.fillRect(r,l,t,g),o.restore())}getLineWidthForValue(o){let c=this.options.grid;if(!this._isVisible()||!c.display)return 0;let l=this.ticks.findIndex(t=>t.value===o);return l>=0?c.setContext(this.getContext(l)).lineWidth:0}drawGrid(o){let c=this.options.grid,r=this.ctx,l=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(o)),t,g,C=(I,O,z)=>{!z.width||!z.color||(r.save(),r.lineWidth=z.width,r.strokeStyle=z.color,r.setLineDash(z.borderDash||[]),r.lineDashOffset=z.borderDashOffset,r.beginPath(),r.moveTo(I.x,I.y),r.lineTo(O.x,O.y),r.stroke(),r.restore())};if(c.display)for(t=0,g=l.length;t<g;++t){let I=l[t];c.drawOnChartArea&&C({x:I.x1,y:I.y1},{x:I.x2,y:I.y2},I),c.drawTicks&&C({x:I.tx1,y:I.ty1},{x:I.tx2,y:I.ty2},{color:I.tickColor,width:I.tickWidth,borderDash:I.tickBorderDash,borderDashOffset:I.tickBorderDashOffset})}}drawBorder(){let{chart:o,ctx:c,options:{border:r,grid:l}}=this,t=r.setContext(this.getContext()),g=r.display?t.width:0;if(!g)return;let C=l.setContext(this.getContext(0)).lineWidth,I=this._borderValue,O,z,q,ie;this.isHorizontal()?(O=Nd(o,this.left,g)-g/2,z=Nd(o,this.right,C)+C/2,q=ie=I):(q=Nd(o,this.top,g)-g/2,ie=Nd(o,this.bottom,C)+C/2,O=z=I),c.save(),c.lineWidth=t.width,c.strokeStyle=t.color,c.beginPath(),c.moveTo(O,q),c.lineTo(z,ie),c.stroke(),c.restore()}drawLabels(o){if(!this.options.ticks.display)return;let r=this.ctx,l=this._computeLabelArea();l&&e_(r,l);let t=this.getLabelItems(o);for(let g of t){let C=g.options,I=g.font,O=g.label,z=g.textOffset;Vd(r,O,0,z,I,C)}l&&t_(r)}drawTitle(){let{ctx:o,options:{position:c,title:r,reverse:l}}=this;if(!r.display)return;let t=Yr(r.font),g=Co(r.padding),C=r.align,I=t.lineHeight/2;c==="bottom"||c==="center"||un(c)?(I+=g.bottom,ur(r.text)&&(I+=t.lineHeight*(r.text.length-1))):I+=g.top;let{titleX:O,titleY:z,maxWidth:q,rotation:ie}=kV(this,I,c,C);Vd(o,r.text,0,0,t,{color:r.color,maxWidth:q,rotation:ie,textAlign:MV(C,c,l),textBaseline:"middle",translation:[O,z]})}draw(o){this._isVisible()&&(this.drawBackground(),this.drawGrid(o),this.drawBorder(),this.drawTitle(),this.drawLabels(o))}_layers(){let o=this.options,c=o.ticks&&o.ticks.z||0,r=Zi(o.grid&&o.grid.z,-1),l=Zi(o.border&&o.border.z,0);return!this._isVisible()||this.draw!==d.prototype.draw?[{z:c,draw:t=>{this.draw(t)}}]:[{z:r,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:l,draw:()=>{this.drawBorder()}},{z:c,draw:t=>{this.drawLabels(t)}}]}getMatchingVisibleMetas(o){let c=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",l=[],t,g;for(t=0,g=c.length;t<g;++t){let C=c[t];C[r]===this.id&&(!o||C.type===o)&&l.push(C)}return l}_resolveTickFontOptions(o){let c=this.options.ticks.setContext(this.getContext(o));return Yr(c.font)}_maxDigits(){let o=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/o}},xp=class{constructor(o,c,r){this.type=o,this.scope=c,this.override=r,this.items=Object.create(null)}isForType(o){return Object.prototype.isPrototypeOf.call(this.type.prototype,o.prototype)}register(o){let c=Object.getPrototypeOf(o),r;EV(c)&&(r=this.register(c));let l=this.items,t=o.id,g=this.scope+"."+t;if(!t)throw new Error("class does not have id: "+o);return t in l||(l[t]=o,IV(o,g,r),this.override&&Tr.override(o.id,o.overrides)),g}get(o){return this.items[o]}unregister(o){let c=this.items,r=o.id,l=this.scope;r in c&&delete c[r],l&&r in Tr[l]&&(delete Tr[l][r],this.override&&delete Bd[r])}};function IV(d,o,c){let r=hp(Object.create(null),[c?Tr.get(c):{},Tr.get(o),d.defaults]);Tr.set(o,r),d.defaultRoutes&&TV(o,d.defaultRoutes),d.descriptors&&Tr.describe(o,d.descriptors)}function TV(d,o){Object.keys(o).forEach(c=>{let r=c.split("."),l=r.pop(),t=[d].concat(r).join("."),g=o[c].split("."),C=g.pop(),I=g.join(".");Tr.route(t,l,I,C)})}function EV(d){return"id"in d&&"defaults"in d}var g2=class{constructor(){this.controllers=new xp(Hd,"datasets",!0),this.elements=new xp(Bs,"elements"),this.plugins=new xp(Object,"plugins"),this.scales=new xp(_u,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...o){this._each("register",o)}remove(...o){this._each("unregister",o)}addControllers(...o){this._each("register",o,this.controllers)}addElements(...o){this._each("register",o,this.elements)}addPlugins(...o){this._each("register",o,this.plugins)}addScales(...o){this._each("register",o,this.scales)}getController(o){return this._get(o,this.controllers,"controller")}getElement(o){return this._get(o,this.elements,"element")}getPlugin(o){return this._get(o,this.plugins,"plugin")}getScale(o){return this._get(o,this.scales,"scale")}removeControllers(...o){this._each("unregister",o,this.controllers)}removeElements(...o){this._each("unregister",o,this.elements)}removePlugins(...o){this._each("unregister",o,this.plugins)}removeScales(...o){this._each("unregister",o,this.scales)}_each(o,c,r){[...c].forEach(l=>{let t=r||this._getRegistryForType(l);r||t.isForType(l)||t===this.plugins&&l.id?this._exec(o,t,l):Hn(l,g=>{let C=r||this._getRegistryForType(g);this._exec(o,C,g)})})}_exec(o,c,r){let l=Cy(o);nr(r["before"+l],[],r),c[o](r),nr(r["after"+l],[],r)}_getRegistryForType(o){for(let c=0;c<this._typedRegistries.length;c++){let r=this._typedRegistries[c];if(r.isForType(o))return r}return this.plugins}_get(o,c,r){let l=c.get(o);if(l===void 0)throw new Error('"'+o+'" is not a registered '+r+".");return l}},bl=new g2,_2=class{constructor(){this._init=[]}notify(o,c,r,l){c==="beforeInit"&&(this._init=this._createDescriptors(o,!0),this._notify(this._init,o,"install"));let t=l?this._descriptors(o).filter(l):this._descriptors(o),g=this._notify(t,o,c,r);return c==="afterDestroy"&&(this._notify(t,o,"stop"),this._notify(this._init,o,"uninstall")),g}_notify(o,c,r,l){l=l||{};for(let t of o){let g=t.plugin,C=g[r],I=[c,l,t.options];if(nr(C,I,g)===!1&&l.cancelable)return!1}return!0}invalidate(){Sn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(o){if(this._cache)return this._cache;let c=this._cache=this._createDescriptors(o);return this._notifyStateChanges(o),c}_createDescriptors(o,c){let r=o&&o.config,l=Zi(r.options&&r.options.plugins,{}),t=DV(r);return l===!1&&!c?[]:PV(o,t,l,c)}_notifyStateChanges(o){let c=this._oldCache||[],r=this._cache,l=(t,g)=>t.filter(C=>!g.some(I=>C.plugin.id===I.plugin.id));this._notify(l(c,r),o,"stop"),this._notify(l(r,c),o,"start")}};function DV(d){let o={},c=[],r=Object.keys(bl.plugins.items);for(let t=0;t<r.length;t++)c.push(bl.getPlugin(r[t]));let l=d.plugins||[];for(let t=0;t<l.length;t++){let g=l[t];c.indexOf(g)===-1&&(c.push(g),o[g.id]=!0)}return{plugins:c,localIds:o}}function AV(d,o){return!o&&d===!1?null:d===!0?{}:d}function PV(d,{plugins:o,localIds:c},r,l){let t=[],g=d.getContext();for(let C of o){let I=C.id,O=AV(r[I],l);O!==null&&t.push({plugin:C,options:OV(d.config,{plugin:C,local:c[I]},O,g)})}return t}function OV(d,{plugin:o,local:c},r,l){let t=d.pluginScopeKeys(o),g=d.getOptionScopes(r,t);return c&&o.defaults&&g.push(o.defaults),d.createResolver(g,l,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function b2(d,o){let c=Tr.datasets[d]||{};return((o.datasets||{})[d]||{}).indexAxis||o.indexAxis||c.indexAxis||"x"}function RV(d,o){let c=d;return d==="_index_"?c=o:d==="_value_"&&(c=o==="x"?"y":"x"),c}function LV(d,o){return d===o?"_index_":"_value_"}function xA(d){if(d==="x"||d==="y"||d==="r")return d}function FV(d){if(d==="top"||d==="bottom")return"x";if(d==="left"||d==="right")return"y"}function y2(d,...o){if(xA(d))return d;for(let c of o){let r=c.axis||FV(c.position)||d.length>1&&xA(d[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${d}' axis. Please provide 'axis' or 'position' option.`)}function wA(d,o,c){if(c[o+"AxisID"]===d)return{axis:o}}function zV(d,o){if(o.data&&o.data.datasets){let c=o.data.datasets.filter(r=>r.xAxisID===d||r.yAxisID===d);if(c.length)return wA(d,"x",c[0])||wA(d,"y",c[0])}return{}}function BV(d,o){let c=Bd[d.type]||{scales:{}},r=o.scales||{},l=b2(d.type,o),t=Object.create(null);return Object.keys(r).forEach(g=>{let C=r[g];if(!un(C))return console.error(`Invalid scale configuration for scale: ${g}`);if(C._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${g}`);let I=y2(g,C,zV(g,d),Tr.scales[C.type]),O=LV(I,l),z=c.scales||{};t[g]=mp(Object.create(null),[{axis:I},C,z[I],z[O]])}),d.data.datasets.forEach(g=>{let C=g.type||d.type,I=g.indexAxis||b2(C,o),z=(Bd[C]||{}).scales||{};Object.keys(z).forEach(q=>{let ie=RV(q,I),de=g[ie+"AxisID"]||ie;t[de]=t[de]||Object.create(null),mp(t[de],[{axis:ie},r[de],z[q]])})}),Object.keys(t).forEach(g=>{let C=t[g];mp(C,[Tr.scales[C.type],Tr.scale])}),t}function cP(d){let o=d.options||(d.options={});o.plugins=Zi(o.plugins,{}),o.scales=BV(d,o)}function dP(d){return d=d||{},d.datasets=d.datasets||[],d.labels=d.labels||[],d}function NV(d){return d=d||{},d.data=dP(d.data),cP(d),d}var CA=new Map,hP=new Set;function Fy(d,o){let c=CA.get(d);return c||(c=o(),CA.set(d,c),hP.add(c)),c}var a_=(d,o,c)=>{let r=dc(o,c);r!==void 0&&d.add(r)},v2=class{constructor(o){this._config=NV(o),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(o){this._config.type=o}get data(){return this._config.data}set data(o){this._config.data=dP(o)}get options(){return this._config.options}set options(o){this._config.options=o}get plugins(){return this._config.plugins}update(){let o=this._config;this.clearCache(),cP(o)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(o){return Fy(o,()=>[[`datasets.${o}`,""]])}datasetAnimationScopeKeys(o,c){return Fy(`${o}.transition.${c}`,()=>[[`datasets.${o}.transitions.${c}`,`transitions.${c}`],[`datasets.${o}`,""]])}datasetElementScopeKeys(o,c){return Fy(`${o}-${c}`,()=>[[`datasets.${o}.elements.${c}`,`datasets.${o}`,`elements.${c}`,""]])}pluginScopeKeys(o){let c=o.id,r=this.type;return Fy(`${r}-plugin-${c}`,()=>[[`plugins.${c}`,...o.additionalOptionScopes||[]]])}_cachedScopes(o,c){let r=this._scopeCache,l=r.get(o);return(!l||c)&&(l=new Map,r.set(o,l)),l}getOptionScopes(o,c,r){let{options:l,type:t}=this,g=this._cachedScopes(o,r),C=g.get(c);if(C)return C;let I=new Set;c.forEach(z=>{o&&(I.add(o),z.forEach(q=>a_(I,o,q))),z.forEach(q=>a_(I,l,q)),z.forEach(q=>a_(I,Bd[t]||{},q)),z.forEach(q=>a_(I,Tr,q)),z.forEach(q=>a_(I,Iy,q))});let O=Array.from(I);return O.length===0&&O.push(Object.create(null)),hP.has(c)&&g.set(c,O),O}chartOptionScopes(){let{options:o,type:c}=this;return[o,Bd[c]||{},Tr.datasets[c]||{},{type:c},Tr,Iy]}resolveNamedOptions(o,c,r,l=[""]){let t={$shared:!0},{resolver:g,subPrefixes:C}=SA(this._resolverCache,o,l),I=g;if(jV(g,c)){t.$shared=!1,r=lc(r)?r():r;let O=this.createResolver(o,r,C);I=uu(g,r,O)}for(let O of c)t[O]=I[O];return t}createResolver(o,c,r=[""],l){let{resolver:t}=SA(this._resolverCache,o,r);return un(c)?uu(t,c,void 0,l):t}};function SA(d,o,c){let r=d.get(o);r||(r=new Map,d.set(o,r));let l=c.join(),t=r.get(l);return t||(t={resolver:Dy(o,c),subPrefixes:c.filter(C=>!C.toLowerCase().includes("hover"))},r.set(l,t)),t}var VV=d=>un(d)&&Object.getOwnPropertyNames(d).some(o=>lc(d[o]));function jV(d,o){let{isScriptable:c,isIndexable:r}=qC(d);for(let l of o){let t=c(l),g=r(l),C=(g||t)&&d[l];if(t&&(lc(C)||VV(C))||g&&ur(C))return!0}return!1}var UV="4.4.3",WV=["top","bottom","left","right","chartArea"];function MA(d,o){return d==="top"||d==="bottom"||WV.indexOf(d)===-1&&o==="x"}function kA(d,o){return function(c,r){return c[d]===r[d]?c[o]-r[o]:c[d]-r[d]}}function IA(d){let o=d.chart,c=o.options.animation;o.notifyPlugins("afterRender"),nr(c&&c.onComplete,[d],o)}function HV(d){let o=d.chart,c=o.options.animation;nr(c&&c.onProgress,[d],o)}function uP(d){return Ay()&&typeof d=="string"?d=document.getElementById(d):d&&d.length&&(d=d[0]),d&&d.canvas&&(d=d.canvas),d}var Uy={},TA=d=>{let o=uP(d);return Object.values(Uy).filter(c=>c.canvas===o).pop()};function GV(d,o,c){let r=Object.keys(d);for(let l of r){let t=+l;if(t>=o){let g=d[l];delete d[l],(c>0||t>o)&&(d[t+c]=g)}}}function qV(d,o,c,r){return!c||d.type==="mouseout"?null:r?o:d}function zy(d,o,c){return d.options.clip?d[c]:o[c]}function $V(d,o){let{xScale:c,yScale:r}=d;return c&&r?{left:zy(c,o,"left"),right:zy(c,o,"right"),top:zy(r,o,"top"),bottom:zy(r,o,"bottom")}:o}var Cp=(()=>{class d{static defaults=Tr;static instances=Uy;static overrides=Bd;static registry=bl;static version=UV;static getChart=TA;static register(...c){bl.add(...c),EA()}static unregister(...c){bl.remove(...c),EA()}constructor(c,r){let l=this.config=new v2(r),t=uP(c),g=TA(t);if(g)throw new Error("Canvas is already in use. Chart with ID '"+g.id+"' must be destroyed before the canvas with ID '"+g.canvas.id+"' can be reused.");let C=l.createResolver(l.chartOptionScopes(),this.getContext());this.platform=new(l.platform||mV(t)),this.platform.updateConfig(l);let I=this.platform.acquireContext(t,C.aspectRatio),O=I&&I.canvas,z=O&&O.height,q=O&&O.width;if(this.id=kD(),this.ctx=I,this.canvas=O,this.width=q,this.height=z,this._options=C,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new _2,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=zD(ie=>this.update(ie),C.resizeDelay||0),this._dataChanges=[],Uy[this.id]=this,!I||!O){console.error("Failed to create chart: can't acquire context from the given item");return}uc.listen(this,"complete",IA),uc.listen(this,"progress",HV),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:c,maintainAspectRatio:r},width:l,height:t,_aspectRatio:g}=this;return Sn(c)?r&&g?g:t?l/t:null:c}get data(){return this.config.data}set data(c){this.config.data=c}get options(){return this._options}set options(c){this.config.options=c}get registry(){return bl}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():XC(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return WC(this.canvas,this.ctx),this}stop(){return uc.stop(this),this}resize(c,r){uc.running(this)?this._resizeBeforeDraw={width:c,height:r}:this._resize(c,r)}_resize(c,r){let l=this.options,t=this.canvas,g=l.maintainAspectRatio&&this.aspectRatio,C=this.platform.getMaximumSize(t,c,r,g),I=l.devicePixelRatio||this.platform.getDevicePixelRatio(),O=this.width?"resize":"attach";this.width=C.width,this.height=C.height,this._aspectRatio=this.aspectRatio,XC(this,I,!0)&&(this.notifyPlugins("resize",{size:C}),nr(l.onResize,[this,C],this),this.attached&&this._doResize(O)&&this.render())}ensureScalesHaveIDs(){let r=this.options.scales||{};Hn(r,(l,t)=>{l.id=t})}buildOrUpdateScales(){let c=this.options,r=c.scales,l=this.scales,t=Object.keys(l).reduce((C,I)=>(C[I]=!1,C),{}),g=[];r&&(g=g.concat(Object.keys(r).map(C=>{let I=r[C],O=y2(C,I),z=O==="r",q=O==="x";return{options:I,dposition:z?"chartArea":q?"bottom":"left",dtype:z?"radialLinear":q?"category":"linear"}}))),Hn(g,C=>{let I=C.options,O=I.id,z=y2(O,I),q=Zi(I.type,C.dtype);(I.position===void 0||MA(I.position,z)!==MA(C.dposition))&&(I.position=C.dposition),t[O]=!0;let ie=null;if(O in l&&l[O].type===q)ie=l[O];else{let de=bl.getScale(q);ie=new de({id:O,type:q,ctx:this.ctx,chart:this}),l[ie.id]=ie}ie.init(I,c)}),Hn(t,(C,I)=>{C||delete l[I]}),Hn(l,C=>{Bo.configure(this,C,C.options),Bo.addBox(this,C)})}_updateMetasets(){let c=this._metasets,r=this.data.datasets.length,l=c.length;if(c.sort((t,g)=>t.index-g.index),l>r){for(let t=r;t<l;++t)this._destroyDatasetMeta(t);c.splice(r,l-r)}this._sortedMetasets=c.slice(0).sort(kA("order","index"))}_removeUnreferencedMetasets(){let{_metasets:c,data:{datasets:r}}=this;c.length>r.length&&delete this._stacks,c.forEach((l,t)=>{r.filter(g=>g===l._dataset).length===0&&this._destroyDatasetMeta(t)})}buildOrUpdateControllers(){let c=[],r=this.data.datasets,l,t;for(this._removeUnreferencedMetasets(),l=0,t=r.length;l<t;l++){let g=r[l],C=this.getDatasetMeta(l),I=g.type||this.config.type;if(C.type&&C.type!==I&&(this._destroyDatasetMeta(l),C=this.getDatasetMeta(l)),C.type=I,C.indexAxis=g.indexAxis||b2(I,this.options),C.order=g.order||0,C.index=l,C.label=""+g.label,C.visible=this.isDatasetVisible(l),C.controller)C.controller.updateIndex(l),C.controller.linkScales();else{let O=bl.getController(I),{datasetElementType:z,dataElementType:q}=Tr.datasets[I];Object.assign(O,{dataElementType:bl.getElement(q),datasetElementType:z&&bl.getElement(z)}),C.controller=new O(this,l),c.push(C.controller)}}return this._updateMetasets(),c}_resetElements(){Hn(this.data.datasets,(c,r)=>{this.getDatasetMeta(r).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(c){let r=this.config;r.update();let l=this._options=r.createResolver(r.chartOptionScopes(),this.getContext()),t=this._animationsDisabled=!l.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:c,cancelable:!0})===!1)return;let g=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let C=0;for(let z=0,q=this.data.datasets.length;z<q;z++){let{controller:ie}=this.getDatasetMeta(z),de=!t&&g.indexOf(ie)===-1;ie.buildOrUpdateElements(de),C=Math.max(+ie.getMaxOverflow(),C)}C=this._minPadding=l.layout.autoPadding?C:0,this._updateLayout(C),t||Hn(g,z=>{z.reset()}),this._updateDatasets(c),this.notifyPlugins("afterUpdate",{mode:c}),this._layers.sort(kA("z","_idx"));let{_active:I,_lastEvent:O}=this;O?this._eventHandler(O,!0):I.length&&this._updateHoverStyles(I,I,!0),this.render()}_updateScales(){Hn(this.scales,c=>{Bo.removeBox(this,c)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let c=this.options,r=new Set(Object.keys(this._listeners)),l=new Set(c.events);(!DC(r,l)||!!this._responsiveListeners!==c.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:c}=this,r=this._getUniformDataChanges()||[];for(let{method:l,start:t,count:g}of r){let C=l==="_removeElements"?-g:g;GV(c,t,C)}}_getUniformDataChanges(){let c=this._dataChanges;if(!c||!c.length)return;this._dataChanges=[];let r=this.data.datasets.length,l=g=>new Set(c.filter(C=>C[0]===g).map((C,I)=>I+","+C.splice(1).join(","))),t=l(0);for(let g=1;g<r;g++)if(!DC(t,l(g)))return;return Array.from(t).map(g=>g.split(",")).map(g=>({method:g[1],start:+g[2],count:+g[3]}))}_updateLayout(c){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Bo.update(this,this.width,this.height,c);let r=this.chartArea,l=r.width<=0||r.height<=0;this._layers=[],Hn(this.boxes,t=>{l&&t.position==="chartArea"||(t.configure&&t.configure(),this._layers.push(...t._layers()))},this),this._layers.forEach((t,g)=>{t._idx=g}),this.notifyPlugins("afterLayout")}_updateDatasets(c){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:c,cancelable:!0})!==!1){for(let r=0,l=this.data.datasets.length;r<l;++r)this.getDatasetMeta(r).controller.configure();for(let r=0,l=this.data.datasets.length;r<l;++r)this._updateDataset(r,lc(c)?c({datasetIndex:r}):c);this.notifyPlugins("afterDatasetsUpdate",{mode:c})}}_updateDataset(c,r){let l=this.getDatasetMeta(c),t={meta:l,index:c,mode:r,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",t)!==!1&&(l.controller._update(r),t.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",t))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(uc.has(this)?this.attached&&!uc.running(this)&&uc.start(this):(this.draw(),IA({chart:this})))}draw(){let c;if(this._resizeBeforeDraw){let{width:l,height:t}=this._resizeBeforeDraw;this._resize(l,t),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let r=this._layers;for(c=0;c<r.length&&r[c].z<=0;++c)r[c].draw(this.chartArea);for(this._drawDatasets();c<r.length;++c)r[c].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(c){let r=this._sortedMetasets,l=[],t,g;for(t=0,g=r.length;t<g;++t){let C=r[t];(!c||C.visible)&&l.push(C)}return l}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let c=this.getSortedVisibleDatasetMetas();for(let r=c.length-1;r>=0;--r)this._drawDataset(c[r]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(c){let r=this.ctx,l=c._clip,t=!l.disabled,g=$V(c,this.chartArea),C={meta:c,index:c.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",C)!==!1&&(t&&e_(r,{left:l.left===!1?0:g.left-l.left,right:l.right===!1?this.width:g.right+l.right,top:l.top===!1?0:g.top-l.top,bottom:l.bottom===!1?this.height:g.bottom+l.bottom}),c.controller.draw(),t&&t_(r),C.cancelable=!1,this.notifyPlugins("afterDatasetDraw",C))}isPointInArea(c){return pl(c,this.chartArea,this._minPadding)}getElementsAtEventForMode(c,r,l,t){let g=YN.modes[r];return typeof g=="function"?g(this,c,l,t):[]}getDatasetMeta(c){let r=this.data.datasets[c],l=this._metasets,t=l.filter(g=>g&&g._dataset===r).pop();return t||(t={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:r&&r.order||0,index:c,_dataset:r,_parsed:[],_sorted:!1},l.push(t)),t}getContext(){return this.$context||(this.$context=hc(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(c){let r=this.data.datasets[c];if(!r)return!1;let l=this.getDatasetMeta(c);return typeof l.hidden=="boolean"?!l.hidden:!r.hidden}setDatasetVisibility(c,r){let l=this.getDatasetMeta(c);l.hidden=!r}toggleDataVisibility(c){this._hiddenIndices[c]=!this._hiddenIndices[c]}getDataVisibility(c){return!this._hiddenIndices[c]}_updateVisibility(c,r,l){let t=l?"show":"hide",g=this.getDatasetMeta(c),C=g.controller._resolveAnimations(void 0,t);pp(r)?(g.data[r].hidden=!l,this.update()):(this.setDatasetVisibility(c,l),C.update(g,{visible:l}),this.update(I=>I.datasetIndex===c?t:void 0))}hide(c,r){this._updateVisibility(c,r,!1)}show(c,r){this._updateVisibility(c,r,!0)}_destroyDatasetMeta(c){let r=this._metasets[c];r&&r.controller&&r.controller._destroy(),delete this._metasets[c]}_stop(){let c,r;for(this.stop(),uc.remove(this),c=0,r=this.data.datasets.length;c<r;++c)this._destroyDatasetMeta(c)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:c,ctx:r}=this;this._stop(),this.config.clearCache(),c&&(this.unbindEvents(),WC(c,r),this.platform.releaseContext(r),this.canvas=null,this.ctx=null),delete Uy[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...c){return this.canvas.toDataURL(...c)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let c=this._listeners,r=this.platform,l=(g,C)=>{r.addEventListener(this,g,C),c[g]=C},t=(g,C,I)=>{g.offsetX=C,g.offsetY=I,this._eventHandler(g)};Hn(this.options.events,g=>l(g,t))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let c=this._responsiveListeners,r=this.platform,l=(O,z)=>{r.addEventListener(this,O,z),c[O]=z},t=(O,z)=>{c[O]&&(r.removeEventListener(this,O,z),delete c[O])},g=(O,z)=>{this.canvas&&this.resize(O,z)},C,I=()=>{t("attach",I),this.attached=!0,this.resize(),l("resize",g),l("detach",C)};C=()=>{this.attached=!1,t("resize",g),this._stop(),this._resize(0,0),l("attach",I)},r.isAttached(this.canvas)?I():C()}unbindEvents(){Hn(this._listeners,(c,r)=>{this.platform.removeEventListener(this,r,c)}),this._listeners={},Hn(this._responsiveListeners,(c,r)=>{this.platform.removeEventListener(this,r,c)}),this._responsiveListeners=void 0}updateHoverStyle(c,r,l){let t=l?"set":"remove",g,C,I,O;for(r==="dataset"&&(g=this.getDatasetMeta(c[0].datasetIndex),g.controller["_"+t+"DatasetHoverStyle"]()),I=0,O=c.length;I<O;++I){C=c[I];let z=C&&this.getDatasetMeta(C.datasetIndex).controller;z&&z[t+"HoverStyle"](C.element,C.datasetIndex,C.index)}}getActiveElements(){return this._active||[]}setActiveElements(c){let r=this._active||[],l=c.map(({datasetIndex:g,index:C})=>{let I=this.getDatasetMeta(g);if(!I)throw new Error("No dataset found at index "+g);return{datasetIndex:g,element:I.data[C],index:C}});!Kg(l,r)&&(this._active=l,this._lastEvent=null,this._updateHoverStyles(l,r))}notifyPlugins(c,r,l){return this._plugins.notify(this,c,r,l)}isPluginEnabled(c){return this._plugins._cache.filter(r=>r.plugin.id===c).length===1}_updateHoverStyles(c,r,l){let t=this.options.hover,g=(O,z)=>O.filter(q=>!z.some(ie=>q.datasetIndex===ie.datasetIndex&&q.index===ie.index)),C=g(r,c),I=l?c:g(c,r);C.length&&this.updateHoverStyle(C,t.mode,!1),I.length&&t.mode&&this.updateHoverStyle(I,t.mode,!0)}_eventHandler(c,r){let l={event:c,replay:r,cancelable:!0,inChartArea:this.isPointInArea(c)},t=C=>(C.options.events||this.options.events).includes(c.native.type);if(this.notifyPlugins("beforeEvent",l,t)===!1)return;let g=this._handleEvent(c,r,l.inChartArea);return l.cancelable=!1,this.notifyPlugins("afterEvent",l,t),(g||l.changed)&&this.render(),this}_handleEvent(c,r,l){let{_active:t=[],options:g}=this,C=r,I=this._getActiveElements(c,t,l,C),O=ED(c),z=qV(c,this._lastEvent,l,O);l&&(this._lastEvent=null,nr(g.onHover,[c,I,this],this),O&&nr(g.onClick,[c,I,this],this));let q=!Kg(I,t);return(q||r)&&(this._active=I,this._updateHoverStyles(I,t,r)),this._lastEvent=z,q}_getActiveElements(c,r,l,t){if(c.type==="mouseout")return[];if(!l)return r;let g=this.options.hover;return this.getElementsAtEventForMode(c,g.mode,g,t)}}return d})();function EA(){return Hn(Cp.instances,d=>d._plugins.invalidate())}function YV(d,o,c){let{startAngle:r,pixelMargin:l,x:t,y:g,outerRadius:C,innerRadius:I}=o,O=l/C;d.beginPath(),d.arc(t,g,C,r-O,c+O),I>l?(O=l/I,d.arc(t,g,I,c+O,r-O,!0)):d.arc(t,g,l,c+Or,r-Or),d.closePath(),d.clip()}function ZV(d){return Ey(d,["outerStart","outerEnd","innerStart","innerEnd"])}function XV(d,o,c,r){let l=ZV(d.options.borderRadius),t=(c-o)/2,g=Math.min(t,r*o/2),C=I=>{let O=(c-Math.min(t,I))*r/2;return no(I,0,Math.min(t,O))};return{outerStart:C(l.outerStart),outerEnd:C(l.outerEnd),innerStart:no(l.innerStart,0,g),innerEnd:no(l.innerEnd,0,g)}}function vp(d,o,c,r){return{x:c+d*Math.cos(o),y:r+d*Math.sin(o)}}function qy(d,o,c,r,l,t){let{x:g,y:C,startAngle:I,pixelMargin:O,innerRadius:z}=o,q=Math.max(o.outerRadius+r+c-O,0),ie=z>0?z+r+c+O:0,de=0,xe=l-I;if(r){let mn=z>0?z-r:0,rn=q>0?q-r:0,Yn=(mn+rn)/2,Zr=Yn!==0?xe*Yn/(Yn+r):xe;de=(xe-Zr)/2}let Ie=Math.max(.001,xe*q-c/mr)/q,Me=(xe-Ie)/2,Ge=I+Me+de,He=l-Me-de,{outerStart:ht,outerEnd:Mt,innerStart:yt,innerEnd:Tt}=XV(o,ie,q,He-Ge),Wt=q-ht,Ct=q-Mt,Yt=Ge+ht/Wt,zt=He-Mt/Ct,Ti=ie+yt,Hi=ie+Tt,_r=Ge+yt/Ti,Ci=He-Tt/Hi;if(d.beginPath(),t){let mn=(Yt+zt)/2;if(d.arc(g,C,q,Yt,mn),d.arc(g,C,q,mn,zt),Mt>0){let rr=vp(Ct,zt,g,C);d.arc(rr.x,rr.y,Mt,zt,He+Or)}let rn=vp(Hi,He,g,C);if(d.lineTo(rn.x,rn.y),Tt>0){let rr=vp(Hi,Ci,g,C);d.arc(rr.x,rr.y,Tt,He+Or,Ci+Math.PI)}let Yn=(He-Tt/ie+(Ge+yt/ie))/2;if(d.arc(g,C,ie,He-Tt/ie,Yn,!0),d.arc(g,C,ie,Yn,Ge+yt/ie,!0),yt>0){let rr=vp(Ti,_r,g,C);d.arc(rr.x,rr.y,yt,_r+Math.PI,Ge-Or)}let Zr=vp(Wt,Ge,g,C);if(d.lineTo(Zr.x,Zr.y),ht>0){let rr=vp(Wt,Yt,g,C);d.arc(rr.x,rr.y,ht,Ge-Or,Yt)}}else{d.moveTo(g,C);let mn=Math.cos(Yt)*q+g,rn=Math.sin(Yt)*q+C;d.lineTo(mn,rn);let Yn=Math.cos(zt)*q+g,Zr=Math.sin(zt)*q+C;d.lineTo(Yn,Zr)}d.closePath()}function QV(d,o,c,r,l){let{fullCircles:t,startAngle:g,circumference:C}=o,I=o.endAngle;if(t){qy(d,o,c,r,I,l);for(let O=0;O<t;++O)d.fill();isNaN(C)||(I=g+(C%pr||pr))}return qy(d,o,c,r,I,l),d.fill(),I}function KV(d,o,c,r,l){let{fullCircles:t,startAngle:g,circumference:C,options:I}=o,{borderWidth:O,borderJoinStyle:z,borderDash:q,borderDashOffset:ie}=I,de=I.borderAlign==="inner";if(!O)return;d.setLineDash(q||[]),d.lineDashOffset=ie,de?(d.lineWidth=O*2,d.lineJoin=z||"round"):(d.lineWidth=O,d.lineJoin=z||"bevel");let xe=o.endAngle;if(t){qy(d,o,c,r,xe,l);for(let Ie=0;Ie<t;++Ie)d.stroke();isNaN(C)||(xe=g+(C%pr||pr))}de&&YV(d,o,xe),t||(qy(d,o,c,r,xe,l),d.stroke())}var x2=class extends Bs{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:o=>o!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(o){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,o&&Object.assign(this,o)}inRange(o,c,r){let l=this.getProps(["x","y"],r),{angle:t,distance:g}=RC(l,{x:o,y:c}),{startAngle:C,endAngle:I,innerRadius:O,outerRadius:z,circumference:q}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],r),ie=(this.options.spacing+this.options.borderWidth)/2,xe=Zi(q,I-C)>=pr||gp(t,C,I),Ie=gl(g,O+ie,z+ie);return xe&&Ie}getCenterPoint(o){let{x:c,y:r,startAngle:l,endAngle:t,innerRadius:g,outerRadius:C}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],o),{offset:I,spacing:O}=this.options,z=(l+t)/2,q=(g+C+O+I)/2;return{x:c+Math.cos(z)*q,y:r+Math.sin(z)*q}}tooltipPosition(o){return this.getCenterPoint(o)}draw(o){let{options:c,circumference:r}=this,l=(c.offset||0)/4,t=(c.spacing||0)/2,g=c.circular;if(this.pixelMargin=c.borderAlign==="inner"?.33:0,this.fullCircles=r>pr?Math.floor(r/pr):0,r===0||this.innerRadius<0||this.outerRadius<0)return;o.save();let C=(this.startAngle+this.endAngle)/2;o.translate(Math.cos(C)*l,Math.sin(C)*l);let I=1-Math.sin(Math.min(mr,r||0)),O=l*I;o.fillStyle=c.backgroundColor,o.strokeStyle=c.borderColor,QV(o,this,O,t,g),KV(o,this,O,t,g),o.restore()}};function mP(d,o,c=o){d.lineCap=Zi(c.borderCapStyle,o.borderCapStyle),d.setLineDash(Zi(c.borderDash,o.borderDash)),d.lineDashOffset=Zi(c.borderDashOffset,o.borderDashOffset),d.lineJoin=Zi(c.borderJoinStyle,o.borderJoinStyle),d.lineWidth=Zi(c.borderWidth,o.borderWidth),d.strokeStyle=Zi(c.borderColor,o.borderColor)}function JV(d,o,c){d.lineTo(c.x,c.y)}function ej(d){return d.stepped?jD:d.tension||d.cubicInterpolationMode==="monotone"?UD:JV}function pP(d,o,c={}){let r=d.length,{start:l=0,end:t=r-1}=c,{start:g,end:C}=o,I=Math.max(l,g),O=Math.min(t,C),z=l<g&&t<g||l>C&&t>C;return{count:r,start:I,loop:o.loop,ilen:O<I&&!z?r+O-I:O-I}}function tj(d,o,c,r){let{points:l,options:t}=o,{count:g,start:C,loop:I,ilen:O}=pP(l,c,r),z=ej(t),{move:q=!0,reverse:ie}=r||{},de,xe,Ie;for(de=0;de<=O;++de)xe=l[(C+(ie?O-de:de))%g],!xe.skip&&(q?(d.moveTo(xe.x,xe.y),q=!1):z(d,Ie,xe,ie,t.stepped),Ie=xe);return I&&(xe=l[(C+(ie?O:0))%g],z(d,Ie,xe,ie,t.stepped)),!!I}function ij(d,o,c,r){let l=o.points,{count:t,start:g,ilen:C}=pP(l,c,r),{move:I=!0,reverse:O}=r||{},z=0,q=0,ie,de,xe,Ie,Me,Ge,He=Mt=>(g+(O?C-Mt:Mt))%t,ht=()=>{Ie!==Me&&(d.lineTo(z,Me),d.lineTo(z,Ie),d.lineTo(z,Ge))};for(I&&(de=l[He(0)],d.moveTo(de.x,de.y)),ie=0;ie<=C;++ie){if(de=l[He(ie)],de.skip)continue;let Mt=de.x,yt=de.y,Tt=Mt|0;Tt===xe?(yt<Ie?Ie=yt:yt>Me&&(Me=yt),z=(q*z+Mt)/++q):(ht(),d.lineTo(Mt,yt),xe=Tt,q=0,Ie=Me=yt),Ge=yt}ht()}function w2(d){let o=d.options,c=o.borderDash&&o.borderDash.length;return!d._decimated&&!d._loop&&!o.tension&&o.cubicInterpolationMode!=="monotone"&&!o.stepped&&!c?ij:tj}function nj(d){return d.stepped?QD:d.tension||d.cubicInterpolationMode==="monotone"?KD:zd}function rj(d,o,c,r){let l=o._path;l||(l=o._path=new Path2D,o.path(l,c,r)&&l.closePath()),mP(d,o.options),d.stroke(l)}function oj(d,o,c,r){let{segments:l,options:t}=o,g=w2(o);for(let C of l)mP(d,t,C.style),d.beginPath(),g(d,o,C,{start:c,end:c+r-1})&&d.closePath(),d.stroke()}var aj=typeof Path2D=="function";function sj(d,o,c,r){aj&&!o.options.segment?rj(d,o,c,r):oj(d,o,c,r)}var Zy=(()=>{class d extends Bs{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:c=>c!=="borderDash"&&c!=="fill"};constructor(c){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,c&&Object.assign(this,c)}updateControlPoints(c,r){let l=this.options;if((l.tension||l.cubicInterpolationMode==="monotone")&&!l.stepped&&!this._pointsUpdated){let t=l.spanGaps?this._loop:this._fullLoop;YD(this._points,l,c,t,r),this._pointsUpdated=!0}}set points(c){this._points=c,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=eA(this,this.options.segment))}first(){let c=this.segments,r=this.points;return c.length&&r[c[0].start]}last(){let c=this.segments,r=this.points,l=c.length;return l&&r[c[l-1].end]}interpolate(c,r){let l=this.options,t=c[r],g=this.points,C=t2(this,{property:r,start:t,end:t});if(!C.length)return;let I=[],O=nj(l),z,q;for(z=0,q=C.length;z<q;++z){let{start:ie,end:de}=C[z],xe=g[ie],Ie=g[de];if(xe===Ie){I.push(xe);continue}let Me=Math.abs((t-xe[r])/(Ie[r]-xe[r])),Ge=O(xe,Ie,Me,l.stepped);Ge[r]=c[r],I.push(Ge)}return I.length===1?I[0]:I}pathSegment(c,r,l){return w2(this)(c,this,r,l)}path(c,r,l){let t=this.segments,g=w2(this),C=this._loop;r=r||0,l=l||this.points.length-r;for(let I of t)C&=g(c,this,I,{start:r,end:r+l-1});return!!C}draw(c,r,l,t){let g=this.options||{};(this.points||[]).length&&g.borderWidth&&(c.save(),sj(c,this,l,t),c.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return d})();function DA(d,o,c,r){let l=d.options,{[c]:t}=d.getProps([c],r);return Math.abs(o-t)<l.radius+l.hitRadius}var lj=(()=>{class d extends Bs{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(c){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,c&&Object.assign(this,c)}inRange(c,r,l){let t=this.options,{x:g,y:C}=this.getProps(["x","y"],l);return Math.pow(c-g,2)+Math.pow(r-C,2)<Math.pow(t.hitRadius+t.radius,2)}inXRange(c,r){return DA(this,c,"x",r)}inYRange(c,r){return DA(this,c,"y",r)}getCenterPoint(c){let{x:r,y:l}=this.getProps(["x","y"],c);return{x:r,y:l}}size(c){c=c||this.options||{};let r=c.radius||0;r=Math.max(r,r&&c.hoverRadius||0);let l=r&&c.borderWidth||0;return(r+l)*2}draw(c,r){let l=this.options;this.skip||l.radius<.1||!pl(this,r,this.size(l)/2)||(c.strokeStyle=l.borderColor,c.lineWidth=l.borderWidth,c.fillStyle=l.backgroundColor,Ty(c,l,this.x,this.y))}getRange(){let c=this.options||{};return c.radius+c.hitRadius}}return d})();function fP(d,o){let{x:c,y:r,base:l,width:t,height:g}=d.getProps(["x","y","base","width","height"],o),C,I,O,z,q;return d.horizontal?(q=g/2,C=Math.min(c,l),I=Math.max(c,l),O=r-q,z=r+q):(q=t/2,C=c-q,I=c+q,O=Math.min(r,l),z=Math.max(r,l)),{left:C,top:O,right:I,bottom:z}}function Wd(d,o,c,r){return d?0:no(o,c,r)}function cj(d,o,c){let r=d.options.borderWidth,l=d.borderSkipped,t=GC(r);return{t:Wd(l.top,t.top,0,c),r:Wd(l.right,t.right,0,o),b:Wd(l.bottom,t.bottom,0,c),l:Wd(l.left,t.left,0,o)}}function dj(d,o,c){let{enableBorderRadius:r}=d.getProps(["enableBorderRadius"]),l=d.options.borderRadius,t=jd(l),g=Math.min(o,c),C=d.borderSkipped,I=r||un(l);return{topLeft:Wd(!I||C.top||C.left,t.topLeft,0,g),topRight:Wd(!I||C.top||C.right,t.topRight,0,g),bottomLeft:Wd(!I||C.bottom||C.left,t.bottomLeft,0,g),bottomRight:Wd(!I||C.bottom||C.right,t.bottomRight,0,g)}}function hj(d){let o=fP(d),c=o.right-o.left,r=o.bottom-o.top,l=cj(d,c/2,r/2),t=dj(d,c/2,r/2);return{outer:{x:o.left,y:o.top,w:c,h:r,radius:t},inner:{x:o.left+l.l,y:o.top+l.t,w:c-l.l-l.r,h:r-l.t-l.b,radius:{topLeft:Math.max(0,t.topLeft-Math.max(l.t,l.l)),topRight:Math.max(0,t.topRight-Math.max(l.t,l.r)),bottomLeft:Math.max(0,t.bottomLeft-Math.max(l.b,l.l)),bottomRight:Math.max(0,t.bottomRight-Math.max(l.b,l.r))}}}}function l2(d,o,c,r){let l=o===null,t=c===null,C=d&&!(l&&t)&&fP(d,r);return C&&(l||gl(o,C.left,C.right))&&(t||gl(c,C.top,C.bottom))}function uj(d){return d.topLeft||d.topRight||d.bottomLeft||d.bottomRight}function mj(d,o){d.rect(o.x,o.y,o.w,o.h)}function c2(d,o,c={}){let r=d.x!==c.x?-o:0,l=d.y!==c.y?-o:0,t=(d.x+d.w!==c.x+c.w?o:0)-r,g=(d.y+d.h!==c.y+c.h?o:0)-l;return{x:d.x+r,y:d.y+l,w:d.w+t,h:d.h+g,radius:d.radius}}var C2=class extends Bs{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(o){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,o&&Object.assign(this,o)}draw(o){let{inflateAmount:c,options:{borderColor:r,backgroundColor:l}}=this,{inner:t,outer:g}=hj(this),C=uj(g.radius)?bp:mj;o.save(),(g.w!==t.w||g.h!==t.h)&&(o.beginPath(),C(o,c2(g,c,t)),o.clip(),C(o,c2(t,-c,g)),o.fillStyle=r,o.fill("evenodd")),o.beginPath(),C(o,c2(t,c)),o.fillStyle=l,o.fill(),o.restore()}inRange(o,c,r){return l2(this,o,c,r)}inXRange(o,c){return l2(this,o,null,c)}inYRange(o,c){return l2(this,null,o,c)}getCenterPoint(o){let{x:c,y:r,base:l,horizontal:t}=this.getProps(["x","y","base","horizontal"],o);return{x:t?(c+l)/2:c,y:t?r:(r+l)/2}}getRange(o){return o==="x"?this.width/2:this.height/2}},pj=Object.freeze({__proto__:null,ArcElement:x2,BarElement:C2,LineElement:Zy,PointElement:lj}),S2=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],AA=S2.map(d=>d.replace("rgb(","rgba(").replace(")",", 0.5)"));function gP(d){return S2[d%S2.length]}function _P(d){return AA[d%AA.length]}function fj(d,o){return d.borderColor=gP(o),d.backgroundColor=_P(o),++o}function gj(d,o){return d.backgroundColor=d.data.map(()=>gP(o++)),o}function _j(d,o){return d.backgroundColor=d.data.map(()=>_P(o++)),o}function bj(d){let o=0;return(c,r)=>{let l=d.getDatasetMeta(r).controller;l instanceof P2?o=gj(c,o):l instanceof rP?o=_j(c,o):l&&(o=fj(c,o))}}function PA(d){let o;for(o in d)if(d[o].borderColor||d[o].backgroundColor)return!0;return!1}function yj(d){return d&&(d.borderColor||d.backgroundColor)}var vj={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(d,o,c){if(!c.enabled)return;let{data:{datasets:r},options:l}=d.config,{elements:t}=l;if(!c.forceOverride&&(PA(r)||yj(l)||t&&PA(t)))return;let g=bj(d);r.forEach(g)}};function xj(d,o,c,r,l){let t=l.samples||r;if(t>=c)return d.slice(o,o+c);let g=[],C=(c-2)/(t-2),I=0,O=o+c-1,z=o,q,ie,de,xe,Ie;for(g[I++]=d[z],q=0;q<t-2;q++){let Me=0,Ge=0,He,ht=Math.floor((q+1)*C)+1+o,Mt=Math.min(Math.floor((q+2)*C)+1,c)+o,yt=Mt-ht;for(He=ht;He<Mt;He++)Me+=d[He].x,Ge+=d[He].y;Me/=yt,Ge/=yt;let Tt=Math.floor(q*C)+1+o,Wt=Math.min(Math.floor((q+1)*C)+1,c)+o,{x:Ct,y:Yt}=d[z];for(de=xe=-1,He=Tt;He<Wt;He++)xe=.5*Math.abs((Ct-Me)*(d[He].y-Yt)-(Ct-d[He].x)*(Ge-Yt)),xe>de&&(de=xe,ie=d[He],Ie=He);g[I++]=ie,z=Ie}return g[I++]=d[O],g}function wj(d,o,c,r){let l=0,t=0,g,C,I,O,z,q,ie,de,xe,Ie,Me=[],Ge=o+c-1,He=d[o].x,Mt=d[Ge].x-He;for(g=o;g<o+c;++g){C=d[g],I=(C.x-He)/Mt*r,O=C.y;let yt=I|0;if(yt===z)O<xe?(xe=O,q=g):O>Ie&&(Ie=O,ie=g),l=(t*l+C.x)/++t;else{let Tt=g-1;if(!Sn(q)&&!Sn(ie)){let Wt=Math.min(q,ie),Ct=Math.max(q,ie);Wt!==de&&Wt!==Tt&&Me.push(ia(Xi({},d[Wt]),{x:l})),Ct!==de&&Ct!==Tt&&Me.push(ia(Xi({},d[Ct]),{x:l}))}g>0&&Tt!==de&&Me.push(d[Tt]),Me.push(C),z=yt,t=0,xe=Ie=O,q=ie=de=g}}return Me}function bP(d){if(d._decimated){let o=d._data;delete d._decimated,delete d._data,Object.defineProperty(d,"data",{configurable:!0,enumerable:!0,writable:!0,value:o})}}function OA(d){d.data.datasets.forEach(o=>{bP(o)})}function Cj(d,o){let c=o.length,r=0,l,{iScale:t}=d,{min:g,max:C,minDefined:I,maxDefined:O}=t.getUserBounds();return I&&(r=no(ml(o,t.axis,g).lo,0,c-1)),O?l=no(ml(o,t.axis,C).hi+1,r,c)-r:l=c-r,{start:r,count:l}}var Sj={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(d,o,c)=>{if(!c.enabled){OA(d);return}let r=d.width;d.data.datasets.forEach((l,t)=>{let{_data:g,indexAxis:C}=l,I=d.getDatasetMeta(t),O=g||l.data;if(yp([C,d.options.indexAxis])==="y"||!I.controller.supportsDecimation)return;let z=d.scales[I.xAxisID];if(z.type!=="linear"&&z.type!=="time"||d.options.parsing)return;let{start:q,count:ie}=Cj(I,O),de=c.threshold||4*r;if(ie<=de){bP(l);return}Sn(g)&&(l._data=O,delete l.data,Object.defineProperty(l,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(Ie){this._data=Ie}}));let xe;switch(c.algorithm){case"lttb":xe=xj(O,q,ie,r,c);break;case"min-max":xe=wj(O,q,ie,r);break;default:throw new Error(`Unsupported decimation algorithm '${c.algorithm}'`)}l._decimated=xe})},destroy(d){OA(d)}};function Mj(d,o,c){let r=d.segments,l=d.points,t=o.points,g=[];for(let C of r){let{start:I,end:O}=C;O=O2(I,O,l);let z=M2(c,l[I],l[O],C.loop);if(!o.segments){g.push({source:C,target:z,start:l[I],end:l[O]});continue}let q=t2(o,z);for(let ie of q){let de=M2(c,t[ie.start],t[ie.end],ie.loop),xe=e2(C,l,de);for(let Ie of xe)g.push({source:Ie,target:ie,start:{[c]:RA(z,de,"start",Math.max)},end:{[c]:RA(z,de,"end",Math.min)}})}}return g}function M2(d,o,c,r){if(r)return;let l=o[d],t=c[d];return d==="angle"&&(l=ha(l),t=ha(t)),{property:d,start:l,end:t}}function kj(d,o){let{x:c=null,y:r=null}=d||{},l=o.points,t=[];return o.segments.forEach(({start:g,end:C})=>{C=O2(g,C,l);let I=l[g],O=l[C];r!==null?(t.push({x:I.x,y:r}),t.push({x:O.x,y:r})):c!==null&&(t.push({x:c,y:I.y}),t.push({x:c,y:O.y}))}),t}function O2(d,o,c){for(;o>d;o--){let r=c[o];if(!isNaN(r.x)&&!isNaN(r.y))break}return o}function RA(d,o,c,r){return d&&o?r(d[c],o[c]):d?d[c]:o?o[c]:0}function yP(d,o){let c=[],r=!1;return ur(d)?(r=!0,c=d):c=kj(d,o),c.length?new Zy({points:c,options:{tension:0},_loop:r,_fullLoop:r}):null}function LA(d){return d&&d.fill!==!1}function Ij(d,o,c){let l=d[o].fill,t=[o],g;if(!c)return l;for(;l!==!1&&t.indexOf(l)===-1;){if(!Ir(l))return l;if(g=d[l],!g)return!1;if(g.visible)return l;t.push(l),l=g.fill}return!1}function Tj(d,o,c){let r=Pj(d);if(un(r))return isNaN(r.value)?!1:r;let l=parseFloat(r);return Ir(l)&&Math.floor(l)===l?Ej(r[0],o,l,c):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function Ej(d,o,c,r){return(d==="-"||d==="+")&&(c=o+c),c===o||c<0||c>=r?!1:c}function Dj(d,o){let c=null;return d==="start"?c=o.bottom:d==="end"?c=o.top:un(d)?c=o.getPixelForValue(d.value):o.getBasePixel&&(c=o.getBasePixel()),c}function Aj(d,o,c){let r;return d==="start"?r=c:d==="end"?r=o.options.reverse?o.min:o.max:un(d)?r=d.value:r=o.getBaseValue(),r}function Pj(d){let o=d.options,c=o.fill,r=Zi(c&&c.target,c);return r===void 0&&(r=!!o.backgroundColor),r===!1||r===null?!1:r===!0?"origin":r}function Oj(d){let{scale:o,index:c,line:r}=d,l=[],t=r.segments,g=r.points,C=Rj(o,c);C.push(yP({x:null,y:o.bottom},r));for(let I=0;I<t.length;I++){let O=t[I];for(let z=O.start;z<=O.end;z++)Lj(l,g[z],C)}return new Zy({points:l,options:{}})}function Rj(d,o){let c=[],r=d.getMatchingVisibleMetas("line");for(let l=0;l<r.length;l++){let t=r[l];if(t.index===o)break;t.hidden||c.unshift(t.dataset)}return c}function Lj(d,o,c){let r=[];for(let l=0;l<c.length;l++){let t=c[l],{first:g,last:C,point:I}=Fj(t,o,"x");if(!(!I||g&&C)){if(g)r.unshift(I);else if(d.push(I),!C)break}}d.push(...r)}function Fj(d,o,c){let r=d.interpolate(o,c);if(!r)return{};let l=r[c],t=d.segments,g=d.points,C=!1,I=!1;for(let O=0;O<t.length;O++){let z=t[O],q=g[z.start][c],ie=g[z.end][c];if(gl(l,q,ie)){C=l===q,I=l===ie;break}}return{first:C,last:I,point:r}}var $y=class{constructor(o){this.x=o.x,this.y=o.y,this.radius=o.radius}pathSegment(o,c,r){let{x:l,y:t,radius:g}=this;return c=c||{start:0,end:pr},o.arc(l,t,g,c.end,c.start,!0),!r.bounds}interpolate(o){let{x:c,y:r,radius:l}=this,t=o.angle;return{x:c+Math.cos(t)*l,y:r+Math.sin(t)*l,angle:t}}};function zj(d){let{chart:o,fill:c,line:r}=d;if(Ir(c))return Bj(o,c);if(c==="stack")return Oj(d);if(c==="shape")return!0;let l=Nj(d);return l instanceof $y?l:yP(l,r)}function Bj(d,o){let c=d.getDatasetMeta(o);return c&&d.isDatasetVisible(o)?c.dataset:null}function Nj(d){return(d.scale||{}).getPointPositionForValue?jj(d):Vj(d)}function Vj(d){let{scale:o={},fill:c}=d,r=Dj(c,o);if(Ir(r)){let l=o.isHorizontal();return{x:l?r:null,y:l?null:r}}return null}function jj(d){let{scale:o,fill:c}=d,r=o.options,l=o.getLabels().length,t=r.reverse?o.max:o.min,g=Aj(c,o,t),C=[];if(r.grid.circular){let I=o.getPointPositionForValue(0,t);return new $y({x:I.x,y:I.y,radius:o.getDistanceFromCenterForValue(g)})}for(let I=0;I<l;++I)C.push(o.getPointPositionForValue(I,g));return C}function d2(d,o,c){let r=zj(o),{line:l,scale:t,axis:g}=o,C=l.options,I=C.fill,O=C.backgroundColor,{above:z=O,below:q=O}=I||{};r&&l.points.length&&(e_(d,c),Uj(d,{line:l,target:r,above:z,below:q,area:c,scale:t,axis:g}),t_(d))}function Uj(d,o){let{line:c,target:r,above:l,below:t,area:g,scale:C}=o,I=c._loop?"angle":o.axis;d.save(),I==="x"&&t!==l&&(FA(d,r,g.top),zA(d,{line:c,target:r,color:l,scale:C,property:I}),d.restore(),d.save(),FA(d,r,g.bottom)),zA(d,{line:c,target:r,color:t,scale:C,property:I}),d.restore()}function FA(d,o,c){let{segments:r,points:l}=o,t=!0,g=!1;d.beginPath();for(let C of r){let{start:I,end:O}=C,z=l[I],q=l[O2(I,O,l)];t?(d.moveTo(z.x,z.y),t=!1):(d.lineTo(z.x,c),d.lineTo(z.x,z.y)),g=!!o.pathSegment(d,C,{move:g}),g?d.closePath():d.lineTo(q.x,c)}d.lineTo(o.first().x,c),d.closePath(),d.clip()}function zA(d,o){let{line:c,target:r,property:l,color:t,scale:g}=o,C=Mj(c,r,l);for(let{source:I,target:O,start:z,end:q}of C){let{style:{backgroundColor:ie=t}={}}=I,de=r!==!0;d.save(),d.fillStyle=ie,Wj(d,g,de&&M2(l,z,q)),d.beginPath();let xe=!!c.pathSegment(d,I),Ie;if(de){xe?d.closePath():BA(d,r,q,l);let Me=!!r.pathSegment(d,O,{move:xe,reverse:!0});Ie=xe&&Me,Ie||BA(d,r,z,l)}d.closePath(),d.fill(Ie?"evenodd":"nonzero"),d.restore()}}function Wj(d,o,c){let{top:r,bottom:l}=o.chart.chartArea,{property:t,start:g,end:C}=c||{};t==="x"&&(d.beginPath(),d.rect(g,r,C-g,l-r),d.clip())}function BA(d,o,c,r){let l=o.interpolate(c,r);l&&d.lineTo(l.x,l.y)}var Hj={id:"filler",afterDatasetsUpdate(d,o,c){let r=(d.data.datasets||[]).length,l=[],t,g,C,I;for(g=0;g<r;++g)t=d.getDatasetMeta(g),C=t.dataset,I=null,C&&C.options&&C instanceof Zy&&(I={visible:d.isDatasetVisible(g),index:g,fill:Tj(C,g,r),chart:d,axis:t.controller.options.indexAxis,scale:t.vScale,line:C}),t.$filler=I,l.push(I);for(g=0;g<r;++g)I=l[g],!(!I||I.fill===!1)&&(I.fill=Ij(l,g,c.propagate))},beforeDraw(d,o,c){let r=c.drawTime==="beforeDraw",l=d.getSortedVisibleDatasetMetas(),t=d.chartArea;for(let g=l.length-1;g>=0;--g){let C=l[g].$filler;C&&(C.line.updateControlPoints(t,C.axis),r&&C.fill&&d2(d.ctx,C,t))}},beforeDatasetsDraw(d,o,c){if(c.drawTime!=="beforeDatasetsDraw")return;let r=d.getSortedVisibleDatasetMetas();for(let l=r.length-1;l>=0;--l){let t=r[l].$filler;LA(t)&&d2(d.ctx,t,d.chartArea)}},beforeDatasetDraw(d,o,c){let r=o.meta.$filler;!LA(r)||c.drawTime!=="beforeDatasetDraw"||d2(d.ctx,r,d.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}},NA=(d,o)=>{let{boxHeight:c=o,boxWidth:r=o}=d;return d.usePointStyle&&(c=Math.min(c,o),r=d.pointStyleWidth||Math.min(r,o)),{boxWidth:r,boxHeight:c,itemHeight:Math.max(o,c)}},Gj=(d,o)=>d!==null&&o!==null&&d.datasetIndex===o.datasetIndex&&d.index===o.index,Yy=class extends Bs{constructor(o){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=o.chart,this.options=o.options,this.ctx=o.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(o,c,r){this.maxWidth=o,this.maxHeight=c,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let o=this.options.labels||{},c=nr(o.generateLabels,[this.chart],this)||[];o.filter&&(c=c.filter(r=>o.filter(r,this.chart.data))),o.sort&&(c=c.sort((r,l)=>o.sort(r,l,this.chart.data))),this.options.reverse&&c.reverse(),this.legendItems=c}fit(){let{options:o,ctx:c}=this;if(!o.display){this.width=this.height=0;return}let r=o.labels,l=Yr(r.font),t=l.size,g=this._computeTitleHeight(),{boxWidth:C,itemHeight:I}=NA(r,t),O,z;c.font=l.string,this.isHorizontal()?(O=this.maxWidth,z=this._fitRows(g,t,C,I)+10):(z=this.maxHeight,O=this._fitCols(g,l,C,I)+10),this.width=Math.min(O,o.maxWidth||this.maxWidth),this.height=Math.min(z,o.maxHeight||this.maxHeight)}_fitRows(o,c,r,l){let{ctx:t,maxWidth:g,options:{labels:{padding:C}}}=this,I=this.legendHitBoxes=[],O=this.lineWidths=[0],z=l+C,q=o;t.textAlign="left",t.textBaseline="middle";let ie=-1,de=-z;return this.legendItems.forEach((xe,Ie)=>{let Me=r+c/2+t.measureText(xe.text).width;(Ie===0||O[O.length-1]+Me+2*C>g)&&(q+=z,O[O.length-(Ie>0?0:1)]=0,de+=z,ie++),I[Ie]={left:0,top:de,row:ie,width:Me,height:l},O[O.length-1]+=Me+C}),q}_fitCols(o,c,r,l){let{ctx:t,maxHeight:g,options:{labels:{padding:C}}}=this,I=this.legendHitBoxes=[],O=this.columnSizes=[],z=g-o,q=C,ie=0,de=0,xe=0,Ie=0;return this.legendItems.forEach((Me,Ge)=>{let{itemWidth:He,itemHeight:ht}=qj(r,c,t,Me,l);Ge>0&&de+ht+2*C>z&&(q+=ie+C,O.push({width:ie,height:de}),xe+=ie+C,Ie++,ie=de=0),I[Ge]={left:xe,top:de,col:Ie,width:He,height:ht},ie=Math.max(ie,He),de+=ht+C}),q+=ie,O.push({width:ie,height:de}),q}adjustHitBoxes(){if(!this.options.display)return;let o=this._computeTitleHeight(),{legendHitBoxes:c,options:{align:r,labels:{padding:l},rtl:t}}=this,g=pu(t,this.left,this.width);if(this.isHorizontal()){let C=0,I=wo(r,this.left+l,this.right-this.lineWidths[C]);for(let O of c)C!==O.row&&(C=O.row,I=wo(r,this.left+l,this.right-this.lineWidths[C])),O.top+=this.top+o+l,O.left=g.leftForLtr(g.x(I),O.width),I+=O.width+l}else{let C=0,I=wo(r,this.top+o+l,this.bottom-this.columnSizes[C].height);for(let O of c)O.col!==C&&(C=O.col,I=wo(r,this.top+o+l,this.bottom-this.columnSizes[C].height)),O.top=I,O.left+=this.left+l,O.left=g.leftForLtr(g.x(O.left),O.width),I+=O.height+l}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){let o=this.ctx;e_(o,this),this._draw(),t_(o)}}_draw(){let{options:o,columnSizes:c,lineWidths:r,ctx:l}=this,{align:t,labels:g}=o,C=Tr.color,I=pu(o.rtl,this.left,this.width),O=Yr(g.font),{padding:z}=g,q=O.size,ie=q/2,de;this.drawTitle(),l.textAlign=I.textAlign("left"),l.textBaseline="middle",l.lineWidth=.5,l.font=O.string;let{boxWidth:xe,boxHeight:Ie,itemHeight:Me}=NA(g,q),Ge=function(Tt,Wt,Ct){if(isNaN(xe)||xe<=0||isNaN(Ie)||Ie<0)return;l.save();let Yt=Zi(Ct.lineWidth,1);if(l.fillStyle=Zi(Ct.fillStyle,C),l.lineCap=Zi(Ct.lineCap,"butt"),l.lineDashOffset=Zi(Ct.lineDashOffset,0),l.lineJoin=Zi(Ct.lineJoin,"miter"),l.lineWidth=Yt,l.strokeStyle=Zi(Ct.strokeStyle,C),l.setLineDash(Zi(Ct.lineDash,[])),g.usePointStyle){let zt={radius:Ie*Math.SQRT2/2,pointStyle:Ct.pointStyle,rotation:Ct.rotation,borderWidth:Yt},Ti=I.xPlus(Tt,xe/2),Hi=Wt+ie;HC(l,zt,Ti,Hi,g.pointStyleWidth&&xe)}else{let zt=Wt+Math.max((q-Ie)/2,0),Ti=I.leftForLtr(Tt,xe),Hi=jd(Ct.borderRadius);l.beginPath(),Object.values(Hi).some(_r=>_r!==0)?bp(l,{x:Ti,y:zt,w:xe,h:Ie,radius:Hi}):l.rect(Ti,zt,xe,Ie),l.fill(),Yt!==0&&l.stroke()}l.restore()},He=function(Tt,Wt,Ct){Vd(l,Ct.text,Tt,Wt+Me/2,O,{strikethrough:Ct.hidden,textAlign:I.textAlign(Ct.textAlign)})},ht=this.isHorizontal(),Mt=this._computeTitleHeight();ht?de={x:wo(t,this.left+z,this.right-r[0]),y:this.top+z+Mt,line:0}:de={x:this.left+z,y:wo(t,this.top+Mt+z,this.bottom-c[0].height),line:0},KC(this.ctx,o.textDirection);let yt=Me+z;this.legendItems.forEach((Tt,Wt)=>{l.strokeStyle=Tt.fontColor,l.fillStyle=Tt.fontColor;let Ct=l.measureText(Tt.text).width,Yt=I.textAlign(Tt.textAlign||(Tt.textAlign=g.textAlign)),zt=xe+ie+Ct,Ti=de.x,Hi=de.y;I.setWidth(this.width),ht?Wt>0&&Ti+zt+z>this.right&&(Hi=de.y+=yt,de.line++,Ti=de.x=wo(t,this.left+z,this.right-r[de.line])):Wt>0&&Hi+yt>this.bottom&&(Ti=de.x=Ti+c[de.line].width+z,de.line++,Hi=de.y=wo(t,this.top+Mt+z,this.bottom-c[de.line].height));let _r=I.x(Ti);if(Ge(_r,Hi,Tt),Ti=BD(Yt,Ti+xe+ie,ht?Ti+zt:this.right,o.rtl),He(I.x(Ti),Hi,Tt),ht)de.x+=zt+z;else if(typeof Tt.text!="string"){let Ci=O.lineHeight;de.y+=vP(Tt,Ci)+z}else de.y+=yt}),JC(this.ctx,o.textDirection)}drawTitle(){let o=this.options,c=o.title,r=Yr(c.font),l=Co(c.padding);if(!c.display)return;let t=pu(o.rtl,this.left,this.width),g=this.ctx,C=c.position,I=r.size/2,O=l.top+I,z,q=this.left,ie=this.width;if(this.isHorizontal())ie=Math.max(...this.lineWidths),z=this.top+O,q=wo(o.align,q,this.right-ie);else{let xe=this.columnSizes.reduce((Ie,Me)=>Math.max(Ie,Me.height),0);z=O+wo(o.align,this.top,this.bottom-xe-o.labels.padding-this._computeTitleHeight())}let de=wo(C,q,q+ie);g.textAlign=t.textAlign(ky(C)),g.textBaseline="middle",g.strokeStyle=c.color,g.fillStyle=c.color,g.font=r.string,Vd(g,c.text,de,z,r)}_computeTitleHeight(){let o=this.options.title,c=Yr(o.font),r=Co(o.padding);return o.display?c.lineHeight+r.height:0}_getLegendItemAt(o,c){let r,l,t;if(gl(o,this.left,this.right)&&gl(c,this.top,this.bottom)){for(t=this.legendHitBoxes,r=0;r<t.length;++r)if(l=t[r],gl(o,l.left,l.left+l.width)&&gl(c,l.top,l.top+l.height))return this.legendItems[r]}return null}handleEvent(o){let c=this.options;if(!Zj(o.type,c))return;let r=this._getLegendItemAt(o.x,o.y);if(o.type==="mousemove"||o.type==="mouseout"){let l=this._hoveredItem,t=Gj(l,r);l&&!t&&nr(c.onLeave,[o,l,this],this),this._hoveredItem=r,r&&!t&&nr(c.onHover,[o,r,this],this)}else r&&nr(c.onClick,[o,r,this],this)}};function qj(d,o,c,r,l){let t=$j(r,d,o,c),g=Yj(l,r,o.lineHeight);return{itemWidth:t,itemHeight:g}}function $j(d,o,c,r){let l=d.text;return l&&typeof l!="string"&&(l=l.reduce((t,g)=>t.length>g.length?t:g)),o+c.size/2+r.measureText(l).width}function Yj(d,o,c){let r=d;return typeof o.text!="string"&&(r=vP(o,c)),r}function vP(d,o){let c=d.text?d.text.length:0;return o*c}function Zj(d,o){return!!((d==="mousemove"||d==="mouseout")&&(o.onHover||o.onLeave)||o.onClick&&(d==="click"||d==="mouseup"))}var Xj={id:"legend",_element:Yy,start(d,o,c){let r=d.legend=new Yy({ctx:d.ctx,options:c,chart:d});Bo.configure(d,r,c),Bo.addBox(d,r)},stop(d){Bo.removeBox(d,d.legend),delete d.legend},beforeUpdate(d,o,c){let r=d.legend;Bo.configure(d,r,c),r.options=c},afterUpdate(d){let o=d.legend;o.buildLabels(),o.adjustHitBoxes()},afterEvent(d,o){o.replay||d.legend.handleEvent(o.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(d,o,c){let r=o.datasetIndex,l=c.chart;l.isDatasetVisible(r)?(l.hide(r),o.hidden=!0):(l.show(r),o.hidden=!1)},onHover:null,onLeave:null,labels:{color:d=>d.chart.options.color,boxWidth:40,padding:10,generateLabels(d){let o=d.data.datasets,{labels:{usePointStyle:c,pointStyle:r,textAlign:l,color:t,useBorderRadius:g,borderRadius:C}}=d.legend.options;return d._getSortedDatasetMetas().map(I=>{let O=I.controller.getStyle(c?0:void 0),z=Co(O.borderWidth);return{text:o[I.index].label,fillStyle:O.backgroundColor,fontColor:t,hidden:!I.visible,lineCap:O.borderCapStyle,lineDash:O.borderDash,lineDashOffset:O.borderDashOffset,lineJoin:O.borderJoinStyle,lineWidth:(z.width+z.height)/4,strokeStyle:O.borderColor,pointStyle:r||O.pointStyle,rotation:O.rotation,textAlign:l||O.textAlign,borderRadius:g&&(C||O.borderRadius),datasetIndex:I.index}},this)}},title:{color:d=>d.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:d=>!d.startsWith("on"),labels:{_scriptable:d=>!["generateLabels","filter","sort"].includes(d)}}},d_=class extends Bs{constructor(o){super(),this.chart=o.chart,this.options=o.options,this.ctx=o.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(o,c){let r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=o,this.height=this.bottom=c;let l=ur(r.text)?r.text.length:1;this._padding=Co(r.padding);let t=l*Yr(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=t:this.width=t}isHorizontal(){let o=this.options.position;return o==="top"||o==="bottom"}_drawArgs(o){let{top:c,left:r,bottom:l,right:t,options:g}=this,C=g.align,I=0,O,z,q;return this.isHorizontal()?(z=wo(C,r,t),q=c+o,O=t-r):(g.position==="left"?(z=r+o,q=wo(C,l,c),I=mr*-.5):(z=t-o,q=wo(C,c,l),I=mr*.5),O=l-c),{titleX:z,titleY:q,maxWidth:O,rotation:I}}draw(){let o=this.ctx,c=this.options;if(!c.display)return;let r=Yr(c.font),t=r.lineHeight/2+this._padding.top,{titleX:g,titleY:C,maxWidth:I,rotation:O}=this._drawArgs(t);Vd(o,c.text,0,0,r,{color:c.color,maxWidth:I,rotation:O,textAlign:ky(c.align),textBaseline:"middle",translation:[g,C]})}};function Qj(d,o){let c=new d_({ctx:d.ctx,options:o,chart:d});Bo.configure(d,c,o),Bo.addBox(d,c),d.titleBlock=c}var Kj={id:"title",_element:d_,start(d,o,c){Qj(d,c)},stop(d){let o=d.titleBlock;Bo.removeBox(d,o),delete d.titleBlock},beforeUpdate(d,o,c){let r=d.titleBlock;Bo.configure(d,r,c),r.options=c},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},By=new WeakMap,Jj={id:"subtitle",start(d,o,c){let r=new d_({ctx:d.ctx,options:c,chart:d});Bo.configure(d,r,c),Bo.addBox(d,r),By.set(d,r)},stop(d){Bo.removeBox(d,By.get(d)),By.delete(d)},beforeUpdate(d,o,c){let r=By.get(d);Bo.configure(d,r,c),r.options=c},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},l_={average(d){if(!d.length)return!1;let o,c,r=new Set,l=0,t=0;for(o=0,c=d.length;o<c;++o){let C=d[o].element;if(C&&C.hasValue()){let I=C.tooltipPosition();r.add(I.x),l+=I.y,++t}}return{x:[...r].reduce((C,I)=>C+I)/r.size,y:l/t}},nearest(d,o){if(!d.length)return!1;let c=o.x,r=o.y,l=Number.POSITIVE_INFINITY,t,g,C;for(t=0,g=d.length;t<g;++t){let I=d[t].element;if(I&&I.hasValue()){let O=I.getCenterPoint(),z=xy(o,O);z<l&&(l=z,C=I)}}if(C){let I=C.tooltipPosition();c=I.x,r=I.y}return{x:c,y:r}}};function _l(d,o){return o&&(ur(o)?Array.prototype.push.apply(d,o):d.push(o)),d}function mc(d){return(typeof d=="string"||d instanceof String)&&d.indexOf(`
`)>-1?d.split(`
`):d}function e6(d,o){let{element:c,datasetIndex:r,index:l}=o,t=d.getDatasetMeta(r).controller,{label:g,value:C}=t.getLabelAndValue(l);return{chart:d,label:g,parsed:t.getParsed(l),raw:d.data.datasets[r].data[l],formattedValue:C,dataset:t.getDataset(),dataIndex:l,datasetIndex:r,element:c}}function VA(d,o){let c=d.chart.ctx,{body:r,footer:l,title:t}=d,{boxWidth:g,boxHeight:C}=o,I=Yr(o.bodyFont),O=Yr(o.titleFont),z=Yr(o.footerFont),q=t.length,ie=l.length,de=r.length,xe=Co(o.padding),Ie=xe.height,Me=0,Ge=r.reduce((Mt,yt)=>Mt+yt.before.length+yt.lines.length+yt.after.length,0);if(Ge+=d.beforeBody.length+d.afterBody.length,q&&(Ie+=q*O.lineHeight+(q-1)*o.titleSpacing+o.titleMarginBottom),Ge){let Mt=o.displayColors?Math.max(C,I.lineHeight):I.lineHeight;Ie+=de*Mt+(Ge-de)*I.lineHeight+(Ge-1)*o.bodySpacing}ie&&(Ie+=o.footerMarginTop+ie*z.lineHeight+(ie-1)*o.footerSpacing);let He=0,ht=function(Mt){Me=Math.max(Me,c.measureText(Mt).width+He)};return c.save(),c.font=O.string,Hn(d.title,ht),c.font=I.string,Hn(d.beforeBody.concat(d.afterBody),ht),He=o.displayColors?g+2+o.boxPadding:0,Hn(r,Mt=>{Hn(Mt.before,ht),Hn(Mt.lines,ht),Hn(Mt.after,ht)}),He=0,c.font=z.string,Hn(d.footer,ht),c.restore(),Me+=xe.width,{width:Me,height:Ie}}function t6(d,o){let{y:c,height:r}=o;return c<r/2?"top":c>d.height-r/2?"bottom":"center"}function i6(d,o,c,r){let{x:l,width:t}=r,g=c.caretSize+c.caretPadding;if(d==="left"&&l+t+g>o.width||d==="right"&&l-t-g<0)return!0}function n6(d,o,c,r){let{x:l,width:t}=c,{width:g,chartArea:{left:C,right:I}}=d,O="center";return r==="center"?O=l<=(C+I)/2?"left":"right":l<=t/2?O="left":l>=g-t/2&&(O="right"),i6(O,d,o,c)&&(O="center"),O}function jA(d,o,c){let r=c.yAlign||o.yAlign||t6(d,c);return{xAlign:c.xAlign||o.xAlign||n6(d,o,c,r),yAlign:r}}function r6(d,o){let{x:c,width:r}=d;return o==="right"?c-=r:o==="center"&&(c-=r/2),c}function o6(d,o,c){let{y:r,height:l}=d;return o==="top"?r+=c:o==="bottom"?r-=l+c:r-=l/2,r}function UA(d,o,c,r){let{caretSize:l,caretPadding:t,cornerRadius:g}=d,{xAlign:C,yAlign:I}=c,O=l+t,{topLeft:z,topRight:q,bottomLeft:ie,bottomRight:de}=jd(g),xe=r6(o,C),Ie=o6(o,I,O);return I==="center"?C==="left"?xe+=O:C==="right"&&(xe-=O):C==="left"?xe-=Math.max(z,ie)+l:C==="right"&&(xe+=Math.max(q,de)+l),{x:no(xe,0,r.width-o.width),y:no(Ie,0,r.height-o.height)}}function Ny(d,o,c){let r=Co(c.padding);return o==="center"?d.x+d.width/2:o==="right"?d.x+d.width-r.right:d.x+r.left}function WA(d){return _l([],mc(d))}function a6(d,o,c){return hc(d,{tooltip:o,tooltipItems:c,type:"tooltip"})}function HA(d,o){let c=o&&o.dataset&&o.dataset.tooltip&&o.dataset.tooltip.callbacks;return c?d.override(c):d}var xP={beforeTitle:fl,title(d){if(d.length>0){let o=d[0],c=o.chart.data.labels,r=c?c.length:0;if(this&&this.options&&this.options.mode==="dataset")return o.dataset.label||"";if(o.label)return o.label;if(r>0&&o.dataIndex<r)return c[o.dataIndex]}return""},afterTitle:fl,beforeBody:fl,beforeLabel:fl,label(d){if(this&&this.options&&this.options.mode==="dataset")return d.label+": "+d.formattedValue||d.formattedValue;let o=d.dataset.label||"";o&&(o+=": ");let c=d.formattedValue;return Sn(c)||(o+=c),o},labelColor(d){let c=d.chart.getDatasetMeta(d.datasetIndex).controller.getStyle(d.dataIndex);return{borderColor:c.borderColor,backgroundColor:c.backgroundColor,borderWidth:c.borderWidth,borderDash:c.borderDash,borderDashOffset:c.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(d){let c=d.chart.getDatasetMeta(d.datasetIndex).controller.getStyle(d.dataIndex);return{pointStyle:c.pointStyle,rotation:c.rotation}},afterLabel:fl,afterBody:fl,beforeFooter:fl,footer:fl,afterFooter:fl};function ma(d,o,c,r){let l=d[o].call(c,r);return typeof l>"u"?xP[o].call(c,r):l}var GA=(()=>{class d extends Bs{static positioners=l_;constructor(c){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=c.chart,this.options=c.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(c){this.options=c,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let c=this._cachedAnimations;if(c)return c;let r=this.chart,l=this.options.setContext(this.getContext()),t=l.enabled&&r.options.animation&&l.animations,g=new Wy(this.chart,t);return t._cacheable&&(this._cachedAnimations=Object.freeze(g)),g}getContext(){return this.$context||(this.$context=a6(this.chart.getContext(),this,this._tooltipItems))}getTitle(c,r){let{callbacks:l}=r,t=ma(l,"beforeTitle",this,c),g=ma(l,"title",this,c),C=ma(l,"afterTitle",this,c),I=[];return I=_l(I,mc(t)),I=_l(I,mc(g)),I=_l(I,mc(C)),I}getBeforeBody(c,r){return WA(ma(r.callbacks,"beforeBody",this,c))}getBody(c,r){let{callbacks:l}=r,t=[];return Hn(c,g=>{let C={before:[],lines:[],after:[]},I=HA(l,g);_l(C.before,mc(ma(I,"beforeLabel",this,g))),_l(C.lines,ma(I,"label",this,g)),_l(C.after,mc(ma(I,"afterLabel",this,g))),t.push(C)}),t}getAfterBody(c,r){return WA(ma(r.callbacks,"afterBody",this,c))}getFooter(c,r){let{callbacks:l}=r,t=ma(l,"beforeFooter",this,c),g=ma(l,"footer",this,c),C=ma(l,"afterFooter",this,c),I=[];return I=_l(I,mc(t)),I=_l(I,mc(g)),I=_l(I,mc(C)),I}_createItems(c){let r=this._active,l=this.chart.data,t=[],g=[],C=[],I=[],O,z;for(O=0,z=r.length;O<z;++O)I.push(e6(this.chart,r[O]));return c.filter&&(I=I.filter((q,ie,de)=>c.filter(q,ie,de,l))),c.itemSort&&(I=I.sort((q,ie)=>c.itemSort(q,ie,l))),Hn(I,q=>{let ie=HA(c.callbacks,q);t.push(ma(ie,"labelColor",this,q)),g.push(ma(ie,"labelPointStyle",this,q)),C.push(ma(ie,"labelTextColor",this,q))}),this.labelColors=t,this.labelPointStyles=g,this.labelTextColors=C,this.dataPoints=I,I}update(c,r){let l=this.options.setContext(this.getContext()),t=this._active,g,C=[];if(!t.length)this.opacity!==0&&(g={opacity:0});else{let I=l_[l.position].call(this,t,this._eventPosition);C=this._createItems(l),this.title=this.getTitle(C,l),this.beforeBody=this.getBeforeBody(C,l),this.body=this.getBody(C,l),this.afterBody=this.getAfterBody(C,l),this.footer=this.getFooter(C,l);let O=this._size=VA(this,l),z=Object.assign({},I,O),q=jA(this.chart,l,z),ie=UA(l,z,q,this.chart);this.xAlign=q.xAlign,this.yAlign=q.yAlign,g={opacity:1,x:ie.x,y:ie.y,width:O.width,height:O.height,caretX:I.x,caretY:I.y}}this._tooltipItems=C,this.$context=void 0,g&&this._resolveAnimations().update(this,g),c&&l.external&&l.external.call(this,{chart:this.chart,tooltip:this,replay:r})}drawCaret(c,r,l,t){let g=this.getCaretPosition(c,l,t);r.lineTo(g.x1,g.y1),r.lineTo(g.x2,g.y2),r.lineTo(g.x3,g.y3)}getCaretPosition(c,r,l){let{xAlign:t,yAlign:g}=this,{caretSize:C,cornerRadius:I}=l,{topLeft:O,topRight:z,bottomLeft:q,bottomRight:ie}=jd(I),{x:de,y:xe}=c,{width:Ie,height:Me}=r,Ge,He,ht,Mt,yt,Tt;return g==="center"?(yt=xe+Me/2,t==="left"?(Ge=de,He=Ge-C,Mt=yt+C,Tt=yt-C):(Ge=de+Ie,He=Ge+C,Mt=yt-C,Tt=yt+C),ht=Ge):(t==="left"?He=de+Math.max(O,q)+C:t==="right"?He=de+Ie-Math.max(z,ie)-C:He=this.caretX,g==="top"?(Mt=xe,yt=Mt-C,Ge=He-C,ht=He+C):(Mt=xe+Me,yt=Mt+C,Ge=He+C,ht=He-C),Tt=Mt),{x1:Ge,x2:He,x3:ht,y1:Mt,y2:yt,y3:Tt}}drawTitle(c,r,l){let t=this.title,g=t.length,C,I,O;if(g){let z=pu(l.rtl,this.x,this.width);for(c.x=Ny(this,l.titleAlign,l),r.textAlign=z.textAlign(l.titleAlign),r.textBaseline="middle",C=Yr(l.titleFont),I=l.titleSpacing,r.fillStyle=l.titleColor,r.font=C.string,O=0;O<g;++O)r.fillText(t[O],z.x(c.x),c.y+C.lineHeight/2),c.y+=C.lineHeight+I,O+1===g&&(c.y+=l.titleMarginBottom-I)}}_drawColorBox(c,r,l,t,g){let C=this.labelColors[l],I=this.labelPointStyles[l],{boxHeight:O,boxWidth:z}=g,q=Yr(g.bodyFont),ie=Ny(this,"left",g),de=t.x(ie),xe=O<q.lineHeight?(q.lineHeight-O)/2:0,Ie=r.y+xe;if(g.usePointStyle){let Me={radius:Math.min(z,O)/2,pointStyle:I.pointStyle,rotation:I.rotation,borderWidth:1},Ge=t.leftForLtr(de,z)+z/2,He=Ie+O/2;c.strokeStyle=g.multiKeyBackground,c.fillStyle=g.multiKeyBackground,Ty(c,Me,Ge,He),c.strokeStyle=C.borderColor,c.fillStyle=C.backgroundColor,Ty(c,Me,Ge,He)}else{c.lineWidth=un(C.borderWidth)?Math.max(...Object.values(C.borderWidth)):C.borderWidth||1,c.strokeStyle=C.borderColor,c.setLineDash(C.borderDash||[]),c.lineDashOffset=C.borderDashOffset||0;let Me=t.leftForLtr(de,z),Ge=t.leftForLtr(t.xPlus(de,1),z-2),He=jd(C.borderRadius);Object.values(He).some(ht=>ht!==0)?(c.beginPath(),c.fillStyle=g.multiKeyBackground,bp(c,{x:Me,y:Ie,w:z,h:O,radius:He}),c.fill(),c.stroke(),c.fillStyle=C.backgroundColor,c.beginPath(),bp(c,{x:Ge,y:Ie+1,w:z-2,h:O-2,radius:He}),c.fill()):(c.fillStyle=g.multiKeyBackground,c.fillRect(Me,Ie,z,O),c.strokeRect(Me,Ie,z,O),c.fillStyle=C.backgroundColor,c.fillRect(Ge,Ie+1,z-2,O-2))}c.fillStyle=this.labelTextColors[l]}drawBody(c,r,l){let{body:t}=this,{bodySpacing:g,bodyAlign:C,displayColors:I,boxHeight:O,boxWidth:z,boxPadding:q}=l,ie=Yr(l.bodyFont),de=ie.lineHeight,xe=0,Ie=pu(l.rtl,this.x,this.width),Me=function(Yt){r.fillText(Yt,Ie.x(c.x+xe),c.y+de/2),c.y+=de+g},Ge=Ie.textAlign(C),He,ht,Mt,yt,Tt,Wt,Ct;for(r.textAlign=C,r.textBaseline="middle",r.font=ie.string,c.x=Ny(this,Ge,l),r.fillStyle=l.bodyColor,Hn(this.beforeBody,Me),xe=I&&Ge!=="right"?C==="center"?z/2+q:z+2+q:0,yt=0,Wt=t.length;yt<Wt;++yt){for(He=t[yt],ht=this.labelTextColors[yt],r.fillStyle=ht,Hn(He.before,Me),Mt=He.lines,I&&Mt.length&&(this._drawColorBox(r,c,yt,Ie,l),de=Math.max(ie.lineHeight,O)),Tt=0,Ct=Mt.length;Tt<Ct;++Tt)Me(Mt[Tt]),de=ie.lineHeight;Hn(He.after,Me)}xe=0,de=ie.lineHeight,Hn(this.afterBody,Me),c.y-=g}drawFooter(c,r,l){let t=this.footer,g=t.length,C,I;if(g){let O=pu(l.rtl,this.x,this.width);for(c.x=Ny(this,l.footerAlign,l),c.y+=l.footerMarginTop,r.textAlign=O.textAlign(l.footerAlign),r.textBaseline="middle",C=Yr(l.footerFont),r.fillStyle=l.footerColor,r.font=C.string,I=0;I<g;++I)r.fillText(t[I],O.x(c.x),c.y+C.lineHeight/2),c.y+=C.lineHeight+l.footerSpacing}}drawBackground(c,r,l,t){let{xAlign:g,yAlign:C}=this,{x:I,y:O}=c,{width:z,height:q}=l,{topLeft:ie,topRight:de,bottomLeft:xe,bottomRight:Ie}=jd(t.cornerRadius);r.fillStyle=t.backgroundColor,r.strokeStyle=t.borderColor,r.lineWidth=t.borderWidth,r.beginPath(),r.moveTo(I+ie,O),C==="top"&&this.drawCaret(c,r,l,t),r.lineTo(I+z-de,O),r.quadraticCurveTo(I+z,O,I+z,O+de),C==="center"&&g==="right"&&this.drawCaret(c,r,l,t),r.lineTo(I+z,O+q-Ie),r.quadraticCurveTo(I+z,O+q,I+z-Ie,O+q),C==="bottom"&&this.drawCaret(c,r,l,t),r.lineTo(I+xe,O+q),r.quadraticCurveTo(I,O+q,I,O+q-xe),C==="center"&&g==="left"&&this.drawCaret(c,r,l,t),r.lineTo(I,O+ie),r.quadraticCurveTo(I,O,I+ie,O),r.closePath(),r.fill(),t.borderWidth>0&&r.stroke()}_updateAnimationTarget(c){let r=this.chart,l=this.$animations,t=l&&l.x,g=l&&l.y;if(t||g){let C=l_[c.position].call(this,this._active,this._eventPosition);if(!C)return;let I=this._size=VA(this,c),O=Object.assign({},C,this._size),z=jA(r,c,O),q=UA(c,O,z,r);(t._to!==q.x||g._to!==q.y)&&(this.xAlign=z.xAlign,this.yAlign=z.yAlign,this.width=I.width,this.height=I.height,this.caretX=C.x,this.caretY=C.y,this._resolveAnimations().update(this,q))}}_willRender(){return!!this.opacity}draw(c){let r=this.options.setContext(this.getContext()),l=this.opacity;if(!l)return;this._updateAnimationTarget(r);let t={width:this.width,height:this.height},g={x:this.x,y:this.y};l=Math.abs(l)<.001?0:l;let C=Co(r.padding),I=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;r.enabled&&I&&(c.save(),c.globalAlpha=l,this.drawBackground(g,c,t,r),KC(c,r.textDirection),g.y+=C.top,this.drawTitle(g,c,r),this.drawBody(g,c,r),this.drawFooter(g,c,r),JC(c,r.textDirection),c.restore())}getActiveElements(){return this._active||[]}setActiveElements(c,r){let l=this._active,t=c.map(({datasetIndex:I,index:O})=>{let z=this.chart.getDatasetMeta(I);if(!z)throw new Error("Cannot find a dataset at index "+I);return{datasetIndex:I,element:z.data[O],index:O}}),g=!Kg(l,t),C=this._positionChanged(t,r);(g||C)&&(this._active=t,this._eventPosition=r,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(c,r,l=!0){if(r&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let t=this.options,g=this._active||[],C=this._getActiveElements(c,g,r,l),I=this._positionChanged(C,c),O=r||!Kg(C,g)||I;return O&&(this._active=C,(t.enabled||t.external)&&(this._eventPosition={x:c.x,y:c.y},this.update(!0,r))),O}_getActiveElements(c,r,l,t){let g=this.options;if(c.type==="mouseout")return[];if(!t)return r.filter(I=>this.chart.data.datasets[I.datasetIndex]&&this.chart.getDatasetMeta(I.datasetIndex).controller.getParsed(I.index)!==void 0);let C=this.chart.getElementsAtEventForMode(c,g.mode,g,l);return g.reverse&&C.reverse(),C}_positionChanged(c,r){let{caretX:l,caretY:t,options:g}=this,C=l_[g.position].call(this,c,r);return C!==!1&&(l!==C.x||t!==C.y)}}return d})(),s6={id:"tooltip",_element:GA,positioners:l_,afterInit(d,o,c){c&&(d.tooltip=new GA({chart:d,options:c}))},beforeUpdate(d,o,c){d.tooltip&&d.tooltip.initialize(c)},reset(d,o,c){d.tooltip&&d.tooltip.initialize(c)},afterDraw(d){let o=d.tooltip;if(o&&o._willRender()){let c={tooltip:o};if(d.notifyPlugins("beforeTooltipDraw",ia(Xi({},c),{cancelable:!0}))===!1)return;o.draw(d.ctx),d.notifyPlugins("afterTooltipDraw",c)}},afterEvent(d,o){if(d.tooltip){let c=o.replay;d.tooltip.handleEvent(o.event,c,o.inChartArea)&&(o.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(d,o)=>o.bodyFont.size,boxWidth:(d,o)=>o.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:xP},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:d=>d!=="filter"&&d!=="itemSort"&&d!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},l6=Object.freeze({__proto__:null,Colors:vj,Decimation:Sj,Filler:Hj,Legend:Xj,SubTitle:Jj,Title:Kj,Tooltip:s6}),c6=(d,o,c,r)=>(typeof o=="string"?(c=d.push(o)-1,r.unshift({index:c,label:o})):isNaN(o)&&(c=null),c);function d6(d,o,c,r){let l=d.indexOf(o);if(l===-1)return c6(d,o,c,r);let t=d.lastIndexOf(o);return l!==t?c:l}var h6=(d,o)=>d===null?null:no(Math.round(d),0,o);function qA(d){let o=this.getLabels();return d>=0&&d<o.length?o[d]:d}var u6=(()=>{class d extends _u{static id="category";static defaults={ticks:{callback:qA}};constructor(c){super(c),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(c){let r=this._addedLabels;if(r.length){let l=this.getLabels();for(let{index:t,label:g}of r)l[t]===g&&l.splice(t,1);this._addedLabels=[]}super.init(c)}parse(c,r){if(Sn(c))return null;let l=this.getLabels();return r=isFinite(r)&&l[r]===c?r:d6(l,c,Zi(r,c),this._addedLabels),h6(r,l.length-1)}determineDataLimits(){let{minDefined:c,maxDefined:r}=this.getUserBounds(),{min:l,max:t}=this.getMinMax(!0);this.options.bounds==="ticks"&&(c||(l=0),r||(t=this.getLabels().length-1)),this.min=l,this.max=t}buildTicks(){let c=this.min,r=this.max,l=this.options.offset,t=[],g=this.getLabels();g=c===0&&r===g.length-1?g:g.slice(c,r+1),this._valueRange=Math.max(g.length-(l?0:1),1),this._startValue=this.min-(l?.5:0);for(let C=c;C<=r;C++)t.push({value:C});return t}getLabelForValue(c){return qA.call(this,c)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(c){return typeof c!="number"&&(c=this.parse(c)),c===null?NaN:this.getPixelForDecimal((c-this._startValue)/this._valueRange)}getPixelForTick(c){let r=this.ticks;return c<0||c>r.length-1?null:this.getPixelForValue(r[c].value)}getValueForPixel(c){return Math.round(this._startValue+this.getDecimalForPixel(c)*this._valueRange)}getBasePixel(){return this.bottom}}return d})();function m6(d,o){let c=[],{bounds:l,step:t,min:g,max:C,precision:I,count:O,maxTicks:z,maxDigits:q,includeBounds:ie}=d,de=t||1,xe=z-1,{min:Ie,max:Me}=o,Ge=!Sn(g),He=!Sn(C),ht=!Sn(O),Mt=(Me-Ie)/(q+1),yt=AC((Me-Ie)/xe/de)*de,Tt,Wt,Ct,Yt;if(yt<1e-14&&!Ge&&!He)return[{value:Ie},{value:Me}];Yt=Math.ceil(Me/yt)-Math.floor(Ie/yt),Yt>xe&&(yt=AC(Yt*yt/xe/de)*de),Sn(I)||(Tt=Math.pow(10,I),yt=Math.ceil(yt*Tt)/Tt),l==="ticks"?(Wt=Math.floor(Ie/yt)*yt,Ct=Math.ceil(Me/yt)*yt):(Wt=Ie,Ct=Me),Ge&&He&&t&&AD((C-g)/t,yt/1e3)?(Yt=Math.round(Math.min((C-g)/yt,z)),yt=(C-g)/Yt,Wt=g,Ct=C):ht?(Wt=Ge?g:Wt,Ct=He?C:Ct,Yt=O-1,yt=(Ct-Wt)/Yt):(Yt=(Ct-Wt)/yt,fp(Yt,Math.round(Yt),yt/1e3)?Yt=Math.round(Yt):Yt=Math.ceil(Yt));let zt=Math.max(OC(yt),OC(Wt));Tt=Math.pow(10,Sn(I)?zt:I),Wt=Math.round(Wt*Tt)/Tt,Ct=Math.round(Ct*Tt)/Tt;let Ti=0;for(Ge&&(ie&&Wt!==g?(c.push({value:g}),Wt<g&&Ti++,fp(Math.round((Wt+Ti*yt)*Tt)/Tt,g,$A(g,Mt,d))&&Ti++):Wt<g&&Ti++);Ti<Yt;++Ti){let Hi=Math.round((Wt+Ti*yt)*Tt)/Tt;if(He&&Hi>C)break;c.push({value:Hi})}return He&&ie&&Ct!==C?c.length&&fp(c[c.length-1].value,C,$A(C,Mt,d))?c[c.length-1].value=C:c.push({value:C}):(!He||Ct===C)&&c.push({value:Ct}),c}function $A(d,o,{horizontal:c,minRotation:r}){let l=os(r),t=(c?Math.sin(l):Math.cos(l))||.001,g=.75*o*(""+d).length;return Math.min(o/t,g)}var wp=class extends _u{constructor(o){super(o),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(o,c){return Sn(o)||(typeof o=="number"||o instanceof Number)&&!isFinite(+o)?null:+o}handleTickRangeOptions(){let{beginAtZero:o}=this.options,{minDefined:c,maxDefined:r}=this.getUserBounds(),{min:l,max:t}=this,g=I=>l=c?l:I,C=I=>t=r?t:I;if(o){let I=zs(l),O=zs(t);I<0&&O<0?C(0):I>0&&O>0&&g(0)}if(l===t){let I=t===0?1:Math.abs(t*.05);C(t+I),o||g(l-I)}this.min=l,this.max=t}getTickLimit(){let o=this.options.ticks,{maxTicksLimit:c,stepSize:r}=o,l;return r?(l=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,l>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${l} ticks. Limiting to 1000.`),l=1e3)):(l=this.computeTickLimit(),c=c||11),c&&(l=Math.min(c,l)),l}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let o=this.options,c=o.ticks,r=this.getTickLimit();r=Math.max(2,r);let l={maxTicks:r,bounds:o.bounds,min:o.min,max:o.max,precision:c.precision,step:c.stepSize,count:c.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:c.minRotation||0,includeBounds:c.includeBounds!==!1},t=this._range||this,g=m6(l,t);return o.bounds==="ticks"&&PC(g,this,"value"),o.reverse?(g.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),g}configure(){let o=this.ticks,c=this.min,r=this.max;if(super.configure(),this.options.offset&&o.length){let l=(r-c)/Math.max(o.length-1,1)/2;c-=l,r+=l}this._startValue=c,this._endValue=r,this._valueRange=r-c}getLabelForValue(o){return _p(o,this.chart.options.locale,this.options.ticks.format)}},k2=class extends wp{static id="linear";static defaults={ticks:{callback:Jg.formatters.numeric}};determineDataLimits(){let{min:o,max:c}=this.getMinMax(!0);this.min=Ir(o)?o:0,this.max=Ir(c)?c:1,this.handleTickRangeOptions()}computeTickLimit(){let o=this.isHorizontal(),c=o?this.width:this.height,r=os(this.options.ticks.minRotation),l=(o?Math.sin(r):Math.cos(r))||.001,t=this._resolveTickFontOptions(0);return Math.ceil(c/Math.min(40,t.lineHeight/l))}getPixelForValue(o){return o===null?NaN:this.getPixelForDecimal((o-this._startValue)/this._valueRange)}getValueForPixel(o){return this._startValue+this.getDecimalForPixel(o)*this._valueRange}},h_=d=>Math.floor(cc(d)),gu=(d,o)=>Math.pow(10,h_(d)+o);function YA(d){return d/Math.pow(10,h_(d))===1}function ZA(d,o,c){let r=Math.pow(10,c),l=Math.floor(d/r);return Math.ceil(o/r)-l}function p6(d,o){let c=o-d,r=h_(c);for(;ZA(d,o,r)>10;)r++;for(;ZA(d,o,r)<10;)r--;return Math.min(r,h_(d))}function f6(d,{min:o,max:c}){o=ua(d.min,o);let r=[],l=h_(o),t=p6(o,c),g=t<0?Math.pow(10,Math.abs(t)):1,C=Math.pow(10,t),I=l>t?Math.pow(10,l):0,O=Math.round((o-I)*g)/g,z=Math.floor((o-I)/C/10)*C*10,q=Math.floor((O-z)/Math.pow(10,t)),ie=ua(d.min,Math.round((I+z+q*Math.pow(10,t))*g)/g);for(;ie<c;)r.push({value:ie,major:YA(ie),significand:q}),q>=10?q=q<15?15:20:q++,q>=20&&(t++,q=2,g=t>=0?1:g),ie=Math.round((I+z+q*Math.pow(10,t))*g)/g;let de=ua(d.max,ie);return r.push({value:de,major:YA(de),significand:q}),r}var I2=class extends _u{static id="logarithmic";static defaults={ticks:{callback:Jg.formatters.logarithmic,major:{enabled:!0}}};constructor(o){super(o),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(o,c){let r=wp.prototype.parse.apply(this,[o,c]);if(r===0){this._zero=!0;return}return Ir(r)&&r>0?r:null}determineDataLimits(){let{min:o,max:c}=this.getMinMax(!0);this.min=Ir(o)?Math.max(0,o):null,this.max=Ir(c)?Math.max(0,c):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Ir(this._userMin)&&(this.min=o===gu(this.min,0)?gu(this.min,-1):gu(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:o,maxDefined:c}=this.getUserBounds(),r=this.min,l=this.max,t=C=>r=o?r:C,g=C=>l=c?l:C;r===l&&(r<=0?(t(1),g(10)):(t(gu(r,-1)),g(gu(l,1)))),r<=0&&t(gu(l,-1)),l<=0&&g(gu(r,1)),this.min=r,this.max=l}buildTicks(){let o=this.options,c={min:this._userMin,max:this._userMax},r=f6(c,this);return o.bounds==="ticks"&&PC(r,this,"value"),o.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}getLabelForValue(o){return o===void 0?"0":_p(o,this.chart.options.locale,this.options.ticks.format)}configure(){let o=this.min;super.configure(),this._startValue=cc(o),this._valueRange=cc(this.max)-cc(o)}getPixelForValue(o){return(o===void 0||o===0)&&(o=this.min),o===null||isNaN(o)?NaN:this.getPixelForDecimal(o===this.min?0:(cc(o)-this._startValue)/this._valueRange)}getValueForPixel(o){let c=this.getDecimalForPixel(o);return Math.pow(10,this._startValue+c*this._valueRange)}};function T2(d){let o=d.ticks;if(o.display&&d.display){let c=Co(o.backdropPadding);return Zi(o.font&&o.font.size,Tr.font.size)+c.height}return 0}function g6(d,o,c){return c=ur(c)?c:[c],{w:VD(d,o.string,c),h:c.length*o.lineHeight}}function XA(d,o,c,r,l){return d===r||d===l?{start:o-c/2,end:o+c/2}:d<r||d>l?{start:o-c,end:o}:{start:o,end:o+c}}function _6(d){let o={l:d.left+d._padding.left,r:d.right-d._padding.right,t:d.top+d._padding.top,b:d.bottom-d._padding.bottom},c=Object.assign({},o),r=[],l=[],t=d._pointLabels.length,g=d.options.pointLabels,C=g.centerPointLabels?mr/t:0;for(let I=0;I<t;I++){let O=g.setContext(d.getPointLabelContext(I));l[I]=O.padding;let z=d.getPointPosition(I,d.drawingArea+l[I],C),q=Yr(O.font),ie=g6(d.ctx,q,d._pointLabels[I]);r[I]=ie;let de=ha(d.getIndexAngle(I)+C),xe=Math.round(Sy(de)),Ie=XA(xe,z.x,ie.w,0,180),Me=XA(xe,z.y,ie.h,90,270);b6(c,o,de,Ie,Me)}d.setCenterPoint(o.l-c.l,c.r-o.r,o.t-c.t,c.b-o.b),d._pointLabelItems=x6(d,r,l)}function b6(d,o,c,r,l){let t=Math.abs(Math.sin(c)),g=Math.abs(Math.cos(c)),C=0,I=0;r.start<o.l?(C=(o.l-r.start)/t,d.l=Math.min(d.l,o.l-C)):r.end>o.r&&(C=(r.end-o.r)/t,d.r=Math.max(d.r,o.r+C)),l.start<o.t?(I=(o.t-l.start)/g,d.t=Math.min(d.t,o.t-I)):l.end>o.b&&(I=(l.end-o.b)/g,d.b=Math.max(d.b,o.b+I))}function y6(d,o,c){let r=d.drawingArea,{extra:l,additionalAngle:t,padding:g,size:C}=c,I=d.getPointPosition(o,r+l+g,t),O=Math.round(Sy(ha(I.angle+Or))),z=S6(I.y,C.h,O),q=w6(O),ie=C6(I.x,C.w,q);return{visible:!0,x:I.x,y:z,textAlign:q,left:ie,top:z,right:ie+C.w,bottom:z+C.h}}function v6(d,o){if(!o)return!0;let{left:c,top:r,right:l,bottom:t}=d;return!(pl({x:c,y:r},o)||pl({x:c,y:t},o)||pl({x:l,y:r},o)||pl({x:l,y:t},o))}function x6(d,o,c){let r=[],l=d._pointLabels.length,t=d.options,{centerPointLabels:g,display:C}=t.pointLabels,I={extra:T2(t)/2,additionalAngle:g?mr/l:0},O;for(let z=0;z<l;z++){I.padding=c[z],I.size=o[z];let q=y6(d,z,I);r.push(q),C==="auto"&&(q.visible=v6(q,O),q.visible&&(O=q))}return r}function w6(d){return d===0||d===180?"center":d<180?"left":"right"}function C6(d,o,c){return c==="right"?d-=o:c==="center"&&(d-=o/2),d}function S6(d,o,c){return c===90||c===270?d-=o/2:(c>270||c<90)&&(d-=o),d}function M6(d,o,c){let{left:r,top:l,right:t,bottom:g}=c,{backdropColor:C}=o;if(!Sn(C)){let I=jd(o.borderRadius),O=Co(o.backdropPadding);d.fillStyle=C;let z=r-O.left,q=l-O.top,ie=t-r+O.width,de=g-l+O.height;Object.values(I).some(xe=>xe!==0)?(d.beginPath(),bp(d,{x:z,y:q,w:ie,h:de,radius:I}),d.fill()):d.fillRect(z,q,ie,de)}}function k6(d,o){let{ctx:c,options:{pointLabels:r}}=d;for(let l=o-1;l>=0;l--){let t=d._pointLabelItems[l];if(!t.visible)continue;let g=r.setContext(d.getPointLabelContext(l));M6(c,g,t);let C=Yr(g.font),{x:I,y:O,textAlign:z}=t;Vd(c,d._pointLabels[l],I,O+C.lineHeight/2,C,{color:g.color,textAlign:z,textBaseline:"middle"})}}function wP(d,o,c,r){let{ctx:l}=d;if(c)l.arc(d.xCenter,d.yCenter,o,0,pr);else{let t=d.getPointPosition(0,o);l.moveTo(t.x,t.y);for(let g=1;g<r;g++)t=d.getPointPosition(g,o),l.lineTo(t.x,t.y)}}function I6(d,o,c,r,l){let t=d.ctx,g=o.circular,{color:C,lineWidth:I}=o;!g&&!r||!C||!I||c<0||(t.save(),t.strokeStyle=C,t.lineWidth=I,t.setLineDash(l.dash),t.lineDashOffset=l.dashOffset,t.beginPath(),wP(d,c,g,r),t.closePath(),t.stroke(),t.restore())}function T6(d,o,c){return hc(d,{label:c,index:o,type:"pointLabel"})}var E2=class extends wp{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Jg.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(o){return o},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(o){super(o),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let o=this._padding=Co(T2(this.options)/2),c=this.width=this.maxWidth-o.width,r=this.height=this.maxHeight-o.height;this.xCenter=Math.floor(this.left+c/2+o.left),this.yCenter=Math.floor(this.top+r/2+o.top),this.drawingArea=Math.floor(Math.min(c,r)/2)}determineDataLimits(){let{min:o,max:c}=this.getMinMax(!1);this.min=Ir(o)&&!isNaN(o)?o:0,this.max=Ir(c)&&!isNaN(c)?c:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/T2(this.options))}generateTickLabels(o){wp.prototype.generateTickLabels.call(this,o),this._pointLabels=this.getLabels().map((c,r)=>{let l=nr(this.options.pointLabels.callback,[c,r],this);return l||l===0?l:""}).filter((c,r)=>this.chart.getDataVisibility(r))}fit(){let o=this.options;o.display&&o.pointLabels.display?_6(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(o,c,r,l){this.xCenter+=Math.floor((o-c)/2),this.yCenter+=Math.floor((r-l)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(o,c,r,l))}getIndexAngle(o){let c=pr/(this._pointLabels.length||1),r=this.options.startAngle||0;return ha(o*c+os(r))}getDistanceFromCenterForValue(o){if(Sn(o))return NaN;let c=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-o)*c:(o-this.min)*c}getValueForDistanceFromCenter(o){if(Sn(o))return NaN;let c=o/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-c:this.min+c}getPointLabelContext(o){let c=this._pointLabels||[];if(o>=0&&o<c.length){let r=c[o];return T6(this.getContext(),o,r)}}getPointPosition(o,c,r=0){let l=this.getIndexAngle(o)-Or+r;return{x:Math.cos(l)*c+this.xCenter,y:Math.sin(l)*c+this.yCenter,angle:l}}getPointPositionForValue(o,c){return this.getPointPosition(o,this.getDistanceFromCenterForValue(c))}getBasePosition(o){return this.getPointPositionForValue(o||0,this.getBaseValue())}getPointLabelPosition(o){let{left:c,top:r,right:l,bottom:t}=this._pointLabelItems[o];return{left:c,top:r,right:l,bottom:t}}drawBackground(){let{backgroundColor:o,grid:{circular:c}}=this.options;if(o){let r=this.ctx;r.save(),r.beginPath(),wP(this,this.getDistanceFromCenterForValue(this._endValue),c,this._pointLabels.length),r.closePath(),r.fillStyle=o,r.fill(),r.restore()}}drawGrid(){let o=this.ctx,c=this.options,{angleLines:r,grid:l,border:t}=c,g=this._pointLabels.length,C,I,O;if(c.pointLabels.display&&k6(this,g),l.display&&this.ticks.forEach((z,q)=>{if(q!==0||q===0&&this.min<0){I=this.getDistanceFromCenterForValue(z.value);let ie=this.getContext(q),de=l.setContext(ie),xe=t.setContext(ie);I6(this,de,I,g,xe)}}),r.display){for(o.save(),C=g-1;C>=0;C--){let z=r.setContext(this.getPointLabelContext(C)),{color:q,lineWidth:ie}=z;!ie||!q||(o.lineWidth=ie,o.strokeStyle=q,o.setLineDash(z.borderDash),o.lineDashOffset=z.borderDashOffset,I=this.getDistanceFromCenterForValue(c.ticks.reverse?this.min:this.max),O=this.getPointPosition(C,I),o.beginPath(),o.moveTo(this.xCenter,this.yCenter),o.lineTo(O.x,O.y),o.stroke())}o.restore()}}drawBorder(){}drawLabels(){let o=this.ctx,c=this.options,r=c.ticks;if(!r.display)return;let l=this.getIndexAngle(0),t,g;o.save(),o.translate(this.xCenter,this.yCenter),o.rotate(l),o.textAlign="center",o.textBaseline="middle",this.ticks.forEach((C,I)=>{if(I===0&&this.min>=0&&!c.reverse)return;let O=r.setContext(this.getContext(I)),z=Yr(O.font);if(t=this.getDistanceFromCenterForValue(this.ticks[I].value),O.showLabelBackdrop){o.font=z.string,g=o.measureText(C.label).width,o.fillStyle=O.backdropColor;let q=Co(O.backdropPadding);o.fillRect(-g/2-q.left,-t-z.size/2-q.top,g+q.width,z.size+q.height)}Vd(o,C.label,0,-t,z,{color:O.color,strokeColor:O.textStrokeColor,strokeWidth:O.textStrokeWidth})}),o.restore()}drawTitle(){}},Xy={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},pa=Object.keys(Xy);function QA(d,o){return d-o}function KA(d,o){if(Sn(o))return null;let c=d._adapter,{parser:r,round:l,isoWeekday:t}=d._parseOpts,g=o;return typeof r=="function"&&(g=r(g)),Ir(g)||(g=typeof r=="string"?c.parse(g,r):c.parse(g)),g===null?null:(l&&(g=l==="week"&&(mu(t)||t===!0)?c.startOf(g,"isoWeek",t):c.startOf(g,l)),+g)}function JA(d,o,c,r){let l=pa.length;for(let t=pa.indexOf(d);t<l-1;++t){let g=Xy[pa[t]],C=g.steps?g.steps:Number.MAX_SAFE_INTEGER;if(g.common&&Math.ceil((c-o)/(C*g.size))<=r)return pa[t]}return pa[l-1]}function E6(d,o,c,r,l){for(let t=pa.length-1;t>=pa.indexOf(c);t--){let g=pa[t];if(Xy[g].common&&d._adapter.diff(l,r,g)>=o-1)return g}return pa[c?pa.indexOf(c):0]}function D6(d){for(let o=pa.indexOf(d)+1,c=pa.length;o<c;++o)if(Xy[pa[o]].common)return pa[o]}function eP(d,o,c){if(!c)d[o]=!0;else if(c.length){let{lo:r,hi:l}=My(c,o),t=c[r]>=o?c[r]:c[l];d[t]=!0}}function A6(d,o,c,r){let l=d._adapter,t=+l.startOf(o[0].value,r),g=o[o.length-1].value,C,I;for(C=t;C<=g;C=+l.add(C,1,r))I=c[C],I>=0&&(o[I].major=!0);return o}function tP(d,o,c){let r=[],l={},t=o.length,g,C;for(g=0;g<t;++g)C=o[g],l[C]=g,r.push({value:C,major:!1});return t===0||!c?r:A6(d,r,l,c)}var D2=(()=>{class d extends _u{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(c){super(c),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(c,r={}){let l=c.time||(c.time={}),t=this._adapter=new WN._date(c.adapters.date);t.init(r),mp(l.displayFormats,t.formats()),this._parseOpts={parser:l.parser,round:l.round,isoWeekday:l.isoWeekday},super.init(c),this._normalized=r.normalized}parse(c,r){return c===void 0?null:KA(this,c)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let c=this.options,r=this._adapter,l=c.time.unit||"day",{min:t,max:g,minDefined:C,maxDefined:I}=this.getUserBounds();function O(z){!C&&!isNaN(z.min)&&(t=Math.min(t,z.min)),!I&&!isNaN(z.max)&&(g=Math.max(g,z.max))}(!C||!I)&&(O(this._getLabelBounds()),(c.bounds!=="ticks"||c.ticks.source!=="labels")&&O(this.getMinMax(!1))),t=Ir(t)&&!isNaN(t)?t:+r.startOf(Date.now(),l),g=Ir(g)&&!isNaN(g)?g:+r.endOf(Date.now(),l)+1,this.min=Math.min(t,g-1),this.max=Math.max(t+1,g)}_getLabelBounds(){let c=this.getLabelTimestamps(),r=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return c.length&&(r=c[0],l=c[c.length-1]),{min:r,max:l}}buildTicks(){let c=this.options,r=c.time,l=c.ticks,t=l.source==="labels"?this.getLabelTimestamps():this._generate();c.bounds==="ticks"&&t.length&&(this.min=this._userMin||t[0],this.max=this._userMax||t[t.length-1]);let g=this.min,C=this.max,I=RD(t,g,C);return this._unit=r.unit||(l.autoSkip?JA(r.minUnit,this.min,this.max,this._getLabelCapacity(g)):E6(this,I.length,r.minUnit,this.min,this.max)),this._majorUnit=!l.major.enabled||this._unit==="year"?void 0:D6(this._unit),this.initOffsets(t),c.reverse&&I.reverse(),tP(this,I,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(c=>+c.value))}initOffsets(c=[]){let r=0,l=0,t,g;this.options.offset&&c.length&&(t=this.getDecimalForValue(c[0]),c.length===1?r=1-t:r=(this.getDecimalForValue(c[1])-t)/2,g=this.getDecimalForValue(c[c.length-1]),c.length===1?l=g:l=(g-this.getDecimalForValue(c[c.length-2]))/2);let C=c.length<3?.5:.25;r=no(r,0,C),l=no(l,0,C),this._offsets={start:r,end:l,factor:1/(r+1+l)}}_generate(){let c=this._adapter,r=this.min,l=this.max,t=this.options,g=t.time,C=g.unit||JA(g.minUnit,r,l,this._getLabelCapacity(r)),I=Zi(t.ticks.stepSize,1),O=C==="week"?g.isoWeekday:!1,z=mu(O)||O===!0,q={},ie=r,de,xe;if(z&&(ie=+c.startOf(ie,"isoWeek",O)),ie=+c.startOf(ie,z?"day":C),c.diff(l,r,C)>1e5*I)throw new Error(r+" and "+l+" are too far apart with stepSize of "+I+" "+C);let Ie=t.ticks.source==="data"&&this.getDataTimestamps();for(de=ie,xe=0;de<l;de=+c.add(de,I,C),xe++)eP(q,de,Ie);return(de===l||t.bounds==="ticks"||xe===1)&&eP(q,de,Ie),Object.keys(q).sort(QA).map(Me=>+Me)}getLabelForValue(c){let r=this._adapter,l=this.options.time;return l.tooltipFormat?r.format(c,l.tooltipFormat):r.format(c,l.displayFormats.datetime)}format(c,r){let t=this.options.time.displayFormats,g=this._unit,C=r||t[g];return this._adapter.format(c,C)}_tickFormatFunction(c,r,l,t){let g=this.options,C=g.ticks.callback;if(C)return nr(C,[c,r,l],this);let I=g.time.displayFormats,O=this._unit,z=this._majorUnit,q=O&&I[O],ie=z&&I[z],de=l[r],xe=z&&ie&&de&&de.major;return this._adapter.format(c,t||(xe?ie:q))}generateTickLabels(c){let r,l,t;for(r=0,l=c.length;r<l;++r)t=c[r],t.label=this._tickFormatFunction(t.value,r,c)}getDecimalForValue(c){return c===null?NaN:(c-this.min)/(this.max-this.min)}getPixelForValue(c){let r=this._offsets,l=this.getDecimalForValue(c);return this.getPixelForDecimal((r.start+l)*r.factor)}getValueForPixel(c){let r=this._offsets,l=this.getDecimalForPixel(c)/r.factor-r.end;return this.min+l*(this.max-this.min)}_getLabelSize(c){let r=this.options.ticks,l=this.ctx.measureText(c).width,t=os(this.isHorizontal()?r.maxRotation:r.minRotation),g=Math.cos(t),C=Math.sin(t),I=this._resolveTickFontOptions(0).size;return{w:l*g+I*C,h:l*C+I*g}}_getLabelCapacity(c){let r=this.options.time,l=r.displayFormats,t=l[r.unit]||l.millisecond,g=this._tickFormatFunction(c,0,tP(this,[c],this._majorUnit),t),C=this._getLabelSize(g),I=Math.floor(this.isHorizontal()?this.width/C.w:this.height/C.h)-1;return I>0?I:1}getDataTimestamps(){let c=this._cache.data||[],r,l;if(c.length)return c;let t=this.getMatchingVisibleMetas();if(this._normalized&&t.length)return this._cache.data=t[0].controller.getAllParsedValues(this);for(r=0,l=t.length;r<l;++r)c=c.concat(t[r].controller.getAllParsedValues(this));return this._cache.data=this.normalize(c)}getLabelTimestamps(){let c=this._cache.labels||[],r,l;if(c.length)return c;let t=this.getLabels();for(r=0,l=t.length;r<l;++r)c.push(KA(this,t[r]));return this._cache.labels=this._normalized?c:this.normalize(c)}normalize(c){return FC(c.sort(QA))}}return d})();function Vy(d,o,c){let r=0,l=d.length-1,t,g,C,I;c?(o>=d[r].pos&&o<=d[l].pos&&({lo:r,hi:l}=ml(d,"pos",o)),{pos:t,time:C}=d[r],{pos:g,time:I}=d[l]):(o>=d[r].time&&o<=d[l].time&&({lo:r,hi:l}=ml(d,"time",o)),{time:t,pos:C}=d[r],{time:g,pos:I}=d[l]);let O=g-t;return O?C+(I-C)*(o-t)/O:C}var A2=class extends D2{static id="timeseries";static defaults=D2.defaults;constructor(o){super(o),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let o=this._getTimestampsForTable(),c=this._table=this.buildLookupTable(o);this._minPos=Vy(c,this.min),this._tableRange=Vy(c,this.max)-this._minPos,super.initOffsets(o)}buildLookupTable(o){let{min:c,max:r}=this,l=[],t=[],g,C,I,O,z;for(g=0,C=o.length;g<C;++g)O=o[g],O>=c&&O<=r&&l.push(O);if(l.length<2)return[{time:c,pos:0},{time:r,pos:1}];for(g=0,C=l.length;g<C;++g)z=l[g+1],I=l[g-1],O=l[g],Math.round((z+I)/2)!==O&&t.push({time:O,pos:g/(C-1)});return t}_generate(){let o=this.min,c=this.max,r=super.getDataTimestamps();return(!r.includes(o)||!r.length)&&r.splice(0,0,o),(!r.includes(c)||r.length===1)&&r.push(c),r.sort((l,t)=>l-t)}_getTimestampsForTable(){let o=this._cache.all||[];if(o.length)return o;let c=this.getDataTimestamps(),r=this.getLabelTimestamps();return c.length&&r.length?o=this.normalize(c.concat(r)):o=c.length?c:r,o=this._cache.all=o,o}getDecimalForValue(o){return(Vy(this._table,o)-this._minPos)/this._tableRange}getValueForPixel(o){let c=this._offsets,r=this.getDecimalForPixel(o)/c.factor-c.end;return Vy(this._table,r*this._tableRange+this._minPos,!0)}},P6=Object.freeze({__proto__:null,CategoryScale:u6,LinearScale:k2,LogarithmicScale:I2,RadialLinearScale:E2,TimeScale:D2,TimeSeriesScale:A2}),Qy=[UN,pj,l6,P6];Cp.register(...Qy);var O6=["chartContainer"];Cp.register(...Qy);var CP=(()=>{let o=class o{constructor(r,l,t){this.http=r,this.router=l,this.razorpayService=t,this.apiUrl=Cn,this.earn=null,this.years=[],this.selectedYear=0,this.selectedMonth=0,this.months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.currentWeek=0,this.totalWeeks=0,this.allChartData=[],this.allLabelsData=[],this.dateRange="";for(let g=2022;g<=2030;g++)this.years.push(g)}ngOnInit(){this.initializeChart(),this.loadDefaultEarnings(),this.getCredits()}getCredits(){this.razorpayService.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits},error:r=>{console.log(r)}})}initializeChart(){let r=document.getElementById("MyChart");this.chart=new Cp(r,{type:"bar",data:{labels:[],datasets:[{data:[],backgroundColor:"limegreen",barPercentage:.8,categoryPercentage:.8}]},options:{aspectRatio:1.8,plugins:{tooltip:{enabled:!1}},scales:{y:{display:!1},x:{display:!0,grid:{display:!1}}}}}),this.chart.canvas.addEventListener("click",l=>{let t=this.chart.getElementsAtEventForMode(l,"nearest",{intersect:!0},!1);if(t.length>0){let g=t[0],C=this.chart.data.labels[g.index],I=this.chart.data.datasets[g.datasetIndex].data[g.index];this.earn=I}})}loadDefaultEarnings(){let r=new Date;this.selectedYear=r.getFullYear(),this.selectedMonth=r.getMonth(),this.updateChartData(this.selectedYear,this.selectedMonth)}onYearMonthChange(){this.selectedYear!==0&&this.selectedMonth!==0&&this.updateChartData(this.selectedYear,this.selectedMonth)}updateChartData(r,l){let t=localStorage.getItem("providerId"),g=`${this.apiUrl}providers/earnings/get-earnings/${t}`;this.http.get(g).subscribe(C=>{console.log("API Response:",C);let O=C.sort((q,ie)=>{let de=new Date(q.date),xe=new Date(ie.date);return de.getTime()-xe.getTime()}).filter(q=>{let ie=new Date(q.date);return ie.getFullYear()===r&&ie.getMonth()===l});console.log("Filtered Data:",O);let z=this.transformData(O,r,l);this.allChartData=z.data,this.allLabelsData=z.labels,this.totalWeeks=Math.ceil(this.allChartData.length/7),this.currentWeek=0,this.displayCurrentWeek()},C=>{console.error(C)})}transformData(r,l,t){let g=new Date(l,t+1,0).getDate(),C=Array.from({length:g},(O,z)=>(z+1).toString()),I=new Array(g).fill(0);return r.forEach(O=>{let q=new Date(O.date).getDate();I[q-1]+=O.amount}),console.log("Transformed Data:",{labels:C,amounts:I}),{labels:C,data:I}}displayCurrentWeek(){let r=this.currentWeek*7,l=r+7,t=this.allLabelsData.slice(r,l),g=this.allChartData.slice(r,l);console.log("Week Labels:",t),console.log("Week Data:",g),this.chart.data.labels=t,this.chart.data.datasets[0].data=g,this.chart.update(),this.updateDateRange(t)}updateDateRange(r){if(r.length>0){let l=this.selectedYear,t=this.selectedMonth,g=new Date(l,t,parseInt(r[0])),C=new Date(l,t,parseInt(r[r.length-1]));this.dateRange=`${g.toDateString()} - ${C.toDateString()}`}else this.dateRange=""}previousWeek(){this.currentWeek>0?this.currentWeek--:this.navigateMonth("previous"),this.displayCurrentWeek()}nextWeek(){this.currentWeek<this.totalWeeks-1?this.currentWeek++:this.navigateMonth("next"),this.displayCurrentWeek()}navigateMonth(r){r==="previous"?this.selectedMonth===0?Number(this.selectedYear)>this.years[0]&&(this.selectedYear--,this.selectedMonth=11):this.selectedMonth--:this.selectedMonth===11?this.selectedYear<this.years[this.years.length-1]&&(this.selectedYear++,this.selectedMonth=0):this.selectedMonth++,this.updateChartData(this.selectedYear,this.selectedMonth)}navToCredit(){this.router.navigate(["credits"])}navToMenu(){this.router.navigate(["menu"])}navToPackage(){this.router.navigate(["packages"])}};o.\u0275fac=function(l){return new(l||o)(fe(Gi),fe(Bt),fe(zo))},o.\u0275cmp=ft({type:o,selectors:[["app-earnings"]],viewQuery:function(l,t){if(l&1&&yi(O6,5),l&2){let g;_i(g=bi())&&(t.chartContainer=g.first)}},decls:76,vars:5,consts:[["chartContainer",""],[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell"],[1,"material-symbols-outlined","notranslate"],[1,"sub-container"],[1,"chart-container"],[1,"chart-navigation"],[2,"font-size","36px",3,"click"],[1,"date-range"],[1,"scroll-container"],[1,"icon2"],["id","MyChart"],[1,"bank-transfer"],[1,"middle-text"],[1,"withdraw-div"],[1,"big-text"],[1,"credit-div"],[1,"icon-credit"],[1,"icon"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],[1,"credit1"],[1,"title"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"credit-div",3,"click"],[1,"package"],["src","assets/packages/silver coin 1.png",1,"package-img"],[2,"height","5rem"]],template:function(l,t){if(l&1){let g=Xt();V(0,"div",1)(1,"div",2),Oe("click",function(){return gt(g),_t(t.navToMenu())}),$(2,"\u2630"),j(),V(3,"div",3)(4,"div",4),Oe("click",function(){return gt(g),_t(t.navToCredit())}),ke(5,"img",5),V(6,"pre"),$(7),j()(),V(8,"div",6)(9,"span",7),$(10,"notifications"),j()()(),V(11,"div",8)(12,"div",9)(13,"div",10)(14,"span",11),Oe("click",function(){return gt(g),_t(t.previousWeek())}),$(15,"	<"),j(),V(16,"p",12),$(17),j(),V(18,"span",11),Oe("click",function(){return gt(g),_t(t.nextWeek())}),$(19,">"),j()(),V(20,"div",13,0)(22,"span",14),$(23,"\u20B9 \xA0"),V(24,"span"),$(25),j()(),ke(26,"br")(27,"br"),V(28,"canvas",15),$(29),j()()(),V(30,"div")(31,"div",16)(32,"span",17),$(33,"Bank transfer"),j(),V(34,"span",7),$(35,"chevron_right"),j()(),ke(36,"br"),V(37,"div",18)(38,"div")(39,"span",19),$(40,"\u20B9 1897"),j(),V(41,"span",17),$(42,"28-29 Mar"),j(),V(43,"span",17),$(44,"Upcoming"),j()(),V(45,"div")(46,"span",19),$(47,"\u20B9 176"),j(),V(48,"span",17),$(49,"26-27 Mar"),j(),V(50,"span",17),$(51,"Success"),j()()()(),V(52,"div",20)(53,"div",21)(54,"div",22)(55,"span",23),$(56,"poker_chip"),j()(),$(57," \xA0 \xA0 "),V(58,"div",24)(59,"span",25),$(60,"Credits"),j(),V(61,"span",25),$(62),j()()(),V(63,"span",26),Oe("click",function(){return gt(g),_t(t.navToCredit())}),$(64,"chevron_right"),j()(),V(65,"div",27),Oe("click",function(){return gt(g),_t(t.navToPackage())}),V(66,"div",21)(67,"span",28),ke(68,"img",29),$(69,"\xA0 "),V(70,"pre"),$(71,"Silver"),j()()(),V(72,"span",26),Oe("click",function(){return gt(g),_t(t.navToPackage())}),$(73,"chevron_right"),j()()()(),ke(74,"div",30)(75,"app-fotter")}l&2&&(ue(7),Ft(t.credits),ue(10),Ft(t.dateRange),ue(8),Ft(t.earn),ue(4),Ft(t.chart),ue(33),Ft(t.credits))},dependencies:[ul],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100%;height:100%}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#d16611;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:8rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:5rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border-radius:.4rem;border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh;display:grid;row-gap:2rem}.chart-container[_ngcontent-%COMP%]{width:100%;height:fit-content;display:grid;row-gap:1rem;box-shadow:0 5px 5px #00000080;border-radius:.5rem}.scroll-container[_ngcontent-%COMP%]{position:relative;width:100%;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}#MyChart[_ngcontent-%COMP%]{background-color:#d6ffdf3b;width:100%;display:inline-block;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none;min-width:100%}.chart-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .chart-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{float:left;text-align:left}.icon2[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.8rem;font-weight:500;line-height:24.2px;color:#49a010;float:left;text-align:left;display:flex;margin-left:1rem}.earning-tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:24.2px;float:left;text-align:left}.bank-transfer[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.withdraw-div[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:49% 49%;column-gap:2%}.withdraw-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:grid;padding:1rem;row-gap:0;height:120px;border:.25px solid black;border-radius:.5rem}.credit-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;height:2rem}.icon[_ngcontent-%COMP%]{width:2rem;height:2rem;border-radius:.4rem;border:.25px solid black}.icon-credit[_ngcontent-%COMP%]{display:flex;width:30%;height:2rem}.credit1[_ngcontent-%COMP%]{display:grid;border:none;justify-content:space-around}.rank[_ngcontent-%COMP%]{display:grid;float:left;text-align:left}.title[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:22.94px}.middle-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px}.big-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:20px;font-weight:600;line-height:19.36px}.date-div[_ngcontent-%COMP%]{width:100%;display:flex;column-gap:.5rem}.date-div[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:10rem;height:2rem;border:.25px solid black}.chart-navigation[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.date-range[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"inter" sans-serif;font-weight:500}.package[_ngcontent-%COMP%]{width:max-content;height:2rem;padding:0 .3rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.package-img[_ngcontent-%COMP%]{width:1.3rem;height:1.3rem}.package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1rem;line-height:1.7rem}']});let d=o;return d})();var SP=(()=>{let o=class o{constructor(r){this.router=r}navToHome(){this.router.navigate(["home"])}};o.\u0275fac=function(l){return new(l||o)(fe(Bt))},o.\u0275cmp=ft({type:o,selectors:[["app-waiting-page"]],decls:10,vars:0,consts:[[1,"container"],[1,"sub-container"],["src","assets/new/Man playing Basketball.gif"],[3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"div"),ke(3,"img",2)(4,"br")(5,"br"),V(6,"p"),$(7,"Thanks for uploading your documents, your documents are under review. We will let you once you ready to work."),j()()(),V(8,"button",3),Oe("click",function(){return t.navToHome()}),$(9,"Next"),j()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:3rem}.sub-container[_ngcontent-%COMP%]{width:80%;margin-top:-5rem;height:max-content;display:grid;align-items:center}.sub-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column}.sub-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60%;height:60%}p[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:16.94px;text-align:center;color:#00000080}button[_ngcontent-%COMP%]{width:90%;height:2.5rem;background:#d16611;color:#f0f8ff;font-size:1.1rem;font-weight:400;line-height:16.94px;border:none;border-radius:.5rem}']});let d=o;return d})();var MP=(()=>{let o=class o{constructor(r){this.router=r}};o.\u0275fac=function(l){return new(l||o)(fe(Bt))},o.\u0275cmp=ft({type:o,selectors:[["app-notification"]],decls:2,vars:0,template:function(l,t){l&1&&(V(0,"p"),$(1,"notification works!"),j())}});let d=o;return d})();var R6=Math.pow(10,8)*24*60*60*1e3,hY=-R6,Ky=6048e5,kP=864e5,IP=6e4,TP=36e5,EP=1e3;var L6=3600;var DP=L6*24,uY=DP*7,F6=DP*365.2425,z6=F6/12,mY=z6*3,R2=Symbol.for("constructDateFrom");function In(d,o){return typeof d=="function"?d(o):d&&typeof d=="object"&&R2 in d?d[R2](o):d instanceof Date?new d.constructor(o):new Date(o)}function dn(d,o){return In(o||d,d)}function Jy(d,o,c){let r=dn(d,c?.in);return isNaN(o)?In(c?.in||d,NaN):(o&&r.setDate(r.getDate()+o),r)}var B6={};function as(){return B6}function fa(d,o){let c=as(),r=o?.weekStartsOn??o?.locale?.options?.weekStartsOn??c.weekStartsOn??c.locale?.options?.weekStartsOn??0,l=dn(d,o?.in),t=l.getDay(),g=(t<r?7:0)+t-r;return l.setDate(l.getDate()-g),l.setHours(0,0,0,0),l}function Ns(d,o){return fa(d,ia(Xi({},o),{weekStartsOn:1}))}function ev(d,o){let c=dn(d,o?.in),r=c.getFullYear(),l=In(c,0);l.setFullYear(r+1,0,4),l.setHours(0,0,0,0);let t=Ns(l),g=In(c,0);g.setFullYear(r,0,4),g.setHours(0,0,0,0);let C=Ns(g);return c.getTime()>=t.getTime()?r+1:c.getTime()>=C.getTime()?r:r-1}function bu(d){let o=dn(d),c=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds()));return c.setUTCFullYear(o.getFullYear()),+d-+c}function AP(d,...o){let c=In.bind(null,d||o.find(r=>typeof r=="object"));return o.map(c)}function L2(d,o){let c=dn(d,o?.in);return c.setHours(0,0,0,0),c}function PP(d,o,c){let[r,l]=AP(c?.in,d,o),t=L2(r),g=L2(l),C=+t-bu(t),I=+g-bu(g);return Math.round((C-I)/kP)}function OP(d,o){let c=ev(d,o),r=In(o?.in||d,0);return r.setFullYear(c,0,4),r.setHours(0,0,0,0),Ns(r)}function RP(d){return d instanceof Date||typeof d=="object"&&Object.prototype.toString.call(d)==="[object Date]"}function LP(d){return!(!RP(d)&&typeof d!="number"||isNaN(+dn(d)))}function FP(d,o){let c=dn(d,o?.in);return c.setFullYear(c.getFullYear(),0,1),c.setHours(0,0,0,0),c}var N6={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},zP=(d,o,c)=>{let r,l=N6[d];return typeof l=="string"?r=l:o===1?r=l.one:r=l.other.replace("{{count}}",o.toString()),c?.addSuffix?c.comparison&&c.comparison>0?"in "+r:r+" ago":r};function tv(d){return(o={})=>{let c=o.width?String(o.width):d.defaultWidth;return d.formats[c]||d.formats[d.defaultWidth]}}var V6={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},j6={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},U6={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},BP={date:tv({formats:V6,defaultWidth:"full"}),time:tv({formats:j6,defaultWidth:"full"}),dateTime:tv({formats:U6,defaultWidth:"full"})};var W6={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},NP=(d,o,c,r)=>W6[d];function Sp(d){return(o,c)=>{let r=c?.context?String(c.context):"standalone",l;if(r==="formatting"&&d.formattingValues){let g=d.defaultFormattingWidth||d.defaultWidth,C=c?.width?String(c.width):g;l=d.formattingValues[C]||d.formattingValues[g]}else{let g=d.defaultWidth,C=c?.width?String(c.width):d.defaultWidth;l=d.values[C]||d.values[g]}let t=d.argumentCallback?d.argumentCallback(o):o;return l[t]}}var H6={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},G6={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},q6={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},$6={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Y6={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Z6={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},X6=(d,o)=>{let c=Number(d),r=c%100;if(r>20||r<10)switch(r%10){case 1:return c+"st";case 2:return c+"nd";case 3:return c+"rd"}return c+"th"},VP={ordinalNumber:X6,era:Sp({values:H6,defaultWidth:"wide"}),quarter:Sp({values:G6,defaultWidth:"wide",argumentCallback:d=>d-1}),month:Sp({values:q6,defaultWidth:"wide"}),day:Sp({values:$6,defaultWidth:"wide"}),dayPeriod:Sp({values:Y6,defaultWidth:"wide",formattingValues:Z6,defaultFormattingWidth:"wide"})};function Mp(d){return(o,c={})=>{let r=c.width,l=r&&d.matchPatterns[r]||d.matchPatterns[d.defaultMatchWidth],t=o.match(l);if(!t)return null;let g=t[0],C=r&&d.parsePatterns[r]||d.parsePatterns[d.defaultParseWidth],I=Array.isArray(C)?K6(C,q=>q.test(g)):Q6(C,q=>q.test(g)),O;O=d.valueCallback?d.valueCallback(I):I,O=c.valueCallback?c.valueCallback(O):O;let z=o.slice(g.length);return{value:O,rest:z}}}function Q6(d,o){for(let c in d)if(Object.prototype.hasOwnProperty.call(d,c)&&o(d[c]))return c}function K6(d,o){for(let c=0;c<d.length;c++)if(o(d[c]))return c}function jP(d){return(o,c={})=>{let r=o.match(d.matchPattern);if(!r)return null;let l=r[0],t=o.match(d.parsePattern);if(!t)return null;let g=d.valueCallback?d.valueCallback(t[0]):t[0];g=c.valueCallback?c.valueCallback(g):g;let C=o.slice(l.length);return{value:g,rest:C}}}var J6=/^(\d+)(th|st|nd|rd)?/i,e8=/\d+/i,t8={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},i8={any:[/^b/i,/^(a|c)/i]},n8={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},r8={any:[/1/i,/2/i,/3/i,/4/i]},o8={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},a8={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},s8={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},l8={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},c8={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},d8={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},UP={ordinalNumber:jP({matchPattern:J6,parsePattern:e8,valueCallback:d=>parseInt(d,10)}),era:Mp({matchPatterns:t8,defaultMatchWidth:"wide",parsePatterns:i8,defaultParseWidth:"any"}),quarter:Mp({matchPatterns:n8,defaultMatchWidth:"wide",parsePatterns:r8,defaultParseWidth:"any",valueCallback:d=>d+1}),month:Mp({matchPatterns:o8,defaultMatchWidth:"wide",parsePatterns:a8,defaultParseWidth:"any"}),day:Mp({matchPatterns:s8,defaultMatchWidth:"wide",parsePatterns:l8,defaultParseWidth:"any"}),dayPeriod:Mp({matchPatterns:c8,defaultMatchWidth:"any",parsePatterns:d8,defaultParseWidth:"any"})};var m_={code:"en-US",formatDistance:zP,formatLong:BP,formatRelative:NP,localize:VP,match:UP,options:{weekStartsOn:0,firstWeekContainsDate:1}};function WP(d,o){let c=dn(d,o?.in);return PP(c,FP(c))+1}function iv(d,o){let c=dn(d,o?.in),r=+Ns(c)-+OP(c);return Math.round(r/Ky)+1}function kp(d,o){let c=dn(d,o?.in),r=c.getFullYear(),l=as(),t=o?.firstWeekContainsDate??o?.locale?.options?.firstWeekContainsDate??l.firstWeekContainsDate??l.locale?.options?.firstWeekContainsDate??1,g=In(o?.in||d,0);g.setFullYear(r+1,0,t),g.setHours(0,0,0,0);let C=fa(g,o),I=In(o?.in||d,0);I.setFullYear(r,0,t),I.setHours(0,0,0,0);let O=fa(I,o);return+c>=+C?r+1:+c>=+O?r:r-1}function HP(d,o){let c=as(),r=o?.firstWeekContainsDate??o?.locale?.options?.firstWeekContainsDate??c.firstWeekContainsDate??c.locale?.options?.firstWeekContainsDate??1,l=kp(d,o),t=In(o?.in||d,0);return t.setFullYear(l,0,r),t.setHours(0,0,0,0),fa(t,o)}function nv(d,o){let c=dn(d,o?.in),r=+fa(c,o)-+HP(c,o);return Math.round(r/Ky)+1}function Fn(d,o){let c=d<0?"-":"",r=Math.abs(d).toString().padStart(o,"0");return c+r}var pc={y(d,o){let c=d.getFullYear(),r=c>0?c:1-c;return Fn(o==="yy"?r%100:r,o.length)},M(d,o){let c=d.getMonth();return o==="M"?String(c+1):Fn(c+1,2)},d(d,o){return Fn(d.getDate(),o.length)},a(d,o){let c=d.getHours()/12>=1?"pm":"am";switch(o){case"a":case"aa":return c.toUpperCase();case"aaa":return c;case"aaaaa":return c[0];case"aaaa":default:return c==="am"?"a.m.":"p.m."}},h(d,o){return Fn(d.getHours()%12||12,o.length)},H(d,o){return Fn(d.getHours(),o.length)},m(d,o){return Fn(d.getMinutes(),o.length)},s(d,o){return Fn(d.getSeconds(),o.length)},S(d,o){let c=o.length,r=d.getMilliseconds(),l=Math.trunc(r*Math.pow(10,c-3));return Fn(l,o.length)}};var Ip={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},F2={G:function(d,o,c){let r=d.getFullYear()>0?1:0;switch(o){case"G":case"GG":case"GGG":return c.era(r,{width:"abbreviated"});case"GGGGG":return c.era(r,{width:"narrow"});case"GGGG":default:return c.era(r,{width:"wide"})}},y:function(d,o,c){if(o==="yo"){let r=d.getFullYear(),l=r>0?r:1-r;return c.ordinalNumber(l,{unit:"year"})}return pc.y(d,o)},Y:function(d,o,c,r){let l=kp(d,r),t=l>0?l:1-l;if(o==="YY"){let g=t%100;return Fn(g,2)}return o==="Yo"?c.ordinalNumber(t,{unit:"year"}):Fn(t,o.length)},R:function(d,o){let c=ev(d);return Fn(c,o.length)},u:function(d,o){let c=d.getFullYear();return Fn(c,o.length)},Q:function(d,o,c){let r=Math.ceil((d.getMonth()+1)/3);switch(o){case"Q":return String(r);case"QQ":return Fn(r,2);case"Qo":return c.ordinalNumber(r,{unit:"quarter"});case"QQQ":return c.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return c.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return c.quarter(r,{width:"wide",context:"formatting"})}},q:function(d,o,c){let r=Math.ceil((d.getMonth()+1)/3);switch(o){case"q":return String(r);case"qq":return Fn(r,2);case"qo":return c.ordinalNumber(r,{unit:"quarter"});case"qqq":return c.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return c.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return c.quarter(r,{width:"wide",context:"standalone"})}},M:function(d,o,c){let r=d.getMonth();switch(o){case"M":case"MM":return pc.M(d,o);case"Mo":return c.ordinalNumber(r+1,{unit:"month"});case"MMM":return c.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return c.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return c.month(r,{width:"wide",context:"formatting"})}},L:function(d,o,c){let r=d.getMonth();switch(o){case"L":return String(r+1);case"LL":return Fn(r+1,2);case"Lo":return c.ordinalNumber(r+1,{unit:"month"});case"LLL":return c.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return c.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return c.month(r,{width:"wide",context:"standalone"})}},w:function(d,o,c,r){let l=nv(d,r);return o==="wo"?c.ordinalNumber(l,{unit:"week"}):Fn(l,o.length)},I:function(d,o,c){let r=iv(d);return o==="Io"?c.ordinalNumber(r,{unit:"week"}):Fn(r,o.length)},d:function(d,o,c){return o==="do"?c.ordinalNumber(d.getDate(),{unit:"date"}):pc.d(d,o)},D:function(d,o,c){let r=WP(d);return o==="Do"?c.ordinalNumber(r,{unit:"dayOfYear"}):Fn(r,o.length)},E:function(d,o,c){let r=d.getDay();switch(o){case"E":case"EE":case"EEE":return c.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return c.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return c.day(r,{width:"short",context:"formatting"});case"EEEE":default:return c.day(r,{width:"wide",context:"formatting"})}},e:function(d,o,c,r){let l=d.getDay(),t=(l-r.weekStartsOn+8)%7||7;switch(o){case"e":return String(t);case"ee":return Fn(t,2);case"eo":return c.ordinalNumber(t,{unit:"day"});case"eee":return c.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return c.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return c.day(l,{width:"short",context:"formatting"});case"eeee":default:return c.day(l,{width:"wide",context:"formatting"})}},c:function(d,o,c,r){let l=d.getDay(),t=(l-r.weekStartsOn+8)%7||7;switch(o){case"c":return String(t);case"cc":return Fn(t,o.length);case"co":return c.ordinalNumber(t,{unit:"day"});case"ccc":return c.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return c.day(l,{width:"narrow",context:"standalone"});case"cccccc":return c.day(l,{width:"short",context:"standalone"});case"cccc":default:return c.day(l,{width:"wide",context:"standalone"})}},i:function(d,o,c){let r=d.getDay(),l=r===0?7:r;switch(o){case"i":return String(l);case"ii":return Fn(l,o.length);case"io":return c.ordinalNumber(l,{unit:"day"});case"iii":return c.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return c.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return c.day(r,{width:"short",context:"formatting"});case"iiii":default:return c.day(r,{width:"wide",context:"formatting"})}},a:function(d,o,c){let l=d.getHours()/12>=1?"pm":"am";switch(o){case"a":case"aa":return c.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return c.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return c.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return c.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(d,o,c){let r=d.getHours(),l;switch(r===12?l=Ip.noon:r===0?l=Ip.midnight:l=r/12>=1?"pm":"am",o){case"b":case"bb":return c.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return c.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return c.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return c.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(d,o,c){let r=d.getHours(),l;switch(r>=17?l=Ip.evening:r>=12?l=Ip.afternoon:r>=4?l=Ip.morning:l=Ip.night,o){case"B":case"BB":case"BBB":return c.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return c.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return c.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(d,o,c){if(o==="ho"){let r=d.getHours()%12;return r===0&&(r=12),c.ordinalNumber(r,{unit:"hour"})}return pc.h(d,o)},H:function(d,o,c){return o==="Ho"?c.ordinalNumber(d.getHours(),{unit:"hour"}):pc.H(d,o)},K:function(d,o,c){let r=d.getHours()%12;return o==="Ko"?c.ordinalNumber(r,{unit:"hour"}):Fn(r,o.length)},k:function(d,o,c){let r=d.getHours();return r===0&&(r=24),o==="ko"?c.ordinalNumber(r,{unit:"hour"}):Fn(r,o.length)},m:function(d,o,c){return o==="mo"?c.ordinalNumber(d.getMinutes(),{unit:"minute"}):pc.m(d,o)},s:function(d,o,c){return o==="so"?c.ordinalNumber(d.getSeconds(),{unit:"second"}):pc.s(d,o)},S:function(d,o){return pc.S(d,o)},X:function(d,o,c){let r=d.getTimezoneOffset();if(r===0)return"Z";switch(o){case"X":return qP(r);case"XXXX":case"XX":return yu(r);case"XXXXX":case"XXX":default:return yu(r,":")}},x:function(d,o,c){let r=d.getTimezoneOffset();switch(o){case"x":return qP(r);case"xxxx":case"xx":return yu(r);case"xxxxx":case"xxx":default:return yu(r,":")}},O:function(d,o,c){let r=d.getTimezoneOffset();switch(o){case"O":case"OO":case"OOO":return"GMT"+GP(r,":");case"OOOO":default:return"GMT"+yu(r,":")}},z:function(d,o,c){let r=d.getTimezoneOffset();switch(o){case"z":case"zz":case"zzz":return"GMT"+GP(r,":");case"zzzz":default:return"GMT"+yu(r,":")}},t:function(d,o,c){let r=Math.trunc(+d/1e3);return Fn(r,o.length)},T:function(d,o,c){return Fn(+d,o.length)}};function GP(d,o=""){let c=d>0?"-":"+",r=Math.abs(d),l=Math.trunc(r/60),t=r%60;return t===0?c+String(l):c+String(l)+o+Fn(t,2)}function qP(d,o){return d%60===0?(d>0?"-":"+")+Fn(Math.abs(d)/60,2):yu(d,o)}function yu(d,o=""){let c=d>0?"-":"+",r=Math.abs(d),l=Fn(Math.trunc(r/60),2),t=Fn(r%60,2);return c+l+o+t}var $P=(d,o)=>{switch(d){case"P":return o.date({width:"short"});case"PP":return o.date({width:"medium"});case"PPP":return o.date({width:"long"});case"PPPP":default:return o.date({width:"full"})}},YP=(d,o)=>{switch(d){case"p":return o.time({width:"short"});case"pp":return o.time({width:"medium"});case"ppp":return o.time({width:"long"});case"pppp":default:return o.time({width:"full"})}},h8=(d,o)=>{let c=d.match(/(P+)(p+)?/)||[],r=c[1],l=c[2];if(!l)return $P(d,o);let t;switch(r){case"P":t=o.dateTime({width:"short"});break;case"PP":t=o.dateTime({width:"medium"});break;case"PPP":t=o.dateTime({width:"long"});break;case"PPPP":default:t=o.dateTime({width:"full"});break}return t.replace("{{date}}",$P(r,o)).replace("{{time}}",YP(l,o))},p_={p:YP,P:h8};var u8=/^D+$/,m8=/^Y+$/,p8=["D","DD","YY","YYYY"];function rv(d){return u8.test(d)}function ov(d){return m8.test(d)}function f_(d,o,c){let r=f8(d,o,c);if(console.warn(r),p8.includes(d))throw new RangeError(r)}function f8(d,o,c){let r=d[0]==="Y"?"years":"days of the month";return`Use \`${d.toLowerCase()}\` instead of \`${d}\` (in \`${o}\`) for formatting ${r} to the input \`${c}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}var g8=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,_8=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,b8=/^'([^]*?)'?$/,y8=/''/g,v8=/[a-zA-Z]/;function ZP(d,o,c){let r=as(),l=c?.locale??r.locale??m_,t=c?.firstWeekContainsDate??c?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,g=c?.weekStartsOn??c?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,C=dn(d,c?.in);if(!LP(C))throw new RangeError("Invalid time value");let I=o.match(_8).map(z=>{let q=z[0];if(q==="p"||q==="P"){let ie=p_[q];return ie(z,l.formatLong)}return z}).join("").match(g8).map(z=>{if(z==="''")return{isToken:!1,value:"'"};let q=z[0];if(q==="'")return{isToken:!1,value:x8(z)};if(F2[q])return{isToken:!0,value:z};if(q.match(v8))throw new RangeError("Format string contains an unescaped latin alphabet character `"+q+"`");return{isToken:!1,value:z}});l.localize.preprocessor&&(I=l.localize.preprocessor(C,I));let O={firstWeekContainsDate:t,weekStartsOn:g,locale:l};return I.map(z=>{if(!z.isToken)return z.value;let q=z.value;(!c?.useAdditionalWeekYearTokens&&ov(q)||!c?.useAdditionalDayOfYearTokens&&rv(q))&&f_(q,o,String(d));let ie=F2[q[0]];return ie(C,q,l.localize,O)}).join("")}function x8(d){let o=d.match(b8);return o?o[1].replace(y8,"'"):d}function XP(){return Object.assign({},as())}function QP(d,o){let c=dn(d,o?.in).getDay();return c===0?7:c}function KP(d,o){let c=w8(o)?new o(0):In(o,0);return c.setFullYear(d.getFullYear(),d.getMonth(),d.getDate()),c.setHours(d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()),c}function w8(d){return typeof d=="function"&&d.prototype?.constructor===d}var C8=10,av=class{subPriority=0;validate(o,c){return!0}},sv=class extends av{constructor(o,c,r,l,t){super(),this.value=o,this.validateValue=c,this.setValue=r,this.priority=l,t&&(this.subPriority=t)}validate(o,c){return this.validateValue(o,this.value,c)}set(o,c,r){return this.setValue(o,c,this.value,r)}},lv=class extends av{priority=C8;subPriority=-1;constructor(o,c){super(),this.context=o||(r=>In(c,r))}set(o,c){return c.timestampIsSet?o:In(o,KP(o,this.context))}};var ni=class{run(o,c,r,l){let t=this.parse(o,c,r,l);return t?{setter:new sv(t.value,this.validate,this.set,this.priority,this.subPriority),rest:t.rest}:null}validate(o,c,r){return!0}};var cv=class extends ni{priority=140;parse(o,c,r){switch(c){case"G":case"GG":case"GGG":return r.era(o,{width:"abbreviated"})||r.era(o,{width:"narrow"});case"GGGGG":return r.era(o,{width:"narrow"});case"GGGG":default:return r.era(o,{width:"wide"})||r.era(o,{width:"abbreviated"})||r.era(o,{width:"narrow"})}}set(o,c,r){return c.era=r,o.setFullYear(r,0,1),o.setHours(0,0,0,0),o}incompatibleTokens=["R","u","t","T"]};var Mn={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},ss={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function $n(d,o){return d&&{value:o(d.value),rest:d.rest}}function yn(d,o){let c=o.match(d);return c?{value:parseInt(c[0],10),rest:o.slice(c[0].length)}:null}function ls(d,o){let c=o.match(d);if(!c)return null;if(c[0]==="Z")return{value:0,rest:o.slice(1)};let r=c[1]==="+"?1:-1,l=c[2]?parseInt(c[2],10):0,t=c[3]?parseInt(c[3],10):0,g=c[5]?parseInt(c[5],10):0;return{value:r*(l*TP+t*IP+g*EP),rest:o.slice(c[0].length)}}function dv(d){return yn(Mn.anyDigitsSigned,d)}function Ki(d,o){switch(d){case 1:return yn(Mn.singleDigit,o);case 2:return yn(Mn.twoDigits,o);case 3:return yn(Mn.threeDigits,o);case 4:return yn(Mn.fourDigits,o);default:return yn(new RegExp("^\\d{1,"+d+"}"),o)}}function Tp(d,o){switch(d){case 1:return yn(Mn.singleDigitSigned,o);case 2:return yn(Mn.twoDigitsSigned,o);case 3:return yn(Mn.threeDigitsSigned,o);case 4:return yn(Mn.fourDigitsSigned,o);default:return yn(new RegExp("^-?\\d{1,"+d+"}"),o)}}function Ep(d){switch(d){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function hv(d,o){let c=o>0,r=c?o:1-o,l;if(r<=50)l=d||100;else{let t=r+50,g=Math.trunc(t/100)*100,C=d>=t%100;l=d+g-(C?100:0)}return c?l:1-l}function uv(d){return d%400===0||d%4===0&&d%100!==0}var mv=class extends ni{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(o,c,r){let l=t=>({year:t,isTwoDigitYear:c==="yy"});switch(c){case"y":return $n(Ki(4,o),l);case"yo":return $n(r.ordinalNumber(o,{unit:"year"}),l);default:return $n(Ki(c.length,o),l)}}validate(o,c){return c.isTwoDigitYear||c.year>0}set(o,c,r){let l=o.getFullYear();if(r.isTwoDigitYear){let g=hv(r.year,l);return o.setFullYear(g,0,1),o.setHours(0,0,0,0),o}let t=!("era"in c)||c.era===1?r.year:1-r.year;return o.setFullYear(t,0,1),o.setHours(0,0,0,0),o}};var pv=class extends ni{priority=130;parse(o,c,r){let l=t=>({year:t,isTwoDigitYear:c==="YY"});switch(c){case"Y":return $n(Ki(4,o),l);case"Yo":return $n(r.ordinalNumber(o,{unit:"year"}),l);default:return $n(Ki(c.length,o),l)}}validate(o,c){return c.isTwoDigitYear||c.year>0}set(o,c,r,l){let t=kp(o,l);if(r.isTwoDigitYear){let C=hv(r.year,t);return o.setFullYear(C,0,l.firstWeekContainsDate),o.setHours(0,0,0,0),fa(o,l)}let g=!("era"in c)||c.era===1?r.year:1-r.year;return o.setFullYear(g,0,l.firstWeekContainsDate),o.setHours(0,0,0,0),fa(o,l)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]};var fv=class extends ni{priority=130;parse(o,c){return c==="R"?Tp(4,o):Tp(c.length,o)}set(o,c,r){let l=In(o,0);return l.setFullYear(r,0,4),l.setHours(0,0,0,0),Ns(l)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]};var gv=class extends ni{priority=130;parse(o,c){return c==="u"?Tp(4,o):Tp(c.length,o)}set(o,c,r){return o.setFullYear(r,0,1),o.setHours(0,0,0,0),o}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]};var _v=class extends ni{priority=120;parse(o,c,r){switch(c){case"Q":case"QQ":return Ki(c.length,o);case"Qo":return r.ordinalNumber(o,{unit:"quarter"});case"QQQ":return r.quarter(o,{width:"abbreviated",context:"formatting"})||r.quarter(o,{width:"narrow",context:"formatting"});case"QQQQQ":return r.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(o,{width:"wide",context:"formatting"})||r.quarter(o,{width:"abbreviated",context:"formatting"})||r.quarter(o,{width:"narrow",context:"formatting"})}}validate(o,c){return c>=1&&c<=4}set(o,c,r){return o.setMonth((r-1)*3,1),o.setHours(0,0,0,0),o}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]};var bv=class extends ni{priority=120;parse(o,c,r){switch(c){case"q":case"qq":return Ki(c.length,o);case"qo":return r.ordinalNumber(o,{unit:"quarter"});case"qqq":return r.quarter(o,{width:"abbreviated",context:"standalone"})||r.quarter(o,{width:"narrow",context:"standalone"});case"qqqqq":return r.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(o,{width:"wide",context:"standalone"})||r.quarter(o,{width:"abbreviated",context:"standalone"})||r.quarter(o,{width:"narrow",context:"standalone"})}}validate(o,c){return c>=1&&c<=4}set(o,c,r){return o.setMonth((r-1)*3,1),o.setHours(0,0,0,0),o}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]};var yv=class extends ni{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(o,c,r){let l=t=>t-1;switch(c){case"M":return $n(yn(Mn.month,o),l);case"MM":return $n(Ki(2,o),l);case"Mo":return $n(r.ordinalNumber(o,{unit:"month"}),l);case"MMM":return r.month(o,{width:"abbreviated",context:"formatting"})||r.month(o,{width:"narrow",context:"formatting"});case"MMMMM":return r.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(o,{width:"wide",context:"formatting"})||r.month(o,{width:"abbreviated",context:"formatting"})||r.month(o,{width:"narrow",context:"formatting"})}}validate(o,c){return c>=0&&c<=11}set(o,c,r){return o.setMonth(r,1),o.setHours(0,0,0,0),o}};var vv=class extends ni{priority=110;parse(o,c,r){let l=t=>t-1;switch(c){case"L":return $n(yn(Mn.month,o),l);case"LL":return $n(Ki(2,o),l);case"Lo":return $n(r.ordinalNumber(o,{unit:"month"}),l);case"LLL":return r.month(o,{width:"abbreviated",context:"standalone"})||r.month(o,{width:"narrow",context:"standalone"});case"LLLLL":return r.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(o,{width:"wide",context:"standalone"})||r.month(o,{width:"abbreviated",context:"standalone"})||r.month(o,{width:"narrow",context:"standalone"})}}validate(o,c){return c>=0&&c<=11}set(o,c,r){return o.setMonth(r,1),o.setHours(0,0,0,0),o}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]};function JP(d,o,c){let r=dn(d,c?.in),l=nv(r,c)-o;return r.setDate(r.getDate()-l*7),dn(r,c?.in)}var xv=class extends ni{priority=100;parse(o,c,r){switch(c){case"w":return yn(Mn.week,o);case"wo":return r.ordinalNumber(o,{unit:"week"});default:return Ki(c.length,o)}}validate(o,c){return c>=1&&c<=53}set(o,c,r,l){return fa(JP(o,r,l),l)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]};function eO(d,o,c){let r=dn(d,c?.in),l=iv(r,c)-o;return r.setDate(r.getDate()-l*7),r}var wv=class extends ni{priority=100;parse(o,c,r){switch(c){case"I":return yn(Mn.week,o);case"Io":return r.ordinalNumber(o,{unit:"week"});default:return Ki(c.length,o)}}validate(o,c){return c>=1&&c<=53}set(o,c,r){return Ns(eO(o,r))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]};var S8=[31,28,31,30,31,30,31,31,30,31,30,31],M8=[31,29,31,30,31,30,31,31,30,31,30,31],Cv=class extends ni{priority=90;subPriority=1;parse(o,c,r){switch(c){case"d":return yn(Mn.date,o);case"do":return r.ordinalNumber(o,{unit:"date"});default:return Ki(c.length,o)}}validate(o,c){let r=o.getFullYear(),l=uv(r),t=o.getMonth();return l?c>=1&&c<=M8[t]:c>=1&&c<=S8[t]}set(o,c,r){return o.setDate(r),o.setHours(0,0,0,0),o}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]};var Sv=class extends ni{priority=90;subpriority=1;parse(o,c,r){switch(c){case"D":case"DD":return yn(Mn.dayOfYear,o);case"Do":return r.ordinalNumber(o,{unit:"date"});default:return Ki(c.length,o)}}validate(o,c){let r=o.getFullYear();return uv(r)?c>=1&&c<=366:c>=1&&c<=365}set(o,c,r){return o.setMonth(0,r),o.setHours(0,0,0,0),o}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]};function Dp(d,o,c){let r=as(),l=c?.weekStartsOn??c?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,t=dn(d,c?.in),g=t.getDay(),I=(o%7+7)%7,O=7-l,z=o<0||o>6?o-(g+O)%7:(I+O)%7-(g+O)%7;return Jy(t,z,c)}var Mv=class extends ni{priority=90;parse(o,c,r){switch(c){case"E":case"EE":case"EEE":return r.day(o,{width:"abbreviated",context:"formatting"})||r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"});case"EEEEE":return r.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"});case"EEEE":default:return r.day(o,{width:"wide",context:"formatting"})||r.day(o,{width:"abbreviated",context:"formatting"})||r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"})}}validate(o,c){return c>=0&&c<=6}set(o,c,r,l){return o=Dp(o,r,l),o.setHours(0,0,0,0),o}incompatibleTokens=["D","i","e","c","t","T"]};var kv=class extends ni{priority=90;parse(o,c,r,l){let t=g=>{let C=Math.floor((g-1)/7)*7;return(g+l.weekStartsOn+6)%7+C};switch(c){case"e":case"ee":return $n(Ki(c.length,o),t);case"eo":return $n(r.ordinalNumber(o,{unit:"day"}),t);case"eee":return r.day(o,{width:"abbreviated",context:"formatting"})||r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"});case"eeeee":return r.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"});case"eeee":default:return r.day(o,{width:"wide",context:"formatting"})||r.day(o,{width:"abbreviated",context:"formatting"})||r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"})}}validate(o,c){return c>=0&&c<=6}set(o,c,r,l){return o=Dp(o,r,l),o.setHours(0,0,0,0),o}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]};var Iv=class extends ni{priority=90;parse(o,c,r,l){let t=g=>{let C=Math.floor((g-1)/7)*7;return(g+l.weekStartsOn+6)%7+C};switch(c){case"c":case"cc":return $n(Ki(c.length,o),t);case"co":return $n(r.ordinalNumber(o,{unit:"day"}),t);case"ccc":return r.day(o,{width:"abbreviated",context:"standalone"})||r.day(o,{width:"short",context:"standalone"})||r.day(o,{width:"narrow",context:"standalone"});case"ccccc":return r.day(o,{width:"narrow",context:"standalone"});case"cccccc":return r.day(o,{width:"short",context:"standalone"})||r.day(o,{width:"narrow",context:"standalone"});case"cccc":default:return r.day(o,{width:"wide",context:"standalone"})||r.day(o,{width:"abbreviated",context:"standalone"})||r.day(o,{width:"short",context:"standalone"})||r.day(o,{width:"narrow",context:"standalone"})}}validate(o,c){return c>=0&&c<=6}set(o,c,r,l){return o=Dp(o,r,l),o.setHours(0,0,0,0),o}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]};function tO(d,o,c){let r=dn(d,c?.in),l=QP(r,c),t=o-l;return Jy(r,t,c)}var Tv=class extends ni{priority=90;parse(o,c,r){let l=t=>t===0?7:t;switch(c){case"i":case"ii":return Ki(c.length,o);case"io":return r.ordinalNumber(o,{unit:"day"});case"iii":return $n(r.day(o,{width:"abbreviated",context:"formatting"})||r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"}),l);case"iiiii":return $n(r.day(o,{width:"narrow",context:"formatting"}),l);case"iiiiii":return $n(r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"}),l);case"iiii":default:return $n(r.day(o,{width:"wide",context:"formatting"})||r.day(o,{width:"abbreviated",context:"formatting"})||r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"}),l)}}validate(o,c){return c>=1&&c<=7}set(o,c,r){return o=tO(o,r),o.setHours(0,0,0,0),o}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]};var Ev=class extends ni{priority=80;parse(o,c,r){switch(c){case"a":case"aa":case"aaa":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"})||r.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaaa":return r.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(o,{width:"wide",context:"formatting"})||r.dayPeriod(o,{width:"abbreviated",context:"formatting"})||r.dayPeriod(o,{width:"narrow",context:"formatting"})}}set(o,c,r){return o.setHours(Ep(r),0,0,0),o}incompatibleTokens=["b","B","H","k","t","T"]};var Dv=class extends ni{priority=80;parse(o,c,r){switch(c){case"b":case"bb":case"bbb":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"})||r.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbbb":return r.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(o,{width:"wide",context:"formatting"})||r.dayPeriod(o,{width:"abbreviated",context:"formatting"})||r.dayPeriod(o,{width:"narrow",context:"formatting"})}}set(o,c,r){return o.setHours(Ep(r),0,0,0),o}incompatibleTokens=["a","B","H","k","t","T"]};var Av=class extends ni{priority=80;parse(o,c,r){switch(c){case"B":case"BB":case"BBB":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"})||r.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBBB":return r.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(o,{width:"wide",context:"formatting"})||r.dayPeriod(o,{width:"abbreviated",context:"formatting"})||r.dayPeriod(o,{width:"narrow",context:"formatting"})}}set(o,c,r){return o.setHours(Ep(r),0,0,0),o}incompatibleTokens=["a","b","t","T"]};var Pv=class extends ni{priority=70;parse(o,c,r){switch(c){case"h":return yn(Mn.hour12h,o);case"ho":return r.ordinalNumber(o,{unit:"hour"});default:return Ki(c.length,o)}}validate(o,c){return c>=1&&c<=12}set(o,c,r){let l=o.getHours()>=12;return l&&r<12?o.setHours(r+12,0,0,0):!l&&r===12?o.setHours(0,0,0,0):o.setHours(r,0,0,0),o}incompatibleTokens=["H","K","k","t","T"]};var Ov=class extends ni{priority=70;parse(o,c,r){switch(c){case"H":return yn(Mn.hour23h,o);case"Ho":return r.ordinalNumber(o,{unit:"hour"});default:return Ki(c.length,o)}}validate(o,c){return c>=0&&c<=23}set(o,c,r){return o.setHours(r,0,0,0),o}incompatibleTokens=["a","b","h","K","k","t","T"]};var Rv=class extends ni{priority=70;parse(o,c,r){switch(c){case"K":return yn(Mn.hour11h,o);case"Ko":return r.ordinalNumber(o,{unit:"hour"});default:return Ki(c.length,o)}}validate(o,c){return c>=0&&c<=11}set(o,c,r){return o.getHours()>=12&&r<12?o.setHours(r+12,0,0,0):o.setHours(r,0,0,0),o}incompatibleTokens=["h","H","k","t","T"]};var Lv=class extends ni{priority=70;parse(o,c,r){switch(c){case"k":return yn(Mn.hour24h,o);case"ko":return r.ordinalNumber(o,{unit:"hour"});default:return Ki(c.length,o)}}validate(o,c){return c>=1&&c<=24}set(o,c,r){let l=r<=24?r%24:r;return o.setHours(l,0,0,0),o}incompatibleTokens=["a","b","h","H","K","t","T"]};var Fv=class extends ni{priority=60;parse(o,c,r){switch(c){case"m":return yn(Mn.minute,o);case"mo":return r.ordinalNumber(o,{unit:"minute"});default:return Ki(c.length,o)}}validate(o,c){return c>=0&&c<=59}set(o,c,r){return o.setMinutes(r,0,0),o}incompatibleTokens=["t","T"]};var zv=class extends ni{priority=50;parse(o,c,r){switch(c){case"s":return yn(Mn.second,o);case"so":return r.ordinalNumber(o,{unit:"second"});default:return Ki(c.length,o)}}validate(o,c){return c>=0&&c<=59}set(o,c,r){return o.setSeconds(r,0),o}incompatibleTokens=["t","T"]};var Bv=class extends ni{priority=30;parse(o,c){let r=l=>Math.trunc(l*Math.pow(10,-c.length+3));return $n(Ki(c.length,o),r)}set(o,c,r){return o.setMilliseconds(r),o}incompatibleTokens=["t","T"]};var Nv=class extends ni{priority=10;parse(o,c){switch(c){case"X":return ls(ss.basicOptionalMinutes,o);case"XX":return ls(ss.basic,o);case"XXXX":return ls(ss.basicOptionalSeconds,o);case"XXXXX":return ls(ss.extendedOptionalSeconds,o);case"XXX":default:return ls(ss.extended,o)}}set(o,c,r){return c.timestampIsSet?o:In(o,o.getTime()-bu(o)-r)}incompatibleTokens=["t","T","x"]};var Vv=class extends ni{priority=10;parse(o,c){switch(c){case"x":return ls(ss.basicOptionalMinutes,o);case"xx":return ls(ss.basic,o);case"xxxx":return ls(ss.basicOptionalSeconds,o);case"xxxxx":return ls(ss.extendedOptionalSeconds,o);case"xxx":default:return ls(ss.extended,o)}}set(o,c,r){return c.timestampIsSet?o:In(o,o.getTime()-bu(o)-r)}incompatibleTokens=["t","T","X"]};var jv=class extends ni{priority=40;parse(o){return dv(o)}set(o,c,r){return[In(o,r*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"};var Uv=class extends ni{priority=20;parse(o){return dv(o)}set(o,c,r){return[In(o,r),{timestampIsSet:!0}]}incompatibleTokens="*"};var iO={G:new cv,y:new mv,Y:new pv,R:new fv,u:new gv,Q:new _v,q:new bv,M:new yv,L:new vv,w:new xv,I:new wv,d:new Cv,D:new Sv,E:new Mv,e:new kv,c:new Iv,i:new Tv,a:new Ev,b:new Dv,B:new Av,h:new Pv,H:new Ov,K:new Rv,k:new Lv,m:new Fv,s:new zv,S:new Bv,X:new Nv,x:new Vv,t:new jv,T:new Uv};var k8=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,I8=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,T8=/^'([^]*?)'?$/,E8=/''/g,D8=/\S/,A8=/[a-zA-Z]/;function nO(d,o,c,r){let l=()=>In(r?.in||c,NaN),t=XP(),g=r?.locale??t.locale??m_,C=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??t.firstWeekContainsDate??t.locale?.options?.firstWeekContainsDate??1,I=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0;if(!o)return d?l():dn(c,r?.in);let O={firstWeekContainsDate:C,weekStartsOn:I,locale:g},z=[new lv(r?.in,c)],q=o.match(I8).map(Me=>{let Ge=Me[0];if(Ge in p_){let He=p_[Ge];return He(Me,g.formatLong)}return Me}).join("").match(k8),ie=[];for(let Me of q){!r?.useAdditionalWeekYearTokens&&ov(Me)&&f_(Me,o,d),!r?.useAdditionalDayOfYearTokens&&rv(Me)&&f_(Me,o,d);let Ge=Me[0],He=iO[Ge];if(He){let{incompatibleTokens:ht}=He;if(Array.isArray(ht)){let yt=ie.find(Tt=>ht.includes(Tt.token)||Tt.token===Ge);if(yt)throw new RangeError(`The format string mustn't contain \`${yt.fullToken}\` and \`${Me}\` at the same time`)}else if(He.incompatibleTokens==="*"&&ie.length>0)throw new RangeError(`The format string mustn't contain \`${Me}\` and any other token at the same time`);ie.push({token:Ge,fullToken:Me});let Mt=He.run(d,Me,g.match,O);if(!Mt)return l();z.push(Mt.setter),d=Mt.rest}else{if(Ge.match(A8))throw new RangeError("Format string contains an unescaped latin alphabet character `"+Ge+"`");if(Me==="''"?Me="'":Ge==="'"&&(Me=P8(Me)),d.indexOf(Me)===0)d=d.slice(Me.length);else return l()}}if(d.length>0&&D8.test(d))return l();let de=z.map(Me=>Me.priority).sort((Me,Ge)=>Ge-Me).filter((Me,Ge,He)=>He.indexOf(Me)===Ge).map(Me=>z.filter(Ge=>Ge.priority===Me).sort((Ge,He)=>He.subPriority-Ge.subPriority)).map(Me=>Me[0]),xe=dn(c,r?.in);if(isNaN(+xe))return l();let Ie={};for(let Me of de){if(!Me.validate(xe,O))return l();let Ge=Me.set(xe,Ie,O);Array.isArray(Ge)?(xe=Ge[0],Object.assign(Ie,Ge[1])):xe=Ge}return xe}function P8(d){return d.match(T8)[1].replace(E8,"'")}var O8=["dialogTemplate"],R8=d=>({selected:d});function L8(d,o){if(d&1){let c=Xt();kd(0),V(1,"div")(2,"p",3),Oe("click",function(){gt(c);let l=lt();return _t(l.extend())}),$(3,"expand_circle_right"),j()(),Id()}}function F8(d,o){if(d&1){let c=Xt();kd(0),V(1,"span",17)(2,"input",18),Oe("change",function(){gt(c);let l=lt().$implicit,t=lt();return _t(t.availabilityService(l.categoryId.name))}),j(),$(3,"\xA0 "),V(4,"span",19),$(5),j()(),Id()}if(d&2){let c=lt().$implicit,r=lt();ue(2),Fe("checked",r.selectedService===c.categoryId.name),ue(3),Ft(c.categoryId.name)}}function z8(d,o){if(d&1){let c=Xt();kd(0),V(1,"span",3),Oe("click",function(){gt(c);let l=lt(2);return _t(l.openServiceDialog())}),$(2,"expand_circle_down"),j(),Id()}}function B8(d,o){if(d&1){let c=Xt();V(0,"div",20)(1,"span",21)(2,"input",18),Oe("change",function(){gt(c);let l=lt().$implicit,t=lt();return _t(t.availabilityService(l.item.categoryId.name))}),j(),V(3,"span",19),$(4),j()()()}if(d&2){let c=lt().$implicit,r=lt();ue(2),Fe("checked",r.selectedService===c.item.categoryId.name),ue(2),Ft(c.item.categoryId.name)}}function N8(d,o){if(d&1&&(kd(0),Nt(1,F8,6,2,"ng-container",4)(2,z8,3,0,"ng-container",4)(3,B8,5,2,"div",16),Id()),d&2){let c=o.index,r=lt();ue(),Fe("ngIf",c<=1&&!r.extendServices),ue(),Fe("ngIf",c===2&&!r.extendServices),ue(),Fe("ngIf",r.extendServices)}}function V8(d,o){if(d&1){let c=Xt();kd(0),V(1,"div",22),Oe("click",function(){let l=gt(c),t=l.$implicit,g=l.index,C=lt();return _t(C.selected(t,g))}),V(2,"p"),$(3),j(),V(4,"p"),$(5),j(),V(6,"span",23),$(7),j()(),Id()}if(d&2){let c=o.$implicit,r=o.index,l=lt();ue(),Fe("ngClass",di(4,R8,l.selectedIndex===r)),ue(2),Ft(c.day.substring(0,3).toUpperCase()),ue(2),Ft(c.date.split("-")[0]),ue(2),Ft(c.workingStaus?"check":"close")}}function j8(d,o){if(d&1){let c=Xt();V(0,"div",29)(1,"input",30),zr("ngModelChange",function(l){let t=gt(c).$implicit;return Fr(t.isSelected,l)||(t.isSelected=l),_t(l)}),Oe("change",function(l){let t=gt(c).$implicit,g=lt(2);return _t(g.onToggleChange(l,t))}),j(),V(2,"span",19),$(3),j()()}if(d&2){let c=o.$implicit;ue(),Lr("ngModel",c.isSelected),ue(2),Ft(c.time)}}function U8(d,o){if(d&1&&(V(0,"div",24)(1,"div",25)(2,"span",12),$(3,"check"),j(),V(4,"p"),$(5,"confirmation your working hours"),j(),V(6,"span",12),$(7,"expand_circle_up"),j()(),ke(8,"br")(9,"div",26),V(10,"section",27),Nt(11,j8,4,2,"div",28),j()()),d&2){let c=lt();ue(11),Fe("ngForOf",c.nextDaysOfIndex.timming)}}function W8(d,o){if(d&1){let c=Xt();V(0,"div")(1,"div",35)(2,"input",18),Oe("change",function(){let l=gt(c).$implicit,t=lt(2);return _t(t.availabilityService(l.categoryId.name))}),j(),$(3," \xA0"),V(4,"span",36),$(5),j()()()}if(d&2){let c=o.$implicit,r=lt(2);ue(2),Fe("checked",r.selectedService===c.categoryId.name),ue(3),Ft(c.categoryId.name)}}function H8(d,o){if(d&1){let c=Xt();V(0,"h1",31),$(1,"Select Services"),j(),V(2,"div",32)(3,"form"),Nt(4,W8,6,2,"div",5),j()(),V(5,"div",33)(6,"button",34),Oe("click",function(){gt(c);let l=lt();return _t(l.onCancel())}),$(7,"Cancel"),j(),V(8,"button",34),Oe("click",function(){gt(c);let l=lt();return _t(l.onSubmit())}),$(9,"Submit"),j()()}if(d&2){let c=lt();ue(4),Fe("ngForOf",c.services)}}var rO=(()=>{let o=class o{constructor(r,l,t,g,C,I,O,z){this.location=r,this.renderer=l,this.el=t,this.http=g,this.dialog=C,this.jobDetailsService=I,this.userService=O,this.dailogeBoxService=z,this.date=new Date,this.userId=localStorage.getItem("providerId"),this.apiUrl=Cn,this.defaultMonth=this.date.toLocaleDateString("default",{month:"long"}),this.daySelected=String(this.date.getDate()).padStart(2,"0"),this.monthSelected=this.defaultMonth.substring(0,3),this.dateSelected=this.date.getDate(),this.isChecked=!1,this.working=!1,this.extendServices=!1,this.services=[],this.nextFourDays=[],this.nextDaysOfIndex=[],this.selectedService="",this.timing=[{time:"07AM-10AM",isSelected:!1},{time:"10AM-01PM",isSelected:!1},{time:"01PM-04Pm",isSelected:!1},{time:"04PM-07Pm",isSelected:!1},{time:"07PM-10Pm",isSelected:!1}],this.selectedIndex=0,this.api="",this.availabilityResponse=[]}extend(){this.extendServices=!this.extendServices}openServiceDialog(){this.dialogRef=this.dialog.open(this.dialogTemplate),this.dialogRef.afterClosed().subscribe(r=>{r&&(this.services=r)})}onCancel(){this.dialogRef.close()}onSubmit(){this.dialogRef.close(this.services)}ngOnInit(){this.getSelectedService(),this.getDetails(),this.getNextFourDays();let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];this.daySelected=r[this.date.getDay()]}getSelectedService(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r);let l=r.works.reduce((t,g)=>(t.find(I=>I.categoryId.name===g.categoryId.name)||t.push(g),t),[]);this.services=l},r=>{console.log(r)})}availabilityService(r){this.selectedService=r,this.showAvailabilityForService(r)}getNextFourDays(){let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=new Date;for(let t=0;t<10;t++){let g=new Date(l);g.setDate(l.getDate()+t);let C=this.formatDate(g),I=t===0?this.getFutureTimings():[...this.timing];this.nextFourDays.push({date:C,day:r[g.getDay()],workingStaus:!1,timming:I})}this.nextDaysOfIndex=this.nextFourDays[this.selectedIndex]}getFutureTimings(){let r=this.date.getHours(),l=this.date.getMinutes();return this.timing.filter(t=>{let g=t.time,C=parseInt(g.slice(0,-2)),I=g.includes("AM");return!I&&C<12&&(C+=12),I&&C===12&&(C=0),C>r})}formatDate(r){let l=String(r.getDate()).padStart(2,"0"),t=r.getFullYear(),g=r.toLocaleDateString("default",{month:"long"});return`${l}-${g}-${t}`}selected(r,l){if(!this.selectedService){this.dailogeBoxService.openDialog("select the service from the above");return}console.log(r),this.isChecked=!1,r.workingStaus?this.working=!0:this.working=!1,this.selectedIndex=l,this.dateSelected=r.date.toString().split("-")[0],this.daySelected=r.day,this.monthSelected=r.date.toString().split("-")[1],this.yearSelected=r.date.toString().split("-")[2],this.nextDaysOfIndex=this.nextFourDays[this.selectedIndex],console.log(this.nextDaysOfIndex),console.log(this.monthSelected)}workingChange(){if(!this.monthSelected||!this.dateSelected||!this.yearSelected){this.isChecked=!this.isChecked,this.working=!1,this.dailogeBoxService.openDialog("please select or confirm the date");return}this.nextFourDays[this.selectedIndex].workingStaus=!this.nextFourDays[this.selectedIndex].workingStaus}onToggleChange(r,l){let g=r.target?.checked??!1;console.log(g),this.nextDaysOfIndex.timming.forEach(de=>{de.time===l.time&&(de.isSelected=g)}),this.timeSelected=g?l.time:"",console.log(this.dateSelected);let C=new Date(`${this.monthSelected} ${this.dateSelected} ${this.yearSelected}`);C.setDate(this.dateSelected);let I=C.getDate(),O=C.getMonth()+1,z=I<10?`0${I}`:I,q=O<10?`0${O}`:O,ie=this.yearSelected;this.fullDate=`${ie}-${q}-${z}`,console.log(q)}submitAllData(){console.log(this.checkDuplicate(this.fullDate,this.timeSelected,this.selectedService)),this.checkDuplicate(this.fullDate,this.timeSelected,this.selectedService)?this.dailogeBoxService.openDialog("The same time slot on the selected date for the selected service is already taken."):this.sendingData()}sendingData(){this.timeSelected!=""?this.api=`${this.apiUrl}providers/provider-date`:this.api=`${this.apiUrl}providers/provider-date/delete`;let r=nO(this.fullDate,"yyyy-MM-dd",new Date);if(isNaN(r.getTime())){console.error("Invalid date:",this.fullDate);return}let l=ZP(r,"yyyy-MM-dd");console.log(l);let t={providerId:this.userId,service:this.selectedService,slotTime:{date:this.fullDate,time:this.timeSelected},availability:this.working,jobStartTime:null,jobEndTime:null};console.log(t),console.log(this.api),this.http.post(this.api,t).subscribe(g=>{console.log(g),this.dailogeBoxService.openDialog("Availability added successfully"),this.timing.forEach(C=>C.isSelected=!1),console.log(this.timing),this.getDetails()},g=>{console.log(g),this.dailogeBoxService.openDialog(g.error.message)})}getDetails(){let r=`${this.apiUrl}providers/provider-date/${this.userId}`;this.http.get(r).subscribe(l=>{console.log(l),this.availabilityResponse=l,this.showAvailability(this.availabilityResponse)},l=>{console.log(l)})}deleteData(){}showAvailability(r){console.log(this.services),r.forEach(l=>{let t=l.slotTime.date,g=new Date(t),C=g.getDate(),I=g.toLocaleDateString("default",{month:"long"}),O=`${String(C).padStart(2,"0")}-${I}-${g.getFullYear()}`;this.nextFourDays.forEach(z=>{z.date===O&&(z.workingStaus=l.availability,z.timming.forEach(q=>{q.time===l.slotTime.time&&(q.isSelected=!0)}))})}),console.log(this.nextFourDays)}checkDuplicate(r,l,t){return this.availabilityResponse.some(g=>g.date===r&&g.time===l&&g.service===t)}navToBack(){this.location.back()}showAvailabilityForService(r){console.log("new called"),this.nextFourDays.forEach(l=>{l.workingStaus=!1,l.timming.forEach(t=>{t.isSelected=!1})}),console.log(this.availabilityResponse),this.availabilityResponse.forEach(l=>{if(l.service===r){let t=l.slotTime.date,g=new Date(t),C=g.getDate(),I=g.toLocaleDateString("default",{month:"long"}),O=`${String(C).padStart(2,"0")}-${I}-${g.getFullYear()}`;this.nextFourDays.forEach(z=>{O===z.date&&(z.workingStaus=!0,z.timming.forEach(q=>{q.time===l.slotTime.time&&(q.isSelected=!0)}))})}})}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(AI),fe(hn),fe(Gi),fe(op),fe(Ar),fe(Jn),fe(Wn))},o.\u0275cmp=ft({type:o,selectors:[["app-calender"]],viewQuery:function(l,t){if(l&1&&yi(O8,5),l&2){let g;_i(g=bi())&&(t.dialogTemplate=g.first)}},decls:27,vars:12,consts:[["dialogTemplate",""],[1,"container"],[1,"headers"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"sub-container"],[1,"working-dates"],[1,"selected-date"],[1,"update"],[1,"custom-checkbox"],["type","checkbox",3,"change","ngModelChange","checked","ngModel"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],["class","confirmation-div",4,"ngIf"],[3,"click"],[2,"width","300px"],["class","extended",4,"ngIf"],[2,"display","flex","align-items","center","justify-content","center"],["type","checkbox",3,"change","checked"],[1,"service-tittle"],[1,"extended"],[1,"service"],[1,"datess",3,"click","ngClass"],[1,"material-symbols-outlined","notranslate"],[1,"confirmation-div"],[1,"conformation"],[1,"line"],[1,"time-section"],["class","time-confirm",4,"ngFor","ngForOf"],[1,"time-confirm"],["type","checkbox","color","accent",3,"ngModelChange","change","ngModel"],["mat-dialog-title",""],["mat-dialog-content","",2,"width","300px"],["mat-dialog-actions","",2,"display","flex","justify-content","space-evenly"],["mat-button","",2,"width","30%","height","2rem",3,"click"],[2,"display","flex","align-items","center","width","100%","height","3rem"],[2,"color","black"]],template:function(l,t){if(l&1){let g=Xt();V(0,"div",1)(1,"div",2)(2,"span",3),Oe("click",function(){return gt(g),_t(t.navToBack())}),$(3,"arrow_back"),j(),Nt(4,L8,4,0,"ng-container",4)(5,N8,4,3,"ng-container",5),j(),ke(6,"br")(7,"br"),V(8,"div",6)(9,"div",7),Nt(10,V8,8,6,"ng-container",5),j(),V(11,"div",8)(12,"span"),$(13),j()(),V(14,"div",9)(15,"div")(16,"label",10)(17,"input",11),Oe("change",function(){return gt(g),_t(t.workingChange())}),zr("ngModelChange",function(I){return gt(g),Fr(t.working,I)||(t.working=I),_t(I)}),j()(),V(18,"span"),$(19,"Working"),j()(),V(20,"span",12),$(21),j()(),Nt(22,U8,12,1,"div",13),V(23,"button",14),Oe("click",function(){return gt(g),_t(t.submitAllData())}),$(24,"submit"),j()()(),Nt(25,H8,10,1,"ng-template",15,0,Hm)}l&2&&(ue(4),Fe("ngIf",t.extendServices),ue(),Fe("ngForOf",t.services),ue(5),Fe("ngForOf",t.nextFourDays),ue(3),Tb("",t.daySelected,",",t.monthSelected," ",t.dateSelected,""),ue(3),ki("checked",t.isChecked),ue(),Fe("checked",t.isChecked),Lr("ngModel",t.working),ue(4),Ft(t.working?"expand_circle_right":"expand_circle_down"),ue(),Fe("ngIf",t.working))},dependencies:[Oo,uo,Cr,Lo,cl,hr,Ro,ra,KI,SE,kE,ME],styles:['.container[_ngcontent-%COMP%]{width:90%;height:100vh;padding:1rem}.headers[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.service[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.service-tittle[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1rem;font-weight:500;line-height:16.94px;text-align:left}.extended[_ngcontent-%COMP%]{border:1px solid red}.sub-container[_ngcontent-%COMP%]{width:95%;position:relative;left:2.5%;display:grid;row-gap:3rem}.working-dates[_ngcontent-%COMP%]{width:100%;display:flex;column-gap:2rem;justify-content:space-between;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;flex-direction:row;-ms-overflow-style:none;scrollbar-width:none}.datess[_ngcontent-%COMP%]{width:5rem;height:5rem;display:flex;text-align:center;flex-direction:column;border:1px solid black;border-radius:.5rem;flex:0 0 20%;padding-top:1rem;padding-bottom:1rem}.datess.selected[_ngcontent-%COMP%]{background-color:#72d388;border:none;color:#fff}.selected-date[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;letter-spacing:.07em}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:#72d388;border:0}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}.btn[_ngcontent-%COMP%]{width:100%;align-items:center}button[_ngcontent-%COMP%]{width:100%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}.update[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-around;border:.25px solid black;border-radius:.4rem;align-items:center}.update[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%;display:flex;justify-content:space-around;text-align:center;align-items:center}.update[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px;letter-spacing:.07em;text-align:center;align-items:center}.confirmation-div[_ngcontent-%COMP%]{background:#fcf5fc;border:.25px solid rgba(0,0,0,1);border-radius:.4rem;padding:1rem}.conformation[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.line[_ngcontent-%COMP%]{height:1rem;border-bottom:.2px solid transparent;border-top:.25px dashed black}.time-confirm[_ngcontent-%COMP%]{height:2rem;display:flex;align-items:center;justify-content:center;text-align:center;gap:.5rem}.time-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:45% 45%;column-gap:5%;row-gap:1rem}']});let d=o;return d})();function G8(d,o){if(d&1){let c=Xt();V(0,"div",5),Oe("click",function(){let l=gt(c).$implicit,t=lt();return _t(t.selectedJob(l))}),V(1,"div")(2,"p")(3,"span",6),$(4),j()(),V(5,"p")(6,"span",7),Oe("click",function(){gt(c);let l=lt();return _t(l.navToBack())}),$(7,"account_balance_wallet"),j(),$(8,"\xA0 "),V(9,"span",8),$(10),j()(),V(11,"p")(12,"span",7),Oe("click",function(){gt(c);let l=lt();return _t(l.navToBack())}),$(13,"description"),j(),$(14,"\xA0 "),V(15,"span",8),$(16),j()()(),V(17,"div")(18,"p",6),$(19),j(),V(20,"p",8),$(21),j()()(),ke(22,"br")}if(d&2){let c=o.$implicit;ue(4),Ft(c.orderId==null||c.orderId.items[0]==null?null:c.orderId.items[0].serviceId.name),ue(6),Ii("Job value:",c.orderId==null?null:c.orderId.totalAmount,""),ue(6),Ii("Online Payments:",c.orderId==null?null:c.orderId.totalAmount,""),ue(3),Ft(c.orderId==null||c.orderId.items[0]==null?null:c.orderId.items[0].selectedTime),ue(2),Aa("",c.orderId==null||c.orderId.items[0]==null?null:c.orderId.items[0].selectedDate," - ",c.orderId==null||c.orderId.items[0]==null?null:c.orderId.items[0].selectedMonth,"")}}var oO=(()=>{let o=class o{navToBack(){this.location.back()}constructor(r,l,t,g){this.location=r,this.jobDetailsService=l,this.router=t,this.orderService=g,this.jobs=[{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"},{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"},{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"}]}ngOnInit(){this.getOrderDetails()}getOrderDetails(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r),this.jobs=r.data,this.filterOrder()},error:r=>{console.log(r)}})}filterOrder(){this.filteredJobs=this.jobs.filter(r=>r.status&&r.status.toLowerCase()==="completed"),console.log(this.filteredJobs),this.jobs=this.filteredJobs}selectedJob(r){console.log(r),this.jobDetailsService.selectedJobDetails(r),this.router.navigate(["jobDetails"])}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(Ar),fe(Bt),fe(Pr))},o.\u0275cmp=ft({type:o,selectors:[["app-job-history"]],decls:11,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","24px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"section",3,"click"],[1,"main-text"],[1,"material-symbols-outlined","notranslate",2,"font-size","1rem",3,"click"],[1,"text"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0"),V(5,"span",3),$(6,"Job History"),j()(),V(7,"div",4)(8,"div"),xr(9,G8,23,6,null,null,io),j()()()),l&2&&(ue(9),wr(t.jobs))},styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%}.section[_ngcontent-%COMP%]{width:100%;height:7rem;border:.25px solid black;border-radius:.5rem;display:flex;justify-content:space-between;align-items:center;text-align:center}.section[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:.5rem;display:flexbox;text-align:left}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:19.36px}.main-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:19.36px}.text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:14.52px}']});let d=o;return d})();function q8(d,o){if(d&1){let c=Xt();V(0,"div",16),Oe("click",function(){let l=gt(c).$implicit,t=lt();return _t(t.selected(l))}),$(1),j()}if(d&2){let c=o.$implicit;ue(),Ft(c)}}var aO=(()=>{let o=class o{navToBack(){this.location.back()}constructor(r,l,t){this.location=r,this.http=l,this.razorPayService=t,this.credits=[20,50,100,250],this.selectedValue=0,this.AmountToPay=0,this.payOnline=!1,this.deductNextPayout=!1}entredAmount(){this.AmountToPay=this.selectedValue}selected(r){this.selectedValue=r,this.AmountToPay=this.selectedValue}togglePayOnline(r){this.payOnline=!this.payOnline,this.payOnline&&(this.deductNextPayout=!1,this.makePayment())}toggleDeductNextPayout(){this.deductNextPayout=!this.deductNextPayout,this.deductNextPayout&&(this.payOnline=!1)}makePayment(){let r=this.AmountToPay,l="INR",t="order_id_from_backend";this.razorPayService.createOrder(r).subscribe({next:g=>{console.log("Order created:",g),this.razorPayService.payWithRazorpay(r,g.id,l)},error:g=>{console.error("Error creating order:",g)}})}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(Gi),fe(zo))},o.\u0275cmp=ft({type:o,selectors:[["app-add-credit"]],decls:32,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","32px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"credit-input"],["src","assets/logo/credit12.png"],["type","number","placeholder","Enter number of credits",3,"ngModelChange","input","value","ngModel"],[1,"quickSelect-div"],[1,"maintext"],[1,"selec-div"],["class","maintext",3,"click",4,"ngFor","ngForOf"],[1,"Amount-div"],[1,"selecPayment-div"],[1,"minText"],["type","checkbox",3,"change","checked"],[1,"maintext",3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0 "),V(5,"span",3),$(6,"Add credits"),j()(),V(7,"div",4)(8,"div",5),ke(9,"img",6),V(10,"input",7),zr("ngModelChange",function(C){return Fr(t.selectedValue,C)||(t.selectedValue=C),C}),Oe("input",function(){return t.entredAmount()}),j()(),V(11,"div",8)(12,"span",9),$(13,"Quick select"),j(),V(14,"div",10),Nt(15,q8,2,1,"div",11),j()(),V(16,"div",12)(17,"span",9),$(18,"Amount to pay"),j(),V(19,"p",9),$(20),j()(),V(21,"div",13)(22,"span",9),$(23,"Select payment method"),j(),ke(24,"br")(25,"br"),V(26,"p",14)(27,"input",15),Oe("change",function(C){return t.togglePayOnline(C)}),j(),$(28,"\xA0Pay Online "),j(),V(29,"p",14)(30,"input",15),Oe("change",function(){return t.toggleDeductNextPayout()}),j(),$(31,"\xA0Deduct from next payout "),j()()()()),l&2&&(ue(10),Fe("value",t.selectedValue),Lr("ngModel",t.selectedValue),ue(5),Fe("ngForOf",t.credits),ue(5),Ii("\u20B9\xA0 ",t.AmountToPay,""),ue(7),Fe("checked",t.payOnline),ue(3),Fe("checked",t.deductNextPayout))},dependencies:[uo,mo,Rb,hr,ra],styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.6rem;font-weight:500;line-height:19.36px}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%;display:grid;row-gap:2rem}.maintext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px}.minText[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:19.36px}.credit-input[_ngcontent-%COMP%]{height:3rem;width:100%;border:.25px solid black;border-radius:.4rem;display:flex;align-items:center;justify-content:space-around}.credit-input[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1rem;height:1rem}.credit-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80%;height:2.5rem;outline:0;border-width:0;font-size:1.2rem}.quickSelect-div[_ngcontent-%COMP%]{width:100%;height:max-content;display:grid;row-gap:1.5rem}.selec-div[_ngcontent-%COMP%]{width:100%;height:max-content;display:flex;flex-wrap:wrap;column-gap:3rem;row-gap:1.5rem}.selec-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{border:.25px solid black;width:4.8rem;height:2.5rem;display:flex;border-radius:.5rem;align-items:center;justify-content:center}.Amount-div[_ngcontent-%COMP%]{width:90%;height:4rem;display:flex;align-items:center;text-align:center;padding-left:5%;padding-right:5%;justify-content:space-between;border:.25px solid black;border-radius:.5rem}.minText[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}']});let d=o;return d})();var sO=(()=>{let o=class o{navToBack(){this.location.back()}constructor(r,l){this.location=r,this.userDetails=l,this.bankDetails=[],this.getUserDetails()}getUserDetails(){this.userDetails.getFinancialDetails().subscribe(r=>{console.log(r),this.bankDetails=r},r=>{console.log(r)})}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(Jn))},o.\u0275cmp=ft({type:o,selectors:[["app-financial-details"]],decls:61,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"gst-div"],[1,"largetext"],[1,"panDetails"],[1,"edit"],[1,"bankdetails"],[1,"normaltext"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0 "),V(5,"span",3),$(6,"Financial details"),j()(),V(7,"div",4)(8,"div",5)(9,"span",6),$(10,"GST Details"),j(),V(11,"span",6),$(12,"Add+"),j()(),V(13,"div",7)(14,"p")(15,"span",6),$(16,"Aadhar Card details"),j(),V(17,"span",8),$(18,"Edit"),j()(),V(19,"p")(20,"span",6),$(21,"Aadhar "),j(),V(22,"span",6),$(23),j()()(),V(24,"div",7)(25,"p")(26,"span",6),$(27,"PAN Card details"),j(),V(28,"span",8),$(29,"Edit"),j()(),V(30,"p")(31,"span",6),$(32,"PAN "),j(),V(33,"span",6),$(34),j()()(),V(35,"div",9)(36,"p")(37,"span",6),$(38,"Bank account details"),j(),V(39,"span",8),$(40,"Edit"),j()(),V(41,"p")(42,"span",10),$(43,"Account number"),j(),V(44,"span",6),$(45),j()(),V(46,"p")(47,"span",10),$(48,"Bank name"),j(),V(49,"span",6),$(50),j()(),V(51,"p")(52,"span",10),$(53,"IFSC code"),j(),V(54,"span",6),$(55),j()(),V(56,"p")(57,"span",10),$(58,"Name in account"),j(),V(59,"span",6),$(60),j()()()()()),l&2&&(ue(23),Ft(t.bankDetails.aadhaarNumber),ue(11),Ft(t.bankDetails.pan),ue(11),Ft(t.bankDetails.accountNumber),ue(5),Ft(t.bankDetails.bankName),ue(5),Ft(t.bankDetails.ifscCode),ue(5),Ft(t.bankDetails.accountName))},styles:['.container[_ngcontent-%COMP%]{width:93vw;height:100vh;padding:1rem .5rem 0 1rem}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.5rem;font-weight:500;line-height:19.36px}.sub-container[_ngcontent-%COMP%]{width:97%;position:relative;top:3.5%;display:grid;row-gap:2rem}.gst-div[_ngcontent-%COMP%]{width:90%;height:4rem;border:.25px solid black;display:flex;justify-content:space-between;align-items:center;text-align:center;padding:5%;border-radius:.5rem}.panDetails[_ngcontent-%COMP%]{width:90%;height:5rem;border:.25px solid black;display:flex;flex-direction:column;row-gap:1rem;padding:5%;border-radius:.5rem}p[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;text-align:center}.bankdetails[_ngcontent-%COMP%]{width:90%;height:13rem;border:.25px solid black;display:flex;flex-direction:column;row-gap:1rem;padding:5%;border-radius:.5rem}.largetext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px}.edit[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px;color:#00000080}.normaltext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px}']});let d=o;return d})();var lO=(()=>{let o=class o{navToBack(){this.location.back()}navToHelp(){this.router.navigate(["help"])}constructor(r,l,t){this.jobDetailsService=r,this.location=l,this.router=t,this.jobDetailsService.getSelectedJob(),console.log(this.jobDetailsService.getSelectedJob())}ngOnInit(){this.orderDetails=this.jobDetailsService.getSelectedJob()}};o.\u0275fac=function(l){return new(l||o)(fe(Ar),fe(ii),fe(Bt))},o.\u0275cmp=ft({type:o,selectors:[["app-job-details"]],decls:65,vars:12,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","24px",3,"click"],[1,"help",3,"click"],[1,"sub-container"],[1,"name"],[1,"tittle"],[1,"customer-details"],[1,"sub-tittle"],[1,"Details"],[1,"para-section"],[1,"highlight-text"],[1,"line"],[1,"time-div"],[1,"summary"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),V(4,"div",3),Oe("click",function(){return t.navToHelp()}),$(5,"Help?"),j()(),V(6,"div",4)(7,"div",5)(8,"span",6),$(9),j(),V(10,"span"),$(11),j()(),V(12,"div",7)(13,"span",8),$(14,"Customers Details"),j(),V(15,"div",9)(16,"p",10)(17,"span",11),$(18,"Location"),j(),V(19,"span"),$(20),j()(),ke(21,"div",12)(22,"br"),V(23,"div",13)(24,"p",10)(25,"span",11),$(26,"Job start"),j(),V(27,"span"),$(28),j()(),V(29,"p",10)(30,"span",11),$(31,"Job End"),j(),V(32,"span"),$(33,"12 Apr 07:30 PM"),j()()()()(),V(34,"div",14)(35,"span",8),$(36,"Summary"),j(),V(37,"div",9)(38,"div",13)(39,"span",11),$(40),j(),V(41,"span",8),$(42),j()(),ke(43,"div",12)(44,"br"),V(45,"div",13)(46,"p")(47,"span"),$(48,"Others"),j(),ke(49,"br"),V(50,"span",11),$(51,"Convenience Fee"),j()(),V(52,"p",8),$(53,"69"),j()(),ke(54,"div",12)(55,"br"),V(56,"div",13)(57,"p")(58,"span",11),$(59,"Total value"),j(),ke(60,"br"),V(61,"span"),$(62,"commission 5 credits"),j()(),V(63,"p",8),$(64),j()()()()()()),l&2&&(ue(9),Ft(t.orderDetails.orderId.addressId.username),ue(2),Ft(t.orderDetails.orderId.items[0].scheduledDate),ue(9),LI(" ",t.orderDetails.orderId.addressId.address,",",t.orderDetails.orderId.addressId.landmark,", ",t.orderDetails.orderId.addressId.city,", ",t.orderDetails.orderId.addressId.state,", ",t.orderDetails.orderId.addressId.pincode," "),ue(8),Ii(" ",t.orderDetails.workStartTime," "),ue(12),Aa("",t.orderDetails.orderId.items[0].quantity," \xA0 X \xA0 ",t.orderDetails.orderId.categoryIds[0].name,""),ue(2),Ii("\u20B9 \xA0",t.orderDetails.orderId.totalAmount,""),ue(22),Ft(t.orderDetails.orderId.totalAmount))},styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;justify-content:space-between;align-items:center}.help[_ngcontent-%COMP%]{width:4rem;height:2.5rem;border:none;background:#20193f;border-radius:1.3rem;color:#fff;display:flex;justify-content:center;align-items:center}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:19.36px;margin-bottom:1rem}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%;display:grid;row-gap:1.5rem}.name[_ngcontent-%COMP%]{position:relative;left:5%;display:flex;flex-direction:column}.sub-tittle[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;padding:0 0 1rem 1rem;margin-bottom:.5rem}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:600;line-height:16.94px;margin-bottom:.5rem}.customer-details[_ngcontent-%COMP%]{padding-top:1rem;display:grid;row-gap:1rem}.time-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.Details[_ngcontent-%COMP%]{width:90%;padding:1rem;border:.25px solid black;border-radius:.5rem}.summary[_ngcontent-%COMP%]{padding-top:1rem;display:grid;row-gap:1rem}.line[_ngcontent-%COMP%]{border:0;border-bottom:1px dashed rgb(45,44,44)}.para-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}']});let d=o;return d})();function $8(d,o){if(d&1&&(V(0,"div")(1,"label",6),ke(2,"input",7),j(),$(3," \xA0 "),V(4,"span",3),$(5),j()(),ke(6,"br")),d&2){let c=o.$implicit;ue(),ki("checked",c.checked),ue(),Fe("checked",c.checked),ue(3),Ft(c.name)}}var cO=(()=>{let o=class o{navToBack(){this.location.back()}constructor(r){this.location=r,this.items=[{name:"Contact Details",checked:!0},{name:"Aadhar card",checked:!0},{name:"Bank Details",checked:!0},{name:"Professional documents",checked:!1}]}toggleCheckbox(){}};o.\u0275fac=function(l){return new(l||o)(fe(ii))},o.\u0275cmp=ft({type:o,selectors:[["app-identity-verification"]],decls:13,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"para"],[1,"verify-div"],[1,"custom-checkbox"],["type","checkbox","disabled","",3,"checked"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0 "),V(5,"span",3),$(6,"Identity Verification"),j()(),V(7,"div",4)(8,"p"),$(9,"We were to successfully verify your details . As a part of our quality process we will request you to re-verify the information every 5months "),j()(),V(10,"div",5),xr(11,$8,7,4,null,null,io),j()()),l&2&&(ue(11),wr(t.items))},styles:['.container[_ngcontent-%COMP%]{width:92vw;padding:1rem;display:grid;row-gap:2rem}.para[_ngcontent-%COMP%]{background-color:#ef8c534d;width:90%;padding:1rem;border-radius:.5rem;color:#ffa800}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:green}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}input[type=checkbox][disabled][_ngcontent-%COMP%]{cursor:not-allowed;background-color:#f0f0f0}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.5rem;font-weight:500;line-height:19.36px}']});let d=o;return d})();var Y8=["footer"],Z8=d=>({active:d});function X8(d,o){if(d&1){let c=Xt();V(0,"button",13),Oe("click",function(){let l=gt(c).$implicit,t=lt();return _t(t.setActiveButton(l))}),$(1),j()}if(d&2){let c=o.$implicit,r=lt();Fe("ngClass",di(2,Z8,r.activeButton===c)),ue(),Ii(" ",c," ")}}function Q8(d,o){if(d&1){let c=Xt();V(0,"span",20)(1,"a",21)(2,"span",6),$(3," call "),j()(),V(4,"span",22),Oe("click",function(){gt(c);let l=lt().$implicit,t=lt();return _t(t.navToChat(l.userId))}),$(5," chat "),j(),V(6,"span",22),Oe("click",function(){gt(c);let l=lt().$implicit,t=lt();return _t(t.navToArrived(l))}),$(7," directions "),j()()}}function K8(d,o){if(d&1&&(V(0,"div",14)(1,"span",15)(2,"span",16),$(3),j(),Nt(4,Q8,8,0,"span",17),j(),V(5,"span",16),$(6),j(),V(7,"span",18),$(8),j(),V(9,"span",19)(10,"span",18),$(11),j(),V(12,"span",16),$(13),j()(),V(14,"span",18),$(15),j()()),d&2){let c=o.$implicit;ue(3),Ft(c.orderId==null||c.orderId.addressId==null?null:c.orderId.addressId.username),ue(),Fe("ngIf",c.status==="Accepted"||c.status==="InProgress"),ue(2),Ft(c.orderId==null||c.orderId.categoryIds[0]==null?null:c.orderId.categoryIds[0].name),ue(2),Ft(c.orderId==null||c.orderId.subCategoryIds[0]==null?null:c.orderId.subCategoryIds[0].name),ue(3),Ft(c.orderId==null||c.orderId.items[0]==null?null:c.orderId.items[0].scheduledDate),ue(2),Ii(" \u20B9 ",c.orderId.totalAmount,""),ue(2),RI("",c.orderId.addressId==null?null:c.orderId.addressId.address," ",c.orderId.addressId.city," ",c.orderId.addressId.state," ",c.orderId.addressId.pincode,"")}}var dO=(()=>{let o=class o{constructor(r,l,t,g){this.location=r,this.router=l,this.razorpayService=t,this.orderService=g,this.buttons=["Ongoing","Pending","Accepted","Completed","Cancelled"],this.activeButton="Ongoing",this.text=this.activeButton,this.filterStatus="InProgress",this.order=[],this.filteredOrder=[],this.getCredits(),this.getOrderDetails()}getCredits(){this.razorpayService.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits},error:r=>{console.log(r)}})}navBack(){this.location.back()}getOrderDetails(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r),this.order=r.data,this.filterOrder()},error:r=>{console.log(r)}})}setActiveButton(r){this.activeButton=r,this.text=r,this.assignOrder()}assignOrder(){switch(this.activeButton){case"Ongoing":this.filterStatus="InProgress";break;case"Pending":this.filterStatus="Workstart";break;case"Accepted":this.filterStatus="Accepted";break;case"Completed":this.filterStatus="Completed";break;case"Cancelled":this.filterStatus="Cancelled";break}this.filterOrder()}filterOrder(){console.log(this.order),this.filteredOrder=this.order.filter(r=>r.status&&r.status.toLowerCase()===this.filterStatus.toLowerCase()),console.log(this.filteredOrder)}navTo(r){switch(r){case"credit":this.router.navigate(["credits"]);break;case"notification":this.router.navigate(["notification"]);break;case"menu":this.router.navigate(["menu"]);break}}navToArrived(r){this.activeButton==="Ongoing"?this.router.navigate(["completeWork",r._id]):this.activeButton==="Pending"&&this.router.navigate(["arrived",r._id])}navToChat(r){let l={role:"user",id:r};this.router.navigate(["help/chatbot"],{queryParams:l})}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(Bt),fe(zo),fe(Pr))},o.\u0275cmp=ft({type:o,selectors:[["app-ongoing"]],viewQuery:function(l,t){if(l&1&&yi(Y8,5),l&2){let g;_i(g=bi())&&(t.footer=g.first)}},decls:20,vars:3,consts:[[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined","notranslate"],[1,"sub-container"],[1,"cat"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"content-container"],["class","content",4,"ngFor","ngForOf"],[2,"height","5rem"],[3,"click","ngClass"],[1,"content"],[1,"icons-div"],[1,"highlight-text"],["class","iconsss",4,"ngIf"],[1,"normal-text"],[1,"service-div"],[1,"iconsss"],["href","'tel:'+ item.orderId.address.mobileNumber"],[1,"material-symbols-outlined","notranslate",3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1),Oe("click",function(){return t.navTo("menu")}),$(2,"\u2630"),j(),V(3,"div",2)(4,"div",3),Oe("click",function(){return t.navTo("credit")}),ke(5,"img",4),V(6,"pre"),$(7),j()(),V(8,"div",5),Oe("click",function(){return t.navTo("notification")}),V(9,"span",6),$(10,"notifications"),j()()(),V(11,"div",7)(12,"div",8),Nt(13,X8,2,4,"button",9),j(),V(14,"div",10),ke(15,"br"),Nt(16,K8,16,10,"div",11),j(),ke(17,"br"),j()(),ke(18,"div",12)(19,"app-fotter")),l&2&&(ue(7),Ft(t.credits),ue(6),Fe("ngForOf",t.buttons),ue(3),Fe("ngForOf",t.filteredOrder))},dependencies:[Oo,uo,Cr,ul],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#d16611;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:8rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:5rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border-radius:.4rem;border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh}.cat[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-evenly;flex-wrap:wrap}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px;border-bottom:2px solid transparent;cursor:pointer}.cat[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-bottom:1px solid #D70D09}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:border-bottom .3s}.content-container[_ngcontent-%COMP%]{width:100%;height:92%;overflow-y:auto;scroll-snap-type:y;scrollbar-width:none;display:flex;flex-direction:column;gap:2rem}.content[_ngcontent-%COMP%]{width:85%;height:max-content;display:flex;flex-direction:column;gap:.8rem 5% 0 5%;padding:.8rem 1.2rem;border:.25px solid rgb(127,126,126);border-radius:.5rem}.icons-div[_ngcontent-%COMP%]{width:100%;display:flex;gap:1rem;justify-content:space-between}.iconsss[_ngcontent-%COMP%]{display:flex;gap:1rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:21.94px;text-align:left;color:#000}.normal-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:300;line-height:19.73px;text-align:left;color:#000}']});let d=o;return d})();var J8=["videoPlayer"],eU=["activeVideo"];function tU(d,o){if(d&1){let c=Xt();V(0,"div",10),Oe("click",function(){let l=gt(c).index,t=lt();return _t(t.getVideoUrl(l))}),V(1,"div",11),Oe("click",function(){let l=gt(c).index,t=lt();return _t(t.getVideoUrl(l))}),ke(2,"img",12),j(),ke(3,"br"),j()}}function iU(d,o){if(d&1){let c=Xt();V(0,"div",13),Oe("click",function(){gt(c);let l=lt();return _t(l.stopVideo())}),V(1,"video",14,0),Oe("ended",function(){gt(c);let l=lt();return _t(l.onVideoEnded())})("timeupdate",function(){gt(c);let l=Da(2),t=lt();return _t(t.preventSeek(l))})("loadedmetadata",function(){gt(c);let l=Da(2),t=lt();return _t(t.onVideoLoaded(l))}),j()()}if(d&2){let c=lt();ue(),Fe("src",c.getVideoUrl(c.currentVideoIndex),Un)}}function nU(d,o){if(d&1){let c=Xt();V(0,"div")(1,"button",15),Oe("click",function(){gt(c);let l=lt();return _t(l.navigateWaiting())}),$(2,"Go to Home"),j()()}}var hO=(()=>{let o=class o{navBack(){}constructor(r,l,t,g){this.http=r,this.tranningService=l,this.router=t,this.userService=g,this.videos=[],this.pupUp=!1,this.bucketName="coolie1-dev",this.region="ap-south-1",this.currentVideoIndex=0,this.lastTime=0,this.isVideoPlaying=!1,this.showNavigationButton=!1}ngOnInit(){this.gettingVideos(),this.getWork()}gettingVideos(){this.tranningService.gettingInductionVeideos().subscribe(r=>{console.log(r),this.videos=r},r=>{console.log(r)})}getWork(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r);let l=r.works.map(t=>t.categoryId._id);this.getVideosForIds(["6701477d6cdbd8a62eb1bafa"])},r=>{console.log(r)})}getVideosForIds(r){console.log(r),this.tranningService.getInductionVideosByIds(r).subscribe(l=>{console.log(l.flat())},l=>{console.log(l)})}playVideo(r){this.pupUp=!0,this.currentVideoIndex=r,this.isVideoPlaying=!0,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())}stopVideo(){this.isVideoPlaying=!1,this.activeVideo&&this.activeVideo.nativeElement&&this.activeVideo.nativeElement.pause()}skipVideo(){this.playNextVideo()}onVideoEnded(){this.pupUp=!1,this.playNextVideo()}onVideoLoaded(r){r.play()}preventSeek(r){r.currentTime>this.lastTime+1?r.currentTime=this.lastTime:this.lastTime=r.currentTime}playNextVideo(){this.currentVideoIndex<this.videos.length-1?(this.currentVideoIndex++,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())):(this.isVideoPlaying=!1,alert("Congrats you have completed the traning"),this.navigateWaiting(),this.showNavigationButton=!0)}getVideoUrl(r){return this.pupUp=!0,`https://${this.bucketName}.s3.${this.region}.amazonaws.com/${this.videos[r].videoKey}`}navigateWaiting(){this.router.navigate(["waiting"])}};o.\u0275fac=function(l){return new(l||o)(fe(Gi),fe(sp),fe(Bt),fe(Jn))},o.\u0275cmp=ft({type:o,selectors:[["app-induction"]],viewQuery:function(l,t){if(l&1&&(yi(J8,5),yi(eU,5)),l&2){let g;_i(g=bi())&&(t.videoPlayer=g.first),_i(g=bi())&&(t.activeVideo=g.first)}},decls:15,vars:5,consts:[["activeVideo",""],[1,"tittle-div"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-tittle-div"],[1,"container"],[1,"sub-container"],["class","videoss",3,"click",4,"ngFor","ngForOf"],["class","overlay",3,"click",4,"ngIf"],[4,"ngIf"],[1,"videoss",3,"click"],[1,"dummy-video",3,"click"],["src","assets/demo/video.png"],[1,"overlay",3,"click"],["controls","","autoplay","","type","video/mp4",1,"active-video",3,"ended","timeupdate","loadedmetadata","src"],[3,"click"]],template:function(l,t){l&1&&(V(0,"div",1)(1,"span",2),Oe("click",function(){return t.navBack()}),$(2,"arrow_back"),j(),V(3,"span",3),$(4,"Induction videos"),j()(),V(5,"div",4)(6,"span"),$(7," Complete the Training session!! "),j(),V(8,"span"),$(9," You will be moved to next process "),j()(),V(10,"div",5)(11,"div",6),Nt(12,tU,4,0,"div",7),j()(),Nt(13,iU,3,1,"div",8)(14,nU,3,0,"div",9)),l&2&&(ue(10),ki("blur",t.isVideoPlaying),ue(2),Fe("ngForOf",t.videos),ue(),Fe("ngIf",t.pupUp),ue(),Fe("ngIf",t.showNavigationButton))},dependencies:[uo,Cr],styles:['.tittle-div[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin:1rem 0 2rem 1rem}.tittle[_ngcontent-%COMP%]{font-size:1.3rem;font-family:"inter" sans-serif;font-weight:500}.sub-tittle-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem;justify-content:center;text-align:center;margin-bottom:1rem}.sub-tittle-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-size:1.1rem;font-family:"inter" sans-serif;font-weight:500;color:red}.sub-tittle-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.1rem;font-family:"inter" sans-serif;font-weight:400;color:#0009}#video[_ngcontent-%COMP%]{width:100%}video[_ngcontent-%COMP%]{width:90%;height:360px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin-top:10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:space-around;align-items:center;text-align:center}.blur[_ngcontent-%COMP%]{filter:blur(5px)}video[_ngcontent-%COMP%]{width:300px;height:200px;margin:10px;cursor:pointer}.videoss[_ngcontent-%COMP%]{width:90%;display:grid;row-gap:2rem}.dummy-video[_ngcontent-%COMP%]{width:100%}.dummy-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:fixed;top:0%;width:100%;height:100%;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}.overlay[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.active-video[_ngcontent-%COMP%]{width:640px;height:360px}button[_ngcontent-%COMP%]{margin-top:10px;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{cursor:pointer}']});let d=o;return d})();var uO=(()=>{let o=class o{constructor(r,l){this.logInService=r,this.router=l}navTo(){console.log(localStorage.getItem("providerId")),localStorage.getItem("providerId")?this.router.navigate(["home"]):this.router.navigate(["selectAccount"])}};o.\u0275fac=function(l){return new(l||o)(fe(Kn),fe(Bt))},o.\u0275cmp=ft({type:o,selectors:[["app-start"]],decls:17,vars:0,consts:[["id","main"],[1,"container"],[1,"logo"],["src","assets/logo/logo png1.png","alt","Coolie No. 1"],[1,"check"],[1,"content"],["src","assets/location/login-home-services-image.png","alt","Worker",1,"worker-image"],[1,"text"],[1,"cta-button",3,"click"],["src","assets/new/arrow.png"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2),ke(3,"img",3),j()(),V(4,"div",4)(5,"div",5),ke(6,"img",6),V(7,"div",7)(8,"span"),$(9,"Home "),V(10,"span"),$(11,"SERVICES"),j()(),V(12,"span"),$(13,"at your Door Step"),j(),V(14,"button",8),Oe("click",function(){return t.navTo()}),$(15,"Let's Go \xA0 "),ke(16,"img",9),j()()()()())},styles:["#main[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100vh;background:radial-gradient(circle at bottom right,#cd2e28 60%,#fff 40%)}.container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;flex:0 0 40%}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80%;max-width:300px;margin-bottom:20px}.content[_ngcontent-%COMP%]{width:100%;position:relative;display:flex;flex-direction:column;align-items:center}.worker-image[_ngcontent-%COMP%]{width:50%;height:50%}.check[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;flex:0 0 60%}.text[_ngcontent-%COMP%]{margin-top:5%;text-align:center;display:flex;flex-direction:column}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Roboto;font-size:1.5rem;color:#fff}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-weight:300;line-height:1.6rem}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1)   span[_ngcontent-%COMP%]{font-weight:500}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.1rem;font-weight:300;line-height:1.4rem}.cta-button[_ngcontent-%COMP%]{background-color:transparent;color:#ffffffde;border:none;padding:22px 30px;font-size:1.5rem;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;border-radius:5px}.cta-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:38px;height:28px}"]});let d=o;return d})();function rU(d,o){d&1&&(V(0,"span"),$(1,"\u2192"),j())}function oU(d,o){d&1&&(V(0,"span"),$(1,"\u2714"),j())}function aU(d,o){d&1&&(V(0,"span"),$(1,"\u2192"),j())}function sU(d,o){d&1&&(V(0,"span"),$(1,"\u2714"),j())}var mO=(()=>{let o=class o{constructor(r,l,t){this.loginService=r,this.router=l,this.jobDetailsService=t,this.isExistingActive=!1,this.isNewActive=!1,this.startX=0,this.currentX=0,this.sliderPosition=5,this.isDragging=!1;let g=localStorage.getItem("providerId");this.jobDetailsService.getUserDetails(g)}onTouchStart(r,l){this.startX=r.touches[0].clientX,this.isDragging=!0}onTouchMove(r,l){this.isDragging&&(this.currentX=r.touches[0].clientX-this.startX,this.updateSliderPosition(this.currentX,l))}onTouchEnd(r){this.isDragging=!1,this.checkFinalPosition(r)}onMouseDown(r,l){this.startX=r.clientX,this.isDragging=!0}onMouseMove(r,l){this.isDragging&&(this.currentX=r.clientX-this.startX,this.updateSliderPosition(this.currentX,l))}onMouseUp(r){this.isDragging=!1,this.checkFinalPosition(r)}updateSliderPosition(r,l){if(l==="existing"){let C=Math.min(Math.max(5,5+r),240);this.sliderPosition=C}else if(l==="new"){let C=Math.min(Math.max(5,5+r),240);this.sliderPosition=C}}checkFinalPosition(r){r==="existing"?this.sliderPosition>150&&!this.isExistingActive?(this.isExistingActive=!0,this.sliderPosition=240,this.onToggleChange("existing")):(this.sliderPosition=5,this.isExistingActive=!1):r==="new"&&(this.sliderPosition>150&&!this.isNewActive?(this.isNewActive=!0,this.sliderPosition=240,this.onToggleChange("new")):(this.sliderPosition=5,this.isNewActive=!1))}onToggleChange(r){r==="existing"?(this.loginService.setLogInApi(),this.navigateBasedOnAccount()):r==="new"&&(this.loginService.setSignUpApi(),setTimeout(()=>{this.router.navigate(["log-in"])},1e3))}navigateBasedOnAccount(){localStorage.getItem("providerId")?this.jobDetailsService.userDetails?setTimeout(()=>{this.router.navigate(["home"])},1e3):setTimeout(()=>{this.router.navigate(["aboutUser"])},1e3):setTimeout(()=>{this.router.navigate(["log-in"])},1e3)}};o.\u0275fac=function(l){return new(l||o)(fe(Kn),fe(Bt),fe(Ar))},o.\u0275cmp=ft({type:o,selectors:[["app-select-account"]],decls:23,vars:8,consts:[[1,"container"],[1,"sub-container"],[1,"sp-div"],[1,"img-div"],["src","assets/logo/start2.png","alt","Logo"],[1,"slide-container",3,"touchstart","touchmove","touchend","mousedown","mousemove","mouseup"],[1,"placehlder"],[1,"slider"],[4,"ngIf"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),$(4,"Hey!"),j(),V(5,"span"),$(6,"Join now"),j()(),V(7,"div",3),ke(8,"img",4),j(),V(9,"div",5),Oe("touchstart",function(C){return t.onTouchStart(C,"existing")})("touchmove",function(C){return t.onTouchMove(C,"existing")})("touchend",function(){return t.onTouchEnd("existing")})("mousedown",function(C){return t.onMouseDown(C,"existing")})("mousemove",function(C){return t.onMouseMove(C,"existing")})("mouseup",function(){return t.onMouseUp("existing")}),V(10,"div",6)(11,"span"),$(12,"Existing Provider"),j()(),V(13,"div",7),Nt(14,rU,2,0,"span",8)(15,oU,2,0,"span",8),j()(),V(16,"div",5),Oe("touchstart",function(C){return t.onTouchStart(C,"new")})("touchmove",function(C){return t.onTouchMove(C,"new")})("touchend",function(){return t.onTouchEnd("new")})("mousedown",function(C){return t.onMouseDown(C,"new")})("mousemove",function(C){return t.onMouseMove(C,"new")})("mouseup",function(){return t.onMouseUp("new")}),V(17,"div",6)(18,"span"),$(19,"New Provider"),j()(),V(20,"div",7),Nt(21,aU,2,0,"span",8)(22,sU,2,0,"span",8),j()()()()),l&2&&(ue(13),ki("active",t.isExistingActive),ue(),Fe("ngIf",!t.isExistingActive),ue(),Fe("ngIf",t.isExistingActive),ue(5),ki("active",t.isNewActive),ue(),Fe("ngIf",!t.isNewActive),ue(),Fe("ngIf",t.isNewActive))},dependencies:[Cr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;align-items:center;justify-content:center;background-color:#f5f5f5}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:400px;display:flex;flex-direction:column;align-items:center;row-gap:1rem}.sp-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:left}span[_ngcontent-%COMP%]{float:left;font-family:Poppins,sans-serif;font-size:24px;font-weight:600;line-height:36px;text-align:left}.img-div[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.img-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.slide-container[_ngcontent-%COMP%]{width:100%;height:50px;background-color:#d16611;border-radius:25px;position:relative;display:flex;align-items:center}.slider[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#000;font-size:14px;font-weight:200;position:absolute;left:calc(var(--sliderPosition, 5px));transition:left .3s}.slider.active[_ngcontent-%COMP%]{left:80%}.placehlder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:50px;font-family:"Poppins" sans-serif;font-size:16px;font-weight:400;color:#fff}']});let d=o;return d})();var pO=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275cmp=ft({type:o,selectors:[["app-congrats"]],decls:14,vars:0,consts:[[1,"main"],[1,"container"],["src","assets/new/congrats.png"],[1,"text"],[1,"arrow-container"],["src","assets/new/round arrow.png"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"div"),ke(3,"img",2),j(),ke(4,"br"),V(5,"div",3)(6,"p"),$(7,"congratulations"),j(),V(8,"p"),$(9,"You have completed induction videos"),j(),V(10,"p"),$(11,"you are now. Partner of Coolieno1! You are successfully on boarded."),j()()(),V(12,"div",4),ke(13,"img",5),j()())},styles:['.main[_ngcontent-%COMP%]{width:100%;height:100vh}.container[_ngcontent-%COMP%]{width:100%;display:grid;row-gap:1rem;align-items:center;justify-content:center;text-align:center;position:relative;top:15%}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;height:max-content}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){width:100%;display:flex;align-items:center;justify-content:center}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:130px;height:130px}.arrow-container[_ngcontent-%COMP%]{position:fixed;bottom:10%;left:40%;display:flex;align-items:center;justify-content:center}.text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(1){font-family:"Archivo" sans-serif Black;font-size:1.2rem;font-weight:600;line-height:17.41px;letter-spacing:.04em}.text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(2){font-family:"inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;letter-spacing:.04em}']});let d=o;return d})();var lU=d=>({"first-package":d,package:!0});function cU(d,o){d&1&&(V(0,"span"),$(1," Activated Package "),j())}function dU(d,o){if(d&1){let c=Xt();V(0,"p",7)(1,"span"),$(2,"UPGRADE TO"),j(),V(3,"button",14),Oe("click",function(){gt(c);let l=lt().$implicit,t=lt();return _t(t.buy(l))}),$(4,"Buy Now"),j()()}if(d&2){let c=lt().$implicit,r=lt();ue(3),Fe("disabled",r.isPackageActivated(c))}}function hU(d,o){d&1&&(V(0,"span"),$(1,"Amount Payable"),j())}function uU(d,o){if(d&1&&(V(0,"div",6),ke(1,"br"),V(2,"div")(3,"p",7),Nt(4,cU,2,0,"span",8)(5,dU,5,1,"ng-template",null,0,Hm),j(),V(7,"p",9),ke(8,"img",10),$(9," \xA0"),V(10,"span"),$(11),j()(),V(12,"p",7)(13,"span")(14,"span",11),$(15,"Current"),j(),$(16," \xA0 "),V(17,"span",12),$(18,"lock_open"),j()(),V(19,"span"),$(20),j()(),V(21,"ul")(22,"li"),$(23),j(),V(24,"li"),$(25),j()(),V(26,"p",7),Nt(27,hU,2,0,"span",13),V(28,"span"),$(29),j()()()()),d&2){let c=o.$implicit,r=Da(6),l=lt();Fe("ngClass",di(11,lU,c.packageName==="silver")),ue(4),Fe("ngIf",l.isPackageActivated(c))("ngIfElse",r),ue(4),Fe("src",c.image,Un),ue(3),Ft(c.packageName),ue(9),Aa(" ",l.isPackageActivated(c)?"Expiry":"Validity"," : ",l.isPackageActivated(c)?l.getExpiryDate(c.packageName):c.validity," "),ue(3),Ii("",c.noOfJobOffers," jobs"),ue(2),Ii("",c.discountPlatformCom," % discount on platform commission"),ue(2),Fe("ngIf",!l.isEnrolled),ue(2),Ii("\u20B9 ",c.priceRs,"")}}var fO=(()=>{let o=class o{constructor(r,l,t,g){this.userDetails=r,this.location=l,this.razorPayService=t,this.dailougeBoxService=g,this.isEnrolled=!0,this.packages=[],this.purchasedPackages=[],this.getPackage(),this.getPurchasedPackages()}navToBack(){this.location.back()}getPackage(){this.userDetails.getPackages().subscribe(r=>{console.log(r),this.packages=r},r=>{console.log(r)})}getPurchasedPackages(){let r=localStorage.getItem("providerId");this.userDetails.getPurchasedPackages(r).subscribe(l=>{console.log("Purchased packages:",l),this.purchasedPackages=l,this.getExpiryDate(l.packageName)},l=>{console.error("Error fetching purchased packages:",l)})}getExpiryDate(r){let l=this.purchasedPackages.find(t=>t.packageName===r);return l?l.expiryDate.split("T")[0]:"N/A"}isPackageActivated(r){return this.purchasedPackages.some(l=>l.packageName===r.packageName)}buy(r){if(this.isAnyPackageActivated()){this.dailougeBoxService.openDialog("You already have an active package. Please wait until it expires.");return}if(!this.validatePackageData(r)){this.dailougeBoxService.openDialog("Package data is not valid. Please check the package details.");return}let l=r.priceRs,t="INR";this.razorPayService.createOrder(l).subscribe({next:g=>{console.log("Order created:",g),this.payWithRazorpay(l,g.id,t,r)},error:g=>{console.error("Error creating order:",g),this.dailougeBoxService.openDialog(g.error.message)}})}isAnyPackageActivated(){return this.purchasedPackages.length>0&&this.purchasedPackages.some(r=>new Date(r.expiryDate)>new Date)}validatePackageData(r){return r&&r.packageName&&r.priceRs&&r.discountPlatformCom!==void 0&&r.comments&&r.validity&&r.image}payWithRazorpay(r,l,t,g){let C={key:"rzp_test_b8XfUOQ4u8dlSq",amount:r*100,currency:t,name:"Coolie no.1",description:"Test Transaction",image:"assets/location/logo-v3 3.png",handler:O=>{console.log(O),this.addPackages(O.razorpay_payment_id,g)},prefill:{name:"Customer Name",email:"customer@example.com",contact:"9999999999"},theme:{color:"#3399cc"},modal:{ondismiss:function(){console.log("Checkout form closed")}}};new Razorpay(C).open()}addPackages(r,l){let g={providerId:localStorage.getItem("providerId"),packageName:l.packageName,priceRs:l.priceRs,discountPlatformCom:l.discountPlatformCom,validity:l.validity,paymentId:r,image:l.image};console.log("Request Body:",g),this.userDetails.buyingPackages(g).subscribe({next:C=>{console.log("Package added successfully:",C),this.getPurchasedPackages()},error:C=>{console.error("Error adding package:",C),this.dailougeBoxService.openDialog(C.error.message)}})}};o.\u0275fac=function(l){return new(l||o)(fe(Jn),fe(ii),fe(zo),fe(Wn))},o.\u0275cmp=ft({type:o,selectors:[["app-packages"]],decls:6,vars:1,consts:[["buyButton",""],[1,"container"],[1,"sub-container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"upgrade"],[4,"ngIf","ngIfElse"],[1,"package-name"],[3,"src"],[1,"Current"],[1,"material-symbols-outlined","notranslate",2,"font-size","1rem"],[4,"ngIf"],[3,"click","disabled"]],template:function(l,t){l&1&&(V(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),Oe("click",function(){return t.navToBack()}),$(4,"arrow_back"),j()(),Nt(5,uU,30,13,"div",5),j()()),l&2&&(ue(5),Fe("ngForOf",t.packages))},dependencies:[Oo,uo,Cr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:670px;position:relative;top:2%;left:5%;display:flex;flex-direction:column;gap:2rem}.arrow[_ngcontent-%COMP%]{width:100%;display:flex;text-align:center}.tittle[_ngcontent-%COMP%]{width:80%;font-family:"Inter" sans-serif;font-size:22px;font-weight:500;line-height:26.63px;text-align:center}.package[_ngcontent-%COMP%]{border-radius:.6rem;background-color:#414141}.first-package[_ngcontent-%COMP%]{background:#605c5c}.package[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;width:90%;left:5%;top:5%;display:flex;flex-direction:column;gap:.5rem}.upgrade[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.upgrade[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px;text-align:left;color:#fff}.package-name[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center}.package-name[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem}.package-name[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], li[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px;text-align:left;color:#fff}.upgrade[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff}.Current[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:18px;font-weight:500;line-height:21.78px;text-align:left;color:#fff}.material-symbols-outlined[_ngcontent-%COMP%]{font-variation-settings:"FILL" 0,"wght" 400,"GRAD" 0,"opsz" 20}button[_ngcontent-%COMP%]{background-color:transparent;border:1px solid rgba(212,175,55,1);color:#d4af37;border-radius:.2rem}ul[_ngcontent-%COMP%]{float:left}']});let d=o;return d})();var mU=["videoPlayer"],pU=["activeVideo"];function fU(d,o){if(d&1){let c=Xt();V(0,"div",6),Oe("click",function(){let l=gt(c).index,t=lt();return _t(t.getVideoUrl(l))}),V(1,"div",7),Oe("click",function(){let l=gt(c).index,t=lt();return _t(t.getVideoUrl(l))}),ke(2,"img",8),j(),ke(3,"br"),j()}}function gU(d,o){if(d&1){let c=Xt();V(0,"div",9),Oe("click",function(){gt(c);let l=lt();return _t(l.stopVideo())}),V(1,"video",10,0),Oe("ended",function(){gt(c);let l=lt();return _t(l.onVideoEnded())})("timeupdate",function(){gt(c);let l=Da(2),t=lt();return _t(t.preventSeek(l))})("loadedmetadata",function(){gt(c);let l=Da(2),t=lt();return _t(t.onVideoLoaded(l))}),j()()}if(d&2){let c=lt();ue(),Fe("src",c.getVideoUrl(c.currentVideoIndex),Un)}}var gO=(()=>{let o=class o{navBack(){this.location.back()}constructor(r,l,t,g){this.http=r,this.tranningService=l,this.userService=t,this.location=g,this.videos=[],this.pupUp=!1,this.bucketName="coolie1-dev",this.region="ap-south-1",this.currentVideoIndex=0,this.lastTime=0,this.isVideoPlaying=!1}ngOnInit(){this.getWork()}getWork(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r);let l=r.works.map(t=>t.serviceId._id);this.getVideosForIds(["670ebee772f9da361fe4cdc4","670ebed072f9da361fe4cd1c"])},r=>{console.log(r)})}getVideosForIds(r){console.log(r),this.tranningService.getVideosByIds(r).subscribe(l=>{console.log(l.flat()),this.videos=l.filter(t=>t!==null)},l=>{console.log(l)})}playVideo(r){this.pupUp=!0,console.log(this.pupUp),this.currentVideoIndex=r,this.isVideoPlaying=!0,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())}stopVideo(){this.isVideoPlaying=!1,this.activeVideo&&this.activeVideo.nativeElement&&this.activeVideo.nativeElement.pause()}skipVideo(){this.playNextVideo()}onVideoEnded(){console.log("ended"),this.pupUp=!1}onVideoLoaded(r){r.play()}preventSeek(r){r.currentTime>this.lastTime+1?r.currentTime=this.lastTime:this.lastTime=r.currentTime}playNextVideo(){this.currentVideoIndex<this.videos.length-1?(this.currentVideoIndex++,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())):this.isVideoPlaying=!1}getVideoUrl(r){return this.pupUp=!0,console.log(this.pupUp),`https://${this.bucketName}.s3.${this.region}.amazonaws.com/${this.videos[r].videoKey}`}};o.\u0275fac=function(l){return new(l||o)(fe(Gi),fe(sp),fe(Jn),fe(ii))},o.\u0275cmp=ft({type:o,selectors:[["app-training"]],viewQuery:function(l,t){if(l&1&&(yi(mU,5),yi(pU,5)),l&2){let g;_i(g=bi())&&(t.videoPlayer=g.first),_i(g=bi())&&(t.activeVideo=g.first)}},decls:11,vars:4,consts:[["activeVideo",""],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"container"],[1,"sub-container"],["class","videoss",3,"click",4,"ngFor","ngForOf"],["class","overlay",3,"click",4,"ngIf"],[1,"videoss",3,"click"],[1,"dummy-video",3,"click"],["src","assets/demo/video.png"],[1,"overlay",3,"click"],["controls","","autoplay","","type","video/mp4",1,"active-video",3,"ended","timeupdate","loadedmetadata","src"]],template:function(l,t){l&1&&(ke(0,"br")(1,"br"),$(2,"\xA0\xA0 \xA0"),V(3,"span",1),Oe("click",function(){return t.navBack()}),$(4,"arrow_back"),j(),ke(5,"br")(6,"br"),V(7,"div",2)(8,"div",3),Nt(9,fU,4,0,"div",4),j()(),Nt(10,gU,3,1,"div",5)),l&2&&(ue(7),ki("blur",t.isVideoPlaying),ue(2),Fe("ngForOf",t.videos),ue(),Fe("ngIf",t.pupUp))},dependencies:[uo,Cr],styles:["#video[_ngcontent-%COMP%]{width:100%}video[_ngcontent-%COMP%]{width:90%;height:360px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin-top:10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:space-around;align-items:center;text-align:center}.blur[_ngcontent-%COMP%]{filter:blur(5px)}video[_ngcontent-%COMP%]{width:300px;height:200px;margin:10px;cursor:pointer}.videoss[_ngcontent-%COMP%]{width:90%;display:grid;row-gap:2rem}.dummy-video[_ngcontent-%COMP%]{width:100%}.dummy-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:fixed;top:0%;width:100%;height:100%;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}.overlay[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.active-video[_ngcontent-%COMP%]{width:640px;height:360px}button[_ngcontent-%COMP%]{margin-top:10px;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{cursor:pointer}"]});let d=o;return d})();var No=(()=>{let o=class o{constructor(r){this.http=r,this.apiUrl=Cn}getOrderDetails(r){let l=`${this.apiUrl}users/order/order/${r}`;return this.http.get(l)}getOrderHistoryId(r){let l=`${this.apiUrl}users/order-history/order/${r}`;return this.http.get(l)}getOrderFromOrderId(r){let l=`${this.apiUrl}users/order/order/${r}`;return this.http.get(l)}uploadBeforeWorkImage(r){let l=`${this.apiUrl}users/order-history/before-work-upload-image`;return this.http.post(l,r)}gettingStatus(r){let l=`${this.apiUrl}users/order-history/order/${r}`;return this.http.get(l)}uploadAfterWorkImage(r){let l=`${this.apiUrl}users/order-history/after-work-upload-image`;return this.http.post(l,r)}feedBack(r){let l=`${this.apiUrl}users/user-feedback`;return this.http.post(l,r)}};o.\u0275fac=function(l){return new(l||o)(at(Gi))},o.\u0275prov=Ut({token:o,factory:o.\u0275fac,providedIn:"root"});let d=o;return d})();var _O=(()=>{let o=class o{constructor(r,l,t,g,C,I,O,z,q){this.router=r,this.jobDetailsService=l,this.orderService=t,this.mapboxService=g,this.routerParam=C,this.location=I,this.afterOrderService=O,this.googleMapService=z,this.getOrderService=q,this.timeLeft=120,this.providerCurrentLocationPlace="",this.current=0,this.max=120,this.radius=100,this.color="rgba(255, 0, 0, 1)",this.background="rgba(253, 5, 0, 0.4)",this.cancelRate=0,this.workingHours=0,this.credits=0,this.userAddress="",this.userCoordinates=[0,0],this.orderIds=[],this.orderId="",this.extractedDetails=[],this.serviceName=[{name:"cleaning"},{name:"tank cleaning"},{name:"tankcleaning"}],this.workSeleceted=this.jobDetailsService.workDetails}ngOnInit(){this.getProvderLocation(),this.startTimer(),this.getOrderId()}startTimer(){this.interval=setInterval(()=>{this.timeLeft>0?(this.timeLeft--,this.current=this.timeLeft):(clearInterval(this.interval),this.getOrderService.clearOrderId(),this.router.navigate(["home"]))},1e3)}ngOnDestroy(){clearInterval(this.interval)}get minutes(){return Math.floor(this.timeLeft/60)}get seconds(){return this.timeLeft%60}getCartId(r){let l=this.order._id,t=g=>{let C=setInterval(()=>{if(this.acceptStatus)if(clearInterval(C),this.acceptStatus){this.acceptStatus=!1,this.acceptedOrder(),console.log("User accepted, exiting the loop");return}else console.log("User declined, moving to the next item"),this.acceptStatus=!1,t(g+1)},1e3);setTimeout(()=>{this.acceptStatus===null&&(clearInterval(C),console.log("Automatically moving to the next item"),t(g+1))},12e4)};t(0)}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{console.log(r);let l=r.get("id");this.getOrderDetails(l)},error:r=>{console.log(r)}})}getOrderDetails(r){r&&(this.orderId=r,console.log(r),this.afterOrderService.getOrderFromOrderId(r).subscribe({next:l=>{console.log(l),this.order=l,this.getUserLocation()},error:l=>{console.log(l)}}))}accepted(){this.acceptStatus=!0,this.acceptedOrder()}declined(){this.acceptStatus=!1,console.log("declined"),this.acceptStatus=!1,this.timeLeft=120,this.getOrderService.clearOrderId(),this.router.navigate(["home"])}acceptedOrder(){console.log("order accepted"),this.orderService.accept(this.orderId,this.order.totalAmount,this.order.userId._id).subscribe(r=>{console.log(r),setTimeout(()=>{this.router.navigate(["arrived",r.orderHistory.orderId])},2e3)},r=>{console.log(r)})}getProvderLocation(){this.googleMapService.getCoordinates().subscribe({next:r=>{console.log(r),this.providerCurrentLocation=r,this.getPlaceNameFromCorr(this.providerCurrentLocation,"provider")},error:r=>{console.log(r)}})}getUserLocation(){console.log("cing user");let r="user",l=this.order.addressId;console.log(this.order);let t={lat:l.latitude,lng:l.longitude};this.getPlaceNameFromCorr(t,r)}getPlaceNameFromCorr(r,l){this.googleMapService.getPlaceNameFromCoordinates(r.lat,r.lng).pipe(xI(1e4),kI(2),Jl(t=>(console.error("Failed to get place name:",t),tr({results:[{formatted_address:"Unknown Location"}]})))).subscribe({next:t=>{let g=t.results[0].formatted_address||"Unknown Location";l==="provider"?(this.providerCurrentLocationPlace=g,console.log("Provider location:",g)):l==="user"&&(this.userAddress=g,console.log("User location:",g))},error:t=>{console.error("Error fetching place name:",t)}})}};o.\u0275fac=function(l){return new(l||o)(fe(Bt),fe(Ar),fe(Pr),fe(lp),fe(Fo),fe(ii),fe(No),fe(hl),fe(ap))},o.\u0275cmp=ft({type:o,selectors:[["app-get-order"]],decls:60,vars:16,consts:[[1,"container"],[1,"timer"],[3,"current","max","color","background","radius","rounded","stroke"],[1,"timer-container"],[1,"time"],[1,"location-container"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],[1,"line"],[1,"address"],[1,"location-txt"],[1,"location"],[1,"service-details"],[1,"main-Text"],[1,"value-Text"],[1,"acc-rej-btns"],[3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1),ke(2,"round-progress",2),V(3,"div",3)(4,"p",4)(5,"span"),$(6),j(),V(7,"span"),$(8,"Time left"),j()()()(),V(9,"div",5)(10,"div")(11,"span",6),$(12," location_on "),j(),ke(13,"div",7),V(14,"span",6),$(15," location_on "),j()(),V(16,"div",8)(17,"p")(18,"span",9),$(19,"My location"),j(),V(20,"span",10),$(21),j()(),ke(22,"br")(23,"br"),V(24,"p")(25,"span",9),$(26,"User location"),j(),V(27,"span",10),$(28),j()()()(),V(29,"div",11)(30,"span")(31,"span",12),$(32,"Category Type :"),j(),V(33,"span",13),$(34),j()(),V(35,"span")(36,"span",12),$(37,"SubService Type :"),j(),V(38,"span",13),$(39),j()(),V(40,"span")(41,"span",12),$(42,"Service Name :"),j(),V(43,"span",13),$(44),j()(),V(45,"span")(46,"span",12),$(47,"Price :"),j(),V(48,"span",13),$(49),j()(),V(50,"span")(51,"span",12),$(52,"Schedule :"),j(),V(53,"span",13),$(54),j()()(),V(55,"div",14)(56,"button",15),Oe("click",function(){return t.declined()}),$(57,"Reject"),j(),V(58,"button",15),Oe("click",function(){return t.accepted()}),$(59,"Accept"),j()()()),l&2&&(ue(2),Fe("current",t.current)("max",t.max)("color",t.color)("background",t.background)("radius",t.radius)("rounded",!0)("stroke",10),ue(4),Aa("",t.minutes,":",t.seconds<10?"0"+t.seconds:t.seconds,""),ue(15),Ft(t.providerCurrentLocationPlace),ue(7),Ft(t.userAddress),ue(6),Ft(t.order==null||t.order.categoryIds[0]==null?null:t.order.categoryIds[0].name),ue(5),Ft(t.order==null||t.order.subCategoryIds[0]==null?null:t.order.subCategoryIds[0].name),ue(5),Ft(t.order==null||t.order.subCategoryIds[0]==null?null:t.order.subCategoryIds[0].name),ue(5),Ft(t.order==null?null:t.order.totalAmount),ue(5),Ft(t.order==null||t.order.items[0]==null?null:t.order.items[0].scheduledDate))},dependencies:[uy],styles:[".container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;top:5%;left:2.5%;display:flex;flex-direction:column;gap:2rem}.timer[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.timer-container[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center}.time[_ngcontent-%COMP%]{font-size:2em;text-align:center;display:flex;flex-direction:column;gap:.5rem}.time[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1rem}.location-container[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:10% 80%}.location-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){display:flex;flex-direction:column;align-items:center;justify-content:center}.line[_ngcontent-%COMP%]{width:1px;height:6rem;border-left:.25px dashed black}.address[_ngcontent-%COMP%], .address[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-align:left}.location-txt[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:500}.location[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:.9rem;font-weight:400;color:#b8b8b8}.service-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.main-Text[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:500;color:#5a5a5a80}.value-Text[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:400;color:#515151}.acc-rej-btns[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-around}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:150px;height:50px;border:none;border-radius:.4rem;font-family:Inter,sans-serif;font-size:1rem;font-weight:500;letter-spacing:1px;color:#fff;text-align:center}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#d70d09}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:#409000}"]});let d=o;return d})();var _U=["map"],bO=(()=>{let o=class o{constructor(r,l,t,g,C,I,O,z){this.router=r,this.routerParam=l,this.mapboxService=t,this.orderService=g,this.location=C,this.googleMapsService=I,this.dailogeBoxService=O,this.afterOrderService=z,this.toggleChecked=!1,this.distanceThreshold=200,this.orderHistoryId=""}ngOnInit(){this.userFullAddress=this.orderService.userFullAddress,this.getOrderId()}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.getUserLocation()},error:l=>{console.log(l)}}))}getUserLocation(){console.log("cing user");let r="user",l=this.order?.addressId;console.log(this.order);let t={lat:l?.latitude,lng:l?.longitude};this.userCoordinates=t,this.initializeMap()}initializeMap(){this.googleMapsService.getCoordinates().subscribe({next:r=>{if(!r){console.error("Provider coordinates are null");return}if(this.providerCoordinates=r,!this.userCoordinates){console.error("User coordinates are null");return}this.googleMapsService.initializeMap(this.providerCoordinates,this.mapElement.nativeElement),this.googleMapsService.addProviderMarker(this.providerCoordinates),this.googleMapsService.addUserMarker(this.userCoordinates),this.googleMapsService.showDirections(this.userCoordinates,this.providerCoordinates),this.trackProviderAndCheckArrival(),this.getUserFullAddress()},error:r=>{console.error("Error fetching provider coordinates:",r)}})}getUserFullAddress(){let r=this.userCoordinates.lat,l=this.userCoordinates.lng;this.googleMapsService.getPlaceNameFromCoordinates(r,l).subscribe({next:t=>{console.log("user full address",t),console.log(t.results[0].formatted_address),this.userFullAddress=t.results[0].formatted_address}})}trackProviderAndCheckArrival(){this.locationTrackingSubscription=this.googleMapsService.trackProviderLocation().subscribe(r=>{this.providerCoordinates=r,this.googleMapsService.updateProviderMarker(this.providerCoordinates);let l=this.googleMapsService.calculateDistance(this.userCoordinates.lat,this.userCoordinates.lng,this.providerCoordinates.lat,this.providerCoordinates.lng);console.log("Distance between user and provider:",l),this.googleMapsService.showDirections(this.userCoordinates,this.providerCoordinates),l<=this.distanceThreshold&&(this.toggleChecked=!0)})}navTOBack(){this.location.back()}toggleDisplay(r){this.toggleChecked&&(console.log("Arrived at user location"),this.router.navigate(["startWork",this.orderHistoryId])),console.log("Arrived at user location"),this.router.navigate(["startWork",this.orderHistoryId])}handleDisabledClick(){console.log("insideeeeeeee"),this.toggleChecked||this.dailogeBoxService.openDialog("You are not arrives at location.")}cancel(){this.orderService.cancelOrder().subscribe(r=>{console.log(r),this.router.navigate(["home"])},r=>{console.log(r)})}ngOnDestroy(){this.locationTrackingSubscription&&(this.locationTrackingSubscription.unsubscribe(),console.log("Stopped tracking provider\u2019s location."))}};o.\u0275fac=function(l){return new(l||o)(fe(Bt),fe(Fo),fe(lp),fe(Pr),fe(ii),fe(hl),fe(Wn),fe(No))},o.\u0275cmp=ft({type:o,selectors:[["app-arvied"]],viewQuery:function(l,t){if(l&1&&yi(_U,7),l&2){let g;_i(g=bi())&&(t.mapElement=g.first)}},decls:18,vars:1,consts:[["map",""],[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"arival-status"],[3,"click"],["id","map",2,"height","500px","width","100%"],[1,"location"],[1,"material-symbols-outlined","notranslate"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"click","change"],["for","toggle",1,"already-label"]],template:function(l,t){if(l&1){let g=Xt();V(0,"section",1)(1,"span",2),Oe("click",function(){return gt(g),_t(t.navTOBack())}),$(2," arrow_back "),j(),V(3,"div",3)(4,"span"),$(5,"On the way "),j(),V(6,"button",4),Oe("click",function(){return gt(g),_t(t.cancel())}),$(7,"Cancel"),j()(),ke(8,"div",5,0),V(10,"div",6)(11,"span",7),$(12," near_me "),j(),V(13,"span"),$(14),j()(),V(15,"div",8)(16,"input",9),Oe("click",function(){return gt(g),_t(t.handleDisabledClick())})("change",function(I){return gt(g),_t(t.toggleDisplay(I))}),j(),ke(17,"label",10),j()()}l&2&&(ue(14),Ii(" ",t.userFullAddress," "))},styles:['.container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;left:2.5%;top:2.5%;display:flex;flex-direction:column;gap:2rem}.arival-status[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-between;border-radius:.5rem;align-items:center;background-color:#d70d09}.arival-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Poppins" sans-serif;margin-left:1.5rem;font-size:1.1rem;font-weight:500;line-height:24px;text-align:left;color:#fff}.arival-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:6rem;height:2.5rem;color:#fff;background-color:transparent;border:.25px solid #ffff;font-family:"Poppins" sans-serif;font-size:1.1rem;font-weight:500;border-radius:.4rem;margin-right:1rem}#map[_ngcontent-%COMP%]{width:100%;height:20rem}.location[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:20% 80%}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){display:flex;justify-content:center;align-items:center}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Poppins" sans-serif;font-size:14px;font-weight:400;line-height:25px;letter-spacing:.05em;text-align:left}.slide-toggle[_ngcontent-%COMP%]{position:fixed;width:95%;height:46px;left:2%;bottom:5%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Arrived";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#409000;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:2px;left:2px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;content:"Arrived";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;pointer-events:none}']});let d=o;return d})();var bU=["map"],yO=(()=>{let o=class o{constructor(r,l,t,g,C,I){this.router=r,this.routerParam=l,this.orderService=t,this.googleMapsService=g,this.location=C,this.afterOrderService=I,this.toggleChecked=!1,this.orderHistoryId=""}ngAfterViewInit(){this.getOrderId()}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.getUserLocationCoordinates()},error:l=>{console.log(l)}}))}initializeMap(r){return jn(this,null,function*(){let l=r;this.getUserFullAddress(l),this.locationTrackingSubscription=this.googleMapsService.getCoordinates().subscribe(t=>{if(!t){console.error("Provider coordinates are null");return}this.googleMapsService.initializeMap(t,this.mapElement.nativeElement),this.googleMapsService.addProviderMarker(t),this.googleMapsService.addUserMarker(l),this.googleMapsService.showDirections(t,l)})})}getUserLocationCoordinates(){return jn(this,null,function*(){console.log("inside user location");let r=this.order?.addressId;if(r){let l={lat:r.latitude,lng:r.longitude};return console.log("user coordinates",l),this.initializeMap(l),l}else{let l={lat:0,lng:0};return this.initializeMap(l),l}})}getUserFullAddress(r){let l=r.lat,t=r.lng;this.googleMapsService.getPlaceNameFromCoordinates(l,t).subscribe({next:g=>{console.log("user full address",g),console.log(g.results[0].formatted_address),this.userFullAddress=g.results[0].formatted_address}})}navTOBack(){this.location.back()}toggleDisplay(r){this.toggleChecked=!this.toggleChecked,this.router.navigate(["work/otp",this.orderHistoryId])}navToChat(){let r={role:"user",id:this.order.userId};this.router.navigate(["help/chatbot"],{queryParams:r})}ngOnDestroy(){this.locationTrackingSubscription&&(this.locationTrackingSubscription.unsubscribe(),console.log("Stopped tracking provider\u2019s location."))}};o.\u0275fac=function(l){return new(l||o)(fe(Bt),fe(Fo),fe(Pr),fe(hl),fe(ii),fe(No))},o.\u0275cmp=ft({type:o,selectors:[["app-start-work"]],viewQuery:function(l,t){if(l&1&&yi(bU,5),l&2){let g;_i(g=bi())&&(t.mapElement=g.first)}},decls:21,vars:1,consts:[["map",""],[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"arival-status"],[1,"material-symbols-outlined","notranslate",2,"font-size","24px","margin-right","1.5rem"],[1,"material-symbols-outlined","notranslate",2,"font-size","24px","margin-right","1.5rem",3,"click"],["id","map",2,"height","500px","width","100%"],[1,"location"],[1,"material-symbols-outlined","notranslate"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"change"],["for","toggle",1,"already-label"]],template:function(l,t){if(l&1){let g=Xt();V(0,"section",1)(1,"span",2),Oe("click",function(){return gt(g),_t(t.navTOBack())}),$(2," arrow_back "),j(),V(3,"div",3)(4,"span"),$(5,"Reached customer location"),j(),V(6,"div")(7,"span",4),$(8,"call"),j(),V(9,"span",5),Oe("click",function(){return gt(g),_t(t.navToChat())}),$(10,"forum"),j()()(),ke(11,"div",6,0),V(13,"div",7)(14,"span",8),$(15,"near_me"),j(),V(16,"span"),$(17),j()(),V(18,"div",9)(19,"input",10),Oe("change",function(I){return gt(g),_t(t.toggleDisplay(I))}),j(),ke(20,"label",11),j()()}l&2&&(ue(17),Ft(t.userFullAddress))},styles:['.container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;left:2.5%;display:flex;flex-direction:column;gap:2rem;margin-top:2.5%}.arival-status[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-between;border-radius:.5rem;align-items:center;background-color:#d70d09}.arival-status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.arival-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Poppins" sans-serif;margin-left:1.5rem;font-size:1.1rem;font-weight:500;line-height:24px;text-align:left;color:#fff}#map[_ngcontent-%COMP%]{width:100%;height:20rem}.map[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.location[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:20% 80%}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){display:flex;justify-content:center;align-items:center}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Poppins" sans-serif;font-size:14px;font-weight:400;line-height:25px;letter-spacing:.05em;text-align:left}.slide-toggle[_ngcontent-%COMP%]{position:fixed;width:95%;height:60px;left:2%;bottom:5%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Arrived";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#409000;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:10px;left:15px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;content:"Start working";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;pointer-events:none}']});let d=o;return d})();var yU=["input1"],vU=["input2"],xU=["input3"],wU=["input4"],vO=(()=>{let o=class o{navTOBack(){this.location.back()}constructor(r,l,t,g,C,I,O){this.form=r,this.orderService=l,this.routerParam=t,this.afterOrderService=g,this.router=C,this.dialougeBOxService=I,this.location=O,this.orderHistoryId="",this.orderId=""}ngOnInit(){this.getOrderId(),this.getOtp(),this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}onInput(r,l){if(r.target.value.length===1)switch(l){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.orderId=l._id,this.getOrderHistoryId(this.orderId)},error:l=>{console.log(l)}}))}getOrderHistoryId(r){this.afterOrderService.getOrderHistoryId(r).subscribe({next:l=>{console.log(l),this.orderHistoryId=l.data._id},error:l=>{console.log(l)}})}getOtp(){}verifyOtp(){let r=this.otp.value,l=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log(l);let t={orderHistoryId:this.orderHistoryId,uniqueNumber:l,userId:this.order.userId,orderId:this.orderId};console.log(t),this.orderService.verifyStartOrder(t).subscribe({next:g=>{console.log(g),this.dialougeBOxService.openDialog("OTP verified sucessfully"),this.router.navigate(["workImage",this.orderId])},error:g=>{console.log(g),this.dialougeBOxService.openDialog(g.error.message)}})}};o.\u0275fac=function(l){return new(l||o)(fe(aa),fe(Pr),fe(Fo),fe(No),fe(Bt),fe(Wn),fe(ii))},o.\u0275cmp=ft({type:o,selectors:[["app-work-otp"]],viewQuery:function(l,t){if(l&1&&(yi(yU,5),yi(vU,5),yi(xU,5),yi(wU,5)),l&2){let g;_i(g=bi())&&(t.input1=g.first),_i(g=bi())&&(t.input2=g.first),_i(g=bi())&&(t.input3=g.first),_i(g=bi())&&(t.input4=g.first)}},decls:24,vars:1,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"image-div"],["src","assets/demo/Stylist doing haircut.png"],[1,"info-text"],[1,"numberss"],[3,"formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input"],["type","text","maxlength","1","formControlName","inputTwo",3,"input"],["type","text","maxlength","1","formControlName","inputThree",3,"input"],["type","text","maxlength","1","formControlName","inputFour",3,"input"],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){if(l&1){let g=Xt();V(0,"div",4)(1,"span",5),Oe("click",function(){return gt(g),_t(t.navTOBack())}),$(2," arrow_back "),j(),V(3,"div",6)(4,"div",7),ke(5,"img",8),j(),V(6,"span")(7,"span",9),$(8,"Before start the work"),j(),ke(9,"br"),V(10,"span",10),$(11,"Enter OTP from user"),j()(),V(12,"form",11)(13,"div",12)(14,"input",13,0),Oe("input",function(I){return gt(g),_t(t.onInput(I,1))}),j(),V(16,"input",14,1),Oe("input",function(I){return gt(g),_t(t.onInput(I,2))}),j(),V(18,"input",15,2),Oe("input",function(I){return gt(g),_t(t.onInput(I,3))}),j(),V(20,"input",16,3),Oe("input",function(I){return gt(g),_t(t.onInput(I,4))}),j()(),V(22,"button",17),Oe("click",function(){return gt(g),_t(t.verifyOtp())}),$(23,"Confirm"),j()()()()}l&2&&(ue(12),Fe("formGroup",t.otp))},dependencies:[Lo,mo,hr,Ro,Gm,oa,es],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;margin-top:2.5%}.material-symbols-outlined[_ngcontent-%COMP%]{width:max-content;margin-left:2.5%}.sub-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;text-align:center}.image-div[_ngcontent-%COMP%]{width:100%;height:25rem}.image-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px;color:#414141}.info-text[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0;color:#414141}.numberss[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:600;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;margin-left:5%}"]});let d=o;return d})();var xO=(()=>{let o=class o{constructor(r,l,t,g,C){this.orderService=r,this.router=l,this.location=t,this.routerParam=g,this.afterOrderService=C,this.total=0,this.orderHistoryId="",this.work={},this.alreadyHasAccount=!1}ngOnInit(){this.getOrderId()}navTOBack(){this.location.back()}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{let l=r.get("id");l&&(this.orderHistoryId=l,this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.work=this.order,console.log("work",this.work)},error:l=>{console.log(l)}})}toggleDisplay(){let r=this.work.userId;this.router.navigate(["workImage",this.orderHistoryId],{replaceUrl:!0})}};o.\u0275fac=function(l){return new(l||o)(fe(Pr),fe(Bt),fe(ii),fe(Fo),fe(No))},o.\u0275cmp=ft({type:o,selectors:[["app-work-complete"]],decls:36,vars:6,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"image"],["src","assets/new/Man washing hand.png"],[1,"details"],[1,"details-div"],[1,"about"],[1,"highlight-text"],[1,"sub-title"],[1,"line"],[1,"time-div"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"ngModelChange","change","ngModel"],["for","toggle",1,"already-label"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"span",1),Oe("click",function(){return t.navTOBack()}),$(2," arrow_back "),j(),V(3,"div",2),ke(4,"img",3),j(),V(5,"section",4)(6,"div",5)(7,"span",6)(8,"span",7),$(9),j()(),V(10,"span",8),$(11),j(),ke(12,"div",9),j(),V(13,"div",10)(14,"p")(15,"span"),$(16,"Others"),j(),ke(17,"br"),V(18,"span",7),$(19,"Convenience Fee"),j()(),V(20,"p",7),$(21,"69"),j()(),ke(22,"div",9)(23,"br"),V(24,"div",10)(25,"p")(26,"span",7),$(27,"Total value"),j(),ke(28,"br"),V(29,"span"),$(30,"commission credits"),j()(),V(31,"p",7),$(32),j()()(),V(33,"div",11)(34,"input",12),zr("ngModelChange",function(C){return Fr(t.alreadyHasAccount,C)||(t.alreadyHasAccount=C),C}),Oe("change",function(){return t.toggleDisplay()}),j(),ke(35,"label",13),j()()),l&2&&(ue(9),Aa("",t.work==null||t.work.orderId==null||t.work.orderId.items[0]==null?null:t.work.orderId.items[0].quantity," X ",t.work==null||t.work.orderId==null||t.work.orderId.categoryIds[0]==null?null:t.work.orderId.categoryIds[0].name,""),ue(2),Aa("",t.work==null||t.work.orderId==null||t.work.orderId.items[0]==null?null:t.work.orderId.items[0].quantity," X ",t.work==null||t.work.orderId==null||t.work.orderId.subCategoryIds[0]==null?null:t.work.orderId.subCategoryIds[0].name,""),ue(21),Ft(t.work==null||t.work.orderId==null?null:t.work.orderId.totalAmount),ue(2),Lr("ngModel",t.alreadyHasAccount))},dependencies:[cl,hr,ra],styles:['.container[_ngcontent-%COMP%]{width:95vw;height:100%;display:flex;flex-direction:column;gap:1rem;position:relative;left:2.5%;right:2.5%;top:2.5%}.image[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.details[_ngcontent-%COMP%], .details-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem}.about[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.slide-toggle[_ngcontent-%COMP%]{position:relative;width:95%;height:46px;left:2%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Placeholder Text";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#bb0e0e;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:2px;left:2px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;color:#fff;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#000;font-size:14px;pointer-events:none}.slide-toggle[_ngcontent-%COMP%]   label.already-label[_ngcontent-%COMP%]:before{content:"Swipe to Complete";color:#fff;font-family:Poppins;font-size:1.1rem;font-weight:500;line-height:22.82px;text-align:left}.time-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.Details[_ngcontent-%COMP%]{width:90%;border:.25px solid black;border-radius:.5rem}.line[_ngcontent-%COMP%]{width:100%;height:0;border:0;border-bottom:1px dashed rgb(45,44,44)}.sub-tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:.9rem;font-weight:400;line-height:14.52px;text-align:left}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:600;line-height:16.94px;text-align:left}']});let d=o;return d})();var CU=["input1"],SU=["input2"],MU=["input3"],kU=["input4"],wO=(()=>{let o=class o{navTOBack(){this.location.back()}constructor(r,l,t,g,C,I){this.form=r,this.orderService=l,this.router=t,this.afterOrderService=g,this.routerParam=C,this.location=I,this.orderHistoryId="",this.orderId="",this.getOrderId(),this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}onInput(r,l){if(r.target.value.length===1)switch(l){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{let l=r.get("id");l&&(this.orderId=l,this.getOrderDetails(l))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.getOrderHistoryId(this.orderId)},error:l=>{console.error(l)}}))}getOrderHistoryId(r){this.afterOrderService.getOrderHistoryId(r).subscribe({next:l=>{console.log(l),this.orderHistoryId=l.data._id},error:l=>{console.log(l)}})}login(){let r=this.otp.value,l=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log(l),this.orderService.verifyAfterComplete(l,this.orderHistoryId,this.orderId).subscribe(t=>{console.log(t);let g={userId:this.order.userId?._id,orderHistoryId:this.orderHistoryId};this.router.navigate(["feedback"],{queryParams:g})},t=>{console.log(t)})}};o.\u0275fac=function(l){return new(l||o)(fe(aa),fe(Pr),fe(Bt),fe(No),fe(Fo),fe(ii))},o.\u0275cmp=ft({type:o,selectors:[["app-verify-after-work"]],viewQuery:function(l,t){if(l&1&&(yi(CU,5),yi(SU,5),yi(MU,5),yi(kU,5)),l&2){let g;_i(g=bi())&&(t.input1=g.first),_i(g=bi())&&(t.input2=g.first),_i(g=bi())&&(t.input3=g.first),_i(g=bi())&&(t.input4=g.first)}},decls:24,vars:1,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"image-div"],["src","assets/demo/Stylist doing haircut.png"],[1,"info-text"],[1,"numberss"],[3,"formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input"],["type","text","maxlength","1","formControlName","inputTwo",3,"input"],["type","text","maxlength","1","formControlName","inputThree",3,"input"],["type","text","maxlength","1","formControlName","inputFour",3,"input"],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){if(l&1){let g=Xt();V(0,"div",4)(1,"span",5),Oe("click",function(){return gt(g),_t(t.navTOBack())}),$(2," arrow_back "),j(),V(3,"div",6)(4,"div",7),ke(5,"img",8),j(),V(6,"span")(7,"span",9),$(8,"Before start the work"),j(),ke(9,"br"),V(10,"span",10),$(11,"Enter OTP from user"),j()(),V(12,"form",11)(13,"div",12)(14,"input",13,0),Oe("input",function(I){return gt(g),_t(t.onInput(I,1))}),j(),V(16,"input",14,1),Oe("input",function(I){return gt(g),_t(t.onInput(I,2))}),j(),V(18,"input",15,2),Oe("input",function(I){return gt(g),_t(t.onInput(I,3))}),j(),V(20,"input",16,3),Oe("input",function(I){return gt(g),_t(t.onInput(I,4))}),j()(),V(22,"button",17),Oe("click",function(){return gt(g),_t(t.login())}),$(23,"Confirm"),j()()()()}l&2&&(ue(12),Fe("formGroup",t.otp))},dependencies:[Lo,mo,hr,Ro,Gm,oa,es],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;margin-top:2.5%;align-items:center}.material-symbols-outlined[_ngcontent-%COMP%]{width:max-content;margin-left:2.5%}.sub-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;text-align:center}.image-div[_ngcontent-%COMP%]{width:100%;height:25rem}.image-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px;color:#414141}.info-text[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0;color:#414141}.numberss[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:600;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#cd2e28;margin-left:5%}"]});let d=o;return d})();function IU(d,o){if(d&1){let c=Xt();V(0,"div",5)(1,"div",6),Oe("click",function(){let l=gt(c).$implicit,t=lt();return _t(t.slect(l))}),ke(2,"img",7),$(3),j(),V(4,"div")(5,"input",8),zr("ngModelChange",function(l){let t=gt(c).$implicit;return Fr(t.checked,l)||(t.checked=l),_t(l)}),Oe("change",function(l){let t=gt(c).$implicit,g=lt();return _t(g.onChange(l,t))}),j()()()}if(d&2){let c=o.$implicit;ue(2),Fe("src",c.imageKey,Un),ue(),Ft(c.name),ue(2),Lr("ngModel",c.checked)}}var CO=(()=>{let o=class o{constructor(r,l,t,g,C,I){this.loginService=r,this.logInService=l,this.router=t,this.location=g,this.dailougeService=C,this.userDetailsService=I,this.workSeleceted=[],this.items=[]}ngOnInit(){this.getSubServices()}getSubServices(){this.loginService.getSubCategory().subscribe(r=>{console.log(r),this.items=r,this.getWork()},r=>{console.log(r)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works,this.autoCheckServices()},r=>{console.log(r)})}autoCheckServices(){this.workSeleceted.forEach(r=>{let l=this.items.filter(t=>t.categoryId===r.categoryId._id);if(l.length>0){let t=r.subcategoryId;l.forEach(g=>{g._id===t._id&&(g.checked=!0,console.log(`Checked subcategory: ${g.name}`))})}})}send(){this.logInService.selectedSubCategories.length>0?this.router.navigate(["services"]):this.dailougeService.openDialog("Please select atleat one sub-category ")}slect(r){let l=this.items.indexOf(r);console.log("categoryId",r._),this.logInService.setSubCat(r._id),this.logInService.selectedSubCategories.length>0?this.router.navigate(["services"]):this.dailougeService.openDialog("Please select atleat one sub-category ")}onChange(r,l){let t=r.target;if(console.log(l),t&&t.checked){let C=this.items.indexOf(l);console.log("categoryId",l._),this.logInService.setSubCat(l._id),this.logInService.selectedSubCategories.length>0?this.router.navigate(["services"]):this.dailougeService.openDialog("Please select atleat one sub-category ")}}navToBack(){this.location.back()}};o.\u0275fac=function(l){return new(l||o)(fe(Kn),fe(Kn),fe(Bt),fe(ii),fe(Wn),fe(Jn))},o.\u0275cmp=ft({type:o,selectors:[["app-sub-services"]],decls:10,vars:0,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"tittle"],[1,"serivce"],[1,"service-div"],[1,"names",3,"click"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"span",1),Oe("click",function(){return t.navToBack()}),$(2," keyboard_backspace "),j(),V(3,"div",2)(4,"span",3),$(5,"Select Sub-Services"),j(),ke(6,"br"),V(7,"div",4),xr(8,IU,6,3,"div",5,io),j()()()),l&2&&(ue(8),wr(t.items))},dependencies:[cl,hr,ra],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;left:5%;align-items:center;display:grid;grid-gap:.5rem;text-align:center}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.serivce[_ngcontent-%COMP%]{height:78vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.5rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2rem;height:2rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let d=o;return d})();var SO=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275cmp=ft({type:o,selectors:[["app-not-found"]],decls:11,vars:0,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"span",1),$(2," wifi_off "),j(),V(3,"span"),$(4,"You're offline"),j(),V(5,"span"),$(6,"Please connect to internet and try again"),j(),V(7,"button")(8,"span",1),$(9," refresh "),j(),$(10," Retry "),j()())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center}.material-symbols-outlined[_ngcontent-%COMP%]{font-weight:300}"]});let d=o;return d})();var MO=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275cmp=ft({type:o,selectors:[["app-location"]],decls:2,vars:0,template:function(l,t){l&1&&(V(0,"p"),$(1,"location works!"),j())}});let d=o;return d})();function TU(d,o){d&1&&(V(0,"p"),$(1,"No subcategories available"),j())}function EU(d,o){if(d&1){let c=Xt();V(0,"div",7)(1,"h3"),$(2),j(),V(3,"section",8)(4,"h3"),$(5),j(),V(6,"span",9),Oe("click",function(){let l=gt(c).$implicit,t=lt();return _t(t.removeWork(l._id))}),$(7," delete "),j()(),V(8,"div")(9,"h3"),$(10,"Services :"),j(),V(11,"ul")(12,"li"),$(13),j()()(),Nt(14,TU,2,0,"p",10),V(15,"p"),$(16),j()()}if(d&2){let c=o.$implicit;ue(2),Ii("Category : ",c.categoryId.name,""),ue(3),Ii(" SubCategory : ",c.subcategoryId.name,""),ue(8),Ii(" ",c.serviceId.name," "),ue(),Fe("ngIf",c.subcategoryId.length===0),ue(2),Ii("Experience: ",c.experience,"")}}var kO=(()=>{let o=class o{constructor(r,l,t){this.location=r,this.userDetailsService=l,this.router=t,this.works=[]}ngOnInit(){this.getWork()}getWork(){this.works=[],this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r),this.works=r.works},error:r=>{console.log(r)}})}removeSubcategory(r,l){console.log(r,"subCat",l),this.userDetailsService.deleteServiceWork(r,l).subscribe({next:t=>{console.log(t),this.getWork()},error:t=>{console.log(t)}})}removeWork(r){let l={providerId:localStorage.getItem("providerId"),workId:r};this.userDetailsService.deleteWork(l).subscribe({next:t=>{console.log(t),this.getWork()},error:t=>{console.log(t)}})}navToSelectWork(){this.router.navigate(["selectWork"])}navToBack(){console.log("back"),this.location.back()}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(Jn),fe(Bt))},o.\u0275cmp=ft({type:o,selectors:[["app-manage-services"]],decls:15,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"new-address",3,"click"],[1,"material-symbols-outlined","notranslate"],[1,"work-div"],[1,"service-section"],[1,"material-icons",3,"click"],[4,"ngIf"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),V(4,"span",3),$(5,"Manage Services"),j()(),V(6,"div",4)(7,"div",5),Oe("click",function(){return t.navToSelectWork()}),V(8,"div")(9,"span",6),$(10," add "),j(),V(11,"span"),$(12,"Add new Services"),j()()(),xr(13,EU,17,5,"div",7,io),j()()),l&2&&(ue(13),wr(t.works))},dependencies:[Cr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:670px;position:relative;top:2%;left:5%;display:flex;flex-direction:column;gap:1rem}.new-address[_ngcontent-%COMP%]{width:100%;height:2.5rem;border-radius:.6rem;border:.25px solid black;display:flex;justify-content:space-between;align-items:center}.new-address[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:60%;display:flex;align-items:center;gap:.5rem;padding-left:.5rem}.new-address[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:16.94px;color:#f9a600}.arrow[_ngcontent-%COMP%]{width:100%;display:flex;text-align:center;margin:1rem 0 0 1rem}.tittle[_ngcontent-%COMP%]{width:80%;font-family:"Inter" sans-serif;font-size:22px;font-weight:500;line-height:26.63px;text-align:center}.work-div[_ngcontent-%COMP%]{margin-bottom:20px;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:2px 2px 10px #0000001a}h3[_ngcontent-%COMP%]{margin:0;color:#2c3e50}ul[_ngcontent-%COMP%]{list-style:none;padding:0}li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin:5px 0;padding:5px;border:1px solid #ddd;border-radius:4px;background-color:#f9f9f9}p[_ngcontent-%COMP%]{color:#7f8c8d;font-size:14px;margin:5px 0}.material-icons[_ngcontent-%COMP%]{cursor:pointer;color:#e74c3c;font-size:24px;transition:color .2s ease}.material-icons[_ngcontent-%COMP%]:hover{color:#c0392b}p[ngIf][_ngcontent-%COMP%]{color:#95a5a6;font-style:italic}.service-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem}']});let d=o;return d})();var IO=(()=>{let o=class o{constructor(r,l,t,g,C){this.location=r,this.routerParam=l,this.afterOrderService=t,this.dailougeBoxService=g,this.router=C,this.rating=0,this.userFeedback="",this.userId="",this.orderHistoryId="",this.getUser()}getUser(){this.routerParam.queryParams.subscribe({next:r=>{this.userId=r.userId,this.orderHistoryId=r.orderHistoryId}})}rate(r){this.rating=r}submitFeedback(){if(this.rating===0){alert("Please provide a rating before submitting.");return}if(this.userFeedback.trim()===""){alert("Please provide your feedback before submitting.");return}console.log("Rating:",this.rating),console.log("Feedback:",this.userFeedback),console.log(this.userId);let r={userId:this.userId,providerId:localStorage.getItem("providerId"),orderHistoryId:this.orderHistoryId,rating:this.rating,description:this.userFeedback};console.log(r),this.afterOrderService.feedBack(r).subscribe({next:l=>{console.log(l),this.dailougeBoxService.openDialog("feedback send sucessfully"),this.router.navigate(["home"])},error:l=>{console.log(l)}}),this.rating=0,this.userFeedback=""}navToBack(){this.location.back()}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(Fo),fe(No),fe(Wn),fe(Bt))},o.\u0275cmp=ft({type:o,selectors:[["app-feedback"]],decls:26,vars:11,consts:[[1,"feedback-container"],[1,"material-symbols-outlined","back-icon",3,"click"],[1,"success-icon"],["src","assets/demo/done.png"],[1,"star-div"],[1,"star-rating-section"],[1,"star-rating"],[1,"star",3,"click"],[1,"rating-text"],[1,"rating-subtext"],[1,"feedback-text"],["placeholder","Write your text","rows","4",3,"ngModelChange","ngModel"],[1,"submit-btn",3,"click"]],template:function(l,t){l&1&&(V(0,"section",0)(1,"span",1),Oe("click",function(){return t.navToBack()}),$(2,"arrow_back"),j(),V(3,"div",2),ke(4,"img",3),j(),V(5,"div",4)(6,"div",5)(7,"div",6)(8,"span",7),Oe("click",function(){return t.rate(1)}),$(9,"\u2605"),j(),V(10,"span",7),Oe("click",function(){return t.rate(2)}),$(11,"\u2605"),j(),V(12,"span",7),Oe("click",function(){return t.rate(3)}),$(13,"\u2605"),j(),V(14,"span",7),Oe("click",function(){return t.rate(4)}),$(15,"\u2605"),j(),V(16,"span",7),Oe("click",function(){return t.rate(5)}),$(17,"\u2605"),j()(),V(18,"p",8),$(19,"Excellent"),j(),V(20,"p",9),$(21,"You rated Sergio Ramos 5 star"),j()(),V(22,"div",10)(23,"textarea",11),zr("ngModelChange",function(C){return Fr(t.userFeedback,C)||(t.userFeedback=C),C}),j()(),V(24,"button",12),Oe("click",function(){return t.submitFeedback()}),$(25,"Submit"),j()()()),l&2&&(ue(8),ki("filled",t.rating>=1),ue(2),ki("filled",t.rating>=2),ue(2),ki("filled",t.rating>=3),ue(2),ki("filled",t.rating>=4),ue(2),ki("filled",t.rating>=5),ue(7),Lr("ngModel",t.userFeedback))},dependencies:[mo,hr,ra],styles:[".feedback-container[_ngcontent-%COMP%]{width:90%;height:95%;max-width:400px;margin:auto;font-family:Arial,sans-serif;padding:20px;box-shadow:0 4px 8px #0000001a;position:relative;text-align:center}.back-icon[_ngcontent-%COMP%]{font-size:24px;color:#555;position:absolute;top:15px;left:15px;cursor:pointer}.success-icon[_ngcontent-%COMP%]{height:90%;display:flex;align-items:center;justify-content:center;font-size:80px;color:#4caf50}.star-div[_ngcontent-%COMP%]{position:fixed;bottom:5%;width:90%}.star-rating-section[_ngcontent-%COMP%]{margin-top:20px;display:flex;flex-direction:column;gap:1rem}.star-rating[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:5px}.star[_ngcontent-%COMP%]{font-size:50px;color:#ccc;cursor:pointer;transition:color .2s;margin:0 5px}.star.filled[_ngcontent-%COMP%]{color:#ffc107}.rating-text[_ngcontent-%COMP%]{font-size:18px;font-weight:700;margin:5px 0;color:#333}.rating-subtext[_ngcontent-%COMP%]{font-size:14px;color:#777;margin-bottom:20px}.feedback-text[_ngcontent-%COMP%]{width:90%;margin:0 7% 20px 2%}textarea[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:14px;border-radius:8px;border:1px solid #ddd;resize:none}.submit-btn[_ngcontent-%COMP%]{width:90%;padding:12px;font-size:16px;color:#fff;background-color:#ff6f00;border:none;border-radius:8px;cursor:pointer;transition:background-color .2s}.submit-btn[_ngcontent-%COMP%]:hover{background-color:#ff8c00}"]});let d=o;return d})();var qd=function(d){return d.Prompt="PROMPT",d.Camera="CAMERA",d.Photos="PHOTOS",d}(qd||{}),g_=function(d){return d.Rear="REAR",d.Front="FRONT",d}(g_||{}),z2=function(d){return d.Uri="uri",d.Base64="base64",d.DataUrl="dataUrl",d}(z2||{});var __=class extends dT{getPhoto(o){return jn(this,null,function*(){return new Promise((c,r)=>jn(this,null,function*(){if(o.webUseInput||o.source===qd.Photos)this.fileInputExperience(o,c,r);else if(o.source===qd.Prompt){let l=document.querySelector("pwa-action-sheet");l||(l=document.createElement("pwa-action-sheet"),document.body.appendChild(l)),l.header=o.promptLabelHeader||"Photo",l.cancelable=!1,l.options=[{title:o.promptLabelPhoto||"From Photos"},{title:o.promptLabelPicture||"Take Picture"}],l.addEventListener("onSelection",t=>jn(this,null,function*(){t.detail===0?this.fileInputExperience(o,c,r):this.cameraExperience(o,c,r)}))}else this.cameraExperience(o,c,r)}))})}pickImages(o){return jn(this,null,function*(){return new Promise((c,r)=>jn(this,null,function*(){this.multipleFileInputExperience(c,r)}))})}cameraExperience(o,c,r){return jn(this,null,function*(){if(customElements.get("pwa-camera-modal")){let l=document.createElement("pwa-camera-modal");l.facingMode=o.direction===g_.Front?"user":"environment",document.body.appendChild(l);try{yield l.componentOnReady(),l.addEventListener("onPhoto",t=>jn(this,null,function*(){let g=t.detail;g===null?r(new jb("User cancelled photos app")):g instanceof Error?r(g):c(yield this._getCameraPhoto(g,o)),l.dismiss(),document.body.removeChild(l)})),l.present()}catch{this.fileInputExperience(o,c,r)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(o,c,r)})}fileInputExperience(o,c,r){let l=document.querySelector("#_capacitor-camera-input"),t=()=>{var g;(g=l.parentNode)===null||g===void 0||g.removeChild(l)};l||(l=document.createElement("input"),l.id="_capacitor-camera-input",l.type="file",l.hidden=!0,document.body.appendChild(l),l.addEventListener("change",g=>{let C=l.files[0],I="jpeg";if(C.type==="image/png"?I="png":C.type==="image/gif"&&(I="gif"),o.resultType==="dataUrl"||o.resultType==="base64"){let O=new FileReader;O.addEventListener("load",()=>{if(o.resultType==="dataUrl")c({dataUrl:O.result,format:I});else if(o.resultType==="base64"){let z=O.result.split(",")[1];c({base64String:z,format:I})}t()}),O.readAsDataURL(C)}else c({webPath:URL.createObjectURL(C),format:I}),t()}),l.addEventListener("cancel",g=>{r(new jb("User cancelled photos app")),t()})),l.accept="image/*",l.capture=!0,o.source===qd.Photos||o.source===qd.Prompt?l.removeAttribute("capture"):o.direction===g_.Front?l.capture="user":o.direction===g_.Rear&&(l.capture="environment"),l.click()}multipleFileInputExperience(o,c){let r=document.querySelector("#_capacitor-camera-input-multiple"),l=()=>{var t;(t=r.parentNode)===null||t===void 0||t.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input-multiple",r.type="file",r.hidden=!0,r.multiple=!0,document.body.appendChild(r),r.addEventListener("change",t=>{let g=[];for(let C=0;C<r.files.length;C++){let I=r.files[C],O="jpeg";I.type==="image/png"?O="png":I.type==="image/gif"&&(O="gif"),g.push({webPath:URL.createObjectURL(I),format:O})}o({photos:g}),l()}),r.addEventListener("cancel",t=>{c(new jb("User cancelled photos app")),l()})),r.accept="image/*",r.click()}_getCameraPhoto(o,c){return new Promise((r,l)=>{let t=new FileReader,g=o.type.split("/")[1];c.resultType==="uri"?r({webPath:URL.createObjectURL(o),format:g,saved:!1}):(t.readAsDataURL(o),t.onloadend=()=>{let C=t.result;c.resultType==="dataUrl"?r({dataUrl:C,format:g,saved:!1}):r({base64String:C.split(",")[1],format:g,saved:!1})},t.onerror=C=>{l(C)})})}checkPermissions(){return jn(this,null,function*(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}})}requestPermissions(){return jn(this,null,function*(){throw this.unimplemented("Not implemented on web.")})}pickLimitedLibraryPhotos(){return jn(this,null,function*(){throw this.unavailable("Not implemented on web.")})}getLimitedLibraryPhotos(){return jn(this,null,function*(){throw this.unavailable("Not implemented on web.")})}},xee=new __;var TO=Ed("Camera",{web:()=>new __});var DU=["imageElement"];function AU(d,o){if(d&1){let c=Xt();V(0,"div",4),ke(1,"img",5),j(),V(2,"div",6)(3,"button",2),Oe("click",function(){gt(c);let l=lt();return _t(l.submit())}),$(4,"Submit"),j()()}if(d&2){let c=lt();ue(),Fe("src",c.imageUrl,Un)}}var EO=(()=>{let o=class o{constructor(r,l,t,g,C){this.location=r,this.routerParam=l,this.afterOrderService=t,this.router=g,this.orderService=C,this.orderHistoryId="",this.orderId="",this.status=""}ngOnInit(){this.takePicture(),this.getOrderId()}takePicture(){return jn(this,null,function*(){try{let r=yield TO.getPhoto({quality:100,allowEditing:!1,resultType:z2.Uri,source:qd.Camera});this.imageUrl=r.webPath}catch(r){console.error("Error capturing image:",r)}})}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{if(r.get("id")){let t=r.get("id");this.getOrderDetails(t)}}})}getOrderDetails(r){r&&this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.orderId=l._id,this.getingStatus()},error:l=>{console.error(l)}})}getingStatus(){this.afterOrderService.gettingStatus(this.orderId).subscribe({next:r=>{console.log(r),this.status=r.data.status,this.orderHistoryId=r.data._id},error:r=>{console.log(r)}})}submit(){return jn(this,null,function*(){let r=localStorage.getItem("providerId");if(!r||!this.orderId||!this.imageUrl||!this.order?.userId._id){console.error("Required data is missing");return}try{let t=yield(yield fetch(this.imageUrl)).blob(),g=new FormData;g.append("providerId",r),g.append("orderId",this.orderId),g.append("userId",this.order.userId?._id),g.append("image",t,"work-image.jpg"),this.status==="Workstart"&&this.afterOrderService.uploadBeforeWorkImage(g).subscribe(C=>{console.log("Data submitted successfully:",C),this.navToCompleteWork()},C=>{console.error("Error submitting data:",C)}),this.status==="InProgress"&&(g.append("orderHistoryId",this.orderHistoryId||""),this.afterOrderService.uploadAfterWorkImage(g).subscribe({next:C=>{console.log(C),this.completeWork()},error:C=>{console.log(C)}}))}catch(l){console.error("Error fetching and submitting image:",l)}})}completeWork(){let r=this.order.userId?._id,l={orderHistoryId:this.orderHistoryId,providerId:localStorage.getItem("providerId"),userId:r,orderId:this.orderId};console.log(l),this.orderService.completeOrder(l).subscribe({next:t=>{console.log(t),this.router.navigate(["verifyAfterWork",this.orderId])},error:t=>{console.log(t)}})}navTOBack(){this.location.back()}navToCompleteWork(){this.router.navigate(["completeWork",this.orderId])}ngOnDestroy(){this.imageUrl=void 0,this.orderHistoryId="",this.orderId="",this.order=[]}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(Fo),fe(No),fe(Bt),fe(Pr))},o.\u0275cmp=ft({type:o,selectors:[["app-work-image"]],viewQuery:function(l,t){if(l&1&&yi(DU,5),l&2){let g;_i(g=bi())&&(t.imageElement=g.first)}},decls:7,vars:1,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[3,"click"],[1,"sub-container"],[1,"image"],["alt","Captured Image",3,"src"],[1,"button-div"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"span",1),Oe("click",function(){return t.navTOBack()}),$(2," arrow_back "),j(),V(3,"button",2),Oe("click",function(){return t.takePicture()}),$(4,"Take Picture"),j(),V(5,"div",3),Nt(6,AU,5,1),j()()),l&2&&(ue(6),Xn(6,t.imageUrl?6:-1))},styles:[".container[_ngcontent-%COMP%]{width:90%;margin:1rem 5% 0}.sub-container[_ngcontent-%COMP%]{width:100%;height:80%;display:flex;flex-direction:column;gap:1rem;align-items:center;justify-content:center}.image[_ngcontent-%COMP%]{width:260px;height:50opx}.image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.button-div[_ngcontent-%COMP%]{position:fixed;bottom:5%}button[_ngcontent-%COMP%]{background-color:#d16611;color:#fff;padding:1rem 2rem;border:none;border-radius:.4rem}"]});let d=o;return d})();function PU(d,o){if(d&1){let c=Xt();V(0,"div",5)(1,"div",6),ke(2,"img",7),$(3),j(),V(4,"div")(5,"input",8),zr("ngModelChange",function(l){let t=gt(c).$implicit;return Fr(t.checked,l)||(t.checked=l),_t(l)}),Oe("change",function(l){let t=gt(c).$implicit,g=lt();return _t(g.onChange(l,t))}),j()()()}if(d&2){let c=o.$implicit;ue(2),Fe("src",c.image,Un),ue(),Ft(c.name),ue(2),Lr("ngModel",c.checked)}}var DO=(()=>{let o=class o{constructor(r,l,t,g){this.location=r,this.logInService=l,this.router=t,this.userDetailsService=g,this.workSeleceted=[],this.selectedCatId="",this.selectedSubCatId="",this.items=[]}ngOnInit(){this.selectedCatId=this.logInService.workId,this.selectedSubCatId=this.logInService.selectedSubCategories,this.getServices()}getServices(){console.log(this.selectedCatId,this.selectedSubCatId," cat ans sub cat ids"),this.logInService.getServices(this.selectedCatId,this.selectedSubCatId).subscribe(r=>{console.log(r),this.items=r,this.getWork()},r=>{console.log(r)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works,this.autoCheckServices()},r=>{console.log(r)})}autoCheckServices(){this.workSeleceted.forEach(r=>{console.log(`Checking work category: ${r.categoryId.name}`);let l=this.items.filter(t=>t.categoryId._id===r.categoryId._id);l.length>0?(console.log(`Found matching items for category: ${r.categoryId.name}`),l.forEach(t=>{t._id===r.serviceId._id?(t.checked=!0,console.log(`Checked item: ${t.name} with service: ${r.serviceId.name}`)):console.log(`No match found for service: ${r.serviceId.name} in item: ${t.name}`)})):console.log(`No matching items found for categoryId: ${r.categoryId._id}`)})}send(){this.logInService.selectedSubCategories.length>0?(this.logInService.setservices(this.selectedServicesId),this.router.navigate(["aboutWork"])):alert("Please select atleat one sub-category ")}onChange(r,l){let t=r.target;if(console.log(l),t&&t.checked){let C=this.items.indexOf(l);console.log("Item checked:",l),this.logInService.selectedSubCategories.length>0?(this.selectedServicesId=l._id,this.logInService.setservices(this.selectedServicesId),console.log("ready to"),this.router.navigate(["aboutWork"])):alert("Please select atleat one sub-category "),console.log("categoryId",l._)}}navToBack(){this.location.back()}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(Kn),fe(Bt),fe(Jn))},o.\u0275cmp=ft({type:o,selectors:[["app-service"]],decls:10,vars:0,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"tittle"],[1,"serivce"],[1,"service-div"],[1,"names"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"span",1),Oe("click",function(){return t.navToBack()}),$(2," keyboard_backspace "),j(),V(3,"div",2)(4,"span",3),$(5,"Select Services"),j(),ke(6,"br"),V(7,"div",4),xr(8,PU,6,3,"div",5,io),j()()()),l&2&&(ue(8),wr(t.items))},dependencies:[cl,hr,ra],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;left:5%;align-items:center;display:grid;grid-gap:.5rem;text-align:center}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.serivce[_ngcontent-%COMP%]{height:78vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.5rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2rem;height:2rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let d=o;return d})();var OU=[{path:"",component:RE},{path:"language",component:LE},{path:"log-in",component:VE},{path:"location",component:MO},{path:"verify",component:jE},{path:"aboutUser",component:UE},{path:"selectWork",component:HE},{path:"aboutWork",component:GE},{path:"workExperiance",component:qE},{path:"aadharVerify",component:$E},{path:"pancard",component:YE},{path:"bankDetails",component:ZE},{path:"waiting",component:SP},{path:"home",component:QE},{path:"fotter",component:ul},{path:"credits",component:KE},{path:"notification",component:MP},{path:"menu",component:JE},{path:"visitingCard",component:eD},{path:"referAndEarn",component:tD},{path:"awards",component:iD},{path:"help",loadChildren:()=>import("./chunk-PIXWQOOF.js").then(d=>d.HelpModule)},{path:"target",component:lD},{path:"earnings",component:CP},{path:"calender",component:rO},{path:"jobHistory",component:oO},{path:"jobDetails",component:lO},{path:"addCredit",component:aO},{path:"financialDetails",component:sO},{path:"identityVerification",component:cO},{path:"ongoing",component:dO},{path:"demo",component:sy},{path:"induction",component:hO},{path:"started",component:uO},{path:"selectAccount",component:mO},{path:"congrats",component:pO},{path:"packages",component:fO},{path:"training",component:gO},{path:"getOrder/:id",component:_O},{path:"arrived/:id",component:bO},{path:"startWork/:id",component:yO},{path:"work/otp/:id",component:vO},{path:"completeWork/:id",component:xO},{path:"verifyAfterWork/:id",component:wO},{path:"subServices",component:CO},{path:"notFound",component:SO},{path:"manageServices",component:kO},{path:"feedback",component:IO},{path:"workImage/:id",component:EO},{path:"services",component:DO}],AO=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o}),o.\u0275inj=mi({imports:[bw.forRoot(OU),bw]});let d=o;return d})();var Wv=Ed("App",{web:()=>import("./chunk-EGBBIWLX.js").then(d=>new d.AppWeb)});var B2=Ed("Network",{web:()=>import("./chunk-YLNCHRU7.js").then(d=>new d.NetworkWeb)});var PO=(()=>{let o=class o{constructor(r,l,t){this.location=r,this.messagingService=l,this.router=t,this.title="CoolieNo.1_Provider",this.myObject={},this.initializePushNotifications(),this.checkForOrderNavigation(),this.gettingNotification()}ngOnInit(){this.monitorNetworkStatus(),this.registerBackButtonListener()}initializePushNotifications(){ac.addListener("pushNotificationActionPerformed",r=>{let l=r.notification.data?.orderId;alert(l),l&&(this.messagingService.setOrderId(l),this.router.navigate(["getOrder",l]))})}checkForOrderNavigation(){let r=this.messagingService.getOrderId();r&&(this.router.navigate(["getOrder",r]),this.messagingService.clearOrderId())}gettingNotification(){Wv.addListener("appStateChange",({isActive:r})=>{r&&ac.getDeliveredNotifications().then(l=>{l.notifications.forEach(g=>{if(g.title==="New Order"){let C=g.data?.orderId;C&&this.router.navigate(["getOrder",C])}})}).catch(l=>{console.error("Error fetching delivered notifications:",l)})})}registerBackButtonListener(){Wv.addListener("backButton",r=>{r.canGoBack?(this.location.back(),console.log("Back button pressed, navigating back")):(console.log("Back button pressed, exiting app"),Wv.exitApp())})}monitorNetworkStatus(){return jn(this,null,function*(){(yield B2.getStatus()).connected||this.router.navigate(["not-found"]),B2.addListener("networkStatusChange",l=>{l.connected||this.router.navigate(["not-found"])})})}};o.\u0275fac=function(l){return new(l||o)(fe(ii),fe(ap),fe(Bt))},o.\u0275cmp=ft({type:o,selectors:[["app-root"]],decls:1,vars:0,template:function(l,t){l&1&&ke(0,"router-outlet")},dependencies:[Bb]});let d=o;return d})();var RU="@",LU=(()=>{let o=class o{constructor(r,l,t,g,C){this.doc=r,this.delegate=l,this.zone=t,this.animationType=g,this.moduleImpl=C,this._rendererFactoryPromise=null,this.scheduler=Tn(Mb,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-4C2XSBWM.js")).catch(l=>{throw new II(5300,!1)}).then(({\u0275createEngine:l,\u0275AnimationRendererFactory:t})=>{this._engine=l(this.animationType,this.doc,this.scheduler);let g=new t(this.delegate,this._engine,this.zone);return this.delegate=g,g})}createRenderer(r,l){let t=this.delegate.createRenderer(r,l);if(t.\u0275type===0)return t;typeof t.throwOnSyntheticProps=="boolean"&&(t.throwOnSyntheticProps=!1);let g=new N2(t);return l?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(C=>{let I=C.createRenderer(r,l);g.use(I)}).catch(C=>{g.use(t)}),g}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};o.\u0275fac=function(l){Um()},o.\u0275prov=Ut({token:o,factory:o.\u0275fac});let d=o;return d})(),N2=class{constructor(o){this.delegate=o,this.replay=[],this.\u0275type=1}use(o){if(this.delegate=o,this.replay!==null){for(let c of this.replay)c(o);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(o,c){return this.delegate.createElement(o,c)}createComment(o){return this.delegate.createComment(o)}createText(o){return this.delegate.createText(o)}get destroyNode(){return this.delegate.destroyNode}appendChild(o,c){this.delegate.appendChild(o,c)}insertBefore(o,c,r,l){this.delegate.insertBefore(o,c,r,l)}removeChild(o,c,r){this.delegate.removeChild(o,c,r)}selectRootElement(o,c){return this.delegate.selectRootElement(o,c)}parentNode(o){return this.delegate.parentNode(o)}nextSibling(o){return this.delegate.nextSibling(o)}setAttribute(o,c,r,l){this.delegate.setAttribute(o,c,r,l)}removeAttribute(o,c,r){this.delegate.removeAttribute(o,c,r)}addClass(o,c){this.delegate.addClass(o,c)}removeClass(o,c){this.delegate.removeClass(o,c)}setStyle(o,c,r,l){this.delegate.setStyle(o,c,r,l)}removeStyle(o,c,r){this.delegate.removeStyle(o,c,r)}setProperty(o,c,r){this.shouldReplay(c)&&this.replay.push(l=>l.setProperty(o,c,r)),this.delegate.setProperty(o,c,r)}setValue(o,c){this.delegate.setValue(o,c)}listen(o,c,r){return this.shouldReplay(c)&&this.replay.push(l=>l.listen(o,c,r)),this.delegate.listen(o,c,r)}shouldReplay(o){return this.replay!==null&&o.startsWith(RU)}};function OO(d="animations"){return cw("NgAsyncAnimations"),EI([{provide:kb,useFactory:(o,c,r)=>new LU(o,c,r,d),deps:[gn,Pb,Bi]},{provide:co,useValue:d==="noop"?"NoopAnimations":"BrowserAnimations"}])}var FU=_I(yC());var Hv={production:!1,firebase:{apiKey:"AIzaSyAcziwgDyx2SxCSeuGbgFDr9_94R2tpDfk",authDomain:"coolie-9cc38.firebaseapp.com",projectId:"coolie-9cc38",storageBucket:"coolie-9cc38.appspot.com",messagingSenderId:"425618348845",appId:"1:425618348845:android:dfb682ab264340b4f611a4",measurementId:"G-X6752VX6L5",vapidKey:"BFLySRIkI2i4ZrxUJjrsCDeG921cCUs-9zLhyulNlP7HUawhIVFefo8GFfxxgnpTWV9zgiKJ9m9Vx8C39MRgPYA"}};var RO=(()=>{let o=class o{};o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=pi({type:o,bootstrap:[PO]}),o.\u0275inj=mi({providers:[OO(),Wn],imports:[Ob,AO,nT,rT,YI,fT,UT,HT,GT,qT,YT,IE,XT,oD,_E,BT,AE.initializeApp(Hv.firebase),OE,BE]});let d=o;return d})();Hv.production&&void 0;ZI().bootstrapModule(RO).catch(d=>console.error(d));"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js").then(d=>{console.log("Service Worker registered with scope:",d.scope)}).catch(d=>{console.log("Service Worker registration failed:",d)});
