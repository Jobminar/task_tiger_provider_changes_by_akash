import{A as JE,a as YS,b as Py,c as Xp,d as ZS,e as XS,f as Oy,l as XE,m as Ry,n as P1,s as QE,t as O1,v as KE}from"./chunk-VFYDMS3I.js";import{i as iD,j as Hd,k as nD}from"./chunk-VR2CY5TD.js";import{A as YE,B as ZE,C as R1,D as Ts,E as F1,F as ii,G as L1,H as z1,I as QS,a as BE,c as ji,d as NE,e as D1,f as VE,g as A1,h as jE,i as sh,j as ba,k as UE,l as Jo,m as Kr,n as ya,o as WE,p as Sl,q as va,r as g0,s as Ga,t as Il,u as HE,v as GE,w as qE,x as $E,y as _0,z as qa}from"./chunk-5ATCEA3X.js";import{$ as ci,A as kg,Aa as Vn,Ab as Vi,Ac as Ko,B as oc,Ba as zn,Bb as zi,Bc as Io,C as LS,Cb as Bi,Cc as $n,D as Ro,Db as xl,Dc as FE,Eb as X,Ec as LE,F as zS,Fa as ah,Fb as Xt,Fc as zE,G as wE,Ga as _a,Gb as Ni,Gc as M1,H as jc,Ha as ME,Hb as ss,Hc as k1,Ia as vr,Ib as I1,Ic as Gc,J as BS,Jb as DE,Jc as qc,Kb as AE,La as le,Lb as Zo,Lc as E1,Ma as _e,Mb as Xo,Na as m0,Nb as Qo,O as NS,Oa as Em,Ob as Hc,P as CE,Pa as w1,Pb as Ur,Qa as Ey,Qb as Zp,R as VS,Ra as C1,Rb as wi,S as v1,Sa as WS,Sb as T1,T as Ud,Ta as HS,Tb as GS,U as Wd,Ua as gn,Ub as wl,V as jS,Vb as Cl,W as Eg,Wa as p0,Wb as Ag,Xa as Gs,Xb as qS,Y as SE,Ya as os,Yb as PE,_ as ky,a as rc,aa as Ai,ab as qt,bb as ir,c as ga,ca as Hn,cb as ze,db as vl,ea as wt,eb as Ki,f as Or,fa as yr,fb as Wc,fc as OE,g as My,ga as x1,gb as hr,h as gE,ha as IE,hb as Yo,hc as RE,i as _E,ib as Dy,j as bE,ja as kn,jb as no,jc as $S,k as Tm,ka as Et,kb as ro,kc as Oa,l as Mm,la as Pi,lb as U,ma as io,mb as W,n as Ln,na as TE,nb as Oe,nc as Ha,ob as Dm,oc as f0,pb as Am,qb as S1,r as yE,ra as rs,rb as ai,s as d0,sa as St,sb as Pm,t as u0,ta as It,tb as kE,tc as Kn,u as vE,ua as Yp,ub as Ne,va as US,vb as EE,w as b1,wa as h0,wb as it,x as y1,xa as Dg,xb as qs,y as km,ya as Uc,yb as as,yc as yi,z as xE,zb as Ay}from"./chunk-IGDLGV62.js";import{a as B1,b as eD,c as Qp,d as tD}from"./chunk-HJO2KOHN.js";import{a as Dn,b as yl,c as pE,d as fE,f as FS,g as zr}from"./chunk-MON7YFGF.js";var KI=fE((XI,QI)=>{"use strict";(function(c,o){typeof XI=="object"&&typeof QI<"u"?QI.exports=o():typeof define=="function"&&define.amd?define(o):(c=typeof globalThis<"u"?globalThis:c||self,c.mapboxgl=o())})(XI,function(){"use strict";var c,o,d;function r(t,g){if(!c)c=g;else if(!o)o=g;else{var w="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+o+")(sharedChunk); self.onerror = null;",M={};c(M),d=g(M),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}r(["exports"],function(t){var g="3.5.1";let w,M={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(w==null){let i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{w=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):i}catch{w=i}}return w},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!M.API_URL)return null;try{let i=new URL(M.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function F(i){return M.API_URL_REGEX.test(i)}function N(i){return i.indexOf("mapbox:")===0}function Q(i){return M.API_CDN_URL_REGEX.test(i)}function ae(i){return M.API_SPRITE_REGEX.test(i)}function pe(i){return M.API_STYLE_REGEX.test(i)&&!ae(i)}let Te={create:"create",load:"load",fullLoad:"fullLoad"},Pe={mark(i){performance.mark(i)},measure(i,e,n){performance.measure(i,e,n)}};function Re(i){let e=i.name.split("?")[0];return Q(e)&&e.includes("mapbox-gl.js")?"javascript":Q(e)&&e.includes("mapbox-gl.css")?"css":function(n){return M.API_FONTS_REGEX.test(n)}(e)?"fontRange":ae(e)?"sprite":pe(e)?"style":function(n){return M.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function Ke(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Je={},_t={};Object.defineProperty(_t,"__esModule",{value:!0}),_t.setMatrixArrayType=function(i){_t.ARRAY_TYPE=kt=i},_t.toRadian=function(i){return i*ni},_t.equals=function(i,e){return Math.abs(i-e)<=Nt*Math.max(1,Math.abs(i),Math.abs(e))},_t.RANDOM=_t.ARRAY_TYPE=_t.EPSILON=void 0;var Nt=1e-6;_t.EPSILON=Nt;var kt=typeof Float32Array<"u"?Float32Array:Array;_t.ARRAY_TYPE=kt;var Ut=Math.random;_t.RANDOM=Ut;var ni=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var zt={};function pi(i){return pi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pi(i)}Object.defineProperty(zt,"__esModule",{value:!0}),zt.create=function(){var i=new ei.ARRAY_TYPE(4);return ei.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},zt.clone=function(i){var e=new ei.ARRAY_TYPE(4);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e},zt.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},zt.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i},zt.fromValues=function(i,e,n,l){var u=new ei.ARRAY_TYPE(4);return u[0]=i,u[1]=e,u[2]=n,u[3]=l,u},zt.set=function(i,e,n,l,u){return i[0]=e,i[1]=n,i[2]=l,i[3]=u,i},zt.transpose=function(i,e){if(i===e){var n=e[1];i[1]=e[2],i[2]=n}else i[0]=e[0],i[1]=e[2],i[2]=e[1],i[3]=e[3];return i},zt.invert=function(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=n*m-u*l;return p?(i[0]=m*(p=1/p),i[1]=-l*p,i[2]=-u*p,i[3]=n*p,i):null},zt.adjoint=function(i,e){var n=e[0];return i[0]=e[3],i[1]=-e[1],i[2]=-e[2],i[3]=n,i},zt.determinant=function(i){return i[0]*i[3]-i[2]*i[1]},zt.multiply=bn,zt.rotate=function(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=Math.sin(n),v=Math.cos(n);return i[0]=l*v+m*b,i[1]=u*v+p*b,i[2]=l*-b+m*v,i[3]=u*-b+p*v,i},zt.scale=function(i,e,n){var l=e[1],u=e[2],m=e[3],p=n[0],b=n[1];return i[0]=e[0]*p,i[1]=l*p,i[2]=u*b,i[3]=m*b,i},zt.fromRotation=function(i,e){var n=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=n,i[2]=-n,i[3]=l,i},zt.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=e[1],i},zt.str=function(i){return"mat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},zt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},zt.LDU=function(i,e,n,l){return i[2]=l[2]/l[0],n[0]=l[0],n[1]=l[1],n[3]=l[3]-i[2]*n[1],[i,e,n]},zt.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i},zt.subtract=lo,zt.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},zt.equals=function(i,e){var n=i[0],l=i[1],u=i[2],m=i[3],p=e[0],b=e[1],v=e[2],S=e[3];return Math.abs(n-p)<=ei.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(l-b)<=ei.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(u-v)<=ei.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(m-S)<=ei.EPSILON*Math.max(1,Math.abs(m),Math.abs(S))},zt.multiplyScalar=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},zt.multiplyScalarAndAdd=function(i,e,n,l){return i[0]=e[0]+n[0]*l,i[1]=e[1]+n[1]*l,i[2]=e[2]+n[2]*l,i[3]=e[3]+n[3]*l,i},zt.sub=zt.mul=void 0;var ei=function(i,e){if(i&&i.__esModule)return i;if(i===null||pi(i)!=="object"&&typeof i!="function")return{default:i};var n=Ji(void 0);if(n&&n.has(i))return n.get(i);var l={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=u?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(l,m,p):l[m]=i[m]}return l.default=i,n&&n.set(i,l),l}(_t);function Ji(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ji=function(l){return l?n:e})(i)}function bn(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=n[0],v=n[1],S=n[2],k=n[3];return i[0]=l*b+m*v,i[1]=u*b+p*v,i[2]=l*S+m*k,i[3]=u*S+p*k,i}function lo(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i}zt.mul=bn,zt.sub=lo;var Hi={};function Mn(i){return Mn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mn(i)}Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.create=function(){var i=new hn.ARRAY_TYPE(6);return hn.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[4]=0,i[5]=0),i[0]=1,i[3]=1,i},Hi.clone=function(i){var e=new hn.ARRAY_TYPE(6);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e},Hi.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i},Hi.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i},Hi.fromValues=function(i,e,n,l,u,m){var p=new hn.ARRAY_TYPE(6);return p[0]=i,p[1]=e,p[2]=n,p[3]=l,p[4]=u,p[5]=m,p},Hi.set=function(i,e,n,l,u,m,p){return i[0]=e,i[1]=n,i[2]=l,i[3]=u,i[4]=m,i[5]=p,i},Hi.invert=function(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=e[4],b=e[5],v=n*m-l*u;return v?(i[0]=m*(v=1/v),i[1]=-l*v,i[2]=-u*v,i[3]=n*v,i[4]=(u*b-m*p)*v,i[5]=(l*p-n*b)*v,i):null},Hi.determinant=function(i){return i[0]*i[3]-i[1]*i[2]},Hi.multiply=yo,Hi.rotate=function(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=e[4],v=e[5],S=Math.sin(n),k=Math.cos(n);return i[0]=l*k+m*S,i[1]=u*k+p*S,i[2]=l*-S+m*k,i[3]=u*-S+p*k,i[4]=b,i[5]=v,i},Hi.scale=function(i,e,n){var l=e[1],u=e[2],m=e[3],p=e[4],b=e[5],v=n[0],S=n[1];return i[0]=e[0]*v,i[1]=l*v,i[2]=u*S,i[3]=m*S,i[4]=p,i[5]=b,i},Hi.translate=function(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=e[4],v=e[5],S=n[0],k=n[1];return i[0]=l,i[1]=u,i[2]=m,i[3]=p,i[4]=l*S+m*k+b,i[5]=u*S+p*k+v,i},Hi.fromRotation=function(i,e){var n=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=n,i[2]=-n,i[3]=l,i[4]=0,i[5]=0,i},Hi.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=e[1],i[4]=0,i[5]=0,i},Hi.fromTranslation=function(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=e[0],i[5]=e[1],i},Hi.str=function(i){return"mat2d("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+")"},Hi.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],1)},Hi.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i},Hi.subtract=Zn,Hi.multiplyScalar=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i},Hi.multiplyScalarAndAdd=function(i,e,n,l){return i[0]=e[0]+n[0]*l,i[1]=e[1]+n[1]*l,i[2]=e[2]+n[2]*l,i[3]=e[3]+n[3]*l,i[4]=e[4]+n[4]*l,i[5]=e[5]+n[5]*l,i},Hi.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]},Hi.equals=function(i,e){var n=i[0],l=i[1],u=i[2],m=i[3],p=i[4],b=i[5],v=e[0],S=e[1],k=e[2],D=e[3],A=e[4],L=e[5];return Math.abs(n-v)<=hn.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(l-S)<=hn.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(u-k)<=hn.EPSILON*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(m-D)<=hn.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(p-A)<=hn.EPSILON*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(b-L)<=hn.EPSILON*Math.max(1,Math.abs(b),Math.abs(L))},Hi.sub=Hi.mul=void 0;var hn=function(i,e){if(i&&i.__esModule)return i;if(i===null||Mn(i)!=="object"&&typeof i!="function")return{default:i};var n=Fr(void 0);if(n&&n.has(i))return n.get(i);var l={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=u?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(l,m,p):l[m]=i[m]}return l.default=i,n&&n.set(i,l),l}(_t);function Fr(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Fr=function(l){return l?n:e})(i)}function yo(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=e[4],v=e[5],S=n[0],k=n[1],D=n[2],A=n[3],L=n[4],z=n[5];return i[0]=l*S+m*k,i[1]=u*S+p*k,i[2]=l*D+m*A,i[3]=u*D+p*A,i[4]=l*L+m*z+b,i[5]=u*L+p*z+v,i}function Zn(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i[4]=e[4]-n[4],i[5]=e[5]-n[5],i}Hi.mul=yo,Hi.sub=Zn;var en={};function As(i){return As=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},As(i)}Object.defineProperty(en,"__esModule",{value:!0}),en.create=function(){var i=new Gr.ARRAY_TYPE(9);return Gr.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},en.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},en.clone=function(i){var e=new Gr.ARRAY_TYPE(9);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e},en.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i},en.fromValues=function(i,e,n,l,u,m,p,b,v){var S=new Gr.ARRAY_TYPE(9);return S[0]=i,S[1]=e,S[2]=n,S[3]=l,S[4]=u,S[5]=m,S[6]=p,S[7]=b,S[8]=v,S},en.set=function(i,e,n,l,u,m,p,b,v,S){return i[0]=e,i[1]=n,i[2]=l,i[3]=u,i[4]=m,i[5]=p,i[6]=b,i[7]=v,i[8]=S,i},en.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},en.transpose=function(i,e){if(i===e){var n=e[1],l=e[2],u=e[5];i[1]=e[3],i[2]=e[6],i[3]=n,i[5]=e[7],i[6]=l,i[7]=u}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},en.invert=function(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=e[4],b=e[5],v=e[6],S=e[7],k=e[8],D=k*p-b*S,A=-k*m+b*v,L=S*m-p*v,z=n*D+l*A+u*L;return z?(i[0]=D*(z=1/z),i[1]=(-k*l+u*S)*z,i[2]=(b*l-u*p)*z,i[3]=A*z,i[4]=(k*n-u*v)*z,i[5]=(-b*n+u*m)*z,i[6]=L*z,i[7]=(-S*n+l*v)*z,i[8]=(p*n-l*m)*z,i):null},en.adjoint=function(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=e[4],b=e[5],v=e[6],S=e[7],k=e[8];return i[0]=p*k-b*S,i[1]=u*S-l*k,i[2]=l*b-u*p,i[3]=b*v-m*k,i[4]=n*k-u*v,i[5]=u*m-n*b,i[6]=m*S-p*v,i[7]=l*v-n*S,i[8]=n*p-l*m,i},en.determinant=function(i){var e=i[3],n=i[4],l=i[5],u=i[6],m=i[7],p=i[8];return i[0]*(p*n-l*m)+i[1]*(-p*e+l*u)+i[2]*(m*e-n*u)},en.multiply=Ca,en.translate=function(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=e[4],v=e[5],S=e[6],k=e[7],D=e[8],A=n[0],L=n[1];return i[0]=l,i[1]=u,i[2]=m,i[3]=p,i[4]=b,i[5]=v,i[6]=A*l+L*p+S,i[7]=A*u+L*b+k,i[8]=A*m+L*v+D,i},en.rotate=function(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=e[4],v=e[5],S=e[6],k=e[7],D=e[8],A=Math.sin(n),L=Math.cos(n);return i[0]=L*l+A*p,i[1]=L*u+A*b,i[2]=L*m+A*v,i[3]=L*p-A*l,i[4]=L*b-A*u,i[5]=L*v-A*m,i[6]=S,i[7]=k,i[8]=D,i},en.scale=function(i,e,n){var l=n[0],u=n[1];return i[0]=l*e[0],i[1]=l*e[1],i[2]=l*e[2],i[3]=u*e[3],i[4]=u*e[4],i[5]=u*e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i},en.fromTranslation=function(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=e[0],i[7]=e[1],i[8]=1,i},en.fromRotation=function(i,e){var n=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=n,i[2]=0,i[3]=-n,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},en.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=e[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},en.fromMat2d=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=0,i[3]=e[2],i[4]=e[3],i[5]=0,i[6]=e[4],i[7]=e[5],i[8]=1,i},en.fromQuat=function(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=n+n,b=l+l,v=u+u,S=n*p,k=l*p,D=l*b,A=u*p,L=u*b,z=u*v,V=m*p,H=m*b,Y=m*v;return i[0]=1-D-z,i[3]=k-Y,i[6]=A+H,i[1]=k+Y,i[4]=1-S-z,i[7]=L-V,i[2]=A-H,i[5]=L+V,i[8]=1-S-D,i},en.normalFromMat4=function(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=e[4],b=e[5],v=e[6],S=e[7],k=e[8],D=e[9],A=e[10],L=e[11],z=e[12],V=e[13],H=e[14],Y=e[15],ne=n*b-l*p,re=n*v-u*p,oe=n*S-m*p,xe=l*v-u*b,be=l*S-m*b,ke=u*S-m*v,Ae=k*V-D*z,je=k*H-A*z,Qe=k*Y-L*z,$e=D*H-A*V,st=D*Y-L*V,vt=A*Y-L*H,at=ne*vt-re*st+oe*$e+xe*Qe-be*je+ke*Ae;return at?(i[0]=(b*vt-v*st+S*$e)*(at=1/at),i[1]=(v*Qe-p*vt-S*je)*at,i[2]=(p*st-b*Qe+S*Ae)*at,i[3]=(u*st-l*vt-m*$e)*at,i[4]=(n*vt-u*Qe+m*je)*at,i[5]=(l*Qe-n*st-m*Ae)*at,i[6]=(V*ke-H*be+Y*xe)*at,i[7]=(H*oe-z*ke-Y*re)*at,i[8]=(z*be-V*oe+Y*ne)*at,i):null},en.projection=function(i,e,n){return i[0]=2/e,i[1]=0,i[2]=0,i[3]=0,i[4]=-2/n,i[5]=0,i[6]=-1,i[7]=1,i[8]=1,i},en.str=function(i){return"mat3("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+")"},en.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},en.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i[6]=e[6]+n[6],i[7]=e[7]+n[7],i[8]=e[8]+n[8],i},en.subtract=Ys,en.multiplyScalar=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*n,i},en.multiplyScalarAndAdd=function(i,e,n,l){return i[0]=e[0]+n[0]*l,i[1]=e[1]+n[1]*l,i[2]=e[2]+n[2]*l,i[3]=e[3]+n[3]*l,i[4]=e[4]+n[4]*l,i[5]=e[5]+n[5]*l,i[6]=e[6]+n[6]*l,i[7]=e[7]+n[7]*l,i[8]=e[8]+n[8]*l,i},en.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]},en.equals=function(i,e){var n=i[0],l=i[1],u=i[2],m=i[3],p=i[4],b=i[5],v=i[6],S=i[7],k=i[8],D=e[0],A=e[1],L=e[2],z=e[3],V=e[4],H=e[5],Y=e[6],ne=e[7],re=e[8];return Math.abs(n-D)<=Gr.EPSILON*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(l-A)<=Gr.EPSILON*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(u-L)<=Gr.EPSILON*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(m-z)<=Gr.EPSILON*Math.max(1,Math.abs(m),Math.abs(z))&&Math.abs(p-V)<=Gr.EPSILON*Math.max(1,Math.abs(p),Math.abs(V))&&Math.abs(b-H)<=Gr.EPSILON*Math.max(1,Math.abs(b),Math.abs(H))&&Math.abs(v-Y)<=Gr.EPSILON*Math.max(1,Math.abs(v),Math.abs(Y))&&Math.abs(S-ne)<=Gr.EPSILON*Math.max(1,Math.abs(S),Math.abs(ne))&&Math.abs(k-re)<=Gr.EPSILON*Math.max(1,Math.abs(k),Math.abs(re))},en.sub=en.mul=void 0;var Gr=function(i,e){if(i&&i.__esModule)return i;if(i===null||As(i)!=="object"&&typeof i!="function")return{default:i};var n=wa(void 0);if(n&&n.has(i))return n.get(i);var l={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=u?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(l,m,p):l[m]=i[m]}return l.default=i,n&&n.set(i,l),l}(_t);function wa(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(wa=function(l){return l?n:e})(i)}function Ca(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=e[4],v=e[5],S=e[6],k=e[7],D=e[8],A=n[0],L=n[1],z=n[2],V=n[3],H=n[4],Y=n[5],ne=n[6],re=n[7],oe=n[8];return i[0]=A*l+L*p+z*S,i[1]=A*u+L*b+z*k,i[2]=A*m+L*v+z*D,i[3]=V*l+H*p+Y*S,i[4]=V*u+H*b+Y*k,i[5]=V*m+H*v+Y*D,i[6]=ne*l+re*p+oe*S,i[7]=ne*u+re*b+oe*k,i[8]=ne*m+re*v+oe*D,i}function Ys(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i[4]=e[4]-n[4],i[5]=e[5]-n[5],i[6]=e[6]-n[6],i[7]=e[7]-n[7],i[8]=e[8]-n[8],i}en.mul=Ca,en.sub=Ys;var si={};function Zs(i){return Zs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zs(i)}Object.defineProperty(si,"__esModule",{value:!0}),si.create=function(){var i=new gr.ARRAY_TYPE(16);return gr.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},si.clone=function(i){var e=new gr.ARRAY_TYPE(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},si.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},si.fromValues=function(i,e,n,l,u,m,p,b,v,S,k,D,A,L,z,V){var H=new gr.ARRAY_TYPE(16);return H[0]=i,H[1]=e,H[2]=n,H[3]=l,H[4]=u,H[5]=m,H[6]=p,H[7]=b,H[8]=v,H[9]=S,H[10]=k,H[11]=D,H[12]=A,H[13]=L,H[14]=z,H[15]=V,H},si.set=function(i,e,n,l,u,m,p,b,v,S,k,D,A,L,z,V,H){return i[0]=e,i[1]=n,i[2]=l,i[3]=u,i[4]=m,i[5]=p,i[6]=b,i[7]=v,i[8]=S,i[9]=k,i[10]=D,i[11]=A,i[12]=L,i[13]=z,i[14]=V,i[15]=H,i},si.identity=id,si.transpose=function(i,e){if(i===e){var n=e[1],l=e[2],u=e[3],m=e[6],p=e[7],b=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=n,i[6]=e[9],i[7]=e[13],i[8]=l,i[9]=m,i[11]=e[14],i[12]=u,i[13]=p,i[14]=b}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i},si.invert=function(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=e[4],b=e[5],v=e[6],S=e[7],k=e[8],D=e[9],A=e[10],L=e[11],z=e[12],V=e[13],H=e[14],Y=e[15],ne=n*b-l*p,re=n*v-u*p,oe=n*S-m*p,xe=l*v-u*b,be=l*S-m*b,ke=u*S-m*v,Ae=k*V-D*z,je=k*H-A*z,Qe=k*Y-L*z,$e=D*H-A*V,st=D*Y-L*V,vt=A*Y-L*H,at=ne*vt-re*st+oe*$e+xe*Qe-be*je+ke*Ae;return at?(i[0]=(b*vt-v*st+S*$e)*(at=1/at),i[1]=(u*st-l*vt-m*$e)*at,i[2]=(V*ke-H*be+Y*xe)*at,i[3]=(A*be-D*ke-L*xe)*at,i[4]=(v*Qe-p*vt-S*je)*at,i[5]=(n*vt-u*Qe+m*je)*at,i[6]=(H*oe-z*ke-Y*re)*at,i[7]=(k*ke-A*oe+L*re)*at,i[8]=(p*st-b*Qe+S*Ae)*at,i[9]=(l*Qe-n*st-m*Ae)*at,i[10]=(z*be-V*oe+Y*ne)*at,i[11]=(D*oe-k*be-L*ne)*at,i[12]=(b*je-p*$e-v*Ae)*at,i[13]=(n*$e-l*je+u*Ae)*at,i[14]=(V*re-z*xe-H*ne)*at,i[15]=(k*xe-D*re+A*ne)*at,i):null},si.adjoint=function(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=e[4],b=e[5],v=e[6],S=e[7],k=e[8],D=e[9],A=e[10],L=e[11],z=e[12],V=e[13],H=e[14],Y=e[15];return i[0]=b*(A*Y-L*H)-D*(v*Y-S*H)+V*(v*L-S*A),i[1]=-(l*(A*Y-L*H)-D*(u*Y-m*H)+V*(u*L-m*A)),i[2]=l*(v*Y-S*H)-b*(u*Y-m*H)+V*(u*S-m*v),i[3]=-(l*(v*L-S*A)-b*(u*L-m*A)+D*(u*S-m*v)),i[4]=-(p*(A*Y-L*H)-k*(v*Y-S*H)+z*(v*L-S*A)),i[5]=n*(A*Y-L*H)-k*(u*Y-m*H)+z*(u*L-m*A),i[6]=-(n*(v*Y-S*H)-p*(u*Y-m*H)+z*(u*S-m*v)),i[7]=n*(v*L-S*A)-p*(u*L-m*A)+k*(u*S-m*v),i[8]=p*(D*Y-L*V)-k*(b*Y-S*V)+z*(b*L-S*D),i[9]=-(n*(D*Y-L*V)-k*(l*Y-m*V)+z*(l*L-m*D)),i[10]=n*(b*Y-S*V)-p*(l*Y-m*V)+z*(l*S-m*b),i[11]=-(n*(b*L-S*D)-p*(l*L-m*D)+k*(l*S-m*b)),i[12]=-(p*(D*H-A*V)-k*(b*H-v*V)+z*(b*A-v*D)),i[13]=n*(D*H-A*V)-k*(l*H-u*V)+z*(l*A-u*D),i[14]=-(n*(b*H-v*V)-p*(l*H-u*V)+z*(l*v-u*b)),i[15]=n*(b*A-v*D)-p*(l*A-u*D)+k*(l*v-u*b),i},si.determinant=function(i){var e=i[0],n=i[1],l=i[2],u=i[3],m=i[4],p=i[5],b=i[6],v=i[7],S=i[8],k=i[9],D=i[10],A=i[11],L=i[12],z=i[13],V=i[14],H=i[15];return(e*p-n*m)*(D*H-A*V)-(e*b-l*m)*(k*H-A*z)+(e*v-u*m)*(k*V-D*z)+(n*b-l*p)*(S*H-A*L)-(n*v-u*p)*(S*V-D*L)+(l*v-u*b)*(S*z-k*L)},si.multiply=_h,si.translate=function(i,e,n){var l,u,m,p,b,v,S,k,D,A,L,z,V=n[0],H=n[1],Y=n[2];return e===i?(i[12]=e[0]*V+e[4]*H+e[8]*Y+e[12],i[13]=e[1]*V+e[5]*H+e[9]*Y+e[13],i[14]=e[2]*V+e[6]*H+e[10]*Y+e[14],i[15]=e[3]*V+e[7]*H+e[11]*Y+e[15]):(u=e[1],m=e[2],p=e[3],b=e[4],v=e[5],S=e[6],k=e[7],D=e[8],A=e[9],L=e[10],z=e[11],i[0]=l=e[0],i[1]=u,i[2]=m,i[3]=p,i[4]=b,i[5]=v,i[6]=S,i[7]=k,i[8]=D,i[9]=A,i[10]=L,i[11]=z,i[12]=l*V+b*H+D*Y+e[12],i[13]=u*V+v*H+A*Y+e[13],i[14]=m*V+S*H+L*Y+e[14],i[15]=p*V+k*H+z*Y+e[15]),i},si.scale=function(i,e,n){var l=n[0],u=n[1],m=n[2];return i[0]=e[0]*l,i[1]=e[1]*l,i[2]=e[2]*l,i[3]=e[3]*l,i[4]=e[4]*u,i[5]=e[5]*u,i[6]=e[6]*u,i[7]=e[7]*u,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},si.rotate=function(i,e,n,l){var u,m,p,b,v,S,k,D,A,L,z,V,H,Y,ne,re,oe,xe,be,ke,Ae,je,Qe,$e,st=l[0],vt=l[1],at=l[2],ht=Math.hypot(st,vt,at);return ht<gr.EPSILON?null:(st*=ht=1/ht,vt*=ht,at*=ht,u=Math.sin(n),m=Math.cos(n),v=e[1],S=e[2],k=e[3],A=e[5],L=e[6],z=e[7],H=e[9],Y=e[10],ne=e[11],re=st*st*(p=1-m)+m,be=st*vt*p-at*u,ke=vt*vt*p+m,Ae=at*vt*p+st*u,je=st*at*p+vt*u,Qe=vt*at*p-st*u,$e=at*at*p+m,i[0]=(b=e[0])*re+(D=e[4])*(oe=vt*st*p+at*u)+(V=e[8])*(xe=at*st*p-vt*u),i[1]=v*re+A*oe+H*xe,i[2]=S*re+L*oe+Y*xe,i[3]=k*re+z*oe+ne*xe,i[4]=b*be+D*ke+V*Ae,i[5]=v*be+A*ke+H*Ae,i[6]=S*be+L*ke+Y*Ae,i[7]=k*be+z*ke+ne*Ae,i[8]=b*je+D*Qe+V*$e,i[9]=v*je+A*Qe+H*$e,i[10]=S*je+L*Qe+Y*$e,i[11]=k*je+z*Qe+ne*$e,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)},si.rotateX=function(i,e,n){var l=Math.sin(n),u=Math.cos(n),m=e[4],p=e[5],b=e[6],v=e[7],S=e[8],k=e[9],D=e[10],A=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*u+S*l,i[5]=p*u+k*l,i[6]=b*u+D*l,i[7]=v*u+A*l,i[8]=S*u-m*l,i[9]=k*u-p*l,i[10]=D*u-b*l,i[11]=A*u-v*l,i},si.rotateY=function(i,e,n){var l=Math.sin(n),u=Math.cos(n),m=e[0],p=e[1],b=e[2],v=e[3],S=e[8],k=e[9],D=e[10],A=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*u-S*l,i[1]=p*u-k*l,i[2]=b*u-D*l,i[3]=v*u-A*l,i[8]=m*l+S*u,i[9]=p*l+k*u,i[10]=b*l+D*u,i[11]=v*l+A*u,i},si.rotateZ=function(i,e,n){var l=Math.sin(n),u=Math.cos(n),m=e[0],p=e[1],b=e[2],v=e[3],S=e[4],k=e[5],D=e[6],A=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*u+S*l,i[1]=p*u+k*l,i[2]=b*u+D*l,i[3]=v*u+A*l,i[4]=S*u-m*l,i[5]=k*u-p*l,i[6]=D*u-b*l,i[7]=A*u-v*l,i},si.fromTranslation=function(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},si.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},si.fromRotation=function(i,e,n){var l,u,m,p=n[0],b=n[1],v=n[2],S=Math.hypot(p,b,v);return S<gr.EPSILON?null:(p*=S=1/S,b*=S,v*=S,l=Math.sin(e),u=Math.cos(e),i[0]=p*p*(m=1-u)+u,i[1]=b*p*m+v*l,i[2]=v*p*m-b*l,i[3]=0,i[4]=p*b*m-v*l,i[5]=b*b*m+u,i[6]=v*b*m+p*l,i[7]=0,i[8]=p*v*m+b*l,i[9]=b*v*m-p*l,i[10]=v*v*m+u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)},si.fromXRotation=function(i,e){var n=Math.sin(e),l=Math.cos(e);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=l,i[6]=n,i[7]=0,i[8]=0,i[9]=-n,i[10]=l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},si.fromYRotation=function(i,e){var n=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=0,i[2]=-n,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=n,i[9]=0,i[10]=l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},si.fromZRotation=function(i,e){var n=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=n,i[2]=0,i[3]=0,i[4]=-n,i[5]=l,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},si.fromRotationTranslation=Sa,si.fromQuat2=function(i,e){var n=new gr.ARRAY_TYPE(3),l=-e[0],u=-e[1],m=-e[2],p=e[3],b=e[4],v=e[5],S=e[6],k=e[7],D=l*l+u*u+m*m+p*p;return D>0?(n[0]=2*(b*p+k*l+v*m-S*u)/D,n[1]=2*(v*p+k*u+S*l-b*m)/D,n[2]=2*(S*p+k*m+b*u-v*l)/D):(n[0]=2*(b*p+k*l+v*m-S*u),n[1]=2*(v*p+k*u+S*l-b*m),n[2]=2*(S*p+k*m+b*u-v*l)),Sa(i,e,n),i},si.getTranslation=function(i,e){return i[0]=e[12],i[1]=e[13],i[2]=e[14],i},si.getScaling=Xs,si.getRotation=function(i,e){var n=new gr.ARRAY_TYPE(3);Xs(n,e);var l=1/n[0],u=1/n[1],m=1/n[2],p=e[0]*l,b=e[1]*u,v=e[2]*m,S=e[4]*l,k=e[5]*u,D=e[6]*m,A=e[8]*l,L=e[9]*u,z=e[10]*m,V=p+k+z,H=0;return V>0?(H=2*Math.sqrt(V+1),i[3]=.25*H,i[0]=(D-L)/H,i[1]=(A-v)/H,i[2]=(b-S)/H):p>k&&p>z?(H=2*Math.sqrt(1+p-k-z),i[3]=(D-L)/H,i[0]=.25*H,i[1]=(b+S)/H,i[2]=(A+v)/H):k>z?(H=2*Math.sqrt(1+k-p-z),i[3]=(A-v)/H,i[0]=(b+S)/H,i[1]=.25*H,i[2]=(D+L)/H):(H=2*Math.sqrt(1+z-p-k),i[3]=(b-S)/H,i[0]=(A+v)/H,i[1]=(D+L)/H,i[2]=.25*H),i},si.fromRotationTranslationScale=function(i,e,n,l){var u=e[0],m=e[1],p=e[2],b=e[3],v=u+u,S=m+m,k=p+p,D=u*v,A=u*S,L=u*k,z=m*S,V=m*k,H=p*k,Y=b*v,ne=b*S,re=b*k,oe=l[0],xe=l[1],be=l[2];return i[0]=(1-(z+H))*oe,i[1]=(A+re)*oe,i[2]=(L-ne)*oe,i[3]=0,i[4]=(A-re)*xe,i[5]=(1-(D+H))*xe,i[6]=(V+Y)*xe,i[7]=0,i[8]=(L+ne)*be,i[9]=(V-Y)*be,i[10]=(1-(D+z))*be,i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i},si.fromRotationTranslationScaleOrigin=function(i,e,n,l,u){var m=e[0],p=e[1],b=e[2],v=e[3],S=m+m,k=p+p,D=b+b,A=m*S,L=m*k,z=m*D,V=p*k,H=p*D,Y=b*D,ne=v*S,re=v*k,oe=v*D,xe=l[0],be=l[1],ke=l[2],Ae=u[0],je=u[1],Qe=u[2],$e=(1-(V+Y))*xe,st=(L+oe)*xe,vt=(z-re)*xe,at=(L-oe)*be,ht=(1-(A+Y))*be,tt=(H+ne)*be,mt=(z+re)*ke,Ct=(H-ne)*ke,ft=(1-(A+V))*ke;return i[0]=$e,i[1]=st,i[2]=vt,i[3]=0,i[4]=at,i[5]=ht,i[6]=tt,i[7]=0,i[8]=mt,i[9]=Ct,i[10]=ft,i[11]=0,i[12]=n[0]+Ae-($e*Ae+at*je+mt*Qe),i[13]=n[1]+je-(st*Ae+ht*je+Ct*Qe),i[14]=n[2]+Qe-(vt*Ae+tt*je+ft*Qe),i[15]=1,i},si.fromQuat=function(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=n+n,b=l+l,v=u+u,S=n*p,k=l*p,D=l*b,A=u*p,L=u*b,z=u*v,V=m*p,H=m*b,Y=m*v;return i[0]=1-D-z,i[1]=k+Y,i[2]=A-H,i[3]=0,i[4]=k-Y,i[5]=1-S-z,i[6]=L+V,i[7]=0,i[8]=A+H,i[9]=L-V,i[10]=1-S-D,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},si.frustum=function(i,e,n,l,u,m,p){var b=1/(n-e),v=1/(u-l),S=1/(m-p);return i[0]=2*m*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*m*v,i[6]=0,i[7]=0,i[8]=(n+e)*b,i[9]=(u+l)*v,i[10]=(p+m)*S,i[11]=-1,i[12]=0,i[13]=0,i[14]=p*m*2*S,i[15]=0,i},si.perspectiveNO=Ps,si.perspectiveZO=function(i,e,n,l,u){var m,p=1/Math.tan(e/2);return i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=u*(m=1/(l-u)),i[14]=u*l*m):(i[10]=-1,i[14]=-l),i},si.perspectiveFromFieldOfView=function(i,e,n,l){var u=Math.tan(e.upDegrees*Math.PI/180),m=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),b=Math.tan(e.rightDegrees*Math.PI/180),v=2/(p+b),S=2/(u+m);return i[0]=v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=S,i[6]=0,i[7]=0,i[8]=-(p-b)*v*.5,i[9]=(u-m)*S*.5,i[10]=l/(n-l),i[11]=-1,i[12]=0,i[13]=0,i[14]=l*n/(n-l),i[15]=0,i},si.orthoNO=To,si.orthoZO=function(i,e,n,l,u,m,p){var b=1/(e-n),v=1/(l-u),S=1/(m-p);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=S,i[11]=0,i[12]=(e+n)*b,i[13]=(u+l)*v,i[14]=m*S,i[15]=1,i},si.lookAt=function(i,e,n,l){var u,m,p,b,v,S,k,D,A,L,z=e[0],V=e[1],H=e[2],Y=l[0],ne=l[1],re=l[2],oe=n[0],xe=n[1],be=n[2];return Math.abs(z-oe)<gr.EPSILON&&Math.abs(V-xe)<gr.EPSILON&&Math.abs(H-be)<gr.EPSILON?id(i):(k=z-oe,D=V-xe,A=H-be,u=ne*(A*=L=1/Math.hypot(k,D,A))-re*(D*=L),m=re*(k*=L)-Y*A,p=Y*D-ne*k,(L=Math.hypot(u,m,p))?(u*=L=1/L,m*=L,p*=L):(u=0,m=0,p=0),b=D*p-A*m,v=A*u-k*p,S=k*m-D*u,(L=Math.hypot(b,v,S))?(b*=L=1/L,v*=L,S*=L):(b=0,v=0,S=0),i[0]=u,i[1]=b,i[2]=k,i[3]=0,i[4]=m,i[5]=v,i[6]=D,i[7]=0,i[8]=p,i[9]=S,i[10]=A,i[11]=0,i[12]=-(u*z+m*V+p*H),i[13]=-(b*z+v*V+S*H),i[14]=-(k*z+D*V+A*H),i[15]=1,i)},si.targetTo=function(i,e,n,l){var u=e[0],m=e[1],p=e[2],b=l[0],v=l[1],S=l[2],k=u-n[0],D=m-n[1],A=p-n[2],L=k*k+D*D+A*A;L>0&&(k*=L=1/Math.sqrt(L),D*=L,A*=L);var z=v*A-S*D,V=S*k-b*A,H=b*D-v*k;return(L=z*z+V*V+H*H)>0&&(z*=L=1/Math.sqrt(L),V*=L,H*=L),i[0]=z,i[1]=V,i[2]=H,i[3]=0,i[4]=D*H-A*V,i[5]=A*z-k*H,i[6]=k*V-D*z,i[7]=0,i[8]=k,i[9]=D,i[10]=A,i[11]=0,i[12]=u,i[13]=m,i[14]=p,i[15]=1,i},si.str=function(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"},si.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])},si.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i[6]=e[6]+n[6],i[7]=e[7]+n[7],i[8]=e[8]+n[8],i[9]=e[9]+n[9],i[10]=e[10]+n[10],i[11]=e[11]+n[11],i[12]=e[12]+n[12],i[13]=e[13]+n[13],i[14]=e[14]+n[14],i[15]=e[15]+n[15],i},si.subtract=Kd,si.multiplyScalar=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*n,i[9]=e[9]*n,i[10]=e[10]*n,i[11]=e[11]*n,i[12]=e[12]*n,i[13]=e[13]*n,i[14]=e[14]*n,i[15]=e[15]*n,i},si.multiplyScalarAndAdd=function(i,e,n,l){return i[0]=e[0]+n[0]*l,i[1]=e[1]+n[1]*l,i[2]=e[2]+n[2]*l,i[3]=e[3]+n[3]*l,i[4]=e[4]+n[4]*l,i[5]=e[5]+n[5]*l,i[6]=e[6]+n[6]*l,i[7]=e[7]+n[7]*l,i[8]=e[8]+n[8]*l,i[9]=e[9]+n[9]*l,i[10]=e[10]+n[10]*l,i[11]=e[11]+n[11]*l,i[12]=e[12]+n[12]*l,i[13]=e[13]+n[13]*l,i[14]=e[14]+n[14]*l,i[15]=e[15]+n[15]*l,i},si.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},si.equals=function(i,e){var n=i[0],l=i[1],u=i[2],m=i[3],p=i[4],b=i[5],v=i[6],S=i[7],k=i[8],D=i[9],A=i[10],L=i[11],z=i[12],V=i[13],H=i[14],Y=i[15],ne=e[0],re=e[1],oe=e[2],xe=e[3],be=e[4],ke=e[5],Ae=e[6],je=e[7],Qe=e[8],$e=e[9],st=e[10],vt=e[11],at=e[12],ht=e[13],tt=e[14],mt=e[15];return Math.abs(n-ne)<=gr.EPSILON*Math.max(1,Math.abs(n),Math.abs(ne))&&Math.abs(l-re)<=gr.EPSILON*Math.max(1,Math.abs(l),Math.abs(re))&&Math.abs(u-oe)<=gr.EPSILON*Math.max(1,Math.abs(u),Math.abs(oe))&&Math.abs(m-xe)<=gr.EPSILON*Math.max(1,Math.abs(m),Math.abs(xe))&&Math.abs(p-be)<=gr.EPSILON*Math.max(1,Math.abs(p),Math.abs(be))&&Math.abs(b-ke)<=gr.EPSILON*Math.max(1,Math.abs(b),Math.abs(ke))&&Math.abs(v-Ae)<=gr.EPSILON*Math.max(1,Math.abs(v),Math.abs(Ae))&&Math.abs(S-je)<=gr.EPSILON*Math.max(1,Math.abs(S),Math.abs(je))&&Math.abs(k-Qe)<=gr.EPSILON*Math.max(1,Math.abs(k),Math.abs(Qe))&&Math.abs(D-$e)<=gr.EPSILON*Math.max(1,Math.abs(D),Math.abs($e))&&Math.abs(A-st)<=gr.EPSILON*Math.max(1,Math.abs(A),Math.abs(st))&&Math.abs(L-vt)<=gr.EPSILON*Math.max(1,Math.abs(L),Math.abs(vt))&&Math.abs(z-at)<=gr.EPSILON*Math.max(1,Math.abs(z),Math.abs(at))&&Math.abs(V-ht)<=gr.EPSILON*Math.max(1,Math.abs(V),Math.abs(ht))&&Math.abs(H-tt)<=gr.EPSILON*Math.max(1,Math.abs(H),Math.abs(tt))&&Math.abs(Y-mt)<=gr.EPSILON*Math.max(1,Math.abs(Y),Math.abs(mt))},si.sub=si.mul=si.ortho=si.perspective=void 0;var gr=function(i,e){if(i&&i.__esModule)return i;if(i===null||Zs(i)!=="object"&&typeof i!="function")return{default:i};var n=td(void 0);if(n&&n.has(i))return n.get(i);var l={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=u?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(l,m,p):l[m]=i[m]}return l.default=i,n&&n.set(i,l),l}(_t);function td(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(td=function(l){return l?n:e})(i)}function id(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function _h(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=e[4],v=e[5],S=e[6],k=e[7],D=e[8],A=e[9],L=e[10],z=e[11],V=e[12],H=e[13],Y=e[14],ne=e[15],re=n[0],oe=n[1],xe=n[2],be=n[3];return i[0]=re*l+oe*b+xe*D+be*V,i[1]=re*u+oe*v+xe*A+be*H,i[2]=re*m+oe*S+xe*L+be*Y,i[3]=re*p+oe*k+xe*z+be*ne,i[4]=(re=n[4])*l+(oe=n[5])*b+(xe=n[6])*D+(be=n[7])*V,i[5]=re*u+oe*v+xe*A+be*H,i[6]=re*m+oe*S+xe*L+be*Y,i[7]=re*p+oe*k+xe*z+be*ne,i[8]=(re=n[8])*l+(oe=n[9])*b+(xe=n[10])*D+(be=n[11])*V,i[9]=re*u+oe*v+xe*A+be*H,i[10]=re*m+oe*S+xe*L+be*Y,i[11]=re*p+oe*k+xe*z+be*ne,i[12]=(re=n[12])*l+(oe=n[13])*b+(xe=n[14])*D+(be=n[15])*V,i[13]=re*u+oe*v+xe*A+be*H,i[14]=re*m+oe*S+xe*L+be*Y,i[15]=re*p+oe*k+xe*z+be*ne,i}function Sa(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=l+l,v=u+u,S=m+m,k=l*b,D=l*v,A=l*S,L=u*v,z=u*S,V=m*S,H=p*b,Y=p*v,ne=p*S;return i[0]=1-(L+V),i[1]=D+ne,i[2]=A-Y,i[3]=0,i[4]=D-ne,i[5]=1-(k+V),i[6]=z+H,i[7]=0,i[8]=A+Y,i[9]=z-H,i[10]=1-(k+L),i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i}function Xs(i,e){var n=e[4],l=e[5],u=e[6],m=e[8],p=e[9],b=e[10];return i[0]=Math.hypot(e[0],e[1],e[2]),i[1]=Math.hypot(n,l,u),i[2]=Math.hypot(m,p,b),i}function Ps(i,e,n,l,u){var m,p=1/Math.tan(e/2);return i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+l)*(m=1/(l-u)),i[14]=2*u*l*m):(i[10]=-1,i[14]=-2*l),i}function To(i,e,n,l,u,m,p){var b=1/(e-n),v=1/(l-u),S=1/(m-p);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*S,i[11]=0,i[12]=(e+n)*b,i[13]=(u+l)*v,i[14]=(p+m)*S,i[15]=1,i}function Kd(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i[4]=e[4]-n[4],i[5]=e[5]-n[5],i[6]=e[6]-n[6],i[7]=e[7]-n[7],i[8]=e[8]-n[8],i[9]=e[9]-n[9],i[10]=e[10]-n[10],i[11]=e[11]-n[11],i[12]=e[12]-n[12],i[13]=e[13]-n[13],i[14]=e[14]-n[14],i[15]=e[15]-n[15],i}si.perspective=Ps,si.ortho=To,si.mul=_h,si.sub=Kd;var vi={},fi={};function da(i){return da=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},da(i)}Object.defineProperty(fi,"__esModule",{value:!0}),fi.create=Jd,fi.clone=function(i){var e=new zo.ARRAY_TYPE(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},fi.length=Ks,fi.fromValues=function(i,e,n){var l=new zo.ARRAY_TYPE(3);return l[0]=i,l[1]=e,l[2]=n,l},fi.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i},fi.set=function(i,e,n,l){return i[0]=e,i[1]=n,i[2]=l,i},fi.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i},fi.subtract=bh,fi.multiply=ds,fi.divide=us,fi.ceil=function(i,e){return i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i[2]=Math.ceil(e[2]),i},fi.floor=function(i,e){return i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i[2]=Math.floor(e[2]),i},fi.min=function(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i},fi.max=function(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i},fi.round=function(i,e){return i[0]=Math.round(e[0]),i[1]=Math.round(e[1]),i[2]=Math.round(e[2]),i},fi.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i},fi.scaleAndAdd=function(i,e,n,l){return i[0]=e[0]+n[0]*l,i[1]=e[1]+n[1]*l,i[2]=e[2]+n[2]*l,i},fi.distance=sc,fi.squaredDistance=nd,fi.squaredLength=lc,fi.negate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i},fi.inverse=function(i,e){return i[0]=1/e[0],i[1]=1/e[1],i[2]=1/e[2],i},fi.normalize=function(i,e){var n=e[0],l=e[1],u=e[2],m=n*n+l*l+u*u;return m>0&&(m=1/Math.sqrt(m)),i[0]=e[0]*m,i[1]=e[1]*m,i[2]=e[2]*m,i},fi.dot=cc,fi.cross=function(i,e,n){var l=e[0],u=e[1],m=e[2],p=n[0],b=n[1],v=n[2];return i[0]=u*v-m*b,i[1]=m*p-l*v,i[2]=l*b-u*p,i},fi.lerp=function(i,e,n,l){var u=e[0],m=e[1],p=e[2];return i[0]=u+l*(n[0]-u),i[1]=m+l*(n[1]-m),i[2]=p+l*(n[2]-p),i},fi.hermite=function(i,e,n,l,u,m){var p=m*m,b=p*(2*m-3)+1,v=p*(m-2)+m,S=p*(m-1),k=p*(3-2*m);return i[0]=e[0]*b+n[0]*v+l[0]*S+u[0]*k,i[1]=e[1]*b+n[1]*v+l[1]*S+u[1]*k,i[2]=e[2]*b+n[2]*v+l[2]*S+u[2]*k,i},fi.bezier=function(i,e,n,l,u,m){var p=1-m,b=p*p,v=m*m,S=b*p,k=3*m*b,D=3*v*p,A=v*m;return i[0]=e[0]*S+n[0]*k+l[0]*D+u[0]*A,i[1]=e[1]*S+n[1]*k+l[1]*D+u[1]*A,i[2]=e[2]*S+n[2]*k+l[2]*D+u[2]*A,i},fi.random=function(i,e){e=e||1;var n=2*zo.RANDOM()*Math.PI,l=2*zo.RANDOM()-1,u=Math.sqrt(1-l*l)*e;return i[0]=Math.cos(n)*u,i[1]=Math.sin(n)*u,i[2]=l*e,i},fi.transformMat4=function(i,e,n){var l=e[0],u=e[1],m=e[2],p=n[3]*l+n[7]*u+n[11]*m+n[15];return i[0]=(n[0]*l+n[4]*u+n[8]*m+n[12])/(p=p||1),i[1]=(n[1]*l+n[5]*u+n[9]*m+n[13])/p,i[2]=(n[2]*l+n[6]*u+n[10]*m+n[14])/p,i},fi.transformMat3=function(i,e,n){var l=e[0],u=e[1],m=e[2];return i[0]=l*n[0]+u*n[3]+m*n[6],i[1]=l*n[1]+u*n[4]+m*n[7],i[2]=l*n[2]+u*n[5]+m*n[8],i},fi.transformQuat=function(i,e,n){var l=n[0],u=n[1],m=n[2],p=e[0],b=e[1],v=e[2],S=u*v-m*b,k=m*p-l*v,D=l*b-u*p,A=u*D-m*k,L=m*S-l*D,z=l*k-u*S,V=2*n[3];return k*=V,D*=V,L*=2,z*=2,i[0]=p+(S*=V)+(A*=2),i[1]=b+k+L,i[2]=v+D+z,i},fi.rotateX=function(i,e,n,l){var u=[],m=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],m[0]=u[0],m[1]=u[1]*Math.cos(l)-u[2]*Math.sin(l),m[2]=u[1]*Math.sin(l)+u[2]*Math.cos(l),i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},fi.rotateY=function(i,e,n,l){var u=[],m=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],m[0]=u[2]*Math.sin(l)+u[0]*Math.cos(l),m[1]=u[1],m[2]=u[2]*Math.cos(l)-u[0]*Math.sin(l),i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},fi.rotateZ=function(i,e,n,l){var u=[],m=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],m[0]=u[0]*Math.cos(l)-u[1]*Math.sin(l),m[1]=u[0]*Math.sin(l)+u[1]*Math.cos(l),m[2]=u[2],i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},fi.angle=function(i,e){var n=i[0],l=i[1],u=i[2],m=e[0],p=e[1],b=e[2],v=Math.sqrt(n*n+l*l+u*u)*Math.sqrt(m*m+p*p+b*b),S=v&&cc(i,e)/v;return Math.acos(Math.min(Math.max(S,-1),1))},fi.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i},fi.str=function(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"},fi.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},fi.equals=function(i,e){var n=i[0],l=i[1],u=i[2],m=e[0],p=e[1],b=e[2];return Math.abs(n-m)<=zo.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(l-p)<=zo.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))&&Math.abs(u-b)<=zo.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))},fi.forEach=fi.sqrLen=fi.len=fi.sqrDist=fi.dist=fi.div=fi.mul=fi.sub=void 0;var zo=function(i,e){if(i&&i.__esModule)return i;if(i===null||da(i)!=="object"&&typeof i!="function")return{default:i};var n=Qs(void 0);if(n&&n.has(i))return n.get(i);var l={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=u?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(l,m,p):l[m]=i[m]}return l.default=i,n&&n.set(i,l),l}(_t);function Qs(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Qs=function(l){return l?n:e})(i)}function Jd(){var i=new zo.ARRAY_TYPE(3);return zo.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Ks(i){return Math.hypot(i[0],i[1],i[2])}function bh(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i}function ds(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i}function us(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i}function sc(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])}function nd(i,e){var n=e[0]-i[0],l=e[1]-i[1],u=e[2]-i[2];return n*n+l*l+u*u}function lc(i){var e=i[0],n=i[1],l=i[2];return e*e+n*n+l*l}function cc(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}fi.sub=bh,fi.mul=ds,fi.div=us,fi.dist=sc,fi.sqrDist=nd,fi.len=Ks,fi.sqrLen=lc;var Fa,eu=(Fa=Jd(),function(i,e,n,l,u,m){var p,b;for(e||(e=3),n||(n=0),b=l?Math.min(l*e+n,i.length):i.length,p=n;p<b;p+=e)Fa[0]=i[p],Fa[1]=i[p+1],Fa[2]=i[p+2],u(Fa,Fa,m),i[p]=Fa[0],i[p+1]=Fa[1],i[p+2]=Fa[2];return i});fi.forEach=eu;var _i={};function rd(i){return rd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rd(i)}Object.defineProperty(_i,"__esModule",{value:!0}),_i.create=od,_i.clone=function(i){var e=new wr.ARRAY_TYPE(4);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e},_i.fromValues=function(i,e,n,l){var u=new wr.ARRAY_TYPE(4);return u[0]=i,u[1]=e,u[2]=n,u[3]=l,u},_i.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},_i.set=function(i,e,n,l,u){return i[0]=e,i[1]=n,i[2]=l,i[3]=u,i},_i.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i},_i.subtract=Js,_i.multiply=Os,_i.divide=iu,_i.ceil=function(i,e){return i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i[2]=Math.ceil(e[2]),i[3]=Math.ceil(e[3]),i},_i.floor=function(i,e){return i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i[2]=Math.floor(e[2]),i[3]=Math.floor(e[3]),i},_i.min=function(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i[3]=Math.min(e[3],n[3]),i},_i.max=function(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i[3]=Math.max(e[3],n[3]),i},_i.round=function(i,e){return i[0]=Math.round(e[0]),i[1]=Math.round(e[1]),i[2]=Math.round(e[2]),i[3]=Math.round(e[3]),i},_i.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},_i.scaleAndAdd=function(i,e,n,l){return i[0]=e[0]+n[0]*l,i[1]=e[1]+n[1]*l,i[2]=e[2]+n[2]*l,i[3]=e[3]+n[3]*l,i},_i.distance=dc,_i.squaredDistance=uc,_i.length=nu,_i.squaredLength=ru,_i.negate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=-e[3],i},_i.inverse=function(i,e){return i[0]=1/e[0],i[1]=1/e[1],i[2]=1/e[2],i[3]=1/e[3],i},_i.normalize=function(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=n*n+l*l+u*u+m*m;return p>0&&(p=1/Math.sqrt(p)),i[0]=n*p,i[1]=l*p,i[2]=u*p,i[3]=m*p,i},_i.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},_i.cross=function(i,e,n,l){var u=n[0]*l[1]-n[1]*l[0],m=n[0]*l[2]-n[2]*l[0],p=n[0]*l[3]-n[3]*l[0],b=n[1]*l[2]-n[2]*l[1],v=n[1]*l[3]-n[3]*l[1],S=n[2]*l[3]-n[3]*l[2],k=e[0],D=e[1],A=e[2],L=e[3];return i[0]=D*S-A*v+L*b,i[1]=-k*S+A*p-L*m,i[2]=k*v-D*p+L*u,i[3]=-k*b+D*m-A*u,i},_i.lerp=function(i,e,n,l){var u=e[0],m=e[1],p=e[2],b=e[3];return i[0]=u+l*(n[0]-u),i[1]=m+l*(n[1]-m),i[2]=p+l*(n[2]-p),i[3]=b+l*(n[3]-b),i},_i.random=function(i,e){var n,l,u,m,p,b;e=e||1;do p=(n=2*wr.RANDOM()-1)*n+(l=2*wr.RANDOM()-1)*l;while(p>=1);do b=(u=2*wr.RANDOM()-1)*u+(m=2*wr.RANDOM()-1)*m;while(b>=1);var v=Math.sqrt((1-p)/b);return i[0]=e*n,i[1]=e*l,i[2]=e*u*v,i[3]=e*m*v,i},_i.transformMat4=function(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3];return i[0]=n[0]*l+n[4]*u+n[8]*m+n[12]*p,i[1]=n[1]*l+n[5]*u+n[9]*m+n[13]*p,i[2]=n[2]*l+n[6]*u+n[10]*m+n[14]*p,i[3]=n[3]*l+n[7]*u+n[11]*m+n[15]*p,i},_i.transformQuat=function(i,e,n){var l=e[0],u=e[1],m=e[2],p=n[0],b=n[1],v=n[2],S=n[3],k=S*l+b*m-v*u,D=S*u+v*l-p*m,A=S*m+p*u-b*l,L=-p*l-b*u-v*m;return i[0]=k*S+L*-p+D*-v-A*-b,i[1]=D*S+L*-b+A*-p-k*-v,i[2]=A*S+L*-v+k*-b-D*-p,i[3]=e[3],i},_i.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i},_i.str=function(i){return"vec4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},_i.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},_i.equals=function(i,e){var n=i[0],l=i[1],u=i[2],m=i[3],p=e[0],b=e[1],v=e[2],S=e[3];return Math.abs(n-p)<=wr.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(l-b)<=wr.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(u-v)<=wr.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(m-S)<=wr.EPSILON*Math.max(1,Math.abs(m),Math.abs(S))},_i.forEach=_i.sqrLen=_i.len=_i.sqrDist=_i.dist=_i.div=_i.mul=_i.sub=void 0;var wr=function(i,e){if(i&&i.__esModule)return i;if(i===null||rd(i)!=="object"&&typeof i!="function")return{default:i};var n=tu(void 0);if(n&&n.has(i))return n.get(i);var l={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=u?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(l,m,p):l[m]=i[m]}return l.default=i,n&&n.set(i,l),l}(_t);function tu(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(tu=function(l){return l?n:e})(i)}function od(){var i=new wr.ARRAY_TYPE(4);return wr.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function Js(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i}function Os(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i}function iu(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i[3]=e[3]/n[3],i}function dc(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2],e[3]-i[3])}function uc(i,e){var n=e[0]-i[0],l=e[1]-i[1],u=e[2]-i[2],m=e[3]-i[3];return n*n+l*l+u*u+m*m}function nu(i){return Math.hypot(i[0],i[1],i[2],i[3])}function ru(i){var e=i[0],n=i[1],l=i[2],u=i[3];return e*e+n*n+l*l+u*u}_i.sub=Js,_i.mul=Os,_i.div=iu,_i.dist=dc,_i.sqrDist=uc,_i.len=nu,_i.sqrLen=ru;var yh=function(){var i=od();return function(e,n,l,u,m,p){var b,v;for(n||(n=4),l||(l=0),v=u?Math.min(u*n+l,e.length):e.length,b=l;b<v;b+=n)i[0]=e[b],i[1]=e[b+1],i[2]=e[b+2],i[3]=e[b+3],m(i,i,p),e[b]=i[0],e[b+1]=i[1],e[b+2]=i[2],e[b+3]=i[3];return e}}();function ou(i){return ou=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ou(i)}_i.forEach=yh,Object.defineProperty(vi,"__esModule",{value:!0}),vi.create=su,vi.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i},vi.setAxisAngle=vh,vi.getAxisAngle=function(i,e){var n=2*Math.acos(e[3]),l=Math.sin(n/2);return l>hs.EPSILON?(i[0]=e[0]/l,i[1]=e[1]/l,i[2]=e[2]/l):(i[0]=1,i[1]=0,i[2]=0),n},vi.getAngle=function(i,e){var n=Me(i,e);return Math.acos(2*n*n-1)},vi.multiply=lu,vi.rotateX=function(i,e,n){n*=.5;var l=e[0],u=e[1],m=e[2],p=e[3],b=Math.sin(n),v=Math.cos(n);return i[0]=l*v+p*b,i[1]=u*v+m*b,i[2]=m*v-u*b,i[3]=p*v-l*b,i},vi.rotateY=function(i,e,n){n*=.5;var l=e[0],u=e[1],m=e[2],p=e[3],b=Math.sin(n),v=Math.cos(n);return i[0]=l*v-m*b,i[1]=u*v+p*b,i[2]=m*v+l*b,i[3]=p*v-u*b,i},vi.rotateZ=function(i,e,n){n*=.5;var l=e[0],u=e[1],m=e[2],p=e[3],b=Math.sin(n),v=Math.cos(n);return i[0]=l*v+u*b,i[1]=u*v-l*b,i[2]=m*v+p*b,i[3]=p*v-m*b,i},vi.calculateW=function(i,e){var n=e[0],l=e[1],u=e[2];return i[0]=n,i[1]=l,i[2]=u,i[3]=Math.sqrt(Math.abs(1-n*n-l*l-u*u)),i},vi.exp=De,vi.ln=Z,vi.pow=function(i,e,n){return Z(i,e),Ie(i,i,n),De(i,i),i},vi.slerp=ie,vi.random=function(i){var e=hs.RANDOM(),n=hs.RANDOM(),l=hs.RANDOM(),u=Math.sqrt(1-e),m=Math.sqrt(e);return i[0]=u*Math.sin(2*Math.PI*n),i[1]=u*Math.cos(2*Math.PI*n),i[2]=m*Math.sin(2*Math.PI*l),i[3]=m*Math.cos(2*Math.PI*l),i},vi.invert=function(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=n*n+l*l+u*u+m*m,b=p?1/p:0;return i[0]=-n*b,i[1]=-l*b,i[2]=-u*b,i[3]=m*b,i},vi.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},vi.fromMat3=ge,vi.fromEuler=function(i,e,n,l){var u=.5*Math.PI/180;e*=u,n*=u,l*=u;var m=Math.sin(e),p=Math.cos(e),b=Math.sin(n),v=Math.cos(n),S=Math.sin(l),k=Math.cos(l);return i[0]=m*v*k-p*b*S,i[1]=p*b*k+m*v*S,i[2]=p*v*S-m*b*k,i[3]=p*v*k+m*b*S,i},vi.str=function(i){return"quat("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},vi.setAxes=vi.sqlerp=vi.rotationTo=vi.equals=vi.exactEquals=vi.normalize=vi.sqrLen=vi.squaredLength=vi.len=vi.length=vi.lerp=vi.dot=vi.scale=vi.mul=vi.add=vi.set=vi.copy=vi.fromValues=vi.clone=void 0;var hs=ad(_t),hc=ad(en),La=ad(fi),Bo=ad(_i);function au(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(au=function(l){return l?n:e})(i)}function ad(i,e){if(i&&i.__esModule)return i;if(i===null||ou(i)!=="object"&&typeof i!="function")return{default:i};var n=au(e);if(n&&n.has(i))return n.get(i);var l={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=u?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(l,m,p):l[m]=i[m]}return l.default=i,n&&n.set(i,l),l}function su(){var i=new hs.ARRAY_TYPE(4);return hs.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function vh(i,e,n){n*=.5;var l=Math.sin(n);return i[0]=l*e[0],i[1]=l*e[1],i[2]=l*e[2],i[3]=Math.cos(n),i}function lu(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=n[0],v=n[1],S=n[2],k=n[3];return i[0]=l*k+p*b+u*S-m*v,i[1]=u*k+p*v+m*b-l*S,i[2]=m*k+p*S+l*v-u*b,i[3]=p*k-l*b-u*v-m*S,i}function De(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=Math.sqrt(n*n+l*l+u*u),b=Math.exp(m),v=p>0?b*Math.sin(p)/p:0;return i[0]=n*v,i[1]=l*v,i[2]=u*v,i[3]=b*Math.cos(p),i}function Z(i,e){var n=e[0],l=e[1],u=e[2],m=e[3],p=Math.sqrt(n*n+l*l+u*u),b=p>0?Math.atan2(p,m)/p:0;return i[0]=n*b,i[1]=l*b,i[2]=u*b,i[3]=.5*Math.log(n*n+l*l+u*u+m*m),i}function ie(i,e,n,l){var u,m,p,b,v,S=e[0],k=e[1],D=e[2],A=e[3],L=n[0],z=n[1],V=n[2],H=n[3];return(m=S*L+k*z+D*V+A*H)<0&&(m=-m,L=-L,z=-z,V=-V,H=-H),1-m>hs.EPSILON?(u=Math.acos(m),p=Math.sin(u),b=Math.sin((1-l)*u)/p,v=Math.sin(l*u)/p):(b=1-l,v=l),i[0]=b*S+v*L,i[1]=b*k+v*z,i[2]=b*D+v*V,i[3]=b*A+v*H,i}function ge(i,e){var n,l=e[0]+e[4]+e[8];if(l>0)n=Math.sqrt(l+1),i[3]=.5*n,i[0]=(e[5]-e[7])*(n=.5/n),i[1]=(e[6]-e[2])*n,i[2]=(e[1]-e[3])*n;else{var u=0;e[4]>e[0]&&(u=1),e[8]>e[3*u+u]&&(u=2);var m=(u+1)%3,p=(u+2)%3;n=Math.sqrt(e[3*u+u]-e[3*m+m]-e[3*p+p]+1),i[u]=.5*n,i[3]=(e[3*m+p]-e[3*p+m])*(n=.5/n),i[m]=(e[3*m+u]+e[3*u+m])*n,i[p]=(e[3*p+u]+e[3*u+p])*n}return i}vi.clone=Bo.clone,vi.fromValues=Bo.fromValues,vi.copy=Bo.copy,vi.set=Bo.set,vi.add=Bo.add,vi.mul=lu;var Ie=Bo.scale;vi.scale=Ie;var Me=Bo.dot;vi.dot=Me,vi.lerp=Bo.lerp;var Ve=Bo.length;vi.length=Ve,vi.len=Ve;var Ye=Bo.squaredLength;vi.squaredLength=Ye,vi.sqrLen=Ye;var Fe=Bo.normalize;vi.normalize=Fe,vi.exactEquals=Bo.exactEquals,vi.equals=Bo.equals;var Xe,Dt,yt,Kt=(Xe=La.create(),Dt=La.fromValues(1,0,0),yt=La.fromValues(0,1,0),function(i,e,n){var l=La.dot(e,n);return l<-.999999?(La.cross(Xe,Dt,e),La.len(Xe)<1e-6&&La.cross(Xe,yt,e),La.normalize(Xe,Xe),vh(i,Xe,Math.PI),i):l>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(La.cross(Xe,e,n),i[0]=Xe[0],i[1]=Xe[1],i[2]=Xe[2],i[3]=1+l,Fe(i,i))});vi.rotationTo=Kt;var ui,Oi,Ui=(ui=su(),Oi=su(),function(i,e,n,l,u,m){return ie(ui,e,u,m),ie(Oi,n,l,m),ie(i,ui,Oi,2*m*(1-m)),i});vi.sqlerp=Ui;var Si,Qi=(Si=hc.create(),function(i,e,n,l){return Si[0]=n[0],Si[3]=n[1],Si[6]=n[2],Si[1]=l[0],Si[4]=l[1],Si[7]=l[2],Si[2]=-e[0],Si[5]=-e[1],Si[8]=-e[2],Fe(i,ge(i,Si))});vi.setAxes=Qi;var Zt={};function lr(i){return lr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lr(i)}Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=function(){var i=new Pn.ARRAY_TYPE(8);return Pn.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0),i[3]=1,i},Zt.clone=function(i){var e=new Pn.ARRAY_TYPE(8);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e},Zt.fromValues=function(i,e,n,l,u,m,p,b){var v=new Pn.ARRAY_TYPE(8);return v[0]=i,v[1]=e,v[2]=n,v[3]=l,v[4]=u,v[5]=m,v[6]=p,v[7]=b,v},Zt.fromRotationTranslationValues=function(i,e,n,l,u,m,p){var b=new Pn.ARRAY_TYPE(8);b[0]=i,b[1]=e,b[2]=n,b[3]=l;var v=.5*u,S=.5*m,k=.5*p;return b[4]=v*l+S*n-k*e,b[5]=S*l+k*i-v*n,b[6]=k*l+v*e-S*i,b[7]=-v*i-S*e-k*n,b},Zt.fromRotationTranslation=No,Zt.fromTranslation=function(i,e){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=.5*e[0],i[5]=.5*e[1],i[6]=.5*e[2],i[7]=0,i},Zt.fromRotation=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},Zt.fromMat4=function(i,e){var n=an.create();qr.getRotation(n,e);var l=new Pn.ARRAY_TYPE(3);return qr.getTranslation(l,e),No(i,n,l),i},Zt.copy=Vo,Zt.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},Zt.set=function(i,e,n,l,u,m,p,b,v){return i[0]=e,i[1]=n,i[2]=l,i[3]=u,i[4]=m,i[5]=p,i[6]=b,i[7]=v,i},Zt.getDual=function(i,e){return i[0]=e[4],i[1]=e[5],i[2]=e[6],i[3]=e[7],i},Zt.setDual=function(i,e){return i[4]=e[0],i[5]=e[1],i[6]=e[2],i[7]=e[3],i},Zt.getTranslation=function(i,e){var n=e[4],l=e[5],u=e[6],m=e[7],p=-e[0],b=-e[1],v=-e[2],S=e[3];return i[0]=2*(n*S+m*p+l*v-u*b),i[1]=2*(l*S+m*b+u*p-n*v),i[2]=2*(u*S+m*v+n*b-l*p),i},Zt.translate=function(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=.5*n[0],v=.5*n[1],S=.5*n[2],k=e[4],D=e[5],A=e[6],L=e[7];return i[0]=l,i[1]=u,i[2]=m,i[3]=p,i[4]=p*b+u*S-m*v+k,i[5]=p*v+m*b-l*S+D,i[6]=p*S+l*v-u*b+A,i[7]=-l*b-u*v-m*S+L,i},Zt.rotateX=function(i,e,n){var l=-e[0],u=-e[1],m=-e[2],p=e[3],b=e[4],v=e[5],S=e[6],k=e[7],D=b*p+k*l+v*m-S*u,A=v*p+k*u+S*l-b*m,L=S*p+k*m+b*u-v*l,z=k*p-b*l-v*u-S*m;return an.rotateX(i,e,n),i[4]=D*(p=i[3])+z*(l=i[0])+A*(m=i[2])-L*(u=i[1]),i[5]=A*p+z*u+L*l-D*m,i[6]=L*p+z*m+D*u-A*l,i[7]=z*p-D*l-A*u-L*m,i},Zt.rotateY=function(i,e,n){var l=-e[0],u=-e[1],m=-e[2],p=e[3],b=e[4],v=e[5],S=e[6],k=e[7],D=b*p+k*l+v*m-S*u,A=v*p+k*u+S*l-b*m,L=S*p+k*m+b*u-v*l,z=k*p-b*l-v*u-S*m;return an.rotateY(i,e,n),i[4]=D*(p=i[3])+z*(l=i[0])+A*(m=i[2])-L*(u=i[1]),i[5]=A*p+z*u+L*l-D*m,i[6]=L*p+z*m+D*u-A*l,i[7]=z*p-D*l-A*u-L*m,i},Zt.rotateZ=function(i,e,n){var l=-e[0],u=-e[1],m=-e[2],p=e[3],b=e[4],v=e[5],S=e[6],k=e[7],D=b*p+k*l+v*m-S*u,A=v*p+k*u+S*l-b*m,L=S*p+k*m+b*u-v*l,z=k*p-b*l-v*u-S*m;return an.rotateZ(i,e,n),i[4]=D*(p=i[3])+z*(l=i[0])+A*(m=i[2])-L*(u=i[1]),i[5]=A*p+z*u+L*l-D*m,i[6]=L*p+z*m+D*u-A*l,i[7]=z*p-D*l-A*u-L*m,i},Zt.rotateByQuatAppend=function(i,e,n){var l=n[0],u=n[1],m=n[2],p=n[3],b=e[0],v=e[1],S=e[2],k=e[3];return i[0]=b*p+k*l+v*m-S*u,i[1]=v*p+k*u+S*l-b*m,i[2]=S*p+k*m+b*u-v*l,i[3]=k*p-b*l-v*u-S*m,i[4]=(b=e[4])*p+(k=e[7])*l+(v=e[5])*m-(S=e[6])*u,i[5]=v*p+k*u+S*l-b*m,i[6]=S*p+k*m+b*u-v*l,i[7]=k*p-b*l-v*u-S*m,i},Zt.rotateByQuatPrepend=function(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=n[0],v=n[1],S=n[2],k=n[3];return i[0]=l*k+p*b+u*S-m*v,i[1]=u*k+p*v+m*b-l*S,i[2]=m*k+p*S+l*v-u*b,i[3]=p*k-l*b-u*v-m*S,i[4]=l*(k=n[7])+p*(b=n[4])+u*(S=n[6])-m*(v=n[5]),i[5]=u*k+p*v+m*b-l*S,i[6]=m*k+p*S+l*v-u*b,i[7]=p*k-l*b-u*v-m*S,i},Zt.rotateAroundAxis=function(i,e,n,l){if(Math.abs(l)<Pn.EPSILON)return Vo(i,e);var u=Math.hypot(n[0],n[1],n[2]);l*=.5;var m=Math.sin(l),p=m*n[0]/u,b=m*n[1]/u,v=m*n[2]/u,S=Math.cos(l),k=e[0],D=e[1],A=e[2],L=e[3];i[0]=k*S+L*p+D*v-A*b,i[1]=D*S+L*b+A*p-k*v,i[2]=A*S+L*v+k*b-D*p,i[3]=L*S-k*p-D*b-A*v;var z=e[4],V=e[5],H=e[6],Y=e[7];return i[4]=z*S+Y*p+V*v-H*b,i[5]=V*S+Y*b+H*p-z*v,i[6]=H*S+Y*v+z*b-V*p,i[7]=Y*S-z*p-V*b-H*v,i},Zt.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i[6]=e[6]+n[6],i[7]=e[7]+n[7],i},Zt.multiply=Rl,Zt.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i},Zt.lerp=function(i,e,n,l){var u=1-l;return _f(e,n)<0&&(l=-l),i[0]=e[0]*u+n[0]*l,i[1]=e[1]*u+n[1]*l,i[2]=e[2]*u+n[2]*l,i[3]=e[3]*u+n[3]*l,i[4]=e[4]*u+n[4]*l,i[5]=e[5]*u+n[5]*l,i[6]=e[6]*u+n[6]*l,i[7]=e[7]*u+n[7]*l,i},Zt.invert=function(i,e){var n=mc(e);return i[0]=-e[0]/n,i[1]=-e[1]/n,i[2]=-e[2]/n,i[3]=e[3]/n,i[4]=-e[4]/n,i[5]=-e[5]/n,i[6]=-e[6]/n,i[7]=e[7]/n,i},Zt.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i[4]=-e[4],i[5]=-e[5],i[6]=-e[6],i[7]=e[7],i},Zt.normalize=function(i,e){var n=mc(e);if(n>0){n=Math.sqrt(n);var l=e[0]/n,u=e[1]/n,m=e[2]/n,p=e[3]/n,b=e[4],v=e[5],S=e[6],k=e[7],D=l*b+u*v+m*S+p*k;i[0]=l,i[1]=u,i[2]=m,i[3]=p,i[4]=(b-l*D)/n,i[5]=(v-u*D)/n,i[6]=(S-m*D)/n,i[7]=(k-p*D)/n}return i},Zt.str=function(i){return"quat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+")"},Zt.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]},Zt.equals=function(i,e){var n=i[0],l=i[1],u=i[2],m=i[3],p=i[4],b=i[5],v=i[6],S=i[7],k=e[0],D=e[1],A=e[2],L=e[3],z=e[4],V=e[5],H=e[6],Y=e[7];return Math.abs(n-k)<=Pn.EPSILON*Math.max(1,Math.abs(n),Math.abs(k))&&Math.abs(l-D)<=Pn.EPSILON*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(u-A)<=Pn.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(m-L)<=Pn.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(p-z)<=Pn.EPSILON*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(b-V)<=Pn.EPSILON*Math.max(1,Math.abs(b),Math.abs(V))&&Math.abs(v-H)<=Pn.EPSILON*Math.max(1,Math.abs(v),Math.abs(H))&&Math.abs(S-Y)<=Pn.EPSILON*Math.max(1,Math.abs(S),Math.abs(Y))},Zt.sqrLen=Zt.squaredLength=Zt.len=Zt.length=Zt.dot=Zt.mul=Zt.setReal=Zt.getReal=void 0;var Pn=Jr(_t),an=Jr(vi),qr=Jr(si);function _r(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(_r=function(l){return l?n:e})(i)}function Jr(i,e){if(i&&i.__esModule)return i;if(i===null||lr(i)!=="object"&&typeof i!="function")return{default:i};var n=_r(e);if(n&&n.has(i))return n.get(i);var l={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=u?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(l,m,p):l[m]=i[m]}return l.default=i,n&&n.set(i,l),l}function No(i,e,n){var l=.5*n[0],u=.5*n[1],m=.5*n[2],p=e[0],b=e[1],v=e[2],S=e[3];return i[0]=p,i[1]=b,i[2]=v,i[3]=S,i[4]=l*S+u*v-m*b,i[5]=u*S+m*p-l*v,i[6]=m*S+l*b-u*p,i[7]=-l*p-u*b-m*v,i}function Vo(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i}function Rl(i,e,n){var l=e[0],u=e[1],m=e[2],p=e[3],b=n[4],v=n[5],S=n[6],k=n[7],D=e[4],A=e[5],L=e[6],z=e[7],V=n[0],H=n[1],Y=n[2],ne=n[3];return i[0]=l*ne+p*V+u*Y-m*H,i[1]=u*ne+p*H+m*V-l*Y,i[2]=m*ne+p*Y+l*H-u*V,i[3]=p*ne-l*V-u*H-m*Y,i[4]=l*k+p*b+u*S-m*v+D*ne+z*V+A*Y-L*H,i[5]=u*k+p*v+m*b-l*S+A*ne+z*H+L*V-D*Y,i[6]=m*k+p*S+l*v-u*b+L*ne+z*Y+D*H-A*V,i[7]=p*k-l*b-u*v-m*S+z*ne-D*V-A*H-L*Y,i}Zt.getReal=an.copy,Zt.setReal=an.copy,Zt.mul=Rl;var _f=an.dot;Zt.dot=_f;var bf=an.length;Zt.length=bf,Zt.len=bf;var mc=an.squaredLength;Zt.squaredLength=mc,Zt.sqrLen=mc;var ki={};function yf(i){return yf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yf(i)}Object.defineProperty(ki,"__esModule",{value:!0}),ki.create=xh,ki.clone=function(i){var e=new Fl.ARRAY_TYPE(2);return e[0]=i[0],e[1]=i[1],e},ki.fromValues=function(i,e){var n=new Fl.ARRAY_TYPE(2);return n[0]=i,n[1]=e,n},ki.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i},ki.set=function(i,e,n){return i[0]=e,i[1]=n,i},ki.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i},ki.subtract=vf,ki.multiply=Ym,ki.divide=wh,ki.ceil=function(i,e){return i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i},ki.floor=function(i,e){return i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i},ki.min=function(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i},ki.max=function(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i},ki.round=function(i,e){return i[0]=Math.round(e[0]),i[1]=Math.round(e[1]),i},ki.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i},ki.scaleAndAdd=function(i,e,n,l){return i[0]=e[0]+n[0]*l,i[1]=e[1]+n[1]*l,i},ki.distance=Ch,ki.squaredDistance=pc,ki.length=Zm,ki.squaredLength=Xm,ki.negate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i},ki.inverse=function(i,e){return i[0]=1/e[0],i[1]=1/e[1],i},ki.normalize=function(i,e){var n=e[0],l=e[1],u=n*n+l*l;return u>0&&(u=1/Math.sqrt(u)),i[0]=e[0]*u,i[1]=e[1]*u,i},ki.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]},ki.cross=function(i,e,n){var l=e[0]*n[1]-e[1]*n[0];return i[0]=i[1]=0,i[2]=l,i},ki.lerp=function(i,e,n,l){var u=e[0],m=e[1];return i[0]=u+l*(n[0]-u),i[1]=m+l*(n[1]-m),i},ki.random=function(i,e){e=e||1;var n=2*Fl.RANDOM()*Math.PI;return i[0]=Math.cos(n)*e,i[1]=Math.sin(n)*e,i},ki.transformMat2=function(i,e,n){var l=e[0],u=e[1];return i[0]=n[0]*l+n[2]*u,i[1]=n[1]*l+n[3]*u,i},ki.transformMat2d=function(i,e,n){var l=e[0],u=e[1];return i[0]=n[0]*l+n[2]*u+n[4],i[1]=n[1]*l+n[3]*u+n[5],i},ki.transformMat3=function(i,e,n){var l=e[0],u=e[1];return i[0]=n[0]*l+n[3]*u+n[6],i[1]=n[1]*l+n[4]*u+n[7],i},ki.transformMat4=function(i,e,n){var l=e[0],u=e[1];return i[0]=n[0]*l+n[4]*u+n[12],i[1]=n[1]*l+n[5]*u+n[13],i},ki.rotate=function(i,e,n,l){var u=e[0]-n[0],m=e[1]-n[1],p=Math.sin(l),b=Math.cos(l);return i[0]=u*b-m*p+n[0],i[1]=u*p+m*b+n[1],i},ki.angle=function(i,e){var n=i[0],l=i[1],u=e[0],m=e[1],p=Math.sqrt(n*n+l*l)*Math.sqrt(u*u+m*m);return Math.acos(Math.min(Math.max(p&&(n*u+l*m)/p,-1),1))},ki.zero=function(i){return i[0]=0,i[1]=0,i},ki.str=function(i){return"vec2("+i[0]+", "+i[1]+")"},ki.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]},ki.equals=function(i,e){var n=i[0],l=i[1],u=e[0],m=e[1];return Math.abs(n-u)<=Fl.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(l-m)<=Fl.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))},ki.forEach=ki.sqrLen=ki.sqrDist=ki.dist=ki.div=ki.mul=ki.sub=ki.len=void 0;var Fl=function(i,e){if(i&&i.__esModule)return i;if(i===null||yf(i)!=="object"&&typeof i!="function")return{default:i};var n=$m(void 0);if(n&&n.has(i))return n.get(i);var l={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=u?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(l,m,p):l[m]=i[m]}return l.default=i,n&&n.set(i,l),l}(_t);function $m(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return($m=function(l){return l?n:e})(i)}function xh(){var i=new Fl.ARRAY_TYPE(2);return Fl.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0),i}function vf(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i}function Ym(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i}function wh(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i}function Ch(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1])}function pc(i,e){var n=e[0]-i[0],l=e[1]-i[1];return n*n+l*l}function Zm(i){return Math.hypot(i[0],i[1])}function Xm(i){var e=i[0],n=i[1];return e*e+n*n}ki.len=Zm,ki.sub=vf,ki.mul=Ym,ki.div=wh,ki.dist=Ch,ki.sqrDist=pc,ki.sqrLen=Xm;var Zg=function(){var i=xh();return function(e,n,l,u,m,p){var b,v;for(n||(n=2),l||(l=0),v=u?Math.min(u*n+l,e.length):e.length,b=l;b<v;b+=n)i[0]=e[b],i[1]=e[b+1],m(i,i,p),e[b]=i[0],e[b+1]=i[1];return e}}();function sd(i){return sd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sd(i)}ki.forEach=Zg,Object.defineProperty(Je,"__esModule",{value:!0}),t.aA=Je.vec4=t._=Je.vec3=Je.vec2=Je.quat2=t.av=Je.quat=t.ad=Je.mat4=t.bC=Je.mat3=Je.mat2d=t.aC=Je.mat2=Je.glMatrix=void 0;var Sh=ms(_t);Je.glMatrix=Sh;var Ih=ms(zt);t.aC=Je.mat2=Ih;var xf=ms(Hi);Je.mat2d=xf;var Xg=ms(en);t.bC=Je.mat3=Xg;var Qg=ms(si);t.ad=Je.mat4=Qg;var cu=ms(vi);t.av=Je.quat=cu;var $i=ms(Zt);Je.quat2=$i;var rb=ms(ki);Je.vec2=rb;var ob=ms(fi);t._=Je.vec3=ob;var ab=ms(_i);function wf(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(wf=function(l){return l?n:e})(i)}function ms(i,e){if(i&&i.__esModule)return i;if(i===null||sd(i)!=="object"&&typeof i!="function")return{default:i};var n=wf(e);if(n&&n.has(i))return n.get(i);var l={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=u?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(l,m,p):l[m]=i[m]}return l.default=i,n&&n.set(i,l),l}t.aA=Je.vec4=ab;var Cf=Th;function Th(i,e,n,l){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=l}Th.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,l=0;l<8;l++){var u=this.sampleCurveX(n)-i;if(Math.abs(u)<e)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=u/m}var p=0,b=1;for(n=i,l=0;l<20&&(u=this.sampleCurveX(n),!(Math.abs(u-i)<e));l++)i>u?p=n:b=n,n=.5*(b-p)+p;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Mh=Ke(Cf),Qm=ld;function ld(i,e){this.x=i,this.y=e}ld.prototype={clone:function(){return new ld(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),l=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=l,this},_rotateAround:function(i,e){var n=Math.cos(i),l=Math.sin(i),u=e.y+l*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-l*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ld.convert=function(i){return i instanceof ld?i:Array.isArray(i)?new ld(i[0],i[1]):i};var gt=Ke(Qm);let Mr=Math.PI/180,kh=180/Math.PI;function tn(i){return i*Mr}function na(i){return i*kh}let Kg=[[0,0],[1,0],[1,1],[0,1]];function Sf(i){if(i<=0)return 0;if(i>=1)return 1;let e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function Eh(i,e,n,l){let u=new Mh(i,e,n,l);return function(m){return u.solve(m)}}let cd=Eh(.25,.1,.25,1);function Ri(i,e,n){return Math.min(n,Math.max(e,i))}function $r(i,e,n){return(n=Ri((n-i)/(e-i),0,1))*n*(3-2*n)}function Ll(i,e,n){let l=n-e,u=((i-e)%l+l)%l+e;return u===e?n:u}function ps(i,e,n){if(!i.length)return n(null,[]);let l=i.length,u=new Array(i.length),m=null;i.forEach((p,b)=>{e(p,(v,S)=>{v&&(m=v),u[b]=S,--l==0&&n(m,u)})})}function Ya(i){let e=[];for(let n in i)e.push(i[n]);return e}function Mo(i,...e){for(let n of e)for(let l in n)i[l]=n[l];return i}let fs=1;function Dh(){return fs++}function Ah(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Km(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Jm(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Ph(i,e){i.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function du(i,e){return i.indexOf(e,i.length-e.length)!==-1}function jo(i,e,n){let l={};for(let u in i)l[u]=e.call(this,i[u],u,i);return l}function dd(i,e,n){let l={};for(let u in i)e.call(this,i[u],u,i)&&(l[u]=i[u]);return l}function po(i){return Array.isArray(i)?i.map(po):typeof i=="object"&&i?jo(i,po):i}let If={};function Vr(i){If[i]||(typeof console<"u"&&console.warn(i),If[i]=!0)}function ra(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function ko(i){let e=0;for(let n,l,u=0,m=i.length,p=m-1;u<m;p=u++)n=i[u],l=i[p],e+=(l.x-n.x)*(n.y+l.y);return e}function Rs([i,e,n]){let l=tn(e+90),u=tn(n);return{x:i*Math.cos(l)*Math.sin(u),y:i*Math.sin(l)*Math.sin(u),z:i*Math.cos(u),azimuthal:e,polar:n}}function Cn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function el(i){let e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,l,u,m)=>{let p=u||m;return e[l]=!p||p.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Oh,ep,fc,Rh,zl,Fh,Lh=null;function tl(i){try{let e=self[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function il(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}function Tf(i,e,n,l){for(;e<n;){let u=e+n>>1;i[u]<l?e=u+1:n=u}return e}function Mf(i,e,n,l){for(;e<n;){let u=e+n>>1;i[u]<=l?e=u+1:n=u}return e}function zh(i){return i>0?1/(1.001-i):1+i}function uu(i){return i>0?1-1/(1.001-i):-i}function gc(){return Oh==null&&(Oh=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Oh}let Eo={now:()=>Rh!==void 0?Rh:performance.now(),setNow(i){Rh=i},restoreNow(){Rh=void 0},frame(i){let e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){let{width:n,height:l}=i;zl||(zl=document.createElement("canvas"));let u=zl.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>zl.width||l>zl.height)&&(zl.width=n,zl.height=l),u.clearRect(-e,-e,n+2*e,l+2*e),u.drawImage(i,0,0,n,l),u.getImageData(-e,-e,n+2*e,l+2*e)},resolveURL:i=>(ep||(ep=document.createElement("a")),ep.href=i,ep.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(fc==null&&(fc=window.matchMedia("(prefers-reduced-motion: reduce)")),fc.matches)},hasCanvasFingerprintNoise(){if(Fh!==void 0)return Fh;if(!gc())return Fh=!1,!1;let i=new OffscreenCanvas(85,1),e=i.getContext("2d",{willReadFrequently:!0}),n=0;for(let u=0;u<i.width;++u)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(u,0,1,1);let l=e.getImageData(0,0,i.width,i.height);n=0;for(let u=0;u<l.data.length;++u)if(u%4!=3&&n++!==l.data[u])return Fh=!0,!0;return Fh=!1,!1}};function tp(i,e){let n=i.indexOf("?");if(n<0)return`${i}?${new URLSearchParams(e).toString()}`;let l=new URLSearchParams(i.slice(n));for(let u in e)l.set(u,e[u]);return`${i.slice(0,n)}?${l.toString()}`}function Bh(i,e={persistentParams:[]}){let n=i.indexOf("?");if(n<0)return i;let l=new URLSearchParams,u=new URLSearchParams(i.slice(n));for(let p of e.persistentParams){let b=u.get(p);b&&l.set(p,b)}let m=l.toString();return`${i.slice(0,n)}${m.length>0?`?${m}`:""}`}let ip="mapbox-tiles",kf=500,np=50,fo,hu;function mu(){try{return caches}catch{}}function pu(){let i=mu();i&&!fo&&(fo=i.open(ip))}let Nh=1/0,rp={supported:!1,testSupport:function(i){!Ef&&gu&&(Df?Jg(i):fu=i)}},fu,gu,Ef=!1,Df=!1,_c=typeof self<"u"?self:{};function Jg(i){let e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,gu),i.isContextLost())return;rp.supported=!0}catch{}i.deleteTexture(e),Ef=!0}_c.document&&(gu=_c.document.createElement("img"),gu.onload=function(){fu&&Jg(fu),fu=null,Df=!0},gu.onerror=function(){Ef=!0,fu=null},gu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let op={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(op);class Vh extends Error{constructor(e,n,l){n===401&&F(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let jh=Cn()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,gs=function(i,e){if(!(/^file:/.test(n=i.url)||/^file:/.test(jh())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(l,u){let m=new AbortController,p=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:jh(),referrerPolicy:l.referrerPolicy,signal:m.signal}),b=!1,v=!1,S=(k=p.url).indexOf("sku=")>0&&F(k);var k;l.type==="json"&&p.headers.set("Accept","application/json");let D=(L,z,V)=>{if(v)return;if(L&&L.message!=="SecurityError"&&Vr(L.toString()),z&&V)return A(z);let H=Date.now();fetch(p).then(Y=>{if(Y.ok){let ne=S?Y.clone():null;return A(Y,ne,H)}return u(new Vh(Y.statusText,Y.status,l.url))}).catch(Y=>{Y.name!=="AbortError"&&u(new Error(`${Y.message} ${l.url}`))})},A=(L,z,V)=>{(l.type==="arrayBuffer"?L.arrayBuffer():l.type==="json"?L.json():L.text()).then(H=>{v||(z&&V&&function(Y,ne,re){if(pu(),!fo)return;let oe=el(ne.headers.get("Cache-Control")||"");if(oe["no-store"])return;let xe={status:ne.status,statusText:ne.statusText,headers:new Headers};ne.headers.forEach((Ae,je)=>xe.headers.set(je,Ae)),oe["max-age"]&&xe.headers.set("Expires",new Date(re+1e3*oe["max-age"]).toUTCString());let be=xe.headers.get("Expires");if(!be||new Date(be).getTime()-re<42e4)return;let ke=Bh(Y.url,{persistentParams:["language","worldview"]});if(ne.status===206){let Ae=Y.headers.get("Range");if(!Ae)return;xe.status=200,ke=tp(ke,{range:Ae})}(function(Ae,je){if(hu===void 0)try{new Response(new ReadableStream),hu=!0}catch{hu=!1}hu?je(Ae.body):Ae.blob().then(je)})(ne,Ae=>{let je=new Response((Qe=ne.status)!==200&&Qe!==404&&[101,103,204,205,304].includes(Qe)?null:Ae,xe);var Qe;pu(),fo&&fo.then($e=>$e.put(ke,je)).catch($e=>Vr($e.message))})}(p,z,V),b=!0,u(null,H,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(H=>{v||u(new Error(H.message))})};return S?function(L,z){if(pu(),!fo)return z(null);fo.then(V=>{let H=Bh(L.url,{persistentParams:["language","worldview"]}),Y=L.headers.get("Range");Y&&(H=tp(H,{range:Y})),V.match(H).then(ne=>{let re=function(oe){if(!oe)return!1;let xe=new Date(oe.headers.get("Expires")||0),be=el(oe.headers.get("Cache-Control")||"");return xe>Date.now()&&!be["no-cache"]}(ne);V.delete(H),re&&V.put(H,ne.clone()),z(null,ne,re)}).catch(z)}).catch(z)}(p,D):D(null,null),{cancel:()=>{v=!0,b||m.abort()}}}(i,e);if(Cn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(l,u){let m=new XMLHttpRequest;m.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(let p in l.headers)m.setRequestHeader(p,l.headers[p]);return l.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=l.credentials==="include",m.onerror=()=>{u(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let p=m.response;if(l.type==="json")try{p=JSON.parse(m.response)}catch(b){return u(b)}u(null,p,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else u(new Vh(m.statusText,m.status,l.url))},m.send(l.body),{cancel:()=>m.abort()}}(i,e)},nl=function(i,e){return gs(Mo(i,{type:"arrayBuffer"}),e)};function e_(i){let e=document.createElement("a");return e.href=i,e.protocol===location.protocol&&e.host===location.host}let Af="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Uh,rl;Uh=[],rl=0;let Uo=function(i,e){if(rp.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),rl>=M.MAX_PARALLEL_IMAGE_REQUESTS){let m={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Uh.push(m),m}rl++;let n=!1,l=()=>{if(!n)for(n=!0,rl--;Uh.length&&rl<M.MAX_PARALLEL_IMAGE_REQUESTS;){let m=Uh.shift(),{requestParameters:p,callback:b,cancelled:v}=m;v||(m.cancel=Uo(p,b).cancel)}},u=nl(i,(m,p,b,v)=>{l(),m?e(m):p&&(self.createImageBitmap?function(S,k){let D=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(D).then(A=>{k(null,A)}).catch(A=>{k(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(S,k)=>e(S,k,b,v)):function(S,k){let D=new Image;D.onload=()=>{k(null,D),URL.revokeObjectURL(D.src),D.onload=null,requestAnimationFrame(()=>{D.src=Af})},D.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let A=new Blob([new Uint8Array(S)],{type:"image/png"});D.src=S.byteLength?URL.createObjectURL(A):Af}(p,(S,k)=>e(S,k,b,v)))});return{cancel:()=>{u.cancel(),l()}}},ap="01",Pf="NO_ACCESS_TOKEN",sb=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Fs(i){let e=i.match(sb);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function _u(i){let e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}let sp="mapbox.eventData";function Bl(i){if(!i)return null;let e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class et{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=Bl(M.ACCESS_TOKEN),l="";return l=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(u,m)=>String.fromCharCode(+("0x"+m)))):M.ACCESS_TOKEN||"",e?`${sp}.${e}:${l}`:`${sp}:${l}`}fetchEventData(){let e=tl("localStorage"),n=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{let u=localStorage.getItem(n);u&&(this.eventData=JSON.parse(u));let m=localStorage.getItem(l);m&&(this.anonId=m)}catch{Vr("Unable to read from LocalStorage")}}saveEventData(){let e=tl("localStorage"),n=this.getStorageKey(),l=this.getStorageKey("uuid"),u=this.anonId;if(e&&u)try{localStorage.setItem(l,u),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Vr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,l,u){if(!M.EVENTS_URL)return;let m=Fs(M.EVENTS_URL);m.params.push(`access_token=${u||M.ACCESS_TOKEN||""}`);let p={event:this.type,created:new Date(e).toISOString()},b=n?Mo(p,n):p,v={url:_u(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=function(S,k){return gs(Mo(S,{method:"POST"}),k)}(v,S=>{this.pendingRequest=null,l(S),this.saveEventData(),this.processRequests(u)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let Pt=new class extends et{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){M.EVENTS_URL&&M.ACCESS_TOKEN&&Array.isArray(i)&&i.some(n=>N(n)||F(n))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Bl(M.ACCESS_TOKEN),n=e?e.u:M.ACCESS_TOKEN,l=n!==this.eventData.tokenU;Jm(this.anonId)||(this.anonId=Ah(),l=!0);let u=this.queue.shift();if(this.eventData.lastSuccess){let m=new Date(this.eventData.lastSuccess),p=new Date(u),b=(u-this.eventData.lastSuccess)/864e5;l=l||b>=1||b<-1||m.getDate()!==p.getDate()}else l=!0;l?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:g,skuId:ap,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=u,this.eventData.tokenU=n)},i):this.processRequests()}},bt=Pt.postTurnstileEvent.bind(Pt),hi=new class extends et{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,n,l){this.skuToken=e,this.errorCb=l,M.EVENTS_URL&&(n||M.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(Pf)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Jm(this.anonId)||(this.anonId=Ah()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:g,skuId:ap,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},i))}remove(){this.errorCb=null}},sn=hi.postMapLoadEvent.bind(hi),er=new class extends et{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(i){let e=this.mapInstanceIdMap.get(i);return e||(e=Ah(),this.mapInstanceIdMap.set(i,e)),e}getEventId(i){let e=this.eventIdPerMapInstanceMap.get(i)||0;return this.eventIdPerMapInstanceMap.set(i,e+1),e}postStyleLoadEvent(i,e){let{map:n,style:l,importedStyles:u}=e;if(!M.EVENTS_URL||!i&&!M.ACCESS_TOKEN)return;let m=this.getMapInstanceId(n),p={mapInstanceId:m,eventId:this.getEventId(m),style:l};u.length&&(p.importedStyles=u),this.queueRequest({timestamp:Date.now(),payload:p},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},i)}},Do=er.postStyleLoadEvent.bind(er),cr=new class extends et{constructor(){super("gljs.performance")}postPerformanceEvent(i,e){M.EVENTS_URL&&(i||M.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),l=function(u){let m=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),b=function(L){let z={};if(L){for(let V in L)if(V!=="other")for(let H of L[V]){let Y=`${V}ResolveRangeMin`,ne=`${V}ResolveRangeMax`,re=`${V}RequestCount`,oe=`${V}RequestCachedCount`;z[Y]=Math.min(z[Y]||1/0,H.startTime),z[ne]=Math.max(z[ne]||-1/0,H.responseEnd);let xe=be=>{z[be]===void 0&&(z[be]=0),++z[be]};H.transferSize!==void 0&&H.transferSize===0&&xe(oe),xe(re)}}return z}(function(L,z){let V={};if(L)for(let H of L){let Y=z(H);V[Y]===void 0&&(V[Y]=[]),V[Y].push(H)}return V}(m,Re)),v=window.devicePixelRatio,S=navigator.connection||navigator.mozConnection||navigator.webkitConnection,k=S?S.effectiveType:void 0,D={counters:[],metadata:[],attributes:[]},A=(L,z,V)=>{V!=null&&L.push({name:z,value:V.toString()})};for(let L in b)A(D.counters,L,b[L]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(A(D.counters,"interactionRangeMin",u.interactionRange[0]),A(D.counters,"interactionRangeMax",u.interactionRange[1])),p)for(let L of Object.keys(Te)){let z=Te[L],V=p.find(H=>H.name===z);V&&A(D.counters,z,V.startTime)}return A(D.counters,"visibilityHidden",u.visibilityHidden),A(D.attributes,"style",function(L){if(L)for(let z of L){let V=z.name.split("?")[0];if(pe(V)){let H=V.split("/").slice(-2);if(H.length===2)return`mapbox://styles/${H[0]}/${H[1]}`}}}(m)),A(D.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),A(D.attributes,"fogEnabled",u.fogEnabled?"true":"false"),A(D.attributes,"projection",u.projection),A(D.attributes,"zoom",u.zoom),A(D.metadata,"devicePixelRatio",v),A(D.metadata,"connectionEffectiveType",k),A(D.metadata,"navigatorUserAgent",navigator.userAgent),A(D.metadata,"screenWidth",window.screen.width),A(D.metadata,"screenHeight",window.screen.height),A(D.metadata,"windowWidth",window.innerWidth),A(D.metadata,"windowHeight",window.innerHeight),A(D.metadata,"mapWidth",u.width/v),A(D.metadata,"mapHeight",u.height/v),A(D.metadata,"webglRenderer",u.renderer),A(D.metadata,"webglVendor",u.vendor),A(D.metadata,"sdkVersion",g),A(D.metadata,"sdkIdentifier","mapbox-gl-js"),D}(n);for(let u of l.metadata);for(let u of l.counters);for(let u of l.attributes);this.postEvent(e,l,()=>{},i)}},Of=cr.postPerformanceEvent.bind(cr),bu=new class extends et{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,n,l){if(!M.API_URL||!M.SESSION_PATH)return;let u=Fs(M.API_URL+M.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${l||M.ACCESS_TOKEN||""}`);let m={url:_u(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,b){return gs(Mo(p,{method:"GET"}),b)}(m,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(l)})}getSessionAPI(i,e,n,l){this.skuToken=e,this.errorCb=l,M.SESSION_PATH&&M.API_URL&&(n||M.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(Pf)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},i)}remove(){this.errorCb=null}},Ia=bu.getSessionAPI.bind(bu),bc=new Set;var ud={exports:{}},hd={exports:function(i,e){var n,l,u,m,p,b,v,S;for(l=i.length-(n=3&i.length),u=e,p=3432918353,b=461845907,S=0;S<l;)v=255&i.charCodeAt(S)|(255&i.charCodeAt(++S))<<8|(255&i.charCodeAt(++S))<<16|(255&i.charCodeAt(++S))<<24,++S,u=27492+(65535&(m=5*(65535&(u=(u^=v=(65535&(v=(v=(65535&v)*p+(((v>>>16)*p&65535)<<16)&4294967295)<<15|v>>>17))*b+(((v>>>16)*b&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(v=0,n){case 3:v^=(255&i.charCodeAt(S+2))<<16;case 2:v^=(255&i.charCodeAt(S+1))<<8;case 1:u^=v=(65535&(v=(v=(65535&(v^=255&i.charCodeAt(S)))*p+(((v>>>16)*p&65535)<<16)&4294967295)<<15|v>>>17))*b+(((v>>>16)*b&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}},lp={exports:function(i,e){for(var n,l=i.length,u=e^l,m=0;l>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),l-=4,++m;switch(l){case 3:u^=(255&i.charCodeAt(m+2))<<16;case 2:u^=(255&i.charCodeAt(m+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(m)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}},Wh=hd.exports,rr=lp.exports;ud.exports=Wh,ud.exports.murmur3=Wh,ud.exports.murmur2=rr;var yu=Ke(ud.exports);function cp(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function Nl(i,e,n){if(n&&n[i]){let l=n[i].indexOf(e);l!==-1&&n[i].splice(l,1)}}class Ta{constructor(e,n={}){Mo(this,n),this.type=e}}class dp extends Ta{constructor(e,n={}){super("error",Mo({error:e},n))}}class md{on(e,n){return this._listeners=this._listeners||{},cp(e,n,this._listeners),this}off(e,n){return Nl(e,n,this._listeners),Nl(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},cp(e,n,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,n){typeof e=="string"&&(e=new Ta(e,n||{}));let l=e.type;if(this.listens(l)){e.target=this;let u=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(let b of u)b.call(this,e);let m=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(let b of m)Nl(l,b,this._oneTimeListeners),b.call(this,e);let p=this._eventedParent;p&&(Mo(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof dp&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}t.F=void 0;var Hh={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ls(i){return(i=Math.round(i))<0?0:i>255?255:i}function vu(i){return Ls(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function xu(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function yc(i,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?i+(e-i)*n*6:2*n<1?e:3*n<2?i+(e-i)*(2/3-n)*6:i}try{t.F={}.parseCSSColor=function(i){var e,n=i.replace(/ /g,"").toLowerCase();if(n in Hh)return Hh[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=n.indexOf("("),u=n.indexOf(")");if(l!==-1&&u+1===n.length){var m=n.substr(0,l),p=n.substr(l+1,u-(l+1)).split(","),b=1;switch(m){case"rgba":if(p.length!==4)return null;b=xu(p.pop());case"rgb":return p.length!==3?null:[vu(p[0]),vu(p[1]),vu(p[2]),b];case"hsla":if(p.length!==4)return null;b=xu(p.pop());case"hsl":if(p.length!==3)return null;var v=(parseFloat(p[0])%360+360)%360/360,S=xu(p[1]),k=xu(p[2]),D=k<=.5?k*(S+1):k+S-k*S,A=2*k-D;return[Ls(255*yc(A,D,v+1/3)),Ls(255*yc(A,D,v)),Ls(255*yc(A,D,v-1/3)),b];default:return null}}return null}}catch{}class mn{constructor(e,n,l,u=1){this.r=e,this.g=n,this.b=l,this.a=u}static parse(e){if(!e)return;if(e instanceof mn)return e;if(typeof e!="string")return;let n=t.F(e);return n?new mn(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,l,u]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(l)},${u})`}toRenderColor(e){let{r:n,g:l,b:u,a:m}=this;return new t_(e,n,l,u,m)}}class t_{constructor(e,n,l,u,m){if(e){let p=e.image.height,b=p*p;n=m===0?0:n/m*(p-1),l=m===0?0:l/m*(p-1),u=m===0?0:u/m*(p-1);let v=Math.floor(n),S=Math.floor(l),k=Math.floor(u),D=Math.ceil(n),A=Math.ceil(l),L=Math.ceil(u),z=n-v,V=l-S,H=u-k,Y=e.image.data,ne=4*(v+S*b+k*p),re=4*(v+S*b+L*p),oe=4*(v+A*b+k*p),xe=4*(v+A*b+L*p),be=4*(D+S*b+k*p),ke=4*(D+S*b+L*p),Ae=4*(D+A*b+k*p),je=4*(D+A*b+L*p);if(ne<0||je>=Y.length)throw new Error("out of range");this.r=ri(ri(ri(Y[ne],Y[re],H),ri(Y[oe],Y[xe],H),V),ri(ri(Y[be],Y[ke],H),ri(Y[Ae],Y[je],H),V),z)/255*m,this.g=ri(ri(ri(Y[ne+1],Y[re+1],H),ri(Y[oe+1],Y[xe+1],H),V),ri(ri(Y[be+1],Y[ke+1],H),ri(Y[Ae+1],Y[je+1],H),V),z)/255*m,this.b=ri(ri(ri(Y[ne+2],Y[re+2],H),ri(Y[oe+2],Y[xe+2],H),V),ri(ri(Y[be+2],Y[ke+2],H),ri(Y[Ae+2],Y[je+2],H),V),z)/255*m,this.a=m}else this.r=n,this.g=l,this.b=u,this.a=m}toArray(){let{r:e,g:n,b:l,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*n/u,255*l/u,u]}toArray01(){let{r:e,g:n,b:l,a:u}=this;return u===0?[0,0,0,0]:[e/u,n/u,l/u,u]}toArray01Scaled(e){let{r:n,g:l,b:u,a:m}=this;return m===0?[0,0,0]:[n/m*e,l/m*e,u/m*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:l,a:u}=this;return[e,n,l,u]}toArray01Linear(){let{r:e,g:n,b:l,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(n/u,2.2),Math.pow(l/u,2.2),u]}}function ri(i,e,n){return i*(1-n)+e*n}function Rf(i,e,n){return i.map((l,u)=>ri(l,e[u],n))}mn.black=new mn(0,0,0,1),mn.white=new mn(1,1,1,1),mn.transparent=new mn(0,0,0,0),mn.red=new mn(1,0,0,1),mn.blue=new mn(0,0,1,1);var vc=Object.freeze({__proto__:null,array:Rf,color:function(i,e,n){return new mn(ri(i.r,e.r,n),ri(i.g,e.g,n),ri(i.b,e.b,n),ri(i.a,e.a,n))},number:ri});function Vl(i,...e){for(let n of e)for(let l in n)i[l]=n[l];return i}class Za extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Ff{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[l,u]of n)this.bindings[l]=u}concat(e){return new Ff(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let wu={kind:"null"},Gt={kind:"number"},nn={kind:"string"},rn={kind:"boolean"},oa={kind:"color"},Cu={kind:"object"},ln={kind:"value"},zs={kind:"collator"},Su={kind:"formatted"},Cr={kind:"resolvedImage"};function br(i,e){return{kind:"array",itemType:i,N:e}}function Yr(i){if(i.kind==="array"){let e=Yr(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}let lb=[wu,Gt,nn,rn,oa,Su,Cu,br(ln),Cr];function Iu(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Iu(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(let n of lb)if(!Iu(n,e))return null}}return`Expected ${Yr(i)} but found ${Yr(e)} instead.`}function Lf(i,e){return e.some(n=>n.kind===i.kind)}function xc(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}class jl{constructor(e,n,l){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ul{constructor(e,n,l,u,m){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=l,this.fontStack=u,this.textColor=m}}class co{constructor(e){this.sections=e}static fromString(e){return new co([new Ul(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof co?e:co.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let l={};n.fontStack&&(l["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(l["font-scale"]=n.scale),n.textColor&&(l["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(l)}return e}}class Ao{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new Ao({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Tu(i,e,n,l){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,e,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,e,n,l]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Wo(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof mn||i instanceof jl||i instanceof co||i instanceof Ao)return!0;if(Array.isArray(i)){for(let e of i)if(!Wo(e))return!1;return!0}if(typeof i=="object"){for(let e in i)if(!Wo(i[e]))return!1;return!0}return!1}function kr(i){if(i===null)return wu;if(typeof i=="string")return nn;if(typeof i=="boolean")return rn;if(typeof i=="number")return Gt;if(i instanceof mn)return oa;if(i instanceof jl)return zs;if(i instanceof co)return Su;if(i instanceof Ao)return Cr;if(Array.isArray(i)){let e=i.length,n;for(let l of i){let u=kr(l);if(n){if(n===u)continue;n=ln;break}n=u}return br(n||ln,e)}return Cu}function _s(i){let e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof mn||i instanceof co||i instanceof Ao?i.toString():JSON.stringify(i)}class Wl{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Wo(e[1]))return n.error("invalid value");let l=e[1],u=kr(l),m=n.expectedType;return u.kind!=="array"||u.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(u=m),new Wl(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof mn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof co?this.value.serialize():this.value}}class vo{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let zf={string:nn,number:Gt,boolean:rn,object:Cu};class Bs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l,u=1,m=e[0];if(m==="array"){let b,v;if(e.length>2){let S=e[1];if(typeof S!="string"||!(S in zf)||S==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=zf[S],u++}else b=ln;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);v=e[2],u++}l=br(b,v)}else l=zf[m];let p=[];for(;u<e.length;u++){let b=n.parse(e[u],u,ln);if(!b)return null;p.push(b)}return new Bs(l,p)}evaluate(e){for(let n=0;n<this.args.length;n++){let l=this.args[n].evaluate(e);if(!Iu(this.type,kr(l)))return l;if(n===this.args.length-1)throw new vo(`Expected value to be of type ${Yr(this.type)}, but found ${Yr(kr(l))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){n.push(l.kind);let u=e.N;(typeof u=="number"||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(l=>l.serialize()))}}class wc{constructor(e){this.type=Su,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l=e[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");let u=[],m=!1;for(let p=1;p<=e.length-1;++p){let b=e[p];if(m&&typeof b=="object"&&!Array.isArray(b)){m=!1;let v=null;if(b["font-scale"]&&(v=n.parse(b["font-scale"],1,Gt),!v))return null;let S=null;if(b["text-font"]&&(S=n.parse(b["text-font"],1,br(nn)),!S))return null;let k=null;if(b["text-color"]&&(k=n.parse(b["text-color"],1,oa),!k))return null;let D=u[u.length-1];D.scale=v,D.font=S,D.textColor=k}else{let v=n.parse(e[p],1,ln);if(!v)return null;let S=v.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,u.push({content:v,scale:null,font:null,textColor:null})}}return new wc(u)}evaluate(e){return new co(this.sections.map(n=>{let l=n.content.evaluate(e);return kr(l)===Cr?new Ul("",l,null,null,null):new Ul(_s(l),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let l={};n.scale&&(l["font-scale"]=n.scale.serialize()),n.font&&(l["text-font"]=n.font.serialize()),n.textColor&&(l["text-color"]=n.textColor.serialize()),e.push(l)}return e}}class Hl{constructor(e,n){this.type=Cr,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let l=n.parse(e[1],1,nn);if(!l)return n.error("No image name provided.");if(e.length===2)return new Hl(l);let u=n.parse(e[2],1,nn);return u?new Hl(l,u):n.error("Secondary image variant is not a string.")}evaluate(e){let n=Ao.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Cc(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}let ve={"to-boolean":rn,"to-color":oa,"to-number":Gt,"to-string":nn};class ua{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l=e[0],u=[],m=wu;if(l==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);m=br(n.expectedType.itemType,p)}else{if(!(p>0&&Wo(e[1][0])))return null;m=br(kr(e[1][0]),p)}for(let b=0;b<p;b++){let v=e[1][b],S;if(Cc(v)==="array")S=n.parse(v,void 0,m.itemType);else{let k=Cc(v);if(k!==m.itemType.kind)return n.error(`Expected ${m.itemType.kind} but found ${k}.`);S=n.registry.literal.parse(["literal",v===void 0?null:v],n)}if(!S)return null;u.push(S)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return n.error("Expected one argument.");m=ve[l];for(let p=1;p<e.length;p++){let b=n.parse(e[p],p,ln);if(!b)return null;u.push(b)}}return new ua(m,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,l;for(let u of this.args){if(n=u.evaluate(e),l=null,n instanceof mn)return n;if(typeof n=="string"){let m=e.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Tu(n[0],n[1],n[2],n[3]),!l))return new mn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new vo(l||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let l of this.args){if(n=l.evaluate(e),n===null)return 0;let u=Number(n);if(!isNaN(u))return u}throw new vo(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?co.fromString(_s(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ao.fromString(_s(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):_s(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new wc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Hl(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let Gh=["Unknown","Point","LineString","Polygon"];class Xa{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Gh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*n-e[0])+this.featureDistanceData.bearing[1]*(u*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=mn.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Wi{constructor(e,n,l,u,m){this.name=e,this.type=n,this._evaluate=l,this.args=u,this._overloadIndex=m}evaluate(e){if(!this._evaluate){let n=Wi.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let l=e[0],u=Wi.definitions[l];if(!u)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);let m=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,b=[],v=null,S=-1;for(let[k,D]of p){if(Array.isArray(k)&&k.length!==e.length-1)continue;b.push(k),S++,v=new Fu(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let A=[],L=!1;for(let z=1;z<e.length;z++){let V=e[z],H=Array.isArray(k)?k[z-1]:k.type,Y=v.parse(V,1+A.length,H);if(!Y){L=!0;break}A.push(Y)}if(!L)if(Array.isArray(k)&&k.length!==A.length)v.error(`Expected ${k.length} arguments, but found ${A.length} instead.`);else{for(let z=0;z<A.length;z++){let V=Array.isArray(k)?k[z]:k.type,H=A[z];v.concat(z+1).checkSubtype(V,H.type)}if(v.errors.length===0)return new Wi(l,m,D,A,S)}}if(b.length===1)n.errors.push(...v.errors);else{let k=(b.length?b:p.map(([A])=>A)).map(Bf).join(" | "),D=[];for(let A=1;A<e.length;A++){let L=n.parse(e[A],1+D.length);if(!L)return null;D.push(Yr(L.type))}n.error(`Expected arguments of type ${k}, but found (${D.join(", ")}) instead.`)}return null}static register(e,n){Wi.definitions=n;for(let l in n)e[l]=Wi}}function Bf(i){return Array.isArray(i)?`(${i.map(Yr).join(", ")})`:`(${Yr(i.type)}...)`}class Sc{constructor(e,n,l){this.type=zs,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let l=e[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");let u=n.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,rn);if(!u)return null;let m=n.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,rn);if(!m)return null;let p=null;return l.locale&&(p=n.parse(l.locale,1,nn),!p)?null:new Sc(u,m,p)}evaluate(e){return new jl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Nf={exports:{}};Nf.exports=function(){function i(l,u,m,p,b){for(;p>m;){if(p-m>600){var v=p-m+1,S=u-m+1,k=Math.log(v),D=.5*Math.exp(2*k/3),A=.5*Math.sqrt(k*D*(v-D)/v)*(S-v/2<0?-1:1);i(l,u,Math.max(m,Math.floor(u-S*D/v+A)),Math.min(p,Math.floor(u+(v-S)*D/v+A)),b)}var L=l[u],z=m,V=p;for(e(l,m,u),b(l[p],L)>0&&e(l,m,p);z<V;){for(e(l,z,V),z++,V--;b(l[z],L)<0;)z++;for(;b(l[V],L)>0;)V--}b(l[m],L)===0?e(l,m,V):e(l,++V,p),V<=u&&(m=V+1),u<=V&&(p=V-1)}}function e(l,u,m){var p=l[u];l[u]=l[m],l[m]=p}function n(l,u){return l<u?-1:l>u?1:0}return function(l,u,m,p,b){i(l,u,m||0,p||l.length-1,b||n)}}();var pd=Ke(Nf.exports);function cb(i){let e=0;for(let n,l,u=0,m=i.length,p=m-1;u<m;p=u++)n=i[u],l=i[p],e+=(l.x-n.x)*(n.y+l.y);return e}function qh(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Mu(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function db(i,e,n){let l=i[0]-e[0],u=i[1]-e[1],m=i[0]-n[0],p=i[1]-n[1];return l*p-m*u==0&&l*m<=0&&u*p<=0}function ku(i,e,n=!1){let l=!1;for(let b=0,v=e.length;b<v;b++){let S=e[b];for(let k=0,D=S.length,A=D-1;k<D;A=k++){let L=S[A],z=S[k];if(db(i,L,z))return n;(m=L)[1]>(u=i)[1]!=(p=z)[1]>u[1]&&u[0]<(p[0]-m[0])*(u[1]-m[1])/(p[1]-m[1])+m[0]&&(l=!l)}}var u,m,p;return l}function Ns(i,e,n,l){let u=l[0]-n[0],m=l[1]-n[1],p=(i[0]-n[0])*m-u*(i[1]-n[1]),b=(e[0]-n[0])*m-u*(e[1]-n[1]);return p>0&&b<0||p<0&&b>0}function cn(i,e,n,l){return(u=[l[0]-n[0],l[1]-n[1]])[0]*(m=[e[0]-i[0],e[1]-i[1]])[1]-u[1]*m[0]!=0&&!(!Ns(i,e,n,l)||!Ns(n,l,i,e));var u,m}let Gl=8192;function i_(i,e){let n=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*Gl),Math.round(l*u*Gl)]}function ub(i,e){for(let n=0;n<e.length;n++)if(ku(i,e[n]))return!0;return!1}function hb(i,e,n){for(let l of n)for(let u=0,m=l.length,p=m-1;u<m;p=u++)if(cn(i,e,l[p],l[u]))return!0;return!1}function Qa(i,e){for(let n=0;n<i.length;++n)if(!ku(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(hb(i[n],i[n+1],e))return!1;return!0}function up(i,e){for(let n=0;n<e.length;n++)if(Qa(i,e[n]))return!0;return!1}function Eu(i,e,n){let l=[];for(let u=0;u<i.length;u++){let m=[];for(let p=0;p<i[u].length;p++){let b=i_(i[u][p],n);qh(e,b),m.push(b)}l.push(m)}return l}function n_(i,e,n){let l=[];for(let u=0;u<i.length;u++){let m=Eu(i[u],e,n);l.push(m)}return l}function Vf(i,e,n,l){if(i[0]<n[0]||i[0]>n[2]){let u=.5*l,m=i[0]-n[0]>u?-l:n[0]-i[0]>u?l:0;m===0&&(m=i[0]-n[2]>u?-l:n[2]-i[0]>u?l:0),i[0]+=m}qh(e,i)}function Vs(i,e,n,l){let u=Math.pow(2,l.z)*Gl,m=[l.x*Gl,l.y*Gl],p=[];if(!i)return p;for(let b of i)for(let v of b){let S=[v.x+m[0],v.y+m[1]];Vf(S,e,n,u),p.push(S)}return p}function Ic(i,e,n,l){let u=Math.pow(2,l.z)*Gl,m=[l.x*Gl,l.y*Gl],p=[];if(!i)return p;for(let v of i){let S=[];for(let k of v){let D=[k.x+m[0],k.y+m[1]];qh(e,D),S.push(D)}p.push(S)}if(e[2]-e[0]<=u/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(let v of p)for(let S of v)Vf(S,e,n,u)}var b;return p}class Tc{constructor(e,n){this.type=rn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Wo(e[1])){let l=e[1];if(l.type==="FeatureCollection")for(let u=0;u<l.features.length;++u){let m=l.features[u].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Tc(l,l.features[u].geometry)}else if(l.type==="Feature"){let u=l.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Tc(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Tc(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,l){let u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(l.type==="Polygon"){let b=Eu(l.coordinates,m,p),v=Vs(n.geometry(),u,m,p);if(!Mu(u,m))return!1;for(let S of v)if(!ku(S,b))return!1}if(l.type==="MultiPolygon"){let b=n_(l.coordinates,m,p),v=Vs(n.geometry(),u,m,p);if(!Mu(u,m))return!1;for(let S of v)if(!ub(S,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,l){let u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(l.type==="Polygon"){let b=Eu(l.coordinates,m,p),v=Ic(n.geometry(),u,m,p);if(!Mu(u,m))return!1;for(let S of v)if(!Qa(S,b))return!1}if(l.type==="MultiPolygon"){let b=n_(l.coordinates,m,p),v=Ic(n.geometry(),u,m,p);if(!Mu(u,m))return!1;for(let S of v)if(!up(S,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let Mc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},za=1/298.257223563,r_=za*(2-za),$h=Math.PI/180;class Yh{static fromTile(e,n,l){let u=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),m=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/$h;return new Yh(m,l)}static get units(){return Mc}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Mc[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Mc).join(", ")}`);let l=6378.137*$h*(n?Mc[n]:1),u=Math.cos(e*$h),m=1/(1-r_*(1-u*u)),p=Math.sqrt(m);this.kx=l*p*u,this.ky=l*p*m*(1-r_)}distance(e,n){let l=Ka(e[0]-n[0])*this.kx,u=(e[1]-n[1])*this.ky;return Math.sqrt(l*l+u*u)}bearing(e,n){let l=Ka(n[0]-e[0])*this.kx;return Math.atan2(l,(n[1]-e[1])*this.ky)/$h}destination(e,n,l){let u=l*$h;return this.offset(e,Math.sin(u)*n,Math.cos(u)*n)}offset(e,n,l){return[e[0]+n/this.kx,e[1]+l/this.ky]}lineDistance(e){let n=0;for(let l=0;l<e.length-1;l++)n+=this.distance(e[l],e[l+1]);return n}area(e){let n=0;for(let l=0;l<e.length;l++){let u=e[l];for(let m=0,p=u.length,b=p-1;m<p;b=m++)n+=Ka(u[m][0]-u[b][0])*(u[m][1]+u[b][1])*(l?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let l=0;if(n<=0)return e[0];for(let u=0;u<e.length-1;u++){let m=e[u],p=e[u+1],b=this.distance(m,p);if(l+=b,l>n)return Zh(m,p,(n-(l-b))/b)}return e[e.length-1]}pointToSegmentDistance(e,n,l){let[u,m]=n,p=Ka(l[0]-u)*this.kx,b=(l[1]-m)*this.ky;if(p!==0||b!==0){let v=(Ka(e[0]-u)*this.kx*p+(e[1]-m)*this.ky*b)/(p*p+b*b);v>1?(u=l[0],m=l[1]):v>0&&(u+=p/this.kx*v,m+=b/this.ky*v)}return p=Ka(e[0]-u)*this.kx,b=(e[1]-m)*this.ky,Math.sqrt(p*p+b*b)}pointOnLine(e,n){let l=1/0,u=e[0][0],m=e[0][1],p=0,b=0;for(let v=0;v<e.length-1;v++){let S=e[v][0],k=e[v][1],D=Ka(e[v+1][0]-S)*this.kx,A=(e[v+1][1]-k)*this.ky,L=0;D===0&&A===0||(L=(Ka(n[0]-S)*this.kx*D+(n[1]-k)*this.ky*A)/(D*D+A*A),L>1?(S=e[v+1][0],k=e[v+1][1]):L>0&&(S+=D/this.kx*L,k+=A/this.ky*L)),D=Ka(n[0]-S)*this.kx,A=(n[1]-k)*this.ky;let z=D*D+A*A;z<l&&(l=z,u=S,m=k,p=v,b=L)}return{point:[u,m],index:p,t:Math.max(0,Math.min(1,b))}}lineSlice(e,n,l){let u=this.pointOnLine(l,e),m=this.pointOnLine(l,n);if(u.index>m.index||u.index===m.index&&u.t>m.t){let S=u;u=m,m=S}let p=[u.point],b=u.index+1,v=m.index;!jf(l[b],p[0])&&b<=v&&p.push(l[b]);for(let S=b+1;S<=v;S++)p.push(l[S]);return jf(l[v],m.point)||p.push(m.point),p}lineSliceAlong(e,n,l){let u=0,m=[];for(let p=0;p<l.length-1;p++){let b=l[p],v=l[p+1],S=this.distance(b,v);if(u+=S,u>e&&m.length===0&&m.push(Zh(b,v,(e-(u-S))/S)),u>=n)return m.push(Zh(b,v,(n-(u-S))/S)),m;u>e&&m.push(v)}return m}bufferPoint(e,n){let l=n/this.ky,u=n/this.kx;return[e[0]-u,e[1]-l,e[0]+u,e[1]+l]}bufferBBox(e,n){let l=n/this.ky,u=n/this.kx;return[e[0]-u,e[1]-l,e[2]+u,e[3]+l]}insideBBox(e,n){return Ka(e[0]-n[0])>=0&&Ka(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function jf(i,e){return i[0]===e[0]&&i[1]===e[1]}function Zh(i,e,n){let l=Ka(e[0]-i[0]);return[i[0]+l*n,i[1]+(e[1]-i[1])*n]}function Ka(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}var Du={exports:{}};(function(i,e){i.exports=function(){var n=function(u,m){if(u===void 0&&(u=[]),m===void 0&&(m=l),this.data=u,this.length=this.data.length,this.compare=m,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function l(u,m){return u<m?-1:u>m?1:0}return n.prototype.push=function(u){this.data.push(u),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var u=this.data[0],m=this.data.pop();return this.length--,this.length>0&&(this.data[0]=m,this._down(0)),u}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(u){for(var m=this.data,p=this.compare,b=m[u];u>0;){var v=u-1>>1,S=m[v];if(p(b,S)>=0)break;m[u]=S,u=v}m[u]=b},n.prototype._down=function(u){for(var m=this.data,p=this.compare,b=this.length>>1,v=m[u];u<b;){var S=1+(u<<1),k=m[S],D=S+1;if(D<this.length&&p(m[D],k)<0&&(S=D,k=m[D]),p(k,v)>=0)break;m[u]=k,u=S}m[u]=v},n}()})(Du);var Uf=Ke(Du.exports),At=8192;function hp(i,e){return e.dist-i.dist}let fd=100,Au=50;function o_(i){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==i.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==i[n])return!1;return!0}function Xh(i){return i[1]-i[0]+1}function ol(i,e){let n=i[1]>=i[0]&&i[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function ha(i,e){if(i[0]>i[1])return[null,null];let n=Xh(i);if(e){if(n===2)return[i,null];let l=Math.floor(n/2);return[[i[0],i[0]+l],[i[0]+l,i[1]]]}{if(n===1)return[i,null];let l=Math.floor(n/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}}function ql(i,e){let n=[1/0,1/0,-1/0,-1/0];if(!ol(e,i.length))return n;for(let l=e[0];l<=e[1];++l)qh(n,i[l]);return n}function al(i){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<i.length;++n)for(let l=0;l<i[n].length;++l)qh(e,i[n][l]);return e}function Po(i,e,n){if(o_(i)||o_(e))return NaN;let l=0,u=0;return i[2]<e[0]&&(l=e[0]-i[2]),i[0]>e[2]&&(l=i[0]-e[2]),i[1]>e[3]&&(u=i[1]-e[3]),i[3]<e[1]&&(u=e[1]-i[3]),n.distance([0,0],[l,u])}function mb(i){return 360*i-180}function a_(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function mp(i,e){let n=Math.pow(2,e.z),l=(i.y/At+e.y)/n;return[mb((i.x/At+e.x)/n),a_(l)]}function Qh(i,e){let n=[];for(let l=0;l<i.length;++l)n.push(mp(i[l],e));return n}function $l(i,e,n){let l=n.pointOnLine(e,i).point;return n.distance(i,l)}function Yl(i,e,n,l,u){let m=n.slice(l[0],l[1]+1),p=1/0;for(let b=e[0];b<=e[1];++b)if((p=Math.min(p,$l(i[b],m,u)))===0)return 0;return p}function Wf(i,e,n,l,u){let m=Math.min(u.pointToSegmentDistance(i,n,l),u.pointToSegmentDistance(e,n,l)),p=Math.min(u.pointToSegmentDistance(n,i,e),u.pointToSegmentDistance(l,i,e));return Math.min(m,p)}function pp(i,e,n,l,u){if(!ol(e,i.length)||!ol(l,n.length))return NaN;let m=1/0;for(let p=e[0];p<e[1];++p)for(let b=l[0];b<l[1];++b){if(cn(i[p],i[p+1],n[b],n[b+1]))return 0;m=Math.min(m,Wf(i[p],i[p+1],n[b],n[b+1],u))}return m}function s_(i,e,n,l,u){if(!ol(e,i.length)||!ol(l,n.length))return NaN;let m=1/0;for(let p=e[0];p<=e[1];++p)for(let b=l[0];b<=l[1];++b)if((m=Math.min(m,u.distance(i[p],n[b])))===0)return m;return m}function Hf(i,e,n){if(ku(i,e,!0))return 0;let l=1/0;for(let u of e){let m=u.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[m-1]&&(l=Math.min(l,n.pointToSegmentDistance(i,u[m-1],u[0])))===0||(l=Math.min(l,$l(i,u,n)))===0)return l}return l}function Er(i,e,n,l){if(!ol(e,i.length))return NaN;for(let m=e[0];m<=e[1];++m)if(ku(i[m],n,!0))return 0;let u=1/0;for(let m=e[0];m<e[1];++m)for(let p of n)for(let b=0,v=p.length,S=v-1;b<v;S=b++){if(cn(i[m],i[m+1],p[S],p[b]))return 0;u=Math.min(u,Wf(i[m],i[m+1],p[S],p[b],l))}return u}function Kh(i,e){for(let n of i)for(let l=0;l<=n.length-1;++l)if(ku(n[l],e,!0))return!0;return!1}function l_(i,e,n,l=1/0){let u=al(i),m=al(e);if(l!==1/0&&Po(u,m,n)>=l)return l;if(Mu(u,m)){if(Kh(i,e))return 0}else if(Kh(e,i))return 0;let p=l;for(let b of i)for(let v=0,S=b.length,k=S-1;v<S;k=v++)for(let D of e)for(let A=0,L=D.length,z=L-1;A<L;z=A++){if(cn(b[k],b[v],D[z],D[A]))return 0;p=Math.min(p,Wf(b[k],b[v],D[z],D[A],n))}return p}function Ba(i,e,n,l,u,m,p){if(m===null||p===null)return;let b=Po(ql(l,m),ql(u,p),n);b<e&&i.push({dist:b,range1:m,range2:p})}function Pu(i,e,n,l,u=1/0){let m=Math.min(l.distance(i[0],n[0][0]),u);if(m===0)return m;let p=new Uf([{dist:0,range1:[0,i.length-1],range2:[0,0]}],hp),b=e?Au:fd,v=al(n);for(;p.length;){let S=p.pop();if(S.dist>=m)continue;let k=S.range1;if(Xh(k)<=b){if(!ol(k,i.length))return NaN;if(e){let D=Er(i,k,n,l);if((m=Math.min(m,D))===0)return m}else for(let D=k[0];D<=k[1];++D){let A=Hf(i[D],n,l);if((m=Math.min(m,A))===0)return m}}else{let D=ha(k,e);if(D[0]!==null){let A=Po(ql(i,D[0]),v,l);A<m&&p.push({dist:A,range1:D[0],range2:[0,0]})}if(D[1]!==null){let A=Po(ql(i,D[1]),v,l);A<m&&p.push({dist:A,range1:D[1],range2:[0,0]})}}}return m}function Jh(i,e,n,l,u,m=1/0){let p=Math.min(m,u.distance(i[0],n[0]));if(p===0)return p;let b=new Uf([{dist:0,range1:[0,i.length-1],range2:[0,n.length-1]}],hp),v=e?Au:fd,S=l?Au:fd;for(;b.length;){let k=b.pop();if(k.dist>=p)continue;let D=k.range1,A=k.range2;if(Xh(D)<=v&&Xh(A)<=S){if(!ol(D,i.length)||!ol(A,n.length))return NaN;if(e&&l?p=Math.min(p,pp(i,D,n,A,u)):e||l?e&&!l?p=Math.min(p,Yl(n,A,i,D,u)):!e&&l&&(p=Math.min(p,Yl(i,D,n,A,u))):p=Math.min(p,s_(i,D,n,A,u)),p===0)return p}else{let L=ha(D,e),z=ha(A,l);Ba(b,p,u,i,n,L[0],z[0]),Ba(b,p,u,i,n,L[0],z[1]),Ba(b,p,u,i,n,L[1],z[0]),Ba(b,p,u,i,n,L[1],z[1])}}return p}function Zl(i,e,n,l,u=1/0){let m=u,p=ql(i,[0,i.length-1]);for(let b of n)if(!(m!==1/0&&Po(p,ql(b,[0,b.length-1]),l)>=m)&&(m=Math.min(m,Jh(i,e,b,!0,l,m)),m===0))return m;return m}function em(i,e,n,l,u=1/0){let m=u,p=ql(i,[0,i.length-1]);for(let b of n){if(m!==1/0&&Po(p,al(b),l)>=m)continue;let v=Pu(i,e,b,l,m);if(isNaN(v))return v;if((m=Math.min(m,v))===0)return m}return m}function aa(i){return i==="Point"||i==="MultiPoint"||i==="LineString"||i==="MultiLineString"||i==="Polygon"||i==="MultiPolygon"}class Xl{constructor(e,n){this.type=Gt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Wo(e[1])){let l=e[1];if(l.type==="FeatureCollection"){for(let u=0;u<l.features.length;++u)if(aa(l.features[u].geometry.type))return new Xl(l,l.features[u].geometry)}else if(l.type==="Feature"){if(aa(l.geometry.type))return new Xl(l,l.geometry)}else if(aa(l.type))return new Xl(l,l)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),l=e.canonicalID();if(n!=null&&l!=null){if(e.geometryType()==="Point")return function(u,m,p){let b=[];for(let S of u)for(let k of S)b.push(mp(k,m));let v=new Yh(b[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?Jh(b,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",v):p.type==="MultiLineString"?Zl(b,!1,p.coordinates,v):p.type==="Polygon"||p.type==="MultiPolygon"?em(b,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,v):null}(n,l,this.geometries);if(e.geometryType()==="LineString")return function(u,m,p){let b=[];for(let S of u){let k=[];for(let D of S)k.push(mp(D,m));b.push(k)}let v=new Yh(b[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Zl(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b,v);if(p.type==="MultiLineString"){let S=1/0;for(let k=0;k<p.coordinates.length;k++){let D=Zl(p.coordinates[k],!0,b,v,S);if(isNaN(D))return D;if((S=Math.min(S,D))===0)return S}return S}if(p.type==="Polygon"||p.type==="MultiPolygon"){let S=1/0;for(let k=0;k<b.length;k++){let D=em(b[k],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,v,S);if(isNaN(D))return D;if((S=Math.min(S,D))===0)return S}return S}return null}(n,l,this.geometries);if(e.geometryType()==="Polygon")return function(u,m,p){let b=[];for(let S of function(k,D){let A=k.length;if(A<=1)return[k];let L=[],z,V;for(let H=0;H<A;H++){let Y=cb(k[H]);Y!==0&&(k[H].area=Math.abs(Y),V===void 0&&(V=Y<0),V===Y<0?(z&&L.push(z),z=[k[H]]):z.push(k[H]))}return z&&L.push(z),L}(u)){let k=[];for(let D=0;D<S.length;++D)k.push(Qh(S[D],m));b.push(k)}let v=new Yh(b[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return em(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b,v);if(p.type==="MultiLineString"){let S=1/0;for(let k=0;k<p.coordinates.length;k++){let D=em(p.coordinates[k],!0,b,v,S);if(isNaN(D))return D;if((S=Math.min(S,D))===0)return S}return S}return p.type==="Polygon"||p.type==="MultiPolygon"?function(S,k,D){let A=1/0;for(let L of S)for(let z of k){let V=l_(L,z,D,A);if(isNaN(V))return V;if((A=Math.min(A,V))===0)return A}return A}(p.type==="Polygon"?[p.coordinates]:p.coordinates,b,v):null}(n,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ou(i,e){switch(i){case"string":return _s(e);case"number":return+e;case"boolean":return!!e;case"color":return mn.parse(e);case"formatted":return co.fromString(_s(e));case"resolvedImage":return Ao.fromString(_s(e))}return e}function tm(i,e,n,l){return l!==void 0&&(i=l*Math.round(i/l)),e!==void 0&&i<e&&(i=e),n!==void 0&&i>n&&(i=n),i}class Ho{constructor(e,n,l){this.type=e,this.key=n,this.scope=l}static parse(e,n){let l=n.expectedType;if(l==null&&(l=ln),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let u=n.parse(e[1],1);if(!(u instanceof Wl))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let m=n.parse(e[2],2);return m instanceof Wl?new Ho(l,_s(u.value),_s(m.value)):n.error("Scope of 'config' expression must be a string literal.")}return new Ho(l,_s(u.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),l=e.getConfig(n);if(!l)return null;let{type:u,value:m,values:p,minValue:b,maxValue:v,stepValue:S}=l,k=l.default.evaluate(e),D=k;if(m){let A=e.scope;e.scope=(A||"").split("").slice(1).join(""),D=m.evaluate(e),e.scope=A}return u&&(D=Ou(u,D)),D===void 0||b===void 0&&v===void 0&&S===void 0||(typeof D=="number"?D=tm(D,b,v,S):Array.isArray(D)&&(D=D.map(A=>typeof A=="number"?tm(A,b,v,S):A))),m!==void 0&&D!==void 0&&p&&!p.includes(D)&&(D=k,u&&(D=Ou(u,D))),(u&&u!==this.type||D!==void 0&&kr(D)!==this.type)&&(D=Ou(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function sl(i){if(i instanceof Wi&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Tc||i instanceof Xl)return!1;let e=!0;return i.eachChild(n=>{e&&!sl(n)&&(e=!1)}),e}function fp(i){if(i instanceof Wi&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!fp(n)&&(e=!1)}),e}function gd(i){if(i instanceof Ho)return!1;let e=!0;return i.eachChild(n=>{e&&!gd(n)&&(e=!1)}),e}function Ru(i,e){if(i instanceof Wi&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(l=>{n&&!Ru(l,e)&&(n=!1)}),n}class gp{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let l=e[1];return n.scope.has(l)?new gp(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class im{constructor(e,n=[],l,u=new Ff,m=[],p,b){this.registry=e,this.path=n,this.key=n.map(v=>`[${v}]`).join(""),this.scope=u,this.errors=m,this.expectedType=l,this._scope=p,this.options=b}parse(e,n,l,u,m={}){return n||l?this.concat(n,l,u)._parse(e,m):this._parse(e,m)}_parse(e,n){function l(u,m,p){return p==="assert"?new Bs(m,[u]):p==="coerce"?new ua(m,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let m=u.parse(e,this);if(!m)return null;if(this.expectedType){let p=this.expectedType,b=m.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||b.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(p,b))return null}else m=l(m,p,n.typeAnnotation||"coerce");else m=l(m,p,n.typeAnnotation||"assert")}if(!(m instanceof Wl)&&m.type.kind!=="resolvedImage"&&nm(m)){let p=new Xa(this._scope,this.options);try{m=new Wl(m.type,m.evaluate(p))}catch(b){return this.error(b.message),null}}return m}return ua.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,l){let u=typeof e=="number"?this.path.concat(e):this.path,m=l?this.scope.concat(l):this.scope;return new im(this.registry,u,n||null,m,this.errors,this._scope,this.options)}error(e,...n){let l=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new Za(l,e))}checkSubtype(e,n){let l=Iu(e,n);return l&&this.error(l),l}}var Fu=im;function nm(i){if(i instanceof gp)return nm(i.boundExpression);if(i instanceof Wi&&i.name==="error"||i instanceof Sc||i instanceof Tc||i instanceof Xl||i instanceof Ho)return!1;let e=i instanceof ua||i instanceof Bs,n=!0;return i.eachChild(l=>{n=e?n&&nm(l):n&&l instanceof Wl}),!!n&&sl(i)&&Ru(i,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function _p(i,e){let n=i.length-1,l,u,m=0,p=n,b=0;for(;m<=p;)if(b=Math.floor((m+p)/2),l=i[b],u=i[b+1],l<=e){if(b===n||e<u)return b;m=b+1}else{if(!(l>e))throw new vo("Input is not a number.");p=b-1}return 0}class _d{constructor(e,n,l){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[u,m]of l)this.labels.push(u),this.outputs.push(m)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let l=n.parse(e[1],1,Gt);if(!l)return null;let u=[],m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let p=1;p<e.length;p+=2){let b=p===1?-1/0:e[p],v=e[p+1],S=p,k=p+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(u.length&&u[u.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);let D=n.parse(v,k,m);if(!D)return null;m=m||D.type,u.push([b,D])}return new _d(m,l,u)}evaluate(e){let n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);let u=this.input.evaluate(e);if(u<=n[0])return l[0].evaluate(e);let m=n.length;return u>=n[m-1]?l[m-1].evaluate(e):l[_p(n,u)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let rm=.95047,c_=1.08883,Gf=4/29,bd=6/29,qf=3*bd*bd,om=bd*bd*bd,bp=Math.PI/180,yp=180/Math.PI;function vp(i){return i>om?Math.pow(i,1/3):i/qf+Gf}function am(i){return i>bd?i*i*i:qf*(i-Gf)}function xp(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function kc(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function d_(i){let e=kc(i.r),n=kc(i.g),l=kc(i.b),u=vp((.4124564*e+.3575761*n+.1804375*l)/rm),m=vp((.2126729*e+.7151522*n+.072175*l)/1);return{l:116*m-16,a:500*(u-m),b:200*(m-vp((.0193339*e+.119192*n+.9503041*l)/c_)),alpha:i.a}}function $f(i){let e=(i.l+16)/116,n=isNaN(i.a)?e:e+i.a/500,l=isNaN(i.b)?e:e-i.b/200;return e=1*am(e),n=rm*am(n),l=c_*am(l),new mn(xp(3.2404542*n-1.5371385*e-.4985314*l),xp(-.969266*n+1.8760108*e+.041556*l),xp(.0556434*n-.2040259*e+1.0572252*l),i.alpha)}function u_(i,e,n){let l=e-i;return i+n*(l>180||l<-180?l-360*Math.round(l/360):l)}let sm={forward:d_,reverse:$f,interpolate:function(i,e,n){return{l:ri(i.l,e.l,n),a:ri(i.a,e.a,n),b:ri(i.b,e.b,n),alpha:ri(i.alpha,e.alpha,n)}}},yd={forward:function(i){let{l:e,a:n,b:l}=d_(i),u=Math.atan2(l,n)*yp;return{h:u<0?u+360:u,c:Math.sqrt(n*n+l*l),l:e,alpha:i.a}},reverse:function(i){let e=i.h*bp,n=i.c;return $f({l:i.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:i.alpha})},interpolate:function(i,e,n){return{h:u_(i.h,e.h,n),c:ri(i.c,e.c,n),l:ri(i.l,e.l,n),alpha:ri(i.alpha,e.alpha,n)}}};var h_=Object.freeze({__proto__:null,hcl:yd,lab:sm});class Ma{constructor(e,n,l,u,m){this.type=e,this.operator=n,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(let[p,b]of m)this.labels.push(p),this.outputs.push(b)}static interpolationFactor(e,n,l,u){let m=0;if(e.name==="exponential")m=wp(n,e.base,l,u);else if(e.name==="linear")m=wp(n,1,l,u);else if(e.name==="cubic-bezier"){let p=e.controlPoints;m=new Mh(p[0],p[1],p[2],p[3]).solve(wp(n,1,l,u))}return m}static parse(e,n){let[l,u,m,...p]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){let S=u[1];if(typeof S!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:S}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{let S=u.slice(1);if(S.length!==4||S.some(k=>typeof k!="number"||k<0||k>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,Gt),!m)return null;let b=[],v=null;l==="interpolate-hcl"||l==="interpolate-lab"?v=oa:n.expectedType&&n.expectedType.kind!=="value"&&(v=n.expectedType);for(let S=0;S<p.length;S+=2){let k=p[S],D=p[S+1],A=S+3,L=S+4;if(typeof k!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(b.length&&b[b.length-1][0]>=k)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);let z=n.parse(D,L,v);if(!z)return null;v=v||z.type,b.push([k,z])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new Ma(v,l,u,m,b):n.error(`Type ${Yr(v)} is not interpolatable.`)}evaluate(e){let n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);let u=this.input.evaluate(e);if(u<=n[0])return l[0].evaluate(e);let m=n.length;if(u>=n[m-1])return l[m-1].evaluate(e);let p=_p(n,u),b=Ma.interpolationFactor(this.interpolation,u,n[p],n[p+1]),v=l[p].evaluate(e),S=l[p+1].evaluate(e);return this.operator==="interpolate"?vc[this.type.kind.toLowerCase()](v,S,b):this.operator==="interpolate-hcl"?yd.reverse(yd.interpolate(yd.forward(v),yd.forward(S),b)):sm.reverse(sm.interpolate(sm.forward(v),sm.forward(S),b))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)n.push(this.labels[l],this.outputs[l].serialize());return n}}function wp(i,e,n,l){let u=l-n,m=i-n;return u===0?0:e===1?m/u:(Math.pow(e,m)-1)/(Math.pow(e,u)-1)}class Lu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let l=null,u=n.expectedType;u&&u.kind!=="value"&&(l=u);let m=[];for(let b of e.slice(1)){let v=n.parse(b,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!v)return null;l=l||v.type,m.push(v)}let p=u&&m.some(b=>Iu(u,b.type));return new Lu(p?ln:l,m)}evaluate(e){let n,l=null,u=0;for(let m of this.args){if(u++,l=m.evaluate(e),l&&l instanceof Ao&&!l.available&&(n||(n=l),l=null,u===this.args.length))return n;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Cp{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let l=[];for(let m=1;m<e.length-1;m+=2){let p=e[m];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,m);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);let b=n.parse(e[m+1],m+1);if(!b)return null;l.push([p,b])}let u=n.parse(e[e.length-1],e.length-1,n.expectedType,l);return u?new Cp(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,l]of this.bindings)e.push(n,l.serialize());return e.push(this.result.serialize()),e}}class lm{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let l=n.parse(e[1],1,Gt),u=n.parse(e[2],2,br(n.expectedType||ln));return l&&u?new lm(u.type.itemType,l,u):null}evaluate(e){let n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new vo(`Array index out of bounds: ${n} < 0.`);if(n>=l.length)throw new vo(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n!==Math.floor(n))throw new vo(`Array index must be an integer, but found ${n} instead.`);return l[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Sn{constructor(e,n){this.type=rn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let l=n.parse(e[1],1,ln),u=n.parse(e[2],2,ln);return l&&u?Lf(l.type,[rn,nn,Gt,wu,ln])?new Sn(l,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(l.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!xc(n,["boolean","string","number","null"]))throw new vo(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(kr(n))} instead.`);if(!xc(l,["string","array"]))throw new vo(`Expected second argument to be of type array or string, but found ${Yr(kr(l))} instead.`);return l.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Sp{constructor(e,n,l){this.type=Gt,this.needle=e,this.haystack=n,this.fromIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let l=n.parse(e[1],1,ln),u=n.parse(e[2],2,ln);if(!l||!u)return null;if(!Lf(l.type,[rn,nn,Gt,wu,ln]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(l.type)} instead`);if(e.length===4){let m=n.parse(e[3],3,Gt);return m?new Sp(l,u,m):null}return new Sp(l,u)}evaluate(e){let n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!xc(n,["boolean","string","number","null"]))throw new vo(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(kr(n))} instead.`);if(!xc(l,["string","array"]))throw new vo(`Expected second argument to be of type array or string, but found ${Yr(kr(l))} instead.`);if(this.fromIndex){let u=this.fromIndex.evaluate(e);return l.indexOf(n,u)}return l.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class zu{constructor(e,n,l,u,m,p){this.inputType=e,this.type=n,this.input=l,this.cases=u,this.outputs=m,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let l,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);let m={},p=[];for(let S=2;S<e.length-1;S+=2){let k=e[S],D=e[S+1];Array.isArray(k)||(k=[k]);let A=n.concat(S);if(k.length===0)return A.error("Expected at least one branch label.");for(let z of k){if(typeof z!="number"&&typeof z!="string")return A.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return A.error("Numeric branch labels must be integer values.");if(l){if(A.checkSubtype(l,kr(z)))return null}else l=kr(z);if(m[String(z)]!==void 0)return A.error("Branch labels must be unique.");m[String(z)]=p.length}let L=n.parse(D,S,u);if(!L)return null;u=u||L.type,p.push(L)}let b=n.parse(e[1],1,ln);if(!b)return null;let v=n.parse(e[e.length-1],e.length-1,u);return v?b.type.kind!=="value"&&n.concat(1).checkSubtype(l,b.type)?null:new zu(l,u,b,m,p,v):null}evaluate(e){let n=this.input.evaluate(e);return(kr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),l=[],u={};for(let p of n){let b=u[this.cases[p]];b===void 0?(u[this.cases[p]]=l.length,l.push([this.cases[p],[p]])):l[b][1].push(p)}let m=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,b]of l)e.push(b.length===1?m(b[0]):b.map(m)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class vd{constructor(e,n,l){this.type=e,this.branches=n,this.otherwise=l}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);let u=[];for(let p=1;p<e.length-1;p+=2){let b=n.parse(e[p],p,rn);if(!b)return null;let v=n.parse(e[p+1],p+1,l);if(!v)return null;u.push([b,v]),l=l||v.type}let m=n.parse(e[e.length-1],e.length-1,l);return m?new vd(l,u,m):null}evaluate(e){for(let[n,l]of this.branches)if(n.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,l]of this.branches)e(n),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class cm{constructor(e,n,l,u){this.type=e,this.input=n,this.beginIndex=l,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let l=n.parse(e[1],1,ln),u=n.parse(e[2],2,Gt);if(!l||!u)return null;if(!Lf(l.type,[br(ln),nn,ln]))return n.error(`Expected first argument to be of type array or string, but found ${Yr(l.type)} instead`);if(e.length===4){let m=n.parse(e[3],3,Gt);return m?new cm(l.type,l,u,m):null}return new cm(l.type,l,u)}evaluate(e){let n=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!xc(n,["string","array"]))throw new vo(`Expected first argument to be of type array or string, but found ${Yr(kr(n))} instead.`);if(this.endIndex){let u=this.endIndex.evaluate(e);return n.slice(l,u)}return n.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function dm(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function m_(i,e,n,l){return l.compare(e,n)===0}function Go(i,e,n){let l=i!=="=="&&i!=="!=";return class UA{constructor(m,p,b){this.type=rn,this.lhs=m,this.rhs=p,this.collator=b,this.hasUntypedArgument=m.type.kind==="value"||p.type.kind==="value"}static parse(m,p){if(m.length!==3&&m.length!==4)return p.error("Expected two or three arguments.");let b=m[0],v=p.parse(m[1],1,ln);if(!v)return null;if(!dm(b,v.type))return p.concat(1).error(`"${b}" comparisons are not supported for type '${Yr(v.type)}'.`);let S=p.parse(m[2],2,ln);if(!S)return null;if(!dm(b,S.type))return p.concat(2).error(`"${b}" comparisons are not supported for type '${Yr(S.type)}'.`);if(v.type.kind!==S.type.kind&&v.type.kind!=="value"&&S.type.kind!=="value")return p.error(`Cannot compare types '${Yr(v.type)}' and '${Yr(S.type)}'.`);l&&(v.type.kind==="value"&&S.type.kind!=="value"?v=new Bs(S.type,[v]):v.type.kind!=="value"&&S.type.kind==="value"&&(S=new Bs(v.type,[S])));let k=null;if(m.length===4){if(v.type.kind!=="string"&&S.type.kind!=="string"&&v.type.kind!=="value"&&S.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(k=p.parse(m[3],3,zs),!k)return null}return new UA(v,S,k)}evaluate(m){let p=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){let v=kr(p),S=kr(b);if(v.kind!==S.kind||v.kind!=="string"&&v.kind!=="number")throw new vo(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${v.kind}, ${S.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){let v=kr(p),S=kr(b);if(v.kind!=="string"||S.kind!=="string")return e(m,p,b)}return this.collator?n(m,p,b,this.collator.evaluate(m)):e(m,p,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){let m=[i];return this.eachChild(p=>{m.push(p.serialize())}),m}}}let pb=Go("==",function(i,e,n){return e===n},m_),um=Go("!=",function(i,e,n){return e!==n},function(i,e,n,l){return!m_(0,e,n,l)}),Ip=Go("<",function(i,e,n){return e<n},function(i,e,n,l){return l.compare(e,n)<0}),Yf=Go(">",function(i,e,n){return e>n},function(i,e,n,l){return l.compare(e,n)>0}),Zf=Go("<=",function(i,e,n){return e<=n},function(i,e,n,l){return l.compare(e,n)<=0}),ka=Go(">=",function(i,e,n){return e>=n},function(i,e,n,l){return l.compare(e,n)>=0});class bs{constructor(e,n,l,u,m,p){this.type=nn,this.number=e,this.locale=n,this.currency=l,this.unit=u,this.minFractionDigits=m,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let l=n.parse(e[1],1,Gt);if(!l)return null;let u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let m=null;if(u.locale&&(m=n.parse(u.locale,1,nn),!m))return null;let p=null;if(u.currency&&(p=n.parse(u.currency,1,nn),!p))return null;let b=null;if(u.unit&&(b=n.parse(u.unit,1,nn),!b))return null;let v=null;if(u["min-fraction-digits"]&&(v=n.parse(u["min-fraction-digits"],1,Gt),!v))return null;let S=null;return u["max-fraction-digits"]&&(S=n.parse(u["max-fraction-digits"],1,Gt),!S)?null:new bs(l,m,p,b,v,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class hm{constructor(e){this.type=Gt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let l=n.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Yr(l.type)} instead.`):new hm(l):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new vo(`Expected value to be of type string or array, but found ${Yr(kr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function Xf(i){return function(){i=1831565813+(i|=0)|0;let e=Math.imul(i^i>>>15,1|i);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let ll={"==":pb,"!=":um,">":Yf,"<":Ip,">=":ka,"<=":Zf,array:Bs,at:lm,boolean:Bs,case:vd,coalesce:Lu,collator:Sc,format:wc,image:Hl,in:Sn,"index-of":Sp,interpolate:Ma,"interpolate-hcl":Ma,"interpolate-lab":Ma,length:hm,let:Cp,literal:Wl,match:zu,number:Bs,"number-format":bs,object:Bs,slice:cm,step:_d,string:Bs,"to-boolean":ua,"to-color":ua,"to-number":ua,"to-string":ua,var:gp,within:Tc,distance:Xl,config:Ho};function Qf(i,[e,n,l,u]){e=e.evaluate(i),n=n.evaluate(i),l=l.evaluate(i);let m=u?u.evaluate(i):1,p=Tu(e,n,l,m);if(p)throw new vo(p);return new mn(e/255*m,n/255*m,l/255*m,m)}function Tp(i,[e,n,l,u]){e=e.evaluate(i),n=n.evaluate(i),l=l.evaluate(i);let m=u?u.evaluate(i):1,p=function(S,k,D,A){return typeof S=="number"&&S>=0&&S<=360?typeof k=="number"&&k>=0&&k<=100&&typeof D=="number"&&D>=0&&D<=100?A===void 0||typeof A=="number"&&A>=0&&A<=1?null:`Invalid hsla value [${[S,k,D,A].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof A=="number"?[S,k,D,A]:[S,k,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof A=="number"?[S,k,D,A]:[S,k,D]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,l,m);if(p)throw new vo(p);let b=`hsla(${e}, ${n}%, ${l}%, ${m})`,v=mn.parse(b);if(!v)throw new vo(`Failed to parse HSLA color: ${b}`);return v}function Kf(i,e){return i in e}function mm(i,e){let n=e[i];return n===void 0?null:n}function Ql(i){return{type:i}}function Kl(i){return{result:"success",value:i}}function xd(i){return{result:"error",value:i}}function Jl(i,e){return!!i&&!!i.parameters&&i.parameters.indexOf(e)>-1}function pm(i){return i["property-type"]==="data-driven"}function p_(i){return Jl(i.expression,"measure-light")}function f(i){return Jl(i.expression,"zoom")}function a(i){return!!i.expression&&i.expression.interpolated}function h(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function _(i){return i}function x(i,e){let n=e.type==="color",l=i.stops&&typeof i.stops[0][0]=="object",u=l||!(l||i.property!==void 0),m=i.type||(a(e)?"exponential":"interval");if(n&&((i=Vl({},i)).stops&&(i.stops=i.stops.map(S=>[S[0],mn.parse(S[1])])),i.default=mn.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!h_[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,b,v;if(m==="exponential")p=P;else if(m==="interval")p=E;else if(m==="categorical"){p=T,b=Object.create(null);for(let S of i.stops)b[S[0]]=S[1];v=typeof i.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);p=O}if(l){let S={},k=[];for(let L=0;L<i.stops.length;L++){let z=i.stops[L],V=z[0].zoom;S[V]===void 0&&(S[V]={zoom:V,type:i.type,property:i.property,default:i.default,stops:[]},k.push(V)),S[V].stops.push([z[0].value,z[1]])}let D=[];for(let L of k)D.push([S[L].zoom,x(S[L],e)]);let A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:Ma.interpolationFactor.bind(void 0,A),zoomStops:D.map(L=>L[0]),evaluate:({zoom:L},z)=>P({stops:D,base:i.base},e,L).evaluate(L,z)}}if(u){let S=m==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Ma.interpolationFactor.bind(void 0,S),zoomStops:i.stops.map(k=>k[0]),evaluate:({zoom:k})=>p(i,e,k,b,v)}}return{kind:"source",evaluate(S,k){let D=k&&k.properties?k.properties[i.property]:void 0;return D===void 0?C(i.default,e.default):p(i,e,D,b,v)}}}function C(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function T(i,e,n,l,u){return C(typeof n===u?l[n]:void 0,i.default,e.default)}function E(i,e,n){if(Cc(n)!=="number")return C(i.default,e.default);let l=i.stops.length;if(l===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[l-1][0])return i.stops[l-1][1];let u=_p(i.stops.map(m=>m[0]),n);return i.stops[u][1]}function P(i,e,n){let l=i.base!==void 0?i.base:1;if(Cc(n)!=="number")return C(i.default,e.default);let u=i.stops.length;if(u===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[u-1][0])return i.stops[u-1][1];let m=_p(i.stops.map(k=>k[0]),n),p=function(k,D,A,L){let z=L-A,V=k-A;return z===0?0:D===1?V/z:(Math.pow(D,V)-1)/(Math.pow(D,z)-1)}(n,l,i.stops[m][0],i.stops[m+1][0]),b=i.stops[m][1],v=i.stops[m+1][1],S=vc[e.type]||_;if(i.colorSpace&&i.colorSpace!=="rgb"){let k=h_[i.colorSpace];S=(D,A)=>k.reverse(k.interpolate(k.forward(D),k.forward(A),p))}return typeof b.evaluate=="function"?{evaluate(...k){let D=b.evaluate.apply(void 0,k),A=v.evaluate.apply(void 0,k);if(D!==void 0&&A!==void 0)return S(D,A,p)}}:S(b,v,p)}function O(i,e,n){return e.type==="color"?n=mn.parse(n):e.type==="formatted"?n=co.fromString(n.toString()):e.type==="resolvedImage"?n=Ao.fromString(n.toString()):Cc(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),C(n,i.default,e.default)}Wi.register(ll,{error:[{kind:"error"},[nn],(i,[e])=>{throw new vo(e.evaluate(i))}],typeof:[nn,[ln],(i,[e])=>Yr(kr(e.evaluate(i)))],"to-rgba":[br(Gt,4),[oa],(i,[e])=>e.evaluate(i).toRenderColor(null).toArray()],rgb:[oa,[Gt,Gt,Gt],Qf],rgba:[oa,[Gt,Gt,Gt,Gt],Qf],hsl:[oa,[Gt,Gt,Gt],Tp],hsla:[oa,[Gt,Gt,Gt,Gt],Tp],has:{type:rn,overloads:[[[nn],(i,[e])=>Kf(e.evaluate(i),i.properties())],[[nn,Cu],(i,[e,n])=>Kf(e.evaluate(i),n.evaluate(i))]]},get:{type:ln,overloads:[[[nn],(i,[e])=>mm(e.evaluate(i),i.properties())],[[nn,Cu],(i,[e,n])=>mm(e.evaluate(i),n.evaluate(i))]]},"feature-state":[ln,[nn],(i,[e])=>mm(e.evaluate(i),i.featureState||{})],properties:[Cu,[],i=>i.properties()],"geometry-type":[nn,[],i=>i.geometryType()],id:[ln,[],i=>i.id()],zoom:[Gt,[],i=>i.globals.zoom],pitch:[Gt,[],i=>i.globals.pitch||0],"distance-from-center":[Gt,[],i=>i.distanceFromCenter()],"measure-light":[Gt,[nn],(i,[e])=>i.measureLight(e.evaluate(i))],"heatmap-density":[Gt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Gt,[],i=>i.globals.lineProgress||0],"raster-value":[Gt,[],i=>i.globals.rasterValue||0],"raster-particle-speed":[Gt,[],i=>i.globals.rasterParticleSpeed||0],"sky-radial-progress":[Gt,[],i=>i.globals.skyRadialProgress||0],accumulated:[ln,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Gt,Ql(Gt),(i,e)=>{let n=0;for(let l of e)n+=l.evaluate(i);return n}],"*":[Gt,Ql(Gt),(i,e)=>{let n=1;for(let l of e)n*=l.evaluate(i);return n}],"-":{type:Gt,overloads:[[[Gt,Gt],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[Gt],(i,[e])=>-e.evaluate(i)]]},"/":[Gt,[Gt,Gt],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[Gt,[Gt,Gt],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[Gt,[],()=>Math.LN2],pi:[Gt,[],()=>Math.PI],e:[Gt,[],()=>Math.E],"^":[Gt,[Gt,Gt],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[Gt,[Gt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Gt,[Gt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Gt,[Gt],(i,[e])=>Math.log(e.evaluate(i))],log2:[Gt,[Gt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Gt,[Gt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Gt,[Gt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Gt,[Gt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Gt,[Gt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Gt,[Gt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Gt,[Gt],(i,[e])=>Math.atan(e.evaluate(i))],min:[Gt,Ql(Gt),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[Gt,Ql(Gt),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[Gt,[Gt],(i,[e])=>Math.abs(e.evaluate(i))],round:[Gt,[Gt],(i,[e])=>{let n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Gt,[Gt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Gt,[Gt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[rn,[nn,ln],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[rn,[ln],(i,[e])=>i.id()===e.value],"filter-type-==":[rn,[nn],(i,[e])=>i.geometryType()===e.value],"filter-<":[rn,[nn,ln],(i,[e,n])=>{let l=i.properties()[e.value],u=n.value;return typeof l==typeof u&&l<u}],"filter-id-<":[rn,[ln],(i,[e])=>{let n=i.id(),l=e.value;return typeof n==typeof l&&n<l}],"filter->":[rn,[nn,ln],(i,[e,n])=>{let l=i.properties()[e.value],u=n.value;return typeof l==typeof u&&l>u}],"filter-id->":[rn,[ln],(i,[e])=>{let n=i.id(),l=e.value;return typeof n==typeof l&&n>l}],"filter-<=":[rn,[nn,ln],(i,[e,n])=>{let l=i.properties()[e.value],u=n.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[rn,[ln],(i,[e])=>{let n=i.id(),l=e.value;return typeof n==typeof l&&n<=l}],"filter->=":[rn,[nn,ln],(i,[e,n])=>{let l=i.properties()[e.value],u=n.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[rn,[ln],(i,[e])=>{let n=i.id(),l=e.value;return typeof n==typeof l&&n>=l}],"filter-has":[rn,[ln],(i,[e])=>e.value in i.properties()],"filter-has-id":[rn,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[rn,[br(nn)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[rn,[br(ln)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[rn,[nn,br(ln)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[rn,[nn,br(ln)],(i,[e,n])=>function(l,u,m,p){for(;m<=p;){let b=m+p>>1;if(u[b]===l)return!0;u[b]>l?p=b-1:m=b+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:rn,overloads:[[[rn,rn],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[Ql(rn),(i,e)=>{for(let n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:rn,overloads:[[[rn,rn],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[Ql(rn),(i,e)=>{for(let n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[rn,[rn],(i,[e])=>!e.evaluate(i)],"is-supported-script":[rn,[nn],(i,[e])=>{let n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[nn,[nn],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[nn,[nn],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[nn,Ql(ln),(i,e)=>e.map(n=>_s(n.evaluate(i))).join("")],"resolved-locale":[nn,[zs],(i,[e])=>e.evaluate(i).resolvedLocale()],random:[Gt,[Gt,Gt,ln],(i,e)=>{let[n,l,u]=e.map(p=>p.evaluate(i));if(n>l||n===l)return n;let m;if(typeof u=="string")m=function(p){let b=0;if(p.length===0)return b;for(let v=0;v<p.length;v++)b=(b<<5)-b+p.charCodeAt(v),b|=0;return b}(u);else{if(typeof u!="number")throw new vo(`Invalid seed input: ${u}`);m=u}return n+Xf(m)()*(l-n)}]});class B{constructor(e,n,l,u){this.expression=e,this._warningHistory={},this._evaluator=new Xa(l,u),this._defaultValue=n?function(m){return m.type==="color"&&(h(m.default)||Array.isArray(m.default))?new mn(0,0,0,0):m.type==="color"?mn.parse(m.default)||null:m.default===void 0?null:m.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,l,u,m,p,b,v){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=u||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,l,u,m,p,b,v){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=v||null;try{let S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new vo(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function j(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ll}function G(i,e,n,l){let u=new Fu(ll,[],e?function(p){let b={color:oa,string:nn,number:Gt,enum:nn,boolean:rn,formatted:Su,resolvedImage:Cr};return p.type==="array"?br(b[p.value]||ln,p.length):b[p.type]}(e):void 0,void 0,void 0,n,l),m=u.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Kl(new B(m,e,n,l)):xd(u.errors)}class q{constructor(e,n,l){this.kind=e,this._styleExpression=n,this.isLightConstant=l,this.isStateDependent=e!=="constant"&&!fp(n.expression),this.isConfigDependent=!gd(n.expression)}evaluateWithoutErrorHandling(e,n,l,u,m,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,l,u,m,p)}evaluate(e,n,l,u,m,p){return this._styleExpression.evaluate(e,n,l,u,m,p)}}class K{constructor(e,n,l,u,m){this.kind=e,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!fp(n.expression),this.isLightConstant=m,this.isConfigDependent=!gd(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,l,u,m,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,l,u,m,p)}evaluate(e,n,l,u,m,p){return this._styleExpression.evaluate(e,n,l,u,m,p)}interpolationFactor(e,n,l){return this.interpolationType?Ma.interpolationFactor(this.interpolationType,e,n,l):0}}function J(i,e,n,l){if((i=G(i,e,n,l)).result==="error")return i;let u=i.value.expression,m=sl(u);if(!m&&!pm(e))return xd([new Za("","data expressions not supported")]);let p=Ru(u,["zoom","pitch","distance-from-center"]);if(!p&&!f(e))return xd([new Za("","zoom expressions not supported")]);let b=Ru(u,["measure-light"]);if(!b&&!p_(e))return xd([new Za("","measure-light expression not supported")]);let v=e.expression&&e.expression.relaxZoomRestriction,S=te(u);return S||p||v?S instanceof Za?xd([S]):S instanceof Ma&&!a(e)?xd([new Za("",'"interpolate" expressions cannot be used with this property')]):Kl(S?new K(m?"camera":"composite",i.value,S.labels,S instanceof Ma?S.interpolation:void 0,b):new q(m?"constant":"source",i.value,b)):xd([new Za("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ee{constructor(e,n){this._parameters=e,this._specification=n,Vl(this,x(this._parameters,this._specification))}static deserialize(e){return new ee(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function te(i){let e=null;if(i instanceof Cp)e=te(i.result);else if(i instanceof Lu){for(let n of i.args)if(e=te(n),e)break}else(i instanceof _d||i instanceof Ma)&&i.input instanceof Wi&&i.input.name==="zoom"&&(e=i);return e instanceof Za||i.eachChild(n=>{let l=te(n);l instanceof Za?e=l:e&&l&&e!==l&&(e=new Za("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var ue=he,ce=3;function he(i,e,n){var l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var u=new Int32Array(this.arrayBuffer);i=u[0],this.d=(e=u[1])+2*(n=u[2]);for(var m=0;m<this.d*this.d;m++){var p=u[ce+m],b=u[ce+m+1];l.push(p===b?null:u.subarray(p,b))}var v=u[ce+l.length+1];this.keys=u.subarray(u[ce+l.length],v),this.bboxes=u.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var S=0;S<this.d*this.d;S++)l.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=n,this.scale=e/i,this.uid=0;var k=n/e*i;this.min=-k,this.max=i+k}he.prototype.insert=function(i,e,n,l,u){this._forEachCell(e,n,l,u,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(u)},he.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},he.prototype._insertCell=function(i,e,n,l,u,m){this.cells[u].push(m)},he.prototype.query=function(i,e,n,l,u){var m=this.min,p=this.max;if(i<=m&&e<=m&&p<=n&&p<=l&&!u)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(i,e,n,l,this._queryCell,b,{},u),b},he.prototype._queryCell=function(i,e,n,l,u,m,p,b){var v=this.cells[u];if(v!==null)for(var S=this.keys,k=this.bboxes,D=0;D<v.length;D++){var A=v[D];if(p[A]===void 0){var L=4*A;(b?b(k[L+0],k[L+1],k[L+2],k[L+3]):i<=k[L+2]&&e<=k[L+3]&&n>=k[L+0]&&l>=k[L+1])?(p[A]=!0,m.push(S[A])):p[A]=!1}}},he.prototype._forEachCell=function(i,e,n,l,u,m,p,b){for(var v=this._convertToCellCoord(i),S=this._convertToCellCoord(e),k=this._convertToCellCoord(n),D=this._convertToCellCoord(l),A=v;A<=k;A++)for(var L=S;L<=D;L++){var z=this.d*L+A;if((!b||b(this._convertFromCellCoord(A),this._convertFromCellCoord(L),this._convertFromCellCoord(A+1),this._convertFromCellCoord(L+1)))&&u.call(this,i,e,n,l,z,m,p,b))return}},he.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},he.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},he.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=ce+this.cells.length+1+1,n=0,l=0;l<this.cells.length;l++)n+=this.cells[l].length;var u=new Int32Array(e+n+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var m=e,p=0;p<i.length;p++){var b=i[p];u[ce+p]=m,u.set(b,m),m+=b.length}return u[ce+i.length]=m,u.set(this.keys,m),u[ce+i.length+1]=m+=this.keys.length,u.set(this.bboxes,m),m+=this.bboxes.length,u.buffer};var Ce=Ke(ue);let we={};function de(i,e,n={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writable:!1}),we[e]={klass:i,omit:n.omit||[]}}de(Object,"Object"),Ce.serialize=function(i,e){let n=i.toArrayBuffer();return e&&e.add(n),{buffer:n}},Ce.deserialize=function(i){return new Ce(i.buffer)},Object.defineProperty(Ce,"name",{value:"Grid"}),de(Ce,"Grid"),de(mn,"Color"),de(Error,"Error"),de(co,"Formatted"),de(Ul,"FormattedSection"),de(Vh,"AJAXError"),de(Ao,"ResolvedImage"),de(ee,"StylePropertyFunction"),de(B,"StyleExpression",{omit:["_evaluator"]}),de(K,"ZoomDependentExpression"),de(q,"ZoomConstantExpression"),de(Wi,"CompoundExpression",{omit:["_evaluate"]});for(let i in ll)we[ll[i]._classRegistryKey]||de(ll[i],`Expression${i}`);function me(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function fe(i){return self.ImageBitmap&&i instanceof ImageBitmap}function Ee(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(me(i)||fe(i))return e&&e.add(i),i;if(ArrayBuffer.isView(i)){let n=i;return e&&e.add(n.buffer),n}if(i instanceof ImageData)return e&&e.add(i.data.buffer),i;if(Array.isArray(i)){let n=[];for(let l of i)n.push(Ee(l,e));return n}if(i instanceof Map){let n={$name:"Map"};for(let[l,u]of i.entries())n[l]=Ee(u);return n}if(typeof i=="object"){let n=i.constructor,l=n._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);let u=n.serialize?n.serialize(i,e):{};if(!n.serialize){for(let m in i)i.hasOwnProperty(m)&&(we[l].omit.indexOf(m)>=0||(u[m]=Ee(i[m],e)));i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof i)}function We(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||me(i)||fe(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(We);if(typeof i=="object"){let e=i.$name||"Object";if(e==="Map"){let u=new Map;for(let m of Object.keys(i))m!=="$name"&&u.set(m,We(i[m]));return u}let{klass:n}=we[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);let l=Object.create(n.prototype);for(let u of Object.keys(i))u!=="$name"&&(l[u]=We(i[u]));return l}throw new Error("can't deserialize object of type "+typeof i)}let ye={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519,"CJK Unified Ideographs Extension B":i=>i>=131072&&i<=173791};function He(i){for(let e of i)if(ut(e.charCodeAt(0)))return!0;return!1}function qe(i){for(let e of i)if(!ct(e.charCodeAt(0)))return!1;return!0}function ct(i){return!(ye.Arabic(i)||ye["Arabic Supplement"](i)||ye["Arabic Extended-A"](i)||ye["Arabic Presentation Forms-A"](i)||ye["Arabic Presentation Forms-B"](i))}function ut(i){return!(i!==746&&i!==747&&(i<4352||!(ye["Bopomofo Extended"](i)||ye.Bopomofo(i)||ye["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||ye["CJK Compatibility Ideographs"](i)||ye["CJK Compatibility"](i)||ye["CJK Radicals Supplement"](i)||ye["CJK Strokes"](i)||!(!ye["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||ye["CJK Unified Ideographs Extension A"](i)||ye["CJK Unified Ideographs"](i)||ye["Enclosed CJK Letters and Months"](i)||ye["Hangul Compatibility Jamo"](i)||ye["Hangul Jamo Extended-A"](i)||ye["Hangul Jamo Extended-B"](i)||ye["Hangul Jamo"](i)||ye["Hangul Syllables"](i)||ye.Hiragana(i)||ye["Ideographic Description Characters"](i)||ye.Kanbun(i)||ye["Kangxi Radicals"](i)||ye["Katakana Phonetic Extensions"](i)||ye.Katakana(i)&&i!==12540||!(!ye["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!ye["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||ye["Unified Canadian Aboriginal Syllabics"](i)||ye["Unified Canadian Aboriginal Syllabics Extended"](i)||ye["Vertical Forms"](i)||ye["Yijing Hexagram Symbols"](i)||ye["Yi Syllables"](i)||ye["Yi Radicals"](i))))}function lt(i){return!(ut(i)||function(e){return!!(ye["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ye["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ye["Letterlike Symbols"](e)||ye["Number Forms"](e)||ye["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ye["Control Pictures"](e)&&e!==9251||ye["Optical Character Recognition"](e)||ye["Enclosed Alphanumerics"](e)||ye["Geometric Shapes"](e)||ye["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ye["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ye["CJK Symbols and Punctuation"](e)||ye.Katakana(e)||ye["Private Use Area"](e)||ye["CJK Compatibility Forms"](e)||ye["Small Form Variants"](e)||ye["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Le(i){return i>=1424&&i<=2303||ye["Arabic Presentation Forms-A"](i)||ye["Arabic Presentation Forms-B"](i)}function Ze(i,e){return!(!e&&Le(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||ye.Khmer(i))}function rt(i){for(let e of i)if(Le(e.charCodeAt(0)))return!0;return!1}let Ot="deferred",Rt="loading",Wt="loaded",Ft=null,pt="unavailable",nt=null,$t=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(pt="error"),Ft&&Ft(i)};function Ii(){bi.fire(new Ta("pluginStateChange",{pluginStatus:pt,pluginURL:nt}))}let bi=new md,Fi=function(){return pt},Gi=function(){if(pt!==Ot||!nt)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");pt=Rt,Ii(),nt&&nl({url:nt},i=>{i?$t(i):(pt=Wt,Ii())})},yn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>pt===Wt||yn.applyArabicShaping!=null,isLoading:()=>pt===Rt,setState(i){pt=i.pluginStatus,nt=i.pluginURL},isParsed:()=>yn.applyArabicShaping!=null&&yn.processBidirectionalText!=null&&yn.processStyledBidirectionalText!=null,getPluginURL:()=>nt};class Vt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,l){for(let u of n)if(!Ze(u.charCodeAt(0),l))return!1;return!0}(e,yn.isLoaded())}}class pn{constructor(e,n,l,u){this.property=e,this.value=n,this.expression=function(m,p,b,v){if(h(m))return new ee(m,p);if(j(m)||Array.isArray(m)&&m.length>0){let S=J(m,p,b,v);if(S.result==="error")throw new Error(S.value.map(k=>`${k.key}: ${k.message}`).join(", "));return S.value}{let S=m;return typeof m=="string"&&p.type==="color"&&(S=mn.parse(m)),{kind:"constant",isConfigDependent:!1,evaluate:()=>S}}}(n===void 0?e.specification.default:n,e.specification,l,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,l){return this.property.possiblyEvaluate(this,e,n,l)}}class Nn{constructor(e,n,l){this.property=e,this.value=new pn(e,void 0,n,l)}transitioned(e,n){return new qi(this.property,this.value,n,Mo({},e.transition,this.transition),e.now)}untransitioned(){return new qi(this.property,this.value,null,{},0)}}class dn{constructor(e,n,l){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=l,this.isConfigDependent=!1}getValue(e){return po(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Nn(this._values[e].property,this._scope,this._options)),this._values[e].value=new pn(this._values[e].property,n===null?void 0:po(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let l=this._properties.properties;if(e)for(let u in e){let m=e[u];if(du(u,"-transition")){let p=u.slice(0,-11);l[p]&&this.setTransition(p,m)}else l.hasOwnProperty(u)&&this.setValue(u,m)}}getTransition(e){return po(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Nn(this._values[e].property)),this._values[e].transition=po(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let l=this.getValue(n);l!==void 0&&(e[n]=l);let u=this.getTransition(n);u!==void 0&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){let l=new xi(this._properties);for(let u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(e,n._values[u]);return l}untransitioned(){let e=new xi(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class qi{constructor(e,n,l,u,m){let p=u.delay||0,b=u.duration||0;m=m||0,this.property=e,this.value=n,this.begin=m+p,this.end=this.begin+b,e.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(e,n,l){let u=e.now||0,m=this.value.possiblyEvaluate(e,n,l),p=this.prior;if(p){if(u>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(u<this.begin)return p.possiblyEvaluate(e,n,l);{let b=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,l),m,Sf(b))}}return m}}class xi{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,l){let u=new Fn(this._properties);for(let m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(e,n,l);return u}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Xn{constructor(e,n,l){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=l,this.isConfigDependent=!1}getValue(e){return po(this._values[e].value)}setValue(e,n){this._values[e]=new pn(this._values[e].property,n===null?void 0:po(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let l=this.getValue(n);l!==void 0&&(e[n]=l)}return e}possiblyEvaluate(e,n,l){let u=new Fn(this._properties);for(let m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(e,n,l);return u}}class on{constructor(e,n,l){this.property=e,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,l,u){return this.property.evaluate(this.value,this.parameters,e,n,l,u)}}class Fn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class dt{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,l){let u=vc[this.specification.type];return u?u(e,n,l):e}}class Lt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,l,u){return new on(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},l,u)}:e.expression,n)}interpolate(e,n,l){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new on(this,{kind:"constant",value:void 0},e.parameters);let u=vc[this.specification.type];return u?new on(this,{kind:"constant",value:u(e.value.value,n.value.value,l)},e.parameters):e}evaluate(e,n,l,u,m,p){return e.kind==="constant"?e.value:e.evaluate(n,l,u,m,p)}}class Sr{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,u){return!!e.expression.evaluate(n,null,{},l,u)}interpolate(){return!1}}class vn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new Vt(0,{});for(let l in e){let u=e[l];u.specification.overridable&&this.overridableProperties.push(l);let m=this.defaultPropertyValues[l]=new pn(u,void 0),p=this.defaultTransitionablePropertyValues[l]=new Nn(u);this.defaultTransitioningPropertyValues[l]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=m.possiblyEvaluate(n)}}}de(Lt,"DataDrivenProperty"),de(dt,"DataConstantProperty"),de(Sr,"ColorRampProperty");var Ue=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ja(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function qo(i){if(Array.isArray(i))return i.map(qo);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let e={};for(let n in i)e[n]=qo(i[n]);return e}return Ja(i)}function Zr(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let e of i.slice(1))if(!Zr(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Gn(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Zr(i)||(i=Us(i));let n=i,l=!0;try{l=function(S){if(!Ea(S))return S;let k=qo(S);return js(k),k=sa(k),k}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let u=Ue[`filter_${e}`],m=G(l,u),p=null;if(m.result==="error")throw new Error(m.value.map(S=>`${S.key}: ${S.message}`).join(", "));p=(S,k,D)=>m.value.evaluate(S,k,{},D);let b=null,v=null;if(l!==n){let S=G(n,u);if(S.result==="error")throw new Error(S.value.map(k=>`${k.key}: ${k.message}`).join(", "));b=(k,D,A,L,z)=>S.value.evaluate(k,D,{},A,void 0,void 0,L,z),v=!sl(S.value.expression)}return{filter:p,dynamicFilter:b||void 0,needGeometry:es(l),needFeature:!!v}}function sa(i){if(!Array.isArray(i))return i;let e=function(n){if(Ec.has(n[0])){for(let l=1;l<n.length;l++)if(Ea(n[l]))return!0}return n}(i);return e===!0?e:e.map(n=>sa(n))}function js(i){let e=!1,n=[];if(i[0]==="case"){for(let l=1;l<i.length-1;l+=2)e=e||Ea(i[l]),n.push(i[l+1]);n.push(i[i.length-1])}else if(i[0]==="match"){e=e||Ea(i[1]);for(let l=2;l<i.length-1;l+=2)n.push(i[l+1]);n.push(i[i.length-1])}else if(i[0]==="step"){e=e||Ea(i[1]);for(let l=1;l<i.length-1;l+=2)n.push(i[l+1])}e&&(i.length=0,i.push("any",...n));for(let l=1;l<i.length;l++)js(i[l])}function Ea(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<i.length;n++)if(Ea(i[n]))return!0;return!1}let Ec=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Dc(i,e){return i<e?-1:i>e?1:0}function es(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(es(i[e]))return!0;return!1}function Us(i){if(!i)return!0;let e=i[0];return i.length<=1?e!=="any":e==="=="?cl(i[1],i[2],"=="):e==="!="?wd(cl(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?cl(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(Us))):e==="all"?["all"].concat(i.slice(1).map(Us)):e==="none"?["all"].concat(i.slice(1).map(Us).map(wd)):e==="in"?Bu(i[1],i.slice(2)):e==="!in"?wd(Bu(i[1],i.slice(2))):e==="has"?Nu(i[1]):e!=="!has"||wd(Nu(i[1]));var n}function cl(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Bu(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Dc)]]:["filter-in-small",i,["literal",e]]}}function Nu(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function wd(i){return["!",i]}let Vu="";function fm(i,e){return e?`${i}${Vu}${e}`:i}let gm="-transition",Jf=new Set(["fill","line","background","hillshade","raster"]);class eo extends md{constructor(e,n,l,u,m){if(super(),this.id=e.id,this.fqid=fm(this.id,l),this.type=e.type,this.scope=l,this.lut=u,this.options=m,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new Xn(n.layout,this.scope,m),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new dn(n.paint,this.scope,m);for(let p in e.paint)this.setPaintProperty(p,e.paint[p]);for(let p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fn(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return Jf.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,n),this.isConfigDependent=this.isConfigDependent||l.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return du(e,gm)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let l=this._transitionablePaint,u=l._properties.properties;if(du(e,gm)){let D=e.slice(0,-11);return u[D]&&l.setTransition(D,n||void 0),!1}if(!u[e])return!1;let m=l._values[e],p=m.value.isDataDriven(),b=m.value;l.setValue(e,n),this.isConfigDependent=this.isConfigDependent||l.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let v=l._values[e].value,S=v.isDataDriven(),k=du(e,"pattern")||e==="line-dasharray";return S||p||k||this._handleOverridablePaintPropertyUpdate(e,b,v)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,l){return null}_handleOverridablePaintPropertyUpdate(e,n,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return dd({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof on&&pm(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Gn(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,l,u,m,p,b,v,S){}queryIntersectsMatchingFeature(e,n,l,u){}}let Mp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class dl{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class or{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xn(i,e=1){let n=0,l=0;return{members:i.map(u=>{let m=Mp[u.type].BYTES_PER_ELEMENT,p=n=fb(n,Math.max(e,m)),b=u.components||1;return l=Math.max(l,m),n+=m*b,{name:u.name,type:u.type,components:b,offset:p}}),size:fb(n,Math.max(l,e)),alignment:e}}function fb(i,e){return Math.ceil(i/e)*e}class ys extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){let u=2*e;return this.int16[u+0]=n,this.int16[u+1]=l,e}}ys.prototype.bytesPerElement=4,de(ys,"StructArrayLayout2i4");class eg extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){let m=3*e;return this.int16[m+0]=n,this.int16[m+1]=l,this.int16[m+2]=u,e}}eg.prototype.bytesPerElement=6,de(eg,"StructArrayLayout3i6");class Da extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,u)}emplace(e,n,l,u,m){let p=4*e;return this.int16[p+0]=n,this.int16[p+1]=l,this.int16[p+2]=u,this.int16[p+3]=m,e}}Da.prototype.bytesPerElement=8,de(Da,"StructArrayLayout4i8");class Cd extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,l,u,m)}emplace(e,n,l,u,m,p){let b=5*e;return this.int16[b+0]=n,this.int16[b+1]=l,this.int16[b+2]=u,this.int16[b+3]=m,this.int16[b+4]=p,e}}Cd.prototype.bytesPerElement=10,de(Cd,"StructArrayLayout5i10");class gb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m,p,b){let v=this.length;return this.resize(v+1),this.emplace(v,e,n,l,u,m,p,b)}emplace(e,n,l,u,m,p,b,v){let S=6*e,k=12*e,D=3*e;return this.int16[S+0]=n,this.int16[S+1]=l,this.uint8[k+4]=u,this.uint8[k+5]=m,this.uint8[k+6]=p,this.uint8[k+7]=b,this.float32[D+2]=v,e}}gb.prototype.bytesPerElement=12,de(gb,"StructArrayLayout2i4ub1f12");class Sd extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,u)}emplace(e,n,l,u,m){let p=4*e;return this.float32[p+0]=n,this.float32[p+1]=l,this.float32[p+2]=u,this.float32[p+3]=m,e}}Sd.prototype.bytesPerElement=16,de(Sd,"StructArrayLayout4f16");class ju extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){let m=3*e;return this.float32[m+0]=n,this.float32[m+1]=l,this.float32[m+2]=u,e}}ju.prototype.bytesPerElement=12,de(ju,"StructArrayLayout3f12");class Uu extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,l,u,m)}emplace(e,n,l,u,m,p){let b=6*e,v=3*e;return this.uint16[b+0]=n,this.uint16[b+1]=l,this.uint16[b+2]=u,this.uint16[b+3]=m,this.float32[v+2]=p,e}}Uu.prototype.bytesPerElement=12,de(Uu,"StructArrayLayout4ui1f12");class f_ extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,u)}emplace(e,n,l,u,m){let p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=l,this.uint16[p+2]=u,this.uint16[p+3]=m,e}}f_.prototype.bytesPerElement=8,de(f_,"StructArrayLayout4ui8");class g_ extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m,p){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,u,m,p)}emplace(e,n,l,u,m,p,b){let v=6*e;return this.int16[v+0]=n,this.int16[v+1]=l,this.int16[v+2]=u,this.int16[v+3]=m,this.int16[v+4]=p,this.int16[v+5]=b,e}}g_.prototype.bytesPerElement=12,de(g_,"StructArrayLayout6i12");class _b extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m,p,b,v,S,k,D,A){let L=this.length;return this.resize(L+1),this.emplace(L,e,n,l,u,m,p,b,v,S,k,D,A)}emplace(e,n,l,u,m,p,b,v,S,k,D,A,L){let z=12*e;return this.int16[z+0]=n,this.int16[z+1]=l,this.int16[z+2]=u,this.int16[z+3]=m,this.uint16[z+4]=p,this.uint16[z+5]=b,this.uint16[z+6]=v,this.uint16[z+7]=S,this.int16[z+8]=k,this.int16[z+9]=D,this.int16[z+10]=A,this.int16[z+11]=L,e}}_b.prototype.bytesPerElement=24,de(_b,"StructArrayLayout4i4ui4i24");class bb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m,p){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,u,m,p)}emplace(e,n,l,u,m,p,b){let v=10*e,S=5*e;return this.int16[v+0]=n,this.int16[v+1]=l,this.int16[v+2]=u,this.float32[S+2]=m,this.float32[S+3]=p,this.float32[S+4]=b,e}}bb.prototype.bytesPerElement=20,de(bb,"StructArrayLayout3i3f20");class yb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}yb.prototype.bytesPerElement=4,de(yb,"StructArrayLayout1ul4");class _m extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}_m.prototype.bytesPerElement=4,de(_m,"StructArrayLayout1f4");class Wu extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){let u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=l,e}}Wu.prototype.bytesPerElement=4,de(Wu,"StructArrayLayout2ui4");class vb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m,p,b,v,S,k,D,A,L){let z=this.length;return this.resize(z+1),this.emplace(z,e,n,l,u,m,p,b,v,S,k,D,A,L)}emplace(e,n,l,u,m,p,b,v,S,k,D,A,L,z){let V=20*e,H=10*e;return this.int16[V+0]=n,this.int16[V+1]=l,this.int16[V+2]=u,this.int16[V+3]=m,this.int16[V+4]=p,this.float32[H+3]=b,this.float32[H+4]=v,this.float32[H+5]=S,this.float32[H+6]=k,this.int16[V+14]=D,this.uint32[H+8]=A,this.uint16[V+18]=L,this.uint16[V+19]=z,e}}vb.prototype.bytesPerElement=40,de(vb,"StructArrayLayout5i4f1i1ul2ui40");class __ extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m,p,b){let v=this.length;return this.resize(v+1),this.emplace(v,e,n,l,u,m,p,b)}emplace(e,n,l,u,m,p,b,v){let S=8*e;return this.int16[S+0]=n,this.int16[S+1]=l,this.int16[S+2]=u,this.int16[S+4]=m,this.int16[S+5]=p,this.int16[S+6]=b,this.int16[S+7]=v,e}}__.prototype.bytesPerElement=16,de(__,"StructArrayLayout3i2i2i16");class b_ extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,l,u,m)}emplace(e,n,l,u,m,p){let b=4*e,v=8*e;return this.float32[b+0]=n,this.float32[b+1]=l,this.float32[b+2]=u,this.int16[v+6]=m,this.int16[v+7]=p,e}}b_.prototype.bytesPerElement=16,de(b_,"StructArrayLayout2f1f2i16");class y_ extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,u)}emplace(e,n,l,u,m){let p=12*e,b=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=l,this.float32[b+1]=u,this.float32[b+2]=m,e}}y_.prototype.bytesPerElement=12,de(y_,"StructArrayLayout2ub2f12");class xo extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){let m=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=l,this.uint16[m+2]=u,e}}xo.prototype.bytesPerElement=6,de(xo,"StructArrayLayout3ui6");class xb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m,p,b,v,S,k,D,A,L,z,V,H,Y,ne,re,oe,xe){let be=this.length;return this.resize(be+1),this.emplace(be,e,n,l,u,m,p,b,v,S,k,D,A,L,z,V,H,Y,ne,re,oe,xe)}emplace(e,n,l,u,m,p,b,v,S,k,D,A,L,z,V,H,Y,ne,re,oe,xe,be){let ke=30*e,Ae=15*e,je=60*e;return this.int16[ke+0]=n,this.int16[ke+1]=l,this.int16[ke+2]=u,this.float32[Ae+2]=m,this.float32[Ae+3]=p,this.uint16[ke+8]=b,this.uint16[ke+9]=v,this.uint32[Ae+5]=S,this.uint32[Ae+6]=k,this.uint32[Ae+7]=D,this.uint16[ke+16]=A,this.uint16[ke+17]=L,this.uint16[ke+18]=z,this.float32[Ae+10]=V,this.float32[Ae+11]=H,this.uint8[je+48]=Y,this.uint8[je+49]=ne,this.uint8[je+50]=re,this.uint32[Ae+13]=oe,this.int16[ke+28]=xe,this.uint8[je+58]=be,e}}xb.prototype.bytesPerElement=60,de(xb,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class wb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m,p,b,v,S,k,D,A,L,z,V,H,Y,ne,re,oe,xe,be,ke,Ae,je,Qe,$e,st,vt,at,ht,tt,mt,Ct){let ft=this.length;return this.resize(ft+1),this.emplace(ft,e,n,l,u,m,p,b,v,S,k,D,A,L,z,V,H,Y,ne,re,oe,xe,be,ke,Ae,je,Qe,$e,st,vt,at,ht,tt,mt,Ct)}emplace(e,n,l,u,m,p,b,v,S,k,D,A,L,z,V,H,Y,ne,re,oe,xe,be,ke,Ae,je,Qe,$e,st,vt,at,ht,tt,mt,Ct,ft){let Ht=22*e,xt=44*e,Mt=88*e;return this.float32[Ht+0]=n,this.float32[Ht+1]=l,this.int16[xt+4]=u,this.int16[xt+5]=m,this.int16[xt+6]=p,this.int16[xt+7]=b,this.int16[xt+8]=v,this.int16[xt+9]=S,this.int16[xt+10]=k,this.int16[xt+11]=D,this.int16[xt+12]=A,this.uint16[xt+13]=L,this.uint16[xt+14]=z,this.uint16[xt+15]=V,this.uint16[xt+16]=H,this.uint16[xt+17]=Y,this.uint16[xt+18]=ne,this.uint16[xt+19]=re,this.uint16[xt+20]=oe,this.uint16[xt+21]=xe,this.uint16[xt+22]=be,this.uint16[xt+23]=ke,this.uint16[xt+24]=Ae,this.uint16[xt+25]=je,this.uint16[xt+26]=Qe,this.uint16[xt+27]=$e,this.uint32[Ht+14]=st,this.float32[Ht+15]=vt,this.float32[Ht+16]=at,this.float32[Ht+17]=ht,this.float32[Ht+18]=tt,this.float32[Ht+19]=mt,this.float32[Ht+20]=Ct,this.uint8[Mt+84]=ft,e}}wb.prototype.bytesPerElement=88,de(wb,"StructArrayLayout2f9i15ui1ul6f1ub88");class bm extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,l,u,m)}emplace(e,n,l,u,m,p){let b=5*e;return this.float32[b+0]=n,this.float32[b+1]=l,this.float32[b+2]=u,this.float32[b+3]=m,this.float32[b+4]=p,e}}bm.prototype.bytesPerElement=20,de(bm,"StructArrayLayout5f20");class v_ extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m,p,b){let v=this.length;return this.resize(v+1),this.emplace(v,e,n,l,u,m,p,b)}emplace(e,n,l,u,m,p,b,v){let S=7*e;return this.float32[S+0]=n,this.float32[S+1]=l,this.float32[S+2]=u,this.float32[S+3]=m,this.float32[S+4]=p,this.float32[S+5]=b,this.float32[S+6]=v,e}}v_.prototype.bytesPerElement=28,de(v_,"StructArrayLayout7f28");class kp extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){let u=2*e;return this.float32[u+0]=n,this.float32[u+1]=l,e}}kp.prototype.bytesPerElement=8,de(kp,"StructArrayLayout2f8");class Cb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,u)}emplace(e,n,l,u,m){let p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=l,this.uint16[p+3]=u,this.uint16[p+4]=m,e}}Cb.prototype.bytesPerElement=12,de(Cb,"StructArrayLayout1ul3ui12");class tg extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}tg.prototype.bytesPerElement=2,de(tg,"StructArrayLayout1ui2");class Sb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m,p,b,v,S,k,D,A,L,z,V,H){let Y=this.length;return this.resize(Y+1),this.emplace(Y,e,n,l,u,m,p,b,v,S,k,D,A,L,z,V,H)}emplace(e,n,l,u,m,p,b,v,S,k,D,A,L,z,V,H,Y){let ne=16*e;return this.float32[ne+0]=n,this.float32[ne+1]=l,this.float32[ne+2]=u,this.float32[ne+3]=m,this.float32[ne+4]=p,this.float32[ne+5]=b,this.float32[ne+6]=v,this.float32[ne+7]=S,this.float32[ne+8]=k,this.float32[ne+9]=D,this.float32[ne+10]=A,this.float32[ne+11]=L,this.float32[ne+12]=z,this.float32[ne+13]=V,this.float32[ne+14]=H,this.float32[ne+15]=Y,e}}Sb.prototype.bytesPerElement=64,de(Sb,"StructArrayLayout16f64");class x_ extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,m,p,b){let v=this.length;return this.resize(v+1),this.emplace(v,e,n,l,u,m,p,b)}emplace(e,n,l,u,m,p,b,v){let S=10*e,k=5*e;return this.uint16[S+0]=n,this.uint16[S+1]=l,this.uint16[S+2]=u,this.uint16[S+3]=m,this.float32[k+2]=p,this.float32[k+3]=b,this.float32[k+4]=v,e}}x_.prototype.bytesPerElement=20,de(x_,"StructArrayLayout4ui3f20");class Ib extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}Ib.prototype.bytesPerElement=2,de(Ib,"StructArrayLayout1i2");class vs extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}vs.prototype.bytesPerElement=1,de(vs,"StructArrayLayout1ub1");class wv extends dl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wv.prototype.size=40;class Tb extends vb{get(e){return new wv(this,e)}}de(Tb,"CollisionBoxArray");class Cv extends dl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Cv.prototype.size=60;class Mb extends xb{get(e){return new Cv(this,e)}}de(Mb,"PlacedSymbolArray");class Sv extends dl{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}Sv.prototype.size=88;class Iv extends wb{get(e){return new Sv(this,e)}}de(Iv,"SymbolInstanceArray");class Tv extends _m{getoffsetX(e){return this.float32[1*e+0]}}de(Tv,"GlyphOffsetArray");class Mv extends ys{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}de(Mv,"SymbolLineVertexArray");class w_ extends dl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}w_.prototype.size=12;class kv extends Cb{get(e){return new w_(this,e)}}de(kv,"FeatureIndexArray");class Ev extends Wu{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}de(Ev,"FillExtrusionCentroidArray");let WC=xn([{name:"a_pos",components:2,type:"Int16"}],4),HC=xn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ir{constructor(e=[]){this.segments=e}_prepareSegment(e,n,l,u){let m=this.segments[this.segments.length-1];return e>Ir.MAX_VERTEX_ARRAY_LENGTH&&Vr(`Max vertices per segment is ${Ir.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Ir.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==u)&&(m={vertexOffset:n,primitiveOffset:l,vertexLength:0,primitiveLength:0},u!==void 0&&(m.sortKey=u),this.segments.push(m)),m}prepareSegment(e,n,l,u){return this._prepareSegment(e,n.length,l.length,u)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,l,u){return new Ir([{vertexOffset:e,primitiveOffset:n,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}function Dv(i,e){return 256*(i=Ri(Math.floor(i),0,255))+Ri(Math.floor(e),0,255)}Ir.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,de(Ir,"SegmentVector");let GC=xn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),qC=xn([{name:"a_dash",components:4,type:"Uint16"}]);class ig{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,l,u){this.ids.push(Av(e)),this.positions.push(n,l,u)}eachPosition(e,n){let l=Av(e),u=0,m=this.ids.length-1;for(;u<m;){let p=u+m>>1;this.ids[p]>=l?m=p:u=p+1}for(;this.ids[u]===l;)n(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,n){let l=new Float64Array(e.ids),u=new Uint32Array(e.positions);return kb(l,u,0,l.length-1),n&&(n.add(l.buffer),n.add(u.buffer)),{ids:l,positions:u}}static deserialize(e){let n=new ig,l;n.ids=e.ids,n.positions=e.positions;for(let u of n.ids)u!==l&&n.uniqueIds.push(u),l=u;return n.indexed=!0,n}}function Av(i){let e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:yu(String(i))}function kb(i,e,n,l){for(;n<l;){let u=i[n+l>>1],m=n-1,p=l+1;for(;;){do m++;while(i[m]<u);do p--;while(i[p]>u);if(m>=p)break;C_(i,m,p),C_(e,3*m,3*p),C_(e,3*m+1,3*p+1),C_(e,3*m+2,3*p+2)}p-n<l-p?(kb(i,e,n,p),n=p+1):(kb(i,e,p+1,l),l=p)}}function C_(i,e,n){let l=i[e];i[e]=i[n],i[n]=l}de(ig,"FeaturePositionMap");class Id{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class S_ extends Id{constructor(e){super(e),this.current=0}set(e,n,l){this.fetchUniformLocation(e,n)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class Na extends Id{constructor(e){super(e),this.current=0}set(e,n,l){this.fetchUniformLocation(e,n)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Td extends Id{constructor(e){super(e),this.current=[0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class Eb extends Id{constructor(e){super(e),this.current=[0,0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class Db extends Id{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class Pv extends Id{constructor(e){super(e),this.current=mn.transparent.toRenderColor(null)}set(e,n,l){this.fetchUniformLocation(e,n)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}let $C=new Float32Array(16);class ym extends Id{constructor(e){super(e),this.current=$C}set(e,n,l){if(this.fetchUniformLocation(e,n)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}let Ov=new Float32Array(9),YC=new Float32Array(4);class Ab extends Id{constructor(e){super(e),this.current=YC}set(e,n,l){if(this.fetchUniformLocation(e,n)){for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function Pb(i){return[Dv(255*i.r,255*i.g),Dv(255*i.b,255*i.a)]}class ng{constructor(e,n,l,u){this.value=e,this.uniformNames=n.map(m=>`u_${m}`),this.type=l,this.context=u}setUniform(e,n,l,u,m){let p=u.constantOr(this.value);n.set(e,m,p instanceof mn?p.toRenderColor(this.context.lut):p)}getBinding(e,n){return this.type==="color"?new Pv(e):new Na(e)}}class Ep{constructor(e,n){this.uniformNames=n.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,l,u,m){let p=m==="u_pattern"||m==="u_dash"?this.pattern:m==="u_pixel_ratio"?this.pixelRatio:null;p&&n.set(e,m,p)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Db(e):new Na(e)}}class Md{constructor(e,n,l,u){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,l,u,m,p,b){let v=this.paintVertexArray.length,S=this.expression.evaluate(new Vt(0,{brightness:p}),n,{},m,u,b);this.paintVertexArray.resize(e),this._setPaintValue(v,e,S,this.context)}updatePaintArray(e,n,l,u,m,p,b){let v=this.expression.evaluate({zoom:0,brightness:b},l,u,void 0,m);this._setPaintValue(e,n,v,this.context)}_setPaintValue(e,n,l,u){if(this.type==="color"){let m=Pb(l.toRenderColor(u.lut));for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,m[0],m[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ec{constructor(e,n,l,u,m,p){this.expression=e,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=l,this.useIntegerZoom=u,this.context=m,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,l,u,m,p,b){let v=this.expression.evaluate(new Vt(this.context.zoom,{brightness:p}),n,{},m,u,b),S=this.expression.evaluate(new Vt(this.context.zoom+1,{brightness:p}),n,{},m,u,b),k=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(k,e,v,S,this.context)}updatePaintArray(e,n,l,u,m,p,b){let v=this.expression.evaluate({zoom:this.context.zoom,brightness:b},l,u,void 0,m),S=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b},l,u,void 0,m);this._setPaintValue(e,n,v,S,this.context)}_setPaintValue(e,n,l,u,m){if(this.type==="color"){let p=Pb(l.toRenderColor(m.lut)),b=Pb(l.toRenderColor(m.lut));for(let v=e;v<n;v++)this.paintVertexArray.emplace(v,p[0],p[1],b[0],b[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,l,u,m){let p=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,b=Ri(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);n.set(e,m,b)}getBinding(e,n){return new Na(e)}}class Hu{constructor(e,n,l,u,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(l==="array"?qC:GC).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new u}populatePaintArray(e,n,l,u){let m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,n.patterns&&n.patterns[this.layerId],l)}updatePaintArray(e,n,l,u,m,p,b){this._setPaintValues(e,n,l.patterns&&l.patterns[this.layerId],p)}_setPaintValues(e,n,l,u){if(!u||!l)return;let m=u[l];if(!m)return;let{tl:p,br:b,pixelRatio:v}=m;for(let S=e;S<n;S++)this.paintVertexArray.emplace(S,p[0],p[1],b[0],b[1],v)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Gu{constructor(e,n,l=()=>!0){this.binders={},this._buffers=[],this.context=n;let u=[];for(let m in e.paint._values){let p=e.paint.get(m);if(!l(m)||!(p instanceof on&&pm(p.property.specification)))continue;let b=ZC(m,e.type),v=p.value,S=p.property.specification.type,k=!!p.property.useIntegerZoom,D=m==="line-dasharray"||m.endsWith("pattern"),A=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||A)if(v.kind==="source"||A||D){let L=Rv(m,S,"source");this.binders[m]=D?new Hu(v,b,S,L,e.id):new Md(v,b,S,L),u.push(`/a_${m}`)}else{let L=Rv(m,S,"composite");this.binders[m]=new ec(v,b,S,k,n,L),u.push(`/z_${m}`)}else this.binders[m]=D?new Ep(v.value,b):new ng(v.value,b,S,n),u.push(`/u_${m}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof Md||n instanceof ec?n.maxValue:0}populatePaintArrays(e,n,l,u,m,p,b){for(let v in this.binders){let S=this.binders[v];S.context=this.context,(S instanceof Md||S instanceof ec||S instanceof Hu)&&S.populatePaintArray(e,n,l,u,m,p,b)}}setConstantPatternPositions(e){for(let n in this.binders){let l=this.binders[n];l instanceof Ep&&l.setConstantPatternPositions(e)}}updatePaintArrays(e,n,l,u,m,p,b,v){let S=!1,k=Object.keys(e),D=k.length!==0,A=D?k:n.uniqueIds;this.context.lut=m.lut;for(let L in this.binders){let z=this.binders[L];if(z.context=this.context,(z instanceof Md||z instanceof ec||z instanceof Hu)&&(z.expression.isStateDependent===!0||z.expression.isLightConstant===!1)){let V=m.paint.get(L);z.expression=V.value;for(let H of A){let Y=e[H.toString()];n.eachPosition(H,(ne,re,oe)=>{let xe=u.feature(ne);z.updatePaintArray(re,oe,xe,Y,p,b,v)})}if(!D)for(let H of l.uniqueIds){let Y=e[H.toString()];l.eachPosition(H,(ne,re,oe)=>{let xe=u.feature(ne);z.updatePaintArray(re,oe,xe,Y,p,b,v)})}S=!0}}return S}defines(){let e=[];for(let n in this.binders){let l=this.binders[n];(l instanceof ng||l instanceof Ep)&&e.push(...l.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let l=this.binders[n];if(l instanceof Md||l instanceof ec||l instanceof Hu)for(let u=0;u<l.paintVertexAttributes.length;u++)e.push(l.paintVertexAttributes[u].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let l=this.binders[n];if(l instanceof ng||l instanceof Ep||l instanceof ec)for(let u of l.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let l in this.binders){let u=this.binders[l];if(u instanceof ng||u instanceof Ep||u instanceof ec)for(let m of u.uniformNames)n.push({name:m,property:l,binding:u.getBinding(e,m)})}return n}setUniforms(e,n,l,u,m){for(let{name:p,property:b,binding:v}of l)this.binders[b].setUniform(e,v,m,u.get(b),p)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof Md||n instanceof ec||n instanceof Hu)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let l=this.binders[n];(l instanceof Md||l instanceof ec||l instanceof Hu)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof Md||n instanceof ec||n instanceof Hu)&&n.destroy()}}}class qu{constructor(e,n,l=()=>!0){this.programConfigurations={};for(let u of e)this.programConfigurations[u.id]=new Gu(u,n,l);this.needsUpload=!1,this._featureMap=new ig,this._featureMapWithoutIds=new ig,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,l,u,m,p,b,v){for(let S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,n,u,m,p,b,v);n.id!==void 0?this._featureMap.add(n.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,l,u,m,p){for(let b of l)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,b,u,m,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let I_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function ZC(i,e){return I_[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}let XC={"line-pattern":{source:Uu,composite:Uu},"fill-pattern":{source:Uu,composite:Uu},"fill-extrusion-pattern":{source:Uu,composite:Uu},"line-dasharray":{source:f_,composite:f_}},QC={color:{source:kp,composite:Sd},number:{source:_m,composite:kp}};function Rv(i,e,n){let l=XC[i];return l&&l[n]||QC[e][n]}de(ng,"ConstantBinder"),de(Ep,"PatternConstantBinder"),de(Md,"SourceExpressionBinder"),de(Hu,"PatternCompositeBinder"),de(ec,"CompositeExpressionBinder"),de(Gu,"ProgramConfiguration",{omit:["_buffers"]}),de(qu,"ProgramConfigurationSet");let Va=At/Math.PI/2,Ob=5,Fv=6,KC=16383,Dp=64,Rb=[Dp,32,16],ul=-Va,hl=Va;function Ap(i,e,n,l=Va){return n=tn(n),[i*Math.sin(n)*l,-e*l,i*Math.cos(n)*l]}function vm(i,e,n){return Ap(Math.cos(tn(i)),Math.sin(tn(i)),e,n)}let Pp=63710088e-1,Fb=2*Math.PI*Pp;class un{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new un(Ll(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,l=this.lat*n,u=e.lat*n,m=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return Pp*Math.acos(Math.min(m,1))}toBounds(e=0){let n=360*e/40075017,l=n/Math.cos(Math.PI/180*this.lat);return new kd({lng:this.lng-l,lat:this.lat-n},{lng:this.lng+l,lat:this.lat+n})}toEcef(e){return vm(this.lat,this.lng,Va+e*Va/Pp)}static convert(e){if(e instanceof un)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new un(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new un(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class kd{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let l=e;this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]])}else{let l=e;this.setSouthWest(l[0]).setNorthEast(l[1])}}setNorthEast(e){return this._ne=e instanceof un?new un(e.lng,e.lat):un.convert(e),this}setSouthWest(e){return this._sw=e instanceof un?new un(e.lng,e.lat):un.convert(e),this}extend(e){let n=this._sw,l=this._ne,u,m;if(e instanceof un)u=e,m=e;else{if(!(e instanceof kd))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(kd.convert(e)):this.extend(un.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(un.convert(e)):this;if(u=e._sw,m=e._ne,!u||!m)return this}return n||l?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new un(u.lng,u.lat),this._ne=new un(m.lng,m.lat)),this}getCenter(){return new un((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new un(this.getWest(),this.getNorth())}getSouthEast(){return new un(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:l}=un.convert(e),u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return!e||e instanceof kd?e:new kd(e)}}var Lv={};(function(i,e){(function(n){function l(m,p,b){var v=u(256*m,256*(p=Math.pow(2,b)-p-1),b),S=u(256*(m+1),256*(p+1),b);return v[0]+","+v[1]+","+S[0]+","+S[1]}function u(m,p,b){var v=2*Math.PI*6378137/256/Math.pow(2,b);return[m*v-2*Math.PI*6378137/2,p*v-2*Math.PI*6378137/2]}n.getURL=function(m,p,b,v,S,k){return k=k||{},m+"?"+["bbox="+l(b,v,S),"format="+(k.format||"image/png"),"service="+(k.service||"WMS"),"version="+(k.version||"1.1.1"),"request="+(k.request||"GetMap"),"srs="+(k.srs||"EPSG:3857"),"width="+(k.width||256),"height="+(k.height||256),"layers="+p].join("&")},n.getTileBBox=l,n.getMercCoords=u,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,Lv);var JC=Lv;class xm{constructor(e,n,l){this.z=e,this.x=n,this.y=l,this.key=rg(0,e,e,n,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let l=JC.getTileBBox(this.x,this.y,this.z),u=function(m,p,b){let v,S="";for(let k=m;k>0;k--)v=1<<k-1,S+=(p&v?1:0)+(b&v?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class zv{constructor(e,n){this.wrap=e,this.canonical=n,this.key=rg(e,n.z,n.z,n.x,n.y)}}class Xr{constructor(e,n,l,u,m){this.overscaledZ=e,this.wrap=n,this.canonical=new xm(l,+u,+m),this.key=n===0&&e===l?this.canonical.key:rg(n,e,l,u,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new Xr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return rg(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let l=this.canonical.z-e;return rg(this.wrap*+n,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Xr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new Xr(n,this.wrap,n,l,u),new Xr(n,this.wrap,n,l+1,u),new Xr(n,this.wrap,n,l,u+1),new Xr(n,this.wrap,n,l+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Xr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Xr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new zv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function rg(i,e,n,l,u){let m=1<<Math.min(n,22),p=m*(u%m)+l%m;return i&&n<22&&(p+=m*m*((i<0?-2*i-1:2*i)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}let e2=[i=>{let e=i.canonical.x-1,n=i.wrap;return e<0&&(e=(1<<i.canonical.z)-1,n--),new Xr(i.overscaledZ,n,i.canonical.z,e,i.canonical.y)},i=>{let e=i.canonical.x+1,n=i.wrap;return e===1<<i.canonical.z&&(e=0,n++),new Xr(i.overscaledZ,n,i.canonical.z,e,i.canonical.y)},i=>new Xr(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,(i.canonical.y===0?1<<i.canonical.z:i.canonical.y)-1),i=>new Xr(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y===(1<<i.canonical.z)-1?0:i.canonical.y+1)];de(xm,"CanonicalTileID"),de(Xr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let t2=0,i2=25.5;function Lb(i){return Fb*Math.cos(i*Math.PI/180)}function Ac(i){return(180+i)/360}function Pc(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ja(i,e){return i/Lb(e)}function ts(i){return 360*i-180}function $o(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Bv(i,e){return i*Lb($o(e))}let Dr=85.051129;function Nv(i){return Math.cos(tn(Ri(i,-Dr,Dr)))}function $u(i,e){let n=Ri(e,t2,i2),l=Math.pow(2,n);return Nv(i)*Fb/(512*l)}function zb(i){return 1/Math.cos(i*Math.PI/180)}function Op(i,e=0){let n=Math.exp(Math.PI*(1-(i.y+e/At)/(1<<i.z)*2));return 80150034*n/(n*n+1)/At/(1<<i.z)}class la{constructor(e,n,l=0){this.x=+e,this.y=+n,this.z=+l}static fromLngLat(e,n=0){let l=un.convert(e);return new la(Ac(l.lng),Pc(l.lat),ja(n,l.lat))}toLngLat(){return new un(ts(this.x),$o(this.y))}toAltitude(){return Bv(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Fb*zb($o(this.y))}}function T_(i,e,n,l,u,m,p,b,v){let S=(e+l)/2,k=(n+u)/2,D=new gt(S,k);b(D),function(A,L,z,V,H,Y){let ne=z-H,re=V-Y;return Math.abs((V-L)*ne-(z-A)*re)/Math.hypot(ne,re)}(D.x,D.y,m.x,m.y,p.x,p.y)>=v?(T_(i,e,n,S,k,m,D,b,v),T_(i,S,k,l,u,D,p,b,v)):i.push(p)}function Bb(i,e,n){let l=i[0],u=l.x,m=l.y;e(l);let p=[l];for(let b=1;b<i.length;b++){let v=i[b],{x:S,y:k}=v;e(v),T_(p,u,m,S,k,l,v,e,n),u=S,m=k,l=v}return p}function M_(i,e,n,l){if(l(e,n)){let u=e.add(n)._mult(.5);M_(i,e,u,l),M_(i,u,n,l)}else i.push(n)}function n2(i,e){let n=i[0],l=[n];for(let u=1;u<i.length;u++){let m=i[u];M_(l,n,m,e),n=m}return l}let Nb=Math.pow(2,14)-1,Vv=-Nb-1;function k_(i,e){let n=Math.round(i.x*e),l=Math.round(i.y*e);return i.x=Ri(n,Vv,Nb),i.y=Ri(l,Vv,Nb),(n<i.x||n>i.x+1||l<i.y||l>i.y+1)&&Vr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function xs(i,e,n){let l=i.loadGeometry(),u=i.extent,m=At/u;if(e&&n&&n.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:b,x:v,y:S,projection:k}=n,D=A=>{let L=ts((e.x+A.x/u)/p),z=$o((e.y+A.y/u)/p),V=k.project(L,z);A.x=(V.x*b-v)*u,A.y=(V.y*b-S)*u};for(let A=0;A<l.length;A++)if(i.type!==1)l[A]=Bb(l[A],D,1);else{let L=[];for(let z of l[A])z.x<0||z.x>=u||z.y<0||z.y>=u||(D(z),L.push(z));l[A]=L}}for(let p of l)for(let b of p)k_(b,m);return l}function Ed(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?xs(i):[]}}function E_(i,e,n,l,u){i.emplaceBack(2*e+(l+1)/2,2*n+(u+1)/2)}function Rp(i,e,n){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class D_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ys,this.indexArray=new xo,this.segments=new Ir,this.programConfigurations=new qu(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,l,u){let m=this.layers[0],p=[],b=null;m.type==="circle"&&(b=m.layout.get("circle-sort-key"));for(let{feature:S,id:k,index:D,sourceLayerIndex:A}of e){let L=this.layers[0]._featureFilter.needGeometry,z=Ed(S,L);if(!this.layers[0]._featureFilter.filter(new Vt(this.zoom),z,l))continue;let V=b?b.evaluate(z,{},l):void 0,H={id:k,properties:S.properties,type:S.type,sourceLayerIndex:A,index:D,geometry:L?z.geometry:xs(S,l,u),patterns:{},sortKey:V};p.push(H)}b&&p.sort((S,k)=>S.sortKey-k.sortKey);let v=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new g_,v=u.projection);for(let S of p){let{geometry:k,index:D,sourceLayerIndex:A}=S,L=e[D].feature;this.addFeature(S,k,D,n.availableImages,l,v,n.brightness),n.featureIndex.insert(L,k,D,A,this.index)}}update(e,n,l,u,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,l,u,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,WC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,HC.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,l,u,m,p,b){for(let v of n)for(let S of v){let k=S.x,D=S.y;if(k<0||k>=At||D<0||D>=At)continue;if(p){let z=p.projectTilePoint(k,D,m),V=p.upVector(m,k,D),H=this.globeExtVertexArray;Rp(H,z,V),Rp(H,z,V),Rp(H,z,V),Rp(H,z,V)}let A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),L=A.vertexLength;E_(this.layoutVertexArray,k,D,-1,-1),E_(this.layoutVertexArray,k,D,1,-1),E_(this.layoutVertexArray,k,D,1,1),E_(this.layoutVertexArray,k,D,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},u,m,b)}}function Vb(i,e){for(let n=0;n<i.length;n++)if(Yu(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Yu(i,e[n]))return!0;return!!jb(i,e)}function r2(i,e,n){return!!Yu(i,e)||!!Ub(e,i,n)}function jv(i,e){if(i.length===1)return Wv(e,i[0]);for(let n=0;n<e.length;n++){let l=e[n];for(let u=0;u<l.length;u++)if(Yu(i,l[u]))return!0}for(let n=0;n<i.length;n++)if(Wv(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(jb(i,e[n]))return!0;return!1}function o2(i,e,n){if(i.length>1){if(jb(i,e))return!0;for(let l=0;l<e.length;l++)if(Ub(e[l],i,n))return!0}for(let l=0;l<i.length;l++)if(Ub(i[l],e,n))return!0;return!1}function jb(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){let l=i[n],u=i[n+1];for(let m=0;m<e.length-1;m++)if(a2(l,u,e[m],e[m+1]))return!0}return!1}function a2(i,e,n,l){return ra(i,n,l)!==ra(e,n,l)&&ra(i,e,n)!==ra(i,e,l)}function Ub(i,e,n){let l=n*n;if(e.length===1)return i.distSqr(e[0])<l;for(let u=1;u<e.length;u++)if(Uv(i,e[u-1],e[u])<l)return!0;return!1}function Uv(i,e,n){let l=e.distSqr(n);if(l===0)return i.distSqr(e);let u=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/l;return i.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function Wv(i,e){let n,l,u,m=!1;for(let p=0;p<i.length;p++){n=i[p];for(let b=0,v=n.length-1;b<n.length;v=b++)l=n[b],u=n[v],l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(m=!m)}return m}function Yu(i,e){let n=!1;for(let l=0,u=i.length-1;l<i.length;u=l++){let m=i[l],p=i[u];m.y>e.y!=p.y>e.y&&e.x<(p.x-m.x)*(e.y-m.y)/(p.y-m.y)+m.x&&(n=!n)}return n}function Hv(i,e,n,l,u){for(let p of i)if(e<=p.x&&n<=p.y&&l>=p.x&&u>=p.y)return!0;let m=[new gt(e,n),new gt(e,u),new gt(l,u),new gt(l,n)];if(i.length>2){for(let p of m)if(Yu(i,p))return!0}for(let p=0;p<i.length-1;p++)if(s2(i[p],i[p+1],m))return!0;return!1}function s2(i,e,n){let l=n[0],u=n[2];if(i.x<l.x&&e.x<l.x||i.x>u.x&&e.x>u.x||i.y<l.y&&e.y<l.y||i.y>u.y&&e.y>u.y)return!1;let m=ra(i,e,n[0]);return m!==ra(i,e,n[1])||m!==ra(i,e,n[2])||m!==ra(i,e,n[3])}function Ua(i,e,n,l,u,m){let p=e.y-i.y,b=i.x-e.x;if(m=m||0){let v=p*p+b*b;if(v===0)return!0;let S=Math.sqrt(v);p/=S,b/=S}return!((n.x-i.x)*p+(n.y-i.y)*b-m<0||(l.x-i.x)*p+(l.y-i.y)*b-m<0||(u.x-i.x)*p+(u.y-i.y)*b-m<0)}function Wb(i,e,n,l,u,m,p){return!(Ua(i,e,l,u,m,p)||Ua(e,n,l,u,m,p)||Ua(n,i,l,u,m,p)||Ua(l,u,i,e,n,p)||Ua(u,m,i,e,n,p)||Ua(m,l,i,e,n,p))}function Fp(i,e,n){let l=e.paint.get(i).value;return l.kind==="constant"?l.value:n.programConfigurations.get(e.id).getMaxValue(i)}function Oc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function wn(i,e,n,l,u){if(!e[0]&&!e[1])return i;let m=gt.convert(e)._mult(u);n==="viewport"&&m._rotate(-l);let p=[];for(let b=0;b<i.length;b++)p.push(i[b].sub(m));return p}function Gv(i,e,n,l){let u=gt.convert(i)._mult(l);return e==="viewport"&&u._rotate(-n),u}de(D_,"CircleBucket",{omit:["layers"]});let ws=new vn({"circle-sort-key":new Lt(Ue.layout_circle["circle-sort-key"]),visibility:new dt(Ue.layout_circle.visibility)});var Oo={paint:new vn({"circle-radius":new Lt(Ue.paint_circle["circle-radius"]),"circle-color":new Lt(Ue.paint_circle["circle-color"]),"circle-blur":new Lt(Ue.paint_circle["circle-blur"]),"circle-opacity":new Lt(Ue.paint_circle["circle-opacity"]),"circle-translate":new dt(Ue.paint_circle["circle-translate"]),"circle-translate-anchor":new dt(Ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dt(Ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dt(Ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Lt(Ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Lt(Ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Lt(Ue.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new dt(Ue.paint_circle["circle-emissive-strength"])}),layout:ws};class Hb{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,l){let u=t._.dot(n,this.dir);if(Math.abs(u)<1e-6)return!1;let m=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return l[0]=this.pos[0]+this.dir[0]*m,l[1]=this.pos[1]+this.dir[1]*m,l[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,n,l){if(t._.equals(this.pos,e)||n===0)return l[0]=l[1]=l[2]=0,!1;let[u,m,p]=this.dir,b=this.pos[0]-e[0],v=this.pos[1]-e[1],S=this.pos[2]-e[2],k=u*u+m*m+p*p,D=2*(b*u+v*m+S*p),A=D*D-4*k*(b*b+v*v+S*S-n*n);if(A<0){let L=Math.max(-D/2,0),z=b+u*L,V=v+m*L,H=S+p*L,Y=Math.hypot(z,V,H);return l[0]=z*n/Y,l[1]=V*n/Y,l[2]=H*n/Y,!1}{let L=(-D-Math.sqrt(A))/(2*k);if(L<0){let z=Math.hypot(b,v,S);return l[0]=b*n/z,l[1]=v*n/z,l[2]=S*n/z,!1}return l[0]=b+u*L,l[1]=v+m*L,l[2]=S+p*L,!0}}}class Rc{constructor(e,n,l,u,m){this.TL=e,this.TR=n,this.BR=l,this.BL=u,this.horizon=m}static fromInvProjectionMatrix(e,n,l){let u=[-1,1,1],m=[1,1,1],p=[1,-1,1],b=[-1,-1,1],v=t._.transformMat4(u,u,e),S=t._.transformMat4(m,m,e),k=t._.transformMat4(p,p,e),D=t._.transformMat4(b,b,e);return new Rc(v,S,k,D,n/l)}}function og(i,e,n){let l=1/0,u=-1/0,m=[];for(let p of i){t._.sub(m,p,e);let b=t._.dot(m,n);l=Math.min(l,b),u=Math.max(u,b)}return[l,u]}function qv(i,e){let n=!0;for(let l=0;l<i.planes.length;l++){let u=i.planes[l],m=0;for(let p=0;p<e.length;p++)m+=t._.dot(u,e[p])+u[3]>=0;if(m===0)return 0;m!==e.length&&(n=!1)}return n?2:1}function $v(i,e){for(let n of i.projections){let l=og(e,i.points[0],n.axis);if(n.projection[1]<l[0]||n.projection[0]>l[1])return 0}return 1}function Yv(i,e){let n=0,l=[0,0,0,0];for(let u=0;u<i.length;u++)l[0]=i[u][0],l[1]=i[u][1],l[2]=i[u][2],l[3]=1,t.aA.dot(l,e)>=0&&n++;return n}class Gb{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=dr.fromPoints(this.points),this.projections=[],this.frustumEdges=[t._.sub([],this.points[2],this.points[3]),t._.sub([],this.points[0],this.points[3]),t._.sub([],this.points[4],this.points[0]),t._.sub([],this.points[5],this.points[1]),t._.sub([],this.points[6],this.points[2]),t._.sub([],this.points[7],this.points[3])];for(let l of this.frustumEdges){let u=[0,-l[2],l[1]],m=[l[2],0,-l[0]];this.projections.push({axis:u,projection:og(this.points,this.points[0],u)}),this.projections.push({axis:m,projection:og(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,n,l,u){let m=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{let k=t.aA.transformMat4([],S,e),D=1/k[3]/n*m;return t.aA.mul(k,k,[D,D,u?1/k[3]:D,D])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{let k=t._.sub([],p[S[0]],p[S[1]]),D=t._.sub([],p[S[2]],p[S[1]]),A=t._.normalize([],t._.cross([],k,D)),L=-t._.dot(A,p[S[1]]);return A.concat(L)}),v=[];for(let S=0;S<p.length;S++)v.push([p[S][0],p[S][1],p[S][2]]);return new Gb(v,b)}intersectsPrecise(e,n,l){for(let u=0;u<n.length;u++)if(!Yv(e,n[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!Yv(e,this.planes[u]))return 0;for(let u of l)for(let m of this.frustumEdges){let p=t._.cross([],u,m),b=t._.length(p);if(b===0)continue;t._.scale(p,p,1/b);let v=og(this.points,this.points[0],p),S=og(e,this.points[0],p);if(v[0]>S[1]||S[0]>v[1])return 0}return 1}}class dr{static fromPoints(e){let n=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(let u of e)t._.min(n,n,u),t._.max(l,l,u);return new dr(n,l)}static fromTileIdAndHeight(e,n,l){let u=1<<e.canonical.z,m=e.canonical.x,p=e.canonical.y;return new dr([m/u,p/u,n],[(m+1)/u,(p+1)/u,l])}static applyTransform(e,n){let l=e.getCorners();for(let u=0;u<l.length;++u)t._.transformMat4(l[u],l[u],n);return dr.fromPoints(l)}static projectAabbCorners(e,n){let l=e.getCorners();for(let u=0;u<l.length;++u)t._.transformMat4(l[u],l[u],n);return l}constructor(e,n){this.min=e,this.max=n,this.center=t._.scale([],t._.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],l=t._.clone(this.min),u=t._.clone(this.max);for(let m=0;m<n.length;m++)l[m]=n[m]?this.min[m]:this.center[m],u[m]=n[m]?this.center[m]:this.max[m];return u[2]=this.max[2],new dr(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?qv(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?qv(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?$v(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?$v(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}de(dr,"Aabb");let l2=xn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ml}=l2,qb=xn([{name:"a_pos_3",components:3,type:"Int16"}]);var Zu=xn([{name:"a_pos",type:"Int16",components:2}]);function Qr(i){return i*Va/Pp}let wo=[new dr([ul,ul,ul],[hl,hl,hl]),new dr([ul,ul,ul],[0,0,hl]),new dr([0,ul,ul],[hl,0,hl]),new dr([ul,0,ul],[0,hl,hl]),new dr([0,0,ul],[hl,hl,hl])];function $b(i,e,n,l=!0){let u=t._.scale([],i._camera.position,i.worldSize),m=[e,n,1,1];t.aA.transformMat4(m,m,i.pixelMatrixInverse),t.aA.scale(m,m,1/m[3]);let p=t._.sub([],m,u),b=t._.normalize([],p),v=i.globeMatrix,S=[v[12],v[13],v[14]],k=t._.sub([],S,u),D=t._.length(k),A=t._.normalize([],k),L=i.worldSize/(2*Math.PI),z=t._.dot(A,b),V=Math.asin(L/D);if(V<Math.acos(z)){if(!l)return null;let $e=[],st=[];t._.scale($e,b,D/z),t._.normalize(st,t._.sub(st,$e,k)),t._.normalize(b,t._.add(b,k,t._.scale(b,st,Math.tan(V)*D)))}let H=[];new Hb(u,b).closestPointOnSphere(S,L,H);let Y=t._.normalize([],il(v,0)),ne=t._.normalize([],il(v,1)),re=t._.normalize([],il(v,2)),oe=t._.dot(Y,H),xe=t._.dot(ne,H),be=t._.dot(re,H),ke=na(Math.asin(-xe/L)),Ae=na(Math.atan2(oe,be));Ae=i.center.lng+function($e,st){let vt=(st-$e+180)%360-180;return vt<-180?vt+360:vt}(i.center.lng,Ae);let je=Ac(Ae),Qe=Ri(Pc(ke),0,1);return new la(je,Qe)}class c2{constructor(e,n,l){this.a=t._.sub([],e,l),this.b=t._.sub([],n,l),this.center=l;let u=t._.normalize([],this.a),m=t._.normalize([],this.b);this.angle=Math.acos(t._.dot(u,m))}}function Yb(i,e){if(i.angle===0)return null;let n;return n=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),n<0||n>1?null:function(l,u,m,p){let b=Math.sin(m);return l*(Math.sin((1-p)*m)/b)+u*(Math.sin(p*m)/b)}(i.a[e],i.b[e],i.angle,Ri(n,0,1))+i.center[e]}function Fc(i){if(i.z<=1)return wo[i.z+2*i.y+i.x];let e=ag(Xu(i));return dr.fromPoints(e)}function Dd(i,e,n){return t._.scale(i,i,1-n),t._.scaleAndAdd(i,i,e,n)}function Zv(i,e){let n=Ad(e.zoom);if(n===0)return Fc(i);let l=Xu(i),u=ag(l),m=Ac(l.getWest())*e.worldSize,p=Ac(l.getEast())*e.worldSize,b=Pc(l.getNorth())*e.worldSize,v=Pc(l.getSouth())*e.worldSize,S=[m,b,0],k=[p,b,0],D=[m,v,0],A=[p,v,0],L=t.ad.invert([],e.globeMatrix);return t._.transformMat4(S,S,L),t._.transformMat4(k,k,L),t._.transformMat4(D,D,L),t._.transformMat4(A,A,L),u[0]=Dd(u[0],D,n),u[1]=Dd(u[1],A,n),u[2]=Dd(u[2],k,n),u[3]=Dd(u[3],S,n),dr.fromPoints(u)}function Xv(i,e,n){for(let l of i)t._.transformMat4(l,l,e),t._.scale(l,l,n)}function Zb(i,e,n,l){let u=e/i.worldSize,m=i.globeMatrix;if(n.z<=1){let je=Fc(n).getCorners();return Xv(je,m,u),dr.fromPoints(je)}let p=Xu(n,l),b=ag(p,Va+Qr(i._tileCoverLift));Xv(b,m,u);let v=Number.MAX_VALUE,S=[-v,-v,-v],k=[v,v,v];if(p.contains(i.center)){for(let $e of b)t._.min(k,k,$e),t._.max(S,S,$e);S[2]=0;let je=i.point,Qe=[je.x*u,je.y*u,0];return t._.min(k,k,Qe),t._.max(S,S,Qe),new dr(k,S)}if(i._tileCoverLift>0){for(let je of b)t._.min(k,k,je),t._.max(S,S,je);return new dr(k,S)}let D=[m[12]*u,m[13]*u,m[14]*u],A=p.getCenter(),L=Ri(i.center.lat,-Dr,Dr),z=Ri(A.lat,-Dr,Dr),V=Ac(i.center.lng),H=Pc(L),Y=V-Ac(A.lng),ne=H-Pc(z);Y>.5?Y-=1:Y<-.5&&(Y+=1);let re=0;if(Math.abs(Y)>Math.abs(ne))re=Y>=0?1:3;else{re=ne>=0?0:2;let je=[m[4]*u,m[5]*u,m[6]*u],Qe=-Math.sin(tn(ne>=0?p.getSouth():p.getNorth()))*Va;t._.scaleAndAdd(D,D,je,Qe)}let oe=b[re],xe=b[(re+1)%4],be=new c2(oe,xe,D),ke=[Yb(be,0)||oe[0],Yb(be,1)||oe[1],Yb(be,2)||oe[2]],Ae=Ad(i.zoom);if(Ae>0){let je=function({x:$e,y:st,z:vt},at,ht,tt,mt){let Ct=1/(1<<vt),ft=$e*Ct,Ht=ft+Ct,xt=st*Ct,Mt=xt+Ct,oi=0,ti=(ft+Ht)/2-tt;return ti>.5?oi=-1:ti<-.5&&(oi=1),ft=((ft+oi)*at-(tt*=at))*ht+tt,Ht=((Ht+oi)*at-tt)*ht+tt,xt=(xt*at-(mt*=at))*ht+mt,Mt=(Mt*at-mt)*ht+mt,[[ft,Mt,0],[Ht,Mt,0],[Ht,xt,0],[ft,xt,0]]}(n,e,i._pixelsPerMercatorPixel,V,H);for(let $e=0;$e<b.length;$e++)Dd(b[$e],je[$e],Ae);let Qe=t._.add([],je[re],je[(re+1)%4]);t._.scale(Qe,Qe,.5),Dd(ke,Qe,Ae)}for(let je of b)t._.min(k,k,je),t._.max(S,S,je);return k[2]=Math.min(oe[2],xe[2]),t._.min(k,k,ke),t._.max(S,S,ke),new dr(k,S)}function Xu({x:i,y:e,z:n},l=!1){let u=1/(1<<n),m=new un(ts(i*u),e===(1<<n)-1&&l?-90:$o((e+1)*u)),p=new un(ts((i+1)*u),e===0&&l?90:$o(e*u));return new kd(m,p)}function ag(i,e=Va){let n=tn(i.getNorth()),l=tn(i.getSouth()),u=Math.cos(n),m=Math.cos(l),p=Math.sin(n),b=Math.sin(l),v=i.getWest(),S=i.getEast();return[Ap(m,b,v,e),Ap(m,b,S,e),Ap(u,p,S,e),Ap(u,p,v,e)]}function sg(i,e,n,l){let u=1<<n.z,m=(i/At+n.x)/u;return vm($o((e/At+n.y)/u),ts(m),l)}function lg({min:i,max:e}){return KC/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}let cg=new Float64Array(16);function Aa(i){let e=lg(i),n=t.ad.fromScaling(cg,[e,e,e]);return t.ad.translate(n,n,t._.negate([],i.min))}function Qu(i){let e=t.ad.fromTranslation(cg,i.min),n=1/lg(i);return t.ad.scale(e,e,[n,n,n])}function Xb(i){let e=At/(2*Math.PI);return i/(2*Math.PI)/e}function Qv(i,e){return At/(512*Math.pow(2,i))*lg(Fc(e))}function Kv(i,e,n,l,u){let m=Xb(n),p=[i,e,-n/(2*Math.PI)],b=t.ad.identity(new Float64Array(16));return t.ad.translate(b,b,p),t.ad.scale(b,b,[m,m,m]),t.ad.rotateX(b,b,tn(-u)),t.ad.rotateY(b,b,tn(-l)),b}function Ad(i){return $r(Ob,Fv,i)}function Jv(i,e){let n=vm(e.lat,e.lng),l=function(m){let p=vm(m._center.lat,m._center.lng),b=t._.fromValues(0,1,0),v=t._.cross([],b,p),S=t.ad.fromRotation([],-m.angle,p);v=t._.transformMat4(v,v,S),t.ad.fromRotation(S,-m._pitch,v);let k=t._.normalize([],p);return t._.scale(k,k,Qr(m.cameraToCenterDistance/m.pixelsPerMeter)),t._.transformMat4(k,k,S),t._.add([],p,k)}(i),u=t._.subtract([],l,n);return t._.angle(u,n)}function A_(i,e){return Jv(i,e)>Math.PI/2*1.01}let Lc=tn(85),En=Math.cos(Lc),ex=Math.sin(Lc),pl=t.ad.create(),Qb=i=>{let e=[];return i.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),i.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function tx(i,e,n,l,u,m,p,b,v){if(m&&i.queryGeometry.isAboveHorizon)return!1;m&&(v*=i.pixelToTileUnitsFactor);let S=i.tileID.canonical,k=n.projection.upVectorScale(S,n.center.lat,n.worldSize).metersToTile;for(let D of e)for(let A of D){let L=A.add(b),z=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(L.x,L.y,!0):0,V=n.projection.projectTilePoint(L.x,L.y,S);if(z>0){let re=n.projection.upVector(S,L.x,L.y);V.x+=re[0]*k*z,V.y+=re[1]*k*z,V.z+=re[2]*k*z}let H=m?L:Tr(V.x,V.y,V.z,l),Y=m?i.tilespaceRays.map(re=>P_(re,z)):i.queryGeometry.screenGeometry,ne=t.aA.transformMat4([],[V.x,V.y,V.z,1],l);if(!p&&m?v*=ne[3]/n.cameraToCenterDistance:p&&!m&&(v*=n.cameraToCenterDistance/ne[3]),m){let re=$o((A.y/At+S.y)/(1<<S.z));v/=n.projection.pixelsPerMeter(re,1)/ja(1,re)}if(r2(Y,H,v))return!0}return!1}function Tr(i,e,n,l){let u=t.aA.transformMat4([],[i,e,n,1],l);return new gt(u[0]/u[3],u[1]/u[3])}let ix=t._.fromValues(0,0,0),nx=t._.fromValues(0,0,1);function P_(i,e){let n=t._.create();return ix[2]=e,i.intersectsPlane(ix,nx,n),new gt(n[0],n[1])}class rx extends D_{}function ox(i,{width:e,height:n},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*l);return i.width=e,i.height=n,i.data=u,i}function ax(i,e,n){let{width:l,height:u}=e;l===i.width&&u===i.height||(Kb(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,l),height:Math.min(i.height,u)},n,null),i.width=l,i.height=u,i.data=e.data)}function Kb(i,e,n,l,u,m,p,b){if(u.width===0||u.height===0)return e;if(u.width>i.width||u.height>i.height||n.x>i.width-u.width||n.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||l.x>e.width-u.width||l.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");let v=i.data,S=e.data,k=m===4&&b;for(let D=0;D<u.height;D++){let A=((n.y+D)*i.width+n.x)*m,L=((l.y+D)*e.width+l.x)*m;if(k)for(let z=0;z<u.width;z++){let V=A+z*m+3,H=L+z*m;S[H+0]=255,S[H+1]=255,S[H+2]=255,S[H+3]=v[V]}else if(p)for(let z=0;z<u.width;z++){let V=A+z*m,H=L+z*m,Y=v[V+3],ne=new mn(v[V+0]/255*Y,v[V+1]/255*Y,v[V+2]/255*Y,Y).toRenderColor(p).toArray();S[H+0]=ne[0],S[H+1]=ne[1],S[H+2]=ne[2],S[H+3]=ne[3]}else for(let z=0;z<u.width*m;z++)S[L+z]=v[A+z]}return e}de(rx,"HeatmapBucket",{omit:["layers"]});class Ku{constructor(e,n){ox(this,e,1,n)}resize(e){ax(this,new Ku(e),1)}clone(){return new Ku({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,u,m){Kb(e,n,l,u,m,1,null)}}class Ws{constructor(e,n){ox(this,e,4,n)}resize(e){ax(this,new Ws(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ws({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,u,m,p,b){Kb(e,n,l,u,m,4,p,b)}}class sx{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}de(Ku,"AlphaImage"),de(Ws,"RGBAImage");let d2=new vn({visibility:new dt(Ue.layout_heatmap.visibility)});var u2={paint:new vn({"heatmap-radius":new Lt(Ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Lt(Ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dt(Ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Sr(Ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dt(Ue.paint_heatmap["heatmap-opacity"])}),layout:d2};function dg(i){let e={},n=i.resolution||256,l=i.clips?i.clips.length:1,u=i.image||new Ws({width:n,height:l}),m=(p,b,v)=>{e[i.evaluationKey]=v;let S=i.expression.evaluate(e);S&&(u.data[p+b+0]=Math.floor(255*S.r/S.a),u.data[p+b+1]=Math.floor(255*S.g/S.a),u.data[p+b+2]=Math.floor(255*S.b/S.a),u.data[p+b+3]=Math.floor(255*S.a))};if(i.clips)for(let p=0,b=0;p<l;++p,b+=4*n)for(let v=0,S=0;v<n;v++,S+=4){let k=v/(n-1),{start:D,end:A}=i.clips[p];m(b,S,D*(1-k)+A*k)}else for(let p=0,b=0;p<n;p++,b+=4)m(0,b,p/(n-1));return u}let h2=new vn({visibility:new dt(Ue.layout_hillshade.visibility)});var m2={paint:new vn({"hillshade-illumination-direction":new dt(Ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new dt(Ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dt(Ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dt(Ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dt(Ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dt(Ue.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new dt(Ue.paint_hillshade["hillshade-emissive-strength"])}),layout:h2};let p2=xn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Jb}=p2;function ug(i,e,n=2){let l=e&&e.length,u=l?e[0]*n:i.length,m=O_(i,0,u,n,!0),p=[];if(!m||m.next===m.prev)return p;let b,v,S;if(l&&(m=function(k,D,A,L){let z=[];for(let V=0,H=D.length;V<H;V++){let Y=O_(k,D[V]*L,V<H-1?D[V+1]*L:k.length,L,!1);Y===Y.next&&(Y.steiner=!0),z.push(y2(Y))}z.sort(_2);for(let V=0;V<z.length;V++)A=b2(z[V],A);return A}(i,e,m,n)),i.length>80*n){b=1/0,v=1/0;let k=-1/0,D=-1/0;for(let A=n;A<u;A+=n){let L=i[A],z=i[A+1];L<b&&(b=L),z<v&&(v=z),L>k&&(k=L),z>D&&(D=z)}S=Math.max(k-b,D-v),S=S!==0?32767/S:0}return hg(m,p,n,b,v,S,0),p}function O_(i,e,n,l,u){let m;if(u===function(p,b,v,S){let k=0;for(let D=b,A=v-S;D<v;D+=S)k+=(p[A]-p[D])*(p[D+1]+p[A+1]),A=D;return k}(i,e,n,l)>0)for(let p=e;p<n;p+=l)m=hx(p/l|0,i[p],i[p+1],m);else for(let p=n-l;p>=e;p-=l)m=hx(p/l|0,i[p],i[p+1],m);return m&&R_(m,m.next)&&(gg(m),m=m.next),m}function wm(i,e){if(!i)return i;e||(e=i);let n,l=i;do if(n=!1,l.steiner||!R_(l,l.next)&&go(l.prev,l,l.next)!==0)l=l.next;else{if(gg(l),l=e=l.prev,l===l.next)break;n=!0}while(n||l!==e);return e}function hg(i,e,n,l,u,m,p){if(!i)return;!p&&m&&function(v,S,k,D){let A=v;do A.z===0&&(A.z=ey(A.x,A.y,S,k,D)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==v);A.prevZ.nextZ=null,A.prevZ=null,function(L){let z,V=1;do{let H,Y=L;L=null;let ne=null;for(z=0;Y;){z++;let re=Y,oe=0;for(let be=0;be<V&&(oe++,re=re.nextZ,re);be++);let xe=V;for(;oe>0||xe>0&&re;)oe!==0&&(xe===0||!re||Y.z<=re.z)?(H=Y,Y=Y.nextZ,oe--):(H=re,re=re.nextZ,xe--),ne?ne.nextZ=H:L=H,H.prevZ=ne,ne=H;Y=re}ne.nextZ=null,V*=2}while(z>1)}(A)}(i,l,u,m);let b=i;for(;i.prev!==i.next;){let v=i.prev,S=i.next;if(m?ma(i,l,u,m):f2(i))e.push(v.i,i.i,S.i),gg(i),i=S.next,b=S.next;else if((i=S)===b){p?p===1?hg(i=Cs(wm(i),e),e,n,l,u,m,2):p===2&&g2(i,e,n,l,u,m):hg(wm(i),e,n,l,u,m,1);break}}}function f2(i){let e=i.prev,n=i,l=i.next;if(go(e,n,l)>=0)return!1;let u=e.x,m=n.x,p=l.x,b=e.y,v=n.y,S=l.y,k=u<m?u<p?u:p:m<p?m:p,D=b<v?b<S?b:S:v<S?v:S,A=u>m?u>p?u:p:m>p?m:p,L=b>v?b>S?b:S:v>S?v:S,z=l.next;for(;z!==e;){if(z.x>=k&&z.x<=A&&z.y>=D&&z.y<=L&&Lp(u,b,m,v,p,S,z.x,z.y)&&go(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function ma(i,e,n,l){let u=i.prev,m=i,p=i.next;if(go(u,m,p)>=0)return!1;let b=u.x,v=m.x,S=p.x,k=u.y,D=m.y,A=p.y,L=b<v?b<S?b:S:v<S?v:S,z=k<D?k<A?k:A:D<A?D:A,V=b>v?b>S?b:S:v>S?v:S,H=k>D?k>A?k:A:D>A?D:A,Y=ey(L,z,e,n,l),ne=ey(V,H,e,n,l),re=i.prevZ,oe=i.nextZ;for(;re&&re.z>=Y&&oe&&oe.z<=ne;){if(re.x>=L&&re.x<=V&&re.y>=z&&re.y<=H&&re!==u&&re!==p&&Lp(b,k,v,D,S,A,re.x,re.y)&&go(re.prev,re,re.next)>=0||(re=re.prevZ,oe.x>=L&&oe.x<=V&&oe.y>=z&&oe.y<=H&&oe!==u&&oe!==p&&Lp(b,k,v,D,S,A,oe.x,oe.y)&&go(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;re&&re.z>=Y;){if(re.x>=L&&re.x<=V&&re.y>=z&&re.y<=H&&re!==u&&re!==p&&Lp(b,k,v,D,S,A,re.x,re.y)&&go(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;oe&&oe.z<=ne;){if(oe.x>=L&&oe.x<=V&&oe.y>=z&&oe.y<=H&&oe!==u&&oe!==p&&Lp(b,k,v,D,S,A,oe.x,oe.y)&&go(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function Cs(i,e){let n=i;do{let l=n.prev,u=n.next.next;!R_(l,u)&&dx(l,n,n.next,u)&&fg(l,u)&&fg(u,l)&&(e.push(l.i,n.i,u.i),gg(n),gg(n.next),n=i=u),n=n.next}while(n!==i);return wm(n)}function g2(i,e,n,l,u,m){let p=i;do{let b=p.next.next;for(;b!==p.prev;){if(p.i!==b.i&&cx(p,b)){let v=ux(p,b);return p=wm(p,p.next),v=wm(v,v.next),hg(p,e,n,l,u,m,0),void hg(v,e,n,l,u,m,0)}b=b.next}p=p.next}while(p!==i)}function _2(i,e){return i.x-e.x}function b2(i,e){let n=function(u,m){let p=m,b=u.x,v=u.y,S,k=-1/0;do{if(v<=p.y&&v>=p.next.y&&p.next.y!==p.y){let V=p.x+(v-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(V<=b&&V>k&&(k=V,S=p.x<p.next.x?p:p.next,V===b))return S}p=p.next}while(p!==m);if(!S)return null;let D=S,A=S.x,L=S.y,z=1/0;p=S;do{if(b>=p.x&&p.x>=A&&b!==p.x&&Lp(v<L?b:k,v,A,L,v<L?k:b,v,p.x,p.y)){let V=Math.abs(v-p.y)/(b-p.x);fg(p,u)&&(V<z||V===z&&(p.x>S.x||p.x===S.x&&lx(S,p)))&&(S=p,z=V)}p=p.next}while(p!==D);return S}(i,e);if(!n)return e;let l=ux(n,i);return wm(l,l.next),wm(n,n.next)}function lx(i,e){return go(i.prev,i,e.prev)<0&&go(e.next,i,i.next)<0}function ey(i,e,n,l,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function y2(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function Lp(i,e,n,l,u,m,p,b){return(u-p)*(e-b)>=(i-p)*(m-b)&&(i-p)*(l-b)>=(n-p)*(e-b)&&(n-p)*(m-b)>=(u-p)*(l-b)}function cx(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,l){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==l.i&&u.next.i!==l.i&&dx(u,u.next,n,l))return!0;u=u.next}while(u!==n);return!1}(i,e)&&(fg(i,e)&&fg(e,i)&&function(n,l){let u=n,m=!1,p=(n.x+l.x)/2,b=(n.y+l.y)/2;do u.y>b!=u.next.y>b&&u.next.y!==u.y&&p<(u.next.x-u.x)*(b-u.y)/(u.next.y-u.y)+u.x&&(m=!m),u=u.next;while(u!==n);return m}(i,e)&&(go(i.prev,i,e.prev)||go(i,e.prev,e))||R_(i,e)&&go(i.prev,i,i.next)>0&&go(e.prev,e,e.next)>0)}function go(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function R_(i,e){return i.x===e.x&&i.y===e.y}function dx(i,e,n,l){let u=pg(go(i,e,n)),m=pg(go(i,e,l)),p=pg(go(n,l,i)),b=pg(go(n,l,e));return u!==m&&p!==b||!(u!==0||!mg(i,n,e))||!(m!==0||!mg(i,l,e))||!(p!==0||!mg(n,i,l))||!(b!==0||!mg(n,e,l))}function mg(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function pg(i){return i>0?1:i<0?-1:0}function fg(i,e){return go(i.prev,i,i.next)<0?go(i,e,i.next)>=0&&go(i,i.prev,e)>=0:go(i,e,i.prev)<0||go(i,i.next,e)<0}function ux(i,e){let n=Ju(i.i,i.x,i.y),l=Ju(e.i,e.x,e.y),u=i.next,m=e.prev;return i.next=e,e.prev=i,n.next=u,u.prev=n,l.next=n,n.prev=l,m.next=l,l.prev=m,l}function hx(i,e,n,l){let u=Ju(i,e,n);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function gg(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ju(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function F_(i,e){let n=i.length;if(n<=1)return[i];let l=[],u,m;for(let p=0;p<n;p++){let b=ko(i[p]);b!==0&&(i[p].area=Math.abs(b),m===void 0&&(m=b<0),m===b<0?(u&&l.push(u),u=[i[p]]):u.push(i[p]))}if(u&&l.push(u),e>1)for(let p=0;p<l.length;p++)l[p].length<=e||(pd(l[p],e,1,l[p].length-1,v2),l[p]=l[p].slice(0,e));return l}function v2(i,e){return e.area-i.area}function ty(i,e,n){let l=n.patternDependencies,u=!1;for(let m of e){let p=m.paint.get(`${i}-pattern`);p.isConstant()||(u=!0);let b=p.constantOr(null);b&&(u=!0,l[b]=!0)}return u}function iy(i,e,n,l,u){let m=u.patternDependencies;for(let p of e){let b=p.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let v=b.evaluate({zoom:l},n,{},u.availableImages);v=v&&v.name?v.name:v,m[v]=!0,n.patterns[p.id]=v}}return n}class L_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ys,this.indexArray=new xo,this.indexArray2=new Wu,this.programConfigurations=new qu(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Ir,this.segments2=new Ir,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,l,u){this.hasPattern=ty("fill",this.layers,n);let m=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:b,id:v,index:S,sourceLayerIndex:k}of e){let D=this.layers[0]._featureFilter.needGeometry,A=Ed(b,D);if(!this.layers[0]._featureFilter.filter(new Vt(this.zoom),A,l))continue;let L=m?m.evaluate(A,{},l,n.availableImages):void 0,z={id:v,properties:b.properties,type:b.type,sourceLayerIndex:k,index:S,geometry:D?A.geometry:xs(b,l,u),patterns:{},sortKey:L};p.push(z)}m&&p.sort((b,v)=>b.sortKey-v.sortKey);for(let b of p){let{geometry:v,index:S,sourceLayerIndex:k}=b;if(this.hasPattern){let D=iy("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(D)}else this.addFeature(b,v,S,l,{},n.availableImages,n.brightness);n.featureIndex.insert(e[S].feature,v,S,k,this.index)}}update(e,n,l,u,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,l,u,m)}addFeatures(e,n,l,u,m,p){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,n,l,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jb),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,l,u,m,p=[],b){for(let v of F_(n,500)){let S=0;for(let V of v)S+=V.length;let k=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray),D=k.vertexLength,A=[],L=[];for(let V of v){if(V.length===0)continue;V!==v[0]&&L.push(A.length/2);let H=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),Y=H.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(Y+V.length-1,Y),A.push(V[0].x),A.push(V[0].y);for(let ne=1;ne<V.length;ne++)this.layoutVertexArray.emplaceBack(V[ne].x,V[ne].y),this.indexArray2.emplaceBack(Y+ne-1,Y+ne),A.push(V[ne].x),A.push(V[ne].y);H.vertexLength+=V.length,H.primitiveLength+=V.length}let z=ug(A,L);for(let V=0;V<z.length;V+=3)this.indexArray.emplaceBack(D+z[V],D+z[V+1],D+z[V+2]);k.vertexLength+=S,k.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,p,u,b)}}de(L_,"FillBucket",{omit:["layers","patternFeatures"]});let mx=new vn({"fill-sort-key":new Lt(Ue.layout_fill["fill-sort-key"]),visibility:new dt(Ue.layout_fill.visibility)});var px={paint:new vn({"fill-antialias":new dt(Ue.paint_fill["fill-antialias"]),"fill-opacity":new Lt(Ue.paint_fill["fill-opacity"]),"fill-color":new Lt(Ue.paint_fill["fill-color"]),"fill-outline-color":new Lt(Ue.paint_fill["fill-outline-color"]),"fill-translate":new dt(Ue.paint_fill["fill-translate"]),"fill-translate-anchor":new dt(Ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new Lt(Ue.paint_fill["fill-pattern"]),"fill-emissive-strength":new dt(Ue.paint_fill["fill-emissive-strength"])}),layout:mx};class ny{constructor(e,n,l,u){if(this.triangleCount=n.length/3,this.min=new gt(0,0),this.max=new gt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[m,p]=[e[0].clone(),e[0].clone()];for(let D=1;D<e.length;++D){let A=e[D];m.x=Math.min(m.x,A.x),m.y=Math.min(m.y,A.y),p.x=Math.max(p.x,A.x),p.y=Math.max(p.y,A.y)}if(u){let D=Math.ceil(Math.max(p.x-m.x,p.y-m.y)/u);l=Math.max(l,D)}if(l===0)return;this.min=m,this.max=p;let b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);let v=Math.max(b.x,b.y)/l;this.cellsX=Math.max(1,Math.ceil(b.x/v)),this.cellsY=Math.max(1,Math.ceil(b.y/v)),this.xScale=1/v,this.yScale=1/v;let S=[];for(let D=0;D<this.triangleCount;D++){let A=e[n[3*D+0]].sub(this.min),L=e[n[3*D+1]].sub(this.min),z=e[n[3*D+2]].sub(this.min),V=zc(Math.floor(Math.min(A.x,L.x,z.x)),this.xScale,this.cellsX),H=zc(Math.floor(Math.max(A.x,L.x,z.x)),this.xScale,this.cellsX),Y=zc(Math.floor(Math.min(A.y,L.y,z.y)),this.yScale,this.cellsY),ne=zc(Math.floor(Math.max(A.y,L.y,z.y)),this.yScale,this.cellsY),re=new gt(0,0),oe=new gt(0,0),xe=new gt(0,0),be=new gt(0,0);for(let ke=Y;ke<=ne;++ke){re.y=oe.y=ke*v,xe.y=be.y=(ke+1)*v;for(let Ae=V;Ae<=H;++Ae)re.x=xe.x=Ae*v,oe.x=be.x=(Ae+1)*v,(Wb(A,L,z,re,oe,be)||Wb(A,L,z,re,be,xe))&&S.push({cellIdx:ke*this.cellsX+Ae,triIdx:D})}}if(S.length===0)return;S.sort((D,A)=>D.cellIdx-A.cellIdx||D.triIdx-A.triIdx);let k=0;for(;k<S.length;){let D=S[k].cellIdx,A={start:this.payload.length,len:0};for(;k<S.length&&S[k].cellIdx===D;)++A.len,this.payload.push(S[k++].triIdx);this.cells[D]=A}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let l=zc(e.x-this.min.x,this.xScale,this.cellsX),u=zc(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[u*this.cellsX+l];if(m){this._lazyInitLookup();for(let p=0;p<m.len;p++){let b=this.payload[m.start+p],v=Math.floor(b/8),S=1<<b%8;if(!(this.lookup[v]&S)&&(this.lookup[v]|=S,n.push(b),n.length===this.triangleCount))return}}}query(e,n,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();let u=zc(e.x-this.min.x,this.xScale,this.cellsX),m=zc(n.x-this.min.x,this.xScale,this.cellsX),p=zc(e.y-this.min.y,this.yScale,this.cellsY),b=zc(n.y-this.min.y,this.yScale,this.cellsY);for(let v=p;v<=b;v++)for(let S=u;S<=m;S++){let k=this.cells[v*this.cellsX+S];if(k)for(let D=0;D<k.len;D++){let A=this.payload[k.start+D],L=Math.floor(A/8),z=1<<A%8;if(!(this.lookup[L]&z)&&(this.lookup[L]|=z,l.push(A),l.length===this.triangleCount))return}}}}function zc(i,e,n){return Math.max(0,Math.min(n-1,Math.floor(i*e)))}de(ny,"TriangleGridIndex");class fx{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(let l of this.footprints)n.push({footprint:l,id:e})}populate(e,n,l,u){let m=[];for(let{feature:p,id:b,index:v,sourceLayerIndex:S}of e){let k=this.layers[0]._featureFilter.needGeometry,D=Ed(p,k);if(!this.layers[0]._featureFilter.filter(new Vt(this.zoom),D,l))continue;let A={id:b,properties:p.properties,type:p.type,sourceLayerIndex:S,index:v,geometry:k?D.geometry:xs(p,l,u),patterns:{}};m.push(A)}for(let p of m){let{geometry:b,index:v,sourceLayerIndex:S}=p;this.addFeature(p,b,v,l,{},n.availableImages,n.brightness),n.featureIndex.insert(e[v].feature,b,v,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,l,u,m){}destroy(){}addFeature(e,n,l,u,m,p=[],b){for(let v of F_(n,2)){let S=[],k=[],D=[],A=new gt(1/0,1/0),L=new gt(-1/0,-1/0);for(let H of v)if(H.length!==0){H!==v[0]&&D.push(k.length/2);for(let Y=0;Y<H.length;Y++)k.push(H[Y].x),k.push(H[Y].y),S.push(H[Y]),A.x=Math.min(A.x,H[Y].x),A.y=Math.min(A.y,H[Y].y),L.x=Math.max(L.x,H[Y].x),L.y=Math.max(L.y,H[Y].y)}let z=ug(k,D),V=new ny(S,z,8,256);this.footprints.push({vertices:S,indices:z,grid:V,min:A,max:L})}}}de(fx,"ClipBucket",{omit:["layers"]});let x2=new vn({"clip-layer-types":new dt(Ue.layout_clip["clip-layer-types"])});var w2={paint:new vn({}),layout:x2};let C2=xn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),S2=xn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),I2=xn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),T2=xn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),M2=xn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:k2}=C2;var z_={},E2=Qm,gx=zp;function zp(i,e,n,l,u){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=u,i.readFields(D2,this,e)}function D2(i,e,n){i==1?e.id=n.readVarint():i==2?function(l,u){for(var m=l.readVarint()+l.pos;l.pos<m;){var p=u._keys[l.readVarint()],b=u._values[l.readVarint()];u.properties[p]=b}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function A2(i){for(var e,n,l=0,u=0,m=i.length,p=m-1;u<m;p=u++)l+=((n=i[p]).x-(e=i[u]).x)*(e.y+n.y);return l}zp.types=["Unknown","Point","LineString","Polygon"],zp.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,l=1,u=0,m=0,p=0,b=[];i.pos<n;){if(u<=0){var v=i.readVarint();l=7&v,u=v>>3}if(u--,l===1||l===2)m+=i.readSVarint(),p+=i.readSVarint(),l===1&&(e&&b.push(e),e=[]),e.push(new E2(m,p));else{if(l!==7)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&b.push(e),b},zp.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,l=0,u=0,m=0,p=1/0,b=-1/0,v=1/0,S=-1/0;i.pos<e;){if(l<=0){var k=i.readVarint();n=7&k,l=k>>3}if(l--,n===1||n===2)(u+=i.readSVarint())<p&&(p=u),u>b&&(b=u),(m+=i.readSVarint())<v&&(v=m),m>S&&(S=m);else if(n!==7)throw new Error("unknown command "+n)}return[p,v,b,S]},zp.prototype.toGeoJSON=function(i,e,n){var l,u,m=this.extent*Math.pow(2,n),p=this.extent*i,b=this.extent*e,v=this.loadGeometry(),S=zp.types[this.type];function k(L){for(var z=0;z<L.length;z++){var V=L[z];L[z]=[360*(V.x+p)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(l=0;l<v.length;l++)D[l]=v[l][0];k(v=D);break;case 2:for(l=0;l<v.length;l++)k(v[l]);break;case 3:for(v=function(L){var z=L.length;if(z<=1)return[L];for(var V,H,Y=[],ne=0;ne<z;ne++){var re=A2(L[ne]);re!==0&&(H===void 0&&(H=re<0),H===re<0?(V&&Y.push(V),V=[L[ne]]):V.push(L[ne]))}return V&&Y.push(V),Y}(v),l=0;l<v.length;l++)for(u=0;u<v[l].length;u++)k(v[l][u])}v.length===1?v=v[0]:S="Multi"+S;var A={type:"Feature",geometry:{type:S,coordinates:v},properties:this.properties};return"id"in this&&(A.id=this.id),A};var P2=gx,_x=bx;function bx(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(O2,this,e),this.length=this._features.length}function O2(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(l){for(var u=null,m=l.readVarint()+l.pos;l.pos<m;){var p=l.readVarint()>>3;u=p===1?l.readString():p===2?l.readFloat():p===3?l.readDouble():p===4?l.readVarint64():p===5?l.readVarint():p===6?l.readSVarint():p===7?l.readBoolean():null}return u}(n))}bx.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new P2(this._pbf,e,this.extent,this._keys,this._values)};var R2=_x;function F2(i,e,n){if(i===3){var l=new R2(n,n.readVarint()+n.pos);l.length&&(e[l.name]=l)}}var ry=z_.VectorTile=function(i,e){this.layers=i.readFields(F2,{},e)},B_=z_.VectorTileFeature=gx;z_.VectorTileLayer=_x;class Pd extends gt{constructor(e,n,l){super(e,n),this.z=l}}class oy extends Pd{constructor(e,n,l,u){super(e,n,l),this.w=u}}function _g(i,e,n,l){let u=[],m=l===0?(p,b,v,S,k,D)=>{p.push(new gt(D,v+(D-b)/(S-b)*(k-v)))}:(p,b,v,S,k,D)=>{p.push(new gt(b+(D-v)/(k-v)*(S-b),D))};for(let p of i){let b=[];for(let v of p){if(v.length<=2)continue;let S=[];for(let A=0;A<v.length-1;A++){let L=v[A].x,z=v[A].y,V=v[A+1].x,H=v[A+1].y,Y=l===0?L:z,ne=l===0?V:H;Y<e?ne>e&&m(S,L,z,V,H,e):Y>n?ne<n&&m(S,L,z,V,H,n):S.push(v[A]),ne<e&&Y>=e&&m(S,L,z,V,H,e),ne>n&&Y<=n&&m(S,L,z,V,H,n)}let k=v[v.length-1],D=l===0?k.x:k.y;D>=e&&D<=n&&S.push(k),S.length&&(k=S[S.length-1],S[0].x===k.x&&S[0].y===k.y||S.push(S[0]),b.push(S))}b.length&&u.push(b)}return u}function yx(i,e,n,l){let u=n==="x"?"y":"x",m=(l-i[n])/(e[n]-i[n]);i[u]=i[u]+(e[u]-i[u])*m,i[n]=l,i.hasOwnProperty("z")&&(i.z=ri(i.z,e.z,m)),i.hasOwnProperty("w")&&(i.w=ri(i.w,e.w,m))}function vx(i,e,n,l){let u=n,m=l;for(let p of["x","y"]){let b=i,v=e;b[p]>=v[p]&&(b=e,v=i),b[p]<u&&v[p]>u&&yx(b,v,p,u),b[p]<m&&v[p]>m&&yx(v,b,p,m)}}function N_(i,e){return i.x-e.x||i.y-e.y}function V_(i,e){return N_(i.min,e.min)===0&&N_(i.max,e.max)===0}function ay(i,e){return!(i.min.x>e.max.x||i.max.x<e.min.x||i.min.y>e.max.y||i.max.y<e.min.y)}function sy(i,e){if(i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(i[n].sourceId!==e[n].sourceId||!V_(i[n],e[n])||i[n].order!==e[n].order||i[n].clipMask!==e[n].clipMask)return!1;return!0}function xx(i,e,n){let l=1/At,u=1/(1<<n.canonical.z),m=(e.x*l+n.canonical.x)*u+n.wrap,p=(e.y*l+n.canonical.y)*u;return{min:new gt((i.x*l+n.canonical.x)*u+n.wrap,(i.y*l+n.canonical.y)*u),max:new gt(m,p)}}function Ss(i,e,n){let l=1<<n.canonical.z,u=((e.x-n.wrap)*l-n.canonical.x)*At,m=(e.y*l-n.canonical.y)*At;return{min:new gt(((i.x-n.wrap)*l-n.canonical.x)*At,(i.y*l-n.canonical.y)*At),max:new gt(u,m)}}function j_(i,e,n,l,u,m,p){let b=i.indices,v=i.vertices,S=[];for(let k=l;k<l+u;k+=3){let D=e[n[k+0]+m],A=e[n[k+1]+m],L=e[n[k+2]+m],z=Math.min(D.x,A.x,L.x),V=Math.max(D.x,A.x,L.x),H=Math.min(D.y,A.y,L.y),Y=Math.max(D.y,A.y,L.y);S.length=0,i.grid.query(new gt(z,H),new gt(V,Y),S);for(let ne=0;ne<S.length;ne++){let re=S[ne];if(Wb(v[b[3*re+0]],v[b[3*re+1]],v[b[3*re+2]],D,A,L,p))return!0}}return!1}function wx(i,e,n,l){if(!i||!n)return!1;let u=i.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(n.vertices.length<i.vertices.length)return wx(n,l,i,e);let m=e.canonical,p=l.canonical,b=Math.pow(2,p.z-m.z);u=i.vertices.map(v=>new gt((v.x+m.x*At)*b-p.x*At,(v.y+m.y*At)*b-p.y*At))}return j_(n,u,i.indices,0,i.indices.length,0,0)}function Cx(i,e,n,l){let u=Math.pow(2,l.z-n.z);return new gt((i+n.x*At)*u-l.x*At,(e+n.y*At)*u-l.y*At)}function Sx(i,e){let n=[];e.footprint.grid.queryPoint(i,n);let l=e.footprint.indices,u=e.footprint.vertices;for(let m=0;m<n.length;m++){let p=n[m];if(Yu([u[l[3*p+0]],u[l[3*p+1]],u[l[3*p+2]]],i))return!0}return!1}class Ix{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let l=this.toIdx(e,n);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function U_(i,e,n,l){let u=0,m=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(l[p])<1e-15){if(n[p]<i[p]||n[p]>e[p])return null}else{let b=1/l[p],v=(i[p]-n[p])*b,S=(e[p]-n[p])*b;if(v>S){let k=v;v=S,S=k}if(v>u&&(u=v),S<m&&(m=S),u>m)return null}return u}function Tx(i,e,n,l,u,m,p,b,v,S,k){let D=l-i,A=u-e,L=m-n,z=p-i,V=b-e,H=v-n,Y=k[1]*H-k[2]*V,ne=k[2]*z-k[0]*H,re=k[0]*V-k[1]*z,oe=D*Y+A*ne+L*re;if(Math.abs(oe)<1e-15)return null;let xe=1/oe,be=S[0]-i,ke=S[1]-e,Ae=S[2]-n,je=(be*Y+ke*ne+Ae*re)*xe;if(je<0||je>1)return null;let Qe=ke*L-Ae*A,$e=Ae*D-be*L,st=be*A-ke*D,vt=(k[0]*Qe+k[1]*$e+k[2]*st)*xe;return vt<0||je+vt>1?null:(z*Qe+V*$e+H*st)*xe}function W_(i,e,n){return(i-e)/(n-e)}function Mx(i,e,n,l,u,m,p,b,v){let S=1<<n,k=m-l,D=p-u,A=(i+1)/S*k+l,L=(e+0)/S*D+u,z=(e+1)/S*D+u;b[0]=(i+0)/S*k+l,b[1]=L,v[0]=A,v[1]=z}class kx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(m){let p=Math.ceil(Math.log2(m.dim/8)),b=[],v=Math.ceil(Math.pow(2,p)),S=1/v,k=(L,z,V,H,Y)=>{let ne=H?1:0,re=(L+1)*V-ne,oe=z*V,xe=(z+1)*V-ne;Y[0]=L*V,Y[1]=oe,Y[2]=re,Y[3]=xe},D=new Ix(v),A=[];for(let L=0;L<v*v;L++){k(L%v,Math.floor(L/v),S,!1,A);let z=eh(A[0],A[1],m),V=eh(A[2],A[1],m),H=eh(A[2],A[3],m),Y=eh(A[0],A[3],m);D.minimums.push(Math.min(z,V,H,Y)),D.maximums.push(Math.max(z,V,H,Y)),D.leaves.push(1)}for(b.push(D),v/=2;v>=1;v/=2){let L=b[b.length-1];D=new Ix(v);for(let z=0;z<v*v;z++){k(z%v,Math.floor(z/v),2,!0,A);let V=L.getElevation(A[0],A[1]),H=L.getElevation(A[2],A[1]),Y=L.getElevation(A[2],A[3]),ne=L.getElevation(A[0],A[3]),re=L.isLeaf(A[0],A[1]),oe=L.isLeaf(A[2],A[1]),xe=L.isLeaf(A[2],A[3]),be=L.isLeaf(A[0],A[3]),ke=Math.min(V.min,H.min,Y.min,ne.min),Ae=Math.max(V.max,H.max,Y.max,ne.max),je=re&&oe&&xe&&be;D.maximums.push(Ae),D.minimums.push(ke),D.leaves.push(Ae-ke<=5&&je?1:0)}b.push(D)}return b}(this.dem),l=n.length-1,u=n[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,l,0)}raycastRoot(e,n,l,u,m,p,b=1){return U_([e,n,-100],[l,u,this.maximums[0]*b],m,p)}raycast(e,n,l,u,m,p,b=1){if(!this.nodeCount)return null;let v=this.raycastRoot(e,n,l,u,m,p,b);if(v==null)return null;let S=[],k=[],D=[],A=[],L=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;L.length>0;){let{idx:z,t:V,nodex:H,nodey:Y,depth:ne}=L.pop();if(this.leaves[z]){Mx(H,Y,ne,e,n,l,u,D,A);let oe=1<<ne,xe=(H+0)/oe,be=(H+1)/oe,ke=(Y+0)/oe,Ae=(Y+1)/oe,je=eh(xe,ke,this.dem)*b,Qe=eh(be,ke,this.dem)*b,$e=eh(be,Ae,this.dem)*b,st=eh(xe,Ae,this.dem)*b,vt=Tx(D[0],D[1],je,A[0],D[1],Qe,A[0],A[1],$e,m,p),at=Tx(A[0],A[1],$e,D[0],A[1],st,D[0],D[1],je,m,p),ht=Math.min(vt!==null?vt:Number.MAX_VALUE,at!==null?at:Number.MAX_VALUE);if(ht!==Number.MAX_VALUE)return ht;{let tt=t._.scaleAndAdd([],m,p,V);if(Ex(je,Qe,st,$e,W_(tt[0],D[0],A[0]),W_(tt[1],D[1],A[1]))>=tt[2])return V}continue}let re=0;for(let oe=0;oe<this._siblingOffset.length;oe++){Mx((H<<1)+this._siblingOffset[oe][0],(Y<<1)+this._siblingOffset[oe][1],ne+1,e,n,l,u,D,A),D[2]=-100,A[2]=this.maximums[this.childOffsets[z]+oe]*b;let xe=U_(D,A,m,p);if(xe!=null){let be=xe;S[oe]=be;let ke=!1;for(let Ae=0;Ae<re&&!ke;Ae++)be>=S[k[Ae]]&&(k.splice(Ae,0,oe),ke=!0);ke||(k[re]=oe),re++}}for(let oe=0;oe<re;oe++){let xe=k[oe];L.push({idx:this.childOffsets[z]+xe,t:S[xe],nodex:(H<<1)+this._siblingOffset[xe][0],nodey:(Y<<1)+this._siblingOffset[xe][1],depth:ne+1})}}return null}_addNode(e,n,l){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,l,u,m){if(e[u].isLeaf(n,l)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);let p=u-1,b=e[p],v=0,S=0;for(let k=0;k<this._siblingOffset.length;k++){let D=2*n+this._siblingOffset[k][0],A=2*l+this._siblingOffset[k][1],L=b.getElevation(D,A),z=b.isLeaf(D,A),V=this._addNode(L.min,L.max,z);z&&(v|=1<<k),S||(S=V)}for(let k=0;k<this._siblingOffset.length;k++)v&1<<k||this._construct(e,2*n+this._siblingOffset[k][0],2*l+this._siblingOffset[k][1],p,S+k)}}function Ex(i,e,n,l,u,m){return ri(ri(i,n,m),ri(e,l,m),u)}function eh(i,e,n){let l=n.dim,u=Ri(i*l-.5,0,l-1),m=Ri(e*l-.5,0,l-1),p=Math.floor(u),b=Math.floor(m),v=Math.min(p+1,l-1),S=Math.min(b+1,l-1);return Ex(n.get(p,b),n.get(v,b),n.get(p,S),n.get(v,S),u-p,m-b)}let Dx={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function L2(i,e,n){return(256*i*256+256*e+n)/10-1e4}function z2(i,e,n){return 256*i+e+n/256-32768}class H_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,l,u=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return Vr(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let m=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let v=0;v<m;v++)p[this._idx(-1,v)]=p[this._idx(0,v)],p[this._idx(m,v)]=p[this._idx(m-1,v)],p[this._idx(v,-1)]=p[this._idx(v,0)],p[this._idx(v,m)]=p[this._idx(v,m-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(m,-1)]=p[this._idx(m-1,0)],p[this._idx(-1,m)]=p[this._idx(0,m-1)],p[this._idx(m,m)]=p[this._idx(m-1,m-1)]}let b=l==="terrarium"?z2:L2;for(let v=0;v<p.length;++v){let S=4*v;this.floatView[v]=b(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=Eo.now()}_buildQuadTree(){this._tree=new kx(this)}get(e,n,l=!1){l&&(e=Ri(e,-1,this.dim),n=Ri(n,-1,this.dim));let u=this._idx(e,n);return this.floatView[u]}set(e,n,l){let u=this._idx(e,n),m=this.floatView[u];return this.floatView[u]=l,l-m}static getUnpackVector(e){return Dx[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let l=[0,0,0,0],u=H_.getUnpackVector(n),m=Math.floor((e+u[3])/u[2]);return l[2]=m%256,m=Math.floor(m/256),l[1]=m%256,m=Math.floor(m/256),l[0]=m,l}getPixels(){return new sx({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,m=n*this.dim+this.dim,p=l*this.dim,b=l*this.dim+this.dim;switch(n){case-1:u=m-1;break;case 1:m=u+1}switch(l){case-1:p=b-1;break;case 1:b=p+1}let v=-n*this.dim,S=-l*this.dim;for(let k=p;k<b;k++)for(let D=u;D<m;D++){let A=4*this._idx(D,k),L=4*this._idx(D+v,k+S);this.pixels[A+0]=e.pixels[L+0],this.pixels[A+1]=e.pixels[L+1],this.pixels[A+2]=e.pixels[L+2],this.pixels[A+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}de(H_,"DEMData"),de(kx,"DemMinMaxQuadTree",{omit:["dem"]});class th{constructor(e,n,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=l}static create(e,n,l){let u=l||e.findDEMTileFor(n);if(!u||!u.dem)return;let m=u.dem,p=u.tileID,b=1<<n.canonical.z-p.canonical.z;return new th(u,m.dim/At/b,[(n.canonical.x/b-p.canonical.x)*m.dim,(n.canonical.y/b-p.canonical.y)*m.dim])}tileCoordToPixel(e,n){let l=n*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),m=Math.floor(l);return new gt(u,m)}getElevationAt(e,n,l,u){let m=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],b=Math.floor(m),v=Math.floor(p),S=this._dem;return u=!!u,l?ri(ri(S.get(b,v,u),S.get(b,v+1,u),p-v),ri(S.get(b+1,v,u),S.get(b+1,v+1,u),p-v),m-b):S.get(b,v,u)}getElevationAtPixel(e,n,l){return this._dem.get(e,n,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ja(1,e)*this._dem.stride}}let G_={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},B2=B_.types,N2=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],V2=["fill-extrusion-flood-light-ground-radius"],j2=Math.pow(2,13),U2=Math.pow(2,15)-1,Ax=new gt(0,1),ih=2147483648;function bg(i,e,n,l,u,m,p,b){i.emplaceBack((e<<1)+p,(n<<1)+m,(Math.floor(l*j2)<<1)+u,Math.round(b))}function q_(i,e,n,l,u,m){i.emplaceBack(e.x,e.y,(n.x<<1)+l,(n.y<<1)+u,m)}function yg(i,e,n){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Px{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Ox{constructor(){this.centroidXY=new gt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new gt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new gt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new gt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Rx{constructor(){this.acc=new gt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,l){this.accCount++,this.acc._add(n);let u=!!this.borders;n.x<e.min.x?(e.min.x=n.x,u=!0):n.x>e.max.x&&(e.max.x=n.x,u=!0),n.y<e.min.y?(e.min.y=n.y,u=!0):n.y>e.max.y&&(e.max.y=n.y,u=!0),((n.x===0||n.x===At)&&n.x===l.x)!=((n.y===0||n.y===At)&&n.y===l.y)&&this.processBorderOverlap(n,l),u&&this.checkBorderIntersection(n,l)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,ri(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>At!=e.x>At&&this.addBorderIntersection(1,ri(n.y,e.y,(At-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,ri(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>At!=e.y>At&&this.addBorderIntersection(3,ri(n.x,e.x,(At-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let l=this.borders[e];n<l[0]&&(l[0]=n),n>l[1]&&(l[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let l=e.x===0?0:1;this.addBorderIntersection(l,n.y),this.addBorderIntersection(l,e.y)}else{let l=e.y===0?2:3;this.addBorderIntersection(l,n.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new gt(0,0):new gt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function Fx(i,e){let n=i.add(e)._unit(),l=Ri(i.x*n.x+i.y*n.y,-1,1);var u,m,p;return u=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(u)))/4*U2*((m=i).x*(p=e).y-m.y*p.x<0?-1:1)}let W2=[i=>i.x<0,i=>i.x>At,i=>i.y<0,i=>i.y>At];function H2(i,e,n,l){let u=[4];if(l===0)return u;n._mult(l);let m=i.sub(n),p=e.sub(n),b=[i,e,m,p];for(let v=0;v<4;v++)for(let S of b)if(W2[v](S)){u.push(v);break}return u}class Lx{constructor(e){this.vertexArray=new Cd,this.indexArray=new xo,this.programConfigurations=new qu(e.layers,{zoom:e.zoom,lut:e.lut},n=>V2.includes(n)),this._segments=new Ir,this.hiddenByLandmarkVertexArray=new vs,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ir}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,l,u=!1){let m=e.length;if(m>2){let p=Math.max(0,this._segments.get().length-1),b=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),v;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let S=e[0],k=e[1];v=Fx(S.sub(e[m-1])._perp()._unit(),k.sub(S)._perp()._unit())}for(let S=0;S<m;S++){let k=S===m-1?0:S+1,D=e[S],A=e[k],L=e[k===m-1?0:k+1],z=A.sub(D)._perp()._unit(),V=Fx(z,L.sub(A)._perp()._unit()),H=v,Y=V;if(y(D,A,n)||u&&I(D,n)&&I(A,n)){v=V;continue}let ne=b.vertexLength;q_(this.vertexArray,D,A,1,1,H),q_(this.vertexArray,D,A,1,0,H),q_(this.vertexArray,D,A,0,1,Y),q_(this.vertexArray,D,A,0,0,Y),b.vertexLength+=4;let re=H2(D,A,z,l);for(let oe of re)this._segmentToGroundQuads[p].push({id:ne,region:oe}),this._segmentToRegionTriCounts[p][oe]+=2,b.primitiveLength+=2;v=V}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let l=0;l<n;l++)this._segmentToGroundQuads[l].sort((u,m)=>u.region-m.region);for(let l=0;l<n;l++){let u=this._segmentToGroundQuads[l],m=e[l],p=this._segmentToRegionTriCounts[l];p.reduce((v,S)=>v+S,0);let b=0;for(let v=0;v<=4;v++){let S=p[v];if(S!==0){let k=this.regionSegments[v];k||(k=this.regionSegments[v]=new Ir);let D={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+b,vertexLength:m.vertexLength,primitiveLength:S};k.get().push(D)}b+=S}for(let v=0;v<u.length;v++){let S=u[v].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,l,u,m,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,l,u,m,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,S2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,l,u,m,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,l,u,m,p)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let l=e.flags&ih?1:0;for(let u=e.groundVertexArrayOffset;u<n;++u)this.hiddenByLandmarkVertexArray.emplace(u,l);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,T2.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class $_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new xo,this.footprintVertices=new ys,this.footprintSegments=[],this.layoutVertexArray=new Da,this.centroidVertexArray=new Ev,this.indexArray=new xo,this.programConfigurations=new qu(e.layers,{zoom:e.zoom,lut:e.lut},n=>N2.includes(n)),this.segments=new Ir,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new Lx(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,l,u){this.features=[],this.hasPattern=ty("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Op(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:m,id:p,index:b,sourceLayerIndex:v}of e){let S=this.layers[0]._featureFilter.needGeometry,k=Ed(m,S);if(!this.layers[0]._featureFilter.filter(new Vt(this.zoom),k,l))continue;let D={id:p,sourceLayerIndex:v,index:b,geometry:S?k.geometry:xs(m,l,u),properties:m.properties,type:m.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(iy("fill-extrusion",this.layers,D,this.zoom,n)):this.addFeature(D,D.geometry,b,l,{},n.availableImages,u,n.brightness),n.featureIndex.insert(m,D.geometry,b,v,this.index,A)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,l,u,m,p){for(let b of this.features){let{geometry:v}=b;this.addFeature(b,v,b.index,n,l,u,m,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,l,u,m){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let b=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,b,l,u,m),this.groundEffect.update(e,n,b,l,u,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,k2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,M2.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,I2.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,l,u,m,p,b,v){let S=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,k=[new gt(0,0),new gt(At,At)],D=b.projection,A=D.name==="globe",L=B2[e.type]==="Polygon",z=new Rx;z.centroidDataIndex=this.centroidData.length;let V=new Ox,H=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,Y=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);V.height=Y,V.vertexArrayOffset=this.layoutVertexArray.length,V.groundVertexArrayOffset=this.groundEffect.vertexArray.length,A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new g_);let ne=F_(n,500);for(let Ae=ne.length-1;Ae>=0;Ae--){let je=ne[Ae];(je.length===0||(re=je[0]).every(Qe=>Qe.x<=0)||re.every(Qe=>Qe.x>=At)||re.every(Qe=>Qe.y<=0)||re.every(Qe=>Qe.y>=At))&&ne.splice(Ae,1)}var re;let oe;if(A)oe=Se(ne,k,u);else{oe=[];for(let Ae of ne)oe.push({polygon:Ae,bounds:k})}let xe=L?this.edgeRadius:0,be=xe>0&&this.zoom<17,ke=(Ae,je)=>{if(Ae.length===0)return!1;let Qe=Ae[Ae.length-1];return je.x===Qe.x&&je.y===Qe.y};for(let{polygon:Ae,bounds:je}of oe){let Qe=0,$e=0;for(let ht of Ae)L&&!ht[0].equals(ht[ht.length-1])&&ht.push(ht[0]),$e+=L?ht.length-1:ht.length;let st=this.segments.prepareSegment((L?5:4)*$e,this.layoutVertexArray,this.indexArray);V.footprintSegIdx<0&&(V.footprintSegIdx=this.footprintSegments.length),V.polygonSegIdx<0&&(V.polygonSegIdx=this.polygonSegments.length);let vt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},at=new Px;if(at.vertexOffset=this.footprintVertices.length,at.indexOffset=3*this.footprintIndices.length,at.ringIndices=[],L){let ht=[],tt=[];Qe=st.vertexLength;for(let Ct=0;Ct<Ae.length;Ct++){let ft=Ae[Ct];ft.length&&Ct!==0&&tt.push(ht.length/2);let Ht=[],xt,Mt;xt=ft[1].sub(ft[0])._perp()._unit(),at.ringIndices.push(ft.length-1);for(let oi=1;oi<ft.length;oi++){let ti=ft[oi],Jt=ft[oi===ft.length-1?1:oi+1],Tt=ti.clone();if(xe){Mt=Jt.sub(ti)._perp()._unit();let li=xt.add(Mt)._unit(),Ei=xe*Math.min(4,1/(xt.x*li.x+xt.y*li.y));Tt.x+=Ei*li.x,Tt.y+=Ei*li.y,Tt.x=Math.round(Tt.x),Tt.y=Math.round(Tt.y),xt=Mt}!H||xe!==0&&!be||ke(Ht,Tt)||Ht.push(Tt),bg(this.layoutVertexArray,Tt.x,Tt.y,0,0,1,1,0),st.vertexLength++,this.footprintVertices.emplaceBack(ti.x,ti.y),ht.push(ti.x,ti.y),A&&yg(this.layoutVertexExtArray,D.projectTilePoint(Tt.x,Tt.y,u),D.upVector(u,Tt.x,Tt.y))}H&&(xe===0||be)&&(Ht.length!==0&&ke(Ht,Ht[0])&&Ht.pop(),this.groundEffect.addData(Ht,je,S))}let mt=ug(ht,tt);for(let Ct=0;Ct<mt.length;Ct+=3)this.footprintIndices.emplaceBack(at.vertexOffset+mt[Ct+0],at.vertexOffset+mt[Ct+1],at.vertexOffset+mt[Ct+2]),this.indexArray.emplaceBack(Qe+mt[Ct],Qe+mt[Ct+2],Qe+mt[Ct+1]),st.primitiveLength++;at.indexCount+=mt.length,at.vertexCount+=this.footprintVertices.length-at.vertexOffset}for(let ht=0;ht<Ae.length;ht++){let tt=Ae[ht];z.startRing(V,tt[0]);let mt=tt.length>4&&R(tt[tt.length-2],tt[0],tt[1]),Ct=xe?G2(tt[tt.length-2],tt[0],tt[1],xe):0,ft=[],Ht,xt,Mt;xt=tt[1].sub(tt[0])._perp()._unit();let oi=!0;for(let ti=1,Jt=0;ti<tt.length;ti++){let Tt=tt[ti-1],li=tt[ti],Ei=tt[ti===tt.length-1?1:ti+1];if(z.appendEdge(V,li,Tt),y(li,Tt,je)){xe&&(xt=Ei.sub(li)._perp()._unit(),oi=!oi);continue}let gi=li.sub(Tt)._perp(),Li=gi.x/(Math.abs(gi.x)+Math.abs(gi.y)),Di=gi.y>0?1:0,Xi=Tt.dist(li);if(Jt+Xi>32768&&(Jt=0),xe){Mt=Ei.sub(li)._perp()._unit();let In=Bx(Tt,li,Ei,zx(xt,Mt),xe);isNaN(In)&&(In=0);let fn=li.sub(Tt)._unit();Tt=Tt.add(fn.mult(Ct))._round(),li=li.add(fn.mult(-In))._round(),Ct=In,xt=Mt,H&&this.zoom>=17&&(ke(ft,Tt)||ft.push(Tt),ke(ft,li)||ft.push(li))}let mi=st.vertexLength,qn=tt.length>4&&R(Tt,li,Ei),Wn=$(Jt,mt,oi);if(bg(this.layoutVertexArray,Tt.x,Tt.y,Li,Di,0,0,Wn),bg(this.layoutVertexArray,Tt.x,Tt.y,Li,Di,0,1,Wn),Jt+=Xi,Wn=$(Jt,qn,!oi),mt=qn,bg(this.layoutVertexArray,li.x,li.y,Li,Di,0,0,Wn),bg(this.layoutVertexArray,li.x,li.y,Li,Di,0,1,Wn),st.vertexLength+=4,this.indexArray.emplaceBack(mi+0,mi+1,mi+2),this.indexArray.emplaceBack(mi+1,mi+3,mi+2),st.primitiveLength+=2,xe){let In=Qe+(ti===1?tt.length-2:ti-2),fn=ti===1?Qe:In+1;if(this.indexArray.emplaceBack(mi+1,In,mi+3),this.indexArray.emplaceBack(In,fn,mi+3),st.primitiveLength+=2,Ht===void 0&&(Ht=mi),!y(Ei,tt[ti],je)){let Tn=ti===tt.length-1?Ht:st.vertexLength;this.indexArray.emplaceBack(mi+2,mi+3,Tn),this.indexArray.emplaceBack(mi+3,Tn+1,Tn),this.indexArray.emplaceBack(mi+3,fn,Tn+1),st.primitiveLength+=3}oi=!oi}if(A){let In=this.layoutVertexExtArray,fn=D.projectTilePoint(Tt.x,Tt.y,u),Tn=D.projectTilePoint(li.x,li.y,u),ur=D.upVector(u,Tt.x,Tt.y),tr=D.upVector(u,li.x,li.y);yg(In,fn,ur),yg(In,fn,ur),yg(In,Tn,tr),yg(In,Tn,tr)}}L&&(Qe+=tt.length-1),H&&xe&&this.zoom>=17&&(ft.length!==0&&ke(ft,ft[0])&&ft.pop(),this.groundEffect.addData(ft,je,S,xe>0))}this.footprintSegments.push(at),vt.triangleCount=this.indexArray.length-vt.triangleArrayOffset,this.polygonSegments.push(vt),++V.footprintSegLen,++V.polygonSegLen}if(V.vertexCount=this.layoutVertexArray.length-V.vertexArrayOffset,V.groundVertexCount=this.groundEffect.vertexArray.length-V.groundVertexArrayOffset,V.vertexCount!==0){if(V.centroidXY=z.borders?Ax:this.encodeCentroid(z,V),this.centroidData.push(V),z.borders){this.featuresOnBorder.push(z);let Ae=this.featuresOnBorder.length-1;for(let je=0;je<z.borders.length;je++)z.borders[je][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[je].push(Ae)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,p,u,v),this.groundEffect.addPaintPropertiesData(e,l,m,p,u,v),this.maxHeight=Math.max(this.maxHeight,Y)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,l)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){let e=[];for(let b=0;b<this.centroidData.length;b++){let v=this.centroidData[b],S=+(v.min.y+v.max.y>At),k=2*S+(+(v.min.x+v.max.x>At)^S);for(let D=0;D<v.polygonSegLen;D++){let A=v.polygonSegIdx+D;e.push({centroidIdx:b,subtile:k,polygonSegmentIdx:A,triangleSegmentIdx:this.polygonSegments[A].triangleSegIdx})}}let n=new xo;e.sort((b,v)=>b.triangleSegmentIdx===v.triangleSegmentIdx?b.subtile-v.subtile:b.triangleSegmentIdx-v.triangleSegmentIdx);let l=0,u=0,m=0;for(let b of e){if(b.triangleSegmentIdx!==l)break;m++}let p=e.length;for(;u!==e.length;){l=e[u].triangleSegmentIdx;let b=0,v=u,S=u;for(let k=v;k<m&&e[k].subtile===b;k++)S++;for(;v!==m;){let k=e[v];b=k.subtile;let D=this.centroidData[k.centroidIdx].min.clone(),A=this.centroidData[k.centroidIdx].max.clone(),L={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let z=v;z<S;z++){let V=e[z],H=this.polygonSegments[V.polygonSegmentIdx],Y=this.centroidData[V.centroidIdx].min,ne=this.centroidData[V.centroidIdx].max,re=this.indexArray.uint16;for(let oe=H.triangleArrayOffset;oe<H.triangleArrayOffset+H.triangleCount;oe++)n.emplaceBack(re[3*oe],re[3*oe+1],re[3*oe+2]);L.primitiveLength+=H.triangleCount,D.x=Math.min(D.x,Y.x),D.y=Math.min(D.y,Y.y),A.x=Math.max(A.x,ne.x),A.y=Math.max(A.y,ne.y)}L.primitiveLength>0&&this.triangleSubSegments.push({segment:L,min:D,max:A}),v=S;for(let z=v;z<m&&e[z].subtile===e[v].subtile;z++)S++}u=m;for(let k=u;k<p&&e[k].triangleSegmentIdx===e[u].triangleSegmentIdx;k++)m++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,l){let u=0,m=0,p=1<<e.canonical.z;if(n){let V=n.getMinMaxForTile(e);V&&(u=V.min,m=V.max)}m+=this.maxHeight;let b=e.toUnwrapped(),v,S=[b.canonical.x/p+b.wrap,b.canonical.y/p],k=[(b.canonical.x+1)/p+b.wrap,(b.canonical.y+1)/p],D=new Ir,A=(V,H,Y)=>[V[0]*(1-Y[0])+H[0]*Y[0],V[1]*(1-Y[1])+H[1]*Y[1]],L=[],z=[];for(let V of this.triangleSubSegments){L[0]=V.min.x/At,L[1]=V.min.y/At,z[0]=V.max.x/At,z[1]=V.max.y/At;let H=A(S,k,L),Y=A(S,k,z);if(new dr([H[0],H[1],u],[Y[0],Y[1],m]).intersectsPrecise(l)===0){v&&(D.segments.push(v),v=void 0);continue}let ne=V.segment;v&&v.vertexOffset!==ne.vertexOffset&&(D.segments.push(v),v=void 0),v?(v.vertexLength+=ne.vertexLength,v.primitiveLength+=ne.primitiveLength):v={vertexOffset:ne.vertexOffset,primitiveLength:ne.primitiveLength,vertexLength:ne.vertexLength,primitiveOffset:ne.primitiveOffset,sortKey:void 0,vaos:{}}}return v&&D.segments.push(v),D}encodeCentroid(e,n){let l=e.centroid(),u=n.span(),m=Math.min(7,Math.round(u.x*this.tileToMeter/10)),p=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new gt(Ri(l.x,1,At-1)<<3|m,Ri(l.y,1,At-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new gt(0,0);let n=e.borders,l=Number.MAX_VALUE;if(n[0][0]!==l||n[1][0]!==l){let u=n[0][0]!==l?0:1;return new gt(6|(n[0][0]!==l?0:65528),(n[u][0]+n[u][1])/2<<3|6)}{let u=n[2][0]!==l?2:3;return new gt((n[u][0]+n[u][1])/2<<3|6,6|(n[2][0]!==l?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=ih,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,u=e.flags&ih?Ax:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==u.y||m!==u.x){for(let p=n;p<l;++p)this.centroidVertexArray.emplace(p,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,l){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let u=n.getReplacementRegionsForTile(e.toUnwrapped());if(sy(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let p of this.centroidData)p.flags&=2147483647;let m=[];for(let p of this.activeReplacements){if(p.order<l)continue;let b=Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z);for(let v of this.centroidData)if(!(v.flags&ih||p.min.x>v.max.x||v.min.x>p.max.x||p.min.y>v.max.y||v.min.y>p.max.y))for(let S=0;S<v.footprintSegLen;S++){let k=this.footprintSegments[v.footprintSegIdx+S];if(m.length=0,Be(this.footprintVertices,k.vertexOffset,k.vertexCount,p.footprintTileId.canonical,e.canonical,m),j_(p.footprint,m,this.footprintIndices.uint16,k.indexOffset,k.indexCount,-k.vertexOffset,-b)){v.flags|=ih;break}}}for(let p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,l){let u=!1;for(let m=0;m<l.footprintSegLen;m++){let p=this.footprintSegments[l.footprintSegIdx+m],b=0;for(let v of p.ringIndices){for(let S=b,k=v+b-1;S<v+b;k=S++){let D=this.footprintVertices.int16[2*(S+p.vertexOffset)+0],A=this.footprintVertices.int16[2*(S+p.vertexOffset)+1],L=this.footprintVertices.int16[2*(k+p.vertexOffset)+1];A>n!=L>n&&e<(this.footprintVertices.int16[2*(k+p.vertexOffset)+0]-D)*(n-A)/(L-A)+D&&(u=!u)}b=v}}return u}getHeightAtTileCoord(e,n){let l=Number.NEGATIVE_INFINITY,u=!0,m=4*(e+At)*At+(n+At);if(this.partLookup.hasOwnProperty(m)){let p=this.partLookup[m];return p?{height:p.height,hidden:!!(p.flags&ih)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||this.footprintContainsPoint(e,n,p)&&p&&p.height>l&&(l=p.height,this.partLookup[m]=p,u=!!(p.flags&ih));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.partLookup[m]=void 0}}function zx(i,e){let n=i.add(e)._unit();return i.x*n.x+i.y*n.y}function G2(i,e,n,l){let u=e.sub(i)._perp()._unit(),m=n.sub(e)._perp()._unit();return Bx(i,e,n,zx(u,m),l)}function Bx(i,e,n,l,u){let m=Math.sqrt(1-l*l);return Math.min(i.dist(e)/3,e.dist(n)/3,u*m/l)}function y(i,e,n){return i.x<n[0].x&&e.x<n[0].x||i.x>n[1].x&&e.x>n[1].x||i.y<n[0].y&&e.y<n[0].y||i.y>n[1].y&&e.y>n[1].y}function I(i,e){return i.x<e[0].x||i.x>e[1].x||i.y<e[0].y||i.y>e[1].y}function R(i,e,n){if(i.x<0||i.x>=At||e.x<0||e.x>=At||n.x<0||n.x>=At)return!1;let l=n.sub(e),u=l.perp(),m=i.sub(e);return(l.x*m.x+l.y*m.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(m.x*m.x+m.y*m.y))>-.866&&u.x*m.x+u.y*m.y<0}function $(i,e,n){let l=e?2|i:-3&i;return n?1|l:-2&l}function se(){let i=Math.PI/32,e=Math.tan(i),n=Pp;return n*Math.sqrt(1+2*e*e)-n}function Se(i,e,n){let l=1<<n.z,u=ts(n.x/l),m=ts((n.x+1)/l),p=$o(n.y/l),b=$o((n.y+1)/l);return function(v,S,k,D,A=0,L){let z=[];if(!v.length||!k||!D)return z;let V=(be,ke)=>{for(let Ae of be)z.push({polygon:Ae,bounds:ke})},H=Math.ceil(Math.log2(k)),Y=Math.ceil(Math.log2(D)),ne=H-Y,re=[];for(let be=0;be<Math.abs(ne);be++)re.push(ne>0?0:1);for(let be=0;be<Math.min(H,Y);be++)re.push(0),re.push(1);let oe=v;if(oe=_g(oe,S[0].y-A,S[1].y+A,1),oe=_g(oe,S[0].x-A,S[1].x+A,0),!oe.length)return z;let xe=[];for(re.length?xe.push({polygons:oe,bounds:S,depth:0}):V(oe,S);xe.length;){let be=xe.pop(),ke=be.depth,Ae=re[ke],je=be.bounds[0],Qe=be.bounds[1],$e=Ae===0?je.x:je.y,st=Ae===0?Qe.x:Qe.y,vt=L?L(Ae,$e,st):.5*($e+st),at=_g(be.polygons,$e-A,vt+A,Ae),ht=_g(be.polygons,vt-A,st+A,Ae);if(at.length){let tt=[je,new gt(Ae===0?vt:Qe.x,Ae===1?vt:Qe.y)];re.length>ke+1?xe.push({polygons:at,bounds:tt,depth:ke+1}):V(at,tt)}if(ht.length){let tt=[new gt(Ae===0?vt:je.x,Ae===1?vt:je.y),Qe];re.length>ke+1?xe.push({polygons:ht,bounds:tt,depth:ke+1}):V(ht,tt)}}return z}(i,e,Math.ceil((m-u)/11.25),Math.ceil((p-b)/11.25),1,(v,S,k)=>{if(v===0)return .5*(S+k);{let D=$o((n.y+S/At)/l);return(Pc(.5*($o((n.y+k/At)/l)+D))*l-n.y)*At}})}function Be(i,e,n,l,u,m){let p=Math.pow(2,l.z-u.z);for(let b=0;b<n;b++){let v=i.int16[2*(b+e)+0],S=i.int16[2*(b+e)+1];v=(v+u.x*At)*p-l.x*At,S=(S+u.y*At)*p-l.y*At,m.push(new gt(v,S))}}de($_,"FillExtrusionBucket",{omit:["layers","features"]}),de(Ox,"PartData"),de(Px,"FootprintSegment"),de(Rx,"BorderCentroidData"),de(Lx,"GroundEffect");let Ge=new vn({visibility:new dt(Ue["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new dt(Ue["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var ot={paint:new vn({"fill-extrusion-opacity":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Lt(Ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Lt(Ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Lt(Ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Lt(Ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Lt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Lt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Ge};function Bt(i,e){return i.x*e.x+i.y*e.y}function jt(i,e){if(i.length===1){let n=0,l=e[n++],u;for(;!u||l.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){let m=e[n],p=i[0],b=u.sub(l),v=m.sub(l),S=p.sub(l),k=Bt(b,b),D=Bt(b,v),A=Bt(v,v),L=Bt(S,b),z=Bt(S,v),V=k*A-D*D,H=(A*L-D*z)/V,Y=(k*z-D*L)/V,ne=l.z*(1-H-Y)+u.z*H+m.z*Y;if(isFinite(ne))return ne}return 1/0}{let n=1/0;for(let l of e)n=Math.min(n,l.z);return n}}function Yt(i,e,n,l,u,m,p,b){let v=p*u.getElevationAt(i,e,!0,!0),S=m[0]!==0,k=S?m[1]===0?p*(m[0]/7-450):p*function(D,A,L){let z=Math.floor(A[0]/8),V=Math.floor(A[1]/8),H=10*(A[0]-8*z),Y=10*(A[1]-8*V),ne=D.getElevationAt(z,V,!0,!0),re=D.getMeterToDEM(L),oe=Math.floor(.5*(H*re-1)),xe=Math.floor(.5*(Y*re-1)),be=D.tileCoordToPixel(z,V),ke=2*oe+1,Ae=2*xe+1,je=function(ht,tt,mt,Ct,ft){return[ht.getElevationAtPixel(tt,mt,!0),ht.getElevationAtPixel(tt+ft,mt,!0),ht.getElevationAtPixel(tt,mt+ft,!0),ht.getElevationAtPixel(tt+Ct,mt+ft,!0)]}(D,be.x-oe,be.y-xe,ke,Ae),Qe=Math.abs(je[0]-je[1]),$e=Math.abs(je[2]-je[3]),st=Math.abs(je[0]-je[2])+Math.abs(je[1]-je[3]),vt=Math.min(.25,.5*re*(Qe+$e)/ke),at=Math.min(.25,.5*re*st/Ae);return ne+Math.max(vt*H,at*Y)}(u,m,b):v;return{base:v+(n===0)?-1:n,top:S?Math.max(k+l,v+n+2):v+l}}let di=xn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Ti}=di,Yi=xn([{name:"a_packed",components:4,type:"Float32"}]),{members:On}=Yi,Zi=xn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Un}=Zi,Qn=xn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hs=xn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),is=xn([{name:"a_projected_pos",components:4,type:"Float32"}],4);xn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let ns=xn([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),Co=xn([{name:"a_z_offset",components:1,type:"Float32"}],4),tc=xn([{name:"a_texb",components:2,type:"Uint16"}]),Od=xn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Nx=xn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);xn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let vM=xn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),DR=xn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xn([{name:"triangle",components:3,type:"Uint16"}]),xn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),xn([{type:"Float32",name:"offsetX"}]),xn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class xM{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Ku({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let l=this.getKey(e,n);return this.positions[l]}trim(){let e=this.width,n=this.height=Km(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,l){let u=[],m=e.length%2==1?-e[e.length-1]*l:0,p=e[0]*l,b=!0;u.push({left:m,right:p,isDash:b,zeroLength:e[0]===0});let v=e[0];for(let S=1;S<e.length;S++){b=!b;let k=e[S];m=v*l,v+=k,p=v*l,u.push({left:m,right:p,isDash:b,zeroLength:k===0})}return u}addRoundDash(e,n,l){let u=n/2;for(let m=-l;m<=l;m++){let p=this.width*(this.nextRow+l+m),b=0,v=e[b];for(let S=0;S<this.width;S++){S/v.right>1&&(v=e[++b]);let k=Math.abs(S-v.left),D=Math.abs(S-v.right),A=Math.min(k,D),L,z=m/l*(u+1);if(v.isDash){let V=u-Math.abs(z);L=Math.sqrt(A*A+V*V)}else L=u-Math.sqrt(A*A+z*z);this.image.data[p+S]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,n){for(let v=e.length-1;v>=0;--v){let S=e[v],k=e[v+1];S.zeroLength?e.splice(v,1):k&&k.isDash===S.isDash&&(k.left=S.left,e.splice(v,1))}let l=e[0],u=e[e.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);let m=this.width*this.nextRow,p=0,b=e[p];for(let v=0;v<this.width;v++){v/b.right>1&&(b=e[++p]);let S=Math.abs(v-b.left),k=Math.abs(v-b.right),D=Math.min(S,k);this.image.data[m+v]=Math.max(0,Math.min(255,(b.isDash?D:-D)+n+128))}}addDash(e,n){let l=this.getKey(e,n);if(this.positions[l])return this.positions[l];let u=n==="round",m=u?7:0,p=2*m+1;if(this.nextRow+p>this.height)return Vr("LineAtlas out of space"),null;e.length===0&&e.push(1);let b=0;for(let k=0;k<e.length;k++)e[k]<0&&(Vr("Negative value is found in line dasharray, replacing values with 0"),e[k]=0),b+=e[k];if(b!==0){let k=this.width/b,D=this.getDashRanges(e,this.width,k);u?this.addRoundDash(D,k,m):this.addRegularDash(D,n==="square"?.5*k:0)}let v=this.nextRow+m;this.nextRow+=p;let S={tl:[v,m],br:[b,0]};return this.positions[l]=S,S}}de(xM,"LineAtlas");let AR=B_.types,PR=Math.cos(Math.PI/180*37.5),OR=Math.cos(Math.PI/180*5);class Vx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new gb,this.layoutVertexArray2=new Sd,this.patternVertexArray=new ju,this.indexArray=new xo,this.programConfigurations=new qu(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Ir,this.maxLineLength=0,this.zOffsetVertexArray=new _m,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:At/64}updateFootprints(e,n){}populate(e,n,l,u){this.hasPattern=ty("line",this.layers,n);let m=this.layers[0].layout.get("line-sort-key"),p=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!p.isConstant()||!!p.constantOr(0);let b=[];for(let{feature:D,id:A,index:L,sourceLayerIndex:z}of e){let V=this.layers[0]._featureFilter.needGeometry,H=Ed(D,V);if(!this.layers[0]._featureFilter.filter(new Vt(this.zoom),H,l))continue;let Y=m?m.evaluate(H,{},l):void 0,ne={id:A,properties:D.properties,type:D.type,sourceLayerIndex:z,index:L,geometry:V?H.geometry:xs(D,l,u),patterns:{},sortKey:Y};b.push(ne)}m&&b.sort((D,A)=>D.sortKey-A.sortKey);let{lineAtlas:v,featureIndex:S}=n,k=this.addConstantDashes(v);for(let D of b){let{geometry:A,index:L,sourceLayerIndex:z}=D;if(k&&this.addFeatureDashes(D,v),this.hasPattern){let V=iy("line",this.layers,D,this.zoom,n);this.patternFeatures.push(V)}else this.addFeature(D,A,L,l,v.positions,n.availableImages,n.brightness);S.insert(e[L].feature,A,L,z,this.index)}}addConstantDashes(e){let n=!1;for(let l of this.layers){let u=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if(u.kind!=="constant"||m.kind!=="constant")n=!0;else{let p=m.value,b=u.value;if(!b)continue;e.addDash(b,p)}}return n}addFeatureDashes(e,n){let l=this.zoom;for(let u of this.layers){let m=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(m.kind==="constant"&&p.kind==="constant")continue;let b,v;if(m.kind==="constant"){if(b=m.value,!b)continue}else b=m.evaluate({zoom:l},e);v=p.kind==="constant"?p.value:p.evaluate({zoom:l},e),n.addDash(b,v),e.patterns[u.id]=n.getKey(b,v)}}update(e,n,l,u,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,l,u,m)}addFeatures(e,n,l,u,m,p){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,n,l,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,On)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Un)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Co.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ti),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,l,u,m,p,b){let v=this.layers[0].layout,S=v.get("line-join").evaluate(e,{}),k=v.get("line-cap").evaluate(e,{}),D=v.get("line-miter-limit"),A=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let L of n)this.addLine(L,e,u,S,k,D,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,p,u,b)}addLine(e,n,l,u,m,p,b){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let v={zoom:this.zoom,lineProgress:void 0},S=this.layers[0].layout,k=u==="none";if(this.patternJoinNone=this.hasPattern&&k,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<e.length-1;be++)this.totalDistance+=e[be].dist(e[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let D=AR[n.type]==="Polygon",A=e.length;for(;A>=2&&e[A-1].equals(e[A-2]);)A--;let L=0;for(;L<A-1&&e[L].equals(e[L+1]);)L++;if(A<(D?3:2))return;u==="bevel"&&(p=1.05);let z=this.overscaling<=16?15*At/(512*this.overscaling):0,V=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray),H,Y,ne,re,oe,xe;this.e1=this.e2=-1,D&&(H=e[A-2],oe=e[L].sub(H)._unit()._perp());for(let be=L;be<A;be++){if(ne=be===A-1?D?e[L+1]:void 0:e[be+1],ne&&e[be].equals(ne))continue;if(oe&&(re=oe),H&&(Y=H),H=e[be],this.hasZOffset){let tt=S.get("line-z-offset").value;if(tt.kind==="constant")xe=tt.value;else{if(this.lineClips){let mt=this.totalDistance/(this.lineClips.end-this.lineClips.start);v.lineProgress=(mt*this.lineClips.start+this.distance+(Y?Y.dist(H):0))/mt}else Vr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),v.lineProgress=0;xe=tt.evaluate(v,n)}xe=xe||0}oe=ne?ne.sub(H)._unit()._perp():re,re=re||oe;let ke=Y&&ne,Ae=ke?u:D||k?"butt":m,je=re.x*oe.x+re.y*oe.y;if(k){let tt=function(mt){if(mt.patternJoinNone){let Ct=mt.segmentPoints.length/2,ft=mt.lineSoFar-mt.segmentStart;for(let Ht=0;Ht<Ct;++Ht){let xt=mt.segmentPoints[2*Ht+1],Mt=Math.round(mt.segmentPoints[2*Ht])+.5+.25*xt;mt.patternVertexArray.emplaceBack(Mt,ft,mt.segmentStart),mt.patternVertexArray.emplaceBack(Mt,ft,mt.segmentStart)}mt.segmentPoints.length=0}mt.e1=mt.e2=-1};if(ke&&je<OR){this.updateDistance(Y,H),this.addCurrentVertex(H,re,1,1,V,xe),tt(this),this.addCurrentVertex(H,oe,-1,-1,V,xe);continue}if(Y){if(!ne){this.updateDistance(Y,H),this.addCurrentVertex(H,re,1,1,V,xe),tt(this);continue}Ae="miter"}}let Qe=re.add(oe);Qe.x===0&&Qe.y===0||Qe._unit();let $e=Qe.x*oe.x+Qe.y*oe.y,st=$e!==0?1/$e:1/0,vt=2*Math.sqrt(2-2*$e),at=$e<PR&&Y&&ne,ht=re.x*oe.y-re.y*oe.x>0;if(at&&be>L){let tt=H.dist(Y);if(tt>2*z){let mt=H.sub(H.sub(Y)._mult(z/tt)._round());this.updateDistance(Y,mt),this.addCurrentVertex(mt,re,0,0,V,xe),Y=mt}}if(ke&&Ae==="round"&&(st<b?Ae="miter":st<=2&&(Ae="fakeround")),Ae==="miter"&&st>p&&(Ae="bevel"),Ae==="bevel"&&(st>2&&(Ae="flipbevel"),st<p&&(Ae="miter")),Y&&this.updateDistance(Y,H),Ae==="miter")Qe._mult(st),this.addCurrentVertex(H,Qe,0,0,V,xe);else if(Ae==="flipbevel"){if(st>100)Qe=oe.mult(-1);else{let tt=st*re.add(oe).mag()/re.sub(oe).mag();Qe._perp()._mult(tt*(ht?-1:1))}this.addCurrentVertex(H,Qe,0,0,V,xe),this.addCurrentVertex(H,Qe.mult(-1),0,0,V,xe)}else if(Ae==="bevel"||Ae==="fakeround"){let tt=-Math.sqrt(st*st-1),mt=ht?tt:0,Ct=ht?0:tt;if(Y&&this.addCurrentVertex(H,re,mt,Ct,V,xe),Ae==="fakeround"){let ft=Math.round(180*vt/Math.PI/20);for(let Ht=1;Ht<ft;Ht++){let xt=Ht/ft;if(xt!==.5){let oi=xt-.5;xt+=xt*oi*(xt-1)*((1.0904+je*(je*(3.55645-1.43519*je)-3.2452))*oi*oi+(.848013+je*(.215638*je-1.06021)))}let Mt=oe.sub(re)._mult(xt)._add(re)._unit()._mult(ht?-1:1);this.addHalfVertex(H,Mt.x,Mt.y,!1,ht,0,V,xe)}}ne&&this.addCurrentVertex(H,oe,-mt,-Ct,V,xe)}else Ae==="butt"?this.addCurrentVertex(H,Qe,0,0,V,xe):Ae==="square"?(Y||this.addCurrentVertex(H,Qe,-1,-1,V,xe),this.addCurrentVertex(H,Qe,0,0,V,xe),Y&&this.addCurrentVertex(H,Qe,1,1,V,xe)):Ae==="round"&&(Y&&(this.addCurrentVertex(H,re,0,0,V,xe),this.addCurrentVertex(H,re,1,1,V,xe,!0)),ne&&(this.addCurrentVertex(H,oe,-1,-1,V,xe,!0),this.addCurrentVertex(H,oe,0,0,V,xe)));if(at&&be<A-1){let tt=H.dist(ne);if(tt>2*z){let mt=H.add(ne.sub(H)._mult(z/tt)._round());this.updateDistance(H,mt),this.addCurrentVertex(mt,oe,0,0,V,xe),H=mt}}}}addVerticesTo(e,n,l,u,m,p,b,v,S,k){let D=(n.w-e.w)/this.tessellationStep|0;if(D>1){this.lineSoFar=e.w;let A=(n.x-e.x)/D,L=(n.y-e.y)/D,z=(n.z-e.z)/D,V=(n.w-e.w)/D;for(let H=1;H<D;++H)e.x+=A,e.y+=L,e.z+=z,this.lineSoFar+=V,this.addHalfVertex(e,l,u,k,!1,b,S,e.z),this.addHalfVertex(e,m,p,k,!0,-v,S,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,l,u,k,!1,b,S,n.z),this.addHalfVertex(n,m,p,k,!0,-v,S,n.z)}addCurrentVertex(e,n,l,u,m,p,b=!1){let v=n.x+n.y*l,S=n.y-n.x*l,k=n.y*u-n.x,D=-n.y-n.x*u;if(p!=null){let L=At+10,z=p,V=new oy(e.x,e.y,z,this.lineSoFar),H=wM(e,-10,L),Y=this.lineSoFar;if(this.currentVertex)if(H){let ne=this.currentVertexIsOutside,re=this.currentVertex,oe=new oy(e.x,e.y,z,this.lineSoFar);vx(re,oe,-10,L),wM(oe,-10,L)||(ne&&(this.e1=this.e2=-1,this.lineSoFar=re.w,this.addHalfVertex(re,v,S,b,!1,l,m,re.z),this.addHalfVertex(re,k,D,b,!0,-u,m,re.z)),this.addVerticesTo(re,oe,v,S,k,D,l,u,m,b))}else{let ne=this.currentVertex;this.currentVertexIsOutside&&(vx(ne,V,-10,L),this.e1=this.e2=-1,this.lineSoFar=ne.w,this.addHalfVertex(ne,v,S,b,!1,l,m,ne.z),this.addHalfVertex(ne,k,D,b,!0,-u,m,ne.z)),this.addVerticesTo(ne,V,v,S,k,D,l,u,m,b)}else H||(this.addHalfVertex(e,v,S,b,!1,l,m,p),this.addHalfVertex(e,k,D,b,!0,-u,m,p));this.currentVertex=V,this.currentVertexIsOutside=H,this.lineSoFar=Y}else this.addHalfVertex(e,v,S,b,!1,l,m,p),this.addHalfVertex(e,k,D,b,!0,-u,m,p)}addHalfVertex({x:e,y:n},l,u,m,p,b,v,S){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(n<<1)+(p?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let k=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),v.primitiveLength++),p?this.e2=k:this.e1=k,S!=null&&this.zOffsetVertexArray.emplaceBack(S)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function wM(i,e,n){return i.x<e||i.x>n||i.y<e||i.y>n}de(Vx,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let RR=new vn({"line-cap":new Lt(Ue.layout_line["line-cap"]),"line-join":new Lt(Ue.layout_line["line-join"]),"line-miter-limit":new dt(Ue.layout_line["line-miter-limit"]),"line-round-limit":new dt(Ue.layout_line["line-round-limit"]),"line-sort-key":new Lt(Ue.layout_line["line-sort-key"]),"line-z-offset":new Lt(Ue.layout_line["line-z-offset"]),visibility:new dt(Ue.layout_line.visibility)});var jx={paint:new vn({"line-opacity":new Lt(Ue.paint_line["line-opacity"]),"line-color":new Lt(Ue.paint_line["line-color"]),"line-translate":new dt(Ue.paint_line["line-translate"]),"line-translate-anchor":new dt(Ue.paint_line["line-translate-anchor"]),"line-width":new Lt(Ue.paint_line["line-width"]),"line-gap-width":new Lt(Ue.paint_line["line-gap-width"]),"line-offset":new Lt(Ue.paint_line["line-offset"]),"line-blur":new Lt(Ue.paint_line["line-blur"]),"line-dasharray":new Lt(Ue.paint_line["line-dasharray"]),"line-pattern":new Lt(Ue.paint_line["line-pattern"]),"line-gradient":new Sr(Ue.paint_line["line-gradient"]),"line-trim-offset":new dt(Ue.paint_line["line-trim-offset"]),"line-trim-fade-range":new dt(Ue.paint_line["line-trim-fade-range"]),"line-trim-color":new dt(Ue.paint_line["line-trim-color"]),"line-emissive-strength":new dt(Ue.paint_line["line-emissive-strength"]),"line-border-width":new Lt(Ue.paint_line["line-border-width"]),"line-border-color":new Lt(Ue.paint_line["line-border-color"]),"line-occlusion-opacity":new dt(Ue.paint_line["line-occlusion-opacity"])}),layout:RR};function CM(i,e,n){return e*(At/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function SM(i,e){return 1/CM(i,1,e.tileZoom)}function IM(i,e,n,l){return i.translatePosMatrix(l||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let TM=i=>{let e=[];MM(i)&&e.push("RENDER_LINE_DASH"),i.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=i.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),i.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let l=i.layout.get("line-join").constantOr("miter")==="none",u=!!i.paint.get("line-pattern").constantOr(1);return l&&u&&e.push("LINE_JOIN_NONE"),e};function MM(i){let e=i.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class kM{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let l=e[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var FR={read:function(i,e,n,l,u){var m,p,b=8*u-l-1,v=(1<<b)-1,S=v>>1,k=-7,D=n?u-1:0,A=n?-1:1,L=i[e+D];for(D+=A,m=L&(1<<-k)-1,L>>=-k,k+=b;k>0;m=256*m+i[e+D],D+=A,k-=8);for(p=m&(1<<-k)-1,m>>=-k,k+=l;k>0;p=256*p+i[e+D],D+=A,k-=8);if(m===0)m=1-S;else{if(m===v)return p?NaN:1/0*(L?-1:1);p+=Math.pow(2,l),m-=S}return(L?-1:1)*p*Math.pow(2,m-l)},write:function(i,e,n,l,u,m){var p,b,v,S=8*m-u-1,k=(1<<S)-1,D=k>>1,A=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=l?0:m-1,z=l?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,p=k):(p=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-p))<1&&(p--,v*=2),(e+=p+D>=1?A/v:A*Math.pow(2,1-D))*v>=2&&(p++,v/=2),p+D>=k?(b=0,p=k):p+D>=1?(b=(e*v-1)*Math.pow(2,u),p+=D):(b=e*Math.pow(2,D-1)*Math.pow(2,u),p=0));u>=8;i[n+L]=255&b,L+=z,b/=256,u-=8);for(p=p<<u|b,S+=u;S>0;i[n+L]=255&p,L+=z,p/=256,S-=8);i[n+L-z]|=128*V}},EM=Ar,Ux=FR;function Ar(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ar.Varint=0,Ar.Fixed64=1,Ar.Bytes=2,Ar.Fixed32=5;var q2=4294967296,DM=1/q2,AM=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Cm(i){return i.type===Ar.Bytes?i.readVarint()+i.pos:i.pos+1}function Y_(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function PM(i,e,n){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(l);for(var u=n.pos-1;u>=i;u--)n.buf[u+l]=n.buf[u]}function LR(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function zR(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function BR(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function NR(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function VR(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function jR(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function UR(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function WR(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function HR(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function Wx(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Z_(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function OM(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Ar.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var l=this.readVarint(),u=l>>3,m=this.pos;this.type=7&l,i(u,e,this),this.pos===m&&this.skip(l)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Wx(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=OM(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Wx(this.buf,this.pos)+Wx(this.buf,this.pos+4)*q2;return this.pos+=8,i},readSFixed64:function(){var i=Wx(this.buf,this.pos)+OM(this.buf,this.pos+4)*q2;return this.pos+=8,i},readFloat:function(){var i=Ux.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Ux.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,l=this.buf;return e=127&(n=l[this.pos++]),n<128?e:(e|=(127&(n=l[this.pos++]))<<7,n<128?e:(e|=(127&(n=l[this.pos++]))<<14,n<128?e:(e|=(127&(n=l[this.pos++]))<<21,n<128?e:function(u,m,p){var b,v,S=p.buf;if(b=(112&(v=S[p.pos++]))>>4,v<128||(b|=(127&(v=S[p.pos++]))<<3,v<128)||(b|=(127&(v=S[p.pos++]))<<10,v<128)||(b|=(127&(v=S[p.pos++]))<<17,v<128)||(b|=(127&(v=S[p.pos++]))<<24,v<128)||(b|=(1&(v=S[p.pos++]))<<31,v<128))return Y_(u,b,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=l[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&AM?function(n,l,u){return AM.decode(n.subarray(l,u))}(this.buf,e,i):function(n,l,u){for(var m="",p=l;p<u;){var b,v,S,k=n[p],D=null,A=k>239?4:k>223?3:k>191?2:1;if(p+A>u)break;A===1?k<128&&(D=k):A===2?(192&(b=n[p+1]))==128&&(D=(31&k)<<6|63&b)<=127&&(D=null):A===3?(v=n[p+2],(192&(b=n[p+1]))==128&&(192&v)==128&&((D=(15&k)<<12|(63&b)<<6|63&v)<=2047||D>=55296&&D<=57343)&&(D=null)):A===4&&(v=n[p+2],S=n[p+3],(192&(b=n[p+1]))==128&&(192&v)==128&&(192&S)==128&&((D=(15&k)<<18|(63&b)<<12|(63&v)<<6|63&S)<=65535||D>=1114112)&&(D=null)),D===null?(D=65533,A=1):D>65535&&(D-=65536,m+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),m+=String.fromCharCode(D),p+=A}return m}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ar.Bytes)return i.push(this.readVarint(e));var n=Cm(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ar.Bytes)return i.push(this.readSVarint());var e=Cm(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ar.Bytes)return i.push(this.readBoolean());var e=Cm(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ar.Bytes)return i.push(this.readFloat());var e=Cm(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ar.Bytes)return i.push(this.readDouble());var e=Cm(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ar.Bytes)return i.push(this.readFixed32());var e=Cm(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ar.Bytes)return i.push(this.readSFixed32());var e=Cm(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ar.Bytes)return i.push(this.readFixed64());var e=Cm(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ar.Bytes)return i.push(this.readSFixed64());var e=Cm(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ar.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ar.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ar.Fixed32)this.pos+=4;else{if(e!==Ar.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Z_(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Z_(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Z_(this.buf,-1&i,this.pos),Z_(this.buf,Math.floor(i*DM),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Z_(this.buf,-1&i,this.pos),Z_(this.buf,Math.floor(i*DM),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var l,u;if(e>=0?(l=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,p,b){b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7)}(l,0,n),function(m,p){var b=(7&m)<<4;p.buf[p.pos++]|=b|((m>>>=3)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m)))))}(u,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(l,u,m){for(var p,b,v=0;v<u.length;v++){if((p=u.charCodeAt(v))>55295&&p<57344){if(!b){p>56319||v+1===u.length?(l[m++]=239,l[m++]=191,l[m++]=189):b=p;continue}if(p<56320){l[m++]=239,l[m++]=191,l[m++]=189,b=p;continue}p=b-55296<<10|p-56320|65536,b=null}else b&&(l[m++]=239,l[m++]=191,l[m++]=189,b=null);p<128?l[m++]=p:(p<2048?l[m++]=p>>6|192:(p<65536?l[m++]=p>>12|224:(l[m++]=p>>18|240,l[m++]=p>>12&63|128),l[m++]=p>>6&63|128),l[m++]=63&p|128)}return m}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&PM(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Ux.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Ux.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var l=this.pos-n;l>=128&&PM(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l},writeMessage:function(i,e,n){this.writeTag(i,Ar.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,LR,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,zR,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,VR,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,BR,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,NR,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,jR,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,UR,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,WR,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,HR,e)},writeBytesField:function(i,e){this.writeTag(i,Ar.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ar.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ar.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ar.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ar.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ar.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ar.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ar.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ar.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ar.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var X_=Ke(EM);let GR=["id","tile","layer","source","sourceLayer","state"];class RM{constructor(e,n,l,u,m){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=l,this._y=u,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let n of GR)this[n]!==void 0&&(e[n]=this[n]);return e}}class qR{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,l){let u=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Mo(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(let m in this.state[e])m!==u&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(let m in this.state[e][u])l[m]||(this.deletedStates[e][u][m]=null)}else for(let m in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][m]===null&&delete this.deletedStates[e][u][m]}removeFeatureState(e,n,l){if(this.deletedStates[e]===null)return;let u=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&n!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,n){let l=String(n),u=Mo({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let m=this.deletedStates[e][n];if(m===null)return{};for(let p in m)delete u[p]}return u}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let l={};for(let u in this.stateChanges){this.state[u]=this.state[u]||{};let m={};for(let p in this.stateChanges[u])this.state[u][p]||(this.state[u][p]={}),Mo(this.state[u][p],this.stateChanges[u][p]),m[p]=this.state[u][p];l[u]=m}for(let u in this.deletedStates){this.state[u]=this.state[u]||{};let m={};if(this.deletedStates[u]===null)for(let p in this.state[u])m[p]={},this.state[u][p]={};else for(let p in this.deletedStates[u]){if(this.deletedStates[u][p]===null)this.state[u][p]={};else if(this.state[u][p])for(let b of Object.keys(this.deletedStates[u][p]))delete this.state[u][p][b];m[p]=this.state[u][p]}l[u]=l[u]||{},Mo(l[u],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(let u in e)e[u].setFeatureState(l,n)}}class FM{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ce(At,16,0),this.featureIndexArray=new kv,this.promoteId=n,this.is3DTile=!1}insert(e,n,l,u,m,p=0,b=0){let v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,m,p);let S=this.grid;for(let k=0;k<n.length;k++){let D=n[k],A=[1/0,1/0,-1/0,-1/0];for(let L=0;L<D.length;L++){let z=D[L];A[0]=Math.min(A[0],z.x),A[1]=Math.min(A[1],z.y),A[2]=Math.max(A[2],z.x),A[3]=Math.max(A[3],z.y)}b!==0&&(A[0]-=b,A[1]-=b,A[2]+=b,A[3]+=b),A[0]<At&&A[1]<At&&A[2]>=0&&A[3]>=0&&S.insert(v,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ry(new X_(this.rawTileData)).layers,this.sourceLayerCoder=new kM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,l,u){this.loadVTLayers();let m=e.params||{},p=Gn(m.filter),b=e.tileResult,v=e.transform,S=b.bufferedTilespaceBounds,k=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(z,V,H,Y)=>Hv(b.bufferedTilespaceGeometry,z,V,H,Y));k.sort($R);let D=null;v.elevation&&k.length>0&&(D=th.create(v.elevation,this.tileID));let A={},L;for(let z=0;z<k.length;z++){let V=k[z];if(V===L)continue;L=V;let H=this.featureIndexArray.get(V),Y=null;if(this.is3DTile){let ne=this.bucketLayerIDs[0][0],re=n[ne];if(re.type!=="model")continue;let{queryFeature:oe,intersectionZ:xe}=re.queryIntersectsMatchingFeature(b,H.featureIndex,p,v);oe&&this.appendToResult(A,ne,H.featureIndex,oe,xe)}else this.loadMatchingFeature(A,H,p,m.layers,m.availableImages,n,l,u,(ne,re,oe,xe=0)=>(Y||(Y=xs(ne,this.tileID.canonical,e.tileTransform)),re.queryIntersectsFeature(b,ne,oe,Y,this.z,e.transform,e.pixelPosMatrix,D,xe)))}return A}loadMatchingFeature(e,n,l,u,m,p,b,v,S){let{featureIndex:k,bucketIndex:D,sourceLayerIndex:A,layoutVertexArrayOffset:L}=n,z=this.bucketLayerIDs[D];if(u&&!function(ne,re){for(let oe=0;oe<ne.length;oe++)if(re.indexOf(ne[oe])>=0)return!0;return!1}(u,z))return;let V=this.sourceLayerCoder.decode(A),H=this.vtLayers[V].feature(k);if(l.needGeometry){let ne=Ed(H,!0);if(!l.filter(new Vt(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!l.filter(new Vt(this.tileID.overscaledZ),H))return;let Y=this.getId(H,V);for(let ne=0;ne<z.length;ne++){let re=z[ne];if(u&&u.indexOf(re)<0)continue;let oe=p[re];if(!oe)continue;let xe={};Y!==void 0&&v&&(xe=v.getState(oe.sourceLayer||"_geojsonTileLayer",Y));let be=!S||S(H,oe,xe,L);if(!be)continue;let ke=new RM(H,this.z,this.x,this.y,Y),Ae=Mo({},b[re]);Ae.paint=LM(Ae.paint,oe.paint,H,xe,m),Ae.layout=LM(Ae.layout,oe.layout,H,xe,m),ke.layer=Ae,this.appendToResult(e,re,k,ke,be)}}appendToResult(e,n,l,u,m){let p=e[n];p===void 0&&(p=e[n]=[]),p.push({featureIndex:l,feature:u,intersectionZ:m})}lookupSymbolFeatures(e,n,l,u,m,p,b,v){let S={};this.loadVTLayers();let k=Gn(m);for(let D of e)this.loadMatchingFeature(S,{bucketIndex:l,sourceLayerIndex:u,featureIndex:D,layoutVertexArrayOffset:0},k,p,b,v,n);return S}loadFeature(e){let{featureIndex:n,sourceLayerIndex:l}=e;this.loadVTLayers();let u=this.sourceLayerCoder.decode(l),m=this.vtFeatures[u];if(m[n])return m[n];let p=this.vtLayers[u].feature(n);return m[n]=p,p}hasLayer(e){for(let n of this.bucketLayerIDs)for(let l of n)if(e===l)return!0;return!1}getId(e,n){let l=e.id;if(this.promoteId){let u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];u!=null&&(l=e.properties[u]),typeof l=="boolean"&&(l=Number(l))}return l}}function LM(i,e,n,l,u){return jo(i,(m,p)=>{let b=e instanceof Fn?e.get(p):null;return b&&b.evaluate?b.evaluate(n,l,u):b})}function $R(i,e){return e-i}de(FM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Pa=24;let Rd=128;function $2(i,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Vt(i+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:l,interpolationType:u}=n,m=0;for(;m<l.length&&l[m]<=i;)m++;m=Math.max(0,m-1);let p=m;for(;p<l.length&&l[p]<i+1;)p++;p=Math.min(l.length-1,p);let b=l[m],v=l[p];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:v,interpolationType:u}:{kind:"camera",minZoom:b,maxZoom:v,minSize:n.evaluate(new Vt(b)),maxSize:n.evaluate(new Vt(v)),interpolationType:u}}}function Hx(i,{uSize:e,uSizeT:n},{lowerSize:l,upperSize:u}){return i.kind==="source"?l/Rd:i.kind==="composite"?ri(l/Rd,u/Rd,n):e}function Q_(i,e){let n=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){let{interpolationType:u,minZoom:m,maxZoom:p}=i,b=u?Ri(Ma.interpolationFactor(u,e,m,p),0,1):0;i.kind==="camera"?l=ri(i.minSize,i.maxSize,b):n=b}return{uSizeT:n,uSize:l}}var YR=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Rd,evaluateSizeForFeature:Hx,evaluateSizeForZoom:Q_,getSizeData:$2});function ZR(i,e,n){return i.sections.forEach(l=>{l.text=function(u,m,p){let b=m.layout.get("text-transform").evaluate(p,{});return b==="uppercase"?u=u.toLocaleUpperCase():b==="lowercase"&&(u=u.toLocaleLowerCase()),yn.applyArabicShaping&&(u=yn.applyArabicShaping(u)),u}(l.text,e,n)}),i}let ly={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function XR(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function QR(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}let Y2=3;function KR(i,e,n){e.glyphs=[],i===1&&n.readMessage(JR,e)}function JR(i,e,n){if(i===3){let{id:l,bitmap:u,width:m,height:p,left:b,top:v,advance:S}=n.readMessage(eF,{});e.glyphs.push({id:l,bitmap:new Ku({width:m+2*Y2,height:p+2*Y2},u),metrics:{width:m,height:p,left:b,top:v,advance:S}})}else i===4?e.ascender=n.readSVarint():i===5&&(e.descender=n.readSVarint())}function eF(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}let zM=Y2,ic={horizontal:1,vertical:2,horizontalOnly:3};class cy{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let l=new cy;return l.scale=e||1,l.fontStack=n,l}static forImage(e){let n=new cy;return n.imageName=e,n}}class K_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let l=new K_;for(let u=0;u<e.sections.length;u++){let m=e.sections[u];m.image?l.addImageSection(m):l.addTextSection(m,n)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,l){let u="";for(let m=0;m<n.length;m++){let p=n.charCodeAt(m+1)||null,b=n.charCodeAt(m-1)||null;u+=!l&&(p&&lt(p)&&!ly[n[m+1]]||b&&lt(b)&&!ly[n[m-1]])||!ly[n[m]]?n[m]:ly[n[m]]}return u}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Gx[this.text.charCodeAt(l)];l++)e++;let n=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Gx[this.text.charCodeAt(l)];l--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let l=new K_;return l.text=this.text.substring(e,n),l.sectionIndex=this.sectionIndex.slice(e,n),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(cy.forText(e.scale,e.fontStack||n));let l=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(l)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void Vr("Can't add FormattedSection with an empty image.");let l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCodePoint(l),this.sections.push(cy.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Vr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Z2(i,e,n,l,u,m,p,b,v,S,k,D,A,L,z){let V=K_.fromFeature(i,u);D===ic.vertical&&V.verticalizePunctuation(A);let H=[],Y=function(be,ke,Ae,je,Qe,$e){if(!be)return[];let st=[],vt=function(mt,Ct,ft,Ht,xt,Mt){let oi=0;for(let ti=0;ti<mt.length();ti++){let Jt=mt.getSection(ti);oi+=BM(mt.getCodePoint(ti),Jt,Ht,xt,Ct,Mt)}return oi/Math.max(1,Math.ceil(oi/ft))}(be,ke,Ae,je,Qe,$e),at=be.text.indexOf("\u200B")>=0,ht=0;for(let mt=0;mt<be.length();mt++){let Ct=be.getSection(mt),ft=be.getCodePoint(mt);if(Gx[ft]||(ht+=BM(ft,Ct,je,Qe,ke,$e)),mt<be.length()-1){let Ht=!((tt=ft)<11904||!(ye["Bopomofo Extended"](tt)||ye.Bopomofo(tt)||ye["CJK Compatibility Forms"](tt)||ye["CJK Compatibility Ideographs"](tt)||ye["CJK Compatibility"](tt)||ye["CJK Radicals Supplement"](tt)||ye["CJK Strokes"](tt)||ye["CJK Symbols and Punctuation"](tt)||ye["CJK Unified Ideographs Extension A"](tt)||ye["CJK Unified Ideographs"](tt)||ye["Enclosed CJK Letters and Months"](tt)||ye["Halfwidth and Fullwidth Forms"](tt)||ye.Hiragana(tt)||ye["Ideographic Description Characters"](tt)||ye["Kangxi Radicals"](tt)||ye["Katakana Phonetic Extensions"](tt)||ye.Katakana(tt)||ye["Vertical Forms"](tt)||ye["Yi Radicals"](tt)||ye["Yi Syllables"](tt)));(tF[ft]||Ht||Ct.imageName)&&st.push(VM(mt+1,ht,vt,st,iF(ft,be.getCodePoint(mt+1),Ht&&at),!1))}}var tt;return jM(VM(be.length(),ht,vt,st,0,!0))}(V,S,m,e,l,L),{processBidirectionalText:ne,processStyledBidirectionalText:re}=yn;if(ne&&V.sections.length===1){let be=ne(V.toString(),Y);for(let ke of be){let Ae=new K_;Ae.text=ke,Ae.sections=V.sections;for(let je=0;je<ke.length;je++)Ae.sectionIndex.push(0);H.push(Ae)}}else if(re){let be=re(V.text,V.sectionIndex,Y);for(let ke of be){let Ae=new K_;Ae.text=ke[0],Ae.sectionIndex=ke[1],Ae.sections=V.sections,H.push(Ae)}}else H=function(be,ke){let Ae=[],je=be.text,Qe=0;for(let $e of ke)Ae.push(be.substring(Qe,$e)),Qe=$e;return Qe<je.length&&Ae.push(be.substring(Qe,je.length)),Ae}(V,Y);let oe=[],xe={positionedLines:oe,text:V.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(be,ke,Ae,je,Qe,$e,st,vt,at,ht,tt,mt){let Ct=0,ft=0,Ht=0,xt=vt==="right"?1:vt==="left"?0:.5,Mt=!1;for(let Ei of Qe){let gi=Ei.getSections();for(let Li of gi){if(Li.imageName)continue;let Di=ke[Li.fontStack];if(Di&&(Mt=Di.ascender!==void 0&&Di.descender!==void 0,!Mt))break}if(!Mt)break}let oi=0;for(let Ei of Qe){Ei.trim();let gi=Ei.getMaxScale(),Li=(gi-1)*Pa,Di={positionedGlyphs:[],lineOffset:0};be.positionedLines[oi]=Di;let Xi=Di.positionedGlyphs,mi=0;if(!Ei.length()){ft+=$e,++oi;continue}let qn=0,Wn=0;for(let fn=0;fn<Ei.length();fn++){let Tn=Ei.getSection(fn),ur=Ei.getSectionIndex(fn),tr=Ei.getCodePoint(fn),jr=Tn.scale,Lr=null,Wa=null,to=null,Pr=Pa,So=0,pa=!(at===ic.horizontal||!tt&&!ut(tr)||tt&&(Gx[tr]||(ti=tr,ye.Arabic(ti)||ye["Arabic Supplement"](ti)||ye["Arabic Extended-A"](ti)||ye["Arabic Presentation Forms-A"](ti)||ye["Arabic Presentation Forms-B"](ti))));if(Tn.imageName){let fa=je[Tn.imageName];if(!fa)continue;to=Tn.imageName,be.iconsInText=be.iconsInText||!0,Wa=fa.paddedRect;let ar=fa.displaySize;jr=jr*Pa/mt,Lr={width:ar[0],height:ar[1],left:0,top:-zM,advance:pa?ar[1]:ar[0],localGlyph:!1},So=Mt?-Lr.height*jr:gi*Pa-17-ar[1]*jr,Pr=Lr.advance;let Is=(pa?ar[0]:ar[1])*jr-Pa*gi;Is>0&&Is>mi&&(mi=Is)}else{let fa=Ae[Tn.fontStack];if(!fa)continue;fa[tr]&&(Wa=fa[tr]);let ar=ke[Tn.fontStack];if(!ar)continue;let Is=ar.glyphs[tr];if(!Is)continue;if(Lr=Is.metrics,Pr=tr!==8203?Pa:0,Mt){let Im=ar.ascender!==void 0?Math.abs(ar.ascender):0,Vc=ar.descender!==void 0?Math.abs(ar.descender):0,jd=(Im+Vc)*jr;qn<jd&&(qn=jd,Wn=(Im-Vc)/2*jr),So=-Im*jr}else So=(gi-jr)*Pa-17}pa?(be.verticalizable=!0,Xi.push({glyph:tr,imageName:to,x:Ct,y:ft+So,vertical:pa,scale:jr,localGlyph:Lr.localGlyph,fontStack:Tn.fontStack,sectionIndex:ur,metrics:Lr,rect:Wa}),Ct+=Pr*jr+ht):(Xi.push({glyph:tr,imageName:to,x:Ct,y:ft+So,vertical:pa,scale:jr,localGlyph:Lr.localGlyph,fontStack:Tn.fontStack,sectionIndex:ur,metrics:Lr,rect:Wa}),Ct+=Lr.advance*jr+ht)}Xi.length!==0&&(Ht=Math.max(Ct-ht,Ht),Mt?UM(Xi,xt,mi,Wn,$e*gi/2):UM(Xi,xt,mi,0,$e/2)),Ct=0;let In=$e*gi+mi;Di.lineOffset=Math.max(mi,Li),ft+=In,++oi}var ti;let Jt=ft,{horizontalAlign:Tt,verticalAlign:li}=X2(st);(function(Ei,gi,Li,Di,Xi,mi){let qn=(gi-Li)*Xi,Wn=-mi*Di;for(let In of Ei)for(let fn of In.positionedGlyphs)fn.x+=qn,fn.y+=Wn})(be.positionedLines,xt,Tt,li,Ht,Jt),be.top+=-li*Jt,be.bottom=be.top+Jt,be.left+=-Tt*Ht,be.right=be.left+Ht,be.hasBaseline=Mt}(xe,e,n,l,H,p,b,v,D,S,A,z),!function(be){for(let ke of be)if(ke.positionedGlyphs.length!==0)return!1;return!0}(oe)&&xe}let Gx={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tF={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function BM(i,e,n,l,u,m){if(e.imageName){let p=l[e.imageName];return p?p.displaySize[0]*e.scale*Pa/m+u:0}{let p=n[e.fontStack],b=p&&p.glyphs[i];return b?b.metrics.advance*e.scale+u:0}}function NM(i,e,n,l){let u=Math.pow(i-e,2);return l?i<e?u/2:2*u:u+Math.abs(n)*n}function iF(i,e,n){let l=0;return i===10&&(l-=1e4),n&&(l+=150),i!==40&&i!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function VM(i,e,n,l,u,m){let p=null,b=NM(e,n,u,m);for(let v of l){let S=NM(e-v.x,n,u,m)+v.badness;S<=b&&(p=v,b=S)}return{index:i,x:e,priorBreak:p,badness:b}}function jM(i){return i?jM(i.priorBreak).concat(i.index):[]}function X2(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function UM(i,e,n,l,u){if(!(e||n||l||u))return;let m=i.length-1,p=i[m],b=(p.x+p.metrics.advance*p.scale)*e;for(let v=0;v<=m;v++)i[v].x-=b,i[v].y+=n+l+u}function nF(i,e,n,l){let{horizontalAlign:u,verticalAlign:m}=X2(l),p=n[0]-i.displaySize[0]*u,b=n[1]-i.displaySize[1]*m;return{imagePrimary:i,imageSecondary:e,top:b,bottom:b+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function WM(i,e,n,l,u,m){let p=i.imagePrimary,b;if(p.content){let H=p.content,Y=p.pixelRatio||1;b=[H[0]/Y,H[1]/Y,p.displaySize[0]-H[2]/Y,p.displaySize[1]-H[3]/Y]}let v=e.left*m,S=e.right*m,k,D,A,L;n==="width"||n==="both"?(L=u[0]+v-l[3],D=u[0]+S+l[1]):(L=u[0]+(v+S-p.displaySize[0])/2,D=L+p.displaySize[0]);let z=e.top*m,V=e.bottom*m;return n==="height"||n==="both"?(k=u[1]+z-l[0],A=u[1]+V+l[2]):(k=u[1]+(z+V-p.displaySize[1])/2,A=k+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:k,right:D,bottom:A,left:L,collisionPadding:b}}class Sm extends gt{constructor(e,n,l,u,m){super(e,n),this.angle=u,this.z=l,m!==void 0&&(this.segment=m)}clone(){return new Sm(this.x,this.y,this.z,this.angle,this.segment)}}function HM(i,e,n,l,u){if(e.segment===void 0)return!0;let m=e,p=e.segment+1,b=0;for(;b>-n/2;){if(p--,p<0)return!1;b-=i[p].dist(m),m=i[p]}b+=i[p].dist(i[p+1]),p++;let v=[],S=0;for(;b<n/2;){let k=i[p],D=i[p+1];if(!D)return!1;let A=i[p-1].angleTo(k)-k.angleTo(D);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:b,angleDelta:A}),S+=A;b-v[0].distance>l;)S-=v.shift().angleDelta;if(S>u)return!1;p++,b+=k.dist(D)}return!0}function GM(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function qM(i,e,n){return i?.6*e*n:0}function $M(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function rF(i,e,n,l,u,m){let p=qM(n,u,m),b=$M(n,l)*m,v=0,S=GM(i)/2;for(let k=0;k<i.length-1;k++){let D=i[k],A=i[k+1],L=D.dist(A);if(v+L>S){let z=(S-v)/L,V=ri(D.x,A.x,z),H=ri(D.y,A.y,z),Y=new Sm(V,H,0,A.angleTo(D),k);return!p||HM(i,Y,b,p,e)?Y:void 0}v+=L}}function oF(i,e,n,l,u,m,p,b,v){let S=qM(l,m,p),k=$M(l,u),D=k*p,A=i[0].x===0||i[0].x===v||i[0].y===0||i[0].y===v;return e-D<e/4&&(e=D+e/4),YM(i,A?e/2*b%e:(k/2+2*m)*p*b%e,e,S,n,D,A,!1,v)}function YM(i,e,n,l,u,m,p,b,v){let S=m/2,k=GM(i),D=0,A=e-n,L=[];for(let z=0;z<i.length-1;z++){let V=i[z],H=i[z+1],Y=V.dist(H),ne=H.angleTo(V);for(;A+n<D+Y;){A+=n;let re=(A-D)/Y,oe=ri(V.x,H.x,re),xe=ri(V.y,H.y,re);if(oe>=0&&oe<v&&xe>=0&&xe<v&&A-S>=0&&A+S<=k){let be=new Sm(oe,xe,0,ne,z);l&&!HM(i,be,m,l,u)||L.push(be)}}D+=Y}return b||L.length||p||(L=YM(i,D/2,n,l,u,m,p,!0,v)),L}function ZM(i,e,n,l,u){let m=[];for(let p=0;p<i.length;p++){let b=i[p],v;for(let S=0;S<b.length-1;S++){let k=b[S],D=b[S+1];k.x<e&&D.x<e||(k.x<e?k=new gt(e,k.y+(e-k.x)/(D.x-k.x)*(D.y-k.y))._round():D.x<e&&(D=new gt(e,k.y+(e-k.x)/(D.x-k.x)*(D.y-k.y))._round()),k.y<n&&D.y<n||(k.y<n?k=new gt(k.x+(n-k.y)/(D.y-k.y)*(D.x-k.x),n)._round():D.y<n&&(D=new gt(k.x+(n-k.y)/(D.y-k.y)*(D.x-k.x),n)._round()),k.x>=l&&D.x>=l||(k.x>=l?k=new gt(l,k.y+(l-k.x)/(D.x-k.x)*(D.y-k.y))._round():D.x>=l&&(D=new gt(l,k.y+(l-k.x)/(D.x-k.x)*(D.y-k.y))._round()),k.y>=u&&D.y>=u||(k.y>=u?k=new gt(k.x+(u-k.y)/(D.y-k.y)*(D.x-k.x),u)._round():D.y>=u&&(D=new gt(k.x+(u-k.y)/(D.y-k.y)*(D.x-k.x),u)._round()),v&&k.equals(v[v.length-1])||(v=[k],m.push(v)),v.push(D)))))}}return m}function XM(i){let e=0,n=0;for(let p of i)e+=p.w*p.h,n=Math.max(n,p.w);i.sort((p,b)=>b.h-p.h);let l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],u=0,m=0;for(let p of i)for(let b=l.length-1;b>=0;b--){let v=l[b];if(!(p.w>v.w||p.h>v.h)){if(p.x=v.x,p.y=v.y,m=Math.max(m,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===v.w&&p.h===v.h){let S=l.pop();b<l.length&&(l[b]=S)}else p.h===v.h?(v.x+=p.w,v.w-=p.w):p.w===v.w?(v.y+=p.h,v.h-=p.h):(l.push({x:v.x+p.w,y:v.y,w:v.w-p.w,h:p.h}),v.y+=p.h,v.h-=p.h);break}}return{w:u,h:m,fill:e/(u*m)||0}}de(Sm,"Anchor");let fl=1;class Q2{constructor(e,{pixelRatio:n,version:l,stretchX:u,stretchY:m,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=u,this.stretchY=m,this.content=p,this.version=l}get tl(){return[this.paddedRect.x+fl,this.paddedRect.y+fl]}get br(){return[this.paddedRect.x+this.paddedRect.w-fl,this.paddedRect.y+this.paddedRect.h-fl]}get displaySize(){return[(this.paddedRect.w-2*fl)/this.pixelRatio,(this.paddedRect.h-2*fl)/this.pixelRatio]}}class QM{constructor(e,n,l){let u={},m={};this.haveRenderCallbacks=[];let p=[];this.addImages(e,u,p),this.addImages(n,m,p);let{w:b,h:v}=XM(p),S=new Ws({width:b||1,height:v||1});for(let k in e){let D=e[k],A=u[k].paddedRect;Ws.copy(D.data,S,{x:0,y:0},{x:A.x+fl,y:A.y+fl},D.data,l,D.sdf)}for(let k in n){let D=n[k],A=m[k].paddedRect,L=A.x+fl,z=A.y+fl,V=D.data.width,H=D.data.height;Ws.copy(D.data,S,{x:0,y:0},{x:L,y:z},D.data,l),Ws.copy(D.data,S,{x:0,y:H-1},{x:L,y:z-1},{width:V,height:1},l),Ws.copy(D.data,S,{x:0,y:0},{x:L,y:z+H},{width:V,height:1},l),Ws.copy(D.data,S,{x:V-1,y:0},{x:L-1,y:z},{width:1,height:H},l),Ws.copy(D.data,S,{x:0,y:0},{x:L+V,y:z},{width:1,height:H},l)}this.image=S,this.iconPositions=u,this.patternPositions=m}addImages(e,n,l){for(let u in e){let m=e[u],p={x:0,y:0,w:m.data.width+2*fl,h:m.data.height+2*fl};l.push(p),n[u]=new Q2(p,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,n,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(let u in e.getUpdatedImages(l))this.patchUpdatedImage(this.iconPositions[u],e.getImage(u,l),n),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u,l),n)}patchUpdatedImage(e,n,l){if(!e||!n||e.version===n.version)return;e.version=n.version;let[u,m]=e.tl,p=!!Object.keys(this.patternPositions).length;l.update(n.data,{useMipmap:p},{x:u,y:m})}}de(Q2,"ImagePosition"),de(QM,"ImageAtlas");let dy=1e20;function KM(i,e,n,l,u,m,p,b,v){for(let S=e;S<e+l;S++)JM(i,n*m+S,m,u,p,b,v);for(let S=n;S<n+u;S++)JM(i,S*m+e,1,l,p,b,v)}function JM(i,e,n,l,u,m,p){m[0]=0,p[0]=-dy,p[1]=dy,u[0]=i[e];for(let b=1,v=0,S=0;b<l;b++){u[b]=i[e+b*n];let k=b*b;do{let D=m[v];S=(u[b]-u[D]+k-D*D)/(b-D)/2}while(S<=p[v]&&--v>-1);v++,m[v]=b,p[v]=S,p[v+1]=dy}for(let b=0,v=0;b<l;b++){for(;p[v+1]<b;)v++;let S=m[v],k=b-S;i[e+b*n]=u[S]+k*k}}let Fd=2,K2={none:0,ideographs:1,all:2};class J_{constructor(e,n,l){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=l,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,l){let u=[],m=this.urls[n]||M.GLYPHS_URL;for(let p in e)for(let b of e[p])u.push({stack:p,id:b});ps(u,({stack:p,id:b},v)=>{let S=this.entries[p];S||(S=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let k=S.glyphs[b];if(k!==void 0)return void v(null,{stack:p,id:b,glyph:k});if(k=this._tinySDF(S,p,b),k)return S.glyphs[b]=k,void v(null,{stack:p,id:b,glyph:k});let D=Math.floor(b/256);if(256*D>65535)return void v(new Error("glyphs > 65535 not supported"));if(S.ranges[D])return void v(null,{stack:p,id:b,glyph:k});let A=S.requests[D];A||(A=S.requests[D]=[],J_.loadGlyphRange(p,D,m,this.requestManager,(L,z)=>{if(z){S.ascender=z.ascender,S.descender=z.descender;for(let V in z.glyphs)this._doesCharSupportLocalGlyph(+V)||(S.glyphs[+V]=z.glyphs[+V]);S.ranges[D]=!0}for(let V of A)V(L,z);delete S.requests[D]})),A.push((L,z)=>{L?v(L):z&&v(null,{stack:p,id:b,glyph:z.glyphs[b]||null})})},(p,b)=>{if(p)l(p);else if(b){let v={};for(let{stack:S,id:k,glyph:D}of b)v[S]===void 0&&(v[S]={}),v[S].glyphs===void 0&&(v[S].glyphs={}),v[S].glyphs[k]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},v[S].ascender=this.entries[S].ascender,v[S].descender=this.entries[S].descender;l(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==K2.none&&(this.localGlyphMode===K2.all?!!this.localFontFamily:!!this.localFontFamily&&(ye["CJK Unified Ideographs"](e)||ye["Hangul Syllables"](e)||ye.Hiragana(e)||ye.Katakana(e)||ye["CJK Symbols and Punctuation"](e)||ye["CJK Unified Ideographs Extension A"](e)||ye["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,l){let u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let V="400";/bold/i.test(n)?V="900":/medium/i.test(n)?V="500":/light/i.test(n)&&(V="200"),m=e.tinySDF=new J_.TinySDF({fontFamily:u,fontWeight:V,fontSize:24*Fd,buffer:3*Fd,radius:8*Fd}),m.fontWeight=V}if(this.localGlyphs[m.fontWeight][l])return this.localGlyphs[m.fontWeight][l];let p=String.fromCodePoint(l),{data:b,width:v,height:S,glyphWidth:k,glyphHeight:D,glyphLeft:A,glyphTop:L,glyphAdvance:z}=m.draw(p);return this.localGlyphs[m.fontWeight][l]={id:l,bitmap:new Ku({width:v,height:S},b),metrics:{width:k/Fd,height:D/Fd,left:A/Fd,top:L/Fd-27,advance:z/Fd,localGlyph:!0}}}}J_.loadGlyphRange=function(i,e,n,l,u){let m=256*e,p=m+255,b=l.transformRequest(l.normalizeGlyphsURL(n).replace("{fontstack}",i).replace("{range}",`${m}-${p}`),op.Glyphs);nl(b,(v,S)=>{if(v)u(v);else if(S){let k={},D=function(A){return new X_(A).readFields(KR,{})}(S);for(let A of D.glyphs)k[A.id]=A;u(null,{glyphs:k,ascender:D.ascender,descender:D.descender})}})},J_.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:n=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:m="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=n;let b=this.size=i+4*e,v=this._createCanvas(b),S=this.ctx=v.getContext("2d",{willReadFrequently:!0});S.font=`${p} ${m} ${i}px ${u}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(i){let e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:m}=this.ctx.measureText(i),p=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-u))),v=Math.min(this.size-this.buffer,p+Math.ceil(l)),S=b+2*this.buffer,k=v+2*this.buffer,D=Math.max(S*k,0),A=new Uint8ClampedArray(D),L={data:A,width:S,height:k,glyphWidth:b,glyphHeight:v,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(b===0||v===0)return L;let{ctx:z,buffer:V,gridInner:H,gridOuter:Y}=this;z.clearRect(V,V,b,v),z.fillText(i,V,V+p);let ne=z.getImageData(V,V,b,v);Y.fill(dy,0,D),H.fill(0,0,D);for(let re=0;re<v;re++)for(let oe=0;oe<b;oe++){let xe=ne.data[4*(re*b+oe)+3]/255;if(xe===0)continue;let be=(re+V)*S+oe+V;if(xe===1)Y[be]=0,H[be]=dy;else{let ke=.5-xe;Y[be]=ke>0?ke*ke:0,H[be]=ke<0?ke*ke:0}}KM(Y,0,0,S,k,S,this.f,this.v,this.z),KM(H,V,V,b,v,S,this.f,this.v,this.z);for(let re=0;re<D;re++){let oe=Math.sqrt(Y[re])-Math.sqrt(H[re]);A[re]=Math.round(255-255*(oe/this.radius+this.cutoff))}return L}};let Bp=fl;function ek(i,e,n,l){let u=[],m=i.imagePrimary,p=m.pixelRatio,b=m.paddedRect.w-2*Bp,v=m.paddedRect.h-2*Bp,S=i.right-i.left,k=i.bottom-i.top,D=m.stretchX||[[0,b]],A=m.stretchY||[[0,v]],L=($e,st)=>$e+st[1]-st[0],z=D.reduce(L,0),V=A.reduce(L,0),H=b-z,Y=v-V,ne=0,re=z,oe=0,xe=V,be=0,ke=H,Ae=0,je=Y;if(m.content&&l){let $e=m.content;ne=qx(D,0,$e[0]),oe=qx(A,0,$e[1]),re=qx(D,$e[0],$e[2]),xe=qx(A,$e[1],$e[3]),be=$e[0]-ne,Ae=$e[1]-oe,ke=$e[2]-$e[0]-re,je=$e[3]-$e[1]-xe}let Qe=($e,st,vt,at)=>{let ht=$x($e.stretch-ne,re,S,i.left),tt=Yx($e.fixed-be,ke,$e.stretch,z),mt=$x(st.stretch-oe,xe,k,i.top),Ct=Yx(st.fixed-Ae,je,st.stretch,V),ft=$x(vt.stretch-ne,re,S,i.left),Ht=Yx(vt.fixed-be,ke,vt.stretch,z),xt=$x(at.stretch-oe,xe,k,i.top),Mt=Yx(at.fixed-Ae,je,at.stretch,V),oi=new gt(ht,mt),ti=new gt(ft,mt),Jt=new gt(ft,xt),Tt=new gt(ht,xt),li=new gt(tt/p,Ct/p),Ei=new gt(Ht/p,Mt/p),gi=e*Math.PI/180;if(gi){let Wn=Math.sin(gi),In=Math.cos(gi),fn=[In,-Wn,Wn,In];oi._matMult(fn),ti._matMult(fn),Tt._matMult(fn),Jt._matMult(fn)}let Li=$e.stretch+$e.fixed,Di=vt.stretch+vt.fixed,Xi=st.stretch+st.fixed,mi=at.stretch+at.fixed,qn=i.imageSecondary;return{tl:oi,tr:ti,bl:Tt,br:Jt,texPrimary:{x:m.paddedRect.x+Bp+Li,y:m.paddedRect.y+Bp+Xi,w:Di-Li,h:mi-Xi},texSecondary:qn?{x:qn.paddedRect.x+Bp+Li,y:qn.paddedRect.y+Bp+Xi,w:Di-Li,h:mi-Xi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:li,pixelOffsetBR:Ei,minFontScaleX:ke/p/S,minFontScaleY:je/p/k,isSDF:n}};if(l&&(m.stretchX||m.stretchY)){let $e=tk(D,H,z),st=tk(A,Y,V);for(let vt=0;vt<$e.length-1;vt++){let at=$e[vt],ht=$e[vt+1];for(let tt=0;tt<st.length-1;tt++)u.push(Qe(at,st[tt],ht,st[tt+1]))}}else u.push(Qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:v+1}));return u}function qx(i,e,n){let l=0;for(let u of i)l+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return l}function tk(i,e,n){let l=[{fixed:-Bp,stretch:0}];for(let[u,m]of i){let p=l[l.length-1];l.push({fixed:u-p.stretch,stretch:p.stretch}),l.push({fixed:u-p.stretch,stretch:p.stretch+(m-u)})}return l.push({fixed:e+Bp,stretch:n}),l}function $x(i,e,n,l){return i/e*n+l}function Yx(i,e,n,l){return i-e*n/l}function aF(i,e,n,l){let u=e+i.positionedLines[l].lineOffset;return l===0?n+u/2:n+(u+(e+i.positionedLines[l-1].lineOffset))/2}function sF(i,e=1,n=!1){let l=1/0,u=1/0,m=-1/0,p=-1/0,b=i[0];for(let L=0;L<b.length;L++){let z=b[L];(!L||z.x<l)&&(l=z.x),(!L||z.y<u)&&(u=z.y),(!L||z.x>m)&&(m=z.x),(!L||z.y>p)&&(p=z.y)}let v=Math.min(m-l,p-u),S=v/2,k=new Uf([],lF);if(v===0)return new gt(l,u);for(let L=l;L<m;L+=v)for(let z=u;z<p;z+=v)k.push(new e0(L+S,z+S,S,i));let D=function(L){let z=0,V=0,H=0,Y=L[0];for(let ne=0,re=Y.length,oe=re-1;ne<re;oe=ne++){let xe=Y[ne],be=Y[oe],ke=xe.x*be.y-be.x*xe.y;V+=(xe.x+be.x)*ke,H+=(xe.y+be.y)*ke,z+=3*ke}return new e0(V/z,H/z,0,L)}(i),A=k.length;for(;k.length;){let L=k.pop();(L.d>D.d||!D.d)&&(D=L,n&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,A)),L.max-D.d<=e||(S=L.h/2,k.push(new e0(L.p.x-S,L.p.y-S,S,i)),k.push(new e0(L.p.x+S,L.p.y-S,S,i)),k.push(new e0(L.p.x-S,L.p.y+S,S,i)),k.push(new e0(L.p.x+S,L.p.y+S,S,i)),A+=4)}return n&&(console.log(`num probes: ${A}`),console.log(`best distance: ${D.d}`)),D.p}function lF(i,e){return e.max-i.max}class e0{constructor(e,n,l,u){this.p=new gt(e,n),this.h=l,this.d=function(m,p){let b=!1,v=1/0;for(let S=0;S<p.length;S++){let k=p[S];for(let D=0,A=k.length,L=A-1;D<A;L=D++){let z=k[D],V=k[L];z.y>m.y!=V.y>m.y&&m.x<(V.x-z.x)*(m.y-z.y)/(V.y-z.y)+z.x&&(b=!b),v=Math.min(v,Uv(m,z,V))}}return(b?1:-1)*Math.sqrt(v)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}let J2=Number.POSITIVE_INFINITY,cF=Math.sqrt(2);function ik(i,[e,n]){let l=0,u=0;if(n===J2){e<0&&(e=0);let m=e/cF;switch(i){case"top-right":case"top-left":u=m-7;break;case"bottom-right":case"bottom-left":u=7-m;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(i){case"top-right":case"bottom-right":l=-m;break;case"top-left":case"bottom-left":l=m;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),i){case"top-right":case"top-left":case"top":u=n-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-n}switch(i){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,u]}function eS(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dF(i,e,n,l,u,m,p,b,v,S,k,D,A,L,z){let V=m.textMaxSize.evaluate(e,{},D);V===void 0&&(V=p);let H=i.layers[0].layout,Y=H.get("icon-offset").evaluate(e,{},D),ne=rk(n.horizontal)||n.vertical,re=A.name==="globe",oe=Pa,xe=p/oe,be=i.tilePixelRatio*V/oe,ke=(ht=i.overscaling,i.zoom>18&&ht>2&&(ht>>=1),Math.max(At/(512*ht),1)*H.get("symbol-spacing")),Ae=H.get("text-padding")*i.tilePixelRatio,je=H.get("icon-padding")*i.tilePixelRatio,Qe=tn(H.get("text-max-angle")),$e=H.get("text-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",st=H.get("icon-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",vt=H.get("symbol-placement"),at=ke/2;var ht;let tt=H.get("icon-text-fit").evaluate(e,{},D),mt=H.get("icon-text-fit-padding").evaluate(e,{},D),Ct=tt!=="none",ft;i.hasAnyIconTextFit===!1&&Ct&&(i.hasAnyIconTextFit=!0),l&&Ct&&(i.allowVerticalPlacement&&n.vertical&&(ft=WM(l,n.vertical,tt,mt,Y,xe)),ne&&(l=WM(l,ne,tt,mt,Y,xe)));let Ht=(xt,Mt,oi)=>{if(Mt.x<0||Mt.x>=At||Mt.y<0||Mt.y>=At)return;let ti=null;if(re){let{x:Jt,y:Tt,z:li}=A.projectTilePoint(Mt.x,Mt.y,oi);ti={anchor:new Sm(Jt,Tt,li,0,void 0),up:A.upVector(oi,Mt.x,Mt.y)}}(function(Jt,Tt,li,Ei,gi,Li,Di,Xi,mi,qn,Wn,In,fn,Tn,ur,tr,jr,Lr,Wa,to,Pr,So,pa,fa,ar,Is,Im){let Vc=Jt.addToLineVertexArray(Tt,Ei),jd,Gp,qp,Ig,oE,aE,sE,lE=0,cE=0,dE=0,uE=0,ES=-1,DS=-1,oh={},hE=yu(""),Tg=li?li.anchor:Tt,AS=mi.layout.get("icon-text-fit").evaluate(Pr,{},ar)!=="none",PS=0,OS=0;if(mi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[PS,OS]=mi.layout.get("text-offset").evaluate(Pr,{},ar).map(_l=>_l*Pa):(PS=mi.layout.get("text-radial-offset").evaluate(Pr,{},ar)*Pa,OS=J2),Jt.allowVerticalPlacement&&gi.vertical){let _l=gi.vertical;if(ur)aE=tS(_l),Xi&&(sE=tS(Xi));else{let bl=mi.layout.get("text-rotate").evaluate(Pr,{},ar)+90;qp=Zx(qn,Tg,Tt,Wn,In,fn,_l,Tn,bl,tr),Xi&&(Ig=Zx(qn,Tg,Tt,Wn,In,fn,Xi,Lr,bl))}}if(Li){let _l=mi.layout.get("icon-rotate").evaluate(Pr,{},ar),bl=ek(Li,_l,pa,AS),c0=Xi?ek(Xi,_l,pa,AS):void 0;Gp=Zx(qn,Tg,Tt,Wn,In,fn,Li,Lr,_l),lE=4*bl.length;let mE=Jt.iconSizeData,Mg=null;mE.kind==="source"?(Mg=[Rd*mi.layout.get("icon-size").evaluate(Pr,{},ar)],Mg[0]>Np&&Vr(`${Jt.layerIds[0]}: Value for "icon-size" is >= ${uy}. Reduce your "icon-size".`)):mE.kind==="composite"&&(Mg=[Rd*So.compositeIconSizes[0].evaluate(Pr,{},ar),Rd*So.compositeIconSizes[1].evaluate(Pr,{},ar)],(Mg[0]>Np||Mg[1]>Np)&&Vr(`${Jt.layerIds[0]}: Value for "icon-size" is >= ${uy}. Reduce your "icon-size".`)),Jt.addSymbols(Jt.icon,bl,Mg,to,Wa,Pr,!1,li,Tt,Vc.lineStartIndex,Vc.lineLength,-1,fa,ar,Is,Im),ES=Jt.icon.placedSymbolArray.length-1,c0&&(cE=4*c0.length,Jt.addSymbols(Jt.icon,c0,Mg,to,Wa,Pr,ic.vertical,li,Tt,Vc.lineStartIndex,Vc.lineLength,-1,fa,ar,Is,Im),DS=Jt.icon.placedSymbolArray.length-1)}for(let _l in gi.horizontal){let bl=gi.horizontal[_l];jd||(hE=yu(bl.text),ur?oE=tS(bl):jd=Zx(qn,Tg,Tt,Wn,In,fn,bl,Tn,mi.layout.get("text-rotate").evaluate(Pr,{},ar),tr));let c0=bl.positionedLines.length===1;if(dE+=nk(Jt,li,Tt,bl,Di,mi,ur,Pr,tr,Vc,gi.vertical?ic.horizontal:ic.horizontalOnly,c0?Object.keys(gi.horizontal):[_l],oh,ES,So,fa,ar,Is),c0)break}gi.vertical&&(uE+=nk(Jt,li,Tt,gi.vertical,Di,mi,ur,Pr,tr,Vc,ic.vertical,["vertical"],oh,DS,So,fa,ar,Is));let $p=-1,RS=(_l,bl)=>_l?Math.max(_l,bl):bl;$p=RS(oE,$p),$p=RS(aE,$p),$p=RS(sE,$p);let EL=$p>-1?1:0;Jt.glyphOffsetArray.length>=65535&&Vr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pr.sortKey!==void 0&&Jt.addToSortKeyRanges(Jt.symbolInstances.length,Pr.sortKey),Jt.symbolInstances.emplaceBack(Tt.x,Tt.y,Tg.x,Tg.y,Tg.z,oh.right>=0?oh.right:-1,oh.center>=0?oh.center:-1,oh.left>=0?oh.left:-1,oh.vertical>=0?oh.vertical:-1,ES,DS,hE,jd!==void 0?jd:Jt.collisionBoxArray.length,jd!==void 0?jd+1:Jt.collisionBoxArray.length,qp!==void 0?qp:Jt.collisionBoxArray.length,qp!==void 0?qp+1:Jt.collisionBoxArray.length,Gp!==void 0?Gp:Jt.collisionBoxArray.length,Gp!==void 0?Gp+1:Jt.collisionBoxArray.length,Ig||Jt.collisionBoxArray.length,Ig?Ig+1:Jt.collisionBoxArray.length,Wn,dE,uE,lE,cE,EL,0,PS,OS,$p,0,1,1,AS?1:0)})(i,Mt,ti,xt,n,l,u,ft,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Ae,$e,v,0,je,st,Y,e,m,S,k,D,L,z)};if(vt==="line")for(let xt of ZM(e.geometry,0,0,At,At)){let Mt=oF(xt,ke,Qe,n.vertical||ne,l,oe,be,i.overscaling,At);for(let oi of Mt)ne&&uF(i,ne.text,at,oi)||Ht(xt,oi,D)}else if(vt==="line-center"){for(let xt of e.geometry)if(xt.length>1){let Mt=rF(xt,Qe,n.vertical||ne,l,oe,be);Mt&&Ht(xt,Mt,D)}}else if(e.type==="Polygon")for(let xt of F_(e.geometry,0)){let Mt=sF(xt,16);Ht(xt[0],new Sm(Mt.x,Mt.y,0,0,void 0),D)}else if(e.type==="LineString")for(let xt of e.geometry)Ht(xt,new Sm(xt[0].x,xt[0].y,0,0,void 0),D);else if(e.type==="Point")for(let xt of e.geometry)for(let Mt of xt)Ht([Mt],new Sm(Mt.x,Mt.y,0,0,void 0),D)}let uy=255,Np=uy*Rd;function nk(i,e,n,l,u,m,p,b,v,S,k,D,A,L,z,V,H,Y){let ne=function(xe,be,ke,Ae,je,Qe,$e,st){let vt=[];if(be.positionedLines.length===0)return vt;let at=Ae.layout.get("text-rotate").evaluate(Qe,{})*Math.PI/180,ht=function(Ht){let xt=Ht[0],Mt=Ht[1],oi=xt*Mt;return oi>0?[xt,-Mt]:oi<0?[-xt,Mt]:xt===0?[Mt,xt]:[Mt,-xt]}(ke),tt=Math.abs(be.top-be.bottom);for(let Ht of be.positionedLines)tt-=Ht.lineOffset;let mt=be.positionedLines.length,Ct=tt/mt,ft=be.top-ke[1];for(let Ht=0;Ht<mt;++Ht){let xt=be.positionedLines[Ht];ft=aF(be,Ct,ft,Ht);for(let Mt of xt.positionedGlyphs){if(!Mt.rect)continue;let oi=Mt.rect||{},ti=zM+1,Jt=!0,Tt=1,li=0;if(Mt.imageName){let to=$e[Mt.imageName];if(!to)continue;if(to.sdf){Vr("SDF images are not supported in formatted text and will be ignored.");continue}Jt=!1,Tt=to.pixelRatio,ti=fl/Tt}let Ei=(je||st)&&Mt.vertical,gi=Mt.metrics.advance*Mt.scale/2,Li=Mt.metrics,Di=Mt.rect;if(Di===null)continue;st&&be.verticalizable&&(li=Mt.imageName?gi-Mt.metrics.width*Mt.scale/2:0);let Xi=je?[Mt.x+gi,Mt.y]:[0,0],mi=[0,0],qn=[0,0],Wn=!1;je||(Ei?(qn=[Mt.x+gi+ht[0],Mt.y+ht[1]-li],Wn=!0):mi=[Mt.x+gi+ke[0],Mt.y+ke[1]-li]);let In=Di.w*Mt.scale/(Tt*(Mt.localGlyph?Fd:1)),fn=Di.h*Mt.scale/(Tt*(Mt.localGlyph?Fd:1)),Tn,ur,tr,jr;if(Ei){let to=Mt.y-ft,Pr=new gt(-gi,gi-to),So=-Math.PI/2,pa=new gt(...qn);Tn=new gt(-gi+mi[0],mi[1]),Tn._rotateAround(So,Pr)._add(pa),Tn.x+=-to+gi,Tn.y-=(Li.left-ti)*Mt.scale;let fa=Mt.imageName?Li.advance*Mt.scale:Pa*Mt.scale,ar=String.fromCodePoint(Mt.glyph);XR(ar)?Tn.x+=(1-ti)*Mt.scale:QR(ar)?Tn.x+=fa-Li.height*Mt.scale+(-ti-1)*Mt.scale:Tn.x+=Mt.imageName||Li.width+2*ti===Di.w&&Li.height+2*ti===Di.h?(fa-fn)/2:(fa-(Li.height+2*ti)*Mt.scale)/2,ur=new gt(Tn.x,Tn.y-In),tr=new gt(Tn.x+fn,Tn.y),jr=new gt(Tn.x+fn,Tn.y-In)}else{let to=(Li.left-ti)*Mt.scale-gi+mi[0],Pr=(-Li.top-ti)*Mt.scale+mi[1],So=to+In,pa=Pr+fn;Tn=new gt(to,Pr),ur=new gt(So,Pr),tr=new gt(to,pa),jr=new gt(So,pa)}if(at){let to;to=je?new gt(0,0):Wn?new gt(ht[0],ht[1]):new gt(ke[0],ke[1]),Tn._rotateAround(at,to),ur._rotateAround(at,to),tr._rotateAround(at,to),jr._rotateAround(at,to)}let Lr=new gt(0,0),Wa=new gt(0,0);vt.push({tl:Tn,tr:ur,bl:tr,br:jr,texPrimary:oi,texSecondary:void 0,writingMode:be.writingMode,glyphOffset:Xi,sectionIndex:Mt.sectionIndex,isSDF:Jt,pixelOffsetTL:Lr,pixelOffsetBR:Wa,minFontScaleX:0,minFontScaleY:0})}}return vt}(0,l,v,m,p,b,u,i.allowVerticalPlacement),re=i.textSizeData,oe=null;re.kind==="source"?(oe=[Rd*m.layout.get("text-size").evaluate(b,{},H)],oe[0]>Np&&Vr(`${i.layerIds[0]}: Value for "text-size" is >= ${uy}. Reduce your "text-size".`)):re.kind==="composite"&&(oe=[Rd*z.compositeTextSizes[0].evaluate(b,{},H),Rd*z.compositeTextSizes[1].evaluate(b,{},H)],(oe[0]>Np||oe[1]>Np)&&Vr(`${i.layerIds[0]}: Value for "text-size" is >= ${uy}. Reduce your "text-size".`)),i.addSymbols(i.text,ne,oe,v,p,b,k,e,n,S.lineStartIndex,S.lineLength,L,V,H,Y,!1);for(let xe of D)A[xe]=i.text.placedSymbolArray.length-1;return 4*ne.length}function rk(i){for(let e in i)return i[e];return null}function Zx(i,e,n,l,u,m,p,b,v,S){let k=p.top,D=p.bottom,A=p.left,L=p.right,z=p.collisionPadding;if(z&&(A-=z[0],k-=z[1],L+=z[2],D+=z[3]),v){let V=new gt(A,k),H=new gt(L,k),Y=new gt(A,D),ne=new gt(L,D),re=tn(v),oe=new gt(0,0);S&&(oe=new gt(S[0],S[1])),V._rotateAround(re,oe),H._rotateAround(re,oe),Y._rotateAround(re,oe),ne._rotateAround(re,oe),A=Math.min(V.x,H.x,Y.x,ne.x),L=Math.max(V.x,H.x,Y.x,ne.x),k=Math.min(V.y,H.y,Y.y,ne.y),D=Math.max(V.y,H.y,Y.y,ne.y)}return i.emplaceBack(e.x,e.y,e.z,n.x,n.y,A,k,L,D,b,l,u,m),i.length-1}function tS(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);let e=i.bottom-i.top;return e>0?Math.max(10,e):null}function uF(i,e,n,l){let u=i.compareText;if(e in u){let m=u[e];for(let p=m.length-1;p>=0;p--)if(l.dist(m[p])<n)return!0}else u[e]=[];return u[e].push(l),!1}function ok(i,e){let n=i.fovAboveCenter,l=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,u=(i._camera.position[2]*i.worldSize-l)/Math.cos(i._pitch),m=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-i._pitch-n,.01)),p=Math.sin(i._pitch)*m+u;return Math.min(1.01*p,u*(1/i._horizonShift))}function vg(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};let n=Math.pow(2,-i.z),l=i.x*n,u=(i.x+1)*n,m=i.y*n,p=(i.y+1)*n,b=ts(l),v=ts(u),S=$o(m),k=$o(p),D=e.project(b,S),A=e.project(v,S),L=e.project(v,k),z=e.project(b,k),V=Math.min(D.x,A.x,L.x,z.x),H=Math.min(D.y,A.y,L.y,z.y),Y=Math.max(D.x,A.x,L.x,z.x),ne=Math.max(D.y,A.y,L.y,z.y),re=n/16;function oe(be,ke,Ae,je,Qe,$e){let st=(Ae+Qe)/2,vt=(je+$e)/2,at=e.project(ts(st),$o(vt)),ht=Math.max(0,V-at.x,H-at.y,at.x-Y,at.y-ne);V=Math.min(V,at.x),Y=Math.max(Y,at.x),H=Math.min(H,at.y),ne=Math.max(ne,at.y),ht>re&&(oe(be,at,Ae,je,st,vt),oe(at,ke,st,vt,Qe,$e))}oe(D,A,l,m,u,m),oe(A,L,u,m,u,p),oe(L,z,u,p,l,p),oe(z,D,l,p,l,m),V-=re,H-=re,Y+=re,ne+=re;let xe=1/Math.max(Y-V,ne-H);return{scale:xe,x:V*xe,y:H*xe,x2:Y*xe,y2:ne*xe,projection:e}}function ak(i,{x:e,y:n},l=0){return new gt(((e-l)*i.scale-i.x)*At,(n*i.scale-i.y)*At)}let hF=t.ad.identity(new Float32Array(16));class Vp{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new un(0,0)}projectTilePoint(e,n,l){return{x:e,y:n,z:0}}locationPoint(e,n,l=!0){return e._coordinatePoint(e.locationCoordinate(n),l)}pixelsPerMeter(e,n){return ja(1,e)*n}pixelSpaceConversion(e,n,l){return 1}farthestPixelDistance(e){return ok(e,e.pixelsPerMeter)}pointCoordinate(e,n,l,u){let m=e.horizonLineFromTop(!1),p=new gt(n,Math.max(m,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,u))}pointCoordinate3D(e,n,l){let u=new gt(n,l);if(e.elevation)return e.elevation.pointCoordinate(u);{let m=this.pointCoordinate(e,u.x,u.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);let l=e.horizonLineFromTop();return n.y<l}createInversionMatrix(e,n){return hF}createTileMatrix(e,n,l){let u,m,p,b=l.canonical,v=t.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let S=vg(b,this);u=1,m=S.x+l.wrap*S.scale,p=S.y,t.ad.scale(v,v,[u/S.scale,u/S.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(b.z),m=(b.x+Math.pow(2,b.z)*l.wrap)*u,p=b.y*u;return t.ad.translate(v,v,[m,p,0]),t.ad.scale(v,v,[u/At,u/At,1]),v}upVector(e,n,l){return[0,0,1]}upVectorScale(e,n,l){return{metersToTile:1}}}class mF extends Vp{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,l]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(tn(n));this.n=(u+Math.sin(tn(l)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:l,c:u,r0:m}=this,p=tn(e-this.center[0]),b=tn(n),v=Math.sqrt(u-2*l*Math.sin(b))/l;return{x:v*Math.sin(p*l),y:v*Math.cos(p*l)-m,z:0}}unproject(e,n){let{n:l,c:u,r0:m}=this,p=m+n,b=Math.atan2(e,Math.abs(p))*Math.sign(p);p*l<0&&(b-=Math.PI*Math.sign(e)*Math.sign(p));let v=tn(this.center[0])*l;b=Ll(b,-Math.PI-v,Math.PI-v);let S=Ri(na(b/l)+this.center[0],-180,180),k=Math.asin(Ri((u-(e*e+p*p)*l*l)/(2*l),-1,1)),D=Ri(na(k),-Dr,Dr);return new un(S,D)}}let hy=1.340264,my=-.081106,py=893e-6,fy=.003796,Xx=Math.sqrt(3)/2;class pF extends Vp{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let l=Math.asin(Xx*Math.sin(n)),u=l*l,m=u*u*u;return{x:.5*(e*Math.cos(l)/(Xx*(hy+3*my*u+m*(7*py+9*fy*u)))/Math.PI+.5),y:1-.5*(l*(hy+my*u+m*(py+fy*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let l=n=(2*(1-n)-1)*Math.PI,u=l*l,m=u*u*u;for(let k,D,A,L=0;L<12&&(D=l*(hy+my*u+m*(py+fy*u))-n,A=hy+3*my*u+m*(7*py+9*fy*u),k=D/A,l=Ri(l-k,-Math.PI/3,Math.PI/3),u=l*l,m=u*u*u,!(Math.abs(k)<1e-12));++L);let p=Xx*e*(hy+3*my*u+m*(7*py+9*fy*u))/Math.cos(l),b=Math.asin(Math.sin(l)/Xx),v=Ri(180*p/Math.PI,-180,180),S=Ri(180*b/Math.PI,-Dr,Dr);return new un(v,S)}}class fF extends Vp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let l=360*(e-.5),u=Ri(360*(.5-n),-Dr,Dr);return new un(l,u)}}let t0=Math.PI/2;function Qx(i){return Math.tan((t0+i)/2)}class gF extends Vp{constructor(e){super(e),this.center=e.center||[0,30];let[n,l]=this.parallels=e.parallels||[30,30],u=tn(n),m=tn(l);this.southernCenter=u+m<0,this.southernCenter&&(u=-u,m=-m);let p=Math.cos(u),b=Qx(u);this.n=u===m?Math.sin(u):Math.log(p/Math.cos(m))/Math.log(Qx(m)/b),this.f=p*Math.pow(Qx(u),this.n)/this.n}project(e,n){n=tn(n),this.southernCenter&&(n=-n),e=tn(e-this.center[0]);let l=1e-6,{n:u,f:m}=this;m>0?n<-t0+l&&(n=-t0+l):n>t0-l&&(n=t0-l);let p=m/Math.pow(Qx(n),u),b=p*Math.sin(u*e),v=m-p*Math.cos(u*e);return b=.5*(b/Math.PI+.5),v=.5*(v/Math.PI+.5),{x:b,y:this.southernCenter?v:1-v,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:l,f:u}=this,m=u-n,p=Math.sign(m),b=Math.sign(l)*Math.sqrt(e*e+m*m),v=Math.atan2(e,Math.abs(m))*p;m*l<0&&(v-=Math.PI*Math.sign(e)*p);let S=Ri(na(v/l)+this.center[0],-180,180),k=Ri(na(2*Math.atan(Math.pow(u/b,1/l))-t0),-Dr,Dr);return new un(S,this.southernCenter?-k:k)}}class sk extends Vp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Ac(e),y:Pc(n),z:0}}unproject(e,n){let l=ts(e),u=$o(n);return new un(l,u)}}let lk=tn(Dr);class _F extends Vp{project(e,n){let l=(n=tn(n))*n,u=l*l;return{x:.5*((e=tn(e))*(.8707-.131979*l+u*(u*(.003971*l-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+l*(.015085+u*(.028874*l-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let l=n=(2*(1-n)-1)*Math.PI,u=25,m=0,p=l*l;do{p=l*l;let S=p*p;m=(l*(1.007226+p*(.015085+S*(.028874*p-.044475-.005916*S)))-n)/(1.007226+p*(.045255+S*(.259866*p-.311325-.005916*11*S))),l=Ri(l-m,-lk,lk)}while(Math.abs(m)>1e-6&&--u>0);p=l*l;let b=Ri(na(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),v=na(l);return new un(b,v)}}let ck=tn(Dr);class bF extends Vp{project(e,n){n=tn(n),e=tn(e);let l=Math.cos(n),u=2/Math.PI,m=Math.acos(l*Math.cos(e/2)),p=Math.sin(m)/m,b=.5*(e*u+2*l*Math.sin(e/2)/p)||0,v=.5*(n+Math.sin(n)/p)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,n){let l=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,m=25,p=1e-6,b=0,v=0;do{let S=Math.cos(u),k=Math.sin(u),D=2*k*S,A=k*k,L=S*S,z=Math.cos(l/2),V=Math.sin(l/2),H=2*z*V,Y=V*V,ne=1-L*z*z,re=ne?1/ne:0,oe=ne?Math.acos(S*z)*Math.sqrt(1/ne):0,xe=.5*(2*oe*S*V+2*l/Math.PI)-e,be=.5*(oe*k+u)-n,ke=.5*re*(L*Y+oe*S*z*A)+1/Math.PI,Ae=re*(H*D/4-oe*k*V),je=.125*re*(D*V-oe*k*L*H),Qe=.5*re*(A*z+oe*Y*S)+.5,$e=Ae*je-Qe*ke;b=(be*Ae-xe*Qe)/$e,v=(xe*je-be*ke)/$e,l=Ri(l-b,-Math.PI,Math.PI),u=Ri(u-v,-ck,ck)}while((Math.abs(b)>p||Math.abs(v)>p)&&--m>0);return new un(na(l),na(u))}}class dk extends Vp{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(tn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:l,cosPhi:u}=this;return{x:tn(e)*u*l+.5,y:-Math.sin(tn(n))/u*l+.5,z:0}}unproject(e,n){let{scale:l,cosPhi:u}=this,m=-(n-.5)/l,p=Ri(na((e-.5)/l)/u,-180,180),b=Math.asin(Ri(m*u,-1,1)),v=Ri(na(b),-Dr,Dr);return new un(p,v)}}class yF extends sk{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,l){let u=sg(e,n,l),m=Aa(Fc(l));return t._.transformMat4(u,u,m),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n){let l=vm(n.lat,n.lng),u=t._.normalize([],l),m=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,p=ja(1,0)*At*m;t._.scaleAndAdd(l,l,u,p);let b=t.ad.identity(new Float64Array(16));return t.ad.multiply(b,e.pixelMatrix,e.globeMatrix),t._.transformMat4(l,l,b),new gt(l[0],l[1])}pixelsPerMeter(e,n){return ja(1,0)*n}pixelSpaceConversion(e,n,l){let u=ja(1,e)*n,m=ri(ja(1,45)*n,u,l);return this.pixelsPerMeter(e,n)/m}createTileMatrix(e,n,l){let u=Qu(Fc(l.canonical));return t.ad.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){let{center:l}=e,u=Aa(Fc(n));return t.ad.rotateY(u,u,tn(l.lng)),t.ad.rotateX(u,u,tn(l.lat)),t.ad.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,l,u){return $b(e,n,l,!0)||new la(0,0)}pointCoordinate3D(e,n,l){let u=this.pointCoordinate(e,n,l,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!$b(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(u,m){let p=u.cameraToCenterDistance,b=u._centerAltitude*m,v=u._camera,S=u._camera.forward(),k=t._.add([],t._.scale([],S,-p),[0,0,b]),D=u.worldSize/(2*Math.PI),A=[0,0,-D],L=u.width/u.height,z=Math.tan(u.fovAboveCenter),V=t._.scale([],v.up(),z),H=t._.scale([],v.right(),z*L),Y=t._.normalize([],t._.add([],t._.add([],S,V),H)),ne=[],re;if(new Hb(k,Y).closestPointOnSphere(A,D,ne)){let oe=t._.add([],ne,A),xe=t._.sub([],oe,k);re=Math.cos(u.fovAboveCenter)*t._.length(xe)}else{let oe=t._.sub([],k,A),xe=t._.sub([],A,k);t._.normalize(xe,xe);let be=t._.length(oe)-D;re=Math.sqrt(be*(be+2*D));let ke=Math.acos(re/(D+be))-Math.acos(t._.dot(S,xe));re*=Math.cos(ke)}return 1.01*re}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Ad(e.zoom);if(l>0){let u=ok(e,ja(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ri(n,u+m*(1-Math.cos(p)),Math.pow(l,10))}return n}upVector(e,n,l){return sg(n,l,e,1)}upVectorScale(e){return{metersToTile:Qr(lg(Fc(e)))}}}function uk(i){let e=i.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new sk(i);case"equirectangular":return new fF(i);case"naturalEarth":return new _F(i);case"equalEarth":return new pF(i);case"winkelTripel":return new bF(i);case"albers":return n?new dk(i):new mF(i);case"lambertConformalConic":return n?new dk(i):new gF(i);case"globe":return new yF(i)}throw new Error(`Invalid projection name: ${i.name}`)}let vF=(()=>{class i{constructor(n,l,u,m){this.id=i.uniqueIdxCounter,i.uniqueIdxCounter++,this.context=n;let p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||m||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=i.uniqueIdxCounter,i.uniqueIdxCounter++;let l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return i.uniqueIdxCounter=0,i})();class i0{constructor(e,n,l){this.func=e,this.mask=n,this.range=l}}i0.ReadOnly=!1,i0.ReadWrite=!0,i0.disabled=new i0(519,i0.ReadOnly,[0,1]);let iS=7680;class nS{constructor(e,n,l,u,m,p){this.test=e,this.ref=n,this.mask=l,this.fail=u,this.depthFail=m,this.pass=p}}nS.disabled=new nS({func:519,mask:0},0,0,iS,iS,iS);let gy=771;class gl{constructor(e,n,l,u){this.blendFunction=e,this.blendColor=n,this.mask=l,this.blendEquation=u}}gl.Replace=[1,0,1,0],gl.disabled=new gl(gl.Replace,mn.transparent,[!1,!1,!1,!1]),gl.unblended=new gl(gl.Replace,mn.transparent,[!0,!0,!0,!0]),gl.alphaBlended=new gl([1,gy,1,gy],mn.transparent,[!0,!0,!0,!0]),gl.alphaBlendedNonPremultiplied=new gl([770,gy,770,gy],mn.transparent,[!0,!0,!0,!0]),gl.multiply=new gl([774,0,774,0],mn.transparent,[!0,!0,!0,!0]);let rS=1029,oS=2305;class Ld{constructor(e,n,l){this.enable=e,this.mode=n,this.frontFace=l}}Ld.disabled=new Ld(!1,rS,oS),Ld.backCCW=new Ld(!0,rS,oS),Ld.backCW=new Ld(!0,rS,2304),Ld.frontCW=new Ld(!0,1028,2304),Ld.frontCCW=new Ld(!0,1028,oS);let xF=B_.types,wF=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kx(i,e,n,l,u,m,p,b,v,S,k,D,A){let L=b?Math.min(Np,Math.round(b[0])):0,z=b?Math.min(Np,Math.round(b[1])):0;i.emplaceBack(e,n,Math.round(32*l),Math.round(32*u),m,p,(L<<1)+(v?1:0),z,16*S,16*k,256*D,256*A)}function Jx(i,e,n){i.emplaceBack(e,n)}function e1(i,e,n,l,u,m,p){i.emplaceBack(e,n,l,u,m,p)}function t1(i,e,n,l,u){i.emplaceBack(e,n,l,u),i.emplaceBack(e,n,l,u),i.emplaceBack(e,n,l,u),i.emplaceBack(e,n,l,u)}function CF(i){for(let e of i.sections)if(rt(e.text))return!0;return!1}class aS{constructor(e){this.layoutVertexArray=new _b,this.indexArray=new xo,this.programConfigurations=e,this.segments=new Ir,this.dynamicLayoutVertexArray=new Sd,this.opacityVertexArray=new yb,this.occlusionQueryOpacityVertexArray=new _m,this.placedSymbolArray=new Mb,this.iconTransitioningVertexArray=new Wu,this.globeExtVertexArray=new bb,this.zOffsetVertexArray=new _m}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,l,u,m){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qn.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,is.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,wF,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,ns.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,tc.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Hs.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Co.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}de(aS,"SymbolBuffers");class sS{constructor(e,n,l){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new l,this.segments=new Ir,this.collisionVertexArray=new y_,this.collisionVertexArrayExt=new Sd}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Od.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Nx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}de(sS,"CollisionBuffers");class n0{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=t.ad.identity([]),this.placementViewportMatrix=t.ad.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=$2(this.zoom,n["text-size"]),this.iconSizeData=$2(this.zoom,n["icon-size"]);let l=this.layers[0].layout,u=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(p=>ic[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=l.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new aS(new qu(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new aS(new qu(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new Tv,this.lineVertexArray=new Mv,this.symbolInstances=new Iv}calculateGlyphDependencies(e,n,l,u,m){for(let p=0;p<e.length;p++){let b=e.codePointAt(p);if(b===void 0)break;if(n[b]=!0,u&&m&&b<=65535){let v=ly[e.charAt(p)];v&&(n[v.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let l=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!sy(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}populate(e,n,l,u){let m=this.layers[0],p=m.layout,b=this.projection.name==="globe",v=p.get("text-font"),S=p.get("text-field"),k=p.get("icon-image"),D=(S.value.kind!=="constant"||S.value.value instanceof co&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),A=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,L=p.get("symbol-sort-key");if(this.features=[],!D&&!A)return;let z=n.iconDependencies,V=n.glyphDependencies,H=n.availableImages,Y=new Vt(this.zoom);for(let{feature:ne,id:re,index:oe,sourceLayerIndex:xe}of e){let be=m._featureFilter.needGeometry,ke=Ed(ne,be);if(!m._featureFilter.filter(Y,ke,l))continue;if(be||(ke.geometry=xs(ne,l,u)),b&&ne.type!==1&&l.z<=5){let $e=ke.geometry,st=.98078528056,vt=(at,ht)=>{let tt=sg(at.x,at.y,l,1),mt=sg(ht.x,ht.y,l,1);return t._.dot(tt,mt)<st};for(let at=0;at<$e.length;at++)$e[at]=n2($e[at],vt)}let Ae,je;if(D){let $e=m.getValueAndResolveTokens("text-field",ke,l,H),st=co.factory($e);CF(st)&&(this.hasRTLText=!0),(!this.hasRTLText||Fi()==="unavailable"||this.hasRTLText&&yn.isParsed())&&(Ae=ZR(st,m,ke))}if(A){let $e=m.getValueAndResolveTokens("icon-image",ke,l,H);je=$e instanceof Ao?$e:Ao.fromString($e)}if(!Ae&&!je)continue;let Qe=this.sortFeaturesByKey?L.evaluate(ke,{},l):void 0;if(this.features.push({id:re,text:Ae,icon:je,index:oe,sourceLayerIndex:xe,geometry:ke.geometry,properties:ne.properties,type:xF[ne.type],sortKey:Qe}),je&&(z[je.namePrimary]=!0,je.nameSecondary&&(z[je.nameSecondary]=!0)),Ae){let $e=v.evaluate(ke,{},l).join(","),st=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ic.vertical)>=0;for(let vt of Ae.sections)if(vt.image)z[vt.image.namePrimary]=!0;else{let at=He(Ae.toString()),ht=vt.fontStack||$e,tt=V[ht]=V[ht]||{};this.calculateGlyphDependencies(vt.text,tt,st,this.allowVerticalPlacement,at)}}}p.get("symbol-placement")==="line"&&(this.features=function(ne){let re={},oe={},xe=[],be=0;function ke($e){xe.push(ne[$e]),be++}function Ae($e,st,vt){let at=oe[$e];return delete oe[$e],oe[st]=at,xe[at].geometry[0].pop(),xe[at].geometry[0]=xe[at].geometry[0].concat(vt[0]),at}function je($e,st,vt){let at=re[st];return delete re[st],re[$e]=at,xe[at].geometry[0].shift(),xe[at].geometry[0]=vt[0].concat(xe[at].geometry[0]),at}function Qe($e,st,vt){let at=vt?st[0][st[0].length-1]:st[0][0];return`${$e}:${at.x}:${at.y}`}for(let $e=0;$e<ne.length;$e++){let st=ne[$e],vt=st.geometry,at=st.text?st.text.toString():null;if(!at){ke($e);continue}let ht=Qe(at,vt),tt=Qe(at,vt,!0);if(ht in oe&&tt in re&&oe[ht]!==re[tt]){let mt=je(ht,tt,vt),Ct=Ae(ht,tt,xe[mt].geometry);delete re[ht],delete oe[tt],oe[Qe(at,xe[Ct].geometry,!0)]=Ct,xe[mt].geometry=null}else ht in oe?Ae(ht,tt,vt):tt in re?je(ht,tt,vt):(ke($e),re[ht]=be-1,oe[tt]=be-1)}return xe.filter($e=>$e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,re)=>ne.sortKey-re.sortKey)}update(e,n,l,u,m){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let b=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,b,l,u,m),this.icon.programConfigurations.updatePaintArrays(e,n,b,l,u,m)}updateOcclusionOpacities(e,n,l){if(!n.useOcclusionQueries)return!1;let u=this;if(u.projection.name==="globe")return!1;let m=!1;u.hasTextData()&&(m=m||u.text.occlusionQueryOpacityVertexArray.length!==0),u.hasIconData()&&(m=m||u.icon.occlusionQueryOpacityVertexArray.length!==0);let p=u.layers[0].paint,b=p.get("icon-occlusion-opacity").constantOr(0),v=p.get("text-occlusion-opacity").constantOr(0);if(!u.layers[0].hasInitialOcclusionOpacityProperties||b===1&&v===1)return!1;let S=!m;for(let L=0;L<u.symbolInstances.length;L++){let z=u.symbolInstances.get(L),V=z.occlusionOpacity;z.occlusionOpacity+=(z.occlusionState>.5?1:-1)*n.fadeSpeed*l*.001,z.occlusionOpacity=Ri(z.occlusionOpacity,0,1),S=S||z.occlusionOpacity!==V}if(!S)return!1;let k=0,D=0,A=(L,z,V,H)=>{let Y=0,ne=0;V?(Y=D,D+=H,ne=D):(Y=k,k+=H,ne=k),ne>z.occlusionQueryOpacityVertexArray.length&&z.occlusionQueryOpacityVertexArray.resize(ne);let re=L.occlusionOpacity;for(let oe=0;oe<H;oe++)z.occlusionQueryOpacityVertexArray.emplace(oe+Y,re)};for(let L=0;L<u.symbolInstances.length;L++){let z=u.symbolInstances.get(L),{numHorizontalGlyphVertices:V,numVerticalGlyphVertices:H,numIconVertices:Y}=z,ne=Y>0;if((V>0||H>0)&&(A(z,u.text,!1,V),A(z,u.text,!1,H)),ne){let{placedIconSymbolIndex:re,verticalPlacedIconSymbolIndex:oe}=z;re>=0&&A(z,u.icon,!0,Y),oe>=0&&A(z,u.icon,!0,z.numVerticalIconVertices)}}return u.hasTextData()&&u.text.occlusionQueryOpacityVertexBuffer&&(u.text.occlusionQueryOpacityVertexBuffer.length<u.text.occlusionQueryOpacityVertexArray.length?u.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(u.text.occlusionQueryOpacityVertexArray,ns.members,!0):u.text.occlusionQueryOpacityVertexBuffer.updateData(u.text.occlusionQueryOpacityVertexArray)),u.hasIconData()&&u.icon.occlusionQueryOpacityVertexBuffer&&(u.icon.occlusionQueryOpacityVertexBuffer.length<u.icon.occlusionQueryOpacityVertexArray.length?u.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(u.icon.occlusionQueryOpacityVertexArray,ns.members,!0):u.icon.occlusionQueryOpacityVertexBuffer.updateData(u.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(m,p,b)=>{l+=p,l>m.length&&m.resize(l);for(let v=-p;v<0;v++)m.emplace(v+l,b)},n=(m,p,b)=>{u+=p,u>m.length&&m.resize(u);for(let v=-p;v<0;v++)m.emplace(v+u,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,u=0;for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:v,numIconVertices:S}=p,k=p.zOffset,D=S>0;if((b>0||v>0)&&(e(this.text.zOffsetVertexArray,b,k),e(this.text.zOffsetVertexArray,v,k)),D){let{placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:L}=p;A>=0&&n(this.icon.zOffsetVertexArray,S,k),L>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,k)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=uk(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,n){let l=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:u,y:m}of n)this.lineVertexArray.emplaceBack(u,m);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,n,l,u,m,p,b,v,S,k,D,A,L,z,V,H){let Y=e.indexArray,ne=e.layoutVertexArray,re=e.globeExtVertexArray,oe=e.segments.prepareSegment(4*n.length,ne,Y,this.canOverlap?p.sortKey:void 0),xe=this.glyphOffsetArray.length,be=oe.vertexLength,ke=this.allowVerticalPlacement&&b===ic.vertical?Math.PI/2:0,Ae=p.text&&p.text.sections;for(let Qe=0;Qe<n.length;Qe++){let{tl:$e,tr:st,bl:vt,br:at,texPrimary:ht,texSecondary:tt,pixelOffsetTL:mt,pixelOffsetBR:Ct,minFontScaleX:ft,minFontScaleY:Ht,glyphOffset:xt,isSDF:Mt,sectionIndex:oi}=n[Qe],ti=oe.vertexLength,Jt=xt[1];if(Kx(ne,S.x,S.y,$e.x,Jt+$e.y,ht.x,ht.y,l,Mt,mt.x,mt.y,ft,Ht),Kx(ne,S.x,S.y,st.x,Jt+st.y,ht.x+ht.w,ht.y,l,Mt,Ct.x,mt.y,ft,Ht),Kx(ne,S.x,S.y,vt.x,Jt+vt.y,ht.x,ht.y+ht.h,l,Mt,mt.x,Ct.y,ft,Ht),Kx(ne,S.x,S.y,at.x,Jt+at.y,ht.x+ht.w,ht.y+ht.h,l,Mt,Ct.x,Ct.y,ft,Ht),v){let{x:Tt,y:li,z:Ei}=v.anchor,[gi,Li,Di]=v.up;e1(re,Tt,li,Ei,gi,Li,Di),e1(re,Tt,li,Ei,gi,Li,Di),e1(re,Tt,li,Ei,gi,Li,Di),e1(re,Tt,li,Ei,gi,Li,Di),t1(e.dynamicLayoutVertexArray,Tt,li,Ei,ke)}else t1(e.dynamicLayoutVertexArray,S.x,S.y,S.z,ke);if(H){let Tt=tt||ht;Jx(e.iconTransitioningVertexArray,Tt.x,Tt.y),Jx(e.iconTransitioningVertexArray,Tt.x+Tt.w,Tt.y),Jx(e.iconTransitioningVertexArray,Tt.x,Tt.y+Tt.h),Jx(e.iconTransitioningVertexArray,Tt.x+Tt.w,Tt.y+Tt.h)}Y.emplaceBack(ti,ti+1,ti+2),Y.emplaceBack(ti+1,ti+2,ti+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xt[0]),Qe!==n.length-1&&oi===n[Qe+1].sectionIndex||e.programConfigurations.populatePaintArrays(ne.length,p,p.index,{},L,z,V,Ae&&Ae[oi])}let je=v?v.anchor:S;e.placedSymbolArray.emplaceBack(je.x,je.y,je.z,S.x,S.y,xe,this.glyphOffsetArray.length-xe,be,k,D,S.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],b,0,!1,0,A,0)}_commitLayoutVertex(e,n,l,u,m,p,b){e.emplaceBack(n,l,u,m,p,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,n,l,u,m,p,b){let v=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),S=v.vertexLength,k=b.tileAnchorX,D=b.tileAnchorY;for(let L=0;L<4;L++)l.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,n,e.padding,b.zOffset),this._commitLayoutVertex(l.layoutVertexArray,u,m,p,k,D,new gt(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,m,p,k,D,new gt(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,m,p,k,D,new gt(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,m,p,k,D,new gt(e.x1,e.y2)),v.vertexLength+=4;let A=l.indexArray;A.emplaceBack(S,S+1),A.emplaceBack(S+1,S+2),A.emplaceBack(S+2,S+3),A.emplaceBack(S+3,S),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,l,u,m,p){for(let b=u;b<m;b++){let v=l.get(b),S=this.getSymbolInstanceTextSize(e,p,n,b);this._addCollisionDebugVertices(v,S,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,l,u,m,p){for(let b=u;b<m;b++){let v=l.get(b),S=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(v,S,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new sS(__,vM.members,Wu),this.iconCollisionBox=new sS(__,vM.members,Wu);let l=Q_(this.iconSizeData,e),u=Q_(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(u,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(u,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(l,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(l,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,l,u){let m=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),p=Hx(this.textSizeData,e,m)/Pa;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,l){let u=this.icon.placedSymbolArray.get(l),m=Hx(this.iconSizeData,e,u);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,n,l,u){e.emplaceBack(n,-l,-l,u),e.emplaceBack(n,l,-l,u),e.emplaceBack(n,l,l,u),e.emplaceBack(n,-l,l,u)}_updateTextDebugCollisionBoxes(e,n,l,u,m,p){for(let b=u;b<m;b++){let v=l.get(b),S=this.getSymbolInstanceTextSize(e,p,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,v.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,l,u,m,p){for(let b=u;b<m;b++){let v=l.get(b),S=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,v.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let l=Q_(this.iconSizeData,e),u=Q_(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(u,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(u,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(l,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(l,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,l,u,m,p,b,v,S){let k={};if(n<l){let{x1:D,y1:A,x2:L,y2:z,padding:V,projectedAnchorX:H,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:re,tileAnchorY:oe,featureIndex:xe}=e.get(n);k.textBox={x1:D,y1:A,x2:L,y2:z,padding:V,projectedAnchorX:H,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:re,tileAnchorY:oe},k.textFeatureIndex=xe}if(u<m){let{x1:D,y1:A,x2:L,y2:z,padding:V,projectedAnchorX:H,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:re,tileAnchorY:oe,featureIndex:xe}=e.get(u);k.verticalTextBox={x1:D,y1:A,x2:L,y2:z,padding:V,projectedAnchorX:H,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:re,tileAnchorY:oe},k.verticalTextFeatureIndex=xe}if(p<b){let{x1:D,y1:A,x2:L,y2:z,padding:V,projectedAnchorX:H,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:re,tileAnchorY:oe,featureIndex:xe}=e.get(p);k.iconBox={x1:D,y1:A,x2:L,y2:z,padding:V,projectedAnchorX:H,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:re,tileAnchorY:oe},k.iconFeatureIndex=xe}if(v<S){let{x1:D,y1:A,x2:L,y2:z,padding:V,projectedAnchorX:H,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:re,tileAnchorY:oe,featureIndex:xe}=e.get(v);k.verticalIconBox={x1:D,y1:A,x2:L,y2:z,padding:V,projectedAnchorX:H,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:re,tileAnchorY:oe},k.verticalIconFeatureIndex=xe}return k}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let l=e.placedSymbolArray.get(n),u=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<u;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),l=Math.cos(e),u=[],m=[],p=[];for(let b=0;b<this.symbolInstances.length;++b){p.push(b);let v=this.symbolInstances.get(b);u.push(0|Math.round(n*v.tileAnchorX+l*v.tileAnchorY)),m.push(v.featureIndex)}return p.sort((b,v)=>u[b]-u[v]||m[v]-m[b]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex);let{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:S}=l;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),m>=0&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),p>=0&&p!==m&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}de(n0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),n0.addDynamicAttributes=t1;class Bc{constructor(e,n,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,l){let{width:u,height:m}=e,{context:p}=this,{gl:b}=p;if(b.bindTexture(b.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||n.premultiply!==!1)),l||this.size&&this.size[0]===u&&this.size[1]===m){let{x:v,y:S}=l||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)b.texSubImage2D(b.TEXTURE_2D,0,v,S,b.RGBA,b.UNSIGNED_BYTE,e);else{let k=this.format,D=b.UNSIGNED_BYTE;this.format===b.R32F&&(k=b.RED,D=b.FLOAT),b.texSubImage2D(b.TEXTURE_2D,0,v,S,u,m,k,D,e.data)}}else if(this.size=[u,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let v=this.format;this.format===b.R8&&(v=b.RED),b.texImage2D(b.TEXTURE_2D,0,this.format,v,b.UNSIGNED_BYTE,e)}else{let v=this.format,S=this.format,k=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(v=b.DEPTH_COMPONENT16,k=b.UNSIGNED_SHORT),this.format===b.R8&&(S=b.RED),this.format===b.R32F&&(k=b.FLOAT,S=b.RED),b.texImage2D(b.TEXTURE_2D,0,v,u,m,0,S,k,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,n,l=!1){let{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,n),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,l,u){let{context:m}=this,{gl:p}=m;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),this.wrapS=l),u!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class i1{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}}let Nc=32,nh=33,jp=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,n=0,l=0,u=0,m=0,p=0,b=0;for(1&e?u=m=p=Nc:n=l=b=Nc;(e>>=1)>1;){let S=n+u>>1,k=l+m>>1;1&e?(u=n,m=l,n=p,l=b):(n=u,l=m,u=p,m=b),p=S,b=k}let v=4*i;jp[v+0]=n,jp[v+1]=l,jp[v+2]=u,jp[v+3]=m}let rh=new Uint16Array(2178),Up=new Uint8Array(1089),n1=new Uint16Array(1089);function hk(i){return i===0?-.03125:i===32?.03125:0}var r1=xn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),SF=xn([{name:"a_index",type:"Int16",components:1}]);let mk={type:2,extent:At,loadGeometry:()=>[[new gt(0,0),new gt(At+1,0),new gt(At+1,At+1),new gt(0,At+1),new gt(0,0)]]};class o1{constructor(e,n,l,u,m){this.tileID=e,this.uid=Dh(),this.uses=0,this.tileSize=n,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,u&&u.style&&(this._lastUpdatedBrightness=u.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<Eo.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=vg(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,l){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,m){let p={};if(!m)return p;for(let b of u){let v=b.layerIds.map(S=>m.getLayer(S)).filter(Boolean);if(v.length!==0){b.layers=v,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(S=>v.filter(k=>k.id===S)[0]));for(let S of v)p[S.fqid]=b}}return p}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let u in this.buckets){let m=this.buckets[u];if(m instanceof n0){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let u in this.buckets){let m=this.buckets[u];if(m instanceof n0&&m.hasRTLText){this.hasRTLText=!0,yn.isLoading()||yn.isLoaded()||Fi()!=="deferred"||Gi();break}}this.queryPadding=0;for(let u in this.buckets){let m=this.buckets[u],p=n.style.getOwnLayer(u);if(!p)continue;let b=p.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,b)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Tb}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let u in this.buckets){let m=this.buckets[u];m.uploadPending()&&m.upload(e)}let n=e.gl,l=this.imageAtlas;if(l&&!l.uploaded){let u=!!Object.keys(l.patternPositions).length;this.imageAtlasTexture=new Bc(e,l.image,n.RGBA,{useMipmap:u}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Bc(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Bc(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,l){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,l),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let u=n.style.getBrightness();(this._lastUpdatedBrightness||u)&&(this._lastUpdatedBrightness&&u&&Math.abs(this._lastUpdatedBrightness-u)<.001||(this._lastUpdatedBrightness=u,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,l,u,m,p,b,v){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:b,transform:p,params:m,tileTransform:this.tileTransform},e,n,l):{}}querySourceFeatures(e,n){let l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;let u=l.loadVTLayers(),m=n?n.sourceLayer:"",p=u._geojsonTileLayer||u[m];if(!p)return;let b=Gn(n&&n.filter),{z:v,x:S,y:k}=this.tileID.canonical,D={z:v,x:S,y:k};for(let A=0;A<p.length;A++){let L=p.feature(A);if(b.needGeometry){let H=Ed(L,!0);if(!b.filter(new Vt(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!b.filter(new Vt(this.tileID.overscaledZ),L))continue;let z=l.getId(L,m),V=new RM(L,v,S,k,z);V.tile=D,e.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let l=el(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let l=Date.now(),u=!1;if(this.expirationTime>l)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{let m=this.expirationTime-n;m?this.expirationTime=l+Math.max(m,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let l=this.latestFeatureIndex.loadVTLayers(),u=n.style.listImages(),m=n.style.getBrightness();for(let p in this.buckets){if(!n.style.hasLayer(p))continue;let b=this.buckets[p],v=b.layers[0].sourceLayer||"_geojsonTileLayer",S=l[v],k={};if(e&&(k=e[v],!S||!k||Object.keys(k).length===0))continue;if(b.update(k,S,u,this.imageAtlas&&this.imageAtlas.patternPositions||{},m),b instanceof Vx||b instanceof L_){let A=n.style.getOwnSourceCache(b.layers[0].source);n._terrain&&n._terrain.enabled&&A&&b.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(A.id,this.tileID)}let D=n&&n.style&&n.style.getOwnLayer(p);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Eo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Eo.now()+e}setTexture(e,n){let l=n.context,u=l.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Bc?this.texture.update(e,{useMipmap:!0}):(this.texture=new Bc(l,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,n){let l={};for(let u of n)l[u]=!0;this.dependencies[e]=l}hasDependency(e,n){for(let l of e){let u=this.dependencies[l];if(u){for(let m of n)if(u[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let l=xs(mk,this.tileID.canonical,this.tileTransform)[0],u=new ys,m=new tg;for(let p=0;p<l.length;p++){let{x:b,y:v}=l[p];u.emplaceBack(b,v),m.emplaceBack(p)}m.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(m),this._tileDebugBuffer=e.createVertexBuffer(u,Zu.members),this._tileDebugSegments=Ir.simpleSegment(0,0,u.length,m.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let l=xs(mk,this.tileID.canonical,this.tileTransform)[0],u,m;if(this.isRaster){let p=function(b,v){let S=vg(b,v),k=Math.pow(2,b.z);for(let H=0;H<nh;H++)for(let Y=0;Y<nh;Y++){let ne=ts((b.x+(Y+hk(Y))/Nc)/k),re=$o((b.y+(H+hk(H))/Nc)/k),oe=v.project(ne,re),xe=H*nh+Y;rh[2*xe+0]=Math.round((oe.x*S.scale-S.x)*At),rh[2*xe+1]=Math.round((oe.y*S.scale-S.y)*At)}Up.fill(0),n1.fill(0);for(let H=2045;H>=0;H--){let Y=4*H,ne=jp[Y+0],re=jp[Y+1],oe=jp[Y+2],xe=jp[Y+3],be=ne+oe>>1,ke=re+xe>>1,Ae=be+ke-re,je=ke+ne-be,Qe=re*nh+ne,$e=xe*nh+oe,st=ke*nh+be,vt=Math.hypot((rh[2*Qe+0]+rh[2*$e+0])/2-rh[2*st+0],(rh[2*Qe+1]+rh[2*$e+1])/2-rh[2*st+1])>=16;Up[st]=Up[st]||(vt?1:0),H<1022&&(Up[st]=Up[st]||Up[(re+je>>1)*nh+(ne+Ae>>1)]||Up[(xe+je>>1)*nh+(oe+Ae>>1)])}let D=new Da,A=new xo,L=0;function z(H,Y){let ne=Y*nh+H;return n1[ne]===0&&(D.emplaceBack(rh[2*ne+0],rh[2*ne+1],H*At/Nc,Y*At/Nc),n1[ne]=++L),n1[ne]-1}function V(H,Y,ne,re,oe,xe){let be=H+ne>>1,ke=Y+re>>1;if(Math.abs(H-oe)+Math.abs(Y-xe)>1&&Up[ke*nh+be])V(oe,xe,H,Y,be,ke),V(ne,re,oe,xe,be,ke);else{let Ae=z(H,Y),je=z(ne,re),Qe=z(oe,xe);A.emplaceBack(Ae,je,Qe)}}return V(0,0,Nc,Nc,Nc,0),V(Nc,Nc,0,0,0,Nc),{vertices:D,indices:A}}(this.tileID.canonical,n);u=p.vertices,m=p.indices}else{u=new Da,m=new xo;for(let{x:b,y:v}of l)u.emplaceBack(b,v,0,0);let p=ug(u.int16,void 0,4);for(let b=0;b<p.length;b+=3)m.emplaceBack(p[b],p[b+1],p[b+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,r1.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(m),this._tileBoundsSegments=Ir.simpleSegment(0,0,u.length,m.length)}_makeGlobeTileDebugBuffers(e,n){let l=n.projection;if(!l||l.name!=="globe"||n.freezeTileCoverage)return;let u=this.tileID.canonical,m=Aa(Zv(u,n)),p=Ad(n.zoom),b;p>0&&(b=t.ad.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,n,m,b,p),this._makeGlobeTileDebugTextBuffer(e,u,n,m,b,p)}_globePoint(e,n,l,u,m,p,b){let v=sg(e,n,l);if(p){let S=1<<l.z,k=Ac(u.center.lng),D=Pc(u.center.lat),A=(l.x+.5)/S-k,L=0;A>.5?L=-1:A<-.5&&(L=1);let z=(e/At+l.x)/S+L,V=(n/At+l.y)/S;z=(z-k)*u._pixelsPerMercatorPixel+k,V=(V-D)*u._pixelsPerMercatorPixel+D;let H=[z*u.worldSize,V*u.worldSize,0];t._.transformMat4(H,H,p),v=Dd(v,H,b)}return t._.transformMat4(v,v,m)}_makeGlobeTileDebugBorderBuffer(e,n,l,u,m,p){let b=new ys,v=new tg,S=new eg,k=(A,L,z,V,H)=>{let Y=(z-A)/(H-1),ne=(V-L)/(H-1),re=b.length;for(let oe=0;oe<H;oe++){let xe=A+oe*Y,be=L+oe*ne;b.emplaceBack(xe,be);let ke=this._globePoint(xe,be,n,l,u,m,p);S.emplaceBack(ke[0],ke[1],ke[2]),v.emplaceBack(re+oe)}},D=At;k(0,0,D,0,16),k(D,0,D,D,16),k(D,D,0,D,16),k(0,D,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(v),this._tileDebugBuffer=e.createVertexBuffer(b,Zu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(S,qb.members),this._tileDebugSegments=Ir.simpleSegment(0,0,b.length,v.length)}_makeGlobeTileDebugTextBuffer(e,n,l,u,m,p){let b=At/4,v=new ys,S=new xo,k=new eg,D=25;S.reserve(32),v.reserve(D),k.reserve(D);let A=(L,z)=>D*L+z;for(let L=0;L<D;L++){let z=L*b;for(let V=0;V<D;V++){let H=V*b;v.emplaceBack(H,z);let Y=this._globePoint(H,z,n,l,u,m,p);k.emplaceBack(Y[0],Y[1],Y[2])}}for(let L=0;L<4;L++)for(let z=0;z<4;z++){let V=A(L,z),H=A(L,z+1),Y=A(L+1,z),ne=A(L+1,z+1);S.emplaceBack(V,H,Y),S.emplaceBack(Y,H,ne)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(S),this._tileDebugTextBuffer=e.createVertexBuffer(v,Zu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(k,qb.members),this._tileDebugTextSegments=Ir.simpleSegment(0,0,D,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Bc&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let Mi={read:function(i,e){return i.readFields(Mi._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(i,e,n){i===1?e.header_length=n.readFixed32():i===2?e.x=n.readVarint():i===3?e.y=n.readVarint():i===4?e.z=n.readVarint():i===5&&e.layers.push(Mi.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Mi.Filter.read=function(i,e){return i.readFields(Mi.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},Mi.Filter._readField=function(i,e,n){i===1?(e.delta_filter=Mi.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):i===2?(e.zigzag_filter=Mi.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):i===3?(e.bitshuffle_filter=Mi.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):i===4&&(e.byteshuffle_filter=Mi.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},Mi.Filter.Delta={},Mi.Filter.Delta.read=function(i,e){return i.readFields(Mi.Filter.Delta._readField,{block_size:0},e)},Mi.Filter.Delta._readField=function(i,e,n){i===1&&(e.block_size=n.readVarint())},Mi.Filter.Zigzag={},Mi.Filter.Zigzag.read=function(i,e){return i.readFields(Mi.Filter.Zigzag._readField,{},e)},Mi.Filter.Zigzag._readField=function(i,e,n){},Mi.Filter.BitShuffle={},Mi.Filter.BitShuffle.read=function(i,e){return i.readFields(Mi.Filter.BitShuffle._readField,{},e)},Mi.Filter.BitShuffle._readField=function(i,e,n){},Mi.Filter.ByteShuffle={},Mi.Filter.ByteShuffle.read=function(i,e){return i.readFields(Mi.Filter.ByteShuffle._readField,{},e)},Mi.Filter.ByteShuffle._readField=function(i,e,n){},Mi.Codec={},Mi.Codec.read=function(i,e){return i.readFields(Mi.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},Mi.Codec._readField=function(i,e,n){i===1?(e.gzip_data=Mi.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):i===2?(e.jpeg_image=Mi.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):i===3?(e.webp_image=Mi.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):i===4&&(e.png_image=Mi.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},Mi.Codec.GzipData={},Mi.Codec.GzipData.read=function(i,e){return i.readFields(Mi.Codec.GzipData._readField,{},e)},Mi.Codec.GzipData._readField=function(i,e,n){},Mi.Codec.JpegImage={},Mi.Codec.JpegImage.read=function(i,e){return i.readFields(Mi.Codec.JpegImage._readField,{},e)},Mi.Codec.JpegImage._readField=function(i,e,n){},Mi.Codec.WebpImage={},Mi.Codec.WebpImage.read=function(i,e){return i.readFields(Mi.Codec.WebpImage._readField,{},e)},Mi.Codec.WebpImage._readField=function(i,e,n){},Mi.Codec.PngImage={},Mi.Codec.PngImage.read=function(i,e){return i.readFields(Mi.Codec.PngImage._readField,{},e)},Mi.Codec.PngImage._readField=function(i,e,n){},Mi.DataIndexEntry={},Mi.DataIndexEntry.read=function(i,e){return i.readFields(Mi.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},Mi.DataIndexEntry._readField=function(i,e,n){i===1?e.first_byte=n.readFixed64():i===2?e.last_byte=n.readFixed64():i===3?e.filters.push(Mi.Filter.read(n,n.readVarint()+n.pos)):i===4?e.codec=Mi.Codec.read(n,n.readVarint()+n.pos):i===5?e.offset=n.readFloat():i===6?e.scale=n.readFloat():i===7&&e.bands.push(n.readString())},Mi.Layer={},Mi.Layer.read=function(i,e){return i.readFields(Mi.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},Mi.Layer._readField=function(i,e,n){i===1?e.version=n.readVarint():i===2?e.name=n.readString():i===3?e.units=n.readString():i===4?e.tilesize=n.readVarint():i===5?e.buffer=n.readVarint():i===6?e.pixel_format=n.readVarint():i===7&&e.data_index.push(Mi.DataIndexEntry.read(n,n.readVarint()+n.pos))};let zd={read:function(i,e){return i.readFields(zd._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(i,e,n){i===2?(e.uint32_values=zd.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):i===3&&(e.fixed32_values=zd.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};zd.Uint32Values.read=function(i,e){return i.readFields(zd.Uint32Values._readField,{values:[]},e)},zd.Uint32Values._readField=function(i,e,n){i===1&&(e.readValuesInto=function(l){if(l.type!==2)throw new Error(`Unsupported pbf type "${l.type}"`);let u=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(l),m=l.pos;return l.pos=u,function(p){l.pos=m;let b=0;for(;l.pos<u;){let v=l.readVarint();p[b++]=v}return p}}(n))},zd.Fixed32Values={},zd.Fixed32Values.read=function(i,e){return i.readFields(zd.Fixed32Values._readField,{values:[]},e)},zd.Fixed32Values._readField=function(i,e,n){throw new Error("Not implemented")};class IF{constructor(e=0,n=0,l=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=l,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let l=this.items[e];this.ttl>0&&l.expiry<=Date.now()?this.delete(e):(n=l.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,l=!1,u=this.resetTtl){let m;if(l||this.has(e)){if(m=this.items[e],m.value=n,l===!1&&u&&(m.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==m){let p=this.last,b=m.next,v=m.prev;this.first===m&&(this.first=m.next),m.next=null,m.prev=this.last,p.next=m,v!==null&&(v.next=b),b!==null&&(b.prev=v)}}else this.max>0&&this.size===this.max&&this.evict(!0),m=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=m:this.last.next=m;return this.last=m,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function TF(i,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let l=2;l>=1;l--){let u=l===1?1:0,m=l===2?1:0;for(let p=0;p<e[0];p++){let b=e[1]*p;for(let v=u;v<e[1];v++){let S=e[2]*(v+b);for(let k=m;k<e[2];k++){let D=e[3]*(k+S);for(let A=0;A<e[3];A++){let L=D+A;i[L]+=i[L-n]}}}}n*=e[l]}return i}function MF(i){for(let e=0,n=i.length;e<n;e++)i[e]=i[e]>>>1^-(1&i[e]);return i}function kF(i,e){switch(e){case"uint32":return i;case"uint16":for(let n=0;n<i.length;n+=2){let l=i[n],u=i[n+1];i[n]=(240&l)>>4|(61440&l)>>8|(240&u)<<4|61440&u,i[n+1]=15&l|(3840&l)>>4|(15&u)<<8|(3840&u)<<4}return i;case"uint8":for(let n=0;n<i.length;n+=4){let l=i[n],u=i[n+1],m=i[n+2],p=i[n+3];i[n+0]=(192&l)>>6|(192&u)>>4|(192&m)>>2|192&p,i[n+1]=(48&l)>>4|(48&u)>>2|48&m|(48&p)<<2,i[n+2]=(12&l)>>2|12&u|(12&m)<<2|(12&p)<<4,i[n+3]=3&l|(3&u)<<2|(3&m)<<4|(3&p)<<6}return i;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Wp extends Error{constructor(e){super(e),this.name="MRTError"}}var nc=Uint8Array,r0=Uint16Array,EF=Int32Array,pk=new nc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fk=new nc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),DF=new nc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gk=function(i,e){for(var n=new r0(31),l=0;l<31;++l)n[l]=e+=1<<i[l-1];var u=new EF(n[30]);for(l=1;l<30;++l)for(var m=n[l];m<n[l+1];++m)u[m]=m-n[l]<<5|l;return{b:n,r:u}},_k=gk(pk,2),bk=_k.b,AF=_k.r;bk[28]=258,AF[258]=28;for(var PF=gk(fk,0).b,lS=new r0(32768),_o=0;_o<32768;++_o){var o0=(43690&_o)>>1|(21845&_o)<<1;lS[_o]=((65280&(o0=(61680&(o0=(52428&o0)>>2|(13107&o0)<<2))>>4|(3855&o0)<<4))>>8|(255&o0)<<8)>>1}var _y=function(i,e,n){for(var l=i.length,u=0,m=new r0(e);u<l;++u)i[u]&&++m[i[u]-1];var p,b=new r0(e);for(u=1;u<e;++u)b[u]=b[u-1]+m[u-1]<<1;if(n){p=new r0(1<<e);var v=15-e;for(u=0;u<l;++u)if(i[u])for(var S=u<<4|i[u],k=e-i[u],D=b[i[u]-1]++<<k,A=D|(1<<k)-1;D<=A;++D)p[lS[D]>>v]=S}else for(p=new r0(l),u=0;u<l;++u)i[u]&&(p[u]=lS[b[i[u]-1]++]>>15-i[u]);return p},by=new nc(288);for(_o=0;_o<144;++_o)by[_o]=8;for(_o=144;_o<256;++_o)by[_o]=9;for(_o=256;_o<280;++_o)by[_o]=7;for(_o=280;_o<288;++_o)by[_o]=8;var yk=new nc(32);for(_o=0;_o<32;++_o)yk[_o]=5;var OF=_y(by,9,1),RF=_y(yk,5,1),cS=function(i){for(var e=i[0],n=1;n<i.length;++n)i[n]>e&&(e=i[n]);return e},Bd=function(i,e,n){var l=e/8|0;return(i[l]|i[l+1]<<8)>>(7&e)&n},dS=function(i,e){var n=e/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(7&e)},FF=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Nd=function(i,e,n){var l=new Error(e||FF[i]);if(l.code=i,Error.captureStackTrace&&Error.captureStackTrace(l,Nd),!n)throw l;return l},LF=new nc(0),zF=typeof TextDecoder<"u"&&new TextDecoder;try{zF.decode(LF,{stream:!0})}catch{}let BF={gzip_data:"gzip"},NF={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},VF={uint32:1,uint16:2,uint8:4},jF={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class uS{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),l=new DataView(e);if(n[0]!==13)throw new Wp("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),l=this.getHeaderLength(e);if(n.length<l)throw new Wp(`Expected header with length >= ${l} but got buffer of length ${n.length}`);let u=new X_(n.subarray(0,l)),m=Mi.read(u);if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new Wp(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(let p of m.layers)this.layers[p.name]=new UF(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],l=this.getLayer(e.layerName);for(let u=0;u<l.dataIndex.length;u++){let m=l.dataIndex[u],p=m.first_byte-e.firstByte,b=m.last_byte+1-e.firstByte;if(u<e.firstBlock||u>e.lastBlock||l._blocksInProgress.has(u))continue;let v={layerName:l.name,firstByte:p,lastByte:b,pixelFormat:l.pixelFormat,blockIndex:u,blockShape:[m.bands.length].concat(l.bandShape),buffer:l.buffer,codec:m.codec.codec,filters:m.filters.map(S=>S.filter)};l._blocksInProgress.add(u),n.push(v)}return new vk(n,()=>{n.forEach(u=>l._blocksInProgress.delete(u.blockIndex))},(u,m)=>{if(n.forEach(p=>l._blocksInProgress.delete(p.blockIndex)),u)throw u;m.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class UF{constructor({version:e,name:n,units:l,tilesize:u,pixel_format:m,buffer:p,data_index:b},v){if(this.version=e,this.version!==1)throw new Wp(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=l,this.tileSize=u,this.buffer=p,this.pixelFormat=NF[m],this.dataIndex=b,this.bandShape=[u+2*p,u+2*p,VF[this.pixelFormat]],this._decodedBlocks=function(S=1e3,k=0,D=!1){if(isNaN(S)||S<0)throw new TypeError("Invalid max value");if(isNaN(k)||k<0)throw new TypeError("Invalid ttl value");if(typeof D!="boolean")throw new TypeError("Invalid resetTtl value");return new IF(S,k,D)}(v?v.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[l,u]of this.dataIndex.entries()){for(let[m,p]of u.bands.entries())if(p===e)return{bandIndex:n+m,blockIndex:l,blockBandIndex:m};n+=u.bands.length}break;case"number":for(let[l,u]of this.dataIndex.entries()){if(e>=n&&e<n+u.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-n};n+=u.bands.length}break;default:throw new Wp(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Wp(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,l=-1/0,u=1/0,m=-1/0;for(let p of e){let{blockIndex:b}=this.getBlockForBand(p);if(b<0)throw new Wp(`Invalid band: ${JSON.stringify(p)}`);let v=this.dataIndex[b];u=Math.min(u,b),m=Math.max(m,b),n=Math.min(n,v.first_byte),l=Math.max(l,v.last_byte)}return{layerName:this.name,firstByte:n,lastByte:l,firstBlock:u,lastBlock:m}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:l}=this.getBlockForBand(e),u=this._decodedBlocks.get(n.toString());if(!u)throw new Wp(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let m=this.dataIndex[n],p=this.bandShape.reduce((S,k)=>S*k,1),b=l*p,v=u.subarray(b,b+p);return{data:v,bytes:new Uint8Array(v.buffer).subarray(v.byteOffset,v.byteOffset+v.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:m.offset,scale:m.scale}}}class vk{constructor(e,n,l){this.tasks=e,this._onCancel=n,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}uS.performDecoding=function(i,e){return Promise.all(e.tasks.map(n=>{let{layerName:l,firstByte:u,lastByte:m,pixelFormat:p,blockShape:b,blockIndex:v,filters:S,codec:k}=n,D=new Uint8Array(i).subarray(u,m+1),A=new Uint32Array(b[0]*b[1]*b[2]),L;if(k!=="gzip_data")throw new Error(`Unhandled codec: ${k}`);return L=function(z,V){if(!globalThis.DecompressionStream&&V==="gzip_data")return Promise.resolve(((re=function(be){be[0]==31&&be[1]==139&&be[2]==8||Nd(6,"invalid gzip data");var ke=be[3],Ae=10;4&ke&&(Ae+=2+(be[10]|be[11]<<8));for(var je=(ke>>3&1)+(ke>>4&1);je>0;je-=!be[Ae++]);return Ae+(2&ke)}(ne=z))+8>ne.length&&Nd(6,"invalid gzip data"),function(be,ke,Ae,je){var Qe=be.length;if(!Qe||ke.f&&!ke.l)return Ae||new nc(0);var $e=!Ae,st=$e||ke.i!=2,vt=ke.i;$e&&(Ae=new nc(3*Qe));var at,ht,tt=function(Gp){var qp=Ae.length;if(Gp>qp){var Ig=new nc(Math.max(2*qp,Gp));Ig.set(Ae),Ae=Ig}},mt=ke.f||0,Ct=ke.p||0,ft=ke.b||0,Ht=ke.l,xt=ke.d,Mt=ke.m,oi=ke.n,ti=8*Qe;do{if(!Ht){mt=Bd(be,Ct,1);var Jt=Bd(be,Ct+1,3);if(Ct+=3,!Jt){var Tt=be[(fn=4+((Ct+7)/8|0))-4]|be[fn-3]<<8,li=fn+Tt;if(li>Qe){vt&&Nd(0);break}st&&tt(ft+Tt),Ae.set(be.subarray(fn,li),ft),ke.b=ft+=Tt,ke.p=Ct=8*li,ke.f=mt;continue}if(Jt==1)Ht=OF,xt=RF,Mt=9,oi=5;else if(Jt==2){var Ei=Bd(be,Ct,31)+257,gi=Bd(be,Ct+10,15)+4,Li=Ei+Bd(be,Ct+5,31)+1;Ct+=14;for(var Di=new nc(Li),Xi=new nc(19),mi=0;mi<gi;++mi)Xi[DF[mi]]=Bd(be,Ct+3*mi,7);Ct+=3*gi;var qn=cS(Xi),Wn=(1<<qn)-1,In=_y(Xi,qn,1);for(mi=0;mi<Li;){var fn,Tn=In[Bd(be,Ct,Wn)];if(Ct+=15&Tn,(fn=Tn>>4)<16)Di[mi++]=fn;else{var ur=0,tr=0;for(fn==16?(tr=3+Bd(be,Ct,3),Ct+=2,ur=Di[mi-1]):fn==17?(tr=3+Bd(be,Ct,7),Ct+=3):fn==18&&(tr=11+Bd(be,Ct,127),Ct+=7);tr--;)Di[mi++]=ur}}var jr=Di.subarray(0,Ei),Lr=Di.subarray(Ei);Mt=cS(jr),oi=cS(Lr),Ht=_y(jr,Mt,1),xt=_y(Lr,oi,1)}else Nd(1);if(Ct>ti){vt&&Nd(0);break}}st&&tt(ft+131072);for(var Wa=(1<<Mt)-1,to=(1<<oi)-1,Pr=Ct;;Pr=Ct){var So=(ur=Ht[dS(be,Ct)&Wa])>>4;if((Ct+=15&ur)>ti){vt&&Nd(0);break}if(ur||Nd(2),So<256)Ae[ft++]=So;else{if(So==256){Pr=Ct,Ht=null;break}var pa=So-254;So>264&&(pa=Bd(be,Ct,(1<<(Is=pk[mi=So-257]))-1)+bk[mi],Ct+=Is);var fa=xt[dS(be,Ct)&to],ar=fa>>4;if(fa||Nd(3),Ct+=15&fa,Lr=PF[ar],ar>3){var Is=fk[ar];Lr+=dS(be,Ct)&(1<<Is)-1,Ct+=Is}if(Ct>ti){vt&&Nd(0);break}st&&tt(ft+131072);var Im=ft+pa;if(ft<Lr){var Vc=0-Lr,jd=Math.min(Lr,Im);for(Vc+ft<0&&Nd(3);ft<jd;++ft)Ae[ft]=(void 0)[Vc+ft]}for(;ft<Im;++ft)Ae[ft]=Ae[ft-Lr]}}ke.l=Ht,ke.p=Pr,ke.b=ft,ke.f=mt,Ht&&(mt=1,ke.m=Mt,ke.d=xt,ke.n=oi)}while(!mt);return ft!=Ae.length&&$e?(at=Ae,((ht=ft)==null||ht>at.length)&&(ht=at.length),new nc(at.subarray(0,ht))):Ae.subarray(0,ft)}(ne.subarray(re,-8),{i:2},new nc(((H=ne)[(Y=H.length)-4]|H[Y-3]<<8|H[Y-2]<<16|H[Y-1]<<24)>>>0))));var H,Y,ne,re;let oe=BF[V];if(!oe)throw new Error(`Unhandled codec: ${V}`);let xe=new globalThis.DecompressionStream(oe);return new Response(new Blob([z]).stream().pipeThrough(xe)).arrayBuffer().then(be=>new Uint8Array(be))}(D,k).then(z=>{let V=zd.read(new X_(z));if(V.values==="uint32_values")return V.uint32_values.readValuesInto(A),new jF[p](A.buffer);throw new Error(`Unhandled numeric data "${V.values}"`)}),L.then(z=>{for(let V=S.length-1;V>=0;V--)switch(S[V]){case"delta_filter":TF(z,b);break;case"zigzag_filter":MF(z);break;case"bitshuffle_filter":kF(z,p);break;default:throw new Error(`Unhandled filter "${S[V]}"`)}return{layerName:l,blockIndex:v,data:z}}).catch(z=>{throw z})}))};class xk extends o1{constructor(e,n,l,u,m){super(e,n,l,u,m),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){let l=n.context,u=l.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Bc?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new Bc(l,e,u.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){let l=this._mrt=new uS(30),u=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=nl(u,(m,p,b,v)=>{if(m)n(m);else try{let S=l.getHeaderLength(p);if(S>e)return void(this.request=this.fetchHeader(S,n));l.parseHeader(p),this._isHeaderLoaded=!0;let k=0;for(let D of Object.values(l.layers))k=Math.max(k,D.dataIndex[D.dataIndex.length-1].last_byte);p.byteLength>=k&&(this.entireBuffer=p),n(null,this.entireBuffer||p,b,v)}catch(S){n(S)}}),this.request}fetchBand(e,n,l){let u=this._mrt;if(!this._isHeaderLoaded||!u)return void l(new Error("Tile header is not ready"));let m=this.actor;if(!m)return void l(new Error("Can't fetch tile band without an actor"));let p,b=(D,A)=>{p.complete(D,A),D?l(D):(this.updateTextureDescriptor(e,n),l(null,this.textureDescriptor&&this.textureDescriptor.img))},v=(D,A)=>{if(D)return l(D);let L=m.send("decodeRasterArray",{buffer:A,task:p},b,void 0,!0);this._workQueue.push(()=>{L&&L.cancel(),p.cancel()})},S=u.getLayer(e);if(!S)return void l(new Error(`Unknown sourceLayer "${e}"`));if(S.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void l(null,this.textureDescriptor?this.textureDescriptor.img:null);let k=S.getDataRange([n]);if(p=u.createDecodingTask(k),!p||p.tasks.length)if(this.flushQueues(),this.entireBuffer)v(null,this.entireBuffer.slice(k.firstByte,k.lastByte+1));else{let D=Object.assign({},this.requestParams,{headers:{Range:`bytes=${k.firstByte}-${k.lastByte}`}}),A=nl(D,v);this._fetchQueue.push(()=>{A.cancel(),p.cancel()})}else l(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,n){if(!this._mrt)return;let l=this._mrt.getLayer(e);if(!l||!l.hasBand(n)||!l.hasDataForBand(n))return;let{bytes:u,tileSize:m,buffer:p,offset:b,scale:v}=l.getBandView(n),S=m+2*p,k={data:u,width:S,height:S},D=this.texture;D&&D instanceof Bc&&D.update(k,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:k,buffer:p,offset:b,tileSize:m,format:l.pixelFormat,mix:[v,256*v,65536*v,16777216*v]}}}class WF{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,l){let u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);let m={value:n,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},l)),this.data[u].push(m),this.order.push(u),this.order.length>this.max){let p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let l=e.wrapped().key,u=n===void 0?0:this.data[l].indexOf(n),m=this.data[l][u];return this.data[l].splice(u,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let l in this.data)for(let u of this.data[l])e(u.value)||n.push(u);for(let l of n)this.remove(l.value.tileID,l)}}class xg extends md{constructor(e,n,l){super(),this.id=e,this._onlySymbols=l,n.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new WF(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new qR,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let l=this._tiles[n];l.upload(e),l.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Ya(this._tiles).map(e=>e.tileID).sort(wk).map(e=>e.key)}getRenderableIds(e,n){let l=[];for(let u in this._tiles)this._isIdRenderable(+u,e,n)&&l.push(this._tiles[u]);return e?l.sort((u,m)=>{let p=u.tileID,b=m.tileID,v=new gt(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),S=new gt(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-b.overscaledZ||S.y-v.y||S.x-v.x}).map(u=>u.tileID.key):l.map(u=>u.tileID).sort(wk).map(u=>u.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,l){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(l||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=n),this._loadTile(l,this._tileLoaded.bind(this,l,e,n)))}_tileLoaded(e,n,l,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new dp(u,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new Ta("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Eo.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ta("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let u=0;u<n.length;u++){let m=n[u];if(e.neighboringTiles&&e.neighboringTiles[m]){let p=this.getTileByID(m);l(e,p),l(p,e)}}function l(u,m){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let p=m.tileID.canonical.x-u.tileID.canonical.x,b=m.tileID.canonical.y-u.tileID.canonical.y,v=Math.pow(2,u.tileID.canonical.z),S=m.tileID.key;p===0&&b===0||Math.abs(b)>1||(Math.abs(p)>1&&(Math.abs(p+v)===1?p+=v:Math.abs(p-v)===1&&(p-=v)),m.dem&&u.dem&&(u.dem.backfillBorder(m.dem,p,b),u.neighboringTiles&&u.neighboringTiles[S]&&(u.neighboringTiles[S].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,l,u){for(let m in this._tiles){let p=this._tiles[m];if(u[m]||!p.hasData()||p.tileID.overscaledZ<=n||p.tileID.overscaledZ>l)continue;let b=p.tileID;for(;p&&p.tileID.overscaledZ>n+1;){let S=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[S.key],p&&p.hasData()&&(b=S)}let v=b;for(;v.overscaledZ>n;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){u[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=n?l:null}for(let l=e.overscaledZ-1;l>=n;l--){let u=e.scaledTo(l),m=this._getLoadedTile(u);if(m)return m}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let l=Math.ceil(e.width/n)+1,u=Math.ceil(e.height/n)+1,m=Math.floor(l*u*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(b)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let l={};for(let u in this._tiles){let m=this._tiles[u];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),l[m.tileID.key]=m}this._tiles=l;for(let u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(let u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,n,l,u){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let m;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)m=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new Xr(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y));else if(this.tileCoverLift!==0){let v=e.clone();v.tileCoverLift=this.tileCoverLift,m=v.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(m.push(new Xr(1,0,1,0,0)),m.push(new Xr(1,0,1,1,0)),m.push(new Xr(1,0,1,0,1)),m.push(new Xr(1,0,1,1,1)))}else if(m=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let v=this._source.hasTile.bind(this._source);m=m.filter(S=>v(S))}}else m=[];if(m.length>0&&this.castsShadows&&u&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!hS(this._source.type)){let v=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!l}),S=Math.min(v,this._source.maxzoom),k=e.extendTileCoverForShadows(m,u,S);for(let D of k)this._shadowCasterTiles[D.key]=!0,m.push(D)}let p=this._updateRetainedTiles(m);if(hS(this._source.type)&&m.length!==0){let v={},S={},k=Object.keys(p);for(let A of k){let L=p[A],z=this._tiles[A];if(!z||z.fadeEndTime&&z.fadeEndTime<=Eo.now())continue;let V=this.findLoadedParent(L,Math.max(L.overscaledZ-xg.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),v[V.tileID.key]=V.tileID),S[A]=L}let D=m[m.length-1].overscaledZ;for(let A in this._tiles){let L=this._tiles[A];if(p[A]||!L.hasData())continue;let z=L.tileID;for(;z.overscaledZ>D;){z=z.scaledTo(z.overscaledZ-1);let V=this._tiles[z.key];if(V&&V.hasData()&&S[z.key]){p[A]=L.tileID;break}}}for(let A in v)p[A]||(this._coveredTiles[A]=!0,p[A]=v[A])}for(let v in p)this._tiles[v].clearFadeHold();let b=function(v,S){let k=[];for(let D in v)D in S||k.push(D);return k}(this._tiles,p);for(let v of b){let S=this._tiles[v];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let l={},u=e.reduce((S,k)=>Math.min(S,k.overscaledZ),1/0),m=e[0].overscaledZ,p=Math.max(m-xg.maxOverzooming,this._source.minzoom),b=Math.max(m+xg.maxUnderzooming,this._source.minzoom),v={};for(let S of e){let k=this._addTile(S);n[S.key]=S,k.hasData()||u<this._source.maxzoom&&(v[S.key]=S)}this._retainLoadedChildren(v,u,b,n);for(let S of e){let k=this._tiles[S.key];if(k.hasData())continue;if(S.canonical.z>=this._source.maxzoom){let A=S.children(this._source.maxzoom)[0],L=this.getTile(A);if(L&&L.hasData()){n[A.key]=A;continue}}else{let A=S.children(this._source.maxzoom);if(n[A[0].key]&&n[A[1].key]&&n[A[2].key]&&n[A[3].key])continue}let D=k.wasRequested();for(let A=S.overscaledZ-1;A>=p;--A){let L=S.scaledTo(A);if(l[L.key]||(l[L.key]=!0,k=this.getTile(L),!k&&D&&(k=this._addTile(L)),k&&(n[L.key]=L,D=k.wasRequested(),k.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}n.push(u.key);let m=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;u=m}for(let m of n)this._loadedParentTiles[m]=l}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let l=!!n;if(!l){let u=this.map?this.map.painter:null,m=this._source.tileSize*e.overscaleFactor();n=this._source.type==="raster-array"?new xk(e,m,this.transform.tileZoom,u,this._isRaster):new o1(e,m,this.transform.tileZoom,u,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,l||this._source.fire(new Ta("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let l=n.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,l){let u=[],m=this.transform;if(!m)return u;let p=m.projection.name==="globe",b=Ac(m.center.lng);for(let v in this._tiles){let S=this._tiles[v];if(l&&S.clearQueryDebugViz(),S.holdingForFade())continue;let k;if(p){let D=S.tileID.canonical;if(D.z===0){let A=[Math.abs(Ri(b,...yy(D,-1))-b),Math.abs(Ri(b,...yy(D,1))-b)];k=[0,2*A.indexOf(Math.min(...A))-1]}else{let A=[Math.abs(Ri(b,...yy(D,-1))-b),Math.abs(Ri(b,...yy(D,0))-b),Math.abs(Ri(b,...yy(D,1))-b)];k=[A.indexOf(Math.min(...A))-1]}}else k=[0];for(let D of k){let A=e.containsTile(S,m,n,D);A&&u.push(A)}}return u}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let l=this.getRenderableIds(e,n).map(m=>this._tiles[m].tileID),u=this.transform.projection.name==="globe";for(let m of l)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=u?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return l}sortCoordinatesByDistance(e){let n=e.slice(),l=this.transform._camera.position,u=this.transform._camera.forward(),m={};for(let p of n){let b=1/(1<<p.canonical.z);m[p.key]=((p.canonical.x+.5)*b+p.wrap-l[0])*u[0]+((p.canonical.y+.5)*b-l[1])*u[1]-l[2]*u[2]}return n.sort((p,b)=>m[p.key]-m[b.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(hS(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Eo.now())return!0}return!1}setFeatureState(e,n,l){this._state.updateState(e=e||"_geojsonTileLayer",n,l)}removeFeatureState(e,n,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,l)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,l){let u=this._tiles[e];u&&u.setDependencies(n,l)}reloadTilesForDependencies(e,n){for(let l in this._tiles)this._tiles[l].hasDependency(e,n)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(e,n))};return void this._source.on("data",b)}let l=new Map,u=Array.isArray(e)?e:[e],m=this.map.painter.terrain,p=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(let b of u){let v=b.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let S of v)l.set(S.key,S);this.usedForTerrain&&b.updateElevation(!1)}ps(Array.from(l.values()),(b,v)=>{let S=new o1(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,k=>{this._source.type==="raster-dem"&&S.dem&&this._backfillDEM(S),v(k,S)})},n)}}function wk(i,e){let n=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||l-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function hS(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function yy(i,e){let n=1<<i.z;return[i.x/n+e,(i.x+1)/n+e]}xg.maxOverzooming=10,xg.maxUnderzooming=3;let Ck=new class extends Lt{possiblyEvaluate(i,e){return e=new Vt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,n,l){return e=Mo({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,n,l)}}(jx.paint.properties["line-width"].specification);function Sk(i,e){return e>0?e+2*i:i}Ck.useIntegerZoom=!0;let HF=new vn({"symbol-placement":new dt(Ue.layout_symbol["symbol-placement"]),"symbol-spacing":new dt(Ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dt(Ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Lt(Ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dt(Ue.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new dt(Ue.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new dt(Ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new dt(Ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new dt(Ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dt(Ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new Lt(Ue.layout_symbol["icon-size"]),"icon-text-fit":new Lt(Ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Lt(Ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new Lt(Ue.layout_symbol["icon-image"]),"icon-rotate":new Lt(Ue.layout_symbol["icon-rotate"]),"icon-padding":new dt(Ue.layout_symbol["icon-padding"]),"icon-keep-upright":new dt(Ue.layout_symbol["icon-keep-upright"]),"icon-offset":new Lt(Ue.layout_symbol["icon-offset"]),"icon-anchor":new Lt(Ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dt(Ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dt(Ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dt(Ue.layout_symbol["text-rotation-alignment"]),"text-field":new Lt(Ue.layout_symbol["text-field"]),"text-font":new Lt(Ue.layout_symbol["text-font"]),"text-size":new Lt(Ue.layout_symbol["text-size"]),"text-max-width":new Lt(Ue.layout_symbol["text-max-width"]),"text-line-height":new Lt(Ue.layout_symbol["text-line-height"]),"text-letter-spacing":new Lt(Ue.layout_symbol["text-letter-spacing"]),"text-justify":new Lt(Ue.layout_symbol["text-justify"]),"text-radial-offset":new Lt(Ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dt(Ue.layout_symbol["text-variable-anchor"]),"text-anchor":new Lt(Ue.layout_symbol["text-anchor"]),"text-max-angle":new dt(Ue.layout_symbol["text-max-angle"]),"text-writing-mode":new dt(Ue.layout_symbol["text-writing-mode"]),"text-rotate":new Lt(Ue.layout_symbol["text-rotate"]),"text-padding":new dt(Ue.layout_symbol["text-padding"]),"text-keep-upright":new dt(Ue.layout_symbol["text-keep-upright"]),"text-transform":new Lt(Ue.layout_symbol["text-transform"]),"text-offset":new Lt(Ue.layout_symbol["text-offset"]),"text-allow-overlap":new dt(Ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new dt(Ue.layout_symbol["text-ignore-placement"]),"text-optional":new dt(Ue.layout_symbol["text-optional"]),visibility:new dt(Ue.layout_symbol.visibility)});var mS={paint:new vn({"icon-opacity":new Lt(Ue.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Lt(Ue.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Lt(Ue.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Lt(Ue.paint_symbol["text-emissive-strength"]),"icon-color":new Lt(Ue.paint_symbol["icon-color"]),"icon-halo-color":new Lt(Ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new Lt(Ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Lt(Ue.paint_symbol["icon-halo-blur"]),"icon-translate":new dt(Ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new dt(Ue.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Lt(Ue.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Lt(Ue.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Lt(Ue.paint_symbol["text-occlusion-opacity"]),"text-color":new Lt(Ue.paint_symbol["text-color"],{runtimeType:oa,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Lt(Ue.paint_symbol["text-halo-color"]),"text-halo-width":new Lt(Ue.paint_symbol["text-halo-width"]),"text-halo-blur":new Lt(Ue.paint_symbol["text-halo-blur"]),"text-translate":new dt(Ue.paint_symbol["text-translate"]),"text-translate-anchor":new dt(Ue.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new dt(Ue.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new dt(Ue.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new dt(Ue.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new dt(Ue.paint_symbol["icon-color-brightness-max"])}),layout:HF};class Ik{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:wu,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}de(Ik,"FormatSectionOverride",{omit:["defaultValue"]});class a1 extends eo{constructor(e,n,l,u){super(e,mS,n,l,u),this._colorAdjustmentMatrix=t.ad.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let l=this.layout.get("text-writing-mode");if(l){let u=[];for(let m of l)u.indexOf(m)<0&&u.push(m);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,l,u){return this._saturation===e&&this._contrast===n&&this._brightnessMin===l&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(m,p,b,v){m=uu(m),p=zh(p);let S=t.ad.create(),k=m/3,D=1-2*k,A=[D,k,k,0,k,D,k,0,k,k,D,0,0,0,0,1],L=.5-.5*p,z=v-b;return t.ad.multiply(S,[z,0,0,0,0,z,0,0,0,0,z,0,b,b,b,1],[p,0,0,0,0,p,0,0,0,0,p,0,L,L,L,1]),t.ad.multiply(S,S,A),S}(e,n,l,u),this._saturation=e,this._contrast=n,this._brightnessMin=l,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,l,u){let m=this.layout.get(e).evaluate(n,{},l,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||j(p.value)||!m?m:function(b,v){return v.replace(/{([^{}]+)}/g,(S,k)=>k in b?String(b[k]):"")}(n.properties,m)}createBucket(e){return new n0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of mS.paint.overridableProperties){if(!a1.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),l=new Ik(n),u=new B(l,n.property.specification,this.scope,this.options),m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new q("source",u):new K("composite",u,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new on(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&a1.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let l=e.get("text-field"),u=mS.paint.properties[n],m=!1,p=b=>{for(let v of b)if(u.overrides&&u.overrides.hasOverride(v))return void(m=!0)};if(l.value.kind==="constant"&&l.value.value instanceof co)p(l.value.value.sections);else if(l.value.kind==="source"){let b=S=>{m||(S instanceof Wl&&kr(S.value)===Su?p(S.value.sections):S instanceof wc?p(S.sections):S.eachChild(b))},v=l.value;v._styleExpression&&b(v._styleExpression.expression)}return m}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,l=[];return e&&l.push("symbolIcon"),n&&l.push("symbolSDF"),l}getDefaultProgramParams(e,n,l){return{config:new Gu(this,{zoom:n,lut:l}),overrideFog:!1}}}let GF=new vn({visibility:new dt(Ue.layout_background.visibility)});var qF={paint:new vn({"background-color":new dt(Ue.paint_background["background-color"]),"background-pattern":new dt(Ue.paint_background["background-pattern"]),"background-opacity":new dt(Ue.paint_background["background-opacity"]),"background-emissive-strength":new dt(Ue.paint_background["background-emissive-strength"])}),layout:GF};let $F=new vn({visibility:new dt(Ue.layout_raster.visibility)});var YF={paint:new vn({"raster-opacity":new dt(Ue.paint_raster["raster-opacity"]),"raster-color":new Sr(Ue.paint_raster["raster-color"]),"raster-color-mix":new dt(Ue.paint_raster["raster-color-mix"]),"raster-color-range":new dt(Ue.paint_raster["raster-color-range"]),"raster-hue-rotate":new dt(Ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dt(Ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dt(Ue.paint_raster["raster-brightness-max"]),"raster-saturation":new dt(Ue.paint_raster["raster-saturation"]),"raster-contrast":new dt(Ue.paint_raster["raster-contrast"]),"raster-resampling":new dt(Ue.paint_raster["raster-resampling"]),"raster-fade-duration":new dt(Ue.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new dt(Ue.paint_raster["raster-emissive-strength"]),"raster-array-band":new dt(Ue.paint_raster["raster-array-band"]),"raster-elevation":new dt(Ue.paint_raster["raster-elevation"])}),layout:$F};function s1(i,e,n,l,u,m,p,b){let v=[i,e,1,n,l,1,u,m,1],S=[p,b,1],k=t.bC.adjoint([],v),[D,A,L]=t._.transformMat3(S,S,k);return t.bC.multiply(v,v,[D,0,0,0,A,0,0,0,L])}function Tk(i,e,n,l,u,m,p,b){let v=function(S,k,D,A,L,z,V,H){let Y=s1(0,0,1,0,1,1,0,1),ne=s1(S,k,D,A,L,z,V,H),re=t.bC.adjoint([],Y);return t.bC.multiply(ne,ne,re)}(i,e,n,l,u,m,p,b);return[v[2]/v[8]/At,v[5]/v[8]/At]}function l1(i){return[i[0],Math.min(Math.max(i[1],-Dr),Dr)]}class Mk extends md{constructor(e,n,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Ta("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Uo(this.map._requestManager.transformRequest(this.url,op.Image),(l,u)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new dp(l)):u&&(this.image=u instanceof HTMLImageElement?Eo.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new i1(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ta("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof i1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],l=e[0][1];for(let m of e)m[1]>l&&(l=m[1]),m[1]<n&&(n=m[1]);let u=(l+n)/2;if(u>Dr?this.onNorthPole=!0:u<-Dr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let m=e.map(la.fromLngLat);this.tileID=function(p){let b=1/0,v=1/0,S=-1/0,k=-1/0;for(let V of p)b=Math.min(b,V.x),v=Math.min(v,V.y),S=Math.max(S,V.x),k=Math.max(k,V.y);let D=Math.max(S-b,k-v),A=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),L=Math.pow(2,A),z=Math.floor((b+S)/2*L);return z>1&&(z-=1),new xm(A,z,Math.floor((v+k)/2*L))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ta("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let H in this.tiles){let Y=this.tiles[H];Y.state!=="loaded"&&(Y.state="loaded",Y.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=vg(new xm(0,0,0),this.map.transform.projection),l=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(H){let Y=H[1].x-H[0].x,ne=H[1].y-H[0].y,re=H[2].x-H[1].x,oe=H[2].y-H[1].y,xe=H[3].x-H[2].x,be=H[3].y-H[2].y,ke=H[0].x-H[3].x,Ae=H[0].y-H[3].y,je=Y*oe-re*ne,Qe=re*be-xe*oe,$e=xe*Ae-ke*be,st=ke*ne-Y*Ae;return je>0&&Qe>0&&$e>0&&st>0||je<0&&Qe<0&&$e<0&&st<0}(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let u=vg(this.tileID,this.map.transform.projection),[m,p,b,v]=this.coordinates.map(H=>{let Y=u.projection.project(H[0],H[1]);return ak(u,Y)._round()});this.perspectiveTransform=Tk(m.x,m.y,p.x,p.y,b.x,b.y,v.x,v.y);let S=this._boundsArray=new Da;S.emplaceBack(m.x,m.y,0,0),S.emplaceBack(p.x,p.y,At,0),S.emplaceBack(v.x,v.y,0,At),S.emplaceBack(b.x,b.y,At,At),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(S,r1.members),this.boundsSegments=Ir.simpleSegment(0,0,4,2);let k=[],D=function(H){return[l1(H[0]),l1(H[1]),l1(H[2]),l1(H[3])]}(this.coordinates),[A,L,z,V]=function(H){let Y=H[0][0],ne=Y,re=H[0][1],oe=re;for(let xe=1;xe<H.length;xe++)H[xe][0]<Y?Y=H[xe][0]:H[xe][0]>ne&&(ne=H[xe][0]),H[xe][1]<re?re=H[xe][1]:H[xe][1]>oe&&(oe=H[xe][1]);return[Y,re,ne-Y,oe-re]}(D);{let H=new Da,[Y,ne,re,oe]=function(tt){let mt=tt[0].x,Ct=mt,ft=tt[0].y,Ht=ft;for(let xt=1;xt<tt.length;xt++)tt[xt].x<mt?mt=tt[xt].x:tt[xt].x>Ct&&(Ct=tt[xt].x),tt[xt].y<ft?ft=tt[xt].y:tt[xt].y>Ht&&(Ht=tt[xt].y);return[mt,ft,Ct-mt,Ht-ft]}(l),xe=tt=>[(tt.x-Y)/re,(tt.y-ne)/oe],[be,ke,Ae,je]=l.map(xe),Qe=function(tt,mt,Ct,ft,Ht,xt,Mt,oi){let ti=s1(0,0,1,0,1,1,0,1),Jt=s1(tt,mt,Ct,ft,Ht,xt,Mt,oi),Tt=t.bC.adjoint([],Jt);return t.bC.multiply(ti,ti,Tt)}(be[0],be[1],ke[0],ke[1],Ae[0],Ae[1],je[0],je[1]);this.elevatedGlobePerspectiveTransform=Tk(be[0],be[1],ke[0],ke[1],Ae[0],Ae[1],je[0],je[1]);let $e=(tt,mt)=>{k.push(tt.lng);let Ct=Math.round((tt.lng-A)/z*At),ft=Math.round((tt.lat-L)/V*At),Ht=xe(mt),xt=t._.transformMat3([],[Ht[0],Ht[1],1],Qe),Mt=Math.round(xt[0]/xt[2]*At),oi=Math.round(xt[1]/xt[2]*At);H.emplaceBack(Ct,ft,Mt,oi)},st=l[3].x-l[0].x,vt=l[3].y-l[0].y,at=l[2].x-l[1].x,ht=l[2].y-l[1].y;for(let tt=0;tt<65;tt++){let mt=tt/64,Ct=[l[0].x+mt*st,l[0].y+mt*vt],ft=[l[1].x+mt*at,l[1].y+mt*ht],Ht=ft[0]-Ct[0],xt=ft[1]-Ct[1];for(let Mt=0;Mt<65;Mt++){let oi=Mt/64,ti={x:Ct[0]+Ht*oi,y:Ct[1]+xt*oi,z:0};$e(n.projection.unproject(ti.x,ti.y),ti)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(H,r1.members)}{this.maxLongitudeTriangleSize=0;let H=[],Y=new xo,ne=(re,oe,xe)=>{Y.emplaceBack(re,oe,xe);let be=k[re],ke=k[oe],Ae=k[xe],je=Math.min(Math.min(be,ke),Ae),Qe=Math.max(Math.max(be,ke),Ae)-je;Qe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Qe),H.push(je+Qe/2)};for(let re=0;re<64;re++)for(let oe=0;oe<64;oe++){let xe=65*re+oe,be=xe+1,ke=xe+65,Ae=ke+1;ne(xe,ke,be),ne(be,ke,Ae)}[H,Y]=function(re,oe){let xe=Array.from({length:re.length},(Ae,je)=>je);xe.sort((Ae,je)=>re[Ae]-re[je]);let be=[],ke=new xo;for(let Ae=0;Ae<xe.length;Ae++){let je=xe[Ae];be.push(re[je]);let Qe=3*je,$e=Qe+1;ke.emplaceBack(oe.uint16[Qe],oe.uint16[$e],oe.uint16[$e+1])}return[be,ke]}(H,Y),this.elevatedGlobeTrianglesCenterLongitudes=H,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Y)}this.elevatedGlobeSegments=Ir.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,z/At,0,V/At,0,0,L,A,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,l=n.gl;!this._dirty||this.texture instanceof i1||(this.texture?this.texture.update(this.image):(this.texture=new Bc(n,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let l=this.elevatedGlobeTrianglesCenterLongitudes,u=(m=e+180)+360*Math.round((l[0]-m)/360);var m;let p=new Ir,b=(D,A)=>{p.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:n.segments[0].vertexLength,primitiveLength:A,sortKey:void 0,vaos:{}})},v=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-u)<=v){let D=Mf(l,0,l.length,u+v);return D===l.length||b(D,Tf(l,D+1,l.length,u+360-v)-D),p}u<l[0]&&(u+=360);let S=Tf(l,0,l.length,u-v);if(S===l.length)return b(0,l.length),p;b(0,S-0);let k=Mf(l,S+1,l.length,u+v);return k!==l.length&&b(k,l.length-k),p}}let ZF=(Math.pow(256,2)-1)/16907520;class kk extends eo{constructor(e,n,l,u){super(e,YF,n,l,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Mk&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[l,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(u)||l===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=dg({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,u])}}let XF=new vn({visibility:new dt(Ue["layout_raster-particle"].visibility)});var QF={paint:new vn({"raster-particle-array-band":new dt(Ue["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new dt(Ue["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Sr(Ue["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new dt(Ue["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new dt(Ue["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new dt(Ue["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new dt(Ue["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:XF};class Ek extends eo{constructor(e,n,l,u){super(e,QF,n,l,u),this._updateColorRamp(),this.lastInvalidatedAt=Eo.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=dg({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Eo.now()}}class KF extends eo{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let JF=new vn({visibility:new dt(Ue.layout_sky.visibility)});var eL={paint:new vn({"sky-type":new dt(Ue.paint_sky["sky-type"]),"sky-atmosphere-sun":new dt(Ue.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new dt(Ue.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new dt(Ue.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new dt(Ue.paint_sky["sky-gradient-radius"]),"sky-gradient":new Sr(Ue.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new dt(Ue.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new dt(Ue.paint_sky["sky-atmosphere-color"]),"sky-opacity":new dt(Ue.paint_sky["sky-opacity"])}),layout:JF};function pS(i,e,n){let l=[0,0,1],u=t.av.identity([]);return t.av.rotateY(u,u,n?-tn(i)+Math.PI:tn(i)),t.av.rotateX(u,u,-tn(e)),t._.transformQuat(l,l,u),t._.normalize(l,l)}var tL={paint:new vn({})};function Dk(i,e){let n=c1(i.projection,i.zoom,i.width,i.height),l=function(m,p,b,v,S){let k=new un(b.lng-180*Hp,b.lat),D=new un(b.lng+180*Hp,b.lat),A=m.project(k.lng,k.lat),L=m.project(D.lng,D.lat),z=-Math.atan2(L.y-A.y,L.x-A.x),V=la.fromLngLat(b);V.y=Ri(V.y,-1+Hp,1-Hp);let H=V.toLngLat(),Y=m.project(H.lng,H.lat),ne=la.fromLngLat(H);ne.x+=Hp;let re=ne.toLngLat(),oe=m.project(re.lng,re.lat),xe=Ok(oe.x-Y.x,oe.y-Y.y,z),be=la.fromLngLat(H);be.y+=Hp;let ke=be.toLngLat(),Ae=m.project(ke.lng,ke.lat),je=Ok(Ae.x-Y.x,Ae.y-Y.y,z),Qe=Math.abs(xe.x)/Math.abs(je.y),$e=t.ad.identity([]);t.ad.rotateZ($e,$e,-z*(1-(S?0:v)));let st=t.ad.identity([]);return t.ad.scale(st,st,[1,1-(1-Qe)*v,1]),st[4]=-je.x/je.y*v,t.ad.rotateZ(st,st,z),t.ad.multiply(st,$e,st),st}(i.projection,0,i.center,n,e),u=Ak(i);return t.ad.scale(l,l,[u,u,1]),l}function Ak(i){let e=i.projection,n=c1(i.projection,i.zoom,i.width,i.height),l=Pk(e,i.center),u=Pk(e,un.convert(e.center));return Math.pow(2,l*n+(1-n)*u)}function c1(i,e,n,l,u=1/0){let m=i.range;if(!m)return 0;let p=Math.min(u,Math.max(n,l)),b=Math.log(p/1024)/Math.LN2;return $r(m[0]+b,m[1]+b,e)}let Hp=1/4e4;function Pk(i,e){let n=Ri(e.lat,-Dr,Dr),l=new un(e.lng-180*Hp,n),u=new un(e.lng+180*Hp,n),m=i.project(l.lng,n),p=i.project(u.lng,n),b=la.fromLngLat(l),v=la.fromLngLat(u),S=p.x-m.x,k=p.y-m.y,D=v.x-b.x,A=v.y-b.y,L=Math.sqrt((D*D+A*A)/(S*S+k*k));return Math.log(L)/Math.LN2}function Ok(i,e,n){let l=Math.cos(n),u=Math.sin(n);return{x:i*l-e*u,y:i*u+e*l}}function Rk(i,e,n){t.ad.identity(i),t.ad.rotateZ(i,i,tn(e[2])),t.ad.rotateX(i,i,tn(e[0])),t.ad.rotateY(i,i,tn(e[1])),t.ad.scale(i,i,n),t.ad.multiply(i,i,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function d1(i,e,n,l,u,m,p,b){let v=[n[0]-e[0],n[1]-e[1],0],S=[l[0]-e[0],l[1]-e[1],0];if(t._.length(v)<1e-12||t._.length(S)<1e-12)return t.av.identity(i);let k=t._.cross([],v,S);t._.normalize(k,k),t._.subtract(S,l,e),v[2]=(m-u)*b,S[2]=(p-u)*b;let D=v;return t._.cross(D,v,S),t._.normalize(D,D),t.av.rotationTo(i,k,D)}function fS(i,e,n=!1){let l=Ad(e.zoom),u=function(m,p,b){let v=p.worldSize,S=[m[12],m[13],m[14]],k=$o(S[1]/v),D=ts(S[0]/v),A=t.ad.identity([]),L=ja(1,k)*v,z=ja(1,0)*v*$u(k,p.zoom),V=1/Xb(v),H=z*V;if(b){let oe=c1(p.projection,p.zoom,p.width,p.height,1024);H=V*p.projection.pixelSpaceConversion(p.center.lat,v,oe)}let Y=vm(k,D);t._.add(Y,Y,t._.scale([],t._.normalize([],Y),L*H*S[2]));let ne=function(oe){let xe=[oe[0],oe[1],oe[2]],be=[0,1,0],ke=t._.cross([],be,xe);return t._.cross(be,xe,ke),t._.squaredLength(be)===0&&(be=[0,1,0],t._.cross(ke,xe,be)),t._.normalize(ke,ke),t._.normalize(be,be),t._.normalize(xe,xe),[ke[0],ke[1],ke[2],0,be[0],be[1],be[2],0,xe[0],xe[1],xe[2],0,oe[0],oe[1],oe[2],1]}(Y);t.ad.scale(A,A,[H,H,H*L]),t.ad.translate(A,A,[-S[0],-S[1],-S[2]]);let re=t.ad.multiply([],p.globeMatrix,ne);return t.ad.multiply(re,re,A),t.ad.multiply(re,re,m),re}(i,e,n);if(l>0){let m=function(p,b){let v=b.worldSize,S=ja(1,0)*v*$u(b.center.lat,b.zoom)/Xb(v),k=ja(1,b.center.lat)*v,D=t.ad.identity([]);return t.ad.rotateY(D,D,tn(b.center.lng)),t.ad.rotateX(D,D,tn(b.center.lat)),t.ad.translate(D,D,[0,0,Va]),t.ad.scale(D,D,[S,S,S*k]),t.ad.translate(D,D,[b.point.x-.5*v,b.point.y-.5*v,0]),t.ad.multiply(D,D,p),t.ad.multiply(D,b.globeMatrix,D)}(i,e);return function(p,b,v){let S=(z,V,H)=>{let Y=t._.length(z),ne=t._.length(V),re=Dd(z,V,H);return t._.scale(re,re,1/t._.length(re)*ri(Y,ne,H))},k=S([p[0],p[1],p[2]],[b[0],b[1],b[2]],v),D=S([p[4],p[5],p[6]],[b[4],b[5],b[6]],v),A=S([p[8],p[9],p[10]],[b[8],b[9],b[10]],v),L=Dd([p[12],p[13],p[14]],[b[12],b[13],b[14]],v);return[k[0],k[1],k[2],0,D[0],D[1],D[2],0,A[0],A[1],A[2],0,L[0],L[1],L[2],1]}(u,m,l)}return u}function Fk(i,e,n,l){let u=dr.projectAabbCorners(l,n),m=Number.MAX_VALUE,p=-1;for(let S=0;S<u.length;++S){let k=u[S];k[0]=(.5*k[0]+.5)*e.width,k[1]=(.5-.5*k[1])*e.height,k[2]<m&&(p=S,m=k[2])}let b=S=>new gt(u[S][0],u[S][1]),v;switch(p){case 0:case 6:v=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:v=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:v=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:v=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(Vb(i,v))return m}let iL=xn([{name:"a_pos_3f",components:3,type:"Float32"}]),nL=xn([{name:"a_color_3f",components:3,type:"Float32"}]),rL=xn([{name:"a_color_4f",components:4,type:"Float32"}]),oL=xn([{name:"a_uv_2f",components:2,type:"Float32"}]),aL=xn([{name:"a_normal_3f",components:3,type:"Float32"}]),sL=xn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),lL=xn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class u1{constructor(e,n,l,u){this.message=(e?`${e}: `:"")+l,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function Lk(i,e){let n=i.indexOf("://")===-1;try{return new URL(i,n&&e?"http://example.com":void 0),!0}catch{return!1}}class zk{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Bk{constructor(){this.instancedDataArray=new Sb,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class gS{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,l,u){this.tileToMeter=Op(l);let m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:b,index:v,sourceLayerIndex:S}of e){let k=b??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),D=Ed(p,m);if(!this.layers[0]._featureFilter.filter(new Vt(this.zoom),D,l))continue;let A={id:k,sourceLayerIndex:S,index:v,geometry:m?D.geometry:xs(p,l,u),properties:p.properties,type:p.type,patterns:{}},L=this.addFeature(A,A.geometry,D);L&&n.featureIndex.insert(p,A.geometry,v,S,this.index,this.instancesPerModel[L].instancedDataArray.length,At/32)}this.lookup=null}update(e,n,l,u){for(let m in this.instancesPerModel){let p=this.instancesPerModel[m];for(let b in e)p.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(p.features[p.idToFeaturesIndex[b]],e[b],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let l=this.instancesPerModel[n];for(let u of l.features){let m=this.layers[0],p=u.feature,b=this.canonical,v=m.paint.get("model-rotation").evaluate(p,{},b),S=m.paint.get("model-scale").evaluate(p,{},b),k=m.paint.get("model-translation").evaluate(p,{},b);t._.exactEquals(u.rotation,v)&&t._.exactEquals(u.scale,S)&&t._.exactEquals(u.translation,k)||(this.evaluate(u,u.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,n,l){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let u=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(sy(this.activeReplacements,u))return!1;this.activeReplacements=u;let m=!1;for(let p in this.instancesPerModel){let b=this.instancesPerModel[p],v=b.instancedDataArray;for(let S of b.features){let k=S.instancedDataOffset,D=S.instancedDataCount;for(let A=0;A<D;A++){let L=16*(A+k),z=v.float32[L+0];z=z>At?z-At:z;let V=Math.floor(z),H=v.float32[L+1],Y=!1;for(let ne of this.activeReplacements)if(!(ne.order<l||ne.order===1/0)&&ne.clipMask&G_.Model&&!(ne.min.x>V||V>ne.max.x||ne.min.y>H||H>ne.max.y)&&(Y=Sx(Cx(V,H,e.canonical,ne.footprintTileId.canonical),ne),Y))break;v.float32[L]=Y?z+At:z,m=m||Y}}}return m}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let l=this.instancesPerModel[n];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,sL.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let l=this.instancesPerModel[n];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,l){let u=this.layers[0],m=u.layout.get("model-id").evaluate(l,{},this.canonical);if(!m)return Vr(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),m;Lk(m,!1)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new Bk);let p=this.instancesPerModel[m],b=p.instancedDataArray,v=new zk(l,b.length);for(let S of n)for(let k of S){if(k.x<0||k.x>=At||k.y<0||k.y>=At)continue;let D=(this.lookupDim-1)/At,A=this.lookupDim*(k.y*D|0)+k.x*D|0;if(this.lookup){if(this.lookup[A]!==0)continue;this.lookup[A]=1}this.instanceCount++;let L=b.length;b.resize(L+1),p.instancesEvaluatedElevation.push(0),b.float32[16*L]=k.x,b.float32[16*L+1]=k.y}return v.instancedDataCount=p.instancedDataArray.length-v.instancedDataOffset,v.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(v),this.evaluate(v,{},p,!1)),m}getModelUris(){return this.modelUris}evaluate(e,n,l,u){let m=this.layers[0],p=e.feature,b=this.canonical,v=e.rotation=m.paint.get("model-rotation").evaluate(p,n,b),S=e.scale=m.paint.get("model-scale").evaluate(p,n,b),k=e.translation=m.paint.get("model-translation").evaluate(p,n,b),D=m.paint.get("model-color").evaluate(p,n,b);D.a=m.paint.get("model-color-mix-intensity").evaluate(p,n,b);let A=[];this.maxVerticalOffset<k[2]&&(this.maxVerticalOffset=k[2]),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),Rk(A,v,S);let L=Math.round(100*D.a)+D.b/1.05;for(let z=0;z<e.instancedDataCount;++z){let V=e.instancedDataOffset+z,H=16*V,Y=l.instancedDataArray.float32,ne=0;u&&(ne=Y[H+6]-l.instancesEvaluatedElevation[V]);let re=0|Y[H+1];Y[H]=(0|Y[H])+D.r/1.05,Y[H+1]=re+D.g/1.05,Y[H+2]=L,Y[H+3]=1/(b.z>10?this.tileToMeter:Op(b,re)),Y[H+4]=k[0],Y[H+5]=k[1],Y[H+6]=k[2]+ne,Y[H+7]=A[0],Y[H+8]=A[1],Y[H+9]=A[2],Y[H+10]=A[4],Y[H+11]=A[5],Y[H+12]=A[6],Y[H+13]=A[8],Y[H+14]=A[9],Y[H+15]=A[10],l.instancesEvaluatedElevation[V]=k[2]}}}de(gS,"ModelBucket",{omit:["layers"]}),de(Bk,"PerModelAttributes"),de(zk,"ModelFeature");let cL=new vn({visibility:new dt(Ue.layout_model.visibility),"model-id":new Lt(Ue.layout_model["model-id"])});var dL={paint:new vn({"model-opacity":new dt(Ue.paint_model["model-opacity"]),"model-rotation":new Lt(Ue.paint_model["model-rotation"]),"model-scale":new Lt(Ue.paint_model["model-scale"]),"model-translation":new Lt(Ue.paint_model["model-translation"]),"model-color":new Lt(Ue.paint_model["model-color"]),"model-color-mix-intensity":new Lt(Ue.paint_model["model-color-mix-intensity"]),"model-type":new dt(Ue.paint_model["model-type"]),"model-cast-shadows":new dt(Ue.paint_model["model-cast-shadows"]),"model-receive-shadows":new dt(Ue.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new dt(Ue.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Lt(Ue.paint_model["model-emissive-strength"]),"model-roughness":new Lt(Ue.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Lt(Ue.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new dt(Ue.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new dt(Ue.paint_model["model-front-cutoff"])}),layout:cL};let wg=64,a0={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Nk(i,e,n,l,u,m,p,b,v,S=!1){let k=n.zoom,D=n.project(l),A=$u(l.lat,k),L=1/A;t.ad.identity(i),t.ad.translate(i,i,[D.x+p[0]*L,D.y+p[1]*L,p[2]]);let z=1,V=1,H=n.worldSize;if(S){if(n.projection.name==="mercator"){let oe=0;n.elevation&&(oe=n.elevation.getAtPointOrZero(new la(D.x/H,D.y/H),0));let xe=t.aA.transformMat4([],[D.x,D.y,oe,1],n.projMatrix)[3]/n.cameraToCenterDistance;z=xe,V=xe*$u(n.center.lat,k)}else if(n.projection.name==="globe"){let oe=fS(i,n),xe=t.ad.multiply([],n.projMatrix,oe),be=[0,0,0,1];t.aA.transformMat4(be,be,xe);let ke=be[3]/n.cameraToCenterDistance,Ae=Ad(k),je=n.projection.pixelsPerMeter(l.lat,H)*$u(l.lat,k),Qe=n.projection.pixelsPerMeter(n.center.lat,H)*$u(n.center.lat,k);z=ke/ri(je,Nv(n.center.lat),Ae),V=ke*A/je,z*=Qe,V*=Qe}}else z=L;t.ad.scale(i,i,[z,z,V]);let Y=[...i],ne=e.orientation,re=[];if(Rk(re,[ne[0]+u[0],ne[1]+u[1],ne[2]+u[2]],m),t.ad.multiply(i,Y,re),b&&n.elevation){let oe=0,xe=[];if(v&&n.elevation){oe=function(Ae,je,Qe,$e,st){let vt=je.elevation;if(!vt)return 0;let at=dr.projectAabbCorners(Qe,$e),ht=ja(1,st.lat)*je.worldSize,tt=function(li,Ei){let gi=[0,0,1],Li=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Di of Li){let Xi=li[Di.corners[0]],mi=li[Di.corners[1]],qn=li[Di.corners[2]],Wn=[mi[0]-Xi[0],mi[1]-Xi[1],Ei*(mi[2]-Xi[2])],In=t._.cross(Wn,Wn,[qn[0]-Xi[0],qn[1]-Xi[1],Ei*(qn[2]-Xi[2])]);t._.normalize(In,In),Di.dotProductWithUp=t._.dot(In,gi)}return Li.sort((Di,Xi)=>Di.dotProductWithUp-Xi.dotProductWithUp),Li[0].corners}(at,ht),mt=at[tt[0]],Ct=at[tt[1]],ft=at[tt[2]],Ht=at[tt[3]],xt=vt.getAtPointOrZero(new la(mt[0]/je.worldSize,mt[1]/je.worldSize),0),Mt=vt.getAtPointOrZero(new la(Ct[0]/je.worldSize,Ct[1]/je.worldSize),0),oi=vt.getAtPointOrZero(new la(ft[0]/je.worldSize,ft[1]/je.worldSize),0),ti=vt.getAtPointOrZero(new la(Ht[0]/je.worldSize,Ht[1]/je.worldSize),0),Jt=(xt+ti)/2,Tt=(Mt+oi)/2;return Jt>Tt?Mt<oi?d1(Ae,Ct,Ht,mt,Mt,ti,xt,ht):d1(Ae,ft,mt,Ht,oi,xt,ti,ht):xt<ti?d1(Ae,mt,Ct,ft,xt,Mt,oi,ht):d1(Ae,Ht,ft,Ct,ti,oi,Mt,ht),Math.max(Jt,Tt)}(xe,n,e.aabb,i,l);let be=t.ad.fromQuat([],xe),ke=t.ad.multiply([],be,re);t.ad.multiply(i,Y,ke)}else oe=n.elevation.getAtPointOrZero(new la(D.x/H,D.y/H),0);oe!==0&&(i[14]+=oe)}}function vy(i,e,n=!1){i.uploaded||(i.gfxTexture=new Bc(e,i.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:i.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),i.uploaded=!0,i.image=null)}function uL(i,e,n){i.indexBuffer=e.createIndexBuffer(i.indexArray,!1,!0),i.vertexBuffer=e.createVertexBuffer(i.vertexArray,iL.members,!1,!0),i.normalArray&&(i.normalBuffer=e.createVertexBuffer(i.normalArray,aL.members,!1,!0)),i.texcoordArray&&(i.texcoordBuffer=e.createVertexBuffer(i.texcoordArray,oL.members,!1,!0)),i.colorArray&&(i.colorBuffer=e.createVertexBuffer(i.colorArray,(i.colorArray.bytesPerElement===12?nL:rL).members,!1,!0)),i.featureArray&&(i.pbrBuffer=e.createVertexBuffer(i.featureArray,lL.members,!0)),i.segments=Ir.simpleSegment(0,0,i.vertexArray.length,i.indexArray.length);let l=i.material;l.pbrMetallicRoughness.baseColorTexture&&vy(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&vy(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&vy(l.normalTexture,e),l.occlusionTexture&&vy(l.occlusionTexture,e,n),l.emissionTexture&&vy(l.emissionTexture,e)}function _S(i,e,n){if(i.meshes)for(let l of i.meshes)uL(l,e,n);if(i.children)for(let l of i.children)_S(l,e,n)}function h1(i){if(i.meshes)for(let e of i.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(i.children)for(let e of i.children)h1(e)}function bS(i){if(i.meshes)for(let n of i.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(i.children)for(let n of i.children)bS(n)}class hL{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class mL{constructor(){this.tasks={},this.taskQueue=[],Ph(["process"],this),this.invoker=new hL(this.process),this.nextId=0}add(e,n){let l=this.nextId++,u=function({type:m,isSymbolTile:p,zoom:b}){return b=b||0,m==="message"?0:m!=="maybePrepare"||p?m!=="parseTile"||p?m==="parseTile"&&p?300-b:m==="maybePrepare"&&p?400-b:500:200-b:100-b}(n);if(u===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:n,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){let m=this.tasks[this.taskQueue[u]];m.priority<n&&(n=m.priority,e=u)}if(e===null)return null;let l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class Vk{constructor(e,n,l){this.target=e,this.parent=n,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Ph(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new mL}send(e,n,l,u,m=!1,p){let b=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=p,this.callbacks[b]=l);let v=new Set;return this.target.postMessage({id:b,type:e,hasCallback:!!l,targetMapId:u,mustQueue:m,sourceMapId:this.mapId,data:Ee(n,v)},v),{cancel:()=>{l&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){let n=e.data,l=n.id;if(l&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(n.mustQueue||Cn()){let u=this.callbacks[l],m=this.scheduler.add(()=>this.processTask(l,n),u&&u.metadata||{type:"message"});m&&(this.cancelCallbacks[l]=m)}else this.processTask(l,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let l=this.callbacks[e];delete this.callbacks[e],l&&(n.error?l(We(n.error)):l(null,We(n.data)))}else{let l=new Set,u=n.hasCallback?(p,b)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?Ee(p):null,data:Ee(b,l)},l)}:p=>{},m=We(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,m,u);else if(this.parent.getWorkerSource){let p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],m.source,m.scope)[p[1]](m,u)}else u(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let yS=(()=>{class i{constructor(n,l){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Dh();let u=this.workerPool.acquire(this.id);for(let m=0;m<u.length;m++){let p=new i.Actor(u[m],l,this.id);p.name=`Worker ${m}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,l,u){ps(this.actors,(m,p)=>{m.send(n,l,p)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return i.Actor=Vk,i})();var xy={workerUrl:"",workerClass:null,workerParams:void 0};function pL(){return xy.workerClass!=null?new xy.workerClass:new self.Worker(xy.workerUrl,xy.workerParams)}let vS="mapboxgl_preloaded_worker_pool";class wy{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<wy.workerCount;)this.workers.push(new pL);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[vS]}numActive(){return Object.keys(this.active).length}}let Cy;function m1(){return Cy||(Cy=new wy),Cy}wy.workerCount=2;let p1,xS,Vd,s0,wS,l0=null;function jk(){return Cn()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:xS||M.DRACO_URL}function Uk(){if(Cn()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(s0)return s0;let i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return s0=WebAssembly.validate(i)?M.MESHOPT_SIMD_URL:M.MESHOPT_URL,s0}let f1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},fL={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Sy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Wk(i,e,n){let l=n.json.bufferViews.length,u=n.buffers.length;e.bufferView=l,n.json.bufferViews[l]={buffer:u,byteLength:i.byteLength},n.buffers[u]=i}let CS="KHR_draco_mesh_compression";function gL(i,e){let n=i.extensions&&i.extensions[CS];if(!n)return;let l=new Vd.Decoder,u=$k(e,n.bufferView),m=new Vd.Mesh;if(!l.DecodeArrayToMesh(u,u.byteLength,m))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[i.indices],b=f1[p.componentType],v=p.count*b.BYTES_PER_ELEMENT,S=Vd._malloc(v);b===Uint16Array?l.GetTrianglesUInt16Array(m,v,S):l.GetTrianglesUInt32Array(m,v,S),Wk(Vd.memory.buffer.slice(S,S+v),p,e),Vd._free(S);for(let k of Object.keys(n.attributes)){let D=l.GetAttributeByUniqueId(m,n.attributes[k]),A=e.json.accessors[i.attributes[k]],L=fL[A.componentType],z=A.count*Sy[A.type]*f1[A.componentType].BYTES_PER_ELEMENT,V=Vd._malloc(z);l.GetAttributeDataArrayForAllPoints(m,D,Vd[L],z,V),Wk(Vd.memory.buffer.slice(V,V+z),A,e),Vd._free(V)}l.destroy(),m.destroy(),delete i.extensions[CS]}let g1="EXT_meshopt_compression";function _L(i,e){if(!i.extensions||!i.extensions[g1])return;let n=i.extensions[g1],l=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),u=new Uint8Array(n.count*n.byteStride);wS.decodeGltfBuffer(u,n.count,n.byteStride,l,n.mode,n.filter),i.buffer=e.buffers.length,i.byteOffset=0,e.buffers[i.buffer]=u.buffer,delete i.extensions[g1]}let Hk=1179937895,Gk=new TextDecoder("utf8");function qk(i,e){return new URL(i,e).href}function bL(i,e,n,l){return fetch(qk(i.uri,l)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[n]=u})}function $k(i,e){let n=i.json.bufferViews[e];return new Uint8Array(i.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function yL(i,e,n,l){if(i.uri){let u=qk(i.uri,l);return fetch(u).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{e.images[n]=m})}if(i.bufferView!==void 0){let u=$k(e,i.bufferView),m=new Blob([u],{type:i.mimeType});return createImageBitmap(m).then(p=>{e.images[n]=p})}}function Yk(i,e=0,n){let l={json:null,images:[],buffers:[]};if(new Uint32Array(i,e,1)[0]===Hk){let k=new Uint32Array(i,e),D=2,A=(k[D++]>>2)-3,L=k[D++]>>2;if(D++,l.json=JSON.parse(Gk.decode(k.subarray(D,D+L))),D+=L,D<A){let z=k[D++];D++;let V=e+(D<<2);l.buffers[0]=i.slice(V,V+z)}}else l.json=JSON.parse(Gk.decode(new Uint8Array(i,e)));let{buffers:u,images:m,meshes:p,extensionsUsed:b,bufferViews:v}=l.json,S=Promise.resolve();if(u){let k=[];for(let D=0;D<u.length;D++){let A=u[D];A.uri?k.push(bL(A,l,D,n)):l.buffers[D]||(l.buffers[D]=null)}S=Promise.all(k)}return S.then(()=>{let k=[],D=b&&b.includes(CS),A=b&&b.includes(g1);if(D&&k.push(function(){if(!Vd)return p1||(p1=function(L){let z,V=null;function H(){z=new Uint8Array(V.buffer)}function Y(){throw new Error("Unexpected Draco error.")}let ne={a:{a:Y,d:function(re,oe,xe){return z.copyWithin(re,oe,oe+xe)},c:function(re){let oe=z.length,xe=Math.max(re>>>0,Math.ceil(1.2*oe)),be=Math.ceil((xe-oe)/65536);try{return V.grow(be),H(),!0}catch{return!1}},b:Y}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(L,ne):L.then(re=>re.arrayBuffer()).then(re=>WebAssembly.instantiate(re,ne))).then(re=>{let{Rb:oe,Qb:xe,P:be,T:ke,X:Ae,Ja:je,La:Qe,Qa:$e,Va:st,Wa:vt,eb:at,jb:ht,f:tt,e:mt,yb:Ct,zb:ft,Ab:Ht,Bb:xt,Db:Mt,Gb:oi}=re.instance.exports;V=mt;let ti=(()=>{let Jt=0,Tt=0,li=0,Ei=0;return gi=>{li&&(oe(Ei),oe(Jt),Tt+=li,li=Jt=0),Jt||(Tt+=128,Jt=xe(Tt));let Li=gi.length+7&-8,Di=Jt;Li>=Tt&&(li=Li,Di=Ei=xe(Li));for(let Xi=0;Xi<gi.length;Xi++)z[Di+Xi]=gi[Xi];return Di}})();return H(),tt(),{memory:mt,_free:oe,_malloc:xe,Mesh:class{constructor(){this.ptr=be()}destroy(){ke(this.ptr)}},Decoder:class{constructor(){this.ptr=je()}destroy(){ht(this.ptr)}DecodeArrayToMesh(Jt,Tt,li){let Ei=ti(Jt),gi=Qe(this.ptr,Ei,Tt,li.ptr);return!!Ae(gi)}GetAttributeByUniqueId(Jt,Tt){return{ptr:$e(this.ptr,Jt.ptr,Tt)}}GetTrianglesUInt16Array(Jt,Tt,li){st(this.ptr,Jt.ptr,Tt,li)}GetTrianglesUInt32Array(Jt,Tt,li){vt(this.ptr,Jt.ptr,Tt,li)}GetAttributeDataArrayForAllPoints(Jt,Tt,li,Ei,gi){at(this.ptr,Jt.ptr,Tt.ptr,li,Ei,gi)}},DT_INT8:Ct(),DT_UINT8:ft(),DT_INT16:Ht(),DT_UINT16:xt(),DT_UINT32:Mt(),DT_FLOAT32:oi()}})}(fetch(jk())),p1.then(L=>{Vd=L,p1=void 0}))}()),A&&k.push(function(){if(wS)return;let L=function(z){let V,H=WebAssembly.instantiateStreaming(z,{}).then(re=>{V=re.instance,V.exports.__wasm_call_ctors()}),Y={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ne={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:H,supported:!0,decodeGltfBuffer(re,oe,xe,be,ke,Ae){(function(je,Qe,$e,st,vt,at,ht){let tt=je.exports.sbrk,mt=st+3&-4,Ct=tt(mt*vt),ft=tt(at.length),Ht=new Uint8Array(je.exports.memory.buffer);Ht.set(at,ft);let xt=Qe(Ct,st,vt,ft,at.length);if(xt===0&&ht&&ht(Ct,mt,vt),$e.set(Ht.subarray(Ct,Ct+st*vt)),tt(Ct-tt(0)),xt!==0)throw new Error(`Malformed buffer data: ${xt}`)})(V,V.exports[ne[ke]],re,oe,xe,be,V.exports[Y[Ae]])}}}(fetch(Uk()));return L.ready.then(()=>{wS=L})}()),m)for(let L=0;L<m.length;L++)k.push(yL(m[L],l,L,n));return(k.length?Promise.all(k):Promise.resolve()).then(()=>{if(D&&p)for(let{primitives:L}of p)for(let z of L)gL(z,l);if(A&&p&&v)for(let L of v)_L(L,l);return l})})}function Cg(i,e){let n=i.json.bufferViews[e.bufferView],l=f1[e.componentType];return new l(i.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==Sy[e.type]*l.BYTES_PER_ELEMENT?n.byteStride/l.BYTES_PER_ELEMENT:Sy[e.type]))}function SS(i,e,n,l){let u=f1[e.componentType],m=function(k){switch(k){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),p=i.json.bufferViews[e.bufferView],b=p.byteStride?p.byteStride/u.BYTES_PER_ELEMENT:Sy[e.type],v=n.float32,S=v.length/n.capacity;for(let k=0,D=0;k<e.count*b;k+=b,D+=S)for(let A=0;A<S;A++)v[D+A]=l[k+A]*m;n._trim()}function vL(i,e,n){let l=i.indices,u=i.attributes,m={};m.indexArray=new xo;let p=e.json.accessors[l],b=p.count/3;m.indexArray.reserve(b);let v=Cg(e,p);for(let A=0;A<b;A++)m.indexArray.emplaceBack(v[3*A],v[3*A+1],v[3*A+2]);m.indexArray._trim(),m.vertexArray=new ju;let S=e.json.accessors[u.POSITION];m.vertexArray.reserve(S.count);let k=Cg(e,S);for(let A=0;A<S.count;A++)m.vertexArray.emplaceBack(k[3*A],k[3*A+1],k[3*A+2]);if(m.vertexArray._trim(),m.aabb=new dr(S.min,S.max),m.centroid=function(A,L){let z=[0,0,0],V=A.length;if(V>0){for(let H=0;H<V;H++){let Y=3*A[H];z[0]+=L[Y],z[1]+=L[Y+1],z[2]+=L[Y+2]}z[0]/=V,z[1]/=V,z[2]/=V}return z}(v,k),u.COLOR_0!==void 0){let A=e.json.accessors[u.COLOR_0],L=Sy[A.type],z=Cg(e,A);m.colorArray=L===3?new ju:new Sd,m.colorArray.resize(A.count),SS(e,A,m.colorArray,z)}if(u.NORMAL!==void 0){m.normalArray=new ju;let A=e.json.accessors[u.NORMAL];m.normalArray.resize(A.count);let L=Cg(e,A);SS(e,A,m.normalArray,L)}if(u.TEXCOORD_0!==void 0&&n.length>0){m.texcoordArray=new kp;let A=e.json.accessors[u.TEXCOORD_0];m.texcoordArray.resize(A.count);let L=Cg(e,A);SS(e,A,m.texcoordArray,L)}if(u._FEATURE_ID_RGBA4444!==void 0){let A=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Cg(e,A))}u._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Cg(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));let D=i.material;return m.material=function(A,L){let{emissiveFactor:z=[0,0,0],alphaMode:V="OPAQUE",alphaCutoff:H=.5,normalTexture:Y,occlusionTexture:ne,emissiveTexture:re,doubleSided:oe}=A,{baseColorFactor:xe=[1,1,1,1],metallicFactor:be=1,roughnessFactor:ke=1,baseColorTexture:Ae,metallicRoughnessTexture:je}=A.pbrMetallicRoughness||{},Qe=ne?L[ne.index]:void 0;if(ne&&ne.extensions&&ne.extensions.KHR_texture_transform&&Qe){let $e=ne.extensions.KHR_texture_transform;Qe.offsetScale=[$e.offset[0],$e.offset[1],$e.scale[0],$e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new mn(...xe),metallicFactor:be,roughnessFactor:ke,baseColorTexture:Ae?L[Ae.index]:void 0,metallicRoughnessTexture:je?L[je.index]:void 0},doubleSided:oe,emissiveFactor:z,alphaMode:V,alphaCutoff:H,normalTexture:Y?L[Y.index]:void 0,occlusionTexture:Qe,emissionTexture:re?L[re.index]:void 0,defined:A.defined===void 0}}(D!==void 0?e.json.materials[D]:{defined:!1},n),m}function Zk(i,e,n){let{matrix:l,rotation:u,translation:m,scale:p,mesh:b,extras:v,children:S}=i,k={};if(k.matrix=l||t.ad.fromRotationTranslationScale([],u||[0,0,0,1],m||[0,0,0],p||[1,1,1]),b!==void 0){k.meshes=n[b];let D=k.anchor=[0,0];for(let A of k.meshes){let{min:L,max:z}=A.aabb;D[0]+=L[0]+z[0],D[1]+=L[1]+z[1]}D[0]=Math.floor(D[0]/k.meshes.length/2),D[1]=Math.floor(D[1]/k.meshes.length/2)}if(v&&(v.id&&(k.id=v.id),v.lights&&(k.lights=function(D){if(!D.length)return[];let A=function(Y){let ne=atob(Y),re=new Uint8Array(ne.length);for(let oe=0;oe<ne.length;oe++)re[oe]=ne.codePointAt(oe);return re}(D),L=[],z=A.length/24,V=new Uint16Array(A.buffer),H=new Float32Array(A.buffer);for(let Y=0;Y<z;Y++){let ne=V[2*Y*6]/30,re=V[2*Y*6+1]/30,oe=V[2*Y*6+10]/100,xe=H[6*Y+1],be=H[6*Y+2],ke=H[6*Y+3],Ae=H[6*Y+4],je=ke-xe,Qe=Ae-be,$e=Math.hypot(je,Qe);L.push({pos:[xe+.5*je,be+.5*Qe,re],normal:[Qe/$e,-je/$e,0],width:$e,height:ne,depth:oe,points:[xe,be,ke,Ae]})}return L}(v.lights))),S){let D=[];for(let A of S)D.push(Zk(e.json.nodes[A],e,n));k.children=D}return k}function xL(i){if(i.vertices.length===0||i.indices.length===0)return null;let e=new ny(i.vertices,i.indices,8,256),[n,l]=[e.min.clone(),e.max.clone()];return{vertices:i.vertices,indices:i.indices,grid:e,min:n,max:l}}function wL(i){if(!i.extras||!i.extras.ground)return null;let e=i.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let l=[];for(let p of n){if(!Array.isArray(p)||p.length!==2)continue;let b=p[0],v=p[1];typeof b=="number"&&typeof v=="number"&&l.push(new gt(b,v))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let u=0;for(let p=0;p<l.length;p++){let b=l[p],v=l[(p+1)%l.length],S=l[(p+2)%l.length];u+=(b.x-v.x)*(S.y-v.y)-(S.x-v.x)*(b.y-v.y)}u>0&&l.reverse();let m=ug(l.flatMap(p=>[p.x,p.y]),[]);return m.length===0?null:{vertices:l,indices:m}}function CL(i,e){let n=[],l=[],u=0,m=[];for(let p of i){u=n.length;let b=p.vertexArray.float32,v=p.indexArray.uint16;for(let S=0;S<p.vertexArray.length;S++)m[0]=b[3*S+0],m[1]=b[3*S+1],m[2]=b[3*S+2],t._.transformMat4(m,m,e),n.push(new gt(m[0],m[1]));for(let S=0;S<3*p.indexArray.length;S++)l.push(v[S]+u)}if(l.length%3!=0)return null;for(let p=0;p<l.length;p+=3){let b=n[l[p+0]],v=n[l[p+1]],S=n[l[p+2]];(b.x-v.x)*(S.y-v.y)-(S.x-v.x)*(b.y-v.y)>0&&([l[p+1],l[p+2]]=[l[p+2],l[p+1]])}return{vertices:n,indices:l}}function Xk(i){let e=function(v,S){let k=[],D=WebGL2RenderingContext;if(v.json.textures)for(let A of v.json.textures){let L={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};A.sampler!==void 0&&Object.assign(L,v.json.samplers[A.sampler]),k.push({image:S[A.source],sampler:L,uploaded:!1})}return k}(i,i.images),n=function(v,S){let k=[];for(let D of v.json.meshes){let A=[];for(let L of D.primitives)A.push(vL(L,v,S));k.push(A)}return k}(i,e),{scenes:l,scene:u,nodes:m}=i.json,p=l?l[u||0].nodes:m,b=[];for(let v of p)b.push(Zk(m[v],i,n));return function(v,S,k){let D={},A=new Set;for(let L=0;L<v.length;L++){let z=k[S[L]];if(!z.extras)continue;let V=z.extras["mapbox:footprint:version"],H=z.extras["mapbox:footprint:id"];(V||H)&&A.add(L),V==="1.0.0"&&H&&(D[H]=L)}for(let L=0;L<v.length;L++){if(A.has(L))continue;let z=v[L],V=k[S[L]];if(!V.extras)continue;let H=null;z.id in D&&(H=CL(v[D[z.id]].meshes,z.matrix)),H||(H=wL(V)),H&&(z.footprint=xL(H))}if(A.size>0){let L=Array.from(A.values()).sort((z,V)=>z-V);for(let z=L.length-1;z>=0;z--)v.splice(L[z],1)}}(b,p,i.json.nodes),b}function SL(i){i.heightmap=new Float32Array(4096),i.heightmap.fill(-1);let e=i.vertexArray.float32,n=i.aabb.min[0]-1,l=i.aabb.min[1]-1,u=wg/(i.aabb.max[0]-n+2),m=wg/(i.aabb.max[1]-l+2);for(let p=0;p<e.length;p+=3){let b=e[p+2],v=(e[p+0]-n)*u|0,S=(e[p+1]-l)*m|0;b>i.heightmap[S*wg+v]&&(i.heightmap[S*wg+v]=b)}}function IL(i,e){let n={};n.indexArray=new xo,n.indexArray.reserve(4*i.length),n.vertexArray=new ju,n.vertexArray.reserve(10*i.length),n.colorArray=new Sd,n.vertexArray.reserve(10*i.length);let l=0;for(let p of i){let b=Math.min(10,Math.max(4,1.3*p.height))*e,v=[-p.normal[1],p.normal[0],0],S=Math.min(.29,.1*p.width/p.depth),k=p.width-2*p.depth*e*(S+.01),D=t._.scaleAndAdd([],p.pos,v,k/2),A=t._.scaleAndAdd([],p.pos,v,-k/2),L=[D[0],D[1],D[2]+p.height],z=[A[0],A[1],A[2]+p.height],V=t._.scaleAndAdd([],p.normal,v,S);t._.scale(V,V,b);let H=t._.scaleAndAdd([],p.normal,v,-S);t._.scale(H,H,b),t._.add(V,D,V),t._.add(H,A,H),D[2]+=.1,A[2]+=.1,n.vertexArray.emplaceBack(V[0],V[1],V[2]),n.vertexArray.emplaceBack(H[0],H[1],H[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(L[0],L[1],L[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(V[0],V[1],V[2]),n.vertexArray.emplaceBack(H[0],H[1],H[2]);let Y=k/b/2;n.colorArray.emplaceBack(-Y-S,-1,Y,.8),n.colorArray.emplaceBack(Y+S,-1,Y,.8),n.colorArray.emplaceBack(-Y,0,Y,1.3),n.colorArray.emplaceBack(Y,0,Y,1.3),n.colorArray.emplaceBack(Y+S,-.8,Y,.7),n.colorArray.emplaceBack(Y+S,-.8,Y,.7),n.colorArray.emplaceBack(0,0,Y,1.3),n.colorArray.emplaceBack(0,0,Y,1.3),n.colorArray.emplaceBack(Y+S,-1.2,Y,.8),n.colorArray.emplaceBack(Y+S,-1.2,Y,.8),n.indexArray.emplaceBack(6+l,4+l,8+l),n.indexArray.emplaceBack(7+l,9+l,5+l),n.indexArray.emplaceBack(0+l,1+l,2+l),n.indexArray.emplaceBack(1+l,3+l,2+l),l+=10}let u={defined:!0,emissiveFactor:[0,0,0]},m={};return m.baseColorFactor=mn.white,u.pbrMetallicRoughness=m,n.material=u,n.aabb=new dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}let IS=new Float32Array(262144),Sg=new Uint8Array(262144);function Qk(i){let e=0;if(i.meshes)for(let n of i.meshes)e=Math.max(e,n.aabb.max[2]);if(i.children)for(let n of i.children)e=Math.max(e,Qk(n));return e}function Kk(i,e,n){if(i.meshes)for(let l of i.meshes)l.aabb.min[0]!==1/0&&n.insert(e,l.aabb.min[0],l.aabb.min[1],l.aabb.max[0],l.aabb.max[1]);if(i.children)for(let l of i.children)Kk(l,e,n)}let Jk=["","wall","door","roof","window","lamp","logo"];class eE{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Qk(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=dr.applyTransform(l.aabb,this.node.matrix),n.encapsulate(l.transformedAabb)),e++;this.aabb=n}return this.aabb}}class _1{constructor(e,n,l,u,m,p){this.id=n,this.modelTraits|=a0.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,l&&(this.modelTraits|=a0.HasMapboxMeshFeatures),u&&(this.modelTraits|=a0.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let b of e)this.nodesInfo.push(new eE(b)),Kk(b,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(let l of this.getNodesInfo()){let u=l.node;u.footprint&&n.push({footprint:u.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let l of n){let u=l.node;this.uploaded?this.updatePbrBuffer(u):_S(u,e,!0)}for(let l of n)h1(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),n=!0);return n}needsReEvaluation(e,n,l){let u=e.transform.projectionOptions,m=e.style.getBrightness(),p=this.brightness!==m;return!!(!this.uploaded||this.dirty||u.name!==this.projection.name||Iy(l.paint.get("model-color").value,p)||Iy(l.paint.get("model-color-mix-intensity").value,p)||Iy(l.paint.get("model-roughness").value,p)||Iy(l.paint.get("model-emissive-strength").value,p)||Iy(l.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=u,this.brightness=m,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let l=this.getNodesInfo(),u=this.id.canonical;for(let m of l){let p=m.feature;m.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},u)}}evaluate(e){let n=this.getNodesInfo();for(let l of n){if(!l.node.meshes)continue;let u=l.feature,m=l.node.meshes&&l.node.meshes[0].featureData,p=l.evaluatedColor[2],b=l.evaluatedRMEA[2],v=this.id.canonical;if(l.hasTranslucentParts=!1,m){for(let S=0;S<Jk.length;S++){let k=Jk[S];k.length&&(u.properties.part=k);let D=e.paint.get("model-color").evaluate(u,{},v).toRenderColor(null),A=e.paint.get("model-color-mix-intensity").evaluate(u,{},v);l.evaluatedColor[S]=[D.r,D.g,D.b,A],l.evaluatedRMEA[S][0]=e.paint.get("model-roughness").evaluate(u,{},v),l.evaluatedRMEA[S][2]=e.paint.get("model-emissive-strength").evaluate(u,{},v),l.evaluatedRMEA[S][3]=D.a,l.emissionHeightBasedParams[S]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,{},v),!l.hasTranslucentParts&&D.a<1&&(l.hasTranslucentParts=!0)}delete u.properties.part,ML(l,p!==l.evaluatedColor[2]||b!==l.evaluatedRMEA[2],this.modelTraits)}else l.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,{},v);l.evaluatedScale=e.paint.get("model-scale").evaluate(u,{},v),this.updatePbrBuffer(l.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,l,u){let m=e.findDEMTileFor(l);if(m&&(m.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;let p=th.create(e,l,m);if(!p)return;this.modelTraits&a0.HasMapboxMeshFeatures&&this.updateDEM(e,p,l,u);for(let b of this.getNodesInfo()){let v=b.node;if(!v.footprint||!v.footprint.vertices||!v.footprint.vertices.length)continue;let S=v.footprint.vertices,k=p.getElevationAt(S[0].x,S[0].y,!0,!0);for(let D=1;D<S.length;D++)k=Math.min(k,p.getElevationAt(S[D].x,S[D].y,!0,!0));v.elevation=k}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,l,u){let m=n._dem._modifiedForSources[u];if(m===void 0&&(n._dem._modifiedForSources[u]=[],m=n._dem._modifiedForSources[u]),m.includes(l.canonical))return;let p=n._dem.dim;m.push(l.canonical);let b=!1;for(let v of this.getNodesInfo()){let S=v.node;if(!S.footprint||!S.footprint.grid)continue;let k=S.footprint.grid,D=n.tileCoordToPixel(k.min.x,k.min.y),A=n.tileCoordToPixel(k.max.x,k.max.y),L=Math.min(Math.min(p-A.y,D.x),Math.min(D.y,p-A.x));if(L<0)continue;let z=Ri(L,2,5),V=Math.max(0,D.x-z),H=Math.max(0,D.y-z),Y=Math.min(A.x+z,p-1),ne=Math.min(A.y+z,p-1);for(let be=H;be<=ne;++be)for(let ke=V;ke<=Y;++ke)Sg[be*p+ke]=255;let re=0,oe=0;for(let be=0;be<k.cellsY;++be)for(let ke=0;ke<k.cellsX;++ke){if(!k.cells[be*k.cellsX+ke])continue;let Ae=n.tileCoordToPixel(k.min.x+ke/k.xScale,k.min.y+be/k.yScale),je=n.tileCoordToPixel(k.min.x+(ke+1)/k.xScale,k.min.y+(be+1)/k.yScale);for(let Qe=Ae.y;Qe<=Math.min(je.y+1,p-1);++Qe)for(let $e=Ae.x;$e<=Math.min(je.x+1,p-1);++$e)Sg[Qe*p+$e]===255&&(Sg[Qe*p+$e]=0,re+=n.getElevationAtPixel($e,Qe),oe++)}let xe=re/oe;V=Math.max(1,D.x-z),H=Math.max(1,D.y-z),Y=Math.min(A.x+z,p-2),ne=Math.min(A.y+z,p-2),b=!0;for(let be=H;be<=ne;++be)for(let ke=V;ke<=Y;++ke)Sg[be*p+ke]===0&&(IS[be*p+ke]=n._dem.set(ke,be,xe));for(let be=1;be<z;++be){V=Math.max(1,D.x-be),H=Math.max(1,D.y-be),Y=Math.min(A.x+be,p-2),ne=Math.min(A.y+be,p-2);for(let ke=H;ke<=ne;++ke)for(let Ae=V;Ae<=Y;++Ae){let je=ke*p+Ae;if(Sg[je]===255){let Qe=0,$e=0,st=-1,vt=-1;for(let at=-1;at<=1;++at)for(let ht=-1;ht<=1;++ht){let tt=(ke+at)*p+Ae+ht;if(Sg[tt]>=be)continue;let mt=IS[tt],Ct=Math.abs(mt);Ct>$e&&(Qe=mt,$e=Ct,st=ht,vt=at)}if($e>.1){let at=1-(be+.5*Math.abs(st*vt))/z,ht=n._dem.get(Ae,ke)+Qe*at,tt=n._dem.get(Ae+st,ke+vt),mt=n._dem.get(Ae-st,ke-vt,!0);(ht-tt)*(ht-mt)>0&&(ht=(tt+mt)/2),IS[je]=n._dem.set(Ae,ke,ht),Sg[je]=be}}}}}b&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Eo.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)h1(n.node),bS(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let l=n.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let m=0;m<this.nodesInfo.length;m++){let p=u[m].node;u[m].hiddenByReplacement=!!p.footprint&&!l.find(b=>b.footprint===p.footprint)}}getHeightAtTileCoord(e,n){let l=this.getNodesInfo(),u=[],m=[0,0,0],p=t.ad.identity([]);for(let b=0;b<this.nodesInfo.length;b++){let v=l[b],S=v.node.meshes[0],k=S.transformedAabb;if(e<k.min[0]||n<k.min[1]||e>k.max[0]||n>k.max[1])continue;if(v.node.hidden===!0)return{height:0,maxHeight:v.feature.properties.height,hidden:!1,verticalScale:v.evaluatedScale[2]};t.ad.invert(p,v.node.matrix),m[0]=e,m[1]=n,t._.transformMat4(m,m,p);let D=(m[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*wg|0,A=Math.min(63,(m[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*wg|0)*wg+Math.min(63,D),L=S.heightmap[A];if(!(L<0&&v.node.footprint))return v.hiddenByReplacement?void 0:{height:L,maxHeight:v.feature.properties.height,hidden:!1,verticalScale:v.evaluatedScale[2]};if(v.node.footprint.grid.query(new gt(e,n),new gt(e,n),u),u.length>0)return{height:void 0,maxHeight:v.feature.properties.height,hidden:v.hiddenByReplacement,verticalScale:v.evaluatedScale[2]}}}}function Iy(i,e){return!i.isLightConstant&&e}function TL(i,e,n,l,u,m,p,b){let v=(61440&e|(61440&e)>>4)>>8,S=(3840&e|(3840&e)>>4)>>4,k=240&e|(240&e)>>4;n[3]>0&&(v=ri(v,255*n[0],n[3]),S=ri(S,255*n[1],n[3]),k=ri(k,255*n[2],n[3]));let D=v<<8|S,A=k<<8|Math.floor(255*l[3]),L=function(be){let ke=Ri(be,0,2);return Math.min(Math.round(.5*ke*255),255)}(l[2])<<8|15*l[0]<<4|15*l[1],z=Ri(u[0],0,1),V=Ri(u[1],0,1),H=Ri(u[2],0,1),Y=Ri(u[3],0,1),ne,re,oe,xe;if(z!==V&&p!==m&&V!==z){let be=p-m;re=1/(be*(V-z)),oe=-(m+be*z)/(be*(V-z));let ke=Ri(u[4],-1,1);xe=Math.pow(10,ke),ne=255*H<<8|255*Y}else ne=65535,re=0,oe=1,xe=1;if(i.emplaceBack(D,A,L,ne,re,oe,xe),b){let be=b.length;b.clear();for(let ke=0;ke<be;ke++)b.emplaceBack(D,A,L,ne,re,oe,xe)}}function ML(i,e,n){let l=i.node,u=0,m=n&a0.HasMeshoptCompression;for(let p of l.meshes){if(l.lights&&l.lightMeshIndex===u||!p.featureData)continue;p.featureArray=new x_,p.featureArray.reserve(p.featureData.length);let b=e;for(let v of p.featureData){let S=m?65535&v:v>>16&65535,k=m?v>>16&65535:65535&v,D=(15&k)<8?15&k:0,A=i.evaluatedRMEA[D],L=i.evaluatedColor[D],z=i.emissionHeightBasedParams[D],V;if(b&&D===2&&l.lights&&(V=new x_,V.resize(10*l.lights.length)),TL(p.featureArray,S,L,A,z,p.aabb.min[2],p.aabb.max[2],V),V&&b){b=!1;let H=l.meshes[l.lightMeshIndex];H.featureArray=V,H.featureArray._trim()}}p.featureArray._trim(),u++}}function tE(i,e,n,l){let u=1<<i.z;e.lat=$o((l/At+i.y)/u),e.lng=ts((n/At+i.x)/u)}de(_1,"Tiled3dModelBucket",{omit:["layers"]}),de(eE,"Tiled3dModelFeature");let kL={circle:class extends eo{constructor(i,e,n,l){super(i,Oo,e,n,l)}createBucket(i){return new D_(i)}queryRadius(i){let e=i;return Fp("circle-radius",this,e)+Fp("circle-stroke-width",this,e)+Oc(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,n,l,u,m,p,b){let v=Gv(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return tx(i,l,m,p,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(i,e,n){let l=Qb(this);return{config:new Gu(this,{zoom:e,lut:n}),defines:l,overrideFog:!1}}},heatmap:class extends eo{createBucket(i){return new rx(i)}constructor(i,e,n,l){super(i,u2,e,n,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Fp("heatmap-radius",this,i)}queryIntersectsFeature(i,e,n,l,u,m,p,b){let v=this.paint.get("heatmap-radius").evaluate(e,n);return tx(i,l,m,p,b,!0,!0,new gt(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(i,e,n){return i==="heatmap"?{config:new Gu(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends eo{constructor(i,e,n,l){super(i,m2,e,n,l)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(i,e,n){return{overrideFog:!1}}},fill:class extends eo{constructor(i,e,n,l){super(i,px,e,n,l)}getProgramIds(){let i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(i,e,n){return{config:new Gu(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(i,e){super.recalculate(i,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new L_(i)}queryRadius(){return Oc(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,n,l,u,m){return!i.queryGeometry.isAboveHorizon&&jv(wn(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends eo{constructor(i,e,n,l){super(i,ot,e,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new $_(i)}queryRadius(){return Oc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(i,e,n,l,u,m,p,b,v){let S=Gv(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(e,n),D=this.paint.get("fill-extrusion-base").evaluate(e,n),A=[0,0],L=b&&m.elevation,z=m.elevation?m.elevation.exaggeration():1,V=i.tile.getBucket(this);if(L&&V instanceof $_){let oe=V.centroidVertexArray,xe=v+1;xe<oe.length&&(A[0]=oe.geta_centroid_pos0(xe),A[1]=oe.geta_centroid_pos1(xe))}if(A[0]===0&&A[1]===1)return!1;m.projection.name==="globe"&&(l=Se([l],[new gt(0,0),new gt(At,At)],i.tileID.canonical).map(oe=>oe.polygon).flat());let H=L?b:null,[Y,ne]=function(oe,xe,be,ke,Ae,je,Qe,$e,st,vt,at){return oe.projection.name==="globe"?function(ht,tt,mt,Ct,ft,Ht,xt,Mt,oi,ti,Jt){let Tt=[],li=[],Ei=ht.projection.upVectorScale(Jt,ht.center.lat,ht.worldSize).metersToTile,gi=[0,0,0,1],Li=[0,0,0,1],Di=(mi,qn,Wn,In)=>{mi[0]=qn,mi[1]=Wn,mi[2]=In,mi[3]=1},Xi=se();mt>0&&(mt+=Xi),Ct+=Xi;for(let mi of tt){let qn=[],Wn=[];for(let In of mi){let fn=In.x+ft.x,Tn=In.y+ft.y,ur=ht.projection.projectTilePoint(fn,Tn,Jt),tr=ht.projection.upVector(Jt,In.x,In.y),jr=mt,Lr=Ct;if(xt){let Wa=Yt(fn,Tn,mt,Ct,xt,Mt,oi,ti);jr+=Wa.base,Lr+=Wa.top}mt!==0?Di(gi,ur.x+tr[0]*Ei*jr,ur.y+tr[1]*Ei*jr,ur.z+tr[2]*Ei*jr):Di(gi,ur.x,ur.y,ur.z),Di(Li,ur.x+tr[0]*Ei*Lr,ur.y+tr[1]*Ei*Lr,ur.z+tr[2]*Ei*Lr),t._.transformMat4(gi,gi,Ht),t._.transformMat4(Li,Li,Ht),qn.push(new Pd(gi[0],gi[1],gi[2])),Wn.push(new Pd(Li[0],Li[1],Li[2]))}Tt.push(qn),li.push(Wn)}return[Tt,li]}(oe,xe,be,ke,Ae,je,Qe,$e,st,vt,at):Qe?function(ht,tt,mt,Ct,ft,Ht,xt,Mt,oi){let ti=[],Jt=[],Tt=[0,0,0,1];for(let li of ht){let Ei=[],gi=[];for(let Li of li){let Di=Li.x+Ct.x,Xi=Li.y+Ct.y,mi=Yt(Di,Xi,tt,mt,Ht,xt,Mt,oi);Tt[0]=Di,Tt[1]=Xi,Tt[2]=mi.base,Tt[3]=1,t.aA.transformMat4(Tt,Tt,ft),Tt[3]=Math.max(Tt[3],1e-5);let qn=new Pd(Tt[0]/Tt[3],Tt[1]/Tt[3],Tt[2]/Tt[3]);Tt[0]=Di,Tt[1]=Xi,Tt[2]=mi.top,Tt[3]=1,t.aA.transformMat4(Tt,Tt,ft),Tt[3]=Math.max(Tt[3],1e-5);let Wn=new Pd(Tt[0]/Tt[3],Tt[1]/Tt[3],Tt[2]/Tt[3]);Ei.push(qn),gi.push(Wn)}ti.push(Ei),Jt.push(gi)}return[ti,Jt]}(xe,be,ke,Ae,je,Qe,$e,st,vt):function(ht,tt,mt,Ct,ft){let Ht=[],xt=[],Mt=ft[8]*tt,oi=ft[9]*tt,ti=ft[10]*tt,Jt=ft[11]*tt,Tt=ft[8]*mt,li=ft[9]*mt,Ei=ft[10]*mt,gi=ft[11]*mt;for(let Li of ht){let Di=[],Xi=[];for(let mi of Li){let qn=mi.x+Ct.x,Wn=mi.y+Ct.y,In=ft[0]*qn+ft[4]*Wn+ft[12],fn=ft[1]*qn+ft[5]*Wn+ft[13],Tn=ft[2]*qn+ft[6]*Wn+ft[14],ur=ft[3]*qn+ft[7]*Wn+ft[15],tr=In+Mt,jr=fn+oi,Lr=Tn+ti,Wa=Math.max(ur+Jt,1e-5),to=In+Tt,Pr=fn+li,So=Tn+Ei,pa=Math.max(ur+gi,1e-5);Di.push(new Pd(tr/Wa,jr/Wa,Lr/Wa)),Xi.push(new Pd(to/pa,Pr/pa,So/pa))}Ht.push(Di),xt.push(Xi)}return[Ht,xt]}(xe,be,ke,Ae,je)}(m,l,D,k,S,p,H,A,z,m.center.lat,i.tileID.canonical),re=i.queryGeometry;return function(oe,xe,be){let ke=1/0;jv(be,xe)&&(ke=jt(be,xe[0]));for(let Ae=0;Ae<xe.length;Ae++){let je=xe[Ae],Qe=oe[Ae];for(let $e=0;$e<je.length-1;$e++){let st=je[$e],vt=[st,je[$e+1],Qe[$e+1],Qe[$e],st];Vb(be,vt)&&(ke=Math.min(ke,jt(be,vt)))}}return ke!==1/0&&ke}(Y,ne,re.isPointQuery()?re.screenBounds:re.screenGeometry)}},line:class extends eo{constructor(i,e,n,l){super(i,jx,e,n,l),jx.layout&&(this.layout=new Fn(jx.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof _d,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Ck.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Vx(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(i,e,n){let l=TM(this);return{config:new Gu(this,{zoom:e,lut:n}),defines:l,overrideFog:!1}}queryRadius(i){let e=i,n=Sk(Fp("line-width",this,e),Fp("line-gap-width",this,e)),l=Fp("line-offset",this,e);return n/2+Math.abs(l)+Oc(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,n,l,u,m){if(i.queryGeometry.isAboveHorizon)return!1;let p=wn(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),b=i.pixelToTileUnitsFactor/2*Sk(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),v=this.paint.get("line-offset").evaluate(e,n);return v&&(l=function(S,k){let D=[],A=new gt(0,0);for(let L=0;L<S.length;L++){let z=S[L],V=[];for(let H=0;H<z.length;H++){let Y=z[H],ne=z[H+1],re=H===0?A:Y.sub(z[H-1])._unit()._perp(),oe=H===z.length-1?A:ne.sub(Y)._unit()._perp(),xe=re._add(oe)._unit();xe._mult(1/(xe.x*oe.x+xe.y*oe.y)),V.push(xe._mult(k)._add(Y))}D.push(V)}return D}(l,v*i.pixelToTileUnitsFactor)),function(S,k,D){for(let A=0;A<k.length;A++){let L=k[A];if(S.length>=3){for(let z=0;z<L.length;z++)if(Yu(S,L[z]))return!0}if(o2(S,L,D))return!0}return!1}(p,l,b)}isTileClipped(){return!0}isDraped(i){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:a1,background:class extends eo{constructor(i,e,n,l){super(i,qF,e,n,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(i,e,n){return{overrideFog:!1}}},raster:kk,"raster-particle":Ek,sky:class extends eo{constructor(i,e,n,l){super(i,eL,e,n,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=dg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){let l=this.paint.get("sky-atmosphere-sun"),u=!l,m=i.style.light,p=m.properties.get("position");return u&&m.properties.get("anchor")==="viewport"&&Vr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?pS(p.azimuthal,90-p.polar,e):pS(l[0],90-l[1],e)}let n=this.paint.get("sky-gradient-center");return pS(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}},slot:class extends eo{constructor(i,e,n,l){super(i,tL,e,null)}},model:class extends eo{constructor(i,e,n,l){super(i,dL,e,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new gS(i)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(i){return i instanceof _1?At-1:0}queryIntersectsFeature(i,e,n,l,u,m){if(!this.modelManager)return!1;let p=this.modelManager,b=i.tile.getBucket(this);if(!(b&&b instanceof gS))return!1;let v=b;for(let S in v.instancesPerModel){let k=v.instancesPerModel[S],D=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(k.idToFeaturesIndex.hasOwnProperty(D)){let A=k.features[k.idToFeaturesIndex[D]],L=p.getModel(S,this.scope);if(!L)return!1;let z=t.ad.create(),V=new un(0,0),H=v.canonical,Y=Number.MAX_VALUE;for(let ne=0;ne<A.instancedDataCount;++ne){let re=16*(A.instancedDataOffset+ne),oe=k.instancedDataArray.float32,xe=[oe[re+4],oe[re+5],oe[re+6]];tE(H,V,oe[re],0|oe[re+1]),Nk(z,L,m,V,A.rotation,A.scale,xe,!1,!1,!1),m.projection.name==="globe"&&(z=fS(z,m));let be=t.ad.multiply([],m.projMatrix,z),ke=i.queryGeometry,Ae=Fk(ke.isPointQuery()?ke.screenBounds:ke.screenGeometry,m,be,L.aabb);Ae!=null&&(Y=Math.min(Ae,Y))}return Y!==Number.MAX_VALUE&&Y}}return!1}_handleOverridablePaintPropertyUpdate(i,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||i!=="model-color"&&i!=="model-color-mix-intensity"&&i!=="model-rotation"&&i!=="model-scale"&&i!=="model-translation"&&i!=="model-emissive-strength")}_isPropertyZoomDependent(i){let e=this._transitionablePaint._values[i];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof K}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(i,e,n,l){let u=i.tile,m=u.getBucket(this),p=null,b=Number.MAX_VALUE;if(!(m&&m instanceof _1))return{queryFeature:p,intersectionZ:b};let v=m.getNodesInfo()[e];if(v.hiddenByReplacement||!v.node.meshes||!n.filter(new Vt(u.tileID.overscaledZ),v.feature,u.tileID.canonical))return{queryFeature:p,intersectionZ:b};let S=v.node,k=l.calculatePosMatrix(u.tileID.toUnwrapped(),l.worldSize),D=v.evaluatedScale,A=0;l.elevation&&S.elevation&&(A=S.elevation*l.elevation.exaggeration()),t.ad.translate(k,k,[(S.anchor?S.anchor[0]:0)*(D[0]-1),(S.anchor?S.anchor[1]:0)*(D[1]-1),A]),t.ad.scale(k,k,D),t.ad.multiply(k,k,S.matrix);let L=i.queryGeometry,z=L.isPointQuery()?L.screenBounds:L.screenGeometry,V=function(Y){let ne=t.ad.multiply([],k,Y.matrix),re=t.ad.multiply(ne,l.expandedFarZProjMatrix,ne);for(let oe=0;oe<Y.meshes.length;++oe){let xe=Y.meshes[oe];if(oe===Y.lightMeshIndex)continue;let be=Fk(z,l,re,xe.aabb);be!=null&&(b=Math.min(be,b))}if(Y.children)for(let oe of Y.children)V(oe)};if(V(S),b===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:b};let H=new un(0,0);return tE(u.tileID.canonical,H,v.node.anchor[0],v.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[H.lng,H.lat]},properties:v.feature.properties,id:v.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:b}}},clip:class extends eo{constructor(i,e,n,l){super(i,w2,e,n,l)}recalculate(i,e){super.recalculate(i,e)}createBucket(i){return new fx(i)}isTileClipped(){return!0}is3D(){return!0}}};de(vk,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let iE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class TS{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,l]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let u=l>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);let m=iE[15&l];if(!m)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new TS(b,p,m,e)}constructor(e,n=64,l=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let m=iE.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${l}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+b+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=n,l}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return MS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:p,nodeSize:b}=this,v=[0,m.length-1,0],S=[];for(;v.length;){let k=v.pop()||0,D=v.pop()||0,A=v.pop()||0;if(D-A<=b){for(let H=A;H<=D;H++){let Y=p[2*H],ne=p[2*H+1];Y>=e&&Y<=l&&ne>=n&&ne<=u&&S.push(m[H])}continue}let L=A+D>>1,z=p[2*L],V=p[2*L+1];z>=e&&z<=l&&V>=n&&V<=u&&S.push(m[L]),(k===0?e<=z:n<=V)&&(v.push(A),v.push(L-1),v.push(1-k)),(k===0?l>=z:u>=V)&&(v.push(L+1),v.push(D),v.push(1-k))}return S}within(e,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:m,nodeSize:p}=this,b=[0,u.length-1,0],v=[],S=l*l;for(;b.length;){let k=b.pop()||0,D=b.pop()||0,A=b.pop()||0;if(D-A<=p){for(let H=A;H<=D;H++)rE(m[2*H],m[2*H+1],e,n)<=S&&v.push(u[H]);continue}let L=A+D>>1,z=m[2*L],V=m[2*L+1];rE(z,V,e,n)<=S&&v.push(u[L]),(k===0?e-l<=z:n-l<=V)&&(b.push(A),b.push(L-1),b.push(1-k)),(k===0?e+l>=z:n+l>=V)&&(b.push(L+1),b.push(D),b.push(1-k))}return v}}function MS(i,e,n,l,u,m){if(u-l<=n)return;let p=l+u>>1;nE(i,e,p,l,u,m),MS(i,e,n,l,p-1,1-m),MS(i,e,n,p+1,u,1-m)}function nE(i,e,n,l,u,m){for(;u>l;){if(u-l>600){let S=u-l+1,k=n-l+1,D=Math.log(S),A=.5*Math.exp(2*D/3),L=.5*Math.sqrt(D*A*(S-A)/S)*(k-S/2<0?-1:1);nE(i,e,n,Math.max(l,Math.floor(n-k*A/S+L)),Math.min(u,Math.floor(n+(S-k)*A/S+L)),m)}let p=e[2*n+m],b=l,v=u;for(Ty(i,e,l,n),e[2*u+m]>p&&Ty(i,e,l,u);b<v;){for(Ty(i,e,b,v),b++,v--;e[2*b+m]<p;)b++;for(;e[2*v+m]>p;)v--}e[2*l+m]===p?Ty(i,e,l,v):(v++,Ty(i,e,v,u)),v<=n&&(l=v+1),n<=v&&(u=v-1)}}function Ty(i,e,n,l){kS(i,n,l),kS(e,2*n,2*l),kS(e,2*n+1,2*l+1)}function kS(i,e,n){let l=i[e];i[e]=i[n],i[n]=l}function rE(i,e,n,l){let u=i-n,m=e-l;return u*u+m*m}t.$=$r,t.A=Ru,t.B=sl,t.C=mn,t.D=Wi,t.E=md,t.G=Zr,t.H=h,t.I=vF,t.J=p_,t.K=function(i){let e=i.value,n=[];if(!e)return n;let l=Cc(e);return l!=="string"?(n=n.concat([new u1(i.key,e,`string expected, "${l}" found`)]),n):(Lk(e,!0)||(n=n.concat([new u1(i.key,e,`invalid url "${e}"`)])),n)},t.L=Ue,t.M=class{constructor(i,e,n,l){this.id=i,this.position=e!=null?new un(e[0],e[1]):new un(0,0),this.orientation=n??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,e){if(t.ad.multiply(i.matrix,e,i.matrix),i.meshes)for(let n of i.meshes){let l=dr.applyTransform(n.aabb,i.matrix);this.aabb.encapsulate(l)}if(i.children)for(let n of i.children)this._applyTransformations(n,i.matrix)}computeBoundsAndApplyParent(){let i=t.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,i)}computeModelMatrix(i,e,n,l,u,m,p=!1){Nk(this.matrix,this,i.transform,this.position,e,n,l,u,m,p)}upload(i){if(!this.uploaded){for(let e of this.nodes)_S(e,i);for(let e of this.nodes)h1(e);this.uploaded=!0}}destroy(){for(let i of this.nodes)bS(i)}},t.N=vn,t.O=dt,t.P=gt,t.Q=class{constructor(i){this.specification=i}possiblyEvaluate(i,e){return Rs(i.expression.evaluate(e))}interpolate(i,e,n){return{x:ri(i.x,e.x,n),y:ri(i.y,e.y,n),z:ri(i.z,e.z,n),azimuthal:ri(i.azimuthal,e.azimuthal,n),polar:ri(i.polar,e.polar,n)}}},t.R=op,t.S=Ib,t.T=Bc,t.U=dn,t.V=u1,t.W=Mo,t.X=Vt,t.Y=la,t.Z=K,t.a=gl,t.a$=function(i){let{x:e,y:n}=i.point,{lng:l,lat:u}=i._center;return Kv(e,n,i.worldSize,l,u)},t.a0=Fn,t.a1=Ad,t.a2=ri,t.a3=At,t.a4=Rf,t.a5=class{constructor(i){this.specification=i}possiblyEvaluate(i,e){return function([n,l]){let u=Rs([1,n,l]);return{x:u.x,y:u.y,z:u.z}}(i.expression.evaluate(e))}interpolate(i,e,n){return{x:ri(i.x,e.x,n),y:ri(i.y,e.y,n),z:ri(i.z,e.z,n)}}},t.a6=ym,t.a7=S_,t.a8=Td,t.a9=Pv,t.aB=function(i,e){let{x:n,y:l}=i.point,u=Kv(n,l,i.worldSize/i._pixelsPerMercatorPixel,0,0);return t.ad.multiply(u,u,Qu(Fc(e)))},t.aD=Q_,t.aE=ic,t.aF=Hx,t.aG=function(i,e,n,l,u){let m=5*e+2;i.float32[m+0]=n,i.float32[m+1]=l,i.float32[m+2]=u},t.aH=t1,t.aI=un,t.aJ=uk,t.aK=zv,t.aL=Xr,t.aM=Gb,t.aN=Ak,t.aO=xm,t.aP=Zb,t.aQ=function(i,e,n,l,u,m,p,b,v){if(v.name==="globe")return Zb(i,e,new xm(n,l,u),!1);let S=vg({z:n,x:l,y:u},v);return new dr([(m+S.x/S.scale)*e,e*(S.y/S.scale),p],[(m+S.x2/S.scale)*e,e*(S.y2/S.scale),b])},t.aR=function(i,e,n){let l=0;for(let u=0;u<2;++u)i[u]>0&&(l+=(i[u]-0)*(i[u]-0)),e[u]<0&&(l+=(0-e[u])*(0-e[u]));return l},t.aS=Dr,t.aT=Hb,t.aU=Fv,t.aV=function(i){let e=t.ad.identity(new Float64Array(16));t.ad.multiply(e,i.pixelMatrix,i.globeMatrix);let n=[0,ul,0],l=[0,hl,0];return t._.transformMat4(n,n,e),t._.transformMat4(l,l,e),[n[0]>0&&n[0]<=i.width&&n[1]>0&&n[1]<=i.height&&!A_(i,new un(i.center.lat,90)),l[0]>0&&l[0]<=i.width&&l[1]>0&&l[1]<=i.height&&!A_(i,new un(i.center.lat,-90))]},t.aW=function(i,e){let{scale:n}=i.tileTransform,l=n*At/(i.tileSize*Math.pow(2,e.zoom-i.tileID.overscaledZ+i.tileID.canonical.z));return t.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},t.aX=c1,t.aY=Dk,t.aZ=function(i){let e=Dk(i,!0);return t.aC.invert([],[e[0],e[1],e[4],e[5]])},t.a_=Rc,t.aa=Na,t.ab=tn,t.ac=function(i,e,n){let l=Math.sqrt(i*i+e*e+n*n),u=l>0?Math.acos(n/l)*kh:0,m=i!==0||e!==0?Math.atan2(-e,-i)*kh+90:0;return m<0&&(m+=360),[l,m,u]},t.ae=i0,t.af=Ld,t.ag=nS,t.ah=function(i,e){let n={};for(let l=0;l<e.length;l++){let u=e[l];u in i&&(n[u]=i[u])}return n},t.ai=kd,t.aj=Ac,t.ak=Pc,t.al=fm,t.am=function(i){Nh++,Nh>np&&(i.getActor().send("enforceCacheSizeLimit",kf),Nh=0)},t.an=bt,t.ao=class{constructor(i){this.entries={},this.scheduler=i}request(i,e,n,l){let u=this.entries[i]=this.entries[i]||{callbacks:[]};if(u.result){let[m,p]=u.result;return this.scheduler?this.scheduler.add(()=>{l(m,p)},e):l(m,p),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=n((m,p)=>{u.result=[m,p];for(let b of u.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,p)},e):b(m,p);setTimeout(()=>delete this.entries[i],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(m=>m!==l),u.callbacks.length||(u.cancel(),delete this.entries[i]))}}},t.ap=function(i,e,n){let l=JSON.stringify(i.request);return i.data&&(this.deduped.entries[l]={result:[null,i.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},u=>{let m=nl(i.request,(p,b,v,S)=>{p?u(p):b&&u(null,{vectorTile:n?void 0:new ry(new X_(b)),rawData:b,cacheControl:v,expires:S})});return()=>{m.cancel(),u()}},e)},t.aq=Eb,t.ar=class extends Id{constructor(i){super(i),this.current=Ov}set(i,e,n){if(this.fetchUniformLocation(i,e)){for(let l=0;l<9;l++)if(n[l]!==this.current[l]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},t.as=Db,t.at=Ri,t.au=Ll,t.aw=il,t.ax=ja,t.ay=$o,t.az=function(i,e,n){i[4*e+0]=n[0],i[4*e+1]=n[1],i[4*e+2]=n[2],i[4*e+3]=n[3]},t.b=Ir,t.b$=ih,t.b0=na,t.b1=Ob,t.b2=function(i){let e=Math.round((i+45+360)%360/90)%4;return Kg[e]},t.b3=45,t.b4=Lb,t.b5=Op,t.b6=dr,t.b7=Rs,t.b8=function(i){return[Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)]},t.b9=Sf,t.bA=function(i,e){return[Math.pow(i[0],2.2)*e,Math.pow(i[1],2.2)*e,Math.pow(i[2],2.2)*e]},t.bB=CM,t.bD=Qv,t.bE=uu,t.bF=zh,t.bG=256,t.bH=function(i,e){let n=[0,0,0],l=Aa(Fc(e.canonical));return t._.transformMat4(n,n,l),t._.transformMat4(n,n,i),n},t.bI=i=>({u_camera_to_center_distance:new Na(i),u_extrude_scale:new Ab(i),u_device_pixel_ratio:new Na(i),u_matrix:new ym(i),u_inv_rot_matrix:new ym(i),u_merc_center:new Td(i),u_tile_id:new Eb(i),u_zoom_transition:new Na(i),u_up_dir:new Eb(i),u_emissive_strength:new Na(i)}),t.bJ=i=>({u_matrix:new ym(i),u_pixels_to_tile_units:new Ab(i),u_device_pixel_ratio:new Na(i),u_units_to_pixels:new Td(i),u_dash_image:new S_(i),u_gradient_image:new S_(i),u_image_height:new Na(i),u_texsize:new Td(i),u_tile_units_to_pixels:new Na(i),u_alpha_discard_threshold:new Na(i),u_trim_offset:new Td(i),u_trim_fade_range:new Td(i),u_trim_color:new Db(i),u_emissive_strength:new Na(i)}),t.bK=i=>({u_matrix:new ym(i),u_texsize:new Td(i),u_pixels_to_tile_units:new Ab(i),u_device_pixel_ratio:new Na(i),u_image:new S_(i),u_units_to_pixels:new Td(i),u_tile_units_to_pixels:new Na(i),u_alpha_discard_threshold:new Na(i),u_trim_offset:new Td(i)}),t.bL=b_,t.bM=DR,t.bN=Pa,t.bO=YR,t.bP=ik,t.bQ=X2,t.bR=Qb,t.bS=(i,e,n,l,u,m)=>{let p=i.transform,b=p.projection.name==="globe",v;if(m.paint.get("circle-pitch-alignment")==="map")if(b){let k=Qv(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;v=Float32Array.from([k,0,0,k])}else v=p.calculatePixelsToTileUnitsMatrix(n);else v=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let S={u_camera_to_center_distance:i.transform.getCameraToCenterDistance(p.projection),u_matrix:i.translatePosMatrix(e.projMatrix,n,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Eo.devicePixelRatio,u_extrude_scale:v,u_inv_rot_matrix:pl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(b){S.u_inv_rot_matrix=l,S.u_merc_center=u,S.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],S.u_zoom_transition=Ad(p.zoom);let k=u[0]*At,D=u[1]*At;S.u_up_dir=p.projection.upVector(new xm(0,0,0),k,D)}return S},t.bT=TM,t.bU=(i,e,n,l,u,m)=>{let p=i.transform;return{u_matrix:IM(i,e,n,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:SM(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:m}},t.bV=(i,e,n,l,u,m,p)=>{let b=i.transform,v=b.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:IM(i,e,n,l),u_pixels_to_tile_units:v,u_device_pixel_ratio:m,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:MM(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:SM(e,i.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},t.bW=Km,t.bX=dg,t.bY=se,t.bZ=e2,t.b_=$_,t.ba=function(i,e,n){let l=Ad(n.zoom),u=i.style.map._antialias,m=e.options.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return l===0&&!u&&!m},t.bb=function(i){let e=i.pixelsPerMeter,n=e/ja(1,i.center.lat),l=t.ad.identity(new Float64Array(16));return t.ad.translate(l,l,[i.point.x,i.point.y,0]),t.ad.scale(l,l,[n,n,e]),Float32Array.from(l)},t.bc=Xu,t.bd=function(i){let e=Dr-5;i=Ri(i,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(tn(i))),3);return Math.round(n*(Rb.length-1))},t.be=function(i,e,n,l){let u=e.getNorth(),m=e.getSouth(),p=e.getWest(),b=e.getEast(),v=1<<i.z,S=b-p,k=u-m,D=S/Dp,A=-k/Rb[n],L=[0,D,0,A,0,0,u,p,0];if(i.z>0){let z=180/l;t.bC.multiply(L,L,[z/S+1,0,0,0,z/k+1,0,-.5*z/D,.5*z/A,1])}return L[2]=v,L[5]=i.x,L[8]=i.y,L},t.bf=Aa,t.bg=Fc,t.bh=function(i,e,n){let l=t.ad.identity(new Float64Array(16)),u=(e/(1<<i)-.5)*Math.PI*2;return t.ad.rotateY(l,n.globeMatrix,u),Float32Array.from(l)},t.bi=gc,t.bj=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},t.bk=kk,t.bl=Ek,t.bm=Mk,t.bn=function(i,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let l=0;l<i.length;l++){let u=document.createElement("source");e_(i[l])||(n.crossOrigin="Anonymous"),u.src=i[l],n.appendChild(u)}return{cancel:()=>{}}},t.bo=i1,t.bp=Ph,t.bq=class{isDataAvailableAtPoint(i){let e=this._source();if(this.isUsingMockSource()||!e||i.y<0||i.y>1)return!1;let n=e.getSource().maxzoom,l=1<<n,u=Math.floor(i.x),m=Math.floor((i.x-u)*l),p=Math.floor(i.y*l),b=this.findDEMTileFor(new Xr(n,u,n,m,p));return!(!b||!b.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let l=this._source();if(!l||i.y<0||i.y>1)return e;let u=l.getSource().maxzoom,m=1<<u,p=Math.floor(i.x),b=i.x-p,v=new Xr(u,p,u,Math.floor(b*m),Math.floor(i.y*m)),S=this.findDEMTileFor(v);if(!S||!S.dem)return e;let k=S.dem,D=1<<S.tileID.canonical.z,A=(b*D-S.tileID.canonical.x)*k.dim,L=(i.y*D-S.tileID.canonical.y)*k.dim,z=Math.floor(A),V=Math.floor(L);return(n?this.exaggeration():1)*ri(ri(k.get(z,V),k.get(z,V+1),L-V),ri(k.get(z+1,V),k.get(z+1,V+1),L-V),A-z)}getAtTileOffset(i,e,n){let l=1<<i.canonical.z;return this.getAtPointOrZero(new la(i.wrap+(i.canonical.x+e/At)/l,(i.canonical.y+n/At)/l))}getAtTileOffsetFunc(i,e,n,l){return u=>{let m=this.getAtTileOffset(i,u.x,u.y),p=l.upVector(i.canonical,u.x,u.y),b=l.upVectorScale(i.canonical,e,n).metersToTile;return t._.scale(p,p,m*b),p}}getForTilePoints(i,e,n,l){if(this.isUsingMockSource())return!1;let u=th.create(this,i,l);return!!u&&(e.forEach(m=>{m[2]=this.exaggeration()*u.getElevationAt(m[0],m[1],n)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(i);if(!e||!e.dem)return null;let n=e.dem.tree,l=e.tileID,u=1<<i.canonical.z-l.canonical.z,m=i.canonical.x/u-l.canonical.x,p=i.canonical.y/u-l.canonical.y,b=0;for(let v=0;v<i.canonical.z-l.canonical.z&&!n.leaves[b];v++){m*=2,p*=2;let S=2*Math.floor(p)+Math.floor(m);b=n.childOffsets[b]+S,m%=1,p%=1}return{min:this.exaggeration()*n.minimums[b],max:this.exaggeration()*n.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let i=this.visibleDemTiles;if(i.length===0)return null;let e=!1,n=Number.MAX_VALUE,l=Number.MIN_VALUE;for(let u of i){let m=this.getMinMaxForTile(u.tileID);m&&(n=Math.min(n,m.min),l=Math.max(l,m.max),e=!0)}return e?{min:n,max:l}:null}},t.br=Zu,t.bs=Qr,t.bt=ys,t.bu=xo,t.bv=xg,t.bw=yS,t.bx=m1,t.by=o1,t.bz=sx,t.c=Xk,t.c$=gs,t.c0=450,t.c1=7,t.c2=ZF,t.c3=xk,t.c4=256,t.c5=Zv,t.c6=Qu,t.c7=xn,t.c8=ju,t.c9=bm,t.cA=function(i){let e=1/0,n=1/0,l=-1/0,u=-1/0;for(let m of i)e=Math.min(e,m.x),n=Math.min(n,m.y),l=Math.max(l,m.x),u=Math.max(u,m.y);return{min:new gt(e,n),max:new gt(l,u)}},t.cB=Yu,t.cC=Bb,t.cD=Va,t.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.cF=ZM,t.cG=Vb,t.cH=Cx,t.cI=Sx,t.cJ=eS,t.cK=TS,t.cL=function(i){return i({pluginStatus:pt,pluginURL:nt}),bi.on("pluginStateChange",i),i},t.cM=J_,t.cN=K2,t.cO=jh,t.cP=$t,t.cQ=N,t.cR=Bh,t.cS=yu,t.cT=po,t.cU=function(i){let e=i.indexOf(Vu);return e>=0?i.slice(0,e):i},t.cV=function(i){return i.indexOf(Vu)>=0},t.cW=function(i){let e=i.indexOf(Vu);return e>=0?i.slice(e+1):""},t.cX=function(i){let e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},t.cY=function(i,e,n,l){return i.type==="custom"?new KF(i,e):new kL[i.type](i,e,n,l)},t.cZ=dd,t.c_=bi,t.ca=1,t.cb=gy,t.cc=0,t.cd=v_,t.ce=function(i,e,n,l,u){return Ri((i-e)/(n-e)*(u-l)+l,l,u)},t.cf=Xf,t.cg=$u,t.ch=class{constructor(i,e,n,l){this.context=i,this.format=l,this.size=n,this.texture=i.gl.createTexture();let[u,m,p]=this.size,{gl:b}=i;b.bindTexture(b.TEXTURE_3D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(!1);let v=this.format,S=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(v=b.DEPTH_COMPONENT16,S=b.UNSIGNED_SHORT),this.format===b.R8&&(l=b.RED),this.format===b.R32F&&(S=b.FLOAT,l=b.RED),b.texImage3D(b.TEXTURE_3D,0,v,u,m,p,0,l,S,e.data)}bind(i,e){let{context:n}=this,{gl:l}=n;l.bindTexture(l.TEXTURE_3D,this.texture),i!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,i),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,i),this.minFilter=i),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}},t.ci=fS,t.cj=[1,1,1],t.ck=th,t.cl=a0,t.cm=Wu,t.cn=kp,t.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new gt(1/0,1/0),max:new gt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(i,e=!1){let n=xx(new gt(0,0),new gt(At,At),i),l=[];if(e&&!ay(n,this._globalClipBounds))return l;for(let u of this._activeRegions){if(u.hiddenByOverlap||!ay(n,u))continue;let m=Ss(u.min,u.max,i);l.push({min:m.min,max:m.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask})}return l}setSources(i){this._setSources(i.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let l of e.cache.getVisibleCoordinates()){let u=e.cache.getTile(l).buckets[e.layer];u&&u.updateFootprints(l.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(i){let e=i.getFootprints();if(e.length===0)return;let n=i.getOrder(),l=i.getClipMask();for(let u of e){if(!u.footprint)continue;let m=xx(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:n,clipMask:l})}this._sourceIds.push(i.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||N_(e.min,n.min)||N_(e.max,n.max));let i=this._activeRegions.length!==this._prevRegions.length;if(!i){let e=0;for(;!i&&e!==this._activeRegions.length;){let n=this._activeRegions[e],l=this._prevRegions[e];i=n.priority!==l.priority||!V_(n,l)||n.order!==l.order||n.clipMask!==l.clipMask,++e}}if(i){++this._updateTime;for(let n of this._activeRegions)n.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));let e=n=>{let l=this._activeRegions;if(n>=l.length)return n;let u=l[n].priority;for(;n<l.length&&l[n].priority===u;)++n;return n};if(this._sourceIds.length>1){let n=0,l=e(n);for(;n!==l;){let u=n,m=n;for(;u!==l;){let p=this._activeRegions[u];p.hiddenByOverlap=!1;for(let b=0;b<m;b++){let v=this._activeRegions[b];if(!v.hiddenByOverlap&&p.order===1/0&&ay(p,v)&&(p.hiddenByOverlap=wx(p.footprint,p.tileId,v.footprint,v.tileId),p.hiddenByOverlap))break}++u}n=l,l=e(n)}}}}_setSources(i){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=i.length-1;e>=0;e--)this._addSource(i[e]);this._computeReplacement()}},t.cp=Da,t.cq=r1,t.cr=tg,t.cs=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let i of this._poleSegments)i.destroy();for(let i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy()}_fillGridMeshWithLods(i,e){let n=new ys,l=new xo,u=[],m=i+1+2,p=e[0]+1,b=e[0]+1+(1+e.length),v=(S,k,D)=>{let A=S===m-1?S-2:S===0?S:S-1;return A+=D?24575:0,[A,k]};for(let S=0;S<m;++S)n.emplaceBack(...v(S,0,!0));for(let S=0;S<p;++S)for(let k=0;k<m;++k)n.emplaceBack(...v(k,S,(k===0||k===m-1)&&!0));for(let S=0;S<e.length;++S){let k=e[S];for(let D=0;D<m;++D)n.emplaceBack(...v(D,k,!0))}for(let S=0;S<e.length;++S){let k=l.length,D=e[S]+1+2,A=new xo;for(let V=0;V<D-1;V++){let H=V===D-2,Y=H?m*(b-e.length+S-V):m;for(let ne=0;ne<m-1;ne++){let re=V*m+ne;V===0||H||ne===0||ne===m-2?(A.emplaceBack(re+1,re,re+Y),A.emplaceBack(re+Y,re+Y+1,re+1)):(l.emplaceBack(re+1,re,re+Y),l.emplaceBack(re+Y,re+Y+1,re+1))}}let L=Ir.simpleSegment(0,k,n.length,l.length-k);for(let V=0;V<A.uint16.length;V+=3)l.emplaceBack(A.uint16[V],A.uint16[V+1],A.uint16[V+2]);let z=Ir.simpleSegment(0,k,n.length,l.length-k);u.push({withoutSkirts:L,withSkirts:z})}return{vertices:n,indices:l,segments:u}}_createGrid(i){let e=this._fillGridMeshWithLods(Dp,Rb);this._gridSegments=e.segments,this._gridBuffer=i.createVertexBuffer(e.vertices,Zu.members),this._gridIndexBuffer=i.createIndexBuffer(e.indices,!0)}_createPoles(i){let e=new xo;for(let p=0;p<=Dp;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);let n=new bm,l=new bm,u=new bm,m=new bm;this._poleSegments=[];for(let p=0,b=0;p<Ob;p++){let v=360/(1<<p);n.emplaceBack(0,-Va,0,.5,0),l.emplaceBack(0,-Va,0,.5,1),u.emplaceBack(0,-Va,0,.5,.5),m.emplaceBack(0,-Va,0,.5,.5);for(let S=0;S<=Dp;S++){let k=S/Dp,D=0,A=ri(0,v,k),[L,z,V]=Ap(En,ex,A,Va);n.emplaceBack(L,z,V,k,D),l.emplaceBack(L,z,V,k,1-D);let H=tn(A);k=.5+.5*Math.sin(H),D=.5+.5*Math.cos(H),u.emplaceBack(L,z,V,k,D),m.emplaceBack(L,z,V,k,1-D)}this._poleSegments.push(Ir.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(n,ml,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(l,ml,!1),this._texturedPoleNorthVertexBuffer=i.createVertexBuffer(u,ml,!1),this._texturedPoleSouthVertexBuffer=i.createVertexBuffer(m,ml,!1)}getGridBuffers(i,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}},t.ct=function(i){return bc.has(i)},t.cu=G_,t.cv=function(i,e,n=0,l=!0){let u=new gt(n,n),m=i.sub(u),p=e.add(u),b=[m,new gt(p.x,m.y),p,new gt(m.x,p.y)];return l&&b.push(m.clone()),b},t.cw=function(i,e){let n=[];for(let l=0;l<i.length;l++){let u=Ll(l-1,-1,i.length-1),m=Ll(l+1,-1,i.length-1),p=i[l],b=i[m],v=i[u].sub(p).unit(),S=b.sub(p).unit(),k=S.angleWithSep(v.x,v.y),D=v.add(S).unit().mult(-1*e/Math.sin(k/2));n.push(p.add(D))}return n},t.cx=ak,t.cy=Hv,t.cz=function(i,e,n=0){return t._.fromValues(((e.x-n)*i.scale-i.x)*At,(e.y*i.scale-i.y)*At,Bv(e.z,e.y))},t.d=dp,t.d$=Qm,t.d0=Eh,t.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},t.d2=cd,t.d3=zb,t.d4=vm,t.d5=function([i,e,n]){let l=Math.hypot(i,e,n),u=Math.atan2(i,n),m=.5*Math.PI-Math.acos(-e/l);return new un(na(u),na(m))},t.d6=ts,t.d7=Pp,t.d8=M,t.d9=A_,t.dA=function(i){let e=mu();if(!e)return;let n=e.delete(ip);i&&n.catch(i).then(()=>i())},t.dB=xy,t.dC=jk,t.dD=function(i){xS=Eo.resolveURL(i),l0||(l0=new yS(m1(),new md)),l0.broadcast("setDracoUrl",xS)},t.dE=Uk,t.dF=function(i){s0=Eo.resolveURL(i),l0||(l0=new yS(m1(),new md)),l0.broadcast("setMeshoptUrl",s0)},t.dG=Ya,t.dH=de,t.dI=Ku,t.dJ=Fd,t.dK=vg,t.dL=Tb,t.dM=kM,t.dN=FM,t.dO=xM,t.dP=jo,t.dQ=QM,t.dR=n0,t.dS=function(i,e,n,l,u,m,p,b,v,S,k){i.createArrays(),i.tilePixelRatio=At/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;let D=i.layers[0].layout,A=i.layers[0]._unevaluatedLayout._values,L={};if(i.textSizeData.kind==="composite"){let{minZoom:Y,maxZoom:ne}=i.textSizeData;L.compositeTextSizes=[A["text-size"].possiblyEvaluate(new Vt(Y),b),A["text-size"].possiblyEvaluate(new Vt(ne),b)]}if(i.iconSizeData.kind==="composite"){let{minZoom:Y,maxZoom:ne}=i.iconSizeData;L.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new Vt(Y),b),A["icon-size"].possiblyEvaluate(new Vt(ne),b)]}L.layoutTextSize=A["text-size"].possiblyEvaluate(new Vt(v+1),b),L.layoutIconSize=A["icon-size"].possiblyEvaluate(new Vt(v+1),b),L.textMaxSize=A["text-size"].possiblyEvaluate(new Vt(18),b);let z=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",V=D.get("text-size"),H=!1;for(let Y of i.features)if(Y.icon&&Y.icon.nameSecondary){H=!0;break}for(let Y of i.features){let ne=D.get("text-font").evaluate(Y,{},b).join(","),re=V.evaluate(Y,{},b),oe=L.layoutTextSize.evaluate(Y,{},b),xe=(L.layoutIconSize.evaluate(Y,{},b),{horizontal:{},vertical:void 0}),be=Y.text,ke,Ae=[0,0];if(be){let $e=be.toString(),st=D.get("text-letter-spacing").evaluate(Y,{},b)*Pa,vt=D.get("text-line-height").evaluate(Y,{},b)*Pa,at=qe($e)?st:0,ht=D.get("text-anchor").evaluate(Y,{},b),tt=D.get("text-variable-anchor");if(!tt){let xt=D.get("text-radial-offset").evaluate(Y,{},b);Ae=xt?ik(ht,[xt*Pa,J2]):D.get("text-offset").evaluate(Y,{},b).map(Mt=>Mt*Pa)}let mt=z?"center":D.get("text-justify").evaluate(Y,{},b),Ct=D.get("symbol-placement")==="point",ft=Ct?D.get("text-max-width").evaluate(Y,{},b)*Pa:1/0,Ht=xt=>{i.allowVerticalPlacement&&He($e)&&(xe.vertical=Z2(be,e,n,u,ne,ft,vt,ht,xt,at,Ae,ic.vertical,!0,oe,re))};if(!z&&tt){let xt=mt==="auto"?tt.map(oi=>eS(oi)):[mt],Mt=!1;for(let oi=0;oi<xt.length;oi++){let ti=xt[oi];if(!xe.horizontal[ti])if(Mt)xe.horizontal[ti]=xe.horizontal[0];else{let Jt=Z2(be,e,n,u,ne,ft,vt,"center",ti,at,Ae,ic.horizontal,!1,oe,re);Jt&&(xe.horizontal[ti]=Jt,Mt=Jt.positionedLines.length===1)}}Ht("left")}else{if(mt==="auto"&&(mt=eS(ht)),Ct||D.get("text-writing-mode").indexOf("horizontal")>=0||!He($e)){let xt=Z2(be,e,n,u,ne,ft,vt,ht,mt,at,Ae,ic.horizontal,!1,oe,re);xt&&(xe.horizontal[mt]=xt)}Ht(Ct?"left":mt)}}let je=!1;if(Y.icon&&Y.icon.namePrimary){let $e=l[Y.icon.namePrimary];$e&&(ke=nF(u[Y.icon.namePrimary],Y.icon.nameSecondary?u[Y.icon.nameSecondary]:void 0,D.get("icon-offset").evaluate(Y,{},b),D.get("icon-anchor").evaluate(Y,{},b)),je=$e.sdf,i.sdfIcons===void 0?i.sdfIcons=$e.sdf:i.sdfIcons!==$e.sdf&&Vr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($e.pixelRatio!==i.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}let Qe=rk(xe.horizontal)||xe.vertical;i.iconsInText||(i.iconsInText=!!Qe&&Qe.iconsInText),(Qe||ke)&&dF(i,Y,xe,ke,l,L,oe,0,Ae,je,p,b,S,k,H)}m&&i.generateCollisionDebugBuffers(v,i.collisionBoxArray)},t.dT=Vx,t.dU=L_,t.dV=ry,t.dW=X_,t.dX=H_,t.dY=uS,t.dZ=B_,t.d_=z_,t.da=Jv,t.db=function(i){let e=[0,0,0],n=t.ad.identity(new Float64Array(16));return t.ad.multiply(n,i.pixelMatrix,i.globeMatrix),t._.transformMat4(e,e,n),new gt(e[0],e[1])},t.dc=Pe,t.dd=Te,t.de=function(i){let e=i.navigator?i.navigator.userAgent:null;return!!function(n){if(Lh==null){let l=n.navigator?n.navigator.userAgent:null;Lh=!!n.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Lh}(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.df=Dh,t.dg=class{constructor(i,e,n){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let i=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ap,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!N(i))return i;let n=Fs(i);return n.params.push(`sdk=js-${g}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!N(i))return i;let n=Fs(i);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(i,e){if(!N(i))return i;let n=Fs(i);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(i,e,n,l){if(!N(i))return i;let u=Fs(i);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),n&&u.params.push(`language=${n}`),l&&u.params.push(`worldview=${l}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(i,e,n,l){let u=Fs(i);return N(i)?(u.path=`/styles/v1${u.path}/sprite${e}${n}`,this._makeAPIURL(u,this._customAccessToken||l)):(u.path+=`${e}${n}`,_u(u))}normalizeTileURL(i,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!N(i))return i;let l=Fs(i);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&l.authority!=="raster"&&n===512?"@2x":""}${rp.supported?".webp":"$1"}`),l.authority==="raster"?l.path=`/${M.RASTER_URL_PREFIX}${l.path}`:l.authority==="rasterarrays"?l.path=`/${M.RASTERARRAYS_URL_PREFIX}${l.path}`:l.authority==="3dtiles"?l.path=`/${M.TILES3D_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${M.TILE_URL_VERSION}${l.path}`);let u=this._customAccessToken||function(m){for(let p of m){let b=p.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(l.params)||M.ACCESS_TOKEN;return M.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,u)}canonicalizeTileURL(i,e){let n=Fs(i);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return i;let l="mapbox://";n.path.match(/^\/raster\/v1\//)?l+=`raster/${n.path.replace(`/${M.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?l+=`rasterarrays/${n.path.replace(`/${M.RASTERARRAYS_URL_PREFIX}/`,"")}`:l+=`tiles/${n.path.replace(`/${M.TILE_URL_VERSION}/`,"")}`;let u=n.params;return e&&(u=u.filter(m=>!m.match(/^access_token=/))),u.length&&(l+=`?${u.join("&")}`),l}canonicalizeTileset(i,e){let n=!!e&&N(e),l=[];for(let u of i.tiles||[])F(u)?l.push(this.canonicalizeTileURL(u,n)):l.push(u);return l}_makeAPIURL(i,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=Fs(M.API_URL);if(i.protocol=l.protocol,i.authority=l.authority,i.protocol==="http"){let u=i.params.indexOf("secure");u>=0&&i.params.splice(u,1)}if(l.path!=="/"&&(i.path=`${l.path}${i.path}`),!M.REQUIRE_ACCESS_TOKEN)return _u(i);if(e=e||M.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return i.params=i.params.filter(u=>u.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),_u(i)}},t.dh=function(i,e){e?bc.add(i):bc.delete(i)},t.di=rp,t.dj=Of,t.dk=Ia,t.dl=Pf,t.dm=sn,t.dn=Do,t.dp=function(i){bc.delete(i)},t.dq=bu,t.dr=hi,t.ds=ps,t.dt=g,t.du=function(i,e){kf=i,np=e},t.dv=function(i,e,n=!1){if(pt===Ot||pt===Rt||pt===Wt)throw new Error("setRTLTextPlugin cannot be called multiple times.");nt=Eo.resolveURL(i),pt=Ot,Ft=e,Ii(),n||Gi()},t.dw=Fi,t.dx=function(){m1().acquire(vS)},t.dy=function(){let i=Cy;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(vS),Cy=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.dz=wy,t.e=Eo,t.e0=EM,t.e1=Ke,t.e2=nl,t.e3=function(i){let e=0;if(new Uint32Array(i,0,1)[0]!==Hk){let n=new Uint32Array(i,0,7),[,,l,u,m,p]=n;e=n.byteLength+u+m+p+m,(l!==i.byteLength||e>=i.byteLength)&&Vr("Invalid b3dm header information.")}return Yk(i,e)},t.e4=function(i,e){let n=Xk(i);for(let l of n){for(let u of l.meshes)SL(u);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(IL(l.lights,e)))}return n},t.e5=_1,t.e6=Vk,t.e7=yn,t.e8=function(i){pu(),fo&&fo.then(e=>{e.keys().then(n=>{for(let l=0;l<n.length-i;l++)e.delete(n[l])})})},t.f=Ta,t.g=function(i,e){return gs(Mo(i,{type:"json"}),e)},t.h=Uo,t.i=Ws,t.j=XM,t.k=Q2,t.l=function(i){return fetch(i).then(e=>e.arrayBuffer()).then(e=>Yk(e,0,i))},t.m=class extends u1{},t.n=Cc,t.o=Vl,t.p=SF,t.q=pm,t.r=f,t.s=a,t.t=j,t.u=Ja,t.v=qo,t.w=Vr,t.x=J,t.y=G,t.z=fp}),r(["./shared"],function(t){function g(De){let Z=De?De.url.toString():void 0;return Z?performance.getEntriesByName(Z):[]}function w(De){if(typeof De=="number"||typeof De=="boolean"||typeof De=="string"||De==null)return JSON.stringify(De);if(Array.isArray(De)){let ie="[";for(let ge of De)ie+=`${w(ge)},`;return`${ie}]`}let Z="{";for(let ie of Object.keys(De).sort())Z+=`${ie}:${w(De[ie])},`;return`${Z}}`}function M(De){let Z="";for(let ie of t.cE)Z+=`/${w(De[ie])}`;return Z}class F{constructor(Z){this.keyCache={},this._layers={},this._layerConfigs={},Z&&this.replace(Z)}replace(Z,ie){this._layerConfigs={},this._layers={},this.update(Z,[],ie)}update(Z,ie,ge){this._options=ge;for(let Me of Z)this._layerConfigs[Me.id]=Me,(this._layers[Me.id]=t.cY(Me,this.scope,null,this._options)).compileFilter(),this.keyCache[Me.id]&&delete this.keyCache[Me.id];for(let Me of ie)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};let Ie=function(Me,Ve){let Ye={};for(let Xe=0;Xe<Me.length;Xe++){let Dt=Ve&&Ve[Me[Xe].id]||M(Me[Xe]);Ve&&(Ve[Me[Xe].id]=Dt);let yt=Ye[Dt];yt||(yt=Ye[Dt]=[]),yt.push(Me[Xe])}let Fe=[];for(let Xe in Ye)Fe.push(Ye[Xe]);return Fe}(t.dG(this._layerConfigs),this.keyCache);for(let Me of Ie){let Ve=Me.map(Kt=>this._layers[Kt.id]),Ye=Ve[0];if(Ye.visibility==="none")continue;let Fe=Ye.source||"",Xe=this.familiesBySource[Fe];Xe||(Xe=this.familiesBySource[Fe]={});let Dt=Ye.sourceLayer||"_geojsonTileLayer",yt=Xe[Dt];yt||(yt=Xe[Dt]=[]),yt.push(Ve)}}}let N=1*t.dJ;class Q{constructor(Z){let ie={},ge=[];for(let Ye in Z){let Fe=Z[Ye],Xe=ie[Ye]={};for(let Dt in Fe.glyphs){let yt=Fe.glyphs[+Dt];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;let Kt=yt.metrics.localGlyph?N:1,ui={x:0,y:0,w:yt.bitmap.width+2*Kt,h:yt.bitmap.height+2*Kt};ge.push(ui),Xe[Dt]=ui}}let{w:Ie,h:Me}=t.j(ge),Ve=new t.dI({width:Ie||1,height:Me||1});for(let Ye in Z){let Fe=Z[Ye];for(let Xe in Fe.glyphs){let Dt=Fe.glyphs[+Xe];if(!Dt||Dt.bitmap.width===0||Dt.bitmap.height===0)continue;let yt=ie[Ye][Xe],Kt=Dt.metrics.localGlyph?N:1;t.dI.copy(Dt.bitmap,Ve,{x:0,y:0},{x:yt.x+Kt,y:yt.y+Kt},Dt.bitmap)}}this.image=Ve,this.positions=ie}}t.dH(Q,"GlyphAtlas");class ae{constructor(Z){this.tileID=new t.aL(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.lut=Z.lut,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.scope=Z.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.promoteId=Z.promoteId,this.isSymbolTile=Z.isSymbolTile,this.tileTransform=t.dK(Z.tileID.canonical,Z.projection),this.projection=Z.projection,this.brightness=Z.brightness,this.extraShadowCaster=!!Z.extraShadowCaster,this.tessellationStep=Z.tessellationStep}parse(Z,ie,ge,Ie,Me){this.status="parsing",this.data=Z,this.collisionBoxArray=new t.dL;let Ve=new t.dM(Object.keys(Z.layers).sort()),Ye=new t.dN(this.tileID,this.promoteId);Ye.bucketLayerIDs=[];let Fe={},Xe=new t.dO(256,256),Dt={featureIndex:Ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Xe,availableImages:ge,brightness:this.brightness},yt=ie.familiesBySource[this.source];for(let Zt in yt){let lr=Z.layers[Zt];if(!lr)continue;let Pn=!1,an=!1,qr=!1;for(let No of yt[Zt])No[0].type==="symbol"?Pn=!0:an=!0,No[0].is3D()&&No[0].type!=="model"&&(qr=!0);if(this.extraShadowCaster&&!qr||this.isSymbolTile===!0&&!Pn||this.isSymbolTile===!1&&!an)continue;lr.version===1&&t.w(`Vector tile source "${this.source}" layer "${Zt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let _r=Ve.encode(Zt),Jr=[];for(let No=0;No<lr.length;No++){let Vo=lr.feature(No),Rl=Ye.getId(Vo,Zt);Jr.push({feature:Vo,id:Rl,index:No,sourceLayerIndex:_r})}for(let No of yt[Zt]){let Vo=No[0];(!this.extraShadowCaster||Vo.is3D()&&Vo.type!=="model")&&(this.isSymbolTile!==void 0&&Vo.type==="symbol"!==this.isSymbolTile||Vo.minzoom&&this.zoom<Math.floor(Vo.minzoom)||Vo.maxzoom&&this.zoom>=Vo.maxzoom||Vo.visibility!=="none"&&(pe(No,this.zoom,Dt.brightness,ge),(Fe[Vo.id]=Vo.createBucket({index:Ye.bucketLayerIDs.length,layers:No,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_r,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Jr,Dt,this.tileID.canonical,this.tileTransform),Ye.bucketLayerIDs.push(No.map(Rl=>Rl.id))))}}let Kt,ui,Oi,Ui;Xe.trim();let Si={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Qi=()=>{if(Kt)return this.status="done",Me(Kt);if(this.extraShadowCaster)this.status="done",Me(null,{buckets:t.dG(Fe).filter(Zt=>!Zt.isEmpty()),featureIndex:Ye,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Dt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(ui&&Oi&&Ui){let Zt=new Q(ui),lr=new t.dQ(Oi,Ui,this.lut);for(let Pn in Fe){let an=Fe[Pn];an instanceof t.dR?(pe(an.layers,this.zoom,Dt.brightness,ge),t.dS(an,ui,Zt.positions,Oi,lr.iconPositions,this.showCollisionBoxes,ge,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):an.hasPattern&&(an instanceof t.dT||an instanceof t.dU||an instanceof t.b_)&&(pe(an.layers,this.zoom,Dt.brightness,ge),an.addFeatures(Dt,this.tileID.canonical,lr.patternPositions,ge,this.tileTransform,this.brightness))}this.status="done",Me(null,{buckets:t.dG(Fe).filter(Pn=>!Pn.isEmpty()),featureIndex:Ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Zt.image,lineAtlas:Xe,imageAtlas:lr,brightness:Dt.brightness})}};if(!this.extraShadowCaster){let Zt=t.dP(Dt.glyphDependencies,an=>Object.keys(an).map(Number));Object.keys(Zt).length?Ie.send("getGlyphs",{uid:this.uid,stacks:Zt,scope:this.scope},(an,qr)=>{Kt||(Kt=an,ui=qr,Qi())},void 0,!1,Si):ui={};let lr=Object.keys(Dt.iconDependencies);lr.length?Ie.send("getImages",{icons:lr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(an,qr)=>{Kt||(Kt=an,Oi=qr,Qi())},void 0,!1,Si):Oi={};let Pn=Object.keys(Dt.patternDependencies);Pn.length?Ie.send("getImages",{icons:Pn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(an,qr)=>{Kt||(Kt=an,Ui=qr,Qi())},void 0,!1,Si):Ui={}}Qi()}}function pe(De,Z,ie,ge){let Ie=new t.X(Z,{brightness:ie});for(let Me of De)Me.recalculate(Ie,ge)}class Te extends t.E{constructor(Z,ie,ge,Ie,Me,Ve){super(),this.actor=Z,this.layerIndex=ie,this.availableImages=ge,this.loadVectorData=Me||t.ap,this.loading={},this.loaded={},this.deduped=new t.ao(Z.scheduler),this.isSpriteLoaded=Ie,this.scheduler=Z.scheduler,this.brightness=Ve}loadTile(Z,ie){let ge=Z.uid,Ie=Z&&Z.request,Me=Ie&&Ie.collectResourceTiming,Ve=this.loading[ge]=new ae(Z);Ve.abort=this.loadVectorData(Z,(Ye,Fe)=>{let Xe=!this.loading[ge];if(delete this.loading[ge],Xe||Ye||!Fe)return Ve.status="done",Xe||(this.loaded[ge]=Ve),ie(Ye);let Dt=Fe.rawData,yt={};Fe.expires&&(yt.expires=Fe.expires),Fe.cacheControl&&(yt.cacheControl=Fe.cacheControl),Ve.vectorTile=Fe.vectorTile||new t.dV(new t.dW(Dt));let Kt=()=>{Ve.parse(Ve.vectorTile,this.layerIndex,this.availableImages,this.actor,(ui,Oi)=>{if(ui||!Oi)return ie(ui);let Ui={};if(Me){let Si=g(Ie);Si.length>0&&(Ui.resourceTiming=JSON.parse(JSON.stringify(Si)))}ie(null,t.W({rawTileData:Dt.slice(0)},Oi,yt,Ui))})};this.isSpriteLoaded?Kt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Kt,{type:"parseTile",isSymbolTile:Z.isSymbolTile,zoom:Z.tileZoom}):Kt()}),this.loaded=this.loaded||{},this.loaded[ge]=Ve})}reloadTile(Z,ie){let ge=this.loaded,Ie=Z.uid;if(ge&&ge[Ie]){let Me=ge[Ie];Me.showCollisionBoxes=Z.showCollisionBoxes,Me.projection=Z.projection,Me.brightness=Z.brightness,Me.tileTransform=t.dK(Z.tileID.canonical,Z.projection),Me.extraShadowCaster=Z.extraShadowCaster,Me.lut=Z.lut;let Ve=(Ye,Fe)=>{let Xe=Me.reloadCallback;Xe&&(delete Me.reloadCallback,Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor,Xe)),ie(Ye,Fe)};Me.status==="parsing"?Me.reloadCallback=Ve:Me.status==="done"&&(Me.vectorTile?Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor,Ve):Ve())}else ie(null,void 0)}abortTile(Z,ie){let ge=Z.uid,Ie=this.loading[ge];Ie&&(Ie.abort&&Ie.abort(),delete this.loading[ge]),ie()}removeTile(Z,ie){let ge=this.loaded,Ie=Z.uid;ge&&ge[Ie]&&delete ge[Ie],ie()}}class Pe{loadTile(Z,ie){let{uid:ge,encoding:Ie,rawImageData:Me,padding:Ve}=Z,Ye=ImageBitmap&&Me instanceof ImageBitmap?this.getImageData(Me,Ve):Me;ie(null,new t.dX(ge,Ye,Ie,Ve<1))}getImageData(Z,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);let ge=this.offscreenCanvasContext.getImageData(-ie,-ie,Z.width+2*ie,Z.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ge}}class Re{decodeRasterArray({task:Z,buffer:ie},ge){t.dY.performDecoding(ie,Z).then(Ie=>{ge(null,Ie)},Ie=>{ge(Ie)})}}let Ke=t.dZ.prototype.toGeoJSON,Je=class{constructor(De){this._feature=De,this.extent=t.a3,this.type=De.type,this.properties=De.tags,"id"in De&&!isNaN(De.id)&&(this.id=parseInt(De.id,10))}loadGeometry(){if(this._feature.type===1){let De=[];for(let Z of this._feature.geometry)De.push([new t.P(Z[0],Z[1])]);return De}{let De=[];for(let Z of this._feature.geometry){let ie=[];for(let ge of Z)ie.push(new t.P(ge[0],ge[1]));De.push(ie)}return De}}toGeoJSON(De,Z,ie){return Ke.call(this,De,Z,ie)}},_t=class{constructor(De){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.a3,this.length=De.length,this._features=De}feature(De){return new Je(this._features[De])}},Nt=64/4096;class kt{constructor(){this.features=new Map}clear(){this.features.clear()}load(Z=[],ie){for(let ge of Z){let Ie=ge.id;if(Ie==null)continue;let Me=this.features.get(Ie);Me&&this.updateCache(Me,ie),ge.geometry?(Me=ni(ge),this.updateCache(Me,ie),this.features.set(Ie,Me)):this.features.delete(Ie),this.updateCache(Me,ie)}}updateCache(Z,ie){for(let{canonical:ge,uid:Ie}of Object.values(ie)){let{z:Me,x:Ve,y:Ye}=ge;Ut(Z,Math.pow(2,Me),Ve,Ye)&&delete ie[Ie]}}getTile(Z,ie,ge){let Ie=Math.pow(2,Z),Me=[];for(let Ve of this.features.values())Ut(Ve,Ie,ie,ge)&&Me.push(Ji(Ve,Ie,ie,ge));return{features:Me}}getFeatures(){return[...this.features.values()]}}function Ut({minX:De,minY:Z,maxX:ie,maxY:ge},Ie,Me,Ve){return De<(Me+1+Nt)/Ie&&Z<(Ve+1+Nt)/Ie&&ie>(Me-Nt)/Ie&&ge>(Ve-Nt)/Ie}function ni(De){let{id:Z,geometry:ie,properties:ge}=De;if(!ie)return;if(ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:Ie,coordinates:Me}=ie,Ve={id:Z,type:1,geometry:[],tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ye=Ve.geometry;if(Ie==="Point")zt(Me,Ye,Ve);else if(Ie==="MultiPoint")for(let Fe of Me)zt(Fe,Ye,Ve);else if(Ie==="LineString")Ve.type=2,pi(Me,Ye,Ve);else if(Ie==="MultiLineString")Ve.type=2,ei(Me,Ye,Ve);else if(Ie==="Polygon")Ve.type=3,ei(Me,Ye,Ve,!0);else{if(Ie!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ve.type=3;for(let Fe of Me)ei(Fe,Ye,Ve,!0)}return Ve}function zt([De,Z],ie,ge){let Ie=t.aj(De),Me=t.ak(Z);Me=Me<0?0:Me>1?1:Me,ie.push(Ie,Me),ge.minX=Math.min(ge.minX,Ie),ge.minY=Math.min(ge.minY,Me),ge.maxX=Math.max(ge.maxX,Ie),ge.maxY=Math.max(ge.maxY,Me)}function pi(De,Z,ie,ge=!1,Ie=!1){let Me=[];for(let Ve of De)zt(Ve,Me,ie);Z.push(Me),ge&&function(Ve,Ye){let Fe=0;for(let Xe=0,Dt=Ve.length,yt=Dt-2;Xe<Dt;yt=Xe,Xe+=2)Fe+=(Ve[Xe]-Ve[yt])*(Ve[Xe+1]+Ve[yt+1]);if(Fe>0===Ye)for(let Xe=0,Dt=Ve.length;Xe<Dt/2;Xe+=2){let yt=Ve[Xe],Kt=Ve[Xe+1];Ve[Xe]=Ve[Dt-2-Xe],Ve[Xe+1]=Ve[Dt-1-Xe],Ve[Dt-2-Xe]=yt,Ve[Dt-1-Xe]=Kt}}(Me,Ie)}function ei(De,Z,ie,ge=!1){for(let Ie=0;Ie<De.length;Ie++)pi(De[Ie],Z,ie,ge,Ie===0)}function Ji(De,Z,ie,ge){let{id:Ie,type:Me,geometry:Ve,tags:Ye}=De,Fe=[];if(Me===1)bn(Ve,Z,ie,ge,Fe);else for(let Xe of Ve)Fe.push(bn(Xe,Z,ie,ge));return{id:Ie,type:Me,geometry:Fe,tags:Ye}}function bn(De,Z,ie,ge,Ie=[]){for(let Me=0;Me<De.length;Me+=2)Ie.push(lo(De[Me],De[Me+1],Z,ie,ge));return Ie}function lo(De,Z,ie,ge,Ie){return[Math.round(t.a3*(De*ie-ge)),Math.round(t.a3*(Z*ie-Ie))]}var Hi={exports:{}},Mn=t.d$,hn=t.d_.VectorTileFeature,Fr=yo;function yo(De,Z){this.options=Z||{},this.features=De,this.length=De.length}function Zn(De,Z){this.id=typeof De.id=="number"?De.id:void 0,this.type=De.type,this.rawGeometry=De.type===1?[De.geometry]:De.geometry,this.properties=De.tags,this.extent=Z||4096}yo.prototype.feature=function(De){return new Zn(this.features[De],this.options.extent)},Zn.prototype.loadGeometry=function(){var De=this.rawGeometry;this.geometry=[];for(var Z=0;Z<De.length;Z++){for(var ie=De[Z],ge=[],Ie=0;Ie<ie.length;Ie++)ge.push(new Mn(ie[Ie][0],ie[Ie][1]));this.geometry.push(ge)}return this.geometry},Zn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var De=this.geometry,Z=1/0,ie=-1/0,ge=1/0,Ie=-1/0,Me=0;Me<De.length;Me++)for(var Ve=De[Me],Ye=0;Ye<Ve.length;Ye++){var Fe=Ve[Ye];Z=Math.min(Z,Fe.x),ie=Math.max(ie,Fe.x),ge=Math.min(ge,Fe.y),Ie=Math.max(Ie,Fe.y)}return[Z,ge,ie,Ie]},Zn.prototype.toGeoJSON=hn.prototype.toGeoJSON;var en=t.e0,As=Fr;function Gr(De){var Z=new en;return function(ie,ge){for(var Ie in ie.layers)ge.writeMessage(3,wa,ie.layers[Ie])}(De,Z),Z.finish()}function wa(De,Z){var ie;Z.writeVarintField(15,De.version||1),Z.writeStringField(1,De.name||""),Z.writeVarintField(5,De.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<De.length;ie++)ge.feature=De.feature(ie),Z.writeMessage(2,Ca,ge);var Ie=ge.keys;for(ie=0;ie<Ie.length;ie++)Z.writeStringField(3,Ie[ie]);var Me=ge.values;for(ie=0;ie<Me.length;ie++)Z.writeMessage(4,td,Me[ie])}function Ca(De,Z){var ie=De.feature;ie.id!==void 0&&Z.writeVarintField(1,ie.id),Z.writeMessage(2,Ys,De),Z.writeVarintField(3,ie.type),Z.writeMessage(4,gr,ie)}function Ys(De,Z){var ie=De.feature,ge=De.keys,Ie=De.values,Me=De.keycache,Ve=De.valuecache;for(var Ye in ie.properties){var Fe=ie.properties[Ye],Xe=Me[Ye];if(Fe!==null){Xe===void 0&&(ge.push(Ye),Me[Ye]=Xe=ge.length-1),Z.writeVarint(Xe);var Dt=typeof Fe;Dt!=="string"&&Dt!=="boolean"&&Dt!=="number"&&(Fe=JSON.stringify(Fe));var yt=Dt+":"+Fe,Kt=Ve[yt];Kt===void 0&&(Ie.push(Fe),Ve[yt]=Kt=Ie.length-1),Z.writeVarint(Kt)}}}function si(De,Z){return(Z<<3)+(7&De)}function Zs(De){return De<<1^De>>31}function gr(De,Z){for(var ie=De.loadGeometry(),ge=De.type,Ie=0,Me=0,Ve=ie.length,Ye=0;Ye<Ve;Ye++){var Fe=ie[Ye],Xe=1;ge===1&&(Xe=Fe.length),Z.writeVarint(si(1,Xe));for(var Dt=ge===3?Fe.length-1:Fe.length,yt=0;yt<Dt;yt++){yt===1&&ge!==1&&Z.writeVarint(si(2,Dt-1));var Kt=Fe[yt].x-Ie,ui=Fe[yt].y-Me;Z.writeVarint(Zs(Kt)),Z.writeVarint(Zs(ui)),Ie+=Kt,Me+=ui}ge===3&&Z.writeVarint(si(7,1))}}function td(De,Z){var ie=typeof De;ie==="string"?Z.writeStringField(1,De):ie==="boolean"?Z.writeBooleanField(7,De):ie==="number"&&(De%1!=0?Z.writeDoubleField(3,De):De<0?Z.writeSVarintField(6,De):Z.writeVarintField(5,De))}Hi.exports=Gr,Hi.exports.fromVectorTileJs=Gr,Hi.exports.fromGeojsonVt=function(De,Z){Z=Z||{};var ie={};for(var ge in De)ie[ge]=new As(De[ge].features,Z),ie[ge].name=ge,ie[ge].version=Z.version,ie[ge].extent=Z.extent;return Gr({layers:ie})},Hi.exports.GeoJSONWrapper=As;var id=t.e1(Hi.exports);let _h={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:De=>De},Sa=Math.fround||(Xs=new Float32Array(1),De=>(Xs[0]=+De,Xs[0]));var Xs;let Ps=3,To=5,Kd=6;class vi{constructor(Z){this.options=Object.assign(Object.create(_h),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){let{log:ie,minZoom:ge,maxZoom:Ie}=this.options;ie&&console.time("total time");let Me=`prepare ${Z.length} points`;ie&&console.time(Me),this.points=Z;let Ve=[];for(let Fe=0;Fe<Z.length;Fe++){let Xe=Z[Fe];if(!Xe.geometry)continue;let[Dt,yt]=Xe.geometry.coordinates,Kt=Sa(zo(Dt)),ui=Sa(Qs(yt));Ve.push(Kt,ui,1/0,Fe,-1,1),this.options.reduce&&Ve.push(0)}let Ye=this.trees[Ie+1]=this._createTree(Ve);ie&&console.timeEnd(Me);for(let Fe=Ie;Fe>=ge;Fe--){let Xe=+Date.now();Ye=this.trees[Fe]=this._createTree(this._cluster(Ye,Fe)),ie&&console.log("z%d: %d clusters in %dms",Fe,Ye.numItems,+Date.now()-Xe)}return ie&&console.timeEnd("total time"),this}getClusters(Z,ie){let ge=((Z[0]+180)%360+360)%360-180,Ie=Math.max(-90,Math.min(90,Z[1])),Me=Z[2]===180?180:((Z[2]+180)%360+360)%360-180,Ve=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ge=-180,Me=180;else if(ge>Me){let yt=this.getClusters([ge,Ie,180,Ve],ie),Kt=this.getClusters([-180,Ie,Me,Ve],ie);return yt.concat(Kt)}let Ye=this.trees[this._limitZoom(ie)],Fe=Ye.range(zo(ge),Qs(Ve),zo(Me),Qs(Ie)),Xe=Ye.data,Dt=[];for(let yt of Fe){let Kt=this.stride*yt;Dt.push(Xe[Kt+To]>1?fi(Xe,Kt,this.clusterProps):this.points[Xe[Kt+Ps]])}return Dt}getChildren(Z){let ie=this._getOriginId(Z),ge=this._getOriginZoom(Z),Ie="No cluster with the specified id.",Me=this.trees[ge];if(!Me)throw new Error(Ie);let Ve=Me.data;if(ie*this.stride>=Ve.length)throw new Error(Ie);let Ye=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),Fe=Me.within(Ve[ie*this.stride],Ve[ie*this.stride+1],Ye),Xe=[];for(let Dt of Fe){let yt=Dt*this.stride;Ve[yt+4]===Z&&Xe.push(Ve[yt+To]>1?fi(Ve,yt,this.clusterProps):this.points[Ve[yt+Ps]])}if(Xe.length===0)throw new Error(Ie);return Xe}getLeaves(Z,ie,ge){let Ie=[];return this._appendLeaves(Ie,Z,ie=ie||10,ge=ge||0,0),Ie}getTile(Z,ie,ge){let Ie=this.trees[this._limitZoom(Z)],Me=Math.pow(2,Z),{extent:Ve,radius:Ye}=this.options,Fe=Ye/Ve,Xe=(ge-Fe)/Me,Dt=(ge+1+Fe)/Me,yt={features:[]};return this._addTileFeatures(Ie.range((ie-Fe)/Me,Xe,(ie+1+Fe)/Me,Dt),Ie.data,ie,ge,Me,yt),ie===0&&this._addTileFeatures(Ie.range(1-Fe/Me,Xe,1,Dt),Ie.data,Me,ge,Me,yt),ie===Me-1&&this._addTileFeatures(Ie.range(0,Xe,Fe/Me,Dt),Ie.data,-1,ge,Me,yt),yt.features.length?yt:null}getClusterExpansionZoom(Z){let ie=this._getOriginZoom(Z)-1;for(;ie<=this.options.maxZoom;){let ge=this.getChildren(Z);if(ie++,ge.length!==1)break;Z=ge[0].properties.cluster_id}return ie}_appendLeaves(Z,ie,ge,Ie,Me){let Ve=this.getChildren(ie);for(let Ye of Ve){let Fe=Ye.properties;if(Fe&&Fe.cluster?Me+Fe.point_count<=Ie?Me+=Fe.point_count:Me=this._appendLeaves(Z,Fe.cluster_id,ge,Ie,Me):Me<Ie?Me++:Z.push(Ye),Z.length===ge)break}return Me}_createTree(Z){let ie=new t.cK(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<Z.length;ge+=this.stride)ie.add(Z[ge],Z[ge+1]);return ie.finish(),ie.data=Z,ie}_addTileFeatures(Z,ie,ge,Ie,Me,Ve){for(let Ye of Z){let Fe=Ye*this.stride,Xe=ie[Fe+To]>1,Dt,yt,Kt;if(Xe)Dt=da(ie,Fe,this.clusterProps),yt=ie[Fe],Kt=ie[Fe+1];else{let Ui=this.points[ie[Fe+Ps]];Dt=Ui.properties;let[Si,Qi]=Ui.geometry.coordinates;yt=zo(Si),Kt=Qs(Qi)}let ui={type:1,geometry:[[Math.round(this.options.extent*(yt*Me-ge)),Math.round(this.options.extent*(Kt*Me-Ie))]],tags:Dt},Oi;Oi=Xe||this.options.generateId?ie[Fe+Ps]:this.points[ie[Fe+Ps]].id,Oi!==void 0&&(ui.id=Oi),Ve.features.push(ui)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,ie){let{radius:ge,extent:Ie,reduce:Me,minPoints:Ve}=this.options,Ye=ge/(Ie*Math.pow(2,ie)),Fe=Z.data,Xe=[],Dt=this.stride;for(let yt=0;yt<Fe.length;yt+=Dt){if(Fe[yt+2]<=ie)continue;Fe[yt+2]=ie;let Kt=Fe[yt],ui=Fe[yt+1],Oi=Z.within(Fe[yt],Fe[yt+1],Ye),Ui=Fe[yt+To],Si=Ui;for(let Qi of Oi){let Zt=Qi*Dt;Fe[Zt+2]>ie&&(Si+=Fe[Zt+To])}if(Si>Ui&&Si>=Ve){let Qi,Zt=Kt*Ui,lr=ui*Ui,Pn=-1,an=(yt/Dt<<5)+(ie+1)+this.points.length;for(let qr of Oi){let _r=qr*Dt;if(Fe[_r+2]<=ie)continue;Fe[_r+2]=ie;let Jr=Fe[_r+To];Zt+=Fe[_r]*Jr,lr+=Fe[_r+1]*Jr,Fe[_r+4]=an,Me&&(Qi||(Qi=this._map(Fe,yt,!0),Pn=this.clusterProps.length,this.clusterProps.push(Qi)),Me(Qi,this._map(Fe,_r)))}Fe[yt+4]=an,Xe.push(Zt/Si,lr/Si,1/0,an,-1,Si),Me&&Xe.push(Pn)}else{for(let Qi=0;Qi<Dt;Qi++)Xe.push(Fe[yt+Qi]);if(Si>1)for(let Qi of Oi){let Zt=Qi*Dt;if(!(Fe[Zt+2]<=ie)){Fe[Zt+2]=ie;for(let lr=0;lr<Dt;lr++)Xe.push(Fe[Zt+lr])}}}}return Xe}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,ie,ge){if(Z[ie+To]>1){let Ve=this.clusterProps[Z[ie+Kd]];return ge?Object.assign({},Ve):Ve}let Ie=this.points[Z[ie+Ps]].properties,Me=this.options.map(Ie);return ge&&Me===Ie?Object.assign({},Me):Me}}function fi(De,Z,ie){return{type:"Feature",id:De[Z+Ps],properties:da(De,Z,ie),geometry:{type:"Point",coordinates:[(ge=De[Z],360*(ge-.5)),Jd(De[Z+1])]}};var ge}function da(De,Z,ie){let ge=De[Z+To],Ie=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Me=De[Z+Kd],Ve=Me===-1?{}:Object.assign({},ie[Me]);return Object.assign(Ve,{cluster:!0,cluster_id:De[Z+Ps],point_count:ge,point_count_abbreviated:Ie})}function zo(De){return De/360+.5}function Qs(De){let Z=Math.sin(De*Math.PI/180),ie=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return ie<0?0:ie>1?1:ie}function Jd(De){let Z=(180-360*De)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function Ks(De,Z,ie,ge){let Ie=ge,Me=Z+(ie-Z>>1),Ve,Ye=ie-Z,Fe=De[Z],Xe=De[Z+1],Dt=De[ie],yt=De[ie+1];for(let Kt=Z+3;Kt<ie;Kt+=3){let ui=bh(De[Kt],De[Kt+1],Fe,Xe,Dt,yt);if(ui>Ie)Ve=Kt,Ie=ui;else if(ui===Ie){let Oi=Math.abs(Kt-Me);Oi<Ye&&(Ve=Kt,Ye=Oi)}}Ie>ge&&(Ve-Z>3&&Ks(De,Z,Ve,ge),De[Ve+2]=Ie,ie-Ve>3&&Ks(De,Ve,ie,ge))}function bh(De,Z,ie,ge,Ie,Me){let Ve=Ie-ie,Ye=Me-ge;if(Ve!==0||Ye!==0){let Fe=((De-ie)*Ve+(Z-ge)*Ye)/(Ve*Ve+Ye*Ye);Fe>1?(ie=Ie,ge=Me):Fe>0&&(ie+=Ve*Fe,ge+=Ye*Fe)}return Ve=De-ie,Ye=Z-ge,Ve*Ve+Ye*Ye}function ds(De,Z,ie,ge){let Ie={id:De??null,type:Z,geometry:ie,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Z==="Point"||Z==="MultiPoint"||Z==="LineString")us(Ie,ie);else if(Z==="Polygon")us(Ie,ie[0]);else if(Z==="MultiLineString")for(let Me of ie)us(Ie,Me);else if(Z==="MultiPolygon")for(let Me of ie)us(Ie,Me[0]);return Ie}function us(De,Z){for(let ie=0;ie<Z.length;ie+=3)De.minX=Math.min(De.minX,Z[ie]),De.minY=Math.min(De.minY,Z[ie+1]),De.maxX=Math.max(De.maxX,Z[ie]),De.maxY=Math.max(De.maxY,Z[ie+1])}function sc(De,Z,ie,ge){if(!Z.geometry)return;let Ie=Z.geometry.coordinates;if(Ie&&Ie.length===0)return;let Me=Z.geometry.type,Ve=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2),Ye=[],Fe=Z.id;if(ie.promoteId?Fe=Z.properties[ie.promoteId]:ie.generateId&&(Fe=ge||0),Me==="Point")nd(Ie,Ye);else if(Me==="MultiPoint")for(let Xe of Ie)nd(Xe,Ye);else if(Me==="LineString")lc(Ie,Ye,Ve,!1);else if(Me==="MultiLineString"){if(ie.lineMetrics){for(let Xe of Ie)Ye=[],lc(Xe,Ye,Ve,!1),De.push(ds(Fe,"LineString",Ye,Z.properties));return}cc(Ie,Ye,Ve,!1)}else if(Me==="Polygon")cc(Ie,Ye,Ve,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(let Xe of Z.geometry.geometries)sc(De,{id:Fe,geometry:Xe,properties:Z.properties},ie,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Xe of Ie){let Dt=[];cc(Xe,Dt,Ve,!0),Ye.push(Dt)}}De.push(ds(Fe,Me,Ye,Z.properties))}function nd(De,Z){Z.push(Fa(De[0]),eu(De[1]),0)}function lc(De,Z,ie,ge){let Ie,Me,Ve=0;for(let Fe=0;Fe<De.length;Fe++){let Xe=Fa(De[Fe][0]),Dt=eu(De[Fe][1]);Z.push(Xe,Dt,0),Fe>0&&(Ve+=ge?(Ie*Dt-Xe*Me)/2:Math.sqrt(Math.pow(Xe-Ie,2)+Math.pow(Dt-Me,2))),Ie=Xe,Me=Dt}let Ye=Z.length-3;Z[2]=1,Ks(Z,0,Ye,ie),Z[Ye+2]=1,Z.size=Math.abs(Ve),Z.start=0,Z.end=Z.size}function cc(De,Z,ie,ge){for(let Ie=0;Ie<De.length;Ie++){let Me=[];lc(De[Ie],Me,ie,ge),Z.push(Me)}}function Fa(De){return De/360+.5}function eu(De){let Z=Math.sin(De*Math.PI/180),ie=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return ie<0?0:ie>1?1:ie}function _i(De,Z,ie,ge,Ie,Me,Ve,Ye){if(ge/=Z,Me>=(ie/=Z)&&Ve<ge)return De;if(Ve<ie||Me>=ge)return null;let Fe=[];for(let Xe of De){let Dt=Xe.geometry,yt=Xe.type,Kt=Ie===0?Xe.minX:Xe.minY,ui=Ie===0?Xe.maxX:Xe.maxY;if(Kt>=ie&&ui<ge){Fe.push(Xe);continue}if(ui<ie||Kt>=ge)continue;let Oi=[];if(yt==="Point"||yt==="MultiPoint")rd(Dt,Oi,ie,ge,Ie);else if(yt==="LineString")wr(Dt,Oi,ie,ge,Ie,!1,Ye.lineMetrics);else if(yt==="MultiLineString")od(Dt,Oi,ie,ge,Ie,!1);else if(yt==="Polygon")od(Dt,Oi,ie,ge,Ie,!0);else if(yt==="MultiPolygon")for(let Ui of Dt){let Si=[];od(Ui,Si,ie,ge,Ie,!0),Si.length&&Oi.push(Si)}if(Oi.length){if(Ye.lineMetrics&&yt==="LineString"){for(let Ui of Oi)Fe.push(ds(Xe.id,yt,Ui,Xe.tags));continue}yt!=="LineString"&&yt!=="MultiLineString"||(Oi.length===1?(yt="LineString",Oi=Oi[0]):yt="MultiLineString"),yt!=="Point"&&yt!=="MultiPoint"||(yt=Oi.length===3?"Point":"MultiPoint"),Fe.push(ds(Xe.id,yt,Oi,Xe.tags))}}return Fe.length?Fe:null}function rd(De,Z,ie,ge,Ie){for(let Me=0;Me<De.length;Me+=3){let Ve=De[Me+Ie];Ve>=ie&&Ve<=ge&&Js(Z,De[Me],De[Me+1],De[Me+2])}}function wr(De,Z,ie,ge,Ie,Me,Ve){let Ye=tu(De),Fe=Ie===0?Os:iu,Xe,Dt,yt=De.start;for(let Si=0;Si<De.length-3;Si+=3){let Qi=De[Si],Zt=De[Si+1],lr=De[Si+2],Pn=De[Si+3],an=De[Si+4],qr=Ie===0?Qi:Zt,_r=Ie===0?Pn:an,Jr=!1;Ve&&(Xe=Math.sqrt(Math.pow(Qi-Pn,2)+Math.pow(Zt-an,2))),qr<ie?_r>ie&&(Dt=Fe(Ye,Qi,Zt,Pn,an,ie),Ve&&(Ye.start=yt+Xe*Dt)):qr>ge?_r<ge&&(Dt=Fe(Ye,Qi,Zt,Pn,an,ge),Ve&&(Ye.start=yt+Xe*Dt)):Js(Ye,Qi,Zt,lr),_r<ie&&qr>=ie&&(Dt=Fe(Ye,Qi,Zt,Pn,an,ie),Jr=!0),_r>ge&&qr<=ge&&(Dt=Fe(Ye,Qi,Zt,Pn,an,ge),Jr=!0),!Me&&Jr&&(Ve&&(Ye.end=yt+Xe*Dt),Z.push(Ye),Ye=tu(De)),Ve&&(yt+=Xe)}let Kt=De.length-3,ui=De[Kt],Oi=De[Kt+1],Ui=Ie===0?ui:Oi;Ui>=ie&&Ui<=ge&&Js(Ye,ui,Oi,De[Kt+2]),Kt=Ye.length-3,Me&&Kt>=3&&(Ye[Kt]!==Ye[0]||Ye[Kt+1]!==Ye[1])&&Js(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&Z.push(Ye)}function tu(De){let Z=[];return Z.size=De.size,Z.start=De.start,Z.end=De.end,Z}function od(De,Z,ie,ge,Ie,Me){for(let Ve of De)wr(Ve,Z,ie,ge,Ie,Me,!1)}function Js(De,Z,ie,ge){De.push(Z,ie,ge)}function Os(De,Z,ie,ge,Ie,Me){let Ve=(Me-Z)/(ge-Z);return Js(De,Me,ie+(Ie-ie)*Ve,1),Ve}function iu(De,Z,ie,ge,Ie,Me){let Ve=(Me-ie)/(Ie-ie);return Js(De,Z+(ge-Z)*Ve,Me,1),Ve}function dc(De,Z){let ie=[];for(let ge=0;ge<De.length;ge++){let Ie=De[ge],Me=Ie.type,Ve;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")Ve=uc(Ie.geometry,Z);else if(Me==="MultiLineString"||Me==="Polygon"){Ve=[];for(let Ye of Ie.geometry)Ve.push(uc(Ye,Z))}else if(Me==="MultiPolygon"){Ve=[];for(let Ye of Ie.geometry){let Fe=[];for(let Xe of Ye)Fe.push(uc(Xe,Z));Ve.push(Fe)}}ie.push(ds(Ie.id,Me,Ve,Ie.tags))}return ie}function uc(De,Z){let ie=[];ie.size=De.size,De.start!==void 0&&(ie.start=De.start,ie.end=De.end);for(let ge=0;ge<De.length;ge+=3)ie.push(De[ge]+Z,De[ge+1],De[ge+2]);return ie}function nu(De,Z){if(De.transformed)return De;let ie=1<<De.z,ge=De.x,Ie=De.y;for(let Me of De.features){let Ve=Me.geometry,Ye=Me.type;if(Me.geometry=[],Ye===1)for(let Fe=0;Fe<Ve.length;Fe+=2)Me.geometry.push(ru(Ve[Fe],Ve[Fe+1],Z,ie,ge,Ie));else for(let Fe=0;Fe<Ve.length;Fe++){let Xe=[];for(let Dt=0;Dt<Ve[Fe].length;Dt+=2)Xe.push(ru(Ve[Fe][Dt],Ve[Fe][Dt+1],Z,ie,ge,Ie));Me.geometry.push(Xe)}}return De.transformed=!0,De}function ru(De,Z,ie,ge,Ie,Me){return[Math.round(ie*(De*ge-Ie)),Math.round(ie*(Z*ge-Me))]}function yh(De,Z,ie,ge,Ie){let Me=Z===Ie.maxZoom?0:Ie.tolerance/((1<<Z)*Ie.extent),Ve={features:[],numPoints:0,numSimplified:0,numFeatures:De.length,source:null,x:ie,y:ge,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ye of De)ou(Ve,Ye,Me,Ie);return Ve}function ou(De,Z,ie,ge){let Ie=Z.geometry,Me=Z.type,Ve=[];if(De.minX=Math.min(De.minX,Z.minX),De.minY=Math.min(De.minY,Z.minY),De.maxX=Math.max(De.maxX,Z.maxX),De.maxY=Math.max(De.maxY,Z.maxY),Me==="Point"||Me==="MultiPoint")for(let Ye=0;Ye<Ie.length;Ye+=3)Ve.push(Ie[Ye],Ie[Ye+1]),De.numPoints++,De.numSimplified++;else if(Me==="LineString")hs(Ve,Ie,De,ie,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(let Ye=0;Ye<Ie.length;Ye++)hs(Ve,Ie[Ye],De,ie,Me==="Polygon",Ye===0);else if(Me==="MultiPolygon")for(let Ye=0;Ye<Ie.length;Ye++){let Fe=Ie[Ye];for(let Xe=0;Xe<Fe.length;Xe++)hs(Ve,Fe[Xe],De,ie,!0,Xe===0)}if(Ve.length){let Ye=Z.tags||null;if(Me==="LineString"&&ge.lineMetrics){Ye={};for(let Xe in Z.tags)Ye[Xe]=Z.tags[Xe];Ye.mapbox_clip_start=Ie.start/Ie.size,Ye.mapbox_clip_end=Ie.end/Ie.size}let Fe={geometry:Ve,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:Ye};Z.id!==null&&(Fe.id=Z.id),De.features.push(Fe)}}function hs(De,Z,ie,ge,Ie,Me){let Ve=ge*ge;if(ge>0&&Z.size<(Ie?Ve:ge))return void(ie.numPoints+=Z.length/3);let Ye=[];for(let Fe=0;Fe<Z.length;Fe+=3)(ge===0||Z[Fe+2]>Ve)&&(ie.numSimplified++,Ye.push(Z[Fe],Z[Fe+1])),ie.numPoints++;Ie&&function(Fe,Xe){let Dt=0;for(let yt=0,Kt=Fe.length,ui=Kt-2;yt<Kt;ui=yt,yt+=2)Dt+=(Fe[yt]-Fe[ui])*(Fe[yt+1]+Fe[ui+1]);if(Dt>0===Xe)for(let yt=0,Kt=Fe.length;yt<Kt/2;yt+=2){let ui=Fe[yt],Oi=Fe[yt+1];Fe[yt]=Fe[Kt-2-yt],Fe[yt+1]=Fe[Kt-1-yt],Fe[Kt-2-yt]=ui,Fe[Kt-1-yt]=Oi}}(Ye,Me),De.push(Ye)}let hc={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class La{constructor(Z,ie){let ge=(ie=this.options=function(Me,Ve){for(let Ye in Ve)Me[Ye]=Ve[Ye];return Me}(Object.create(hc),ie)).debug;if(ge&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ie=function(Me,Ve){let Ye=[];if(Me.type==="FeatureCollection")for(let Fe=0;Fe<Me.features.length;Fe++)sc(Ye,Me.features[Fe],Ve,Fe);else sc(Ye,Me.type==="Feature"?Me:{geometry:Me},Ve);return Ye}(Z,ie);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ie=function(Me,Ve){let Ye=Ve.buffer/Ve.extent,Fe=Me,Xe=_i(Me,1,-1-Ye,Ye,0,-1,2,Ve),Dt=_i(Me,1,1-Ye,2+Ye,0,-1,2,Ve);return(Xe||Dt)&&(Fe=_i(Me,1,-Ye,1+Ye,0,-1,2,Ve)||[],Xe&&(Fe=dc(Xe,1).concat(Fe)),Dt&&(Fe=Fe.concat(dc(Dt,-1)))),Fe}(Ie,ie),Ie.length&&this.splitTile(Ie,0,0,0),ge&&(Ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Z,ie,ge,Ie,Me,Ve,Ye){let Fe=[Z,ie,ge,Ie],Xe=this.options,Dt=Xe.debug;for(;Fe.length;){Ie=Fe.pop(),ge=Fe.pop(),ie=Fe.pop(),Z=Fe.pop();let yt=1<<ie,Kt=Bo(ie,ge,Ie),ui=this.tiles[Kt];if(!ui&&(Dt>1&&console.time("creation"),ui=this.tiles[Kt]=yh(Z,ie,ge,Ie,Xe),this.tileCoords.push({z:ie,x:ge,y:Ie}),Dt)){Dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,ge,Ie,ui.numFeatures,ui.numPoints,ui.numSimplified),console.timeEnd("creation"));let Jr=`z${ie}`;this.stats[Jr]=(this.stats[Jr]||0)+1,this.total++}if(ui.source=Z,Me==null){if(ie===Xe.indexMaxZoom||ui.numPoints<=Xe.indexMaxPoints)continue}else{if(ie===Xe.maxZoom||ie===Me)continue;if(Me!=null){let Jr=Me-ie;if(ge!==Ve>>Jr||Ie!==Ye>>Jr)continue}}if(ui.source=null,Z.length===0)continue;Dt>1&&console.time("clipping");let Oi=.5*Xe.buffer/Xe.extent,Ui=.5-Oi,Si=.5+Oi,Qi=1+Oi,Zt=null,lr=null,Pn=null,an=null,qr=_i(Z,yt,ge-Oi,ge+Si,0,ui.minX,ui.maxX,Xe),_r=_i(Z,yt,ge+Ui,ge+Qi,0,ui.minX,ui.maxX,Xe);Z=null,qr&&(Zt=_i(qr,yt,Ie-Oi,Ie+Si,1,ui.minY,ui.maxY,Xe),lr=_i(qr,yt,Ie+Ui,Ie+Qi,1,ui.minY,ui.maxY,Xe),qr=null),_r&&(Pn=_i(_r,yt,Ie-Oi,Ie+Si,1,ui.minY,ui.maxY,Xe),an=_i(_r,yt,Ie+Ui,Ie+Qi,1,ui.minY,ui.maxY,Xe),_r=null),Dt>1&&console.timeEnd("clipping"),Fe.push(Zt||[],ie+1,2*ge,2*Ie),Fe.push(lr||[],ie+1,2*ge,2*Ie+1),Fe.push(Pn||[],ie+1,2*ge+1,2*Ie),Fe.push(an||[],ie+1,2*ge+1,2*Ie+1)}}getTile(Z,ie,ge){Z=+Z,ie=+ie,ge=+ge;let Ie=this.options,{extent:Me,debug:Ve}=Ie;if(Z<0||Z>24)return null;let Ye=1<<Z,Fe=Bo(Z,ie=ie+Ye&Ye-1,ge);if(this.tiles[Fe])return nu(this.tiles[Fe],Me);Ve>1&&console.log("drilling down to z%d-%d-%d",Z,ie,ge);let Xe,Dt=Z,yt=ie,Kt=ge;for(;!Xe&&Dt>0;)Dt--,yt>>=1,Kt>>=1,Xe=this.tiles[Bo(Dt,yt,Kt)];return Xe&&Xe.source?(Ve>1&&(console.log("found parent tile z%d-%d-%d",Dt,yt,Kt),console.time("drilling down")),this.splitTile(Xe.source,Dt,yt,Kt,Z,ie,ge),Ve>1&&console.timeEnd("drilling down"),this.tiles[Fe]?nu(this.tiles[Fe],Me):null):null}}function Bo(De,Z,ie){return 32*((1<<De)*ie+Z)+De}function au(De,Z){let ie=De.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);let ge=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!ge)return Z(null,null);let Ie=new _t(ge.features),Me=id(Ie);Me.byteOffset===0&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),Z(null,{vectorTile:Ie,rawData:Me.buffer})}class ad extends Te{constructor(Z,ie,ge,Ie,Me,Ve){super(Z,ie,ge,Ie,au,Ve),Me&&(this.loadGeoJSON=Me),this._dynamicIndex=new kt}loadData(Z,ie){let ge=Z&&Z.request,Ie=ge&&ge.collectResourceTiming;this.loadGeoJSON(Z,(Me,Ve)=>{if(Me||!Ve)return ie(Me);if(typeof Ve!="object")return ie(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{try{if(Z.filter){let Fe=t.y(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Fe.result==="error")throw new Error(Fe.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));Ve.features=Ve.features.filter(Xe=>Fe.value.evaluate({zoom:0},Xe))}Z.dynamic?(Ve.type==="Feature"&&(Ve={type:"FeatureCollection",features:[Ve]}),Z.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ve.features,this.loaded),Z.cluster&&(Ve.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Z.cluster?new vi(function({superclusterOptions:Fe,clusterProperties:Xe}){if(!Xe||!Fe)return Fe;let Dt={},yt={},Kt={accumulated:null,zoom:0},ui={properties:null},Oi=Object.keys(Xe);for(let Ui of Oi){let[Si,Qi]=Xe[Ui],Zt=t.y(Qi),lr=t.y(typeof Si=="string"?[Si,["accumulated"],["get",Ui]]:Si);Dt[Ui]=Zt.value,yt[Ui]=lr.value}return Fe.map=Ui=>{ui.properties=Ui;let Si={};for(let Qi of Oi)Si[Qi]=Dt[Qi].evaluate(Kt,ui);return Si},Fe.reduce=(Ui,Si)=>{ui.properties=Si;for(let Qi of Oi)Kt.accumulated=Ui[Qi],Ui[Qi]=yt[Qi].evaluate(Kt,ui)},Fe}(Z)).load(Ve.features):Z.dynamic?this._dynamicIndex:function(Fe,Xe){return new La(Fe,Xe)}(Ve,Z.geojsonVtOptions)}catch(Fe){return ie(Fe)}let Ye={};if(Ie){let Fe=g(ge);Fe&&(Ye.resourceTiming={},Ye.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Fe)))}ie(null,Ye)}})}reloadTile(Z,ie){let ge=this.loaded;return ge&&ge[Z.uid]?Z.partial?ie(null,void 0):super.reloadTile(Z,ie):this.loadTile(Z,ie)}loadGeoJSON(Z,ie){if(Z.request)t.g(Z.request,ie);else{if(typeof Z.data!="string")return ie(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(Z.data))}catch{return ie(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ge){ie(ge)}}getClusterChildren(Z,ie){try{ie(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ge){ie(ge)}}getClusterLeaves(Z,ie){try{ie(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ge){ie(ge)}}}class su{constructor(Z,ie){this.tileID=new t.aL(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Z.projection,this.brightness=ie}parse(Z,ie,ge,Ie){this.status="parsing";let Me=new t.aL(ge.tileID.overscaledZ,ge.tileID.wrap,ge.tileID.canonical.z,ge.tileID.canonical.x,ge.tileID.canonical.y),Ve={},Ye=ie.familiesBySource[ge.source],Fe=new t.dN(Me,ge.promoteId);return Fe.bucketLayerIDs=[],Fe.is3DTile=!0,t.e3(Z).then(Xe=>{if(!Xe)return Ie(new Error("Could not parse tile"));let Dt=t.e4(Xe,1/t.b5(ge.tileID.canonical)),yt=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Xe.json.asset.extras&&Xe.json.asset.extras.MAPBOX_mesh_features,Kt=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("EXT_meshopt_compression"),ui=new t.X(this.zoom,{brightness:this.brightness});for(let Oi in Ye)for(let Ui of Ye[Oi]){let Si=Ui[0];Fe.bucketLayerIDs.push(Ui.map(Zt=>Zt.id)),Si.recalculate(ui,[]);let Qi=new t.e5(Dt,Me,yt,Kt,this.brightness,Fe);yt||(Qi.needsUpload=!0),Ve[Si.fqid]=Qi,Qi.evaluate(Si)}this.status="done",Ie(null,{buckets:Ve,featureIndex:Fe})}).catch(Xe=>Ie(new Error(Xe.message)))}}class vh{constructor(Z,ie,ge,Ie,Me,Ve){this.actor=Z,this.layerIndex=ie,this.brightness=Ve,this.loading={},this.loaded={}}loadTile(Z,ie){let ge=Z.uid,Ie=this.loading[ge]=new su(Z,this.brightness);t.e2(Z.request,(Me,Ve)=>{let Ye=!this.loading[ge];return delete this.loading[ge],Ye||Me?(Ie.status="done",Ye||(this.loaded[ge]=Ie),ie(Me)):Ve&&Ve.byteLength!==0?void Ie.parse(Ve,this.layerIndex,Z,(Fe,Xe)=>{Ie.status="done",this.loaded=this.loaded||{},this.loaded[ge]=Ie,Fe||!Xe?ie(Fe):ie(null,Xe)}):(Ie.status="done",this.loaded[ge]=Ie,ie())})}reloadTile(Z,ie){let ge=this.loaded,Ie=Z.uid;if(ge&&ge[Ie]){let Me=ge[Ie];Me.projection=Z.projection,Me.brightness=Z.brightness;let Ve=(Ye,Fe)=>{Me.reloadCallback&&(delete Me.reloadCallback,this.loadTile(Z,ie)),ie(Ye,Fe)};Me.status==="parsing"?Me.reloadCallback=Ve:Me.status==="done"&&this.loadTile(Z,ie)}}abortTile(Z,ie){let ge=Z.uid;this.loading[ge]&&delete this.loading[ge],ie()}removeTile(Z,ie){let ge=this.loaded,Ie=Z.uid;ge&&ge[Ie]&&delete ge[Ie],ie()}}class lu{constructor(Z){this.self=Z,this.actor=new t.e6(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.aJ({name:"mercator"}),this.workerSourceTypes={vector:Te,geojson:ad,"batched-model":vh},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ie,ge)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=ge},this.self.registerRTLTextPlugin=ie=>{if(t.e7.isParsed())throw new Error("RTL text plugin already registered.");t.e7.applyArabicShaping=ie.applyArabicShaping,t.e7.processBidirectionalText=ie.processBidirectionalText,t.e7.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(Z,ie,ge){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],delete this.rasterArrayWorkerSource,ge()}checkIfReady(Z,ie,ge){ge()}setReferrer(Z,ie){this.referrer=ie}spriteLoaded(Z,{scope:ie,isLoaded:ge}){if(this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),this.isSpriteLoaded[Z][ie]=ge,this.workerSources[Z]&&this.workerSources[Z][ie])for(let Ie in this.workerSources[Z][ie]){let Me=this.workerSources[Z][ie][Ie];for(let Ve in Me){let Ye=Me[Ve];Ye instanceof Te&&(Ye.isSpriteLoaded=ge,Ye.fire(new t.f("isSpriteLoaded")))}}}setImages(Z,{scope:ie,images:ge},Ie){if(this.availableImages[Z]||(this.availableImages[Z]={}),this.availableImages[Z][ie]=ge,this.workerSources[Z]&&this.workerSources[Z][ie]){for(let Me in this.workerSources[Z][ie]){let Ve=this.workerSources[Z][ie][Me];for(let Ye in Ve)Ve[Ye].availableImages=ge}Ie()}else Ie()}setProjection(Z,ie){this.projections[Z]=t.aJ(ie)}setBrightness(Z,ie,ge){this.brightness=ie,ge()}setLayers(Z,ie,ge){this.getLayerIndex(Z,ie.scope).replace(ie.layers,ie.options),ge()}updateLayers(Z,ie,ge){this.getLayerIndex(Z,ie.scope).update(ie.layers,ie.removedIds,ie.options),ge()}loadTile(Z,ie,ge){ie.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,ie.type,ie.source,ie.scope).loadTile(ie,ge)}loadDEMTile(Z,ie,ge){this.getDEMWorkerSource(Z,ie.source,ie.scope).loadTile(ie,ge)}decodeRasterArray(Z,ie,ge){this.getRasterArrayWorkerSource().decodeRasterArray(ie,ge)}reloadTile(Z,ie,ge){ie.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,ie.type,ie.source,ie.scope).reloadTile(ie,ge)}abortTile(Z,ie,ge){this.getWorkerSource(Z,ie.type,ie.source,ie.scope).abortTile(ie,ge)}removeTile(Z,ie,ge){this.getWorkerSource(Z,ie.type,ie.source,ie.scope).removeTile(ie,ge)}removeSource(Z,ie,ge){if(!(this.workerSources[Z]&&this.workerSources[Z][ie.scope]&&this.workerSources[Z][ie.scope][ie.type]&&this.workerSources[Z][ie.scope][ie.type][ie.source]))return;let Ie=this.workerSources[Z][ie.scope][ie.type][ie.source];delete this.workerSources[Z][ie.scope][ie.type][ie.source],Ie.removeSource!==void 0?Ie.removeSource(ie,ge):ge()}loadWorkerSource(Z,ie,ge){try{this.self.importScripts(ie.url),ge()}catch(Ie){ge(Ie.toString())}}syncRTLPluginState(Z,ie,ge){try{t.e7.setState(ie);let Ie=t.e7.getPluginURL();if(t.e7.isLoaded()&&!t.e7.isParsed()&&Ie!=null){this.self.importScripts(Ie);let Me=t.e7.isParsed();ge(Me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ie}`),Me)}}catch(Ie){ge(Ie.toString())}}setDracoUrl(Z,ie){this.dracoUrl=ie}getAvailableImages(Z,ie){this.availableImages[Z]||(this.availableImages[Z]={});let ge=this.availableImages[Z][ie];return ge||(ge=[]),ge}getLayerIndex(Z,ie){this.layerIndexes[Z]||(this.layerIndexes[Z]={});let ge=this.layerIndexes[Z][ie];return ge||(ge=this.layerIndexes[Z][ie]=new F,ge.scope=ie),ge}getWorkerSource(Z,ie,ge,Ie){return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][Ie]||(this.workerSources[Z][Ie]={}),this.workerSources[Z][Ie][ie]||(this.workerSources[Z][Ie][ie]={}),this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),this.workerSources[Z][Ie][ie][ge]||(this.workerSources[Z][Ie][ie][ge]=new this.workerSourceTypes[ie]({send:(Me,Ve,Ye,Fe,Xe,Dt)=>{this.actor.send(Me,Ve,Ye,Z,Xe,Dt)},scheduler:this.actor.scheduler},this.getLayerIndex(Z,Ie),this.getAvailableImages(Z,Ie),this.isSpriteLoaded[Z][Ie],void 0,this.brightness)),this.workerSources[Z][Ie][ie][ge]}getDEMWorkerSource(Z,ie,ge){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][ge]||(this.demWorkerSources[Z][ge]={}),this.demWorkerSources[Z][ge][ie]||(this.demWorkerSources[Z][ge][ie]=new Pe),this.demWorkerSources[Z][ge][ie]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Re),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Z,ie){t.e8(ie)}getWorkerPerformanceMetrics(Z,ie,ge){ge(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new lu(self)),lu}),r(["./shared"],function(t){function g(f,a){if(Array.isArray(f)){if(!Array.isArray(a)||f.length!==a.length)return!1;for(let h=0;h<f.length;h++)if(!g(f[h],a[h]))return!1;return!0}if(typeof f=="object"&&f!==null&&a!==null){if(typeof a!="object"||Object.keys(f).length!==Object.keys(a).length)return!1;for(let h in f)if(!g(f[h],a[h]))return!1;return!0}return f===a}var w=M;function M(f){return!function(a){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,C=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(C);try{x=new Worker(T),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(T),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var C=x.getImageData(0,0,1,1);return C&&C.width===_.width}()?(F[h=a&&a.failIfMajorPerformanceCaveat]===void 0&&(F[h]=function(_){var x,C=function(T){var E=document.createElement("canvas"),P=Object.create(M.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=T,E.getContext("webgl2",P)}(_);if(!C)return!1;try{x=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!x||C.isContextLost())&&(C.shaderSource(x,"void main() {}"),C.compileShader(x),C.getShaderParameter(x,C.COMPILE_STATUS)===!0)}(h)),F[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var h}(f)}var F={};function N(f,a,h){let _=document.createElement(f);return a!=null&&(_.className=a),h&&h.appendChild(_),_}function Q(f,a,h){let _=document.createElementNS("http://www.w3.org/2000/svg",f);for(let x of Object.keys(a))_.setAttributeNS(null,x,String(a[x]));return h&&h.appendChild(_),_}M.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let ae=typeof document<"u"?document.documentElement&&document.documentElement.style:null,pe=ae&&ae.userSelect!==void 0?"userSelect":"WebkitUserSelect",Te;function Pe(){ae&&pe&&(Te=ae[pe],ae[pe]="none")}function Re(){ae&&pe&&(ae[pe]=Te)}function Ke(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Ke,!0)}function Je(){window.addEventListener("click",Ke,!0),window.setTimeout(()=>{window.removeEventListener("click",Ke,!0)},0)}function _t(f,a){let h=f.getBoundingClientRect();return Ut(f,h,a)}function Nt(f,a){let h=f.getBoundingClientRect(),_=[];for(let x=0;x<a.length;x++)_.push(Ut(f,h,a[x]));return _}function kt(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function Ut(f,a,h){let _=f.offsetWidth===a.width?1:f.offsetWidth/a.width;return new t.P((h.clientX-a.left)*_,(h.clientY-a.top)*_)}class ni{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(a,h){this._updatedSourceCaches[a]=h,this.setDirty()}discardSourceCacheUpdate(a){delete this._updatedSourceCaches[a]}updateLayer(a){let h=a.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(a.id),this.setDirty()}removeLayer(a){let h=a.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][a.id]=a,this._updatedLayers[h].delete(a.id),this._updatedPaintProps.delete(a.fqid),this.setDirty()}getRemovedLayer(a){return this._removedLayers[a.scope]?this._removedLayers[a.scope][a.id]:null}discardLayerRemoval(a){this._removedLayers[a.scope]&&delete this._removedLayers[a.scope][a.id]}getLayerUpdatesByScope(){let a={};for(let h in this._updatedLayers)a[h]=a[h]||{},a[h].updatedIds=Array.from(this._updatedLayers[h].values());for(let h in this._removedLayers)a[h]=a[h]||{},a[h].removedIds=Object.keys(this._removedLayers[h]);return a}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(a){this._updatedPaintProps.add(a.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(a){this._updatedImages.add(a),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let zt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pi{constructor(a,h,_,x,C,T){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.instanceCount=T,this.context=a;let E=a.gl;this.buffer=E.createBuffer(),a.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||C||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){let h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,h){for(let _=0;_<this.attributes.length;_++){let x=h.attributes[this.attributes[_].name];x!==void 0&&a.enableVertexAttribArray(x)}}setVertexAttribPointers(a,h,_){for(let x=0;x<this.attributes.length;x++){let C=this.attributes[x],T=h.attributes[C.name];T!==void 0&&a.vertexAttribPointer(T,C.components,a[zt[C.type]],!1,this.itemSize,C.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(a,h,_){for(let x=0;x<this.attributes.length;x++){let C=h.attributes[this.attributes[x].name];C!==void 0&&this.instanceCount&&this.instanceCount>0&&a.vertexAttribDivisor(C,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ei{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ji extends ei{getDefault(){return t.C.transparent}set(a){let h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class bn extends ei{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class lo extends ei{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Hi extends ei{getDefault(){return[!0,!0,!0,!0]}set(a){let h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Mn extends ei{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class hn extends ei{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Fr extends ei{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){let h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class yo extends ei{getDefault(){let a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){let h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Zn extends ei{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}}class en extends ei{getDefault(){return[0,1]}set(a){let h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class As extends ei{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}}class Gr extends ei{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class wa extends ei{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}}class Ca extends ei{getDefault(){let a=this.gl;return[a.ONE,a.ZERO,a.ONE,a.ZERO]}set(a){let h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Ys extends ei{getDefault(){return t.C.transparent}set(a){let h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class si extends ei{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(a,a),this.current=a,this.dirty=!1)}}class Zs extends ei{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}}class gr extends ei{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class td extends ei{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let id=class extends ei{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class _h extends ei{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Sa extends ei{getDefault(){let a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){let h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Xs extends ei{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Ps extends ei{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class To extends ei{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class Kd extends ei{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class vi extends ei{getDefault(){return null}set(a){let h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class fi extends ei{getDefault(){return null}set(a){this.gl&&(a!==this.current||this.dirty)&&(this.gl.bindVertexArray(a),this.current=a,this.dirty=!1)}}class da extends ei{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class zo extends ei{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Qs extends ei{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Jd extends ei{constructor(a,h){super(a),this.context=a,this.parent=h}getDefault(){return null}}class Ks extends Jd{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class bh extends Jd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class ds extends Jd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class us extends bh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class sc{constructor(a,h,_,x,C){this.context=a,this.width=h,this.height=_;let T=this.framebuffer=a.gl.createFramebuffer();x&&(this.colorAttachment=new Ks(a,T)),C&&(this.depthAttachmentType=C,this.depthAttachment=C==="renderbuffer"?new bh(a,T):new ds(a,T))}destroy(){let a=this.context.gl;if(this.colorAttachment){let h=this.colorAttachment.get();h&&a.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let h=this.depthAttachment.get();h&&a.deleteRenderbuffer(h)}else{let h=this.depthAttachment.get();h&&a.deleteTexture(h)}a.deleteFramebuffer(this.framebuffer)}}class nd{constructor(a,h){this.gl=a,this.clearColor=new Ji(this),this.clearDepth=new bn(this),this.clearStencil=new lo(this),this.colorMask=new Hi(this),this.depthMask=new Mn(this),this.stencilMask=new hn(this),this.stencilFunc=new Fr(this),this.stencilOp=new yo(this),this.stencilTest=new Zn(this),this.depthRange=new en(this),this.depthTest=new As(this),this.depthFunc=new Gr(this),this.blend=new wa(this),this.blendFunc=new Ca(this),this.blendColor=new Ys(this),this.blendEquation=new si(this),this.cullFace=new Zs(this),this.cullFaceSide=new gr(this),this.frontFace=new td(this),this.program=new id(this),this.activeTexture=new _h(this),this.viewport=new Sa(this),this.bindFramebuffer=new Xs(this),this.bindRenderbuffer=new Ps(this),this.bindTexture=new To(this),this.bindVertexBuffer=new Kd(this),this.bindElementBuffer=new vi(this),this.bindVertexArrayOES=new fi(this),this.pixelStoreUnpack=new da(this),this.pixelStoreUnpackPremultiplyAlpha=new zo(this),this.pixelStoreUnpackFlipY=new Qs(this),this.options=h?Dn({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=a.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),this.maxPointSize=a.getParameter(a.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,h,_){return new t.I(this,a,h,_)}createVertexBuffer(a,h,_,x,C){return new pi(this,a,h,_,x,C)}createRenderbuffer(a,h,_){let x=this.gl,C=x.createRenderbuffer();return this.bindRenderbuffer.set(C),x.renderbufferStorage(x.RENDERBUFFER,a,h,_),this.bindRenderbuffer.set(null),C}createFramebuffer(a,h,_,x){return new sc(this,a,h,_,x)}clear({color:a,depth:h,stencil:_,colorMask:x}){let C=this.gl,T=0;a&&(T|=C.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set(x||[!0,!0,!0,!0])),h!==void 0&&(T|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),_!==void 0&&(T|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),C.clear(T)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){g(a.blendFunction,t.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor),a.blendEquation?this.blendEquation.set(a.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(a.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class lc{constructor(a){this._gl=a.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let a=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,a}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class cc{constructor(a){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,a.registerParameter(this,["Symbols"],"useOcclusionQueries"),a.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),a.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),a.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),a.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),a.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class Fa{constructor(a,h,_,x){let C={width:_[0],height:_[1],data:null},T=a.gl;this.targetColorTexture=new t.T(a,C,T.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new t.T(a,C,T.RGBA,{useMipmap:!1}),this.context=a,this.updateParticleTexture(h,x),this.lastInvalidatedAt=0}updateParticleTexture(a,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let _=this.context.gl,x=h.width*h.height;this.particleTexture0=new t.T(this.context,h,_.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new t.T(this.context,h,_.RGBA,{premultiply:!1,useMipmap:!1});let C=new t.S;C.reserve(x);for(let T=0;T<x;T++)C.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(C,t.p.members,!0),this.particleSegment=t.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(a){return!(this.lastInvalidatedAt<a&&(this.lastInvalidatedAt=t.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class eu extends t.E{constructor(a){super(),this.requestManager=a,this.models={"":{}},this.numModelsLoading={}}loadModel(a,h){return t.l(this.requestManager.transformRequest(h,t.R.Model).url).then(_=>{if(!_)return;let x=t.c(_),C=new t.M(a,void 0,void 0,x);return C.computeBoundsAndApplyParent(),C}).catch(_=>{if(_&&_.status===404)return null;this.fire(new t.d(new Error(`Could not load model ${a} from ${h}: ${_.message}`)))})}load(a,h){this.models[h]||(this.models[h]={});let _=Object.keys(a);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+_.length;let x=[];for(let C of _)x.push(this.loadModel(C,a[C]));Promise.allSettled(x).then(C=>{for(let T=0;T<C.length;T++){let{status:E,value:P}=C[T];E==="fulfilled"&&P&&(this.models[h][_[T]]={model:P,numReferences:1})}this.numModelsLoading[h]-=_.length,this.fire(new t.f("data",{dataType:"style"}))}).catch(C=>{this.fire(new t.d(new Error(`Could not load models: ${C.message}`)))})}isLoaded(){for(let a in this.numModelsLoading)if(this.numModelsLoading[a]>0)return!1;return!0}hasModel(a,h){return!!this.getModel(a,h)}getModel(a,h){return this.models[h]||(this.models[h]={}),this.models[h][a]?this.models[h][a].model:void 0}addModel(a,h,_){this.models[_]||(this.models[_]={}),this.hasModel(a,_)&&this.models[_][a].numReferences++,this.load({[a]:this.requestManager.normalizeModelURL(h)},_)}addModels(a,h){this.models[h]||(this.models[h]={});let _={};for(let x in a)this.models[h][x]={},_[x]=this.requestManager.normalizeModelURL(a[x]);this.load(_,h)}addModelsFromBucket(a,h){this.models[h]||(this.models[h]={});let _={};for(let x of a)this.hasModel(x,h)?this.models[h][x].numReferences++:_[x]=this.requestManager.normalizeModelURL(x);this.load(_,h)}removeModel(a,h){if(this.models[h]&&this.models[h][a]&&(this.models[h][a].numReferences--,this.models[h][a].numReferences===0)){let _=this.models[h][a].model;delete this.models[h][a],_.destroy()}}listModels(a){return this.models[a]||(this.models[a]={}),Object.keys(this.models[a])}upload(a,h){this.models[h]||(this.models[h]={});for(let _ in this.models[h])this.models[h][_].model&&this.models[h][_].model.upload(a.context)}}function _i(f){let{userImage:a}=f;return!!(a&&a.render&&a.render())&&(f.data.replace(new Uint8Array(a.data.buffer)),!0)}class rd extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(a){this.images[a]={},this.loaded[a]=!1,this.updatedImages[a]={},this.patterns[a]={},this.callbackDispatchedThisFrame[a]={},this.atlasImage[a]=new t.i({width:1,height:1})}isLoaded(){for(let a in this.loaded)if(!this.loaded[a])return!1;return!0}setLoaded(a,h){if(this.loaded[h]!==a&&(this.loaded[h]=a,a)){for(let{ids:_,callback:x}of this.requestors)this._notify(_,h,x);this.requestors=[]}}hasImage(a,h){return!!this.getImage(a,h)}getImage(a,h){return this.images[h][a]}addImage(a,h,_){this._validate(a,_)&&(this.images[h][a]=_)}_validate(a,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new t.d(new Error(`Image "${a}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new t.d(new Error(`Image "${a}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new t.d(new Error(`Image "${a}" has invalid "content" value`))),_=!1),_}_validateStretch(a,h){if(!a)return!0;let _=0;for(let x of a){if(x[0]<_||x[1]<x[0]||h<x[1])return!1;_=x[1]}return!0}_validateContent(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,h,_){_.version=this.images[h][a].version+1,this.images[h][a]=_,this.updatedImages[h][a]=!0}removeImage(a,h){let _=this.images[h][a];delete this.images[h][a],delete this.patterns[h][a],_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(a){return Object.keys(this.images[a])}getImages(a,h,_){let x=!0,C=!!this.loaded[h];if(!C)for(let T of a)this.images[h][T]||(x=!1);C||x?this._notify(a,h,_):this.requestors.push({ids:a,scope:h,callback:_})}getUpdatedImages(a){return this.updatedImages[a]}_notify(a,h,_){let x={};for(let C of a){this.images[h][C]||this.fire(new t.f("styleimagemissing",{id:C}));let T=this.images[h][C];T?x[C]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:t.w(`Image "${C}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}_(null,x)}getPixelSize(a){let{width:h,height:_}=this.atlasImage[a];return{width:h,height:_}}getPattern(a,h,_){let x=this.patterns[h][a],C=this.getImage(a,h);if(!C)return null;if(x&&x.position.version===C.version)return x.position;if(x)x.position.version=C.version;else{let T={w:C.data.width+2,h:C.data.height+2,x:0,y:0},E=new t.k(T,C);this.patterns[h][a]={bin:T,position:E}}return this._updatePatternAtlas(h,_),this.patterns[h][a].position}bind(a,h){let _=a.gl,x=this.atlasTexture[h];x?this.dirty&&(x.update(this.atlasImage[h]),this.dirty=!1):(x=new t.T(a,this.atlasImage[h],_.RGBA),this.atlasTexture[h]=x),x.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(a,h){let _=[];for(let E in this.patterns[a])_.push(this.patterns[a][E].bin);let{w:x,h:C}=t.j(_),T=this.atlasImage[a];T.resize({width:x||1,height:C||1});for(let E in this.patterns[a]){let{bin:P}=this.patterns[a][E],O=P.x+1,B=P.y+1,j=this.images[a][E].data,G=j.width,q=j.height;t.i.copy(j,T,{x:0,y:0},{x:O,y:B},{width:G,height:q},h),t.i.copy(j,T,{x:0,y:q-1},{x:O,y:B-1},{width:G,height:1},h),t.i.copy(j,T,{x:0,y:0},{x:O,y:B+q},{width:G,height:1},h),t.i.copy(j,T,{x:G-1,y:0},{x:O-1,y:B},{width:1,height:q},h),t.i.copy(j,T,{x:0,y:0},{x:O+G,y:B},{width:1,height:q},h)}this.dirty=!0}beginFrame(){for(let a in this.images)this.callbackDispatchedThisFrame[a]={}}dispatchRenderCallbacks(a,h){for(let _ of a){if(this.callbackDispatchedThisFrame[h][_])continue;this.callbackDispatchedThisFrame[h][_]=!0;let x=this.images[h][_];_i(x)&&this.updateImage(_,h,x)}}}function wr(f){let a=f.key,h=f.value,_=f.valueSpec||{},x=f.objectElementValidators||{},C=f.style,T=f.styleSpec,E=[],P=t.n(h);if(P!=="object")return[new t.V(a,h,`object expected, ${P} found`)];for(let O in h){let B=O.split(".")[0],j;x[B]?j=x[B]:_[B]?j=Z:x["*"]?j=x["*"]:_["*"]&&(j=Z),j?E=E.concat(j({key:(a&&`${a}.`)+O,value:h[O],valueSpec:_[B]||_["*"],style:C,styleSpec:T,object:h,objectKey:O},h)):E.push(new t.m(a,h[O],`unknown property "${O}"`))}for(let O in _)x[O]||_[O].required&&_[O].default===void 0&&h[O]===void 0&&E.push(new t.V(a,h,`missing required property "${O}"`));return E}function tu(f){let a=f.value,h=f.valueSpec,_=f.style,x=f.styleSpec,C=f.key,T=f.arrayElementValidator||Z;if(t.n(a)!=="array")return[new t.V(C,a,`array expected, ${t.n(a)} found`)];if(h.length&&a.length!==h.length)return[new t.V(C,a,`array length ${h.length} expected, length ${a.length} found`)];if(h["min-length"]&&a.length<h["min-length"])return[new t.V(C,a,`array length at least ${h["min-length"]} expected, length ${a.length} found`)];let E={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};x.$version<7&&(E.function=h.function),t.n(h.value)==="object"&&(E=h.value);let P=[];for(let O=0;O<a.length;O++)P=P.concat(T({array:a,arrayIndex:O,value:a[O],valueSpec:E,style:_,styleSpec:x,key:`${C}[${O}]`},!0));return P}function od(f){let a=f.key,h=f.value,_=f.valueSpec,x=t.n(h);if(x==="number"&&h!=h&&(x="NaN"),x!=="number")return[new t.V(a,h,`number expected, ${x} found`)];if("minimum"in _){let C=_.minimum;if(t.n(_.minimum)==="array"&&(C=_.minimum[f.arrayIndex]),h<C)return[new t.V(a,h,`${h} is less than the minimum value ${C}`)]}if("maximum"in _){let C=_.maximum;if(t.n(_.maximum)==="array"&&(C=_.maximum[f.arrayIndex]),h>C)return[new t.V(a,h,`${h} is greater than the maximum value ${C}`)]}return[]}function Js(f){let a=f.valueSpec,h=t.u(f.value.type),_,x,C,T={},E=h!=="categorical"&&f.value.property===void 0,P=!E,O=t.n(f.value.stops)==="array"&&t.n(f.value.stops[0])==="array"&&t.n(f.value.stops[0][0])==="object",B=wr({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(q){if(h==="identity")return[new t.V(q.key,q.value,'identity function may not have a "stops" property')];let K=[],J=q.value;return K=K.concat(tu({key:q.key,value:J,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:j})),t.n(J)==="array"&&J.length===0&&K.push(new t.V(q.key,J,"array must have at least one stop")),K},default:function(q){return Z({key:q.key,value:q.value,valueSpec:a,style:q.style,styleSpec:q.styleSpec})}}});return h==="identity"&&E&&B.push(new t.V(f.key,f.value,'missing required property "property"')),h==="identity"||f.value.stops||B.push(new t.V(f.key,f.value,'missing required property "stops"')),h==="exponential"&&f.valueSpec.expression&&!t.s(f.valueSpec)&&B.push(new t.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(P&&!t.q(f.valueSpec)?B.push(new t.V(f.key,f.value,"property functions not supported")):E&&!t.r(f.valueSpec)&&B.push(new t.V(f.key,f.value,"zoom functions not supported"))),h!=="categorical"&&!O||f.value.property!==void 0||B.push(new t.V(f.key,f.value,'"property" property is required')),B;function j(q){let K=[],J=q.value,ee=q.key;if(t.n(J)!=="array")return[new t.V(ee,J,`array expected, ${t.n(J)} found`)];if(J.length!==2)return[new t.V(ee,J,`array length 2 expected, length ${J.length} found`)];if(O){if(t.n(J[0])!=="object")return[new t.V(ee,J,`object expected, ${t.n(J[0])} found`)];if(J[0].zoom===void 0)return[new t.V(ee,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new t.V(ee,J,"object stop key must have value")];let te=t.u(J[0].zoom);if(typeof te!="number")return[new t.V(ee,J[0].zoom,"stop zoom values must be numbers")];if(C&&C>te)return[new t.V(ee,J[0].zoom,"stop zoom values must appear in ascending order")];te!==C&&(C=te,x=void 0,T={}),K=K.concat(wr({key:`${ee}[0]`,value:J[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:od,value:G}}))}else K=K.concat(G({key:`${ee}[0]`,value:J[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},J));return t.t(t.v(J[1]))?K.concat([new t.V(`${ee}[1]`,J[1],"expressions are not allowed in function stops.")]):K.concat(Z({key:`${ee}[1]`,value:J[1],valueSpec:a,style:q.style,styleSpec:q.styleSpec}))}function G(q,K){let J=t.n(q.value),ee=t.u(q.value),te=q.value!==null?q.value:K;if(_){if(J!==_)return[new t.V(q.key,te,`${J} stop domain type must match previous stop domain type ${_}`)]}else _=J;if(J!=="number"&&J!=="string"&&J!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new t.V(q.key,te,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&h!=="categorical"){let ue=`number expected, ${J} found`;return t.q(a)&&h===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new t.V(q.key,te,ue)]}return h!=="categorical"||J!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?h!=="categorical"&&J==="number"&&typeof ee=="number"&&typeof x=="number"&&x!==void 0&&ee<x?[new t.V(q.key,te,"stop domain values must appear in ascending order")]:(x=ee,h==="categorical"&&ee in T?[new t.V(q.key,te,"stop domain values must be unique")]:(T[ee]=!0,[])):[new t.V(q.key,te,`integer expected, found ${String(ee)}`)]}}function Os(f){let a=(f.expressionContext==="property"?t.x:t.y)(t.v(f.value),f.valueSpec);if(a.result==="error")return a.value.map(_=>new t.V(`${f.key}${_.key}`,f.value,_.message));let h=a.value.expression||a.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!h.outputDefined())return[new t.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!t.z(h))return[new t.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return iu(h,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!t.A(h,["zoom","feature-state"]))return[new t.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!t.B(h))return[new t.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function iu(f,a){let h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(a.valueSpec&&a.valueSpec.expression)for(let x of a.valueSpec.expression.parameters)h.delete(x);if(h.size===0)return[];let _=[];return f instanceof t.D&&h.has(f.name)?[new t.V(a.key,a.value,`["${f.name}"] expression is not supported in a filter for a ${a.object.type} layer with id: ${a.object.id}`)]:(f.eachChild(x=>{_.push(...iu(x,a))}),_)}function dc(f){let a=f.key,h=f.value,_=f.valueSpec,x=[];return Array.isArray(_.values)?_.values.indexOf(t.u(h))===-1&&x.push(new t.V(a,h,`expected one of [${_.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(_.values).indexOf(t.u(h))===-1&&x.push(new t.V(a,h,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(h)} found`)),x}function uc(f){return t.G(t.v(f.value))?Os(t.o({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):nu(f)}function nu(f){let a=f.value,h=f.key;if(t.n(a)!=="array")return[new t.V(h,a,`array expected, ${t.n(a)} found`)];let _=f.styleSpec,x,C=[];if(a.length<1)return[new t.V(h,a,"filter array must have at least 1 element")];switch(C=C.concat(dc({key:`${h}[0]`,value:a[0],valueSpec:_.filter_operator,style:f.style,styleSpec:f.styleSpec})),t.u(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&t.u(a[1])==="$type"&&C.push(new t.V(h,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&C.push(new t.V(h,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(x=t.n(a[1]),x!=="string"&&C.push(new t.V(`${h}[1]`,a[1],`string expected, ${x} found`)));for(let T=2;T<a.length;T++)x=t.n(a[T]),t.u(a[1])==="$type"?C=C.concat(dc({key:`${h}[${T}]`,value:a[T],valueSpec:_.geometry_type,style:f.style,styleSpec:f.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&C.push(new t.V(`${h}[${T}]`,a[T],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let T=1;T<a.length;T++)C=C.concat(nu({key:`${h}[${T}]`,value:a[T],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":x=t.n(a[1]),a.length!==2?C.push(new t.V(h,a,`filter array for "${a[0]}" operator must have 2 elements`)):x!=="string"&&C.push(new t.V(`${h}[1]`,a[1],`string expected, ${x} found`))}return C}function ru(f,a){let h=f.key,_=f.style,x=f.layer,C=f.styleSpec,T=f.value,E=f.objectKey,P=C[`${a}_${f.layerType}`];if(!P)return[];let O=E.match(/^(.*)-transition$/);if(a==="paint"&&O&&P[O[1]]&&P[O[1]].transition)return Z({key:h,value:T,valueSpec:C.transition,style:_,styleSpec:C});let B=f.valueSpec||P[E];if(!B)return[new t.m(h,T,`unknown property "${E}"`)];let j;if(t.n(T)==="string"&&t.q(B)&&!B.tokens&&(j=/^{([^}]+)}$/.exec(T))){let q=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new t.V(h,T,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${q}.`)]}let G=[];if(f.layerType==="symbol")E!=="text-field"||!_||_.glyphs||_.imports||G.push(new t.V(h,T,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&t.H(t.v(T))&&t.u(T.type)==="identity"&&G.push(new t.V(h,T,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&a==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&t.q(B)&&(t.J(B)||t.r(B))){let q=t.x(t.v(T),B),K=q.value.expression||q.value._styleExpression.expression;K&&!t.A(K,["measure-light"])&&(E==="model-emissive-strength"&&t.B(K)&&t.z(K)||G.push(new t.V(h,T,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return G.concat(Z({key:f.key,value:T,valueSpec:B,style:_,styleSpec:C,expressionContext:"property",propertyType:a,propertyKey:E}))}function yh(f){return ru(f,"paint")}function ou(f){return ru(f,"layout")}function hs(f){let a=[],h=f.value,_=f.key,x=f.style,C=f.styleSpec;h.type||h.ref||a.push(new t.V(_,h,'either "type" or "ref" is required'));let T=t.u(h.type),E=t.u(h.ref);if(h.id){let P=t.u(h.id);for(let O=0;O<f.arrayIndex;O++){let B=x.layers[O];t.u(B.id)===P&&a.push(new t.V(_,h.id,`duplicate layer id "${h.id}", previously used at line ${B.id.__line__}`))}}if("ref"in h){let P;["type","source","source-layer","filter","layout"].forEach(O=>{O in h&&a.push(new t.V(_,h[O],`"${O}" is prohibited for ref layers`))}),x.layers.forEach(O=>{t.u(O.id)===E&&(P=O)}),P?P.ref?a.push(new t.V(_,h.ref,"ref cannot reference another ref layer")):T=t.u(P.type):typeof E=="string"&&a.push(new t.V(_,h.ref,`ref layer "${E}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(h.source){let P=x.sources&&x.sources[h.source],O=P&&t.u(P.type);P?O==="vector"&&T==="raster"?a.push(new t.V(_,h.source,`layer "${h.id}" requires a raster source`)):O==="raster"&&T!=="raster"?a.push(new t.V(_,h.source,`layer "${h.id}" requires a vector source`)):O!=="vector"||h["source-layer"]?O==="raster-dem"&&T!=="hillshade"?a.push(new t.V(_,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="raster-array"||["raster","raster-particle"].includes(T)?T!=="line"||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||O==="geojson"&&P.lineMetrics?T==="raster-particle"&&O!=="raster-array"&&a.push(new t.V(_,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):a.push(new t.V(_,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new t.V(_,h.source,"raster-array source can only be used with layer type 'raster'.")):a.push(new t.V(_,h,`layer "${h.id}" must specify a "source-layer"`)):a.push(new t.V(_,h.source,`source "${h.source}" not found`))}else a.push(new t.V(_,h,'missing required property "source"'));return a=a.concat(wr({key:_,value:h,valueSpec:C.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Z({key:`${_}.type`,value:h.type,valueSpec:C.layer.type,style:f.style,styleSpec:f.styleSpec,object:h,objectKey:"type"}),filter:P=>uc(t.o({layerType:T},P)),layout:P=>wr({layer:h,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":O=>ou(t.o({layerType:T},O))}}),paint:P=>wr({layer:h,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":O=>yh(t.o({layerType:T,layer:h},O))}})}})),a}function hc(f){let a=f.value,h=f.key,_=t.n(a);return _!=="string"?[new t.V(h,a,`string expected, ${_} found`)]:[]}let La={promoteId:function({key:f,value:a}){if(t.n(a)==="string")return hc({key:f,value:a});{let h=[];for(let _ in a)h.push(...hc({key:`${f}.${_}`,value:a[_]}));return h}}};function Bo(f){let a=f.value,h=f.key,_=f.styleSpec,x=f.style;if(!a.type)return[new t.V(h,a,'"type" is required')];let C=t.u(a.type),T=[];switch(["vector","raster","raster-dem","raster-array"].includes(C)&&(a.url||a.tiles||T.push(new t.m(h,a,'Either "url" or "tiles" is required.'))),C){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(wr({key:h,value:a,valueSpec:_[`source_${C.replace("-","_")}`],style:f.style,styleSpec:_,objectElementValidators:La})),T;case"geojson":if(T=wr({key:h,value:a,valueSpec:_.source_geojson,style:x,styleSpec:_,objectElementValidators:La}),a.cluster)for(let E in a.clusterProperties){let[P,O]=a.clusterProperties[E],B=typeof P=="string"?[P,["accumulated"],["get",E]]:P;T.push(...Os({key:`${h}.${E}.map`,value:O,expressionContext:"cluster-map"})),T.push(...Os({key:`${h}.${E}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return T;case"video":return wr({key:h,value:a,valueSpec:_.source_video,style:x,styleSpec:_});case"image":return wr({key:h,value:a,valueSpec:_.source_image,style:x,styleSpec:_});case"canvas":return[new t.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return dc({key:`${h}.type`,value:a.type,valueSpec:{values:au(_)},style:x,styleSpec:_})}}function au(f){return f.source.reduce((a,h)=>{let _=f[h];return _.type.type==="enum"&&(a=a.concat(Object.keys(_.type.values))),a},[])}function ad(f){let a=f.value,h=f.styleSpec,_=h.light,x=f.style,C=[],T=t.n(a);if(a===void 0)return C;if(T!=="object")return C=C.concat([new t.V("light",a,`object expected, ${T} found`)]),C;for(let E in a){let P=E.match(/^(.*)-transition$/);C=C.concat(P&&_[P[1]]&&_[P[1]].transition?Z({key:E,value:a[E],valueSpec:h.transition,style:x,styleSpec:h}):_[E]?Z({key:E,value:a[E],valueSpec:_[E],style:x,styleSpec:h}):[new t.V(E,a[E],`unknown property "${E}"`)])}return C}function su(f){let a=f.value,h=[];if(!a)return h;let _=t.n(a);if(_!=="object")return h=h.concat([new t.V("light-3d",a,`object expected, ${_} found`)]),h;let x=f.styleSpec,C=x["light-3d"],T=f.key,E=f.style,P=f.style.lights;for(let j of["type","id"])if(!(j in a))return h=h.concat([new t.V("light-3d",a,`missing property ${j} on light`)]),h;if(a.type&&P)for(let j=0;j<f.arrayIndex;j++){let G=t.u(a.type),q=P[j];t.u(q.type)===G&&h.push(new t.V(T,a.id,`duplicate light type "${a.type}", previously defined at line ${q.id.__line__}`))}let O=`properties_light_${a.type}`;if(!(O in x))return h=h.concat([new t.V("light-3d",a,`Invalid light type ${a.type}`)]),h;let B=x[O];for(let j in a)if(j==="properties"){let G=a[j],q=t.n(G);if(q!=="object")return h=h.concat([new t.V("properties",G,`object expected, ${q} found`)]),h;for(let K in G)h=h.concat(B[K]?Z({key:K,value:G[K],valueSpec:B[K],style:E,styleSpec:x}):[new t.m(f.key,G[K],`unknown property "${K}"`)])}else{let G=j.match(/^(.*)-transition$/);h=h.concat(G&&C[G[1]]&&C[G[1]].transition?Z({key:j,value:a[j],valueSpec:x.transition,style:E,styleSpec:x}):C[j]?Z({key:j,value:a[j],valueSpec:C[j],style:E,styleSpec:x}):[new t.m(j,a[j],`unknown property "${j}"`)])}return h}function vh(f){let a=f.value,h=f.key,_=f.style,x=f.styleSpec,C=x.terrain,T=[],E=t.n(a);if(a===void 0||E==="null")return T;if(E!=="object")return T=T.concat([new t.V("terrain",a,`object expected, ${E} found`)]),T;for(let P in a){let O=P.match(/^(.*)-transition$/);T=T.concat(O&&C[O[1]]&&C[O[1]].transition?Z({key:P,value:a[P],valueSpec:x.transition,style:_,styleSpec:x}):C[P]?Z({key:P,value:a[P],valueSpec:C[P],style:_,styleSpec:x}):[new t.m(P,a[P],`unknown property "${P}"`)])}if(a.source){let P=_.sources&&_.sources[a.source],O=P&&t.u(P.type);P?O!=="raster-dem"&&T.push(new t.V(h,a.source,`terrain cannot be used with a source of type ${String(O)}, it only be used with a "raster-dem" source type`)):T.push(new t.V(h,a.source,`source "${a.source}" not found`))}else T.push(new t.V(h,a,'terrain is missing required property "source"'));return T}function lu(f){let a=f.value,h=f.style,_=f.styleSpec,x=_.fog,C=[],T=t.n(a);if(a===void 0)return C;if(T!=="object")return C=C.concat([new t.V("fog",a,`object expected, ${T} found`)]),C;for(let E in a){let P=E.match(/^(.*)-transition$/);C=C.concat(P&&x[P[1]]&&x[P[1]].transition?Z({key:E,value:a[E],valueSpec:_.transition,style:h,styleSpec:_}):x[E]?Z({key:E,value:a[E],valueSpec:x[E],style:h,styleSpec:_}):[new t.m(E,a[E],`unknown property "${E}"`)])}return C}let De={"*":()=>[],array:tu,boolean:function(f){let a=f.value,h=f.key,_=t.n(a);return _!=="boolean"?[new t.V(h,a,`boolean expected, ${_} found`)]:[]},number:od,color:function(f){let a=f.key,h=f.value,_=t.n(h);return _!=="string"?[new t.V(a,h,`color expected, ${_} found`)]:t.F(h)===null?[new t.V(a,h,`color expected, "${h}" found`)]:[]},enum:dc,filter:uc,function:Js,layer:hs,object:wr,source:Bo,model:t.K,light:ad,"light-3d":su,terrain:vh,fog:lu,string:hc,formatted:function(f){return hc(f).length===0?[]:Os(f)},resolvedImage:function(f){return hc(f).length===0?[]:Os(f)},projection:function(f){let a=f.value,h=f.styleSpec,_=h.projection,x=f.style,C=[],T=t.n(a);if(T==="object")for(let E in a)C=C.concat(Z({key:E,value:a[E],valueSpec:_[E],style:x,styleSpec:h}));else T!=="string"&&(C=C.concat([new t.V("projection",a,`object or string expected, ${T} found`)]));return C},import:function(f){let{value:a,styleSpec:h}=f,T=a,{data:_}=T,x=pE(T,["data"]);Object.defineProperty(x,"__line__",{value:a.__line__,enumerable:!1});let C=wr(t.o({},f,{value:x,valueSpec:h.import}));return t.u(x.id)===""&&C.push(new t.V(`${f.key}.id`,x,"import id can't be an empty string")),_&&(C=C.concat(ge(_,h,{key:`${f.key}.data`}))),C}};function Z(f,a=!1){let h=f.value,_=f.valueSpec,x=f.styleSpec;if(_.expression&&t.H(t.u(h)))return Js(f);if(_.expression&&t.t(t.v(h)))return Os(f);if(_.type&&De[_.type]){let C=De[_.type](f);return a===!0&&C.length>0&&t.n(f.value)==="array"?Os(f):C}return wr(t.o({},f,{valueSpec:_.type?x[_.type]:_}))}function ie(f){let a=f.value,h=f.key,_=hc(f);return _.length||(a.indexOf("{fontstack}")===-1&&_.push(new t.V(h,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&_.push(new t.V(h,a,'"glyphs" url must include a "{range}" token'))),_}function ge(f,a=t.L,h={}){return Z({key:h.key||"",value:f,valueSpec:a.$root,styleSpec:a,style:f,objectElementValidators:{glyphs:ie,"*":()=>[]}})}function Ie(f,a=t.L){return Ui(ge(f,a))}let Me=f=>Ui(Bo(f)),Ve=f=>Ui(ad(f)),Ye=f=>Ui(su(f)),Fe=f=>Ui(vh(f)),Xe=f=>Ui(lu(f)),Dt=f=>Ui(hs(f)),yt=f=>Ui(uc(f)),Kt=f=>Ui(yh(f)),ui=f=>Ui(ou(f)),Oi=f=>Ui(t.K(f));function Ui(f){return f.slice().sort((a,h)=>a.line&&h.line?a.line-h.line:0)}function Si(f,a){let h=!1;if(a&&a.length)for(let _ of a)_ instanceof t.m?t.w(_.message):(f.fire(new t.d(new Error(_.message))),h=!0);return h}let Qi=new t.N({anchor:new t.O(t.L.light.anchor),position:new t.Q(t.L.light.position),color:new t.O(t.L.light.color),intensity:new t.O(t.L.light.intensity)});class Zt extends t.E{constructor(a,h="flat"){super(),this._transitionable=new t.U(Qi),this.setLight(a,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,h,_={}){this._validate(Ve,a,_)||(this._transitionable.setTransitionOrValue(a),this.id=h)}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,_){return(!_||_.validate!==!1)&&Si(this,a.call(Ie,t.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:t.L})))}}let lr=new t.N({source:new t.O(t.L.terrain.source),exaggeration:new t.O(t.L.terrain.exaggeration)}),Pn=class extends t.E{constructor(f,a,h,_){super(),this.scope=h,this._transitionable=new t.U(lr,h,_),this._transitionable.setTransitionOrValue(f,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(f,a){this._transitionable.setTransitionOrValue(f,a)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new t.X(f)).get("exaggeration")}isZoomDependent(){let f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof t.Z}},an=45,qr=65,_r=.05;function Jr(f,a,h,_){let x=t.$(an,qr,h),[C,T]=No(f,_),E=1-Math.min(1,Math.exp((a-C)/(T-C)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*x*f.alpha}function No(f,a){let h=.5/Math.tan(.5*a);return[f.range[0]+h,f.range[1]+h]}function Vo(f,a,h,_,x){let C=t._.transformMat4([],[a,h,_],x.mercatorFogMatrix);return Jr(f,t._.length(C),x.pitch,x._fov)}function Rl(f,a,h,_,x,C,T){let E=[[h,_,0],[x,_,0],[x,C,0],[h,C,0]],P=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(let B of E){let j=t._.transformMat4([],B,a),G=t._.length(j);P=Math.min(P,G),O=Math.max(O,G)}return[Jr(f,P,T.pitch,T._fov),Jr(f,O,T.pitch,T._fov)]}let _f=new t.N({range:new t.O(t.L.fog.range),color:new t.O(t.L.fog.color),"high-color":new t.O(t.L.fog["high-color"]),"space-color":new t.O(t.L.fog["space-color"]),"horizon-blend":new t.O(t.L.fog["horizon-blend"]),"star-intensity":new t.O(t.L.fog["star-intensity"]),"vertical-range":new t.O(t.L.fog["vertical-range"])});class bf extends t.E{constructor(a,h,_,x){super(),this._transitionable=new t.U(_f,_,new Map(x)),this.set(a,x),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new t.a0(_f),this.scope=_}get state(){let a=this._transform,h=a.projection.name==="globe",_=t.a1(a.zoom),x=this.properties.get("range"),C=[.5,3];return{range:h?[t.a2(C[0],x[0],_),t.a2(C[1],x[1],_)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,h,_={}){if(this._validate(Xe,a,_))return;let x=t.W({},a);for(let C of Object.keys(t.L.fog))x[C]===void 0&&(x[C]=t.L.fog[C].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;let h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:t.$(an,qr,a))*h.a}getOpacityAtLatLng(a,h){return this._transform.projection.supportsFog?function(_,x,C){let T=t.Y.fromLngLat(x),E=C.elevation?C.elevation.getAtPointOrZero(T):0;return Vo(_,T.x,T.y,E,C)}(this.state,a,h):0}getOpacityForTile(a){if(!this._transform.projection.supportsFog)return[1,1];let h=this._transform.calculateFogTileMatrix(a.toUnwrapped());return Rl(this.state,h,0,0,t.a3,t.a3,this._transform)}getOpacityForBounds(a,h,_,x,C){return this._transform.projection.supportsFog?Rl(this.state,a,h,_,x,C,this._transform):[1,1]}getFovAdjustedRange(a){return this._transform.projection.supportsFog?No(this.state,a):[0,1]}isVisibleOnFrustum(a){if(!this._transform.projection.supportsFog)return!1;let h=[4,5,6,7];for(let _ of h){let x=a.points[_],C;if(x[2]>=0)C=x;else{let T=a.points[_-4];C=t.a4(T,x,T[2]/(T[2]-x[2]))}if(Vo(this.state,C[0],C[1],0,this._transform)>=_r)return!0}return!1}updateConfig(a){this._transitionable.setTransitionOrValue(this._options,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,_){return(!_||_.validate!==!1)&&Si(this,a.call(Ie,t.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:t.L})))}}class mc extends t.E{constructor(a,h,_,x){super(),this.scope=_,this._options=a,this.properties=new t.a0(h),this._transitionable=new t.U(h,_,new Map(x)),this._transitionable.setTransitionOrValue(a.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(a){this._transitionable.setTransitionOrValue(this._options.properties,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(a,h){this._options=a,this._transitionable.setTransitionOrValue(a.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let ki=new t.N({color:new t.O(t.L.properties_light_ambient.color),intensity:new t.O(t.L.properties_light_ambient.intensity)}),yf=new t.N({direction:new t.a5(t.L.properties_light_directional.direction),color:new t.O(t.L.properties_light_directional.color),intensity:new t.O(t.L.properties_light_directional.intensity),"cast-shadows":new t.O(t.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new t.O(t.L.properties_light_directional["shadow-intensity"])});var Fl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,$m=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,xh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,vf="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ym=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,wh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ch=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,pc=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Zm=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Xm=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Zg=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let sd=[];cu(Fl,sd),cu(xh,sd),cu($m,sd);let Sh={"_prelude_fog.vertex.glsl":wh,"_prelude_terrain.vertex.glsl":Ym,"_prelude_shadow.vertex.glsl":Xm,"_prelude_fog.fragment.glsl":Ch,"_prelude_shadow.fragment.glsl":Zg,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":pc,"_prelude_raster_particle.glsl":Zm},Ih={};$i("",Ym),$i(Ch,wh),$i(Zg,Xm),$i(pc,""),$i(Zm,"");let xf=$i($m,xh),Xg=Fl;var Qg={background:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:$i("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$i(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:$i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:$i("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:$i("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:$i("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:$i(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:$i(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:$i(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:$i(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:$i("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:$i("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:$i(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:$i(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:$i(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:$i(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:$i("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:$i(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,vf),skyboxGradient:$i(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,vf),skyboxCapture:$i(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:$i(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:$i(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:$i(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:$i("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function cu(f,a){let h=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of h)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let x=_.split(" ");for(let C of x)a.includes(C)||a.push(C)}}function $i(f,a){let h=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,x=a.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(O=>{let B=O.split(" ");return B[B.length-1]}),x=[...new Set(x)]);let C={},T=[],E=[];if(f=f.replace(h,(O,B)=>(E.push(B),"")),(a=a.replace(h,(O,B)=>(T.push(B),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let P=[...sd];cu(f,P),cu(a,P);for(let O of[...T,...E])Sh[O]||console.error(`Undefined include: ${O}`),Ih[O]||(Ih[O]=[],cu(Sh[O],Ih[O])),P=[...P,...Ih[O]];return{fragmentSource:f=f.replace(_,(O,B,j,G,q)=>(C[q]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${j} ${G} ${q};
#else
uniform ${j} ${G} u_${q};
#endif
`:B==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${j} ${G} ${q} = u_${q};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${j} ${G} ${q};
#endif
`:B==="initialize-attribute"?"":void 0)),vertexSource:a=a.replace(_,(O,B,j,G,q)=>{let K=G==="float"?"vec2":G,J=q.match(/color/)?"color":K;return B==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${j} ${G} a_${q};
#endif
`:C[q]?B==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${j} ${K} a_${q};
out ${j} ${G} ${q};
#else
uniform ${j} ${G} u_${q};
#endif
`:B==="initialize"?J==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${j} ${G} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${J}(a_${q}, u_${q}_t);
#else
    ${j} ${G} ${q} = u_${q};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${j} ${G} a_${q};
    out ${j} ${G} ${q};
#endif
`:B==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:B==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${j} ${K} a_${q};
#else
uniform ${j} ${G} u_${q};
#endif
`:B==="define-instanced"?J==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${j} ${G} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${j} ${K} a_${q};
#else
uniform ${j} ${G} u_${q};
#endif
`:B==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${j} ${G} ${q} = a_${q};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${j} ${G} ${q} = a_${q};
#else
    ${j} ${G} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${j} ${G} ${q} = unpack_mix_${J}(a_${q}, u_${q}_t);
#else
    ${j} ${G} ${q} = u_${q};
#endif
`}),staticAttributes:x,usedDefines:P,vertexIncludes:T,fragmentIncludes:E}}class rb{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,h,_,x,C,T,E,P){this.context=a;let O=this.boundPaintVertexBuffers.length!==x.length;for(let j=0;!O&&j<x.length;j++)this.boundPaintVertexBuffers[j]!==x[j]&&(O=!0);let B=this.boundDynamicVertexBuffers.length!==E.length;for(let j=0;!B&&j<E.length;j++)this.boundDynamicVertexBuffers[j]!==E[j]&&(B=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||O||B||this.boundIndexBuffer!==C||this.boundVertexOffset!==T)this.freshBind(h,_,x,C,T,E,P);else{a.bindVertexArrayOES.set(this.vao);for(let j of E)j&&(j.bind(),P&&j.instanceCount&&j.setVertexAttribDivisor(a.gl,h,P));C&&C.dynamicDraw&&C.bind()}}freshBind(a,h,_,x,C,T,E){let P=a.numAttributes,O=this.context,B=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=T,h.enableAttributes(B,a),h.bind(),h.setVertexAttribPointers(B,a,C);for(let j of _)j.enableAttributes(B,a),j.bind(),j.setVertexAttribPointers(B,a,C);for(let j of T)j&&(j.enableAttributes(B,a),j.bind(),j.setVertexAttribPointers(B,a,C),E&&j.instanceCount&&j.setVertexAttribDivisor(B,a,E));x&&x.bind(),O.currentNumAttributes=P}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ob(f,a){let h=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new t.Y(0,_/h).toLngLat().lat,new t.Y(0,(_+1)/h).toLngLat().lat]}function ab(f,a,h,_,x,C,T){let E=f.context,P=E.gl,O=h.hillshadeFBO;if(!O)return;f.prepareDrawTile();let B=f.isTileAffectedByFog(a),j=f.getOrCreateProgram("hillshade",{overrideFog:B});E.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,O.colorAttachment.get());let G=((ee,te,ue,ce)=>{let he=ue.paint.get("hillshade-shadow-color"),Ce=ue.paint.get("hillshade-highlight-color"),we=ue.paint.get("hillshade-accent-color"),de=ue.paint.get("hillshade-emissive-strength"),me=t.ab(ue.paint.get("hillshade-illumination-direction"));if(ue.paint.get("hillshade-illumination-anchor")==="viewport")me-=ee.transform.angle;else if(ee.style&&ee.style.enable3dLights()&&ee.style.directionalLight){let Ee=ee.style.directionalLight.properties.get("direction"),We=t.ac(Ee.x,Ee.y,Ee.z);me=t.ab(We[1])}let fe=!ee.options.moving;return{u_matrix:ce||ee.transform.calculateProjMatrix(te.tileID.toUnwrapped(),fe),u_image:0,u_latrange:ob(0,te.tileID),u_light:[ue.paint.get("hillshade-exaggeration"),me],u_shadow:he.toRenderColor(ue.lut),u_highlight:Ce.toRenderColor(ue.lut),u_emissive_strength:de,u_accent:we.toRenderColor(ue.lut)}})(f,h,_,f.terrain?a.projMatrix:null);f.uploadCommonUniforms(E,j,a.toUnwrapped());let{tileBoundsBuffer:q,tileBoundsIndexBuffer:K,tileBoundsSegments:J}=f.getTileBoundsBuffers(h);j.draw(f,P.TRIANGLES,x,C,T,t.af.disabled,G,_.id,q,K,J)}function wf(f,a,h){if(!a.needsDEMTextureUpload)return;let _=f.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||f.getTileTexture(h.stride);let C=h.getPixels();a.demTexture?a.demTexture.update(C,{premultiply:!1}):a.demTexture=new t.T(_,C,x.R32F,{premultiply:!1}),a.needsDEMTextureUpload=!1}function ms(f,a,h){let _=f.context,x=_.gl;if(!a.dem)return;let C=a.dem;if(_.activeTexture.set(x.TEXTURE1),wf(f,a,C),!a.demTexture)return;a.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);let T=C.dim;_.activeTexture.set(x.TEXTURE0);let E=a.hillshadeFBO;if(!E){let G=new t.T(_,{width:T,height:T,data:null},x.RGBA);G.bind(x.LINEAR,x.CLAMP_TO_EDGE),E=a.hillshadeFBO=_.createFramebuffer(T,T,!0,"renderbuffer"),E.colorAttachment.set(G.texture)}_.bindFramebuffer.set(E.framebuffer),_.viewport.set([0,0,T,T]);let{tileBoundsBuffer:P,tileBoundsIndexBuffer:O,tileBoundsSegments:B}=f.getMercatorTileBoundsBuffers(),j=[];f.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:j}).draw(f,x.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.disabled,((G,q)=>{let K=q.stride,J=t.ad.create();return t.ad.ortho(J,0,t.a3,-t.a3,0,0,1),t.ad.translate(J,J,[0,-t.a3,0]),{u_matrix:J,u_image:1,u_dimension:[K,K],u_zoom:G.overscaledZ}})(a.tileID,C),h.id,P,O,B),a.needsHillshadePrepare=!1}function Cf(f,a,h,_,x){let C=function(T,E){if(T)return x(T);if(E){if(f.url&&E.tiles&&f.tiles&&delete f.tiles,E.variants){if(!Array.isArray(E.variants))return x(new Error("variants must be an array"));for(let O of E.variants){if(O==null||typeof O!="object"||O.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(O.capabilities))return x(new Error("capabilities must be an array"));if(O.capabilities.length===1&&O.capabilities[0]==="meshopt"){E=t.W(E,O);break}}}let P=t.ah(t.W(E,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(P.vectorLayers=E.vector_layers,P.vectorLayerIds=P.vectorLayers.map(O=>O.id)),E.raster_layers&&(P.rasterLayers=E.raster_layers,P.rasterLayerIds=P.rasterLayers.map(O=>O.id)),P.tiles=a.canonicalizeTileset(P,f.url),x(null,P)}};return f.url?t.g(a.transformRequest(a.normalizeSourceURL(f.url,null,h,_),t.R.Source),C):t.e.frame(()=>C(null,f))}class Th{constructor(a,h,_){this.bounds=t.ai.convert(this.validateBounds(a)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){let h=Math.pow(2,a.z),_=Math.floor(t.aj(this.bounds.getWest())*h),x=Math.floor(t.ak(this.bounds.getNorth())*h),C=Math.ceil(t.aj(this.bounds.getEast())*h),T=Math.ceil(t.ak(this.bounds.getSouth())*h);return a.x>=_&&a.x<C&&a.y>=x&&a.y<T}}class Mh extends t.E{constructor(a,h,_,x){super(),this.id=a,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.W({type:"raster"},h),t.W(this,t.ah(h,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"})),this._tileJSONRequest=Cf(this._options,this.map._requestManager,null,null,(h,_)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new t.d(h)):_&&(t.W(this,_),_.bounds&&(this.tileBounds=new Th(_.bounds,this.minzoom,this.maxzoom)),t.an(_.tiles),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),a&&a(h)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();let a=t.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return t.W({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,h){let _=t.e.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);a.request=t.h(this.map._requestManager.transformRequest(x,t.R.Tile),(C,T,E,P)=>(delete a.request,a.aborted?(a.state="unloaded",h(null)):C?(a.state="errored",h(C)):T?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:E,expires:P}),a.setTexture(T,this.map.painter),a.state="loaded",t.am(this.dispatcher),void h(null)):h(null)))}abortTile(a,h){a.request&&(a.request.cancel(),delete a.request),h&&h()}unloadTile(a,h){a.texture&&a.texture instanceof t.T?(a.destroy(!0),a.texture&&a.texture instanceof t.T&&this.map.painter.saveTileTexture(a.texture)):a.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Qm extends t.E{constructor(a,h,_,x){if(super(),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.W(this,t.ah(h,["url","scheme","tileSize","promoteId"])),this._options=t.W({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new t.ao}load(a){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"}));let h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=Cf(this._options,this.map._requestManager,h,_,(x,C)=>{this._tileJSONRequest=null,this._loaded=!0,x?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new t.d(x))):C&&(t.W(this,C),C.bounds&&(this.tileBounds=new Th(C.bounds,this.minzoom,this.maxzoom)),t.an(C.tiles,this.map._requestManager._customAccessToken),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),a&&a(x)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();let a=t.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return t.W({},this._options)}loadTile(a,h){let _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),x=this.map._requestManager.transformRequest(_,t.R.Tile),C=this.map.style?this.map.style.getLut(this.scope):null,T={request:x,data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,lut:C?{image:C.image.clone()}:null,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:t.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:a.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(T.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",T,E.bind(this));else if(a.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",T,E.bind(this),void 0,!0);else{let P=t.ap.call({deduped:this._deduped},T,(O,B)=>{O||!B?E.call(this,O):(T.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},a.actor&&a.actor.send("loadTile",T,E.bind(this),void 0,!0))},!0);a.request={cancel:P}}function E(P,O){return delete a.request,a.aborted?h(null):P&&P.status!==404?h(P):(O&&O.resourceTiming&&(a.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&a.setExpiryData(O),a.loadVectorData(O,this.map.painter),t.am(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,h){a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope}),a.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let ld=f=>({u_matrix:new t.a6(f),u_image0:new t.a7(f),u_skirt_height:new t.aa(f),u_ground_shadow_factor:new t.aq(f)}),gt=(f,a,h)=>({u_matrix:f,u_image0:0,u_skirt_height:a,u_ground_shadow_factor:h}),Mr=(f,a,h,_,x,C,T,E,P,O,B,j,G,q,K,J)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:x,u_merc_center:C,u_image0:0,u_frustum_tl:T,u_frustum_tr:E,u_frustum_br:P,u_frustum_bl:O,u_globe_pos:B,u_globe_radius:j,u_viewport:G,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:K});class kh{constructor(a=0,h=0,_=0,x=0){if(isNaN(a)||a<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=h,this.left=_,this.right=x}interpolate(a,h,_){return h.top!=null&&a.top!=null&&(this.top=t.a2(a.top,h.top,_)),h.bottom!=null&&a.bottom!=null&&(this.bottom=t.a2(a.bottom,h.bottom,_)),h.left!=null&&a.left!=null&&(this.left=t.a2(a.left,h.left,_)),h.right!=null&&a.right!=null&&(this.right=t.a2(a.right,h.right,_)),this}getCenter(a,h){let _=t.at((this.left+a-this.right)/2,0,a),x=t.at((this.top+h-this.bottom)/2,0,h);return new t.P(_,x)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new kh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function tn(f,a){let h=t.aw(f,3);t.ad.fromQuat(f,a),t.az(f,3,h)}function na(f,a){let h=t.av.identity([]);return t.av.rotateZ(h,h,-a),t.av.rotateX(h,h,-f),h}function Kg(f,a){let h=[f[0],f[1],0],_=[a[0],a[1],0];if(t._.length(h)>=1e-15){let T=t._.normalize([],h);t._.scale(_,T,t._.dot(_,T)),a[0]=_[0],a[1]=_[1]}let x=t._.cross([],a,f);if(t._.len(x)<1e-15)return null;let C=Math.atan2(-x[1],x[0]);return na(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),C)}class Sf{constructor(a,h){this.position=a,this.orientation=h}get position(){return this._position}set position(a){if(a){let h=a instanceof t.Y?a:new t.Y(a[0],a[1],a[2]);this._renderWorldCopies&&(h.x=t.au(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(a,h){if(this.orientation=null,!this.position)return;let _=this.position,x=this._elevation?this._elevation.getAtPointOrZero(t.Y.fromLngLat(a)):0,C=t.Y.fromLngLat(a,x),T=[C.x-_.x,C.y-_.y,C.z-_.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Kg(T,h)}setPitchBearing(a,h){this.orientation=na(t.ab(a),t.ab(-h))}}class Eh{constructor(a,h){this._transform=t.ad.identity([]),this.orientation=h,this.position=a}get mercatorPosition(){let a=this.position;return new t.Y(a[0],a[1],a[2])}get position(){let a=t.aw(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var h;a&&t.az(this._transform,3,[(h=a)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||t.av.identity([]),a&&tn(this._transform,this._orientation)}getPitchBearing(){let a=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,h){this._orientation=na(a,h),tn(this._transform,this._orientation)}forward(){let a=t.aw(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){let a=t.aw(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){let a=t.aw(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,h){let _=new Float64Array(16);return t.ad.invert(_,this.getWorldToCamera(a,h)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(a,h,_){let x=this.position;t._.scale(x,x,-a);let C=new Float64Array(16);return t.ad.fromScaling(C,[_,_,_]),t.ad.translate(C,C,x),C[10]*=h,C}getWorldToCamera(a,h){let _=new Float64Array(16),x=new Float64Array(4),C=this.position;return t.av.conjugate(x,this._orientation),t._.scale(C,C,-a),t.ad.fromQuat(_,x),t.ad.translate(_,_,C),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(a,h,_,x){let C=new Float64Array(16);return t.ad.perspective(C,a,h,_,x),C}getCameraToClipOrthographic(a,h,_,x,C,T){let E=new Float64Array(16);return t.ad.ortho(E,a,h,_,x,C,T),E}getDistanceToElevation(a,h=!1){let _=a===0?0:t.ax(a,h?t.ay(this.position[1]):this.position[1]),x=this.forward();return(_-this.position[2])/x[2]}clone(){return new Eh([...this.position],[...this.orientation])}}let cd={unknown:0,flipRequired:1,flipNotRequired:2},Ri=Math.tan(85*Math.PI/180);function $r(f,a,h,_,x,C,T){let E=t.ad.create();if(h)if(C.name==="globe"){let P=t.aB(x,a);t.ad.multiply(E,E,P)}else{let P=t.aC.invert([],T);E[0]=P[0],E[1]=P[1],E[4]=P[2],E[5]=P[3],_||t.ad.rotateZ(E,E,x.angle)}else t.ad.multiply(E,x.labelPlaneMatrix,f);return E}function Ll(f,a,h,_,x,C,T){let E=$r(f,a,h,_,x,C,T);return C.name==="globe"&&h||(E[2]=E[6]=E[10]=E[14]=0),E}function ps(f,a,h,_,x,C,T){if(h){if(C.name==="globe"){let E=$r(f,a,h,_,x,C,T);return t.ad.invert(E,E),t.ad.multiply(E,f,E),E}{let E=t.ad.clone(f),P=t.ad.identity([]);return P[0]=T[0],P[1]=T[1],P[4]=T[2],P[5]=T[3],t.ad.multiply(E,E,P),_||t.ad.rotateZ(E,E,-x.angle),E}}return x.glCoordMatrix}function Ya(f,a,h,_){let x=[f,a,h,1];h?t.aA.transformMat4(x,x,_):po(x,x,_);let C=x[3];return x[0]/=C,x[1]/=C,x[2]/=C,x}function Mo(f,a){return Math.min(.5+f/a*.5,1.5)}function fs(f,a){let h=f[0]/f[3],_=f[1]/f[3];return h>=-a[0]&&h<=a[0]&&_>=-a[1]&&_<=a[1]}function Dh(f,a,h,_,x,C,T,E,P,O){let B=h.transform,j=_?f.textSizeData:f.iconSizeData,G=t.aD(j,h.transform.zoom),q=B.projection.name==="globe",K=[256/h.width*2+1,256/h.height*2+1],J=_?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;J.clear();let ee=null;q&&(ee=_?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);let te=f.lineVertexArray,ue=_?f.text.placedSymbolArray:f.icon.placedSymbolArray,ce=h.transform.width/h.transform.height,he,Ce=!1;for(let we=0;we<ue.length;we++){let de=ue.get(we),{numGlyphs:me,writingMode:fe}=de;if(fe!==t.aE.vertical||Ce||he===t.aE.horizontal||(Ce=!0),he=fe,(de.hidden||fe===t.aE.vertical)&&!Ce){dd(me,J);continue}Ce=!1;let Ee=new t.P(de.tileAnchorX,de.tileAnchorY),{x:We,y:ye,z:He}=B.projection.projectTilePoint(Ee.x,Ee.y,O.canonical);if(P){let[Wt,Ft,pt]=P(Ee);We+=Wt,ye+=Ft,He+=pt}let qe=[We,ye,He,1];if(t.aA.transformMat4(qe,qe,a),!fs(qe,K)){dd(me,J);continue}let ct=qe[3],ut=Mo(h.transform.getCameraToCenterDistance(B.projection),ct),lt=t.aF(j,G,de),Le=T?lt/ut:lt*ut,Ze=Ya(We,ye,He,x);if(Ze[3]<=0){dd(me,J);continue}let rt={},Ot=T?null:P,Rt=Jm(de,Le,!1,E,a,x,C,f.glyphOffsetArray,te,J,ee,Ze,Ee,rt,ce,Ot,B.projection,O,T);Ce=Rt.useVertical,Ot&&Rt.needsFlipping&&(rt={}),(Rt.notEnoughRoom||Ce||Rt.needsFlipping&&Jm(de,Le,!0,E,a,x,C,f.glyphOffsetArray,te,J,ee,Ze,Ee,rt,ce,Ot,B.projection,O,T).notEnoughRoom)&&dd(me,J)}_?(f.text.dynamicLayoutVertexBuffer.updateData(J),ee&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(ee)):(f.icon.dynamicLayoutVertexBuffer.updateData(J),ee&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(ee))}function Ah(f,a,h,_,x,C,T,E,P,O,B,j,G,q,K,J){let{lineStartIndex:ee,glyphStartIndex:te,segment:ue}=E,ce=te+E.numGlyphs,he=ee+E.lineLength,Ce=a.getoffsetX(te),we=a.getoffsetX(ce-1),de=jo(f*Ce,h,_,x,C,T,ue,ee,he,P,O,B,j,G,!0,q,K,J);if(!de)return null;let me=jo(f*we,h,_,x,C,T,ue,ee,he,P,O,B,j,G,!0,q,K,J);return me?{first:de,last:me}:null}function Km(f,a,h,_){return f===t.aE.horizontal&&Math.abs(_)>Math.abs(h)?{useVertical:!0}:f===t.aE.vertical?_>0?{needsFlipping:!0}:null:a!==cd.unknown&&function(x,C){return x===0||Math.abs(C/x)>Ri}(h,_)?a===cd.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function Jm(f,a,h,_,x,C,T,E,P,O,B,j,G,q,K,J,ee,te,ue){let ce=a/24,he=f.lineOffsetX*ce,Ce=f.lineOffsetY*ce,{lineStartIndex:we,glyphStartIndex:de,numGlyphs:me,segment:fe,writingMode:Ee,flipState:We}=f,ye=we+f.lineLength,He=qe=>{if(B){let[Le,Ze,rt]=qe.up,Ot=O.length;t.aG(B,Ot+0,Le,Ze,rt),t.aG(B,Ot+1,Le,Ze,rt),t.aG(B,Ot+2,Le,Ze,rt),t.aG(B,Ot+3,Le,Ze,rt)}let[ct,ut,lt]=qe.point;t.aH(O,ct,ut,lt,qe.angle)};if(me>1){let qe=Ah(ce,E,he,Ce,h,j,G,f,P,C,q,J,!1,ee,te,ue);if(!qe)return{notEnoughRoom:!0};if(_&&!h){let[ct,ut,lt]=qe.first.point,[Le,Ze,rt]=qe.last.point;[ct,ut]=Ya(ct,ut,lt,T),[Le,Ze]=Ya(Le,Ze,rt,T);let Ot=Km(Ee,We,(Le-ct)*K,Ze-ut);if(f.flipState=Ot&&Ot.needsFlipping?cd.flipRequired:cd.flipNotRequired,Ot)return Ot}He(qe.first);for(let ct=de+1;ct<de+me-1;ct++){let ut=jo(ce*E.getoffsetX(ct),he,Ce,h,j,G,fe,we,ye,P,C,q,J,!1,!1,ee,te,ue);if(!ut)return O.length-=4*(ct-de),{notEnoughRoom:!0};He(ut)}He(qe.last)}else{if(_&&!h){let ct=Ya(G.x,G.y,0,x),ut=we+fe+1,lt=new t.P(P.getx(ut),P.gety(ut)),Le=Ya(lt.x,lt.y,0,x),Ze=Le[3]>0?Le:du(G,lt,ct,1,x,void 0,ee,te.canonical),rt=Km(Ee,We,(Ze[0]-ct[0])*K,Ze[1]-ct[1]);if(f.flipState=rt&&rt.needsFlipping?cd.flipRequired:cd.flipNotRequired,rt)return rt}let qe=jo(ce*E.getoffsetX(de),he,Ce,h,j,G,fe,we,ye,P,C,q,J,!1,!1,ee,te,ue);if(!qe)return{notEnoughRoom:!0};He(qe)}return{}}function Ph(f,a,h,_,x){let{x:C,y:T,z:E}=_.projectTilePoint(f.x,f.y,a);if(!x)return Ya(C,T,E,h);let[P,O,B]=x(f);return Ya(C+P,T+O,E+B,h)}function du(f,a,h,_,x,C,T,E){let P=Ph(f.sub(a)._unit()._add(f),E,x,T,C);return t._.sub(P,h,P),t._.normalize(P,P),t._.scaleAndAdd(P,h,P,_)}function jo(f,a,h,_,x,C,T,E,P,O,B,j,G,q,K,J,ee,te){let ue=_?f-a:f+a,ce=ue>0?1:-1,he=0;_&&(ce*=-1,he=Math.PI),ce<0&&(he+=Math.PI);let Ce=E+T+(ce>0?0:1)|0,we=x,de=x,me=0,fe=0,Ee=Math.abs(ue),We=[],ye=[],He=C,qe=He,ct=()=>du(qe,He,de,Ee-me+1,B,G,J,ee.canonical);for(;me+fe<=Ee;){if(Ce+=ce,Ce<E||Ce>=P)return null;if(de=we,qe=He,We.push(de),q&&ye.push(qe),He=new t.P(O.getx(Ce),O.gety(Ce)),we=j[Ce],!we){let Ft=Ph(He,ee.canonical,B,J,G);we=Ft[3]>0?j[Ce]=Ft:ct()}me+=fe,fe=t._.distance(de,we)}K&&G&&(j[Ce]&&(we=ct(),fe=t._.distance(de,we)),j[Ce]=we);let ut=(Ee-me)/fe,lt=He.sub(qe)._mult(ut)._add(qe),Le=t._.sub([],we,de),Ze=t._.scaleAndAdd([],de,Le,ut),rt=[0,0,1],Ot=Le[0],Rt=Le[1];if(te&&(rt=J.upVector(ee.canonical,lt.x,lt.y),rt[0]!==0||rt[1]!==0||rt[2]!==1)){let Ft=[rt[2],0,-rt[0]],pt=t._.cross([],rt,Ft);t._.normalize(Ft,Ft),t._.normalize(pt,pt),Ot=t._.dot(Le,Ft),Rt=t._.dot(Le,pt)}if(h){let Ft=t._.cross([],rt,Le);t._.normalize(Ft,Ft),t._.scaleAndAdd(Ze,Ze,Ft,h*ce)}let Wt=he+Math.atan2(Rt,Ot);return We.push(Ze),q&&ye.push(lt),{point:Ze,angle:Wt,path:We,tilePath:ye,up:rt}}function dd(f,a){let h=a.length,_=h+4*f;a.resize(_),a.float32.fill(-1/0,4*h,4*_)}function po(f,a,h){let _=a[0],x=a[1];return f[0]=h[0]*_+h[4]*x+h[12],f[1]=h[1]*_+h[5]*x+h[13],f[3]=h[3]*_+h[7]*x+h[15],f}let If=(f,a,h)=>(1-h)*f+h*a,Vr=f=>f*f*f*f*f;class ra{constructor(a,h,_,x,C,T,E){this.tileSize=512,this._renderWorldCopies=C===void 0||C,this._minZoom=a||0,this._maxZoom=h||22,this._minPitch=_??0,this._maxPitch=x??60,this.setProjection(T),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new t.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new kh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Eh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let a=new ra(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(a,h=!1){let _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(a||_)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return t.ah(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};let h=this.projection?this.getProjection():void 0;this.projection=t.aJ(this.projectionOptions);let _=!g(h,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(a){return this._orthographicProjectionAtLowPitch!==a&&(this._orthographicProjectionAtLowPitch=a,this._calcMatrices(),!0)}setMercatorFromTransition(){let a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.aJ({name:"mercator"});let h=a!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){let a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return t.au(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){let h=-a*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=t.aC.create(),t.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){let h=t.at(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=t.ab(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){let h=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(a){this._tileCoverLift!==a&&(this._tileCoverLift=a)}_updateCameraOnTerrain(){let a=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&a===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||a===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let _=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=a||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let a=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop(),x=0,C=0;for(let T=0;T<h.length;T++){let E=new t.P(h[T][0]*this.width,_+h[T][1]*(this.height-_)),P=a.pointCoordinate(E);if(!P)continue;let O=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);x+=P[3]*O,C+=O}return C===0?NaN:x/C}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let a=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,x=this._mercatorZfromZoom(a),C=this._mercatorZfromZoom(this._maxZoom),T=Math.max(x-_,C);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){let h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude())),_;_=a.z<this._camera.position[2]?[h.x,h.y,h.z]:[a.x,a.y,a.z];let x=t._.length(t._.sub([],this._camera.position,_));return t.at(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let h=!1;if(a.orientation&&!t.av.exactEquals(a.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(a.orientation)),a.position){let _=[a.position.x,a.position.y,a.position.z];t._.exactEquals(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let a=this._camera.position,h=new Sf;return h.position=new t.Y(a[0],a[1],a[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(a){if(!t.av.length(a))return!1;t.av.normalize(a,a);let h=t._.transformQuat([],[0,0,-1],a),_=t._.transformQuat([],[0,-1,0],a);if(_[2]<0)return!1;let x=Kg(h,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(a){let h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;a[2]=t.at(a[2],x/_,x/h),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,h,_){this._unmodified=!1,this._edgeInsets.interpolate(a,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){let h=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(a){let h=[new t.aK(0,a)];if(this.renderWorldCopies){let _=this.pointCoordinate(new t.P(0,0)),x=this.pointCoordinate(new t.P(this.width,0)),C=this.pointCoordinate(new t.P(this.width,this.height)),T=this.pointCoordinate(new t.P(0,this.height)),E=Math.floor(Math.min(_.x,x.x,C.x,T.x)),P=Math.floor(Math.max(_.x,x.x,C.x,T.x)),O=1;for(let B=E-O;B<=P+O;B++)B!==0&&h.push(new t.aK(B,a))}return h}isLODDisabled(a){return(!a||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(a,h,_){let x=[];if(h[0]===0&&h[1]===0)return x;for(let T of a){let E=T.canonical,P=T.overscaledZ,O=T.wrap,B=1<<E.z,j=E.x+1<B,G=E.x>0,q=E.y+1<B,K=E.y>0,J=T.wrap-(G?0:1),ee=T.wrap+(j?0:1),te=G?E.x-1:B-1,ue=j?E.x+1:0;h[0]<0?(x.push(new t.aL(P,ee,E.z,ue,E.y)),h[1]<0&&q&&(x.push(new t.aL(P,O,E.z,E.x,E.y+1)),x.push(new t.aL(P,ee,E.z,ue,E.y+1))),h[1]>0&&K&&(x.push(new t.aL(P,O,E.z,E.x,E.y-1)),x.push(new t.aL(P,ee,E.z,ue,E.y-1)))):h[0]>0?(x.push(new t.aL(P,J,E.z,te,E.y)),h[1]<0&&q&&(x.push(new t.aL(P,O,E.z,E.x,E.y+1)),x.push(new t.aL(P,J,E.z,te,E.y+1))),h[1]>0&&K&&(x.push(new t.aL(P,O,E.z,E.x,E.y-1)),x.push(new t.aL(P,J,E.z,te,E.y-1)))):h[1]<0&&q?x.push(new t.aL(P,O,E.z,E.x,E.y+1)):K&&x.push(new t.aL(P,O,E.z,E.x,E.y-1))}if(x.length>1){x.sort((P,O)=>P.overscaledZ-O.overscaledZ||P.wrap-O.wrap||P.canonical.z-O.canonical.z||P.canonical.x-O.canonical.x||P.canonical.y-O.canonical.y);let T=0,E=0;for(;E<x.length;)x[E].equals(x[T])?++E:x[++T]=x[E++];x.length=T+1}let C=[];for(let T of x)x.some(E=>T.isChildOf(E))||C.push(T);return x=C.filter(T=>!a.some(E=>!!(T.overscaledZ<_&&E.isChildOf(T))||T.equals(E)||T.isChildOf(E))),x}coveringTiles(a){let h=this.coveringZoomLevel(a),_=h,x=this.elevation&&this.elevation.exaggeration(),C=x&&!a.isTerrainDEM,T=this.projection.name==="mercator";if(a.minzoom!==void 0&&h<a.minzoom)return[];a.maxzoom!==void 0&&h>a.maxzoom&&(h=a.maxzoom);let E=this.locationCoordinate(this.center),P=this.center.lat,O=1<<h,B=[O*E.x,O*E.y,0],j=this.projection.name==="globe",G=!j,q=t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,G),K=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=O*t.ax(1,this.center.lat),ee=this._camera.position[2]/t.ax(1,this.center.lat),te=[O*K.x,O*K.y,ee*(G?1:J)],ue=j||x,ce=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),he=this.isLODDisabled(!0)?h:0,Ce;if(this._elevation&&a.isTerrainDEM)Ce=1e4*this._elevation.exaggeration();else if(this._elevation){let Le=this._elevation.getMinMaxForVisibleTiles();Ce=Le?Le.max:this._centerAltitude}else Ce=this._centerAltitude;let we=a.isTerrainDEM?-Ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,de=this.projection.isReprojectedInTileSpace?t.aN(this):1,me=Le=>{let rt=new t.Y(Le.x+25e-6,Le.y,Le.z),Ot=new t.Y(Le.x,Le.y+25e-6,Le.z),Rt=Le.toLngLat(),Wt=rt.toLngLat(),Ft=Ot.toLngLat(),pt=this.locationCoordinate(Rt),nt=this.locationCoordinate(Wt),$t=this.locationCoordinate(Ft),Ii=Math.hypot(nt.x-pt.x,nt.y-pt.y),bi=Math.hypot($t.x-pt.x,$t.y-pt.y);return Math.sqrt(Ii*bi)*de/25e-6},fe=Le=>{let Ze=Ce,rt=we;return{aabb:t.aQ(this,O,0,0,0,Le,rt,Ze,this.projection),zoom:0,x:0,y:0,minZ:rt,maxZ:Ze,wrap:Le,fullyVisible:!1}},Ee=[],We=[],ye=h,He=a.reparseOverscaled?_:h,qe=Le=>Le*Le,ct=qe((ee-this._centerAltitude)*J),ut=Le=>{if(!this._elevation||!Le.tileID||!T)return;let Ze=this._elevation.getMinMaxForTile(Le.tileID),rt=Le.aabb;Ze?(rt.min[2]=Ze.min,rt.max[2]=Ze.max,rt.center[2]=(rt.min[2]+rt.max[2])/2):(Le.shouldSplit=lt(Le),Le.shouldSplit||(rt.min[2]=rt.max[2]=rt.center[2]=this._centerAltitude))},lt=Le=>{if(Le.zoom<he)return!0;if(Le.zoom===ye)return!1;if(Le.shouldSplit!=null)return Le.shouldSplit;let Ze=Le.aabb.distanceX(te),rt=Le.aabb.distanceY(te),Ot=ct,Rt=1;if(j){Ot=qe(Le.aabb.distanceZ(te));let pt=Math.pow(2,Le.zoom),nt=t.ay((Le.y+1)/pt),$t=t.ay(Le.y/pt),Ii=Math.min(Math.max(P,nt),$t),bi=t.b4(Ii)/t.b4(P);if(Rt=Ii===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,bi/this._mercatorScaleRatio),this.zoom<=t.b1&&Le.zoom===ye-1&&bi>=.9)return!0}else if(C&&(Ot=qe(Le.aabb.distanceZ(te)*J)),this.projection.isReprojectedInTileSpace&&_<=5){let pt=Math.pow(2,Le.zoom),nt=me(new t.Y((Le.x+.5)/pt,(Le.y+.5)/pt));Rt=nt>.85?1:nt}let Wt=Ze*Ze+rt*rt+Ot,Ft=qe((1<<ye-Le.zoom)*ce*Rt*((pt,nt)=>{if(nt*qe(.707)<pt)return 1;let $t=Math.sqrt(nt/pt);return $t/(1.4144271570014144+(Math.pow(1.1,$t-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ot,ct),Wt));return Wt<Ft};if(this.renderWorldCopies)for(let Le=1;Le<=3;Le++)Ee.push(fe(-Le)),Ee.push(fe(Le));for(Ee.push(fe(0));Ee.length>0;){let Le=Ee.pop(),Ze=Le.x,rt=Le.y,Ot=Le.fullyVisible,Rt=()=>this.projection.name==="globe"&&(Le.y===0||Le.y===(1<<Le.zoom)-1);if(!Ot){let Wt=ue?Le.aabb.intersects(q):Le.aabb.intersectsFlat(q);if(Wt===0&&Rt()){let Ft=new t.aO(Le.zoom,Ze,rt);Wt=t.aP(this,O,Ft,!0).intersects(q)}if(Wt===0)continue;Ot=Wt===2}if(Le.zoom!==ye&&lt(Le))for(let Wt=0;Wt<4;Wt++){let Ft=(Ze<<1)+Wt%2,pt=(rt<<1)+(Wt>>1),nt={aabb:T?Le.aabb.quadrant(Wt):t.aQ(this,O,Le.zoom+1,Ft,pt,Le.wrap,Le.minZ,Le.maxZ,this.projection),zoom:Le.zoom+1,x:Ft,y:pt,wrap:Le.wrap,fullyVisible:Ot,tileID:void 0,shouldSplit:void 0,minZ:Le.minZ,maxZ:Le.maxZ};C&&!j&&(nt.tileID=new t.aL(Le.zoom+1===ye?He:Le.zoom+1,Le.wrap,Le.zoom+1,Ft,pt),ut(nt)),Ee.push(nt)}else{let Wt=Le.zoom===ye?He:Le.zoom;if(a.minzoom&&a.minzoom>Wt)continue;if(!Ot){let $t=ue?Le.aabb.intersectsPrecise(q):Le.aabb.intersectsPreciseFlat(q);if($t===0&&Rt()){let Ii=new t.aO(Le.zoom,Ze,rt);$t=t.aP(this,O,Ii,!0).intersectsPrecise(q)}if($t===0)continue}let Ft=B[0]-(.5+Ze+(Le.wrap<<Le.zoom))*(1<<h-Le.zoom),pt=B[1]-.5-rt,nt=Le.tileID?Le.tileID:new t.aL(Wt,Le.wrap,Le.zoom,Ze,rt);We.push({tileID:nt,distanceSq:Ft*Ft+pt*pt})}}if(this.fogCullDistSq){let Le=this.fogCullDistSq,Ze=this.horizonLineFromTop();We=We.filter(rt=>{let Ot=[0,0,0,1],Rt=[t.a3,t.a3,0,1],Wt=this.calculateFogTileMatrix(rt.tileID.toUnwrapped());t.aA.transformMat4(Ot,Ot,Wt),t.aA.transformMat4(Rt,Rt,Wt);let Ft=t.aA.min([],Ot,Rt),pt=t.aA.max([],Ot,Rt),nt=t.aR(Ft,pt);if(nt===0)return!0;let $t=!1,Ii=this._elevation;if(Ii&&nt>Le&&Ze!==0){let bi=this.calculateProjMatrix(rt.tileID.toUnwrapped()),Fi;a.isTerrainDEM||(Fi=Ii.getMinMaxForTile(rt.tileID)),Fi||(Fi={min:we,max:Ce});let Gi=t.b2(this.rotation),yn=[Gi[0]*t.a3,Gi[1]*t.a3,Fi.max];t._.transformMat4(yn,yn,bi),$t=(1-yn[1])*this.height*.5<Ze}return nt<Le||$t})}return We.sort((Le,Ze)=>Le.distanceSq-Ze.distanceSq).map(Le=>Le.tileID)}resize(a,h){this.width=a,this.height=h,this.pixelsToGLUnits=[2/a,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){let h=t.at(a.lat,-t.aS,t.aS),_=this.projection.project(a.lng,h);return new t.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,h){let _,x,C=this.centerPoint;if(this.projection.name==="globe"){let E=this.worldSize;_=(h.x-C.x)/E,x=(h.y-C.y)/E}else{let E=this.pointCoordinate(h),P=this.pointCoordinate(C);_=E.x-P.x,x=E.y-P.y}let T=this.locationCoordinate(a);this.setLocation(new t.Y(T.x-_,T.y-x))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,h){let _=h?t.ax(h,a.lat):void 0,x=this.projection.project(a.lng,a.lat);return new t.Y(x.x,x.y,_)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,h){let _=h??this._centerAltitude,x=[a.x,a.y,0,1],C=[a.x,a.y,1,1];t.aA.transformMat4(x,x,this.pixelMatrixInverse),t.aA.transformMat4(C,C,this.pixelMatrixInverse);let T=C[3];t.aA.scale(x,x,1/x[3]),t.aA.scale(C,C,1/T);let E=x[2],P=C[2];return{p0:x,p1:C,t:E===P?0:(_-E)/(P-E)}}screenPointToMercatorRay(a){let h=[a.x,a.y,0,1],_=[a.x,a.y,1,1];return t.aA.transformMat4(h,h,this.pixelMatrixInverse),t.aA.transformMat4(_,_,this.pixelMatrixInverse),t.aA.scale(h,h,1/h[3]),t.aA.scale(_,_,1/_[3]),h[2]=t.ax(h[2],this._center.lat)*this.worldSize,_[2]=t.ax(_[2],this._center.lat)*this.worldSize,t.aA.scale(h,h,1/this.worldSize),t.aA.scale(_,_,1/this.worldSize),new t.aT([h[0],h[1],h[2]],t._.normalize([],t._.sub([],_,h)))}rayIntersectionCoordinate(a){let{p0:h,p1:_,t:x}=a,C=t.ax(h[2],this._center.lat),T=t.ax(_[2],this._center.lat);return new t.Y(t.a2(h[0],_[0],x)/this.worldSize,t.a2(h[1],_[1],x)/this.worldSize,t.a2(C,T,x))}pointCoordinate(a,h=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,h)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let h=this.projection.pointCoordinate3D(this,a.x,a.y);if(h)return new t.Y(h[0],h[1],h[2]);let _=0,x=this.horizonLineFromTop();if(a.y>x)return this.pointCoordinate(a);let C=.02*x,T=a.clone();for(let E=0;E<10&&x-_>C;E++){T.y=t.a2(_,x,.66);let P=this.projection.pointCoordinate3D(this,T.x,T.y);P?(x=T.y,h=P):_=T.y}return h?new t.Y(h[0],h[1],h[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=t.aU)return!this.isPointAboveHorizon(a);let h=this.pointCoordinate(a);return h.y>=0&&h.y<=1}_coordinatePoint(a,h){let _=h&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,x=[a.x*this.worldSize,a.y*this.worldSize,_+a.toAltitude(),1];return t.aA.transformMat4(x,x,this.pixelMatrix),x[3]>0?new t.P(x[0]/x[3],x[1]/x[3]):new t.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:a,left:h}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,C=this.pointLocation3D(new t.P(h,a)),T=this.pointLocation3D(new t.P(x,a)),E=this.pointLocation3D(new t.P(x,_)),P=this.pointLocation3D(new t.P(h,_)),O=Math.min(C.lng,T.lng,E.lng,P.lng),B=Math.max(C.lng,T.lng,E.lng,P.lng),j=Math.min(C.lat,T.lat,E.lat,P.lat),G=Math.max(C.lat,T.lat,E.lat,P.lat),q=Math.pow(2,-this.zoom)/16*270,K=this.projection.name==="globe"?1:4,J=(ee,te,ue,ce,he)=>{let Ce=(ee+ue)/2,we=(te+ce)/2,de=new t.P(Ce,we),{lng:me,lat:fe}=this.pointLocation3D(de),Ee=Math.max(0,O-me,j-fe,me-B,fe-G);O=Math.min(O,me),B=Math.max(B,me),j=Math.min(j,fe),G=Math.max(G,fe),(he<K||Ee>q)&&(J(ee,te,Ce,we,he+1),J(Ce,we,ue,ce,he+1))};if(J(h,a,x,a,1),J(x,a,x,_,1),J(x,_,h,_,1),J(h,_,h,a,1),this.projection.name==="globe"){let[ee,te]=t.aV(this);ee?(G=90,B=180,O=-180):te&&(j=-90,B=180,O=-180)}return new t.ai(new t.aI(O,j),new t.aI(B,G))}_getBoundsRectangular(a,h){let{top:_,left:x}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,E=new t.P(x,_),P=new t.P(T,_),O=new t.P(T,C),B=new t.P(x,C),j=this.pointCoordinate(E,a),G=this.pointCoordinate(P,a),q=this.pointCoordinate(O,h),K=this.pointCoordinate(B,h),J=(ee,te)=>(te.y-ee.y)/(te.x-ee.x);return j.y>1&&G.y>=0?j=new t.Y((1-K.y)/J(K,j)+K.x,1):j.y<0&&G.y<=1&&(j=new t.Y(-K.y/J(K,j)+K.x,0)),G.y>1&&j.y>=0?G=new t.Y((1-q.y)/J(q,G)+q.x,1):G.y<0&&j.y<=1&&(G=new t.Y(-q.y/J(q,G)+q.x,0)),new t.ai().extend(this.coordinateLocation(j)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){let a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);let h=a.visibleDemTiles.reduce((_,x)=>{if(x.dem){let C=x.dem.tree;_.min=Math.min(_.min,C.minimums[0]),_.max=Math.max(_.max,C.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*a.exaggeration(),h.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){let h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return a?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-t.aS,this.maxLat=t.aS,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.aj(this.minLng)*this.tileSize,this.worldMaxX=t.aj(this.maxLng)*this.tileSize,this.worldMinY=t.ak(this.maxLat)*this.tileSize,this.worldMaxY=t.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,h){return this.projection.createTileMatrix(this,h,a)}calculateDistanceTileData(a){let h=a.key,_=this._distanceTileDataCache;if(_[h])return _[h];let x=a.canonical,C=1/this.height,T=this.cameraWorldSize,E=T/this.zoomScale(x.z),P=(x.x+Math.pow(2,x.z)*a.wrap)*E,O=x.y*E,B=this.point;B.x*=T/this.worldSize,B.y*=T/this.worldSize;let j=this.angle,G=Math.sin(-j),q=-Math.cos(-j);return _[h]={bearing:[G,q],center:[(B.x-P)*C,(B.y-O)*C],scale:E/t.a3*C},_[h]}calculateFogTileMatrix(a){let h=a.key,_=this._fogTileMatrixCache;if(_[h])return _[h];let x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return t.ad.multiply(x,this.worldToFogMatrix,x),_[h]=new Float32Array(x),_[h]}calculateProjMatrix(a,h=!1,_=!1){let x=a.key,C;if(C=_?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,C[x])return C[x];let T=this.calculatePosMatrix(a,this.worldSize),E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,t.ad.multiply(T,E,T),C[x]=new Float32Array(T),C[x]}calculatePixelsToTileUnitsMatrix(a){let h=a.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];let x=t.aW(a,this);return _[h]=x,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let a=1/this.worldSize,h=t.ad.fromScaling([],[a,a,a]);return t.ad.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let a=this._elevation;this._updateCameraState();let h=t.ax(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),x=this._camera.forward(),C=t.ax(1,this._center.lat);_[2]/=C,x[2]/=C,t._.normalize(x,x);let T=a.raycast(_,x,a.exaggeration());if(T){let E=t._.scaleAndAdd([],_,x,T),P=new t.Y(E[0],E[1],t.ax(E[2],t.ay(E[1]))),O=(P.z+t._.length([P.x-_[0],P.y-_[1],P.z-_[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;let h=this._elevation,_=t.ax(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(_),C=h.getAtPointOrZero(new t.Y(...x)),T=this.pixelsPerMeter/this.worldSize*C,E=this._minimumHeightOverTerrain(),P=x[2]-T;if(P<=E)if(P<0||a){let O=this.locationCoordinate(this._center,this._centerAltitude),B=[x[0],x[1],O.z-x[2]],j=t._.length(B);B[2]-=(E-P)/this._pixelsPerMercatorPixel;let G=t._.length(B);if(G===0)return;t._.scale(B,B,j/G*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],O.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){let G=this.center;return G.lat=t.at(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(G.lng=t.at(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}let h=this._unmodified,{x:_,y:x}=this.point,C=0,T=_,E=x,P=this.width/2,O=this.height/2,B=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(x-O<B&&(E=B+O),x+O>j&&(E=j-O),j-B<this.height&&(C=Math.max(C,this.height/(j-B)),E=(j+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let G=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,K=this.worldSize/2-(G+q)/2;T=(_+K+this.worldSize)%this.worldSize-K,T-P<G&&(T=G+P),T+P>q&&(T=q-P),q-G<this.width&&(C=Math.max(C,this.width/(q-G)),T=(q+G)/2)}T===_&&E===x||(this.center=this.unproject(new t.P(T,E))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let a=this.centerOffset,h=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=t.ax(1,this.center.lat)/t.ax(1,t.b3));let x=t.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let C=this.projection.zAxisUnit==="meters"?_:1,T=this._camera.getWorldToCamera(this.worldSize,C),E,P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(P[8]=2*-a.x/this.width,P[9]=2*a.y/this.height,this.isOrthographic){let fe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ee=fe*this.aspect,We=-Ee,ye=-fe;Ee-=a.x,We-=a.x,fe+=a.y,ye+=a.y,E=this._camera.getCameraToClipOrthographic(We,Ee,ye,fe,this._nearZ,this._farZ),((He,qe,ct,ut)=>{for(let lt=0;lt<16;lt++)He[lt]=If(qe[lt],ct[lt],ut)})(E,E,P,Vr(this.pitch>=15?1:this.pitch/15))}else E=P;let O=t.ad.mul([],P,T),B=t.ad.mul([],E,T);if(this.projection.isReprojectedInTileSpace){let fe=this.locationCoordinate(this.center),Ee=t.ad.identity([]);t.ad.translate(Ee,Ee,[fe.x*this.worldSize,fe.y*this.worldSize,0]),t.ad.multiply(Ee,Ee,t.aY(this)),t.ad.translate(Ee,Ee,[-fe.x*this.worldSize,-fe.y*this.worldSize,0]),t.ad.multiply(B,B,Ee),t.ad.multiply(O,O,Ee),this.inverseAdjustmentMatrix=t.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=t.ad.scale([],B,[this.worldSize,this.worldSize,this.worldSize/C,1]),this.projMatrix=B,this.invProjMatrix=t.ad.invert(new Float64Array(16),this.projMatrix),h){let fe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);fe[8]=2*-a.x/this.width,fe[9]=2*a.y/this.height,this.expandedFarZProjMatrix=t.ad.mul([],fe,T)}else this.expandedFarZProjMatrix=this.projMatrix;let j=t.ad.invert([],E);this.frustumCorners=t.a_.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height),this.cameraFrustum=t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);let G=new Float32Array(16);t.ad.identity(G),t.ad.scale(G,G,[1,-1,1]),t.ad.rotateX(G,G,this._pitch),t.ad.rotateZ(G,G,this.angle);let q=t.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=t.ad.clone(q);let K=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-a.x/this.width,q[9]=2*(a.y+K)/this.height,this.skyboxMatrix=t.ad.multiply(G,q,G);let J=this.point,ee=J.x,te=J.y,ue=this.width%2/2,ce=this.height%2/2,he=Math.cos(this.angle),Ce=Math.sin(this.angle),we=ee-Math.round(ee)+he*ue+Ce*ce,de=te-Math.round(te)+he*ce+Ce*ue,me=new Float64Array(B);if(t.ad.translate(me,me,[we>.5?we-1:we,de>.5?de-1:de,0]),this.alignedProjMatrix=me,B=t.ad.create(),t.ad.scale(B,B,[this.width/2,-this.height/2,1]),t.ad.translate(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=t.ad.create(),t.ad.scale(B,B,[1,-1,1]),t.ad.translate(B,B,[-1,-1,0]),t.ad.scale(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=t.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},B=t.ad.invert(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=t.a$(this);let fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t._.transformMat4(fe,fe,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let a=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,C=[a,a,h];t._.scale(C,C,x),t._.scale(_,_,-1),t._.multiply(_,_,C);let T=t.ad.create();t.ad.translate(T,T,_),t.ad.scale(T,T,C),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,h,x)}_computeCameraPosition(a){let h=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-a/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*C,x.y/this.worldSize-_[1]*C,a/this.worldSize*this._centerAltitude-_[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){let h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],x=a[2],C=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(C=Math.min((h-_)/x,1)),this._camera.position=t._.scaleAndAdd([],this._camera.position,a,C),this._updateStateFromCamera()}_updateStateFromCamera(){let a=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),C=t.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.ab(this._maxPitch)),E=Math.max((a[2]-C)/Math.cos(_),T),P=this._zoomFromMercatorZ(E);t._.scaleAndAdd(a,a,h,E),this._pitch=t.at(_,t.ab(this.minPitch),t.ab(this.maxPitch)),this.angle=t.au(x,-Math.PI,Math.PI),this._setZoom(t.at(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.Y(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){let a=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let h=0,_=t.aU,x=0,C=1/0;for(;_-h>1e-6&&_>h;){let T=h+.5*(_-h),E=this.tileSize*Math.pow(2,T),P=this.getCameraToCenterDistance(this.projection,T,E),O=this.scaleZoom(P/(a*this.tileSize)),B=Math.abs(T-O);B<C&&(C=B,x=T),T<O?h=T:_=T}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,h){let _=Math.min(a.x,h.x),x=Math.max(a.x,h.x),C=Math.min(a.y,h.y),T=Math.max(a.y,h.y);if(C<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let E=[new t.P(_,C),new t.P(x,T),new t.P(_,T),new t.P(x,C)],P=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(let B of E){let j=this.pointRayIntersection(B);if(j.t<0)return!0;let G=this.rayIntersectionCoordinate(j);if(G.x<P||G.y<0||G.x>O||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.P(0,0),new t.P(this.width,this.height))}zoomDeltaToMovement(a,h){let _=t._.length(t._.sub([],this._camera.position,a)),x=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){let a=function([h,_,x],C){let T=[h,_,x,1];t.aA.transformMat4(T,T,C);let E=T[3]=Math.max(T[3],1e-6);return T[0]/=E,T[1]/=E,T[2]/=E,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.P(a[0],a[1])}{let a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,a))}}getCameraToCenterDistance(a,h=this.zoom,_=this.worldSize){let x=t.aX(a,h,this.width,this.height,1024),C=a.pixelSpaceConversion(this.center.lat,_,x),T=.5/Math.tan(.5*this._fov)*this.height*C;return this.isOrthographic&&(T=If(1,T,Vr(this.pitch>=15?1:this.pitch/15))),T}getWorldToCameraMatrix(){let a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&t.ad.multiply(a,a,this.globeMatrix),a}getFrustum(a){return t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,this.projection.zAxisUnit==="meters")}}let ko={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},Rs=(f,a)=>{if(a>0&&f.terrain&&t.w("Cutoff is currently disabled on terrain"),a<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let h=f.transform,_=Math.max(Math.abs(h._zoom-(f.minCutoffZoom-1)),1),x=h.isLODDisabled(!1)?t.$(60,45,h.pitch):t.$(30,15,h.pitch),C=h._farZ-h._nearZ,T=a*h.height,E=((1-(P=x))*h.cameraToCenterDistance+P*(h._farZ+T))*_;var P;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(E-h._nearZ)/C,(E-T-h._nearZ)/C]}}},Cn={cascadeCount:2,shadowMapResolution:2048};class el{constructor(a,h){this.aabb=a,this.lastCascade=h}}class Oh{add(a,h){let _=this.receivers[a.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],h.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],h.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],h.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],h.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],h.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],h.max[2])):this.receivers[a.key]=new el(h,null)}clear(){this.receivers={}}get(a){return this.receivers[a.key]}computeRequiredCascades(a,h,_){let x=t.b6.fromPoints(a.points),C=0;for(let T in this.receivers){let E=this.receivers[T];if(!E||!x.intersectsAabb(E.aabb))continue;E.aabb.min=x.closestPoint(E.aabb.min),E.aabb.max=x.closestPoint(E.aabb.max);let P=E.aabb.getCorners();for(let O=0;O<_.length;O++){let B=!0;for(let j of P){let G=[j[0]*h,j[1]*h,j[2]];if(t._.transformMat4(G,G,_[O].matrix),G[0]<-1||G[0]>1||G[1]<-1||G[1]>1){B=!1;break}}if(E.lastCascade=O,C=Math.max(C,O),B)break}}return C+1}}class ep{constructor(a){this.painter=a,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Oh,this._depthMode=new t.ae(a.context.gl.LEQUAL,t.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,a.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),a.tp.registerParameter(Cn,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),a.tp.registerParameter(Cn,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),a.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let a of this._cascades)a.texture.destroy(),a.framebuffer.destroy();this._cascades=[]}updateShadowParameters(a,h){let _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;let x=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||x<=0||(this._shadowLayerCount=_.style.order.reduce((K,J)=>{let ee=_.style._mergedLayers[J];return K+(ee.hasShadowPass()&&!ee.isHidden(a.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let C=_.context,T=Cn.shadowMapResolution,E=Cn.shadowMapResolution;if(this._cascades.length===0||Cn.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let K=0;K<Cn.cascadeCount;++K){let J=_._shadowMapDebug,ee=C.gl,te=C.createFramebuffer(T,E,J,"texture"),ue=new t.T(C,{width:T,height:E,data:null},ee.DEPTH_COMPONENT);if(te.depthAttachment.set(ue.texture),J){let ce=new t.T(C,{width:T,height:E,data:null},ee.RGBA);te.colorAttachment.set(ce.texture)}this._cascades.push({framebuffer:te,texture:ue,matrix:[],far:0,boundingSphereRadius:0,frustum:new t.aM,scale:0})}}this.shadowDirection=Rh(h);let P=0;if(a.elevation){let K=a.elevation,J=[1e4,-1e4];K.visibleDemTiles.filter(ee=>ee.dem).forEach(ee=>{let te=ee.dem.tree;J[0]=Math.min(J[0],te.minimums[0]),J[1]=Math.max(J[1],te.maximums[0])}),J[0]!==1e4&&(P=(J[1]-J[0])*K.exaggeration())}let O=1.5*a.cameraToCenterDistance,B=3*O,j=new Float64Array(16);for(let K=0;K<this._cascades.length;++K){let J=this._cascades[K],ee=a.height/50,te=1;Cn.cascadeCount===1?te=B:K===0?te=O:(ee=O,te=B);let[ue,ce]=Fh(a,this.shadowDirection,ee,te,Cn.shadowMapResolution,P);J.scale=a.scale,J.matrix=ue,J.boundingSphereRadius=ce,t.ad.invert(j,J.matrix),J.frustum=t.aM.fromInvProjectionMatrix(j,1,0,!0),J.far=te}let G=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[G].far,this._cascades[G].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Cn.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Cn.shadowMapResolution,this._uniformValues.u_shadowmap_0=ko.ShadowMap0,this._uniformValues.u_shadowmap_1=ko.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let q=_.transform.elevation;for(let K of this._groundShadowTiles){let J={min:0,max:0};if(q){let ee=q.getMinMaxForTile(K);ee&&(J=ee)}this.addShadowReceiver(K.toUnwrapped(),J.min,J.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(a){this._enabled=a}drawShadowPass(a,h){if(!this.enabled)return;let _=this.painter,x=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),x.viewport.set([0,0,Cn.shadowMapResolution,Cn.shadowMapResolution]);for(let C=0;C<this._numCascadesToRender;++C){_.currentShadowCascade=C,x.bindFramebuffer.set(this._cascades[C].framebuffer.framebuffer),x.clear({color:t.C.white,depth:1});for(let T of a.order){let E=a._mergedLayers[T];if(!E.hasShadowPass()||E.isHidden(_.transform.zoom))continue;let P=a.getLayerSourceCache(E),O=P?h[P.id]:void 0;(E.type==="model"||O&&O.length)&&_.renderLayer(_,P,E,O)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let a=this.painter,h=a.style,_=a.context,x=h.directionalLight,C=h.ambientLight;if(!x||!C)return;let T=[],E=Rs(a,a.longestCutoffRange);E.shouldRenderCutoff&&T.push("RENDER_CUTOFF");let P=zl(h,x,C),O=new t.ae(_.gl.LEQUAL,t.ae.ReadOnly,a.depthRangeFor3D);for(let B of this._groundShadowTiles){let j=B.toUnwrapped(),G=a.isTileAffectedByFog(B),q=a.getOrCreateProgram("groundShadow",{defines:T,overrideFog:G});this.setupShadows(j,q),a.uploadCommonUniforms(_,q,j,null,E);let K={u_matrix:a.transform.calculateProjMatrix(j),u_ground_shadow_factor:P};q.draw(a,_.gl.TRIANGLES,O,t.ag.disabled,t.a.multiply,t.af.disabled,K,"ground_shadow",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments,{},a.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?t.a.unblended:t.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(a){let h=this.painter.transform,_=h.calculatePosMatrix(a,h.worldSize);return t.ad.multiply(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(a){return t.ad.multiply(a,this._cascades[this.painter.currentShadowCascade].matrix,a),Float32Array.from(a)}setupShadows(a,h,_,x=0){if(!this.enabled)return;let C=this.painter.transform,T=this.painter.context,E=T.gl,P=this._uniformValues,O=new Float64Array(16),B=C.calculatePosMatrix(a,C.worldSize);for(let j=0;j<this._cascades.length;j++)t.ad.multiply(O,this._cascades[j].matrix,B),P[j===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),T.activeTexture.set(E.TEXTURE0+ko.ShadowMap0+j),this._cascades[j].texture.bind(E.NEAREST,E.CLAMP_TO_EDGE);if(this.useNormalOffset=!!_,this.useNormalOffset){let j=t.b5(a.canonical),G=2/C.tileSize*t.a3/Cn.shadowMapResolution,q=G*this._cascades[0].boundingSphereRadius,K=G*this._cascades[this._cascades.length-1].boundingSphereRadius,J=(_==="vector-tile"?1:3)/Math.pow(2,x-a.canonical.z-(1-C.zoom+Math.floor(C.zoom)));P.u_shadow_normal_offset=[j,q*J,K*J],P.u_shadow_bias=[6e-5,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(T,P)}setupShadowsFromMatrix(a,h,_=!1){if(!this.enabled)return;let x=this.painter.context,C=x.gl,T=this._uniformValues,E=new Float64Array(16);for(let P=0;P<Cn.cascadeCount;P++)t.ad.multiply(E,this._cascades[P].matrix,a),T[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),x.activeTexture.set(C.TEXTURE0+ko.ShadowMap0+P),this._cascades[P].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);this.useNormalOffset=_,_?(T.u_shadow_normal_offset=[1,5,5],T.u_shadow_bias=[6e-5,.0012,.012]):T.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(x,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(a,h,_,x){if(x[2]>=0)return{};let C=function(P,O,B){let j=B/(1<<P.canonical.z);return new t.b6([P.canonical.x*j+P.wrap*B,P.canonical.y*j+P.wrap*B,0],[(P.canonical.x+1)*j+P.wrap*B,(P.canonical.y+1)*j+P.wrap*B,O])}(a,h,_).getCorners(),T=h/-x[2];x[0]<0?(t._.add(C[0],C[0],[x[0]*T,0,0]),t._.add(C[3],C[3],[x[0]*T,0,0])):x[0]>0&&(t._.add(C[1],C[1],[x[0]*T,0,0]),t._.add(C[2],C[2],[x[0]*T,0,0])),x[1]<0?(t._.add(C[0],C[0],[0,x[1]*T,0]),t._.add(C[1],C[1],[0,x[1]*T,0])):x[1]>0&&(t._.add(C[2],C[2],[0,x[1]*T,0]),t._.add(C[3],C[3],[0,x[1]*T,0]));let E={};return E.vertices=C,E.planes=[fc(C[1],C[0],C[4]),fc(C[2],C[1],C[5]),fc(C[3],C[2],C[6]),fc(C[0],C[3],C[7])],E}addShadowReceiver(a,h,_){this._receivers.add(a,t.b6.fromTileIdAndHeight(a,h,_))}getMaxCascadeForTile(a){let h=this._receivers.get(a);return h&&h.lastCascade?h.lastCascade:0}}function fc(f,a,h){let _=t._.sub([],h,a),x=t._.sub([],f,a),C=t._.cross([],_,x),T=t._.length(C);return T===0?[0,0,1,0]:(t._.scale(C,C,1/T),[C[0],C[1],C[2],-t._.dot(C,a)])}function Rh(f){let a=f.properties.get("direction"),h=t.ac(a.x,a.y,a.z);h[2]=t.at(h[2],0,75);let _=t.b7([h[0],h[1],h[2]]);return t._.fromValues(_.x,_.y,_.z)}function zl(f,a,h){let _=a.properties.get("color"),x=a.properties.get("intensity"),C=a.properties.get("direction"),T=[C.x,C.y,C.z],E=h.properties.get("color"),P=h.properties.get("intensity"),O=Math.max(t._.dot([0,0,1],T),0),B=[0,0,0];t._.scale(B,E.toRenderColor(f.getLut(a.scope)).toArray01Linear().slice(0,3),P);let j=[0,0,0];return t._.scale(j,_.toRenderColor(f.getLut(h.scope)).toArray01Linear().slice(0,3),O*x),t.b8([B[0]>0?B[0]/(B[0]+j[0]):0,B[1]>0?B[1]/(B[1]+j[1]):0,B[2]>0?B[2]/(B[2]+j[2]):0])}function Fh(f,a,h,_,x,C){let T=f.zoom,E=f.scale,P=f.worldSize,O=1/P,B=f.aspect,j=Math.sqrt(1+B*B)*Math.tan(.5*f.fovX),G=j*j,q=_-h,K=_+h,J,ee;G>q/K?(J=_,ee=_*j):(J=.5*K*(1+G),ee=.5*Math.sqrt(q*q+2*(_*_+h*h)*G+K*K*G*G));let te=f.projection.pixelsPerMeter(f.center.lat,P),ue=f._camera.getCameraToWorldMercator(),ce=[0,0,-J*O];t._.transformMat4(ce,ce,ue);let he=ee*O,Ce=f._edgeInsets;if(!(Ce.left===0&&Ce.top===0&&Ce.right===0&&Ce.bottom===0||Ce.left===Ce.right&&Ce.top===Ce.bottom)){let Ot=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?te:1),Rt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,h,_);Rt[8]=2*-f.centerOffset.x/f.width,Rt[9]=2*f.centerOffset.y/f.height;let Wt=new Float64Array(16);t.ad.mul(Wt,Rt,Ot);let Ft=new Float64Array(16);t.ad.invert(Ft,Wt);let pt=t.aM.fromInvProjectionMatrix(Ft,P,T,!0);for(let nt of pt.points){let $t=((we=nt)[0]/=E,we[1]/=E,we[2]=t.ax(we[2],f._center.lat),we);he=Math.max(he,t._.len(t._.subtract([],ce,$t)))}}var we;he*=x/(x-1);let de=Math.acos(a[2]),me=Math.atan2(-a[0],-a[1]),fe=new Eh;fe.position=ce,fe.setPitchBearing(de,me);let Ee=fe.getWorldToCamera(P,te),We=he*P,ye=Math.min(f._mercatorZfromZoom(17)*P*-2,-2*We),He=fe.getCameraToClipOrthographic(-We,We,-We,We,ye,(We+C*te)/a[2]),qe=new Float64Array(16);t.ad.multiply(qe,He,Ee);let ct=t._.fromValues(Math.floor(1e6*ce[0])/1e6*P,Math.floor(1e6*ce[1])/1e6*P,0),ut=.5*x,lt=[0,0,0];t._.transformMat4(lt,ct,qe),t._.scale(lt,lt,ut);let Le=[Math.floor(lt[0]),Math.floor(lt[1]),Math.floor(lt[2])],Ze=[0,0,0];t._.sub(Ze,lt,Le),t._.scale(Ze,Ze,-1/ut);let rt=new Float64Array(16);return t.ad.identity(rt),t.ad.translate(rt,rt,Ze),t.ad.multiply(qe,rt,qe),[qe,We]}function Lh(f,a){return f!=null&&a!=null&&!(!f.hasData()||!a.hasData())&&f.demTexture!=null&&a.demTexture!=null&&f.tileID.key!==a.tileID.key}let tl=new class{constructor(){this.operations={}}newMorphing(f,a,h,_,x){if(f in this.operations){let C=this.operations[f];C.to.tileID.key!==h.tileID.key&&(C.queued=h)}else this.operations[f]={startTime:_,phase:0,duration:x,from:a,to:h,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;let a=this.operations[f];return{from:a.from,to:a.to,phase:a.phase}}update(f){for(let a in this.operations){let h=this.operations[a];for(h.phase=(f-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,f)){delete this.operations[a];break}}}_nextOp(f,a){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=a,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},il={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Tf(f,a,h){if(a===0)return 0;let _=a<1&&h===514?.25/a:1;return 6*Math.pow(1.5,22-f)*Math.max(a,1)*_}function Mf(f,a){let h=1<<f.z;return!a&&(f.x===0||f.x===h-1)||f.y===0||f.y===h-1}let zh=f=>({u_matrix:f});function uu(f,a,h,_,x){if(x>0){let C=t.e.now(),T=(C-f.timeAdded)/x,E=a?(C-a.timeAdded)/x:-1,P=h.getSource(),O=_.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),B=!a||Math.abs(a.tileID.overscaledZ-O)>Math.abs(f.tileID.overscaledZ-O),j=B&&f.refreshedUponExpiration?1:t.at(B?T:1-E,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),a?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class gc extends Mh{constructor(a,h,_,x){super(a,h,_,x),this.type="raster-array",this.maxzoom=22,this._options=t.W({type:"raster-array"},h)}triggerRepaint(a){let h=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);h&&h.enabled&&_&&h._clearRenderCacheForTile(_.id,a.tileID),this.map.triggerRepaint()}loadTile(a,h){let _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(_,t.R.Tile);a.requestParams=x,a.actor||(a.actor=this.dispatcher.getActor()),a.request=a.fetchHeader(void 0,(C,T,E,P)=>{if(delete a.request,a.aborted)return a.state="unloaded",h(null);if(C)return C.code===20?void 0:(a.state="errored",h(C));this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:E,expires:P}),a.state="empty",h(null)})}unloadTile(a,h){let _=a.texture;_&&_ instanceof t.T?(a.destroy(!0),this.map.painter.saveTileTexture(_)):(a.destroy(),a.flushQueues(),a._isHeaderLoaded=!1,delete a._mrt,delete a.textureDescriptor),a.fbo&&(a.fbo.destroy(),delete a.fbo),delete a.request,delete a.requestParams,delete a.neighboringTiles,a.state="unloaded"}prepareTile(a,h,_){a._isHeaderLoaded&&(a.state!=="empty"&&(a.state="reloading"),a.fetchBand(h,_,(x,C)=>{if(x)return a.state="errored",this.fire(new t.d(x)),void this.triggerRepaint(a);C&&(a.setTexture(C,this.map.painter),a.state="loaded",this.triggerRepaint(a))}))}getInitialBand(a){if(!this.rasterLayers)return 0;let h=this.rasterLayers.find(({id:C})=>C===a),_=h&&h.fields,x=_&&_.bands&&_.bands;return x?x[0]:0}getTextureDescriptor(a,h,_){if(!a)return;let x=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let C=null;h instanceof t.bk?C=h.paint.get("raster-array-band"):h instanceof t.bl&&(C=h.paint.get("raster-particle-array-band"));let T=C||this.getInitialBand(x);if(T!=null)if(a.textureDescriptor){if(!a.updateNeeded(x,T)||_)return Object.assign({},a.textureDescriptor,{texture:a.texture})}else this.prepareTile(a,x,T)}}let Eo={vector:Qm,raster:Mh,"raster-dem":class extends Mh{constructor(f,a,h,_){super(f,a,h,_),this.type="raster-dem",this.maxzoom=22,this._options=t.W({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(f,a){let h=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,C){x&&(f.state="errored",a(x)),C&&(f.dem=C,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",a(null))}f.request=t.h(this.map._requestManager.transformRequest(h,t.R.Tile),(function(x,C,T,E){if(delete f.request,f.aborted)f.state="unloaded",a(null);else if(x)f.state="errored",a(x);else if(C){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:T,expires:E});let P=ImageBitmap&&C instanceof ImageBitmap&&t.bi(),O=1-(C.width-t.bj(C.width))/2;O<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));let B=P?C:t.e.getImageData(C,O),j={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:B,encoding:this.encoding,padding:O};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",j,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){let a=f.canonical,h=Math.pow(2,a.z),_=(a.x-1+h)%h,x=a.x===0?f.wrap-1:f.wrap,C=(a.x+1+h)%h,T=a.x+1===h?f.wrap+1:f.wrap,E={};return E[new t.aL(f.overscaledZ,x,a.z,_,a.y).key]={backfilled:!1},E[new t.aL(f.overscaledZ,T,a.z,C,a.y).key]={backfilled:!1},a.y>0&&(E[new t.aL(f.overscaledZ,x,a.z,_,a.y-1).key]={backfilled:!1},E[new t.aL(f.overscaledZ,f.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},E[new t.aL(f.overscaledZ,T,a.z,C,a.y-1).key]={backfilled:!1}),a.y+1<h&&(E[new t.aL(f.overscaledZ,x,a.z,_,a.y+1).key]={backfilled:!1},E[new t.aL(f.overscaledZ,f.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},E[new t.aL(f.overscaledZ,T,a.z,C,a.y+1).key]={backfilled:!1}),E}},"raster-array":gc,geojson:class extends t.E{constructor(f,a,h,_){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=a.data,this._options=t.W({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.minzoom!==void 0&&(this.minzoom=a.minzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;let x=t.a3/this.tileSize;this.workerOptions=t.W({source:this.id,scope:this.scope,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*x,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*x,extent:t.a3,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:t.a3,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*x,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter,dynamic:a.dynamic},a.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){return this._options.dynamic?typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection")?this.fire(new t.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...f.features):this._data=f,this._updateWorkerData(!0),this):this.fire(new t.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(f,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},a),this}getClusterChildren(f,a){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},a),this}getClusterLeaves(f,a,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:a,offset:h},_),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.f("dataloading",{dataType:"source"})),this._loaded=!1;let a=t.W({append:f},this.workerOptions);a.scope=this.scope;let h=this._data;typeof h=="string"?(a.request=this.map._requestManager.transformRequest(t.e.resolveURL(h),t.R.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,a,(_,x)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new t.d(_));else{let C={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(C.resourceTiming=x.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new t.f("data",C)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,a){let h=f.actor?"reloadTile":"loadTile";f.actor=this.actor;let _=this.map.style?this.map.style.getLut(this.scope):null,x=this._partialReload,C={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_?{image:_.image.clone()}:null,scope:this.scope,pixelRatio:t.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:x};f.request=this.actor.send(h,C,(T,E)=>x&&!E?(f.state="loaded",a(null)):(delete f.request,f.destroy(),f.aborted?a(null):T?a(T):(f.loadVectorData(E,this.map.painter,h==="reloadTile"),a(null))),void 0,h==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,a){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends t.bm{constructor(f,a,h,_){super(f,a,h,_),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;let f=this.options;this.urls=[];for(let a of f.urls)this.urls.push(this.map._requestManager.transformRequest(a,t.R.Source).url);t.bn(this.urls,(a,h)=>{this._loaded=!0,a?this.fire(new t.d(a)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){let a=this.video.seekable;f<a.start(0)||f>a.end(0)?this.fire(new t.d(new t.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let f=this.map.painter.context,a=f.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(f,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:t.bm,model:class extends t.E{constructor(f,a,h,_){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=a}load(){let f=[];for(let a in this._options.models){let h=this._options.models[a],_=t.l(this.map._requestManager.transformRequest(h.uri,t.R.Model).url).then(x=>{if(!x)return;let C=t.c(x),T=new t.M(a,h.position,h.orientation,C);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(x=>{this.fire(new t.d(new Error(`Could not load model ${a} from ${h.uri}: ${x.message}`)))});f.push(_)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this.fire(new t.d(new Error(`Could not load models: ${a.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,a){}serialize(){return{type:"model"}}},"batched-model":class extends t.E{constructor(f,a,h,_){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=a,this.tiles=this._options.tiles,this.maxzoom=a.maxzoom||19,this.minzoom=a.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"}));let a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=Cf(this._options,this.map._requestManager,a,h,(_,x)=>{this._tileJSONRequest=null,this._loaded=!0,_?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new t.d(_))):x&&(t.W(this,x),x.bounds&&(this.tileBounds=new Th(x.bounds,this.minzoom,this.maxzoom)),t.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),f&&f(_)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,a){let h=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(h,t.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=a;else{if(f.buckets){let C=Object.values(f.buckets);for(let T of C)T.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",_,x.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",_,x.bind(this),void 0,!0);function x(C,T){return f.aborted?a(null):C&&C.status!==404?a(C):(T&&(T.resourceTiming&&(f.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&f.setExpiryData(T),f.buckets=Dn(Dn({},f.buckets),T.buckets),T.featureIndex&&(f.latestFeatureIndex=T.featureIndex)),f.state="loaded",void a(null))}}serialize(){return t.W({},this._options)}},canvas:class extends t.bm{constructor(f,a,h,_){super(f,a,h,_),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(C=>typeof C!="number"))||this.fire(new t.d(new t.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.d(new t.V(`sources.${f}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new t.d(new t.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new t.d(new t.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.d(new t.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let a=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof t.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends t.E{constructor(f,a,h,_){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=a,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Th(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),t.W(this,t.ah(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){let{x:a,y:h,z:_}=f.canonical;return this._implementation.hasTile({x:a,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,a){let{x:h,y:_,z:x}=f.tileID.canonical,C=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:h,y:_,z:x},{signal:C.signal})).then((function(T){return delete f.request,f.aborted?(f.state="unloaded",a(null)):T===void 0?(f.state="errored",a(null)):T===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",a(null)):function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement}(T)?(this.loadTileData(f,T),f.state="loaded",void a(null)):(f.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.code!==20&&(f.state="errored",a(T))}),f.request.cancel=()=>C.abort()}loadTileData(f,a){f.setTexture(a,this._map.painter)}unloadTile(f,a){if(f.texture&&f.texture instanceof t.T?(f.destroy(!0),f.texture&&f.texture instanceof t.T&&this._map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){let{x:h,y:_,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:x})}a&&a()}abortTile(f,a){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),a&&a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){let f=t.al(this.id,this.scope);this._map.style.clearSource(f)}_update(){this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))}}},tp=function(f,a,h,_){let x=new Eo[a.type](f,a,h,_);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return t.bp(["load","abort","unload","serialize","prepare"],x),x};class Bh extends t.bv{constructor(a){let h={type:"raster-dem",maxzoom:a.transform.maxZoom},_=new t.bw(t.bx(),null),x=tp("mock-dem",h,_,a.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,h){a.state="loaded",h(null)}}class ip extends t.bv{constructor(a){let h=tp("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new t.bw(t.bx(),null),a.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,h,_){if(a.freezeTileCoverage)return;this.transform=a;let x=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,T)=>{if(C[T.key]="",!this._tiles[T.key]){let E=new t.by(T,this._source.tileSize*T.overscaleFactor(),a.tileZoom);E.state="loaded",this._tiles[T.key]=E}return C},{});for(let C in this._tiles)C in x||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(a){let h=this.proxyCachedFBO[a];if(h!==void 0){let _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class kf extends t.aL{constructor(a,h,_){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class np extends t.bq{constructor(a,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},a.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[_,x,C]=function(P){let O=new t.bt,B=new t.bu,j=131;O.reserve(17161),B.reserve(33800);let G=t.a3/128,q=t.a3+G/2,K=q+G;for(let ee=-G;ee<K;ee+=G)for(let te=-G;te<K;te+=G){let ue=te<0||te>q||ee<0||ee>q?24575:0,ce=t.at(Math.round(te),0,t.a3),he=t.at(Math.round(ee),0,t.a3);O.emplaceBack(ce+ue,he)}let J=(ee,te)=>{let ue=te*j+ee;B.emplaceBack(ue+1,ue,ue+j),B.emplaceBack(ue+j,ue+j+1,ue+1)};for(let ee=1;ee<129;ee++)for(let te=1;te<129;te++)J(te,ee);return[0,129].forEach(ee=>{for(let te=0;te<130;te++)J(te,ee),J(ee,te)}),[O,B,32768]}(),T=a.context;this.gridBuffer=T.createVertexBuffer(_,t.br.members),this.gridIndexBuffer=T.createIndexBuffer(x),this.gridSegments=t.b.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=t.b.simpleSegment(0,0,_.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ip(h.map),this.orthoMatrix=t.ad.create(),t.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,t.a3,0,t.a3,0,1);let E=T.gl;this._overlapStencilMode=new t.ag({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Bh(h.map),this._pendingGroundEffectLayers=[]}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),this._style=a,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,h,_){if(a&&a.terrain){this._style!==a&&(this.style=a,this._evaluationZoom=void 0);let x=a.terrain.properties,C=a.terrain.drapeRenderMode===0,T=a.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=t.e.now();let E=a.terrain&&a.terrain.scope,P=x.get("source"),O=C?this._mockSourceCache:a.getSourceCache(P,E);if(!O)return void t.w(`Couldn't find terrain source "${P}".`);if(this.sourceCache=O,this._exaggeration=T?this.calculateExaggeration(h):x.get("exaggeration"),!h.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;let B=()=>{this.sourceCache.used&&t.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let j=this.getScaledDemTileSize();this.sourceCache.update(h,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,B(),this._initializing=!0),B(),h.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(a){let h=this._previousCameraAltitude,_=a.getFreeCameraOptions().position.z/a.pixelsPerMeter*a.worldSize;this._previousCameraAltitude=_;let x=h!=null?_-h:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;let C=a.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(C);let E=C-this._previousZoom,P=this._previousUpdateTimestamp,O=C;this._evaluationZoom!=null&&(O=this._evaluationZoom,Math.abs(C-O)>.5&&(E=.5*(C-O+E)),E*x<0&&(O+=E)),this._evaluationZoom=O;let B=T.getExaggeration(O),j=B===T.getExaggeration(Math.max(0,O-.1));if(j&&Math.abs(B-this._exaggeration)<.01)return B;let G=Math.min(.1,.00375*(this._updateTimestamp-P));return(j||B<.1||Math.abs(E)<1e-4)&&(G=Math.min(.2,4*G)),t.a2(this._exaggeration,B,G)}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let a in this._style._mergedSourceCaches)this._style._mergedSourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(t.Y.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let x=this.proxyCoords=h.getIds().map(P=>{let O=h.getTileByID(P).tileID;return O.projMatrix=_.calculateProjMatrix(O.toUnwrapped()),O});(function(P,O){let B=O.transform.pointCoordinate(O.transform.getCameraPoint()),j=new t.P(B.x,B.y);P.sort((G,q)=>{if(q.overscaledZ-G.overscaledZ)return q.overscaledZ-G.overscaledZ;let K=new t.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),J=new t.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ee=j.mult(1<<G.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(K)-ee.distSqr(J)})})(x,this.painter);let C=this.proxyToSource||{};this.proxyToSource={},x.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};let T=this._style._mergedSourceCaches;for(let P in T){let O=T[P];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,a[P],C),O.usedForTerrain))continue;let B=a[P];O.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[h.id]=x.map(P=>new kf(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1;let E={};this._visibleDemTiles=[];for(let P of this.proxyCoords){let O=this.terrainTileForTile[P.key];if(!O)continue;let B=O.tileID.key;B in E||(this._visibleDemTiles.push(O),E[B]=B)}}_assignTerrainTiles(a){this._initializing||a.forEach(h=>{if(this.terrainTileForTile[h.key])return;let _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){let a=this.painter.context,h=a.gl;for(let _ in this.terrainTileForTile){let x=this.terrainTileForTile[_],C=x.dem;!C||x.demTexture&&!x.needsDEMTextureUpload||(a.activeTexture.set(h.TEXTURE1),wf(this.painter,x,C))}}_prepareDemTileUniforms(a,h,_,x){if(!h||h.demTexture==null)return!1;let C=a.tileID.canonical,T=Math.pow(2,h.tileID.canonical.z-C.z),E=x||"";return _[`u_dem_tl${E}`]=[C.x*T%1,C.y*T%1],_[`u_dem_scale${E}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let a=this.painter.context,h=a.gl;if(!this._emptyDepthBufferTexture){let _=new t.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.T(a,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let a=0,h=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;let C=x.dem.tree.minimums[0];return C>0&&a++,_+C},0);return a?h/a:0}_updateEmptyDEMTexture(){let a=this.painter.context,h=a.gl;a.activeTexture.set(h.TEXTURE2);let _=this._getLoadedAreaMinimum(),[x,C]=(()=>{let E=new t.bz({width:1,height:1},new Float32Array([_]));return[h.R32F,E]})();this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(C,{premultiply:!1}):T=this._emptyDEMTexture=new t.T(a,C,x,{premultiply:!1}),T}setupElevationDraw(a,h,_){let x=this.painter.context,C=x.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};T.u_exaggeration=this.exaggeration();let E=null,P=null,O=1;if(_&&_.morphing&&this._useVertexMorphing){let q=_.morphing.srcDemTile,K=_.morphing.dstDemTile;O=_.morphing.phase,q&&K&&(this._prepareDemTileUniforms(a,q,T,"_prev")&&(P=q),this._prepareDemTileUniforms(a,K,T)&&(E=K))}let B=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?C.LINEAR:C.NEAREST,j=null;var G;if(this.enabled?P&&E?(j=E.demTexture,x.activeTexture.set(C.TEXTURE4),P.demTexture.bind(B(P),C.CLAMP_TO_EDGE),T.u_dem_lerp=O):(E=this.terrainTileForTile[a.tileID.key],j=this._prepareDemTileUniforms(a,E,T)?E.demTexture:this.emptyDEMTexture):j=this.emptyDEMTexture,x.activeTexture.set(C.TEXTURE2),j&&(T.u_dem_size=(G=j).size[0]===1?1:G.size[0]-2,j.bind(B(E),C.CLAMP_TO_EDGE)),x.activeTexture.set(C.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&E){let q=(1<<E.tileID.canonical.z)*t.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=q}if(_&&_.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(x,T),this.painter.transform.projection.name==="globe"){let q=this.globeUniformValues(this.painter.transform,a.tileID.canonical,_&&_.useDenormalizedUpVectorScale);h.setGlobeUniformValues(x,q)}}globeUniformValues(a,h,_){let x=a.projection;return{u_tile_tl_up:x.upVector(h,0,0),u_tile_tr_up:x.upVector(h,t.a3,0),u_tile_br_up:x.upVector(h,t.a3,t.a3),u_tile_bl_up:x.upVector(h,0,t.a3),u_tile_up_scale:_?t.bs(1):x.upVectorScale(h,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){let h=this.painter,_=this.painter.context;a.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,C,T,E,P){if(x.transform.projection.name==="globe")(function(O,B,j,G,q){let K=O.context,J=K.gl,ee,te,ue=O.transform,ce=t.ba(O,K,ue),he=(He,qe)=>{if(te===qe)return;let ct=[il[qe],"PROJECTION_GLOBE_VIEW"];ce&&ct.push("CUSTOM_ANTIALIASING");let ut=O.isTileAffectedByFog(He);ee=O.getOrCreateProgram("globeRaster",{defines:ct,overrideFog:ut}),te=qe},Ce=O.colorModeForRenderPass(),we=new t.ae(J.LEQUAL,t.ae.ReadWrite,O.depthRangeFor3D);tl.update(q);let de=t.bb(ue),me=[t.aj(ue.center.lng),t.ak(ue.center.lat)],fe=O.globeSharedBuffers,Ee=[ue.width*t.e.devicePixelRatio,ue.height*t.e.devicePixelRatio],We=Float32Array.from(ue.globeMatrix),ye={useDenormalizedUpVectorScale:!0};{let He=O.transform,qe=Tf(He.zoom,B.exaggeration(),B.sourceCache._source.tileSize);te=-1;let ct=J.TRIANGLES;for(let ut of G){let lt=j.getTile(ut),Le=t.ag.disabled,Ze=B.prevTerrainTileForTile[ut.key],rt=B.terrainTileForTile[ut.key];Lh(Ze,rt)&&tl.newMorphing(ut.key,Ze,rt,q,250),K.activeTexture.set(J.TEXTURE0),lt.texture&&lt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let Ot=tl.getMorphValuesForProxy(ut.key),Rt=Ot?1:0;Ot&&t.o(ye,{morphing:{srcDemTile:Ot.from,dstDemTile:Ot.to,phase:t.b9(Ot.phase)}});let Wt=t.bc(ut.canonical),Ft=t.bd(Wt.getCenter().lat),pt=t.be(ut.canonical,Wt,Ft,He.worldSize/He._pixelsPerMercatorPixel),nt=t.bf(t.bg(ut.canonical)),$t=Mr(He.expandedFarZProjMatrix,We,de,nt,t.a1(He.zoom),me,He.frustumCorners.TL,He.frustumCorners.TR,He.frustumCorners.BR,He.frustumCorners.BL,He.globeCenterInViewSpace,He.globeRadius,Ee,qe,He._farZ,pt);if(he(ut,Rt),ee&&(B.setupElevationDraw(lt,ee,ye),O.uploadCommonUniforms(K,ee,ut.toUnwrapped()),fe)){let[Ii,bi,Fi]=fe.getGridBuffers(Ft,qe!==0);ee.draw(O,ct,we,Le,Ce,t.af.backCCW,$t,"globe_raster",Ii,bi,Fi)}}}if(fe&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){let He=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&He.push("CUSTOM_ANTIALIASING"),ee=O.getOrCreateProgram("globeRaster",{defines:He});for(let qe of G){let{x:ct,y:ut,z:lt}=qe.canonical,Le=ut===0,Ze=ut===(1<<lt)-1,[rt,Ot,Rt,Wt]=fe.getPoleBuffers(lt,!1);if(Wt&&(Le||Ze)){let Ft=j.getTile(qe);K.activeTexture.set(J.TEXTURE0),Ft.texture&&Ft.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let pt=t.bh(lt,ct,ue),nt=t.bf(t.bg(qe.canonical)),$t=(Ii,bi)=>Ii.draw(O,J.TRIANGLES,we,t.ag.disabled,Ce,t.af.disabled,Mr(ue.expandedFarZProjMatrix,pt,pt,nt,0,me,ue.frustumCorners.TL,ue.frustumCorners.TR,ue.frustumCorners.BR,ue.frustumCorners.BL,ue.globeCenterInViewSpace,ue.globeRadius,Ee,0,ue._farZ),"globe_pole_raster",bi,Rt,Wt);B.setupElevationDraw(Ft,ee,ye),O.uploadCommonUniforms(K,ee,qe.toUnwrapped()),Le&&O.renderDefaultNorthPole&&$t(ee,rt),Ze&&O.renderDefaultSouthPole&&(pt=t.ad.scale(t.ad.create(),pt,[1,-1,1]),$t(ee,Ot))}}}})(x,C,T,E,P);else{let O=x.context,B=O.gl,j,G,q=x.shadowRenderer,K=Rs(x,x.longestCutoffRange),J=Ce=>{if(G===Ce)return;let we=[];we.push(il[Ce]),K.shouldRenderCutoff&&we.push("RENDER_CUTOFF"),j=x.getOrCreateProgram("terrainRaster",{defines:we}),G=Ce},ee=x.colorModeForRenderPass(),te=new t.ae(B.LEQUAL,t.ae.ReadWrite,x.depthRangeFor3D);tl.update(P);let ue=x.transform,ce=Tf(ue.zoom,C.exaggeration(),C.sourceCache._source.tileSize),he=[0,0,0];if(q){let Ce=x.style.directionalLight,we=x.style.ambientLight;Ce&&we&&(he=zl(x.style,Ce,we))}{G=-1;let Ce=B.TRIANGLES,[we,de]=[C.gridIndexBuffer,C.gridSegments];for(let me of E){let fe=T.getTile(me),Ee=t.ag.disabled,We=C.prevTerrainTileForTile[me.key],ye=C.terrainTileForTile[me.key];Lh(We,ye)&&tl.newMorphing(me.key,We,ye,P,250),O.activeTexture.set(B.TEXTURE0),fe.texture&&fe.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE);let He=tl.getMorphValuesForProxy(me.key),qe=He?1:0,ct;He&&(ct={morphing:{srcDemTile:He.from,dstDemTile:He.to,phase:t.b9(He.phase)}});let ut=gt(me.projMatrix,Mf(me.canonical,ue.renderWorldCopies)?ce/10:ce,he);if(J(qe),!j)continue;C.setupElevationDraw(fe,j,ct);let lt=me.toUnwrapped();q&&q.setupShadows(lt,j),x.uploadCommonUniforms(O,j,lt,null,K),j.draw(x,Ce,te,Ee,ee,t.af.backCCW,ut,"terrain_raster",C.gridBuffer,we,de)}}}}(h,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;let h=this.painter,_=this.painter.context,x=this.proxySourceCache,C=this.proxiedCoords[x.id],T=this._drapedRenderBatches.shift(),E=h.style.order,P=[],O=0;for(let B of C){let j=x.getTileByID(B.proxyTileKey),G=x.proxyCachedFBO[B.key]?x.proxyCachedFBO[B.key][a]:void 0,q=G!==void 0?x.renderCache[G]:this.pool[O++],K=G!==void 0;if(j.texture=q.tex,K&&!q.dirty){P.push(j.tileID);continue}let J;_.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(_.clear({color:t.C.transparent,stencil:0}),q.dirty=!1);for(let ee=T.start;ee<=T.end;++ee){let te=h.style._mergedLayers[E[ee]];if(te.isHidden(h.transform.zoom))continue;let ue=h.style.getLayerSourceCache(te),ce=ue?this.proxyToSource[B.key][ue.id]:[B];if(!ce)continue;let he=ce;_.viewport.set([0,0,q.fb.width,q.fb.height]),J!==(ue?ue.id:null)&&(this._setupStencil(q,ce,te,ue),J=ue?ue.id:null),h.renderLayer(h,ue,te,he)}if(this._drapedRenderBatches.length===0)for(let ee of this._pendingGroundEffectLayers){let te=h.style._mergedLayers[E[ee]];if(te.isHidden(h.transform.zoom))continue;let ue=h.style.getLayerSourceCache(te),ce=ue?this.proxyToSource[B.key][ue.id]:[B];if(!ce)continue;let he=ce;_.viewport.set([0,0,q.fb.width,q.fb.height]),J!==(ue?ue.id:null)&&(this._setupStencil(q,ce,te,ue),J=ue?ue.id:null),h.renderLayer(h,ue,te,he)}this.renderedToTile?(q.dirty=!0,P.push(j.tileID)):K||--O,O===5&&(O=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),T.end+1}postRender(){}isLayerOrderingCorrect(a){let h=a.order.length,_=-1,x=h;for(let C=0;C<h;++C)this._style.isLayerDraped(a._mergedLayers[a.order[C]])?_=Math.max(_,C):x=Math.min(x,C);return x>_}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{a=Math.min(a,h.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,h,_){if(!this._visibleDemTiles)return null;let x=this._visibleDemTiles.filter(C=>C.dem).map(C=>{let T=C.tileID,E=1<<T.overscaledZ,{x:P,y:O}=T.canonical,B=P/E,j=(P+1)/E,G=O/E,q=(O+1)/E;return{minx:B,miny:G,maxx:j,maxy:q,t:C.dem.tree.raycastRoot(B,G,j,q,a,h,_),tile:C}});x.sort((C,T)=>(C.t!==null?C.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(let C of x){if(C.t==null)return null;let T=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,a,h,_);if(T!=null)return T}return null}_createFBO(){let a=this.painter.context,h=a.gl,_=this.drapeBufferSize;a.activeTexture.set(h.TEXTURE0);let x=new t.T(a,{width:_[0],height:_[1],data:null},h.RGBA);x.bind(h.LINEAR,h.CLAMP_TO_EDGE);let C=a.createFramebuffer(_[0],_[1],!0,null);return C.colorAttachment.set(x.texture),C.depthAttachment=new us(a,C.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:C,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let a in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{let h=this._style._mergedLayers[a],_=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!_&&h.shouldRedrape():!_&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(let _ of this._style.getSources())if(_ instanceof Qm){a=!0;break}if(!a)return;let h={};for(let _=0;_<this._style.order.length;++_){let x=this._style._mergedLayers[this._style.order[_]],C=this._style.getLayerSourceCache(x);if(C&&!h[C.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof t.Z){h[C.id]=!0;for(let T of this.proxyCoords){let E=this.proxyToSource[T.key][C.id];if(E)for(let P of E)this._clearRenderCacheForTile(C.id,P)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(let _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof Mh){a=!0;break}if(!a)return;let h={};for(let _=0;_<this._style.order.length;++_){let x=this._style._mergedLayers[this._style.order[_]],C=this._style.getLayerSourceCache(x);if(!C||h[C.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;let T=x.paint.get("raster-fade-duration");for(let E of this.proxyCoords){let P=this.proxyToSource[E.key][C.id];if(P)for(let O of P){let B=uu(C.getTile(O),C.findLoadedParent(O,0),C,this.painter.transform,T);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(C.id,O)}}}}_setupDrapedRenderBatches(){let a=this._style.order,h=a.length;if(h===0)return;let _=[];this._pendingGroundEffectLayers=[];let x,C=0,T=this._style._mergedLayers[a[C]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++C<h;)T=this._style._mergedLayers[a[C]];for(;C<h;++C){let E=this._style._mergedLayers[a[C]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?x===void 0&&(x=C):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(C),x!==void 0&&(_.push({start:x,end:C-1}),x=void 0)))}if(x!==void 0&&_.push({start:x,end:C-1}),_.length!==0){let E=_[_.length-1];this._pendingGroundEffectLayers.every(P=>P>E.end)||t.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(a){let h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){let T=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let E=0;E<T.length;++E){let P=Object.values(T[E]);h.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();let _=this.proxyCoords,x=this._tilesDirty;for(let T=_.length-1;T>=0;T--){let E=_[T];if(h.getTileByID(E.key),h.proxyCachedFBO[E.key]!==void 0){let P=a[E.key],O=this.proxyToSource[E.key],B=0;for(let j in O){let G=O[j],q=P[j];if(!q||q.length!==G.length||G.some((K,J)=>K!==q[J]||x[j]&&x[j].hasOwnProperty(K.key))){B=-1;break}++B}for(let j in h.proxyCachedFBO[E.key])h.renderCache[h.proxyCachedFBO[E.key][j]].dirty=B<0||B!==Object.values(P).length}}let C=[...this._drapedRenderBatches];C.sort((T,E)=>E.end-E.start-(T.end-T.start));for(let T of C)for(let E of _){if(h.proxyCachedFBO[E.key])continue;let P=h.renderCachePool.pop();P===void 0&&h.renderCache.length<50&&(P=h.renderCache.length,h.renderCache.push(this._createFBO())),P!==void 0&&(h.proxyCachedFBO[E.key]={},h.proxyCachedFBO[E.key][T.start]=P,h.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(a,h,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let C=this.painter.context,T=C.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let E;if(_.isTileClipped())E=h.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):t.ag.disabled}_renderTileClippingMasks(a,h){let _=this.painter,x=this.painter.context,C=x.gl;_._tileClippingMaskIDs={},x.setColorMode(t.a.disabled),x.setDepthMode(t.ae.disabled);let T=_.getOrCreateProgram("clippingMask");for(let E of a){let P=_._tileClippingMaskIDs[E.key]=--h;T.draw(_,C.TRIANGLES,t.ae.disabled,new t.ag({func:C.ALWAYS,mask:0},P,255,C.KEEP,C.KEEP,C.REPLACE),t.a.disabled,t.af.disabled,zh(E.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(a){let h=this.painter.transform;if(a.x<0||a.x>h.width||a.y<0||a.y>h.height)return null;let _=[a.x,a.y,1,1];t.aA.transformMat4(_,_,h.pixelMatrixInverse),t.aA.scale(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;let x=h._camera.position,C=t.ax(1,h.center.lat),T=[x[0],x[1],x[2]/C,0],E=t._.subtract([],_.slice(0,3),T);t._.normalize(E,E);let P=this.raycast(T,E,this._exaggeration);return P!==null&&P?(t._.scaleAndAdd(T,T,E,P),T[3]=T[2],T[2]*=C,T):null}drawDepth(){let a=this.painter,h=a.context,_=this.proxySourceCache,x=Math.ceil(a.width),C=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===C||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let T=h.gl,E=h.createFramebuffer(x,C,!0,"renderbuffer");h.activeTexture.set(T.TEXTURE0);let P=new t.T(h,{width:x,height:C,data:null},T.RGBA);P.bind(T.NEAREST,T.CLAMP_TO_EDGE),E.colorAttachment.set(P.texture);let O=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,x,C);E.depthAttachment.set(O),this._depthFBO=E,this._depthTexture=P}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,x,C]),function(T,E,P,O){if(T.transform.projection.name==="globe")return;let B=T.context,j=B.gl;B.clear({depth:1});let G=T.getOrCreateProgram("terrainDepth"),q=new t.ae(j.LESS,t.ae.ReadWrite,T.depthRangeFor3D);for(let K of O){let J=P.getTile(K),ee=gt(K.projMatrix,0,[0,0,0]);E.setupElevationDraw(J,G),G.draw(T,j.TRIANGLES,q,t.ag.disabled,t.a.unblended,t.af.backCCW,ee,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(a,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,h,_){if(a.getSource()instanceof t.bm)return this._setupProxiedCoordsForImageSource(a,h,_);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};let x=this.proxiedCoords[a.id]=[],C=this.proxyCoords;for(let P=0;P<C.length;P++){let O=C[P],B=this._findTileCoveringTileID(O,a);if(B){let j=this._createProxiedId(O,B,_[O.key]&&_[O.key][a.id]);x.push(j),this.proxyToSource[O.key][a.id]=[j]}}let T=!1,E=new Set;for(let P=0;P<h.length;P++){let O=a.getTile(h[P]);if(!O||!O.hasData())continue;let B=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==O.tileID.canonical.z){let j=this.proxyToSource[B.tileID.key][a.id],G=this._createProxiedId(B.tileID,O,_[B.tileID.key]&&_[B.tileID.key][a.id]);j?j.splice(j.length-1,0,G):this.proxyToSource[B.tileID.key][a.id]=[G];let q=this.proxyToSource[B.tileID.key][a.id];E.has(q)||E.add(q),x.push(G),T=!0}}if(this._sourceTilesOverlap[a.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(let P of E)P.sort((O,B)=>B.overscaledZ-O.overscaledZ)}_setupProxiedCoordsForImageSource(a,h,_){if(!a.getSource().loaded())return;let x=this.proxiedCoords[a.id]=[],C=this.proxyCoords,T=a.getSource(),E=T.tileID;if(!E)return;let P=new t.P(E.x,E.y)._div(1<<E.z),O=T.coordinates.map(t.Y.fromLngLat).reduce((j,G)=>(j.min.x=Math.min(j.min.x,G.x-P.x),j.min.y=Math.min(j.min.y,G.y-P.y),j.max.x=Math.max(j.max.x,G.x-P.x),j.max.y=Math.max(j.max.y,G.y-P.y),j),{min:new t.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(j,G)=>{let q=j.wrap+j.canonical.x/(1<<j.canonical.z),K=j.canonical.y/(1<<j.canonical.z),J=t.a3/(1<<j.canonical.z),ee=G.wrap+G.canonical.x/(1<<G.canonical.z),te=G.canonical.y/(1<<G.canonical.z);return q+J<ee+O.min.x||q>ee+O.max.x||K+J<te+O.min.y||K>te+O.max.y};for(let j=0;j<C.length;j++){let G=C[j];for(let q=0;q<h.length;q++){let K=a.getTile(h[q]);if(!K||!K.hasData()||B(G,K.tileID))continue;let J=this._createProxiedId(G,K,_[G.key]&&_[G.key][a.id]),ee=this.proxyToSource[G.key][a.id];ee?ee.push(J):this.proxyToSource[G.key][a.id]=[J],x.push(J)}}}_createProxiedId(a,h,_){let x=this.orthoMatrix;if(_){let C=_.find(T=>T.key===h.tileID.key);if(C)return C}if(h.tileID.key!==a.key){let C=a.canonical.z-h.tileID.canonical.z,T,E,P;x=t.ad.create();let O=h.tileID.wrap-a.wrap<<a.overscaledZ;C>0?(T=t.a3>>C,E=T*((h.tileID.canonical.x<<C)-a.canonical.x+O),P=T*((h.tileID.canonical.y<<C)-a.canonical.y)):(T=t.a3<<-C,E=t.a3*(h.tileID.canonical.x-(a.canonical.x+O<<-C)),P=t.a3*(h.tileID.canonical.y-(a.canonical.y<<-C))),t.ad.ortho(x,0,T,0,T,0,1),t.ad.translate(x,x,[E,P,0])}return new kf(h.tileID,a.key,x)}_findTileCoveringTileID(a,h){let _=h.getTile(a);if(_&&_.hasData())return _;let x=this._findCoveringTileCache[h.id],C=x[a.key];if(_=C?h.getTileByID(C):null,_&&_.hasData()||C===null)return _;let T=_?_.tileID:a,E=T.overscaledZ,P=h.getSource().minzoom,O=[];if(!C){let j=h.getSource().maxzoom;if(a.canonical.z>=j){let G=a.canonical.z-j;h.getSource().reparseOverscaled?(E=Math.max(a.canonical.z+2,h.transform.tileZoom),T=new t.aL(E,a.wrap,j,a.canonical.x>>G,a.canonical.y>>G)):G!==0&&(E=j,T=new t.aL(E,a.wrap,j,a.canonical.x>>G,a.canonical.y>>G))}T.key!==a.key&&(O.push(T.key),_=h.getTile(T))}let B=j=>{O.forEach(G=>{x[G]=j}),O.length=0};for(E-=1;E>=P&&(!_||!_.hasData());E--){_&&B(_.tileID.key);let j=T.calculateScaledKey(E);if(_=h.getTileByID(j),_&&_.hasData())break;let G=x[j];if(G===null)break;G===void 0?O.push(j):_=h.getTileByID(G)}return B(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,h){let _=this._tilesDirty[a];_||(_=this._tilesDirty[a]={}),_[h.key]=!0}}function fo(f,a,h){let _=function(E,P,O){let B=t._.dot(P,E),j=t._.dot(O,[.2126,.7152,.0722]),G=(K,J,ee)=>(1-ee)*K+ee*J,q=G(1-.3*Math.min(j,1),1,Math.min(B+1,1));return G(.92,1,Math.asin(t.at(P[2],-1,1))/Math.PI+.5)*q}(f,[0,0,1],a),x=[0,0,0];t._.scale(x,h.slice(0,3),_);let C=[0,0,0];t._.scale(C,a.slice(0,3),f[2]);let T=[0,0,0];return t._.add(T,x,C),t.b8(T)}let hu=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],mu=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class pu{static cacheKey(a,h,_,x){let C=`${h}${x?x.cacheKey:""}`;for(let T of _)a.usedDefines.includes(T)&&(C+=`/${T}`);return C}constructor(a,h,_,x,C,T){let E=a.gl;this.program=E.createProgram(),this.configuration=x,this.name=h,this.fixedDefines=[...T];let P=x?x.getBinderAttributes():[],O=(_.staticAttributes||[]).concat(P),B=x?x.defines():[];B=B.concat(T.map(ee=>`#define ${ee}`));let j=`#version 300 es
`,G=j+B.concat("precision mediump float;",Xg,xf.fragmentSource).join(`
`);for(let ee of _.fragmentIncludes)G+=`
${Sh[ee]}`;G+=`
${_.fragmentSource}`;let q=j+B.concat("precision highp float;",Xg,xf.vertexSource).join(`
`);for(let ee of _.vertexIncludes)q+=`
${Sh[ee]}`;q+=`
${_.vertexSource}`;let K=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(K,G),E.compileShader(K),E.attachShader(this.program,K);let J=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(J,q),E.compileShader(J),E.attachShader(this.program,J),this.attributes={},this.numAttributes=O.length;for(let ee=0;ee<this.numAttributes;ee++)if(O[ee]){let te=O[ee].startsWith("a_")?O[ee]:`a_${O[ee]}`;E.bindAttribLocation(this.program,ee,te),this.attributes[te]=ee}E.linkProgram(this.program),E.deleteShader(J),E.deleteShader(K),this.fixedUniforms=C(a),this.binderUniforms=x?x.getUniforms(a):[],T.includes("TERRAIN")&&(this.terrainUniforms=(ee=>({u_dem:new t.a7(ee),u_dem_prev:new t.a7(ee),u_dem_tl:new t.a8(ee),u_dem_scale:new t.aa(ee),u_dem_tl_prev:new t.a8(ee),u_dem_scale_prev:new t.aa(ee),u_dem_size:new t.aa(ee),u_dem_lerp:new t.aa(ee),u_exaggeration:new t.aa(ee),u_depth:new t.a7(ee),u_depth_size_inv:new t.a8(ee),u_meter_to_dem:new t.aa(ee),u_label_plane_matrix_inv:new t.a6(ee)}))(a)),T.includes("GLOBE")&&(this.globeUniforms=(ee=>({u_tile_tl_up:new t.aq(ee),u_tile_tr_up:new t.aq(ee),u_tile_br_up:new t.aq(ee),u_tile_bl_up:new t.aq(ee),u_tile_up_scale:new t.aa(ee)}))(a)),T.includes("FOG")&&(this.fogUniforms=(ee=>({u_fog_matrix:new t.a6(ee),u_fog_range:new t.a8(ee),u_fog_color:new t.as(ee),u_fog_horizon_blend:new t.aa(ee),u_fog_vertical_limit:new t.a8(ee),u_fog_temporal_offset:new t.aa(ee),u_frustum_tl:new t.aq(ee),u_frustum_tr:new t.aq(ee),u_frustum_br:new t.aq(ee),u_frustum_bl:new t.aq(ee),u_globe_pos:new t.aq(ee),u_globe_radius:new t.aa(ee),u_globe_transition:new t.aa(ee),u_is_globe:new t.a7(ee),u_viewport:new t.a8(ee)}))(a)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ee=>({u_cutoff_params:new t.as(ee)}))(a)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ee=>({u_lighting_ambient_color:new t.aq(ee),u_lighting_directional_dir:new t.aq(ee),u_lighting_directional_color:new t.aq(ee),u_ground_radiance:new t.aq(ee)}))(a)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ee=>({u_light_matrix_0:new t.a6(ee),u_light_matrix_1:new t.a6(ee),u_fade_range:new t.a8(ee),u_shadow_normal_offset:new t.aq(ee),u_shadow_intensity:new t.aa(ee),u_shadow_texel_size:new t.aa(ee),u_shadow_map_resolution:new t.aa(ee),u_shadow_direction:new t.aq(ee),u_shadow_bias:new t.aq(ee),u_shadowmap_0:new t.a7(ee),u_shadowmap_1:new t.a7(ee)}))(a))}}setTerrainUniformValues(a,h){if(!this.terrainUniforms)return;let _=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let x in h)_[x]&&_[x].set(this.program,x,h[x])}}setGlobeUniformValues(a,h){if(!this.globeUniforms)return;let _=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let x in h)_[x]&&_[x].set(this.program,x,h[x])}}setFogUniformValues(a,h){if(!this.fogUniforms)return;let _=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let x in h)_[x].set(this.program,x,h[x])}}setCutoffUniformValues(a,h){if(!this.cutoffUniforms)return;let _=this.cutoffUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let x in h)_[x].set(this.program,x,h[x])}}setLightsUniformValues(a,h){if(!this.lightsUniforms)return;let _=this.lightsUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let x in h)_[x].set(this.program,x,h[x])}}setShadowUniformValues(a,h){if(this.failedToCreate||!this.shadowUniforms)return;let _=this.shadowUniforms;a.program.set(this.program);for(let x in h)_[x].set(this.program,x,h[x])}_drawDebugWireframe(a,h,_,x,C,T,E,P,O,B){let j=a.options.wireframe;if(j.terrain===!1&&j.layers2D===!1&&j.layers3D===!1)return;let G=a.context;if(!(!(!j.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!j.layers2D||a._terrain&&a._terrain.renderingToTexture||!hu.includes(this.name))||!(!j.layers3D||!mu.includes(this.name))))return;let q=G.gl,K=a.wireframeDebugCache.getLinesFromTrianglesBuffer(a.frameCounter,C,G);if(!K)return;let J=[...this.fixedDefines];J.push("DEBUG_WIREFRAME");let ee=a.getOrCreateProgram(this.name,{config:this.configuration,defines:J});G.program.set(ee.program);let te=(he,Ce,we)=>{if(Ce[he]&&we[he])for(let de in Ce[he])we[he][de]&&we[he][de].set(we.program,de,Ce[he][de].current)};O&&O.setUniforms(ee.program,G,ee.binderUniforms,E,{zoom:P}),te("fixedUniforms",this,ee),te("terrainUniforms",this,ee),te("globeUniforms",this,ee),te("fogUniforms",this,ee),te("lightsUniforms",this,ee),te("shadowUniforms",this,ee),K.bind(),G.setColorMode(new t.a([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],t.C.transparent,[!0,!0,!0,!1])),G.setDepthMode(new t.ae(h.func===q.LESS?q.LEQUAL:h.func,t.ae.ReadOnly,h.range)),G.setStencilMode(t.ag.disabled);let ue=3*T.primitiveLength*2,ce=3*T.primitiveOffset*2*2;B&&B>1?q.drawElementsInstanced(q.LINES,ue,q.UNSIGNED_SHORT,ce,B):q.drawElements(q.LINES,ue,q.UNSIGNED_SHORT,ce),C.bind(),G.program.set(this.program),G.setDepthMode(h),G.setStencilMode(_),G.setColorMode(x)}draw(a,h,_,x,C,T,E,P,O,B,j,G,q,K,J,ee){let te=a.context,ue=te.gl;if(this.failedToCreate)return;te.program.set(this.program),te.setDepthMode(_),te.setStencilMode(x),te.setColorMode(C),te.setCullFace(T);for(let Ce of Object.keys(this.fixedUniforms))this.fixedUniforms[Ce].set(this.program,Ce,E[Ce]);K&&K.setUniforms(this.program,te,this.binderUniforms,G,{zoom:q});let ce={[ue.POINTS]:1,[ue.LINES]:2,[ue.TRIANGLES]:3,[ue.LINE_STRIP]:1}[h],he=ee&&ee>0?1:void 0;for(let Ce of j.get()){let we=Ce.vaos||(Ce.vaos={});(we[P]||(we[P]=new rb)).bind(te,this,O,K?K.getPaintVertexBuffers():[],B,Ce.vertexOffset,J||[],he),ee&&ee>1?ue.drawElementsInstanced(h,Ce.primitiveLength*ce,ue.UNSIGNED_SHORT,Ce.primitiveOffset*ce*2,ee):B?ue.drawElements(h,Ce.primitiveLength*ce,ue.UNSIGNED_SHORT,Ce.primitiveOffset*ce*2):ue.drawArrays(h,Ce.vertexOffset,Ce.vertexLength),h===ue.TRIANGLES&&B&&this._drawDebugWireframe(a,_,x,C,B,Ce,G,q,K,ee)}}}function Nh(f,a){let h=Math.pow(2,a.tileID.overscaledZ),_=a.tileSize*Math.pow(2,f.transform.tileZoom)/h,x=_*(a.tileID.canonical.x+a.tileID.wrap*h),C=_*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/t.bB(a,1,f.transform.tileZoom),u_pixel_coord_upper:[x>>16,C>>16],u_pixel_coord_lower:[65535&x,65535&C]}}let rp=t.ad.create(),fu=(f,a,h,_,x,C,T,E,P,O,B,j,G,q,K,J)=>{let ee=a.style.light,te=ee.properties.get("position"),ue=[te.x,te.y,te.z],ce=t.bC.create();ee.properties.get("anchor")==="viewport"&&(t.bC.fromRotation(ce,-a.transform.angle),t._.transformMat3(ue,ue,ce));let he=ee.properties.get("color"),Ce=a.transform,we={u_matrix:f,u_lightpos:ue,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[he.r,he.g,he.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:rp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:C,u_flood_light_color:j,u_vertical_scale:G,u_flood_light_intensity:q,u_ground_shadow_factor:K,u_emissive_strength:J};return Ce.projection.name==="globe"&&(we.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],we.u_zoom_transition=P,we.u_inv_rot_matrix=B,we.u_merc_center=O,we.u_up_dir=Ce.projection.upVector(new t.aO(0,0,0),O[0]*t.a3,O[1]*t.a3),we.u_height_lift=E),we},gu=(f,a,h)=>({u_matrix:f,u_edge_radius:a,u_vertical_scale:h}),Ef=(f,a,h,_,x,C,T,E,P,O,B,j,G,q)=>{let K=fu(f,a,h,_,x,C,T,P,O,B,j,G,q,1,[0,0,0],0),J={u_height_factor:-Math.pow(2,T.overscaledZ)/E.tileSize/8};return t.W(K,Nh(a,E),J)},Df=(f,a)=>({u_matrix:f,u_emissive_strength:a}),_c=(f,a,h,_)=>t.W(Df(f,a),Nh(h,_)),Jg=(f,a,h)=>({u_matrix:f,u_world:h,u_emissive_strength:a}),op=(f,a,h,_,x)=>t.W(_c(f,a,h,_),{u_world:x}),Vh=(f,a,h,_)=>{let x=t.a3/h.tileSize;return{u_matrix:f,u_camera_to_center_distance:a.getCameraToCenterDistance(_),u_extrude_scale:[a.pixelsToGLUnits[0]/x,a.pixelsToGLUnits[1]/x]}},jh=(f,a,h=1)=>({u_matrix:f,u_color:a.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),gs=t.ad.create(),nl=(f,a,h,_,x,C,T)=>{let E=f.transform,P=E.projection.name==="globe",O=P?t.bD(E.zoom,a.canonical)*E._pixelsPerMercatorPixel:t.bB(h,1,C),B={u_matrix:a.projMatrix,u_extrude_scale:O,u_intensity:T,u_inv_rot_matrix:gs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){B.u_inv_rot_matrix=_,B.u_merc_center=x,B.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],B.u_zoom_transition=t.a1(E.zoom);let j=x[0]*t.a3,G=x[1]*t.a3;B.u_up_dir=E.projection.upVector(new t.aO(0,0,0),j,G)}return B};function e_(f,[a,h,_,x],[C,T]){if(C===T)return[0,0,0,0];let E=255*(f-1)/(f*(T-C));return[a*E,h*E,_*E,x*E]}function Af(f,a,[h,_]){return h===_?0:.5/f+(a-h)*(f-1)/(f*(_-h))}let Uh=(f,a,h,_,x,C,T,E,P,O,B,j,G,q,K,J,ee,te,ue,ce,he)=>({u_matrix:f,u_normalize_matrix:a,u_globe_matrix:h,u_merc_matrix:_,u_grid_matrix:x,u_tl_parent:C,u_scale_parent:O,u_fade_t:B.mix,u_opacity:B.opacity*j.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:j.paint.get("raster-brightness-min"),u_brightness_high:j.paint.get("raster-brightness-max"),u_saturation_factor:t.bE(j.paint.get("raster-saturation")),u_contrast_factor:t.bF(j.paint.get("raster-contrast")),u_spin_weights:rl(j.paint.get("raster-hue-rotate")),u_perspective_transform:G,u_raster_elevation:q,u_zoom_transition:T,u_merc_center:E,u_cutoff_params:P,u_colorization_mix:e_(t.bG,J,te),u_colorization_offset:Af(t.bG,ee,te),u_color_ramp:K,u_texture_offset:[ce/(ue+2*ce),ue/(ue+2*ce)],u_texture_res:[ue+2*ce,ue+2*ce],u_emissive_strength:he});function rl(f){f*=Math.PI/180;let a=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*a-h+1)/3,(Math.sqrt(3)*a-h+1)/3]}let Uo=.15,ap=(f,a,h,_,x,C,T,E,P,O,B,j)=>({u_matrix:f,u_normalize_matrix:a,u_globe_matrix:h,u_merc_matrix:_,u_grid_matrix:x,u_tl_parent:C,u_scale_parent:O,u_fade_t:B.mix,u_opacity:B.opacity,u_image0:0,u_image1:1,u_raster_elevation:j,u_zoom_transition:T,u_merc_center:E,u_cutoff_params:P}),Pf=(f,a,h,_,x,C,T,E,P,O)=>({u_particle_texture:f,u_particle_texture_side_len:a,u_tile_offset:h,u_velocity:_,u_color_ramp:C,u_velocity_res:x,u_max_speed:T,u_uv_offset:E,u_data_scale:P,u_data_offset:O,u_particle_pos_scale:1.3,u_particle_pos_offset:[Uo,Uo]}),sb=(f,a,h,_,x,C,T,E,P,O)=>({u_particle_texture:f,u_particle_texture_side_len:a,u_velocity:h,u_velocity_res:_,u_max_speed:x,u_speed_factor:C,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:P,u_data_offset:O,u_particle_pos_scale:1.3,u_particle_pos_offset:[Uo,Uo]}),Fs=t.ad.create(),_u=(f,a,h,_,x,C,T,E,P,O,B,j,G,q,K,J,ee,te)=>{let ue=x.transform,ce={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:ue.getCameraToCenterDistance(J),u_rotate_symbol:+h,u_aspect_ratio:ue.width/ue.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:T,u_coord_matrix:E,u_is_text:+P,u_pitch_with_map:+_,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Fs,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Fs,u_up_vector:[0,-1,0],u_color_adj_mat:ee,u_icon_transition:te||0};return J.name==="globe"&&(ce.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],ce.u_zoom_transition=j,ce.u_inv_rot_matrix=q,ce.u_merc_center=G,ce.u_camera_forward=ue._camera.forward(),ce.u_ecef_origin=t.bH(ue.globeMatrix,B.toUnwrapped()),ce.u_tile_matrix=Float32Array.from(ue.globeMatrix),ce.u_up_vector=K),ce},sp=(f,a,h,_,x,C,T,E,P,O,B,j,G,q,K,J,ee)=>t.W(_u(f,a,h,_,x,C,T,E,P,O,j,G,q,K,J,ee),{u_gamma_scale:_?x.transform.getCameraToCenterDistance(ee)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:t.e.devicePixelRatio,u_is_halo:+B,undefined:void 0}),Bl=(f,a,h,_,x,C,T,E,P,O,B,j,G,q,K,J)=>t.W(sp(f,a,h,_,x,C,T,E,!0,P,!0,B,j,G,q,K,J),{u_texsize_icon:O,u_texture_icon:1}),et=(f,a,h,_)=>({u_matrix:f,u_emissive_strength:a,u_opacity:h,u_color:_}),Pt=(f,a,h,_,x,C,T,E)=>t.W(function(P,O,B,j,G){let{width:q,height:K}=j.imageManager.getPixelSize(O),J=Math.pow(2,G.tileID.overscaledZ),ee=G.tileSize*Math.pow(2,j.transform.tileZoom)/J,te=ee*(G.tileID.canonical.x+G.tileID.wrap*J),ue=ee*G.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[q,K],u_pattern_size:B.displaySize,u_tile_units_to_pixels:1/t.bB(G,1,j.transform.tileZoom),u_pixel_coord_upper:[te>>16,ue>>16],u_pixel_coord_lower:[65535&te,65535&ue]}}(0,C,T,_,E),{u_matrix:f,u_emissive_strength:a,u_opacity:h}),bt=new Float32Array(t.ad.identity([])),hi=(f,a,h,_,x,C,T,E,P,O,B,j,G,q=[0,0,0],K)=>{let J=x.style.light,ee=J.properties.get("position"),te=[-ee.x,-ee.y,ee.z],ue=t.bC.create();J.properties.get("anchor")==="viewport"&&(t.bC.fromRotation(ue,-x.transform.angle),t._.transformMat3(te,te,ue));let ce=B.alphaMode==="MASK",he=J.properties.get("color").toRenderColor(null),Ce=G.paint.get("model-ambient-occlusion-intensity"),we=G.paint.get("model-color").constantOr(t.C.white).toRenderColor(null),de=G.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:a,u_normal_matrix:h,u_node_matrix:_||bt,u_lightpos:te,u_lightintensity:J.properties.get("intensity"),u_lightcolor:[he.r,he.g,he.b],u_camera_pos:q,u_opacity:C,u_baseTextureIsAlpha:0,u_alphaMask:+ce,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:[T.r,T.g,T.b,T.a],u_emissiveFactor:[E[0],E[1],E[2],1],u_metallicFactor:P,u_roughnessFactor:O,u_baseColorTexture:ko.BaseColor,u_metallicRoughnessTexture:ko.MetallicRoughness,u_normalTexture:ko.Normal,u_occlusionTexture:ko.Occlusion,u_emissionTexture:ko.Emission,u_lutTexture:ko.LUT,u_color_mix:[we.r,we.g,we.b,de],u_aoIntensity:Ce,u_emissive_strength:j,u_occlusionTextureTransform:K||[0,0,0,0]}},sn=(f,a=bt,h=bt)=>({u_matrix:f,u_instance:a,u_node_matrix:h}),er=(f,a,h,_,x)=>({u_matrix:Float32Array.from(f),u_anchorPos:a,u_screenSizePx:h,u_occluderSizePx:_,u_color:x}),Do={fillExtrusion:f=>({u_matrix:new t.a6(f),u_lightpos:new t.aq(f),u_lightintensity:new t.aa(f),u_lightcolor:new t.aq(f),u_vertical_gradient:new t.aa(f),u_opacity:new t.aa(f),u_edge_radius:new t.aa(f),u_ao:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_up_dir:new t.aq(f),u_height_lift:new t.aa(f),u_flood_light_color:new t.aq(f),u_vertical_scale:new t.aa(f),u_flood_light_intensity:new t.aa(f),u_ground_shadow_factor:new t.aq(f),u_emissive_strength:new t.aa(f)}),fillExtrusionDepth:f=>({u_matrix:new t.a6(f),u_edge_radius:new t.aa(f),u_vertical_scale:new t.aa(f)}),fillExtrusionPattern:f=>({u_matrix:new t.a6(f),u_lightpos:new t.aq(f),u_lightintensity:new t.aa(f),u_lightcolor:new t.aq(f),u_vertical_gradient:new t.aa(f),u_height_factor:new t.aa(f),u_edge_radius:new t.aa(f),u_ao:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_up_dir:new t.aq(f),u_height_lift:new t.aa(f),u_image:new t.a7(f),u_texsize:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f),u_opacity:new t.aa(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new t.a6(f),u_opacity:new t.aa(f),u_ao_pass:new t.aa(f),u_meter_to_tile:new t.aa(f),u_ao:new t.a8(f),u_flood_light_intensity:new t.aa(f),u_flood_light_color:new t.aq(f),u_attenuation:new t.aa(f),u_edge_radius:new t.aa(f),u_fb:new t.a7(f),u_fb_size:new t.aa(f)}),fill:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f)}),fillPattern:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_image:new t.a7(f),u_texsize:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f)}),fillOutline:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_world:new t.a8(f)}),fillOutlinePattern:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_world:new t.a8(f),u_image:new t.a7(f),u_texsize:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f)}),circle:t.bI,collisionBox:f=>({u_matrix:new t.a6(f),u_camera_to_center_distance:new t.aa(f),u_extrude_scale:new t.a8(f)}),collisionCircle:f=>({u_matrix:new t.a6(f),u_inv_matrix:new t.a6(f),u_camera_to_center_distance:new t.aa(f),u_viewport_size:new t.a8(f)}),debug:f=>({u_color:new t.a9(f),u_matrix:new t.a6(f),u_overlay:new t.a7(f),u_overlay_scale:new t.aa(f)}),clippingMask:f=>({u_matrix:new t.a6(f)}),heatmap:f=>({u_extrude_scale:new t.aa(f),u_intensity:new t.aa(f),u_matrix:new t.a6(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_up_dir:new t.aq(f)}),heatmapTexture:f=>({u_image:new t.a7(f),u_color_ramp:new t.a7(f),u_opacity:new t.aa(f)}),hillshade:f=>({u_matrix:new t.a6(f),u_image:new t.a7(f),u_latrange:new t.a8(f),u_light:new t.a8(f),u_shadow:new t.a9(f),u_highlight:new t.a9(f),u_emissive_strength:new t.aa(f),u_accent:new t.a9(f)}),hillshadePrepare:f=>({u_matrix:new t.a6(f),u_image:new t.a7(f),u_dimension:new t.a8(f),u_zoom:new t.aa(f)}),line:t.bJ,linePattern:t.bK,raster:f=>({u_matrix:new t.a6(f),u_normalize_matrix:new t.a6(f),u_globe_matrix:new t.a6(f),u_merc_matrix:new t.a6(f),u_grid_matrix:new t.ar(f),u_tl_parent:new t.a8(f),u_scale_parent:new t.aa(f),u_fade_t:new t.aa(f),u_opacity:new t.aa(f),u_image0:new t.a7(f),u_image1:new t.a7(f),u_brightness_low:new t.aa(f),u_brightness_high:new t.aa(f),u_saturation_factor:new t.aa(f),u_contrast_factor:new t.aa(f),u_spin_weights:new t.aq(f),u_perspective_transform:new t.a8(f),u_raster_elevation:new t.aa(f),u_zoom_transition:new t.aa(f),u_merc_center:new t.a8(f),u_cutoff_params:new t.as(f),u_colorization_mix:new t.as(f),u_colorization_offset:new t.aa(f),u_color_ramp:new t.a7(f),u_texture_offset:new t.a8(f),u_texture_res:new t.a8(f),u_emissive_strength:new t.aa(f)}),rasterParticle:f=>({u_matrix:new t.a6(f),u_normalize_matrix:new t.a6(f),u_globe_matrix:new t.a6(f),u_merc_matrix:new t.a6(f),u_grid_matrix:new t.ar(f),u_tl_parent:new t.a8(f),u_scale_parent:new t.aa(f),u_fade_t:new t.aa(f),u_opacity:new t.aa(f),u_image0:new t.a7(f),u_image1:new t.a7(f),u_raster_elevation:new t.aa(f),u_zoom_transition:new t.aa(f),u_merc_center:new t.a8(f),u_cutoff_params:new t.as(f)}),rasterParticleTexture:f=>({u_texture:new t.a7(f),u_opacity:new t.aa(f)}),rasterParticleDraw:f=>({u_particle_texture:new t.a7(f),u_particle_texture_side_len:new t.aa(f),u_tile_offset:new t.a8(f),u_velocity:new t.a7(f),u_color_ramp:new t.a7(f),u_velocity_res:new t.a8(f),u_max_speed:new t.aa(f),u_uv_offset:new t.a8(f),u_data_scale:new t.as(f),u_data_offset:new t.aa(f),u_particle_pos_scale:new t.aa(f),u_particle_pos_offset:new t.a8(f)}),rasterParticleUpdate:f=>({u_particle_texture:new t.a7(f),u_particle_texture_side_len:new t.aa(f),u_velocity:new t.a7(f),u_velocity_res:new t.a8(f),u_max_speed:new t.aa(f),u_speed_factor:new t.aa(f),u_reset_rate:new t.aa(f),u_rand_seed:new t.aa(f),u_uv_offset:new t.a8(f),u_data_scale:new t.as(f),u_data_offset:new t.aa(f),u_particle_pos_scale:new t.aa(f),u_particle_pos_offset:new t.a8(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new t.a7(f),u_is_size_feature_constant:new t.a7(f),u_size_t:new t.aa(f),u_size:new t.aa(f),u_camera_to_center_distance:new t.aa(f),u_rotate_symbol:new t.a7(f),u_aspect_ratio:new t.aa(f),u_fade_change:new t.aa(f),u_matrix:new t.a6(f),u_label_plane_matrix:new t.a6(f),u_coord_matrix:new t.a6(f),u_is_text:new t.a7(f),u_pitch_with_map:new t.a7(f),u_texsize:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_camera_forward:new t.aq(f),u_tile_matrix:new t.a6(f),u_up_vector:new t.aq(f),u_ecef_origin:new t.aq(f),u_texture:new t.a7(f),u_icon_transition:new t.aa(f),u_color_adj_mat:new t.a6(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new t.a7(f),u_is_size_feature_constant:new t.a7(f),u_size_t:new t.aa(f),u_size:new t.aa(f),u_camera_to_center_distance:new t.aa(f),u_rotate_symbol:new t.a7(f),u_aspect_ratio:new t.aa(f),u_fade_change:new t.aa(f),u_matrix:new t.a6(f),u_label_plane_matrix:new t.a6(f),u_coord_matrix:new t.a6(f),u_is_text:new t.a7(f),u_pitch_with_map:new t.a7(f),u_texsize:new t.a8(f),u_texture:new t.a7(f),u_gamma_scale:new t.aa(f),u_device_pixel_ratio:new t.aa(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_camera_forward:new t.aq(f),u_tile_matrix:new t.a6(f),u_up_vector:new t.aq(f),u_ecef_origin:new t.aq(f),u_is_halo:new t.a7(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new t.a7(f),u_is_size_feature_constant:new t.a7(f),u_size_t:new t.aa(f),u_size:new t.aa(f),u_camera_to_center_distance:new t.aa(f),u_rotate_symbol:new t.a7(f),u_aspect_ratio:new t.aa(f),u_fade_change:new t.aa(f),u_matrix:new t.a6(f),u_label_plane_matrix:new t.a6(f),u_coord_matrix:new t.a6(f),u_is_text:new t.a7(f),u_pitch_with_map:new t.a7(f),u_texsize:new t.a8(f),u_texsize_icon:new t.a8(f),u_texture:new t.a7(f),u_texture_icon:new t.a7(f),u_gamma_scale:new t.aa(f),u_device_pixel_ratio:new t.aa(f),u_is_halo:new t.a7(f)}),background:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_opacity:new t.aa(f),u_color:new t.a9(f)}),backgroundPattern:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_opacity:new t.aa(f),u_image:new t.a7(f),u_pattern_tl:new t.a8(f),u_pattern_br:new t.a8(f),u_texsize:new t.a8(f),u_pattern_size:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f)}),terrainRaster:ld,terrainDepth:ld,skybox:f=>({u_matrix:new t.a6(f),u_sun_direction:new t.aq(f),u_cubemap:new t.a7(f),u_opacity:new t.aa(f),u_temporal_offset:new t.aa(f)}),skyboxGradient:f=>({u_matrix:new t.a6(f),u_color_ramp:new t.a7(f),u_center_direction:new t.aq(f),u_radius:new t.aa(f),u_opacity:new t.aa(f),u_temporal_offset:new t.aa(f)}),skyboxCapture:f=>({u_matrix_3f:new t.ar(f),u_sun_direction:new t.aq(f),u_sun_intensity:new t.aa(f),u_color_tint_r:new t.as(f),u_color_tint_m:new t.as(f),u_luminance:new t.aa(f)}),globeRaster:f=>({u_proj_matrix:new t.a6(f),u_globe_matrix:new t.a6(f),u_normalize_matrix:new t.a6(f),u_merc_matrix:new t.a6(f),u_zoom_transition:new t.aa(f),u_merc_center:new t.a8(f),u_image0:new t.a7(f),u_grid_matrix:new t.ar(f),u_skirt_height:new t.aa(f),u_far_z_cutoff:new t.aa(f),u_frustum_tl:new t.aq(f),u_frustum_tr:new t.aq(f),u_frustum_br:new t.aq(f),u_frustum_bl:new t.aq(f),u_globe_pos:new t.aq(f),u_globe_radius:new t.aa(f),u_viewport:new t.a8(f)}),globeAtmosphere:f=>({u_frustum_tl:new t.aq(f),u_frustum_tr:new t.aq(f),u_frustum_br:new t.aq(f),u_frustum_bl:new t.aq(f),u_horizon:new t.aa(f),u_transition:new t.aa(f),u_fadeout_range:new t.aa(f),u_color:new t.as(f),u_high_color:new t.as(f),u_space_color:new t.as(f),u_temporal_offset:new t.aa(f),u_horizon_angle:new t.aa(f)}),model:f=>({u_matrix:new t.a6(f),u_lighting_matrix:new t.a6(f),u_normal_matrix:new t.a6(f),u_node_matrix:new t.a6(f),u_lightpos:new t.aq(f),u_lightintensity:new t.aa(f),u_lightcolor:new t.aq(f),u_camera_pos:new t.aq(f),u_opacity:new t.aa(f),u_baseColorFactor:new t.as(f),u_emissiveFactor:new t.as(f),u_metallicFactor:new t.aa(f),u_roughnessFactor:new t.aa(f),u_baseTextureIsAlpha:new t.a7(f),u_alphaMask:new t.a7(f),u_alphaCutoff:new t.aa(f),u_baseColorTexture:new t.a7(f),u_metallicRoughnessTexture:new t.a7(f),u_normalTexture:new t.a7(f),u_occlusionTexture:new t.a7(f),u_emissionTexture:new t.a7(f),u_lutTexture:new t.a7(f),u_color_mix:new t.as(f),u_aoIntensity:new t.aa(f),u_emissive_strength:new t.aa(f),u_occlusionTextureTransform:new t.as(f)}),modelDepth:f=>({u_matrix:new t.a6(f),u_instance:new t.a6(f),u_node_matrix:new t.a6(f)}),groundShadow:f=>({u_matrix:new t.a6(f),u_ground_shadow_factor:new t.aq(f)}),stars:f=>({u_matrix:new t.a6(f),u_up:new t.aq(f),u_right:new t.aq(f),u_intensity_multiplier:new t.aa(f)}),occlusion:f=>({u_matrix:new t.a6(f),u_anchorPos:new t.aq(f),u_screenSizePx:new t.a8(f),u_occluderSizePx:new t.a8(f),u_color:new t.as(f)})};function cr(f,a,h){let _=a.createTileMatrix(f,f.worldSize,h.toUnwrapped());return t.ad.multiply(new Float32Array(16),f.projMatrix,_)}function Of(f,a,h){if(a.projection.name===h.projection.name)return f.projMatrix;let _=h.clone();return _.setProjection(a.projection),cr(_,a.getProjection(),f)}function bu(f,a,h){return a.name===h.projection.name?f.projMatrix:cr(h,a,f)}let Ia;function bc(f,a,h,_,x,C,T){let E=f.context,P=E.gl,O=f.transform,B=f.getOrCreateProgram("collisionBox"),j=[],G=0,q=0;for(let he=0;he<_.length;he++){let Ce=_[he],we=a.getTile(Ce),de=we.getBucket(h);if(!de)continue;let me=Of(Ce,de,O),fe=me;x[0]===0&&x[1]===0||(fe=f.translatePosMatrix(me,we,x,C));let Ee=T?de.textCollisionBox:de.iconCollisionBox,We=de.collisionCircleArray;if(We.length>0){let ye=t.ad.create(),He=fe;t.ad.mul(ye,de.placementInvProjMatrix,O.glCoordMatrix),t.ad.mul(ye,ye,de.placementViewportMatrix),j.push({circleArray:We,circleOffset:q,transform:He,invTransform:ye,projection:de.getProjection()}),G+=We.length/4,q=G}Ee&&(f.terrain&&f.terrain.setupElevationDraw(we,B),B.draw(f,P.LINES,t.ae.disabled,t.ag.disabled,f.colorModeForRenderPass(),t.af.disabled,Vh(fe,O,we,de.getProjection()),h.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,O.zoom,null,[Ee.collisionVertexBuffer,Ee.collisionVertexBufferExt]))}if(!T||!j.length)return;let K=f.getOrCreateProgram("collisionCircle"),J=new t.bL;J.resize(4*G),J._trim();let ee=0;for(let he of j)for(let Ce=0;Ce<he.circleArray.length/4;Ce++){let we=4*Ce,de=he.circleArray[we+0],me=he.circleArray[we+1],fe=he.circleArray[we+2],Ee=he.circleArray[we+3];J.emplace(ee++,de,me,fe,Ee,0),J.emplace(ee++,de,me,fe,Ee,1),J.emplace(ee++,de,me,fe,Ee,2),J.emplace(ee++,de,me,fe,Ee,3)}(!Ia||Ia.length<2*G)&&(Ia=function(he){let Ce=2*he,we=new t.bu;we.resize(Ce),we._trim();for(let de=0;de<Ce;de++){let me=6*de;we.uint16[me+0]=4*de+0,we.uint16[me+1]=4*de+1,we.uint16[me+2]=4*de+2,we.uint16[me+3]=4*de+2,we.uint16[me+4]=4*de+3,we.uint16[me+5]=4*de+0}return we}(G));let te=E.createIndexBuffer(Ia,!0),ue=E.createVertexBuffer(J,t.bM.members,!0);for(let he of j){let Ce={u_matrix:he.transform,u_inv_matrix:he.invTransform,u_camera_to_center_distance:(ce=O).getCameraToCenterDistance(he.projection),u_viewport_size:[ce.width,ce.height]};K.draw(f,P.TRIANGLES,t.ae.disabled,t.ag.disabled,f.colorModeForRenderPass(),t.af.disabled,Ce,h.id,ue,te,t.b.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,O.zoom)}var ce;ue.destroy(),te.destroy()}let ud=t.ad.create();function hd(f){let a=f._camera.getWorldToCamera(f.worldSize,1),h=t.ad.multiply([],a,f.globeMatrix);t.ad.invert(h,h);let _=[0,0,0],x=[0,1,0,0];return t.aA.transformMat4(x,x,h),_[0]=x[0],_[1]=x[1],_[2]=x[2],t._.normalize(_,_),_}function lp({width:f,height:a,anchor:h,textOffset:_,textScale:x},C){let{horizontalAlign:T,verticalAlign:E}=t.bQ(h),P=-(T-.5)*f,O=-(E-.5)*a,B=t.bP(h,_);return new t.P((P/x+B[0])*C,(O/x+B[1])*C)}function Wh(f,a,h,_,x,C,T,E,P,O,B){let j=f.text.placedSymbolArray,G=f.text.dynamicLayoutVertexArray,q=f.icon.dynamicLayoutVertexArray,K={},J=f.getProjection(),ee=bu(E,J,C),te=C.elevation,ue=J.upVectorScale(E.canonical,C.center.lat,C.worldSize).metersToTile;G.clear();for(let ce=0;ce<j.length;ce++){let he=j.get(ce),{tileAnchorX:Ce,tileAnchorY:we,numGlyphs:de}=he,me=he.hidden||!he.crossTileID||f.allowVerticalPlacement&&!he.placedOrientation?null:_[he.crossTileID];if(me){let fe=0,Ee=0,We=0;if(te){let rt=te?te.getAtTileOffset(E,Ce,we):0,[Ot,Rt,Wt]=J.upVector(E.canonical,Ce,we);fe=rt*Ot*ue,Ee=rt*Rt*ue,We=rt*Wt*ue}let[ye,He,qe,ct]=Ya(he.projectedAnchorX+fe,he.projectedAnchorY+Ee,he.projectedAnchorZ+We,h?ee:T),ut=Mo(C.getCameraToCenterDistance(J),ct),lt=x.evaluateSizeForFeature(f.textSizeData,O,he)*ut/t.bN;h&&(lt*=f.tilePixelRatio/P);let Le=lp(me,lt);h?({x:ye,y:He,z:qe}=J.projectTilePoint(Ce+Le.x,we+Le.y,E.canonical),[ye,He,qe]=Ya(ye+fe,He+Ee,qe+We,T)):(a&&Le._rotate(-C.angle),ye+=Le.x,He+=Le.y,qe=0);let Ze=f.allowVerticalPlacement&&he.placedOrientation===t.aE.vertical?Math.PI/2:0;for(let rt=0;rt<de;rt++)t.aH(G,ye,He,qe,Ze);B&&he.associatedIconIndex>=0&&(K[he.associatedIconIndex]={x:ye,y:He,z:qe,angle:Ze})}else dd(de,G)}if(B){q.clear();let ce=f.icon.placedSymbolArray;for(let he=0;he<ce.length;he++){let Ce=ce.get(he),{numGlyphs:we}=Ce,de=K[he];if(Ce.hidden||!de)dd(we,q);else{let{x:me,y:fe,z:Ee,angle:We}=de;for(let ye=0;ye<we;ye++)t.aH(q,me,fe,Ee,We)}}f.icon.dynamicLayoutVertexBuffer.updateData(q)}f.text.dynamicLayoutVertexBuffer.updateData(G)}function rr(f,a,h,_,x,C,T={}){let E=h.paint.get("icon-translate"),P=h.paint.get("text-translate"),O=h.paint.get("icon-translate-anchor"),B=h.paint.get("text-translate-anchor"),j=h.layout.get("icon-rotation-alignment"),G=h.layout.get("text-rotation-alignment"),q=h.layout.get("icon-pitch-alignment"),K=h.layout.get("text-pitch-alignment"),J=h.layout.get("icon-keep-upright"),ee=h.layout.get("text-keep-upright"),te=h.paint.get("icon-color-saturation"),ue=h.paint.get("icon-color-contrast"),ce=h.paint.get("icon-color-brightness-min"),he=h.paint.get("icon-color-brightness-max"),Ce=h.paint.get("icon-occlusion-opacity").constantOr(0),we=h.paint.get("text-occlusion-opacity").constantOr(0),de=f.context,me=de.gl,fe=f.transform,Ee=j==="map",We=G==="map",ye=q==="map",He=K==="map",qe=Ce!==1,ct=we!==1,ut=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,lt=!1,Le=f.depthModeForSublayer(0,t.ae.ReadOnly),Ze=[t.aj(fe.center.lng),t.ak(fe.center.lat)],rt=h.layout.get("text-variable-anchor"),Ot=fe.projection.name==="globe",Rt=[],Wt=[0,-1,0];for(let Ft of _){let pt=a.getTile(Ft),nt=pt.getBucket(h);if(!nt||nt.projection.name==="mercator"&&Ot||nt.fullyClipped)continue;let $t=nt.projection.name==="globe",Ii=$t?t.a1(fe.zoom):0,bi=bu(Ft,nt.getProjection(),fe),Fi=fe.calculatePixelsToTileUnitsMatrix(pt),Gi=rt&&nt.hasTextData(),yn=nt.hasIconTextFit()&&Gi&&nt.hasIconData(),Vt=nt.getProjection().createInversionMatrix(fe,Ft.canonical),pn=()=>{let dt=Ee&&h.layout.get("symbol-placement")!=="point",Lt=[];h.hasInitialOcclusionOpacityProperties&&qe&&f.symbolParams.useOcclusionQueries&&!$t&&!Ot&&Lt.push("OCCLUSION_QUERIES"),h.hasInitialOcclusionOpacityProperties||Lt.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH");let Sr=dt||yn,vn=h.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&ye&&Lt.push("PITCH_WITH_MAP_TERRAIN"),$t&&(Lt.push("PROJECTION_GLOBE_VIEW"),Sr&&Lt.push("PROJECTED_POS_ON_VIEWPORT")),vn>0&&Lt.push("ICON_TRANSITION"),nt.icon.zOffsetVertexBuffer&&Lt.push("Z_OFFSET"),te===0&&ue===0&&ce===0&&he===1||Lt.push("COLOR_ADJUSTMENT");let Ue=nt.icon.programConfigurations.get(h.id),Ja=f.getOrCreateProgram(nt.sdfIcons?"symbolSDF":"symbolIcon",{config:Ue,defines:Lt}),qo,Zr=pt.imageAtlasTexture?pt.imageAtlasTexture.size:[0,0],Gn=nt.iconSizeData,sa=t.aD(Gn,fe.zoom),js=ye||fe.pitch!==0,Ea=$r(bi,pt.tileID.canonical,ye,Ee,fe,nt.getProjection(),Fi),Ec=ps(bi,pt.tileID.canonical,ye,Ee,fe,nt.getProjection(),Fi),Dc=f.translatePosMatrix(Ec,pt,E,O,!0),es=f.translatePosMatrix(bi,pt,E,O),Us=Sr?ud:Ea,cl=Ee&&!ye&&!dt,Bu=Wt;!Ot&&!fe.mercatorFromTransition||Ee||(Bu=hd(fe));let Nu=$t?Bu:Wt;if(nt.sdfIcons&&!nt.iconsInText)qo=sp(Gn.kind,sa,cl,ye,f,es,Us,Dc,!1,Zr,!0,Ft,Ii,Ze,Vt,Nu,nt.getProjection());else{let eo=h.getColorAdjustmentMatrix(te,ue,ce,he);qo=_u(Gn.kind,sa,cl,ye,f,es,Us,Dc,!1,Zr,Ft,Ii,Ze,Vt,Nu,nt.getProjection(),eo,vn)}let wd=pt.imageAtlasTexture?pt.imageAtlasTexture:null,Vu=h.layout.get("icon-size").constantOr(0)!==1||nt.iconsNeedLinear,fm=nt.sdfIcons||f.options.rotating||f.options.zooming||Vu||js?me.LINEAR:me.NEAREST,gm=nt.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,Jf=f.terrain&&ye&&dt?t.ad.invert(t.ad.create(),Ea):ud;if(dt&&nt.icon){let eo=fe.elevation,Mp=eo?eo.getAtTileOffsetFunc(Ft,fe.center.lat,fe.worldSize,nt.getProjection()):null,dl=Ll(bi,pt.tileID.canonical,ye,Ee,fe,nt.getProjection(),Fi);Dh(nt,bi,f,!1,dl,Ec,ye,J,Mp,Ft)}return{program:Ja,buffers:nt.icon,uniformValues:qo,atlasTexture:wd,atlasTextureIcon:null,atlasInterpolation:fm,atlasInterpolationIcon:null,isSDF:nt.sdfIcons,hasHalo:gm,tile:pt,labelPlaneMatrixInv:Jf}},Nn=()=>{let dt=We&&h.layout.get("symbol-placement")!=="point",Lt=[],Sr=dt||rt||yn;h.hasInitialOcclusionOpacityProperties&&ct&&f.symbolParams.useOcclusionQueries&&!$t&&!Ot&&Lt.push("OCCLUSION_QUERIES"),h.hasInitialOcclusionOpacityProperties||Lt.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH"),f.terrainRenderModeElevated()&&He&&Lt.push("PITCH_WITH_MAP_TERRAIN"),$t&&(Lt.push("PROJECTION_GLOBE_VIEW"),Sr&&Lt.push("PROJECTED_POS_ON_VIEWPORT")),nt.text.zOffsetVertexBuffer&&Lt.push("Z_OFFSET");let vn=nt.text.programConfigurations.get(h.id),Ue=f.getOrCreateProgram(nt.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:vn,defines:Lt}),Ja,qo=[0,0],Zr=null,Gn=nt.textSizeData;nt.iconsInText&&(qo=pt.imageAtlasTexture?pt.imageAtlasTexture.size:[0,0],Zr=pt.imageAtlasTexture?pt.imageAtlasTexture:null,Ja=He||fe.pitch!==0||f.options.rotating||f.options.zooming||Gn.kind==="composite"||Gn.kind==="camera"?me.LINEAR:me.NEAREST);let sa=pt.glyphAtlasTexture?pt.glyphAtlasTexture.size:[0,0],js=t.aD(Gn,fe.zoom),Ea=$r(bi,pt.tileID.canonical,He,We,fe,nt.getProjection(),Fi),Ec=ps(bi,pt.tileID.canonical,He,We,fe,nt.getProjection(),Fi),Dc=f.translatePosMatrix(Ec,pt,P,B,!0),es=f.translatePosMatrix(bi,pt,P,B),Us=Sr?ud:Ea,cl=We&&!He&&!dt,Bu=Wt;!Ot&&!fe.mercatorFromTransition||We||(Bu=hd(fe));let Nu=$t?Bu:Wt,wd;wd=nt.iconsInText?Bl(Gn.kind,js,cl,He,f,es,Us,Dc,sa,qo,Ft,Ii,Ze,Vt,Nu,nt.getProjection()):sp(Gn.kind,js,cl,He,f,es,Us,Dc,!0,sa,!0,Ft,Ii,Ze,Vt,Nu,nt.getProjection());let Vu=pt.glyphAtlasTexture?pt.glyphAtlasTexture:null,fm=me.LINEAR,gm=h.paint.get("text-halo-width").constantOr(1)!==0,Jf=f.terrain&&He&&dt?t.ad.invert(t.ad.create(),Ea):ud;if(dt&&nt.text){let eo=fe.elevation,Mp=eo?eo.getAtTileOffsetFunc(Ft,fe.center.lat,fe.worldSize,nt.getProjection()):null,dl=Ll(bi,pt.tileID.canonical,He,We,fe,nt.getProjection(),Fi);Dh(nt,bi,f,!0,dl,Ec,He,ee,Mp,Ft)}return{program:Ue,buffers:nt.text,uniformValues:wd,atlasTexture:Vu,atlasTextureIcon:Zr,atlasInterpolation:fm,atlasInterpolationIcon:Ja,isSDF:!0,hasHalo:gm,tile:pt,labelPlaneMatrixInv:Jf}},dn=nt.icon.segments.get().length,qi=nt.text.segments.get().length,xi=dn&&!T.onlyText?pn():null,Xn=qi&&!T.onlyIcons?Nn():null,on=h.paint.get("icon-opacity").constantOr(1),Fn=h.paint.get("text-opacity").constantOr(1);if(ut&&nt.canOverlap){lt=!0;let dt=on&&!T.onlyText?nt.icon.segments.get():[],Lt=Fn&&!T.onlyIcons?nt.text.segments.get():[];for(let Sr of dt)Rt.push({segments:new t.b([Sr]),sortKey:Sr.sortKey,state:xi});for(let Sr of Lt)Rt.push({segments:new t.b([Sr]),sortKey:Sr.sortKey,state:Xn})}else T.onlyText||Rt.push({segments:on?nt.icon.segments:new t.b([]),sortKey:0,state:xi}),T.onlyIcons||Rt.push({segments:Fn?nt.text.segments:new t.b([]),sortKey:0,state:Xn})}lt&&Rt.sort((Ft,pt)=>Ft.sortKey-pt.sortKey);for(let Ft of Rt){let pt=Ft.state;if(pt)if(f.terrain&&f.terrain.setupElevationDraw(pt.tile,pt.program,{useDepthForOcclusion:!h.hasInitialOcclusionOpacityProperties&&fe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:pt.labelPlaneMatrixInv}),de.activeTexture.set(me.TEXTURE0),pt.atlasTexture&&pt.atlasTexture.bind(pt.atlasInterpolation,me.CLAMP_TO_EDGE,!0),pt.atlasTextureIcon&&(de.activeTexture.set(me.TEXTURE1),pt.atlasTextureIcon&&pt.atlasTextureIcon.bind(pt.atlasInterpolationIcon,me.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,pt.program),pt.hasHalo){let nt=pt.uniformValues;nt.u_is_halo=1,yu(pt.buffers,Ft.segments,h,f,pt.program,Le,x,C,nt,2),nt.u_is_halo=0}else{if(pt.isSDF){let nt=pt.uniformValues;pt.hasHalo&&(nt.u_is_halo=1,yu(pt.buffers,Ft.segments,h,f,pt.program,Le,x,C,nt,1)),nt.u_is_halo=0}yu(pt.buffers,Ft.segments,h,f,pt.program,Le,x,C,pt.uniformValues,1)}}}function yu(f,a,h,_,x,C,T,E,P,O){let B=_.context.gl,j=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];f.occlusionQueryOpacityVertexBuffer.length>0&&j.push(f.occlusionQueryOpacityVertexBuffer),x.draw(_,B.TRIANGLES,C,T,E,t.af.disabled,P,h.id,f.layoutVertexBuffer,f.indexBuffer,a,h.paint,_.transform.zoom,f.programConfigurations.get(h.id),j,O)}function cp(f,a,h,_,x,C,T){let E=f.context.gl,P=h.paint.get("fill-pattern"),O=P&&P.constantOr(1),B,j,G,q,K;T?(j=O&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=E.LINES):(j=O?"fillPattern":"fill",B=E.TRIANGLES);for(let J of _){let ee=a.getTile(J);if(O&&!ee.patternsLoaded())continue;let te=ee.getBucket(h);if(!te)continue;f.prepareDrawTile();let ue=te.programConfigurations.get(h.id),ce=f.isTileAffectedByFog(J),he=f.getOrCreateProgram(j,{config:ue,overrideFog:ce});O&&(f.context.activeTexture.set(E.TEXTURE0),ee.imageAtlasTexture&&ee.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ue.updatePaintBuffers());let Ce=P.constantOr(null);if(Ce&&ee.imageAtlas){let me=ee.imageAtlas.patternPositions[Ce.toString()];me&&ue.setConstantPatternPositions(me)}let we=f.translatePosMatrix(J.projMatrix,ee,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),de=h.paint.get("fill-emissive-strength");if(T){q=te.indexBuffer2,K=te.segments2;let me=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];G=j==="fillOutlinePattern"&&O?op(we,de,f,ee,me):Jg(we,de,me)}else q=te.indexBuffer,K=te.segments,G=O?_c(we,de,f,ee):Df(we,de);f.uploadCommonUniforms(f.context,he,J.toUnwrapped()),he.draw(f,B,x,f.stencilModeForClipping(J),C,t.af.disabled,G,h.id,te.layoutVertexBuffer,q,K,h.paint,f.transform.zoom,ue,void 0)}}function Nl(f,a,h,_,x,C,T,E){h.resetLayerRenderingStats(f);let P=f.context,O=P.gl,B=f.transform,j=h.paint.get("fill-extrusion-pattern"),G=j.constantOr(1),q=h.paint.get("fill-extrusion-opacity"),K=f.style.enable3dLights(),J=h.paint.get(K&&!G?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),J],te=h.layout.get("fill-extrusion-edge-radius"),ue=te>0&&!h.paint.get("fill-extrusion-rounded-roof"),ce=ue?0:te,he=B.projection.name==="globe"?t.bY():0,Ce=B.projection.name==="globe",we=Ce?t.a1(B.zoom):0,de=[t.aj(B.center.lng),t.ak(B.center.lat)],me=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),fe=h.paint.get("fill-extrusion-flood-light-intensity"),Ee=h.paint.get("fill-extrusion-vertical-scale"),We=Rs(f,h.paint.get("fill-extrusion-cutoff-fade-range")),ye=h.paint.get("fill-extrusion-emissive-strength"),He=[],qe;Ce&&He.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&He.push("FAUX_AO"),ue&&He.push("ZERO_ROOF_RADIUS"),E&&He.push("HAS_CENTROID"),fe>0&&He.push("FLOOD_LIGHT"),We.shouldRenderCutoff&&He.push("RENDER_CUTOFF");let ct=f.renderPass==="shadow",ut=f.shadowRenderer,lt=ct&&!!ut;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Le=[0,0,0];if(ut){let Ot=f.style.directionalLight,Rt=f.style.ambientLight;Ot&&Rt&&(Le=zl(f.style,Ot,Rt)),qe=He.concat(["SHADOWS_SINGLE_CASCADE"])}let Ze=lt?"fillExtrusionDepth":G?"fillExtrusionPattern":"fillExtrusion",rt=h.getLayerRenderingStats();for(let Ot of _){let Rt=a.getTile(Ot),Wt=Rt.getBucket(h);if(!Wt||Wt.projection.name!==B.projection.name)continue;let Ft=!1;ut&&(Ft=ut.getMaxCascadeForTile(Ot.toUnwrapped())===0);let pt=f.isTileAffectedByFog(Ot),nt=Wt.programConfigurations.get(h.id),$t=f.getOrCreateProgram(Ze,{config:nt,defines:Ft?qe:He,overrideFog:pt});if(f.terrain&&f.terrain.setupElevationDraw(Rt,$t,{useMeterToDem:!0}),!Wt.centroidVertexBuffer){let Vt=$t.attributes.a_centroid_pos;Vt!==void 0&&O.vertexAttrib2f(Vt,0,0)}!ct&&ut&&ut.setupShadows(Rt.tileID.toUnwrapped(),$t,"vector-tile",Rt.tileID.overscaledZ),G&&(f.context.activeTexture.set(O.TEXTURE0),Rt.imageAtlasTexture&&Rt.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),nt.updatePaintBuffers());let Ii=j.constantOr(null);if(Ii&&Rt.imageAtlas){let Vt=Rt.imageAtlas.patternPositions[Ii.toString()];Vt&&nt.setConstantPatternPositions(Vt)}let bi=h.paint.get("fill-extrusion-vertical-gradient"),Fi;if(ct&&ut){if(vu(Rt.tileID,Wt,f))continue;let Vt=ut.calculateShadowPassMatrixFromTile(Rt.tileID.toUnwrapped());Fi=gu(Vt,ce,Ee)}else{let Vt=f.translatePosMatrix(Ot.expandedProjMatrix,Rt,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),pn=B.projection.createInversionMatrix(B,Ot.canonical);Fi=G?Ef(Vt,f,bi,q,ee,ce,Ot,Rt,he,we,de,pn,me,Ee):fu(Vt,f,bi,q,ee,ce,Ot,he,we,de,pn,me,Ee,fe,Le,ye)}f.uploadCommonUniforms(P,$t,Ot.toUnwrapped(),null,We);let Gi=Wt.segments;if(B.projection.name==="mercator"&&!ct&&(Gi=Wt.getVisibleSegments(Rt.tileID,f.terrain,f.transform.getFrustum(0)),!Gi.get().length))continue;if(rt)if(ct)for(let Vt of Gi.get())rt.numRenderedVerticesInShadowPass+=Vt.primitiveLength;else for(let Vt of Gi.get())rt.numRenderedVerticesInTransparentPass+=Vt.primitiveLength;let yn=[];(f.terrain||E)&&yn.push(Wt.centroidVertexBuffer),Ce&&yn.push(Wt.layoutVertexExtBuffer),$t.draw(f,P.gl.TRIANGLES,x,C,T,t.af.backCCW,Fi,h.id,Wt.layoutVertexBuffer,Wt.indexBuffer,Gi,h.paint,f.transform.zoom,nt,yn)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function Ta(f,a,h,_,x,C,T,E,P,O,B,j,G,q,K,J,ee,te,ue){let ce=f.context,he=ce.gl,Ce=f.transform,we=f.transform.zoom,de=[],me=Rs(f,h.paint.get("fill-extrusion-cutoff-fade-range"));O==="clear"?(de.push("CLEAR_SUBPASS"),ue&&(de.push("CLEAR_FROM_TEXTURE"),ce.activeTexture.set(he.TEXTURE0),ue.bind(he.LINEAR,he.CLAMP_TO_EDGE))):O==="sdf"&&de.push("SDF_SUBPASS"),ee&&de.push("HAS_CENTROID"),me.shouldRenderCutoff&&de.push("RENDER_CUTOFF");let fe=h.layout.get("fill-extrusion-edge-radius"),Ee=(We,ye,He,qe,ct)=>{let ut=ye.programConfigurations.get(h.id),lt=f.isTileAffectedByFog(We),Le=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:ut,defines:de,overrideFog:lt}),Ze=((Ot,Rt,Wt,Ft,pt,nt,$t,Ii,bi,Fi,Gi)=>({u_matrix:Rt,u_opacity:Wt,u_ao_pass:Ft?1:0,u_meter_to_tile:pt,u_ao:nt,u_flood_light_intensity:$t,u_flood_light_color:Ii,u_attenuation:bi,u_edge_radius:Fi,u_fb:0,u_fb_size:Gi}))(0,qe,B,P,ct,[j,G*ct],q,K,J,we>=17?0:fe*ct,ue?ue.size[0]:0),rt=[];ee&&rt.push(ye.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(ce,Le,We.toUnwrapped(),null,me),Le.draw(f,ce.gl.TRIANGLES,x,C,T,E,Ze,h.id,ye.vertexBuffer,ye.indexBuffer,He,h.paint,we,ut,rt)};for(let We of _){let ye=a.getTile(We),He=ye.getBucket(h);if(!He||He.projection.name!==Ce.projection.name||!He.groundEffect||He.groundEffect&&!He.groundEffect.hasData())continue;let qe=He.groundEffect,ct=1/He.tileToMeter;{let ut=f.translatePosMatrix(We.projMatrix,ye,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),lt=qe.getDefaultSegment();Ee(We,qe,lt,ut,ct)}if(te)for(let ut=0;ut<4;ut++){let lt=t.bZ[ut](We),Le=a.getTile(lt);if(!Le)continue;let Ze=Le.getBucket(h);if(!Ze||Ze.projection.name!==Ce.projection.name||!Ze.groundEffect||Ze.groundEffect&&!Ze.groundEffect.hasData())continue;let rt=Ze.groundEffect,Ot,Rt;ut===0?(Ot=[-t.a3,0,0],Rt=1):ut===1?(Ot=[t.a3,0,0],Rt=0):ut===2?(Ot=[0,-t.a3,0],Rt=3):(Ot=[0,t.a3,0],Rt=2);let Wt=rt.regionSegments[Rt];if(!Wt)continue;let Ft=new Float32Array(16);t.ad.translate(Ft,We.projMatrix,Ot),Ee(We,rt,Wt,f.translatePosMatrix(Ft,ye,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ct)}}}function dp(f,a,h,_,x,C,T){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();let E=C?C.findDEMTileFor(h):null;if(!(E&&E.dem||T))return;let P=te=>new t.P(Math.ceil((te+t.c0)*t.c1),0),O=te=>{let ue=a.getSource().minzoom,ce=Ce=>{let we=a.getTileByID(Ce);if(we&&we.hasData())return we.getBucket(x)},he=[0,-1,1];for(let Ce of he){if(te.overscaledZ+Ce<ue)continue;let we=ce(te.calculateScaledKey(te.overscaledZ+Ce));if(we)return we}},B=[0,0,0],j=(te,ue)=>(B[0]=Math.min(te.min.y,ue.min.y),B[1]=Math.max(te.max.y,ue.max.y),B[2]=t.a3-ue.min.x>te.max.x?ue.min.x-t.a3:te.max.x,B),G=(te,ue)=>(B[0]=Math.min(te.min.x,ue.min.x),B[1]=Math.max(te.max.x,ue.max.x),B[2]=t.a3-ue.min.y>te.max.y?ue.min.y-t.a3:te.max.y,B),q=[(te,ue)=>j(te,ue),(te,ue)=>j(ue,te),(te,ue)=>G(te,ue),(te,ue)=>G(ue,te)],K=(te,ue,ce,he,Ce,we,de)=>{if(!C)return 0;let me=[[we?ce:te,we?te:ce,0],[we?ce:ue,we?ue:ce,0]],fe=de<0?t.a3+de:de,Ee=[we?fe:(te+ue)/2,we?(te+ue)/2:fe,0];return ce===0&&de<0||ce!==0&&de>0?C.getForTilePoints(Ce,[Ee],!0,he):me.push(Ee),C.getForTilePoints(h,me,!0,E),Math.max(me[0][2],me[1][2],Ee[2])/C.exaggeration()};for(let te=0;te<4;te++){let ue=_.borderFeatureIndices[te];if(ue.length===0)continue;let ce=t.bZ[te](h),he=O(ce);if(!(he&&he instanceof t.b_)||_.borderDoneWithNeighborZ[te]===he.canonical.z)continue;he.centroidVertexArray.length===0&&he.createCentroidsBuffer();let Ce=C?C.findDEMTileFor(ce):null;if(!(Ce&&Ce.dem||T))continue;let we=(te<2?1:5)-te,de=he.borderDoneWithNeighborZ[we]!==_.canonical.z,me=he.borderFeatureIndices[we],fe=0;if(_.canonical.z!==he.canonical.z){for(let Ee of ue)_.showCentroid(_.featuresOnBorder[Ee]);if(de)for(let Ee of me)he.showCentroid(he.featuresOnBorder[Ee]);_.borderDoneWithNeighborZ[te]=he.canonical.z,he.borderDoneWithNeighborZ[we]=_.canonical.z}for(let Ee of ue){let We=_.featuresOnBorder[Ee],ye=_.centroidData[We.centroidDataIndex],He=We.borders[te],qe;for(;fe<me.length;){qe=he.featuresOnBorder[me[fe]];let ct=qe.borders[we];if(ct[1]>He[0]+3||ct[0]>He[0]-3)break;he.showCentroid(qe),fe++}if(qe&&fe<me.length){let ct=fe,ut=0;for(;!(qe.borders[we][0]>He[1]-3)&&(ut++,++fe!==me.length);)qe=he.featuresOnBorder[me[fe]];if(qe=he.featuresOnBorder[me[ct]],ut>1){let Ze=qe.borders[we];Math.abs(He[0]-Ze[0])<3&&Math.abs(He[1]-Ze[1])<3&&(ut=1,fe=ct+1)}else if(ut===0){_.showCentroid(We);continue}let lt=he.centroidData[qe.centroidDataIndex];T&&ut===1&&(((J=ye).flags|(ee=lt).flags)&t.b$?(J.flags|=t.b$,ee.flags|=t.b$):(J.flags&=~t.b$,ee.flags&=~t.b$));let Le=We.intersectsCount()>1||qe.intersectsCount()>1;if(ut>1)fe=ct,ye.centroidXY=lt.centroidXY=new t.P(0,0);else if(Ce&&Ce.dem&&!Le){let Ze=q[te](ye,lt),rt=te%2?t.a3-1:0,Ot=K(Ze[0],Math.min(t.a3-1,Ze[1]),rt,Ce,ce,te<2,Ze[2]);ye.centroidXY=lt.centroidXY=P(Ot)}else Le?ye.centroidXY=lt.centroidXY=new t.P(0,0):(ye.centroidXY=_.encodeBorderCentroid(We),lt.centroidXY=he.encodeBorderCentroid(qe));_.writeCentroidToBuffer(ye),he.writeCentroidToBuffer(lt)}else _.showCentroid(We)}_.borderDoneWithNeighborZ[te]=he.canonical.z,he.borderDoneWithNeighborZ[we]=_.canonical.z}var J,ee;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(f)}let md=[1,0,0],Hh=[0,1,0],Ls=[0,0,1];function vu(f,a,h){let _=h.transform,x=h.shadowRenderer;if(!x)return!0;let C=f.toUnwrapped(),T=_.tileSize*x._cascades[h.currentShadowCascade].scale,E=a.maxHeight;if(_.elevation){let J=_.elevation.getMinMaxForTile(f);J&&(E+=J.max)}let P=[...x.shadowDirection];P[2]=-P[2];let O=x.computeSimplifiedTileShadowVolume(C,E,T,P);if(!O)return!1;let B=[md,Hh,Ls,P,[P[0],0,P[2]],[0,P[1],P[2]]],j=_.projection.name==="globe",G=_.scaleZoom(T),q=t.aM.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,G,!j),K=x.getCurrentCascadeFrustum();return q.intersectsPrecise(O.vertices,O.planes,B)===0||K.intersectsPrecise(O.vertices,O.planes,B)===0}function xu(f){return[f[0]*t.c2,f[1]*t.c2,f[2]*t.c2,0]}function yc(f,a,h,_,x,C,T,E,P){let O=_.getSource(),B=h.globeSharedBuffers;if(!B)return;let j,G,q;if(a&&(j=_.getTile(a)),O instanceof t.bm?(G=O.texture,q=t.bh(0,0,h.transform)):j&&a&&(G=j.texture,q=t.bh(a.canonical.z,a.canonical.x,h.transform)),!G||!q)return;f||(q=t.ad.scale(t.ad.create(),q,[1,-1,1]));let K=h.context,J=K.gl,ee=x.paint.get("raster-resampling")==="nearest"?J.NEAREST:J.LINEAR,te=h.colorModeForDrapableLayerRenderPass(C),ue=T.defines;ue.push("GLOBE_POLES");let ce=new t.ae(J.LEQUAL,t.ae.ReadWrite,h.depthRangeFor3D),he=Float32Array.from(h.transform.expandedFarZProjMatrix),Ce=Float32Array.from(t.bf(t.bg(new t.aO(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),K.activeTexture.set(J.TEXTURE0),G.bind(ee,J.CLAMP_TO_EDGE),K.activeTexture.set(J.TEXTURE1),G.bind(ee,J.CLAMP_TO_EDGE),G.useMipmap&&K.extTextureFilterAnisotropic&&h.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,K.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,K.extTextureFilterAnisotropicMax);let[we,de,me,fe]=a?B.getPoleBuffers(a.canonical.z,!1):B.getPoleBuffers(0,!0),Ee=x.paint.get("raster-elevation"),We;f?(We=we,h.renderDefaultNorthPole=Ee!==0):(We=de,h.renderDefaultSouthPole=Ee!==0);let ye=xu(T.mix),He=((ct,ut,lt,Le,Ze,rt,Ot,Rt,Wt,Ft,pt,nt,$t)=>Uh(ct,ut,lt,new Float32Array(16),new Float32Array(9),[0,0],Le,[0,0],[0,0,0,0],1,{opacity:1,mix:0},rt,[0,0],Rt,2,Ft,pt,nt,1,0,$t))(he,Ce,q,t.a1(h.transform.zoom),0,x,0,Ee,0,ye,T.offset,T.range,C),qe=h.getOrCreateProgram("raster",{defines:ue});h.uploadCommonUniforms(K,qe,null),qe.draw(h,J.TRIANGLES,ce,P,te,E,He,x.id,We,me,fe)}function mn(f){let a=f._nearZ,h=f.projection.farthestPixelDistance(f),_=h-a,x=.2*f.height,C=a+x;return[a,h,(C-x-a)/_,(C-a)/_]}function t_(f,a,h,_){if(f)return a instanceof gc&&f instanceof t.c3?a.getTextureDescriptor(f,h,!0):{texture:f.texture,mix:xu(_.mix),offset:_.offset,buffer:0,tileSize:1}}function ri(f,a,h){if(!f)return null;let _=a.getTextureDescriptor(f,h,!0);if(!_)return null;let{texture:x,mix:C,offset:T,tileSize:E,buffer:P,format:O}=_;if(!x||!O)return null;let B=!1;return O==="uint32"&&(B=!0,C[3]=0,C=e_(t.c4,C,[0,h.paint.get("raster-particle-max-speed")]),T=Af(t.c4,T,[0,h.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[P/(E+2*P),E/(E+2*P)],tileSize:E,scalarData:B,scale:C,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[O]]}}function Rf(f){let a=f._nearZ,h=f.projection.farthestPixelDistance(f),_=h-a,x=.2*f.height,C=a+x;return[a,h,(C-x-a)/_,(C-a)/_]}let vc=new t.C(1,0,0,1),Vl=new t.C(0,1,0,1),Za=new t.C(0,0,1,1),Ff=new t.C(1,0,1,1),wu=new t.C(0,1,1,1);function Gt(f,a,h,_,x,C,T){let E=f.context,P=f.transform,O=E.gl,B=P.projection.name==="globe",j=B?["PROJECTION_GLOBE_VIEW"]:[],G=t.ad.clone(h.projMatrix);if(B&&t.a1(P.zoom)>0){let ye=t.c5(h.canonical,P),He=t.c6(ye);G=t.ad.multiply(new Float32Array(16),P.globeMatrix,He),t.ad.multiply(G,P.projMatrix,G)}let q=t.ad.create();q[12]+=2*x/(t.e.devicePixelRatio*P.width),q[13]+=2*C/(t.e.devicePixelRatio*P.height),t.ad.multiply(G,q,G);let K=f.getOrCreateProgram("debug",{defines:j}),J=a.getTileByID(h.key);f.terrain&&f.terrain.setupElevationDraw(J,K);let ee=t.ae.disabled,te=t.ag.disabled,ue=f.colorModeForRenderPass(),ce="$debug";E.activeTexture.set(O.TEXTURE0),f.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),B?J._makeGlobeTileDebugBuffers(f.context,P):J._makeDebugTileBoundsBuffers(f.context,P.projection);let he=J._tileDebugBuffer||f.debugBuffer,Ce=J._tileDebugIndexBuffer||f.debugIndexBuffer,we=J._tileDebugSegments||f.debugSegments;if(K.draw(f,O.LINE_STRIP,ee,te,ue,t.af.disabled,jh(G,_),ce,he,Ce,we,null,null,null,[J._globeTileDebugBorderBuffer]),T){let ye=J.latestRawTileData,He=Math.floor((ye&&ye.byteLength||0)/1024),qe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(qe+=` => ${h.overscaledZ}`),qe+=` ${J.state}`,qe+=` ${He}kb`,function(ct,ut){ct.initDebugOverlayCanvas();let lt=ct.debugOverlayCanvas,Le=ct.context.gl,Ze=ct.debugOverlayCanvas.getContext("2d");Ze.clearRect(0,0,lt.width,lt.height),Ze.shadowColor="white",Ze.shadowBlur=2,Ze.lineWidth=1.5,Ze.strokeStyle="white",Ze.textBaseline="top",Ze.font="bold 36px Open Sans, sans-serif",Ze.fillText(ut,5,5),Ze.strokeText(ut,5,5),ct.debugOverlayTexture.update(lt),ct.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(f,qe)}let de=a.getTile(h).tileSize,me=512/Math.min(de,512)*(h.overscaledZ/P.zoom)*.5,fe=J._tileDebugTextBuffer||f.debugBuffer,Ee=J._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,We=J._tileDebugTextSegments||f.debugSegments;K.draw(f,O.TRIANGLES,ee,te,t.a.alphaBlended,t.af.disabled,jh(G,t.C.transparent,me),ce,fe,Ee,We,null,null,null,[J._globeTileDebugTextBuffer])}function nn(f,a,h,_){oa(f,0,a+h/2,f.transform.width,h,_)}function rn(f,a,h,_){oa(f,a-h/2,0,h,f.transform.height,_)}function oa(f,a,h,_,x,C){let T=f.context,E=T.gl;E.enable(E.SCISSOR_TEST),E.scissor(a*t.e.devicePixelRatio,h*t.e.devicePixelRatio,_*t.e.devicePixelRatio,x*t.e.devicePixelRatio),T.clear({color:C}),E.disable(E.SCISSOR_TEST)}let Cu=t.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ln}=Cu;function zs(f,a,h,_){f.emplaceBack(a,h,_)}class Su{constructor(a){this.vertexArray=new t.c8,this.indices=new t.bu,zs(this.vertexArray,-1,-1,1),zs(this.vertexArray,1,-1,1),zs(this.vertexArray,-1,1,1),zs(this.vertexArray,1,1,1),zs(this.vertexArray,-1,-1,-1),zs(this.vertexArray,1,-1,-1),zs(this.vertexArray,-1,1,-1),zs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,ln),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=t.b.simpleSegment(0,0,36,12)}}function Cr(f,a,h,_,x,C){let T=f.context.gl,E=a.paint.get("sky-atmosphere-color"),P=a.paint.get("sky-atmosphere-halo-color"),O=a.paint.get("sky-atmosphere-sun-intensity"),B=((j,G,q,K,J)=>({u_matrix_3f:j,u_sun_direction:G,u_sun_intensity:q,u_color_tint_r:[K.r,K.g,K.b,K.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(t.bC.fromMat4(t.bC.create(),_),x,O,E,P);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+C,a.skyboxTexture,0),h.draw(f,T.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.frontCW,B,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}let br=t.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Yr{constructor(a){let h=new t.c9;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);let _=new t.bu;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(h,br.members),this.indexBuffer=a.createIndexBuffer(_),this.segments=t.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let lb=t.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Iu{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Lf{constructor(a){this.colorModeAlphaBlendedWriteRGB=new t.a([t.ca,t.cb,t.ca,t.cb],t.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new t.a([t.ca,t.cc,t.ca,t.cc],t.C.transparent,[!1,!1,!1,!0]),this.params=new Iu,this.updateNeeded=!0,a.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),a.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(a){let h=a.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Yr(h);let _=this.params.sizeRange,x=this.params.intensityRange,C=function(B){let j=t.cf(30),G=[];for(let q=0;q<B;++q){let K=2*Math.PI*j(),J=Math.acos(1-2*j())-.5*Math.PI;G.push(t._.fromValues(Math.cos(J)*Math.cos(K),Math.cos(J)*Math.sin(K),Math.sin(J)))}return G}(this.params.starsCount),T=t.cf(300),E=new t.cd,P=new t.bu,O=0;for(let B=0;B<C.length;++B){let j=t._.scale([],C[B],200),G=Math.max(0,1+.01*_*(1*T()-.5)),q=Math.max(0,1+.01*x*(1*T()-.5));E.emplaceBack(j[0],j[1],j[2],-1,-1,G,q),E.emplaceBack(j[0],j[1],j[2],1,-1,G,q),E.emplaceBack(j[0],j[1],j[2],1,1,G,q),E.emplaceBack(j[0],j[1],j[2],-1,1,G,q),P.emplaceBack(O+0,O+1,O+2),P.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=h.createVertexBuffer(E,lb.members),this.starsIdx=h.createIndexBuffer(P),this.starsSegments=t.b.simpleSegment(0,0,E.length,P.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(a,h){let _=a.context,x=_.gl,C=a.transform,T=new t.ae(x.LEQUAL,t.ae.ReadOnly,[0,1]),E=t.a1(C.zoom),P=a.style.getLut(h.scope),O=h.properties.get("color").toRenderColor(P).toArray01(),B=h.properties.get("high-color").toRenderColor(P).toArray01(),j=h.properties.get("space-color").toRenderColor(P).toArray01PremultipliedAlpha(),G=5e-4,q=t.ce(h.properties.get("horizon-blend"),0,1,G,.25),K=t.ba(a,_,C)&&q===G?C.worldSize/(2*Math.PI*1.025)-1:C.globeRadius,J=a.frameCounter/1e3%1,ee=t._.length(C.globeCenterInViewSpace),te=Math.sqrt(Math.pow(ee,2)-Math.pow(K,2)),ue=Math.acos(te/ee),ce=he=>{let Ce=C.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];he&&Ce.push("ALPHA_PASS");let we=a.getOrCreateProgram("globeAtmosphere",{defines:Ce}),de=((fe,Ee,We,ye,He,qe,ct,ut,lt,Le,Ze,rt)=>({u_frustum_tl:fe,u_frustum_tr:Ee,u_frustum_br:We,u_frustum_bl:ye,u_horizon:He,u_transition:qe,u_fadeout_range:ct,u_color:ut,u_high_color:lt,u_space_color:Le,u_temporal_offset:Ze,u_horizon_angle:rt}))(C.frustumCorners.TL,C.frustumCorners.TR,C.frustumCorners.BR,C.frustumCorners.BL,C.frustumCorners.horizon,E,q,O,B,j,J,ue);a.uploadCommonUniforms(_,we);let me=this.atmosphereBuffer;me&&we.draw(a,x.TRIANGLES,T,t.ag.disabled,he?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,t.af.backCW,de,he?"atmosphere_glow_alpha":"atmosphere_glow",me.vertexBuffer,me.indexBuffer,me.segments)};ce(!1),ce(!0)}drawStars(a,h){let _=t.at(h.properties.get("star-intensity"),0,1);if(_===0)return;let x=a.context,C=x.gl,T=a.transform,E=a.getOrCreateProgram("stars"),P=t.av.identity([]);t.av.rotateX(P,P,-T._pitch),t.av.rotateZ(P,P,-T.angle),t.av.rotateX(P,P,t.ab(T._center.lat)),t.av.rotateY(P,P,-t.ab(T._center.lng));let O=t.ad.fromQuat(new Float32Array(16),P),B=t.ad.multiply([],T.starsProjMatrix,O),j=t.bC.fromMat4([],O),G=t.bC.invert([],j),q=[0,1,0];t._.transformMat3(q,q,G),t._.scale(q,q,this.params.sizeMultiplier);let K=[1,0,0];t._.transformMat3(K,K,G),t._.scale(K,K,this.params.sizeMultiplier);let J=(ee=q,te=K,ue=_,{u_matrix:Float32Array.from(B),u_up:ee,u_right:te,u_intensity_multiplier:ue});var ee,te,ue;a.uploadCommonUniforms(x,E),this.starsVx&&this.starsIdx&&E.draw(a,C.TRIANGLES,t.ae.disabled,t.ag.disabled,this.colorModeAlphaBlendedWriteRGB,t.af.disabled,J,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function xc(f,a){let h=[...f],_=a.cameraWorldSizeForFog/a.worldSize,x=t.ad.identity([]);return t.ad.scale(x,x,[_,_,1]),t.ad.multiply(h,x,h),t.ad.multiply(h,a.worldToFogMatrix,h),h}function jl(f,a,h,_,x){let C=h.material,T=_.context,{baseColorTexture:E,metallicRoughnessTexture:P}=C.pbrMetallicRoughness,{normalTexture:O,occlusionTexture:B,emissionTexture:j}=C;function G(q,K,J){if(q&&(f.push(K),T.activeTexture.set(T.gl.TEXTURE0+J),q.gfxTexture)){let{minFilter:ee,magFilter:te,wrapS:ue,wrapT:ce}=q.sampler;q.gfxTexture.bindExtraParam(ee,te,ue,ce)}}G(E,"HAS_TEXTURE_u_baseColorTexture",ko.BaseColor),G(P,"HAS_TEXTURE_u_metallicRoughnessTexture",ko.MetallicRoughness),G(O,"HAS_TEXTURE_u_normalTexture",ko.Normal),G(B,"HAS_TEXTURE_u_occlusionTexture",ko.Occlusion),G(j,"HAS_TEXTURE_u_emissionTexture",ko.Emission),x&&(x.texture||(x.texture=new t.ch(_.context,x.image,[x.image.height,x.image.height,x.image.height],T.gl.RGBA)),T.activeTexture.set(T.gl.TEXTURE0+ko.LUT),x.texture&&x.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),a.push(h.texcoordBuffer)),h.colorBuffer&&(f.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),a.push(h.colorBuffer)),h.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),a.push(h.normalBuffer)),h.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),a.push(h.pbrBuffer)),C.alphaMode!=="OPAQUE"&&C.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),C.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES")}function Ul(f,a,h,_,x,C){let T=h.paint.get("model-opacity"),E=a.context,P=new t.ae(a.context.gl.LEQUAL,t.ae.ReadWrite,a.depthRangeFor3D),O=a.transform,B=f.mesh,j=B.material,G=j.pbrMetallicRoughness,q=a.style.fog,K;K=a.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:t.ad.multiply([],_.zScaleMatrix,f.nodeModelMatrix),t.ad.multiply(K,_.negCameraPosMatrix,K);let J=t.ad.invert([],K);t.ad.transpose(J,J);let ee=h.paint.get("model-emissive-strength").constantOr(0),te=hi(new Float32Array(f.worldViewProjection),new Float32Array(K),new Float32Array(J),null,a,T,G.baseColorFactor.toRenderColor(null),j.emissiveFactor,G.metallicFactor,G.roughnessFactor,j,ee,h),ue={defines:[]},ce=[];jl(ue.defines,ce,B,a,h.lut);let he=a.shadowRenderer;he&&(he.useNormalOffset=!1);let Ce=null;if(q){let me=xc(f.nodeModelMatrix,a.transform);if(Ce=new Float32Array(me),O.projection.name!=="globe"){let fe=B.aabb.min,Ee=B.aabb.max,[We,ye]=q.getOpacityForBounds(me,fe[0],fe[1],Ee[0],Ee[1]);ue.overrideFog=We>=_r||ye>=_r}}let we=Rs(a,h.paint.get("model-cutoff-fade-range"));we.shouldRenderCutoff&&ue.defines.push("RENDER_CUTOFF");let de=a.getOrCreateProgram("model",ue);a.uploadCommonUniforms(E,de,null,Ce,we),a.renderPass!=="shadow"&&he&&he.setupShadowsFromMatrix(f.nodeModelMatrix,de),de.draw(a,E.gl.TRIANGLES,P,x,C,B.material.doubleSided?t.af.disabled:t.af.backCCW,te,h.id,B.vertexBuffer,B.indexBuffer,B.segments,h.paint,a.transform.zoom,void 0,ce)}function co(f,a,h,_,x,C,T){let E;E=f.projection.name==="globe"?t.ci(h,f):[...h],t.ad.multiply(E,E,a.matrix);let P=t.ad.multiply([],_,E);if(a.meshes)for(let O of a.meshes){if(O.material.alphaMode!=="BLEND"){T.push({mesh:O,depth:0,modelIndex:x,worldViewProjection:P,nodeModelMatrix:E});continue}let B=t._.transformMat4([],O.centroid,P);B[2]>0&&C.push({mesh:O,depth:B[2],modelIndex:x,worldViewProjection:P,nodeModelMatrix:E})}if(a.children)for(let O of a.children)co(f,O,h,_,x,C,T)}function Ao(f,a,h,_){let x=h.shadowRenderer;if(!x)return;let C=x.getShadowPassDepthMode(),T=x.getShadowPassColorMode(),E=x.calculateShadowPassMatrixFromMatrix(a),P=sn(E);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,C,t.ag.disabled,T,t.af.backCCW,P,_.id,f.vertexBuffer,f.indexBuffer,f.segments,_.paint,h.transform.zoom,void 0,void 0)}function Tu(f,a,h){let _=a.updateZoomBasedPaintProperties(),x=function(C,T,E){let P,O,B,j=C.terrain?C.terrain.exaggeration():0;if(C.terrain&&j>0){let G=C.terrain,q=G.findDEMTileFor(E);q&&q.dem?P=t.ck.create(G,E,q):j=0}if(j===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),j===T.validForExaggeration&&(j===0||P&&P._demTile&&P._demTile.tileID===T.validForDEMTile.id&&P._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(let G in T.instancesPerModel){let q=T.instancesPerModel[G];for(let K=0;K<q.instancedDataArray.length;++K){let J=(P?j*P.getElevationAt(0|q.instancedDataArray.float32[16*K],0|q.instancedDataArray.float32[16*K+1],!0,!0):0)+q.instancesEvaluatedElevation[K];q.instancedDataArray.float32[16*K+6]=J,O=O?Math.min(T.terrainElevationMin,J):J,B=B?Math.max(T.terrainElevationMax,J):J}}return T.terrainElevationMin=O||0,T.terrainElevationMax=B||0,T.validForExaggeration=j,T.validForDEMTile=P&&P._demTile?{id:P._demTile.tileID,timestamp:P._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,a,h);(_||x)&&(a.uploaded=!1,a.upload(f.context))}let Wo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new t.b6([0,0,0],[t.a3,t.a3,0])};function kr(f,a){let h=1<<f.canonical.z,_=a.getFreeCameraOptions().position,x=a.elevation,C=f.canonical.x/h,T=(f.canonical.x+1)/h,E=f.canonical.y/h,P=(f.canonical.y+1)/h,O=a._centerAltitude;if(x){let q=x.getMinMaxForTile(f);q&&q.max>O&&(O=q.max)}let B=t.at(_.x,C,T)-_.x,j=t.at(_.y,E,P)-_.y,G=t.ax(O,a.center.lat)-_.z;return a._zoomFromMercatorZ(Math.sqrt(B*B+j*j+G*G))}function _s(f,a,h,_,x,C,T){let E=f.context,P=f.renderPass==="shadow",O=f.shadowRenderer,B=P&&O?O.getShadowPassDepthMode():new t.ae(E.gl.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D),j=f.isTileAffectedByFog(C);if(h.meshes)for(let G of h.meshes){let q=["MODEL_POSITION_ON_GPU"],K=[],J,ee,te;_.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");let ue=Rs(f,a.paint.get("model-cutoff-fade-range"));if(ue.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),P&&O)J=f.getOrCreateProgram("modelDepth",{defines:q}),ee=sn(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(h.matrix)),te=O.getShadowPassColorMode();else{jl(q,K,G,f,a.lut),J=f.getOrCreateProgram("model",{defines:q,overrideFog:j});let he=G.material,Ce=he.pbrMetallicRoughness,we=a.paint.get("model-opacity"),de=a.paint.get("model-emissive-strength").constantOr(0);ee=hi(C.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,f,we,Ce.baseColorFactor.toRenderColor(null),he.emissiveFactor,Ce.metallicFactor,Ce.roughnessFactor,he,de,a,x),O&&(T.shadowUniformsInitialized?J.setShadowUniformValues(E,O.getShadowUniformValues()):(O.setupShadows(C.toUnwrapped(),J,"model-tile",C.overscaledZ),T.shadowUniformsInitialized=!0)),te=ue.shouldRenderCutoff||we<1||he.alphaMode!=="OPAQUE"?t.a.alphaBlended:t.a.unblended}f.uploadCommonUniforms(E,J,C.toUnwrapped(),null,ue);let ce=G.material.doubleSided?t.af.disabled:t.af.backCCW;if(_.instancedDataArray.length>20)K.push(_.instancedDataBuffer),J.draw(f,E.gl.TRIANGLES,B,t.ag.disabled,te,ce,ee,a.id,G.vertexBuffer,G.indexBuffer,G.segments,a.paint,f.transform.zoom,void 0,K,_.instancedDataArray.length);else{let he=P?"u_instance":"u_normal_matrix";for(let Ce=0;Ce<_.instancedDataArray.length;++Ce)ee[he]=new Float32Array(_.instancedDataArray.arrayBuffer,64*Ce,16),J.draw(f,E.gl.TRIANGLES,B,t.ag.disabled,te,ce,ee,a.id,G.vertexBuffer,G.indexBuffer,G.segments,a.paint,f.transform.zoom,void 0,K)}}if(h.children)for(let G of h.children)_s(f,a,G,_,x,C,T)}let Wl=[1,-1,1];function vo(f,a,h,_){if(!h.modelManager)return!0;let x=h.modelManager;if(!h.shadowRenderer)return!0;let C=h.shadowRenderer,T=a.aabb,E=!0,P=f.maxHeight;if(P===0){let B=0;for(let j in f.instancesPerModel){let G=x.getModel(j,_);G?B=Math.max(B,Math.max(Math.max(G.aabb.max[0],G.aabb.max[1]),G.aabb.max[2])):E=!1}P=f.maxScale*B*1.41+f.maxVerticalOffset,E&&(f.maxHeight=P)}T.max[2]=P,T.min[2]+=f.terrainElevationMin,T.max[2]+=f.terrainElevationMax,t._.transformMat4(T.min,T.min,a.tileMatrix),t._.transformMat4(T.max,T.max,a.tileMatrix);let O=T.intersects(C.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=O===2),O===0}function zf(f,a){let h=f.uniformValues.u_cutoff_params[0],_=f.uniformValues.u_cutoff_params[1],x=f.uniformValues.u_cutoff_params[2],C=f.uniformValues.u_cutoff_params[3];return _===h||C===x?1:t.at(((a-h)/(_-h)-x)/(C-x),0,1)}function Bs(f,a,h,_){if(a.pitch<20)return 1;let x=a.getWorldToCameraMatrix(),C=t.ad.multiply([],x,f),T=[...h.min,1],E=t.aA.transformMat4([],T,C),P=E,O=E;T[1]=h.max[1],E=t.aA.transformMat4([],T,C),P=E[1]<P[1]?E:P,O=E[1]>O[1]?E:O,T[0]=h.max[0],E=t.aA.transformMat4([],T,C),P=E[1]<P[1]?E:P,O=E[1]>O[1]?E:O,T[1]=h.min[1],E=t.aA.transformMat4([],T,C),P=E[1]<P[1]?E:P,O=E[1]>O[1]?E:O;let B=t.at(_[0],0,1),j=100*a.pixelsPerMeter*t.at(_[1],0,1),G=t.at(_[2],0,1),q=t._.lerp([],P,O,B),K=Math.tan(.5*a.fovX),J=-q[2]*K;if(j===0)return q[1]<-Math.abs(J)?G:1;let ee=(-Math.abs(J)-q[1])/j,te=(ce,he,Ce)=>(1-Ce)*ce+Ce*he,ue=t.at(te(1,G,ee),G,1);return te(1,ue,t.at((a.pitch-20)/20,0,1))}class wc{}class Hl{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(a,h,_){{let j=this._storage.get(h.id);if(j)return j.lastUsedFrameIdx=a,j.buf}let x=_.gl,C=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),T=new ArrayBuffer(C),E=new Int16Array(T);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));let P=new t.cm;for(let j=0;j<C/2;j+=3){let G=E[j],q=E[j+1],K=E[j+2];P.emplaceBack(G,q),P.emplaceBack(q,K),P.emplaceBack(K,G)}let O=_.bindVertexArrayOES.current,B=new wc;return B.buf=new t.I(_,P),B.lastUsedFrameIdx=a,this._storage.set(h.id,B),_.bindVertexArrayOES.set(O),B.buf}update(a){for(let[h,_]of this._storage)a-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(h))}destroy(){for(let[a,h]of this._storage)h.buf.destroy(),this._storage.delete(a)}}let Cc=t.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class ve{constructor(a){let h=new t.cn,_=new t.bu;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1),_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),this.segments=t.b.simpleSegment(0,0,h.length,_.length),this.vx=a.createVertexBuffer(h,Cc.members),this.idx=a.createIndexBuffer(_)}destroy(){this.vx.destroy(),this.idx.destroy()}}let ua={symbol:function(f,a,h,_,x){if(f.renderPass!=="translucent")return;let C=t.ag.disabled,T=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(O,B,j,G,q,K,J){let ee=B.transform,te=q==="map",ue=K==="map";for(let ce of O){let he=G.getTile(ce),Ce=he.getBucket(j);if(!Ce||!Ce.text||!Ce.text.segments.get().length)continue;let we=t.aD(Ce.textSizeData,ee.zoom),de=bu(ce,Ce.getProjection(),ee),me=ee.calculatePixelsToTileUnitsMatrix(he),fe=$r(de,he.tileID.canonical,ue,te,ee,Ce.getProjection(),me),Ee=Ce.hasIconTextFit()&&Ce.hasIconData();if(we){let We=Math.pow(2,ee.zoom-he.tileID.overscaledZ);Wh(Ce,te,ue,J,t.bO,ee,fe,ce,We,we,Ee)}}}(_,f,h,a,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x);let E=h.paint.get("icon-opacity").constantOr(1)!==0,P=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(E||P)?rr(f,a,h,_,C,T):(E&&rr(f,a,h,_,C,T,{onlyIcons:!0}),P&&rr(f,a,h,_,C,T,{onlyText:!0}),function(O,B,j,G){if(!O.symbolParams.useOcclusionQueries)return;let q=O.context.gl,K=O.transform,J=j.paint,ee=J.get("icon-occlusion-opacity").constantOr(0),te=J.get("text-occlusion-opacity").constantOr(0);if(!j.hasInitialOcclusionOpacityProperties||ee===1&&te===1)return;let ue=K.projection.name==="globe";for(let ce of G){let he=B.getTile(ce),Ce=he.getBucket(j);if(!Ce||Ce.projection.name==="mercator"&&ue||Ce.fullyClipped)continue;if(Ce.projection.name==="globe"){t.w(`Occlusion not supported for globe mode. Layer: ${j.type}`);continue}let we=bu(ce,Ce.getProjection(),K),de=t.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,O.symbolParams.depthOffset,1),me=t.ad.multiply([],de,we),fe=O.symbolParams.visualizeOcclusions!=="none"?1:O.symbolParams.occlusionQueryFrameWindow;for(let Ee=0;Ee<Ce.symbolInstances.length;Ee++){let We=Ce.symbolInstances.get(Ee),ye=O.style.placement.opacities[We.crossTileID];if(ye&&ye.isHidden()||(O.frameCounter+Ee)%fe!=0)continue;let He=We.tileAnchorX,qe=We.tileAnchorY,ct=We.zOffset,ut;if(O.symbolParams.visualizeOcclusions==="none"){let Ot=Ce.queries.get(Ee);if(Ot){if(!Ot.isFree()){if(!Ot.isResultAvailable())continue;let Rt=Ot.consumeResult();We.occlusionState=Rt===0?0:1;continue}ut=Ot}else ut=new lc(O.context),Ce.queries.set(Ee,ut)}let lt=O.getOrCreateProgram("occlusion"),Le=O.symbolParams.occluderSize,Ze=er(me,[He,qe,ct],[K.width,K.height],[Le,Le],O.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);O.terrain&&O.terrain.setupElevationDraw(he,lt,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),O.symbolParams.visualizeOcclusions==="none"&&ut&&ut.begin();let rt=new t.ae(O.symbolParams.visualizeOcclusions==="zPass"?O.context.gl.ALWAYS:O.context.gl.LEQUAL,t.ae.ReadOnly,O.depthRangeFor3D);lt.draw(O,q.TRIANGLES,rt,t.ag.disabled,O.symbolParams.visualizeOcclusions!=="none"?t.a.alphaBlendedNonPremultiplied:t.a.disabled,t.af.disabled,Ze,"occlusion",O.occlusionBuffers.vx,O.occlusionBuffers.idx,O.occlusionBuffers.segments),O.symbolParams.visualizeOcclusions==="none"&&ut&&ut.end()}}}(f,a,h,_)),a.map.showCollisionBoxes&&(bc(f,a,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),bc(f,a,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(f,a,h,_){if(f.renderPass!=="translucent")return;let x=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),E=h.layout.get("circle-sort-key").constantOr(1)!==void 0,P=h.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(C.constantOr(1)===0||T.constantOr(1)===0))return;let O=f.context,B=O.gl,j=f.transform,G=f.depthModeForSublayer(0,t.ae.ReadOnly),q=t.ag.disabled,K=f.colorModeForDrapableLayerRenderPass(P),J=j.projection.name==="globe",ee=[t.aj(j.center.lng),t.ak(j.center.lat)],te=[];for(let ce=0;ce<_.length;ce++){let he=_[ce],Ce=a.getTile(he),we=Ce.getBucket(h);if(!we||we.projection.name!==j.projection.name)continue;let de=we.programConfigurations.get(h.id),me=t.bR(h),fe=f.isTileAffectedByFog(he);J&&me.push("PROJECTION_GLOBE_VIEW");let Ee=f.getOrCreateProgram("circle",{config:de,defines:me,overrideFog:fe}),We=we.layoutVertexBuffer,ye=we.globeExtVertexBuffer,He=we.indexBuffer,qe=j.projection.createInversionMatrix(j,he.canonical),ct={programConfiguration:de,program:Ee,layoutVertexBuffer:We,globeExtVertexBuffer:ye,indexBuffer:He,uniformValues:t.bS(f,he,Ce,qe,ee,h),tile:Ce};if(E){let ut=we.segments.get();for(let lt of ut)te.push({segments:new t.b([lt]),sortKey:lt.sortKey,state:ct})}else te.push({segments:we.segments,sortKey:0,state:ct})}E&&te.sort((ce,he)=>ce.sortKey-he.sortKey);let ue={useDepthForOcclusion:j.depthOcclusionForSymbolsAndCircles};for(let ce of te){let{programConfiguration:he,program:Ce,layoutVertexBuffer:we,globeExtVertexBuffer:de,indexBuffer:me,uniformValues:fe,tile:Ee}=ce.state,We=ce.segments;f.terrain&&f.terrain.setupElevationDraw(Ee,Ce,ue),f.uploadCommonUniforms(O,Ce,Ee.tileID.toUnwrapped()),Ce.draw(f,B.TRIANGLES,G,q,K,t.af.disabled,fe,h.id,we,me,We,h.paint,j.zoom,he,[de])}},heatmap:function(f,a,h,_){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){let x=f.context,C=x.gl,T=t.ag.disabled,E=new t.a([C.ONE,C.ONE,C.ONE,C.ONE],t.C.transparent,[!0,!0,!0,!0]);(function(q,K,J,ee){let te=q.gl,ue=K.width*ee,ce=K.height*ee;q.activeTexture.set(te.TEXTURE1),q.viewport.set([0,0,ue,ce]);let he=J.heatmapFbo;if(!he||he&&(he.width!==ue||he.height!==ce)){he&&he.destroy();let Ce=te.createTexture();te.bindTexture(te.TEXTURE_2D,Ce),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),he=J.heatmapFbo=q.createFramebuffer(ue,ce,!0,null),function(we,de,me,fe,Ee,We){let ye=we.gl;ye.texImage2D(ye.TEXTURE_2D,0,we.extRenderToTextureHalfFloat?ye.RGBA16F:ye.RGBA,Ee,We,0,ye.RGBA,we.extRenderToTextureHalfFloat?ye.HALF_FLOAT:ye.UNSIGNED_BYTE,null),fe.colorAttachment.set(me)}(q,0,Ce,he,ue,ce)}else te.bindTexture(te.TEXTURE_2D,he.colorAttachment.get()),q.bindFramebuffer.set(he.framebuffer)})(x,f,h,f.transform.projection.name==="globe"?.5:.25),x.clear({color:t.C.transparent});let P=f.transform,O=P.projection.name==="globe",B=O?["PROJECTION_GLOBE_VIEW"]:[],j=O?t.af.frontCCW:t.af.disabled,G=[t.aj(P.center.lng),t.ak(P.center.lat)];for(let q=0;q<_.length;q++){let K=_[q];if(a.hasRenderableParent(K))continue;let J=a.getTile(K),ee=J.getBucket(h);if(!ee||ee.projection.name!==P.projection.name)continue;let te=f.isTileAffectedByFog(K),ue=ee.programConfigurations.get(h.id),ce=f.getOrCreateProgram("heatmap",{config:ue,defines:B,overrideFog:te}),{zoom:he}=f.transform;f.terrain&&f.terrain.setupElevationDraw(J,ce),f.uploadCommonUniforms(x,ce,K.toUnwrapped());let Ce=P.projection.createInversionMatrix(P,K.canonical);ce.draw(f,C.TRIANGLES,t.ae.disabled,T,E,j,nl(f,K,J,Ce,G,he,h.paint.get("heatmap-intensity")),h.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,h.paint,f.transform.zoom,ue,O?[ee.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(x,C){let T=x.context,E=T.gl,P=C.heatmapFbo;if(!P)return;T.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,P.colorAttachment.get()),T.activeTexture.set(E.TEXTURE1);let O=C.colorRampTexture;O||(O=C.colorRampTexture=new t.T(T,C.colorRamp,E.RGBA)),O.bind(E.LINEAR,E.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,E.TRIANGLES,t.ae.disabled,t.ag.disabled,x.colorModeForRenderPass(),t.af.disabled,((B,j,G,q)=>({u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}))(0,C),C.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,C.paint,x.transform.zoom)}(f,h))},line:function(f,a,h,_){if(f.renderPass!=="translucent")return;let x=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(x.constantOr(1)===0||C.constantOr(1)===0)return;let T=h.paint.get("line-emissive-strength"),E=h.paint.get("line-occlusion-opacity"),P=f.context,O=P.gl,B=h.layout.get("line-z-offset"),j=!B.isConstant()||!!B.constantOr(0),G=j?new t.ae(f.depthOcclusion?O.GREATER:O.LEQUAL,t.ae.ReadOnly,f.depthRangeFor3D):f.depthModeForSublayer(0,t.ae.ReadOnly),q=f.colorModeForDrapableLayerRenderPass(T),K=f.terrain&&f.terrain.renderingToTexture,J=K?1:t.e.devicePixelRatio,ee=h.paint.get("line-dasharray"),te=ee.constantOr(1),ue=h.layout.get("line-cap"),ce=ee.constantOr(null),he=ue.constantOr(null),Ce=h.paint.get("line-pattern"),we=Ce.constantOr(1),de=Ce.constantOr(null),me=h.paint.get("line-opacity").constantOr(1),fe=!we&&me!==1||f.depthOcclusion&&E>0&&E<1,Ee=h.paint.get("line-gradient"),We=we?"linePattern":"line",ye=t.bT(h),He;if(K&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(fe=!1),E!==0&&f.depthOcclusion){let ct=h.paint._values["line-opacity"];ct&&ct.value&&ct.value.kind==="constant"?He=ct.value:t.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}if(j&&(f.forceTerrainMode=!0),!j&&E!==0&&f.terrain&&!K)return void t.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let qe=fe&&j?f.stencilModeFor3D():t.ag.disabled;for(let ct of _){let ut=a.getTile(ct);if(we&&!ut.patternsLoaded())continue;let lt=ut.getBucket(h);if(!lt)continue;f.prepareDrawTile();let Le=lt.programConfigurations.get(h.id),Ze=f.isTileAffectedByFog(ct),rt=f.getOrCreateProgram(We,{config:Le,defines:j?[...ye,"ELEVATED"]:ye,overrideFog:Ze});if(de&&ut.imageAtlas){let nt=ut.imageAtlas.patternPositions[de.toString()];nt&&Le.setConstantPatternPositions(nt)}if(!we&&ce&&he&&ut.lineAtlas){let nt=ut.lineAtlas.getDash(ce,he);nt&&Le.setConstantPatternPositions(nt)}let[Ot,Rt]=h.paint.get("line-trim-offset");(he==="round"||he==="square")&&Ot!==Rt&&(Ot===0&&(Ot-=1),Rt===1&&(Rt+=1));let Wt=K?ct.projMatrix:null,Ft=we?t.bU(f,ut,h,Wt,J,[Ot,Rt]):t.bV(f,ut,h,Wt,lt.lineClipsArray.length,J,[Ot,Rt]);if(Ee){let nt=lt.gradients[h.id],$t=nt.texture;if(h.gradientVersion!==nt.version){let Ii=256;if(h.stepInterpolant){let bi=a.getSource().maxzoom,Fi=ct.canonical.z===bi?Math.ceil(1<<f.transform.maxZoom-ct.canonical.z):1;Ii=t.at(t.bW(lt.maxLineLength/t.a3*1024*Fi),256,P.maxTextureSize)}nt.gradient=t.bX({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ii,image:nt.gradient||void 0,clips:lt.lineClipsArray}),nt.texture?nt.texture.update(nt.gradient):nt.texture=new t.T(P,nt.gradient,O.RGBA),nt.version=h.gradientVersion,$t=nt.texture}P.activeTexture.set(O.TEXTURE1),$t.bind(h.stepInterpolant?O.NEAREST:O.LINEAR,O.CLAMP_TO_EDGE)}te&&(P.activeTexture.set(O.TEXTURE0),ut.lineAtlasTexture&&ut.lineAtlasTexture.bind(O.LINEAR,O.REPEAT),Le.updatePaintBuffers()),we&&(P.activeTexture.set(O.TEXTURE0),ut.imageAtlasTexture&&ut.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Le.updatePaintBuffers()),j&&f.terrain.setupElevationDraw(ut,rt),f.uploadCommonUniforms(P,rt,ct.toUnwrapped());let pt=nt=>{He!=null&&(He.value=me*E),rt.draw(f,O.TRIANGLES,G,nt,q,t.af.disabled,Ft,h.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,h.paint,f.transform.zoom,Le,[lt.layoutVertexBuffer2,lt.patternVertexBuffer,lt.zOffsetVertexBuffer]),He!=null&&(He.value=me)};if(fe&&!j){let nt=f.stencilModeForClipping(ct).ref;nt===0&&K&&P.clear({stencil:0});let $t={func:O.EQUAL,mask:255};Ft.u_alpha_discard_threshold=.8,pt(new t.ag($t,nt,255,O.KEEP,O.KEEP,O.INVERT)),Ft.u_alpha_discard_threshold=0,pt(new t.ag($t,nt,255,O.KEEP,O.KEEP,O.KEEP))}else fe&&j&&(Ft.u_alpha_discard_threshold=.001),pt(j?qe:f.stencilModeForClipping(ct))}fe&&(f.resetStencilClippingMasks(),K&&P.clear({stencil:0})),E===0||f.depthOcclusion||K||f.layersWithOcclusionOpacity.push(f.currentLayer),j&&(f.forceTerrainMode=!1)},fill:function(f,a,h,_){let x=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(C.constantOr(1)===0)return;let T=h.paint.get("fill-emissive-strength"),E=f.colorModeForDrapableLayerRenderPass(T),P=h.paint.get("fill-pattern"),O=f.opaquePassEnabledForLayer()&&!P.constantOr(1)&&x.constantOr(t.C.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===O){let B=f.depthModeForSublayer(1,f.renderPass==="opaque"?t.ae.ReadWrite:t.ae.ReadOnly);cp(f,a,h,_,B,E,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){let B=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,t.ae.ReadOnly);cp(f,a,h,_,B,E,!0)}},"fill-extrusion":function(f,a,h,_){let x=h.paint.get("fill-extrusion-opacity"),C=f.context,T=C.gl,E=f.terrain,P=E&&E.renderingToTexture;if(x===0)return;let O=f.conflationActive&&f.style.isLayerClipped(h,a.getSource()),B=f.style.order.indexOf(h.fqid);if(O&&function(j,G,q,K,J){for(let ee of K){let te=G.getTile(ee).getBucket(q);te&&(te.updateReplacement(ee,j.replacementSource,J),te.uploadCentroid(j.context))}}(f,a,h,_,B),E||O)for(let j of _){let G=a.getTile(j).getBucket(h);G&&dp(f.context,a,j,G,h,E,O)}if(f.renderPass==="shadow"&&f.shadowRenderer){let j=f.shadowRenderer;if(E&&x<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof t.Z)return;let G=j.getShadowPassDepthMode(),q=j.getShadowPassColorMode();Nl(f,a,h,_,G,t.ag.disabled,q,O)}else if(f.renderPass==="translucent"){let j=!h.paint.get("fill-extrusion-pattern").constantOr(1),G=h.paint.get("fill-extrusion-color").constantOr(t.C.white);if(!P&&G.a!==0){let q=new t.ae(f.context.gl.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D);x===1&&j?Nl(f,a,h,_,q,t.ag.disabled,t.a.unblended,O):(Nl(f,a,h,_,q,t.ag.disabled,t.a.disabled,O),Nl(f,a,h,_,q,f.stencilModeFor3D(),f.colorModeForRenderPass(),O),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&j&&(!E&&f.transform.projection.name!=="globe"||P)){let q=h.paint.get("fill-extrusion-opacity"),K=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),J=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ee=h.paint.get("fill-extrusion-flood-light-intensity"),te=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),ue=K>0&&J>0,ce=ee>0,he=(we,de,me)=>(1-me)*we+me*de,Ce=we=>{let de=f.depthModeForSublayer(1,t.ae.ReadOnly,T.LEQUAL,!0),me=h.paint.get(we?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),fe=he(.1,3,me),Ee=f._showOverdrawInspector;if(!Ee){let We=new t.ag({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),ye=new t.a([T.ONE,T.ONE,T.ONE,T.ONE],t.C.transparent,[!1,!1,!1,!0],T.MIN);Ta(f,a,h,_,de,We,ye,t.af.disabled,we,"sdf",q,K,J,ee,te,fe,O,!1)}{let We=Ee?t.ag.disabled:new t.ag({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),ye=Ee?f.colorModeForRenderPass():new t.a([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],t.C.transparent,[!0,!0,!0,!0]);Ta(f,a,h,_,de,We,ye,t.af.disabled,we,"color",q,K,J,ee,te,fe,O,!1)}};if(P){let we=(de,me,fe)=>{let Ee=f.depthModeForSublayer(1,t.ae.ReadOnly,T.LEQUAL,!1),We=h.paint.get(de?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ye=he(.1,3,We);{let He=new t.a([T.ONE,T.ONE,T.ONE,T.ONE],t.C.transparent,[!1,!1,!1,!0]);Ta(f,a,h,_,Ee,t.ag.disabled,He,t.af.disabled,de,"clear",q,K,J,ee,te,ye,O,me)}{let He=new t.ag({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),qe=new t.a([T.ONE,T.ONE,T.ONE,T.ONE],t.C.transparent,[!1,!1,!1,!0],T.MIN);Ta(f,a,h,_,Ee,He,qe,t.af.disabled,de,"sdf",q,K,J,ee,te,ye,O,me)}{let He=de?T.ZERO:T.ONE_MINUS_DST_ALPHA,qe=new t.ag({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),ct=new t.a([He,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],t.C.transparent,[!0,!0,!0,!0]);Ta(f,a,h,_,Ee,qe,ct,t.af.disabled,de,"color",q,K,J,ee,te,ye,O,me)}{let He=new t.a([T.ONE,T.ONE,T.ONE,de?T.ZERO:T.ONE],t.C.transparent,[!1,!1,!1,!0],de?T.FUNC_ADD:T.MAX);Ta(f,a,h,_,Ee,t.ag.disabled,He,t.af.disabled,de,"clear",q,K,J,ee,te,ye,O,me,fe)}};if(ue||ce){let de;if(f.prepareDrawTile(),E){let me=E.drapeBufferSize[0],fe=E.drapeBufferSize[1];de=E.framebufferCopyTexture,de&&(!de||de.size[0]===me&&de.size[1]===fe)||(de&&de.destroy(),de=E.framebufferCopyTexture=new t.T(C,new t.i({width:me,height:fe}),T.RGBA)),de.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexImage2D(T.TEXTURE_2D,0,T.RGBA,0,0,me,fe,0)}ue&&we(!0,!1,de),ce&&we(!1,!0,de)}}else ue&&Ce(!0),ce&&Ce(!1)}}},hillshade:function(f,a,h,_){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;let x=f.context,C=f.terrain&&f.terrain.renderingToTexture,[T,E]=f.renderPass!=="translucent"||C?[{},_]:f.stencilConfigForOverlap(_);for(let P of E){let O=a.getTile(P);if(O.needsHillshadePrepare&&f.renderPass==="offscreen")ms(f,O,h);else if(f.renderPass==="translucent"){let B=f.depthModeForSublayer(0,t.ae.ReadOnly),j=h.paint.get("hillshade-emissive-strength"),G=f.colorModeForDrapableLayerRenderPass(j),q=C&&f.terrain?f.terrain.stencilModeForRTTOverlap(P):T[P.overscaledZ];ab(f,P,O,h,B,q,G)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,a,h,_,x,C){if(f.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;let T=f.transform.projection.name==="globe",E=h.paint.get("raster-elevation")!==0,P=E&&T;if(f.renderElevatedRasterBackface&&!P)return;let O=f.context,B=O.gl,j=a.getSource(),G=function(we,de,me,fe){let Ee=de.paint.get("raster-color"),We=we.type==="raster-array",ye=[],He=de.paint.get("raster-resampling"),qe=de.paint.get("raster-color-mix"),ct=de.paint.get("raster-color-range"),ut=[qe[0],qe[1],qe[2],0],lt=qe[3],Le=He==="nearest"?fe.NEAREST:fe.LINEAR;if(We&&(ye.push("RASTER_ARRAY"),Ee||ye.push("RASTER_COLOR"),He==="linear"&&ye.push("RASTER_ARRAY_LINEAR"),Le=fe.NEAREST,!ct&&we.rasterLayers)){let Ze=we.rasterLayers.find(({id:rt})=>rt===de.sourceLayer);Ze&&Ze.fields&&Ze.fields.range&&(ct=Ze.fields.range)}if(ct=ct||[0,1],Ee){ye.push("RASTER_COLOR"),me.activeTexture.set(fe.TEXTURE2),de.updateColorRamp(ct);let Ze=de.colorRampTexture;Ze||(Ze=de.colorRampTexture=new t.T(me,de.colorRamp,fe.RGBA)),Ze.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}return{mix:ut,range:ct,offset:lt,defines:ye,resampling:Le}}(j,h,O,B);if(j instanceof t.bm&&!_.length&&!T)return;let q=h.paint.get("raster-emissive-strength"),K=f.colorModeForDrapableLayerRenderPass(q),J=f.terrain&&f.terrain.renderingToTexture,ee=!f.options.moving,te=h.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;if(j instanceof t.bm&&!_.length&&(j.onNorthPole||j.onSouthPole)){let we=E?f.stencilModeFor3D():t.ag.disabled;return void yc(!!j.onNorthPole,null,f,a,h,q,G,t.af.disabled,we)}if(!_.length)return;let[ue,ce]=j instanceof t.bm||J?[{},_]:f.stencilConfigForOverlap(_),he=ce[ce.length-1].overscaledZ;P&&G.defines.push("PROJECTION_GLOBE_VIEW"),E&&G.defines.push("RENDER_CUTOFF");let Ce=(we,de,me)=>{for(let fe of we){let Ee=fe.toUnwrapped(),We=a.getTile(fe);if(J&&(!We||!We.hasData()))continue;O.activeTexture.set(B.TEXTURE0);let ye=t_(We,j,h,G);if(!ye||!ye.texture)continue;let{texture:He,mix:qe,offset:ct,tileSize:ut,buffer:lt}=ye,Le,Ze;J?(Le=t.ae.disabled,Ze=fe.projMatrix):E?(Le=new t.ae(B.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D),Ze=T?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Ee,ee)):(Le=f.depthModeForSublayer(fe.overscaledZ-he,h.paint.get("raster-opacity")===1?t.ae.ReadWrite:t.ae.ReadOnly,B.LESS),Ze=f.transform.calculateProjMatrix(Ee,ee));let rt=f.terrain&&J?f.terrain.stencilModeForRTTOverlap(fe):ue[fe.overscaledZ],Ot=C?0:h.paint.get("raster-fade-duration");We.registerFadeDuration(Ot);let Rt=a.findLoadedParent(fe,0),Wt=uu(We,Rt,a,f.transform,Ot),Ft,pt;f.terrain&&f.terrain.prepareDrawTile(),O.activeTexture.set(B.TEXTURE0),He.bind(te,B.CLAMP_TO_EDGE),O.activeTexture.set(B.TEXTURE1),Rt?(Rt.texture&&Rt.texture.bind(te,B.CLAMP_TO_EDGE),Ft=Math.pow(2,Rt.tileID.overscaledZ-We.tileID.overscaledZ),pt=[We.tileID.canonical.x*Ft%1,We.tileID.canonical.y*Ft%1]):He.bind(te,B.CLAMP_TO_EDGE),He.useMipmap&&O.extTextureFilterAnisotropic&&f.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);let nt=f.transform,$t,Ii=E?mn(nt):[0,0,0,0],bi,Fi,Gi,yn,Vt,pn=0;if(P&&j instanceof t.bm&&j.coordinates.length>3)bi=Float32Array.from(t.bf(t.bg(new t.aO(0,0,0)))),Fi=Float32Array.from(nt.globeMatrix),Gi=Float32Array.from(t.bb(nt)),yn=[t.aj(nt.center.lng),t.ak(nt.center.lat)],$t=j.elevatedGlobePerspectiveTransform,Vt=j.elevatedGlobeGridMatrix||new Float32Array(9);else if(P){let xi=t.bc(fe.canonical);pn=t.bd(xi.getCenter().lat),bi=Float32Array.from(t.bf(t.bg(fe.canonical))),Fi=Float32Array.from(nt.globeMatrix),Gi=Float32Array.from(t.bb(nt)),yn=[t.aj(nt.center.lng),t.ak(nt.center.lat)],$t=[0,0],Vt=Float32Array.from(t.be(fe.canonical,xi,pn,nt.worldSize/nt._pixelsPerMercatorPixel))}else $t=j instanceof t.bm?j.perspectiveTransform:[0,0],bi=new Float32Array(16),Fi=new Float32Array(9),Gi=new Float32Array(16),yn=[0,0],Vt=new Float32Array(9);let Nn=Uh(Ze,bi,Fi,Gi,Vt,pt||[0,0],t.a1(f.transform.zoom),yn,Ii,Ft||1,Wt,h,$t,E?h.paint.get("raster-elevation"):0,2,qe,ct,G.range,ut,lt,q),dn=f.isTileAffectedByFog(fe),qi=f.getOrCreateProgram("raster",{defines:G.defines,overrideFog:dn});if(f.uploadCommonUniforms(O,qi,Ee),j instanceof t.bm){let xi=j.elevatedGlobeVertexBuffer,Xn=j.elevatedGlobeIndexBuffer;if(J||!T)j.boundsBuffer&&j.boundsSegments&&qi.draw(f,B.TRIANGLES,Le,t.ag.disabled,K,t.af.disabled,Nn,h.id,j.boundsBuffer,f.quadTriangleIndexBuffer,j.boundsSegments);else if(xi&&Xn){let on=nt.zoom<=t.b1?j.elevatedGlobeSegments:j.getSegmentsForLongitude(nt.center.lng);on&&qi.draw(f,B.TRIANGLES,Le,t.ag.disabled,K,de,Nn,h.id,xi,Xn,on)}}else if(P){Le=new t.ae(B.LEQUAL,t.ae.ReadOnly,f.depthRangeFor3D);let xi=f.globeSharedBuffers;if(xi){let[Xn,on,Fn]=xi.getGridBuffers(pn,!1);qi.draw(f,B.TRIANGLES,Le,me||rt,f.colorModeForRenderPass(),de,Nn,h.id,Xn,on,Fn)}}else{let{tileBoundsBuffer:xi,tileBoundsIndexBuffer:Xn,tileBoundsSegments:on}=f.getTileBoundsBuffers(We);qi.draw(f,B.TRIANGLES,Le,rt,K,t.af.disabled,Nn,h.id,xi,Xn,on)}}if(!(j instanceof t.bm)&&P)for(let fe of we){let Ee=fe.canonical.y===(1<<fe.canonical.z)-1;fe.canonical.y===0&&yc(!0,fe,f,a,h,q,G,de,me||t.ag.disabled),Ee&&yc(!1,fe,f,a,h,q,G,de===t.af.frontCW?t.af.backCW:t.af.frontCW,me||t.ag.disabled)}};P?Ce(ce,f.renderElevatedRasterBackface?t.af.backCW:t.af.frontCW,f.stencilModeFor3D()):Ce(ce,t.af.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,a,h,_,x,C){f.renderPass==="offscreen"&&function(T,E,P,O){if(!O.length)return;let B=T.context,j=B.gl,G=E.getSource();if(!(G instanceof gc))return;let q=Math.ceil(Math.sqrt(P.paint.get("raster-particle-count"))),K=P.particlePositionRGBAImage;if(!K||K.width!==q){let ce=function(he){let Ce=he*he,we=new Uint8Array(4*Ce),de=function(fe){return fe|=0,fe=Math.imul(2747636419^fe,2654435769),fe=Math.imul(fe^fe>>>16,2654435769),((fe=Math.imul(fe^fe>>>16,2654435769))>>>0)/4294967296},me=1/1.3;for(let fe=0;fe<Ce;fe++){let Ee=me*(de(2*fe+0)+Uo),We=me*(de(2*fe+1)+Uo),ye=255*Ee%1,He=255*We%1,qe=ye,ct=We-He/255,ut=He;we[4*fe+0]=255*(Ee-ye/255),we[4*fe+1]=255*qe,we[4*fe+2]=255*ct,we[4*fe+3]=255*ut}return we}(q);K=P.particlePositionRGBAImage=new t.i({width:q,height:q},ce)}let J=P.particleFramebuffer;J?J.width!==q&&(J.destroy(),J=P.particleFramebuffer=B.createFramebuffer(q,q,!0,null)):J=P.particleFramebuffer=B.createFramebuffer(q,q,!0,null);let ee=[];for(let ce of O){let he=E.getTile(ce);if(!(he instanceof t.c3))continue;let Ce=ri(he,G,P);if(!Ce)continue;let we=[he.tileSize,he.tileSize],de=P.tileFramebuffer;de||(de=P.tileFramebuffer=B.createFramebuffer(we[0],we[1],!0,null));let me=he.rasterParticleState;me||(me=he.rasterParticleState=new Fa(B,ce,we,K));let fe=me.update(P.lastInvalidatedAt);me.particleTextureDimension!==q&&me.updateParticleTexture(ce,K);let Ee=me.targetColorTexture;me.targetColorTexture=me.backgroundColorTexture,me.backgroundColorTexture=Ee;let We=me.particleTexture0;me.particleTexture0=me.particleTexture1,me.particleTexture1=We,ee.push([ce,Ce,me,fe])}if(ee.length===0)return;let te=t.e.now(),ue=P.previousDrawTimestamp?.001*(te-P.previousDrawTimestamp):.0167;if(P.previousDrawTimestamp=te,P.hasColorMap()){B.activeTexture.set(j.TEXTURE0+2);let ce=P.colorRampTexture;ce||(ce=P.colorRampTexture=new t.T(B,P.colorRamp,j.RGBA)),ce.bind(j.LINEAR,j.CLAMP_TO_EDGE)}B.bindFramebuffer.set(P.tileFramebuffer.framebuffer),function(ce,he,Ce){let we=ce.context,de=we.gl,me=he.tileFramebuffer;we.activeTexture.set(de.TEXTURE0);let fe={u_texture:0,u_opacity:1.05*(We=he.paint.get("raster-particle-fade-opacity-factor"))/(We+.05)},Ee=ce.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var We;for(let ye of Ce){let[,,He,qe]=ye;me.colorAttachment.set(He.targetColorTexture.texture),we.viewport.set([0,0,me.width,me.height]),we.clear({color:t.C.transparent}),qe&&(He.backgroundColorTexture.bind(de.NEAREST,de.CLAMP_TO_EDGE),Ee.draw(ce,de.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.alphaBlended,t.af.disabled,fe,he.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments))}}(T,P,ee),function(ce,he,Ce,we){let de=ce.context,me=de.gl,fe=Ce.tileFramebuffer,Ee=ce.transform.projection.name==="globe",We=Ce.paint.get("raster-particle-max-speed");for(let ye of we){let[He,qe,ct]=ye;de.activeTexture.set(me.TEXTURE0+0),qe.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE),fe.colorAttachment.set(ct.targetColorTexture.texture);let ut=ce.getOrCreateProgram("rasterParticleDraw",{defines:qe.defines,overrideFog:!1});de.activeTexture.set(me.TEXTURE0+1);let lt=qe.scalarData?[]:[0,1,2,3].map(rt=>t.bZ[rt](He));lt.push(He);let Le=He.canonical.x,Ze=He.canonical.y;for(let rt of lt){let Ot=he.getTile(Ee?rt.wrapped():rt);if(!Ot)continue;let Rt=Ot.rasterParticleState;if(!Rt)continue;let Wt=rt.canonical.x+(1<<rt.canonical.z)*(rt.wrap-He.wrap),Ft=rt.canonical.y;Rt.particleTexture0.bind(me.NEAREST,me.CLAMP_TO_EDGE);let pt=Pf(1,Rt.particleTexture0.size[0],[Wt-Le,Ft-Ze],0,qe.texture.size,2,We,qe.textureOffset,qe.scale,qe.offset);ut.draw(ce,me.POINTS,t.ae.disabled,t.ag.disabled,t.a.alphaBlended,t.af.disabled,pt,Ce.id,Rt.particleIndexBuffer,void 0,Rt.particleSegment)}}}(T,E,P,ee),B.bindFramebuffer.set(P.particleFramebuffer.framebuffer),function(ce,he,Ce,we){let de=ce.context,me=de.gl,fe=he.paint.get("raster-particle-max-speed"),Ee=we*he.paint.get("raster-particle-speed-factor")*.15,We=function(He){return Math.pow(He,6)}(.01+1*he.paint.get("raster-particle-reset-rate-factor")),ye=he.particleFramebuffer;de.viewport.set([0,0,ye.width,ye.height]);for(let He of Ce){let[,qe,ct]=He;de.activeTexture.set(me.TEXTURE0+0),qe.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE),de.activeTexture.set(me.TEXTURE0+1);let ut=ct.particleTexture0;ut.bind(me.NEAREST,me.CLAMP_TO_EDGE);let lt=sb(1,ut.size[0],0,qe.texture.size,fe,Ee,We,qe.textureOffset,qe.scale,qe.offset);ye.colorAttachment.set(ct.particleTexture1.texture),de.clear({color:t.C.transparent}),ce.getOrCreateProgram("rasterParticleUpdate",{defines:qe.defines}).draw(ce,me.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.disabled,lt,he.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments)}}(T,P,ee,ue)}(f,a,h,_),f.renderPass==="translucent"&&(function(T,E,P,O,B){let j=T.context,G=j.gl,q=!T.options.moving,K=T.transform.projection.name==="globe";if(!O.length)return;let[J,ee]=T.stencilConfigForOverlap(O),te=[];K&&te.push("PROJECTION_GLOBE_VIEW");let ue=T.stencilModeFor3D();for(let ce of ee){let he=ce.toUnwrapped(),Ce=E.getTile(ce);if(!Ce.rasterParticleState)continue;let we=Ce.rasterParticleState,de=100;Ce.registerFadeDuration(de);let me=E.findLoadedParent(ce,0),fe=uu(Ce,me,E,T.transform,de),Ee,We;T.terrain&&T.terrain.prepareDrawTile(),j.activeTexture.set(G.TEXTURE0),we.targetColorTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),j.activeTexture.set(G.TEXTURE1),me&&me.rasterParticleState?(me.rasterParticleState.targetColorTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Ee=Math.pow(2,me.tileID.overscaledZ-Ce.tileID.overscaledZ),We=[Ce.tileID.canonical.x*Ee%1,Ce.tileID.canonical.y*Ee%1]):we.targetColorTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let ye=K?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(he,q),He=T.transform,qe=Rf(He),ct=t.bc(ce.canonical),ut=t.bd(ct.getCenter().lat),lt,Le,Ze,rt,Ot;K?(lt=Float32Array.from(t.bf(t.bg(ce.canonical))),Le=Float32Array.from(He.globeMatrix),Ze=Float32Array.from(t.bb(He)),rt=[t.aj(He.center.lng),t.ak(He.center.lat)],Ot=Float32Array.from(t.be(ce.canonical,ct,ut,He.worldSize/He._pixelsPerMercatorPixel))):(lt=new Float32Array(16),Le=new Float32Array(9),Ze=new Float32Array(16),rt=[0,0],Ot=new Float32Array(9));let Rt=ap(ye,lt,Le,Ze,Ot,We||[0,0],t.a1(T.transform.zoom),rt,qe,Ee||1,fe,250),Wt=T.isTileAffectedByFog(ce),Ft=T.getOrCreateProgram("rasterParticle",{defines:te,overrideFog:Wt});if(T.uploadCommonUniforms(j,Ft,he),K){let pt=new t.ae(G.LEQUAL,t.ae.ReadWrite,T.depthRangeFor3D),nt=0,$t=T.globeSharedBuffers;if($t){let[Ii,bi,Fi]=$t.getGridBuffers(ut,nt!==0);Ft.draw(T,G.TRIANGLES,pt,ue,t.a.alphaBlended,t.af.backCCW,Rt,P.id,Ii,bi,Fi)}}else{let pt=T.depthModeForSublayer(0,t.ae.ReadOnly),nt=J[ce.overscaledZ],{tileBoundsBuffer:$t,tileBoundsIndexBuffer:Ii,tileBoundsSegments:bi}=T.getTileBoundsBuffers(Ce);Ft.draw(T,G.TRIANGLES,pt,nt,t.a.alphaBlended,t.af.disabled,Rt,P.id,$t,Ii,bi)}}T.resetStencilClippingMasks()}(f,a,h,_),f.style.map.triggerRepaint())},background:function(f,a,h,_){let x=h.paint.get("background-color"),C=h.paint.get("background-opacity"),T=h.paint.get("background-emissive-strength");if(C===0)return;let E=f.context,P=E.gl,O=f.transform,B=O.tileSize,j=h.paint.get("background-pattern"),G;if(j!==void 0&&(j===null||(G=f.imageManager.getPattern(j.toString(),h.scope,f.style.getLut(h.scope)),!G)))return;let q=!j&&x.a===1&&C===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==q)return;let K=t.ag.disabled,J=f.depthModeForSublayer(0,q==="opaque"?t.ae.ReadWrite:t.ae.ReadOnly),ee=f.colorModeForDrapableLayerRenderPass(T),te=j?"backgroundPattern":"background",ue,ce=_;ce||(ue=f.getBackgroundTiles(),ce=Object.values(ue).map(he=>he.tileID)),j&&(E.activeTexture.set(P.TEXTURE0),f.imageManager.bind(f.context,h.scope));for(let he of ce){let Ce=f.isTileAffectedByFog(he),we=f.getOrCreateProgram(te,{overrideFog:Ce}),de=he.toUnwrapped(),me=_?he.projMatrix:f.transform.calculateProjMatrix(de);f.prepareDrawTile();let fe=a?a.getTile(he):ue?ue[he.key]:new t.by(he,B,O.zoom,f),Ee=j?Pt(me,T,C,f,0,h.scope,G,{tileID:he,tileSize:B}):et(me,T,C,x.toRenderColor(h.lut));f.uploadCommonUniforms(E,we,de);let{tileBoundsBuffer:We,tileBoundsIndexBuffer:ye,tileBoundsSegments:He}=f.getTileBoundsBuffers(fe);we.draw(f,P.TRIANGLES,J,K,ee,t.af.disabled,Ee,h.id,We,ye,He)}},sky:function(f,a,h){let _=f._atmosphere?t.a1(f.transform.zoom):1,x=h.paint.get("sky-opacity")*_;if(x===0)return;let C=f.context,T=h.paint.get("sky-type"),E=new t.ae(C.gl.LEQUAL,t.ae.ReadOnly,[0,1]),P=f.frameCounter/1e3%1;T==="atmosphere"?f.renderPass==="offscreen"?h.needsSkyboxCapture(f)&&(function(O,B,j,G){let q=O.context,K=q.gl,J=B.skyboxFbo;if(!J){J=B.skyboxFbo=q.createFramebuffer(32,32,!0,null),B.skyboxGeometry=new Su(q),B.skyboxTexture=q.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,B.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let ce=0;ce<6;++ce)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(J.framebuffer),q.viewport.set([0,0,32,32]);let ee=B.getCenter(O,!0),te=O.getOrCreateProgram("skyboxCapture"),ue=new Float64Array(16);t.ad.identity(ue),t.ad.rotateY(ue,ue,.5*-Math.PI),Cr(O,B,te,ue,ee,0),t.ad.identity(ue),t.ad.rotateY(ue,ue,.5*Math.PI),Cr(O,B,te,ue,ee,1),t.ad.identity(ue),t.ad.rotateX(ue,ue,.5*-Math.PI),Cr(O,B,te,ue,ee,2),t.ad.identity(ue),t.ad.rotateX(ue,ue,.5*Math.PI),Cr(O,B,te,ue,ee,3),t.ad.identity(ue),Cr(O,B,te,ue,ee,4),t.ad.identity(ue),t.ad.rotateY(ue,ue,Math.PI),Cr(O,B,te,ue,ee,5),q.viewport.set([0,0,O.width,O.height])}(f,h),h.markSkyboxValid(f)):f.renderPass==="sky"&&function(O,B,j,G,q){let K=O.context,J=K.gl,ee=O.transform,te=O.getOrCreateProgram("skybox");K.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,B.skyboxTexture);let ue=((ce,he,Ce,we,de)=>({u_matrix:ce,u_sun_direction:he,u_cubemap:0,u_opacity:we,u_temporal_offset:de}))(ee.skyboxMatrix,B.getCenter(O,!1),0,G,q);O.uploadCommonUniforms(K,te),te.draw(O,J.TRIANGLES,j,t.ag.disabled,O.colorModeForRenderPass(),t.af.backCW,ue,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,h,E,x,P):T==="gradient"&&f.renderPass==="sky"&&function(O,B,j,G,q){let K=O.context,J=K.gl,ee=O.transform,te=O.getOrCreateProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new Su(K)),K.activeTexture.set(J.TEXTURE0);let ue=B.colorRampTexture;ue||(ue=B.colorRampTexture=new t.T(K,B.colorRamp,J.RGBA)),ue.bind(J.LINEAR,J.CLAMP_TO_EDGE);let ce=((he,Ce,we,de,me)=>({u_matrix:he,u_color_ramp:0,u_center_direction:Ce,u_radius:t.ab(we),u_opacity:de,u_temporal_offset:me}))(ee.skyboxMatrix,B.getCenter(O,!1),B.paint.get("sky-gradient-radius"),G,q);O.uploadCommonUniforms(K,te),te.draw(O,J.TRIANGLES,j,t.ag.disabled,O.colorModeForRenderPass(),t.af.backCW,ce,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,h,E,x,P)},debug:function(f,a,h,_,x,C){for(let T=0;T<h.length;T++)if(x){let O=new t.C(_.r*.8,_.g*.8,_.b*.8,1);Gt(f,a,h[T],_,-1,-1,C),Gt(f,a,h[T],_,-1,1,C),Gt(f,a,h[T],_,1,1,C),Gt(f,a,h[T],_,1,-1,C),Gt(f,a,h[T],O,0,0,C)}else Gt(f,a,h[T],_,0,0,C)},custom:function(f,a,h,_){let x=f.context,C=h.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&h.isDraped(a)){if(f.renderPass==="offscreen"){let T=C.prerender;if(T){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){let E=f.transform.pointMerc;T.call(C,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),t.a1(f.transform.zoom),[E.x,E.y],f.transform.pixelsPerMeterRatio)}else T.call(C,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){let E=C.renderToTile;if(E){let P=_[0].canonical,O=new t.Y(P.x+_[0].wrap*(1<<P.z),P.y,P.z);x.setDepthMode(t.ae.disabled),x.setStencilMode(t.ag.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),E.call(C,x.gl,O),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(t.ag.disabled);let T=C.renderingMode==="3d"?new t.ae(f.context.gl.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,t.ae.ReadOnly);if(x.setDepthMode(T),f.transform.projection.name==="globe"){let E=f.transform.pointMerc;C.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),t.a1(f.transform.zoom),[E.x,E.y],f.transform.pixelsPerMeterRatio)}else C.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else t.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,a,h,_){if(f.renderPass==="opaque")return;let x=h.paint.get("model-opacity");if(x===0)return;let C=h.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!C||f.terrain&&x<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof t.Z))return;let T=f.shadowRenderer,E=h.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,E||(T.enabled=!1));let P=()=>{T&&(T.useNormalOffset=!0,E||(T.enabled=!0))},O=a.getSource();if(f.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(te,ue,ce,he,Ce){let we=te.transform;if(we.projection.name!=="mercator")return void t.w(`Drawing 3D models for ${we.projection.name} projection is not yet implemented`);let de=we.getFreeCameraOptions().position;if(!te.modelManager)return;let me=te.modelManager;ce.modelManager=me;let fe=te.shadowRenderer;if(!ce._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let Ee=ce._unevaluatedLayout._values["model-id"],We=Dn({},ce.layout.get("model-id").parameters),ye=te.style.order.indexOf(ce.fqid);for(let He of he){let qe=ue.getTile(He).getBucket(ce);if(!qe||qe.projection.name!==we.projection.name)continue;let ct=qe.getModelUris();ct&&!qe.modelsRequested&&(me.addModelsFromBucket(ct,Ce),qe.modelsRequested=!0);let ut=kr(He,we);We.zoom=ut;let lt=Ee.possiblyEvaluate(We);if(Tu(te,qe,He),Wo.shadowUniformsInitialized=!1,Wo.useSingleShadowCascade=!!fe&&fe.getMaxCascadeForTile(He.toUnwrapped())===0,te.renderPass==="shadow"&&fe){if(te.currentShadowCascade===1&&qe.isInsideFirstShadowMapFrustum)continue;let rt=we.calculatePosMatrix(He.toUnwrapped(),we.worldSize);if(Wo.tileMatrix.set(rt),Wo.shadowTileMatrix=Float32Array.from(fe.calculateShadowPassMatrixFromMatrix(rt)),Wo.aabb.min.fill(0),Wo.aabb.max[0]=Wo.aabb.max[1]=t.a3,Wo.aabb.max[2]=0,vo(qe,Wo,te,ce.scope))continue}let Le=1<<He.canonical.z,Ze=[((de.x-He.wrap)*Le-He.canonical.x)*t.a3,(de.y*Le-He.canonical.y)*t.a3,de.z*Le*t.a3];te.conflationActive&&Object.keys(qe.instancesPerModel).length>0&&te.style.isLayerClipped(ce,ue.getSource())&&qe.updateReplacement(He,te.replacementSource,ye)&&(qe.uploaded=!1,qe.upload(te.context));for(let rt in qe.instancesPerModel){let Ot=qe.instancesPerModel[rt];Ot.features.length>0&&(rt=lt.evaluate(Ot.features[0].feature,{}));let Rt=me.getModel(rt,Ce);if(Rt&&Rt.uploaded)for(let Wt of Rt.nodes)_s(te,ce,Wt,Ot,Ze,He,Wo)}}}(f,a,h,_,O.type==="vector"?h.scope:""),void P();if(!O.loaded())return;if(O.type==="batched-model")return function(te,ue,ce,he){ce.resetLayerRenderingStats(te);let Ce=te.context,we=te.transform,de=te.style.fog,me=te.shadowRenderer;if(we.projection.name!=="mercator")return void t.w(`Drawing 3D landmark models for ${we.projection.name} projection is not yet implemented`);let fe=te.transform.getFreeCameraOptions().position,Ee=t._.scale([],[fe.x,fe.y,fe.z],te.transform.worldSize);t._.negate(Ee,Ee);let We=t.ad.identity([]),ye=t.cg(we.center.lat,we.zoom),He=t.ad.fromScaling([],[1,1,1/ye]);t.ad.translate(We,We,Ee);let qe=ce.paint.get("model-opacity"),ct=new t.ae(Ce.gl.LEQUAL,t.ae.ReadWrite,te.depthRangeFor3D),ut=new t.ae(Ce.gl.LEQUAL,t.ae.ReadOnly,te.depthRangeFor3D),lt=new t.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Le=te.renderPass==="shadow",Ze=Le&&me?me.getCurrentCascadeFrustum():we.getFrustum(we.scaleZoom(we.worldSize)),rt=ce.paint.get("model-front-cutoff"),Ot=rt[2]<1,Rt=Rs(te,ce.paint.get("model-cutoff-fade-range")),Wt=ce.getLayerRenderingStats();(function(Ft,pt,nt,$t){let Ii=Ft.terrain?Ft.terrain.exaggeration():0,bi=Ft.transform.zoom;for(let Fi of $t){let Gi=pt.getTile(Fi).getBucket(nt);Gi&&(Ft.conflationActive&&Gi.updateReplacement(Fi,Ft.replacementSource),Gi.evaluateScale(Ft,nt),Ft.terrain&&Ii>0&&Gi.elevationUpdate(Ft.terrain,Ii,Fi,nt.source),Gi.needsReEvaluation(Ft,bi,nt)&&Gi.evaluate(nt))}})(te,ue,ce,he),function(){let Ft,pt,nt;Ot?(Ft=he.length-1,pt=-1,nt=-1):(Ft=0,pt=he.length,nt=1);for(let $t=Ft;$t!==pt;$t+=nt){let Ii=he[$t],bi=ue.getTile(Ii).getBucket(ce);if(!bi||!bi.uploaded)continue;let Fi=!1;me&&(Fi=me.getMaxCascadeForTile(Ii.toUnwrapped())===0);let Gi=we.calculatePosMatrix(Ii.toUnwrapped(),we.worldSize),yn=bi.modelTraits,Vt=[];for(let pn of bi.getNodesInfo()){if(pn.hiddenByReplacement||!pn.node.meshes)continue;let Nn=pn.node,dn=0;te.terrain&&Nn.elevation&&(dn=Nn.elevation*te.terrain.exaggeration());let qi=pn.evaluatedScale;if(qi[0]<=1&&qi[1]<=1&&qi[2]<=1&&(()=>{let Ue=pn.aabb;return lt.min=[...Ue.min],lt.max=[...Ue.max],lt.min[2]+=dn,lt.max[2]+=dn,t._.transformMat4(lt.min,lt.min,Gi),t._.transformMat4(lt.max,lt.max,Gi),lt})().intersects(Ze)===0)continue;let xi=[...Gi],Xn=Nn.anchor?Nn.anchor[0]:0,on=Nn.anchor?Nn.anchor[1]:0;t.ad.translate(xi,xi,[Xn*(qi[0]-1),on*(qi[1]-1),dn]),t._.exactEquals(qi,t.cj)||t.ad.scale(xi,xi,qi);let Fn=t.ad.multiply([],xi,Nn.matrix),dt=t.ad.multiply([],we.expandedFarZProjMatrix,Fn),Lt=t.ad.multiply([],we.expandedFarZProjMatrix,xi),Sr=t.aA.transformMat4([],[Xn,on,dn,1],dt)[2];Nn.hidden=!1;let vn=qe;Le||(Ot&&(vn*=Bs(xi,we,pn.aabb,rt)),vn*=zf(Rt,Sr)),vn!==0?Vt.push({nodeInfo:pn,depth:Sr,opacity:vn,wvpForNode:dt,wvpForTile:Lt,nodeModelMatrix:Fn,tileModelMatrix:xi}):Nn.hidden=!0}Le||Vt.sort((pn,Nn)=>!Ot||pn.opacity===1&&Nn.opacity===1?pn.depth<Nn.depth?-1:1:pn.opacity===1?-1:Nn.opacity===1?1:pn.depth>Nn.depth?-1:1);for(let pn of Vt){let Nn=pn.nodeInfo,dn=Nn.node,qi=t.ad.multiply([],He,pn.tileModelMatrix);t.ad.multiply(qi,We,qi);let xi=t.ad.invert([],qi);t.ad.transpose(xi,xi),t.ad.scale(xi,xi,Wl),qi=t.ad.multiply(qi,qi,dn.matrix);let Xn=te.renderPass==="light-beam",on=yn&t.cl.HasMapboxMeshFeatures,Fn=on?0:Nn.evaluatedRMEA[0][2];for(let dt=0;dt<dn.meshes.length;++dt){let Lt=dn.meshes[dt],Sr=dt===dn.lightMeshIndex,vn=pn.wvpForNode;if(Sr){if(!Xn&&!te.terrain&&te.shadowRenderer){te.currentLayer<te.firstLightBeamLayer&&(te.firstLightBeamLayer=te.currentLayer);continue}vn=pn.wvpForTile}else if(Xn)continue;let Ue={defines:[]},Ja=[];if(jl(Ue.defines,Ja,Lt,te,ce.lut),on||Ue.defines.push("DIFFUSE_SHADED"),Fi&&Ue.defines.push("SHADOWS_SINGLE_CASCADE"),Wt&&(Le?Wt.numRenderedVerticesInShadowPass+=Lt.vertexArray.length:Wt.numRenderedVerticesInTransparentPass+=Lt.vertexArray.length),Le){Ao(Lt,pn.nodeModelMatrix,te,ce);continue}let qo=null;if(de){let Ec=xc(pn.nodeModelMatrix,te.transform);if(qo=new Float32Array(Ec),we.projection.name!=="globe"){let Dc=Lt.aabb.min,es=Lt.aabb.max,[Us,cl]=de.getOpacityForBounds(Ec,Dc[0],Dc[1],es[0],es[1]);Ue.overrideFog=Us>=_r||cl>=_r}}let Zr=Lt.material,Gn;Zr.occlusionTexture&&Zr.occlusionTexture.offsetScale&&(Gn=Zr.occlusionTexture.offsetScale,Ue.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Le&&me&&(me.useNormalOffset=!!Lt.normalBuffer);let sa=te.getOrCreateProgram("model",Ue);!Le&&me&&me.setupShadowsFromMatrix(pn.tileModelMatrix,sa,me.useNormalOffset),te.uploadCommonUniforms(Ce,sa,null,qo);let js=Zr.pbrMetallicRoughness;js.metallicFactor=.9,js.roughnessFactor=.5;let Ea=hi(new Float32Array(vn),new Float32Array(qi),new Float32Array(xi),new Float32Array(dn.matrix),te,pn.opacity,js.baseColorFactor.toRenderColor(null),Zr.emissiveFactor,js.metallicFactor,js.roughnessFactor,Zr,Fn,ce,[0,0,0],Gn);!Sr&&(Nn.hasTranslucentParts||pn.opacity<1)&&sa.draw(te,Ce.gl.TRIANGLES,ct,t.ag.disabled,t.a.disabled,t.af.backCCW,Ea,ce.id,Lt.vertexBuffer,Lt.indexBuffer,Lt.segments,ce.paint,te.transform.zoom,void 0,Ja),sa.draw(te,Ce.gl.TRIANGLES,Sr?ut:ct,t.ag.disabled,Sr||pn.opacity<1||Nn.hasTranslucentParts?t.a.alphaBlended:t.a.unblended,t.af.backCCW,Ea,ce.id,Lt.vertexBuffer,Lt.indexBuffer,Lt.segments,ce.paint,te.transform.zoom,void 0,Ja)}}}}()}(f,a,h,_),void P();let B=O.getModels(),j=[],G=f.transform.getFreeCameraOptions().position,q=t._.scale([],[G.x,G.y,G.z],f.transform.worldSize);t._.negate(q,q);let K=[],J=[],ee=0;for(let te of B){let ue=h.paint.get("model-rotation").constantOr(null),ce=h.paint.get("model-scale").constantOr(null),he=h.paint.get("model-translation").constantOr(null);te.computeModelMatrix(f,ue,ce,he,!0,!0,!1);let Ce=t.ad.identity([]),we=t.cg(te.position.lat,f.transform.zoom),de=t.ad.fromScaling([],[1,1,1/we]);t.ad.translate(Ce,Ce,q),j.push({zScaleMatrix:de,negCameraPosMatrix:Ce});for(let me of te.nodes)co(f.transform,me,te.matrix,f.transform.expandedFarZProjMatrix,ee,K,J);ee++}if(K.sort((te,ue)=>ue.depth-te.depth),f.renderPass!=="shadow"){if(x===1)for(let te of J)Ul(te,f,h,j[te.modelIndex],t.ag.disabled,f.colorModeForRenderPass());else{for(let te of J)Ul(te,f,h,j[te.modelIndex],t.ag.disabled,t.a.disabled);for(let te of J)Ul(te,f,h,j[te.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(let te of K)Ul(te,f,h,j[te.modelIndex],t.ag.disabled,f.colorModeForRenderPass());P()}else{for(let te of J)Ao(te.mesh,te.nodeModelMatrix,f,h);for(let te of K)Ao(te.mesh,te.nodeModelMatrix,f,h);P()}}},Gh={model:function(f,a,h){let _=a.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,_.type==="vector"?f.scope:""));if(_.type==="batched-model")return;let x=_.getModels();for(let C of x)C.upload(h.context)},raster:function(f,a,h){let _=a.getSource();if(!(_ instanceof gc&&_.loaded()))return;let x=f.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!x)return;let C=f.paint.get("raster-array-band")||_.getInitialBand(x);if(C==null)return;let T=a.getIds().map(E=>a.getTileByID(E));for(let E of T)E.updateNeeded(x,C)&&_.prepareTile(E,x,C)},"raster-particle":function(f,a,h){let _=a.getSource();if(!(_ instanceof gc&&_.loaded()))return;let x=f.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!x)return;let C=f.paint.get("raster-particle-array-band")||_.getInitialBand(x);if(C==null)return;let T=a.getIds().map(E=>a.getTileByID(E));for(let E of T)E.updateNeeded(x,C)&&_.prepareTile(E,x,C)}};class Xa{constructor(a,h,_,x){this.context=new nd(a,h),this.occlusionBuffers=new ve(this.context),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=t.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let C=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let T of C)this._debugParams.enabledLayers[T]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let T of C)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],T);this.symbolParams=new cc(x),this.setup(),this.numSublayers=t.bv.maxUnderzooming+t.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new t.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ep(this),this._wireframeDebugCache=new Hl,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(a,h){let _=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new np(this,a));let x=this._terrain;this.transform.elevation=_?x:null,x.update(a,this.transform,h),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(a){let h=a.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[_,x]=h.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);let C=_+.78*(x-_);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(a){a&&!this._terrain&&(this._terrain=new np(this,this.style)),this._forceTerrainMode=a}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(a,h){if(this.width=a*t.e.devicePixelRatio,this.height=h*t.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){let a=this.context,h=new t.bt;h.emplaceBack(0,0),h.emplaceBack(t.a3,0),h.emplaceBack(0,t.a3),h.emplaceBack(t.a3,t.a3),this.tileExtentBuffer=a.createVertexBuffer(h,t.br.members),this.tileExtentSegments=t.b.simpleSegment(0,0,4,2);let _=new t.bt;_.emplaceBack(0,0),_.emplaceBack(t.a3,0),_.emplaceBack(0,t.a3),_.emplaceBack(t.a3,t.a3),this.debugBuffer=a.createVertexBuffer(_,t.br.members),this.debugSegments=t.b.simpleSegment(0,0,4,5);let x=new t.bt;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(x,t.br.members),this.viewportSegments=t.b.simpleSegment(0,0,4,2);let C=new t.cp;C.emplaceBack(0,0,0,0),C.emplaceBack(t.a3,0,t.a3,0),C.emplaceBack(0,t.a3,0,t.a3),C.emplaceBack(t.a3,t.a3,t.a3,t.a3),this.mercatorBoundsBuffer=a.createVertexBuffer(C,t.cq.members),this.mercatorBoundsSegments=t.b.simpleSegment(0,0,4,2);let T=new t.bu;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(T);let E=new t.cr;for(let O of[0,1,3,2,0])E.emplaceBack(O);this.debugIndexBuffer=a.createIndexBuffer(E),this.emptyTexture=new t.T(a,new t.i({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=t.ad.create();let P=this.context.gl;this.stencilClearMode=new t.ag({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let a=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,a.TRIANGLES,t.ae.disabled,this.stencilClearMode,t.a.disabled,t.af.disabled,zh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,h,_){if(!h||this.currentStencilSource===h.id||!a.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(let P of _)if(this._tileClippingMaskIDs[P.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=h.id;let x=this.context,C=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(t.a.disabled),x.setDepthMode(t.ae.disabled);let T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let E of _){let P=h.getTile(E),O=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:j,tileBoundsSegments:G}=this.getTileBoundsBuffers(P);T.draw(this,C.TRIANGLES,t.ae.disabled,new t.ag({func:C.ALWAYS,mask:0},O,255,C.KEEP,C.KEEP,C.REPLACE),t.a.disabled,t.af.disabled,zh(E.projMatrix),"$clipping",B,j,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let a=this.nextStencilID++,h=this.context.gl;return new t.ag({func:h.NOTEQUAL,mask:255},a,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);let h=this.context.gl;return new t.ag({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(a){let h=this.context.gl,_=a.sort((T,E)=>E.overscaledZ-T.overscaledZ),x=_[_.length-1].overscaledZ,C=_[0].overscaledZ-x+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();let T={};for(let E=0;E<C;E++)T[E+x]=new t.ag({func:h.GEQUAL,mask:255},E+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[T,_]}return[{[x]:t.ag.disabled},_]}colorModeForRenderPass(){let a=this.context.gl;return this._showOverdrawInspector?new t.a([a.CONSTANT_COLOR,a.ONE,a.CONSTANT_COLOR,a.ONE],new t.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?t.a.unblended:t.a.alphaBlended}colorModeForDrapableLayerRenderPass(a){let h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new t.a([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new t.C(0,0,0,a===void 0?0:a),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(a,h,_,x=!1){if(this.depthOcclusion)return new t.ae(this.context.gl.GREATER,t.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return t.ae.disabled;let C=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new t.ae(_||this.context.gl.LEQUAL,h,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((a,h)=>a+h/this._fpsHistory.length,0))}render(a,h){let _=t.e.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=a.map.repaint,this.style=a,this.options=h;let x=this.style._mergedLayers,C=this.style.order.filter(me=>{let fe=x[me];return!(fe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[fe.type]}),T=C.map(me=>x[me]),E=this.style._mergedSourceCaches;this.imageManager=a.imageManager,this.modelManager=a.modelManager,this.symbolFadeChange=a.placement.symbolFadeChange(t.e.now()),this.imageManager.beginFrame();let P=0,O=!1;for(let me in E){let fe=E[me];fe.used&&(fe.prepare(this.context),fe.getSource().usedInConflation&&++P)}let B=!1;for(let me of T)me.isHidden(this.transform.zoom)||(me.type==="clip"&&(B=!0),this.prepareLayer(me));let j={},G={},q={},K={},J={};for(let me in E){let fe=E[me];j[me]=fe.getVisibleCoordinates(),G[me]=j[me].slice().reverse(),q[me]=fe.getVisibleCoordinates(!0).reverse(),K[me]=fe.getShadowCasterCoordinates(),J[me]=fe.sortCoordinatesByDistance(j[me])}let ee=me=>{let fe=this.style.getLayerSourceCache(me);return fe&&fe.used?fe.getSource():null};if(P||B){let me=[],fe=[],Ee=0;for(let We of T)this.isSourceForClippingOrConflation(We,ee(We))&&(me.push(We),fe.push(Ee)),Ee++;if(me&&(B||me.length>1)){let We=[];for(let ye=0;ye<me.length;ye++){let He=me[ye],qe=fe[ye],ct=this.style.getLayerSourceCache(He);if(!ct||!ct.used||!ct.getSource().usedInConflation&&He.type!=="clip")continue;let ut=1/0,lt=t.cu.None;if(He.type==="clip"){ut=qe;for(let Le of He.layout.get("clip-layer-types"))lt|=Le==="model"?t.cu.Model:Le==="symbol"?t.cu.Symbol:t.cu.FillExtrusion}We.push({layer:He.fqid,cache:ct,order:ut,clipMask:lt})}this.replacementSource.setSources(We),O=!0}}O||this.replacementSource.clear(),this.conflationActive=O,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let me=0;me<T.length;me++){let fe=T[me],Ee=fe.cutoffRange();if(this.longestCutoffRange=Math.max(Ee,this.longestCutoffRange),Ee>0){let We=ee(fe);We&&(this.minCutoffZoom=Math.max(We.minzoom,this.minCutoffZoom)),fe.minzoom&&(this.minCutoffZoom=Math.max(fe.minzoom,this.minCutoffZoom))}fe.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=me),this._lastOcclusionLayer=me)}let te=this.style&&this.style.fog;te?(this._fogVisible=te.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=te.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(q),this.opaquePassCutoff=0);let ue=this._shadowRenderer;if(ue){ue.updateShadowParameters(this.transform,this.style.directionalLight);for(let me in E)for(let fe of j[me]){let Ee={min:0,max:0};this.terrain&&(Ee=this.terrain.getMinMaxForTile(fe)||Ee),ue.addShadowReceiver(fe.toUnwrapped(),Ee.min,Ee.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new t.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Lf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!t.ct(this.context.gl))return;this.renderPass="offscreen";for(let me of T){let fe=a.getLayerSourceCache(me);if(!me.hasOffscreenPass()||me.isHidden(this.transform.zoom))continue;let Ee=fe?G[fe.id]:void 0;(me.type==="custom"||me.type==="raster"||me.type==="raster-particle"||me.isSky()||Ee&&Ee.length)&&this.renderLayer(this,fe,me,Ee)}this.depthRangeFor3D=[0,1-(T.length+2)*this.numSublayers*this.depthEpsilon];let ce=this.terrain;ce&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&ce.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,K)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let he=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ce=(()=>{if(h.showOverdrawInspector)return t.C.black;let me=this.style.fog;if(me&&this.transform.projection.supportsFog){let fe=this.style.getLut(me.scope);if(!he){let Ee=me.properties.get("color").toRenderColor(fe).toArray01();return new t.C(...Ee)}if(he){let Ee=me.properties.get("space-color").toRenderColor(fe).toArray01();return new t.C(...Ee)}}return t.C.transparent})();if(this.context.clear({color:Ce,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&he&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){let me=T[this.currentLayer],fe=a.getLayerSourceCache(me);if(me.isSky())continue;let Ee=fe?(me.is3D()?J:G)[fe.id]:void 0;this._renderTileClippingMasks(me,fe,Ee),this.renderLayer(this,fe,me,Ee)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&he&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||t.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){let me=T[this.currentLayer],fe=a.getLayerSourceCache(me);me.isSky()&&this.renderLayer(this,fe,me,fe?G[fe.id]:void 0)}function we(me,fe){let Ee;return fe&&(Ee=(me.type==="symbol"?q:me.is3D()?J:G)[fe.id]),Ee}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){let me=T[this.currentLayer];if(me.type==="raster"){let fe=a.getLayerSourceCache(me);this.renderLayer(this,fe,me,we(me,fe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let de=0;for(ue&&(de=ue.getShadowCastingLayerCount());this.currentLayer<C.length;){let me=T[this.currentLayer],fe=a.getLayerSourceCache(me);if(me.isSky())++this.currentLayer;else if(ce&&this.style.isLayerDraped(me)){if(me.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=ce.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(me.is3D()||this.terrain||this._renderTileClippingMasks(me,fe,fe?j[fe.id]:void 0),this.renderLayer(this,fe,me,we(me,fe)),!ce&&ue&&de>0&&me.hasShadowPass()&&--de==0&&(ue.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let Ee=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ee;this.currentLayer++){let We=T[this.currentLayer];if(!We.hasLightBeamPass())continue;let ye=a.getLayerSourceCache(We);this.renderLayer(this,ye,We,ye?G[ye.id]:void 0)}this.currentLayer=Ee,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let Ee=this.currentLayer;this.depthOcclusion=!0;for(let We of this.layersWithOcclusionOpacity){this.currentLayer=We;let ye=T[this.currentLayer],He=a.getLayerSourceCache(ye),qe=He?G[He.id]:void 0;ye.is3D()||this.terrain||this._renderTileClippingMasks(ye,He,He?j[He.id]:void 0),this.renderLayer(this,He,ye,qe)}this.depthOcclusion=!1,this.currentLayer=Ee,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let me=null;T.forEach(fe=>{let Ee=a.getLayerSourceCache(fe);Ee&&!fe.isHidden(this.transform.zoom)&&Ee.getVisibleCoordinates().length&&(!me||me.getSource().maxzoom<Ee.getSource().maxzoom)&&(me=Ee)}),me&&this.options.showTileBoundaries&&ua.debug(this,me,me.getVisibleCoordinates(),t.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ua.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new t.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(me){let fe=me.transform.padding;nn(me,me.transform.height-(fe.top||0),3,vc),nn(me,fe.bottom||0,3,Vl),rn(me,fe.left||0,3,Za),rn(me,me.transform.width-(fe.right||0),3,Ff);let Ee=me.transform.centerPoint;(function(We,ye,He,qe){oa(We,ye-1,He-10,2,20,qe),oa(We,ye-10,He-1,20,2,qe)})(me,Ee.x,me.transform.height-Ee.y,wu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),O||(this.conflationActive=!1)}prepareLayer(a){this.gpuTimingStart(a);let{unsupportedLayers:h}=this.transform.projection,_=!h||!h.includes(a.type);if(Gh[a.type]&&(_||this.terrain&&a.type==="custom")){let x=this.style.getLayerSourceCache(a);Gh[a.type](a,x,this)}this.gpuTimingEnd()}renderLayer(a,h,_,x){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||_.type==="raster-particle"||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(_.type)&&(!a.terrain||_.type!=="custom")||_.type==="clip"||ua[_.type](a,h,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;let h=this.context.extTimerQuery,_=this.context.gl,x=this.gpuTimers[a.id];x||(x=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:_.createQuery()}),x.calls++,_.beginQuery(h.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let a=this.context.extTimerQuery,h=this.context.gl,_=h.createQuery();this.deferredRenderGpuTimeQueries.push(_),h.beginQuery(a.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){let a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){let h={};for(let _ in a){let x=a[_],C=this.context.extTimerQuery,T=C.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;C.deleteQueryEXT(x.query),h[_]=T}return h}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;let h=this.context.extTimerQuery,_=this.context.gl,x=0;for(let C of a)x+=h.getQueryParameter(C,_.QUERY_RESULT)/1e6,h.deleteQueryEXT(C);return x}translatePosMatrix(a,h,_,x,C){if(!_[0]&&!_[1])return a;let T=C?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(T){let O=Math.sin(T),B=Math.cos(T);_=[_[0]*B-_[1]*O,_[0]*O+_[1]*B]}let E=[C?_[0]:t.bB(h,_[0],this.transform.zoom),C?_[1]:t.bB(h,_[1],this.transform.zoom),0],P=new Float32Array(16);return t.ad.translate(P,a,E),P}saveTileTexture(a){let h=a.size[0],_=this._tileTextures[h];_?_.push(a):this._tileTextures[h]=[a]}getTileTexture(a){let h=this._tileTextures[a];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(a,h,_){let x=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,C=[];return this.style&&this.style.enable3dLights()&&(a==="globeRaster"||a==="terrainRaster"?(C.push("LIGHTING_3D_MODE"),C.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||C.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||C.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?C.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):C.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(C.push("TERRAIN"),this.linearFloatFilteringSupported()&&C.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&C.push("GLOBE"),!this._fogVisible||x||h!==void 0&&!h||C.push("FOG","FOG_DITHERING"),x&&C.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&C.push("OVERDRAW_INSPECTOR"),C}getOrCreateProgram(a,h){this.cache=this.cache||{};let _=h&&h.defines||[],x=h&&h.config,C=this.currentGlobalDefines(a,h&&h.overrideFog,h&&h.overrideRtt).concat(_),T=pu.cacheKey(Qg[a],a,C,x);return this.cache[T]||(this.cache[T]=new pu(this.context,a,Qg[a],x,Do[a],C)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(a,h){if(this.style.enable3dLights()){let _=this.style.directionalLight,x=this.style.ambientLight;if(_&&x){let C=((T,E,P)=>{let O=T.properties.get("direction"),B=T.properties.get("color").toRenderColor(P.getLut(T.scope)).toArray01(),j=T.properties.get("intensity"),G=E.properties.get("color").toRenderColor(P.getLut(E.scope)).toArray01(),q=E.properties.get("intensity"),K=[O.x,O.y,O.z],J=t.bA(G,q),ee=t.bA(B,j);return{u_lighting_ambient_color:J,u_lighting_directional_dir:K,u_lighting_directional_color:ee,u_ground_radiance:fo(K,ee,J)}})(_,x,this.style);h.setLightsUniformValues(a,C)}}}uploadCommonUniforms(a,h,_,x,C){if(this.uploadCommonLightUniforms(a,h),this.terrain&&this.terrain.renderingToTexture)return;let T=this.style.fog;if(T){let E=T.getOpacity(this.transform.pitch),P=((O,B,j,G,q,K,J,ee,te,ue,ce,he)=>{let Ce=O.transform,we=B.properties.get("color").toRenderColor(O.style.getLut(B.scope)).toArray01();we[3]=G;let de=O.frameCounter/1e3%1,[me,fe]=B.properties.get("vertical-range");return{u_fog_matrix:j?Ce.calculateFogTileMatrix(j):he||O.identityMat,u_fog_range:B.getFovAdjustedRange(Ce._fov),u_fog_color:we,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(me,fe),fe],u_fog_temporal_offset:de,u_frustum_tl:q,u_frustum_tr:K,u_frustum_br:J,u_frustum_bl:ee,u_globe_pos:te,u_globe_radius:ue,u_viewport:ce,u_globe_transition:t.a1(Ce.zoom),u_is_globe:+(Ce.projection.name==="globe")}})(this,T,_,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.e.devicePixelRatio,this.transform.height*t.e.devicePixelRatio],x);h.setFogUniformValues(a,P)}C&&h.setCutoffUniformValues(a,C.uniformValues)}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){let a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){let a=this.context.gl,h=a.createTexture();return a.bindTexture(a.TEXTURE_2D,h),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let a=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(let x of _)h[x.key]=a[x.key]||new t.by(x,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(a,h){return!(!a.is3D()||a.minzoom&&a.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||a.sourceLayer!=="building")&&a.type!=="clip"&&(!h||h.type!=="batched-model"))}isTileAffectedByFog(a){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[a.key];return h||(this._cachedTileFogOpacities[a.key]=h=this.style.fog.getOpacityForTile(a)),h[0]>=_r||h[1]>=_r}}class Wi{constructor(a,h,_,x){this.screenBounds=a,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(a,h){let _,x;if(a instanceof t.P||typeof a[0]=="number"){let C=t.P.convert(a);_=[C],x=h.isPointAboveHorizon(C)}else{let C=t.P.convert(a[0]),T=t.P.convert(a[1]);_=[C,T],x=t.cv(C,T).every(E=>h.isPointAboveHorizon(E))}return new Wi(_,h.getCameraPoint(),x,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return t.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){let h=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],x=t.cv(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(x[3]=this.cameraPoint)),t.cw(x,a)}bufferedCameraGeometryGlobe(a){let h=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],x=t.cv(h,_,a),C=this.cameraPoint.clone();switch(3*((C.y>h.y)+(C.y>_.y))+((C.x>h.x)+(C.x>_.x))){case 0:x[0]=C,x[4]=C.clone();break;case 1:x.splice(1,0,C);break;case 2:x[1]=C;break;case 3:x.splice(4,0,C);break;case 5:x.splice(2,0,C);break;case 6:x[3]=C;break;case 7:x.splice(3,0,C);break;case 8:x[2]=C}return x}containsTile(a,h,_,x=0){let C=a.queryPadding/h._pixelsPerMercatorPixel+1,T=_?this._bufferedCameraMercator(C,h):this._bufferedScreenMercator(C,h),E=a.tileID.wrap+(T.unwrapped?x:0),P=T.polygon.map(ee=>t.cx(a.tileTransform,ee,E));if(!t.cy(P,0,0,t.a3,t.a3))return;E=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);let O=this.screenGeometryMercator.polygon.map(ee=>t.cz(a.tileTransform,ee,E)),B=O.map(ee=>new t.P(ee[0],ee[1])),j=h.getFreeCameraOptions().position||new t.Y(0,0,0),G=t.cz(a.tileTransform,j,E),q=O.map(ee=>{let te=t._.sub(ee,ee,G);return t._.normalize(te,te),new t.aT(G,te)}),K=t.bB(a,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:q,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(J=t.cA(P),J.min.x=t.at(J.min.x,0,t.a3),J.min.y=t.at(J.min.y,0,t.a3),J.max.x=t.at(J.max.x,0,t.a3),J.max.y=t.at(J.max.y,0,t.a3),J),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:K};var J}_bufferedScreenMercator(a,h){let _=Nf(a);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let x;return x=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),h):{polygon:this.bufferedScreenGeometry(a).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(a,h){let _=Nf(a);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let x;return x=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),h):{polygon:this.bufferedCameraGeometry(a).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[_]=x,x}}_projectAndResample(a,h){let _=function(C,T){let E=t.ad.multiply([],T.pixelMatrix,T.globeMatrix),P=[0,-t.cD,0,1],O=[0,t.cD,0,1],B=[0,0,0,1];t.aA.transformMat4(P,P,E),t.aA.transformMat4(O,O,E),t.aA.transformMat4(B,B,E);let j=new t.P(P[0]/P[3],P[1]/P[3]),G=new t.P(O[0]/O[3],O[1]/O[3]),q=t.cB(C,j)&&P[3]<B[3],K=t.cB(C,G)&&O[3]<B[3];if(!q&&!K)return null;let J=function(de,me,fe){for(let Ee=1;Ee<de.length;Ee++){let We=Sc(me.pointCoordinate3D(de[Ee-1]).x),ye=Sc(me.pointCoordinate3D(de[Ee]).x);if(fe<0){if(We<ye)return{idx:Ee,t:-We/(ye-1-We)}}else if(ye<We)return{idx:Ee,t:(1-We)/(ye+1-We)}}return null}(C,T,q?-1:1);if(!J)return null;let{idx:ee,t:te}=J,ue=ee>1?Bf(C.slice(0,ee),T):[],ce=ee<C.length?Bf(C.slice(ee),T):[];ue=ue.map(de=>new t.P(Sc(de.x),de.y)),ce=ce.map(de=>new t.P(Sc(de.x),de.y));let he=[...ue];he.length===0&&he.push(ce[ce.length-1]);let Ce=t.a2(he[he.length-1].y,(ce.length===0?ue[0]:ce[0]).y,te),we;return we=q?[new t.P(0,Ce),new t.P(0,0),new t.P(1,0),new t.P(1,Ce)]:[new t.P(1,Ce),new t.P(1,1),new t.P(0,1),new t.P(0,Ce)],he.push(...we),ce.length===0?he.push(ue[0]):he.push(...ce),{polygon:he.map(de=>new t.Y(de.x,de.y)),unwrapped:!1}}(a,h);if(_)return _;let x=function(C,T){let E=!1,P=-1/0,O=0;for(let j=0;j<C.length-1;j++)C[j].x>P&&(P=C[j].x,O=j);for(let j=0;j<C.length-1;j++){let G=(O+j)%(C.length-1),q=C[G],K=C[G+1];Math.abs(q.x-K.x)>.5&&(q.x<K.x?(q.x+=1,G===0&&(C[C.length-1].x+=1)):(K.x+=1,G+1===C.length-1&&(C[0].x+=1)),E=!0)}let B=t.aj(T.center.lng);return E&&B<Math.abs(B-1)&&C.forEach(j=>{j.x-=1}),{polygon:C,unwrapped:E}}(Bf(a,h).map(C=>new t.P(Sc(C.x),C.y)),h);return{polygon:x.polygon.map(C=>new t.Y(C.x,C.y)),unwrapped:x.unwrapped}}}function Bf(f,a){return t.cC(f,h=>{let _=a.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function Sc(f){return f<0?1+f%1:f%1}function Nf(f){return 100*f|0}function pd(f,a){let h=t.ad.identity([]);return t.ad.scale(h,h,[.5*f.width,.5*-f.height,1]),t.ad.translate(h,h,[1,-1,0]),t.ad.multiply(h,h,f.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(h)}function cb(f,a,h,_,x,C,T,E=!1){let P=f.tilesIn(_,T,E);P.sort(Mu);let O=[];for(let j of P)O.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(a,h,f._state,j,x,C,pd(f.transform,j.tile.tileID),E)});let B=function(j){let G={},q={};for(let K of j){let J=K.queryResults,ee=K.wrappedTileID,te=q[ee]=q[ee]||{};for(let ue in J){let ce=J[ue],he=te[ue]=te[ue]||{},Ce=G[ue]=G[ue]||[];for(let we of ce)he[we.featureIndex]||(he[we.featureIndex]=!0,Ce.push(we))}}return G}(O);for(let j in B)B[j].forEach(G=>{let q=G.feature,K=q.layer;K&&K.type!=="background"&&K.type!=="sky"&&K.type!=="slot"&&(q.source=K.source,K["source-layer"]&&(q.sourceLayer=K["source-layer"]),q.state=q.id!==void 0?f.getFeatureState(K["source-layer"],q.id):{})});return B}function qh(f,a){let h=f.getRenderableIds().map(C=>f.getTileByID(C)),_=[],x={};for(let C=0;C<h.length;C++){let T=h[C],E=T.tileID.canonical.key;x[E]||(x[E]=!0,T.querySourceFeatures(_,a))}return _}function Mu(f,a){let h=f.tileID,_=a.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}class db{constructor(a){this.style=a,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let a=!1,h=!1;for(let _ in this.style._mergedLayers){let x=this.style._mergedLayers[_];if(x.type==="fill-extrusion")this.layers.push({layer:x,visible:a,visibilityChanged:h});else if(x.type==="model"){let C=this.style.getLayerSource(x);C&&C.type==="batched-model"&&this.layers.push({layer:x,visible:a,visibilityChanged:h})}}}onNewFrame(a){this.layersGotHidden=!1;for(let h of this.layers){let _=h.layer,x=!1;_.type==="fill-extrusion"?x=!_.isHidden(a)&&_.paint.get("fill-extrusion-opacity")>0:_.type==="model"&&(x=!_.isHidden(a)&&_.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!x&&h.visible,h.visible=x}}updateZOffset(a,h){this.currentBuildingBuckets=[];for(let x of this.layers){let C=x.layer,T=this.style.getLayerSourceCache(C),E=1;C.type==="fill-extrusion"&&(E=x.visible?C.paint.get("fill-extrusion-vertical-scale"):0);let P=T?T.getTile(h):null;if(!P&&T&&h.canonical.z>T.getSource().minzoom){let O=h.scaledTo(Math.min(T.getSource().maxzoom,h.overscaledZ-1));for(;O.overscaledZ>=T.getSource().minzoom&&(P=T.getTile(O),!P&&O.overscaledZ!==0);)O=O.scaledTo(O.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:P?P.getBucket(C):null,tileID:P?P.tileID:h,verticalScale:E})}a.hasAnyZOffset=!1;let _=!1;for(let x=0;x<a.symbolInstances.length;x++){let C=a.symbolInstances.get(x),T=C.zOffset,E=this._getHeightAtTileOffset(h,C.tileAnchorX,C.tileAnchorY);C.zOffset=E!==Number.NEGATIVE_INFINITY?E:T,_||T===C.zOffset||(_=!0),a.hasAnyZOffset||C.zOffset===0||(a.hasAnyZOffset=!0)}_&&(a.zOffsetBuffersNeedUpload=!0,a.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(a,h,_,x){let C=h,T=_;if(a.canonical.z!==x.canonical.z){let E=x.canonical,P=1/(1<<a.canonical.z-E.z);C=(h+a.canonical.x*t.a3)*P-E.x*t.a3|0,T=(_+a.canonical.y*t.a3)*P-E.y*t.a3|0}return{tileX:C,tileY:T}}_getHeightAtTileOffset(a,h,_){let x,C;for(let T=0;T<this.layers.length;++T){if(this.layers[T].layer.type!=="fill-extrusion")continue;let{bucket:E,tileID:P,verticalScale:O}=this.currentBuildingBuckets[T];if(!E)continue;let{tileX:B,tileY:j}=this._mapCoordToOverlappingTile(a,h,_,P),G=E.getHeightAtTileCoord(B,j);G&&G.height!==void 0&&(G.hidden?x=G.height:C=Math.max(G.height*O,C||0))}if(C!==void 0)return C;for(let T=0;T<this.layers.length;++T){let E=this.layers[T];if(E.layer.type!=="model"||!E.visible)continue;let{bucket:P,tileID:O}=this.currentBuildingBuckets[T];if(!P)continue;let{tileX:B,tileY:j}=this._mapCoordToOverlappingTile(a,h,_,O),G=P.getHeightAtTileCoord(B,j);if(G&&!G.hidden)return G.height===void 0&&x!==void 0?Math.min(G.maxHeight,x)*G.verticalScale:G.height?G.height*G.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ku(f,a){let h={};for(let _ in f)_!=="ref"&&(h[_]=f[_]);return t.cE.forEach(_=>{_ in a&&(h[_]=a[_])}),h}function Ns(f){f=f.slice();let a=Object.create(null);for(let h=0;h<f.length;h++)a[f[h].id]=f[h];for(let h=0;h<f.length;h++)"ref"in f[h]&&(f[h]=ku(f[h],a[f[h].ref]));return f}let cn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Gl(f,a,h){h.push({command:cn.addSource,args:[f,a[f]]})}function i_(f,a,h){a.push({command:cn.removeSource,args:[f]}),h[f]=!0}function ub(f,a,h,_){i_(f,h,_),Gl(f,a,h)}function hb(f,a,h){let _;for(_ in f[h])if(f[h].hasOwnProperty(_)&&_!=="data"&&!g(f[h][_],a[h][_]))return!1;for(_ in a[h])if(a[h].hasOwnProperty(_)&&_!=="data"&&!g(f[h][_],a[h][_]))return!1;return!0}function Qa(f,a,h,_,x,C){let T;for(T in a=a||{},f=f||{})f.hasOwnProperty(T)&&(g(f[T],a[T])||h.push({command:C,args:[_,T,a[T],x]}));for(T in a)a.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(g(f[T],a[T])||h.push({command:C,args:[_,T,a[T],x]}))}function up(f){return f.id}function Eu(f,a){return f[a.id]=a,f}class n_{constructor(a,h){this.reset(a,h)}reset(a,h){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=t.at(a,0,1);let h=1,_=this._distances[h],x=a*this.paddedLength+this.padding;for(;_<x&&h<this._distances.length;)_=this._distances[++h];let C=h-1,T=this._distances[C],E=_-T,P=E>0?(x-T)/E:0;return this.points[C].mult(1-P).add(this.points[h].mult(P))}}class Vf{constructor(a,h,_){let x=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(h/_);for(let T=0;T<this.xCellCount*this.yCellCount;T++)x.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=h,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,h,_,x,C){this._forEachCell(h,_,x,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(C)}insertCircle(a,h,_,x){this._forEachCell(h-x,_-x,h+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(h),this.circles.push(_),this.circles.push(x)}_insertBoxCell(a,h,_,x,C,T){this.boxCells[C].push(T)}_insertCircleCell(a,h,_,x,C,T){this.circleCells[C].push(T)}_query(a,h,_,x,C,T){if(_<0||a>this.width||x<0||h>this.height)return!C&&[];let E=[];if(a<=0&&h<=0&&this.width<=_&&this.height<=x){if(C)return!0;for(let P=0;P<this.boxKeys.length;P++)E.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){let O=this.circles[3*P],B=this.circles[3*P+1],j=this.circles[3*P+2];E.push({key:this.circleKeys[P],x1:O-j,y1:B-j,x2:O+j,y2:B+j})}return T?E.filter(T):E}return this._forEachCell(a,h,_,x,this._queryCell,E,{hitTest:C,seenUids:{box:{},circle:{}}},T),C?E.length>0:E}_queryCircle(a,h,_,x,C){let T=a-_,E=a+_,P=h-_,O=h+_;if(E<0||T>this.width||O<0||P>this.height)return!x&&[];let B=[];return this._forEachCell(T,P,E,O,this._queryCellCircle,B,{hitTest:x,circle:{x:a,y:h,radius:_},seenUids:{box:{},circle:{}}},C),x?B.length>0:B}query(a,h,_,x,C){return this._query(a,h,_,x,!1,C)}hitTest(a,h,_,x,C){return this._query(a,h,_,x,!0,C)}hitTestCircle(a,h,_,x){return this._queryCircle(a,h,_,!0,x)}_queryCell(a,h,_,x,C,T,E,P){let O=E.seenUids,B=this.boxCells[C];if(B!==null){let G=this.bboxes;for(let q of B)if(!O.box[q]){O.box[q]=!0;let K=4*q;if(a<=G[K+2]&&h<=G[K+3]&&_>=G[K+0]&&x>=G[K+1]&&(!P||P(this.boxKeys[q]))){if(E.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[q],x1:G[K],y1:G[K+1],x2:G[K+2],y2:G[K+3]})}}}let j=this.circleCells[C];if(j!==null){let G=this.circles;for(let q of j)if(!O.circle[q]){O.circle[q]=!0;let K=3*q;if(this._circleAndRectCollide(G[K],G[K+1],G[K+2],a,h,_,x)&&(!P||P(this.circleKeys[q]))){if(E.hitTest)return T.push(!0),!0;{let J=G[K],ee=G[K+1],te=G[K+2];T.push({key:this.circleKeys[q],x1:J-te,y1:ee-te,x2:J+te,y2:ee+te})}}}}}_queryCellCircle(a,h,_,x,C,T,E,P){let O=E.circle,B=E.seenUids,j=this.boxCells[C];if(j!==null){let q=this.bboxes;for(let K of j)if(!B.box[K]){B.box[K]=!0;let J=4*K;if(this._circleAndRectCollide(O.x,O.y,O.radius,q[J+0],q[J+1],q[J+2],q[J+3])&&(!P||P(this.boxKeys[K])))return T.push(!0),!0}}let G=this.circleCells[C];if(G!==null){let q=this.circles;for(let K of G)if(!B.circle[K]){B.circle[K]=!0;let J=3*K;if(this._circlesCollide(q[J],q[J+1],q[J+2],O.x,O.y,O.radius)&&(!P||P(this.circleKeys[K])))return T.push(!0),!0}}}_forEachCell(a,h,_,x,C,T,E,P){let O=this._convertToXCellCoord(a),B=this._convertToYCellCoord(h),j=this._convertToXCellCoord(_),G=this._convertToYCellCoord(x);for(let q=O;q<=j;q++)for(let K=B;K<=G;K++)if(C.call(this,a,h,_,x,this.xCellCount*K+q,T,E,P))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,h,_,x,C,T){let E=x-a,P=C-h,O=_+T;return O*O>E*E+P*P}_circleAndRectCollide(a,h,_,x,C,T,E){let P=(T-x)/2,O=Math.abs(a-(x+P));if(O>P+_)return!1;let B=(E-C)/2,j=Math.abs(h-(C+B));if(j>B+_)return!1;if(O<=P||j<=B)return!0;let G=O-P,q=j-B;return G*G+q*q<=_*_}}let Vs=100;class Ic{constructor(a,h,_=new Vf(a.width+200,a.height+200,25),x=new Vf(a.width+200,a.height+200,25)){this.transform=a,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Vs,this.screenBottomBoundary=a.height+Vs,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=h}placeCollisionBox(a,h,_,x,C,T,E,P){let O=_.projectedAnchorX,B=_.projectedAnchorY,j=_.projectedAnchorZ,G=_.elevation,q=_.tileID,K=a.getProjection();if(G&&q){let[we,de,me]=K.upVector(q.canonical,_.tileAnchorX,_.tileAnchorY),fe=K.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=we*G*fe,B+=de*G*fe,j+=me*G*fe}let J=this.projectAndGetPerspectiveRatio(E,O,B,j,_.tileID,K.name==="globe"||!!G||this.transform.pitch>0,K),ee=T*J.perspectiveRatio,te=(_.x1*h+x.x-_.padding)*ee+J.point.x,ue=(_.y1*h+x.y-_.padding)*ee+J.point.y,ce=(_.x2*h+x.x+_.padding)*ee+J.point.x,he=(_.y2*h+x.y+_.padding)*ee+J.point.y,Ce=J.perspectiveRatio<=.55||J.occluded;return!this.isInsideGrid(te,ue,ce,he)||!C&&this.grid.hitTest(te,ue,ce,he,P)||Ce?{box:[],offscreen:!1,occluded:J.occluded}:{box:[te,ue,ce,he],offscreen:this.isOffscreen(te,ue,ce,he),occluded:!1}}placeCollisionCircles(a,h,_,x,C,T,E,P,O,B,j,G,q,K,J){let ee=[],te=this.transform.elevation,ue=a.getProjection(),ce=te?te.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,ue):null,he=new t.P(_.tileAnchorX,_.tileAnchorY),{x:Ce,y:we,z:de}=ue.projectTilePoint(he.x,he.y,J.canonical);if(ce){let[lt,Le,Ze]=ce(he);Ce+=lt,we+=Le,de+=Ze}let me=ue.name==="globe",fe=this.projectAndGetPerspectiveRatio(E,Ce,we,de,J,me||!!te||this.transform.pitch>0,ue),{perspectiveRatio:Ee}=fe,We=(j?T/Ee:T*Ee)/t.bN,ye=Ya(Ce,we,de,P),He=fe.signedDistanceFromCamera>0?Ah(We,C,_.lineOffsetX*We,_.lineOffsetY*We,!1,ye,he,_,x,P,{},te&&!j?ce:null,j&&!!te,ue,J,j):null,qe=!1,ct=!1,ut=!0;if(He&&!fe.occluded){let lt=.5*q*Ee+K,Le=new t.P(-100,-100),Ze=new t.P(this.screenRightBoundary,this.screenBottomBoundary),rt=new n_,{first:Ot,last:Rt}=He,Wt=Ot.path.length,Ft=[];for(let $t=Wt-1;$t>=1;$t--)Ft.push(Ot.path[$t]);for(let $t=1;$t<Rt.path.length;$t++)Ft.push(Rt.path[$t]);let pt=2.5*lt;O&&(Ft=Ft.map(([$t,Ii,bi],Fi)=>(ce&&!me&&(bi=ce(Fi<Wt-1?Ot.tilePath[Wt-1-Fi]:Rt.tilePath[Fi-Wt+2])[2]),Ya($t,Ii,bi,O))),Ft.some($t=>$t[3]<=0)&&(Ft=[]));let nt=[];if(Ft.length>0){let $t=1/0,Ii=-1/0,bi=1/0,Fi=-1/0;for(let Gi of Ft)$t=Math.min($t,Gi[0]),bi=Math.min(bi,Gi[1]),Ii=Math.max(Ii,Gi[0]),Fi=Math.max(Fi,Gi[1]);Ii>=Le.x&&$t<=Ze.x&&Fi>=Le.y&&bi<=Ze.y&&(nt=[Ft.map(Gi=>new t.P(Gi[0],Gi[1]))],($t<Le.x||Ii>Ze.x||bi<Le.y||Fi>Ze.y)&&(nt=t.cF(nt,Le.x,Le.y,Ze.x,Ze.y)))}for(let $t of nt){rt.reset($t,.25*lt);let Ii=0;Ii=rt.length<=.5*lt?1:Math.ceil(rt.paddedLength/pt)+1;for(let bi=0;bi<Ii;bi++){let Fi=bi/Math.max(Ii-1,1),Gi=rt.lerp(Fi),yn=Gi.x+Vs,Vt=Gi.y+Vs;ee.push(yn,Vt,lt,0);let pn=yn-lt,Nn=Vt-lt,dn=yn+lt,qi=Vt+lt;if(ut=ut&&this.isOffscreen(pn,Nn,dn,qi),ct=ct||this.isInsideGrid(pn,Nn,dn,qi),!h&&this.grid.hitTestCircle(yn,Vt,lt,G)&&(qe=!0,!B))return{circles:[],offscreen:!1,collisionDetected:qe,occluded:!1}}}}return{circles:!B&&qe||!ct?[]:ee,offscreen:ut,collisionDetected:qe,occluded:fe.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let h=[],_=1/0,x=1/0,C=-1/0,T=-1/0;for(let B of a){let j=new t.P(B.x+Vs,B.y+Vs);_=Math.min(_,j.x),x=Math.min(x,j.y),C=Math.max(C,j.x),T=Math.max(T,j.y),h.push(j)}let E=this.grid.query(_,x,C,T).concat(this.ignoredGrid.query(_,x,C,T)),P={},O={};for(let B of E){let j=B.key;if(P[j.bucketInstanceId]===void 0&&(P[j.bucketInstanceId]={}),P[j.bucketInstanceId][j.featureIndex])continue;let G=[new t.P(B.x1,B.y1),new t.P(B.x2,B.y1),new t.P(B.x2,B.y2),new t.P(B.x1,B.y2)];t.cG(h,G)&&(P[j.bucketInstanceId][j.featureIndex]=!0,O[j.bucketInstanceId]===void 0&&(O[j.bucketInstanceId]=[]),O[j.bucketInstanceId].push(j.featureIndex))}return O}insertCollisionBox(a,h,_,x,C){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:C},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,h,_,x,C){let T=h?this.ignoredGrid:this.grid,E={bucketInstanceId:_,featureIndex:x,collisionGroupID:C};for(let P=0;P<a.length;P+=4)T.insertCircle(E,a[P],a[P+1],a[P+2])}projectAndGetPerspectiveRatio(a,h,_,x,C,T,E){let P=[h,_,x,1],O=!1;x||this.transform.pitch>0?(t.aA.transformMat4(P,P,a),this.fogState&&C&&E.name!=="globe"&&(O=function(G,q,K,J,ee,te){let ue=te.calculateFogTileMatrix(ee),ce=[q,K,J];return t._.transformMat4(ce,ce,ue),Jr(G,t._.length(ce),te.pitch,te._fov)}(this.fogState,h,_,x,C.toUnwrapped(),this.transform)>.9)):po(P,P,a);let B=P[3];return{point:new t.P((P[0]/B+1)/2*this.transform.width+Vs,(-P[1]/B+1)/2*this.transform.height+Vs),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/B*.5,1.5),signedDistanceFromCamera:B,occluded:T&&P[2]>B||O}}isOffscreen(a,h,_,x){return _<Vs||a>=this.screenRightBoundary||x<Vs||h>this.screenBottomBoundary}isInsideGrid(a,h,_,x){return _>=0&&a<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){let a=t.ad.identity([]);return t.ad.translate(a,a,[-100,-100,0]),a}}class Tc{constructor(a,h,_,x){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?h:-h))):x&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Mc{constructor(a,h,_,x,C,T=!1){this.text=new Tc(a?a.text:null,h,_,C),this.icon=new Tc(a?a.icon:null,h,x,C),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class za{constructor(a,h,_,x=!1){this.text=a,this.icon=h,this.skipFade=_,this.clipped=x}}class r_{constructor(){this.invProjMatrix=t.ad.create(),this.viewportMatrix=t.ad.create(),this.circles=[]}}class $h{constructor(a,h,_,x,C){this.bucketInstanceId=a,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=C}}class Yh{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){let h=++this.maxGroupID;this.collisionGroups[a]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[a]}}function jf(f,a,h,_,x){let{horizontalAlign:C,verticalAlign:T}=t.bQ(f),E=-(C-.5)*a,P=-(T-.5)*h,O=t.bP(f,_);return new t.P(E+O[0]*x,P+O[1]*x)}function Zh(f,a,h,_,x){let C=new t.P(f,a);return h&&C._rotate(_?x:-x),C}class Ka{constructor(a,h,_,x,C,T){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new Ic(this.transform,C),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Yh(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,h,_,x){let C=_.getBucket(h),T=_.latestFeatureIndex;if(!C||!T||h.fqid!==C.layerIds[0])return;let E=C.layers[0].layout,P=_.collisionBoxArray,O=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),B=_.tileSize/t.a3,j=_.tileID.toUnwrapped();this.transform.setProjection(C.projection);let G=(q=_.tileID,K=C.getProjection(),J=this.transform,K.name===this.projection?J.calculateProjMatrix(q.toUnwrapped()):cr(J,K,q));var q,K,J;let ee=E.get("text-pitch-alignment")==="map",te=E.get("text-rotation-alignment")==="map";h.compileFilter();let ue=h.dynamicFilter(),ce=h.dynamicFilterNeedsFeature(),he=this.transform.calculatePixelsToTileUnitsMatrix(_),Ce=Ll(G,_.tileID.canonical,ee,te,this.transform,C.getProjection(),he),we=null;if(ee){let fe=ps(G,_.tileID.canonical,ee,te,this.transform,C.getProjection(),he);we=t.ad.multiply([],this.transform.labelPlaneMatrix,fe)}let de=null;ue&&_.latestFeatureIndex&&(de={unwrappedTileID:j,dynamicFilter:ue,dynamicFilterNeedsFeature:ce,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new $h(C.bucketInstanceId,T,C.sourceLayerIndex,C.index,_.tileID);let me={bucket:C,layout:E,posMatrix:G,textLabelPlaneMatrix:Ce,labelToScreenMatrix:we,clippingData:de,scale:O,textPixelRatio:B,holdingForFade:_.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:t.aD(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.aD(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(x)for(let fe of C.sortKeyRanges){let{sortKey:Ee,symbolInstanceStart:We,symbolInstanceEnd:ye}=fe;a.push({sortKey:Ee,symbolInstanceStart:We,symbolInstanceEnd:ye,parameters:me})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:me})}attemptAnchorPlacement(a,h,_,x,C,T,E,P,O,B,j,G,q,K,J,ee,te,ue){let{textOffset0:ce,textOffset1:he,crossTileID:Ce}=G,we=[ce,he],de=jf(a,_,x,we,C),me=this.collisionIndex.placeCollisionBox(K,C,h,Zh(de.x,de.y,T,E,this.transform.angle),j,P,O,B.predicate);if(ee){let fe=K.getSymbolInstanceIconSize(ue,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(K,fe,ee,Zh(de.x,de.y,T,E,this.transform.angle),j,P,O,B.predicate).box.length===0)return}if(me.box.length>0){let fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ce]&&this.prevPlacement.placements[Ce]&&this.prevPlacement.placements[Ce].text&&(fe=this.prevPlacement.variableOffsets[Ce].anchor),this.variableOffsets[Ce]={textOffset:we,width:_,height:x,anchor:a,textScale:C,prevAnchor:fe},this.markUsedJustification(K,a,G,J),K.allowVerticalPlacement&&(this.markUsedOrientation(K,J,G),this.placedOrientations[Ce]=J),{shift:de,placedGlyphBoxes:me}}}placeLayerBucketPart(a,h,_,x){let{bucket:C,layout:T,posMatrix:E,textLabelPlaneMatrix:P,labelToScreenMatrix:O,clippingData:B,textPixelRatio:j,holdingForFade:G,collisionBoxArray:q,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:J,collisionGroup:ee}=a.parameters,te=T.get("text-optional"),ue=T.get("icon-optional"),ce=T.get("text-allow-overlap"),he=T.get("icon-allow-overlap"),Ce=T.get("text-rotation-alignment")==="map",we=T.get("text-pitch-alignment")==="map",de=T.get("symbol-z-order")==="viewport-y",me=T.get("symbol-z-elevate");this.transform.setProjection(C.projection);let fe=ce&&(he||!C.hasIconData()||ue),Ee=he&&(ce||!C.hasTextData()||te);!C.collisionArrays&&q&&C.deserializeCollisionBoxes(q),_&&x&&C.updateCollisionDebugBuffers(this.transform.zoom,q);let We=(ye,He,qe)=>{let{crossTileID:ct,numVerticalGlyphVertices:ut}=ye;if(B){let dn={zoom:this.transform.zoom,pitch:this.transform.pitch},qi=null;if(B.dynamicFilterNeedsFeature){let xi=this.retainedQueryData[C.bucketInstanceId];qi=B.featureIndex.loadFeature({featureIndex:ye.featureIndex,bucketIndex:xi.bucketIndex,sourceLayerIndex:xi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,B.dynamicFilter)(dn,qi,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new t.P(ye.tileAnchorX,ye.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[ct]=new za(!1,!1,!1,!0),void h.add(ct)}if(h.has(ct))return;if(G)return void(this.placements[ct]=new za(!1,!1,!1));let lt=!1,Le=!1,Ze=!0,rt=!1,Ot=!1,Rt=null,Wt={box:null,offscreen:null,occluded:null},Ft={box:null,offscreen:null,occluded:null},pt=null,nt=null,$t=null,Ii=0,bi=0,Fi=0;qe.textFeatureIndex?Ii=qe.textFeatureIndex:ye.useRuntimeCollisionCircles&&(Ii=ye.featureIndex),qe.verticalTextFeatureIndex&&(bi=qe.verticalTextFeatureIndex);let Gi=dn=>{dn.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;let qi=this.transform.elevation;dn.elevation=ye.zOffset+(qi?qi.getAtTileOffset(dn.tileID,dn.tileAnchorX,dn.tileAnchorY):0)},yn=qe.textBox;if(yn){Gi(yn);let dn=xi=>{let Xn=t.aE.horizontal;if(C.allowVerticalPlacement&&!xi&&this.prevPlacement){let on=this.prevPlacement.placedOrientations[ct];on&&(this.placedOrientations[ct]=on,Xn=on,this.markUsedOrientation(C,Xn,ye))}return Xn},qi=(xi,Xn)=>{if(C.allowVerticalPlacement&&ut>0&&qe.verticalTextBox){for(let on of C.writingModes)if(on===t.aE.vertical?(Wt=Xn(),Ft=Wt):Wt=xi(),Wt&&Wt.box&&Wt.box.length)break}else Wt=xi()};if(T.get("text-variable-anchor")){let xi=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ct]){let Fn=this.prevPlacement.variableOffsets[ct];xi.indexOf(Fn.anchor)>0&&(xi=xi.filter(dt=>dt!==Fn.anchor),xi.unshift(Fn.anchor))}let Xn=(Fn,dt,Lt)=>{let Sr=C.getSymbolInstanceTextSize(K,ye,this.transform.zoom,He),vn=(Fn.x2-Fn.x1)*Sr+2*Fn.padding,Ue=(Fn.y2-Fn.y1)*Sr+2*Fn.padding,Ja=ye.hasIconTextFit&&!he?dt:null;Ja&&Gi(Ja);let qo={box:[],offscreen:!1,occluded:!1},Zr=ce?2*xi.length:xi.length;for(let Gn=0;Gn<Zr;++Gn){let sa=this.attemptAnchorPlacement(xi[Gn%xi.length],Fn,vn,Ue,Sr,Ce,we,j,E,ee,Gn>=xi.length,ye,He,C,Lt,Ja,K,J);if(sa&&(qo=sa.placedGlyphBoxes,qo&&qo.box&&qo.box.length)){lt=!0,Rt=sa.shift;break}}return qo};qi(()=>Xn(yn,qe.iconBox,t.aE.horizontal),()=>{let Fn=qe.verticalTextBox;return Fn&&Gi(Fn),C.allowVerticalPlacement&&!(Wt&&Wt.box&&Wt.box.length)&&ut>0&&Fn?Xn(Fn,qe.verticalIconBox,t.aE.vertical):{box:null,offscreen:null,occluded:null}}),Wt&&(lt=Wt.box,Ze=Wt.offscreen,rt=Wt.occluded);let on=dn(!(!Wt||!Wt.box));if(!lt&&this.prevPlacement){let Fn=this.prevPlacement.variableOffsets[ct];Fn&&(this.variableOffsets[ct]=Fn,this.markUsedJustification(C,Fn.anchor,ye,on))}}else{let xi=(Xn,on)=>{let Fn=C.getSymbolInstanceTextSize(K,ye,this.transform.zoom,He),dt=this.collisionIndex.placeCollisionBox(C,Fn,Xn,new t.P(0,0),ce,j,E,ee.predicate);return dt&&dt.box&&dt.box.length&&(this.markUsedOrientation(C,on,ye),this.placedOrientations[ct]=on),dt};qi(()=>xi(yn,t.aE.horizontal),()=>{let Xn=qe.verticalTextBox;return C.allowVerticalPlacement&&ut>0&&Xn?(Gi(Xn),xi(Xn,t.aE.vertical)):{box:null,offscreen:null,occluded:null}}),dn(!!(Wt&&Wt.box&&Wt.box.length))}}if(pt=Wt,lt=pt&&pt.box&&pt.box.length>0,Ze=pt&&pt.offscreen,rt=pt&&pt.occluded,ye.useRuntimeCollisionCircles){let dn=C.text.placedSymbolArray.get(ye.centerJustifiedTextSymbolIndex>=0?ye.centerJustifiedTextSymbolIndex:ye.verticalPlacedTextSymbolIndex),qi=t.aF(C.textSizeData,K,dn),xi=T.get("text-padding");nt=this.collisionIndex.placeCollisionCircles(C,ce,dn,C.lineVertexArray,C.glyphOffsetArray,qi,E,P,O,_,we,ee.predicate,ye.collisionCircleDiameter*qi/t.bN,xi,this.retainedQueryData[C.bucketInstanceId].tileID),lt=ce||nt.circles.length>0&&!nt.collisionDetected,Ze=Ze&&nt.offscreen,rt=nt.occluded}if(qe.iconFeatureIndex&&(Fi=qe.iconFeatureIndex),qe.iconBox){let dn=qi=>{Gi(qi);let xi=ye.hasIconTextFit&&Rt?Zh(Rt.x,Rt.y,Ce,we,this.transform.angle):new t.P(0,0),Xn=C.getSymbolInstanceIconSize(J,this.transform.zoom,ye.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,Xn,qi,xi,he,j,E,ee.predicate)};Ft&&Ft.box&&Ft.box.length&&qe.verticalIconBox?($t=dn(qe.verticalIconBox),Le=$t.box.length>0):($t=dn(qe.iconBox),Le=$t.box.length>0),Ze=Ze&&$t.offscreen,Ot=$t.occluded}let Vt=te||ye.numHorizontalGlyphVertices===0&&ut===0,pn=ue||ye.numIconVertices===0;if(Vt||pn?pn?Vt||(Le=Le&&lt):lt=Le&&lt:Le=lt=Le&&lt,lt&&pt&&pt.box&&this.collisionIndex.insertCollisionBox(pt.box,T.get("text-ignore-placement"),C.bucketInstanceId,Ft&&Ft.box&&bi?bi:Ii,ee.ID),Le&&$t&&this.collisionIndex.insertCollisionBox($t.box,T.get("icon-ignore-placement"),C.bucketInstanceId,Fi,ee.ID),nt&&(lt&&this.collisionIndex.insertCollisionCircles(nt.circles,T.get("text-ignore-placement"),C.bucketInstanceId,Ii,ee.ID),_)){let dn=C.bucketInstanceId,qi=this.collisionCircleArrays[dn];qi===void 0&&(qi=this.collisionCircleArrays[dn]=new r_);for(let xi=0;xi<nt.circles.length;xi+=4)qi.circles.push(nt.circles[xi+0]),qi.circles.push(nt.circles[xi+1]),qi.circles.push(nt.circles[xi+2]),qi.circles.push(nt.collisionDetected?1:0)}let Nn=C.projection.name!=="globe";fe=fe&&(Nn||!rt),Ee=Ee&&(Nn||!Ot),this.placements[ct]=new za(lt||fe,Le||Ee,Ze||C.justReloaded),h.add(ct)};if(me&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,this.retainedQueryData[C.bucketInstanceId].tileID),C.updateZOffset()),de){let ye=C.getSortedSymbolIndexes(this.transform.angle);for(let He=ye.length-1;He>=0;--He){let qe=ye[He];We(C.symbolInstances.get(qe),qe,C.collisionArrays[qe])}C.hasAnyZOffset&&t.w(`${C.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(C.hasAnyZOffset){let ye=C.getSortedIndexesByZOffset();for(let He=0;He<ye.length;++He){let qe=ye[He];We(C.symbolInstances.get(qe),qe,C.collisionArrays[qe])}}else for(let ye=a.symbolInstanceStart;ye<a.symbolInstanceEnd;ye++)We(C.symbolInstances.get(ye),ye,C.collisionArrays[ye]);if(_&&C.bucketInstanceId in this.collisionCircleArrays){let ye=this.collisionCircleArrays[C.bucketInstanceId];t.ad.invert(ye.invProjMatrix,E),ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(a,h,_,x){let{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:P,crossTileID:O}=_,B=t.cJ(h),j=x===t.aE.vertical?P:B==="left"?C:B==="center"?T:B==="right"?E:-1;C>=0&&(a.text.placedSymbolArray.get(C).crossTileID=j>=0&&C!==j?0:O),T>=0&&(a.text.placedSymbolArray.get(T).crossTileID=j>=0&&T!==j?0:O),E>=0&&(a.text.placedSymbolArray.get(E).crossTileID=j>=0&&E!==j?0:O),P>=0&&(a.text.placedSymbolArray.get(P).crossTileID=j>=0&&P!==j?0:O)}markUsedOrientation(a,h,_){let x=h===t.aE.horizontal||h===t.aE.horizontalOnly?h:0,C=h===t.aE.vertical?h:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:O}=_,B=a.text.placedSymbolArray;T>=0&&(B.get(T).placedOrientation=x),E>=0&&(B.get(E).placedOrientation=x),P>=0&&(B.get(P).placedOrientation=x),O>=0&&(B.get(O).placedOrientation=C)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;let h=this.prevPlacement,_=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;let x=h?h.symbolFadeChange(a):1,C=h?h.opacities:{},T=h?h.variableOffsets:{},E=h?h.placedOrientations:{};for(let P in this.placements){let O=this.placements[P],B=C[P];B?(this.opacities[P]=new Mc(B,x,O.text,O.icon,null,O.clipped),_=_||O.text!==B.text.placed||O.icon!==B.icon.placed):(this.opacities[P]=new Mc(null,x,O.text,O.icon,O.skipFade,O.clipped),_=_||O.text||O.icon)}for(let P in C){let O=C[P];if(!this.opacities[P]){let B=new Mc(O,x,!1,!1);B.isHidden()||(this.opacities[P]=B,_=_||O.text.placed||O.icon.placed)}}for(let P in T)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=T[P]);for(let P in E)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=E[P]);_?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:a)}updateLayerOpacities(a,h,_,x){let C=new Set;for(let T of h){let E=T.getBucket(a);E&&T.latestFeatureIndex&&a.fqid===E.layerIds[0]&&(this.updateBucketOpacities(E,C,T.collisionBoxArray,_,x,T.tileID),E.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(E,T.tileID),E.updateZOffset()))}}updateBucketOpacities(a,h,_,x,C,T){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();let E=a.layers[0].layout,P=!!a.layers[0].dynamicFilter(),O=new Mc(null,0,!1,!1,!0),B=E.get("text-allow-overlap"),j=E.get("icon-allow-overlap"),G=E.get("text-variable-anchor"),q=E.get("text-rotation-alignment")==="map",K=E.get("text-pitch-alignment")==="map",J=new Mc(null,0,B&&(j||!a.hasIconData()||E.get("icon-optional")),j&&(B||!a.hasTextData()||E.get("text-optional")),!0);!a.collisionArrays&&_&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(_);let ee=(ue,ce,he)=>{for(let Ce=0;Ce<ce/4;Ce++)ue.opacityVertexArray.emplaceBack(he)},te=0;C&&a.updateReplacement(T,C);for(let ue=0;ue<a.symbolInstances.length;ue++){let ce=a.symbolInstances.get(ue),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:Ce,crossTileID:we,numIconVertices:de,tileAnchorX:me,tileAnchorY:fe}=ce,Ee=h.has(we),We=this.opacities[we];Ee?We=O:We||(We=J,this.opacities[we]=We),h.add(we);let ye=he>0||Ce>0,He=de>0,qe=this.placedOrientations[we],ct=qe===t.aE.vertical,ut=qe===t.aE.horizontal||qe===t.aE.horizontalOnly;!ye&&!He||We.isHidden()||te++;let lt=!1;if((ye||He)&&C)for(let Le of a.activeReplacements){if(Le.order<x||Le.order===1/0||!(Le.clipMask&t.cu.Symbol)||Le.min.x>me||me>Le.max.x||Le.min.y>fe||fe>Le.max.y)continue;let Ze=t.cH(me,fe,T.canonical,Le.footprintTileId.canonical);if(lt=t.cI(Ze,Le),lt)break}if(ye){let Le=lt?ha:ol(We.text);ee(a.text,he,ct?ha:Le),ee(a.text,Ce,ut?ha:Le);let Ze=We.text.isHidden(),{leftJustifiedTextSymbolIndex:rt,centerJustifiedTextSymbolIndex:Ot,rightJustifiedTextSymbolIndex:Rt,verticalPlacedTextSymbolIndex:Wt}=ce,Ft=a.text.placedSymbolArray,pt=Ze||ct?1:0;rt>=0&&(Ft.get(rt).hidden=pt),Ot>=0&&(Ft.get(Ot).hidden=pt),Rt>=0&&(Ft.get(Rt).hidden=pt),Wt>=0&&(Ft.get(Wt).hidden=Ze||ut?1:0);let nt=this.variableOffsets[we];nt&&this.markUsedJustification(a,nt.anchor,ce,qe);let $t=this.placedOrientations[we];$t&&(this.markUsedJustification(a,"left",ce,$t),this.markUsedOrientation(a,$t,ce))}if(He){let Le=lt?ha:ol(We.icon),{placedIconSymbolIndex:Ze,verticalPlacedIconSymbolIndex:rt}=ce,Ot=a.icon.placedSymbolArray,Rt=We.icon.isHidden()?1:0;Ze>=0&&(ee(a.icon,de,ct?ha:Le),Ot.get(Ze).hidden=Rt),rt>=0&&(ee(a.icon,ce.numVerticalIconVertices,ut?ha:Le),Ot.get(rt).hidden=Rt)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){let Le=a.collisionArrays[ue];if(Le){let Ze=new t.P(0,0),rt=!0;if(Le.textBox||Le.verticalTextBox){if(G){let Rt=this.variableOffsets[we];Rt?(Ze=jf(Rt.anchor,Rt.width,Rt.height,Rt.textOffset,Rt.textScale),q&&Ze._rotate(K?this.transform.angle:-this.transform.angle)):rt=!1}P&&(rt=!We.clipped),Le.textBox&&Du(a.textCollisionBox.collisionVertexArray,We.text.placed,!rt||ct,Ze.x,Ze.y),Le.verticalTextBox&&Du(a.textCollisionBox.collisionVertexArray,We.text.placed,!rt||ut,Ze.x,Ze.y)}let Ot=rt&&!!(!ut&&Le.verticalIconBox);Le.iconBox&&Du(a.iconCollisionBox.collisionVertexArray,We.icon.placed,Ot,ce.hasIconTextFit?Ze.x:0,ce.hasIconTextFit?Ze.y:0),Le.verticalIconBox&&Du(a.iconCollisionBox.collisionVertexArray,We.icon.placed,!Ot,ce.hasIconTextFit?Ze.x:0,ce.hasIconTextFit?Ze.y:0)}}}if(a.fullyClipped=te===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){let ue=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=ue.invProjMatrix,a.placementViewportMatrix=ue.viewportMatrix,a.collisionCircleArray=ue.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,h){let _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function Du(f,a,h,_,x){f.emplaceBack(a?1:0,h?1:0,_||0,x||0),f.emplaceBack(a?1:0,h?1:0,_||0,x||0),f.emplaceBack(a?1:0,h?1:0,_||0,x||0),f.emplaceBack(a?1:0,h?1:0,_||0,x||0)}let Uf=Math.pow(2,25),At=Math.pow(2,24),hp=Math.pow(2,17),fd=Math.pow(2,16),Au=Math.pow(2,9),o_=Math.pow(2,8),Xh=Math.pow(2,1);function ol(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let a=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Uf+a*At+h*hp+a*fd+h*Au+a*o_+h*Xh+a}let ha=0;class ql{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,h,_,x,C){let T=this._bucketParts;for(;this._currentTileIndex<a.length;)if(h.getBucketParts(T,x,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((E,P)=>E.sortKey-P.sortKey));this._currentPartIndex<T.length;){let E=T[this._currentPartIndex];if(h.placeLayerBucketPart(E,this._seenCrossTileIDs,_,E.symbolInstanceStart===0),this._currentPartIndex++,C())return!0}return!1}}class al{constructor(a,h,_,x,C,T,E,P,O){this.placement=new Ka(a,C,T,E,P,O),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(a,h,_,x){let C=t.e.now(),T=()=>{let E=t.e.now()-C;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){let E=h[a[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=P)&&(!E.maxzoom||E.maxzoom>P)){let O=E,B=O.layout.get("symbol-z-elevate"),j=this._inProgressLayer=this._inProgressLayer||new ql(O),G=t.al(E.source,E.scope);if(j.continuePlacement(B?x[G]:_[G],this.placement,this._showCollisionBoxes,E,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}let Po=512/t.a3/2;class mb{constructor(a,h,_){this.tileID=a,this.bucketInstanceId=_,this.index=new t.cK(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let x=a.canonical.x*t.a3,C=a.canonical.y*t.a3;for(let T=0;T<h.length;T++){let{key:E,crossTileID:P,tileAnchorX:O,tileAnchorY:B}=h.get(T),j=Math.floor((x+O)*Po),G=Math.floor((C+B)*Po);this.index.add(j,G),this.keys.push(E),this.crossTileIDs.push(P)}this.index.finish()}findMatches(a,h,_){let x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),C=Po/Math.pow(2,h.canonical.z-this.tileID.canonical.z),T=h.canonical.x*t.a3,E=h.canonical.y*t.a3;for(let P=0;P<a.length;P++){let O=a.get(P);if(O.crossTileID)continue;let{key:B,tileAnchorX:j,tileAnchorY:G}=O,q=Math.floor((T+j)*C),K=Math.floor((E+G)*C),J=this.index.range(q-x,K-x,q+x,K+x);for(let ee of J){let te=this.crossTileIDs[ee];if(this.keys[ee]===B&&!_.has(te)){_.add(te),O.crossTileID=te;break}}}}}class a_{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class mp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){let h=Math.round((a-this.lng)/360);if(h!==0)for(let _ in this.indexes){let x=this.indexes[_],C={};for(let T in x){let E=x[T];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+h),C[E.tileID.key]=E}this.indexes[_]=C}this.lng=a}addBucket(a,h,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let C=0;C<h.symbolInstances.length;C++)h.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);let x=this.usedCrossTileIDs[a.overscaledZ];for(let C in this.indexes){let T=this.indexes[C];if(Number(C)>a.overscaledZ)for(let E in T){let P=T[E];P.tileID.isChildOf(a)&&P.findMatches(h.symbolInstances,a,x)}else{let E=T[a.scaledTo(Number(C)).key];E&&E.findMatches(h.symbolInstances,a,x)}}for(let C=0;C<h.symbolInstances.length;C++){let T=h.symbolInstances.get(C);T.crossTileID||(T.crossTileID=_.generate(),x.add(T.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new mb(a,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(a,h){for(let _ of h.crossTileIDs)this.usedCrossTileIDs[a].delete(_)}removeStaleBuckets(a){let h=!1;for(let _ in this.indexes){let x=this.indexes[_];for(let C in x)a[x[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[C]),delete x[C],h=!0)}return h}}class Qh{constructor(){this.layerIndexes={},this.crossTileIDs=new a_,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,h,_,x){let C=this.layerIndexes[a.fqid];C===void 0&&(C=this.layerIndexes[a.fqid]=new mp);let T=!1,E={};x.name!=="globe"&&C.handleWrapJump(_);for(let P of h){let O=P.getBucket(a);O&&a.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(P.tileID,O,this.crossTileIDs)&&(T=!0),E[O.bucketInstanceId]=!0)}return C.removeStaleBuckets(E)&&(T=!0),T}pruneUnusedLayers(a){let h={};a.forEach(_=>{h[_]=!0});for(let _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}let $l=new t.N({data:new t.O(t.L.colorTheme.data)}),Yl=(f,a)=>Si(f,a&&a.filter(h=>h.identifier!=="source.canvas")),Wf=t.ah(cn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),pp=t.ah(cn,["setCenter","setZoom","setBearing","setPitch"]),s_={version:8,layers:[],sources:{}},Hf={duration:300,delay:0};class Er extends t.E{constructor(a,h={}){super(),this.map=a,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=t.W({},Hf),this._buildingIndex=new db(this),this.crossTileSymbolIndex=new Qh,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new ni,this.dispatcher=h.dispatcher?h.dispatcher:new t.bw(t.bx(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new rd,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new t.cM(a._requestManager,h.localFontFamily?t.cN.all:h.localIdeographFontFamily?t.cN.ideographs:t.cN.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new eu(a._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",t.cO());let _=this;this._rtlTextPluginCallback=Er.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(C,T)=>{if(t.cP(C),T&&T.every(E=>E))for(let E in _._sourceCaches){let P=_._sourceCaches[E],O=P.getSource().type;O!=="vector"&&O!=="geojson"||P.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;let C=this.getOwnSource(x.sourceId);if(C&&C.vectorLayerIds)for(let T in this._layers){let E=this._layers[T];E.source===C.id&&this._validateLayer(E)}})}load(a){return a?(typeof a=="string"?this.loadURL(a):this.loadJSON(a),this):this}_getGlobalId(a){if(!a)return null;if(typeof a=="string"){if(t.cQ(a))return a;let h=t.cR(a);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${t.cS(JSON.stringify(a))}`}_diffStyle(a,h,_){this.globalId=this._getGlobalId(a);let x=(C,T)=>{try{T(null,this.setState(C,_))}catch(E){T(E,!1)}};if(typeof a=="string"){let C=this.map._requestManager.normalizeStyleURL(a),T=this.map._requestManager.transformRequest(C,t.R.Style);t.g(T,(E,P)=>{E?this.fire(new t.d(E)):P&&x(P,h)})}else typeof a=="object"&&x(a,h)}loadURL(a,h={}){this.fire(new t.f("dataloading",{dataType:"style"}));let _=typeof h.validate=="boolean"?h.validate:!t.cQ(a);this.globalId=this._getGlobalId(a),a=this.map._requestManager.normalizeStyleURL(a,h.accessToken),this.resolvedImports.add(a);let x=this.importsCache.get(a);if(x)return this._load(x,_);let C=this.map._requestManager.transformRequest(a,t.R.Style);this._request=t.g(C,(T,E)=>{if(this._request=null,T)this.fire(new t.d(T));else if(E)return this.importsCache.set(a,E),this._load(E,_)})}loadJSON(a,h={}){this.fire(new t.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(a),this._request=t.e.frame(()=>{this._request=null,this._load(a,h.validate!==!1)})}loadEmpty(){this.fire(new t.f("dataloading",{dataType:"style"})),this._load(s_,!1)}_loadImports(a,h,_){if(this.importDepth>=4)return t.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let x=[];for(let C of a){let T=this._createFragmentStyle(C),E=new Promise(B=>{T.once("style.import.load",B),T.once("error",B)}).then(()=>this.mergeAll());if(x.push(E),this.resolvedImports.has(C.url)){T.loadEmpty();continue}let P=C.data||this.importsCache.get(C.url);P?(T.loadJSON(P,{validate:h}),this._isInternalStyle(P)&&(T.globalId=null)):C.url?T.loadURL(C.url,{validate:h}):T.loadEmpty();let O={style:T,id:C.id,config:C.config};if(_){let B=this.fragments.findIndex(({id:j})=>j===_);this.fragments=this.fragments.slice(0,B).concat(O).concat(this.fragments.slice(B))}else this.fragments.push(O)}return Promise.allSettled(x)}getImportGlobalIds(a=this,h=new Set){for(let _ of a.fragments)_.style.globalId&&h.add(_.style.globalId),this.getImportGlobalIds(_.style,h);return[...h.values()]}_createFragmentStyle(a){let h=this.scope?t.al(a.id,this.scope):a.id,_,x=this._initialConfig&&this._initialConfig[h];(a.config||x)&&(_=t.W({},a.config,x));let C=new Er(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,configDependentLayers:this._configDependentLayers});return C.setEventedParent(this.map,{style:C}),C}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(a){return this.isRootStyle()&&(a.fragment||!!a.schema&&a.fragment!==!1)}_load(a,h){let _=a.schema;if(this._isInternalStyle(a)){let T=t.W({},s_,{imports:[{id:"basemap",data:a,url:""}]});return void this._load(T,h)}if(this.updateConfig(this._config,_),h&&Yl(this,Ie(a)))return;this._loaded=!0,this.stylesheet=t.cT(a);let x=()=>{for(let O in a.sources)this.addSource(O,a.sources[O],{validate:!1,isInitialLoad:!0});a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(a.glyphs,this.scope);let T=Ns(this.stylesheet.layers);if(this._order=T.map(O=>O.id),this.stylesheet.light&&t.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let O=this.stylesheet.lights[0];this.light=new Zt(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Zt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let O of T){let B=t.cY(O,this.scope,this._styleColorTheme.lut,this.options);B.isConfigDependent&&this._configDependentLayers.add(B.fqid),B.setEventedParent(this,{layer:{id:B.id}}),this._layers[B.id]=B,this._serializedLayers[B.id]=B.serialize();let j=this.getOwnLayerSourceCache(B),G=!!this.directionalLight&&this.directionalLight.shadowsEnabled();j&&B.canCastShadows()&&G&&(j.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let E=this.stylesheet.terrain;E&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(E,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new t.f("data",{dataType:"style"}));let P=this.isRootStyle();a.imports?this._loadImports(a.imports,h).then(()=>{this._reloadImports(),this.fire(new t.f(P?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new t.f(P?"style.load":"style.import.load")))},C=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=C,C){let T=this._evaluateColorThemeData(C);this._loadColorTheme(T).then(()=>{x()}).catch(E=>{t.w(`Couldn't load color theme from the stylesheet: ${E}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let a,h,_,x,C,T,E,P,O={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(a=B.light),B.stylesheet.lights)for(let j of B.stylesheet.lights)j.type==="ambient"&&B.ambientLight!=null&&(h=B.ambientLight),j.type==="directional"&&B.directionalLight!=null&&(_=B.directionalLight);x=this._prioritizeTerrain(x,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(C=B.fog),B.stylesheet.camera!=null&&(P=B.stylesheet.camera),B.stylesheet.projection!=null&&(T=B.stylesheet.projection),B.stylesheet.transition!=null&&(E=B.stylesheet.transition),O[B.scope]=B._styleColorTheme}}),this.light=a,this.ambientLight=h,this.directionalLight=_,this.fog=C,this._styleColorThemeForScope=O,x===null?delete this.terrain:this.terrain=x,this.camera=P||{"camera-projection":"perspective"},this.projection=T||{name:"mercator"},this.transition=t.W({},Hf,E),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(a){let h=_=>{for(let x of _.fragments)h(x.style);a(_)};h(this)}_prioritizeTerrain(a,h,_){let x=a&&a.drapeRenderMode===0;return _===null?h&&h.drapeRenderMode===0?h:x?a:null:h!=null&&(!a||x||h&&h.drapeRenderMode===1)?h:a}mergeTerrain(){let a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{a=this._prioritizeTerrain(a,h.terrain,h.stylesheet.terrain)}),a===null?delete this.terrain:this.terrain=a}mergeProjection(){let a;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(a=h.stylesheet.projection)}),this.projection=a||{name:"mercator"}}mergeSources(){let a={},h={},_={};this.forEachFragmentStyle(x=>{for(let C in x._sourceCaches){let T=t.al(C,x.scope);a[T]=x._sourceCaches[C]}for(let C in x._otherSourceCaches){let T=t.al(C,x.scope);h[T]=x._otherSourceCaches[C]}for(let C in x._symbolSourceCaches){let T=t.al(C,x.scope);_[T]=x._symbolSourceCaches[C]}}),this._mergedSourceCaches=a,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=_}mergeLayers(){let a={},h=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(T=>{for(let E of T._order){let P=T._layers[E];if(P.type==="slot"){let O=t.cU(E);if(a[O])continue;a[O]=[]}P.slot&&a[P.slot]?a[P.slot].push(P):h.push(P)}}),this._mergedOrder=[],this._clipLayerIndices=[];let x=0,C=(T=[])=>{for(let E of T)if(E.type==="slot"){let P=t.cU(E.id);a[P]&&C(a[P]),this._mergedSlots.push(P)}else{let P=t.al(E.id,E.scope);this._mergedOrder.push(P),_[P]=E,E.is3D()&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&this._clipLayerIndices.push(x),x++}};C(h),this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(a){return this.stylesheet.camera=t.W({},this.stylesheet.camera,a),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(a){return a.data?function(h,_,x){let C=t.W({},_);for(let E of Object.keys(t.L.colorTheme))C[E]===void 0&&(C[E]=t.L.colorTheme[E].default);let T=new t.U($l,h,new Map(x));return T.setTransitionOrValue(C,x),T.untransitioned().possiblyEvaluate(new t.X(0))}(this.scope,a,this.options).get("data"):null}_loadColorTheme(a){return this._styleColorTheme.lutLoading=!0,new Promise((h,_)=>{let x="data:image/png;base64,";if(a.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();a.startsWith(x)||(a=x+a);let C="mapbox-reserved-lut",T=new Image;T.src=a,T.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},T.onload=()=>{this._styleColorTheme.lutLoading=!1;let{width:E,height:P,data:O}=t.e.getImageData(T);if(P>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(E!==P*P)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new t.i({width:E,height:P},O),pixelRatio:1,sdf:!1,version:0});let B=this.imageManager.getImage(C,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:a},h()):_(new Error("Missing LUT image."))}})}getLut(a){let h=this._styleColorThemeForScope[a];return h?h.lut:null}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(a){this._spriteRequest=function(h,_,x){let C,T,E,P=t.e.devicePixelRatio>1?"@2x":"",O=t.g(_.transformRequest(_.normalizeSpriteURL(h,P,".json"),t.R.SpriteJSON),(G,q)=>{O=null,E||(E=G,C=q,j())}),B=t.h(_.transformRequest(_.normalizeSpriteURL(h,P,".png"),t.R.SpriteImage),(G,q)=>{B=null,E||(E=G,T=q,j())});function j(){if(E)x(E);else if(C&&T){let G=t.e.getImageData(T),q={};for(let K in C){let{width:J,height:ee,x:te,y:ue,sdf:ce,pixelRatio:he,stretchX:Ce,stretchY:we,content:de}=C[K],me=new t.i({width:J,height:ee});t.i.copy(G,me,{x:te,y:ue},{x:0,y:0},{width:J,height:ee},null),q[K]={data:me,pixelRatio:he,sdf:ce,stretchX:Ce,stretchY:we,content:de}}x(null,q)}}return{cancel(){O&&(O.cancel(),O=null),B&&(B.cancel(),B=null)}}}(a,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new t.d(h));else if(_)for(let x in _)this.imageManager.addImage(x,this.scope,_[x]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.f("data",{dataType:"style"}))})}_validateLayer(a){let h=this.getOwnSource(a.source);if(!h)return;let _=a.sourceLayer;_&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(_)===-1)&&this.fire(new t.d(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:a}of this.fragments)if(!a.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((a,h)=>{let _=this.fragments[h];return _&&_.style&&(a.data=_.style.serialize()),a})}_serializeSources(){let a={};for(let h in this._sourceCaches){let _=this._sourceCaches[h].getSource();a[_.id]||(a[_.id]=_.serialize())}return a}_serializeLayers(a){let h=[];for(let _ of a){let x=this._layers[_];x&&x.type!=="custom"&&h.push(x.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(let a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(a){return!!this.terrain&&a.isDraped(this.getLayerSourceCache(a))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(a){let h=this.getOwnLayer(a);if(h)return h;this.fire(new t.d(new Error(`The layer '${a}' does not exist in the map's style.`)))}_checkSource(a){let h=this.getOwnSource(a);if(h)return h;this.fire(new t.d(new Error(`The source '${a}' does not exist in the map's style.`)))}update(a){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(a),this.directionalLight&&this.directionalLight.recalculate(a);let h=this.calculateLightsBrightness();a.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));let _=this._changes.isDirty(),x=!1;if(this._changes.isDirty()){let T=this._changes.getLayerUpdatesByScope();for(let E in T){let{updatedIds:P,removedIds:O}=T[E];(P||O)&&(this._updateWorkerLayers(E,P,O),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(a),this.light&&this.light.updateTransitions(a),this.ambientLight&&this.ambientLight.updateTransitions(a),this.directionalLight&&this.directionalLight.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._changes.reset()}let C={};for(let T in this._mergedSourceCaches){let E=this._mergedSourceCaches[T];C[T]=E.used,E.used=!1,E.tileCoverLift=0}for(let T of this._mergedOrder){let E=this._mergedLayers[T];if(E.recalculate(a,this._availableImages),!E.isHidden(a.zoom)){let P=this.getLayerSourceCache(E);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,E.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let P=E.minzoom||0;P<(E.maxzoom||25.5);P++){let O=this.map.painter;if(O){let B=E.getProgramIds();if(!B)continue;for(let j of B){let G=E.getDefaultProgramParams(j,a.zoom,this._styleColorTheme.lut);G&&(O.style=this,this.fog&&(O._fogVisible=!0,G.overrideFog=!0,O.getOrCreateProgram(j,G)),O._fogVisible=!1,G.overrideFog=!1,O.getOrCreateProgram(j,G),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(G.overrideRtt=!0,O.getOrCreateProgram(j,G)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();for(let T in C){let E=this._mergedSourceCaches[T];C[T]!==E.used&&E.getSource().fire(new t.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light&&this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),_&&this.fire(new t.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let a=this._changes.getUpdatedImages();if(a.length){for(let h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changes.resetUpdatedImages()}}_updateWorkerLayers(a,h,_){let x=this.getFragmentStyle(a);x&&this.dispatcher.broadcast("updateLayers",{layers:h?x._serializeLayers(h):[],scope:a,removedIds:_||[],options:x.options})}setState(a,h){if(this._checkLoaded(),Yl(this,Ie(a)))return!1;(a=t.cT(a)).layers=Ns(a.layers);let _=function(T,E){if(!T)return[{command:cn.setStyle,args:[E]}];let P=[];try{if(!g(T.version,E.version))return[{command:cn.setStyle,args:[E]}];if(g(T.center,E.center)||P.push({command:cn.setCenter,args:[E.center]}),g(T.zoom,E.zoom)||P.push({command:cn.setZoom,args:[E.zoom]}),g(T.bearing,E.bearing)||P.push({command:cn.setBearing,args:[E.bearing]}),g(T.pitch,E.pitch)||P.push({command:cn.setPitch,args:[E.pitch]}),g(T.sprite,E.sprite)||P.push({command:cn.setSprite,args:[E.sprite]}),g(T.glyphs,E.glyphs)||P.push({command:cn.setGlyphs,args:[E.glyphs]}),g(T.imports,E.imports)||function(q=[],K=[],J){K=K||[];let ee=(q=q||[]).map(up),te=K.map(up),ue=q.reduce(Eu,{}),ce=K.reduce(Eu,{}),he=ee.slice(),Ce,we,de,me;for(Ce=0,we=0;Ce<ee.length;Ce++)de=ee[Ce],ce.hasOwnProperty(de)?we++:(J.push({command:cn.removeImport,args:[de]}),he.splice(he.indexOf(de,we),1));for(Ce=0,we=0;Ce<te.length;Ce++)de=te[te.length-1-Ce],he[he.length-1-Ce]!==de&&(ue.hasOwnProperty(de)?(J.push({command:cn.removeImport,args:[de]}),he.splice(he.lastIndexOf(de,he.length-we),1)):we++,me=he[he.length-Ce],J.push({command:cn.addImport,args:[ce[de],me]}),he.splice(he.length-Ce,0,de));for(let fe of K){let Ee=ue[fe.id];Ee&&!g(Ee,fe)&&J.push({command:cn.updateImport,args:[fe.id,fe]})}}(T.imports,E.imports,P),g(T.transition,E.transition)||P.push({command:cn.setTransition,args:[E.transition]}),g(T.light,E.light)||P.push({command:cn.setLight,args:[E.light]}),g(T.fog,E.fog)||P.push({command:cn.setFog,args:[E.fog]}),g(T.projection,E.projection)||P.push({command:cn.setProjection,args:[E.projection]}),g(T.lights,E.lights)||P.push({command:cn.setLights,args:[E.lights]}),g(T.camera,E.camera)||P.push({command:cn.setCamera,args:[E.camera]}),!g(T["color-theme"],E["color-theme"]))return[{command:cn.setStyle,args:[E]}];let O={},B=[];(function(q,K,J,ee){let te;for(te in K=K||{},q=q||{})q.hasOwnProperty(te)&&(K.hasOwnProperty(te)||i_(te,J,ee));for(te in K){if(!K.hasOwnProperty(te))continue;let ue=K[te];q.hasOwnProperty(te)?g(q[te],ue)||(q[te].type==="geojson"&&ue.type==="geojson"&&hb(q,K,te)?J.push({command:cn.setGeoJSONSourceData,args:[te,ue.data]}):ub(te,K,J,ee)):Gl(te,K,J)}})(T.sources,E.sources,B,O);let j=[];T.layers&&T.layers.forEach(q=>{q.source&&O[q.source]?P.push({command:cn.removeLayer,args:[q.id]}):j.push(q)});let G=T.terrain;G&&O[G.source]&&(P.push({command:cn.setTerrain,args:[void 0]}),G=void 0),P=P.concat(B),g(G,E.terrain)||P.push({command:cn.setTerrain,args:[E.terrain]}),function(q,K,J){K=K||[];let ee=(q=q||[]).map(up),te=K.map(up),ue=q.reduce(Eu,{}),ce=K.reduce(Eu,{}),he=ee.slice(),Ce=Object.create(null),we,de,me,fe,Ee,We,ye;for(we=0,de=0;we<ee.length;we++)me=ee[we],ce.hasOwnProperty(me)?de++:(J.push({command:cn.removeLayer,args:[me]}),he.splice(he.indexOf(me,de),1));for(we=0,de=0;we<te.length;we++)me=te[te.length-1-we],he[he.length-1-we]!==me&&(ue.hasOwnProperty(me)?(J.push({command:cn.removeLayer,args:[me]}),he.splice(he.lastIndexOf(me,he.length-de),1)):de++,We=he[he.length-we],J.push({command:cn.addLayer,args:[ce[me],We]}),he.splice(he.length-we,0,me),Ce[me]=!0);for(we=0;we<te.length;we++)if(me=te[we],fe=ue[me],Ee=ce[me],!Ce[me]&&!g(fe,Ee))if(g(fe.source,Ee.source)&&g(fe["source-layer"],Ee["source-layer"])&&g(fe.type,Ee.type)){for(ye in Qa(fe.layout,Ee.layout,J,me,null,cn.setLayoutProperty),Qa(fe.paint,Ee.paint,J,me,null,cn.setPaintProperty),g(fe.slot,Ee.slot)||J.push({command:cn.setSlot,args:[me,Ee.slot]}),g(fe.filter,Ee.filter)||J.push({command:cn.setFilter,args:[me,Ee.filter]}),g(fe.minzoom,Ee.minzoom)&&g(fe.maxzoom,Ee.maxzoom)||J.push({command:cn.setLayerZoomRange,args:[me,Ee.minzoom,Ee.maxzoom]}),fe)fe.hasOwnProperty(ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&ye!=="slot"&&(ye.indexOf("paint.")===0?Qa(fe[ye],Ee[ye],J,me,ye.slice(6),cn.setPaintProperty):g(fe[ye],Ee[ye])||J.push({command:cn.setLayerProperty,args:[me,ye,Ee[ye]]}));for(ye in Ee)Ee.hasOwnProperty(ye)&&!fe.hasOwnProperty(ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&ye!=="slot"&&(ye.indexOf("paint.")===0?Qa(fe[ye],Ee[ye],J,me,ye.slice(6),cn.setPaintProperty):g(fe[ye],Ee[ye])||J.push({command:cn.setLayerProperty,args:[me,ye,Ee[ye]]}))}else J.push({command:cn.removeLayer,args:[me]}),We=he[he.lastIndexOf(me)+1],J.push({command:cn.addLayer,args:[Ee,We]})}(j,E.layers,P)}catch(O){console.warn("Unable to compute style diff:",O),P=[{command:cn.setStyle,args:[E]}]}return P}(this.serialize(),a).filter(T=>!(T.command in pp));if(_.length===0)return!1;let x=_.filter(T=>!(T.command in Wf));if(x.length>0)throw new Error(`Unimplemented: ${x.map(T=>T.command).join(", ")}.`);let C=[];return _.forEach(T=>{C.push(this[T.command].apply(this,T.args))}),h&&Promise.all(C).then(h),this.stylesheet=a,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(a,h){return this.getImage(a)?this.fire(new t.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,this.scope,h),this._afterImageUpdated(a),this)}updateImage(a,h){this.imageManager.updateImage(a,this.scope,h)}getImage(a){return this.imageManager.getImage(a,this.scope)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a,this.scope),this._afterImageUpdated(a),this):this.fire(new t.d(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(a),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new t.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(a,h,_={}){return this._checkLoaded(),this._validate(Oi,`models.${a}`,h,null,_)||(this.modelManager.addModel(a,h,this.scope),this._changes.setDirty()),this}hasModel(a){return this.modelManager.hasModel(a,this.scope)}removeModel(a){return this.hasModel(a)?(this.modelManager.removeModel(a,this.scope),this):this.fire(new t.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(a,h,_={}){if(this._checkLoaded(),this.getOwnSource(a)!==void 0)throw new Error(`There is already a source with ID "${a}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(Me,`sources.${a}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);let x=tp(a,h,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));let C=T=>{let E=(T?"symbol:":"other:")+x.id,P=t.al(E,this.scope),O=this._sourceCaches[E]=new t.bv(P,x,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=O,O.onAdd(this.map)};C(!1),h.type!=="vector"&&h.type!=="geojson"||C(!0),x.onAdd&&x.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(a){this._checkLoaded();let h=this.getOwnSource(a);if(!h)throw new Error("There is no source with this ID");for(let x in this._layers)if(this._layers[x].source===a)return this.fire(new t.d(new Error(`Source "${a}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===a)return this.fire(new t.d(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));let _=this.getOwnSourceCaches(a);for(let x of _){let C=t.cU(x.id);delete this._sourceCaches[C],this._changes.discardSourceCacheUpdate(x.id),x.fire(new t.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(a,h){this._checkLoaded(),this.getOwnSource(a).setData(h),this._changes.setDirty()}getOwnSource(a){let h=this.getOwnSourceCache(a);return h&&h.getSource()}getOwnSources(){let a=[];for(let h in this._otherSourceCaches){let _=this.getOwnSourceCache(h);_&&a.push(_.getSource())}return a}areTilesLoaded(){let a=this._mergedSourceCaches;for(let h in a){let _=a[h]._tiles;for(let x in _){let C=_[x];if(C.state!=="loaded"&&C.state!=="errored")return!1}}return!0}setLights(a){if(this._checkLoaded(),!a)return delete this.ambientLight,void delete this.directionalLight;let h=this._getTransitionParameters();for(let x of a){if(this._validate(Ye,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){let C=this.ambientLight;C.set(x),C.updateTransitions(h)}else this.ambientLight=new mc(x,ki,this.scope,this.options);break;case"directional":if(this.directionalLight){let C=this.directionalLight;C.set(x),C.updateTransitions(h)}else this.directionalLight=new mc(x,yf,this.scope,this.options)}}let _=new t.X(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let a=this.directionalLight,h=this.ambientLight;if(!a||!h)return;let _=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),x=a.properties.get("color").toRenderColor(null).toArray01(),C=a.properties.get("intensity"),T=a.properties.get("direction"),E=1-t.ac(T.x,T.y,T.z)[2]/90,P=_(x)*C*E,O=h.properties.get("color").toRenderColor(null).toArray01(),B=h.properties.get("intensity");return(P+_(O)*B)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let a=[];return this.directionalLight&&a.push(this.directionalLight.get()),this.ambientLight&&a.push(this.ambientLight.get()),a}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(a){if(!a)return this;if(t.cV(a)){let h=t.cW(a),_=this.fragments.find(({id:C})=>C===h);if(!_)throw new Error(`Style import not found: ${a}`);let x=t.cU(a);return _.style.getFragmentStyle(x)}{let h=this.fragments.find(({id:_})=>_===a);if(!h)throw new Error(`Style import not found: ${a}`);return h.style}}getConfigProperty(a,h){let _=this.getFragmentStyle(a);if(!_)return null;let x=t.al(h,_.scope),C=_.options.get(x),T=C?C.value||C.default:null;return T?T.serialize():null}setConfigProperty(a,h,_){let x=this.getFragmentStyle(a);if(!x)return;let C=x.stylesheet.schema;if(!C||!C[h])return;let T=t.y(_);if(T.result!=="success")return void Yl(this,T.value);let E=T.value.expression,P=t.al(h,x.scope),O=x.options.get(P);if(!O)return;let B,{minValue:j,maxValue:G,stepValue:q,type:K,values:J}=C[h],ee=t.y(C[h].default);ee.result==="success"&&(B=ee.value.expression),B?(this.options.set(P,yl(Dn({},O),{value:E,default:B,minValue:j,maxValue:G,stepValue:q,type:K,values:J})),this.updateConfigDependencies()):this.fire(new t.d(new Error(`No schema defined for the config option "${h}" in the "${a}" fragment.`)))}getConfig(a){let h=this.getFragmentStyle(a);if(!h)return null;let _=h.stylesheet.schema;if(!_)return null;let x={};for(let C in _){let T=t.al(C,h.scope),E=h.options.get(T),P=E?E.value||E.default:null;x[C]=P?P.serialize():null}return x}setConfig(a,h){let _=this.getFragmentStyle(a);_&&(_.updateConfig(h,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(a){let h=this.getFragmentStyle(a);return h?h.stylesheet.schema:null}setSchema(a,h){let _=this.getFragmentStyle(a);_&&(_.stylesheet.schema=h,_.updateConfig(_._config,h),this.updateConfigDependencies())}updateConfig(a,h){if(this._config=a,a||h)if(h)for(let _ in h){let x,C,T=t.y(h[_].default);if(T.result==="success"&&(x=T.value.expression),a&&a[_]!==void 0){let G=t.y(a[_]);G.result==="success"&&(C=G.value.expression)}let{minValue:E,maxValue:P,stepValue:O,type:B,values:j}=h[_];if(x){let G=t.al(_,this.scope);this.options.set(G,{default:x,value:C,minValue:E,maxValue:P,stepValue:O,type:B,values:j})}else this.fire(new t.d(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new t.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let a of this._configDependentLayers){let h=this.getLayer(a);h&&(h.possiblyEvaluateVisibility(),this._updateLayer(h))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(a=>{if(a._styleColorTheme.colorTheme){let h=a._evaluateColorThemeData(a._styleColorTheme.colorTheme);(!a._styleColorTheme.lut||a._styleColorTheme.lut&&h!==a._styleColorTheme.lut.data)&&a.setColorTheme(a._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(a,h,_={}){this._checkLoaded();let x=a.id;if(this._layers[x])return void this.fire(new t.d(new Error(`Layer with id "${x}" already exists on this map`)));let C;if(a.type==="custom"){if(Yl(this,t.cX(a)))return;C=t.cY(a,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof a.source=="object"&&(this.addSource(x,a.source),a=t.cT(a),a=t.W(a,{source:x})),this._validate(Dt,`layers.${x}`,a,{arrayIndex:-1},_))return;C=t.cY(a,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(C),C.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[C.id]=C.serialize()}C.isConfigDependent&&this._configDependentLayers.add(C.fqid);let T=this._order.length;if(h){let B=this._order.indexOf(h);if(B===-1)return void this.fire(new t.d(new Error(`Layer with id "${h}" does not exist on this map.`)));C.slot===this._layers[h].slot?T=B:t.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,x),this._layerOrderChanged=!0,this._layers[x]=C;let E=this.getOwnLayerSourceCache(C),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&C.canCastShadows()&&P&&(E.castsShadows=!0);let O=this._changes.getRemovedLayer(C);if(O&&C.source&&E&&C.type!=="custom"){this._changes.discardLayerRemoval(C);let B=t.al(C.source,C.scope);O.type!==C.type?this._changes.updateSourceCache(B,"clear"):(this._changes.updateSourceCache(B,"reload"),E.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),C.scope=this.scope,this.mergeLayers()}moveLayer(a,h){this._checkLoaded();let _=this._checkLayer(a);if(!_||a===h)return;let x=this._order.indexOf(a);this._order.splice(x,1);let C=this._order.length;if(h){let T=this._order.indexOf(h);if(T===-1)return void this.fire(new t.d(new Error(`Layer with id "${h}" does not exist on this map.`)));_.slot===this._layers[h].slot?C=T:t.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,a),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(a){this._checkLoaded();let h=this._checkLayer(a);if(!h)return;h.setEventedParent(null);let _=this._order.indexOf(a);this._order.splice(_,1),delete this._layers[a],delete this._serializedLayers[a],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);let x=this.getOwnLayerSourceCache(h);if(x&&x.castsShadows){let C=!1;for(let T in this._layers)if(this._layers[T].source===h.source&&this._layers[T].canCastShadows()){C=!0;break}x.castsShadows=C}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(a){return this._layers[a]}hasLayer(a){return a in this._mergedLayers}hasLayerType(a){for(let h in this._layers)if(this._layers[h].type===a)return!0;return!1}setLayerZoomRange(a,h,_){this._checkLoaded();let x=this._checkLayer(a);x&&(x.minzoom===h&&x.maxzoom===_||(h!=null&&(x.minzoom=h),_!=null&&(x.maxzoom=_),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(a,h){this._checkLoaded();let _=this._checkLayer(a);_&&_.slot!==h&&(_.slot=h,this._updateLayer(_))}setFilter(a,h,_={}){this._checkLoaded();let x=this._checkLayer(a);if(x&&!g(x.filter,h))return h==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(yt,`layers.${x.id}.filter`,h,{layerType:x.type},_)||(x.filter=t.cT(h),this._updateLayer(x)))}getFilter(a){let h=this._checkLayer(a);if(h)return t.cT(h.filter)}setLayoutProperty(a,h,_,x={}){this._checkLoaded();let C=this._checkLayer(a);if(C&&!g(C.getLayoutProperty(h),_)){if(_!=null&&(!x||x.validate!==!1)&&Yl(C,ui.call(Ie,{key:`layers.${a}.layout.${h}`,layerType:C.type,objectKey:h,value:_,styleSpec:t.L,style:{glyphs:!0,sprite:!0}})))return;C.setLayoutProperty(h,_),C.isConfigDependent&&this._configDependentLayers.add(C.fqid),this._updateLayer(C)}}getLayoutProperty(a,h){let _=this._checkLayer(a);if(_)return _.getLayoutProperty(h)}setPaintProperty(a,h,_,x={}){this._checkLoaded();let C=this._checkLayer(a);if(!C||g(C.getPaintProperty(h),_)||_!=null&&(!x||x.validate!==!1)&&Yl(C,Kt.call(Ie,{key:`layers.${a}.paint.${h}`,layerType:C.type,objectKey:h,value:_,styleSpec:t.L})))return;let T=C.setPaintProperty(h,_);C.isConfigDependent&&this._configDependentLayers.add(C.fqid),T&&this._updateLayer(C),this._changes.updatePaintProperties(C)}getPaintProperty(a,h){let _=this._checkLayer(a);if(_)return _.getPaintProperty(h)}setFeatureState(a,h){this._checkLoaded();let _=a.source,x=a.sourceLayer,C=this._checkSource(_);if(!C)return;let T=C.type;if(T==="geojson"&&x)return void this.fire(new t.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!x)return void this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new t.d(new Error("The feature id parameter must be provided.")));let E=this.getOwnSourceCaches(_);for(let P of E)P.setFeatureState(x,a.id,h)}removeFeatureState(a,h){this._checkLoaded();let _=a.source,x=this._checkSource(_);if(!x)return;let C=x.type,T=C==="vector"?a.sourceLayer:void 0;if(C==="vector"&&!T)return void this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new t.d(new Error("A feature id is required to remove its specific state property.")));let E=this.getOwnSourceCaches(_);for(let P of E)P.removeFeatureState(T,a.id,h)}getFeatureState(a){this._checkLoaded();let h=a.source,_=a.sourceLayer,x=this._checkSource(h);if(x){if(x.type!=="vector"||_)return a.id===void 0&&this.fire(new t.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(_,a.id);this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(a){return this.stylesheet.transition=t.W({},this.stylesheet.transition,a),this.transition=this.stylesheet.transition,this}getTransition(){return t.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let a=this.getTerrain(),h=a&&this.terrain&&this.terrain.scope===this.scope?a:this.stylesheet.terrain;return t.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateLayer(a){this._changes.updateLayer(a);let h=this.getLayerSourceCache(a),_=t.al(a.source,a.scope),x=this._changes.getUpdatedSourceCaches();a.source&&!x[_]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),h.pause()),a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){let h=E=>this._mergedLayers[E].type==="fill-extrusion"||this._mergedLayers[E].type==="model",_=this.order,x={},C=[];for(let E=_.length-1;E>=0;E--){let P=_[E];if(h(P)){x[P]=E;for(let O of a){let B=O[P];if(B)for(let j of B)C.push(j)}}}C.sort((E,P)=>P.intersectionZ-E.intersectionZ);let T=[];for(let E=_.length-1;E>=0;E--){let P=_[E];if(h(P))for(let O=C.length-1;O>=0;O--){let B=C[O].feature;if(B.layer&&x[B.layer.id]<E)break;T.push(B),C.pop()}else for(let O of a){let B=O[P];if(B)for(let j of B)T.push(j.feature)}}return T}queryRenderedFeatures(a,h,_){h&&h.filter&&this._validate(yt,"queryRenderedFeatures.filter",h.filter,null,h),h.scope=this.scope,h.availableImages=this._availableImages,h.serializedLayers=this._serializedLayers;let x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new t.d(new Error("parameters.layers must be an Array."))),[];for(let O of h.layers){let B=this._mergedLayers[O];if(!B)return this.fire(new t.d(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];x[B.source]=!0}}let C=[],T=h.serializedLayers||{},E=h&&h.layers?h.layers.some(O=>{let B=this.getLayer(O);return B&&B.is3D()}):this.has3DLayers(),P=Wi.createFromScreenPoints(a,_);for(let O in this._mergedSourceCaches){let B=this._mergedSourceCaches[O].getSource();if(!B||B.scope!==h.scope)continue;let j=this._mergedSourceCaches[O].getSource().id;h.layers&&!x[j]||C.push(cb(this._mergedSourceCaches[O],this._mergedLayers,T,P,h,_,E,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(O,B,j,G,q,K,J){let ee={},te=K.queryRenderedSymbols(G),ue=[];for(let ce of Object.keys(te).map(Number))ue.push(J[ce]);ue.sort(Mu);for(let ce of ue){let he=ce.featureIndex.lookupSymbolFeatures(te[ce.bucketInstanceId],B,ce.bucketIndex,ce.sourceLayerIndex,q.filter,q.layers,q.availableImages,O);for(let Ce in he){let we=ee[Ce]=ee[Ce]||[],de=he[Ce];de.sort((me,fe)=>{let Ee=ce.featureSortOrder;if(Ee){let We=Ee.indexOf(me.featureIndex);return Ee.indexOf(fe.featureIndex)-We}return fe.featureIndex-me.featureIndex});for(let me of de)we.push(me)}}for(let ce in ee)ee[ce].forEach(he=>{let Ce=he.feature,we=j(O[ce]);if(!we)return;let de=we.getFeatureState(Ce.layer["source-layer"],Ce.id);Ce.source=Ce.layer.source,Ce.layer["source-layer"]&&(Ce.sourceLayer=Ce.layer["source-layer"]),Ce.state=de});return ee}(this._mergedLayers,T,this.getLayerSourceCache.bind(this),P.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(a,h){h&&h.filter&&this._validate(yt,"querySourceFeatures.filter",h.filter,null,h);let _=this.getOwnSourceCaches(a),x=[];for(let C of _)x=x.concat(qh(C,h));return x}addSourceType(a,h,_){return Er.getSourceType(a)?_(new Error(`A source type called "${a}" already exists.`)):(Er.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(a,h,_={}){this._checkLoaded();let x=this.light.getLight(),C=!1;for(let E in a)if(!g(a[E],x[E])){C=!0;break}if(!C)return;let T=this._getTransitionParameters();this.light.setLight(a,h,_),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=t.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&t.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(a,h=1){if(this._checkLoaded(),!a)return this.terrainSetForDrapingOnly()&&h!==0||delete this.terrain,a===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=a,x=a.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof _.source=="object"){let E="terrain-dem-src";this.addSource(E,_.source),_=t.cT(_),_=t.W(_,{source:E})}let C=t.W({},_),T={};if(this.terrain&&x){C.source=this.terrain.get().source;let E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(T.style=E.serialize())}if(this._validate(Fe,"terrain",C,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&h!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,h),this.fire(new t.f("data",{dataType:"style"}))}else{let C=this.terrain,T=C.get();for(let E of Object.keys(t.L.terrain))!_.hasOwnProperty(E)&&t.L.terrain[E].default&&(_[E]=t.L.terrain[E].default);for(let E in a)if(!g(a[E],T[E])){C.set(a,this.options),this.stylesheet.terrain=a;let P=this._getTransitionParameters({duration:0});C.updateTransitions(P),this.fire(new t.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){let h=this.fog=new bf(a,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();let _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let h=this.fog;if(!g(h.get(),a)){h.set(a,this.options),this.stylesheet.fog=h.get();let _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}}else this._createFog(a);this._markersNeedUpdate=!0}setColorTheme(a){this._checkLoaded();let h=()=>{for(let x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(let x in this._sourceCaches)this._sourceCaches[x].clearTiles()};if(this._styleColorTheme.colorTheme=a,!a)return this._styleColorTheme.lut=null,void h();let _=this._evaluateColorThemeData(a);this._loadColorTheme(_).then(()=>{h()}).catch(x=>{t.w(`Couldn't set color theme: ${x}`)})}_getTransitionParameters(a){return{now:t.e.now(),transition:t.W(this.transition,a)}}updateDrapeFirstLayers(){if(!this.terrain)return;let a=[],h=[];for(let _ in this._mergedLayers)this.isLayerDraped(this._mergedLayers[_])?a.push(_):h.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...h)}_createTerrain(a,h){let _=this.terrain=new Pn(a,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=a),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let x=this._getTransitionParameters({duration:0});_.updateTransitions(x)}_force3DLayerUpdate(){for(let a in this._layers){let h=this._layers[a];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(let a in this._layers){let h=this._layers[a];h.type==="symbol"&&this._updateLayer(h)}}_validate(a,h,_,x,C={}){if(C&&C.validate===!1)return!1;let T=t.W({},this.serialize());return Yl(this,a.call(Ie,t.W({key:h,style:T,value:_,styleSpec:t.L},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let a in this._mergedLayers)this._mergedLayers[a].setEventedParent(null);for(let a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles(),this._mergedSourceCaches[a].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(a){let h=this.getSourceCaches(a);for(let _ of h)_.clearTiles()}clearSources(){for(let a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles()}reloadSource(a){let h=this.getSourceCaches(a);for(let _ of h)_.resume(),_.reload()}reloadSources(){for(let a of this.getSources())a.reload&&a.reload()}updateSources(a){let h;this.directionalLight&&(h=Rh(this.directionalLight));for(let _ in this._mergedSourceCaches)this._mergedSourceCaches[_].update(a,void 0,void 0,h)}_generateCollisionBoxes(){for(let a in this._sourceCaches){let h=this._sourceCaches[a];h.resume(),h.reload()}}_updatePlacement(a,h,_,x,C,T,E=!1){let P=!1,O=!1,B={},j={};for(let q of this._mergedOrder){let K=this._mergedLayers[q];if(K.type!=="symbol")continue;let J=t.al(K.source,K.scope),ee=B[J];if(!ee){let ue=this.getLayerSourceCache(K);if(!ue)continue;let ce=ue.getRenderableIds(!0).map(he=>ue.getTileByID(he));j[J]=ce.slice(),ee=B[J]=ce.sort((he,Ce)=>Ce.tileID.overscaledZ-he.tileID.overscaledZ||(he.tileID.isLessThan(Ce.tileID)?-1:1))}let te=this.crossTileSymbolIndex.addLayer(K,ee,h.center.lng,h.projection);P=P||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),E=E||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new t.f("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.e.now(),h.zoom))&&(this.pauseablePlacement=new al(h,this._mergedOrder,E,_,x,C,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,B,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.e.now()),O=!0),P&&this.pauseablePlacement.placement.setStale()),O||P){this._buildingIndex.onNewFrame(h.zoom);for(let q=0;q<this._mergedOrder.length;q++){let K=this._mergedLayers[this._mergedOrder[q]];if(K.type!=="symbol")continue;let J=this.isLayerClipped(K)&&this._clipLayerIndices.some(ee=>q<ee);this.placement.updateLayerOpacities(K,B[t.al(K.source,K.scope)],q,J?T:null)}}let G=!1;for(let q of this._mergedOrder){let K=this._mergedLayers[q];if(K.type!=="symbol")continue;let J=B[t.al(K.source,K.scope)];for(let ee of J){let te=ee.getBucket(K);te&&ee.latestFeatureIndex&&K.fqid===te.layerIds[0]&&(G=te.updateOcclusionOpacities(a.context,a.symbolParams,a._dt)||G)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.e.now())||G,occlusionQueryBasedOpacityChanged:G}}_releaseSymbolFadeTiles(){for(let a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}addImport(a,h){this._checkLoaded();let _=this.stylesheet.imports=this.stylesheet.imports||[];if(_.findIndex(({id:C})=>C===a.id)!==-1)return void this.fire(new t.d(new Error(`Import with id '${a.id}' already exists in the map's style.`)));if(!h)return _.push(a),this._loadImports([a],!0);let x=_.findIndex(({id:C})=>C===h);return x===-1&&this.fire(new t.d(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,x).concat(a).concat(_.slice(x)),this._loadImports([a],!0,h)}updateImport(a,h){this._checkLoaded();let _=this.stylesheet.imports||[],x=this.getImportIndex(a);return x===-1?this:typeof h=="string"?(this.setImportUrl(a,h),this):(h.url&&h.url!==_[x].url&&this.setImportUrl(a,h.url),g(h.config,_[x].config)||this.setImportConfig(a,h.config),g(h.data,_[x].data)||this.setImportData(a,h.data),this)}moveImport(a,h){this._checkLoaded();let _=this.stylesheet.imports||[],x=this.getImportIndex(a);if(x===-1)return this;let C=this.getImportIndex(h);if(C===-1)return this;let T=_[x],E=this.fragments[x];return _=_.filter(({id:P})=>P!==a),this.fragments=this.fragments.filter(({id:P})=>P!==a),this.stylesheet.imports=_.slice(0,C).concat(T).concat(_.slice(C)),this.fragments=this.fragments.slice(0,C).concat(E).concat(this.fragments.slice(C)),this.mergeLayers(),this}setImportUrl(a,h){this._checkLoaded();let _=this.stylesheet.imports||[],x=this.getImportIndex(a);if(x===-1)return this;_[x].url=h;let C=this.fragments[x];return C.style=this._createFragmentStyle(_[x]),C.style.on("style.import.load",()=>this.mergeAll()),C.style.loadURL(h),this}setImportData(a,h){this._checkLoaded();let _=this.getImportIndex(a),x=this.stylesheet.imports||[];return _===-1?this:h?(this.fragments[_].style.setState(h),this._reloadImports(),this):(delete x[_].data,this.setImportUrl(a,x[_].url))}setImportConfig(a,h){this._checkLoaded();let _=this.getImportIndex(a),x=this.stylesheet.imports||[];if(_===-1)return this;h?x[_].config=h:delete x[_].config;let C=this.fragments[_],T=C.style.stylesheet&&C.style.stylesheet.schema;return C.config=h,C.style.updateConfig(h,T),this.updateConfigDependencies(),this}removeImport(a){this._checkLoaded();let h=this.stylesheet.imports||[],_=this.getImportIndex(a);_!==-1&&(h.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(a){let h=(this.stylesheet.imports||[]).findIndex(_=>_.id===a);return h===-1&&this.fire(new t.d(new Error(`Import '${a}' does not exist in the map's style and cannot be updated.`))),h}getLayer(a){return this._mergedLayers[a]}getSources(){let a=[];for(let h in this._mergedOtherSourceCaches){let _=this._mergedOtherSourceCaches[h];_&&a.push(_.getSource())}return a}getSource(a,h){let _=this.getSourceCache(a,h);return _&&_.getSource()}getLayerSource(a){let h=this.getLayerSourceCache(a);return h&&h.getSource()}getSourceCache(a,h){let _=t.al(a,h);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(a){let h=t.al(a.source,a.scope);return a.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(a){if(a==null)return Object.values(this._mergedSourceCaches);let h=[];return this._mergedOtherSourceCaches[a]&&h.push(this._mergedOtherSourceCaches[a]),this._mergedSymbolSourceCaches[a]&&h.push(this._mergedSymbolSourceCaches[a]),h}updateSourceCaches(){let a=this._changes.getUpdatedSourceCaches();for(let h in a){let _=a[h];_==="reload"?this.reloadSource(h):_==="clear"&&this.clearSource(h)}}updateLayers(a){let h=this._changes.getUpdatedPaintProperties();for(let _ of h){let x=this.getLayer(_);x&&x.updateTransitions(a)}}getImages(a,h,_){this.imageManager.getImages(h.icons,h.scope,_),this._updateTilesForChangedImages();let x=C=>{C&&C.setDependencies(h.tileID.key,h.type,h.icons)};x(this._otherSourceCaches[h.source]),x(this._symbolSourceCaches[h.source])}getGlyphs(a,h,_){this.glyphManager.getGlyphs(h.stacks,h.scope,_)}getResource(a,h,_){return t.c$(h,_)}getOwnSourceCache(a){return this._otherSourceCaches[a]}getOwnLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}getOwnSourceCaches(a){let h=[];return this._otherSourceCaches[a]&&h.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&h.push(this._symbolSourceCaches[a]),h}_isSourceCacheLoaded(a){let h=this.getOwnSourceCaches(a);return h.length===0?(this.fire(new t.d(new Error(`There is no source with ID '${a}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(a,h){if(this._clipLayerIndices.length===0&&a.type!=="fill-extrusion")return!1;let _=a.type==="fill-extrusion"&&a.sourceLayer==="building",x=0;if(a.is3D()){if(_||h&&h.type==="batched-model")return!0;a.type==="model"&&(x=t.cu.Model)}else a.type==="symbol"&&(x=t.cu.Symbol);for(let C of this._clipLayerIndices){let T=this._mergedLayers[this._mergedOrder[C]];if(!T)continue;let E=[];for(let P of T.layout.get("clip-layer-types"))E.push(P==="model"?t.cu.Model:P==="symbol"?t.cu.Symbol:t.cu.FillExtrusion);for(let P of E)if(x&P)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(a=>{a.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Kh(f,a){let h=!1,_=null,x=()=>{_=null,h&&(f(),_=setTimeout(x,a),h=!1)};return()=>(h=!0,_||x(),_)}Er.getSourceType=function(f){return Eo[f]},Er.setSourceType=function(f,a){Eo[f]=a},Er.registerForPluginStateChange=t.cL;class l_{constructor(a){this._hashName=a&&encodeURIComponent(a),t.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Kh(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let a=this._map;if(!a)return"";let h=Ba(a);if(this._hashName){let _=this._hashName,x=!1,C=location.hash.slice(1).split("&").map(T=>{let E=T.split("=")[0];return E===_?(x=!0,`${E}=${h}`):T}).filter(T=>T);return x||C.push(`${_}=${h}`),`#${C.join("&")}`}return`#${h}`}_getCurrentHash(){let a=location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return a.split("/")}_onHashChange(){let a=this._map;if(!a)return!1;let h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){let _=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(h[3]||0):a.getBearing();return a.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ba(f,a){let h=f.getCenter(),_=Math.round(100*f.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,x),T=Math.round(h.lng*C)/C,E=Math.round(h.lat*C)/C,P=f.getBearing(),O=f.getPitch(),B=a?`/${T}/${E}/${_}`:`${_}/${E}/${T}`;return(P||O)&&(B+="/"+Math.round(10*P)/10),O&&(B+=`/${Math.round(O)}`),B}let Pu={linearity:.3,easing:t.d0(0,0,.3,1)},Jh=t.W({deceleration:2500,maxSpeed:1400},Pu),Zl=t.W({deceleration:20,maxSpeed:1400},Pu),em=t.W({deceleration:1e3,maxSpeed:360},Pu),aa=t.W({deceleration:1e3,maxSpeed:90},Pu);class Xl{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.e.now(),settings:a})}_drainInertiaBuffer(){let a=this._inertiaBuffer,h=t.e.now();for(;a.length>0&&h-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let h={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:C}of this._inertiaBuffer)h.zoom+=C.zoomDelta||0,h.bearing+=C.bearingDelta||0,h.pitch+=C.pitchDelta||0,C.panDelta&&h.pan._add(C.panDelta),C.around&&(h.around=C.around),C.pinchAround&&(h.pinchAround=C.pinchAround);let _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){let C=tm(h.pan.mag(),_,t.W({},Jh,a||{}));x.offset=h.pan.mult(C.amount/h.pan.mag()),x.center=this._map.transform.center,Ou(x,C)}if(h.zoom){let C=tm(h.zoom,_,Zl);x.zoom=this._map.transform.zoom+C.amount,Ou(x,C)}if(h.bearing){let C=tm(h.bearing,_,em);x.bearing=this._map.transform.bearing+t.at(C.amount,-179,179),Ou(x,C)}if(h.pitch){let C=tm(h.pitch,_,aa);x.pitch=this._map.transform.pitch+C.amount,Ou(x,C)}if(x.zoom||x.bearing){let C=h.pinchAround===void 0?h.around:h.pinchAround;x.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Ou(f,a){(!f.duration||f.duration<a.duration)&&(f.duration=a.duration,f.easing=a.easing)}function tm(f,a,h){let{maxSpeed:_,linearity:x,deceleration:C}=h,T=t.at(f*x/(a/1e3),-_,_),E=Math.abs(T)/(C*x);return{easing:h.easing,duration:1e3*E,amount:T*(E/2)}}class Ho extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_,x={}){let C=_t(h.getCanvasContainer(),_),T=h.unproject(C);super(a,t.W({point:C,lngLat:T,originalEvent:_},x)),this._defaultPrevented=!1,this.target=h}}class sl extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_){let x=a==="touchend"?_.changedTouches:_.touches,C=Nt(h.getCanvasContainer(),x),T=C.map(P=>h.unproject(P)),E=C.reduce((P,O,B,j)=>P.add(O.div(j.length)),new t.P(0,0));super(a,{points:C,point:E,lngLats:T,lngLat:h.unproject(E),originalEvent:_}),this._defaultPrevented=!1}}class fp extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_){super(a,{originalEvent:_}),this._defaultPrevented=!1}}class gd{constructor(a,h){this._map=a,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new fp(a.type,this._map,a))}mousedown(a,h){return this._mousedownPos=h,this._firePreventable(new Ho(a.type,this._map,a))}mouseup(a){this._map.fire(new Ho(a.type,this._map,a))}preclick(a){let h=t.W({},a);h.type="preclick",this._map.fire(new Ho(h.type,this._map,h))}click(a,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Ho(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Ho(a.type,this._map,a))}mouseover(a){this._map.fire(new Ho(a.type,this._map,a))}mouseout(a){this._map.fire(new Ho(a.type,this._map,a))}touchstart(a){return this._firePreventable(new sl(a.type,this._map,a))}touchmove(a){this._map.fire(new sl(a.type,this._map,a))}touchend(a){this._map.fire(new sl(a.type,this._map,a))}touchcancel(a){this._map.fire(new sl(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ru{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Ho(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ho("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Ho(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gp{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,h){this.isEnabled()&&a.shiftKey&&a.button===0&&(Pe(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(a,h){if(!this._active)return;let _=h,x=this._startPos,C=this._lastPos;if(!x||!C||C.equals(_)||!this._box&&_.dist(x)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=N("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));let T=Math.min(x.x,_.x),E=Math.max(x.x,_.x),P=Math.min(x.y,_.y),O=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${P}px)`,this._box.style.width=E-T+"px",this._box.style.height=O-P+"px")})}mouseupWindow(a,h){if(!this._active)return;let _=this._startPos,x=h;if(_&&a.button===0){if(this.reset(),Je(),_.x!==x.x||_.y!==x.y)return this._map.fire(new t.f("boxzoomend",{originalEvent:a})),{cameraAnimation:C=>C.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Re(),delete this._startPos,delete this._lastPos}_fireEvent(a,h){return this._map.fire(new t.f(a,{originalEvent:h}))}}function im(f,a){let h={};for(let _=0;_<f.length;_++)h[f[_].identifier]=a[_];return h}class Fu{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){let C=new t.P(0,0);for(let T of x)C._add(T);return C.div(x.length)}(h),this.touches=im(_,h)))}touchmove(a,h,_){if(this.aborted||!this.centroid)return;let x=im(_,h);for(let C in this.touches){let T=x[C];(!T||T.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(a,h,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){let x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class nm{constructor(a){this.singleTap=new Fu(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,h,_){this.singleTap.touchstart(a,h,_)}touchmove(a,h,_){this.singleTap.touchmove(a,h,_)}touchend(a,h,_){let x=this.singleTap.touchend(a,h,_);if(x){let C=a.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(x)<30;if(C&&T||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class _p{constructor(){this._zoomIn=new nm({numTouches:1,numTaps:2}),this._zoomOut=new nm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,h,_){this._zoomIn.touchstart(a,h,_),this._zoomOut.touchstart(a,h,_)}touchmove(a,h,_){this._zoomIn.touchmove(a,h,_),this._zoomOut.touchmove(a,h,_)}touchend(a,h,_){let x=this._zoomIn.touchend(a,h,_),C=this._zoomOut.touchend(a,h,_);return x?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(x)},{originalEvent:a})}):C?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(C)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let _d={0:1,2:2};class rm{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,h){return!1}_move(a,h){return{}}mousedown(a,h){if(this._lastPoint)return;let _=kt(a);this._correctButton(a,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(a,h){let _=this._lastPoint;if(_){if(a.preventDefault(),this._eventButton!=null&&function(x,C){let T=_d[C];return x.buttons===void 0||(x.buttons&T)!==T}(a,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}}mouseupWindow(a){this._lastPoint&&kt(a)===this._eventButton&&(this._moved&&Je(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class c_ extends rm{mousedown(a,h){super.mousedown(a,h),this._lastPoint&&(this._active=!0)}_correctButton(a,h){return h===0&&!a.ctrlKey}_move(a,h){return{around:h,panDelta:h.sub(a)}}}class Gf extends rm{_correctButton(a,h){return h===0&&a.ctrlKey||h===2}_move(a,h){let _=.8*(h.x-a.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(a){a.preventDefault()}}class bd extends rm{_correctButton(a,h){return h===0&&a.ctrlKey||h===2}_move(a,h){let _=-.5*(h.y-a.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(a){a.preventDefault()}}class qf{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),t.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}touchstart(a,h,_){return this._calculateTransform(a,h,_)}touchmove(a,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!t.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,h,_)}}touchend(a,h,_){this._calculateTransform(a,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,h,_){_.length>0&&(this._active=!0);let x=im(_,h),C=new t.P(0,0),T=new t.P(0,0),E=0;for(let O in x){let B=x[O],j=this._touches[O];j&&(C._add(B),T._add(B.sub(j)),E++,x[O]=B)}if(this._touches=x,E<this._minTouches||!T.mag())return;let P=T.div(E);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(E),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class om{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,h,_){return{}}touchstart(a,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(a,h,_){let x=this._firstTwoTouches;if(!x)return;a.preventDefault();let[C,T]=x,E=bp(_,h,C),P=bp(_,h,T);if(!E||!P)return;let O=this._aroundCenter?null:E.add(P).div(2);return this._move([E,P],O,a)}touchend(a,h,_){if(!this._firstTwoTouches)return;let[x,C]=this._firstTwoTouches,T=bp(_,h,x),E=bp(_,h,C);T&&E||(this._active&&Je(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function bp(f,a,h){for(let _=0;_<f.length;_++)if(f[_].identifier===h)return a[_]}function yp(f,a){return Math.log(f/a)/Math.LN2}class vp extends om{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,h){let _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(yp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yp(this._distance,_),pinchAround:h}}}function am(f,a){return 180*f.angleWith(a)/Math.PI}class xp extends om{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,h){let _=this._vector;if(this._vector=a[0].sub(a[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:am(this._vector,_),pinchAround:h}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());let h=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;let x=am(a,_);return Math.abs(x)<h}}function kc(f){return Math.abs(f.y)>Math.abs(f.x)}class d_ extends om{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,kc(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,h,_){let x=this._lastPoints;if(!x)return;let C=a[0].sub(x[0]),T=a[1].sub(x[1]);return this._map._cooperativeGestures&&!t.d1()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(C,T,_.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(C.y+T.y)/2*-.5})}gestureBeginsVertically(a,h,_){if(this._valid!==void 0)return this._valid;let x=a.mag()>=2,C=h.mag()>=2;if(!x&&!C)return;if(!x||!C)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;let T=a.y>0==h.y>0;return kc(a)&&kc(h)&&T}}let $f={panStep:100,bearingStep:15,pitchStep:10};class u_{constructor(){let a=$f;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let h=0,_=0,x=0,C=0,T=0;switch(a.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),C=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),C=1);break;case 38:a.shiftKey?x=1:(a.preventDefault(),T=-1);break;case 40:a.shiftKey?x=-1:(a.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:E=>{let P=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:sm,zoom:h?Math.round(P)+h*(a.shiftKey?2:1):P,bearing:E.getBearing()+_*this._bearingStep,pitch:E.getPitch()+x*this._pitchStep,offset:[-C*this._panStep,-T*this._panStep],center:E.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function sm(f){return f*(2-f)}let yd=4.000244140625,h_=1/450;class Ma{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=h_,t.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||t.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY,_=t.e.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,h!==0&&h%yd==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),a.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=a,this._delta-=h,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let h=_t(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let h=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){let O=this._type==="wheel"&&Math.abs(this._delta)>yd?this._wheelZoomRate:this._defaultZoomRate,B=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&B!==0&&(B=1/B);let j=h(),G=Math.pow(2,j),q=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):G;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(q*B))),this._type==="wheel"&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let _=typeof this._targetZoom=="number"?this._targetZoom:h(),x=this._startZoom,C=this._easing,T,E=!1;if(this._type==="wheel"&&x&&C){let O=Math.min((t.e.now()-this._lastWheelEventTime)/200,1),B=C(O);T=t.a2(x,_,B),O<1?this._frameId||(this._frameId=!0):E=!0}else T=_,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let P=T-h();return P*this._lastDelta<0&&(P=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:P,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let h=t.d2;if(this._prevEase){let _=this._prevEase,x=(t.e.now()-_.start)/_.duration,C=_.easing(x+.01)-_.easing(x),T=.27/Math.sqrt(C*C+1e-4)*.01,E=Math.sqrt(.0729-T*T);h=t.d0(T,E,.25,1)}return this._prevEase={start:t.e.now(),duration:a,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class wp{constructor(a,h){this._clickZoom=a,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Lu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,h){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(a.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cp{constructor(){this._tap=new nm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,h,_){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(a,h,_))}touchmove(a,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;let x=h[0],C=x.y-this._swipePoint.y;return this._swipePoint=x,a.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(a,h,_)}touchend(a,h,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(a,h,_)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lm{constructor(a,h,_){this._el=a,this._mousePan=h,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sn{constructor(a,h,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Sp{constructor(a,h,_,x){this._el=a,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let zu=f=>f.zoom||f.drag||f.pitch||f.rotate;class vd extends t.f{}class cm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,h){let _=t._.sub([],h,a);this.radius=t._.length(_[2]<0?t._.div([],_,this.constants):[_[0],_[1],0])}projectRay(a){t._.div(a,a,this.constants),t._.normalize(a,a),t._.mul(a,a,this.constants);let h=t._.scale([],a,this.radius);if(h[2]>0){let _=t._.scale([],[0,0,1],t._.dot(h,[0,0,1])),x=t._.scale([],t._.normalize([],[h[0],h[1],0]),this.radius),C=t._.add([],h,t._.scale([],t._.sub([],t._.add([],x,_),h),2));h[0]=C[0],h[1]=C[1]}return h}}function dm(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class m_{constructor(a,h){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xl(a),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),t.bp(["handleEvent","handleWindowEvent"],this);let _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(let[x,C,T]of this._listeners){let E=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(C,E,T)}}destroy(){for(let[a,h,_]of this._listeners){let x=a===document?this.handleWindowEvent:this.handleEvent;a.removeEventListener(h,x,_)}}_addDefaultHandlers(a){let h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new gd(h,a));let x=h.boxZoom=new gp(h,a);this._add("boxZoom",x);let C=new _p,T=new Lu;h.doubleClickZoom=new wp(T,C),this._add("tapZoom",C),this._add("clickZoom",T);let E=new Cp;this._add("tapDragZoom",E);let P=h.touchPitch=new d_(h);this._add("touchPitch",P);let O=new Gf(a),B=new bd(a);h.dragRotate=new Sn(a,O,B),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);let j=new c_(a),G=new qf(h,a);h.dragPan=new lm(_,j,G),this._add("mousePan",j),this._add("touchPan",G,["touchZoom","touchRotate"]);let q=new xp,K=new vp;h.touchZoomRotate=new Sp(_,K,q,E),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ru(h));let J=h.scrollZoom=new Ma(h,this);this._add("scrollZoom",J,["mousePan"]);let ee=h.keyboard=new u_;this._add("keyboard",ee);for(let te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[te]&&h[te].enable(a[te])}_add(a,h,_){this._handlers.push({handlerName:a,handler:h,allowed:_}),this._handlersById[a]=h}stop(a){if(!this._updatingCamera){for(let{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!zu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,h,_){for(let x in a)if(x!==_&&(!h||h.indexOf(x)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){let h=[];for(let _ of a)this._el.contains(_.target)&&h.push(_);return h}handleEvent(a,h){this._updatingCamera=!0;let _=a.type==="renderFrame",x=_?void 0:a,C={needsRenderFrame:!1},T={},E={},P=a.touches?this._getMapTouches(a.touches):void 0,O=P?Nt(this._el,P):_?void 0:_t(this._el,a);for(let{handlerName:G,handler:q,allowed:K}of this._handlers){if(!q.isEnabled())continue;let J;this._blockedByActive(E,K,G)?q.reset():q[h||a.type]&&(J=q[h||a.type](a,O,P),this.mergeHandlerResult(C,T,J,G,x),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||q.isActive())&&(E[G]=q)}let B={};for(let G in this._previousActiveHandlers)E[G]||(B[G]=x);this._previousActiveHandlers=E,(Object.keys(B).length||dm(C))&&(this._changes.push([C,T,B]),this._triggerRenderFrame()),(Object.keys(E).length||dm(C))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:j}=C;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(a,h,_,x,C){if(!_)return;t.W(a,_);let T={handlerName:x,originalEvent:_.originalEvent||C};_.zoomDelta!==void 0&&(h.zoom=T),_.panDelta!==void 0&&(h.drag=T),_.pitchDelta!==void 0&&(h.pitch=T),_.bearingDelta!==void 0&&(h.rotate=T)}_applyChanges(){let a={},h={},_={};for(let[x,C,T]of this._changes)x.panDelta&&(a.panDelta=(a.panDelta||new t.P(0,0))._add(x.panDelta)),x.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(a.around=x.around),x.aroundCoord!==void 0&&(a.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(a.pinchAround=x.pinchAround),x.noInertia&&(a.noInertia=x.noInertia),t.W(h,C),t.W(_,T);this._updateMapTransform(a,h,_),this._changes=[]}_updateMapTransform(a,h,_){let x=this._map,C=x.transform,T=ue=>[ue.x,ue.y,ue.z];if((ue=>{let ce=this._eventsInProgress.drag;return ce&&!this._handlersById[ce.handlerName].isActive()})()&&!dm(a)){let ue=C.zoom;C.cameraElevationReference="sea",this._originalZoom!=null&&C._orthographicProjectionAtLowPitch&&C.projection.name!=="globe"&&C.pitch===0?(C.cameraElevationReference="ground",C.zoom=this._originalZoom):(C.recenterOnTerrain(),C.cameraElevationReference="ground"),ue!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&x._stop(!0),!dm(a))return void this._fireEvents(h,_,!0);let{panDelta:E,zoomDelta:P,bearingDelta:O,pitchDelta:B,around:j,aroundCoord:G,pinchAround:q}=a;C._isCameraConstrained&&(P>0&&(P=0),C._isCameraConstrained=!1),q!==void 0&&(j=q),(P||(ue=>h[ue]&&!this._eventsInProgress[ue])("drag"))&&j&&(this._dragOrigin=T(C.pointCoordinate3D(j)),this._originalZoom=C.zoom,this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",x._stop(!0),j=j||x.transform.centerPoint,O&&(C.bearing+=O),B&&(C.pitch+=B),C._updateCameraState();let K=[0,0,0];if(E)if(C.projection.name==="mercator"){let ue=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(j).dir),ce=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(j.sub(E)).dir);K[0]=ce[0]-ue[0],K[1]=ce[1]-ue[1]}else{let ue=C.pointCoordinate(j);if(C.projection.name==="globe"){E=E.rotate(-C.angle);let ce=C._pixelsPerMercatorPixel/C.worldSize;K[0]=-E.x*t.d3(t.ay(ue.y))*ce,K[1]=-E.y*t.d3(C.center.lat)*ce}else{let ce=C.pointCoordinate(j.sub(E));ue&&ce&&(K[0]=ce.x-ue.x,K[1]=ce.y-ue.y)}}let J=C.zoom,ee=[0,0,0];if(P){let ue=T(G||C.pointCoordinate3D(j)),ce={dir:t._.normalize([],t._.sub([],ue,C._camera.position))};if(ce.dir[2]<0){let he=C.zoomDeltaToMovement(ue,P);t._.scale(ee,ce.dir,he)}}let te=t._.add(K,K,ee);C._translateCameraConstrained(te),P&&Math.abs(C.zoom-J)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(h,_,!0)}_fireEvents(a,h,_){let x=zu(this._eventsInProgress),C=zu(a),T={};for(let B in a){let{originalEvent:j}=a[B];this._eventsInProgress[B]||(T[`${B}start`]=j),this._eventsInProgress[B]=a[B]}!x&&C&&this._fireEvent("movestart",C.originalEvent);for(let B in T)this._fireEvent(B,T[B]);C&&this._fireEvent("move",C.originalEvent);for(let B in a){let{originalEvent:j}=a[B];this._fireEvent(B,j)}let E={},P;for(let B in this._eventsInProgress){let{handlerName:j,originalEvent:G}=this._eventsInProgress[B];this._handlersById[j].isActive()||(delete this._eventsInProgress[B],P=h[j]||G,E[`${B}end`]=P)}for(let B in E)this._fireEvent(B,E[B]);let O=zu(this._eventsInProgress);if(_&&(x||C)&&!O){this._updatingCamera=!0;let B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;B?(j(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:P})):(this._map.fire(new t.f("moveend",{originalEvent:P})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,h){this._map.fire(new t.f(a,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new vd("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Go="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class pb extends t.E{constructor(a,h){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,t.bp(["_renderFrameCallback"],this)}getCenter(){return new t.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(a,h){return this.jumpTo({center:a},h)}panBy(a,h,_){return a=t.P.convert(a).mult(-1),this.panTo(this.transform.center,t.W({offset:a},h),_)}panTo(a,h,_){return this.easeTo(t.W({center:a},h),_)}getZoom(){return this.transform.zoom}setZoom(a,h){return this.jumpTo({zoom:a},h),this}zoomTo(a,h,_){return this.easeTo(t.W({zoom:a},h),_)}zoomIn(a,h){return this.zoomTo(this.getZoom()+1,a,h),this}zoomOut(a,h){return this.zoomTo(this.getZoom()-1,a,h),this}getBearing(){return this.transform.bearing}setBearing(a,h){return this.jumpTo({bearing:a},h),this}getPadding(){return this.transform.padding}setPadding(a,h){return this.jumpTo({padding:a},h),this}rotateTo(a,h,_){return this.easeTo(t.W({bearing:a},h),_)}resetNorth(a,h){return this.rotateTo(0,t.W({duration:1e3},a),h),this}resetNorthPitch(a,h){return this.easeTo(t.W({bearing:0,pitch:0,duration:1e3},a),h),this}snapToNorth(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this}getPitch(){return this.transform.pitch}setPitch(a,h){return this.jumpTo({pitch:a},h),this}cameraForBounds(a,h){a=t.ai.convert(a);let _=h&&h.bearing||0,x=h&&h.pitch||0,C=a.getNorthWest(),T=a.getSouthEast();return this._cameraForBounds(this.transform,C,T,_,x,h)}_extendPadding(a){let h={top:0,right:0,bottom:0,left:0};return a==null?t.W({},h,this.transform.padding):typeof a=="number"?{top:a,bottom:a,right:a,left:a}:t.W({},h,a)}_extendCameraOptions(a){return(a=t.W({offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=this._extendPadding(a.padding),a}_minimumAABBFrustumDistance(a,h){let _=h.max[0]-h.min[0],x=h.max[1]-h.min[1];return _/x>a.aspect?_/(2*Math.tan(.5*a.fovX)*a.aspect):x/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,h,_,x,C,T){let E=a.clone(),P=this._extendCameraOptions(T);E.bearing=x,E.pitch=C;let O=t.aI.convert(h),B=t.aI.convert(_),j=.5*(O.lat+B.lat),G=.5*(O.lng+B.lng),q=t.d4(j,G),K=t._.normalize([],q),J=t._.normalize([],t._.cross([],K,[0,1,0])),ee=t._.cross([],J,K),te=[J[0],J[1],J[2],0,ee[0],ee[1],ee[2],0,K[0],K[1],K[2],0,0,0,0,1],ue=[q,t.d4(O.lat,O.lng),t.d4(B.lat,O.lng),t.d4(B.lat,B.lng),t.d4(O.lat,B.lng),t.d4(j,O.lng),t.d4(j,B.lng),t.d4(O.lat,G),t.d4(B.lat,G)],ce=t.b6.fromPoints(ue.map(rt=>[t._.dot(J,rt),t._.dot(ee,rt),t._.dot(K,rt)])),he=t._.transformMat4([],ce.center,te);t._.squaredLength(he)===0&&t._.set(he,0,0,1),t._.normalize(he,he),t._.scale(he,he,t.cD),E.center=t.d5(he);let Ce=E.getWorldToCameraMatrix(),we=t.ad.invert(new Float64Array(16),Ce);ce=t.b6.applyTransform(ce,t.ad.multiply([],Ce,te));let de=this._extendAABB(ce,E,P,x);if(!de)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=de,t._.transformMat4(he,he,Ce);let me=.5*(ce.max[2]-ce.min[2]),fe=this._minimumAABBFrustumDistance(E,ce),Ee=t._.scale([],[0,0,1],me),We=t._.add(Ee,he,Ee),ye=fe+(E.pitch===0?0:t._.distance(he,We)),He=E.globeCenterInViewSpace,qe=t._.sub([],he,[He[0],He[1],He[2]]);t._.normalize(qe,qe),t._.scale(qe,qe,ye);let ct=t._.add([],he,qe);t._.transformMat4(ct,ct,we);let ut=t.d7/t.cD,lt=t._.length(ct),Le=t.ax(Math.max(lt*ut-t.d7,Number.EPSILON),0),Ze=Math.min(E.zoomFromMercatorZAdjusted(Le),P.maxZoom);return Ze>.5*(t.b1+t.aU)?(E.setProjection({name:"mercator"}),E.zoom=Ze,this._cameraForBounds(E,h,_,x,C,T)):{center:E.center,zoom:Ze,bearing:x,pitch:C}}_extendAABB(a,h,_,x){let C=.5*((_.padding.left||0)+(_.padding.right||0)),T=.5*((_.padding.top||0)+(_.padding.bottom||0)),E=T,P=C,O=C,B=T,j=h.width-(P+O),G=h.height-(E+B),q=t._.sub([],a.max,a.min),K=Math.min(j/q[0],G/q[1]),J=Math.min(h.scaleZoom(h.scale*K),_.maxZoom);if(isNaN(J))return null;let ee=h.scale/h.zoomScale(J),te=new t.b6([a.min[0]-P*ee,a.min[1]-B*ee,a.min[2]],[a.max[0]+O*ee,a.max[1]+E*ee,a.max[2]]),ue=(typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new t.P(_.offset.x,_.offset.y):t.P.convert(_.offset)).rotate(-t.ab(x));return te.center[0]-=ue.x*ee,te.center[1]+=ue.y*ee,te}queryTerrainElevation(a,h){let _=this.transform.elevation;return _?(h=t.W({},{exaggerated:!0},h),_.getAtPoint(t.Y.fromLngLat(a),null,h.exaggerated)):null}_cameraForBounds(a,h,_,x,C,T){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,h,_,x,C,T);let E=a.clone(),P=this._extendCameraOptions(T);E.bearing=x,E.pitch=C;let O=t.aI.convert(h),B=t.aI.convert(_),j=new t.aI(O.lng,B.lat),G=new t.aI(B.lng,O.lat),q=E.project(O),K=E.project(B),J=this.queryTerrainElevation(O),ee=this.queryTerrainElevation(B),te=this.queryTerrainElevation(j),ue=this.queryTerrainElevation(G),ce=[[q.x,q.y,Math.min(J||0,ee||0,te||0,ue||0)],[K.x,K.y,Math.max(J||0,ee||0,te||0,ue||0)]],he=t.b6.fromPoints(ce),Ce=E.getWorldToCameraMatrix(),we=t.ad.invert(new Float64Array(16),Ce);he=t.b6.applyTransform(he,Ce);let de=this._extendAABB(he,E,P,x);if(!de)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");he=de;let me=.5*t._.sub([],he.max,he.min)[2],fe=this._minimumAABBFrustumDistance(E,he),Ee=[0,0,1,0];t.aA.transformMat4(Ee,Ee,Ce),t.aA.normalize(Ee,Ee);let We=t._.scale([],Ee,fe+me),ye=t._.add([],he.center,We);t._.transformMat4(he.center,he.center,we),t._.transformMat4(ye,ye,we);let He=[he.center[0],he.center[1],ye[2]*E.pixelsPerMeter];t._.scale(He,He,1/E.worldSize);let qe=t.d6(He[0]),ct=t.ay(He[1]),ut=Math.min(E._zoomFromMercatorZ(He[2]),P.maxZoom),lt=new t.aI(qe,ct);return E.mercatorFromTransition&&ut<.5*(t.b1+t.aU)?(E.setProjection({name:"globe"}),E.zoom=ut,this._cameraForBounds(E,h,_,x,C,T)):{center:lt,zoom:ut,bearing:x,pitch:C}}fitBounds(a,h,_){let x=this.cameraForBounds(a,h);return this._fitInternal(x,h,_)}fitScreenCoordinates(a,h,_,x,C){let T=t.P.convert(a),E=t.P.convert(h),P=new t.P(Math.min(T.x,E.x),Math.min(T.y,E.y)),O=new t.P(Math.max(T.x,E.x),Math.max(T.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,E))return this;let B=this.transform.pointLocation3D(P),j=this.transform.pointLocation3D(O),G=this.transform.pointLocation3D(new t.P(P.x,O.y)),q=this.transform.pointLocation3D(new t.P(O.x,P.y)),K=[Math.min(B.lng,j.lng,G.lng,q.lng),Math.min(B.lat,j.lat,G.lat,q.lat)],J=[Math.max(B.lng,j.lng,G.lng,q.lng),Math.max(B.lat,j.lat,G.lat,q.lat)],ee=x&&x.pitch?x.pitch:this.getPitch(),te=this._cameraForBounds(this.transform,K,J,_,ee,x);return this._fitInternal(te,x,C)}_fitInternal(a,h,_){return a?(h=t.W(a,h)).linear?this.easeTo(h,_):this.flyTo(h,_):this}jumpTo(a,h){this.stop();let _=a.preloadOnly?this.transform.clone():this.transform,x=!1,C=!1,T=!1;return"zoom"in a&&_.zoom!==+a.zoom&&(x=!0,_.zoom=+a.zoom),a.center!==void 0&&(_.center=t.aI.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(C=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(T=!0,_.pitch=+a.pitch),a.padding==null||_.isPaddingEqual(a.padding)||(_.padding=a.padding),a.preloadOnly?(this._preloadTiles(_),this):(this.fire(new t.f("movestart",h)).fire(new t.f("move",h)),x&&this.fire(new t.f("zoomstart",h)).fire(new t.f("zoom",h)).fire(new t.f("zoomend",h)),C&&this.fire(new t.f("rotatestart",h)).fire(new t.f("rotate",h)).fire(new t.f("rotateend",h)),T&&this.fire(new t.f("pitchstart",h)).fire(new t.f("pitch",h)).fire(new t.f("pitchend",h)),this.fire(new t.f("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.w(Go),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,h){let _=this.transform;if(!_.projection.supportsFreeCamera)return t.w(Go),this;this.stop();let x=_.zoom,C=_.pitch,T=_.bearing;_.setFreeCameraOptions(a);let E=x!==_.zoom,P=C!==_.pitch,O=T!==_.bearing;return this.fire(new t.f("movestart",h)).fire(new t.f("move",h)),E&&this.fire(new t.f("zoomstart",h)).fire(new t.f("zoom",h)).fire(new t.f("zoomend",h)),O&&this.fire(new t.f("rotatestart",h)).fire(new t.f("rotate",h)).fire(new t.f("rotateend",h)),P&&this.fire(new t.f("pitchstart",h)).fire(new t.f("pitch",h)).fire(new t.f("pitchend",h)),this.fire(new t.f("moveend",h)),this}easeTo(a,h){this._stop(!1,a.easeId),((a=t.W({offset:[0,0],duration:500,easing:t.d2},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);let _=this.transform,x=this.getZoom(),C=this.getBearing(),T=this.getPitch(),E=this.getPadding(),P="zoom"in a?+a.zoom:x,O="bearing"in a?this._normalizeBearing(a.bearing,C):C,B="pitch"in a?+a.pitch:T,j=this._extendPadding(a.padding),G=t.P.convert(a.offset),q,K,J;if(_.projection.name==="globe"){let fe=t.Y.fromLngLat(_.center),Ee=G.rotate(-_.angle);fe.x+=Ee.x/_.worldSize,fe.y+=Ee.y/_.worldSize;let We=fe.toLngLat(),ye=t.aI.convert(a.center||We);this._normalizeCenter(ye),q=_.centerPoint.add(Ee),K=new t.P(fe.x,fe.y).mult(_.worldSize),J=new t.P(t.aj(ye.lng),t.ak(ye.lat)).mult(_.worldSize).sub(K)}else{q=_.centerPoint.add(G);let fe=_.pointLocation(q),Ee=t.aI.convert(a.center||fe);this._normalizeCenter(Ee),K=_.project(fe),J=_.project(Ee).sub(K)}let ee=_.zoomScale(P-x),te,ue;a.around&&(te=t.aI.convert(a.around),ue=_.locationPoint(te));let ce=this._zooming||P!==x,he=this._rotating||C!==O,Ce=this._pitching||B!==T,we=!_.isPaddingEqual(j),de=fe=>Ee=>{if(ce&&(fe.zoom=t.a2(x,P,Ee)),he&&(fe.bearing=t.a2(C,O,Ee)),Ce&&(fe.pitch=t.a2(T,B,Ee)),we&&(fe.interpolatePadding(E,j,Ee),q=fe.centerPoint.add(G)),te)fe.setLocationAtPoint(te,ue);else{let We=fe.zoomScale(fe.zoom-x),ye=P>x?Math.min(2,ee):Math.max(.5,ee),He=Math.pow(ye,1-Ee),qe=fe.unproject(K.add(J.mult(Ee*He)).mult(We));fe.setLocationAtPoint(fe.renderWorldCopies?qe.wrap():qe,q)}return a.preloadOnly||this._fireMoveEvents(h),fe};if(a.preloadOnly){let fe=this._emulate(de,a.duration,_);return this._preloadTiles(fe),this}let me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ce,this._rotating=he,this._pitching=Ce,this._padding=we,this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,me),this._ease(de(_),fe=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(h,fe)},a),this}_prepareEase(a,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||_.moving||this.fire(new t.f("movestart",a)),this._zooming&&!_.zooming&&this.fire(new t.f("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new t.f("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new t.f("pitchstart",a))}_fireMoveEvents(a){this.fire(new t.f("move",a)),this._zooming&&this.fire(new t.f("zoom",a)),this._rotating&&this.fire(new t.f("rotate",a)),this._pitching&&this.fire(new t.f("pitch",a))}_afterEase(a,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let _=this._zooming,x=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new t.f("zoomend",a)),x&&this.fire(new t.f("rotateend",a)),C&&this.fire(new t.f("pitchend",a)),this.fire(new t.f("moveend",a))}flyTo(a,h){if(this._prefersReducedMotion(a)){let Ze=t.ah(a,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Ze,h)}this.stop(),a=t.W({offset:[0,0],speed:1.2,curve:1.42,easing:t.d2},a);let _=this.transform,x=this.getZoom(),C=this.getBearing(),T=this.getPitch(),E=this.getPadding(),P="zoom"in a?t.at(+a.zoom,_.minZoom,_.maxZoom):x,O="bearing"in a?this._normalizeBearing(a.bearing,C):C,B="pitch"in a?+a.pitch:T,j=this._extendPadding(a.padding),G=_.zoomScale(P-x),q=t.P.convert(a.offset),K=_.centerPoint.add(q),J=_.pointLocation(K),ee=t.aI.convert(a.center||J);this._normalizeCenter(ee);let te=_.project(J),ue=_.project(ee).sub(te),ce=a.curve,he=Math.max(_.width,_.height),Ce=he/G,we=ue.mag();if("minZoom"in a){let Ze=t.at(Math.min(a.minZoom,x,P),_.minZoom,_.maxZoom),rt=he/_.zoomScale(Ze-x);ce=Math.sqrt(rt/we*2)}let de=ce*ce;function me(Ze){let rt=(Ce*Ce-he*he+(Ze?-1:1)*de*de*we*we)/(2*(Ze?Ce:he)*de*we);return Math.log(Math.sqrt(rt*rt+1)-rt)}function fe(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Ee(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}let We=me(0),ye=function(Ze){return Ee(We)/Ee(We+ce*Ze)},He=function(Ze){return he*((Ee(We)*(fe(rt=We+ce*Ze)/Ee(rt))-fe(We))/de)/we;var rt},qe=(me(1)-We)/ce;if(Math.abs(we)<1e-6||!isFinite(qe)){if(Math.abs(he-Ce)<1e-6)return this.easeTo(a,h);let Ze=Ce<he?-1:1;qe=Math.abs(Math.log(Ce/he))/ce,He=function(){return 0},ye=function(rt){return Math.exp(Ze*ce*rt)}}a.duration="duration"in a?+a.duration:1e3*qe/("screenSpeed"in a?+a.screenSpeed/ce:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);let ct=C!==O,ut=B!==T,lt=!_.isPaddingEqual(j),Le=Ze=>rt=>{let Ot=rt*qe,Rt=1/ye(Ot);Ze.zoom=rt===1?P:x+Ze.scaleZoom(Rt),ct&&(Ze.bearing=t.a2(C,O,rt)),ut&&(Ze.pitch=t.a2(T,B,rt)),lt&&(Ze.interpolatePadding(E,j,rt),K=Ze.centerPoint.add(q));let Wt=rt===1?ee:Ze.unproject(te.add(ue.mult(He(Ot))).mult(Rt));return Ze.setLocationAtPoint(Ze.renderWorldCopies?Wt.wrap():Wt,K),Ze._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(h),Ze};if(a.preloadOnly){let Ze=this._emulate(Le,a.duration,_);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=ct,this._pitching=ut,this._padding=lt,this._prepareEase(h,!1),this._ease(Le(_),()=>this._afterEase(h),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(a){}_cancelRenderFrame(a){}_stop(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!a){let _=this.handlers;_&&_.stop(!1)}return this}_ease(a,h,_){_.animate===!1||_.duration===0?(a(1),h()):(this._easeStart=t.e.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let a=Math.min((t.e.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,h){a=t.au(a,-180,180);let _=Math.abs(a-h);return Math.abs(a-360-h)<_&&(a-=360),Math.abs(a+360-h)<_&&(a+=360),a}_normalizeCenter(a){let h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;let _=a.lng-h.center.lng;a.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&t.e.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,h,_){let x=Math.ceil(15*h/1e3),C=[],T=a(_.clone());for(let E=0;E<=x;E++){let P=T(E/x);C.push(P.clone())}return C}_preloadTiles(a,h){}}class um{constructor(a={}){this.options=a,t.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){let h=this.options&&this.options.compact;return this._map=a,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=N("button","mapboxgl-ctrl-attrib-button",this._container),N("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,h){let _=this._map._getUIString(`AttributionControl.${h}`);a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));let h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.d8.ACCESS_TOKEN}];if(a){let _=h.reduce((x,C,T)=>(C.value&&(x+=`${C.key}=${C.value}${T<h.length-1?"&":""}`),x),"?");a.href=`${t.d8.FEEDBACK_URL}/${_}#${Ba(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){let x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}let h=this._map.style._mergedSourceCaches;for(let x in h){let C=h[x];if(C.used){let T=C.getSource();T.attribution&&a.indexOf(T.attribution)<0&&a.push(T.attribution)}}a.sort((x,C)=>x.length-C.length),a=a.filter((x,C)=>{for(let T=C+1;T<a.length;T++)if(a[T].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));let _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ip{constructor(){t.bp(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=N("div","mapboxgl-ctrl");let h=N("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(let h in a){let _=a[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){let a=this._container.children;if(a.length){let h=a[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Yf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){let h=++this._id;return this._queue.push({callback:a,id:h,cancelled:!1}),h}remove(a){let h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(let x of _)if(x.id===a)return void(x.cancelled=!0)}run(a=0){let h=this._currentlyRunning=this._queue;this._queue=[];for(let _ of h)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Zf(f,a,h){if(f=new t.aI(f.lng,f.lat),a){let _=new t.aI(f.lng-360,f.lat),x=new t.aI(f.lng+360,f.lat),C=360*Math.ceil(Math.abs(f.lng-h.center.lng)/360),T=h.locationPoint(f).distSqr(a),E=a.x<0||a.y<0||a.x>h.width||a.y>h.height;h.locationPoint(_).distSqr(a)<T&&(E||Math.abs(_.lng-h.center.lng)<C)?f=_:h.locationPoint(x).distSqr(a)<T&&(E||Math.abs(x.lng-h.center.lng)<C)&&(f=x)}for(;Math.abs(f.lng-h.center.lng)>180;){let _=h.locationPoint(f);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}let ka={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class bs extends t.E{constructor(a,h){if(super(),(a instanceof HTMLElement||h)&&(a=t.W({element:a},h)),t.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=t.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=N("div");let C=41,T=27,E=Q("svg",{display:"block",height:C*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${C}`},this._element),P=Q("radialGradient",{id:"shadowGradient"},Q("defs",{},E));Q("stop",{offset:"10%","stop-opacity":.4},P),Q("stop",{offset:"100%","stop-opacity":.05},P),Q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),Q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),Q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),Q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=t.P.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",C=>{C.preventDefault()}),this._element.addEventListener("mousedown",C=>{C.preventDefault()});let _=this._element.classList;for(let C in ka)_.remove(`mapboxgl-marker-anchor-${C}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`);let x=a&&a.className?a.className.trim().split(/\s+/):[];_.add(...x),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){let a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=t.aI.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){let x=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){let h=a.code,_=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(a){let h=a.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let a=this._map,h=this._pos;if(!a||!h)return!1;let _=a.unproject(h),x=a.getFreeCameraOptions();if(!x.position)return!1;let C=x.position.toLngLat();return C.distanceTo(_)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){let a=this._map;if(!a)return;let h=this._pos;if(!h||h.x<0||h.x>a.transform.width||h.y<0||h.y>a.transform.height)return void this._clearFadeTimer();let _=a.unproject(h),x;a._showingGlobe()&&t.d9(a.transform,this._lngLat)?x=0:(x=1-a._queryFogOpacity(_),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let a=this._pos;if(!a||!this._map)return;let h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${ka[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){let a=this._pos,h=this._map,_=this.getPitchAlignment();if(!h||!a||_!=="map")return"";if(!h._showingGlobe()){let P=h.getPitch();return P?`rotateX(${P}deg)`:""}let x=t.b0(t.da(h.transform,this._lngLat)),C=a.sub(t.db(h.transform)),T=Math.abs(C.x)+Math.abs(C.y);if(T===0)return"";let E=x/T;return`rotateX(${-C.y*E}deg) rotateY(${C.x*E}deg)`}_calculateZTransform(){let a=this._pos,h=this._map;if(!h||!a)return"";let _=0,x=this.getRotationAlignment();if(x==="map")if(h._showingGlobe()){let C=h.project(new t.aI(this._lngLat.lng,this._lngLat.lat+.001)),T=h.project(new t.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(C);_=t.b0(Math.atan2(T.y,T.x))-90}else _=-h.getBearing();else if(x==="horizon"){let C=t.$(4,6,h.getZoom()),T=t.db(h.transform);T.y+=C*h.transform.height;let E=a.sub(T),P=t.b0(Math.atan2(E.y,E.x));_=(P>90?P-270:P+90)*(1-C)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(a){cancelAnimationFrame(this._updateFrameId);let h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Zf(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),a===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=t.P.convert(a),this._update(),this}addClassName(a){return this._element.classList.add(a),this}removeClassName(a){return this._element.classList.remove(a),this}toggleClassName(a){return this._element.classList.toggle(a)}_onMove(a){let h=this._map;if(!h)return;let _=this._pointerdownPos,x=this._positionDelta;if(_&&x){if(!this._isDragging){let C=this._clickTolerance||h._clickTolerance;if(a.point.dist(_)<C)return;this._isDragging=!0}this._pos=a.point.sub(x),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new t.f("dragstart"))),this.fire(new t.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new t.f("dragend")),this._state="inactive"}_addDragHandler(a){let h=this._map,_=this._pos;h&&_&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(_),this._pointerdownPos=a.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;let h=this._map;return h&&(a?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let hm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Xf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ll(f=new t.P(0,0),a="bottom"){if(typeof f=="number"){let h=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(a){case"top":return new t.P(0,f);case"top-left":return new t.P(h,h);case"top-right":return new t.P(-h,h);case"bottom":return new t.P(0,-f);case"bottom-left":return new t.P(h,-h);case"bottom-right":return new t.P(-h,-h);case"left":return new t.P(f,0);case"right":return new t.P(-f,0)}return new t.P(0,0)}return f instanceof t.P||Array.isArray(f)?t.P.convert(f):t.P.convert(f[a]||[0,0])}class Qf{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;let h=t.b9((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,h,_){this._start=this.getValue(h),this._end=a,this._startTime=h,this._endTime=h+_}}let Tp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Kf{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let mm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},Ql={showCompass:!0,showZoom:!0,visualizePitch:!1};class Kl{constructor(a,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Gf({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,_&&(this.mousePitch=new bd({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),t.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(a,h){this.mouseRotate.mousedown(a,h),this.mousePitch&&this.mousePitch.mousedown(a,h),Pe()}move(a,h){let _=this.map,x=this.mouseRotate.mousemoveWindow(a,h),C=x&&x.bearingDelta;if(C&&_.setBearing(_.getBearing()+C),this.mousePitch){let T=this.mousePitch.mousemoveWindow(a,h),E=T&&T.pitchDelta;E&&_.setPitch(_.getPitch()+E)}}off(){let a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Re(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(t.W({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),_t(this.element,a)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,_t(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Nt(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=Nt(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let xd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Jl={maxWidth:100,unit:"metric"},pm={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:t.dt,supported:w,setRTLTextPlugin:t.dv,getRTLTextPluginStatus:t.dw,Map:class extends pb{constructor(f){t.dc.mark(t.dd.create);let a=f;if((f=t.W({},mm,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&t.de(window)&&(f.antialias=!1,t.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ra(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new Yf,this._domRenderTaskQueue=new Yf,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.df(),this._locale=t.W({},Tp,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Qf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new t.dg(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Dn({},f.contextCreateOptions):{},typeof f.container=="string"){let h=document.getElementById(f.container);if(!h)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=h}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&t.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),t.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Kf),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new m_(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||t.d8.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new l_(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){a.center==null&&a.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});let h=f.bounds;h&&(this.resize(),this.fitBounds(h,t.W({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new um({customAttribution:f.customAttribution})),this._logoControl=new Ip,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new t.f(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new t.f(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(f,a){if(a===void 0&&(a=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new t.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let h=f.onAdd(this);this._controls.push(f);let _=this._controlPositions[a];return a.indexOf("bottom")!==-1?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new t.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let a=this._controls.indexOf(f);return a>-1&&this._controls.splice(a,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let a=!this._moving;return a&&this.fire(new t.f("movestart",f)).fire(new t.f("move",f)),this.fire(new t.f("resize",f)),a&&this.fire(new t.f("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(t.ai.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new t.f("zoomstart")).fire(new t.f("zoom")).fire(new t.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new t.f("zoomstart")).fire(new t.f("zoom")).fire(new t.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new t.f("pitchstart")).fire(new t.f("pitch")).fire(new t.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new t.f("pitchstart")).fire(new t.f("pitch")).fire(new t.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(a=>a==="auto"?navigator.language:a):f}setLanguage(f){let a=this._parseLanguage(f);if(!this.style||a===this._language)return this;this._language=a,this.style.reloadSources();for(let h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let f=this.transform,a=f.projection.name,h;a==="globe"&&f.zoom>=t.aU?(f.setMercatorFromTransition(),h=!0):a==="mercator"&&f.zoom<t.aU&&(f.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,a){return this._updateProjection(f||a||{name:"mercator"})}_updateProjection(f){let a;return a=f.name==="globe"&&this.transform.zoom>=t.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),a&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(t.aI.convert(f))}unproject(f){return this.transform.pointLocation3D(t.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,a,h){if(f==="mouseenter"||f==="mouseover"){let _=!1,x=T=>{let E=a.filter(O=>this.getLayer(O)),P=E.length?this.queryRenderedFeatures(T.point,{layers:E}):[];P.length?_||(_=!0,h.call(this,new Ho(f,this,T.originalEvent,{features:P}))):_=!1},C=()=>{_=!1};return{layers:new Set(a),listener:h,delegates:{mousemove:x,mouseout:C}}}if(f==="mouseleave"||f==="mouseout"){let _=!1,x=T=>{let E=a.filter(P=>this.getLayer(P));(E.length?this.queryRenderedFeatures(T.point,{layers:E}):[]).length?_=!0:_&&(_=!1,h.call(this,new Ho(f,this,T.originalEvent)))},C=T=>{_&&(_=!1,h.call(this,new Ho(f,this,T.originalEvent)))};return{layers:new Set(a),listener:h,delegates:{mousemove:x,mouseout:C}}}{let _=x=>{let C=a.filter(E=>this.getLayer(E)),T=C.length?this.queryRenderedFeatures(x.point,{layers:C}):[];T.length&&(x.features=T,h.call(this,x),delete x.features)};return{layers:new Set(a),listener:h,delegates:{[f]:_}}}}on(f,a,h){if(typeof a=="function"||h===void 0)return super.on(f,a);if(Array.isArray(a)||(a=[a]),a){for(let x of a)if(!this._isValidId(x))return this}let _=this._createDelegatedListener(f,a,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(_);for(let x in _.delegates)this.on(x,_.delegates[x]);return this}once(f,a,h){if(typeof a=="function"||h===void 0)return super.once(f,a);if(Array.isArray(a)||(a=[a]),a){for(let x of a)if(!this._isValidId(x))return this}let _=this._createDelegatedListener(f,a,h);for(let x in _.delegates)this.once(x,_.delegates[x]);return this}off(f,a,h){if(typeof a=="function"||h===void 0)return super.off(f,a);let _=new Set(Array.isArray(a)?a:[a]);for(let T of _)if(!this._isValidId(T))return this;let x=(T,E)=>{if(T.size!==E.size)return!1;for(let P of T)if(!E.has(P))return!1;return!0},C=this._delegatedListeners?this._delegatedListeners[f]:void 0;return C&&(T=>{for(let E=0;E<T.length;E++){let P=T[E];if(P.listener===h&&x(P.layers,_)){for(let O in P.delegates)this.off(O,P.delegates[O]);return T.splice(E,1),this}}})(C),this}queryRenderedFeatures(f,a){if(!this.style)return[];if(a!==void 0||f===void 0||f instanceof t.P||Array.isArray(f)||(a=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],(a=a||{}).layers&&Array.isArray(a.layers)){for(let h of a.layers)if(!this._isValidId(h))return[]}return this.style.queryRenderedFeatures(f,a,this.transform)}querySourceFeatures(f,a){return this._isValidId(f)?this.style.querySourceFeatures(f,a):[]}isPointOnSurface(f){let{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&t.w(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.P.convert(f))}setStyle(f,a){return a=t.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a),this.style&&f&&a.diff!==!1&&a.localFontFamily===this._localFontFamily&&a.localIdeographFontFamily===this._localIdeographFontFamily&&!a.config?(this.style._diffStyle(f,(h,_)=>{h?(t.w(`Unable to perform style diff: ${String(h.message||h.error||h)}. Rebuilding the style from scratch.`),this._updateStyle(f,a)):_&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(f,a))}_getUIString(f){let a=this._locale[f];if(a==null)throw new Error(`Missing UI string '${f}'`);return a}_updateStyle(f,a){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){let h=t.W({},a);a&&a.config&&(h.initialConfig=a.config,delete h.config),this.style=new Er(this,h).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Er(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new t.d(new Error("IDs can't be empty."))),!1):!t.cV(f)||(this.fire(new t.d(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}addSource(f,a){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,a),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,a,h){this._lazyInitEmptyStyle(),this.style.addSourceType(f,a,h)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,a,{pixelRatio:h=1,sdf:_=!1,stretchX:x,stretchY:C,content:T}={}){if(this._lazyInitEmptyStyle(),a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap){let{width:E,height:P,data:O}=t.e.getImageData(a);this.style.addImage(f,{data:new t.i({width:E,height:P},O),pixelRatio:h,stretchX:x,stretchY:C,content:T,sdf:_,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new t.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:E,height:P}=a,O=a;this.style.addImage(f,{data:new t.i({width:E,height:P},new Uint8Array(O.data)),pixelRatio:h,stretchX:x,stretchY:C,content:T,sdf:_,version:0,userImage:O}),O.onAdd&&O.onAdd(this,f)}}updateImage(f,a){this._lazyInitEmptyStyle();let h=this.style.getImage(f);if(!h)return void this.fire(new t.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap?t.e.getImageData(a):a,{width:x,height:C,data:T}=_;if(x===void 0||C===void 0)return void this.fire(new t.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==h.data.width||C!==h.data.height)return void this.fire(new t.d(new Error(`The width and height of the updated image (${x}, ${C})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));let E=!(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap);h.data.replace(T,E),this.style.updateImage(f,h)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new t.d(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,a){t.h(this._requestManager.transformRequest(f,t.R.Image),(h,_)=>{a(h,_ instanceof HTMLImageElement?t.e.getImageData(_):_)})}listImages(){return this.style.listImages()}addModel(f,a){this._lazyInitEmptyStyle(),this.style.addModel(f,a)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new t.d(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,a){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,a),this._update(!0)):this}getSlot(f){let a=this.getLayer(f);return a&&a.slot||null}setSlot(f,a){return this.style.setSlot(f,a),this.style.mergeLayers(),this._update(!0)}addImport(f,a){return this.style.addImport(f,a),this}updateImport(f,a){return typeof a!="string"&&a.id!==f?(this.removeImport(f),this.addImport(a)):(this.style.updateImport(f,a),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,a){return this.style.moveImport(f,a),this._update(!0)}moveLayer(f,a){return this._isValidId(f)?(this.style.moveLayer(f,a),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){return this._isValidId(f)?this.style.getOwnLayer(f):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,a,h){return this._isValidId(f)?(this.style.setLayerZoomRange(f,a,h),this._update(!0)):this}setFilter(f,a,h={}){return this._isValidId(f)?(this.style.setFilter(f,a,h),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,a,h,_={}){return this._isValidId(f)?(this.style.setPaintProperty(f,a,h,_),this._update(!0)):this}getPaintProperty(f,a){return this._isValidId(f)?this.style.getPaintProperty(f,a):null}setLayoutProperty(f,a,h,_={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,a,h,_),this._update(!0)):this}getLayoutProperty(f,a){return this._isValidId(f)?this.style.getLayoutProperty(f,a):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,a){return this.style.setSchema(f,a),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,a){return this.style.setConfig(f,a),this._update(!0)}getConfigProperty(f,a){return this.style.getConfigProperty(f,a)}setConfigProperty(f,a,h){return this.style.setConfigProperty(f,a,h),this._update(!0)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){let a=f[0];a.properties?this.style.setFlatLight(a.properties,a.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,a={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.aI.convert(f),this.transform):0}setFeatureState(f,a){return this._isValidId(f.source)?(this.style.setFeatureState(f,a),this._update()):this}removeFeatureState(f,a){return this._isValidId(f.source)?(this.style.removeFeatureState(f,a),this._update()):this}getFeatureState(f){return this._isValidId(f.source)?this.style.getFeatureState(f):null}_updateContainerDimensions(){if(!this._container)return;let f=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300,h,_,x,C=this._container;for(;C&&(!_||!x);){let T=window.getComputedStyle(C).transform;T&&T!=="none"&&(h=T.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(_=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(x=h[3])),C=C.parentElement}this._containerWidth=_?Math.abs(f/_):f,this._containerHeight=x?Math.abs(a/x):a}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&t.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=N("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();let a=this._canvasContainer=N("div","mapboxgl-canvas-container",f);this._canvas=N("canvas","mapboxgl-canvas",a),this._interactive&&(a.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let h=this._controlContainer=N("div","mapboxgl-control-container",f),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=N("div",`mapboxgl-ctrl-${x}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,a){let h=t.e.devicePixelRatio||1;this._canvas.width=h*Math.ceil(f),this._canvas.height=h*Math.ceil(a),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${a}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){let a=this._markers.indexOf(f);a!==-1&&this._markers.splice(a,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){let a=this._popups.indexOf(f);a!==-1&&this._popups.splice(a,1)}_setupPainter(){let f=t.W({},w.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl2",f);a?(t.dh(a,!0),this.painter=new Xa(a,this._contextCreateOptions,this.transform,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),t.di.testSupport(a)):this.fire(new t.d(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.f("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new t.f("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let a;this.fire(new t.f("renderstart")),++this._frameId;let h=this.painter.context.extTimerQuery,_=t.e.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(a=x.createQuery(),x.beginQuery(h.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();let C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let O=this.transform.zoom,B=this.transform.pitch,j=t.e.now(),G=new t.X(O,{now:j,fadeDuration:C,pitch:B,transition:this.style.transition});this.style.update(G)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(_),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(_);let E=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,this.painter.replacementSource);if(E&&(this._placementDirty=E.needsRerender,this._occlusionOpacityChanged=E.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.dc.mark(t.dd.load),this.fire(new t.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){let O=t.e.now()-_;x.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{let B=x.getQueryParameter(a,x.QUERY_RESULT)/1e6;x.deleteQuery(a),this.fire(new t.f("gpu-timing-frame",{cpuTime:O,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){let O=this.painter.collectGpuTimers();setTimeout(()=>{let B=this.painter.queryGpuTimers(O);this.fire(new t.f("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){let O=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let B=this.painter.queryGpuTimeDeferredRender(O);this.fire(new t.f("gpu-timing-deferred-render",{gpuTime:B}))},50)}let P=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||T;if((this._sourcesDirty||this._styleDirty||T||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),P||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let O=!this.isMoving()&&this.loaded();if(O&&(T=this._updateAverageElevation(_,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new t.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let B=this._calculateSpeedIndex();this.fire(new t.f("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!P&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,t.dc.mark(t.dd.fullLoad),this._performanceMetricsCollection&&t.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(let a of this._markers)f&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(let a of this._popups)!f||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(f,a=!1){let h=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);let _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(a||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){let x=this.transform.averageElevation,C=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(C)?C=0:this._averageElevationLastSampledAt=f;let T=Math.abs(x-C);if(T>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(C),h(C);this._averageElevation.easeTo(C,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(C),h(C)}return!!this._averageElevation.isEasing(f)&&h(this._averageElevation.getValue(f))}_authenticate(){t.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===t.dl||f.status===401)){let a=this.painter.context.gl;t.dh(a,!1),this._logoControl instanceof Ip&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),t.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&t.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){let f=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());let h=this.painter.context.gl,_=h.createFramebuffer();function x(C){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,C,0);let T=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,T),T}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(x(f),a.canvasCopies.map(x),a.timeStamps)}_canvasPixelComparison(f,a,h){let _=h[1]-h[0],x=f.length/4;for(let C=0;C<a.length;C++){let T=a[C],E=0;for(let P=0;P<T.length;P+=4)T[P]===f[P]&&T[P+1]===f[P+1]&&T[P+2]===f[P+2]&&T[P+3]===f[P+3]&&(E+=1);_+=(h[C+2]-h[C+1])*(1-E/x)}return _}remove(){this._hash&&this._hash.remove();for(let a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),t.dp(this.painter.context.gl),t.dq.remove(),t.dr.remove(),this._removed=!0,this.fire(new t.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=t.e.frame(a=>{let h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(a)}))}_preloadTiles(f){let a=this.style?this.style.getSourceCaches():[];return t.ds(a,(h,_)=>h._preloadTiles(f,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,a){t.du(f,a)}_occlusionCriteriaSatisfied(){let f=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&f&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return t.dt}},NavigationControl:class{constructor(f){this.options=t.W({},Ql,f),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(t.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),N("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),N("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{let h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:a}):h.resetNorth({},{originalEvent:a}))}),this._compassIcon=N("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let f=this._map;if(!f)return;let a=f.getZoom(),h=a===f.getMaxZoom(),_=a===f.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){let f=this._map;if(!f)return;let a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Kl(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){let f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,a){let h=N("button",f,this._container);return h.type="button",h.addEventListener("click",a),h}_setButtonTitle(f,a){if(!this._map)return;let h=this._map._getUIString(`NavigationControl.${a}`);f.setAttribute("aria-label",h),f.firstElementChild&&f.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends t.E{constructor(f){super();let a=navigator.geolocation;this.options=t.W({geolocation:a},xd,f),t.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Kh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){let a=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,f(h)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>a(h.state!=="denied")).catch(()=>a()):a()}_isOutOfMapMaxBounds(f){let a=this._map.getMaxBounds(),h=f.coords;return!!a&&(h.longitude<a.getWest()||h.longitude>a.getEast()||h.latitude<a.getSouth()||h.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new t.f("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.f("geolocate",f)),this._finish()}}_updateCamera(f){let a=new t.aI(f.coords.longitude,f.coords.latitude),h=f.coords.accuracy,_=this._map.getBearing(),x=t.W({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(h),x,{geolocateSource:!0})}_updateMarker(f){if(f){let a=new t.aI(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let f=this._map.transform,a=t.ax(1,f._center.lat)*f.worldSize,h=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.f("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=N("button","mapboxgl-ctrl-geolocate",this._container),N("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{let a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N("div","mapboxgl-user-location"),this._dotElement.appendChild(N("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(N("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new bs({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=N("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.f("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:um,ScaleControl:class{constructor(f){this.options=t.W({},Jl,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),t.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let f=this.options.maxWidth||100,a=this._map,h=a._containerHeight/2,_=a._containerWidth/2-f/2,x=a.unproject([_,h]),C=a.unproject([_+f,h]),T=x.distanceTo(C);if(this.options.unit==="imperial"){let E=3.2808*T;E>5280?this._setScale(f,E/5280,"mile"):this._setScale(f,E,"foot")}else this.options.unit==="nautical"?this._setScale(f,T/1852,"nautical-mile"):T>=1e3?this._setScale(f,T/1e3,"kilometer"):this._setScale(f,T,"meter")}_setScale(f,a,h){this._map._requestDomTask(()=>{let _=function(C){let T=Math.pow(10,`${Math.floor(C)}`.length-1),E=C/T;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(P){let O=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*O)/O}(E),T*E}(a),x=_/a;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(_):`${_}&nbsp;${pm[h]}`,this._container.style.width=f*x+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:t.w("Full screen control 'container' must be a DOM element.")),t.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let f=this._fullscreenButton=N("button","mapboxgl-ctrl-fullscreen",this._controlContainer);N("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.E{constructor(f){super(),this.options=t.W(Object.create(hm),f),t.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new t.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new t.f("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=t.aI.convert(f),this._pos=null,this._trackPointer=!1,this._update();let a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){let a=document.createDocumentFragment(),h=document.createElement("body"),_;for(h.innerHTML=f;_=h.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=N("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(f),this.options.closeButton){let h=this._closeButton=N("button","mapboxgl-popup-close-button",a);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let a;return this._classList.delete(f)?a=!1:(this._classList.add(f),a=!0),this._updateClassList(),a}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;let a=this._map,h=this._container,_=this._pos;if(!a||!h||!_)return"bottom";let x=h.offsetWidth,C=h.offsetHeight,T=_.x<x/2,E=_.x>a.transform.width-x/2;if(_.y+f<C)return T?"top-left":E?"top-right":"top";if(_.y>a.transform.height-C){if(T)return"bottom-left";if(E)return"bottom-right"}return T?"left":E?"right":"bottom"}_updateClassList(){let f=this._container;if(!f)return;let a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),f.className=a.join(" ")}_update(f){let a=this._map,h=this._content;if(!a||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=N("div","mapboxgl-popup",a.getContainer()),this._tip=N("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zf(this._lngLat,this._pos,a.transform)),!this._trackPointer||f){let x=this._pos=this._trackPointer&&f?f:a.project(this._lngLat),C=ll(this.options.offset),T=this._anchor=this._getAnchor(C.y),E=ll(this.options.offset,T),P=x.add(E).round();a._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${ka[T]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&a._showingGlobe()){let x=t.d9(a.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(Xf);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:bs,Style:Er,LngLat:t.aI,LngLatBounds:t.ai,Point:t.P,MercatorCoordinate:t.Y,FreeCameraOptions:Sf,Evented:t.E,config:t.d8,prewarm:t.dx,clearPrewarmedResources:t.dy,get accessToken(){return t.d8.ACCESS_TOKEN},set accessToken(f){t.d8.ACCESS_TOKEN=f},get baseApiUrl(){return t.d8.API_URL},set baseApiUrl(f){t.d8.API_URL=f},get workerCount(){return t.dz.workerCount},set workerCount(f){t.dz.workerCount=f},get maxParallelImageRequests(){return t.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){t.d8.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){t.dA(f)},get workerUrl(){return t.dB.workerUrl},set workerUrl(f){t.dB.workerUrl=f},get workerClass(){return t.dB.workerClass},set workerClass(f){t.dB.workerClass=f},get workerParams(){return t.dB.workerParams},set workerParams(f){t.dB.workerParams=f},get dracoUrl(){return t.dC()},set dracoUrl(f){t.dD(f)},get meshoptUrl(){return t.dE()},set meshoptUrl(f){t.dF(f)},setNow:t.e.setNow,restoreNow:t.e.restoreNow}});var s=d;return s})});var pR=fE((nb,yv)=>{"use strict";(function(){var c,o="4.17.21",d=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",s="Expected a function",t="Invalid `variable` option passed into `_.template`",g="__lodash_hash_undefined__",w=500,M="__lodash_placeholder__",F=1,N=2,Q=4,ae=1,pe=2,Te=1,Pe=2,Re=4,Ke=8,Je=16,_t=32,Nt=64,kt=128,Ut=256,ni=512,zt=30,pi="...",ei=800,Ji=16,bn=1,lo=2,Hi=3,Mn=1/0,hn=9007199254740991,Fr=17976931348623157e292,yo=NaN,Zn=4294967295,en=Zn-1,As=Zn>>>1,Gr=[["ary",kt],["bind",Te],["bindKey",Pe],["curry",Ke],["curryRight",Je],["flip",ni],["partial",_t],["partialRight",Nt],["rearg",Ut]],wa="[object Arguments]",Ca="[object Array]",Ys="[object AsyncFunction]",si="[object Boolean]",Zs="[object Date]",gr="[object DOMException]",td="[object Error]",id="[object Function]",_h="[object GeneratorFunction]",Sa="[object Map]",Xs="[object Number]",Ps="[object Null]",To="[object Object]",Kd="[object Promise]",vi="[object Proxy]",fi="[object RegExp]",da="[object Set]",zo="[object String]",Qs="[object Symbol]",Jd="[object Undefined]",Ks="[object WeakMap]",bh="[object WeakSet]",ds="[object ArrayBuffer]",us="[object DataView]",sc="[object Float32Array]",nd="[object Float64Array]",lc="[object Int8Array]",cc="[object Int16Array]",Fa="[object Int32Array]",eu="[object Uint8Array]",_i="[object Uint8ClampedArray]",rd="[object Uint16Array]",wr="[object Uint32Array]",tu=/\b__p \+= '';/g,od=/\b(__p \+=) '' \+/g,Js=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Os=/&(?:amp|lt|gt|quot|#39);/g,iu=/[&<>"']/g,dc=RegExp(Os.source),uc=RegExp(iu.source),nu=/<%-([\s\S]+?)%>/g,ru=/<%([\s\S]+?)%>/g,yh=/<%=([\s\S]+?)%>/g,ou=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,hs=/^\w*$/,hc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,La=/[\\^$.*+?()[\]{}|]/g,Bo=RegExp(La.source),au=/^\s+/,ad=/\s/,su=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,vh=/\{\n\/\* \[wrapped with (.+)\] \*/,lu=/,? & /,De=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Z=/[()=,{}\[\]\/\s]/,ie=/\\(\\)?/g,ge=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ie=/\w*$/,Me=/^[-+]0x[0-9a-f]+$/i,Ve=/^0b[01]+$/i,Ye=/^\[object .+?Constructor\]$/,Fe=/^0o[0-7]+$/i,Xe=/^(?:0|[1-9]\d*)$/,Dt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,yt=/($^)/,Kt=/['\n\r\u2028\u2029\\]/g,ui="\\ud800-\\udfff",Oi="\\u0300-\\u036f",Ui="\\ufe20-\\ufe2f",Si="\\u20d0-\\u20ff",Qi=Oi+Ui+Si,Zt="\\u2700-\\u27bf",lr="a-z\\xdf-\\xf6\\xf8-\\xff",Pn="\\xac\\xb1\\xd7\\xf7",an="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",qr="\\u2000-\\u206f",_r=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Jr="A-Z\\xc0-\\xd6\\xd8-\\xde",No="\\ufe0e\\ufe0f",Vo=Pn+an+qr+_r,Rl="['\u2019]",_f="["+ui+"]",bf="["+Vo+"]",mc="["+Qi+"]",ki="\\d+",yf="["+Zt+"]",Fl="["+lr+"]",$m="[^"+ui+Vo+ki+Zt+lr+Jr+"]",xh="\\ud83c[\\udffb-\\udfff]",vf="(?:"+mc+"|"+xh+")",Ym="[^"+ui+"]",wh="(?:\\ud83c[\\udde6-\\uddff]){2}",Ch="[\\ud800-\\udbff][\\udc00-\\udfff]",pc="["+Jr+"]",Zm="\\u200d",Xm="(?:"+Fl+"|"+$m+")",Zg="(?:"+pc+"|"+$m+")",sd="(?:"+Rl+"(?:d|ll|m|re|s|t|ve))?",Sh="(?:"+Rl+"(?:D|LL|M|RE|S|T|VE))?",Ih=vf+"?",xf="["+No+"]?",Xg="(?:"+Zm+"(?:"+[Ym,wh,Ch].join("|")+")"+xf+Ih+")*",Qg="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",cu="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",$i=xf+Ih+Xg,rb="(?:"+[yf,wh,Ch].join("|")+")"+$i,ob="(?:"+[Ym+mc+"?",mc,wh,Ch,_f].join("|")+")",ab=RegExp(Rl,"g"),wf=RegExp(mc,"g"),ms=RegExp(xh+"(?="+xh+")|"+ob+$i,"g"),Cf=RegExp([pc+"?"+Fl+"+"+sd+"(?="+[bf,pc,"$"].join("|")+")",Zg+"+"+Sh+"(?="+[bf,pc+Xm,"$"].join("|")+")",pc+"?"+Xm+"+"+sd,pc+"+"+Sh,cu,Qg,ki,rb].join("|"),"g"),Th=RegExp("["+Zm+ui+Qi+No+"]"),Mh=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Qm=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ld=-1,gt={};gt[sc]=gt[nd]=gt[lc]=gt[cc]=gt[Fa]=gt[eu]=gt[_i]=gt[rd]=gt[wr]=!0,gt[wa]=gt[Ca]=gt[ds]=gt[si]=gt[us]=gt[Zs]=gt[td]=gt[id]=gt[Sa]=gt[Xs]=gt[To]=gt[fi]=gt[da]=gt[zo]=gt[Ks]=!1;var Mr={};Mr[wa]=Mr[Ca]=Mr[ds]=Mr[us]=Mr[si]=Mr[Zs]=Mr[sc]=Mr[nd]=Mr[lc]=Mr[cc]=Mr[Fa]=Mr[Sa]=Mr[Xs]=Mr[To]=Mr[fi]=Mr[da]=Mr[zo]=Mr[Qs]=Mr[eu]=Mr[_i]=Mr[rd]=Mr[wr]=!0,Mr[td]=Mr[id]=Mr[Ks]=!1;var kh={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},tn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},na={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Kg={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Sf=parseFloat,Eh=parseInt,cd=typeof global=="object"&&global&&global.Object===Object&&global,Ri=typeof self=="object"&&self&&self.Object===Object&&self,$r=cd||Ri||Function("return this")(),Ll=typeof nb=="object"&&nb&&!nb.nodeType&&nb,ps=Ll&&typeof yv=="object"&&yv&&!yv.nodeType&&yv,Ya=ps&&ps.exports===Ll,Mo=Ya&&cd.process,fs=function(){try{var et=ps&&ps.require&&ps.require("util").types;return et||Mo&&Mo.binding&&Mo.binding("util")}catch{}}(),Dh=fs&&fs.isArrayBuffer,Ah=fs&&fs.isDate,Km=fs&&fs.isMap,Jm=fs&&fs.isRegExp,Ph=fs&&fs.isSet,du=fs&&fs.isTypedArray;function jo(et,Pt,bt){switch(bt.length){case 0:return et.call(Pt);case 1:return et.call(Pt,bt[0]);case 2:return et.call(Pt,bt[0],bt[1]);case 3:return et.call(Pt,bt[0],bt[1],bt[2])}return et.apply(Pt,bt)}function dd(et,Pt,bt,hi){for(var sn=-1,er=et==null?0:et.length;++sn<er;){var Do=et[sn];Pt(hi,Do,bt(Do),et)}return hi}function po(et,Pt){for(var bt=-1,hi=et==null?0:et.length;++bt<hi&&Pt(et[bt],bt,et)!==!1;);return et}function If(et,Pt){for(var bt=et==null?0:et.length;bt--&&Pt(et[bt],bt,et)!==!1;);return et}function Vr(et,Pt){for(var bt=-1,hi=et==null?0:et.length;++bt<hi;)if(!Pt(et[bt],bt,et))return!1;return!0}function ra(et,Pt){for(var bt=-1,hi=et==null?0:et.length,sn=0,er=[];++bt<hi;){var Do=et[bt];Pt(Do,bt,et)&&(er[sn++]=Do)}return er}function ko(et,Pt){var bt=et==null?0:et.length;return!!bt&&il(et,Pt,0)>-1}function Rs(et,Pt,bt){for(var hi=-1,sn=et==null?0:et.length;++hi<sn;)if(bt(Pt,et[hi]))return!0;return!1}function Cn(et,Pt){for(var bt=-1,hi=et==null?0:et.length,sn=Array(hi);++bt<hi;)sn[bt]=Pt(et[bt],bt,et);return sn}function el(et,Pt){for(var bt=-1,hi=Pt.length,sn=et.length;++bt<hi;)et[sn+bt]=Pt[bt];return et}function Oh(et,Pt,bt,hi){var sn=-1,er=et==null?0:et.length;for(hi&&er&&(bt=et[++sn]);++sn<er;)bt=Pt(bt,et[sn],sn,et);return bt}function ep(et,Pt,bt,hi){var sn=et==null?0:et.length;for(hi&&sn&&(bt=et[--sn]);sn--;)bt=Pt(bt,et[sn],sn,et);return bt}function fc(et,Pt){for(var bt=-1,hi=et==null?0:et.length;++bt<hi;)if(Pt(et[bt],bt,et))return!0;return!1}var Rh=uu("length");function zl(et){return et.split("")}function Fh(et){return et.match(De)||[]}function Lh(et,Pt,bt){var hi;return bt(et,function(sn,er,Do){if(Pt(sn,er,Do))return hi=er,!1}),hi}function tl(et,Pt,bt,hi){for(var sn=et.length,er=bt+(hi?1:-1);hi?er--:++er<sn;)if(Pt(et[er],er,et))return er;return-1}function il(et,Pt,bt){return Pt===Pt?Af(et,Pt,bt):tl(et,Mf,bt)}function Tf(et,Pt,bt,hi){for(var sn=bt-1,er=et.length;++sn<er;)if(hi(et[sn],Pt))return sn;return-1}function Mf(et){return et!==et}function zh(et,Pt){var bt=et==null?0:et.length;return bt?Bh(et,Pt)/bt:yo}function uu(et){return function(Pt){return Pt==null?c:Pt[et]}}function gc(et){return function(Pt){return et==null?c:et[Pt]}}function Eo(et,Pt,bt,hi,sn){return sn(et,function(er,Do,cr){bt=hi?(hi=!1,er):Pt(bt,er,Do,cr)}),bt}function tp(et,Pt){var bt=et.length;for(et.sort(Pt);bt--;)et[bt]=et[bt].value;return et}function Bh(et,Pt){for(var bt,hi=-1,sn=et.length;++hi<sn;){var er=Pt(et[hi]);er!==c&&(bt=bt===c?er:bt+er)}return bt}function ip(et,Pt){for(var bt=-1,hi=Array(et);++bt<et;)hi[bt]=Pt(bt);return hi}function kf(et,Pt){return Cn(Pt,function(bt){return[bt,et[bt]]})}function np(et){return et&&et.slice(0,ap(et)+1).replace(au,"")}function fo(et){return function(Pt){return et(Pt)}}function hu(et,Pt){return Cn(Pt,function(bt){return et[bt]})}function mu(et,Pt){return et.has(Pt)}function pu(et,Pt){for(var bt=-1,hi=et.length;++bt<hi&&il(Pt,et[bt],0)>-1;);return bt}function Nh(et,Pt){for(var bt=et.length;bt--&&il(Pt,et[bt],0)>-1;);return bt}function rp(et,Pt){for(var bt=et.length,hi=0;bt--;)et[bt]===Pt&&++hi;return hi}var fu=gc(kh),gu=gc(tn);function Ef(et){return"\\"+Kg[et]}function Df(et,Pt){return et==null?c:et[Pt]}function _c(et){return Th.test(et)}function Jg(et){return Mh.test(et)}function op(et){for(var Pt,bt=[];!(Pt=et.next()).done;)bt.push(Pt.value);return bt}function Vh(et){var Pt=-1,bt=Array(et.size);return et.forEach(function(hi,sn){bt[++Pt]=[sn,hi]}),bt}function jh(et,Pt){return function(bt){return et(Pt(bt))}}function gs(et,Pt){for(var bt=-1,hi=et.length,sn=0,er=[];++bt<hi;){var Do=et[bt];(Do===Pt||Do===M)&&(et[bt]=M,er[sn++]=bt)}return er}function nl(et){var Pt=-1,bt=Array(et.size);return et.forEach(function(hi){bt[++Pt]=hi}),bt}function e_(et){var Pt=-1,bt=Array(et.size);return et.forEach(function(hi){bt[++Pt]=[hi,hi]}),bt}function Af(et,Pt,bt){for(var hi=bt-1,sn=et.length;++hi<sn;)if(et[hi]===Pt)return hi;return-1}function Uh(et,Pt,bt){for(var hi=bt+1;hi--;)if(et[hi]===Pt)return hi;return hi}function rl(et){return _c(et)?sb(et):Rh(et)}function Uo(et){return _c(et)?Fs(et):zl(et)}function ap(et){for(var Pt=et.length;Pt--&&ad.test(et.charAt(Pt)););return Pt}var Pf=gc(na);function sb(et){for(var Pt=ms.lastIndex=0;ms.test(et);)++Pt;return Pt}function Fs(et){return et.match(ms)||[]}function _u(et){return et.match(Cf)||[]}var sp=function et(Pt){Pt=Pt==null?$r:Bl.defaults($r.Object(),Pt,Bl.pick($r,Qm));var bt=Pt.Array,hi=Pt.Date,sn=Pt.Error,er=Pt.Function,Do=Pt.Math,cr=Pt.Object,Of=Pt.RegExp,bu=Pt.String,Ia=Pt.TypeError,bc=bt.prototype,ud=er.prototype,hd=cr.prototype,lp=Pt["__core-js_shared__"],Wh=ud.toString,rr=hd.hasOwnProperty,yu=0,cp=function(){var y=/[^.]+$/.exec(lp&&lp.keys&&lp.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),Nl=hd.toString,Ta=Wh.call(cr),dp=$r._,md=Of("^"+Wh.call(rr).replace(La,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Hh=Ya?Pt.Buffer:c,Ls=Pt.Symbol,vu=Pt.Uint8Array,xu=Hh?Hh.allocUnsafe:c,yc=jh(cr.getPrototypeOf,cr),mn=cr.create,t_=hd.propertyIsEnumerable,ri=bc.splice,Rf=Ls?Ls.isConcatSpreadable:c,vc=Ls?Ls.iterator:c,Vl=Ls?Ls.toStringTag:c,Za=function(){try{var y=dn(cr,"defineProperty");return y({},"",{}),y}catch{}}(),Ff=Pt.clearTimeout!==$r.clearTimeout&&Pt.clearTimeout,wu=hi&&hi.now!==$r.Date.now&&hi.now,Gt=Pt.setTimeout!==$r.setTimeout&&Pt.setTimeout,nn=Do.ceil,rn=Do.floor,oa=cr.getOwnPropertySymbols,Cu=Hh?Hh.isBuffer:c,ln=Pt.isFinite,zs=bc.join,Su=jh(cr.keys,cr),Cr=Do.max,br=Do.min,Yr=hi.now,lb=Pt.parseInt,Iu=Do.random,Lf=bc.reverse,xc=dn(Pt,"DataView"),jl=dn(Pt,"Map"),Ul=dn(Pt,"Promise"),co=dn(Pt,"Set"),Ao=dn(Pt,"WeakMap"),Tu=dn(cr,"create"),Wo=Ao&&new Ao,kr={},_s=Cd(xc),Wl=Cd(jl),vo=Cd(Ul),zf=Cd(co),Bs=Cd(Ao),wc=Ls?Ls.prototype:c,Hl=wc?wc.valueOf:c,Cc=wc?wc.toString:c;function ve(y){if(wo(y)&&!wn(y)&&!(y instanceof Wi)){if(y instanceof Xa)return y;if(rr.call(y,"__wrapped__"))return Sd(y)}return new Xa(y)}var ua=function(){function y(){}return function(I){if(!Qr(I))return{};if(mn)return mn(I);y.prototype=I;var R=new y;return y.prototype=c,R}}();function Gh(){}function Xa(y,I){this.__wrapped__=y,this.__actions__=[],this.__chain__=!!I,this.__index__=0,this.__values__=c}ve.templateSettings={escape:nu,evaluate:ru,interpolate:yh,variable:"",imports:{_:ve}},ve.prototype=Gh.prototype,ve.prototype.constructor=ve,Xa.prototype=ua(Gh.prototype),Xa.prototype.constructor=Xa;function Wi(y){this.__wrapped__=y,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Zn,this.__views__=[]}function Bf(){var y=new Wi(this.__wrapped__);return y.__actions__=O(this.__actions__),y.__dir__=this.__dir__,y.__filtered__=this.__filtered__,y.__iteratees__=O(this.__iteratees__),y.__takeCount__=this.__takeCount__,y.__views__=O(this.__views__),y}function Sc(){if(this.__filtered__){var y=new Wi(this);y.__dir__=-1,y.__filtered__=!0}else y=this.clone(),y.__dir__*=-1;return y}function Nf(){var y=this.__wrapped__.value(),I=this.__dir__,R=wn(y),$=I<0,se=R?y.length:0,Se=Fn(0,se,this.__views__),Be=Se.start,Ge=Se.end,ot=Ge-Be,Bt=$?Ge:Be-1,jt=this.__iteratees__,Yt=jt.length,di=0,Ti=br(ot,this.__takeCount__);if(!R||!$&&se==ot&&Ti==ot)return Qf(y,this.__actions__);var Yi=[];e:for(;ot--&&di<Ti;){Bt+=I;for(var On=-1,Zi=y[Bt];++On<Yt;){var Un=jt[On],Qn=Un.iteratee,Hs=Un.type,is=Qn(Zi);if(Hs==lo)Zi=is;else if(!is){if(Hs==bn)continue e;break e}}Yi[di++]=Zi}return Yi}Wi.prototype=ua(Gh.prototype),Wi.prototype.constructor=Wi;function pd(y){var I=-1,R=y==null?0:y.length;for(this.clear();++I<R;){var $=y[I];this.set($[0],$[1])}}function cb(){this.__data__=Tu?Tu(null):{},this.size=0}function qh(y){var I=this.has(y)&&delete this.__data__[y];return this.size-=I?1:0,I}function Mu(y){var I=this.__data__;if(Tu){var R=I[y];return R===g?c:R}return rr.call(I,y)?I[y]:c}function db(y){var I=this.__data__;return Tu?I[y]!==c:rr.call(I,y)}function ku(y,I){var R=this.__data__;return this.size+=this.has(y)?0:1,R[y]=Tu&&I===c?g:I,this}pd.prototype.clear=cb,pd.prototype.delete=qh,pd.prototype.get=Mu,pd.prototype.has=db,pd.prototype.set=ku;function Ns(y){var I=-1,R=y==null?0:y.length;for(this.clear();++I<R;){var $=y[I];this.set($[0],$[1])}}function cn(){this.__data__=[],this.size=0}function Gl(y){var I=this.__data__,R=Au(I,y);if(R<0)return!1;var $=I.length-1;return R==$?I.pop():ri.call(I,R,1),--this.size,!0}function i_(y){var I=this.__data__,R=Au(I,y);return R<0?c:I[R][1]}function ub(y){return Au(this.__data__,y)>-1}function hb(y,I){var R=this.__data__,$=Au(R,y);return $<0?(++this.size,R.push([y,I])):R[$][1]=I,this}Ns.prototype.clear=cn,Ns.prototype.delete=Gl,Ns.prototype.get=i_,Ns.prototype.has=ub,Ns.prototype.set=hb;function Qa(y){var I=-1,R=y==null?0:y.length;for(this.clear();++I<R;){var $=y[I];this.set($[0],$[1])}}function up(){this.size=0,this.__data__={hash:new pd,map:new(jl||Ns),string:new pd}}function Eu(y){var I=pn(this,y).delete(y);return this.size-=I?1:0,I}function n_(y){return pn(this,y).get(y)}function Vf(y){return pn(this,y).has(y)}function Vs(y,I){var R=pn(this,y),$=R.size;return R.set(y,I),this.size+=R.size==$?0:1,this}Qa.prototype.clear=up,Qa.prototype.delete=Eu,Qa.prototype.get=n_,Qa.prototype.has=Vf,Qa.prototype.set=Vs;function Ic(y){var I=-1,R=y==null?0:y.length;for(this.__data__=new Qa;++I<R;)this.add(y[I])}function Tc(y){return this.__data__.set(y,g),this}function Mc(y){return this.__data__.has(y)}Ic.prototype.add=Ic.prototype.push=Tc,Ic.prototype.has=Mc;function za(y){var I=this.__data__=new Ns(y);this.size=I.size}function r_(){this.__data__=new Ns,this.size=0}function $h(y){var I=this.__data__,R=I.delete(y);return this.size=I.size,R}function Yh(y){return this.__data__.get(y)}function jf(y){return this.__data__.has(y)}function Zh(y,I){var R=this.__data__;if(R instanceof Ns){var $=R.__data__;if(!jl||$.length<d-1)return $.push([y,I]),this.size=++R.size,this;R=this.__data__=new Qa($)}return R.set(y,I),this.size=R.size,this}za.prototype.clear=r_,za.prototype.delete=$h,za.prototype.get=Yh,za.prototype.has=jf,za.prototype.set=Zh;function Ka(y,I){var R=wn(y),$=!R&&Oc(y),se=!R&&!$&&Rc(y),Se=!R&&!$&&!se&&Qu(y),Be=R||$||se||Se,Ge=Be?ip(y.length,bu):[],ot=Ge.length;for(var Bt in y)(I||rr.call(y,Bt))&&!(Be&&(Bt=="length"||se&&(Bt=="offset"||Bt=="parent")||Se&&(Bt=="buffer"||Bt=="byteLength"||Bt=="byteOffset")||Zr(Bt,ot)))&&Ge.push(Bt);return Ge}function Du(y){var I=y.length;return I?y[Lu(0,I-1)]:c}function Uf(y,I){return ys(O(y),al(I,0,y.length))}function At(y){return ys(O(y))}function hp(y,I,R){(R!==c&&!Ua(y[I],R)||R===c&&!(I in y))&&ha(y,I,R)}function fd(y,I,R){var $=y[I];(!(rr.call(y,I)&&Ua($,R))||R===c&&!(I in y))&&ha(y,I,R)}function Au(y,I){for(var R=y.length;R--;)if(Ua(y[R][0],I))return R;return-1}function o_(y,I,R,$){return $l(y,function(se,Se,Be){I($,se,R(se),Be)}),$}function Xh(y,I){return y&&B(I,ma(I),y)}function ol(y,I){return y&&B(I,Cs(I),y)}function ha(y,I,R){I=="__proto__"&&Za?Za(y,I,{configurable:!0,enumerable:!0,value:R,writable:!0}):y[I]=R}function ql(y,I){for(var R=-1,$=I.length,se=bt($),Se=y==null;++R<$;)se[R]=Se?c:Jb(y,I[R]);return se}function al(y,I,R){return y===y&&(R!==c&&(y=y<=R?y:R),I!==c&&(y=y>=I?y:I)),y}function Po(y,I,R,$,se,Se){var Be,Ge=I&F,ot=I&N,Bt=I&Q;if(R&&(Be=se?R(y,$,se,Se):R(y)),Be!==c)return Be;if(!Qr(y))return y;var jt=wn(y);if(jt){if(Be=Sr(y),!Ge)return O(y,Be)}else{var Yt=on(y),di=Yt==id||Yt==_h;if(Rc(y))return p_(y,Ge);if(Yt==To||Yt==wa||di&&!se){if(Be=ot||di?{}:vn(y),!Ge)return ot?G(y,ol(Be,y)):j(y,Xh(Be,y))}else{if(!Mr[Yt])return se?y:{};Be=Ue(y,Yt,Ge)}}Se||(Se=new za);var Ti=Se.get(y);if(Ti)return Ti;Se.set(y,Be),lg(y)?y.forEach(function(Zi){Be.add(Po(Zi,I,R,Zi,y,Se))}):$b(y)&&y.forEach(function(Zi,Un){Be.set(Un,Po(Zi,I,R,Un,y,Se))});var Yi=Bt?ot?bi:Ii:ot?Cs:ma,On=jt?c:Yi(y);return po(On||y,function(Zi,Un){On&&(Un=Zi,Zi=y[Un]),fd(Be,Un,Po(Zi,I,R,Un,y,Se))}),Be}function mb(y){var I=ma(y);return function(R){return a_(R,y,I)}}function a_(y,I,R){var $=R.length;if(y==null)return!$;for(y=cr(y);$--;){var se=R[$],Se=I[se],Be=y[se];if(Be===c&&!(se in y)||!Se(Be))return!1}return!0}function mp(y,I,R){if(typeof y!="function")throw new Ia(s);return dl(function(){y.apply(c,R)},I)}function Qh(y,I,R,$){var se=-1,Se=ko,Be=!0,Ge=y.length,ot=[],Bt=I.length;if(!Ge)return ot;R&&(I=Cn(I,fo(R))),$?(Se=Rs,Be=!1):I.length>=d&&(Se=mu,Be=!1,I=new Ic(I));e:for(;++se<Ge;){var jt=y[se],Yt=R==null?jt:R(jt);if(jt=$||jt!==0?jt:0,Be&&Yt===Yt){for(var di=Bt;di--;)if(I[di]===Yt)continue e;ot.push(jt)}else Se(I,Yt,$)||ot.push(jt)}return ot}var $l=J(Ba),Yl=J(Pu,!0);function Wf(y,I){var R=!0;return $l(y,function($,se,Se){return R=!!I($,se,Se),R}),R}function pp(y,I,R){for(var $=-1,se=y.length;++$<se;){var Se=y[$],Be=I(Se);if(Be!=null&&(Ge===c?Be===Be&&!Aa(Be):R(Be,Ge)))var Ge=Be,ot=Se}return ot}function s_(y,I,R,$){var se=y.length;for(R=En(R),R<0&&(R=-R>se?0:se+R),$=$===c||$>se?se:En($),$<0&&($+=se),$=R>$?0:ex($);R<$;)y[R++]=I;return y}function Hf(y,I){var R=[];return $l(y,function($,se,Se){I($,se,Se)&&R.push($)}),R}function Er(y,I,R,$,se){var Se=-1,Be=y.length;for(R||(R=qo),se||(se=[]);++Se<Be;){var Ge=y[Se];I>0&&R(Ge)?I>1?Er(Ge,I-1,R,$,se):el(se,Ge):$||(se[se.length]=Ge)}return se}var Kh=ee(),l_=ee(!0);function Ba(y,I){return y&&Kh(y,I,ma)}function Pu(y,I){return y&&l_(y,I,ma)}function Jh(y,I){return ra(I,function(R){return ml(y[R])})}function Zl(y,I){I=Kl(I,y);for(var R=0,$=I.length;y!=null&&R<$;)y=y[Da(I[R++])];return R&&R==$?y:c}function em(y,I,R){var $=I(y);return wn(y)?$:el($,R(y))}function aa(y){return y==null?y===c?Jd:Ps:Vl&&Vl in cr(y)?qi(y):Vu(y)}function Xl(y,I){return y>I}function Ou(y,I){return y!=null&&rr.call(y,I)}function tm(y,I){return y!=null&&I in cr(y)}function Ho(y,I,R){return y>=br(I,R)&&y<Cr(I,R)}function sl(y,I,R){for(var $=R?Rs:ko,se=y[0].length,Se=y.length,Be=Se,Ge=bt(Se),ot=1/0,Bt=[];Be--;){var jt=y[Be];Be&&I&&(jt=Cn(jt,fo(I))),ot=br(jt.length,ot),Ge[Be]=!R&&(I||se>=120&&jt.length>=120)?new Ic(Be&&jt):c}jt=y[0];var Yt=-1,di=Ge[0];e:for(;++Yt<se&&Bt.length<ot;){var Ti=jt[Yt],Yi=I?I(Ti):Ti;if(Ti=R||Ti!==0?Ti:0,!(di?mu(di,Yi):$(Bt,Yi,R))){for(Be=Se;--Be;){var On=Ge[Be];if(!(On?mu(On,Yi):$(y[Be],Yi,R)))continue e}di&&di.push(Yi),Bt.push(Ti)}}return Bt}function fp(y,I,R,$){return Ba(y,function(se,Se,Be){I($,R(se),Se,Be)}),$}function gd(y,I,R){I=Kl(I,y),y=gm(y,I);var $=y==null?y:y[Da(vs(I))];return $==null?c:jo($,y,R)}function Ru(y){return wo(y)&&aa(y)==wa}function gp(y){return wo(y)&&aa(y)==ds}function im(y){return wo(y)&&aa(y)==Zs}function Fu(y,I,R,$,se){return y===I?!0:y==null||I==null||!wo(y)&&!wo(I)?y!==y&&I!==I:nm(y,I,R,$,Fu,se)}function nm(y,I,R,$,se,Se){var Be=wn(y),Ge=wn(I),ot=Be?Ca:on(y),Bt=Ge?Ca:on(I);ot=ot==wa?To:ot,Bt=Bt==wa?To:Bt;var jt=ot==To,Yt=Bt==To,di=ot==Bt;if(di&&Rc(y)){if(!Rc(I))return!1;Be=!0,jt=!1}if(di&&!jt)return Se||(Se=new za),Be||Qu(y)?Ft(y,I,R,$,se,Se):pt(y,I,ot,R,$,se,Se);if(!(R&ae)){var Ti=jt&&rr.call(y,"__wrapped__"),Yi=Yt&&rr.call(I,"__wrapped__");if(Ti||Yi){var On=Ti?y.value():y,Zi=Yi?I.value():I;return Se||(Se=new za),se(On,Zi,R,$,Se)}}return di?(Se||(Se=new za),nt(y,I,R,$,se,Se)):!1}function _p(y){return wo(y)&&on(y)==Sa}function _d(y,I,R,$){var se=R.length,Se=se,Be=!$;if(y==null)return!Se;for(y=cr(y);se--;){var Ge=R[se];if(Be&&Ge[2]?Ge[1]!==y[Ge[0]]:!(Ge[0]in y))return!1}for(;++se<Se;){Ge=R[se];var ot=Ge[0],Bt=y[ot],jt=Ge[1];if(Be&&Ge[2]){if(Bt===c&&!(ot in y))return!1}else{var Yt=new za;if($)var di=$(Bt,jt,ot,y,I,Yt);if(!(di===c?Fu(jt,Bt,ae|pe,$,Yt):di))return!1}}return!0}function rm(y){if(!Qr(y)||Ec(y))return!1;var I=ml(y)?md:Ye;return I.test(Cd(y))}function c_(y){return wo(y)&&aa(y)==fi}function Gf(y){return wo(y)&&on(y)==da}function bd(y){return wo(y)&&Zu(y.length)&&!!gt[aa(y)]}function qf(y){return typeof y=="function"?y:y==null?Ss:typeof y=="object"?wn(y)?xp(y[0],y[1]):am(y):Dx(y)}function om(y){if(!es(y))return Su(y);var I=[];for(var R in cr(y))rr.call(y,R)&&R!="constructor"&&I.push(R);return I}function bp(y){if(!Qr(y))return wd(y);var I=es(y),R=[];for(var $ in y)$=="constructor"&&(I||!rr.call(y,$))||R.push($);return R}function yp(y,I){return y<I}function vp(y,I){var R=-1,$=ws(y)?bt(y.length):[];return $l(y,function(se,Se,Be){$[++R]=I(se,Se,Be)}),$}function am(y){var I=Nn(y);return I.length==1&&I[0][2]?cl(I[0][0],I[0][1]):function(R){return R===y||_d(R,y,I)}}function xp(y,I){return sa(y)&&Us(I)?cl(Da(y),I):function(R){var $=Jb(R,y);return $===c&&$===I?O_(R,y):Fu(I,$,ae|pe)}}function kc(y,I,R,$,se){y!==I&&Kh(I,function(Se,Be){if(se||(se=new za),Qr(Se))d_(y,I,Be,R,kc,$,se);else{var Ge=$?$(eo(y,Be),Se,Be+"",y,I,se):c;Ge===c&&(Ge=Se),hp(y,Be,Ge)}},Cs)}function d_(y,I,R,$,se,Se,Be){var Ge=eo(y,R),ot=eo(I,R),Bt=Be.get(ot);if(Bt){hp(y,R,Bt);return}var jt=Se?Se(Ge,ot,R+"",y,I,Be):c,Yt=jt===c;if(Yt){var di=wn(ot),Ti=!di&&Rc(ot),Yi=!di&&!Ti&&Qu(ot);jt=ot,di||Ti||Yi?wn(Ge)?jt=Ge:Oo(Ge)?jt=O(Ge):Ti?(Yt=!1,jt=p_(ot,!0)):Yi?(Yt=!1,jt=x(ot,!0)):jt=[]:Xu(ot)||Oc(ot)?(jt=Ge,Oc(Ge)?jt=Qb(Ge):(!Qr(Ge)||ml(Ge))&&(jt=vn(ot))):Yt=!1}Yt&&(Be.set(ot,jt),se(jt,ot,$,Se,Be),Be.delete(ot)),hp(y,R,jt)}function $f(y,I){var R=y.length;if(R)return I+=I<0?R:0,Zr(I,R)?y[I]:c}function u_(y,I,R){I.length?I=Cn(I,function(Se){return wn(Se)?function(Be){return Zl(Be,Se.length===1?Se[0]:Se)}:Se}):I=[Ss];var $=-1;I=Cn(I,fo(Vt()));var se=vp(y,function(Se,Be,Ge){var ot=Cn(I,function(Bt){return Bt(Se)});return{criteria:ot,index:++$,value:Se}});return tp(se,function(Se,Be){return T(Se,Be,R)})}function sm(y,I){return yd(y,I,function(R,$){return O_(y,$)})}function yd(y,I,R){for(var $=-1,se=I.length,Se={};++$<se;){var Be=I[$],Ge=Zl(y,Be);R(Ge,Be)&&vd(Se,Kl(Be,y),Ge)}return Se}function h_(y){return function(I){return Zl(I,y)}}function Ma(y,I,R,$){var se=$?Tf:il,Se=-1,Be=I.length,Ge=y;for(y===I&&(I=O(I)),R&&(Ge=Cn(y,fo(R)));++Se<Be;)for(var ot=0,Bt=I[Se],jt=R?R(Bt):Bt;(ot=se(Ge,jt,ot,$))>-1;)Ge!==y&&ri.call(Ge,ot,1),ri.call(y,ot,1);return y}function wp(y,I){for(var R=y?I.length:0,$=R-1;R--;){var se=I[R];if(R==$||se!==Se){var Se=se;Zr(se)?ri.call(y,se,1):hm(y,se)}}return y}function Lu(y,I){return y+rn(Iu()*(I-y+1))}function Cp(y,I,R,$){for(var se=-1,Se=Cr(nn((I-y)/(R||1)),0),Be=bt(Se);Se--;)Be[$?Se:++se]=y,y+=R;return Be}function lm(y,I){var R="";if(!y||I<1||I>hn)return R;do I%2&&(R+=y),I=rn(I/2),I&&(y+=y);while(I);return R}function Sn(y,I){return or(fm(y,I,Ss),y+"")}function Sp(y){return Du(Ju(y))}function zu(y,I){var R=Ju(y);return ys(R,al(I,0,R.length))}function vd(y,I,R,$){if(!Qr(y))return y;I=Kl(I,y);for(var se=-1,Se=I.length,Be=Se-1,Ge=y;Ge!=null&&++se<Se;){var ot=Da(I[se]),Bt=R;if(ot==="__proto__"||ot==="constructor"||ot==="prototype")return y;if(se!=Be){var jt=Ge[ot];Bt=$?$(jt,ot,Ge):c,Bt===c&&(Bt=Qr(jt)?jt:Zr(I[se+1])?[]:{})}fd(Ge,ot,Bt),Ge=Ge[ot]}return y}var cm=Wo?function(y,I){return Wo.set(y,I),y}:Ss,dm=Za?function(y,I){return Za(y,"toString",{configurable:!0,enumerable:!1,value:V_(I),writable:!0})}:Ss;function m_(y){return ys(Ju(y))}function Go(y,I,R){var $=-1,se=y.length;I<0&&(I=-I>se?0:se+I),R=R>se?se:R,R<0&&(R+=se),se=I>R?0:R-I>>>0,I>>>=0;for(var Se=bt(se);++$<se;)Se[$]=y[$+I];return Se}function pb(y,I){var R;return $l(y,function($,se,Se){return R=I($,se,Se),!R}),!!R}function um(y,I,R){var $=0,se=y==null?$:y.length;if(typeof I=="number"&&I===I&&se<=As){for(;$<se;){var Se=$+se>>>1,Be=y[Se];Be!==null&&!Aa(Be)&&(R?Be<=I:Be<I)?$=Se+1:se=Se}return se}return Ip(y,I,Ss,R)}function Ip(y,I,R,$){var se=0,Se=y==null?0:y.length;if(Se===0)return 0;I=R(I);for(var Be=I!==I,Ge=I===null,ot=Aa(I),Bt=I===c;se<Se;){var jt=rn((se+Se)/2),Yt=R(y[jt]),di=Yt!==c,Ti=Yt===null,Yi=Yt===Yt,On=Aa(Yt);if(Be)var Zi=$||Yi;else Bt?Zi=Yi&&($||di):Ge?Zi=Yi&&di&&($||!Ti):ot?Zi=Yi&&di&&!Ti&&($||!On):Ti||On?Zi=!1:Zi=$?Yt<=I:Yt<I;Zi?se=jt+1:Se=jt}return br(Se,en)}function Yf(y,I){for(var R=-1,$=y.length,se=0,Se=[];++R<$;){var Be=y[R],Ge=I?I(Be):Be;if(!R||!Ua(Ge,ot)){var ot=Ge;Se[se++]=Be===0?0:Be}}return Se}function Zf(y){return typeof y=="number"?y:Aa(y)?yo:+y}function ka(y){if(typeof y=="string")return y;if(wn(y))return Cn(y,ka)+"";if(Aa(y))return Cc?Cc.call(y):"";var I=y+"";return I=="0"&&1/y==-Mn?"-0":I}function bs(y,I,R){var $=-1,se=ko,Se=y.length,Be=!0,Ge=[],ot=Ge;if(R)Be=!1,se=Rs;else if(Se>=d){var Bt=I?null:Le(y);if(Bt)return nl(Bt);Be=!1,se=mu,ot=new Ic}else ot=I?[]:Ge;e:for(;++$<Se;){var jt=y[$],Yt=I?I(jt):jt;if(jt=R||jt!==0?jt:0,Be&&Yt===Yt){for(var di=ot.length;di--;)if(ot[di]===Yt)continue e;I&&ot.push(Yt),Ge.push(jt)}else se(ot,Yt,R)||(ot!==Ge&&ot.push(Yt),Ge.push(jt))}return Ge}function hm(y,I){return I=Kl(I,y),y=gm(y,I),y==null||delete y[Da(vs(I))]}function Xf(y,I,R,$){return vd(y,I,R(Zl(y,I)),$)}function ll(y,I,R,$){for(var se=y.length,Se=$?se:-1;($?Se--:++Se<se)&&I(y[Se],Se,y););return R?Go(y,$?0:Se,$?Se+1:se):Go(y,$?Se+1:0,$?se:Se)}function Qf(y,I){var R=y;return R instanceof Wi&&(R=R.value()),Oh(I,function($,se){return se.func.apply(se.thisArg,el([$],se.args))},R)}function Tp(y,I,R){var $=y.length;if($<2)return $?bs(y[0]):[];for(var se=-1,Se=bt($);++se<$;)for(var Be=y[se],Ge=-1;++Ge<$;)Ge!=se&&(Se[se]=Qh(Se[se]||Be,y[Ge],I,R));return bs(Er(Se,1),I,R)}function Kf(y,I,R){for(var $=-1,se=y.length,Se=I.length,Be={};++$<se;){var Ge=$<Se?I[$]:c;R(Be,y[$],Ge)}return Be}function mm(y){return Oo(y)?y:[]}function Ql(y){return typeof y=="function"?y:Ss}function Kl(y,I){return wn(y)?y:sa(y,I)?[y]:eg(Tr(y))}var xd=Sn;function Jl(y,I,R){var $=y.length;return R=R===c?$:R,!I&&R>=$?y:Go(y,I,R)}var pm=Ff||function(y){return $r.clearTimeout(y)};function p_(y,I){if(I)return y.slice();var R=y.length,$=xu?xu(R):new y.constructor(R);return y.copy($),$}function f(y){var I=new y.constructor(y.byteLength);return new vu(I).set(new vu(y)),I}function a(y,I){var R=I?f(y.buffer):y.buffer;return new y.constructor(R,y.byteOffset,y.byteLength)}function h(y){var I=new y.constructor(y.source,Ie.exec(y));return I.lastIndex=y.lastIndex,I}function _(y){return Hl?cr(Hl.call(y)):{}}function x(y,I){var R=I?f(y.buffer):y.buffer;return new y.constructor(R,y.byteOffset,y.length)}function C(y,I){if(y!==I){var R=y!==c,$=y===null,se=y===y,Se=Aa(y),Be=I!==c,Ge=I===null,ot=I===I,Bt=Aa(I);if(!Ge&&!Bt&&!Se&&y>I||Se&&Be&&ot&&!Ge&&!Bt||$&&Be&&ot||!R&&ot||!se)return 1;if(!$&&!Se&&!Bt&&y<I||Bt&&R&&se&&!$&&!Se||Ge&&R&&se||!Be&&se||!ot)return-1}return 0}function T(y,I,R){for(var $=-1,se=y.criteria,Se=I.criteria,Be=se.length,Ge=R.length;++$<Be;){var ot=C(se[$],Se[$]);if(ot){if($>=Ge)return ot;var Bt=R[$];return ot*(Bt=="desc"?-1:1)}}return y.index-I.index}function E(y,I,R,$){for(var se=-1,Se=y.length,Be=R.length,Ge=-1,ot=I.length,Bt=Cr(Se-Be,0),jt=bt(ot+Bt),Yt=!$;++Ge<ot;)jt[Ge]=I[Ge];for(;++se<Be;)(Yt||se<Se)&&(jt[R[se]]=y[se]);for(;Bt--;)jt[Ge++]=y[se++];return jt}function P(y,I,R,$){for(var se=-1,Se=y.length,Be=-1,Ge=R.length,ot=-1,Bt=I.length,jt=Cr(Se-Ge,0),Yt=bt(jt+Bt),di=!$;++se<jt;)Yt[se]=y[se];for(var Ti=se;++ot<Bt;)Yt[Ti+ot]=I[ot];for(;++Be<Ge;)(di||se<Se)&&(Yt[Ti+R[Be]]=y[se++]);return Yt}function O(y,I){var R=-1,$=y.length;for(I||(I=bt($));++R<$;)I[R]=y[R];return I}function B(y,I,R,$){var se=!R;R||(R={});for(var Se=-1,Be=I.length;++Se<Be;){var Ge=I[Se],ot=$?$(R[Ge],y[Ge],Ge,R,y):c;ot===c&&(ot=y[Ge]),se?ha(R,Ge,ot):fd(R,Ge,ot)}return R}function j(y,I){return B(y,xi(y),I)}function G(y,I){return B(y,Xn(y),I)}function q(y,I){return function(R,$){var se=wn(R)?dd:o_,Se=I?I():{};return se(R,y,Vt($,2),Se)}}function K(y){return Sn(function(I,R){var $=-1,se=R.length,Se=se>1?R[se-1]:c,Be=se>2?R[2]:c;for(Se=y.length>3&&typeof Se=="function"?(se--,Se):c,Be&&Gn(R[0],R[1],Be)&&(Se=se<3?c:Se,se=1),I=cr(I);++$<se;){var Ge=R[$];Ge&&y(I,Ge,$,Se)}return I})}function J(y,I){return function(R,$){if(R==null)return R;if(!ws(R))return y(R,$);for(var se=R.length,Se=I?se:-1,Be=cr(R);(I?Se--:++Se<se)&&$(Be[Se],Se,Be)!==!1;);return R}}function ee(y){return function(I,R,$){for(var se=-1,Se=cr(I),Be=$(I),Ge=Be.length;Ge--;){var ot=Be[y?Ge:++se];if(R(Se[ot],ot,Se)===!1)break}return I}}function te(y,I,R){var $=I&Te,se=he(y);function Se(){var Be=this&&this!==$r&&this instanceof Se?se:y;return Be.apply($?R:this,arguments)}return Se}function ue(y){return function(I){I=Tr(I);var R=_c(I)?Uo(I):c,$=R?R[0]:I.charAt(0),se=R?Jl(R,1).join(""):I.slice(1);return $[y]()+se}}function ce(y){return function(I){return Oh(oy(px(I).replace(ab,"")),y,"")}}function he(y){return function(){var I=arguments;switch(I.length){case 0:return new y;case 1:return new y(I[0]);case 2:return new y(I[0],I[1]);case 3:return new y(I[0],I[1],I[2]);case 4:return new y(I[0],I[1],I[2],I[3]);case 5:return new y(I[0],I[1],I[2],I[3],I[4]);case 6:return new y(I[0],I[1],I[2],I[3],I[4],I[5]);case 7:return new y(I[0],I[1],I[2],I[3],I[4],I[5],I[6])}var R=ua(y.prototype),$=y.apply(R,I);return Qr($)?$:R}}function Ce(y,I,R){var $=he(y);function se(){for(var Se=arguments.length,Be=bt(Se),Ge=Se,ot=yn(se);Ge--;)Be[Ge]=arguments[Ge];var Bt=Se<3&&Be[0]!==ot&&Be[Se-1]!==ot?[]:gs(Be,ot);if(Se-=Bt.length,Se<R)return ut(y,I,me,se.placeholder,c,Be,Bt,c,c,R-Se);var jt=this&&this!==$r&&this instanceof se?$:y;return jo(jt,this,Be)}return se}function we(y){return function(I,R,$){var se=cr(I);if(!ws(I)){var Se=Vt(R,3);I=ma(I),R=function(Ge){return Se(se[Ge],Ge,se)}}var Be=y(I,R,$);return Be>-1?se[Se?I[Be]:Be]:c}}function de(y){return $t(function(I){var R=I.length,$=R,se=Xa.prototype.thru;for(y&&I.reverse();$--;){var Se=I[$];if(typeof Se!="function")throw new Ia(s);if(se&&!Be&&Gi(Se)=="wrapper")var Be=new Xa([],!0)}for($=Be?$:R;++$<R;){Se=I[$];var Ge=Gi(Se),ot=Ge=="wrapper"?Fi(Se):c;ot&&Ea(ot[0])&&ot[1]==(kt|Ke|_t|Ut)&&!ot[4].length&&ot[9]==1?Be=Be[Gi(ot[0])].apply(Be,ot[3]):Be=Se.length==1&&Ea(Se)?Be[Ge]():Be.thru(Se)}return function(){var Bt=arguments,jt=Bt[0];if(Be&&Bt.length==1&&wn(jt))return Be.plant(jt).value();for(var Yt=0,di=R?I[Yt].apply(this,Bt):jt;++Yt<R;)di=I[Yt].call(this,di);return di}})}function me(y,I,R,$,se,Se,Be,Ge,ot,Bt){var jt=I&kt,Yt=I&Te,di=I&Pe,Ti=I&(Ke|Je),Yi=I&ni,On=di?c:he(y);function Zi(){for(var Un=arguments.length,Qn=bt(Un),Hs=Un;Hs--;)Qn[Hs]=arguments[Hs];if(Ti)var is=yn(Zi),ns=rp(Qn,is);if($&&(Qn=E(Qn,$,se,Ti)),Se&&(Qn=P(Qn,Se,Be,Ti)),Un-=ns,Ti&&Un<Bt){var Co=gs(Qn,is);return ut(y,I,me,Zi.placeholder,R,Qn,Co,Ge,ot,Bt-Un)}var tc=Yt?R:this,Od=di?tc[y]:y;return Un=Qn.length,Ge?Qn=Jf(Qn,Ge):Yi&&Un>1&&Qn.reverse(),jt&&ot<Un&&(Qn.length=ot),this&&this!==$r&&this instanceof Zi&&(Od=On||he(Od)),Od.apply(tc,Qn)}return Zi}function fe(y,I){return function(R,$){return fp(R,y,I($),{})}}function Ee(y,I){return function(R,$){var se;if(R===c&&$===c)return I;if(R!==c&&(se=R),$!==c){if(se===c)return $;typeof R=="string"||typeof $=="string"?(R=ka(R),$=ka($)):(R=Zf(R),$=Zf($)),se=y(R,$)}return se}}function We(y){return $t(function(I){return I=Cn(I,fo(Vt())),Sn(function(R){var $=this;return y(I,function(se){return jo(se,$,R)})})})}function ye(y,I){I=I===c?" ":ka(I);var R=I.length;if(R<2)return R?lm(I,y):I;var $=lm(I,nn(y/rl(I)));return _c(I)?Jl(Uo($),0,y).join(""):$.slice(0,y)}function He(y,I,R,$){var se=I&Te,Se=he(y);function Be(){for(var Ge=-1,ot=arguments.length,Bt=-1,jt=$.length,Yt=bt(jt+ot),di=this&&this!==$r&&this instanceof Be?Se:y;++Bt<jt;)Yt[Bt]=$[Bt];for(;ot--;)Yt[Bt++]=arguments[++Ge];return jo(di,se?R:this,Yt)}return Be}function qe(y){return function(I,R,$){return $&&typeof $!="number"&&Gn(I,R,$)&&(R=$=c),I=Lc(I),R===c?(R=I,I=0):R=Lc(R),$=$===c?I<R?1:-1:Lc($),Cp(I,R,$,y)}}function ct(y){return function(I,R){return typeof I=="string"&&typeof R=="string"||(I=pl(I),R=pl(R)),y(I,R)}}function ut(y,I,R,$,se,Se,Be,Ge,ot,Bt){var jt=I&Ke,Yt=jt?Be:c,di=jt?c:Be,Ti=jt?Se:c,Yi=jt?c:Se;I|=jt?_t:Nt,I&=~(jt?Nt:_t),I&Re||(I&=~(Te|Pe));var On=[y,I,se,Ti,Yt,Yi,di,Ge,ot,Bt],Zi=R.apply(c,On);return Ea(y)&&Mp(Zi,On),Zi.placeholder=$,xn(Zi,y,I)}function lt(y){var I=Do[y];return function(R,$){if(R=pl(R),$=$==null?0:br(En($),292),$&&ln(R)){var se=(Tr(R)+"e").split("e"),Se=I(se[0]+"e"+(+se[1]+$));return se=(Tr(Se)+"e").split("e"),+(se[0]+"e"+(+se[1]-$))}return I(R)}}var Le=co&&1/nl(new co([,-0]))[1]==Mn?function(y){return new co(y)}:W_;function Ze(y){return function(I){var R=on(I);return R==Sa?Vh(I):R==da?e_(I):kf(I,y(I))}}function rt(y,I,R,$,se,Se,Be,Ge){var ot=I&Pe;if(!ot&&typeof y!="function")throw new Ia(s);var Bt=$?$.length:0;if(Bt||(I&=~(_t|Nt),$=se=c),Be=Be===c?Be:Cr(En(Be),0),Ge=Ge===c?Ge:En(Ge),Bt-=se?se.length:0,I&Nt){var jt=$,Yt=se;$=se=c}var di=ot?c:Fi(y),Ti=[y,I,R,$,se,jt,Yt,Se,Be,Ge];if(di&&Nu(Ti,di),y=Ti[0],I=Ti[1],R=Ti[2],$=Ti[3],se=Ti[4],Ge=Ti[9]=Ti[9]===c?ot?0:y.length:Cr(Ti[9]-Bt,0),!Ge&&I&(Ke|Je)&&(I&=~(Ke|Je)),!I||I==Te)var Yi=te(y,I,R);else I==Ke||I==Je?Yi=Ce(y,I,Ge):(I==_t||I==(Te|_t))&&!se.length?Yi=He(y,I,R,$):Yi=me.apply(c,Ti);var On=di?cm:Mp;return xn(On(Yi,Ti),y,I)}function Ot(y,I,R,$){return y===c||Ua(y,hd[R])&&!rr.call($,R)?I:y}function Rt(y,I,R,$,se,Se){return Qr(y)&&Qr(I)&&(Se.set(I,y),kc(y,I,c,Rt,Se),Se.delete(I)),y}function Wt(y){return Xu(y)?c:y}function Ft(y,I,R,$,se,Se){var Be=R&ae,Ge=y.length,ot=I.length;if(Ge!=ot&&!(Be&&ot>Ge))return!1;var Bt=Se.get(y),jt=Se.get(I);if(Bt&&jt)return Bt==I&&jt==y;var Yt=-1,di=!0,Ti=R&pe?new Ic:c;for(Se.set(y,I),Se.set(I,y);++Yt<Ge;){var Yi=y[Yt],On=I[Yt];if($)var Zi=Be?$(On,Yi,Yt,I,y,Se):$(Yi,On,Yt,y,I,Se);if(Zi!==c){if(Zi)continue;di=!1;break}if(Ti){if(!fc(I,function(Un,Qn){if(!mu(Ti,Qn)&&(Yi===Un||se(Yi,Un,R,$,Se)))return Ti.push(Qn)})){di=!1;break}}else if(!(Yi===On||se(Yi,On,R,$,Se))){di=!1;break}}return Se.delete(y),Se.delete(I),di}function pt(y,I,R,$,se,Se,Be){switch(R){case us:if(y.byteLength!=I.byteLength||y.byteOffset!=I.byteOffset)return!1;y=y.buffer,I=I.buffer;case ds:return!(y.byteLength!=I.byteLength||!Se(new vu(y),new vu(I)));case si:case Zs:case Xs:return Ua(+y,+I);case td:return y.name==I.name&&y.message==I.message;case fi:case zo:return y==I+"";case Sa:var Ge=Vh;case da:var ot=$&ae;if(Ge||(Ge=nl),y.size!=I.size&&!ot)return!1;var Bt=Be.get(y);if(Bt)return Bt==I;$|=pe,Be.set(y,I);var jt=Ft(Ge(y),Ge(I),$,se,Se,Be);return Be.delete(y),jt;case Qs:if(Hl)return Hl.call(y)==Hl.call(I)}return!1}function nt(y,I,R,$,se,Se){var Be=R&ae,Ge=Ii(y),ot=Ge.length,Bt=Ii(I),jt=Bt.length;if(ot!=jt&&!Be)return!1;for(var Yt=ot;Yt--;){var di=Ge[Yt];if(!(Be?di in I:rr.call(I,di)))return!1}var Ti=Se.get(y),Yi=Se.get(I);if(Ti&&Yi)return Ti==I&&Yi==y;var On=!0;Se.set(y,I),Se.set(I,y);for(var Zi=Be;++Yt<ot;){di=Ge[Yt];var Un=y[di],Qn=I[di];if($)var Hs=Be?$(Qn,Un,di,I,y,Se):$(Un,Qn,di,y,I,Se);if(!(Hs===c?Un===Qn||se(Un,Qn,R,$,Se):Hs)){On=!1;break}Zi||(Zi=di=="constructor")}if(On&&!Zi){var is=y.constructor,ns=I.constructor;is!=ns&&"constructor"in y&&"constructor"in I&&!(typeof is=="function"&&is instanceof is&&typeof ns=="function"&&ns instanceof ns)&&(On=!1)}return Se.delete(y),Se.delete(I),On}function $t(y){return or(fm(y,c,xo),y+"")}function Ii(y){return em(y,ma,xi)}function bi(y){return em(y,Cs,Xn)}var Fi=Wo?function(y){return Wo.get(y)}:W_;function Gi(y){for(var I=y.name+"",R=kr[I],$=rr.call(kr,I)?R.length:0;$--;){var se=R[$],Se=se.func;if(Se==null||Se==y)return se.name}return I}function yn(y){var I=rr.call(ve,"placeholder")?ve:y;return I.placeholder}function Vt(){var y=ve.iteratee||j_;return y=y===j_?qf:y,arguments.length?y(arguments[0],arguments[1]):y}function pn(y,I){var R=y.__data__;return js(I)?R[typeof I=="string"?"string":"hash"]:R.map}function Nn(y){for(var I=ma(y),R=I.length;R--;){var $=I[R],se=y[$];I[R]=[$,se,Us(se)]}return I}function dn(y,I){var R=Df(y,I);return rm(R)?R:c}function qi(y){var I=rr.call(y,Vl),R=y[Vl];try{y[Vl]=c;var $=!0}catch{}var se=Nl.call(y);return $&&(I?y[Vl]=R:delete y[Vl]),se}var xi=oa?function(y){return y==null?[]:(y=cr(y),ra(oa(y),function(I){return t_.call(y,I)}))}:th,Xn=oa?function(y){for(var I=[];y;)el(I,xi(y)),y=yc(y);return I}:th,on=aa;(xc&&on(new xc(new ArrayBuffer(1)))!=us||jl&&on(new jl)!=Sa||Ul&&on(Ul.resolve())!=Kd||co&&on(new co)!=da||Ao&&on(new Ao)!=Ks)&&(on=function(y){var I=aa(y),R=I==To?y.constructor:c,$=R?Cd(R):"";if($)switch($){case _s:return us;case Wl:return Sa;case vo:return Kd;case zf:return da;case Bs:return Ks}return I});function Fn(y,I,R){for(var $=-1,se=R.length;++$<se;){var Se=R[$],Be=Se.size;switch(Se.type){case"drop":y+=Be;break;case"dropRight":I-=Be;break;case"take":I=br(I,y+Be);break;case"takeRight":y=Cr(y,I-Be);break}}return{start:y,end:I}}function dt(y){var I=y.match(vh);return I?I[1].split(lu):[]}function Lt(y,I,R){I=Kl(I,y);for(var $=-1,se=I.length,Se=!1;++$<se;){var Be=Da(I[$]);if(!(Se=y!=null&&R(y,Be)))break;y=y[Be]}return Se||++$!=se?Se:(se=y==null?0:y.length,!!se&&Zu(se)&&Zr(Be,se)&&(wn(y)||Oc(y)))}function Sr(y){var I=y.length,R=new y.constructor(I);return I&&typeof y[0]=="string"&&rr.call(y,"index")&&(R.index=y.index,R.input=y.input),R}function vn(y){return typeof y.constructor=="function"&&!es(y)?ua(yc(y)):{}}function Ue(y,I,R){var $=y.constructor;switch(I){case ds:return f(y);case si:case Zs:return new $(+y);case us:return a(y,R);case sc:case nd:case lc:case cc:case Fa:case eu:case _i:case rd:case wr:return x(y,R);case Sa:return new $;case Xs:case zo:return new $(y);case fi:return h(y);case da:return new $;case Qs:return _(y)}}function Ja(y,I){var R=I.length;if(!R)return y;var $=R-1;return I[$]=(R>1?"& ":"")+I[$],I=I.join(R>2?", ":" "),y.replace(su,`{
/* [wrapped with `+I+`] */
`)}function qo(y){return wn(y)||Oc(y)||!!(Rf&&y&&y[Rf])}function Zr(y,I){var R=typeof y;return I=I??hn,!!I&&(R=="number"||R!="symbol"&&Xe.test(y))&&y>-1&&y%1==0&&y<I}function Gn(y,I,R){if(!Qr(R))return!1;var $=typeof I;return($=="number"?ws(R)&&Zr(I,R.length):$=="string"&&I in R)?Ua(R[I],y):!1}function sa(y,I){if(wn(y))return!1;var R=typeof y;return R=="number"||R=="symbol"||R=="boolean"||y==null||Aa(y)?!0:hs.test(y)||!ou.test(y)||I!=null&&y in cr(I)}function js(y){var I=typeof y;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?y!=="__proto__":y===null}function Ea(y){var I=Gi(y),R=ve[I];if(typeof R!="function"||!(I in Wi.prototype))return!1;if(y===R)return!0;var $=Fi(R);return!!$&&y===$[0]}function Ec(y){return!!cp&&cp in y}var Dc=lp?ml:G_;function es(y){var I=y&&y.constructor,R=typeof I=="function"&&I.prototype||hd;return y===R}function Us(y){return y===y&&!Qr(y)}function cl(y,I){return function(R){return R==null?!1:R[y]===I&&(I!==c||y in cr(R))}}function Bu(y){var I=k_(y,function($){return R.size===w&&R.clear(),$}),R=I.cache;return I}function Nu(y,I){var R=y[1],$=I[1],se=R|$,Se=se<(Te|Pe|kt),Be=$==kt&&R==Ke||$==kt&&R==Ut&&y[7].length<=I[8]||$==(kt|Ut)&&I[7].length<=I[8]&&R==Ke;if(!(Se||Be))return y;$&Te&&(y[2]=I[2],se|=R&Te?0:Re);var Ge=I[3];if(Ge){var ot=y[3];y[3]=ot?E(ot,Ge,I[4]):Ge,y[4]=ot?gs(y[3],M):I[4]}return Ge=I[5],Ge&&(ot=y[5],y[5]=ot?P(ot,Ge,I[6]):Ge,y[6]=ot?gs(y[5],M):I[6]),Ge=I[7],Ge&&(y[7]=Ge),$&kt&&(y[8]=y[8]==null?I[8]:br(y[8],I[8])),y[9]==null&&(y[9]=I[9]),y[0]=I[0],y[1]=se,y}function wd(y){var I=[];if(y!=null)for(var R in cr(y))I.push(R);return I}function Vu(y){return Nl.call(y)}function fm(y,I,R){return I=Cr(I===c?y.length-1:I,0),function(){for(var $=arguments,se=-1,Se=Cr($.length-I,0),Be=bt(Se);++se<Se;)Be[se]=$[I+se];se=-1;for(var Ge=bt(I+1);++se<I;)Ge[se]=$[se];return Ge[I]=R(Be),jo(y,this,Ge)}}function gm(y,I){return I.length<2?y:Zl(y,Go(I,0,-1))}function Jf(y,I){for(var R=y.length,$=br(I.length,R),se=O(y);$--;){var Se=I[$];y[$]=Zr(Se,R)?se[Se]:c}return y}function eo(y,I){if(!(I==="constructor"&&typeof y[I]=="function")&&I!="__proto__")return y[I]}var Mp=fb(cm),dl=Gt||function(y,I){return $r.setTimeout(y,I)},or=fb(dm);function xn(y,I,R){var $=I+"";return or(y,Ja($,gb(dt($),R)))}function fb(y){var I=0,R=0;return function(){var $=Yr(),se=Ji-($-R);if(R=$,se>0){if(++I>=ei)return arguments[0]}else I=0;return y.apply(c,arguments)}}function ys(y,I){var R=-1,$=y.length,se=$-1;for(I=I===c?$:I;++R<I;){var Se=Lu(R,se),Be=y[Se];y[Se]=y[R],y[R]=Be}return y.length=I,y}var eg=Bu(function(y){var I=[];return y.charCodeAt(0)===46&&I.push(""),y.replace(hc,function(R,$,se,Se){I.push(se?Se.replace(ie,"$1"):$||R)}),I});function Da(y){if(typeof y=="string"||Aa(y))return y;var I=y+"";return I=="0"&&1/y==-Mn?"-0":I}function Cd(y){if(y!=null){try{return Wh.call(y)}catch{}try{return y+""}catch{}}return""}function gb(y,I){return po(Gr,function(R){var $="_."+R[0];I&R[1]&&!ko(y,$)&&y.push($)}),y.sort()}function Sd(y){if(y instanceof Wi)return y.clone();var I=new Xa(y.__wrapped__,y.__chain__);return I.__actions__=O(y.__actions__),I.__index__=y.__index__,I.__values__=y.__values__,I}function ju(y,I,R){(R?Gn(y,I,R):I===c)?I=1:I=Cr(En(I),0);var $=y==null?0:y.length;if(!$||I<1)return[];for(var se=0,Se=0,Be=bt(nn($/I));se<$;)Be[Se++]=Go(y,se,se+=I);return Be}function Uu(y){for(var I=-1,R=y==null?0:y.length,$=0,se=[];++I<R;){var Se=y[I];Se&&(se[$++]=Se)}return se}function f_(){var y=arguments.length;if(!y)return[];for(var I=bt(y-1),R=arguments[0],$=y;$--;)I[$-1]=arguments[$];return el(wn(R)?O(R):[R],Er(I,1))}var g_=Sn(function(y,I){return Oo(y)?Qh(y,Er(I,1,Oo,!0)):[]}),_b=Sn(function(y,I){var R=vs(I);return Oo(R)&&(R=c),Oo(y)?Qh(y,Er(I,1,Oo,!0),Vt(R,2)):[]}),bb=Sn(function(y,I){var R=vs(I);return Oo(R)&&(R=c),Oo(y)?Qh(y,Er(I,1,Oo,!0),c,R):[]});function yb(y,I,R){var $=y==null?0:y.length;return $?(I=R||I===c?1:En(I),Go(y,I<0?0:I,$)):[]}function _m(y,I,R){var $=y==null?0:y.length;return $?(I=R||I===c?1:En(I),I=$-I,Go(y,0,I<0?0:I)):[]}function Wu(y,I){return y&&y.length?ll(y,Vt(I,3),!0,!0):[]}function vb(y,I){return y&&y.length?ll(y,Vt(I,3),!0):[]}function __(y,I,R,$){var se=y==null?0:y.length;return se?(R&&typeof R!="number"&&Gn(y,I,R)&&(R=0,$=se),s_(y,I,R,$)):[]}function b_(y,I,R){var $=y==null?0:y.length;if(!$)return-1;var se=R==null?0:En(R);return se<0&&(se=Cr($+se,0)),tl(y,Vt(I,3),se)}function y_(y,I,R){var $=y==null?0:y.length;if(!$)return-1;var se=$-1;return R!==c&&(se=En(R),se=R<0?Cr($+se,0):br(se,$-1)),tl(y,Vt(I,3),se,!0)}function xo(y){var I=y==null?0:y.length;return I?Er(y,1):[]}function xb(y){var I=y==null?0:y.length;return I?Er(y,Mn):[]}function wb(y,I){var R=y==null?0:y.length;return R?(I=I===c?1:En(I),Er(y,I)):[]}function bm(y){for(var I=-1,R=y==null?0:y.length,$={};++I<R;){var se=y[I];$[se[0]]=se[1]}return $}function v_(y){return y&&y.length?y[0]:c}function kp(y,I,R){var $=y==null?0:y.length;if(!$)return-1;var se=R==null?0:En(R);return se<0&&(se=Cr($+se,0)),il(y,I,se)}function Cb(y){var I=y==null?0:y.length;return I?Go(y,0,-1):[]}var tg=Sn(function(y){var I=Cn(y,mm);return I.length&&I[0]===y[0]?sl(I):[]}),Sb=Sn(function(y){var I=vs(y),R=Cn(y,mm);return I===vs(R)?I=c:R.pop(),R.length&&R[0]===y[0]?sl(R,Vt(I,2)):[]}),x_=Sn(function(y){var I=vs(y),R=Cn(y,mm);return I=typeof I=="function"?I:c,I&&R.pop(),R.length&&R[0]===y[0]?sl(R,c,I):[]});function Ib(y,I){return y==null?"":zs.call(y,I)}function vs(y){var I=y==null?0:y.length;return I?y[I-1]:c}function wv(y,I,R){var $=y==null?0:y.length;if(!$)return-1;var se=$;return R!==c&&(se=En(R),se=se<0?Cr($+se,0):br(se,$-1)),I===I?Uh(y,I,se):tl(y,Mf,se,!0)}function Tb(y,I){return y&&y.length?$f(y,En(I)):c}var Cv=Sn(Mb);function Mb(y,I){return y&&y.length&&I&&I.length?Ma(y,I):y}function Sv(y,I,R){return y&&y.length&&I&&I.length?Ma(y,I,Vt(R,2)):y}function Iv(y,I,R){return y&&y.length&&I&&I.length?Ma(y,I,c,R):y}var Tv=$t(function(y,I){var R=y==null?0:y.length,$=ql(y,I);return wp(y,Cn(I,function(se){return Zr(se,R)?+se:se}).sort(C)),$});function Mv(y,I){var R=[];if(!(y&&y.length))return R;var $=-1,se=[],Se=y.length;for(I=Vt(I,3);++$<Se;){var Be=y[$];I(Be,$,y)&&(R.push(Be),se.push($))}return wp(y,se),R}function w_(y){return y==null?y:Lf.call(y)}function kv(y,I,R){var $=y==null?0:y.length;return $?(R&&typeof R!="number"&&Gn(y,I,R)?(I=0,R=$):(I=I==null?0:En(I),R=R===c?$:En(R)),Go(y,I,R)):[]}function Ev(y,I){return um(y,I)}function WC(y,I,R){return Ip(y,I,Vt(R,2))}function HC(y,I){var R=y==null?0:y.length;if(R){var $=um(y,I);if($<R&&Ua(y[$],I))return $}return-1}function Ir(y,I){return um(y,I,!0)}function Dv(y,I,R){return Ip(y,I,Vt(R,2),!0)}function GC(y,I){var R=y==null?0:y.length;if(R){var $=um(y,I,!0)-1;if(Ua(y[$],I))return $}return-1}function qC(y){return y&&y.length?Yf(y):[]}function ig(y,I){return y&&y.length?Yf(y,Vt(I,2)):[]}function Av(y){var I=y==null?0:y.length;return I?Go(y,1,I):[]}function kb(y,I,R){return y&&y.length?(I=R||I===c?1:En(I),Go(y,0,I<0?0:I)):[]}function C_(y,I,R){var $=y==null?0:y.length;return $?(I=R||I===c?1:En(I),I=$-I,Go(y,I<0?0:I,$)):[]}function Id(y,I){return y&&y.length?ll(y,Vt(I,3),!1,!0):[]}function S_(y,I){return y&&y.length?ll(y,Vt(I,3)):[]}var Na=Sn(function(y){return bs(Er(y,1,Oo,!0))}),Td=Sn(function(y){var I=vs(y);return Oo(I)&&(I=c),bs(Er(y,1,Oo,!0),Vt(I,2))}),Eb=Sn(function(y){var I=vs(y);return I=typeof I=="function"?I:c,bs(Er(y,1,Oo,!0),c,I)});function Db(y){return y&&y.length?bs(y):[]}function Pv(y,I){return y&&y.length?bs(y,Vt(I,2)):[]}function $C(y,I){return I=typeof I=="function"?I:c,y&&y.length?bs(y,c,I):[]}function ym(y){if(!(y&&y.length))return[];var I=0;return y=ra(y,function(R){if(Oo(R))return I=Cr(R.length,I),!0}),ip(I,function(R){return Cn(y,uu(R))})}function Ov(y,I){if(!(y&&y.length))return[];var R=ym(y);return I==null?R:Cn(R,function($){return jo(I,c,$)})}var YC=Sn(function(y,I){return Oo(y)?Qh(y,I):[]}),Ab=Sn(function(y){return Tp(ra(y,Oo))}),Pb=Sn(function(y){var I=vs(y);return Oo(I)&&(I=c),Tp(ra(y,Oo),Vt(I,2))}),ng=Sn(function(y){var I=vs(y);return I=typeof I=="function"?I:c,Tp(ra(y,Oo),c,I)}),Ep=Sn(ym);function Md(y,I){return Kf(y||[],I||[],fd)}function ec(y,I){return Kf(y||[],I||[],vd)}var Hu=Sn(function(y){var I=y.length,R=I>1?y[I-1]:c;return R=typeof R=="function"?(y.pop(),R):c,Ov(y,R)});function Gu(y){var I=ve(y);return I.__chain__=!0,I}function qu(y,I){return I(y),y}function I_(y,I){return I(y)}var ZC=$t(function(y){var I=y.length,R=I?y[0]:0,$=this.__wrapped__,se=function(Se){return ql(Se,y)};return I>1||this.__actions__.length||!($ instanceof Wi)||!Zr(R)?this.thru(se):($=$.slice(R,+R+(I?1:0)),$.__actions__.push({func:I_,args:[se],thisArg:c}),new Xa($,this.__chain__).thru(function(Se){return I&&!Se.length&&Se.push(c),Se}))});function XC(){return Gu(this)}function QC(){return new Xa(this.value(),this.__chain__)}function Rv(){this.__values__===c&&(this.__values__=A_(this.value()));var y=this.__index__>=this.__values__.length,I=y?c:this.__values__[this.__index__++];return{done:y,value:I}}function Va(){return this}function Ob(y){for(var I,R=this;R instanceof Gh;){var $=Sd(R);$.__index__=0,$.__values__=c,I?se.__wrapped__=$:I=$;var se=$;R=R.__wrapped__}return se.__wrapped__=y,I}function Fv(){var y=this.__wrapped__;if(y instanceof Wi){var I=y;return this.__actions__.length&&(I=new Wi(this)),I=I.reverse(),I.__actions__.push({func:I_,args:[w_],thisArg:c}),new Xa(I,this.__chain__)}return this.thru(w_)}function KC(){return Qf(this.__wrapped__,this.__actions__)}var Dp=q(function(y,I,R){rr.call(y,R)?++y[R]:ha(y,R,1)});function Rb(y,I,R){var $=wn(y)?Vr:Wf;return R&&Gn(y,I,R)&&(I=c),$(y,Vt(I,3))}function ul(y,I){var R=wn(y)?ra:Hf;return R(y,Vt(I,3))}var hl=we(b_),Ap=we(y_);function vm(y,I){return Er(Xr(y,I),1)}function Pp(y,I){return Er(Xr(y,I),Mn)}function Fb(y,I,R){return R=R===c?1:En(R),Er(Xr(y,I),R)}function un(y,I){var R=wn(y)?po:$l;return R(y,Vt(I,3))}function kd(y,I){var R=wn(y)?If:Yl;return R(y,Vt(I,3))}var Lv=q(function(y,I,R){rr.call(y,R)?y[R].push(I):ha(y,R,[I])});function JC(y,I,R,$){y=ws(y)?y:Ju(y),R=R&&!$?En(R):0;var se=y.length;return R<0&&(R=Cr(se+R,0)),cg(y)?R<=se&&y.indexOf(I,R)>-1:!!se&&il(y,I,R)>-1}var xm=Sn(function(y,I,R){var $=-1,se=typeof I=="function",Se=ws(y)?bt(y.length):[];return $l(y,function(Be){Se[++$]=se?jo(I,Be,R):gd(Be,I,R)}),Se}),zv=q(function(y,I,R){ha(y,R,I)});function Xr(y,I){var R=wn(y)?Cn:vp;return R(y,Vt(I,3))}function rg(y,I,R,$){return y==null?[]:(wn(I)||(I=I==null?[]:[I]),R=$?c:R,wn(R)||(R=R==null?[]:[R]),u_(y,I,R))}var e2=q(function(y,I,R){y[R?0:1].push(I)},function(){return[[],[]]});function t2(y,I,R){var $=wn(y)?Oh:Eo,se=arguments.length<3;return $(y,Vt(I,4),R,se,$l)}function i2(y,I,R){var $=wn(y)?ep:Eo,se=arguments.length<3;return $(y,Vt(I,4),R,se,Yl)}function Lb(y,I){var R=wn(y)?ra:Hf;return R(y,xs(Vt(I,3)))}function Ac(y){var I=wn(y)?Du:Sp;return I(y)}function Pc(y,I,R){(R?Gn(y,I,R):I===c)?I=1:I=En(I);var $=wn(y)?Uf:zu;return $(y,I)}function ja(y){var I=wn(y)?At:m_;return I(y)}function ts(y){if(y==null)return 0;if(ws(y))return cg(y)?rl(y):y.length;var I=on(y);return I==Sa||I==da?y.size:om(y).length}function $o(y,I,R){var $=wn(y)?fc:pb;return R&&Gn(y,I,R)&&(I=c),$(y,Vt(I,3))}var Bv=Sn(function(y,I){if(y==null)return[];var R=I.length;return R>1&&Gn(y,I[0],I[1])?I=[]:R>2&&Gn(I[0],I[1],I[2])&&(I=[I[0]]),u_(y,Er(I,1),[])}),Dr=wu||function(){return $r.Date.now()};function Nv(y,I){if(typeof I!="function")throw new Ia(s);return y=En(y),function(){if(--y<1)return I.apply(this,arguments)}}function $u(y,I,R){return I=R?c:I,I=y&&I==null?y.length:I,rt(y,kt,c,c,c,c,I)}function zb(y,I){var R;if(typeof I!="function")throw new Ia(s);return y=En(y),function(){return--y>0&&(R=I.apply(this,arguments)),y<=1&&(I=c),R}}var Op=Sn(function(y,I,R){var $=Te;if(R.length){var se=gs(R,yn(Op));$|=_t}return rt(y,$,I,R,se)}),la=Sn(function(y,I,R){var $=Te|Pe;if(R.length){var se=gs(R,yn(la));$|=_t}return rt(I,$,y,R,se)});function T_(y,I,R){I=R?c:I;var $=rt(y,Ke,c,c,c,c,c,I);return $.placeholder=T_.placeholder,$}function Bb(y,I,R){I=R?c:I;var $=rt(y,Je,c,c,c,c,c,I);return $.placeholder=Bb.placeholder,$}function M_(y,I,R){var $,se,Se,Be,Ge,ot,Bt=0,jt=!1,Yt=!1,di=!0;if(typeof y!="function")throw new Ia(s);I=pl(I)||0,Qr(R)&&(jt=!!R.leading,Yt="maxWait"in R,Se=Yt?Cr(pl(R.maxWait)||0,I):Se,di="trailing"in R?!!R.trailing:di);function Ti(Co){var tc=$,Od=se;return $=se=c,Bt=Co,Be=y.apply(Od,tc),Be}function Yi(Co){return Bt=Co,Ge=dl(Un,I),jt?Ti(Co):Be}function On(Co){var tc=Co-ot,Od=Co-Bt,Nx=I-tc;return Yt?br(Nx,Se-Od):Nx}function Zi(Co){var tc=Co-ot,Od=Co-Bt;return ot===c||tc>=I||tc<0||Yt&&Od>=Se}function Un(){var Co=Dr();if(Zi(Co))return Qn(Co);Ge=dl(Un,On(Co))}function Qn(Co){return Ge=c,di&&$?Ti(Co):($=se=c,Be)}function Hs(){Ge!==c&&pm(Ge),Bt=0,$=ot=se=Ge=c}function is(){return Ge===c?Be:Qn(Dr())}function ns(){var Co=Dr(),tc=Zi(Co);if($=arguments,se=this,ot=Co,tc){if(Ge===c)return Yi(ot);if(Yt)return pm(Ge),Ge=dl(Un,I),Ti(ot)}return Ge===c&&(Ge=dl(Un,I)),Be}return ns.cancel=Hs,ns.flush=is,ns}var n2=Sn(function(y,I){return mp(y,1,I)}),Nb=Sn(function(y,I,R){return mp(y,pl(I)||0,R)});function Vv(y){return rt(y,ni)}function k_(y,I){if(typeof y!="function"||I!=null&&typeof I!="function")throw new Ia(s);var R=function(){var $=arguments,se=I?I.apply(this,$):$[0],Se=R.cache;if(Se.has(se))return Se.get(se);var Be=y.apply(this,$);return R.cache=Se.set(se,Be)||Se,Be};return R.cache=new(k_.Cache||Qa),R}k_.Cache=Qa;function xs(y){if(typeof y!="function")throw new Ia(s);return function(){var I=arguments;switch(I.length){case 0:return!y.call(this);case 1:return!y.call(this,I[0]);case 2:return!y.call(this,I[0],I[1]);case 3:return!y.call(this,I[0],I[1],I[2])}return!y.apply(this,I)}}function Ed(y){return zb(2,y)}var E_=xd(function(y,I){I=I.length==1&&wn(I[0])?Cn(I[0],fo(Vt())):Cn(Er(I,1),fo(Vt()));var R=I.length;return Sn(function($){for(var se=-1,Se=br($.length,R);++se<Se;)$[se]=I[se].call(this,$[se]);return jo(y,this,$)})}),Rp=Sn(function(y,I){var R=gs(I,yn(Rp));return rt(y,_t,c,I,R)}),D_=Sn(function(y,I){var R=gs(I,yn(D_));return rt(y,Nt,c,I,R)}),Vb=$t(function(y,I){return rt(y,Ut,c,c,c,I)});function r2(y,I){if(typeof y!="function")throw new Ia(s);return I=I===c?I:En(I),Sn(y,I)}function jv(y,I){if(typeof y!="function")throw new Ia(s);return I=I==null?0:Cr(En(I),0),Sn(function(R){var $=R[I],se=Jl(R,0,I);return $&&el(se,$),jo(y,this,se)})}function o2(y,I,R){var $=!0,se=!0;if(typeof y!="function")throw new Ia(s);return Qr(R)&&($="leading"in R?!!R.leading:$,se="trailing"in R?!!R.trailing:se),M_(y,I,{leading:$,maxWait:I,trailing:se})}function jb(y){return $u(y,1)}function a2(y,I){return Rp(Ql(I),y)}function Ub(){if(!arguments.length)return[];var y=arguments[0];return wn(y)?y:[y]}function Uv(y){return Po(y,Q)}function Wv(y,I){return I=typeof I=="function"?I:c,Po(y,Q,I)}function Yu(y){return Po(y,F|Q)}function Hv(y,I){return I=typeof I=="function"?I:c,Po(y,F|Q,I)}function s2(y,I){return I==null||a_(y,I,ma(I))}function Ua(y,I){return y===I||y!==y&&I!==I}var Wb=ct(Xl),Fp=ct(function(y,I){return y>=I}),Oc=Ru(function(){return arguments}())?Ru:function(y){return wo(y)&&rr.call(y,"callee")&&!t_.call(y,"callee")},wn=bt.isArray,Gv=Dh?fo(Dh):gp;function ws(y){return y!=null&&Zu(y.length)&&!ml(y)}function Oo(y){return wo(y)&&ws(y)}function Hb(y){return y===!0||y===!1||wo(y)&&aa(y)==si}var Rc=Cu||G_,og=Ah?fo(Ah):im;function qv(y){return wo(y)&&y.nodeType===1&&!Xu(y)}function $v(y){if(y==null)return!0;if(ws(y)&&(wn(y)||typeof y=="string"||typeof y.splice=="function"||Rc(y)||Qu(y)||Oc(y)))return!y.length;var I=on(y);if(I==Sa||I==da)return!y.size;if(es(y))return!om(y).length;for(var R in y)if(rr.call(y,R))return!1;return!0}function Yv(y,I){return Fu(y,I)}function Gb(y,I,R){R=typeof R=="function"?R:c;var $=R?R(y,I):c;return $===c?Fu(y,I,c,R):!!$}function dr(y){if(!wo(y))return!1;var I=aa(y);return I==td||I==gr||typeof y.message=="string"&&typeof y.name=="string"&&!Xu(y)}function l2(y){return typeof y=="number"&&ln(y)}function ml(y){if(!Qr(y))return!1;var I=aa(y);return I==id||I==_h||I==Ys||I==vi}function qb(y){return typeof y=="number"&&y==En(y)}function Zu(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=hn}function Qr(y){var I=typeof y;return y!=null&&(I=="object"||I=="function")}function wo(y){return y!=null&&typeof y=="object"}var $b=Km?fo(Km):_p;function c2(y,I){return y===I||_d(y,I,Nn(I))}function Yb(y,I,R){return R=typeof R=="function"?R:c,_d(y,I,Nn(I),R)}function Fc(y){return Zb(y)&&y!=+y}function Dd(y){if(Dc(y))throw new sn(r);return rm(y)}function Zv(y){return y===null}function Xv(y){return y==null}function Zb(y){return typeof y=="number"||wo(y)&&aa(y)==Xs}function Xu(y){if(!wo(y)||aa(y)!=To)return!1;var I=yc(y);if(I===null)return!0;var R=rr.call(I,"constructor")&&I.constructor;return typeof R=="function"&&R instanceof R&&Wh.call(R)==Ta}var ag=Jm?fo(Jm):c_;function sg(y){return qb(y)&&y>=-hn&&y<=hn}var lg=Ph?fo(Ph):Gf;function cg(y){return typeof y=="string"||!wn(y)&&wo(y)&&aa(y)==zo}function Aa(y){return typeof y=="symbol"||wo(y)&&aa(y)==Qs}var Qu=du?fo(du):bd;function Xb(y){return y===c}function Qv(y){return wo(y)&&on(y)==Ks}function Kv(y){return wo(y)&&aa(y)==bh}var Ad=ct(yp),Jv=ct(function(y,I){return y<=I});function A_(y){if(!y)return[];if(ws(y))return cg(y)?Uo(y):O(y);if(vc&&y[vc])return op(y[vc]());var I=on(y),R=I==Sa?Vh:I==da?nl:Ju;return R(y)}function Lc(y){if(!y)return y===0?y:0;if(y=pl(y),y===Mn||y===-Mn){var I=y<0?-1:1;return I*Fr}return y===y?y:0}function En(y){var I=Lc(y),R=I%1;return I===I?R?I-R:I:0}function ex(y){return y?al(En(y),0,Zn):0}function pl(y){if(typeof y=="number")return y;if(Aa(y))return yo;if(Qr(y)){var I=typeof y.valueOf=="function"?y.valueOf():y;y=Qr(I)?I+"":I}if(typeof y!="string")return y===0?y:+y;y=np(y);var R=Ve.test(y);return R||Fe.test(y)?Eh(y.slice(2),R?2:8):Me.test(y)?yo:+y}function Qb(y){return B(y,Cs(y))}function tx(y){return y?al(En(y),-hn,hn):y===0?y:0}function Tr(y){return y==null?"":ka(y)}var ix=K(function(y,I){if(es(I)||ws(I)){B(I,ma(I),y);return}for(var R in I)rr.call(I,R)&&fd(y,R,I[R])}),nx=K(function(y,I){B(I,Cs(I),y)}),P_=K(function(y,I,R,$){B(I,Cs(I),y,$)}),rx=K(function(y,I,R,$){B(I,ma(I),y,$)}),ox=$t(ql);function ax(y,I){var R=ua(y);return I==null?R:Xh(R,I)}var Kb=Sn(function(y,I){y=cr(y);var R=-1,$=I.length,se=$>2?I[2]:c;for(se&&Gn(I[0],I[1],se)&&($=1);++R<$;)for(var Se=I[R],Be=Cs(Se),Ge=-1,ot=Be.length;++Ge<ot;){var Bt=Be[Ge],jt=y[Bt];(jt===c||Ua(jt,hd[Bt])&&!rr.call(y,Bt))&&(y[Bt]=Se[Bt])}return y}),Ku=Sn(function(y){return y.push(c,Rt),jo(lx,c,y)});function Ws(y,I){return Lh(y,Vt(I,3),Ba)}function sx(y,I){return Lh(y,Vt(I,3),Pu)}function d2(y,I){return y==null?y:Kh(y,Vt(I,3),Cs)}function u2(y,I){return y==null?y:l_(y,Vt(I,3),Cs)}function dg(y,I){return y&&Ba(y,Vt(I,3))}function h2(y,I){return y&&Pu(y,Vt(I,3))}function m2(y){return y==null?[]:Jh(y,ma(y))}function p2(y){return y==null?[]:Jh(y,Cs(y))}function Jb(y,I,R){var $=y==null?c:Zl(y,I);return $===c?R:$}function ug(y,I){return y!=null&&Lt(y,I,Ou)}function O_(y,I){return y!=null&&Lt(y,I,tm)}var wm=fe(function(y,I,R){I!=null&&typeof I.toString!="function"&&(I=Nl.call(I)),y[I]=R},V_(Ss)),hg=fe(function(y,I,R){I!=null&&typeof I.toString!="function"&&(I=Nl.call(I)),rr.call(y,I)?y[I].push(R):y[I]=[R]},Vt),f2=Sn(gd);function ma(y){return ws(y)?Ka(y):om(y)}function Cs(y){return ws(y)?Ka(y,!0):bp(y)}function g2(y,I){var R={};return I=Vt(I,3),Ba(y,function($,se,Se){ha(R,I($,se,Se),$)}),R}function _2(y,I){var R={};return I=Vt(I,3),Ba(y,function($,se,Se){ha(R,se,I($,se,Se))}),R}var b2=K(function(y,I,R){kc(y,I,R)}),lx=K(function(y,I,R,$){kc(y,I,R,$)}),ey=$t(function(y,I){var R={};if(y==null)return R;var $=!1;I=Cn(I,function(Se){return Se=Kl(Se,y),$||($=Se.length>1),Se}),B(y,bi(y),R),$&&(R=Po(R,F|N|Q,Wt));for(var se=I.length;se--;)hm(R,I[se]);return R});function y2(y,I){return cx(y,xs(Vt(I)))}var Lp=$t(function(y,I){return y==null?{}:sm(y,I)});function cx(y,I){if(y==null)return{};var R=Cn(bi(y),function($){return[$]});return I=Vt(I),yd(y,R,function($,se){return I($,se[0])})}function go(y,I,R){I=Kl(I,y);var $=-1,se=I.length;for(se||(se=1,y=c);++$<se;){var Se=y==null?c:y[Da(I[$])];Se===c&&($=se,Se=R),y=ml(Se)?Se.call(y):Se}return y}function R_(y,I,R){return y==null?y:vd(y,I,R)}function dx(y,I,R,$){return $=typeof $=="function"?$:c,y==null?y:vd(y,I,R,$)}var mg=Ze(ma),pg=Ze(Cs);function fg(y,I,R){var $=wn(y),se=$||Rc(y)||Qu(y);if(I=Vt(I,4),R==null){var Se=y&&y.constructor;se?R=$?new Se:[]:Qr(y)?R=ml(Se)?ua(yc(y)):{}:R={}}return(se?po:Ba)(y,function(Be,Ge,ot){return I(R,Be,Ge,ot)}),R}function ux(y,I){return y==null?!0:hm(y,I)}function hx(y,I,R){return y==null?y:Xf(y,I,Ql(R))}function gg(y,I,R,$){return $=typeof $=="function"?$:c,y==null?y:Xf(y,I,Ql(R),$)}function Ju(y){return y==null?[]:hu(y,ma(y))}function F_(y){return y==null?[]:hu(y,Cs(y))}function v2(y,I,R){return R===c&&(R=I,I=c),R!==c&&(R=pl(R),R=R===R?R:0),I!==c&&(I=pl(I),I=I===I?I:0),al(pl(y),I,R)}function ty(y,I,R){return I=Lc(I),R===c?(R=I,I=0):R=Lc(R),y=pl(y),Ho(y,I,R)}function iy(y,I,R){if(R&&typeof R!="boolean"&&Gn(y,I,R)&&(I=R=c),R===c&&(typeof I=="boolean"?(R=I,I=c):typeof y=="boolean"&&(R=y,y=c)),y===c&&I===c?(y=0,I=1):(y=Lc(y),I===c?(I=y,y=0):I=Lc(I)),y>I){var $=y;y=I,I=$}if(R||y%1||I%1){var se=Iu();return br(y+se*(I-y+Sf("1e-"+((se+"").length-1))),I)}return Lu(y,I)}var L_=ce(function(y,I,R){return I=I.toLowerCase(),y+(R?mx(I):I)});function mx(y){return Pd(Tr(y).toLowerCase())}function px(y){return y=Tr(y),y&&y.replace(Dt,fu).replace(wf,"")}function ny(y,I,R){y=Tr(y),I=ka(I);var $=y.length;R=R===c?$:al(En(R),0,$);var se=R;return R-=I.length,R>=0&&y.slice(R,se)==I}function zc(y){return y=Tr(y),y&&uc.test(y)?y.replace(iu,gu):y}function fx(y){return y=Tr(y),y&&Bo.test(y)?y.replace(La,"\\$&"):y}var x2=ce(function(y,I,R){return y+(R?"-":"")+I.toLowerCase()}),w2=ce(function(y,I,R){return y+(R?" ":"")+I.toLowerCase()}),C2=ue("toLowerCase");function S2(y,I,R){y=Tr(y),I=En(I);var $=I?rl(y):0;if(!I||$>=I)return y;var se=(I-$)/2;return ye(rn(se),R)+y+ye(nn(se),R)}function I2(y,I,R){y=Tr(y),I=En(I);var $=I?rl(y):0;return I&&$<I?y+ye(I-$,R):y}function T2(y,I,R){y=Tr(y),I=En(I);var $=I?rl(y):0;return I&&$<I?ye(I-$,R)+y:y}function M2(y,I,R){return R||I==null?I=0:I&&(I=+I),lb(Tr(y).replace(au,""),I||0)}function k2(y,I,R){return(R?Gn(y,I,R):I===c)?I=1:I=En(I),lm(Tr(y),I)}function z_(){var y=arguments,I=Tr(y[0]);return y.length<3?I:I.replace(y[1],y[2])}var E2=ce(function(y,I,R){return y+(R?"_":"")+I.toLowerCase()});function gx(y,I,R){return R&&typeof R!="number"&&Gn(y,I,R)&&(I=R=c),R=R===c?Zn:R>>>0,R?(y=Tr(y),y&&(typeof I=="string"||I!=null&&!ag(I))&&(I=ka(I),!I&&_c(y))?Jl(Uo(y),0,R):y.split(I,R)):[]}var zp=ce(function(y,I,R){return y+(R?" ":"")+Pd(I)});function D2(y,I,R){return y=Tr(y),R=R==null?0:al(En(R),0,y.length),I=ka(I),y.slice(R,R+I.length)==I}function A2(y,I,R){var $=ve.templateSettings;R&&Gn(y,I,R)&&(I=c),y=Tr(y),I=P_({},I,$,Ot);var se=P_({},I.imports,$.imports,Ot),Se=ma(se),Be=hu(se,Se),Ge,ot,Bt=0,jt=I.interpolate||yt,Yt="__p += '",di=Of((I.escape||yt).source+"|"+jt.source+"|"+(jt===yh?ge:yt).source+"|"+(I.evaluate||yt).source+"|$","g"),Ti="//# sourceURL="+(rr.call(I,"sourceURL")?(I.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ld+"]")+`
`;y.replace(di,function(Zi,Un,Qn,Hs,is,ns){return Qn||(Qn=Hs),Yt+=y.slice(Bt,ns).replace(Kt,Ef),Un&&(Ge=!0,Yt+=`' +
__e(`+Un+`) +
'`),is&&(ot=!0,Yt+=`';
`+is+`;
__p += '`),Qn&&(Yt+=`' +
((__t = (`+Qn+`)) == null ? '' : __t) +
'`),Bt=ns+Zi.length,Zi}),Yt+=`';
`;var Yi=rr.call(I,"variable")&&I.variable;if(!Yi)Yt=`with (obj) {
`+Yt+`
}
`;else if(Z.test(Yi))throw new sn(t);Yt=(ot?Yt.replace(tu,""):Yt).replace(od,"$1").replace(Js,"$1;"),Yt="function("+(Yi||"obj")+`) {
`+(Yi?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ge?", __e = _.escape":"")+(ot?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Yt+`return __p
}`;var On=_g(function(){return er(Se,Ti+"return "+Yt).apply(c,Be)});if(On.source=Yt,dr(On))throw On;return On}function P2(y){return Tr(y).toLowerCase()}function _x(y){return Tr(y).toUpperCase()}function bx(y,I,R){if(y=Tr(y),y&&(R||I===c))return np(y);if(!y||!(I=ka(I)))return y;var $=Uo(y),se=Uo(I),Se=pu($,se),Be=Nh($,se)+1;return Jl($,Se,Be).join("")}function O2(y,I,R){if(y=Tr(y),y&&(R||I===c))return y.slice(0,ap(y)+1);if(!y||!(I=ka(I)))return y;var $=Uo(y),se=Nh($,Uo(I))+1;return Jl($,0,se).join("")}function R2(y,I,R){if(y=Tr(y),y&&(R||I===c))return y.replace(au,"");if(!y||!(I=ka(I)))return y;var $=Uo(y),se=pu($,Uo(I));return Jl($,se).join("")}function F2(y,I){var R=zt,$=pi;if(Qr(I)){var se="separator"in I?I.separator:se;R="length"in I?En(I.length):R,$="omission"in I?ka(I.omission):$}y=Tr(y);var Se=y.length;if(_c(y)){var Be=Uo(y);Se=Be.length}if(R>=Se)return y;var Ge=R-rl($);if(Ge<1)return $;var ot=Be?Jl(Be,0,Ge).join(""):y.slice(0,Ge);if(se===c)return ot+$;if(Be&&(Ge+=ot.length-Ge),ag(se)){if(y.slice(Ge).search(se)){var Bt,jt=ot;for(se.global||(se=Of(se.source,Tr(Ie.exec(se))+"g")),se.lastIndex=0;Bt=se.exec(jt);)var Yt=Bt.index;ot=ot.slice(0,Yt===c?Ge:Yt)}}else if(y.indexOf(ka(se),Ge)!=Ge){var di=ot.lastIndexOf(se);di>-1&&(ot=ot.slice(0,di))}return ot+$}function ry(y){return y=Tr(y),y&&dc.test(y)?y.replace(Os,Pf):y}var B_=ce(function(y,I,R){return y+(R?" ":"")+I.toUpperCase()}),Pd=ue("toUpperCase");function oy(y,I,R){return y=Tr(y),I=R?c:I,I===c?Jg(y)?_u(y):Fh(y):y.match(I)||[]}var _g=Sn(function(y,I){try{return jo(y,c,I)}catch(R){return dr(R)?R:new sn(R)}}),yx=$t(function(y,I){return po(I,function(R){R=Da(R),ha(y,R,Op(y[R],y))}),y});function vx(y){var I=y==null?0:y.length,R=Vt();return y=I?Cn(y,function($){if(typeof $[1]!="function")throw new Ia(s);return[R($[0]),$[1]]}):[],Sn(function($){for(var se=-1;++se<I;){var Se=y[se];if(jo(Se[0],this,$))return jo(Se[1],this,$)}})}function N_(y){return mb(Po(y,F))}function V_(y){return function(){return y}}function ay(y,I){return y==null||y!==y?I:y}var sy=de(),xx=de(!0);function Ss(y){return y}function j_(y){return qf(typeof y=="function"?y:Po(y,F))}function wx(y){return am(Po(y,F))}function Cx(y,I){return xp(y,Po(I,F))}var Sx=Sn(function(y,I){return function(R){return gd(R,y,I)}}),Ix=Sn(function(y,I){return function(R){return gd(y,R,I)}});function U_(y,I,R){var $=ma(I),se=Jh(I,$);R==null&&!(Qr(I)&&(se.length||!$.length))&&(R=I,I=y,y=this,se=Jh(I,ma(I)));var Se=!(Qr(R)&&"chain"in R)||!!R.chain,Be=ml(y);return po(se,function(Ge){var ot=I[Ge];y[Ge]=ot,Be&&(y.prototype[Ge]=function(){var Bt=this.__chain__;if(Se||Bt){var jt=y(this.__wrapped__),Yt=jt.__actions__=O(this.__actions__);return Yt.push({func:ot,args:arguments,thisArg:y}),jt.__chain__=Bt,jt}return ot.apply(y,el([this.value()],arguments))})}),y}function Tx(){return $r._===this&&($r._=dp),this}function W_(){}function Mx(y){return y=En(y),Sn(function(I){return $f(I,y)})}var kx=We(Cn),Ex=We(Vr),eh=We(fc);function Dx(y){return sa(y)?uu(Da(y)):h_(y)}function L2(y){return function(I){return y==null?c:Zl(y,I)}}var z2=qe(),H_=qe(!0);function th(){return[]}function G_(){return!1}function B2(){return{}}function N2(){return""}function V2(){return!0}function j2(y,I){if(y=En(y),y<1||y>hn)return[];var R=Zn,$=br(y,Zn);I=Vt(I),y-=Zn;for(var se=ip($,I);++R<y;)I(R);return se}function U2(y){return wn(y)?Cn(y,Da):Aa(y)?[y]:O(eg(Tr(y)))}function Ax(y){var I=++yu;return Tr(y)+I}var ih=Ee(function(y,I){return y+I},0),bg=lt("ceil"),q_=Ee(function(y,I){return y/I},1),yg=lt("floor");function Px(y){return y&&y.length?pp(y,Ss,Xl):c}function Ox(y,I){return y&&y.length?pp(y,Vt(I,2),Xl):c}function Rx(y){return zh(y,Ss)}function Fx(y,I){return zh(y,Vt(I,2))}function W2(y){return y&&y.length?pp(y,Ss,yp):c}function H2(y,I){return y&&y.length?pp(y,Vt(I,2),yp):c}var Lx=Ee(function(y,I){return y*I},1),$_=lt("round"),zx=Ee(function(y,I){return y-I},0);function G2(y){return y&&y.length?Bh(y,Ss):0}function Bx(y,I){return y&&y.length?Bh(y,Vt(I,2)):0}return ve.after=Nv,ve.ary=$u,ve.assign=ix,ve.assignIn=nx,ve.assignInWith=P_,ve.assignWith=rx,ve.at=ox,ve.before=zb,ve.bind=Op,ve.bindAll=yx,ve.bindKey=la,ve.castArray=Ub,ve.chain=Gu,ve.chunk=ju,ve.compact=Uu,ve.concat=f_,ve.cond=vx,ve.conforms=N_,ve.constant=V_,ve.countBy=Dp,ve.create=ax,ve.curry=T_,ve.curryRight=Bb,ve.debounce=M_,ve.defaults=Kb,ve.defaultsDeep=Ku,ve.defer=n2,ve.delay=Nb,ve.difference=g_,ve.differenceBy=_b,ve.differenceWith=bb,ve.drop=yb,ve.dropRight=_m,ve.dropRightWhile=Wu,ve.dropWhile=vb,ve.fill=__,ve.filter=ul,ve.flatMap=vm,ve.flatMapDeep=Pp,ve.flatMapDepth=Fb,ve.flatten=xo,ve.flattenDeep=xb,ve.flattenDepth=wb,ve.flip=Vv,ve.flow=sy,ve.flowRight=xx,ve.fromPairs=bm,ve.functions=m2,ve.functionsIn=p2,ve.groupBy=Lv,ve.initial=Cb,ve.intersection=tg,ve.intersectionBy=Sb,ve.intersectionWith=x_,ve.invert=wm,ve.invertBy=hg,ve.invokeMap=xm,ve.iteratee=j_,ve.keyBy=zv,ve.keys=ma,ve.keysIn=Cs,ve.map=Xr,ve.mapKeys=g2,ve.mapValues=_2,ve.matches=wx,ve.matchesProperty=Cx,ve.memoize=k_,ve.merge=b2,ve.mergeWith=lx,ve.method=Sx,ve.methodOf=Ix,ve.mixin=U_,ve.negate=xs,ve.nthArg=Mx,ve.omit=ey,ve.omitBy=y2,ve.once=Ed,ve.orderBy=rg,ve.over=kx,ve.overArgs=E_,ve.overEvery=Ex,ve.overSome=eh,ve.partial=Rp,ve.partialRight=D_,ve.partition=e2,ve.pick=Lp,ve.pickBy=cx,ve.property=Dx,ve.propertyOf=L2,ve.pull=Cv,ve.pullAll=Mb,ve.pullAllBy=Sv,ve.pullAllWith=Iv,ve.pullAt=Tv,ve.range=z2,ve.rangeRight=H_,ve.rearg=Vb,ve.reject=Lb,ve.remove=Mv,ve.rest=r2,ve.reverse=w_,ve.sampleSize=Pc,ve.set=R_,ve.setWith=dx,ve.shuffle=ja,ve.slice=kv,ve.sortBy=Bv,ve.sortedUniq=qC,ve.sortedUniqBy=ig,ve.split=gx,ve.spread=jv,ve.tail=Av,ve.take=kb,ve.takeRight=C_,ve.takeRightWhile=Id,ve.takeWhile=S_,ve.tap=qu,ve.throttle=o2,ve.thru=I_,ve.toArray=A_,ve.toPairs=mg,ve.toPairsIn=pg,ve.toPath=U2,ve.toPlainObject=Qb,ve.transform=fg,ve.unary=jb,ve.union=Na,ve.unionBy=Td,ve.unionWith=Eb,ve.uniq=Db,ve.uniqBy=Pv,ve.uniqWith=$C,ve.unset=ux,ve.unzip=ym,ve.unzipWith=Ov,ve.update=hx,ve.updateWith=gg,ve.values=Ju,ve.valuesIn=F_,ve.without=YC,ve.words=oy,ve.wrap=a2,ve.xor=Ab,ve.xorBy=Pb,ve.xorWith=ng,ve.zip=Ep,ve.zipObject=Md,ve.zipObjectDeep=ec,ve.zipWith=Hu,ve.entries=mg,ve.entriesIn=pg,ve.extend=nx,ve.extendWith=P_,U_(ve,ve),ve.add=ih,ve.attempt=_g,ve.camelCase=L_,ve.capitalize=mx,ve.ceil=bg,ve.clamp=v2,ve.clone=Uv,ve.cloneDeep=Yu,ve.cloneDeepWith=Hv,ve.cloneWith=Wv,ve.conformsTo=s2,ve.deburr=px,ve.defaultTo=ay,ve.divide=q_,ve.endsWith=ny,ve.eq=Ua,ve.escape=zc,ve.escapeRegExp=fx,ve.every=Rb,ve.find=hl,ve.findIndex=b_,ve.findKey=Ws,ve.findLast=Ap,ve.findLastIndex=y_,ve.findLastKey=sx,ve.floor=yg,ve.forEach=un,ve.forEachRight=kd,ve.forIn=d2,ve.forInRight=u2,ve.forOwn=dg,ve.forOwnRight=h2,ve.get=Jb,ve.gt=Wb,ve.gte=Fp,ve.has=ug,ve.hasIn=O_,ve.head=v_,ve.identity=Ss,ve.includes=JC,ve.indexOf=kp,ve.inRange=ty,ve.invoke=f2,ve.isArguments=Oc,ve.isArray=wn,ve.isArrayBuffer=Gv,ve.isArrayLike=ws,ve.isArrayLikeObject=Oo,ve.isBoolean=Hb,ve.isBuffer=Rc,ve.isDate=og,ve.isElement=qv,ve.isEmpty=$v,ve.isEqual=Yv,ve.isEqualWith=Gb,ve.isError=dr,ve.isFinite=l2,ve.isFunction=ml,ve.isInteger=qb,ve.isLength=Zu,ve.isMap=$b,ve.isMatch=c2,ve.isMatchWith=Yb,ve.isNaN=Fc,ve.isNative=Dd,ve.isNil=Xv,ve.isNull=Zv,ve.isNumber=Zb,ve.isObject=Qr,ve.isObjectLike=wo,ve.isPlainObject=Xu,ve.isRegExp=ag,ve.isSafeInteger=sg,ve.isSet=lg,ve.isString=cg,ve.isSymbol=Aa,ve.isTypedArray=Qu,ve.isUndefined=Xb,ve.isWeakMap=Qv,ve.isWeakSet=Kv,ve.join=Ib,ve.kebabCase=x2,ve.last=vs,ve.lastIndexOf=wv,ve.lowerCase=w2,ve.lowerFirst=C2,ve.lt=Ad,ve.lte=Jv,ve.max=Px,ve.maxBy=Ox,ve.mean=Rx,ve.meanBy=Fx,ve.min=W2,ve.minBy=H2,ve.stubArray=th,ve.stubFalse=G_,ve.stubObject=B2,ve.stubString=N2,ve.stubTrue=V2,ve.multiply=Lx,ve.nth=Tb,ve.noConflict=Tx,ve.noop=W_,ve.now=Dr,ve.pad=S2,ve.padEnd=I2,ve.padStart=T2,ve.parseInt=M2,ve.random=iy,ve.reduce=t2,ve.reduceRight=i2,ve.repeat=k2,ve.replace=z_,ve.result=go,ve.round=$_,ve.runInContext=et,ve.sample=Ac,ve.size=ts,ve.snakeCase=E2,ve.some=$o,ve.sortedIndex=Ev,ve.sortedIndexBy=WC,ve.sortedIndexOf=HC,ve.sortedLastIndex=Ir,ve.sortedLastIndexBy=Dv,ve.sortedLastIndexOf=GC,ve.startCase=zp,ve.startsWith=D2,ve.subtract=zx,ve.sum=G2,ve.sumBy=Bx,ve.template=A2,ve.times=j2,ve.toFinite=Lc,ve.toInteger=En,ve.toLength=ex,ve.toLower=P2,ve.toNumber=pl,ve.toSafeInteger=tx,ve.toString=Tr,ve.toUpper=_x,ve.trim=bx,ve.trimEnd=O2,ve.trimStart=R2,ve.truncate=F2,ve.unescape=ry,ve.uniqueId=Ax,ve.upperCase=B_,ve.upperFirst=Pd,ve.each=un,ve.eachRight=kd,ve.first=v_,U_(ve,function(){var y={};return Ba(ve,function(I,R){rr.call(ve.prototype,R)||(y[R]=I)}),y}(),{chain:!1}),ve.VERSION=o,po(["bind","bindKey","curry","curryRight","partial","partialRight"],function(y){ve[y].placeholder=ve}),po(["drop","take"],function(y,I){Wi.prototype[y]=function(R){R=R===c?1:Cr(En(R),0);var $=this.__filtered__&&!I?new Wi(this):this.clone();return $.__filtered__?$.__takeCount__=br(R,$.__takeCount__):$.__views__.push({size:br(R,Zn),type:y+($.__dir__<0?"Right":"")}),$},Wi.prototype[y+"Right"]=function(R){return this.reverse()[y](R).reverse()}}),po(["filter","map","takeWhile"],function(y,I){var R=I+1,$=R==bn||R==Hi;Wi.prototype[y]=function(se){var Se=this.clone();return Se.__iteratees__.push({iteratee:Vt(se,3),type:R}),Se.__filtered__=Se.__filtered__||$,Se}}),po(["head","last"],function(y,I){var R="take"+(I?"Right":"");Wi.prototype[y]=function(){return this[R](1).value()[0]}}),po(["initial","tail"],function(y,I){var R="drop"+(I?"":"Right");Wi.prototype[y]=function(){return this.__filtered__?new Wi(this):this[R](1)}}),Wi.prototype.compact=function(){return this.filter(Ss)},Wi.prototype.find=function(y){return this.filter(y).head()},Wi.prototype.findLast=function(y){return this.reverse().find(y)},Wi.prototype.invokeMap=Sn(function(y,I){return typeof y=="function"?new Wi(this):this.map(function(R){return gd(R,y,I)})}),Wi.prototype.reject=function(y){return this.filter(xs(Vt(y)))},Wi.prototype.slice=function(y,I){y=En(y);var R=this;return R.__filtered__&&(y>0||I<0)?new Wi(R):(y<0?R=R.takeRight(-y):y&&(R=R.drop(y)),I!==c&&(I=En(I),R=I<0?R.dropRight(-I):R.take(I-y)),R)},Wi.prototype.takeRightWhile=function(y){return this.reverse().takeWhile(y).reverse()},Wi.prototype.toArray=function(){return this.take(Zn)},Ba(Wi.prototype,function(y,I){var R=/^(?:filter|find|map|reject)|While$/.test(I),$=/^(?:head|last)$/.test(I),se=ve[$?"take"+(I=="last"?"Right":""):I],Se=$||/^find/.test(I);se&&(ve.prototype[I]=function(){var Be=this.__wrapped__,Ge=$?[1]:arguments,ot=Be instanceof Wi,Bt=Ge[0],jt=ot||wn(Be),Yt=function(Un){var Qn=se.apply(ve,el([Un],Ge));return $&&di?Qn[0]:Qn};jt&&R&&typeof Bt=="function"&&Bt.length!=1&&(ot=jt=!1);var di=this.__chain__,Ti=!!this.__actions__.length,Yi=Se&&!di,On=ot&&!Ti;if(!Se&&jt){Be=On?Be:new Wi(this);var Zi=y.apply(Be,Ge);return Zi.__actions__.push({func:I_,args:[Yt],thisArg:c}),new Xa(Zi,di)}return Yi&&On?y.apply(this,Ge):(Zi=this.thru(Yt),Yi?$?Zi.value()[0]:Zi.value():Zi)})}),po(["pop","push","shift","sort","splice","unshift"],function(y){var I=bc[y],R=/^(?:push|sort|unshift)$/.test(y)?"tap":"thru",$=/^(?:pop|shift)$/.test(y);ve.prototype[y]=function(){var se=arguments;if($&&!this.__chain__){var Se=this.value();return I.apply(wn(Se)?Se:[],se)}return this[R](function(Be){return I.apply(wn(Be)?Be:[],se)})}}),Ba(Wi.prototype,function(y,I){var R=ve[I];if(R){var $=R.name+"";rr.call(kr,$)||(kr[$]=[]),kr[$].push({name:I,func:R})}}),kr[me(c,Pe).name]=[{name:"wrapper",func:c}],Wi.prototype.clone=Bf,Wi.prototype.reverse=Sc,Wi.prototype.value=Nf,ve.prototype.at=ZC,ve.prototype.chain=XC,ve.prototype.commit=QC,ve.prototype.next=Rv,ve.prototype.plant=Ob,ve.prototype.reverse=Fv,ve.prototype.toJSON=ve.prototype.valueOf=ve.prototype.value=KC,ve.prototype.first=ve.prototype.head,vc&&(ve.prototype[vc]=Va),ve},Bl=sp();typeof define=="function"&&typeof define.amd=="object"&&define.amd?($r._=Bl,define(function(){return Bl})):ps?((ps.exports=Bl)._=Bl,Ll._=Bl):$r._=Bl}).call(nb)});var DL=(()=>{let o=class o extends O1{constructor(r,s,t){super(r,s,t,yr(w1,{optional:!0}))}ngOnDestroy(){this.flush()}};o.\u0275fac=function(s){return new(s||o)(wt(Kn),wt(Ry),wt(P1))},o.\u0275prov=ci({token:o,factory:o.\u0275fac});let c=o;return c})();function AL(){return new QE}function PL(c,o,d){return new JE(c,o,d)}var oD=[{provide:P1,useFactory:AL},{provide:O1,useClass:DL},{provide:C1,useFactory:PL,deps:[D1,O1,gn]}],rD=[{provide:Ry,useFactory:()=>new KE},{provide:_a,useValue:"BrowserAnimations"},...oD],OL=[{provide:Ry,useClass:XE},{provide:_a,useValue:"NoopAnimations"},...oD],aD=(()=>{let o=class o{static withConfig(r){return{ngModule:o,providers:r.disableAnimations?OL:rD}}};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({providers:rD,imports:[A1]});let c=o;return c})();var JS;try{JS=typeof Intl<"u"&&Intl.v8BreakIterator}catch{JS=!1}var oo=(()=>{let o=class o{constructor(r){this._platformId=r,this.isBrowser=this._platformId?E1(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||JS)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};o.\u0275fac=function(s){return new(s||o)(wt(ah))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var Fy;function RL(){if(Fy==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Fy=!0}))}finally{Fy=Fy||!1}return Fy}function lh(c){return RL()?c:!!c.capture}var Pg;function sD(){if(Pg==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Pg=!1,Pg;if("scrollBehavior"in document.documentElement.style)Pg=!0;else{let c=Element.prototype.scrollTo;c?Pg=!/\{\s*\[native code\]\s*\}/.test(c.toString()):Pg=!1}}return Pg}var KS;function FL(){if(KS==null){let c=typeof document<"u"?document.head:null;KS=!!(c&&(c.createShadowRoot||c.attachShadow))}return KS}function lD(c){if(FL()){let o=c.getRootNode?c.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&o instanceof ShadowRoot)return o}return null}function Og(){let c=typeof document<"u"&&document?document.activeElement:null;for(;c&&c.shadowRoot;){let o=c.shadowRoot.activeElement;if(o===c)break;c=o}return c}function Gd(c){return c.composedPath?c.composedPath()[0]:c.target}function Ly(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function y0(c,...o){return o.length?o.some(d=>c[d]):c.altKey||c.shiftKey||c.ctrlKey||c.metaKey}function zy(c,o=0){return LL(c)?Number(c):o}function LL(c){return!isNaN(parseFloat(c))&&!isNaN(Number(c))}function v0(c){return Array.isArray(c)?c:[c]}function ca(c){return c==null?"":typeof c=="string"?c:`${c}px`}function Om(c){return c instanceof Vn?c.nativeElement:c}var zL=(()=>{let o=class o{create(r){return typeof MutationObserver>"u"?null:new MutationObserver(r)}};o.\u0275fac=function(s){return new(s||o)},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var N1=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({providers:[zL]});let c=o;return c})();var cD=new Set,Rg,BL=(()=>{let o=class o{constructor(r,s){this._platform=r,this._nonce=s,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):VL}matchMedia(r){return(this._platform.WEBKIT||this._platform.BLINK)&&NL(r,this._nonce),this._matchMedia(r)}};o.\u0275fac=function(s){return new(s||o)(wt(oo),wt(ME,8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();function NL(c,o){if(!cD.has(c))try{Rg||(Rg=document.createElement("style"),o&&Rg.setAttribute("nonce",o),Rg.setAttribute("type","text/css"),document.head.appendChild(Rg)),Rg.sheet&&(Rg.sheet.insertRule(`@media ${c} {body{ }}`,0),cD.add(c))}catch(d){console.error(d)}}function VL(c){return{matches:c==="all"||c==="",media:c,addListener:()=>{},removeListener:()=>{}}}var uD=(()=>{let o=class o{constructor(r,s){this._mediaMatcher=r,this._zone=s,this._queries=new Map,this._destroySubject=new Or}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(r){return dD(v0(r)).some(t=>this._registerQuery(t).mql.matches)}observe(r){let t=dD(v0(r)).map(w=>this._registerQuery(w).observable),g=u0(t);return g=b1(g.pipe(jc(1)),g.pipe(v1(1),zS(0))),g.pipe(d0(w=>{let M={matches:!1,breakpoints:{}};return w.forEach(({matches:F,query:N})=>{M.matches=M.matches||F,M.breakpoints[N]=F}),M}))}_registerQuery(r){if(this._queries.has(r))return this._queries.get(r);let s=this._mediaMatcher.matchMedia(r),g={observable:new ga(w=>{let M=F=>this._zone.run(()=>w.next(F));return s.addListener(M),()=>{s.removeListener(M)}}).pipe(Ud(s),d0(({matches:w})=>({query:r,matches:w})),Eg(this._destroySubject)),mql:s};return this._queries.set(r,g),g}};o.\u0275fac=function(s){return new(s||o)(wt(BL),wt(gn))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();function dD(c){return c.map(o=>o.split(",")).reduce((o,d)=>o.concat(d)).map(o=>o.trim())}var By=(()=>{let o=class o{constructor(r){this._platform=r}isDisabled(r){return r.hasAttribute("disabled")}isVisible(r){return UL(r)&&getComputedStyle(r).visibility==="visible"}isTabbable(r){if(!this._platform.isBrowser)return!1;let s=jL(XL(r));if(s&&(hD(s)===-1||!this.isVisible(s)))return!1;let t=r.nodeName.toLowerCase(),g=hD(r);return r.hasAttribute("contenteditable")?g!==-1:t==="iframe"||t==="object"||this._platform.WEBKIT&&this._platform.IOS&&!YL(r)?!1:t==="audio"?r.hasAttribute("controls")?g!==-1:!1:t==="video"?g===-1?!1:g!==null?!0:this._platform.FIREFOX||r.hasAttribute("controls"):r.tabIndex>=0}isFocusable(r,s){return ZL(r)&&!this.isDisabled(r)&&(s?.ignoreVisibility||this.isVisible(r))}};o.\u0275fac=function(s){return new(s||o)(wt(oo))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();function jL(c){try{return c.frameElement}catch{return null}}function UL(c){return!!(c.offsetWidth||c.offsetHeight||typeof c.getClientRects=="function"&&c.getClientRects().length)}function WL(c){let o=c.nodeName.toLowerCase();return o==="input"||o==="select"||o==="button"||o==="textarea"}function HL(c){return qL(c)&&c.type=="hidden"}function GL(c){return $L(c)&&c.hasAttribute("href")}function qL(c){return c.nodeName.toLowerCase()=="input"}function $L(c){return c.nodeName.toLowerCase()=="a"}function fD(c){if(!c.hasAttribute("tabindex")||c.tabIndex===void 0)return!1;let o=c.getAttribute("tabindex");return!!(o&&!isNaN(parseInt(o,10)))}function hD(c){if(!fD(c))return null;let o=parseInt(c.getAttribute("tabindex")||"",10);return isNaN(o)?-1:o}function YL(c){let o=c.nodeName.toLowerCase(),d=o==="input"&&c.type;return d==="text"||d==="password"||o==="select"||o==="textarea"}function ZL(c){return HL(c)?!1:WL(c)||GL(c)||c.hasAttribute("contenteditable")||fD(c)}function XL(c){return c.ownerDocument&&c.ownerDocument.defaultView||window}var tI=class{get enabled(){return this._enabled}set enabled(o){this._enabled=o,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(o,this._startAnchor),this._toggleAnchorTabIndex(o,this._endAnchor))}constructor(o,d,r,s,t=!1){this._element=o,this._checker=d,this._ngZone=r,this._document=s,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,t||this.attachAnchors()}destroy(){let o=this._startAnchor,d=this._endAnchor;o&&(o.removeEventListener("focus",this.startAnchorListener),o.remove()),d&&(d.removeEventListener("focus",this.endAnchorListener),d.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(o){return new Promise(d=>{this._executeOnStable(()=>d(this.focusInitialElement(o)))})}focusFirstTabbableElementWhenReady(o){return new Promise(d=>{this._executeOnStable(()=>d(this.focusFirstTabbableElement(o)))})}focusLastTabbableElementWhenReady(o){return new Promise(d=>{this._executeOnStable(()=>d(this.focusLastTabbableElement(o)))})}_getRegionBoundary(o){let d=this._element.querySelectorAll(`[cdk-focus-region-${o}], [cdkFocusRegion${o}], [cdk-focus-${o}]`);return o=="start"?d.length?d[0]:this._getFirstTabbableElement(this._element):d.length?d[d.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(o){let d=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(d){if(!this._checker.isFocusable(d)){let r=this._getFirstTabbableElement(d);return r?.focus(o),!!r}return d.focus(o),!0}return this.focusFirstTabbableElement(o)}focusFirstTabbableElement(o){let d=this._getRegionBoundary("start");return d&&d.focus(o),!!d}focusLastTabbableElement(o){let d=this._getRegionBoundary("end");return d&&d.focus(o),!!d}hasAttached(){return this._hasAttached}_getFirstTabbableElement(o){if(this._checker.isFocusable(o)&&this._checker.isTabbable(o))return o;let d=o.children;for(let r=0;r<d.length;r++){let s=d[r].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(d[r]):null;if(s)return s}return null}_getLastTabbableElement(o){if(this._checker.isFocusable(o)&&this._checker.isTabbable(o))return o;let d=o.children;for(let r=d.length-1;r>=0;r--){let s=d[r].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(d[r]):null;if(s)return s}return null}_createAnchor(){let o=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,o),o.classList.add("cdk-visually-hidden"),o.classList.add("cdk-focus-trap-anchor"),o.setAttribute("aria-hidden","true"),o}_toggleAnchorTabIndex(o,d){o?d.setAttribute("tabindex","0"):d.removeAttribute("tabindex")}toggleAnchors(o){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(o,this._startAnchor),this._toggleAnchorTabIndex(o,this._endAnchor))}_executeOnStable(o){this._ngZone.isStable?o():this._ngZone.onStable.pipe(jc(1)).subscribe(o)}},Ny=(()=>{let o=class o{constructor(r,s,t){this._checker=r,this._ngZone=s,this._document=t}create(r,s=!1){return new tI(r,this._checker,this._ngZone,this._document,s)}};o.\u0275fac=function(s){return new(s||o)(wt(By),wt(gn),wt(Kn))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),gD=(()=>{let o=class o{get enabled(){return this.focusTrap?.enabled||!1}set enabled(r){this.focusTrap&&(this.focusTrap.enabled=r)}constructor(r,s,t){this._elementRef=r,this._focusTrapFactory=s,this._previouslyFocusedElement=null,yr(oo).isBrowser&&(this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0))}ngOnDestroy(){this.focusTrap?.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap?.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap&&!this.focusTrap.hasAttached()&&this.focusTrap.attachAnchors()}ngOnChanges(r){let s=r.autoCapture;s&&!s.firstChange&&this.autoCapture&&this.focusTrap?.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=Og(),this.focusTrap?.focusInitialElementWhenReady()}};o.\u0275fac=function(s){return new(s||o)(_e(Vn),_e(Ny),_e(Kn))},o.\u0275dir=io({type:o,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:[kn.HasDecoratorInputTransform,"cdkTrapFocus","enabled",Ha],autoCapture:[kn.HasDecoratorInputTransform,"cdkTrapFocusAutoCapture","autoCapture",Ha]},exportAs:["cdkTrapFocus"],standalone:!0,features:[os,rs]});let c=o;return c})();function iI(c){return c.buttons===0||c.detail===0}function nI(c){let o=c.touches&&c.touches[0]||c.changedTouches&&c.changedTouches[0];return!!o&&o.identifier===-1&&(o.radiusX==null||o.radiusX===1)&&(o.radiusY==null||o.radiusY===1)}var QL=new Hn("cdk-input-modality-detector-options"),KL={ignoreKeys:[18,17,224,91,16]},_D=650,x0=lh({passive:!0,capture:!0}),JL=(()=>{let o=class o{get mostRecentModality(){return this._modality.value}constructor(r,s,t,g){this._platform=r,this._mostRecentTarget=null,this._modality=new My(null),this._lastTouchMs=0,this._onKeydown=w=>{this._options?.ignoreKeys?.some(M=>M===w.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Gd(w))},this._onMousedown=w=>{Date.now()-this._lastTouchMs<_D||(this._modality.next(iI(w)?"keyboard":"mouse"),this._mostRecentTarget=Gd(w))},this._onTouchstart=w=>{if(nI(w)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Gd(w)},this._options=Dn(Dn({},KL),g),this.modalityDetected=this._modality.pipe(v1(1)),this.modalityChanged=this.modalityDetected.pipe(BS()),r.isBrowser&&s.runOutsideAngular(()=>{t.addEventListener("keydown",this._onKeydown,x0),t.addEventListener("mousedown",this._onMousedown,x0),t.addEventListener("touchstart",this._onTouchstart,x0)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,x0),document.removeEventListener("mousedown",this._onMousedown,x0),document.removeEventListener("touchstart",this._onTouchstart,x0))}};o.\u0275fac=function(s){return new(s||o)(wt(oo),wt(gn),wt(Kn),wt(QL,8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var j1=function(c){return c[c.IMMEDIATE=0]="IMMEDIATE",c[c.EVENTUAL=1]="EVENTUAL",c}(j1||{}),e5=new Hn("cdk-focus-monitor-default-options"),V1=lh({passive:!0,capture:!0}),Rm=(()=>{let o=class o{constructor(r,s,t,g,w){this._ngZone=r,this._platform=s,this._inputModalityDetector=t,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Or,this._rootNodeFocusAndBlurListener=M=>{let F=Gd(M);for(let N=F;N;N=N.parentElement)M.type==="focus"?this._onFocus(M,N):this._onBlur(M,N)},this._document=g,this._detectionMode=w?.detectionMode||j1.IMMEDIATE}monitor(r,s=!1){let t=Om(r);if(!this._platform.isBrowser||t.nodeType!==1)return Ln();let g=lD(t)||this._getDocument(),w=this._elementInfo.get(t);if(w)return s&&(w.checkChildren=!0),w.subject;let M={checkChildren:s,subject:new Or,rootNode:g};return this._elementInfo.set(t,M),this._registerGlobalListeners(M),M.subject}stopMonitoring(r){let s=Om(r),t=this._elementInfo.get(s);t&&(t.subject.complete(),this._setClasses(s),this._elementInfo.delete(s),this._removeGlobalListeners(t))}focusVia(r,s,t){let g=Om(r),w=this._getDocument().activeElement;g===w?this._getClosestElementsInfo(g).forEach(([M,F])=>this._originChanged(M,s,F)):(this._setOrigin(s),typeof g.focus=="function"&&g.focus(t))}ngOnDestroy(){this._elementInfo.forEach((r,s)=>this.stopMonitoring(s))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(r){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(r)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:r&&this._isLastInteractionFromInputLabel(r)?"mouse":"program"}_shouldBeAttributedToTouch(r){return this._detectionMode===j1.EVENTUAL||!!r?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(r,s){r.classList.toggle("cdk-focused",!!s),r.classList.toggle("cdk-touch-focused",s==="touch"),r.classList.toggle("cdk-keyboard-focused",s==="keyboard"),r.classList.toggle("cdk-mouse-focused",s==="mouse"),r.classList.toggle("cdk-program-focused",s==="program")}_setOrigin(r,s=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=r,this._originFromTouchInteraction=r==="touch"&&s,this._detectionMode===j1.IMMEDIATE){clearTimeout(this._originTimeoutId);let t=this._originFromTouchInteraction?_D:1;this._originTimeoutId=setTimeout(()=>this._origin=null,t)}})}_onFocus(r,s){let t=this._elementInfo.get(s),g=Gd(r);!t||!t.checkChildren&&s!==g||this._originChanged(s,this._getFocusOrigin(g),t)}_onBlur(r,s){let t=this._elementInfo.get(s);!t||t.checkChildren&&r.relatedTarget instanceof Node&&s.contains(r.relatedTarget)||(this._setClasses(s),this._emitOrigin(t,null))}_emitOrigin(r,s){r.subject.observers.length&&this._ngZone.run(()=>r.subject.next(s))}_registerGlobalListeners(r){if(!this._platform.isBrowser)return;let s=r.rootNode,t=this._rootNodeFocusListenerCount.get(s)||0;t||this._ngZone.runOutsideAngular(()=>{s.addEventListener("focus",this._rootNodeFocusAndBlurListener,V1),s.addEventListener("blur",this._rootNodeFocusAndBlurListener,V1)}),this._rootNodeFocusListenerCount.set(s,t+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Eg(this._stopInputModalityDetector)).subscribe(g=>{this._setOrigin(g,!0)}))}_removeGlobalListeners(r){let s=r.rootNode;if(this._rootNodeFocusListenerCount.has(s)){let t=this._rootNodeFocusListenerCount.get(s);t>1?this._rootNodeFocusListenerCount.set(s,t-1):(s.removeEventListener("focus",this._rootNodeFocusAndBlurListener,V1),s.removeEventListener("blur",this._rootNodeFocusAndBlurListener,V1),this._rootNodeFocusListenerCount.delete(s))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(r,s,t){this._setClasses(r,s),this._emitOrigin(t,s),this._lastFocusOrigin=s}_getClosestElementsInfo(r){let s=[];return this._elementInfo.forEach((t,g)=>{(g===r||t.checkChildren&&g.contains(r))&&s.push([g,t])}),s}_isLastInteractionFromInputLabel(r){let{_mostRecentTarget:s,mostRecentModality:t}=this._inputModalityDetector;if(t!=="mouse"||!s||s===r||r.nodeName!=="INPUT"&&r.nodeName!=="TEXTAREA"||r.disabled)return!1;let g=r.labels;if(g){for(let w=0;w<g.length;w++)if(g[w].contains(s))return!0}return!1}};o.\u0275fac=function(s){return new(s||o)(wt(gn),wt(oo),wt(JL),wt(Kn,8),wt(e5,8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),bD=(()=>{let o=class o{constructor(r,s){this._elementRef=r,this._focusMonitor=s,this._focusOrigin=null,this.cdkFocusChange=new zn}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){let r=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(r,r.nodeType===1&&r.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(s=>{this._focusOrigin=s,this.cdkFocusChange.emit(s)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}};o.\u0275fac=function(s){return new(s||o)(_e(Vn),_e(Rm))},o.\u0275dir=io({type:o,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"],standalone:!0});let c=o;return c})(),Fg=function(c){return c[c.NONE=0]="NONE",c[c.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",c[c.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",c}(Fg||{}),mD="cdk-high-contrast-black-on-white",pD="cdk-high-contrast-white-on-black",eI="cdk-high-contrast-active",rI=(()=>{let o=class o{constructor(r,s){this._platform=r,this._document=s,this._breakpointSubscription=yr(uD).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return Fg.NONE;let r=this._document.createElement("div");r.style.backgroundColor="rgb(1,2,3)",r.style.position="absolute",this._document.body.appendChild(r);let s=this._document.defaultView||window,t=s&&s.getComputedStyle?s.getComputedStyle(r):null,g=(t&&t.backgroundColor||"").replace(/ /g,"");switch(r.remove(),g){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return Fg.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return Fg.BLACK_ON_WHITE}return Fg.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let r=this._document.body.classList;r.remove(eI,mD,pD),this._hasCheckedHighContrastMode=!0;let s=this.getHighContrastMode();s===Fg.BLACK_ON_WHITE?r.add(eI,mD):s===Fg.WHITE_ON_BLACK&&r.add(eI,pD)}}};o.\u0275fac=function(s){return new(s||o)(wt(oo),wt(Kn))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),U1=(()=>{let o=class o{constructor(r){r._applyBodyHighContrastModeCssClasses()}};o.\u0275fac=function(s){return new(s||o)(wt(rI))},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[N1]});let c=o;return c})();var t5=new Hn("cdk-dir-doc",{providedIn:"root",factory:i5});function i5(){return yr(Kn)}var n5=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function r5(c){let o=c?.toLowerCase()||"";return o==="auto"&&typeof navigator<"u"&&navigator?.language?n5.test(navigator.language)?"rtl":"ltr":o==="rtl"?"rtl":"ltr"}var Fm=(()=>{let o=class o{constructor(r){if(this.value="ltr",this.change=new zn,r){let s=r.body?r.body.dir:null,t=r.documentElement?r.documentElement.dir:null;this.value=r5(s||t||"ltr")}}ngOnDestroy(){this.change.complete()}};o.\u0275fac=function(s){return new(s||o)(wt(t5,8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var Kp=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({});let c=o;return c})();var o5=["mat-internal-form-field",""],a5=["*"];function s5(){return!0}var l5=new Hn("mat-sanity-checks",{providedIn:"root",factory:s5}),Wr=(()=>{let o=class o{constructor(r,s,t){this._sanityChecks=s,this._document=t,this._hasDoneGlobalChecks=!1,r._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(r){return Ly()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[r]}};o.\u0275fac=function(s){return new(s||o)(wt(rI),wt(l5,8),wt(Kn))},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[Kp,Kp]});let c=o;return c})();var vD=new Hn("MAT_DATE_LOCALE",{providedIn:"root",factory:c5});function c5(){return yr(RE)}var Tl=class{constructor(){this._localeChanges=new Or,this.localeChanges=this._localeChanges}getValidDateOrNull(o){return this.isDateInstance(o)&&this.isValid(o)?o:null}deserialize(o){return o==null||this.isDateInstance(o)&&this.isValid(o)?o:this.invalid()}setLocale(o){this.locale=o,this._localeChanges.next()}compareDate(o,d){return this.getYear(o)-this.getYear(d)||this.getMonth(o)-this.getMonth(d)||this.getDate(o)-this.getDate(d)}sameDate(o,d){if(o&&d){let r=this.isValid(o),s=this.isValid(d);return r&&s?!this.compareDate(o,d):r==s}return o==d}clampDate(o,d,r){return d&&this.compareDate(o,d)<0?d:r&&this.compareDate(o,r)>0?r:o}},w0=new Hn("mat-date-formats"),d5=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function oI(c,o){let d=Array(c);for(let r=0;r<c;r++)d[r]=o(r);return d}var u5=(()=>{let o=class o extends Tl{constructor(r){super(),this.useUtcForDisplay=!1,this._matDateLocale=yr(vD,{optional:!0}),r!==void 0&&(this._matDateLocale=r),super.setLocale(this._matDateLocale)}getYear(r){return r.getFullYear()}getMonth(r){return r.getMonth()}getDate(r){return r.getDate()}getDayOfWeek(r){return r.getDay()}getMonthNames(r){let s=new Intl.DateTimeFormat(this.locale,{month:r,timeZone:"utc"});return oI(12,t=>this._format(s,new Date(2017,t,1)))}getDateNames(){let r=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return oI(31,s=>this._format(r,new Date(2017,0,s+1)))}getDayOfWeekNames(r){let s=new Intl.DateTimeFormat(this.locale,{weekday:r,timeZone:"utc"});return oI(7,t=>this._format(s,new Date(2017,0,t+1)))}getYearName(r){let s=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(s,r)}getFirstDayOfWeek(){return 0}getNumDaysInMonth(r){return this.getDate(this._createDateWithOverflow(this.getYear(r),this.getMonth(r)+1,0))}clone(r){return new Date(r.getTime())}createDate(r,s,t){let g=this._createDateWithOverflow(r,s,t);return g.getMonth()!=s,g}today(){return new Date}parse(r,s){return typeof r=="number"?new Date(r):r?new Date(Date.parse(r)):null}format(r,s){if(!this.isValid(r))throw Error("NativeDateAdapter: Cannot format invalid date.");let t=new Intl.DateTimeFormat(this.locale,yl(Dn({},s),{timeZone:"utc"}));return this._format(t,r)}addCalendarYears(r,s){return this.addCalendarMonths(r,s*12)}addCalendarMonths(r,s){let t=this._createDateWithOverflow(this.getYear(r),this.getMonth(r)+s,this.getDate(r));return this.getMonth(t)!=((this.getMonth(r)+s)%12+12)%12&&(t=this._createDateWithOverflow(this.getYear(t),this.getMonth(t),0)),t}addCalendarDays(r,s){return this._createDateWithOverflow(this.getYear(r),this.getMonth(r),this.getDate(r)+s)}toIso8601(r){return[r.getUTCFullYear(),this._2digit(r.getUTCMonth()+1),this._2digit(r.getUTCDate())].join("-")}deserialize(r){if(typeof r=="string"){if(!r)return null;if(d5.test(r)){let s=new Date(r);if(this.isValid(s))return s}}return super.deserialize(r)}isDateInstance(r){return r instanceof Date}isValid(r){return!isNaN(r.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(r,s,t){let g=new Date;return g.setFullYear(r,s,t),g.setHours(0,0,0,0),g}_2digit(r){return("00"+r).slice(-2)}_format(r,s){let t=new Date;return t.setUTCFullYear(s.getFullYear(),s.getMonth(),s.getDate()),t.setUTCHours(s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()),r.format(t)}};o.\u0275fac=function(s){return new(s||o)(wt(vD,8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac});let c=o;return c})(),h5={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};var ED=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({providers:[m5()]});let c=o;return c})();function m5(c=h5){return[{provide:Tl,useClass:u5},{provide:w0,useValue:c}]}var $c=function(c){return c[c.FADING_IN=0]="FADING_IN",c[c.VISIBLE=1]="VISIBLE",c[c.FADING_OUT=2]="FADING_OUT",c[c.HIDDEN=3]="HIDDEN",c}($c||{}),lI=class{constructor(o,d,r,s=!1){this._renderer=o,this.element=d,this.config=r,this._animationForciblyDisabledThroughCss=s,this.state=$c.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},xD=lh({passive:!0,capture:!0}),cI=class{constructor(){this._events=new Map,this._delegateEventHandler=o=>{let d=Gd(o);d&&this._events.get(o.type)?.forEach((r,s)=>{(s===d||s.contains(d))&&r.forEach(t=>t.handleEvent(o))})}}addHandler(o,d,r,s){let t=this._events.get(d);if(t){let g=t.get(r);g?g.add(s):t.set(r,new Set([s]))}else this._events.set(d,new Map([[r,new Set([s])]])),o.runOutsideAngular(()=>{document.addEventListener(d,this._delegateEventHandler,xD)})}removeHandler(o,d,r){let s=this._events.get(o);if(!s)return;let t=s.get(d);t&&(t.delete(r),t.size===0&&s.delete(d),s.size===0&&(this._events.delete(o),document.removeEventListener(o,this._delegateEventHandler,xD)))}},wD={enterDuration:225,exitDuration:150},p5=800,CD=lh({passive:!0,capture:!0}),SD=["mousedown","touchstart"],ID=["mouseup","mouseleave","touchend","touchcancel"],Vy=class Vy{constructor(o,d,r,s){this._target=o,this._ngZone=d,this._platform=s,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,s.isBrowser&&(this._containerElement=Om(r))}fadeInRipple(o,d,r={}){let s=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),t=Dn(Dn({},wD),r.animation);r.centered&&(o=s.left+s.width/2,d=s.top+s.height/2);let g=r.radius||f5(o,d,s),w=o-s.left,M=d-s.top,F=t.enterDuration,N=document.createElement("div");N.classList.add("mat-ripple-element"),N.style.left=`${w-g}px`,N.style.top=`${M-g}px`,N.style.height=`${g*2}px`,N.style.width=`${g*2}px`,r.color!=null&&(N.style.backgroundColor=r.color),N.style.transitionDuration=`${F}ms`,this._containerElement.appendChild(N);let Q=window.getComputedStyle(N),ae=Q.transitionProperty,pe=Q.transitionDuration,Te=ae==="none"||pe==="0s"||pe==="0s, 0s"||s.width===0&&s.height===0,Pe=new lI(this,N,r,Te);N.style.transform="scale3d(1, 1, 1)",Pe.state=$c.FADING_IN,r.persistent||(this._mostRecentTransientRipple=Pe);let Re=null;return!Te&&(F||t.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Ke=()=>this._finishRippleTransition(Pe),Je=()=>this._destroyRipple(Pe);N.addEventListener("transitionend",Ke),N.addEventListener("transitioncancel",Je),Re={onTransitionEnd:Ke,onTransitionCancel:Je}}),this._activeRipples.set(Pe,Re),(Te||!F)&&this._finishRippleTransition(Pe),Pe}fadeOutRipple(o){if(o.state===$c.FADING_OUT||o.state===$c.HIDDEN)return;let d=o.element,r=Dn(Dn({},wD),o.config.animation);d.style.transitionDuration=`${r.exitDuration}ms`,d.style.opacity="0",o.state=$c.FADING_OUT,(o._animationForciblyDisabledThroughCss||!r.exitDuration)&&this._finishRippleTransition(o)}fadeOutAll(){this._getActiveRipples().forEach(o=>o.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(o=>{o.config.persistent||o.fadeOut()})}setupTriggerEvents(o){let d=Om(o);!this._platform.isBrowser||!d||d===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=d,SD.forEach(r=>{Vy._eventManager.addHandler(this._ngZone,r,d,this)}))}handleEvent(o){o.type==="mousedown"?this._onMousedown(o):o.type==="touchstart"?this._onTouchStart(o):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{ID.forEach(d=>{this._triggerElement.addEventListener(d,this,CD)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(o){o.state===$c.FADING_IN?this._startFadeOutTransition(o):o.state===$c.FADING_OUT&&this._destroyRipple(o)}_startFadeOutTransition(o){let d=o===this._mostRecentTransientRipple,{persistent:r}=o.config;o.state=$c.VISIBLE,!r&&(!d||!this._isPointerDown)&&o.fadeOut()}_destroyRipple(o){let d=this._activeRipples.get(o)??null;this._activeRipples.delete(o),this._activeRipples.size||(this._containerRect=null),o===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),o.state=$c.HIDDEN,d!==null&&(o.element.removeEventListener("transitionend",d.onTransitionEnd),o.element.removeEventListener("transitioncancel",d.onTransitionCancel)),o.element.remove()}_onMousedown(o){let d=iI(o),r=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+p5;!this._target.rippleDisabled&&!d&&!r&&(this._isPointerDown=!0,this.fadeInRipple(o.clientX,o.clientY,this._target.rippleConfig))}_onTouchStart(o){if(!this._target.rippleDisabled&&!nI(o)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let d=o.changedTouches;if(d)for(let r=0;r<d.length;r++)this.fadeInRipple(d[r].clientX,d[r].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(o=>{let d=o.state===$c.VISIBLE||o.config.terminateOnPointerUp&&o.state===$c.FADING_IN;!o.config.persistent&&d&&o.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let o=this._triggerElement;o&&(SD.forEach(d=>Vy._eventManager.removeHandler(d,o,this)),this._pointerUpEventsRegistered&&(ID.forEach(d=>o.removeEventListener(d,this,CD)),this._pointerUpEventsRegistered=!1))}};Vy._eventManager=new cI;var dI=Vy;function f5(c,o,d){let r=Math.max(Math.abs(c-d.left),Math.abs(c-d.right)),s=Math.max(Math.abs(o-d.top),Math.abs(o-d.bottom));return Math.sqrt(r*r+s*s)}var uI=new Hn("mat-ripple-global-options"),G1=(()=>{let o=class o{get disabled(){return this._disabled}set disabled(r){r&&this.fadeOutAllNonPersistent(),this._disabled=r,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(r){this._trigger=r,this._setupTriggerEventsIfEnabled()}constructor(r,s,t,g,w){this._elementRef=r,this._animationMode=w,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=g||{},this._rippleRenderer=new dI(this,s,r,t)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Dn(Dn(Dn({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(r,s=0,t){return typeof r=="number"?this._rippleRenderer.fadeInRipple(r,s,Dn(Dn({},this.rippleConfig),t)):this._rippleRenderer.fadeInRipple(0,0,Dn(Dn({},this.rippleConfig),r))}};o.\u0275fac=function(s){return new(s||o)(_e(Vn),_e(gn),_e(oo),_e(uI,8),_e(_a,8))},o.\u0275dir=io({type:o,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(s,t){s&2&&Ki("mat-ripple-unbounded",t.unbounded)},inputs:{color:[kn.None,"matRippleColor","color"],unbounded:[kn.None,"matRippleUnbounded","unbounded"],centered:[kn.None,"matRippleCentered","centered"],radius:[kn.None,"matRippleRadius","radius"],animation:[kn.None,"matRippleAnimation","animation"],disabled:[kn.None,"matRippleDisabled","disabled"],trigger:[kn.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let c=o;return c})(),DD=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[Wr,Wr]});let c=o;return c})();var TD={capture:!0},MD=["focus","click","mouseenter","touchstart"],aI="mat-ripple-loader-uninitialized",sI="mat-ripple-loader-class-name",kD="mat-ripple-loader-centered",H1="mat-ripple-loader-disabled",AD=(()=>{let o=class o{constructor(){this._document=yr(Kn,{optional:!0}),this._animationMode=yr(_a,{optional:!0}),this._globalRippleOptions=yr(uI,{optional:!0}),this._platform=yr(oo),this._ngZone=yr(gn),this._hosts=new Map,this._onInteraction=r=>{if(!(r.target instanceof HTMLElement))return;let t=r.target.closest(`[${aI}]`);t&&this._createRipple(t)},this._ngZone.runOutsideAngular(()=>{for(let r of MD)this._document?.addEventListener(r,this._onInteraction,TD)})}ngOnDestroy(){let r=this._hosts.keys();for(let s of r)this.destroyRipple(s);for(let s of MD)this._document?.removeEventListener(s,this._onInteraction,TD)}configureRipple(r,s){r.setAttribute(aI,""),(s.className||!r.hasAttribute(sI))&&r.setAttribute(sI,s.className||""),s.centered&&r.setAttribute(kD,""),s.disabled&&r.setAttribute(H1,"")}getRipple(r){return this._hosts.get(r)||this._createRipple(r)}setDisabled(r,s){let t=this._hosts.get(r);if(t){t.disabled=s;return}s?r.setAttribute(H1,""):r.removeAttribute(H1)}_createRipple(r){if(!this._document)return;let s=this._hosts.get(r);if(s)return s;r.querySelector(".mat-ripple")?.remove();let t=this._document.createElement("span");t.classList.add("mat-ripple",r.getAttribute(sI)),r.append(t);let g=new G1(new Vn(t),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return g._isInitialized=!0,g.trigger=r,g.centered=r.hasAttribute(kD),g.disabled=r.hasAttribute(H1),this.attachRipple(r,g),g}attachRipple(r,s){r.removeAttribute(aI),this._hosts.set(r,s)}destroyRipple(r){let s=this._hosts.get(r);s&&(s.ngOnDestroy(),this._hosts.delete(r))}};o.\u0275fac=function(s){return new(s||o)},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),PD=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275cmp=Et({type:o,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(s,t){s&2&&Ki("mdc-form-field--align-end",t.labelPosition==="before")},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[Ur],attrs:o5,ngContentSelectors:a5,decls:1,vars:0,template:function(s,t){s&1&&(qs(),as(0))},styles:[".mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-form-field{font-family:var(--mdc-form-field-label-text-font);line-height:var(--mdc-form-field-label-text-line-height);font-size:var(--mdc-form-field-label-text-size);font-weight:var(--mdc-form-field-label-text-weight);letter-spacing:var(--mdc-form-field-label-text-tracking);color:var(--mdc-form-field-label-text-color)}.mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}"],encapsulation:2,changeDetection:0});let c=o;return c})();function _5(c,o){c&1&&Oe(0,"div",2)}var b5=new Hn("MAT_PROGRESS_BAR_DEFAULT_OPTIONS");var RD=(()=>{let o=class o{constructor(r,s,t,g,w){this._elementRef=r,this._ngZone=s,this._changeDetectorRef=t,this._animationMode=g,this._isNoopAnimation=!1,this._defaultColor="primary",this._value=0,this._bufferValue=0,this.animationEnd=new zn,this._mode="determinate",this._transitionendHandler=M=>{this.animationEnd.observers.length===0||!M.target||!M.target.classList.contains("mdc-linear-progress__primary-bar")||(this.mode==="determinate"||this.mode==="buffer")&&this._ngZone.run(()=>this.animationEnd.next({value:this.value}))},this._isNoopAnimation=g==="NoopAnimations",w&&(w.color&&(this.color=this._defaultColor=w.color),this.mode=w.mode||this.mode)}get color(){return this._color||this._defaultColor}set color(r){this._color=r}get value(){return this._value}set value(r){this._value=OD(r||0),this._changeDetectorRef.markForCheck()}get bufferValue(){return this._bufferValue||0}set bufferValue(r){this._bufferValue=OD(r||0),this._changeDetectorRef.markForCheck()}get mode(){return this._mode}set mode(r){this._mode=r,this._changeDetectorRef.markForCheck()}ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._elementRef.nativeElement.addEventListener("transitionend",this._transitionendHandler)})}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._transitionendHandler)}_getPrimaryBarTransform(){return`scaleX(${this._isIndeterminate()?1:this.value/100})`}_getBufferBarFlexBasis(){return`${this.mode==="buffer"?this.bufferValue:100}%`}_isIndeterminate(){return this.mode==="indeterminate"||this.mode==="query"}};o.\u0275fac=function(s){return new(s||o)(_e(Vn),_e(gn),_e(Oa),_e(_a,8),_e(b5,8))},o.\u0275cmp=Et({type:o,selectors:[["mat-progress-bar"]],hostAttrs:["role","progressbar","aria-valuemin","0","aria-valuemax","100","tabindex","-1",1,"mat-mdc-progress-bar","mdc-linear-progress"],hostVars:10,hostBindings:function(s,t){s&2&&(ir("aria-valuenow",t._isIndeterminate()?null:t.value)("mode",t.mode),Wc("mat-"+t.color),Ki("_mat-animation-noopable",t._isNoopAnimation)("mdc-linear-progress--animation-ready",!t._isNoopAnimation)("mdc-linear-progress--indeterminate",t._isIndeterminate()))},inputs:{color:"color",value:[kn.HasDecoratorInputTransform,"value","value",f0],bufferValue:[kn.HasDecoratorInputTransform,"bufferValue","bufferValue",f0],mode:"mode"},outputs:{animationEnd:"animationEnd"},exportAs:["matProgressBar"],standalone:!0,features:[os,Ur],decls:7,vars:5,consts:[["aria-hidden","true",1,"mdc-linear-progress__buffer"],[1,"mdc-linear-progress__buffer-bar"],[1,"mdc-linear-progress__buffer-dots"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__primary-bar"],[1,"mdc-linear-progress__bar-inner"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__secondary-bar"]],template:function(s,t){s&1&&(U(0,"div",0),Oe(1,"div",1),qt(2,_5,1,0,"div",2),W(),U(3,"div",3),Oe(4,"span",4),W(),U(5,"div",5),Oe(6,"span",4),W()),s&2&&(le(),vl("flex-basis",t._getBufferBarFlexBasis()),le(),hr(2,t.mode==="buffer"?2:-1),le(),vl("transform",t._getPrimaryBarTransform()))},styles:[`@keyframes mdc-linear-progress-primary-indeterminate-translate{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(var(--mdc-linear-progress-primary-half))}100%{transform:translateX(var(--mdc-linear-progress-primary-full))}}@keyframes mdc-linear-progress-primary-indeterminate-scale{0%{transform:scaleX(0.08)}36.65%{animation-timing-function:cubic-bezier(0.334731, 0.12482, 0.785844, 1);transform:scaleX(0.08)}69.15%{animation-timing-function:cubic-bezier(0.06, 0.11, 0.6, 1);transform:scaleX(0.661479)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(var(--mdc-linear-progress-secondary-quarter))}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(var(--mdc-linear-progress-secondary-half))}100%{transform:translateX(var(--mdc-linear-progress-secondary-full))}}@keyframes mdc-linear-progress-secondary-indeterminate-scale{0%{animation-timing-function:cubic-bezier(0.205028, 0.057051, 0.57661, 0.453971);transform:scaleX(0.08)}19.15%{animation-timing-function:cubic-bezier(0.152313, 0.196432, 0.648374, 1.004315);transform:scaleX(0.457104)}44.15%{animation-timing-function:cubic-bezier(0.257759, -0.003163, 0.211762, 1.38179);transform:scaleX(0.72796)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-primary-indeterminate-translate-reverse{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(var(--mdc-linear-progress-primary-half-neg))}100%{transform:translateX(var(--mdc-linear-progress-primary-full-neg))}}@keyframes mdc-linear-progress-secondary-indeterminate-translate-reverse{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(var(--mdc-linear-progress-secondary-quarter-neg))}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(var(--mdc-linear-progress-secondary-half-neg))}100%{transform:translateX(var(--mdc-linear-progress-secondary-full-neg))}}@keyframes mdc-linear-progress-buffering-reverse{from{transform:translateX(-10px)}}.mdc-linear-progress{position:relative;width:100%;transform:translateZ(0);outline:1px solid rgba(0,0,0,0);overflow-x:hidden;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}@media screen and (forced-colors: active){.mdc-linear-progress{outline-color:CanvasText}}.mdc-linear-progress__bar{position:absolute;top:0;bottom:0;margin:auto 0;width:100%;animation:none;transform-origin:top left;transition:transform 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-linear-progress__bar-inner{display:inline-block;position:absolute;width:100%;animation:none;border-top-style:solid}.mdc-linear-progress__buffer{display:flex;position:absolute;top:0;bottom:0;margin:auto 0;width:100%;overflow:hidden}.mdc-linear-progress__buffer-dots{background-repeat:repeat-x;flex:auto;transform:rotate(180deg);-webkit-mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");animation:mdc-linear-progress-buffering 250ms infinite linear}.mdc-linear-progress__buffer-bar{flex:0 1 100%;transition:flex-basis 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-linear-progress__primary-bar{transform:scaleX(0)}.mdc-linear-progress__secondary-bar{display:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__bar{transition:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{left:-145.166611%}.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{left:-54.888891%;display:block}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation:mdc-linear-progress-primary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-primary-indeterminate-scale 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation:mdc-linear-progress-secondary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-secondary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress:not([dir=ltr]) .mdc-linear-progress__bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]) .mdc-linear-progress__bar{right:0;-webkit-transform-origin:center right;transform-origin:center right}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation-name:mdc-linear-progress-primary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation-name:mdc-linear-progress-secondary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress:not([dir=ltr]) .mdc-linear-progress__buffer-dots,.mdc-linear-progress[dir=rtl]:not([dir=ltr]) .mdc-linear-progress__buffer-dots{animation:mdc-linear-progress-buffering-reverse 250ms infinite linear;transform:rotate(0)}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{right:-145.166611%;left:auto}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{right:-54.888891%;left:auto}.mdc-linear-progress--closed{opacity:0}.mdc-linear-progress--closed-animation-off .mdc-linear-progress__buffer-dots{animation:none}.mdc-linear-progress--closed-animation-off.mdc-linear-progress--indeterminate .mdc-linear-progress__bar,.mdc-linear-progress--closed-animation-off.mdc-linear-progress--indeterminate .mdc-linear-progress__bar .mdc-linear-progress__bar-inner{animation:none}@keyframes mdc-linear-progress-buffering{from{transform:rotate(180deg) translateX(calc(var(--mdc-linear-progress-track-height) * -2.5))}}.mdc-linear-progress__bar-inner{border-color:var(--mdc-linear-progress-active-indicator-color)}.mdc-linear-progress__buffer-dots{background-color:var(--mdc-linear-progress-track-color)}@media(forced-colors: active){.mdc-linear-progress__buffer-dots{background-color:ButtonBorder}}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress__buffer-dots{background-color:rgba(0,0,0,0);background-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='none slice'%3E%3Ccircle cx='1' cy='1' r='1' fill='rgba(244, 67, 54, 0.25)'/%3E%3C/svg%3E")}}.mdc-linear-progress__buffer-bar{background-color:var(--mdc-linear-progress-track-color)}.mdc-linear-progress{height:max(var(--mdc-linear-progress-track-height), var(--mdc-linear-progress-active-indicator-height))}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress{height:4px}}.mdc-linear-progress__bar{height:var(--mdc-linear-progress-active-indicator-height)}.mdc-linear-progress__bar-inner{border-top-width:var(--mdc-linear-progress-active-indicator-height)}.mdc-linear-progress__buffer{height:var(--mdc-linear-progress-track-height)}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress__buffer-dots{background-size:10px var(--mdc-linear-progress-track-height)}}.mdc-linear-progress__buffer{border-radius:var(--mdc-linear-progress-track-shape)}.mat-mdc-progress-bar{display:block;text-align:start;--mdc-linear-progress-primary-half: 83.67142%;--mdc-linear-progress-primary-full: 200.611057%;--mdc-linear-progress-secondary-quarter: 37.651913%;--mdc-linear-progress-secondary-half: 84.386165%;--mdc-linear-progress-secondary-full: 160.277782%;--mdc-linear-progress-primary-half-neg: -83.67142%;--mdc-linear-progress-primary-full-neg: -200.611057%;--mdc-linear-progress-secondary-quarter-neg: -37.651913%;--mdc-linear-progress-secondary-half-neg: -84.386165%;--mdc-linear-progress-secondary-full-neg: -160.277782%}.mat-mdc-progress-bar[mode=query]{transform:scaleX(-1)}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-dots,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__secondary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__bar-inner.mdc-linear-progress__bar-inner{animation:none}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-bar{transition:transform 1ms}`],encapsulation:2,changeDetection:0});let c=o;return c})();function OD(c,o=0,d=100){return Math.max(o,Math.min(d,c))}var FD=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[Wr]});let c=o;return c})();var LD=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({});let c=o;return c})();var hI=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[Wr,qc,N1,Wr]});let c=o;return c})();var zD=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[Wr,hI,hI,LD,Wr]});let c=o;return c})();var BD=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[Wr,qc,Wr]});let c=o;return c})();var ND=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[qc,Wr]});let c=o;return c})();var jy=class{attach(o){return this._attachedHost=o,o.attach(this)}detach(){let o=this._attachedHost;o!=null&&(this._attachedHost=null,o.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(o){this._attachedHost=o}},Jp=class extends jy{constructor(o,d,r,s,t){super(),this.component=o,this.viewContainerRef=d,this.injector=r,this.componentFactoryResolver=s,this.projectableNodes=t}},Lg=class extends jy{constructor(o,d,r,s){super(),this.templateRef=o,this.viewContainerRef=d,this.context=r,this.injector=s}get origin(){return this.templateRef.elementRef}attach(o,d=this.context){return this.context=d,super.attach(o)}detach(){return this.context=void 0,super.detach()}},mI=class extends jy{constructor(o){super(),this.element=o instanceof Vn?o.nativeElement:o}},C0=class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(o){if(o instanceof Jp)return this._attachedPortal=o,this.attachComponentPortal(o);if(o instanceof Lg)return this._attachedPortal=o,this.attachTemplatePortal(o);if(this.attachDomPortal&&o instanceof mI)return this._attachedPortal=o,this.attachDomPortal(o)}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(o){this._disposeFn=o}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var q1=class extends C0{constructor(o,d,r,s,t){super(),this.outletElement=o,this._componentFactoryResolver=d,this._appRef=r,this._defaultInjector=s,this.attachDomPortal=g=>{this._document;let w=g.element;w.parentNode;let M=this._document.createComment("dom-portal");w.parentNode.insertBefore(M,w),this.outletElement.appendChild(w),this._attachedPortal=g,super.setDisposeFn(()=>{M.parentNode&&M.parentNode.replaceChild(w,M)})},this._document=t}attachComponentPortal(o){let r=(o.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(o.component),s;return o.viewContainerRef?(s=o.viewContainerRef.createComponent(r,o.viewContainerRef.length,o.injector||o.viewContainerRef.injector,o.projectableNodes||void 0),this.setDisposeFn(()=>s.destroy())):(s=r.create(o.injector||this._defaultInjector||Uc.NULL),this._appRef.attachView(s.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(s.hostView),s.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(s)),this._attachedPortal=o,s}attachTemplatePortal(o){let d=o.viewContainerRef,r=d.createEmbeddedView(o.templateRef,o.context,{injector:o.injector});return r.rootNodes.forEach(s=>this.outletElement.appendChild(s)),r.detectChanges(),this.setDisposeFn(()=>{let s=d.indexOf(r);s!==-1&&d.remove(s)}),this._attachedPortal=o,r}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(o){return o.hostView.rootNodes[0]}};var ef=(()=>{let o=class o extends C0{constructor(r,s,t){super(),this._componentFactoryResolver=r,this._viewContainerRef=s,this._isInitialized=!1,this.attached=new zn,this.attachDomPortal=g=>{this._document;let w=g.element;w.parentNode;let M=this._document.createComment("dom-portal");g.setAttachedHost(this),w.parentNode.insertBefore(M,w),this._getRootNode().appendChild(w),this._attachedPortal=g,super.setDisposeFn(()=>{M.parentNode&&M.parentNode.replaceChild(w,M)})},this._document=t}get portal(){return this._attachedPortal}set portal(r){this.hasAttached()&&!r&&!this._isInitialized||(this.hasAttached()&&super.detach(),r&&super.attach(r),this._attachedPortal=r||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(r){r.setAttachedHost(this);let s=r.viewContainerRef!=null?r.viewContainerRef:this._viewContainerRef,g=(r.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(r.component),w=s.createComponent(g,s.length,r.injector||s.injector,r.projectableNodes||void 0);return s!==this._viewContainerRef&&this._getRootNode().appendChild(w.hostView.rootNodes[0]),super.setDisposeFn(()=>w.destroy()),this._attachedPortal=r,this._attachedRef=w,this.attached.emit(w),w}attachTemplatePortal(r){r.setAttachedHost(this);let s=this._viewContainerRef.createEmbeddedView(r.templateRef,r.context,{injector:r.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=r,this._attachedRef=s,this.attached.emit(s),s}_getRootNode(){let r=this._viewContainerRef.element.nativeElement;return r.nodeType===r.ELEMENT_NODE?r:r.parentNode}};o.\u0275fac=function(s){return new(s||o)(_e(Ey),_e(p0),_e(Kn))},o.\u0275dir=io({type:o,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[kn.None,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],standalone:!0,features:[Gs]});let c=o;return c})();var Lm=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({});let c=o;return c})();var x5=20,VD=(()=>{let o=class o{constructor(r,s,t){this._ngZone=r,this._platform=s,this._scrolled=new Or,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=t}register(r){this.scrollContainers.has(r)||this.scrollContainers.set(r,r.elementScrolled().subscribe(()=>this._scrolled.next(r)))}deregister(r){let s=this.scrollContainers.get(r);s&&(s.unsubscribe(),this.scrollContainers.delete(r))}scrolled(r=x5){return this._platform.isBrowser?new ga(s=>{this._globalSubscription||this._addGlobalListener();let t=r>0?this._scrolled.pipe(LS(r)).subscribe(s):this._scrolled.subscribe(s);return this._scrolledCount++,()=>{t.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Ln()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((r,s)=>this.deregister(s)),this._scrolled.complete()}ancestorScrolled(r,s){let t=this.getAncestorScrollContainers(r);return this.scrolled(s).pipe(oc(g=>!g||t.indexOf(g)>-1))}getAncestorScrollContainers(r){let s=[];return this.scrollContainers.forEach((t,g)=>{this._scrollableContainsElement(g,r)&&s.push(g)}),s}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(r,s){let t=Om(s),g=r.getElementRef().nativeElement;do if(t==g)return!0;while(t=t.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let r=this._getWindow();return xE(r.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};o.\u0275fac=function(s){return new(s||o)(wt(gn),wt(oo),wt(Kn,8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var w5=20,pI=(()=>{let o=class o{constructor(r,s,t){this._platform=r,this._change=new Or,this._changeListener=g=>{this._change.next(g)},this._document=t,s.runOutsideAngular(()=>{if(r.isBrowser){let g=this._getWindow();g.addEventListener("resize",this._changeListener),g.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let r=this._getWindow();r.removeEventListener("resize",this._changeListener),r.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let r={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),r}getViewportRect(){let r=this.getViewportScrollPosition(),{width:s,height:t}=this.getViewportSize();return{top:r.top,left:r.left,bottom:r.top+t,right:r.left+s,height:t,width:s}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let r=this._document,s=this._getWindow(),t=r.documentElement,g=t.getBoundingClientRect(),w=-g.top||r.body.scrollTop||s.scrollY||t.scrollTop||0,M=-g.left||r.body.scrollLeft||s.scrollX||t.scrollLeft||0;return{top:w,left:M}}change(r=w5){return r>0?this._change.pipe(LS(r)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let r=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:r.innerWidth,height:r.innerHeight}:{width:0,height:0}}};o.\u0275fac=function(s){return new(s||o)(wt(oo),wt(gn),wt(Kn,8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var $1=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({});let c=o;return c})(),fI=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[Kp,$1,Kp,$1]});let c=o;return c})();var jD=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[Wr,Wr]});let c=o;return c})();var S5=["switch"],I5=["*"];function T5(c,o){c&1&&(U(0,"div",10),Yp(),U(1,"svg",12),Oe(2,"path",13),W(),U(3,"svg",14),Oe(4,"path",15),W()())}var M5=new Hn("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1})}),k5={provide:jE,useExisting:ky(()=>UD),multi:!0},Y1=class{constructor(o,d){this.source=o,this.checked=d}},E5=0,UD=(()=>{let o=class o{_createChangeEvent(r){return new Y1(this,r)}get buttonId(){return`${this.id||this._uniqueId}-button`}focus(){this._switchElement.nativeElement.focus()}get checked(){return this._checked}set checked(r){this._checked=r,this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(r,s,t,g,w,M){this._elementRef=r,this._focusMonitor=s,this._changeDetectorRef=t,this.defaults=w,this._onChange=F=>{},this._onTouched=()=>{},this._validatorOnChange=()=>{},this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.change=new zn,this.toggleChange=new zn,this.tabIndex=parseInt(g)||0,this.color=w.color||"accent",this._noopAnimations=M==="NoopAnimations",this.id=this._uniqueId=`mat-mdc-slide-toggle-${++E5}`,this.hideIcon=w.hideIcon??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(r=>{r==="keyboard"||r==="program"?(this._focused=!0,this._changeDetectorRef.markForCheck()):r||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(r){r.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(r){this.checked=!!r}registerOnChange(r){this._onChange=r}registerOnTouched(r){this._onTouched=r}validate(r){return this.required&&r.value!==!0?{required:!0}:null}registerOnValidatorChange(r){this._validatorOnChange=r}setDisabledState(r){this.disabled=r,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new Y1(this,this.checked)))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}};o.\u0275fac=function(s){return new(s||o)(_e(Vn),_e(Rm),_e(Oa),Dg("tabindex"),_e(M5),_e(_a,8))},o.\u0275cmp=Et({type:o,selectors:[["mat-slide-toggle"]],viewQuery:function(s,t){if(s&1&&Vi(S5,5),s&2){let g;zi(g=Bi())&&(t._switchElement=g.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(s,t){s&2&&(Pm("id",t.id),ir("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),Wc(t.color?"mat-"+t.color:""),Ki("mat-mdc-slide-toggle-focused",t._focused)("mat-mdc-slide-toggle-checked",t.checked)("_mat-animation-noopable",t._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[kn.None,"aria-label","ariaLabel"],ariaLabelledby:[kn.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[kn.None,"aria-describedby","ariaDescribedby"],required:[kn.HasDecoratorInputTransform,"required","required",Ha],color:"color",disabled:[kn.HasDecoratorInputTransform,"disabled","disabled",Ha],disableRipple:[kn.HasDecoratorInputTransform,"disableRipple","disableRipple",Ha],tabIndex:[kn.HasDecoratorInputTransform,"tabIndex","tabIndex",r=>r==null?0:f0(r)],checked:[kn.HasDecoratorInputTransform,"checked","checked",Ha],hideIcon:[kn.HasDecoratorInputTransform,"hideIcon","hideIcon",Ha]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],standalone:!0,features:[Hc([k5,{provide:UE,useExisting:o,multi:!0}]),os,rs,Ur],ngContentSelectors:I5,decls:13,vars:24,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(s,t){if(s&1){let g=ai();qs(),U(0,"div",1)(1,"button",2,0),Ne("click",function(){return St(g),It(t._handleClick())}),Oe(3,"div",3),U(4,"div",4)(5,"div",5)(6,"div",6),Oe(7,"div",7),W(),U(8,"div",8),Oe(9,"div",9),W(),qt(10,T5,5,0,"div",10),W()()(),U(11,"label",11),Ne("click",function(M){return St(g),It(M.stopPropagation())}),as(12),W()()}if(s&2){let g=xl(2);ze("labelPosition",t.labelPosition),le(),Ki("mdc-switch--selected",t.checked)("mdc-switch--unselected",!t.checked)("mdc-switch--checked",t.checked)("mdc-switch--disabled",t.disabled),ze("tabIndex",t.disabled?-1:t.tabIndex)("disabled",t.disabled),ir("id",t.buttonId)("name",t.name)("aria-label",t.ariaLabel)("aria-labelledby",t._getAriaLabelledBy())("aria-describedby",t.ariaDescribedby)("aria-required",t.required||null)("aria-checked",t.checked),le(8),ze("matRippleTrigger",g)("matRippleDisabled",t.disableRipple||t.disabled)("matRippleCentered",!0),le(),hr(10,t.hideIcon?-1:10),le(),ze("for",t.buttonId),ir("id",t._labelId)}},dependencies:[G1,PD],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1);background-color:var(--mdc-elevation-overlay-color)}.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative}.mdc-switch[hidden]{display:none}.mdc-switch:disabled{cursor:default;pointer-events:none}.mdc-switch__track{overflow:hidden;position:relative;width:100%}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%}@media screen and (forced-colors: active){.mdc-switch__track::before,.mdc-switch__track::after{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(-100%)}[dir=rtl] .mdc-switch__track::after,.mdc-switch__track[dir=rtl]::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track[dir=rtl]::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0)}[dir=rtl] .mdc-switch__handle-track,.mdc-switch__handle-track[dir=rtl]{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track,.mdc-switch--selected .mdc-switch__handle-track[dir=rtl]{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto}[dir=rtl] .mdc-switch__handle,.mdc-switch__handle[dir=rtl]{left:auto;right:0}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media screen and (forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-elevation-overlay{bottom:0;left:0;right:0;top:0}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1}.mdc-switch:disabled .mdc-switch__ripple{display:none}.mdc-switch__icons{height:100%;position:relative;width:100%;z-index:1}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}.mdc-switch{width:var(--mdc-switch-track-width)}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color)}.mdc-switch.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color)}.mdc-switch .mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation)}.mdc-switch .mdc-switch__focus-ring-wrapper,.mdc-switch .mdc-switch__handle{height:var(--mdc-switch-handle-height)}.mdc-switch .mdc-switch__handle{border-radius:var(--mdc-switch-handle-shape)}.mdc-switch .mdc-switch__handle{width:var(--mdc-switch-handle-width)}.mdc-switch .mdc-switch__handle-track{width:calc(100% - var(--mdc-switch-handle-width))}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__icon{fill:var(--mdc-switch-selected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__icon{fill:var(--mdc-switch-unselected-icon-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size)}.mdc-switch.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-hover-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-focus-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-pressed-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-hover-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-focus-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-pressed-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-selected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-selected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-unselected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-unselected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch .mdc-switch__ripple{height:var(--mdc-switch-state-layer-size);width:var(--mdc-switch-state-layer-size)}.mdc-switch .mdc-switch__track{height:var(--mdc-switch-track-height)}.mdc-switch:disabled .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch:enabled .mdc-switch__track::after{background:var(--mdc-switch-selected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color)}.mdc-switch:enabled .mdc-switch__track::before{background:var(--mdc-switch-unselected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color)}.mdc-switch .mdc-switch__track{border-radius:var(--mdc-switch-track-shape)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mat-mdc-slide-toggle{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle .mdc-switch__ripple::after{content:"";opacity:0}.mat-mdc-slide-toggle .mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:opacity 75ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-elevation-overlay,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mdc-switch__handle{transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size);height:var(--mat-switch-unselected-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size);height:var(--mat-switch-selected-handle-size)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size);height:var(--mat-switch-with-icon-handle-size)}.mat-mdc-slide-toggle:active .mdc-switch:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size);height:var(--mat-switch-pressed-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{margin:var(--mat-switch-selected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{margin:var(--mat-switch-unselected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--selected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--unselected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin)}.mdc-switch__track::after,.mdc-switch__track::before{border-width:var(--mat-switch-track-outline-width);border-color:var(--mat-switch-track-outline-color)}.mdc-switch--selected .mdc-switch__track::after,.mdc-switch--selected .mdc-switch__track::before{border-width:var(--mat-switch-selected-track-outline-width)}.mdc-switch--disabled .mdc-switch__track::after,.mdc-switch--disabled .mdc-switch__track::before{border-width:var(--mat-switch-disabled-unselected-track-outline-width);border-color:var(--mat-switch-disabled-unselected-track-outline-color)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity)}'],encapsulation:2,changeDetection:0});let c=o;return c})();var WD=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[UD,Wr,Wr]});let c=o;return c})();var HD=sD(),gI=class{constructor(o,d){this._viewportRuler=o,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=d}attach(){}enable(){if(this._canBeEnabled()){let o=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=o.style.left||"",this._previousHTMLStyles.top=o.style.top||"",o.style.left=ca(-this._previousScrollPosition.left),o.style.top=ca(-this._previousScrollPosition.top),o.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let o=this._document.documentElement,d=this._document.body,r=o.style,s=d.style,t=r.scrollBehavior||"",g=s.scrollBehavior||"";this._isEnabled=!1,r.left=this._previousHTMLStyles.left,r.top=this._previousHTMLStyles.top,o.classList.remove("cdk-global-scrollblock"),HD&&(r.scrollBehavior=s.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),HD&&(r.scrollBehavior=t,s.scrollBehavior=g)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let d=this._document.body,r=this._viewportRuler.getViewportSize();return d.scrollHeight>r.height||d.scrollWidth>r.width}};var _I=class{constructor(o,d,r,s){this._scrollDispatcher=o,this._ngZone=d,this._viewportRuler=r,this._config=s,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(o){this._overlayRef,this._overlayRef=o}enable(){if(this._scrollSubscription)return;let o=this._scrollDispatcher.scrolled(0).pipe(oc(d=>!d||!this._overlayRef.overlayElement.contains(d.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=o.subscribe(()=>{let d=this._viewportRuler.getViewportScrollPosition().top;Math.abs(d-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=o.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},Z1=class{enable(){}disable(){}attach(){}};function bI(c,o){return o.some(d=>{let r=c.bottom<d.top,s=c.top>d.bottom,t=c.right<d.left,g=c.left>d.right;return r||s||t||g})}function GD(c,o){return o.some(d=>{let r=c.top<d.top,s=c.bottom>d.bottom,t=c.left<d.left,g=c.right>d.right;return r||s||t||g})}var yI=class{constructor(o,d,r,s){this._scrollDispatcher=o,this._viewportRuler=d,this._ngZone=r,this._config=s,this._scrollSubscription=null}attach(o){this._overlayRef,this._overlayRef=o}enable(){if(!this._scrollSubscription){let o=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(o).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let d=this._overlayRef.overlayElement.getBoundingClientRect(),{width:r,height:s}=this._viewportRuler.getViewportSize();bI(d,[{width:r,height:s,bottom:s,right:r,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},D5=(()=>{let o=class o{constructor(r,s,t,g){this._scrollDispatcher=r,this._viewportRuler=s,this._ngZone=t,this.noop=()=>new Z1,this.close=w=>new _I(this._scrollDispatcher,this._ngZone,this._viewportRuler,w),this.block=()=>new gI(this._viewportRuler,this._document),this.reposition=w=>new yI(this._scrollDispatcher,this._viewportRuler,this._ngZone,w),this._document=g}};o.\u0275fac=function(s){return new(s||o)(wt(VD),wt(pI),wt(gn),wt(Kn))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),S0=class{constructor(o){if(this.scrollStrategy=new Z1,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,o){let d=Object.keys(o);for(let r of d)o[r]!==void 0&&(this[r]=o[r])}}};var vI=class{constructor(o,d){this.connectionPair=o,this.scrollableViewProperties=d}};var XD=(()=>{let o=class o{constructor(r){this._attachedOverlays=[],this._document=r}ngOnDestroy(){this.detach()}add(r){this.remove(r),this._attachedOverlays.push(r)}remove(r){let s=this._attachedOverlays.indexOf(r);s>-1&&this._attachedOverlays.splice(s,1),this._attachedOverlays.length===0&&this.detach()}};o.\u0275fac=function(s){return new(s||o)(wt(Kn))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),A5=(()=>{let o=class o extends XD{constructor(r,s){super(r),this._ngZone=s,this._keydownListener=t=>{let g=this._attachedOverlays;for(let w=g.length-1;w>-1;w--)if(g[w]._keydownEvents.observers.length>0){let M=g[w]._keydownEvents;this._ngZone?this._ngZone.run(()=>M.next(t)):M.next(t);break}}}add(r){super.add(r),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}};o.\u0275fac=function(s){return new(s||o)(wt(Kn),wt(gn,8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),P5=(()=>{let o=class o extends XD{constructor(r,s,t){super(r),this._platform=s,this._ngZone=t,this._cursorStyleIsSet=!1,this._pointerDownListener=g=>{this._pointerDownEventTarget=Gd(g)},this._clickListener=g=>{let w=Gd(g),M=g.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:w;this._pointerDownEventTarget=null;let F=this._attachedOverlays.slice();for(let N=F.length-1;N>-1;N--){let Q=F[N];if(Q._outsidePointerEvents.observers.length<1||!Q.hasAttached())continue;if(Q.overlayElement.contains(w)||Q.overlayElement.contains(M))break;let ae=Q._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>ae.next(g)):ae.next(g)}}}add(r){if(super.add(r),!this._isAttached){let s=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(s)):this._addEventListeners(s),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=s.style.cursor,s.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let r=this._document.body;r.removeEventListener("pointerdown",this._pointerDownListener,!0),r.removeEventListener("click",this._clickListener,!0),r.removeEventListener("auxclick",this._clickListener,!0),r.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(r.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(r){r.addEventListener("pointerdown",this._pointerDownListener,!0),r.addEventListener("click",this._clickListener,!0),r.addEventListener("auxclick",this._clickListener,!0),r.addEventListener("contextmenu",this._clickListener,!0)}};o.\u0275fac=function(s){return new(s||o)(wt(Kn),wt(oo),wt(gn,8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),I0=(()=>{let o=class o{constructor(r,s){this._platform=s,this._document=r}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let r="cdk-overlay-container";if(this._platform.isBrowser||Ly()){let t=this._document.querySelectorAll(`.${r}[platform="server"], .${r}[platform="test"]`);for(let g=0;g<t.length;g++)t[g].remove()}let s=this._document.createElement("div");s.classList.add(r),Ly()?s.setAttribute("platform","test"):this._platform.isBrowser||s.setAttribute("platform","server"),this._document.body.appendChild(s),this._containerElement=s}};o.\u0275fac=function(s){return new(s||o)(wt(Kn),wt(oo))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),zm=class{constructor(o,d,r,s,t,g,w,M,F,N=!1){this._portalOutlet=o,this._host=d,this._pane=r,this._config=s,this._ngZone=t,this._keyboardDispatcher=g,this._document=w,this._location=M,this._outsideClickDispatcher=F,this._animationsDisabled=N,this._backdropElement=null,this._backdropClick=new Or,this._attachments=new Or,this._detachments=new Or,this._locationChanges=rc.EMPTY,this._backdropClickHandler=Q=>this._backdropClick.next(Q),this._backdropTransitionendHandler=Q=>{this._disposeBackdrop(Q.target)},this._keydownEvents=new Or,this._outsidePointerEvents=new Or,s.scrollStrategy&&(this._scrollStrategy=s.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=s.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(o){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let d=this._portalOutlet.attach(o);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(jc(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof d?.onDestroy=="function"&&d.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),d}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let o=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),o}dispose(){let o=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,o&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(o){o!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=o,this.hasAttached()&&(o.attach(this),this.updatePosition()))}updateSize(o){this._config=Dn(Dn({},this._config),o),this._updateElementSize()}setDirection(o){this._config=yl(Dn({},this._config),{direction:o}),this._updateElementDirection()}addPanelClass(o){this._pane&&this._toggleClasses(this._pane,o,!0)}removePanelClass(o){this._pane&&this._toggleClasses(this._pane,o,!1)}getDirection(){let o=this._config.direction;return o?typeof o=="string"?o:o.value:"ltr"}updateScrollStrategy(o){o!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=o,this.hasAttached()&&(o.attach(this),o.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let o=this._pane.style;o.width=ca(this._config.width),o.height=ca(this._config.height),o.minWidth=ca(this._config.minWidth),o.minHeight=ca(this._config.minHeight),o.maxWidth=ca(this._config.maxWidth),o.maxHeight=ca(this._config.maxHeight)}_togglePointerEvents(o){this._pane.style.pointerEvents=o?"":"none"}_attachBackdrop(){let o="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(o)})}):this._backdropElement.classList.add(o)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let o=this._backdropElement;if(o){if(this._animationsDisabled){this._disposeBackdrop(o);return}o.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{o.addEventListener("transitionend",this._backdropTransitionendHandler)}),o.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(o)},500))}}_toggleClasses(o,d,r){let s=v0(d||[]).filter(t=>!!t);s.length&&(r?o.classList.add(...s):o.classList.remove(...s))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{let o=this._ngZone.onStable.pipe(Eg(kg(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),o.unsubscribe())})})}_disposeScrollStrategy(){let o=this._scrollStrategy;o&&(o.disable(),o.detach&&o.detach())}_disposeBackdrop(o){o&&(o.removeEventListener("click",this._backdropClickHandler),o.removeEventListener("transitionend",this._backdropTransitionendHandler),o.remove(),this._backdropElement===o&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},qD="cdk-overlay-connected-position-bounding-box",O5=/([A-Za-z%]+)$/,X1=class{get positions(){return this._preferredPositions}constructor(o,d,r,s,t){this._viewportRuler=d,this._document=r,this._platform=s,this._overlayContainer=t,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Or,this._resizeSubscription=rc.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(o)}attach(o){this._overlayRef&&this._overlayRef,this._validatePositions(),o.hostElement.classList.add(qD),this._overlayRef=o,this._boundingBox=o.hostElement,this._pane=o.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let o=this._originRect,d=this._overlayRect,r=this._viewportRect,s=this._containerRect,t=[],g;for(let w of this._preferredPositions){let M=this._getOriginPoint(o,s,w),F=this._getOverlayPoint(M,d,w),N=this._getOverlayFit(F,d,r,w);if(N.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(w,M);return}if(this._canFitWithFlexibleDimensions(N,F,r)){t.push({position:w,origin:M,overlayRect:d,boundingBoxRect:this._calculateBoundingBoxRect(M,w)});continue}(!g||g.overlayFit.visibleArea<N.visibleArea)&&(g={overlayFit:N,overlayPoint:F,originPoint:M,position:w,overlayRect:d})}if(t.length){let w=null,M=-1;for(let F of t){let N=F.boundingBoxRect.width*F.boundingBoxRect.height*(F.position.weight||1);N>M&&(M=N,w=F)}this._isPushed=!1,this._applyPosition(w.position,w.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(g.position,g.originPoint);return}this._applyPosition(g.position,g.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&zg(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(qD),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let o=this._lastPosition;if(o){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let d=this._getOriginPoint(this._originRect,this._containerRect,o);this._applyPosition(o,d)}else this.apply()}withScrollableContainers(o){return this._scrollables=o,this}withPositions(o){return this._preferredPositions=o,o.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(o){return this._viewportMargin=o,this}withFlexibleDimensions(o=!0){return this._hasFlexibleDimensions=o,this}withGrowAfterOpen(o=!0){return this._growAfterOpen=o,this}withPush(o=!0){return this._canPush=o,this}withLockedPosition(o=!0){return this._positionLocked=o,this}setOrigin(o){return this._origin=o,this}withDefaultOffsetX(o){return this._offsetX=o,this}withDefaultOffsetY(o){return this._offsetY=o,this}withTransformOriginOn(o){return this._transformOriginSelector=o,this}_getOriginPoint(o,d,r){let s;if(r.originX=="center")s=o.left+o.width/2;else{let g=this._isRtl()?o.right:o.left,w=this._isRtl()?o.left:o.right;s=r.originX=="start"?g:w}d.left<0&&(s-=d.left);let t;return r.originY=="center"?t=o.top+o.height/2:t=r.originY=="top"?o.top:o.bottom,d.top<0&&(t-=d.top),{x:s,y:t}}_getOverlayPoint(o,d,r){let s;r.overlayX=="center"?s=-d.width/2:r.overlayX==="start"?s=this._isRtl()?-d.width:0:s=this._isRtl()?0:-d.width;let t;return r.overlayY=="center"?t=-d.height/2:t=r.overlayY=="top"?0:-d.height,{x:o.x+s,y:o.y+t}}_getOverlayFit(o,d,r,s){let t=YD(d),{x:g,y:w}=o,M=this._getOffset(s,"x"),F=this._getOffset(s,"y");M&&(g+=M),F&&(w+=F);let N=0-g,Q=g+t.width-r.width,ae=0-w,pe=w+t.height-r.height,Te=this._subtractOverflows(t.width,N,Q),Pe=this._subtractOverflows(t.height,ae,pe),Re=Te*Pe;return{visibleArea:Re,isCompletelyWithinViewport:t.width*t.height===Re,fitsInViewportVertically:Pe===t.height,fitsInViewportHorizontally:Te==t.width}}_canFitWithFlexibleDimensions(o,d,r){if(this._hasFlexibleDimensions){let s=r.bottom-d.y,t=r.right-d.x,g=$D(this._overlayRef.getConfig().minHeight),w=$D(this._overlayRef.getConfig().minWidth),M=o.fitsInViewportVertically||g!=null&&g<=s,F=o.fitsInViewportHorizontally||w!=null&&w<=t;return M&&F}return!1}_pushOverlayOnScreen(o,d,r){if(this._previousPushAmount&&this._positionLocked)return{x:o.x+this._previousPushAmount.x,y:o.y+this._previousPushAmount.y};let s=YD(d),t=this._viewportRect,g=Math.max(o.x+s.width-t.width,0),w=Math.max(o.y+s.height-t.height,0),M=Math.max(t.top-r.top-o.y,0),F=Math.max(t.left-r.left-o.x,0),N=0,Q=0;return s.width<=t.width?N=F||-g:N=o.x<this._viewportMargin?t.left-r.left-o.x:0,s.height<=t.height?Q=M||-w:Q=o.y<this._viewportMargin?t.top-r.top-o.y:0,this._previousPushAmount={x:N,y:Q},{x:o.x+N,y:o.y+Q}}_applyPosition(o,d){if(this._setTransformOrigin(o),this._setOverlayElementStyles(d,o),this._setBoundingBoxStyles(d,o),o.panelClass&&this._addPanelClasses(o.panelClass),this._positionChanges.observers.length){let r=this._getScrollVisibility();if(o!==this._lastPosition||!this._lastScrollVisibility||!R5(this._lastScrollVisibility,r)){let s=new vI(o,r);this._positionChanges.next(s)}this._lastScrollVisibility=r}this._lastPosition=o,this._isInitialRender=!1}_setTransformOrigin(o){if(!this._transformOriginSelector)return;let d=this._boundingBox.querySelectorAll(this._transformOriginSelector),r,s=o.overlayY;o.overlayX==="center"?r="center":this._isRtl()?r=o.overlayX==="start"?"right":"left":r=o.overlayX==="start"?"left":"right";for(let t=0;t<d.length;t++)d[t].style.transformOrigin=`${r} ${s}`}_calculateBoundingBoxRect(o,d){let r=this._viewportRect,s=this._isRtl(),t,g,w;if(d.overlayY==="top")g=o.y,t=r.height-g+this._viewportMargin;else if(d.overlayY==="bottom")w=r.height-o.y+this._viewportMargin*2,t=r.height-w+this._viewportMargin;else{let pe=Math.min(r.bottom-o.y+r.top,o.y),Te=this._lastBoundingBoxSize.height;t=pe*2,g=o.y-pe,t>Te&&!this._isInitialRender&&!this._growAfterOpen&&(g=o.y-Te/2)}let M=d.overlayX==="start"&&!s||d.overlayX==="end"&&s,F=d.overlayX==="end"&&!s||d.overlayX==="start"&&s,N,Q,ae;if(F)ae=r.width-o.x+this._viewportMargin*2,N=o.x-this._viewportMargin;else if(M)Q=o.x,N=r.right-o.x;else{let pe=Math.min(r.right-o.x+r.left,o.x),Te=this._lastBoundingBoxSize.width;N=pe*2,Q=o.x-pe,N>Te&&!this._isInitialRender&&!this._growAfterOpen&&(Q=o.x-Te/2)}return{top:g,left:Q,bottom:w,right:ae,width:N,height:t}}_setBoundingBoxStyles(o,d){let r=this._calculateBoundingBoxRect(o,d);!this._isInitialRender&&!this._growAfterOpen&&(r.height=Math.min(r.height,this._lastBoundingBoxSize.height),r.width=Math.min(r.width,this._lastBoundingBoxSize.width));let s={};if(this._hasExactPosition())s.top=s.left="0",s.bottom=s.right=s.maxHeight=s.maxWidth="",s.width=s.height="100%";else{let t=this._overlayRef.getConfig().maxHeight,g=this._overlayRef.getConfig().maxWidth;s.height=ca(r.height),s.top=ca(r.top),s.bottom=ca(r.bottom),s.width=ca(r.width),s.left=ca(r.left),s.right=ca(r.right),d.overlayX==="center"?s.alignItems="center":s.alignItems=d.overlayX==="end"?"flex-end":"flex-start",d.overlayY==="center"?s.justifyContent="center":s.justifyContent=d.overlayY==="bottom"?"flex-end":"flex-start",t&&(s.maxHeight=ca(t)),g&&(s.maxWidth=ca(g))}this._lastBoundingBoxSize=r,zg(this._boundingBox.style,s)}_resetBoundingBoxStyles(){zg(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){zg(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(o,d){let r={},s=this._hasExactPosition(),t=this._hasFlexibleDimensions,g=this._overlayRef.getConfig();if(s){let N=this._viewportRuler.getViewportScrollPosition();zg(r,this._getExactOverlayY(d,o,N)),zg(r,this._getExactOverlayX(d,o,N))}else r.position="static";let w="",M=this._getOffset(d,"x"),F=this._getOffset(d,"y");M&&(w+=`translateX(${M}px) `),F&&(w+=`translateY(${F}px)`),r.transform=w.trim(),g.maxHeight&&(s?r.maxHeight=ca(g.maxHeight):t&&(r.maxHeight="")),g.maxWidth&&(s?r.maxWidth=ca(g.maxWidth):t&&(r.maxWidth="")),zg(this._pane.style,r)}_getExactOverlayY(o,d,r){let s={top:"",bottom:""},t=this._getOverlayPoint(d,this._overlayRect,o);if(this._isPushed&&(t=this._pushOverlayOnScreen(t,this._overlayRect,r)),o.overlayY==="bottom"){let g=this._document.documentElement.clientHeight;s.bottom=`${g-(t.y+this._overlayRect.height)}px`}else s.top=ca(t.y);return s}_getExactOverlayX(o,d,r){let s={left:"",right:""},t=this._getOverlayPoint(d,this._overlayRect,o);this._isPushed&&(t=this._pushOverlayOnScreen(t,this._overlayRect,r));let g;if(this._isRtl()?g=o.overlayX==="end"?"left":"right":g=o.overlayX==="end"?"right":"left",g==="right"){let w=this._document.documentElement.clientWidth;s.right=`${w-(t.x+this._overlayRect.width)}px`}else s.left=ca(t.x);return s}_getScrollVisibility(){let o=this._getOriginRect(),d=this._pane.getBoundingClientRect(),r=this._scrollables.map(s=>s.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:GD(o,r),isOriginOutsideView:bI(o,r),isOverlayClipped:GD(d,r),isOverlayOutsideView:bI(d,r)}}_subtractOverflows(o,...d){return d.reduce((r,s)=>r-Math.max(s,0),o)}_getNarrowedViewportRect(){let o=this._document.documentElement.clientWidth,d=this._document.documentElement.clientHeight,r=this._viewportRuler.getViewportScrollPosition();return{top:r.top+this._viewportMargin,left:r.left+this._viewportMargin,right:r.left+o-this._viewportMargin,bottom:r.top+d-this._viewportMargin,width:o-2*this._viewportMargin,height:d-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(o,d){return d==="x"?o.offsetX==null?this._offsetX:o.offsetX:o.offsetY==null?this._offsetY:o.offsetY}_validatePositions(){}_addPanelClasses(o){this._pane&&v0(o).forEach(d=>{d!==""&&this._appliedPanelClasses.indexOf(d)===-1&&(this._appliedPanelClasses.push(d),this._pane.classList.add(d))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(o=>{this._pane.classList.remove(o)}),this._appliedPanelClasses=[])}_getOriginRect(){let o=this._origin;if(o instanceof Vn)return o.nativeElement.getBoundingClientRect();if(o instanceof Element)return o.getBoundingClientRect();let d=o.width||0,r=o.height||0;return{top:o.y,bottom:o.y+r,left:o.x,right:o.x+d,height:r,width:d}}};function zg(c,o){for(let d in o)o.hasOwnProperty(d)&&(c[d]=o[d]);return c}function $D(c){if(typeof c!="number"&&c!=null){let[o,d]=c.split(O5);return!d||d==="px"?parseFloat(o):null}return c||null}function YD(c){return{top:Math.floor(c.top),right:Math.floor(c.right),bottom:Math.floor(c.bottom),left:Math.floor(c.left),width:Math.floor(c.width),height:Math.floor(c.height)}}function R5(c,o){return c===o?!0:c.isOriginClipped===o.isOriginClipped&&c.isOriginOutsideView===o.isOriginOutsideView&&c.isOverlayClipped===o.isOverlayClipped&&c.isOverlayOutsideView===o.isOverlayOutsideView}var ZD="cdk-global-overlay-wrapper",xI=class{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(o){let d=o.getConfig();this._overlayRef=o,this._width&&!d.width&&o.updateSize({width:this._width}),this._height&&!d.height&&o.updateSize({height:this._height}),o.hostElement.classList.add(ZD),this._isDisposed=!1}top(o=""){return this._bottomOffset="",this._topOffset=o,this._alignItems="flex-start",this}left(o=""){return this._xOffset=o,this._xPosition="left",this}bottom(o=""){return this._topOffset="",this._bottomOffset=o,this._alignItems="flex-end",this}right(o=""){return this._xOffset=o,this._xPosition="right",this}start(o=""){return this._xOffset=o,this._xPosition="start",this}end(o=""){return this._xOffset=o,this._xPosition="end",this}width(o=""){return this._overlayRef?this._overlayRef.updateSize({width:o}):this._width=o,this}height(o=""){return this._overlayRef?this._overlayRef.updateSize({height:o}):this._height=o,this}centerHorizontally(o=""){return this.left(o),this._xPosition="center",this}centerVertically(o=""){return this.top(o),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let o=this._overlayRef.overlayElement.style,d=this._overlayRef.hostElement.style,r=this._overlayRef.getConfig(),{width:s,height:t,maxWidth:g,maxHeight:w}=r,M=(s==="100%"||s==="100vw")&&(!g||g==="100%"||g==="100vw"),F=(t==="100%"||t==="100vh")&&(!w||w==="100%"||w==="100vh"),N=this._xPosition,Q=this._xOffset,ae=this._overlayRef.getConfig().direction==="rtl",pe="",Te="",Pe="";M?Pe="flex-start":N==="center"?(Pe="center",ae?Te=Q:pe=Q):ae?N==="left"||N==="end"?(Pe="flex-end",pe=Q):(N==="right"||N==="start")&&(Pe="flex-start",Te=Q):N==="left"||N==="start"?(Pe="flex-start",pe=Q):(N==="right"||N==="end")&&(Pe="flex-end",Te=Q),o.position=this._cssPosition,o.marginLeft=M?"0":pe,o.marginTop=F?"0":this._topOffset,o.marginBottom=this._bottomOffset,o.marginRight=M?"0":Te,d.justifyContent=Pe,d.alignItems=F?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let o=this._overlayRef.overlayElement.style,d=this._overlayRef.hostElement,r=d.style;d.classList.remove(ZD),r.justifyContent=r.alignItems=o.marginTop=o.marginBottom=o.marginLeft=o.marginRight=o.position="",this._overlayRef=null,this._isDisposed=!0}},F5=(()=>{let o=class o{constructor(r,s,t,g){this._viewportRuler=r,this._document=s,this._platform=t,this._overlayContainer=g}global(){return new xI}flexibleConnectedTo(r){return new X1(r,this._viewportRuler,this._document,this._platform,this._overlayContainer)}};o.\u0275fac=function(s){return new(s||o)(wt(pI),wt(Kn),wt(oo),wt(I0))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),L5=0,Ml=(()=>{let o=class o{constructor(r,s,t,g,w,M,F,N,Q,ae,pe,Te){this.scrollStrategies=r,this._overlayContainer=s,this._componentFactoryResolver=t,this._positionBuilder=g,this._keyboardDispatcher=w,this._injector=M,this._ngZone=F,this._document=N,this._directionality=Q,this._location=ae,this._outsideClickDispatcher=pe,this._animationsModuleType=Te}create(r){let s=this._createHostElement(),t=this._createPaneElement(s),g=this._createPortalOutlet(t),w=new S0(r);return w.direction=w.direction||this._directionality.value,new zm(g,s,t,w,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations")}position(){return this._positionBuilder}_createPaneElement(r){let s=this._document.createElement("div");return s.id=`cdk-overlay-${L5++}`,s.classList.add("cdk-overlay-pane"),r.appendChild(s),s}_createHostElement(){let r=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(r),r}_createPortalOutlet(r){return this._appRef||(this._appRef=this._injector.get(OE)),new q1(r,this._componentFactoryResolver,this._appRef,this._injector,this._document)}};o.\u0275fac=function(s){return new(s||o)(wt(D5),wt(I0),wt(Ey),wt(F5),wt(A5),wt(Uc),wt(gn),wt(Kn),wt(Fm),wt(yi),wt(P5),wt(_a,8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var z5=new Hn("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let c=yr(Ml);return()=>c.scrollStrategies.reposition()}});function B5(c){return()=>c.scrollStrategies.reposition()}var N5={provide:z5,deps:[Ml],useFactory:B5},T0=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({providers:[Ml,N5],imports:[Kp,Lm,fI,fI]});let c=o;return c})();var V5=["mat-button",""],j5=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],U5=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var W5=".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}";var H5=["mat-icon-button",""],G5=["*"];var q5=new Hn("MAT_BUTTON_CONFIG");var $5=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],KD=(()=>{let o=class o{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(r){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,r)}get disableRipple(){return this._disableRipple}set disableRipple(r){this._disableRipple=r,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(r){this._disabled=r,this._updateRippleDisabled()}constructor(r,s,t,g){this._elementRef=r,this._platform=s,this._ngZone=t,this._animationMode=g,this._focusMonitor=yr(Rm),this._rippleLoader=yr(AD),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let w=yr(q5,{optional:!0}),M=r.nativeElement,F=M.classList;this.disabledInteractive=w?.disabledInteractive??!1,this._rippleLoader?.configureRipple(M,{className:"mat-mdc-button-ripple"});for(let{attribute:N,mdcClasses:Q}of $5)M.hasAttribute(N)&&F.add(...Q)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(r="program",s){r?this._focusMonitor.focusVia(this._elementRef.nativeElement,r,s):this._elementRef.nativeElement.focus(s)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};o.\u0275fac=function(s){m0()},o.\u0275dir=io({type:o,inputs:{color:"color",disableRipple:[kn.HasDecoratorInputTransform,"disableRipple","disableRipple",Ha],disabled:[kn.HasDecoratorInputTransform,"disabled","disabled",Ha],ariaDisabled:[kn.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",Ha],disabledInteractive:[kn.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",Ha]},features:[os]});let c=o;return c})();var wI=(()=>{let o=class o extends KD{constructor(r,s,t,g){super(r,s,t,g)}};o.\u0275fac=function(s){return new(s||o)(_e(Vn),_e(oo),_e(gn),_e(_a,8))},o.\u0275cmp=Et({type:o,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(s,t){s&2&&(ir("disabled",t._getDisabledAttribute())("aria-disabled",t._getAriaDisabled()),Wc(t.color?"mat-"+t.color:""),Ki("mat-mdc-button-disabled",t.disabled)("mat-mdc-button-disabled-interactive",t.disabledInteractive)("_mat-animation-noopable",t._animationMode==="NoopAnimations")("mat-unthemed",!t.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Gs,Ur],attrs:V5,ngContentSelectors:U5,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(s,t){s&1&&(qs(j5),Oe(0,"span",0),as(1),U(2,"span",1),as(3,1),W(),as(4,2),Oe(5,"span",2)(6,"span",3)),s&2&&Ki("mdc-button__ripple",!t._isFab)("mdc-fab__ripple",t._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let c=o;return c})();var CI=(()=>{let o=class o extends KD{constructor(r,s,t,g){super(r,s,t,g),this._rippleLoader.configureRipple(this._elementRef.nativeElement,{centered:!0})}};o.\u0275fac=function(s){return new(s||o)(_e(Vn),_e(oo),_e(gn),_e(_a,8))},o.\u0275cmp=Et({type:o,selectors:[["button","mat-icon-button",""]],hostVars:14,hostBindings:function(s,t){s&2&&(ir("disabled",t._getDisabledAttribute())("aria-disabled",t._getAriaDisabled()),Wc(t.color?"mat-"+t.color:""),Ki("mat-mdc-button-disabled",t.disabled)("mat-mdc-button-disabled-interactive",t.disabledInteractive)("_mat-animation-noopable",t._animationMode==="NoopAnimations")("mat-unthemed",!t.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Gs,Ur],attrs:H5,ngContentSelectors:G5,decls:4,vars:0,consts:[[1,"mat-mdc-button-persistent-ripple","mdc-icon-button__ripple"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(s,t){s&1&&(qs(),Oe(0,"span",0),as(1),Oe(2,"span",1)(3,"span",2))},styles:['.mdc-icon-button{display:inline-block;position:relative;box-sizing:border-box;border:none;outline:none;background-color:rgba(0,0,0,0);fill:currentColor;color:inherit;text-decoration:none;cursor:pointer;user-select:none;z-index:0;overflow:visible}.mdc-icon-button .mdc-icon-button__touch{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}@media screen and (forced-colors: active){.mdc-icon-button.mdc-ripple-upgraded--background-focused .mdc-icon-button__focus-ring,.mdc-icon-button:not(.mdc-ripple-upgraded):focus .mdc-icon-button__focus-ring{display:block}}.mdc-icon-button:disabled{cursor:default;pointer-events:none}.mdc-icon-button[hidden]{display:none}.mdc-icon-button--display-flex{align-items:center;display:inline-flex;justify-content:center}.mdc-icon-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%;display:none}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring{border-color:CanvasText}}.mdc-icon-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring::after{border-color:CanvasText}}.mdc-icon-button__icon{display:inline-block}.mdc-icon-button__icon.mdc-icon-button__icon--on{display:none}.mdc-icon-button--on .mdc-icon-button__icon{display:none}.mdc-icon-button--on .mdc-icon-button__icon.mdc-icon-button__icon--on{display:inline-block}.mdc-icon-button__link{height:100%;left:0;outline:none;position:absolute;top:0;width:100%}.mat-mdc-icon-button{color:var(--mdc-icon-button-icon-color)}.mat-mdc-icon-button .mdc-button__icon{font-size:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button svg,.mat-mdc-icon-button img{width:var(--mdc-icon-button-icon-size);height:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button:disabled{color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button{border-radius:50%;flex-shrink:0;text-align:center;width:var(--mdc-icon-button-state-layer-size, 48px);height:var(--mdc-icon-button-state-layer-size, 48px);padding:calc(calc(var(--mdc-icon-button-state-layer-size, 48px) - var(--mdc-icon-button-icon-size, 24px)) / 2);font-size:var(--mdc-icon-button-icon-size);-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-icon-button svg{vertical-align:baseline}.mat-mdc-icon-button[disabled],.mat-mdc-icon-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-icon-button .mat-mdc-button-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-icon-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-icon-button .mdc-button__label{z-index:1}.mat-mdc-icon-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-icon-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-icon-button .mat-ripple-element{background-color:var(--mat-icon-button-ripple-color)}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-state-layer-color)}.mat-mdc-icon-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-disabled-state-layer-color)}.mat-mdc-icon-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-hover-state-layer-opacity)}.mat-mdc-icon-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-focus-state-layer-opacity)}.mat-mdc-icon-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-pressed-state-layer-opacity)}.mat-mdc-icon-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-icon-button-touch-target-display)}.mat-mdc-icon-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple{border-radius:50%}.mat-mdc-icon-button.mat-unthemed:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-primary:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-accent:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-warn:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}',W5],encapsulation:2,changeDetection:0});let c=o;return c})();var JD=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[Wr,DD,Wr]});let c=o;return c})();var Y5=["mat-calendar-body",""];function Z5(c,o){if(c&1&&(U(0,"tr",0)(1,"td",3),X(2),W()()),c&2){let d=it();le(),vl("padding-top",d._cellPadding)("padding-bottom",d._cellPadding),ir("colspan",d.numCols),le(),Ni(" ",d.label," ")}}function X5(c,o){if(c&1&&(U(0,"td",3),X(1),W()),c&2){let d=it(2);vl("padding-top",d._cellPadding)("padding-bottom",d._cellPadding),ir("colspan",d._firstRowOffset),le(),Ni(" ",d._firstRowOffset>=d.labelMinRequiredCells?d.label:""," ")}}function Q5(c,o){if(c&1){let d=ai();U(0,"td",6)(1,"button",7),Ne("click",function(s){let t=St(d).$implicit,g=it(2);return It(g._cellClicked(t,s))})("focus",function(s){let t=St(d).$implicit,g=it(2);return It(g._emitActiveDateChange(t,s))}),U(2,"span",8),X(3),W(),Oe(4,"span",9),W()()}if(c&2){let d=o.$implicit,r=o.$index,s=it().$index,t=it();vl("width",t._cellWidth)("padding-top",t._cellPadding)("padding-bottom",t._cellPadding),ir("data-mat-row",s)("data-mat-col",r),le(),Ki("mat-calendar-body-disabled",!d.enabled)("mat-calendar-body-active",t._isActiveCell(s,r))("mat-calendar-body-range-start",t._isRangeStart(d.compareValue))("mat-calendar-body-range-end",t._isRangeEnd(d.compareValue))("mat-calendar-body-in-range",t._isInRange(d.compareValue))("mat-calendar-body-comparison-bridge-start",t._isComparisonBridgeStart(d.compareValue,s,r))("mat-calendar-body-comparison-bridge-end",t._isComparisonBridgeEnd(d.compareValue,s,r))("mat-calendar-body-comparison-start",t._isComparisonStart(d.compareValue))("mat-calendar-body-comparison-end",t._isComparisonEnd(d.compareValue))("mat-calendar-body-in-comparison-range",t._isInComparisonRange(d.compareValue))("mat-calendar-body-preview-start",t._isPreviewStart(d.compareValue))("mat-calendar-body-preview-end",t._isPreviewEnd(d.compareValue))("mat-calendar-body-in-preview",t._isInPreview(d.compareValue)),ze("ngClass",d.cssClasses)("tabindex",t._isActiveCell(s,r)?0:-1),ir("aria-label",d.ariaLabel)("aria-disabled",!d.enabled||null)("aria-pressed",t._isSelected(d.compareValue))("aria-current",t.todayValue===d.compareValue?"date":null)("aria-describedby",t._getDescribedby(d.compareValue)),le(),Ki("mat-calendar-body-selected",t._isSelected(d.compareValue))("mat-calendar-body-comparison-identical",t._isComparisonIdentical(d.compareValue))("mat-calendar-body-today",t.todayValue===d.compareValue),le(),Ni(" ",d.displayValue," ")}}function K5(c,o){if(c&1&&(U(0,"tr",1),qt(1,X5,2,6,"td",4),no(2,Q5,5,48,"td",5,Dy),W()),c&2){let d=o.$implicit,r=o.$index,s=it();le(),hr(1,r===0&&s._firstRowOffset?1:-1),le(),ro(d)}}function J5(c,o){if(c&1&&(U(0,"th",2)(1,"span",6),X(2),W(),U(3,"span",3),X(4),W()()),c&2){let d=o.$implicit;le(2),Xt(d.long),le(2),Xt(d.narrow)}}var ez=["*"];function tz(c,o){}function iz(c,o){if(c&1){let d=ai();U(0,"mat-month-view",2),Qo("activeDateChange",function(s){St(d);let t=it();return Xo(t.activeDate,s)||(t.activeDate=s),It(s)}),Ne("_userSelection",function(s){St(d);let t=it();return It(t._dateSelected(s))})("dragStarted",function(s){St(d);let t=it();return It(t._dragStarted(s))})("dragEnded",function(s){St(d);let t=it();return It(t._dragEnded(s))}),W()}if(c&2){let d=it();Zo("activeDate",d.activeDate),ze("selected",d.selected)("dateFilter",d.dateFilter)("maxDate",d.maxDate)("minDate",d.minDate)("dateClass",d.dateClass)("comparisonStart",d.comparisonStart)("comparisonEnd",d.comparisonEnd)("startDateAccessibleName",d.startDateAccessibleName)("endDateAccessibleName",d.endDateAccessibleName)("activeDrag",d._activeDrag)}}function nz(c,o){if(c&1){let d=ai();U(0,"mat-year-view",3),Qo("activeDateChange",function(s){St(d);let t=it();return Xo(t.activeDate,s)||(t.activeDate=s),It(s)}),Ne("monthSelected",function(s){St(d);let t=it();return It(t._monthSelectedInYearView(s))})("selectedChange",function(s){St(d);let t=it();return It(t._goToDateInView(s,"month"))}),W()}if(c&2){let d=it();Zo("activeDate",d.activeDate),ze("selected",d.selected)("dateFilter",d.dateFilter)("maxDate",d.maxDate)("minDate",d.minDate)("dateClass",d.dateClass)}}function rz(c,o){if(c&1){let d=ai();U(0,"mat-multi-year-view",4),Qo("activeDateChange",function(s){St(d);let t=it();return Xo(t.activeDate,s)||(t.activeDate=s),It(s)}),Ne("yearSelected",function(s){St(d);let t=it();return It(t._yearSelectedInMultiYearView(s))})("selectedChange",function(s){St(d);let t=it();return It(t._goToDateInView(s,"year"))}),W()}if(c&2){let d=it();Zo("activeDate",d.activeDate),ze("selected",d.selected)("dateFilter",d.dateFilter)("maxDate",d.maxDate)("minDate",d.minDate)("dateClass",d.dateClass)}}function oz(c,o){}var az=["button"],sz=[[["","matDatepickerToggleIcon",""]]],lz=["[matDatepickerToggleIcon]"];function cz(c,o){c&1&&(Yp(),U(0,"svg",2),Oe(1,"path",3),W())}var Gy=(()=>{let o=class o{constructor(){this.changes=new Or,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(r,s){return`${r} \u2013 ${s}`}formatYearRangeLabel(r,s){return`${r} to ${s}`}};o.\u0275fac=function(s){return new(s||o)},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),Wy=class{constructor(o,d,r,s,t={},g=o,w){this.value=o,this.displayValue=d,this.ariaLabel=r,this.enabled=s,this.cssClasses=t,this.compareValue=g,this.rawValue=w}},dz=1,eA=lh({passive:!1,capture:!0}),tf=lh({passive:!0,capture:!0}),Q1=lh({passive:!0}),E0=(()=>{let o=class o{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(r,s){this._elementRef=r,this._ngZone=s,this._platform=yr(oo),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new zn,this.previewChange=new zn,this.activeDateChange=new zn,this.dragStarted=new zn,this.dragEnded=new zn,this._didDragSinceMouseDown=!1,this._enterHandler=t=>{if(this._skipNextFocus&&t.type==="focus"){this._skipNextFocus=!1;return}if(t.target&&this.isRange){let g=this._getCellFromElement(t.target);g&&this._ngZone.run(()=>this.previewChange.emit({value:g.enabled?g:null,event:t}))}},this._touchmoveHandler=t=>{if(!this.isRange)return;let g=tA(t),w=g?this._getCellFromElement(g):null;g!==t.target&&(this._didDragSinceMouseDown=!0),II(t.target)&&t.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:w?.enabled?w:null,event:t}))},this._leaveHandler=t=>{this.previewEnd!==null&&this.isRange&&(t.type!=="blur"&&(this._didDragSinceMouseDown=!0),t.target&&this._getCellFromElement(t.target)&&!(t.relatedTarget&&this._getCellFromElement(t.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:t})))},this._mousedownHandler=t=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;let g=t.target&&this._getCellFromElement(t.target);!g||!this._isInRange(g.compareValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:g.rawValue,event:t})})},this._mouseupHandler=t=>{if(!this.isRange)return;let g=II(t.target);if(!g){this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:t})});return}g.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{let w=this._getCellFromElement(g);this.dragEnded.emit({value:w?.rawValue??null,event:t})})},this._touchendHandler=t=>{let g=tA(t);g&&this._mouseupHandler({target:g})},this._id=`mat-calendar-body-${dz++}`,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,s.runOutsideAngular(()=>{let t=r.nativeElement;t.addEventListener("touchmove",this._touchmoveHandler,eA),t.addEventListener("mouseenter",this._enterHandler,tf),t.addEventListener("focus",this._enterHandler,tf),t.addEventListener("mouseleave",this._leaveHandler,tf),t.addEventListener("blur",this._leaveHandler,tf),t.addEventListener("mousedown",this._mousedownHandler,Q1),t.addEventListener("touchstart",this._mousedownHandler,Q1),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(r,s){this._didDragSinceMouseDown||r.enabled&&this.selectedValueChange.emit({value:r.value,event:s})}_emitActiveDateChange(r,s){r.enabled&&this.activeDateChange.emit({value:r.value,event:s})}_isSelected(r){return this.startValue===r||this.endValue===r}ngOnChanges(r){let s=r.numCols,{rows:t,numCols:g}=this;(r.rows||s)&&(this._firstRowOffset=t&&t.length&&t[0].length?g-t[0].length:0),(r.cellAspectRatio||s||!this._cellPadding)&&(this._cellPadding=`${50*this.cellAspectRatio/g}%`),(s||!this._cellWidth)&&(this._cellWidth=`${100/g}%`)}ngOnDestroy(){let r=this._elementRef.nativeElement;r.removeEventListener("touchmove",this._touchmoveHandler,eA),r.removeEventListener("mouseenter",this._enterHandler,tf),r.removeEventListener("focus",this._enterHandler,tf),r.removeEventListener("mouseleave",this._leaveHandler,tf),r.removeEventListener("blur",this._leaveHandler,tf),r.removeEventListener("mousedown",this._mousedownHandler,Q1),r.removeEventListener("touchstart",this._mousedownHandler,Q1),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(r,s){let t=r*this.numCols+s;return r&&(t-=this._firstRowOffset),t==this.activeCell}_focusActiveCell(r=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(jc(1)).subscribe(()=>{setTimeout(()=>{let s=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");s&&(r||(this._skipNextFocus=!0),s.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(r){return TI(r,this.startValue,this.endValue)}_isRangeEnd(r){return MI(r,this.startValue,this.endValue)}_isInRange(r){return kI(r,this.startValue,this.endValue,this.isRange)}_isComparisonStart(r){return TI(r,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(r,s,t){if(!this._isComparisonStart(r)||this._isRangeStart(r)||!this._isInRange(r))return!1;let g=this.rows[s][t-1];if(!g){let w=this.rows[s-1];g=w&&w[w.length-1]}return g&&!this._isRangeEnd(g.compareValue)}_isComparisonBridgeEnd(r,s,t){if(!this._isComparisonEnd(r)||this._isRangeEnd(r)||!this._isInRange(r))return!1;let g=this.rows[s][t+1];if(!g){let w=this.rows[s+1];g=w&&w[0]}return g&&!this._isRangeStart(g.compareValue)}_isComparisonEnd(r){return MI(r,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(r){return kI(r,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(r){return this.comparisonStart===this.comparisonEnd&&r===this.comparisonStart}_isPreviewStart(r){return TI(r,this.previewStart,this.previewEnd)}_isPreviewEnd(r){return MI(r,this.previewStart,this.previewEnd)}_isInPreview(r){return kI(r,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(r){return this.isRange?this.startValue===r&&this.endValue===r?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===r?this._startDateLabelId:this.endValue===r?this._endDateLabelId:null:null}_getCellFromElement(r){let s=II(r);if(s){let t=s.getAttribute("data-mat-row"),g=s.getAttribute("data-mat-col");if(t&&g)return this.rows[parseInt(t)][parseInt(g)]}return null}};o.\u0275fac=function(s){return new(s||o)(_e(Vn),_e(gn))},o.\u0275cmp=Et({type:o,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],standalone:!0,features:[rs,Ur],attrs:Y5,decls:7,vars:5,consts:[["aria-hidden","true"],["role","row"],[1,"mat-calendar-body-hidden-label",3,"id"],[1,"mat-calendar-body-label"],[1,"mat-calendar-body-label",3,"paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"click","focus","ngClass","tabindex"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"]],template:function(s,t){s&1&&(qt(0,Z5,3,6,"tr",0),no(1,K5,4,1,"tr",1,Dy),U(3,"label",2),X(4),W(),U(5,"label",2),X(6),W()),s&2&&(hr(0,t._firstRowOffset<t.labelMinRequiredCells?0:-1),le(),ro(t.rows),le(2),ze("id",t._startDateLabelId),le(),Ni(" ",t.startDateAccessibleName,`
`),le(),ze("id",t._endDateLabelId),le(),Ni(" ",t.endDateAccessibleName,`
`))},dependencies:[Ko],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:start;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}'],encapsulation:2,changeDetection:0});let c=o;return c})();function SI(c){return c?.nodeName==="TD"}function II(c){let o;return SI(c)?o=c:SI(c.parentNode)?o=c.parentNode:SI(c.parentNode?.parentNode)&&(o=c.parentNode.parentNode),o?.getAttribute("data-mat-row")!=null?o:null}function TI(c,o,d){return d!==null&&o!==d&&c<d&&c===o}function MI(c,o,d){return o!==null&&o!==d&&c>=o&&c===d}function kI(c,o,d,r){return r&&o!==null&&d!==null&&o!==d&&c>=o&&c<=d}function tA(c){let o=c.changedTouches[0];return document.elementFromPoint(o.clientX,o.clientY)}var Yc=class{constructor(o,d){this.start=o,this.end=d}},K1=(()=>{let o=class o{constructor(r,s){this.selection=r,this._adapter=s,this._selectionChanged=new Or,this.selectionChanged=this._selectionChanged,this.selection=r}updateSelection(r,s){let t=this.selection;this.selection=r,this._selectionChanged.next({selection:r,source:s,oldValue:t})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(r){return this._adapter.isDateInstance(r)&&this._adapter.isValid(r)}};o.\u0275fac=function(s){m0()},o.\u0275prov=ci({token:o,factory:o.\u0275fac});let c=o;return c})(),uz=(()=>{let o=class o extends K1{constructor(r){super(null,r)}add(r){super.updateSelection(r,this)}isValid(){return this.selection!=null&&this._isValidDateInstance(this.selection)}isComplete(){return this.selection!=null}clone(){let r=new o(this._adapter);return r.updateSelection(this.selection,this),r}};o.\u0275fac=function(s){return new(s||o)(wt(Tl))},o.\u0275prov=ci({token:o,factory:o.\u0275fac});let c=o;return c})();function hz(c,o){return c||new uz(o)}var mz={provide:K1,deps:[[new x1,new IE,K1],Tl],useFactory:hz};var aA=new Hn("MAT_DATE_RANGE_SELECTION_STRATEGY");var EI=7,iA=(()=>{let o=class o{get activeDate(){return this._activeDate}set activeDate(r){let s=this._activeDate,t=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),this._hasSameMonthAndYear(s,this._activeDate)||this._init()}get selected(){return this._selected}set selected(r){r instanceof Yc?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,s,t,g,w){this._changeDetectorRef=r,this._dateFormats=s,this._dateAdapter=t,this._dir=g,this._rangeStrategy=w,this._rerenderSubscription=rc.EMPTY,this.activeDrag=null,this.selectedChange=new zn,this._userSelection=new zn,this.dragStarted=new zn,this.dragEnded=new zn,this.activeDateChange=new zn,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Ud(null)).subscribe(()=>this._init())}ngOnChanges(r){let s=r.comparisonStart||r.comparisonEnd;s&&!s.firstChange&&this._setRanges(this.selected),r.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(r){let s=r.value,t=this._getDateFromDayOfMonth(s),g,w;this._selected instanceof Yc?(g=this._getDateInCurrentMonth(this._selected.start),w=this._getDateInCurrentMonth(this._selected.end)):g=w=this._getDateInCurrentMonth(this._selected),(g!==s||w!==s)&&this.selectedChange.emit(t),this._userSelection.emit({value:t,event:r.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(r){let s=r.value,t=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(s),this._dateAdapter.compareDate(t,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(r){let s=this._activeDate,t=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,t?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,t?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=r.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=r.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:this._selectionKeyPressed=!0,this._canSelect(this._activeDate)&&r.preventDefault();return;case 27:this._previewEnd!=null&&!y0(r)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:r}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:r})),r.preventDefault(),r.stopPropagation());return;default:return}this._dateAdapter.compareDate(s,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let r=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(EI+this._dateAdapter.getDayOfWeek(r)-this._dateAdapter.getFirstDayOfWeek())%EI,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(r){this._matCalendarBody._focusActiveCell(r)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:r,value:s}){if(this._rangeStrategy){let t=s?s.rawValue:null,g=this._rangeStrategy.createPreview(t,this.selected,r);if(this._previewStart=this._getCellCompareValue(g.start),this._previewEnd=this._getCellCompareValue(g.end),this.activeDrag&&t){let w=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,t,r);w&&(this._previewStart=this._getCellCompareValue(w.start),this._previewEnd=this._getCellCompareValue(w.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(r){if(this.activeDrag)if(r.value){let s=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,r.value,r.event);this.dragEnded.emit({value:s??null,event:r.event})}else this.dragEnded.emit({value:null,event:r.event})}_getDateFromDayOfMonth(r){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r)}_initWeekdays(){let r=this._dateAdapter.getFirstDayOfWeek(),s=this._dateAdapter.getDayOfWeekNames("narrow"),g=this._dateAdapter.getDayOfWeekNames("long").map((w,M)=>({long:w,narrow:s[M]}));this._weekdays=g.slice(r).concat(g.slice(0,r))}_createWeekCells(){let r=this._dateAdapter.getNumDaysInMonth(this.activeDate),s=this._dateAdapter.getDateNames();this._weeks=[[]];for(let t=0,g=this._firstWeekOffset;t<r;t++,g++){g==EI&&(this._weeks.push([]),g=0);let w=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),t+1),M=this._shouldEnableDate(w),F=this._dateAdapter.format(w,this._dateFormats.display.dateA11yLabel),N=this.dateClass?this.dateClass(w,"month"):void 0;this._weeks[this._weeks.length-1].push(new Wy(t+1,s[t],F,M,N,this._getCellCompareValue(w),w))}}_shouldEnableDate(r){return!!r&&(!this.minDate||this._dateAdapter.compareDate(r,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(r,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(r))}_getDateInCurrentMonth(r){return r&&this._hasSameMonthAndYear(r,this.activeDate)?this._dateAdapter.getDate(r):null}_hasSameMonthAndYear(r,s){return!!(r&&s&&this._dateAdapter.getMonth(r)==this._dateAdapter.getMonth(s)&&this._dateAdapter.getYear(r)==this._dateAdapter.getYear(s))}_getCellCompareValue(r){if(r){let s=this._dateAdapter.getYear(r),t=this._dateAdapter.getMonth(r),g=this._dateAdapter.getDate(r);return new Date(s,t,g).getTime()}return null}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setRanges(r){r instanceof Yc?(this._rangeStart=this._getCellCompareValue(r.start),this._rangeEnd=this._getCellCompareValue(r.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(r),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(r){return!this.dateFilter||this.dateFilter(r)}_clearPreview(){this._previewStart=this._previewEnd=null}};o.\u0275fac=function(s){return new(s||o)(_e(Oa),_e(w0,8),_e(Tl,8),_e(Fm,8),_e(aA,8))},o.\u0275cmp=Et({type:o,selectors:[["mat-month-view"]],viewQuery:function(s,t){if(s&1&&Vi(E0,5),s&2){let g;zi(g=Bi())&&(t._matCalendarBody=g.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],standalone:!0,features:[rs,Ur],decls:8,vars:14,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["scope","col"],["aria-hidden","true"],["colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown","label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName"],[1,"cdk-visually-hidden"]],template:function(s,t){s&1&&(U(0,"table",0)(1,"thead",1)(2,"tr"),no(3,J5,5,2,"th",2,Dy),W(),U(5,"tr",3),Oe(6,"th",4),W()(),U(7,"tbody",5),Ne("selectedValueChange",function(w){return t._dateSelected(w)})("activeDateChange",function(w){return t._updateActiveDate(w)})("previewChange",function(w){return t._previewChanged(w)})("dragStarted",function(w){return t.dragStarted.emit(w)})("dragEnded",function(w){return t._dragEnded(w)})("keyup",function(w){return t._handleCalendarBodyKeyup(w)})("keydown",function(w){return t._handleCalendarBodyKeydown(w)}),W()()),s&2&&(le(3),ro(t._weekdays),le(4),ze("label",t._monthLabel)("rows",t._weeks)("todayValue",t._todayDate)("startValue",t._rangeStart)("endValue",t._rangeEnd)("comparisonStart",t._comparisonRangeStart)("comparisonEnd",t._comparisonRangeEnd)("previewStart",t._previewStart)("previewEnd",t._previewEnd)("isRange",t._isRange)("labelMinRequiredCells",3)("activeCell",t._dateAdapter.getDate(t.activeDate)-1)("startDateAccessibleName",t.startDateAccessibleName)("endDateAccessibleName",t.endDateAccessibleName))},dependencies:[E0],encapsulation:2,changeDetection:0});let c=o;return c})(),ac=24,DI=4,nA=(()=>{let o=class o{get activeDate(){return this._activeDate}set activeDate(r){let s=this._activeDate,t=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),sA(this._dateAdapter,s,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(r){r instanceof Yc?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setSelectedYear(r)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,s,t){this._changeDetectorRef=r,this._dateAdapter=s,this._dir=t,this._rerenderSubscription=rc.EMPTY,this.selectedChange=new zn,this.yearSelected=new zn,this.activeDateChange=new zn,this._dateAdapter,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Ud(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());let s=this._dateAdapter.getYear(this._activeDate)-Uy(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let t=0,g=[];t<ac;t++)g.push(s+t),g.length==DI&&(this._years.push(g.map(w=>this._createCellForYear(w))),g=[]);this._changeDetectorRef.markForCheck()}_yearSelected(r){let s=r.value,t=this._dateAdapter.createDate(s,0,1),g=this._getDateFromYear(s);this.yearSelected.emit(t),this.selectedChange.emit(g)}_updateActiveDate(r){let s=r.value,t=this._activeDate;this.activeDate=this._getDateFromYear(s),this._dateAdapter.compareDate(t,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(r){let s=this._activeDate,t=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-DI);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,DI);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-Uy(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,ac-Uy(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?-ac*10:-ac);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?ac*10:ac);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(s,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_getActiveCell(){return Uy(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(r){let s=this._dateAdapter.getMonth(this.activeDate),t=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(r,s,1));return this._dateAdapter.createDate(r,s,Math.min(this._dateAdapter.getDate(this.activeDate),t))}_createCellForYear(r){let s=this._dateAdapter.createDate(r,0,1),t=this._dateAdapter.getYearName(s),g=this.dateClass?this.dateClass(s,"multi-year"):void 0;return new Wy(r,t,t,this._shouldEnableYear(r),g)}_shouldEnableYear(r){if(r==null||this.maxDate&&r>this._dateAdapter.getYear(this.maxDate)||this.minDate&&r<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;let s=this._dateAdapter.createDate(r,0,1);for(let t=s;this._dateAdapter.getYear(t)==r;t=this._dateAdapter.addCalendarDays(t,1))if(this.dateFilter(t))return!0;return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedYear(r){if(this._selectedYear=null,r instanceof Yc){let s=r.start||r.end;s&&(this._selectedYear=this._dateAdapter.getYear(s))}else r&&(this._selectedYear=this._dateAdapter.getYear(r))}};o.\u0275fac=function(s){return new(s||o)(_e(Oa),_e(Tl,8),_e(Fm,8))},o.\u0275cmp=Et({type:o,selectors:[["mat-multi-year-view"]],viewQuery:function(s,t){if(s&1&&Vi(E0,5),s&2){let g;zi(g=Bi())&&(t._matCalendarBody=g.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],standalone:!0,features:[Ur],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell"]],template:function(s,t){s&1&&(U(0,"table",0)(1,"thead",1)(2,"tr"),Oe(3,"th",2),W()(),U(4,"tbody",3),Ne("selectedValueChange",function(w){return t._yearSelected(w)})("activeDateChange",function(w){return t._updateActiveDate(w)})("keyup",function(w){return t._handleCalendarBodyKeyup(w)})("keydown",function(w){return t._handleCalendarBodyKeydown(w)}),W()()),s&2&&(le(4),ze("rows",t._years)("todayValue",t._todayYear)("startValue",t._selectedYear)("endValue",t._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",t._getActiveCell()))},dependencies:[E0],encapsulation:2,changeDetection:0});let c=o;return c})();function sA(c,o,d,r,s){let t=c.getYear(o),g=c.getYear(d),w=lA(c,r,s);return Math.floor((t-w)/ac)===Math.floor((g-w)/ac)}function Uy(c,o,d,r){let s=c.getYear(o);return pz(s-lA(c,d,r),ac)}function lA(c,o,d){let r=0;return d?r=c.getYear(d)-ac+1:o&&(r=c.getYear(o)),r}function pz(c,o){return(c%o+o)%o}var rA=(()=>{let o=class o{get activeDate(){return this._activeDate}set activeDate(r){let s=this._activeDate,t=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),this._dateAdapter.getYear(s)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(r){r instanceof Yc?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setSelectedMonth(r)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,s,t,g){this._changeDetectorRef=r,this._dateFormats=s,this._dateAdapter=t,this._dir=g,this._rerenderSubscription=rc.EMPTY,this.selectedChange=new zn,this.monthSelected=new zn,this.activeDateChange=new zn,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Ud(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(r){let s=r.value,t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),s,1);this.monthSelected.emit(t);let g=this._getDateFromMonth(s);this.selectedChange.emit(g)}_updateActiveDate(r){let s=r.value,t=this._activeDate;this.activeDate=this._getDateFromMonth(s),this._dateAdapter.compareDate(t,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(r){let s=this._activeDate,t=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,t?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,t?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(s,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let r=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(s=>s.map(t=>this._createCellForMonth(t,r[t]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(r){return r&&this._dateAdapter.getYear(r)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(r):null}_getDateFromMonth(r){let s=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,1),t=this._dateAdapter.getNumDaysInMonth(s);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,Math.min(this._dateAdapter.getDate(this.activeDate),t))}_createCellForMonth(r,s){let t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,1),g=this._dateAdapter.format(t,this._dateFormats.display.monthYearA11yLabel),w=this.dateClass?this.dateClass(t,"year"):void 0;return new Wy(r,s.toLocaleUpperCase(),g,this._shouldEnableMonth(r),w)}_shouldEnableMonth(r){let s=this._dateAdapter.getYear(this.activeDate);if(r==null||this._isYearAndMonthAfterMaxDate(s,r)||this._isYearAndMonthBeforeMinDate(s,r))return!1;if(!this.dateFilter)return!0;let t=this._dateAdapter.createDate(s,r,1);for(let g=t;this._dateAdapter.getMonth(g)==r;g=this._dateAdapter.addCalendarDays(g,1))if(this.dateFilter(g))return!0;return!1}_isYearAndMonthAfterMaxDate(r,s){if(this.maxDate){let t=this._dateAdapter.getYear(this.maxDate),g=this._dateAdapter.getMonth(this.maxDate);return r>t||r===t&&s>g}return!1}_isYearAndMonthBeforeMinDate(r,s){if(this.minDate){let t=this._dateAdapter.getYear(this.minDate),g=this._dateAdapter.getMonth(this.minDate);return r<t||r===t&&s<g}return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedMonth(r){r instanceof Yc?this._selectedMonth=this._getMonthInCurrentYear(r.start)||this._getMonthInCurrentYear(r.end):this._selectedMonth=this._getMonthInCurrentYear(r)}};o.\u0275fac=function(s){return new(s||o)(_e(Oa),_e(w0,8),_e(Tl,8),_e(Fm,8))},o.\u0275cmp=Et({type:o,selectors:[["mat-year-view"]],viewQuery:function(s,t){if(s&1&&Vi(E0,5),s&2){let g;zi(g=Bi())&&(t._matCalendarBody=g.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],standalone:!0,features:[Ur],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell"]],template:function(s,t){s&1&&(U(0,"table",0)(1,"thead",1)(2,"tr"),Oe(3,"th",2),W()(),U(4,"tbody",3),Ne("selectedValueChange",function(w){return t._monthSelected(w)})("activeDateChange",function(w){return t._updateActiveDate(w)})("keyup",function(w){return t._handleCalendarBodyKeyup(w)})("keydown",function(w){return t._handleCalendarBodyKeydown(w)}),W()()),s&2&&(le(4),ze("label",t._yearLabel)("rows",t._months)("todayValue",t._todayMonth)("startValue",t._selectedMonth)("endValue",t._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",t._dateAdapter.getMonth(t.activeDate)))},dependencies:[E0],encapsulation:2,changeDetection:0});let c=o;return c})(),fz=1,cA=(()=>{let o=class o{constructor(r,s,t,g,w){this._intl=r,this.calendar=s,this._dateAdapter=t,this._dateFormats=g,this._id=`mat-calendar-header-${fz++}`,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>w.markForCheck())}get periodButtonText(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return this.calendar.currentView=="month"?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView=this.calendar.currentView=="month"?"multi-year":"month"}previousClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?-1:-ac)}nextClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?1:ac)}previousEnabled(){return this.calendar.minDate?!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate):!0}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(r,s){return this.calendar.currentView=="month"?this._dateAdapter.getYear(r)==this._dateAdapter.getYear(s)&&this._dateAdapter.getMonth(r)==this._dateAdapter.getMonth(s):this.calendar.currentView=="year"?this._dateAdapter.getYear(r)==this._dateAdapter.getYear(s):sA(this._dateAdapter,r,s,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){let s=this._dateAdapter.getYear(this.calendar.activeDate)-Uy(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),t=s+ac-1,g=this._dateAdapter.getYearName(this._dateAdapter.createDate(s,0,1)),w=this._dateAdapter.getYearName(this._dateAdapter.createDate(t,0,1));return[g,w]}};o.\u0275fac=function(s){return new(s||o)(_e(Gy),_e(ky(()=>AI)),_e(Tl,8),_e(w0,8),_e(Oa))},o.\u0275cmp=Et({type:o,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],standalone:!0,features:[Ur],ngContentSelectors:ez,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],[1,"cdk-visually-hidden",3,"id"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"click","disabled"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"click","disabled"]],template:function(s,t){s&1&&(qs(),U(0,"div",0)(1,"div",1)(2,"label",2),X(3),W(),U(4,"button",3),Ne("click",function(){return t.currentPeriodClicked()}),U(5,"span",4),X(6),W(),Yp(),U(7,"svg",5),Oe(8,"polygon",6),W()(),US(),Oe(9,"div",7),as(10),U(11,"button",8),Ne("click",function(){return t.previousClicked()}),W(),U(12,"button",9),Ne("click",function(){return t.nextClicked()}),W()()()),s&2&&(le(2),ze("id",t._periodButtonLabelId),le(),Xt(t.periodButtonDescription),le(),ir("aria-label",t.periodButtonLabel)("aria-describedby",t._periodButtonLabelId),le(2),Xt(t.periodButtonText),le(),Ki("mat-calendar-invert",t.calendar.currentView!=="month"),le(4),ze("disabled",!t.previousEnabled()),ir("aria-label",t.prevButtonLabel),le(),ze("disabled",!t.nextEnabled()),ir("aria-label",t.nextButtonLabel))},dependencies:[wI,CI],encapsulation:2,changeDetection:0});let c=o;return c})(),AI=(()=>{let o=class o{get startAt(){return this._startAt}set startAt(r){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get selected(){return this._selected}set selected(r){r instanceof Yc?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get activeDate(){return this._clampedActiveDate}set activeDate(r){this._clampedActiveDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(r){let s=this._currentView!==r?r:null;this._currentView=r,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),s&&this.viewChanged.emit(s)}constructor(r,s,t,g){this._dateAdapter=s,this._dateFormats=t,this._changeDetectorRef=g,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new zn,this.yearSelected=new zn,this.monthSelected=new zn,this.viewChanged=new zn(!0),this._userSelection=new zn,this._userDragDrop=new zn,this._activeDrag=null,this.stateChanges=new Or,this._intlChanges=r.changes.subscribe(()=>{g.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new Jp(this.headerComponent||cA),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(r){let s=r.minDate&&!this._dateAdapter.sameDate(r.minDate.previousValue,r.minDate.currentValue)?r.minDate:void 0,t=r.maxDate&&!this._dateAdapter.sameDate(r.maxDate.previousValue,r.maxDate.currentValue)?r.maxDate:void 0,g=s||t||r.dateFilter;if(g&&!g.firstChange){let w=this._getCurrentViewComponent();w&&(this._changeDetectorRef.detectChanges(),w._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(r){let s=r.value;(this.selected instanceof Yc||s&&!this._dateAdapter.sameDate(s,this.selected))&&this.selectedChange.emit(s),this._userSelection.emit(r)}_yearSelectedInMultiYearView(r){this.yearSelected.emit(r)}_monthSelectedInYearView(r){this.monthSelected.emit(r)}_goToDateInView(r,s){this.activeDate=r,this.currentView=s}_dragStarted(r){this._activeDrag=r}_dragEnded(r){this._activeDrag&&(r.value&&this._userDragDrop.emit(r),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}};o.\u0275fac=function(s){return new(s||o)(_e(Gy),_e(Tl,8),_e(w0,8),_e(Oa))},o.\u0275cmp=Et({type:o,selectors:[["mat-calendar"]],viewQuery:function(s,t){if(s&1&&(Vi(iA,5),Vi(rA,5),Vi(nA,5)),s&2){let g;zi(g=Bi())&&(t.monthView=g.first),zi(g=Bi())&&(t.yearView=g.first),zi(g=Bi())&&(t.multiYearView=g.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],standalone:!0,features:[Hc([mz]),rs,Ur],decls:5,vars:2,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content"],[3,"activeDateChange","_userSelection","dragStarted","dragEnded","activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag"],[3,"activeDateChange","monthSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"],[3,"activeDateChange","yearSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"]],template:function(s,t){if(s&1&&(qt(0,tz,0,0,"ng-template",0),U(1,"div",1),qt(2,iz,1,11)(3,nz,1,6)(4,rz,1,6),W()),s&2){let g;ze("cdkPortalOutlet",t._calendarHeaderPortal),le(2),hr(2,(g=t.currentView)==="month"?2:g==="year"?3:g==="multi-year"?4:-1)}},dependencies:[ef,bD,iA,rA,nA],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight);--mdc-text-button-label-text-color:var(--mat-datepicker-calendar-period-button-text-color)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button:not(.mat-mdc-button-disabled),.mat-datepicker-content .mat-calendar-next-button:not(.mat-mdc-button-disabled){color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let c=o;return c})(),oA={transformPanel:YS("transformPanel",[Oy("void => enter-dropdown",Py("120ms cubic-bezier(0, 0, 0.2, 1)",XS([Xp({opacity:0,transform:"scale(1, 0.8)"}),Xp({opacity:1,transform:"scale(1, 1)"})]))),Oy("void => enter-dialog",Py("150ms cubic-bezier(0, 0, 0.2, 1)",XS([Xp({opacity:0,transform:"scale(0.7)"}),Xp({transform:"none",opacity:1})]))),Oy("* => void",Py("100ms linear",Xp({opacity:0})))]),fadeInCalendar:YS("fadeInCalendar",[ZS("void",Xp({opacity:0})),ZS("enter",Xp({opacity:1})),Oy("void => *",Py("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])};var gz=new Hn("mat-datepicker-scroll-strategy",{providedIn:"root",factory:()=>{let c=yr(Ml);return()=>c.scrollStrategies.reposition()}});function _z(c){return()=>c.scrollStrategies.reposition()}var bz={provide:gz,deps:[Ml],useFactory:_z},yz=(()=>{let o=class o{constructor(r,s,t,g,w,M){this._elementRef=r,this._changeDetectorRef=s,this._globalModel=t,this._dateAdapter=g,this._rangeSelectionStrategy=w,this._subscriptions=new rc,this._animationDone=new Or,this._isAnimating=!1,this._actionsPortal=null,this._closeButtonText=M.closeCalendarLabel}ngOnInit(){this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(r){let s=this._model.selection,t=r.value,g=s instanceof Yc;if(g&&this._rangeSelectionStrategy){let w=this._rangeSelectionStrategy.selectionFinished(t,s,r.event);this._model.updateSelection(w,this)}else t&&(g||!this._dateAdapter.sameDate(t,s))&&this._model.add(t);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(r){this._model.updateSelection(r.value,this)}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_handleAnimationEvent(r){this._isAnimating=r.phaseName==="start",this._isAnimating||this._animationDone.next()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(r,s){this._model=r?this._globalModel.clone():this._globalModel,this._actionsPortal=r,s&&this._changeDetectorRef.detectChanges()}};o.\u0275fac=function(s){return new(s||o)(_e(Vn),_e(Oa),_e(K1),_e(Tl),_e(aA,8),_e(Gy))},o.\u0275cmp=Et({type:o,selectors:[["mat-datepicker-content"]],viewQuery:function(s,t){if(s&1&&Vi(AI,5),s&2){let g;zi(g=Bi())&&(t._calendar=g.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:5,hostBindings:function(s,t){s&1&&EE("@transformPanel.start",function(w){return t._handleAnimationEvent(w)})("@transformPanel.done",function(w){return t._handleAnimationEvent(w)}),s&2&&(kE("@transformPanel",t._animationState),Wc(t.color?"mat-"+t.color:""),Ki("mat-datepicker-content-touch",t.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],standalone:!0,features:[Ur],decls:5,vars:27,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop","id","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"focus","blur","click","color"]],template:function(s,t){if(s&1&&(U(0,"div",0)(1,"mat-calendar",1),Ne("yearSelected",function(w){return t.datepicker._selectYear(w)})("monthSelected",function(w){return t.datepicker._selectMonth(w)})("viewChanged",function(w){return t.datepicker._viewChanged(w)})("_userSelection",function(w){return t._handleUserSelection(w)})("_userDragDrop",function(w){return t._handleUserDragDrop(w)}),W(),qt(2,oz,0,0,"ng-template",2),U(3,"button",3),Ne("focus",function(){return t._closeButtonFocused=!0})("blur",function(){return t._closeButtonFocused=!1})("click",function(){return t.datepicker.close()}),X(4),W()()),s&2){let g;Ki("mat-datepicker-content-container-with-custom-header",t.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",t._actionsPortal),ir("aria-modal",!0)("aria-labelledby",(g=t._dialogLabelId)!==null&&g!==void 0?g:void 0),le(),Wc(t.datepicker.panelClass),ze("id",t.datepicker.id)("startAt",t.datepicker.startAt)("startView",t.datepicker.startView)("minDate",t.datepicker._getMinDate())("maxDate",t.datepicker._getMaxDate())("dateFilter",t.datepicker._getDateFilter())("headerComponent",t.datepicker.calendarHeaderComponent)("selected",t._getSelected())("dateClass",t.datepicker.dateClass)("comparisonStart",t.comparisonStart)("comparisonEnd",t.comparisonEnd)("@fadeInCalendar","enter")("startDateAccessibleName",t.startDateAccessibleName)("endDateAccessibleName",t.endDateAccessibleName),le(),ze("cdkPortalOutlet",t._actionsPortal),le(),Ki("cdk-visually-hidden",!t._closeButtonFocused),ze("color",t.color||"primary"),le(),Xt(t._closeButtonText)}},dependencies:[gD,AI,ef,wI],styles:[".mat-datepicker-content{display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color);color:var(--mat-datepicker-calendar-container-text-color);box-shadow:var(--mat-datepicker-calendar-container-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-shape)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;box-shadow:var(--mat-datepicker-calendar-container-touch-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-touch-shape);position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}"],encapsulation:2,data:{animation:[oA.transformPanel,oA.fadeInCalendar]},changeDetection:0});let c=o;return c})();var vz=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275dir=io({type:o,selectors:[["","matDatepickerToggleIcon",""]],standalone:!0});let c=o;return c})(),xz=(()=>{let o=class o{get disabled(){return this._disabled===void 0&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(r){this._disabled=r}constructor(r,s,t){this._intl=r,this._changeDetectorRef=s,this._stateChanges=rc.EMPTY;let g=Number(t);this.tabIndex=g||g===0?g:null}ngOnChanges(r){r.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(r){this.datepicker&&!this.disabled&&(this.datepicker.open(),r.stopPropagation())}_watchStateChanges(){let r=this.datepicker?this.datepicker.stateChanges:Ln(),s=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:Ln(),t=this.datepicker?kg(this.datepicker.openedStream,this.datepicker.closedStream):Ln();this._stateChanges.unsubscribe(),this._stateChanges=kg(this._intl.changes,r,s,t).subscribe(()=>this._changeDetectorRef.markForCheck())}};o.\u0275fac=function(s){return new(s||o)(_e(Gy),_e(Oa),Dg("tabindex"))},o.\u0275cmp=Et({type:o,selectors:[["mat-datepicker-toggle"]],contentQueries:function(s,t,g){if(s&1&&Ay(g,vz,5),s&2){let w;zi(w=Bi())&&(t._customIcon=w.first)}},viewQuery:function(s,t){if(s&1&&Vi(az,5),s&2){let g;zi(g=Bi())&&(t._button=g.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(s,t){s&1&&Ne("click",function(w){return t._open(w)}),s&2&&(ir("tabindex",null)("data-mat-calendar",t.datepicker?t.datepicker.id:null),Ki("mat-datepicker-toggle-active",t.datepicker&&t.datepicker.opened)("mat-accent",t.datepicker&&t.datepicker.color==="accent")("mat-warn",t.datepicker&&t.datepicker.color==="warn"))},inputs:{datepicker:[kn.None,"for","datepicker"],tabIndex:"tabIndex",ariaLabel:[kn.None,"aria-label","ariaLabel"],disabled:[kn.HasDecoratorInputTransform,"disabled","disabled",Ha],disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],standalone:!0,features:[os,rs,Ur],ngContentSelectors:lz,decls:4,vars:6,consts:[["button",""],["mat-icon-button","","type","button",3,"disabled","disableRipple"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(s,t){s&1&&(qs(sz),U(0,"button",1,0),qt(2,cz,2,0,":svg:svg",2),as(3),W()),s&2&&(ze("disabled",t.disabled)("disableRipple",t.disableRipple),ir("aria-haspopup",t.datepicker?"dialog":null)("aria-label",t.ariaLabel||t._intl.openCalendarLabel)("tabindex",t.disabled?-1:t.tabIndex),le(2),hr(2,t._customIcon?-1:2))},dependencies:[CI],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color)}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color)}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}"],encapsulation:2,changeDetection:0});let c=o;return c})();var dA=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({providers:[Gy,bz],imports:[qc,JD,T0,U1,Lm,Wr,yz,xz,cA,$1]});let c=o;return c})();function wz(c,o){}var Bg=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}};var jI=(()=>{let o=class o extends C0{constructor(r,s,t,g,w,M,F,N){super(),this._elementRef=r,this._focusTrapFactory=s,this._config=g,this._interactivityChecker=w,this._ngZone=M,this._overlayRef=F,this._focusMonitor=N,this._platform=yr(oo),this._focusTrap=null,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this._changeDetectorRef=yr(Oa),this.attachDomPortal=Q=>{this._portalOutlet.hasAttached();let ae=this._portalOutlet.attachDomPortal(Q);return this._contentAttached(),ae},this._document=t,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(r){this._ariaLabelledByQueue.push(r),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(r){let s=this._ariaLabelledByQueue.indexOf(r);s>-1&&(this._ariaLabelledByQueue.splice(s,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(r){this._portalOutlet.hasAttached();let s=this._portalOutlet.attachComponentPortal(r);return this._contentAttached(),s}attachTemplatePortal(r){this._portalOutlet.hasAttached();let s=this._portalOutlet.attachTemplatePortal(r);return this._contentAttached(),s}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(r,s){this._interactivityChecker.isFocusable(r)||(r.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let t=()=>{r.removeEventListener("blur",t),r.removeEventListener("mousedown",t),r.removeAttribute("tabindex")};r.addEventListener("blur",t),r.addEventListener("mousedown",t)})),r.focus(s)}_focusByCssSelector(r,s){let t=this._elementRef.nativeElement.querySelector(r);t&&this._forceFocus(t,s)}_trapFocus(){let r=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||r.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElementWhenReady().then(s=>{s||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}}_restoreFocus(){let r=this._config.restoreFocus,s=null;if(typeof r=="string"?s=this._document.querySelector(r):typeof r=="boolean"?s=r?this._elementFocusedBeforeDialogWasOpened:null:r&&(s=r),this._config.restoreFocus&&s&&typeof s.focus=="function"){let t=Og(),g=this._elementRef.nativeElement;(!t||t===this._document.body||t===g||g.contains(t))&&(this._focusMonitor?(this._focusMonitor.focusVia(s,this._closeInteractionType),this._closeInteractionType=null):s.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let r=this._elementRef.nativeElement,s=Og();return r===s||r.contains(s)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=Og()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}};o.\u0275fac=function(s){return new(s||o)(_e(Vn),_e(Ny),_e(Kn,8),_e(Bg),_e(By),_e(gn),_e(zm),_e(Rm))},o.\u0275cmp=Et({type:o,selectors:[["cdk-dialog-container"]],viewQuery:function(s,t){if(s&1&&Vi(ef,7),s&2){let g;zi(g=Bi())&&(t._portalOutlet=g.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(s,t){s&2&&ir("id",t._config.id||null)("role",t._config.role)("aria-modal",t._config.ariaModal)("aria-labelledby",t._config.ariaLabel?null:t._ariaLabelledByQueue[0])("aria-label",t._config.ariaLabel)("aria-describedby",t._config.ariaDescribedBy||null)},standalone:!0,features:[Gs,Ur],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(s,t){s&1&&qt(0,wz,0,0,"ng-template",0)},dependencies:[ef],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2});let c=o;return c})(),qy=class{constructor(o,d){this.overlayRef=o,this.config=d,this.closed=new Or,this.disableClose=d.disableClose,this.backdropClick=o.backdropClick(),this.keydownEvents=o.keydownEvents(),this.outsidePointerEvents=o.outsidePointerEvents(),this.id=d.id,this.keydownEvents.subscribe(r=>{r.keyCode===27&&!this.disableClose&&!y0(r)&&(r.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=o.detachments().subscribe(()=>{d.closeOnOverlayDetachments!==!1&&this.close()})}close(o,d){if(this.containerInstance){let r=this.closed;this.containerInstance._closeInteractionType=d?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),r.next(o),r.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(o="",d=""){return this.overlayRef.updateSize({width:o,height:d}),this}addPanelClass(o){return this.overlayRef.addPanelClass(o),this}removePanelClass(o){return this.overlayRef.removePanelClass(o),this}},Cz=new Hn("DialogScrollStrategy",{providedIn:"root",factory:()=>{let c=yr(Ml);return()=>c.scrollStrategies.block()}}),Sz=new Hn("DialogData"),Iz=new Hn("DefaultDialogConfig");var Tz=0,UI=(()=>{let o=class o{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(r,s,t,g,w,M){this._overlay=r,this._injector=s,this._defaultOptions=t,this._parentDialog=g,this._overlayContainer=w,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Or,this._afterOpenedAtThisLevel=new Or,this._ariaHiddenElements=new Map,this.afterAllClosed=y1(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Ud(void 0))),this._scrollStrategy=M}open(r,s){let t=this._defaultOptions||new Bg;s=Dn(Dn({},t),s),s.id=s.id||`cdk-dialog-${Tz++}`,s.id&&this.getDialogById(s.id);let g=this._getOverlayConfig(s),w=this._overlay.create(g),M=new qy(w,s),F=this._attachContainer(w,M,s);return M.containerInstance=F,this._attachDialogContent(r,M,F,s),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(M),M.closed.subscribe(()=>this._removeOpenDialog(M,!0)),this.afterOpened.next(M),M}closeAll(){VI(this.openDialogs,r=>r.close())}getDialogById(r){return this.openDialogs.find(s=>s.id===r)}ngOnDestroy(){VI(this._openDialogsAtThisLevel,r=>{r.config.closeOnDestroy===!1&&this._removeOpenDialog(r,!1)}),VI(this._openDialogsAtThisLevel,r=>r.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(r){let s=new S0({positionStrategy:r.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:r.scrollStrategy||this._scrollStrategy(),panelClass:r.panelClass,hasBackdrop:r.hasBackdrop,direction:r.direction,minWidth:r.minWidth,minHeight:r.minHeight,maxWidth:r.maxWidth,maxHeight:r.maxHeight,width:r.width,height:r.height,disposeOnNavigation:r.closeOnNavigation});return r.backdropClass&&(s.backdropClass=r.backdropClass),s}_attachContainer(r,s,t){let g=t.injector||t.viewContainerRef?.injector,w=[{provide:Bg,useValue:t},{provide:qy,useValue:s},{provide:zm,useValue:r}],M;t.container?typeof t.container=="function"?M=t.container:(M=t.container.type,w.push(...t.container.providers(t))):M=jI;let F=new Jp(M,t.viewContainerRef,Uc.create({parent:g||this._injector,providers:w}),t.componentFactoryResolver);return r.attach(F).instance}_attachDialogContent(r,s,t,g){if(r instanceof Em){let w=this._createInjector(g,s,t,void 0),M={$implicit:g.data,dialogRef:s};g.templateContext&&(M=Dn(Dn({},M),typeof g.templateContext=="function"?g.templateContext():g.templateContext)),t.attachTemplatePortal(new Lg(r,null,M,w))}else{let w=this._createInjector(g,s,t,this._injector),M=t.attachComponentPortal(new Jp(r,g.viewContainerRef,w,g.componentFactoryResolver));s.componentRef=M,s.componentInstance=M.instance}}_createInjector(r,s,t,g){let w=r.injector||r.viewContainerRef?.injector,M=[{provide:Sz,useValue:r.data},{provide:qy,useValue:s}];return r.providers&&(typeof r.providers=="function"?M.push(...r.providers(s,r,t)):M.push(...r.providers)),r.direction&&(!w||!w.get(Fm,null,{optional:!0}))&&M.push({provide:Fm,useValue:{value:r.direction,change:Ln()}}),Uc.create({parent:w||g,providers:M})}_removeOpenDialog(r,s){let t=this.openDialogs.indexOf(r);t>-1&&(this.openDialogs.splice(t,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((g,w)=>{g?w.setAttribute("aria-hidden",g):w.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),s&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let r=this._overlayContainer.getContainerElement();if(r.parentElement){let s=r.parentElement.children;for(let t=s.length-1;t>-1;t--){let g=s[t];g!==r&&g.nodeName!=="SCRIPT"&&g.nodeName!=="STYLE"&&!g.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(g,g.getAttribute("aria-hidden")),g.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let r=this._parentDialog;return r?r._getAfterAllClosed():this._afterAllClosedAtThisLevel}};o.\u0275fac=function(s){return new(s||o)(wt(Ml),wt(Uc),wt(Iz,8),wt(o,12),wt(I0),wt(Cz))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();function VI(c,o){let d=c.length;for(;d--;)o(c[d])}var uA=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({providers:[UI],imports:[T0,Lm,U1,Lm]});let c=o;return c})();function Mz(c,o){}var $y=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}},WI="mdc-dialog--open",hA="mdc-dialog--opening",mA="mdc-dialog--closing",kz=150,Ez=75,Dz=(()=>{let o=class o extends jI{constructor(r,s,t,g,w,M,F,N,Q){super(r,s,t,g,w,M,F,Q),this._animationMode=N,this._animationStateChanged=new zn,this._animationsEnabled=this._animationMode!=="NoopAnimations",this._actionSectionCount=0,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?fA(this._config.enterAnimationDuration)??kz:0,this._exitAnimationDuration=this._animationsEnabled?fA(this._config.exitAnimationDuration)??Ez:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(pA,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(hA,WI)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(WI),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(WI),this._animationsEnabled?(this._hostElement.style.setProperty(pA,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(mA)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(r){this._actionSectionCount+=r,this._changeDetectorRef.markForCheck()}_clearAnimationClasses(){this._hostElement.classList.remove(hA,mA)}_waitForAnimationToComplete(r,s){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(s,r)}_requestAnimationFrame(r){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(r):r()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(r){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:r})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(r){let s=super.attachComponentPortal(r);return s.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),s}};o.\u0275fac=function(s){return new(s||o)(_e(Vn),_e(Ny),_e(Kn,8),_e($y),_e(By),_e(gn),_e(zm),_e(_a,8),_e(Rm))},o.\u0275cmp=Et({type:o,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(s,t){s&2&&(Pm("id",t._config.id),ir("aria-modal",t._config.ariaModal)("role",t._config.role)("aria-labelledby",t._config.ariaLabel?null:t._ariaLabelledByQueue[0])("aria-label",t._config.ariaLabel)("aria-describedby",t._config.ariaDescribedBy||null),Ki("_mat-animation-noopable",!t._animationsEnabled)("mat-mdc-dialog-container-with-actions",t._actionSectionCount>0))},standalone:!0,features:[Gs,Ur],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1),qt(2,Mz,0,0,"ng-template",2),W()())},dependencies:[ef],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0;transform:scale(0.8)}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--closing .mdc-dialog__surface{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{opacity:1}.mdc-dialog--open .mdc-dialog__surface{transform:none}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{width:100%;height:100%}.mat-mdc-dialog-component-host{display:contents}.mat-mdc-dialog-container{--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition:opacity linear var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container .mdc-dialog__surface{transition:transform var(--mat-dialog-transition-duration, 0ms) 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container,.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__surface{transition:none}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 80vw);min-width:var(--mat-dialog-container-min-width, 0)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, 80vw)}}.mat-mdc-dialog-title{padding:var(--mat-dialog-headline-padding, 0 24px 9px)}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{padding:var(--mat-dialog-actions-padding, 8px);justify-content:var(--mat-dialog-actions-alignment, start)}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2});let c=o;return c})(),pA="--mat-dialog-transition-duration";function fA(c){return c==null?null:typeof c=="number"?c:c.endsWith("ms")?zy(c.substring(0,c.length-2)):c.endsWith("s")?zy(c.substring(0,c.length-1))*1e3:c==="0"?0:null}var J1=function(c){return c[c.OPEN=0]="OPEN",c[c.CLOSING=1]="CLOSING",c[c.CLOSED=2]="CLOSED",c}(J1||{}),D0=class{constructor(o,d,r){this._ref=o,this._containerInstance=r,this._afterOpened=new Or,this._beforeClosed=new Or,this._state=J1.OPEN,this.disableClose=d.disableClose,this.id=o.id,o.addPanelClass("mat-mdc-dialog-panel"),r._animationStateChanged.pipe(oc(s=>s.state==="opened"),jc(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),r._animationStateChanged.pipe(oc(s=>s.state==="closed"),jc(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),o.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),kg(this.backdropClick(),this.keydownEvents().pipe(oc(s=>s.keyCode===27&&!this.disableClose&&!y0(s)))).subscribe(s=>{this.disableClose||(s.preventDefault(),Az(this,s.type==="keydown"?"keyboard":"mouse"))})}close(o){this._result=o,this._containerInstance._animationStateChanged.pipe(oc(d=>d.state==="closing"),jc(1)).subscribe(d=>{this._beforeClosed.next(o),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),d.totalTime+100)}),this._state=J1.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(o){let d=this._ref.config.positionStrategy;return o&&(o.left||o.right)?o.left?d.left(o.left):d.right(o.right):d.centerHorizontally(),o&&(o.top||o.bottom)?o.top?d.top(o.top):d.bottom(o.bottom):d.centerVertically(),this._ref.updatePosition(),this}updateSize(o="",d=""){return this._ref.updateSize(o,d),this}addPanelClass(o){return this._ref.addPanelClass(o),this}removePanelClass(o){return this._ref.removePanelClass(o),this}getState(){return this._state}_finishDialogClose(){this._state=J1.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function Az(c,o,d){return c._closeInteractionType=o,c.close(d)}var HI=new Hn("MatMdcDialogData"),Pz=new Hn("mat-mdc-dialog-default-options"),Oz=new Hn("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let c=yr(Ml);return()=>c.scrollStrategies.block()}});var Rz=0,A0=(()=>{let o=class o{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let r=this._parentDialog;return r?r._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(r,s,t,g,w,M,F,N){this._overlay=r,this._defaultOptions=g,this._scrollStrategy=w,this._parentDialog=M,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Or,this._afterOpenedAtThisLevel=new Or,this.dialogConfigClass=$y,this.afterAllClosed=y1(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Ud(void 0))),this._dialog=s.get(UI),this._dialogRefConstructor=D0,this._dialogContainerType=Dz,this._dialogDataToken=HI}open(r,s){let t;s=Dn(Dn({},this._defaultOptions||new $y),s),s.id=s.id||`mat-mdc-dialog-${Rz++}`,s.scrollStrategy=s.scrollStrategy||this._scrollStrategy();let g=this._dialog.open(r,yl(Dn({},s),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:s},{provide:Bg,useValue:s}]},templateContext:()=>({dialogRef:t}),providers:(w,M,F)=>(t=new this._dialogRefConstructor(w,s,F),t.updatePosition(s?.position),[{provide:this._dialogContainerType,useValue:F},{provide:this._dialogDataToken,useValue:M.data},{provide:this._dialogRefConstructor,useValue:t}])}));return t.componentRef=g.componentRef,t.componentInstance=g.componentInstance,this.openDialogs.push(t),this.afterOpened.next(t),t.afterClosed().subscribe(()=>{let w=this.openDialogs.indexOf(t);w>-1&&(this.openDialogs.splice(w,1),this.openDialogs.length||this._getAfterAllClosed().next())}),t}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(r){return this.openDialogs.find(s=>s.id===r)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(r){let s=r.length;for(;s--;)r[s].close()}};o.\u0275fac=function(s){return new(s||o)(wt(Ml),wt(Uc),wt(yi,8),wt(Pz,8),wt(Oz),wt(o,12),wt(I0),wt(_a,8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),Fz=0;var gA=(()=>{let o=class o{constructor(r,s,t){this._dialogRef=r,this._elementRef=s,this._dialog=t}ngOnInit(){this._dialogRef||(this._dialogRef=Lz(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{this._onAdd()})}ngOnDestroy(){this._dialogRef?._containerInstance&&Promise.resolve().then(()=>{this._onRemove()})}};o.\u0275fac=function(s){return new(s||o)(_e(D0,8),_e(Vn),_e(A0))},o.\u0275dir=io({type:o,standalone:!0});let c=o;return c})(),_A=(()=>{let o=class o extends gA{constructor(){super(...arguments),this.id=`mat-mdc-dialog-title-${Fz++}`}_onAdd(){this._dialogRef._containerInstance?._addAriaLabelledBy?.(this.id)}_onRemove(){this._dialogRef?._containerInstance?._removeAriaLabelledBy?.(this.id)}};o.\u0275fac=(()=>{let r;return function(t){return(r||(r=h0(o)))(t||o)}})(),o.\u0275dir=io({type:o,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-mdc-dialog-title","mdc-dialog__title"],hostVars:1,hostBindings:function(s,t){s&2&&Pm("id",t.id)},inputs:{id:"id"},exportAs:["matDialogTitle"],standalone:!0,features:[Gs]});let c=o;return c})(),bA=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275dir=io({type:o,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],standalone:!0});let c=o;return c})(),yA=(()=>{let o=class o extends gA{_onAdd(){this._dialogRef._containerInstance?._updateActionSectionCount?.(1)}_onRemove(){this._dialogRef._containerInstance?._updateActionSectionCount?.(-1)}};o.\u0275fac=(()=>{let r;return function(t){return(r||(r=h0(o)))(t||o)}})(),o.\u0275dir=io({type:o,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:6,hostBindings:function(s,t){s&2&&Ki("mat-mdc-dialog-actions-align-start",t.align==="start")("mat-mdc-dialog-actions-align-center",t.align==="center")("mat-mdc-dialog-actions-align-end",t.align==="end")},inputs:{align:"align"},standalone:!0,features:[Gs]});let c=o;return c})();function Lz(c,o){let d=c.nativeElement.parentElement;for(;d&&!d.classList.contains("mat-mdc-dialog-container");)d=d.parentElement;return d?o.find(r=>r.id===d.id):null}var vA=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({providers:[A0],imports:[uA,T0,Lm,Wr,Wr]});let c=o;return c})();var _n="https://appsvc-apibackend-dev.azurewebsites.net/v1.0/";var ew=(()=>{let o=class o{constructor(r,s){this.dialogRef=r,this.data=s,this.content="",this.content=s.content,setTimeout(()=>{this.onNoClick()},3e3)}onNoClick(){this.dialogRef.close()}};o.\u0275fac=function(s){return new(s||o)(_e(D0),_e(HI))},o.\u0275cmp=Et({type:o,selectors:[["app-demo"]],inputs:{content:"content"},decls:3,vars:1,consts:[[1,"mat-dialog-container","bottom-dialog-container"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"p"),X(2),W()()),s&2&&(le(2),Xt(t.content))},styles:[".mat-dialog-container[_ngcontent-%COMP%]{position:fixed;bottom:2rem;left:5%;width:90%;height:auto;border-radius:16px;color:#fff;background-color:#0d0c0cad;padding:8px;display:flex;align-items:center;justify-content:center}"]});let c=o;return c})();var mr=(()=>{let o=class o{constructor(r){this.dialog=r}openDialog(r){let s={content:r};this.dialog.open(ew,{width:"100%",height:"auto",panelClass:"bottom-dialog-container",data:s})}};o.\u0275fac=function(s){return new(s||o)(wt(A0))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var nr=(()=>{let o=class o{constructor(r){this.http=r,this.workResponse=[],this.buyedPackage=[],this.api=_n}getUserDetails(r){let s=this.api+`providers/provider-auth/${r}`;return this.providerDetails?Ln(this.providerDetails):new ga(t=>{this.http.get(s).subscribe(g=>{console.log(g),this.providerDetails=g,t.next(this.providerDetails),t.complete()},g=>{console.log(g),t.error(g)})})}selectWork(r){return r}getBanners(){let r=`${this.api}admin/provider-banners`;return this.http.get(r)}getWork(r){let s=this.api+`providers/provider-work/${r}`;return console.log(s),this.http.get(s)}deleteServiceWork(r,s){let t=`${this.api}providers/provider-work/delete`,w={body:{providerId:localStorage.getItem("providerId"),workId:r,serviceId:s}};return this.http.delete(t,w)}deleteWork(r){let s=`${this.api}providers/provider-work/delete-work`,t={body:r};return this.http.delete(s,t)}getFinancialDetails(){let r=this.api+`providers/provider-finance/${localStorage.getItem("providerId")}`;return this.http.get(r)}getPackages(){let r=`${this.api}admin/admin-provider-package`;return this.http.get(r)}buyingPackages(r){let s=`${this.api}providers/provider-package`;return this.http.post(s,r)}getPurchasedPackages(r){let s=`${this.api}providers/provider-package/${r}`;return this.http.get(s)}getBuyedPackage(){let r=localStorage.getItem("providerId");return this.buyedPackage&&this.buyedPackage.length>0?Ln(this.buyedPackage):new ga(s=>{this.getPurchasedPackages(r).subscribe({next:t=>{console.log(t),this.buyedPackage=t,s.next(this.buyedPackage),s.complete()},error:t=>{console.error(t),this.buyedPackage=[],s.error(t)}})})}getCertificated(r){let s=this.api+`providers/provider-certificate/${r}`;return this.http.get(s)}upDatingEarnings(r){let s=`${this.api}providers/provider-earnings`;return this.http.post(s,r)}setDefult(){this.workResponseId="",this.workResponse=[],this.currentLocation="",this.currentCordinates="",this.userRegistered="",this.api=""}};o.\u0275fac=function(s){return new(s||o)(wt(ji))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var Br=(()=>{let o=class o{constructor(r,s,t){this.http=r,this.router=s,this.dialogService=t,this.apiUrl=_n,this.userDetails=[],this.workDetails=[],this.alreadyHasAccount=!1,this.isAccountVerify=!0,this.api="",this.name="",this.workId=[],this.experience=0,this.selectedSubCategories=[],this.userFromServer=[],this.catIdForServices=[]}setLog(r){console.log(r),console.log(this.api);let s={phone:r},t=this.apiUrl+"providers/provider-auth/login";console.log(s),this.http.post(t,s).subscribe(g=>{console.log(g),this.responseOtp=g,this.userNumber=r,this.router.navigate(["verify"])},g=>{console.log(g),console.log(g.error),console.log(g.error.message),g.error.message==="User does not exist. Please sign up first."?(alert("Account was not found. Please signUp first."),this.router.navigate(["selectAccount"])):alert("something went wrong.Please retry again")})}showOtp(){alert(this.responseOtp.otp)}resendOtp(){console.log(this.userNumber),console.log(this.api);let r={phone:this.userNumber};console.log(r),this.http.post(this.api,r).subscribe(s=>{console.log(s)},s=>{console.log(s)})}verifyOtp(r){let s={otp:r,phone:this.userNumber},t=this.apiUrl+"providers/provider-auth/verify-otp";return this.http.post(t,s)}setUserInLocalStroage(r){localStorage.setItem("providerId",r)}setUser(r){this.userDetails.push({number:this.userNumber}),console.log(this.userDetails),localStorage.setItem("providerId",r),this.userId=localStorage.getItem("providerId")}getUserId(){let r=localStorage.getItem("providerId");return console.log(r),Ln(r)}removeUser(){localStorage.removeItem("providerId")}setWork(r,s){this.workName=r,this.workId.push(s),console.log(this.workId)}setSubCat(r,s){this.selectedSubCategories.push(r),this.catIdForServices.push(s),console.log(this.selectedSubCategories)}setservices(r){console.log("serviceId",r),this.selectedServiceId=r}setAge(r){console.log(r),this.age=r,console.log(this.age)}setExperiance(r){console.log(r),this.experience=r}setWorkDetails(){this.workDetails=[],console.log(this.selectedSubCategories);let r=[{categoryId:this.workId,experience:this.experience,subcategoryId:this.selectedSubCategories,serviceId:this.selectedServiceId}];this.workDetails=r,console.log(this.workDetails)}getSubCategories(r){let s=r.map(t=>{let g=`${this.apiUrl}core/sub-categories/category/${t}`;return this.http.get(g).pipe(Ro(w=>(console.error(`Failed to fetch data for category ID ${t}:`,w),Ln(null))))});return km(s)}getServices(r,s){let t=`${_n}providers/provider-display-services/services`,g={categoryIds:r,subCategoryIds:s};return this.http.post(t,g)}sendWorkDetails(r){let s=this.apiUrl+"providers/provider-work",g={providerId:localStorage.getItem("providerId"),works:r};return console.log(g),this.http.post(s,g)}UserDetails(r){let s=[];r.forEach((w,M)=>{s.push(M=w)}),console.log(s),console.log(r);let t=localStorage.getItem("providerId"),g=`${this.apiUrl}providers/provider-auth/${t}`;return new ga(w=>{this.http.patch(g,r).subscribe(M=>{console.log("Success",M),this.userFromServer=M,w.next(M),w.complete(),this.router.navigate(["addAddress"])},M=>{console.error("Error",M),M.error instanceof ErrorEvent?alert("A network error occurred. Please try again later."):alert("An error occurred. Please try again later."),console.error(`Backend returned code ${M.status}, body was: `,M.error),w.error(M)})})}formatingResponse(r){console.log(r.work),console.log(r.work);let t=JSON.parse(r.work).flat();this.userFromServer.work=t,console.log(this.userFromServer)}updateUserWork(r,s){console.log(r);let t=localStorage.getItem("providerId");console.log(s);let g={providerId:t,works:r};console.log("work in service",g);let w=this.apiUrl+"providers/provider-work";this.http.post(w,g).subscribe(M=>{console.log(M),this.dialogService.openDialog("Service has been updated"),this.router.navigate(["home"])},M=>{console.log(M)})}getPhoneNumber(){let r=localStorage.getItem("providerId"),s=this.apiUrl+`providers/provider-auth/${r}`;return this.http.get(s).subscribe(t=>{this.userNumber=t.phone,console.log(this.userNumber)},t=>{console.log(t)}),this.userNumber}getAddress(){let r=localStorage.getItem("providerId"),s=`${_n}providers/provider-address/${r}`;return this.http.get(s)}setDefult(){this.userDetails=[],this.workDetails=[],this.userNumber=null,this.userId="",this.alreadyHasAccount=!1,this.isAccountVerify=!0,this.api="",this.responseOtp="",this.name="",this.pincode="",this.radius=void 0,this.workName="",this.workId=[],this.age="",this.gender="",this.experience=0,this.selectedSubCategories=[],this.categoryId="",this.userFromServer=[]}};o.\u0275fac=function(s){return new(s||o)(wt(ji),wt(ii),wt(mr))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var Bm=Qp("PushNotifications",{});var zz="firebase",Bz="10.12.4";iD(zz,Bz,"app");var Yy=new qS("ANGULARFIRE2_VERSION");var tw=class{zone;delegate;constructor(o,d=_E){this.zone=o,this.delegate=d}now(){return this.delegate.now()}schedule(o,d,r){let s=this.zone,t=function(g){s.runGuarded(()=>{o.apply(this,[g])})};return this.delegate.schedule(t,d,r)}};var xA=(()=>{class c{ngZone;outsideAngular;insideAngular;constructor(d){this.ngZone=d,this.outsideAngular=d.runOutsideAngular(()=>new tw(Zone.current)),this.insideAngular=d.run(()=>new tw(Zone.current,gE)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||c)(wt(gn))};static \u0275prov=ci({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();var Vz="firebase",jz="10.12.4";Hd.registerVersion(Vz,jz,"app-compat");var Uz=["ngOnDestroy"],CA=(c,o,d,r={})=>new Proxy(c,{get:(s,t)=>d.runOutsideAngular(()=>{if(c[t])return r?.spy?.get&&r.spy.get(t,c[t]),c[t];if(Uz.indexOf(t)>-1)return()=>{};let g=o.toPromise().then(w=>{let M=w?.[t];return typeof M=="function"?M.bind(w):M?.then?M.then(F=>d.run(()=>F)):d.run(()=>M)});return new Proxy(()=>{},{get:(w,M)=>g[M],apply:(w,M,F)=>g.then(N=>{let Q=N?.(...F);return r?.spy?.apply&&r.spy.apply(t,F,Q),Q})})})});var iw=class{constructor(o){return o}},nw=new Hn("angularfire2.app.options"),rw=new Hn("angularfire2.app.name");function qI(c,o,d){let r=typeof d=="string"&&d||"[DEFAULT]",s=typeof d=="object"&&d||{};s.name=s.name||r;let g=Hd.apps.filter(w=>w&&w.name===s.name)[0]||o.runOutsideAngular(()=>Hd.initializeApp(c,s));try{if(JSON.stringify(c)!==JSON.stringify(g.options)){let w=!!module.hot;Wz("error",`${g.name} Firebase App already initialized with different options${w?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new iw(g)}var Wz=(c,...o)=>{$S()&&typeof console<"u"&&console[c](...o)},Hz={provide:iw,useFactory:qI,deps:[nw,gn,[new x1,rw]]},SA=(()=>{class c{static initializeApp(d,r){return{ngModule:c,providers:[{provide:nw,useValue:d},{provide:rw,useValue:r}]}}constructor(d){Hd.registerVersion("angularfire",Yy.full,"core"),Hd.registerVersion("angularfire",Yy.full,"app-compat"),Hd.registerVersion("angular",PE.full,d.toString())}static \u0275fac=function(r){return new(r||c)(wt(ah))};static \u0275mod=Pi({type:c});static \u0275inj=Ai({providers:[Hz]})}return c})();function IA(c,o,d,r,s){let[,t,g]=globalThis.\u0275AngularfireInstanceCache.find(w=>w[0]===c)||[];if(t)return Gz(s,g)||(wA("error",`${o} was already initialized on the ${d} Firebase App with different settings.${qz?" You may need to reload as Firebase is not HMR aware.":""}`),wA("warn",{is:s,was:g})),t;{let w=r();return globalThis.\u0275AngularfireInstanceCache.push([c,w,s]),w}}function Gz(c,o){try{return c.toString()===o.toString()}catch{return c===o}}var qz=typeof module<"u"&&!!module.hot,wA=(c,...o)=>{$S()&&typeof console<"u"&&console[c](...o)};globalThis.\u0275AngularfireInstanceCache||=[];var $z=new Hn("angularfire2.messaging.vapid-key"),Yz=new Hn("angularfire2.messaging.service-worker-registeration"),$I=(()=>{class c{requestPermission;getToken;tokenChanges;messages;requestToken;deleteToken;constructor(d,r,s,t,g,w,M){let F=M,N=Ln(void 0).pipe(Mm(g.outsideAngular),Tm(g.insideAngular),Wd(nD),Wd(pe=>pe?import("./chunk-WCJOXY6X.js"):bE),d0(()=>qI(d,t,r)),Wd(pe=>IA(`${pe.name}.messaging`,"AngularFireMessaging",pe.name,()=>Ln(pe.messaging()),[])),VS({bufferSize:1,refCount:!1}));this.requestPermission=N.pipe(Mm(g.outsideAngular),Tm(g.insideAngular),Wd(()=>Notification.requestPermission())),this.getToken=N.pipe(Mm(g.outsideAngular),Tm(g.insideAngular),Wd(pe=>zr(this,null,function*(){if(Notification.permission==="granted"){let Te=F?yield F:null;return yield pe.getToken({vapidKey:w,serviceWorkerRegistration:Te})}else return null})));let Q=new ga(pe=>{navigator.permissions.query({name:"notifications"}).then(Te=>{Te.onchange=()=>pe.next()})}),ae=N.pipe(Mm(g.outsideAngular),Tm(g.insideAngular),jS(Q),jS(this.getToken));return this.tokenChanges=N.pipe(Mm(g.outsideAngular),Tm(g.insideAngular),Wd(()=>b1(this.getToken,ae))),this.messages=N.pipe(Mm(g.outsideAngular),Tm(g.insideAngular),Wd(pe=>new ga(Te=>pe.onMessage(Te)))),this.requestToken=N.pipe(Mm(g.outsideAngular),Tm(g.insideAngular),Wd(()=>this.requestPermission),Ro(()=>Ln(null)),vE(()=>this.tokenChanges)),this.deleteToken=()=>N.pipe(Mm(g.outsideAngular),Tm(g.insideAngular),Wd(pe=>pe.deleteToken()),wE(!1)),CA(this,N,t)}static \u0275fac=function(r){return new(r||c)(wt(nw),wt(rw,8),wt(ah),wt(gn),wt(xA),wt($z,8),wt(Yz,8))};static \u0275prov=ci({token:c,factory:c.\u0275fac,providedIn:"any"})}return c})(),TA=(()=>{class c{constructor(){Hd.registerVersion("angularfire",Yy.full,"fcm-compat")}static \u0275fac=function(r){return new(r||c)};static \u0275mod=Pi({type:c});static \u0275inj=Ai({providers:[$I]})}return c})();var P0=(()=>{let o=class o{constructor(r,s,t,g){this.afMessaging=r,this.http=s,this.router=t,this.location=g,this.orderId=null,this.apiUrl=_n,this.listenForMessages()}requestPermission(){eD.isNativePlatform()?Bm.requestPermissions().then(r=>{r.receive==="granted"&&(Bm.register(),Bm.addListener("registration",s=>{console.log("Push registration success, token: "+s.value),this.token=s.value,this.sendTokenToBackend(s.value)}),Bm.addListener("pushNotificationReceived",s=>{this.handleInAppNotification(s),console.log("Push received: ",s)}),Bm.addListener("pushNotificationActionPerformed",s=>{console.log("Push action performed: ",s),this.handleNotificationClick(s)}))}):this.afMessaging.requestToken.subscribe({next:r=>{console.log("FCM token:",r),this.token=r,this.sendTokenToBackend(r)},error:r=>{console.error("Error getting token",r)}})}listenForMessages(){this.afMessaging.messages.subscribe(r=>{console.log(r);let s=r.notification?.title,t=r.data?.orderId;s==="New Order"&&t&&this.router.navigate(["getOrder",t],{replaceUrl:!0}).then(()=>{this.location.replaceState("home")})},r=>{console.log(r)})}sendTokenToBackend(r){alert(r);let s=this.apiUrl+"providers/provider-token",t={providerId:localStorage.getItem("providerId"),token:r};alert(t.providerId),alert(t.token),this.http.post(s,t).subscribe({next:g=>{console.log(g),alert("token send sucessfully")},error:g=>{console.log(g),alert("error"),alert(g.error.message)}})}handleInAppNotification(r){alert("inapp notification");let s=r.notification?.title||r.title,t=r.notification?.body||r.body,g=r.data;s&&t&&(alert(s),s==="New Order"&&(alert(g.orderId),setTimeout(()=>{this.router.navigate(["getOrder",g.orderId]).then(()=>{this.location.replaceState("home")})},3e3)))}handleNotificationClick(r){let s=r.data?.orderId,t=r.notification?.title,g=r.notification?.body;t&&t==="New Order"&&(alert("inside nav"),setTimeout(()=>{alert(s),this.router.navigate(["getOrder",s])},3e3))}setOrderId(r){this.orderId=r}getOrderId(){return this.orderId}clearOrderId(){this.orderId=null}};o.\u0275fac=function(s){return new(s||o)(wt($I),wt(ji),wt(ii),wt(yi))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var MA=(()=>{let o=class o{constructor(r,s,t,g,w,M){this.router=r,this.dailougeBoxService=s,this.http=t,this.userDetailsService=g,this.logInService=w,this.getOrderService=M,setTimeout(()=>{console.log(localStorage.getItem("providerId")),localStorage.getItem("providerId")?this.navTo():this.router.navigate(["log-in"])},4e3),this.getOrderService.getOrderId()&&setTimeout(()=>{this.router.navigate(["getOrder",this.getOrderService.getOrderId])},4e3)}navTo(){let r=localStorage.getItem("providerId"),s=this.logInService.getAddress().pipe(Ro(M=>(console.error("address",M),Ln("not found")))),t=this.userDetailsService.getUserDetails(r).pipe(Ro(M=>(console.error("details",M),Ln("not found")))),g=this.userDetailsService.getWork(localStorage.getItem("providerId")).pipe(Ro(M=>(console.error("work",M),Ln("not found")))),w=this.http.get(`${_n}providers/provider-watched-video/${r}`).pipe(Ro(M=>(console.error("training",M),Ln("not found"))));u0([t,s,g,w]).subscribe(([M,F,N,Q])=>{console.log("API 1 Response:",M),console.log("API 2 Response:",F),console.log("API 3 Response:",N),console.log("API 4 Response:",Q);let ae=[{condition:M.provider.firstName?M:"not found",message:"Please complete your registration",route:"aboutUser"},{condition:F,message:"Please complete your registration",route:"addAddress"},{condition:N,message:"Please provide your address",route:"selectWork"},{condition:Q,message:"Please complete your training",route:"induction"}];for(let pe of ae)if(pe.condition==="not found"){this.dailougeBoxService.openDialog(pe.message),this.router.navigate([pe.route]);break}ae.every(pe=>!pe.condition)&&this.router.navigate(["home"])},M=>{console.error("Error in combining responses",M)})}};o.\u0275fac=function(s){return new(s||o)(_e(ii),_e(mr),_e(ji),_e(nr),_e(Br),_e(P0))},o.\u0275cmp=Et({type:o,selectors:[["app-landing-page"]],decls:3,vars:0,consts:[["gifElement",""],[1,"container"],["src","assets/new/ti.gif","alt","Loading...",1,"gif-loader"]],template:function(s,t){s&1&&(U(0,"div",1),Oe(1,"img",2,0),W())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}"]});let c=o;return c})();var kA=(()=>{let o=class o{constructor(r){this.location=r}ngAfterViewInit(){this.loadGoogleTranslateScript()}loadGoogleTranslateScript(){if(!document.getElementById("google-translate-script")){let s=document.createElement("script");s.type="text/javascript",s.src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit",s.id="google-translate-script",document.body.appendChild(s)}}navToBack(){this.location.back()}};o.\u0275fac=function(s){return new(s||o)(_e(yi))},o.\u0275cmp=Et({type:o,selectors:[["app-language"]],decls:8,vars:0,consts:[[1,"container"],[1,"sub-container"],[1,"tittlee"],[1,"material-symbols-outlined","notranslate",3,"click"],["id","google_translate_element",1,"trans"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2)(3,"span",3),Ne("click",function(){return t.navToBack()}),X(4," keyboard_backspace "),W(),U(5,"span"),X(6,"Select Language"),W()(),Oe(7,"div",4),W()())},styles:['.goog-te-banner-frame.skiptranslate[_ngcontent-%COMP%]{display:none!important}body[_ngcontent-%COMP%]{top:0!important}.goog-logo-link[_ngcontent-%COMP%]{display:none!important}.goog-te-gadget[_ngcontent-%COMP%]{font-size:0}select[_ngcontent-%COMP%]{padding:8px;font-size:16px;border-radius:4px;border:1px solid #ccc;margin-top:10px}.container[_ngcontent-%COMP%]{width:100%;height:100vh;margin-bottom:1rem}.sub-container[_ngcontent-%COMP%]{width:95%;position:relative;top:3%;left:2.5%;display:flex;flex-direction:column;gap:2rem;padding-bottom:3rem}.tittlee[_ngcontent-%COMP%]{display:flex;text-align:center;align-items:center;gap:10px}.tittlee[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.2rem;font-family:"Roboto" sans-serif;font-weight:500}.trans[_ngcontent-%COMP%]   .goog-te-combo[_ngcontent-%COMP%]{width:100%;height:2rem;margin:0;border:1px solid rgb(208,32,32)}']});let c=o;return c})();var EA=(()=>{let o=class o{constructor(r){this.http=r,this.apiUrl=_n,this.api=this.apiUrl+"providers/provider-auth/signup"}setLog(r){console.log(r);let s={phone:r};console.log(s),this.http.post(this.api,s).subscribe(t=>{console.log(t)},t=>{console.log(t)})}setDefult(){this.api="",this.apiUrl=""}};o.\u0275fac=function(s){return new(s||o)(wt(ji))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var Zc=c=>({"full-screen":c}),Qz=(c,o)=>({"border-radius":c,"background-color":o}),Kz=(c,o,d,r)=>({"border-top-color":c,"border-right-color":o,"border-bottom-color":d,"border-left-color":r}),bo=c=>({"background-color":c}),Jz=c=>({color:c});function e4(c,o){if(c&1&&Oe(0,"div",14),c&2){let d=it(2);ze("ngClass",wi(2,Zc,d.config.fullScreenBackdrop===!0))("ngStyle",GS(4,Kz,d.config.secondaryColour,d.config.secondaryColour,d.config.secondaryColour,d.config.primaryColour))}}function t4(c,o){if(c&1&&(U(0,"div",15),Oe(1,"div",16)(2,"div",17)(3,"div",18)(4,"div",19)(5,"div",20)(6,"div",21)(7,"div",22)(8,"div",23)(9,"div",24),W()),c&2){let d=it(2);ze("ngClass",wi(10,Zc,d.config.fullScreenBackdrop===!0)),le(),ze("ngStyle",wi(12,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(14,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(16,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(18,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(20,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(22,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(24,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(26,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(28,bo,d.config.primaryColour))}}function i4(c,o){if(c&1&&Oe(0,"div",25),c&2){let d=it(2);ze("ngStyle",wi(2,bo,d.config.primaryColour))("ngClass",wi(4,Zc,d.config.fullScreenBackdrop===!0))}}function n4(c,o){if(c&1&&(U(0,"div",26),Oe(1,"div",27)(2,"div",28)(3,"div",29)(4,"div",30)(5,"div",31),W()),c&2){let d=it(2);ze("ngClass",wi(6,Zc,d.config.fullScreenBackdrop===!0)),le(),ze("ngStyle",wi(8,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(10,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(12,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(14,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(16,bo,d.config.primaryColour))}}function r4(c,o){if(c&1&&(U(0,"div",32),Oe(1,"div",33)(2,"div",34),W()),c&2){let d=it(2);ze("ngClass",wi(3,Zc,d.config.fullScreenBackdrop===!0)),le(),ze("ngStyle",wi(5,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(7,bo,d.config.secondaryColour))}}function o4(c,o){if(c&1&&(U(0,"div",35),Oe(1,"div",36)(2,"div",37),W()),c&2){let d=it(2);ze("ngClass",wi(3,Zc,d.config.fullScreenBackdrop===!0)),le(),ze("ngStyle",wi(5,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(7,bo,d.config.secondaryColour))}}function a4(c,o){if(c&1&&Oe(0,"div",38),c&2){let d=it(2);ze("ngClass",wi(2,Zc,d.config.fullScreenBackdrop===!0))("ngStyle",wi(4,bo,d.config.primaryColour))}}function s4(c,o){if(c&1&&(U(0,"div",39),Oe(1,"div",40)(2,"div",41),W()),c&2){let d=it(2);ze("ngClass",wi(3,Zc,d.config.fullScreenBackdrop===!0)),le(),ze("ngStyle",wi(5,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(7,bo,d.config.secondaryColour))}}function l4(c,o){if(c&1&&Oe(0,"div",42),c&2){let d=it(2);ze("ngClass",wi(2,Zc,d.config.fullScreenBackdrop===!0))("ngStyle",wi(4,Jz,d.config.primaryColour))}}function c4(c,o){if(c&1&&Oe(0,"div",43),c&2){let d=it(2);ze("ngClass",wi(1,Zc,d.config.fullScreenBackdrop===!0))}}function d4(c,o){if(c&1&&(U(0,"div",44),Oe(1,"div",45)(2,"div",46)(3,"div",47),W()),c&2){let d=it(2);ze("ngClass",wi(4,Zc,d.config.fullScreenBackdrop===!0)),le(),ze("ngStyle",wi(6,bo,d.config.primaryColour)),le(),ze("ngStyle",wi(8,bo,d.config.secondaryColour)),le(),ze("ngStyle",wi(10,bo,d.config.tertiaryColour))}}function u4(c,o){c&1&&S1(0)}function h4(c,o){if(c&1&&(Dm(0),qt(1,u4,1,0,"ng-container",48),Am()),c&2){let d=it(2);le(),ze("ngTemplateOutlet",d.template)}}function m4(c,o){if(c&1&&(U(0,"div"),Oe(1,"div",1),U(2,"div",2),qt(3,e4,1,9,"div",3)(4,t4,10,30,"div",4)(5,i4,1,6,"div",5)(6,n4,6,18,"div",6)(7,r4,3,9,"div",7)(8,o4,3,9,"div",8)(9,a4,1,6,"div",9)(10,s4,3,9,"div",10)(11,l4,1,6,"div",11)(12,c4,1,3,"div",12)(13,d4,4,12,"div",13)(14,h4,2,1,"ng-container",0),W()()),c&2){let d=it();le(),ze("ngClass",wi(14,Zc,d.config.fullScreenBackdrop===!0))("ngStyle",T1(16,Qz,d.config.backdropBorderRadius,d.config.backdropBackgroundColour)),le(),ze("ngSwitch",d.config.animationType),le(),ze("ngSwitchCase",d.ngxLoadingAnimationTypes.circle),le(),ze("ngSwitchCase",d.ngxLoadingAnimationTypes.cubeGrid),le(),ze("ngSwitchCase",d.ngxLoadingAnimationTypes.rotatingPlane),le(),ze("ngSwitchCase",d.ngxLoadingAnimationTypes.rectangleBounce),le(),ze("ngSwitchCase",d.ngxLoadingAnimationTypes.wanderingCubes),le(),ze("ngSwitchCase",d.ngxLoadingAnimationTypes.doubleBounce),le(),ze("ngSwitchCase",d.ngxLoadingAnimationTypes.pulse),le(),ze("ngSwitchCase",d.ngxLoadingAnimationTypes.chasingDots),le(),ze("ngSwitchCase",d.ngxLoadingAnimationTypes.circleSwish),le(),ze("ngSwitchCase",d.ngxLoadingAnimationTypes.none),le(2),ze("ngIf",d.template)}}var ow=class{constructor(o={}){this.backdropBorderRadius=o.backdropBorderRadius,this.backdropBackgroundColour=o.backdropBackgroundColour,this.fullScreenBackdrop=o.fullScreenBackdrop,this.animationType=o.animationType,this.primaryColour=o.primaryColour,this.secondaryColour=o.secondaryColour,this.tertiaryColour=o.tertiaryColour}},DA={chasingDots:"chasing-dots",circle:"sk-circle",circleSwish:"circleSwish",cubeGrid:"sk-cube-grid",doubleBounce:"double-bounce",none:"none",pulse:"pulse",rectangleBounce:"rectangle-bounce",rotatingPlane:"rotating-plane",threeBounce:"three-bounce",wanderingCubes:"wandering-cubes"},p4=(()=>{let o=class o{constructor(r){this.config=r,this.loadingConfig=this.config||new ow}};o.\u0275fac=function(s){return new(s||o)(wt("loadingConfig",8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),nf=(()=>{let o=class o{constructor(r){this.LoadingService=r,this.show=!1,this.config=new ow,this.defaultConfig={animationType:DA.threeBounce,backdropBackgroundColour:"rgba(0, 0, 0, 0.3)",backdropBorderRadius:"0px",fullScreenBackdrop:!1,primaryColour:"#ffffff",secondaryColour:"#ffffff",tertiaryColour:"#ffffff"},this.ngxLoadingAnimationTypes=DA}ngOnInit(){this.setupConfig()}setupConfig(){for(let r in this.defaultConfig)this.config[r]==null&&(this.config[r]=this.LoadingService.loadingConfig[r]!=null?this.LoadingService.loadingConfig[r]:this.defaultConfig[r])}};o.\u0275fac=function(s){return new(s||o)(_e(p4))},o.\u0275cmp=Et({type:o,selectors:[["ngx-loading"]],inputs:{show:"show",config:"config",template:"template"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"backdrop",3,"ngClass","ngStyle"],[3,"ngSwitch"],["class","spinner-circle",3,"ngClass","ngStyle",4,"ngSwitchCase"],["class","sk-cube-grid",3,"ngClass",4,"ngSwitchCase"],["class","spinner-sk-rotateplane",3,"ngStyle","ngClass",4,"ngSwitchCase"],["class","spinner-rectangle-bounce",3,"ngClass",4,"ngSwitchCase"],["class","spinner-wandering-cubes",3,"ngClass",4,"ngSwitchCase"],["class","spinner-double-bounce",3,"ngClass",4,"ngSwitchCase"],["class","spinner-pulse",3,"ngClass","ngStyle",4,"ngSwitchCase"],["class","spinner-chasing-dots",3,"ngClass",4,"ngSwitchCase"],["class","spinner-circle-swish",3,"ngClass","ngStyle",4,"ngSwitchCase"],[3,"ngClass",4,"ngSwitchCase"],["class","spinner-three-bounce",3,"ngClass",4,"ngSwitchDefault"],[1,"spinner-circle",3,"ngClass","ngStyle"],[1,"sk-cube-grid",3,"ngClass"],[1,"sk-cube","sk-cube1",3,"ngStyle"],[1,"sk-cube","sk-cube2",3,"ngStyle"],[1,"sk-cube","sk-cube3",3,"ngStyle"],[1,"sk-cube","sk-cube4",3,"ngStyle"],[1,"sk-cube","sk-cube5",3,"ngStyle"],[1,"sk-cube","sk-cube6",3,"ngStyle"],[1,"sk-cube","sk-cube7",3,"ngStyle"],[1,"sk-cube","sk-cube8",3,"ngStyle"],[1,"sk-cube","sk-cube9",3,"ngStyle"],[1,"spinner-sk-rotateplane",3,"ngStyle","ngClass"],[1,"spinner-rectangle-bounce",3,"ngClass"],[1,"rect1",3,"ngStyle"],[1,"rect2",3,"ngStyle"],[1,"rect3",3,"ngStyle"],[1,"rect4",3,"ngStyle"],[1,"rect5",3,"ngStyle"],[1,"spinner-wandering-cubes",3,"ngClass"],[1,"cube1",3,"ngStyle"],[1,"cube2",3,"ngStyle"],[1,"spinner-double-bounce",3,"ngClass"],[1,"double-bounce1",3,"ngStyle"],[1,"double-bounce2",3,"ngStyle"],[1,"spinner-pulse",3,"ngClass","ngStyle"],[1,"spinner-chasing-dots",3,"ngClass"],[1,"dot1",3,"ngStyle"],[1,"dot2",3,"ngStyle"],[1,"spinner-circle-swish",3,"ngClass","ngStyle"],[3,"ngClass"],[1,"spinner-three-bounce",3,"ngClass"],[1,"bounce1",3,"ngStyle"],[1,"bounce2",3,"ngStyle"],[1,"bounce3",3,"ngStyle"],[4,"ngTemplateOutlet"]],template:function(s,t){s&1&&qt(0,m4,15,19,"div",0),s&2&&ze("ngIf",t.show)},dependencies:[Ko,$n,k1,M1,FE,LE,zE],styles:['.backdrop[_ngcontent-%COMP%]{z-index:1999;position:absolute;inset:0;background-color:#0000004d}.spinner-circle[_ngcontent-%COMP%], .spinner-circle[_ngcontent-%COMP%]:after{border-radius:50%;width:10em;height:10em}.spinner-circle[_ngcontent-%COMP%]{font-size:6px;border-top:1.1em solid rgba(255,255,255,.2);border-right:1.1em solid rgba(255,255,255,.2);border-bottom:1.1em solid rgba(255,255,255,.2);border-left:1.1em solid #ffffff;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:_ngcontent-%COMP%_load8 1.1s infinite linear;animation:_ngcontent-%COMP%_load8 1.1s infinite linear}@-webkit-keyframes _ngcontent-%COMP%_load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.spinner-circle-swish[_ngcontent-%COMP%]{font-size:60px;overflow:hidden;width:1em;height:1em;border-radius:50%;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:_ngcontent-%COMP%_load6 1.7s infinite ease;animation:_ngcontent-%COMP%_load6 1.7s infinite ease}@-webkit-keyframes _ngcontent-%COMP%_load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;-webkit-transform:rotate(0deg)}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}to{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;-webkit-transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;transform:rotate(0)}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}to{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;transform:rotate(360deg)}}.sk-cube-grid[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube[_ngcontent-%COMP%]{width:33%;height:33%;background-color:#333;float:left;-webkit-animation:_ngcontent-%COMP%_sk-cubeGridScaleDelay 1.3s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-cubeGridScaleDelay 1.3s infinite ease-in-out}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube1[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube2[_ngcontent-%COMP%]{-webkit-animation-delay:.3s;animation-delay:.3s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube3[_ngcontent-%COMP%]{-webkit-animation-delay:.4s;animation-delay:.4s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube4[_ngcontent-%COMP%]{-webkit-animation-delay:.1s;animation-delay:.1s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube5[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube6[_ngcontent-%COMP%]{-webkit-animation-delay:.3s;animation-delay:.3s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube7[_ngcontent-%COMP%]{-webkit-animation-delay:0s;animation-delay:0s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube8[_ngcontent-%COMP%]{-webkit-animation-delay:.1s;animation-delay:.1s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube9[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}@-webkit-keyframes _ngcontent-%COMP%_sk-cubeGridScaleDelay{0%,70%,to{-webkit-transform:scale3D(1,1,1);transform:scaleZ(1)}35%{-webkit-transform:scale3D(0,0,1);transform:scale3D(0,0,1)}}@keyframes _ngcontent-%COMP%_sk-cubeGridScaleDelay{0%,70%,to{-webkit-transform:scale3D(1,1,1);transform:scaleZ(1)}35%{-webkit-transform:scale3D(0,0,1);transform:scale3D(0,0,1)}}.spinner-double-bounce[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.double-bounce1[_ngcontent-%COMP%], .double-bounce2[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;background-color:#333;opacity:.6;position:absolute;top:0;left:0;-webkit-animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out}.double-bounce2[_ngcontent-%COMP%]{-webkit-animation-delay:-1s;animation-delay:-1s}.spinner-pulse[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#333;position:absolute;inset:0;margin:auto;z-index:2000;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-scaleout 1s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-scaleout 1s infinite ease-in-out}@-webkit-keyframes _ngcontent-%COMP%_sk-scaleout{0%{-webkit-transform:scale(0)}to{-webkit-transform:scale(1);opacity:0}}@keyframes _ngcontent-%COMP%_sk-scaleout{0%{-webkit-transform:scale(0);transform:scale(0)}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.spinner-three-bounce[_ngcontent-%COMP%]{width:70px;text-align:center;position:absolute;inset:0;height:20px;margin:auto;z-index:2000}.spinner-three-bounce[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:18px;height:18px;background-color:#fff;border-radius:100%;display:inline-block;-webkit-animation:_ngcontent-%COMP%_sk-bouncedelay 1.4s infinite ease-in-out both;animation:_ngcontent-%COMP%_sk-bouncedelay 1.4s infinite ease-in-out both}.spinner-three-bounce[_ngcontent-%COMP%]   .bounce1[_ngcontent-%COMP%]{-webkit-animation-delay:-.32s;animation-delay:-.32s}.spinner-three-bounce[_ngcontent-%COMP%]   .bounce2[_ngcontent-%COMP%]{-webkit-animation-delay:-.16s;animation-delay:-.16s}@-webkit-keyframes _ngcontent-%COMP%_sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0)}40%{-webkit-transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.spinner-sk-rotateplane[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#fff;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-animation:_ngcontent-%COMP%_sk-rotateplane 1.2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-rotateplane 1.2s infinite ease-in-out}@-webkit-keyframes _ngcontent-%COMP%_sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}to{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes _ngcontent-%COMP%_sk-rotateplane{0%{transform:perspective(120px) rotateX(0) rotateY(0);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}to{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}.spinner-rectangle-bounce[_ngcontent-%COMP%]{width:50px;height:40px;font-size:10px;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000}.spinner-rectangle-bounce[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background-color:#fff;height:100%;width:6px;display:inline-block;-webkit-animation:_ngcontent-%COMP%_sk-stretchdelay 1.2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-stretchdelay 1.2s infinite ease-in-out}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect2[_ngcontent-%COMP%]{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect3[_ngcontent-%COMP%]{-webkit-animation-delay:-1s;animation-delay:-1s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect4[_ngcontent-%COMP%]{-webkit-animation-delay:-.9s;animation-delay:-.9s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect5[_ngcontent-%COMP%]{-webkit-animation-delay:-.8s;animation-delay:-.8s}@-webkit-keyframes _ngcontent-%COMP%_sk-stretchdelay{0%,40%,to{-webkit-transform:scaleY(.4)}20%{-webkit-transform:scaleY(1)}}@keyframes _ngcontent-%COMP%_sk-stretchdelay{0%,40%,to{transform:scaleY(.4);-webkit-transform:scaleY(.4)}20%{transform:scaleY(1);-webkit-transform:scaleY(1)}}.spinner-wandering-cubes[_ngcontent-%COMP%]{width:60px;height:58px;font-size:10px;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000}.cube1[_ngcontent-%COMP%], .cube2[_ngcontent-%COMP%]{background-color:#fff;width:15px;height:15px;position:absolute;top:0;left:0;-webkit-animation:_ngcontent-%COMP%_sk-cubemove 1.8s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-cubemove 1.8s infinite ease-in-out}.cube2[_ngcontent-%COMP%]{-webkit-animation-delay:-.9s;animation-delay:-.9s}@-webkit-keyframes _ngcontent-%COMP%_sk-cubemove{25%{-webkit-transform:translateX(42px) rotate(-90deg) scale(.5)}50%{-webkit-transform:translateX(42px) translateY(42px) rotate(-180deg)}75%{-webkit-transform:translateX(0px) translateY(42px) rotate(-270deg) scale(.5)}to{-webkit-transform:rotate(-360deg)}}@keyframes _ngcontent-%COMP%_sk-cubemove{25%{transform:translate(42px) rotate(-90deg) scale(.5);-webkit-transform:translateX(42px) rotate(-90deg) scale(.5)}50%{transform:translate(42px) translateY(42px) rotate(-179deg);-webkit-transform:translateX(42px) translateY(42px) rotate(-179deg)}50.1%{transform:translate(42px) translateY(42px) rotate(-180deg);-webkit-transform:translateX(42px) translateY(42px) rotate(-180deg)}75%{transform:translate(0) translateY(42px) rotate(-270deg) scale(.5);-webkit-transform:translateX(0px) translateY(42px) rotate(-270deg) scale(.5)}to{transform:rotate(-360deg);-webkit-transform:rotate(-360deg)}}.sk-circle[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.sk-circle[_ngcontent-%COMP%]   .sk-child[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;left:0;top:0}.sk-circle[_ngcontent-%COMP%]   .sk-child[_ngcontent-%COMP%]:before{content:"";display:block;margin:0 auto;width:15%;height:15%;background-color:#333;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-circleBounceDelay 1.2s infinite ease-in-out both;animation:_ngcontent-%COMP%_sk-circleBounceDelay 1.2s infinite ease-in-out both}.sk-circle[_ngcontent-%COMP%]   .sk-circle2[_ngcontent-%COMP%]{-webkit-transform:rotate(30deg);-ms-transform:rotate(30deg);transform:rotate(30deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle3[_ngcontent-%COMP%]{-webkit-transform:rotate(60deg);-ms-transform:rotate(60deg);transform:rotate(60deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle4[_ngcontent-%COMP%]{-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle5[_ngcontent-%COMP%]{-webkit-transform:rotate(120deg);-ms-transform:rotate(120deg);transform:rotate(120deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle6[_ngcontent-%COMP%]{-webkit-transform:rotate(150deg);-ms-transform:rotate(150deg);transform:rotate(150deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle7[_ngcontent-%COMP%]{-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle8[_ngcontent-%COMP%]{-webkit-transform:rotate(210deg);-ms-transform:rotate(210deg);transform:rotate(210deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle9[_ngcontent-%COMP%]{-webkit-transform:rotate(240deg);-ms-transform:rotate(240deg);transform:rotate(240deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle10[_ngcontent-%COMP%]{-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle11[_ngcontent-%COMP%]{-webkit-transform:rotate(300deg);-ms-transform:rotate(300deg);transform:rotate(300deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle12[_ngcontent-%COMP%]{-webkit-transform:rotate(330deg);-ms-transform:rotate(330deg);transform:rotate(330deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle2[_ngcontent-%COMP%]:before{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.sk-circle[_ngcontent-%COMP%]   .sk-circle3[_ngcontent-%COMP%]:before{-webkit-animation-delay:-1s;animation-delay:-1s}.sk-circle[_ngcontent-%COMP%]   .sk-circle4[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.9s;animation-delay:-.9s}.sk-circle[_ngcontent-%COMP%]   .sk-circle5[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.8s;animation-delay:-.8s}.sk-circle[_ngcontent-%COMP%]   .sk-circle6[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.7s;animation-delay:-.7s}.sk-circle[_ngcontent-%COMP%]   .sk-circle7[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.6s;animation-delay:-.6s}.sk-circle[_ngcontent-%COMP%]   .sk-circle8[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.5s;animation-delay:-.5s}.sk-circle[_ngcontent-%COMP%]   .sk-circle9[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.4s;animation-delay:-.4s}.sk-circle[_ngcontent-%COMP%]   .sk-circle10[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.3s;animation-delay:-.3s}.sk-circle[_ngcontent-%COMP%]   .sk-circle11[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.2s;animation-delay:-.2s}.sk-circle[_ngcontent-%COMP%]   .sk-circle12[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.1s;animation-delay:-.1s}@-webkit-keyframes _ngcontent-%COMP%_sk-circleBounceDelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-circleBounceDelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.spinner-chasing-dots[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000;text-align:center;-webkit-animation:_ngcontent-%COMP%_sk-rotate 2s infinite linear;animation:_ngcontent-%COMP%_sk-rotate 2s infinite linear}.dot1[_ngcontent-%COMP%], .dot2[_ngcontent-%COMP%]{width:60%;height:60%;display:inline-block;position:absolute;top:0;background-color:#333;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out}.dot2[_ngcontent-%COMP%]{top:auto;bottom:0;-webkit-animation-delay:-1s;animation-delay:-1s}@-webkit-keyframes _ngcontent-%COMP%_sk-rotate{to{-webkit-transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_sk-rotate{to{transform:rotate(360deg);-webkit-transform:rotate(360deg)}}@-webkit-keyframes _ngcontent-%COMP%_sk-bounce{0%,to{-webkit-transform:scale(0)}50%{-webkit-transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-bounce{0%,to{transform:scale(0);-webkit-transform:scale(0)}50%{transform:scale(1);-webkit-transform:scale(1)}}.full-screen[_ngcontent-%COMP%]{position:fixed;position:-ms-page}']});let c=o;return c})(),AA=(()=>{let o=class o{static forRoot(r){return{ngModule:o,providers:[{provide:"loadingConfig",useValue:r}]}}};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[qc]});let c=o;return c})();var f4=c=>({disabled:c}),g4=()=>({backdropBorderRadius:"3px",backdropBackgroundColour:"rgba(0, 0, 0, 0.5)"});function _4(c,o){c&1&&(U(0,"div",16)(1,"p",17),X(2,"***Please enter a valid 10-digit phone number."),W()())}function b4(c,o){if(c&1&&Oe(0,"ngx-loading",15),c&2){let d=it();ze("show",d.loading)("config",Zp(2,g4))}}var PA=(()=>{let o=class o{constructor(r,s,t,g,w){this.router=r,this.fb=s,this.auth=t,this.http=g,this.logInService=w,this.loading=!1,this.showError=!1,this.myForm=this.fb.group({phoneNumber:[null,[Jo.required,Jo.pattern("^[0-9]{10}$")]]})}validate(){this.myForm.value.phoneNumber.length===10?this.showError=!1:this.showError=!0}login(){this.loading=!0,this.logInService.setLog(this.myForm.value.phoneNumber),this.loading=!1}};o.\u0275fac=function(s){return new(s||o)(_e(ii),_e(qa),_e(EA),_e(ji),_e(Br))},o.\u0275cmp=Et({type:o,selectors:[["app-log-in"]],decls:23,vars:7,consts:[[1,"container"],[1,"sub-container"],[1,"banner-div"],[1,"banner"],["src","./assets/logo/logo png1.png"],[3,"submit","input","formGroup"],[1,"phone-div"],[1,"num"],[1,"line"],["type","tel","formControlName","phoneNumber",1,"input-box"],["class","error",4,"ngIf"],[1,"otp-details"],[1,"material-symbols-outlined"],[1,"btn"],[3,"disabled","ngClass"],[3,"show","config"],[1,"error"],[1,"error-message",2,"color","red"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),Oe(4,"img",4),W()(),U(5,"form",5),Ne("submit",function(){return t.login()})("input",function(){return t.validate()}),U(6,"div",6)(7,"div")(8,"span",7),X(9,"+91"),W(),Oe(10,"span",8)(11,"input",9),W()(),qt(12,_4,3,0,"div",10),U(13,"div",11)(14,"span",12),X(15," info "),W(),U(16,"span"),X(17,"You will receive an OTP code from Task Tigers to confirm your number."),W()(),Oe(18,"br"),U(19,"div",13)(20,"button",14),X(21,"Get OTP"),W()()()()(),qt(22,b4,1,3,"ngx-loading",15)),s&2&&(le(5),ze("formGroup",t.myForm),le(7),ze("ngIf",t.showError),le(8),ze("disabled",!t.myForm.valid)("ngClass",wi(5,f4,!t.myForm.valid)),le(2),hr(22,t.loading?22:-1))},dependencies:[Ko,$n,va,ba,Kr,ya,Ga,Il,nf],styles:[".container[_ngcontent-%COMP%]{width:100vw;max-width:450px;height:100vh;display:flex;flex-direction:column;align-items:center;background:radial-gradient(circle at top left,rgba(250,239,221,1)300px,transparent 11px)}.sub-container[_ngcontent-%COMP%]{width:100%;position:relative;top:30%;display:grid;grid-gap:1.2rem;align-items:center}.banner-div[_ngcontent-%COMP%]{width:100%;display:flex;height:5rem;flex-direction:column;justify-content:center;align-items:center}.banner[_ngcontent-%COMP%]{width:90%;max-width:450px;height:26rem;background-size:cover;background-repeat:no-repeat;background-position:center;display:flex;flex-direction:column;justify-content:center;text-align:center}.banner[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.2rem}.phone-div[_ngcontent-%COMP%]{width:90%;align-items:start;border-radius:.5rem;height:3.5rem;border:1px solid rgba(0,0,0,1);position:relative;left:5%}.phone-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:flex;position:relative;top:30%;left:5%;font-size:1.3rem}.phone-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:26px;height:17px}.num[_ngcontent-%COMP%]{font-size:1.4rem}.line[_ngcontent-%COMP%]{margin-top:-.2rem;font-size:2.2rem}.input-box[_ngcontent-%COMP%]{float:left;margin-top:-.4rem;width:70%;height:2rem;outline:0;border-width:0 0 0;font-size:1.5rem}input[_ngcontent-%COMP%]{background-color:transparent}input[type=checkbox][_ngcontent-%COMP%]{accent-color:#D16611}.otp-details[_ngcontent-%COMP%]{background:#dee0e480;width:90%;height:5rem;text-align:center;border-radius:.5rem;display:flex;justify-content:space-around;align-items:center;gap:1rem;margin-left:5%}.otp-details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){margin-left:1rem}.otp-details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){margin-right:1rem}.update-div[_ngcontent-%COMP%]{width:80%;height:1.6rem;margin-left:5%;margin-top:.4rem;align-items:center;display:flex}.update-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;background-color:#d70d09}.update-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.1rem;font-family:inter;font-weight:400;line-height:1.4rem}.btn[_ngcontent-%COMP%]{width:90%;align-items:center;margin-left:5%}button[_ngcontent-%COMP%]{width:100%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}.disabled[_ngcontent-%COMP%]{background-color:#838180}.error[_ngcontent-%COMP%]{width:90%;margin-left:5%}"]});let c=o;return c})();var ea=(()=>{let o=class o{constructor(r,s,t){this.http=r,this.router=s,this.dialogService=t,this.providerRating=0,this.apiUrl=_n,this.userId=localStorage.getItem("provider"),this.isVerify=!1,this.checkingDetails=!1,this.items=[],this.selectedJob=[],this.userName="",this.workDetails=[],this.getServices()}setCheckingDetails(r){this.checkingDetails=r}getcheckingDetails(){return this.checkingDetails}selectedJobDetails(r){console.log(r),this.selectedJob=r}getSelectedJob(){return console.log(this.selectedJob),this.selectedJob}getUserDetails(r){let s=this.apiUrl+`providers/provider-auth/${r}`;return new ga(t=>{this.http.get(s).subscribe(g=>{console.log(g),console.log("response",g),this.isVerify=g.isVerified,this.userDetails=g,this.formatingResponse(this.userDetails),t.next(!1),t.complete()},g=>{console.log(g),g.error.message=="No items found for this user"?(console.log("not found"),t.next(!0)):(t.error(g),this.checkingDetails||(this.dialogService.openDialog("Please add the details uncomment me in job-details-service-117"),this.checkingDetails=!0)),t.complete()})})}getRating(){let r=localStorage.getItem("providerId");if(this.providerRating>0)return Ln(this.providerRating);{let s=`${this.apiUrl}users/user-feedback/provider/${r}`;return new ga(t=>{this.http.get(s).subscribe({next:g=>{console.log(g),this.providerRating=g,t.next(this.providerRating)},error:g=>{console.log(g)}})})}}formatingResponse(r){try{typeof r.work=="string"&&(this.workDetails=r.work);let t=r.work;this.workDetails=t,console.log(this.workDetails)}catch(s){console.error("Error processing response.work",s)}}flattenArray(r){return r.reduce((s,t)=>Array.isArray(t)?s.concat(this.flattenArray(t)):s.concat(t),[])}getServices(){let r=this.apiUrl+"core/categories";this.http.get(r).subscribe(s=>{console.log(s),this.formattingServices(s)},s=>{console.log(s)})}formattingServices(r){r.forEach(s=>{this.items.push({id:s._id,names:s.name,checked:!1,image:s.imageKey})})}getAvailability(){let r=this.apiUrl+`providers/provider-date/${localStorage.getItem("providerId")}`;return this.http.get(r)}setDefault(){this.items=[],this.selectedJob=[],this.userDetails="",this.userName=""}};o.\u0275fac=function(s){return new(s||o)(wt(ji),wt(ii),wt(mr))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var y4=["input1"],v4=["input2"],x4=["input3"],w4=["input4"];function C4(c,o){if(c&1){let d=ai();Oe(0,"br"),U(1,"button",16),Ne("click",function(){St(d);let s=it();return It(s.resend())}),X(2,"Resend Code"),W()}}function S4(c,o){if(c&1&&(Oe(0,"br"),U(1,"div",17)(2,"p"),X(3),W()()),c&2){let d=it();le(3),ss("",d.minutes," : ",d.seconds,"")}}var OA=(()=>{let o=class o{constructor(r,s,t,g,w,M,F,N){this.form=r,this.logInService=s,this.jobDetailsService=t,this.loginServices=g,this.router=w,this.userDetailsService=M,this.dialogeService=F,this.http=N,this.apiUrl=_n,this.userNumber=0,this.resendToggling="resend",this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}ngOnInit(){this.userNumber=this.logInService.userNumber,this.logInService.showOtp()}onInput(r,s){if(r.target.value.length===1)switch(s){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}s===4&&this.login()}onKeyDown(r,s){console.log("called",r,s);let t=r.target;if(console.log("input :",t.value),console.log(s==1),r.key==="Backspace"&&!t.value&&s>1){let g=s-1;if(console.log("previous input",`#input${s-1}`),g)switch(g){case 3:this.input3.nativeElement.focus();break;case 2:this.input2.nativeElement.focus();break;case 1:this.input1.nativeElement.focus();break;default:console.log("something went wrong")}}}login(){return zr(this,null,function*(){let r=this.otp.value,s=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log("OTP:",this.otp.value),this.logInService.verifyOtp(s).subscribe(t=>zr(this,null,function*(){console.log("log in done",t),console.log(t.providerId),yield this.logInService.setUser(t.providerId),this.storeUserData(),yield this.chekingUser()}),t=>{console.log("error",t),alert(t.error.message)})})}storeUserData(){}resend(){this.logInService.resendOtp(),this.resendToggling="countdown",this.startCountdown()}startCountdown(){let r=120;this.updateDisplay(r),this.countdownInterval=setInterval(()=>{r-=1,r<=0?(this.stopCountdown(),this.resendToggling="resend"):this.updateDisplay(r)},1e3)}stopCountdown(){clearInterval(this.countdownInterval)}ngOnDestroy(){this.stopCountdown()}updateDisplay(r){this.minutes=Math.floor(r/60),this.seconds=r%60}chekingUser(){return zr(this,null,function*(){let r=localStorage.getItem("providerId"),s=`${this.apiUrl}providers/provider-details/${r}`;this.http.get(s).subscribe(t=>{console.log("response",t),console.log(t.providerName),this.logInService.alreadyHasAccount=!0,this.navTo()},t=>{console.log(t),this.dialogeService.openDialog("Please add your Details"),this.router.navigate(["aboutUser"])})})}navTo(){let r=localStorage.getItem("providerId"),s=this.logInService.getAddress().pipe(Ro(M=>(console.error("address",M),Ln("not found")))),t=this.userDetailsService.getUserDetails(r).pipe(Ro(M=>(console.error("details",M),Ln("not found")))),g=this.userDetailsService.getWork(localStorage.getItem("providerId")).pipe(Ro(M=>(console.error("work",M),Ln("not found")))),w=this.http.get(`${_n}providers/provider-watched-video/${r}`).pipe(Ro(M=>(console.error("training",M),Ln("not found"))));u0([t,s,g,w]).subscribe(([M,F,N,Q])=>{console.log("API 1 Response:",M),console.log("API 2 Response:",F),console.log("API 3 Response:",N),console.log("API 4 Response:",Q);let ae=[{condition:M.provider.firstName?M:"not found",message:"Please complete your registration",route:"aboutUser"},{condition:F,message:"Please complete your registration",route:"addAddress"},{condition:N,message:"Please provide your address",route:"selectWork"},{condition:Q,message:"Please complete your training",route:"induction"}];for(let pe of ae)if(pe.condition==="not found"){this.dialogeService.openDialog(pe.message),this.router.navigate([pe.route]);break}ae.every(pe=>!pe.condition)&&this.router.navigate(["home"])},M=>{console.error("Error in combining responses",M)})}};o.\u0275fac=function(s){return new(s||o)(_e(qa),_e(Br),_e(ea),_e(Br),_e(ii),_e(nr),_e(mr),_e(ji))},o.\u0275cmp=Et({type:o,selectors:[["app-verify"]],viewQuery:function(s,t){if(s&1&&(Vi(y4,5),Vi(v4,5),Vi(x4,5),Vi(w4,5)),s&2){let g;zi(g=Bi())&&(t.input1=g.first),zi(g=Bi())&&(t.input2=g.first),zi(g=Bi())&&(t.input3=g.first),zi(g=Bi())&&(t.input4=g.first)}},decls:25,vars:3,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"info-text"],[1,"info-text2"],[3,"ngSubmit","formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputTwo",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputThree",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputFour",3,"input","keydown"],[1,"resend-div"],[1,"resend",3,"click"],[1,"resend"]],template:function(s,t){if(s&1){let g=ai();U(0,"div",4)(1,"div",5)(2,"span",6),X(3,"Verify your phone number "),W(),Oe(4,"br"),U(5,"span",7),X(6,"Please enter the code we just send to"),W(),U(7,"p",8),X(8),W(),Oe(9,"br"),U(10,"form",9),Ne("ngSubmit",function(){return St(g),It(t.login())}),U(11,"div",10)(12,"input",11,0),Ne("input",function(M){return St(g),It(t.onInput(M,1))})("keydown",function(M){return St(g),It(t.onKeyDown(M,1))}),W(),U(14,"input",12,1),Ne("input",function(M){return St(g),It(t.onInput(M,2))})("keydown",function(M){return St(g),It(t.onKeyDown(M,2))}),W(),U(16,"input",13,2),Ne("input",function(M){return St(g),It(t.onInput(M,3))})("keydown",function(M){return St(g),It(t.onKeyDown(M,3))}),W(),U(18,"input",14,3),Ne("input",function(M){return St(g),It(t.onInput(M,4))})("keydown",function(M){return St(g),It(t.onKeyDown(M,4))}),W()(),U(20,"div",15)(21,"span"),X(22,"Did not received the OTP? "),qt(23,C4,3,0)(24,S4,4,2),W()()()()()}if(s&2){let g;le(8),Ni("+91 ",t.userNumber,""),le(2),ze("formGroup",t.otp),le(13),hr(23,(g=t.resendToggling)==="resend"?23:g==="countdown"?24:-1)}},dependencies:[va,ba,Kr,ya,_0,Ga,Il],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;text-align:center;align-items:center}.sub-container[_ngcontent-%COMP%]{position:relative;top:10%}.tittle[_ngcontent-%COMP%]{font-family:Poppins;font-size:22px;font-weight:400;line-height:28px;text-align:center;text-underline-position:from-font;text-decoration-skip-ink:none}.info-text[_ngcontent-%COMP%], .info-text2[_ngcontent-%COMP%]{font-family:Poppins;font-size:16px;font-weight:400;line-height:28px;text-align:left;text-underline-position:from-font;text-decoration-skip-ink:none;color:#777}.info-text2[_ngcontent-%COMP%]{color:#1b2431;font-weight:500;text-align:center}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:0 0 0 1.5px #807e7e80;font-size:2.5rem;font-weight:300;align-items:center}.resend-div[_ngcontent-%COMP%]{margin-top:3rem;margin-left:5%;width:90%;height:4rem;display:grid;align-items:center;row-gap:0;text-align:left}.resend-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer;font-size:1.1rem;font-family:Roboto,sans-serif;font-weight:400;color:#000}.resend[_ngcontent-%COMP%]{margin-top:1rem;width:max-content;border-radius:.8rem;border:.25px solid black;padding:.8rem 1.5rem;font-family:Basis Grotesque Pro;font-size:1rem;font-weight:700;line-height:18.2px;letter-spacing:-.03em;text-align:center;text-underline-position:from-font;text-decoration-skip-ink:none;background-color:transparent}.resend[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#000}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}@media screen and (min-width: 600px){.container[_ngcontent-%COMP%]{align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:30%;border:1px solid black;position:relative;left:35%}}"]});let c=o;return c})();var I4=()=>({backdropBorderRadius:"3px",backdropBackgroundColour:"rgba(0, 0, 0, 0.5)"});function T4(c,o){c&1&&(U(0,"span"),X(1,"Select options"),W())}function M4(c,o){if(c&1&&(U(0,"span"),X(1),W()),c&2){let d=it();le(),Xt(d.selectedItems.join(", "))}}function k4(c,o){if(c&1){let d=ai();U(0,"div",32)(1,"label")(2,"input",33),Ne("change",function(){let s=St(d).$implicit,t=it(2);return It(t.onSelect(s))}),W(),X(3),W()()}if(c&2){let d=o.$implicit,r=it(2);le(2),ze("checked",r.isSelected(d)),le(),Ni(" ",d," ")}}function E4(c,o){if(c&1){let d=ai();U(0,"div",29),qt(1,k4,4,2,"div",30),U(2,"button",31),Ne("click",function(){St(d);let s=it();return It(s.closeDropdown())}),X(3,"save"),W()()}if(c&2){let d=it();le(),ze("ngForOf",d.language)}}function D4(c,o){if(c&1&&(U(0,"div",28),Oe(1,"ngx-loading",34),W()),c&2){let d=it();le(),ze("show",d.loading)("config",Zp(2,I4))}}var RA=(()=>{let o=class o{constructor(r,s,t,g,w,M){this.fb=r,this.router=s,this.location=t,this.loginService=g,this.userDetailsService=w,this.dailougeBoxService=M,this.selectedFile=null,this.imagePreview=null,this.loading=!1,this.workAdded=!0,this.language=["Telugu","Hindi","English","Tamil","urudu","marati","kanada"],this.options=["Male","Female","Others"],this.selectedItems=[],this.dropdownOpen=!1,this.aboutProvider=this.fb.group({userId:localStorage.getItem("providerId"),firstName:["",Jo.required],surname:["",Jo.required],gender:["",Jo.required],DOB:[""],phoneNumber:[""],whatsapp:[""],age:[this.loginService.age,Jo.required],launguage:this.selectedItems[0],email:[""]}),console.log("inform",this.aboutProvider.value.work),this.selectedWork=this.loginService.workDetails.flatMap(F=>F.flatMap(N=>N.nameOfService)).join(", ")}ngOnInit(){this.getNumber(),this.getWork()}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r),r.works.length>0&&(this.workAdded=!1)},error:r=>{console.log(r)}})}getNumber(){return zr(this,null,function*(){let r=this.loginService.getPhoneNumber();console.log(r),this.userNumber=yield this.loginService.userNumber,console.log(this.userNumber)})}flattenWorkDetails(r){return r.flatMap(s=>s.flatMap(t=>t.nameOfService))}onFileSelected(r){let s=r.target;if(s.files&&s.files.length>0){this.selectedFile=s.files[0];let t=new FileReader;t.onload=()=>{this.imagePreview=t.result},t.readAsDataURL(this.selectedFile)}}navTo(){this.router.navigate(["selectWork"])}submit(){this.loading=!0;let r=new FormData;r.append("firstName",this.aboutProvider.value.firstName),r.append("surName",this.aboutProvider.value.surname),r.append("launguage",this.aboutProvider.value.launguage),r.append("gender",this.aboutProvider.value.gender),r.append("gmail",this.aboutProvider.value.email),r.append("dateOfBirth",this.aboutProvider.value.DOB),r.append("primaryMobile",this.aboutProvider.value.phoneNumber),r.append("whatsappNumber",this.aboutProvider.value.whatsapp),r.forEach((s,t)=>{console.log(`${t}: ${s}`)}),this.loginService.UserDetails(r).subscribe({next:s=>{this.loading=!1,this.dailougeBoxService.openDialog("Details are uploaded sucessfully")},error:s=>{this.loading=!1}})}navToBack(){console.log("back"),this.location.back()}toggleDropdown(){this.dropdownOpen=!this.dropdownOpen}closeDropdown(){this.dropdownOpen=!1}isSelected(r){return this.selectedItems.includes(r)}onSelect(r){this.isSelected(r)?this.selectedItems=this.selectedItems.filter(s=>s!==r):this.selectedItems.push(r),console.log(this.selectedItems)}};o.\u0275fac=function(s){return new(s||o)(_e(qa),_e(ii),_e(yi),_e(Br),_e(nr),_e(mr))},o.\u0275cmp=Et({type:o,selectors:[["app-about-user"]],decls:58,vars:5,consts:[[1,"container"],[1,"sub-container"],[3,"formGroup"],[1,"form-div"],["for","name"],["type","text","placeholder","First Name","formControlName","firstName","id","names","required",""],["type","text","placeholder","Surname","formControlName","surname","id","names","required",""],["for","gender"],["for","gender","formControlName","gender"],["value","","disabled","","selected",""],["value","Male"],["value","Female"],["value","Others"],["for","DOB"],["type","date","placeholder","DOB","formControlName","DOB","id","DOB","required",""],["for","phoneNumber"],["type","number","formControlName","phoneNumber","required","","placeholder","phoneNumber"],["for","whatsapp"],["type","number","formControlName","whatsapp","required","","placeholder","whatsapp"],["for","email"],["type","email","placeholder","email","formControlName","email","id","email","required",""],[1,"ng-selects"],[1,"dropdown",3,"clickOutside"],[1,"dropdown-toggle",3,"click"],[4,"ngIf"],[1,"caret"],["class","dropdown-menu",4,"ngIf"],["type","submit",1,"login-btn",3,"click"],[1,"loading-div"],[1,"dropdown-menu"],["class","dropdown-item",4,"ngFor","ngForOf"],[3,"click"],[1,"dropdown-item"],["type","checkbox",3,"change","checked"],[3,"show","config"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"form",2)(3,"div",3)(4,"div")(5,"label",4),X(6,"First Name"),W(),Oe(7,"br")(8,"input",5),W(),U(9,"div")(10,"label",4),X(11,"Surname"),W(),Oe(12,"br")(13,"input",6),W(),U(14,"div")(15,"label",7),X(16,"Select your Gender"),W(),Oe(17,"br"),U(18,"select",8)(19,"option",9),X(20,"Select"),W(),U(21,"option",10),X(22,"Male"),W(),U(23,"option",11),X(24,"Female"),W(),U(25,"option",12),X(26,"Others"),W()()(),U(27,"div")(28,"label",13),X(29,"Date of Birth"),W(),Oe(30,"br")(31,"input",14),W(),U(32,"div")(33,"label",15),X(34," Phone number "),W(),Oe(35,"br")(36,"input",16),W(),U(37,"div")(38,"label",17),X(39," Whatsapp number (Optional) "),W(),Oe(40,"br")(41,"input",18),W(),U(42,"div")(43,"label",19),X(44,"Email (Optional)"),W(),Oe(45,"br")(46,"input",20),W(),U(47,"div",21)(48,"div",22),Ne("clickOutside",function(){return t.closeDropdown()}),U(49,"div",23),Ne("click",function(){return t.toggleDropdown()}),qt(50,T4,2,0,"span",24)(51,M4,2,1,"span",24),Oe(52,"span",25),W(),qt(53,E4,4,1,"div",26),W()(),U(54,"button",27),Ne("click",function(){return t.submit()}),X(55,"Continue"),W()()()()(),Oe(56,"br"),qt(57,D4,2,3,"div",28)),s&2&&(le(2),ze("formGroup",t.aboutProvider),le(48),ze("ngIf",!t.selectedItems.length),le(),ze("ngIf",t.selectedItems.length),le(2),ze("ngIf",t.dropdownOpen),le(4),hr(57,t.loading?57:-1))},dependencies:[Io,$n,va,GE,qE,ba,g0,HE,Kr,ya,$E,Ga,Il,nf],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;top:10%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.form-div[_ngcontent-%COMP%]{width:100%;display:grid;grid-gap:1rem;text-align:left}.form-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:grid;text-align:left}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;height:3rem;border:1px solid black;border-radius:.8rem;font-size:1rem;outline:none}input[_ngcontent-%COMP%]::placeholder{padding-left:.5rem}label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:400;font-family:inter;line-height:19px}#providerType[_ngcontent-%COMP%]   option[value=""][disabled][_ngcontent-%COMP%]{display:none}.file-input-container[_ngcontent-%COMP%]{position:relative;width:200px;height:200px;border:.25px solid #ccc;display:flex;align-items:center;justify-content:center;border-radius:.5rem}.file-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:60%;cursor:pointer;position:relative}.placeholder-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.preview-image[_ngcontent-%COMP%]{width:10rem;height:8rem}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.image-label[_ngcontent-%COMP%]{float:left;text-align:left}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:100%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;margin-bottom:3rem}.loading-div[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:1000;overflow-y:auto}.dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block;width:200px;border:1px solid #ccc;border-radius:4px;cursor:pointer}.dropdown-toggle[_ngcontent-%COMP%]{background-color:#fff;border-radius:4px}.dropdown-toggle[_ngcontent-%COMP%]   .caret[_ngcontent-%COMP%]{float:right}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;width:100%;background-color:#fff;border:1px solid #ccc;border-radius:4px;box-shadow:0 2px 4px #0000001a;z-index:1000}.dropdown-item[_ngcontent-%COMP%]{padding:8px 12px}.dropdown-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:pointer}.dropdown-item[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.dropdown-item[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}']});let c=o;return c})();var FA=(()=>{let o=class o{constructor(r){this.router=r,this.currentUrl=this.router.url,this.router.events.pipe(oc(s=>s instanceof R1),NS()).subscribe(s=>{this.previousUrl=s[0].url,this.currentUrl=s[1].url})}getPreviousUrl(){return this.previousUrl}};o.\u0275fac=function(s){return new(s||o)(wt(ii))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();function P4(c,o){if(c&1){let d=ai();U(0,"div",9)(1,"div",11),Ne("click",function(){let s=St(d).$implicit,t=it();return It(t.selectedCat(s))}),Oe(2,"img",12),X(3),W(),U(4,"div")(5,"input",13),Qo("ngModelChange",function(s){let t=St(d).$implicit;return Xo(t.checked,s)||(t.checked=s),It(s)}),Ne("change",function(s){let t=St(d).$implicit,g=it();return It(g.onChange(s,t))}),W()()()}if(c&2){let d=o.$implicit;le(2),ze("src",d.image,vr),le(),Ni(" ",d.names,""),le(2),Zo("ngModel",d.checked)}}var LA=(()=>{let o=class o{ngOnInit(){this.previousUrl=this.routeTrackingService.getPreviousUrl(),this.items=this.jobDetails.items,this.getWork(),console.log(this.items)}constructor(r,s,t,g,w,M){this.router=r,this.logInservice=s,this.jobDetails=t,this.routeTrackingService=g,this.userDetailsService=w,this.dialogeService=M,this.searchQuery="",this.workSeleceted=[],this.items=[],this.workForSending=[]}onInputChange(r){console.log(this.searchQuery);let s=this.jobDetails.items.filter(t=>t.names.toLowerCase().includes(this.searchQuery.toLowerCase()));console.log(s),this.items=s}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works,this.autoCheckServices()},r=>{console.log(r)})}onChange(r,s){let t=r.target;if(t){let g=t.checked;if(g){let w=this.items.indexOf(s);this.jobDetails.items[w].checked=!0,console.log("Item checked:",this.items.indexOf(s)),console.log("Item checked:",s.names),console.log("categoryId",s.id),this.logInservice.categoryId=s.id,this.logInservice.setWork(s.names,s.id)}g||(console.log(this.logInservice.workId),console.log(s.id),this.logInservice.workId=this.logInservice.workId.filter(w=>w!==s.id),s.checked=!1,console.log(this.logInservice.workId))}}selectedCat(r){console.log("clciked");let s=this.items.indexOf(r);this.jobDetails.items[s].checked=!0,console.log("Item checked:",this.items.indexOf(r)),console.log("Item checked:",r.names),console.log("categoryId",r.id),this.logInservice.categoryId=r.id,this.logInservice.setWork(r.names,r.id)}selectAll(r){let s=r.target;s.checked&&this.items.map(t=>{this.logInservice.categoryId=t.id,this.logInservice.setWork(t.names,t.id),t.checked=!0}),s.checked||(this.logInservice.categoryId=[],this.logInservice.workId=[],this.items.map(t=>{t.checked=!0}))}autoCheckServices(){this.workSeleceted.forEach(r=>{let s=this.items.find(t=>t.names===r.categoryId.name);console.log(s),s&&s&&(s.checked=!0)})}send(){this.router.navigate(["subServices"])}UpdatingUserWork(r){console.log(r);let s=this.userDetailsService.workResponseId;console.log("work before",this.userDetailsService.workResponse),console.log("id before",s),this.workForSending.push(this.userDetailsService.workResponse),this.workForSending.push(r),console.log(this.workForSending.flat()),this.logInservice.updateUserWork(this.workForSending.flat(),s)}};o.\u0275fac=function(s){return new(s||o)(_e(ii),_e(Br),_e(ea),_e(FA),_e(nr),_e(mr))},o.\u0275cmp=Et({type:o,selectors:[["app-select-work"]],decls:20,vars:2,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"search-container"],["type","text","placeholder","Search for Service",1,"search-input",3,"ngModelChange","input","ngModel"],[1,"material-symbols-outlined","notranslate",3,"hidden"],[1,"serivce"],[1,"tittle2"],["type","checkbox",3,"change"],[1,"service-div"],["type","submit",1,"login-btn",3,"click"],[1,"names",3,"click"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),X(3,"what work do you do?"),W(),Oe(4,"br"),U(5,"div",3)(6,"input",4),Qo("ngModelChange",function(w){return Xo(t.searchQuery,w)||(t.searchQuery=w),w}),Ne("input",function(w){return t.onInputChange(w)}),W(),U(7,"span",5),X(8,"search"),W()(),U(9,"div",6)(10,"span",7),X(11,"All categories"),W(),U(12,"span")(13,"input",8),Ne("change",function(w){return t.selectAll(w)}),W(),X(14,"Select All"),W(),Oe(15,"br"),no(16,P4,6,3,"div",9,Yo),W()(),U(18,"button",10),Ne("click",function(){return t.send()}),X(19,"Continue"),W()()),s&2&&(le(6),Zo("ngModel",t.searchQuery),le(),ze("hidden",t.searchQuery),le(9),ro(t.items))},dependencies:[ba,sh,Kr,Sl],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-container[_ngcontent-%COMP%]{position:relative}.search-container[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{padding-right:30px;width:70%;height:2.5rem;border-radius:.8rem;font-size:1.5rem}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.search-container[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{position:absolute;top:50%;left:7%;transform:translateY(-50%);cursor:pointer;pointer-events:none;font-size:32px;margin:0}.tittle2[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:500;line-height:24px;display:flex;align-items:start}.serivce[_ngcontent-%COMP%]{height:70vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.7rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:3rem;height:3rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let c=o;return c})();var zA=(()=>{let o=class o{constructor(r,s,t){this.router=r,this.dialogeService=s,this.loginService=t,this.selectedExperiance="",this.selectedAge="",this.workSelected=this.loginService.workName,this.selectedCheckbox=null}sendResponse(){console.log(this.selectedAge,this.selectedExperiance)}expSelected(r){this.selectedExperiance===r?this.selectedExperiance=null:this.selectedExperiance=r,console.log(this.selectedExperiance),this.selectedExperiance==="yes"?this.router.navigate(["workExperiance"]):(this.loginService.setExperiance("0"),this.loginService.setWorkDetails())}onCheckboxChange(r){this.selectedAge===r?this.selectedAge=null:this.selectedAge=r,console.log("Selected Checkbox:",this.selectedAge),this.loginService.setAge(this.selectedAge)}};o.\u0275fac=function(s){return new(s||o)(_e(ii),_e(mr),_e(Br))},o.\u0275cmp=Et({type:o,selectors:[["app-about-work"]],decls:44,vars:6,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["type","checkbox",3,"change","checked"],[2,"padding","0.5rem"],[1,"select-div"],[1,"conditions"],["type","checkbox"],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),X(3,"Tell us about your work!"),W(),Oe(4,"br")(5,"br"),U(6,"div",3)(7,"pre"),X(8,"What is your age?"),W(),Oe(9,"hr"),U(10,"div")(11,"span"),X(12,"16 - 18"),W(),U(13,"input",4),Ne("change",function(){return t.onCheckboxChange("16-18")}),W()(),Oe(14,"hr"),U(15,"div")(16,"span"),X(17,"18 - 40"),W(),U(18,"input",4),Ne("change",function(){return t.onCheckboxChange("18-40")}),W()(),Oe(19,"hr"),U(20,"div")(21,"span"),X(22,"More than 40"),W(),U(23,"input",4),Ne("change",function(){return t.onCheckboxChange("more than 40")}),W()()(),U(24,"div",3)(25,"p",5),X(26),W(),Oe(27,"hr"),U(28,"div",6)(29,"span"),X(30,"Yes"),W(),U(31,"input",4),Ne("change",function(){return t.expSelected("yes")}),W()(),Oe(32,"hr"),U(33,"div")(34,"span"),X(35,"No"),W(),U(36,"input",4),Ne("change",function(){return t.expSelected("no")}),W()()(),U(37,"div",7),Oe(38,"input",8),X(39," \xA0 Agree with Terms & conditions"),W(),Oe(40,"br")(41,"br"),U(42,"button",9),Ne("click",function(){return t.sendResponse()}),X(43,"Continue"),W()()()),s&2&&(le(13),ze("checked",t.selectedAge==="16-18"),le(5),ze("checked",t.selectedAge==="18-40"),le(5),ze("checked",t.selectedAge==="more than 40"),le(3),Ni("Do you have any experience in ",t.workSelected," services?"),le(5),ze("checked",t.selectedExperiance==="yes"),le(5),ze("checked",t.selectedExperiance==="no"))},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content;border:1px solid black;margin-bottom:5%;border-radius:1rem}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5%;display:flex;justify-content:space-between}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:95%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611}.conditions[_ngcontent-%COMP%]{width:max-content;font-size:1.2rem;font-family:inter,sans-serif;font-weight:400;line-height:1.4rem;float:left;display:flex;justify-content:space-around}.conditions[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}.sub-div1[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1rem}"]});let c=o;return c})();var BA=(()=>{let o=class o{constructor(r,s,t){this.logInservice=r,this.router=s,this.dialogeService=t,this.experiance=""}onCheckboxChange(r){this.experiance===r?this.experiance=null:this.experiance=r,console.log("Selected Checkbox:",this.experiance)}sendResponse(){this.logInservice.setExperiance(this.experiance),this.logInservice.setWorkDetails()}};o.\u0275fac=function(s){return new(s||o)(_e(Br),_e(ii),_e(mr))},o.\u0275cmp=Et({type:o,selectors:[["app-work-experiance"]],decls:30,vars:4,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["type","checkbox",3,"change","checked"],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),X(3,"Tell us about your work!"),W(),Oe(4,"br")(5,"br"),U(6,"div",3)(7,"div")(8,"span"),X(9,"0-1 Years"),W(),U(10,"input",4),Ne("change",function(){return t.onCheckboxChange("0-1")}),W()(),Oe(11,"hr"),U(12,"div")(13,"span"),X(14,"2-4 Years"),W(),U(15,"input",4),Ne("change",function(){return t.onCheckboxChange("2-4")}),W()(),Oe(16,"hr"),U(17,"div")(18,"span"),X(19,"3-5 Years"),W(),U(20,"input",4),Ne("change",function(){return t.onCheckboxChange("3-5")}),W()(),Oe(21,"hr"),U(22,"div")(23,"span"),X(24,"More than 5 Years"),W(),U(25,"input",4),Ne("change",function(){return t.onCheckboxChange("more than 5")}),W()()()(),Oe(26,"br")(27,"br"),U(28,"button",5),Ne("click",function(){return t.sendResponse()}),X(29,"Continue"),W()()),s&2&&(le(10),ze("checked",t.experiance==="0-1"),le(5),ze("checked",t.experiance==="2-4"),le(5),ze("checked",t.experiance==="3-5"),le(5),ze("checked",t.experiance==="moreThan5"))},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content;border:1px solid black;margin-bottom:5%;border-radius:1rem}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5%;display:flex;justify-content:space-between}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:95%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611}"]});let c=o;return c})();var NA=(()=>{let o=class o{constructor(r){this.router=r}verify(){console.log("inside"),this.router.navigate(["pancard"])}};o.\u0275fac=function(s){return new(s||o)(_e(ii))},o.\u0275cmp=Et({type:o,selectors:[["app-aadhar-verification"]],decls:24,vars:0,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["for","name"],["type","number","placeholder","name","id","names","required",""],["type","number","placeholder","OTP","id","names","required",""],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),X(3,"Lets Get the Documentation Done....!!"),W(),Oe(4,"br")(5,"br"),U(6,"div",3)(7,"div")(8,"label",4),X(9,"Adhar Number"),W(),Oe(10,"br")(11,"input",5),W(),Oe(12,"br"),U(13,"button"),X(14,"Verify"),W(),U(15,"div")(16,"label",4),X(17,"OTP"),W(),Oe(18,"br")(19,"input",6),W()(),U(20,"button",7),Ne("click",function(){return t.verify()}),X(21,"Verify"),W()(),Oe(22,"br")(23,"br"),W())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.6rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:grid;text-align:left}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;height:3rem;border:1px solid black;border-radius:.8rem;font-size:1rem}input[_ngcontent-%COMP%]::placeholder{padding-left:.5rem}label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:400;font-family:inter,sans-serif;line-height:19px}.sub-div1[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:4rem;height:1.4rem;background-color:#d16611;color:#fff;font-size:.8rem;font-family:inter;float:right;border:none;border-radius:.4rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}"]});let c=o;return c})();function O4(c,o){c&1&&(U(0,"p"),X(1,"Front side photo of your Aadhar card with your clear name and photo"),W())}function R4(c,o){c&1&&(U(0,"label",18)(1,"span",19),X(2,"\u{1F4F7}"),W(),X(3," Upload Photo "),W())}function F4(c,o){if(c&1){let d=ai();U(0,"input",20),Ne("change",function(s){St(d);let t=it();return It(t.onFileSelect(s,"aadharFront"))}),W()}}function L4(c,o){if(c&1&&Oe(0,"img",21),c&2){let d=it();ze("src",d.previews.aadharFront,vr)}}function z4(c,o){c&1&&(U(0,"p"),X(1,"Back side photo of your Aadhar card"),W())}function B4(c,o){c&1&&(U(0,"label",22)(1,"span",19),X(2,"\u{1F4F7}"),W(),X(3," Upload Photo "),W())}function N4(c,o){if(c&1&&Oe(0,"img",23),c&2){let d=it();ze("src",d.previews.aadharBack,vr)}}function V4(c,o){c&1&&(U(0,"p"),X(1,"Front side photo of your Pan card with your clear photo"),W())}function j4(c,o){c&1&&(U(0,"label",22)(1,"span",19),X(2,"\u{1F4F7}"),W(),X(3," Upload Photo "),W())}function U4(c,o){if(c&1&&Oe(0,"img",24),c&2){let d=it();ze("src",d.previews.panCard,vr)}}var VA=(()=>{let o=class o{constructor(r,s,t){this.fb=r,this.http=s,this.location=t,this.previews={aadharFront:null,aadharBack:null,panCard:null},this.documentForm=this.fb.group({aadharFront:[null],aadharBack:[null],panCard:[null]})}onFileSelect(r,s){let t=r.target;if(t.files&&t.files[0]){let g=t.files[0];this.documentForm.patchValue({[s]:g});let w=new FileReader;w.onload=()=>{this.previews[s]=w.result},w.readAsDataURL(g)}}onSubmit(){if(this.documentForm.valid){let r=new FormData;for(let s in this.documentForm.value)r.append(s,this.documentForm.value[s]);this.http.post("https://your-backend-url.com/upload",r).subscribe(s=>{console.log("Upload successful",s)})}}navTo(){this.location.back()}};o.\u0275fac=function(s){return new(s||o)(_e(qa),_e(ji),_e(yi))},o.\u0275cmp=Et({type:o,selectors:[["app-pancard"]],decls:35,vars:11,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[3,"ngSubmit","formGroup"],[1,"section"],[1,"upload-box"],[4,"ngIf"],["for","aadharFrontInput","class","upload-button",4,"ngIf"],["type","file","id","aadharFrontInput","class","file-input",3,"change",4,"ngIf"],["alt","Aadhar Front Preview","class","preview-image",3,"src",4,"ngIf"],["for","fileInput","class","upload-button",4,"ngIf"],["type","file","id","fileInput",1,"upload-button",3,"change"],["type","file"],["alt","Aadhar Back Preview","class","preview-image",3,"src",4,"ngIf"],["alt","Pan Card Preview","class","preview-image",3,"src",4,"ngIf"],[1,"submit-btn"],["type","submit",1,"submit-btn"],["for","aadharFrontInput",1,"upload-button"],[1,"icon"],["type","file","id","aadharFrontInput",1,"file-input",3,"change"],["alt","Aadhar Front Preview",1,"preview-image",3,"src"],["for","fileInput",1,"upload-button"],["alt","Aadhar Back Preview",1,"preview-image",3,"src"],["alt","Pan Card Preview",1,"preview-image",3,"src"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),Ne("click",function(){return t.navTo()}),X(3,"arrow_back"),W(),X(4,"\xA0 "),U(5,"span",3),X(6,"Document\u2019s Verification"),W()(),U(7,"form",4),Ne("ngSubmit",function(){return t.onSubmit()}),U(8,"section",5)(9,"h2"),X(10,"Aadhar card details"),W(),U(11,"p"),X(12,"Upload focused photo of your Aadhar Card for faster verification"),W(),U(13,"div",6),qt(14,O4,2,0,"p",7)(15,R4,4,0,"label",8)(16,F4,1,0,"input",9)(17,L4,1,1,"img",10),W(),U(18,"div",6),qt(19,z4,2,0,"p",7)(20,B4,4,0,"label",11),U(21,"input",12),Ne("change",function(w){return t.onFileSelect(w,"aadharBack")}),W(),Oe(22,"input",13),qt(23,N4,1,1,"img",14),W()(),U(24,"section",5)(25,"h2"),X(26,"PAN card details"),W(),U(27,"div",6),qt(28,V4,2,0,"p",7)(29,j4,4,0,"label",11),U(30,"input",12),Ne("change",function(w){return t.onFileSelect(w,"panCard")}),W(),qt(31,U4,1,1,"img",15),W()(),U(32,"div",16)(33,"button",17),X(34,"Save & Continue"),W()()()()),s&2&&(le(7),ze("formGroup",t.documentForm),le(7),ze("ngIf",!t.previews.aadharFront),le(),ze("ngIf",!t.previews.aadharFront),le(),ze("ngIf",!t.previews.aadharFront),le(),ze("ngIf",t.previews.aadharFront),le(2),ze("ngIf",!t.previews.aadharBack),le(),ze("ngIf",!t.previews.aadharBack),le(3),ze("ngIf",t.previews.aadharBack),le(5),ze("ngIf",!t.previews.panCard),le(),ze("ngIf",!t.previews.panCard),le(2),ze("ngIf",t.previews.panCard))},dependencies:[$n,va,ya,Ga],styles:[".container[_ngcontent-%COMP%]{width:90;margin-left:5%;margin-right:5%;margin-top:1rem;margin-bottom:4rem}.arrow[_ngcontent-%COMP%]{padding:1rem 0;display:flex;align-items:center}.tittle[_ngcontent-%COMP%]{float:left;font-family:Inter,sans-serif;font-size:1.4rem;font-weight:600;line-height:24px}.title[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.progress-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:20px}.step[_ngcontent-%COMP%]{flex:1;text-align:center;padding:10px;border-radius:20px;background-color:#e0e0e0;margin-right:5px}.step.active[_ngcontent-%COMP%]{background-color:#f5a623;color:#fff}.section[_ngcontent-%COMP%]{width:100%}.section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px;margin-bottom:10px}.section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#555;margin-bottom:10px}.upload-box[_ngcontent-%COMP%]{height:10rem;border:1.34px dashed rgba(150,154,164,1);padding:1rem 3rem;text-align:center;border-radius:8px;margin-bottom:15px}.upload-button[_ngcontent-%COMP%]{background-color:#f5a623;color:#fff;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;transition:background-color .3s}.upload-button[_ngcontent-%COMP%]:hover{background-color:#e0951f}.upload-box[_ngcontent-%COMP%]{margin-bottom:20px}.preview-image[_ngcontent-%COMP%]{height:100%;width:auto;display:block;border:1px solid #ccc;border-radius:5px}input[type=file][_ngcontent-%COMP%]{display:none}.upload-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:10px 20px;border:2px solid #ffa500;border-radius:30px;background-color:transparent;color:orange;font-size:16px;cursor:pointer;text-decoration:none;transition:background-color .3s,color .3s}.upload-button[_ngcontent-%COMP%]:hover{background-color:orange;color:#fff}.upload-button[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:8px;font-size:20px;color:orange}.status-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:8px 16px;border:2px solid #ff9999;border-radius:30px;background-color:transparent;color:#f66;font-size:16px;cursor:pointer;transition:background-color .3s,color .3s}.status-button[_ngcontent-%COMP%]:hover{background-color:#f99;color:#fff}.status-button[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-left:8px;font-size:18px;color:#f66}.status-button[_ngcontent-%COMP%]:hover   .icon[_ngcontent-%COMP%]{color:#fff}.submit-btn[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.submit-btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:60%;height:3.5rem;border-radius:1rem;font-family:Open Sans;font-size:14.63px;font-weight:600;line-height:19.93px;text-align:left;text-underline-position:from-font;text-decoration-skip-ink:none;color:#fff;background:#e8841c;border:none}"]});let c=o;return c})();var jA=(()=>{let o=class o{constructor(r,s,t){this.fb=r,this.router=s,this.http=t,this.apiUrl=_n,this.bankDetails=this.fb.group({accountName:["",Jo.required],gst:["",Jo.required],accountNumber:["",Jo.required],PANNumber:["",Jo.required],bankName:["",Jo.required],IFSC:["",Jo.required],branch:["",Jo.required],aadhaarNumber:532268448050})}submit(){let r=`${this.apiUrl}providers/provider-finance`,s=new FormData;s.append("accountName",this.bankDetails.value.accountName),s.append("providerId",localStorage.getItem("providerId")||""),s.append("aadhaarNumber",this.bankDetails.value.aadhaarNumber),s.append("gst",this.bankDetails.value.gst),s.append("accountNumber",this.bankDetails.value.accountNumber),s.append("pan",this.bankDetails.value.PANNumber),s.append("bankName",this.bankDetails.value.bankName),s.append("ifscCode",this.bankDetails.value.IFSC),s.append("branch",this.bankDetails.value.branch),this.http.post(r,s).subscribe({next:t=>{console.log(t),this.router.navigate(["induction"])},error:t=>{console.log(t),t.error.error==='E11000 duplicate key error collection: test.finances index: pan_1 dup key: { pan: "cggpc1173E" }'&&alert("Pancard is already registered")}})}skip(){this.router.navigate(["induction"])}};o.\u0275fac=function(s){return new(s||o)(_e(qa),_e(ii),_e(ji))},o.\u0275cmp=Et({type:o,selectors:[["app-bank-details"]],decls:56,vars:1,consts:[[1,"skip-btn",3,"click"],[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],[1,"form-main",3,"formGroup"],[1,"form-div-section"],["for","accountName"],["type","text","id","accountName","formControlName","accountName"],["for","accountNumber"],["type","number","id","accountNumber","formControlName","accountNumber"],["for","PANNumber"],["type","text","id","PANNumber","formControlName","PANNumber"],["for","bankName"],["type","text","id","bankName","formControlName","bankName"],["for","IFSC"],["type","text","id","IFSC","formControlName","IFSC"],["for","branch"],["type","text","id","branch","formControlName","branch"],["for","gst"],["type","text","id","gst","formControlName","gst"],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){s&1&&(U(0,"button",0),Ne("click",function(){return t.skip()}),X(1,"skip"),W(),U(2,"div",1)(3,"div",2)(4,"span",3),X(5,"Banking details"),W(),Oe(6,"br")(7,"br"),U(8,"div",4)(9,"form",5)(10,"div",6)(11,"fieldset")(12,"legend",7),X(13," Account Name \xA0"),W(),Oe(14,"input",8)(15,"br"),W()(),U(16,"div",6)(17,"fieldset")(18,"legend",9),X(19," Account Number \xA0"),W(),Oe(20,"input",10)(21,"br"),W()(),U(22,"div",6)(23,"fieldset")(24,"legend",11),X(25," PAN Number \xA0"),W(),Oe(26,"input",12)(27,"br"),W()(),U(28,"div",6)(29,"fieldset")(30,"legend",13),X(31," Bank name \xA0"),W(),Oe(32,"input",14)(33,"br"),W()(),U(34,"div",6)(35,"fieldset")(36,"legend",15),X(37," IFSC \xA0"),W(),Oe(38,"input",16)(39,"br"),W()(),U(40,"div",6)(41,"fieldset")(42,"legend",17),X(43," Branch \xA0"),W(),Oe(44,"input",18)(45,"br"),W()(),U(46,"div",6)(47,"fieldset")(48,"legend",19),X(49," GST \xA0"),W(),Oe(50,"input",20)(51,"br"),W()()()(),U(52,"button",21),Ne("click",function(){return t.submit()}),X(53,"Submit"),W()(),Oe(54,"br")(55,"br"),W()),s&2&&(le(9),ze("formGroup",t.bankDetails))},dependencies:[va,ba,g0,Kr,ya,Ga,Il],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;justify-content:center;align-items:center;text-align:center}.skip-btn[_ngcontent-%COMP%]{width:max-content;height:max-content;float:right;margin:1rem;margin-bottom:0;background-color:transparent;border:none;font-family:"Inter" sans-serif;color:#00000080;font-size:16px;font-weight:400;line-height:16.94px;text-align:left}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:0%;left:0%;display:grid;grid-template-rows:max-content max-content;align-items:start;text-align:left}.tittle[_ngcontent-%COMP%]{float:left;font-family:Inter,sans-serif;font-size:1.6rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content}.form-main[_ngcontent-%COMP%]{width:90%;height:max-content;display:flex;flex-direction:column;gap:.9rem}fieldset[_ngcontent-%COMP%]{width:100%;height:2.5rem;border-radius:.5rem}fieldset[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{font-size:.9rem;font-family:Inter,sans-serif;font-weight:400;line-height:1rem;flex-shrink:0;margin-right:10px;color:#030b33b3}input[_ngcontent-%COMP%]{flex-grow:1;outline:0;border-width:0 0 0 0;border-color:#000;font-size:1.1rem;padding:5px 0}.login-btn[_ngcontent-%COMP%]{height:3rem;width:90%;font-size:1.3rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:3rem;border:none;background-color:#d16611;position:fixed;top:90%;left:5%}.mat-mdc-text-field-wrapper.mdc-text-field.mdc-text-field--filled[_ngcontent-%COMP%]{background-color:transparent;height:5rem}']});let c=o;return c})();var O0=(()=>{let o=class o{constructor(r){this.http=r,this.apiUrl=_n,this.apiForVideo=this.apiUrl+"admin"}getingVideos(){return this.http.get(`${this.apiForVideo}/training`)}gettingInductionVeideos(){return this.http.get(`${this.apiForVideo}/induction`)}getVideosByIds(r){let s=r.map(t=>this.http.get(`${this.apiForVideo}/training/${t}`).pipe(Ro(g=>(console.error(`Error fetching video for ID ${t}:`,g),Ln(null)))));return km(s)}getInductionVideosByIds(r){console.log(r);let s=r.map(t=>this.http.get(`${this.apiForVideo}/induction/${t}`).pipe(Ro(g=>(console.error(`Error fetching video for ID ${t}:`,g),Ln(null)))));return km(s)}updatingWatchedVideo(r){let s=`${this.apiUrl}providers/provider-watched-video`;return this.http.post(s,r)}};o.\u0275fac=function(s){return new(s||o)(wt(ji))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var ks=(()=>{let o=class o{constructor(r,s){this.http=r,this.location=s,this.apiUrl=_n,this.userId=localStorage.getItem("providerId"),this.userCredit=0}payWithRazorpay(r,s,t){let g={key:"rzp_test_b8XfUOQ4u8dlSq",amount:r*100,currency:t,name:"Coolie no.1",description:"Test Transaction",image:"assets/location/logo-v3 3.png",handler:M=>{console.log(M),this.addingCredit(r)},prefill:{name:"Customer Name",email:"customer@example.com",contact:"9999999999"},notes:{address:"Razorpay Corporate Office"},theme:{color:"#3399cc"},modal:{ondismiss:function(){console.log("Checkout form closed")},escape:!1,backdropclose:!1,handleback:!0}};new Razorpay(g).open()}createOrder(r){let s=new BE({"Content-Type":"application/json"}),t={amount:r,currency:"INR",receipt:`receipt_${Date.now()}`},g=`${this.apiUrl}core/razor-pay/create-order`;return this.http.post(g,t,{headers:s})}addingCredit(r){let s=this.apiUrl+"providers/provider-credits/recharge",t={providerId:this.userId,amount:r};return this.http.post(s,t).subscribe(g=>{console.log(g),this.getNow()},g=>{console.log(g)})}getCredits(){let r=this.apiUrl+`providers/provider-credits/${this.userId}`;return this.http.get(r)}getNow(){this.getCredits().subscribe(r=>{console.log(r),this.userCredit=r.credits,this.location.back()},r=>{console.log(r)})}getCreditHistory(){let r=this.apiUrl+`providers/provider-credits/${this.userId}`;return this.http.get}setDefault(){this.userId="",this.userCredit=0}};o.\u0275fac=function(s){return new(s||o)(wt(ji),wt(yi))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var $d=FS(KI());var R0=(()=>{let o=class o{setonlineStatus(r,s){this.onlineStatus=r,localStorage.setItem("onlineStatus",r.toString()),localStorage.setItem("onlineText",s)}getonlineStatus(){let r=localStorage.getItem("onlineStatus"),s=localStorage.getItem("onlineText");return{status:r==="true",text:s||"Go"}}constructor(r,s){this.platformId=r,this.http=s,this.apiUrl=_n,this.destinationInput="",this.currentLocation=[0,0],this.directionsLayerId="directions",this.userCordinates=[0,0],this.onlineStatus=!1,$d.default.accessToken="pk.eyJ1IjoiY29vbGllbm8xLWFkbWluIiwiYSI6ImNsdWZjZGR1ZzBtZHcybnJvaHBiYTd2NzMifQ.TQ6FrqUIUUWv7J7n75A3tQ"}ngOnInit(){this.initializeMap()}ngOnDestroy(){this.watchId&&navigator.geolocation.clearWatch(this.watchId)}initializeMap(){navigator.geolocation.getCurrentPosition(r=>{this.currentLocation=[r.coords.longitude,r.coords.latitude],console.log(this.currentLocation,"currect location"),this.map=new $d.default.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:this.currentLocation,zoom:12}),this.map.addControl(new $d.default.NavigationControl),this.userMarker=new $d.default.Marker({color:"blue"}).setLngLat(this.currentLocation).setPopup(new $d.default.Popup().setText("You are here")).addTo(this.map),this.watchId=navigator.geolocation.watchPosition(s=>{let t=[s.coords.longitude,s.coords.latitude];this.currentLocation=t,this.userMarker&&this.userMarker.setLngLat(t),this.userCordinates[0]!=0&&this.addDestinationMarker(this.userCordinates)},s=>{console.error("Error watching position:",s)})})}navigateToPlace(){if(!this.destinationInput){console.error("Please enter the destination address or coordinates.");return}if(/^(-?\d+(\.\d+)?),\s*(-?\d+(\.\d+)?)$/.test(this.destinationInput)){let[s,t]=this.destinationInput.split(",").map(g=>parseFloat(g.trim()));this.addDestinationMarker([s,t])}else fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(this.destinationInput)}.json?access_token=${$d.default.accessToken}`).then(s=>{if(!s.ok)throw new Error("Network response was not ok");return s.json()}).then(s=>{if(s.features.length===0)throw new Error("No results found");let t=s.features[0].geometry.coordinates;this.addDestinationMarker(t)}).catch(s=>{console.error("Error fetching destination coordinates:",s),alert("Error: Could not find the location. Please check your input.")})}addDestinationMarker(r){console.log(r),this.destinationMarker&&this.destinationMarker.remove(),this.destinationMarker=new $d.default.Marker({color:"red"}).setLngLat(r).setPopup(new $d.default.Popup().setText(this.destinationInput)).addTo(this.map),this.map.flyTo({center:r,zoom:12}),this.getDirections(r)}getDirections(r){let s=`https://api.mapbox.com/directions/v5/mapbox/driving/${this.currentLocation[0]},${this.currentLocation[1]};${r[0]},${r[1]}?alternatives=true&geometries=geojson&steps=true&access_token=${$d.default.accessToken}`;fetch(s).then(t=>{if(!t.ok)throw new Error("NoRoute");return t.json()}).then(t=>{if(console.log("Directions data:",t),t.routes.length===0)throw new Error("No routes found");this.map.getSource(this.directionsLayerId)&&(this.map.removeLayer(this.directionsLayerId),this.map.removeSource(this.directionsLayerId)),this.map.addSource(this.directionsLayerId,{type:"geojson",data:{type:"Feature",properties:{},geometry:t.routes[0].geometry}}),this.map.addLayer({id:this.directionsLayerId,type:"line",source:this.directionsLayerId,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"red","line-width":5}});let g=new $d.default.LngLatBounds;t.routes[0].geometry.coordinates.forEach(w=>{g.extend(w)}),this.map.fitBounds(g,{padding:50})}).catch(t=>{console.error("Error fetching directions:",t),alert("Error: Could not find a route.")})}getCurrentLocation(){return new ga(r=>{navigator.geolocation.getCurrentPosition(s=>{let t=[s.coords.longitude,s.coords.latitude];console.log("current location inside getcurrent location",t),alert(t),this.getPlaceNameFromCoordinates(t),r.next(t),r.complete()},s=>{r.error(s)})})}getPlaceNameFromCoordinates(r){let t=`https://api.mapbox.com/geocoding/v5/mapbox.places/${r[0]},${r[1]}.json?access_token=pk.eyJ1IjoiY29vbGllbm8xLWFkbWluIiwiYSI6ImNsdWZjZGR1ZzBtZHcybnJvaHBiYTd2NzMifQ.TQ6FrqUIUUWv7J7n75A3tQ`;return new ga(g=>{fetch(t).then(w=>{if(!w.ok)throw console.error("Network response was not ok:",w.status,w.statusText),new Error(`Network response was not ok: ${w.status} ${w.statusText}`);return w.json()}).then(w=>{if(w.features.length===0)throw console.error("No results found:",w),new Error("No results found");let M=w.features[0].place_name;g.next(M),g.complete()}).catch(w=>{console.error("Error fetching place name:",w),g.error(w)})})}sendCordinates(r){let s=this.apiUrl+"providers/provider-cordinates",g={providerId:localStorage.getItem("providerId"),longitude:r[0],latitude:r[1]};return console.log(g),this.http.post(s,g)}};o.\u0275fac=function(s){return new(s||o)(wt(ah),wt(ji))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var ta=(()=>{let o=class o{constructor(r){this.http=r,this.oredrDetails=[],this.apiUrl=_n}getOrder(r){let s=this.apiUrl+`users/order/category/${r}`;return this.http.get(s)}getOrderDetails(r){return this.http.get("")}accept(r,s,t){let g={orderId:r,price:s,userId:t,providerId:localStorage.getItem("providerId")};console.log(g);let w=this.apiUrl+"users/order-history/accept-order";return this.http.post(w,g)}verifyOtp(){let r=this.apiUrl+"users/order-history/verify-start-order",s={orderId:this.orderIds};return this.http.post(r,s)}verifyStartOrder(r){let s=`${this.apiUrl}users/order-history/verify-start-order`;return this.http.post(s,r)}cancelOrder(r){let s=this.apiUrl+"users/order-history/provider-cancel-order",t={orderId:r,providerId:localStorage.getItem("providerId"),reason:"nothing"};return console.log(t),this.http.post(s,t)}sendingImageBeforeWork(r){let s=`${this.apiUrl}users/order-history/before-work-upload-image`;return this.http.post(s,r)}completeOrder(r){let s=this.apiUrl+"users/order-history/order-completed-generateotp";return this.http.post(s,r)}verifyAfterComplete(r,s,t){let g=this.apiUrl+"users/order-history/order-completed-verify",w={orderHistoryId:s,orderId:t,otp:r};return console.log(w),this.http.post(g,w)}orderHistory(){let r=localStorage.getItem("providerId"),s=this.apiUrl+`users/order-history/provider/${r}`;return this.http.get(s)}setDefult(){this.orderIds="",this.oredrDetails=[],this.userFullAddress=""}};o.\u0275fac=function(s){return new(s||o)(wt(ji))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var ch=(()=>{let o=class o{constructor(r){this.http=r,this.apiUrl=_n,this.mapStatus=!1,this.currentLocation$=new My(null),this.onlineStatus=!1,this.directionsService=new google.maps.DirectionsService,this.directionsRenderer=new google.maps.DirectionsRenderer}setonlineStatus(r,s){this.onlineStatus=r,localStorage.setItem("onlineStatus",r.toString()),localStorage.setItem("onlineText",s)}getonlineStatus(){let r=localStorage.getItem("onlineStatus"),s=localStorage.getItem("onlineText");return{status:r==="true",text:s||"Go"}}getCoordinates(){return navigator.geolocation.getCurrentPosition(r=>{let s={lat:r.coords.latitude,lng:r.coords.longitude};this.currentLocation$.next(s)},r=>{console.log(r)}),this.currentLocation$.asObservable()}sendCordinates(r){let s=this.apiUrl+"providers/provider-cordinates",t=localStorage.getItem("providerId");console.log(r);let g={providerId:t,longitude:r.location.lng,latitude:r.location.lat};return console.log(g),this.http.post(s,g)}getCoordinatesFromPlaceName(r){let s=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(r)}&key=AIzaSyCJQHv3pYfnPd6F3ju1DXZ7jm46PJbncuk`;return this.http.get(s)}getPlaceNameFromCoordinates(r,s){let t=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${r},${s}&key=AIzaSyCJQHv3pYfnPd6F3ju1DXZ7jm46PJbncuk`;return this.http.get(t)}addDestinationMarker(r){new google.maps.Marker({position:{lat:r[1],lng:r[0]},map:this.map,title:"Destination"})}initializeMap(r,s){this.map=new google.maps.Map(s,{center:{lat:r.lat,lng:r.lng},zoom:15})}addProviderMarker(r){this.providerMarker=new google.maps.Marker({position:r,map:this.map,title:"Provider Location"})}addUserMarker(r){new google.maps.Marker({position:r,map:this.map,title:"User Location",icon:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}),this.directionsRenderer.setMap(this.map)}updateProviderMarker(r){this.providerMarker&&this.providerMarker.setPosition(r)}showDirections(r,s){if(!r||!s){console.error("Invalid origin or destination for directions.");return}let t={origin:new google.maps.LatLng(r.lat,r.lng),destination:new google.maps.LatLng(s.lat,s.lng),travelMode:google.maps.TravelMode.DRIVING};this.directionsService.route(t,(g,w)=>{w==="OK"?this.directionsRenderer.setDirections(g):console.error("Error fetching directions:",w)})}trackProviderLocation(){let r=new My(null);return navigator.geolocation.watchPosition(s=>{let t={lat:s.coords.latitude,lng:s.coords.longitude};r.next(t)},s=>{console.log("Tracking error:",s)}),r.asObservable()}calculateDistance(r,s,t,g){let w=pe=>pe*Math.PI/180,F=w(t-r),N=w(g-s),Q=Math.sin(F/2)*Math.sin(F/2)+Math.cos(w(r))*Math.cos(w(t))*Math.sin(N/2)*Math.sin(N/2);return 6371e3*(2*Math.atan2(Math.sqrt(Q),Math.sqrt(1-Q)))}setDefult(){}};o.\u0275fac=function(s){return new(s||o)(wt(ji))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var sw=c=>({active:c}),dh=(()=>{let o=class o{constructor(r){this.router=r,this.activeIcon="home"}ngOnInit(){this.router.events.subscribe(r=>{r instanceof R1&&this.setActiveIcon(r.urlAfterRedirects)}),this.setActiveIcon(this.router.url)}changeColor(r,s){this.activeIcon=r,this.router.navigate([s])}setActiveIcon(r){r.includes("home")?this.activeIcon="home":r.includes("ongoing")?this.activeIcon="Services":r.includes("earnings")?this.activeIcon="Activity":r.includes("target")&&(this.activeIcon="Account")}};o.\u0275fac=function(s){return new(s||o)(_e(ii))},o.\u0275cmp=Et({type:o,selectors:[["app-fotter"]],decls:25,vars:12,consts:[[1,"fottersss"],[1,"sub-fotterss",3,"click","ngClass"],[1,"material-symbols-outlined","notranslate"],[1,"names"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1),Ne("click",function(){return t.changeColor("home","home")}),U(2,"i",2),X(3,"home"),W(),X(4," \xA0 "),U(5,"span",3),X(6,"Home"),W()(),U(7,"div",1),Ne("click",function(){return t.changeColor("Services","ongoing")}),U(8,"i",2),X(9,"work_history"),W(),X(10,"\xA0 "),U(11,"span",3),X(12,"Ongoing"),W()(),U(13,"div",1),Ne("click",function(){return t.changeColor("Activity","earnings")}),U(14,"i",2),X(15,"payments"),W(),X(16,"\xA0 "),U(17,"span",3),X(18,"Earnings"),W()(),U(19,"div",1),Ne("click",function(){return t.changeColor("Account","target")}),U(20,"i",2),X(21,"ads_click"),W(),X(22,"\xA0 "),U(23,"span",3),X(24,"Target"),W()()()),s&2&&(le(),ze("ngClass",wi(4,sw,t.activeIcon==="home")),le(6),ze("ngClass",wi(6,sw,t.activeIcon==="Services")),le(6),ze("ngClass",wi(8,sw,t.activeIcon==="Activity")),le(6),ze("ngClass",wi(10,sw,t.activeIcon==="Account")))},dependencies:[Ko],styles:[".fottersss[_ngcontent-%COMP%]{border:0;width:100%;display:flex;justify-content:space-around;position:fixed;bottom:0;text-align:center;padding-top:.5rem;padding-bottom:.5rem;background-color:#fff}.sub-fotterss[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{font-size:2rem;color:#00000080}.names[_ngcontent-%COMP%]{display:none}.active[_ngcontent-%COMP%]{background-color:#d16611;border-radius:25px;padding:.5rem 1rem}.active[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{color:#fff}.active[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]{display:block;color:#fff}"]});let c=o;return c})();var W4=["footer"],H4=c=>({"availability-bg":c}),G4=()=>({backdropBorderRadius:"3px",backdropBackgroundColour:"rgba(0, 0, 0, 0.5)"});function q4(c,o){if(c&1&&(U(0,"div")(1,"div",26),Oe(2,"img",27),W()()),c&2){let d=o.$implicit;le(2),ze("src",d.image,vr)}}function $4(c,o){if(c&1&&(U(0,"div")(1,"span"),X(2),W(),U(3,"span"),Oe(4,"i",30),X(5),W()()),c&2){let d=o.$implicit;le(2),I1("",d.day,", ",d.month," ",d.date,""),le(3),Ni(" ",d.isWorking,"")}}function Y4(c,o){if(c&1){let d=ai();qt(0,$4,6,4,"div",11),U(1,"div",28),Ne("click",function(){St(d);let s=it();return It(s.navToCal())}),U(2,"pre",29),X(3,"calendar_today"),W()()}if(c&2){let d=it();ze("ngForOf",d.nextWorking)}}function Z4(c,o){if(c&1){let d=ai();U(0,"div")(1,"span"),X(2,"Schedule your availability now"),W()(),U(3,"div",28),Ne("click",function(){St(d);let s=it();return It(s.navToCal())}),U(4,"pre",29),X(5,"arrow_forward_ios"),W()()}}function X4(c,o){c&1&&(U(0,"span"),X(1,"No more jobs today"),W())}function Q4(c,o){if(c&1&&(U(0,"span"),X(1),W()),c&2){let d=it();le(),Ni("",d.noOfPendingOrders," more jobs today")}}function K4(c,o){if(c&1&&(U(0,"div")(1,"div",32)(2,"video",33),Oe(3,"source",34),W()()()),c&2){let d=o.$implicit;le(3),ze("src",d.video,vr)}}function J4(c,o){if(c&1&&(U(0,"div",31),qt(1,K4,4,1,"div",11),W()),c&2){let d=it();le(),ze("ngForOf",d.data)}}function eB(c,o){if(c&1&&Oe(0,"ngx-loading",25),c&2){let d=it();ze("show",d.loading)("config",Zp(2,G4))}}var WA=(()=>{let o=class o{ngOnInit(){this.isAccountVerify=this.logInService.isAccountVerify,this.trainingService.getingVideos().subscribe(r=>{console.log(r),this.data=r},r=>{console.log(r)})}toggleDrawer(){this.isDrawerOpen=!this.isDrawerOpen,this.router.navigate(["menu"])}navToCredit(){this.router.navigate(["credits"])}navToNotification(){this.router.navigate(["notification"])}navToCal(){this.router.navigate(["calender"])}constructor(r,s,t,g,w,M,F,N,Q,ae,pe){this.router=r,this.http=s,this.trainingService=t,this.logInService=g,this.userDetailsService=w,this.jobDetailsService=M,this.razorpayService=F,this.mapboxService=N,this.orderService=Q,this.dialogService=ae,this.googleMapService=pe,this.isDrawerOpen=!1,this.data=[],this.bucketName="coolie1-dev",this.region="ap-south-1",this.nextWorking=[],this.loading=!1,this.ads=[{src:"assets/demo/ad.png"},{src:"assets/demo/ad.png"},{src:"assets/demo/ad.png"},{src:"assets/documents/pancard.png"}],this.dates=[],this.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.credits=0,this.online=!1,this.onlineText="Go",this.noOfPendingOrders=0,console.log(this.nextWorking.length),this.getBanners(),this.getProviderDetails(),this.workingDates(),this.getAvalibility(),this.getWork(),this.getCredit(),this.getPendingOrders()}getProviderDetails(){return zr(this,null,function*(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")),setTimeout(()=>{this.navToAboutUser()},2e3)})}navToAboutUser(){localStorage.getItem("providerId")||this.router.navigate(["selectAccount"]);let r;this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")).subscribe(s=>{console.log(s),r=s,r&&!this.jobDetailsService.getcheckingDetails()&&(console.log("inside",this.jobDetailsService.getcheckingDetails()),this.dialogService.openDialog("Please add the details uncomment me in home-132"),this.jobDetailsService.setCheckingDetails(!0))}),console.log(r)}workingDates(){this.nextWorking=this.dates.splice(0,2),console.log(this.nextWorking)}getAvalibility(){this.jobDetailsService.getAvailability().subscribe(r=>{console.log(r),this.formattingAvailbility(r)},r=>{console.log(r)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),console.log(r._id),this.userDetailsService.workResponse=r.works,this.userDetailsService.workResponseId=r._id},r=>{console.log(r)})}formattingAvailbility(r){let s=new Date;for(let t=0;t<r.length;t++){let w=r[t].slotTime.date.split("T")[0],M=new Date(w),F=this.dayNames[M.getDay()],N=this.monthNames[M.getMonth()],Q=M.getFullYear(),ae=M.getDate();(M>=s||M.toDateString()===s.toDateString())&&(this.dates.some(Te=>Te.date===ae&&Te.day===F&&Te.month===N&&Te.year===Q)||(this.dates.push({date:ae,day:F,month:N,year:Q,isWorking:"working"}),this.dates.sort((Te,Pe)=>{let Re=this.monthNames.indexOf(Te.month),Ke=this.monthNames.indexOf(Pe.month);if(Re===-1||Ke===-1)return 0;let Je=new Date(Te.year,Re,Te.date),_t=new Date(Pe.year,Ke,Pe.date);return Je.getTime()-_t.getTime()})))}this.workingDates()}getCredit(){this.razorpayService.getCredits().subscribe(r=>{console.log(r),this.razorpayService.userCredit=r.creditBalance,this.credits=r.credits},r=>{console.log(r)})}getBanners(){this.userDetailsService.getBanners().subscribe({next:r=>{console.log(r),this.ads=r},error:r=>{console.log(r)}})}onlineStatus(){try{this.loading=!0;let r=this.jobDetailsService.isVerify;console.log(r),this.online=!this.online,this.onlineText=this.online?"Off":"Go",this.googleMapService.onlineStatus=this.online,this.googleMapService.setonlineStatus(this.online,this.onlineText),localStorage.setItem("onlineStatus",this.online.toString()),localStorage.setItem("onlineText",this.onlineText),this.online&&this.googleMapService.getCoordinates().subscribe(s=>{console.log("Current Location:",s),this.sendCordinates(s),this.getname(s),alert(s?.lat),this.loading=!1},s=>{console.error("Error getting current location:",s),alert(s.error.message),this.loading=!1})}catch(r){console.error("Error in onlineStatus method:",r)}console.log(this.online)}getname(r){this.mapboxService.getPlaceNameFromCoordinates(r).subscribe(s=>{console.log("Place Name:",s),this.userDetailsService.currentCordinates=r,this.userDetailsService.currentLocation=s,this.mapboxService.placeName=s},s=>{console.error("Error getting place name:",s)})}sendCordinates(r){this.googleMapService.sendCordinates(r).subscribe({next:s=>{console.log(s),alert(s.message)},error:s=>{console.log(s),alert(s.errors.message)}})}sendTokens(){let r="",s={};this.http.post(r,s).subscribe(t=>{console.log(t)},t=>{console.log(t)})}getPendingOrders(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r);let t=new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-"),g="Accepted",w=r.data.filter(M=>{let F=M.orderId.items[0].scheduledDate.split(" ")[0];return console.log("scheduleee================",F),M.status.toLowerCase().includes(g.toLowerCase())&&F===t});console.log("filtered",w),this.noOfPendingOrders=w.length},error:r=>{console.log(r)}})}};o.\u0275fac=function(s){return new(s||o)(_e(ii),_e(ji),_e(O0),_e(Br),_e(nr),_e(ea),_e(ks),_e(R0),_e(ta),_e(mr),_e(ch))},o.\u0275cmp=Et({type:o,selectors:[["app-home"]],viewQuery:function(s,t){if(s&1&&Vi(W4,5),s&2){let g;zi(g=Bi())&&(t.footer=g.first)}},decls:62,vars:15,consts:[[1,"container"],[1,"header"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets/logo/credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined","notranslate"],[1,"sub-container"],[1,"ads-div"],[1,"wrapperrr"],[4,"ngFor","ngForOf"],[1,"sub-divs"],[1,"availability-div",3,"ngClass"],[1,"new-jobs"],[1,"text-div"],[1,"icon-div"],[1,"more-jobs"],[1,"text-div1"],[1,"pending-task-div"],[1,"quick-links"],["routerLinkActive","help",1,"helps",3,"routerLink"],[2,"color","white"],["id","video-div",4,"ngIf"],[2,"height","5rem"],[3,"show","config"],[1,"slidesss"],[3,"src"],[3,"click"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],[1,"fa","fa-circle",2,"font-size","10px"],["id","video-div"],["id","video-slidess"],["controls","","id","videoss"],["type","video/mp4",3,"src"]],template:function(s,t){s&1&&(U(0,"div",0),Oe(1,"br"),U(2,"div",1)(3,"div",2),Ne("click",function(){return t.toggleDrawer()}),X(4,"\u2630"),W(),U(5,"div",3)(6,"div",4),Ne("click",function(){return t.navToCredit()}),Oe(7,"img",5),U(8,"pre"),X(9),wl(10,"number"),W()(),U(11,"div",6),Ne("click",function(){return t.navToNotification()}),U(12,"span",7),X(13,"notifications"),W()()()(),Oe(14,"br"),U(15,"div",8)(16,"div",9)(17,"div",10),qt(18,q4,3,1,"div",11),W()(),U(19,"div",12)(20,"div",13),qt(21,Y4,4,1)(22,Z4,6,0),W(),U(23,"div")(24,"div",14)(25,"div",15)(26,"span"),X(27,"No new jobs"),W(),U(28,"span"),X(29,"5 jobs missed recently"),W()(),U(30,"div",16)(31,"span",7),X(32,"arrow_forward_ios"),W()()(),Oe(33,"br"),U(34,"div",17)(35,"div",18),qt(36,X4,2,0,"span")(37,Q4,2,1),W(),U(38,"div",16)(39,"span",7),X(40,"arrow_forward_ios"),W()()()(),U(41,"div",19)(42,"span"),X(43,"Pending Tasks"),W(),Oe(44,"br")(45,"br"),U(46,"p"),X(47," 80 subscription jobs . 4days left to buy job pack now "),W(),U(48,"p"),X(49," Only 50 credits left.Recharge credits to get new jobs "),W()(),U(50,"div",20)(51,"div")(52,"span"),X(53,"Quick links"),W()(),U(54,"div",21)(55,"span",22),X(56,"Help?"),W()()(),qt(57,J4,2,1,"div",23),W()()(),Oe(58,"div",24)(59,"router-outlet")(60,"app-fotter"),qt(61,eB,1,3,"ngx-loading",25)),s&2&&(Ki("overlap",t.isDrawerOpen),le(9),Xt(t.credits%1===0?t.credits:Cl(10,10,t.credits,"1.2-2")),le(9),ze("ngForOf",t.ads),le(2),ze("ngClass",wi(13,H4,t.nextWorking.length!=0)),le(),hr(21,t.nextWorking.length!=0?21:22),le(15),hr(36,t.noOfPendingOrders===0?36:37),le(18),ze("routerLink","/help"),le(3),ze("ngIf",t.isAccountVerify),le(4),hr(61,t.loading?61:-1))},dependencies:[Ko,Io,$n,F1,L1,z1,nf,dh,Gc],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%;transition:padding-left .3s ease;margin-top:0}#drawer[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000;color:red;padding:20px;box-sizing:border-box;transition:transform .3s ease;transform:translate(-100%);z-index:2}#drawer.open[_ngcontent-%COMP%]{transform:translate(0);overlay:auto}.header[_ngcontent-%COMP%]{margin-top:0rem;width:90%;display:flex;justify-content:space-between}#menu-button[_ngcontent-%COMP%]{cursor:pointer;z-index:2;color:#d16611;font-size:24px}.list-menu[_ngcontent-%COMP%]{list-style-type:none;font-size:1rem;font-weight:400;font-family:Roboto Condensed}.bell-credit[_ngcontent-%COMP%]{width:max-content;height:2.5rem;display:flex;justify-content:space-between;gap:.5rem;border-radius:.2rem}.package[_ngcontent-%COMP%]{width:max-content;padding:0 .5rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.credit[_ngcontent-%COMP%]{width:max-content;padding:0 .5rem;display:flex;justify-content:space-evenly;align-items:center;gap:.3rem;border:1px solid black;border-radius:.4rem}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .package[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%], .package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center;border-radius:.4rem}.sub-container[_ngcontent-%COMP%]{width:95%;height:90vh;overflow-y:auto;scroll-snap-type:y;scroll-behavior:smooth;scrollbar-width:none}.sub-divs[_ngcontent-%COMP%]{margin-top:1rem;display:grid;row-gap:1.4rem}.ads-div[_ngcontent-%COMP%]{display:flex;height:7rem;width:100%}.wrapperrr[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;grid-gap:.5rem;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}.slidesss[_ngcontent-%COMP%]{width:100%;height:100%}.slidesss[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:auto;object-fit:cover}.availability-div[_ngcontent-%COMP%]{width:auto;height:max-content;display:flex;column-gap:4%;row-gap:0;background-color:#ffca83;align-items:center;justify-content:space-between;padding:0 2rem;border-radius:.8rem}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:22px;text-align:left}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:22px;text-align:left}.availability-bg[_ngcontent-%COMP%]{background-color:#f5f5f5}.new-jobs[_ngcontent-%COMP%]{width:100%;height:5rem;background-color:#ffb24b;border-radius:1.3rem;color:#f5f5f5;display:flex;justify-content:space-between;align-items:center}.text-div[_ngcontent-%COMP%]{width:max-content;height:4rem;display:grid;justify-content:center;row-gap:0rem;text-align:left;align-items:center;padding-left:2rem}.text-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(1), .pending-task-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .quick-links[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .text-div1[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-size:1.4rem;font-weight:500;color:#000}.text-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(2){font-family:Inter,sans-serif;font-size:.95rem;font-weight:400;color:#00000080}.icon-div[_ngcontent-%COMP%]{width:30%;display:flex;justify-content:center;align-items:center;color:#000}.more-jobs[_ngcontent-%COMP%]{width:100%;height:4rem;background-color:#ffd6d3;border-radius:1.3rem;color:#fff;display:flex;align-items:center;justify-content:space-between}.text-div1[_ngcontent-%COMP%]{width:max-content;height:4rem;display:grid;justify-content:center;align-items:center;padding-left:2rem}.pending-task-div[_ngcontent-%COMP%]{text-align:left}.pending-task-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:15px;font-weight:400;line-height:16.94px;letter-spacing:.05em;text-align:left}.quick-links[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.helps[_ngcontent-%COMP%]{width:6rem;height:3rem;background-color:#20193f;color:#fff;display:flex;justify-content:center;align-items:center;border-radius:1.8rem}#video-div[_ngcontent-%COMP%]{width:100%;height:10rem;display:flex;grid-gap:.5rem;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}video[_ngcontent-%COMP%]{width:100vw;height:10rem;object-fit:cover;cursor:pointer}.online[_ngcontent-%COMP%]{background-color:#d16611;width:6rem;height:6rem;border-radius:50%;position:fixed;bottom:70px;left:40%;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:500;color:#fff;overflow:hidden}.online[_ngcontent-%COMP%]:before{content:"";position:absolute;width:50%;height:50%;border:.2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_wave 1.9s ease-out infinite;pointer-events:none}@keyframes _ngcontent-%COMP%_wave{50%{transform:scale(1);width:50%;height:50%}60%{transform:scale(1.5);width:60%;height:60%}70%{transform:scale(2);width:70%;height:70%}to{transform:scale(2.5);width:100%;height:100%}}']});let c=o;return c})();var tB=c=>({active:c});function iB(c,o){if(c&1){let d=ai();U(0,"button",14),Ne("click",function(){let s=St(d).$implicit,t=it();return It(t.setActiveButton(s))}),X(1),W()}if(c&2){let d=o.$implicit,r=it();ze("ngClass",wi(2,tB,r.activeButton===d)),le(),Ni(" ",d," ")}}function nB(c,o){if(c&1&&(U(0,"div",15)(1,"span",16)(2,"span",17),X(3),W(),U(4,"span",18),X(5),W()(),U(6,"span",18),X(7),W()(),Oe(8,"div",19)),c&2){let d=o.$implicit;le(3),Xt(d.date),le(2),Xt(d.details),le(2),Xt(d.amount)}}var HA=(()=>{let o=class o{navBack(){this.location.back()}navToAddCredit(){this.router.navigate(["addCredit"])}constructor(r,s,t){this.location=r,this.router=s,this.razorpayServie=t,this.buttons=["All","Recharge","Expenses","Penalties"],this.activeButton="All",this.history=[],this.filteredCreditHistory=[],this.credits=this.razorpayServie.userCredit,console.log(this.razorpayServie.userCredit),this.getCredit()}setActiveButton(r){this.activeButton=r,this.filter(this.activeButton)}getCredit(){this.razorpayServie.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits,this.history=r.transactions,this.filteredCreditHistory=this.history},error:r=>{console.log(r)}})}filter(r){let s=this.history,t;r!="All"?(t=s.filter(g=>g.type.toLowerCase().includes(r.toLowerCase())),this.filteredCreditHistory=t):this.filteredCreditHistory=s,console.log(this.filteredCreditHistory)}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(ii),_e(ks))},o.\u0275cmp=Et({type:o,selectors:[["app-credit"]],decls:25,vars:5,consts:[[1,"container"],[1,"header"],[1,"arrow_back",3,"click"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],[1,"logo"],["src","assets\\documents\\credit bg.png"],[1,"credit"],[1,"credit-details"],[3,"click"],[1,"sub-container"],[1,"cat"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"content"],[1,"content-div"],[3,"click","ngClass"],[1,"sub-content-div"],[1,"span-div"],[1,"highlight"],[1,"normal-text"],[1,"line"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"div",2),Ne("click",function(){return t.navBack()}),U(3,"span",3),X(4,"arrow_back"),W()(),U(5,"div",4),Oe(6,"img",5),W()(),U(7,"div",6)(8,"div",7)(9,"span"),X(10,"Credit balance :"),W(),X(11,"\xA0 "),U(12,"span"),X(13),wl(14,"number"),W()(),U(15,"div")(16,"button",8),Ne("click",function(){return t.navToAddCredit()}),X(17,"Add+"),W()()(),U(18,"div",9)(19,"div",10),qt(20,iB,2,4,"button",11),W(),U(21,"div",12)(22,"div",13),no(23,nB,9,3,null,null,Yo),W()()()()),s&2&&(le(13),Xt(t.credits%1===0?t.credits:Cl(14,2,t.credits,"1.2-2")),le(7),ze("ngForOf",t.buttons),le(3),ro(t.filteredCreditHistory))},dependencies:[Ko,Io,Gc],styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh;align-items:center;text-align:center;display:grid;grid-template-rows:max-content max-content auto;row-gap:2rem;gap:2rem;grid-gap:2rem}.header[_ngcontent-%COMP%]{border:1px solid black;width:90%;height:10rem;display:flex;position:relative;left:5%;top:10%;border-radius:.8rem}.arrow_back[_ngcontent-%COMP%]{width:10%;position:relative;top:8%;left:2%}.logo[_ngcontent-%COMP%]{width:90%;display:flex;justify-content:center;align-items:center}.credit[_ngcontent-%COMP%]{width:90%;height:max-content;display:flex;justify-content:space-between;position:relative;left:5%}.credit-details[_ngcontent-%COMP%]{float:left;text-align:left}.credit-details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:1rem;font-family:"Inter" sans-serif;font-weight:500;line-height:1.2rem}.credit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:4rem;height:2rem;background-color:#5ba36b;color:#fff;border:none;border-radius:.6rem}.sub-container[_ngcontent-%COMP%]{width:90%;height:70vh;position:relative;left:5%}.cat[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px;border-bottom:2px solid transparent;cursor:pointer}.cat[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-bottom:2px solid #f40905}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:border-bottom .3s}.content[_ngcontent-%COMP%]{width:100%;margin-top:.8rem}.content-div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-content-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.span-div[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.highlight[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:16.94px;text-align:left}.normal-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:14.52px;text-align:left}.line[_ngcontent-%COMP%]{margin-top:.5rem;border:none;border-bottom:.25px solid black}']});let c=o;return c})();function rB(c,o){c&1&&(U(0,"span"),X(1,"Name"),W())}function oB(c,o){if(c&1&&(U(0,"span"),X(1),W()),c&2){let d=it();le(),Xt(d.userName)}}function aB(c,o){if(c&1){let d=ai();U(0,"span",20),Ne("click",function(){St(d);let s=it();return It(s.navTo("packages"))}),Oe(1,"img",21),X(2,"\xA0 "),U(3,"p",22),X(4),W()()}if(c&2){let d=it();le(),ze("src",d.packageImage,vr),le(3),Xt(d.packageName)}}function sB(c,o){if(c&1&&(U(0,"div",23)(1,"span",15),X(2,"star"),W(),X(3),W()),c&2){let d=it();le(3),Xt(d.providerRating)}}function lB(c,o){if(c&1){let d=ai();Oe(0,"br"),U(1,"div",10),Ne("click",function(){let s=St(d).$implicit,t=it();return It(t.navTo(s.name))}),U(2,"div",10),Ne("click",function(){let s=St(d).$implicit,t=it();return It(t.navTo(s.name))}),U(3,"span",24),X(4),W(),X(5," \xA0 \xA0 "),U(6,"span"),X(7),W()(),U(8,"span",15),X(9,"arrow_forward_ios"),W()(),Oe(10,"hr")}if(c&2){let d=o.$implicit;le(4),Xt(d.icon),le(3),Xt(d.name)}}var GA=(()=>{let o=class o{constructor(r,s,t,g,w,M,F,N){this.location=r,this.router=s,this.loginService=t,this.jobDetailsService=g,this.ordersService=w,this.razorpayService=M,this.userDetals=F,this.dialougeService=N,this.userName="",this.userImage="",this.whatsAppStaus="on",this.providerRating="",this.packageImage="",this.packageName="",this.options=[{icon:"calendar_today",name:"Calendar"},{icon:"work",name:"Job History"},{icon:"poker_chip",name:"Credits"},{icon:"tv_gen",name:"Training"},{icon:"featured_seasonal_and_gifts",name:"Invite a friend"},{icon:"question_mark",name:"Help Center"},{icon:"emoji_events",name:"Certificate & documents"}]}ngOnInit(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")),this.getUsername(),this.getProviderRating(),this.getPackageDetails()}getProviderRating(){this.jobDetailsService.getRating().subscribe({next:r=>{console.log(r),this.providerRating=r.averageRating},error:r=>{this.providerRating="",console.log(r)}})}getUsername(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r)},complete:()=>{this.userName=this.jobDetailsService.userDetails?.provider.firstName,this.userImage=this.jobDetailsService.userDetails?.provider.image,console.log(this.jobDetailsService.userDetails),console.log(this.userName),this.apiSubscription?.unsubscribe()}})}getPackageDetails(){this.userDetals.getBuyedPackage().subscribe({next:r=>{console.log(r),this.packageImage=r[0].image,this.packageName=r[0].packageName},error:r=>{console.log(r)}})}navTo(r){switch(console.log(r),r){case"Calendar":this.router.navigate(["calender"]);break;case"Job History":this.router.navigate(["jobHistory"]);break;case"Credits":console.log("inside"),this.router.navigate(["credits"]);break;case"Training":this.router.navigate(["training"]);break;case"Invite a friend":this.router.navigate(["referAndEarn"]);break;case"Help Center":this.router.navigate(["help"]);break;case"Certificate & documents":this.router.navigate(["awards"]);break;case"packages":this.router.navigate(["packages"]);break;default:console.log("No matching case found")}}navToFinancial(){this.router.navigate(["financialDetails"])}navBack(){this.location.back()}navToVisiting(){let r=localStorage.getItem("providerId");this.userDetals.getUserDetails(r).subscribe({next:s=>{console.log(s),this.router.navigate(["visitingCard"])},error:s=>{console.log(s),this.dialougeService.openDialog("Provider details are missing"),this.router.navigate(["aboutUser"])}})}logOut(){this.jobDetailsService.setDefault(),this.loginService.setDefult(),this.ordersService.setDefult(),this.razorpayService.setDefault(),this.userDetals.setDefult(),this.loginService.removeUser(),this.router.navigate(["selectAccount"]),localStorage.clear()}statusChange(){this.whatsAppStaus==="on"?this.whatsAppStaus="off":(this.whatsAppStaus="off")&&(this.whatsAppStaus="on")}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(ii),_e(Br),_e(ea),_e(ta),_e(ks),_e(nr),_e(mr))},o.\u0275cmp=Et({type:o,selectors:[["app-menu"]],decls:59,vars:6,consts:[[1,"material-symbols-outlined","notranslate",3,"click"],[1,"container"],[1,"sub-container"],[1,"profile"],[1,"image"],[1,"profile-img",3,"src"],[1,"details"],[1,"details-div"],["class","package",3,"click",4,"ngIf"],["class","rating",4,"ngIf"],[3,"click"],[1,"category"],[1,"updates"],[1,"finacial",3,"click"],[1,"iconss"],[1,"material-symbols-outlined","notranslate"],[1,"finacial"],[1,"fa","fa-whatsapp"],["routerLinkActive","language",1,"finacial",3,"routerLink"],[1,"btn",3,"click"],[1,"package",3,"click"],[1,"package-img",3,"src"],[1,"truncate"],[1,"rating"],[1,"material-symbols-outlined","notranslate",2,"font-size","26px"]],template:function(s,t){s&1&&(Oe(0,"br")(1,"br"),X(2,"\xA0\xA0 \xA0"),U(3,"span",0),Ne("click",function(){return t.navBack()}),X(4,"arrow_back"),W(),Oe(5,"br")(6,"br"),U(7,"div",1)(8,"div",2)(9,"div",3)(10,"div",4),Oe(11,"img",5),W(),U(12,"div",6)(13,"div",7),qt(14,rB,2,0,"span")(15,oB,2,1)(16,aB,5,2,"span",8),W(),qt(17,sB,4,1,"div",9),U(18,"button",10),Ne("click",function(){return t.navToVisiting()}),X(19,"View more"),W()()(),Oe(20,"br"),U(21,"div",11),no(22,lB,11,2,null,null,Yo),W(),Oe(24,"br"),U(25,"div",12)(26,"div",13),Ne("click",function(){return t.navToFinancial()}),U(27,"div",14)(28,"span",15),X(29,"currency_rupee"),W()(),U(30,"div")(31,"span"),X(32,"Financial details"),W(),Oe(33,"br"),X(34," GST,PAN and bank information "),W()(),U(35,"div",16)(36,"div",14),Oe(37,"span",17),W(),U(38,"div")(39,"span"),X(40,"Send whatsApp updates"),W(),Oe(41,"br"),U(42,"span",10),Ne("click",function(){return t.statusChange()}),X(43),W()()(),U(44,"div",18)(45,"div",14)(46,"span",15),X(47,"g_translate"),W()(),U(48,"div")(49,"span"),X(50,"Change language"),W(),Oe(51,"br"),X(52," English "),W()()(),Oe(53,"br"),U(54,"div",19),Ne("click",function(){return t.logOut()}),U(55,"button")(56,"span",15),X(57,"power_settings_new"),W(),X(58,"\xA0 Logout"),W()()()()),s&2&&(le(11),ze("src",t.userImage?t.userImage:"assets/logo/profile.png",vr),le(3),hr(14,t.userName===""?14:15),le(2),ze("ngIf",t.packageImage),le(),ze("ngIf",t.providerRating),le(5),ro(t.options),le(21),Xt(t.whatsAppStaus),le(),ze("routerLink","/language"))},dependencies:[$n,L1,z1],styles:['.container[_ngcontent-%COMP%]{width:90%;height:100vh;padding:1rem}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;left:5%}.profile[_ngcontent-%COMP%]{width:100%;height:9rem;display:flex;align-items:center;justify-content:space-evenly;border:.25px solid black;border-radius:.5rem}.image[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.profile-img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.details[_ngcontent-%COMP%]{width:70%;display:flex;flex-direction:column;text-align:left;gap:.5rem}.details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.5rem;font-family:"Inter" sans-serif;font-weight:500}.details-div[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.package[_ngcontent-%COMP%]{width:8rem;height:auto;padding:0rem .3rem 0;display:flex;justify-content:space-evenly;align-items:center;text-align:center;border:1px solid black;border-radius:.4rem}.package-img[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem}.package[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem}.truncate[_ngcontent-%COMP%]{display:inline-block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-top:.7rem}.details[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:18px;border:none;background-color:transparent;width:max-content;border-bottom:2px solid black;display:flex;align-items:center}.rating[_ngcontent-%COMP%]{display:flex;width:max-content;height:max-content;align-items:center}.category[_ngcontent-%COMP%]{width:100%}.category[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.category[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .finacial[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:500}.updates[_ngcontent-%COMP%]{border:.25px solid black;width:100%;height:11.5rem;border-radius:.5rem;display:flex;flex-direction:column;align-items:center;justify-content:center}.finacial[_ngcontent-%COMP%]{display:flex;width:100%;height:3.2rem}.iconss[_ngcontent-%COMP%]{width:20%;display:flex;justify-content:center;align-items:center;text-align:center}.iconss[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px}.btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:18px;border:none;background-color:transparent;display:flex;align-items:center}.btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;color:red}']});let c=o;return c})();function cB(c,o){c&1&&(U(0,"span"),X(1,"Name"),W())}function dB(c,o){if(c&1&&(U(0,"span"),X(1),W()),c&2){let d=it();le(),Xt(d.userName)}}function uB(c,o){if(c&1&&X(0),c&2){let d=it().$implicit;Ni(" ",d.name," ")}}function hB(c,o){if(c&1&&(U(0,"span"),qt(1,uB,1,1),W()),c&2){let d=o.index;le(),hr(1,d<2?1:-1)}}function mB(c,o){if(c&1&&qt(0,hB,2,1,"span",19),c&2){let d=it();ze("ngForOf",d.workSeleceted)}}var qA=(()=>{let o=class o{constructor(r,s,t,g,w){this.router=r,this.location=s,this.jobDetailsService=t,this.logInService=g,this.userService=w,this.userImage="",this.userName="",this.userId=localStorage.getItem("providerId"),this.workSeleceted=this.jobDetailsService?.userDetails?.work,this.providerRating="",this.certificateImages=[{images:"assets/demo/awards.png"},{images:"assets/demo/certificate2.png"}]}ngOnInit(){this.signingDetails(),this.getWork(),this.getCertificates(),this.getProviderRating()}getProviderRating(){this.jobDetailsService.getRating().subscribe({next:r=>{console.log(r),this.providerRating=r.averageRating},error:r=>{console.log(r)}})}signingDetails(){this.phoneNumber=this.jobDetailsService.userDetails?.providerphone,this.userName=this.jobDetailsService.userDetails?.provider.firstName,this.userImage=this.jobDetailsService.userDetails?.provider.image}getWork(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r);let s=new Set,t=r.works.reduce((g,w)=>(w.categoryId.forEach(M=>{s.has(M._id)||(s.add(M._id),g.push(M))}),g),[]);this.workSeleceted=t,console.log(this.workSeleceted)},r=>{console.log(r)})}getCertificates(){let r=localStorage.getItem("providerId");this.userService.getCertificated(r).subscribe({next:s=>{console.log(s);let t=[];for(let g=0;g<s.length;g++){let w=s[g];t.push({images:w.image})}this.certificateImages=t},error:s=>{console.log(s)},complete:()=>{this.apiSubscription?.unsubscribe()}})}navTo(){this.router.navigate(["manageServices"])}navToBack(){this.location.back()}navToVerification(){this.logInService.isAccountVerify?this.router.navigate(["identityVerification"]):this.router.navigate(["aadharVerify"])}navToCertificates(){this.router.navigate(["awards"])}};o.\u0275fac=function(s){return new(s||o)(_e(ii),_e(yi),_e(ea),_e(Br),_e(nr))},o.\u0275cmp=Et({type:o,selectors:[["app-visiting-card"]],decls:67,vars:8,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"sub-container"],[1,"profile"],[1,"image"],["alt","User Image",3,"src"],[1,"details"],[1,"rating"],[1,"category"],[1,"ids"],[1,"tittle"],[1,"ids",3,"click"],[3,"click"],[1,"tittle2"],[1,"material-symbols-outlined","notranslate"],[1,"awards-div"],[1,"awards"],[3,"src"],[2,"height","3rem"],[4,"ngFor","ngForOf"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"span",1),Ne("click",function(){return t.navToBack()}),X(2,"arrow_back"),W(),Oe(3,"br"),U(4,"div",2)(5,"div",3)(6,"div",4),Oe(7,"img",5),W(),U(8,"div",6),qt(9,cB,2,0,"span")(10,dB,2,1),U(11,"div",7),X(12),W(),qt(13,mB,1,1,"span"),W()(),U(14,"div",8)(15,"div")(16,"div",9)(17,"span",10),X(18,"My Id"),W(),U(19,"span",10),X(20),W()(),Oe(21,"hr"),W(),U(22,"div")(23,"div",11),Ne("click",function(){return t.navTo()}),U(24,"span",10),X(25,"Manage Service"),W(),U(26,"span",10),X(27,"+"),W()(),Oe(28,"hr"),W(),U(29,"div")(30,"div",9)(31,"div",12),Ne("click",function(){return t.navToVerification()}),U(32,"span",10),X(33,"Identity verification"),W(),Oe(34,"br"),U(35,"span",13),X(36,"Identity Proof and Personal details"),W()(),U(37,"span",14),X(38,"arrow_forward_ios"),W()()()(),U(39,"div",15)(40,"span"),X(41,"Award and certificate "),W(),U(42,"div",16)(43,"div"),Oe(44,"img",17),W(),U(45,"div"),Oe(46,"img",17),W()(),U(47,"span",12),Ne("click",function(){return t.navToCertificates()}),X(48,"View More"),W()(),U(49,"div",15)(50,"span"),X(51,"Contact Details"),W(),U(52,"div"),Oe(53,"hr"),W(),U(54,"div")(55,"pre"),X(56,"Phone"),W(),U(57,"span"),X(58),W()(),U(59,"div")(60,"pre"),X(61,"Email"),W(),U(62,"span"),X(63,"abcdgmail.com"),W()()()()(),Oe(64,"br")(65,"br")(66,"div",18)),s&2&&(le(7),ze("src",t.userImage?t.userImage:"assets/logo/profile.png",vr),le(2),hr(9,t.userName===""?9:10),le(3),Ni(" \u2605 ",t.providerRating," "),le(),hr(13,t.workSeleceted?13:-1),le(7),Xt(t.userId),le(24),ze("src",t.certificateImages[0].images,vr),le(2),ze("src",t.certificateImages[0].images,vr),le(12),Xt(t.phoneNumber))},dependencies:[Io],styles:['.container[_ngcontent-%COMP%]{width:100%;margin-bottom:3rem}.material-symbols-outlined[_ngcontent-%COMP%]{margin:1rem}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;left:5%;display:grid;row-gap:2rem}.profile[_ngcontent-%COMP%]{width:100%;height:8rem;display:flex;align-items:center;justify-content:space-evenly;border:.25px solid black;border-radius:.5rem}.image[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.profile[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.details[_ngcontent-%COMP%]{width:70%;height:5rem}.details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:500}.rating[_ngcontent-%COMP%]{display:flex;width:max-content;height:1.3rem;align-items:center;text-align:left}.category[_ngcontent-%COMP%]{width:100%;padding:.5rem;display:flex;flex-direction:column;gap:.8rem}.work-names[_ngcontent-%COMP%]{border:1px solid red;width:100%;display:flex;flex-direction:row}.ids[_ngcontent-%COMP%]{width:100%;height:max-content;display:flex;justify-content:space-between;margin-top:.5rem;margin-bottom:.5rem}.tittle[_ngcontent-%COMP%], .awards-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter"sans-serif;font-weight:500}.tittle2[_ngcontent-%COMP%], pre[_ngcontent-%COMP%]{font-size:1rem;font-family:"Inter"sans-serif;font-weight:400}.awards-div[_ngcontent-%COMP%]{display:grid;row-gap:1rem;border:.25px solid black;border-radius:.5rem;padding:1rem}.awards[_ngcontent-%COMP%]{width:100%;border:1px solid black;display:flex;justify-content:space-between}.awards[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:48%;height:141px}.awards[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}hr[_ngcontent-%COMP%]{color:#000}']});let c=o;return c})();var $A=(()=>{let o=class o{navToBack(){this.location.back()}constructor(r){this.location=r}};o.\u0275fac=function(s){return new(s||o)(_e(yi))},o.\u0275cmp=Et({type:o,selectors:[["app-refer-and-earn"]],decls:54,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"refer-div"],[1,"refer"],[1,"tittle1"],["src","assets\\documents\\invite.png"],[1,"dot"],[1,"line"],[1,"links"],["src","assets\\logo\\whatsup.png"],[1,"material-symbols-outlined","notranslate"],[1,"how"],[1,"steps-div"],[1,"steps"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),Ne("click",function(){return t.navToBack()}),X(3,"arrow_back"),W(),X(4,"\xA0 "),U(5,"span",3),X(6,"Refer and Earn"),W()(),U(7,"div",4)(8,"div",5)(9,"div",6)(10,"div")(11,"span",7),X(12,"Refer and get FREE services "),W(),U(13,"p"),X(14,"Invite your to our company off.You win \u20B9 500 once they take services.They get instant \u20B9 500 "),W()(),U(15,"div"),Oe(16,"img",8),W()(),U(17,"div",9),Oe(18,"div",10),U(19,"span"),X(20,"Refer via"),W(),Oe(21,"div",10),W(),U(22,"div",11)(23,"div"),Oe(24,"img",12)(25,"br"),U(26,"span"),X(27,"Whatsapp"),W()(),U(28,"div")(29,"span",13),X(30,"link"),W(),Oe(31,"br"),U(32,"span"),X(33,"Link"),W()()()(),U(34,"div",14)(35,"span",7),X(36,"How it works?"),W(),Oe(37,"br"),U(38,"div",15)(39,"div",16)(40,"div"),X(41,"1"),W(),U(42,"span"),X(43,"Invite your friends & get rewarded"),W()(),U(44,"div",16)(45,"div"),X(46,"2"),W(),U(47,"span"),X(48,"They get free service on first order"),W()(),U(49,"div",16)(50,"div"),X(51,"3"),W(),U(52,"span"),X(53,"You get reward once their service is completed"),W()()()()()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-rows:auto auto auto;row-gap:30px;align-items:center;text-align:center;justify-content:center}.tittle[_ngcontent-%COMP%]{float:left;font-family:inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:24px}.refer-div[_ngcontent-%COMP%]{border:.25px solid black;border-radius:.5rem}.refer[_ngcontent-%COMP%]{padding:1rem;width:90%;height:max-content;display:flex;border-radius:.4rem}.refer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:92px;height:92px}.dot[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto max-content auto}.dot[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1rem;font-weight:500;line-height:14.52px}.line[_ngcontent-%COMP%]{margin-top:8px;border:none;border-top:1.2px dashed rgb(91,90,90)}.links[_ngcontent-%COMP%]{display:flex;justify-content:space-around;padding:1rem}.tittle1[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:500;line-height:24px}.how[_ngcontent-%COMP%]{width:90%;height:max-content;padding:1rem;border:.25px solid black;border-radius:.5rem;display:grid;text-align:left}.how[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.steps-div[_ngcontent-%COMP%]{display:grid;row-gap:1.5rem}.steps[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background-color:#49a010;color:#fff;align-items:center}.steps[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:80%}']});let c=o;return c})();function pB(c,o){c&1&&(U(0,"div",12)(1,"span"),X(2,"+"),W(),U(3,"span"),X(4,"Add Photo"),W()())}function fB(c,o){if(c&1&&Oe(0,"img",13),c&2){let d=it();ze("src",d.imagePreview,vr)}}function gB(c,o){if(c&1&&(U(0,"div",11),Oe(1,"img",14)(2,"div",15),W()),c&2){let d=o.$implicit;le(),ze("src",d.image,vr)}}var YA=(()=>{let o=class o{navToBack(){this.location.back()}constructor(r,s,t,g){this.location=r,this.http=s,this.fb=t,this.userDetalsService=g,this.apiUrl=_n,this.items=[],this.bucketName="coolie1-dev",this.region="ap-south-1",this.userId=localStorage.getItem("providerId"),this.selectedFile=null,this.selectedDocument=null,this.base64Image=null,this.imagePreview=null,this.documentPreview=null,this.getCertificates(),this.imageForm=this.fb.group({image:"",user:this.userId,isverified:!1}),console.log(this.items)}onFileSelected(r){let s=r.target;if(s.files&&s.files.length>0){this.selectedFile=s.files[0],this.imagePreview=s.files[0];let t=s.files[0],g=new FileReader;g.onload=()=>{this.imagePreview=g.result},g.readAsDataURL(this.selectedFile),console.log("image",this.imagePreview),this.imageForm.value.image=t}this.sending()}onDocumentSelected(r){let s=r.target;if(s.files&&s.files.length>0){this.selectedDocument=s.files[0],this.imagePreview=s.files[0];let t=s.files[0],g=new FileReader;g.onload=()=>{this.imagePreview=g.result},g.readAsDataURL(this.selectedDocument),console.log("image",this.imagePreview,"file",t),this.imageForm.value.image=t}this.sending()}sending(){console.log("sending doc");let r=new FormData;r.append("image",this.imageForm.value.image),r.append("isVerified",this.imageForm.value.isverified),r.append("providerId",this.imageForm.value.user);let s=this.apiUrl+"providers/provider-certificate";this.http.post(s,r).subscribe({next:t=>{console.log(t),this.imageForm.value.image=null,this.imagePreview=null,this.selectedFile=null,this.getCertificates()},error:t=>{console.log(t)}})}getCertificates(){this.userDetalsService.getCertificated(this.userId).subscribe({next:r=>{console.log(r),this.items=r,console.log(this.items[0].image)},error:r=>{console.log(r)},complete:()=>{this.apiSubscription?.unsubscribe()}})}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(ji),_e(qa),_e(nr))},o.\u0275cmp=Et({type:o,selectors:[["app-awards"]],decls:16,vars:3,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"addPhoto"],[1,"file-label"],["class","placeholder-image",4,"ngIf"],["alt","Selected image","class","preview-image",3,"src",4,"ngIf"],[3,"formGroup"],["type","file","id","file-input","required","",1,"file-input",3,"change"],[1,"awards"],[1,"placeholder-image"],["alt","Selected image",1,"preview-image",3,"src"],["alt","Image from AWS S3",3,"src"],[1,"click-blocker"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),Ne("click",function(){return t.navToBack()}),X(3,"arrow_back"),W(),X(4,"\xA0\xA0 "),U(5,"span",3),X(6,"Certificate and Documents"),W()(),U(7,"div",4)(8,"div",5)(9,"label",6),qt(10,pB,5,0,"div",7)(11,fB,1,1,"img",8),W(),U(12,"form",9)(13,"input",10),Ne("change",function(w){return t.onFileSelected(w)}),W()()(),no(14,gB,3,1,"div",11,Yo),W()()),s&2&&(le(10),ze("ngIf",!t.selectedFile),le(),ze("ngIf",t.selectedFile),le(),ze("formGroup",t.imageForm),le(2),ro(t.items))},dependencies:[$n,va,ya,Ga],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-columns:auto auto;row-gap:30px;column-gap:30px;align-items:center;text-align:center;justify-content:space-around}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:24px}.addPhoto[_ngcontent-%COMP%]{width:8.5rem;height:8rem;display:grid;align-items:center;border:1px dashed black}span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:600;line-height:19px}.awards[_ngcontent-%COMP%]{width:8.5rem;height:8rem}.awards[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.file-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:60%;cursor:pointer;position:relative}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.placeholder-image[_ngcontent-%COMP%]{display:grid;row-gap:1rem}.preview-image[_ngcontent-%COMP%]{width:10rem;height:8rem}.awards[_ngcontent-%COMP%]{position:relative}.click-blocker[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:transparent;z-index:1;pointer-events:all}']});let c=o;return c})();var _B=["path"],bB=Math.PI/180,yB=(()=>{let o=class o{constructor(r){this.supportsSvg=!!(r&&r.createElementNS&&r.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect),this.base=r&&r.head.querySelector("base"),this.hasPerf=typeof window<"u"&&window.performance&&window.performance.now&&typeof window.performance.now()=="number"}resolveColor(r){if(this.base&&this.base.href){let s=r.indexOf("#");if(s>-1&&r.indexOf("url")>-1)return r.slice(0,s)+location.href+r.slice(s)}return r}getTimestamp(){return this.hasPerf?window.performance.now():Date.now()}getArc(r,s,t,g,w=!1){let M=Math.max(0,Math.min(r||0,s)),F=w?180:359.9999,N=s===0?F:M/s*F,Q=this._polarToCartesian(g,t,N),ae=this._polarToCartesian(g,t,0),pe=N<=180?0:1;return`M ${Q} A ${t} ${t} 0 ${pe} 0 ${ae}`}_polarToCartesian(r,s,t){let g=(t-90)*bB,w=r+s*Math.cos(g),M=r+s*Math.sin(g);return w+" "+M}};o.\u0275fac=function(s){return new(s||o)(wt(Kn,8))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),ZA={radius:125,animation:"easeOutCubic",animationDelay:void 0,duration:500,stroke:15,color:"#45CCCE",background:"#EAEAEA",responsive:!1,clockwise:!0,semicircle:!1,rounded:!1},XA=new Hn("ROUND_PROGRESS_DEFAULTS",{providedIn:"root",factory:()=>ZA}),vB={provide:XA,useValue:ZA},xB=(()=>{let o=class o{linearEase(r,s,t,g){return t*r/g+s}easeInQuad(r,s,t,g){return t*(r/=g)*r+s}easeOutQuad(r,s,t,g){return-t*(r/=g)*(r-2)+s}easeInOutQuad(r,s,t,g){return(r/=g/2)<1?t/2*r*r+s:-t/2*(--r*(r-2)-1)+s}easeInCubic(r,s,t,g){return t*(r/=g)*r*r+s}easeOutCubic(r,s,t,g){return t*((r=r/g-1)*r*r+1)+s}easeInOutCubic(r,s,t,g){return(r/=g/2)<1?t/2*r*r*r+s:t/2*((r-=2)*r*r+2)+s}easeInQuart(r,s,t,g){return t*(r/=g)*r*r*r+s}easeOutQuart(r,s,t,g){return-t*((r=r/g-1)*r*r*r-1)+s}easeInOutQuart(r,s,t,g){return(r/=g/2)<1?t/2*r*r*r*r+s:-t/2*((r-=2)*r*r*r-2)+s}easeInQuint(r,s,t,g){return t*(r/=g)*r*r*r*r+s}easeOutQuint(r,s,t,g){return t*((r=r/g-1)*r*r*r*r+1)+s}easeInOutQuint(r,s,t,g){return(r/=g/2)<1?t/2*r*r*r*r*r+s:t/2*((r-=2)*r*r*r*r+2)+s}easeInSine(r,s,t,g){return-t*Math.cos(r/g*(Math.PI/2))+t+s}easeOutSine(r,s,t,g){return t*Math.sin(r/g*(Math.PI/2))+s}easeInOutSine(r,s,t,g){return-t/2*(Math.cos(Math.PI*r/g)-1)+s}easeInExpo(r,s,t,g){return r===0?s:t*Math.pow(2,10*(r/g-1))+s}easeOutExpo(r,s,t,g){return r===g?s+t:t*(-Math.pow(2,-10*r/g)+1)+s}easeInOutExpo(r,s,t,g){return r===0?s:r===g?s+t:(r/=g/2)<1?t/2*Math.pow(2,10*(r-1))+s:t/2*(-Math.pow(2,-10*--r)+2)+s}easeInCirc(r,s,t,g){return-t*(Math.sqrt(1-(r/=g)*r)-1)+s}easeOutCirc(r,s,t,g){return t*Math.sqrt(1-(r=r/g-1)*r)+s}easeInOutCirc(r,s,t,g){return(r/=g/2)<1?-t/2*(Math.sqrt(1-r*r)-1)+s:t/2*(Math.sqrt(1-(r-=2)*r)+1)+s}easeInElastic(r,s,t,g){let w=g*.3,M=1.70158,F=t;return r===0?s:(r/=g)===1?s+t:(F<Math.abs(t)?(F=t,M=w/4):M=w/(2*Math.PI)*Math.asin(t/F),-(F*Math.pow(2,10*r--)*Math.sin((r*g-M)*(2*Math.PI)/w))+s)}easeOutElastic(r,s,t,g){let w=g*.3,M=1.70158,F=t;return r===0?s:(r/=g)===1?s+t:(F<Math.abs(t)?(F=t,M=w/4):M=w/(2*Math.PI)*Math.asin(t/F),F*Math.pow(2,-10*r)*Math.sin((r*g-M)*(2*Math.PI)/w)+t+s)}easeInOutElastic(r,s,t,g){let w=g*.44999999999999996,M=1.70158,F=t;return r===0?s:(r/=g/2)===2?s+t:(F<Math.abs(t)?(F=t,M=w/4):M=w/(2*Math.PI)*Math.asin(t/F),r<1?-.5*(F*Math.pow(2,10*(r-=1))*Math.sin((r*g-M)*(2*Math.PI)/w))+s:F*Math.pow(2,-10*(r-=1))*Math.sin((r*g-M)*(2*Math.PI)/w)*.5+t+s)}easeInBack(r,s,t,g,w=1.70158){return t*(r/=g)*r*((w+1)*r-w)+s}easeOutBack(r,s,t,g,w=1.70158){return t*((r=r/g-1)*r*((w+1)*r+w)+1)+s}easeInOutBack(r,s,t,g,w=1.70158){return(r/=g/2)<1?t/2*(r*r*(((w*=1.525)+1)*r-w))+s:t/2*((r-=2)*r*(((w*=1.525)+1)*r+w)+2)+s}easeInBounce(r,s,t,g){return t-this.easeOutBounce(g-r,0,t,g)+s}easeOutBounce(r,s,t,g){return(r/=g)<1/2.75?t*(7.5625*r*r)+s:r<2/2.75?t*(7.5625*(r-=1.5/2.75)*r+.75)+s:r<2.5/2.75?t*(7.5625*(r-=2.25/2.75)*r+.9375)+s:t*(7.5625*(r-=2.625/2.75)*r+.984375)+s}easeInOutBounce(r,s,t,g){return r<g/2?this.easeInBounce(r*2,0,t,g)*.5+s:this.easeOutBounce(r*2-g,0,t,g)*.5+t*.5+s}};o.\u0275fac=function(s){return new(s||o)},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})(),cw=(()=>{let o=class o{constructor(r,s,t,g){this.service=r,this.easing=s,this.defaults=t,this.ngZone=g,this.currentLinecap="",this.current=0,this.max=0,this.radius=this.defaults.radius,this.animation=this.defaults.animation,this.animationDelay=this.defaults.animationDelay,this.duration=this.defaults.duration,this.stroke=this.defaults.stroke,this.color=this.defaults.color,this.background=this.defaults.background,this.responsive=this.defaults.responsive,this.clockwise=this.defaults.clockwise,this.semicircle=this.defaults.semicircle,this.rounded=this.defaults.rounded,this.onRender=new zn,this.lastAnimationId=0}_animateChange(r,s){typeof r!="number"&&(r=0),s=this._clamp(s),r=this._clamp(r);let t=this,g=s-r,w=t.duration;t.ngZone.runOutsideAngular(()=>{let M=()=>{let F=t.service.getTimestamp(),N=++t.lastAnimationId;requestAnimationFrame(function Q(){let ae=Math.min(t.service.getTimestamp()-F,w),pe=t.easing[t.animation],Te=pe(ae,r,g,w);t._updatePath(Te),t.onRender.observers.length>0&&t.onRender.emit(Te),N===t.lastAnimationId&&ae<w&&requestAnimationFrame(Q)})};this.animationDelay>0?setTimeout(M,this.animationDelay):M()})}_updatePath(r){if(this.path){let s=this.service.getArc(r,this.max,this.radius-this.stroke/2,this.radius,this.semicircle),t=this.path.nativeElement,g=this.rounded&&r>0?"round":"";g!==this.currentLinecap&&(this.currentLinecap=g,t.style.strokeLinecap=g),t.setAttribute("d",s)}}_clamp(r){return Math.max(0,Math.min(r||0,this.max))}getPathTransform(){let r=this._getDiameter();return this.semicircle?this.clockwise?`translate(0, ${r}) rotate(-90)`:`translate(${r+","+r}) rotate(90) scale(-1, 1)`:this.clockwise?null:`scale(-1, 1) translate(-${r} 0)`}resolveColor(r){return this.service.resolveColor(r)}ngOnChanges(r){r.current?this._animateChange(r.current.previousValue,r.current.currentValue):this._updatePath(this.current)}_getDiameter(){return this.radius*2}_getElementHeight(){return this.responsive?null:(this.semicircle?this.radius:this._getDiameter())+"px"}_getViewBox(){let r=this._getDiameter();return`0 0 ${r} ${this.semicircle?this.radius:r}`}_getPaddingBottom(){return this.responsive?this.semicircle?"50%":"100%":null}};o.\u0275fac=function(s){return new(s||o)(_e(yB),_e(xB),_e(XA),_e(gn))},o.\u0275cmp=Et({type:o,selectors:[["round-progress"]],viewQuery:function(s,t){if(s&1&&Vi(_B,5),s&2){let g;zi(g=Bi())&&(t.path=g.first)}},hostAttrs:["role","progressbar"],hostVars:11,hostBindings:function(s,t){s&2&&(ir("aria-valuemin",0)("aria-valuemax",t.max)("aria-valuenow",t.current),vl("width",t.responsive?"":t._getDiameter()+"px")("height",t._getElementHeight())("padding-bottom",t._getPaddingBottom()),Ki("responsive",t.responsive))},inputs:{current:"current",max:"max",radius:"radius",animation:"animation",animationDelay:"animationDelay",duration:"duration",stroke:"stroke",color:"color",background:"background",responsive:"responsive",clockwise:"clockwise",semicircle:"semicircle",rounded:"rounded"},outputs:{onRender:"onRender"},standalone:!0,features:[rs,Ur],decls:4,vars:13,consts:[["path",""],["xmlns","http://www.w3.org/2000/svg"],["fill","none"]],template:function(s,t){s&1&&(Yp(),U(0,"svg",1),Oe(1,"circle",2)(2,"path",2,0),W()),s&2&&(ir("viewBox",t._getViewBox()),le(),vl("stroke",t.resolveColor(t.background))("stroke-width",t.stroke),ir("cx",t.radius)("cy",t.radius)("r",t.radius-t.stroke/2),le(),vl("stroke-width",t.stroke)("stroke",t.resolveColor(t.color)),ir("transform",t.getPathTransform()))},styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden}.responsive[_nghost-%COMP%]{width:100%;padding-bottom:100%}.responsive[_nghost-%COMP%] > svg[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0}"],changeDetection:0});let c=o;return c})(),QA=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({providers:[vB]});let c=o;return c})();var JA=c=>({color:c}),wB=c=>({singlePromotion:c});function CB(c,o){if(c&1){let d=ai();U(0,"div",27),Ne("click",function(){St(d);let s=it();return It(s.openPopUp())}),U(1,"div",28)(2,"div"),X(3),W(),U(4,"div",29),X(5),W()(),U(6,"div",30)(7,"div",31),Oe(8,"mat-progress-bar",32),W(),U(9,"span"),X(10),W()()()}if(c&2){let d=o.$implicit,r=it();ze("ngClass",wi(5,wB,r.promos.length===1)),le(3),Xt(d.promoName),le(2),Ni("Get \u20B9",d.bonusAmount,""),le(3),ze("value",r.getProgressPercentage(6,d.numberOfJobs)),le(2),Ni("(",d.numberOfJobs," jobs)")}}function SB(c,o){if(c&1){let d=ai();U(0,"div",33)(1,"div",34)(2,"button",35),Ne("click",function(){St(d);let s=it();return It(s.closePopup())}),X(3,"X"),W(),U(4,"h1",36),X(5,"Task Tigers"),W(),U(6,"h2",37),X(7,'"Double Your Earnings This Month!"'),W(),U(8,"div",38)(9,"div",39)(10,"p"),X(11,"Ready to boost your earnings? This month, we're doubling the rewards for your hard work!"),W(),U(12,"p")(13,"strong"),X(14,"Offer applicable"),W()(),U(15,"p"),X(16,"29-10-2024 To 19-11-2024"),W()(),U(17,"div",40)(18,"div",41)(19,"span",42),X(20,"Get"),W(),U(21,"span",43),X(22,"1000"),W(),U(23,"span",42),X(24,"Bonus"),W()()()(),U(25,"div",44)(26,"h3"),X(27,"Here's how it works"),W(),U(28,"p"),X(29,"- Complete [X] jobs in [X] services and earn [Reward Amount]"),W()(),U(30,"div",45)(31,"strong"),X(32,"Note:"),W(),U(33,"p"),X(34,"Don't miss this limited-time offer. Start accepting more jobs today and watch your earnings soar!"),W()()()()}}var eP=(()=>{let o=class o{constructor(r,s,t,g){this.http=r,this.router=s,this.razorpayService=t,this.jobDetailsService=g,this.apiUrl=_n,this.enteredValue=0,this.maxValue=5,this.minTarget=0,this.min=80,this.isVisible=!0,this.divColor="black",this.providerRating=0,this.creditBalance=50,this.isDrawerOpen=!1,this.current=0,this.max=5,this.radius=150,this.semicircle=!0,this.color="black",this.background="#eaeaea",this.cancelRate=0,this.workingHours=0,this.credits=0,this.promoMilestones=[100,250,400,650],this.colorChange(),this.getTarget(),this.getCredits(),this.getProviderRating(),this.getData()}getCredits(){this.razorpayService.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits},error:r=>{console.log(r)}})}getProviderRating(){this.jobDetailsService.getRating().subscribe({next:r=>{console.log(r),this.providerRating=parseInt(r.averageRating)},error:r=>{console.log(r)}})}colorChange(){this.minTarget<this.min&&(this.divColor="red")}calculateProgress(r,s){let t=r+5;return s===0?0:t/s*100}toggleDrawer(){this.isDrawerOpen=!this.isDrawerOpen,this.router.navigate(["menu"])}increment(r=1){this.current+=r}getOverlayStyle(){let r=this.semicircle,s=(r?"":"translateY(-50%) ")+"translateX(-50%)";return{top:r?"auto":"50%",bottom:r?"5%":"auto",left:"50%",transform:s,"font-size":this.radius/3.5+"px"}}getTarget(){let r=localStorage.getItem("providerId"),s=`${this.apiUrl}providers/service-provider-targets/${r}`;this.http.get(s).subscribe(t=>{console.log(t),this.current=t.specialRating,this.minTarget=t.responseRate,this.cancelRate=t.cancellationRate,this.workingHours=t.totalWorkingHours},t=>{console.log(t)})}getData(){let s=["6701477d6cdbd8a62eb1bafd","6701477d6cdbd8a62eb1bb0","6701477d6cdbd8a62eb1bb03"].map(t=>this.http.get(`${this.apiUrl}admin/admin-provider-promotions/${t}`).pipe(Ro(g=>(console.error(`Error fetching data for ID ${t}:`,g),Ln(null)))));km(s).subscribe(t=>{let g=t.filter(w=>w!==null);console.log(g.flat()),this.promos=g.flat().filter(w=>w.status==="Active")})}getProgressPercentage(r,s){return s===0?0:r/s*100}openPopUp(){this.isVisible=!0}closePopup(){this.isVisible=!1}navTo(r){switch(r){case"credit":this.router.navigate(["credits"]);break;case"notification":this.router.navigate(["notification"]);break;case"buyNow":this.router.navigate(["addCredit"])}}navToDetails(){this.router.navigate(["credits"])}};o.\u0275fac=function(s){return new(s||o)(_e(ji),_e(ii),_e(ks),_e(ea))},o.\u0275cmp=Et({type:o,selectors:[["app-target"]],decls:79,vars:29,consts:[[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined","notranslate"],[1,"sub-container"],[1,"container-target"],[1,"progress-wrapper"],[1,"current",3,"ngStyle"],[3,"current","max","color","background","radius","semicircle","rounded","stroke"],[1,"progress-content"],[1,"fa","fa-star"],[1,"tittle-promotions"],["class","promo-card",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"section-div"],[1,"section"],[1,"info"],[1,"sub-info"],[1,"material-symbols-outlined","notranslate",3,"ngStyle"],[2,"font-size","1.4rem",3,"ngStyle"],[1,"material-symbols-outlined","notranslate",2,"color","red","font-size","28px"],[1,"credit-balance-div"],[3,"click"],["class","overlay",4,"ngIf"],[2,"height","10rem"],[1,"promo-card",3,"click","ngClass"],[1,"promo-header"],[1,"total-pay"],[1,"promo-details"],[1,"progress-bar"],["mode","determinate","color","primary",3,"value"],[1,"overlay"],[1,"popup-content"],[1,"close-button",3,"click"],[1,"popup-title"],[1,"popup-subtitle"],[1,"bonus-img-details"],[1,"offer-details"],[1,"bonus-section"],[1,"burst"],[1,"bonus-text"],[1,"bonus-amount"],[1,"instructions"],[1,"note"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1),Ne("click",function(){return t.toggleDrawer()}),X(2,"\u2630"),W(),U(3,"div",2)(4,"div",3),Ne("click",function(){return t.navTo("credit")}),Oe(5,"img",4),U(6,"pre"),X(7),wl(8,"number"),W()(),U(9,"div",5),Ne("click",function(){return t.navTo("notification")}),U(10,"span",6),X(11,"notifications"),W()()(),U(12,"div",7)(13,"div",8)(14,"div",9)(15,"div",10),X(16),W(),Oe(17,"round-progress",11),U(18,"div",12),Oe(19,"br"),U(20,"div"),Oe(21,"span",13),U(22,"span"),X(23,"Min : 4.7"),W()()()()(),U(24,"div",14)(25,"span"),X(26,"Promotions"),W(),U(27,"u"),X(28,"VIew All"),W()(),qt(29,CB,11,7,"div",15),U(30,"div",16)(31,"div",17)(32,"span",6),X(33,"schedule"),W(),Oe(34,"br")(35,"br"),U(36,"span",18),X(37),W(),Oe(38,"br"),U(39,"span",19),X(40,"Weekend hours"),W()(),U(41,"div",17)(42,"span",20),X(43,"draft"),W(),X(44," \xA0"),U(45,"span",21),X(46,"Min:80%"),W(),Oe(47,"br")(48,"br"),U(49,"span",18),X(50),W(),Oe(51,"br"),U(52,"span",19),X(53,"Response rate"),W()(),U(54,"div",17)(55,"span",22),X(56,"privacy_tip"),W(),Oe(57,"br")(58,"br"),U(59,"span",18),X(60),W(),Oe(61,"br"),U(62,"span",19),X(63,"Cancellation"),W()()(),Oe(64,"br"),U(65,"div",23)(66,"span",19),X(67),wl(68,"number"),W(),Oe(69,"br")(70,"br"),U(71,"div")(72,"button",24),Ne("click",function(){return t.navTo("buyNow")}),X(73,"Buy now"),W(),U(74,"button",24),Ne("click",function(){return t.navToDetails()}),X(75,"See details"),W()()()()(),qt(76,SB,35,0,"div",25),Oe(77,"div",26)(78,"app-fotter")),s&2&&(le(7),Xt(t.credits%1===0?t.credits:Cl(8,19,t.credits,"1.2-2")),le(8),ze("ngStyle",t.getOverlayStyle()),le(),Ni("",t.providerRating,"%"),le(),ze("current",t.providerRating)("max",t.max)("color",t.color)("background",t.background)("radius",t.radius)("semicircle",t.semicircle)("rounded",!0)("stroke",20),le(12),ze("ngForOf",t.promos),le(8),Ni("",t.workingHours," HRS"),le(5),ze("ngStyle",wi(25,JA,t.divColor)),le(3),ze("ngStyle",wi(27,JA,t.divColor)),le(5),Ni("",t.minTarget,"%"),le(10),Xt(t.cancelRate),le(7),Ni("Credit Balance ",t.credits%1===0?t.credits:Cl(68,22,t.credits,"1.2-2"),""),le(9),ze("ngIf",t.isVisible))},dependencies:[Ko,Io,$n,M1,RD,cw,dh,Gc],styles:['.left-half-spinner-container[_ngcontent-%COMP%]{position:relative;width:100px;height:100px;overflow:hidden;transform:rotate(90deg)}.left-half-spinner-container[_ngcontent-%COMP%]   .mat-progress-spinner[_ngcontent-%COMP%]{width:100px;height:100px}.left-half-spinner-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;right:0;width:50%;height:100%;background:#fff;z-index:1}.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%;margin-bottom:5rem}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#000;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:9rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:6rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border:1px solid black;width:2.3rem;border-radius:.4rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh}.section-div[_ngcontent-%COMP%]{display:grid;grid-template-columns:45% 45%;column-gap:2%;width:100%;height:max-content;justify-content:space-around}.section[_ngcontent-%COMP%]{border:.25px solid black;border-radius:.4rem;height:7rem;margin-top:2rem;padding:2rem 1rem 1rem;text-align:left}.info[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:600;line-height:19.36px}.sub-info[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:16.94px}.credit-balance-div[_ngcontent-%COMP%]{width:88%;height:5.5rem;border:.25px solid black;text-align:left;padding:1rem;padding-left:6%;border-radius:.8rem}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:max-content;height:2rem;display:flex;align-items:center;justify-content:center;font-family:"Inter" sans-serif;font-size:14px;font-weight:500;line-height:16.94px;border-radius:.5rem}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#3cc04b;color:#fff;border:none}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:transparent;border:.25 solid black}.credit-balance-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%;display:grid;grid-template-columns:auto auto;column-gap:1rem}cf[_ngcontent-%COMP%]:before, .cf[_ngcontent-%COMP%]:after{content:" ";display:table}.cf[_ngcontent-%COMP%]:after{clear:both}.progress-wrapper[_ngcontent-%COMP%]{position:relative;margin:20px auto;font-size:40px}.current[_ngcontent-%COMP%]{position:absolute;color:#bbb;font-weight:100;line-height:1}round-progress[_ngcontent-%COMP%]{margin:auto}.container-target[_ngcontent-%COMP%]{width:100%;text-align:center;padding-bottom:40px;background:#fff;border:solid 1px #ccc;border-radius:4px}button[_ngcontent-%COMP%]{display:inline-block;padding:10px 20px;background:#45ccce;color:#fff;font-size:16px;border:none;cursor:pointer;border-radius:4px;text-align:center;margin:0 5px 5px 0}button[_ngcontent-%COMP%]:nth-child(2){color:#000;border:.25px solid black;border-radius:4px;display:inline-block;text-align:center}form[_ngcontent-%COMP%]{text-align:left;max-width:350px;margin:30px auto}form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:15px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{float:right;padding:5px;width:150px}input[type=checkbox][_ngcontent-%COMP%]{width:auto}input[type=color][_ngcontent-%COMP%]{height:30px}.back[_ngcontent-%COMP%]{position:fixed;top:5px;right:5px}.progress-container[_ngcontent-%COMP%]   round-progress[_ngcontent-%COMP%]{position:relative;z-index:1}.progress-content[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(-50%,-50%);text-align:center;font-size:1.1rem;font-weight:400;line-height:1.2;z-index:2}.progress-content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;top:.5rem;display:flex;flex-direction:column}@media (max-width: 650px){.back[_ngcontent-%COMP%]{position:static;display:block;text-align:center}h2[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]{margin-bottom:20px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;margin-top:5px;float:none}}.tittle-promotions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:700;margin:16px 0 10px}.promo-card[_ngcontent-%COMP%]{width:80%;border:1px solid #ddd;border-radius:8px;padding:16px}.singlePromotion[_ngcontent-%COMP%]{width:auto}.promo-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:700}.promo-details[_ngcontent-%COMP%]{margin-top:8px;display:flex;justify-content:space-between}.label[_ngcontent-%COMP%]{color:gray;margin-bottom:4px}.progress-bar[_ngcontent-%COMP%]{width:80%;display:flex;justify-content:space-between;align-items:center}.milestone[_ngcontent-%COMP%]{position:relative;font-size:14px}.overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000;overflow-y:auto}.popup-content[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;padding:20px;width:80%;max-width:500px;box-shadow:0 4px 8px #0000001a;position:relative}.close-button[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:none;border:none;font-size:20px;cursor:pointer;color:red}.bonus-section[_ngcontent-%COMP%]{width:100%;height:7rem;display:flex;justify-content:center;align-items:center}.bonus-img-details[_ngcontent-%COMP%]{display:flex;width:100%}.burst[_ngcontent-%COMP%]{width:120px;position:relative;display:inline-block;background-image:url(/assets/new/promotion/promotion.png);background-size:cover;background-position:center;padding:20px;font-family:Arial,sans-serif;font-weight:700;color:#000}.bonus-text[_ngcontent-%COMP%]{display:block;font-size:12px;margin-left:20px}.bonus-amount[_ngcontent-%COMP%]{font-size:23px;color:#d85a00;margin-left:20px}']});let c=o;return c})();function Ky(c){return c+.5|0}var of=(c,o,d)=>Math.max(Math.min(c,d),o);function Xy(c){return of(Ky(c*2.55),0,255)}function af(c){return of(Ky(c*255),0,255)}function Nm(c){return of(Ky(c/2.55)/100,0,1)}function tP(c){return of(Ky(c*100),0,100)}var Xc={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},tT=[..."0123456789ABCDEF"],IB=c=>tT[c&15],TB=c=>tT[(c&240)>>4]+tT[c&15],dw=c=>(c&240)>>4===(c&15),MB=c=>dw(c.r)&&dw(c.g)&&dw(c.b)&&dw(c.a);function kB(c){var o=c.length,d;return c[0]==="#"&&(o===4||o===5?d={r:255&Xc[c[1]]*17,g:255&Xc[c[2]]*17,b:255&Xc[c[3]]*17,a:o===5?Xc[c[4]]*17:255}:(o===7||o===9)&&(d={r:Xc[c[1]]<<4|Xc[c[2]],g:Xc[c[3]]<<4|Xc[c[4]],b:Xc[c[5]]<<4|Xc[c[6]],a:o===9?Xc[c[7]]<<4|Xc[c[8]]:255})),d}var EB=(c,o)=>c<255?o(c):"";function DB(c){var o=MB(c)?IB:TB;return c?"#"+o(c.r)+o(c.g)+o(c.b)+EB(c.a,o):void 0}var AB=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function oP(c,o,d){let r=o*Math.min(d,1-d),s=(t,g=(t+c/30)%12)=>d-r*Math.max(Math.min(g-3,9-g,1),-1);return[s(0),s(8),s(4)]}function PB(c,o,d){let r=(s,t=(s+c/60)%6)=>d-d*o*Math.max(Math.min(t,4-t,1),0);return[r(5),r(3),r(1)]}function OB(c,o,d){let r=oP(c,1,.5),s;for(o+d>1&&(s=1/(o+d),o*=s,d*=s),s=0;s<3;s++)r[s]*=1-o-d,r[s]+=o;return r}function RB(c,o,d,r,s){return c===s?(o-d)/r+(o<d?6:0):o===s?(d-c)/r+2:(c-o)/r+4}function iT(c){let d=c.r/255,r=c.g/255,s=c.b/255,t=Math.max(d,r,s),g=Math.min(d,r,s),w=(t+g)/2,M,F,N;return t!==g&&(N=t-g,F=w>.5?N/(2-t-g):N/(t+g),M=RB(d,r,s,N,t),M=M*60+.5),[M|0,F||0,w]}function nT(c,o,d,r){return(Array.isArray(o)?c(o[0],o[1],o[2]):c(o,d,r)).map(af)}function rT(c,o,d){return nT(oP,c,o,d)}function FB(c,o,d){return nT(OB,c,o,d)}function LB(c,o,d){return nT(PB,c,o,d)}function aP(c){return(c%360+360)%360}function zB(c){let o=AB.exec(c),d=255,r;if(!o)return;o[5]!==r&&(d=o[6]?Xy(+o[5]):af(+o[5]));let s=aP(+o[2]),t=+o[3]/100,g=+o[4]/100;return o[1]==="hwb"?r=FB(s,t,g):o[1]==="hsv"?r=LB(s,t,g):r=rT(s,t,g),{r:r[0],g:r[1],b:r[2],a:d}}function BB(c,o){var d=iT(c);d[0]=aP(d[0]+o),d=rT(d),c.r=d[0],c.g=d[1],c.b=d[2]}function NB(c){if(!c)return;let o=iT(c),d=o[0],r=tP(o[1]),s=tP(o[2]);return c.a<255?`hsla(${d}, ${r}%, ${s}%, ${Nm(c.a)})`:`hsl(${d}, ${r}%, ${s}%)`}var iP={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},nP={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function VB(){let c={},o=Object.keys(nP),d=Object.keys(iP),r,s,t,g,w;for(r=0;r<o.length;r++){for(g=w=o[r],s=0;s<d.length;s++)t=d[s],w=w.replace(t,iP[t]);t=parseInt(nP[g],16),c[w]=[t>>16&255,t>>8&255,t&255]}return c}var uw;function jB(c){uw||(uw=VB(),uw.transparent=[0,0,0,0]);let o=uw[c.toLowerCase()];return o&&{r:o[0],g:o[1],b:o[2],a:o.length===4?o[3]:255}}var UB=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function WB(c){let o=UB.exec(c),d=255,r,s,t;if(o){if(o[7]!==r){let g=+o[7];d=o[8]?Xy(g):of(g*255,0,255)}return r=+o[1],s=+o[3],t=+o[5],r=255&(o[2]?Xy(r):of(r,0,255)),s=255&(o[4]?Xy(s):of(s,0,255)),t=255&(o[6]?Xy(t):of(t,0,255)),{r,g:s,b:t,a:d}}}function HB(c){return c&&(c.a<255?`rgba(${c.r}, ${c.g}, ${c.b}, ${Nm(c.a)})`:`rgb(${c.r}, ${c.g}, ${c.b})`)}var eT=c=>c<=.0031308?c*12.92:Math.pow(c,1/2.4)*1.055-.055,F0=c=>c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4);function GB(c,o,d){let r=F0(Nm(c.r)),s=F0(Nm(c.g)),t=F0(Nm(c.b));return{r:af(eT(r+d*(F0(Nm(o.r))-r))),g:af(eT(s+d*(F0(Nm(o.g))-s))),b:af(eT(t+d*(F0(Nm(o.b))-t))),a:c.a+d*(o.a-c.a)}}function hw(c,o,d){if(c){let r=iT(c);r[o]=Math.max(0,Math.min(r[o]+r[o]*d,o===0?360:1)),r=rT(r),c.r=r[0],c.g=r[1],c.b=r[2]}}function sP(c,o){return c&&Object.assign(o||{},c)}function rP(c){var o={r:0,g:0,b:0,a:255};return Array.isArray(c)?c.length>=3&&(o={r:c[0],g:c[1],b:c[2],a:255},c.length>3&&(o.a=af(c[3]))):(o=sP(c,{r:0,g:0,b:0,a:1}),o.a=af(o.a)),o}function qB(c){return c.charAt(0)==="r"?WB(c):zB(c)}var Qy=class c{constructor(o){if(o instanceof c)return o;let d=typeof o,r;d==="object"?r=rP(o):d==="string"&&(r=kB(o)||jB(o)||qB(o)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var o=sP(this._rgb);return o&&(o.a=Nm(o.a)),o}set rgb(o){this._rgb=rP(o)}rgbString(){return this._valid?HB(this._rgb):void 0}hexString(){return this._valid?DB(this._rgb):void 0}hslString(){return this._valid?NB(this._rgb):void 0}mix(o,d){if(o){let r=this.rgb,s=o.rgb,t,g=d===t?.5:d,w=2*g-1,M=r.a-s.a,F=((w*M===-1?w:(w+M)/(1+w*M))+1)/2;t=1-F,r.r=255&F*r.r+t*s.r+.5,r.g=255&F*r.g+t*s.g+.5,r.b=255&F*r.b+t*s.b+.5,r.a=g*r.a+(1-g)*s.a,this.rgb=r}return this}interpolate(o,d){return o&&(this._rgb=GB(this._rgb,o._rgb,d)),this}clone(){return new c(this.rgb)}alpha(o){return this._rgb.a=af(o),this}clearer(o){let d=this._rgb;return d.a*=1-o,this}greyscale(){let o=this._rgb,d=Ky(o.r*.3+o.g*.59+o.b*.11);return o.r=o.g=o.b=d,this}opaquer(o){let d=this._rgb;return d.a*=1+o,this}negate(){let o=this._rgb;return o.r=255-o.r,o.g=255-o.g,o.b=255-o.b,this}lighten(o){return hw(this._rgb,2,o),this}darken(o){return hw(this._rgb,2,-o),this}saturate(o){return hw(this._rgb,1,o),this}desaturate(o){return hw(this._rgb,1,-o),this}rotate(o){return BB(this._rgb,o),this}};function mh(){}var bP=(()=>{let c=0;return()=>c++})();function pr(c){return c===null||typeof c>"u"}function uo(c){if(Array.isArray&&Array.isArray(c))return!0;let o=Object.prototype.toString.call(c);return o.slice(0,7)==="[object"&&o.slice(-6)==="Array]"}function Jn(c){return c!==null&&Object.prototype.toString.call(c)==="[object Object]"}function Fo(c){return(typeof c=="number"||c instanceof Number)&&isFinite(+c)}function Dl(c,o){return Fo(c)?c:o}function An(c,o){return typeof c>"u"?o:c}var yP=(c,o)=>typeof c=="string"&&c.endsWith("%")?parseFloat(c)/100:+c/o,lT=(c,o)=>typeof c=="string"&&c.endsWith("%")?parseFloat(c)/100*o:+c;function so(c,o,d){if(c&&typeof c.call=="function")return c.apply(d,o)}function Nr(c,o,d,r){let s,t,g;if(uo(c))if(t=c.length,r)for(s=t-1;s>=0;s--)o.call(d,c[s],s);else for(s=0;s<t;s++)o.call(d,c[s],s);else if(Jn(c))for(g=Object.keys(c),t=g.length,s=0;s<t;s++)o.call(d,c[g[s]],g[s])}function tv(c,o){let d,r,s,t;if(!c||!o||c.length!==o.length)return!1;for(d=0,r=c.length;d<r;++d)if(s=c[d],t=o[d],s.datasetIndex!==t.datasetIndex||s.index!==t.index)return!1;return!0}function gw(c){if(uo(c))return c.map(gw);if(Jn(c)){let o=Object.create(null),d=Object.keys(c),r=d.length,s=0;for(;s<r;++s)o[d[s]]=gw(c[d[s]]);return o}return c}function vP(c){return["__proto__","prototype","constructor"].indexOf(c)===-1}function $B(c,o,d,r){if(!vP(c))return;let s=o[c],t=d[c];Jn(s)&&Jn(t)?z0(s,t,r):o[c]=gw(t)}function z0(c,o,d){let r=uo(o)?o:[o],s=r.length;if(!Jn(c))return c;d=d||{};let t=d.merger||$B,g;for(let w=0;w<s;++w){if(g=r[w],!Jn(g))continue;let M=Object.keys(g);for(let F=0,N=M.length;F<N;++F)t(M[F],c,g,d)}return c}function N0(c,o){return z0(c,o,{merger:YB})}function YB(c,o,d){if(!vP(c))return;let r=o[c],s=d[c];Jn(r)&&Jn(s)?N0(r,s):Object.prototype.hasOwnProperty.call(o,c)||(o[c]=gw(s))}var lP={"":c=>c,x:c=>c.x,y:c=>c.y};function ZB(c){let o=c.split("."),d=[],r="";for(let s of o)r+=s,r.endsWith("\\")?r=r.slice(0,-1)+".":(d.push(r),r="");return d}function XB(c){let o=ZB(c);return d=>{for(let r of o){if(r==="")break;d=d&&d[r]}return d}}function Um(c,o){return(lP[o]||(lP[o]=XB(o)))(c)}function vw(c){return c.charAt(0).toUpperCase()+c.slice(1)}var V0=c=>typeof c<"u",Vm=c=>typeof c=="function",cT=(c,o)=>{if(c.size!==o.size)return!1;for(let d of c)if(!o.has(d))return!1;return!0};function xP(c){return c.type==="mouseup"||c.type==="click"||c.type==="contextmenu"}var ho=Math.PI,mo=2*ho,QB=mo+ho,_w=Number.POSITIVE_INFINITY,KB=ho/180,ia=ho/2,Ng=ho/4,cP=ho*2/3,jm=Math.log10,Zd=Math.sign;function j0(c,o,d){return Math.abs(c-o)<d}function dT(c){let o=Math.round(c);c=j0(c,o,c/1e3)?o:c;let d=Math.pow(10,Math.floor(jm(c))),r=c/d;return(r<=1?1:r<=2?2:r<=5?5:10)*d}function wP(c){let o=[],d=Math.sqrt(c),r;for(r=1;r<d;r++)c%r===0&&(o.push(r),o.push(c/r));return d===(d|0)&&o.push(d),o.sort((s,t)=>s-t).pop(),o}function Ug(c){return!isNaN(parseFloat(c))&&isFinite(c)}function CP(c,o){let d=Math.round(c);return d-o<=c&&d+o>=c}function uT(c,o,d){let r,s,t;for(r=0,s=c.length;r<s;r++)t=c[r][d],isNaN(t)||(o.min=Math.min(o.min,t),o.max=Math.max(o.max,t))}function Qc(c){return c*(ho/180)}function xw(c){return c*(180/ho)}function hT(c){if(!Fo(c))return;let o=1,d=0;for(;Math.round(c*o)/o!==c;)o*=10,d++;return d}function mT(c,o){let d=o.x-c.x,r=o.y-c.y,s=Math.sqrt(d*d+r*r),t=Math.atan2(r,d);return t<-.5*ho&&(t+=mo),{angle:t,distance:s}}function bw(c,o){return Math.sqrt(Math.pow(o.x-c.x,2)+Math.pow(o.y-c.y,2))}function JB(c,o){return(c-o+QB)%mo-ho}function El(c){return(c%mo+mo)%mo}function U0(c,o,d,r){let s=El(c),t=El(o),g=El(d),w=El(t-s),M=El(g-s),F=El(s-t),N=El(s-g);return s===t||s===g||r&&t===g||w>M&&F<N}function Ra(c,o,d){return Math.max(o,Math.min(d,c))}function SP(c){return Ra(c,-32768,32767)}function ph(c,o,d,r=1e-6){return c>=Math.min(o,d)-r&&c<=Math.max(o,d)+r}function ww(c,o,d){d=d||(g=>c[g]<o);let r=c.length-1,s=0,t;for(;r-s>1;)t=s+r>>1,d(t)?s=t:r=t;return{lo:s,hi:r}}var uh=(c,o,d,r)=>ww(c,d,r?s=>{let t=c[s][o];return t<d||t===d&&c[s+1][o]===d}:s=>c[s][o]<d),IP=(c,o,d)=>ww(c,d,r=>c[r][o]>=d);function TP(c,o,d){let r=0,s=c.length;for(;r<s&&c[r]<o;)r++;for(;s>r&&c[s-1]>d;)s--;return r>0||s<c.length?c.slice(r,s):c}var MP=["push","pop","shift","splice","unshift"];function kP(c,o){if(c._chartjs){c._chartjs.listeners.push(o);return}Object.defineProperty(c,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[o]}}),MP.forEach(d=>{let r="_onData"+vw(d),s=c[d];Object.defineProperty(c,d,{configurable:!0,enumerable:!1,value(...t){let g=s.apply(this,t);return c._chartjs.listeners.forEach(w=>{typeof w[r]=="function"&&w[r](...t)}),g}})})}function pT(c,o){let d=c._chartjs;if(!d)return;let r=d.listeners,s=r.indexOf(o);s!==-1&&r.splice(s,1),!(r.length>0)&&(MP.forEach(t=>{delete c[t]}),delete c._chartjs)}function fT(c){let o=new Set(c);return o.size===c.length?c:Array.from(o)}var gT=function(){return typeof window>"u"?function(c){return c()}:window.requestAnimationFrame}();function _T(c,o){let d=[],r=!1;return function(...s){d=s,r||(r=!0,gT.call(window,()=>{r=!1,c.apply(o,d)}))}}function EP(c,o){let d;return function(...r){return o?(clearTimeout(d),d=setTimeout(c,o,r)):c.apply(this,r),o}}var Cw=c=>c==="start"?"left":c==="end"?"right":"center",ls=(c,o,d)=>c==="start"?o:c==="end"?d:(o+d)/2,DP=(c,o,d,r)=>c===(r?"left":"right")?d:c==="center"?(o+d)/2:o;function bT(c,o,d){let r=o.length,s=0,t=r;if(c._sorted){let{iScale:g,_parsed:w}=c,M=g.axis,{min:F,max:N,minDefined:Q,maxDefined:ae}=g.getUserBounds();Q&&(s=Ra(Math.min(uh(w,M,F).lo,d?r:uh(o,M,g.getPixelForValue(F)).lo),0,r-1)),ae?t=Ra(Math.max(uh(w,g.axis,N,!0).hi+1,d?0:uh(o,M,g.getPixelForValue(N),!0).hi+1),s,r)-s:t=r-s}return{start:s,count:t}}function yT(c){let{xScale:o,yScale:d,_scaleRanges:r}=c,s={xmin:o.min,xmax:o.max,ymin:d.min,ymax:d.max};if(!r)return c._scaleRanges=s,!0;let t=r.xmin!==o.min||r.xmax!==o.max||r.ymin!==d.min||r.ymax!==d.max;return Object.assign(r,s),t}var mw=c=>c===0||c===1,dP=(c,o,d)=>-(Math.pow(2,10*(c-=1))*Math.sin((c-o)*mo/d)),uP=(c,o,d)=>Math.pow(2,-10*c)*Math.sin((c-o)*mo/d)+1,L0={linear:c=>c,easeInQuad:c=>c*c,easeOutQuad:c=>-c*(c-2),easeInOutQuad:c=>(c/=.5)<1?.5*c*c:-.5*(--c*(c-2)-1),easeInCubic:c=>c*c*c,easeOutCubic:c=>(c-=1)*c*c+1,easeInOutCubic:c=>(c/=.5)<1?.5*c*c*c:.5*((c-=2)*c*c+2),easeInQuart:c=>c*c*c*c,easeOutQuart:c=>-((c-=1)*c*c*c-1),easeInOutQuart:c=>(c/=.5)<1?.5*c*c*c*c:-.5*((c-=2)*c*c*c-2),easeInQuint:c=>c*c*c*c*c,easeOutQuint:c=>(c-=1)*c*c*c*c+1,easeInOutQuint:c=>(c/=.5)<1?.5*c*c*c*c*c:.5*((c-=2)*c*c*c*c+2),easeInSine:c=>-Math.cos(c*ia)+1,easeOutSine:c=>Math.sin(c*ia),easeInOutSine:c=>-.5*(Math.cos(ho*c)-1),easeInExpo:c=>c===0?0:Math.pow(2,10*(c-1)),easeOutExpo:c=>c===1?1:-Math.pow(2,-10*c)+1,easeInOutExpo:c=>mw(c)?c:c<.5?.5*Math.pow(2,10*(c*2-1)):.5*(-Math.pow(2,-10*(c*2-1))+2),easeInCirc:c=>c>=1?c:-(Math.sqrt(1-c*c)-1),easeOutCirc:c=>Math.sqrt(1-(c-=1)*c),easeInOutCirc:c=>(c/=.5)<1?-.5*(Math.sqrt(1-c*c)-1):.5*(Math.sqrt(1-(c-=2)*c)+1),easeInElastic:c=>mw(c)?c:dP(c,.075,.3),easeOutElastic:c=>mw(c)?c:uP(c,.075,.3),easeInOutElastic(c){return mw(c)?c:c<.5?.5*dP(c*2,.1125,.45):.5+.5*uP(c*2-1,.1125,.45)},easeInBack(c){return c*c*((1.70158+1)*c-1.70158)},easeOutBack(c){return(c-=1)*c*((1.70158+1)*c+1.70158)+1},easeInOutBack(c){let o=1.70158;return(c/=.5)<1?.5*(c*c*(((o*=1.525)+1)*c-o)):.5*((c-=2)*c*(((o*=1.525)+1)*c+o)+2)},easeInBounce:c=>1-L0.easeOutBounce(1-c),easeOutBounce(c){return c<1/2.75?7.5625*c*c:c<2/2.75?7.5625*(c-=1.5/2.75)*c+.75:c<2.5/2.75?7.5625*(c-=2.25/2.75)*c+.9375:7.5625*(c-=2.625/2.75)*c+.984375},easeInOutBounce:c=>c<.5?L0.easeInBounce(c*2)*.5:L0.easeOutBounce(c*2-1)*.5+.5};function vT(c){if(c&&typeof c=="object"){let o=c.toString();return o==="[object CanvasPattern]"||o==="[object CanvasGradient]"}return!1}function xT(c){return vT(c)?c:new Qy(c)}function oT(c){return vT(c)?c:new Qy(c).saturate(.5).darken(.1).hexString()}var eN=["x","y","borderWidth","radius","tension"],tN=["color","borderColor","backgroundColor"];function iN(c){c.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),c.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:o=>o!=="onProgress"&&o!=="onComplete"&&o!=="fn"}),c.set("animations",{colors:{type:"color",properties:tN},numbers:{type:"number",properties:eN}}),c.describe("animations",{_fallback:"animation"}),c.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:o=>o|0}}}})}function nN(c){c.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}var hP=new Map;function rN(c,o){o=o||{};let d=c+JSON.stringify(o),r=hP.get(d);return r||(r=new Intl.NumberFormat(c,o),hP.set(d,r)),r}function W0(c,o,d){return rN(o,d).format(c)}var AP={values(c){return uo(c)?c:""+c},numeric(c,o,d){if(c===0)return"0";let r=this.chart.options.locale,s,t=c;if(d.length>1){let F=Math.max(Math.abs(d[0].value),Math.abs(d[d.length-1].value));(F<1e-4||F>1e15)&&(s="scientific"),t=oN(c,d)}let g=jm(Math.abs(t)),w=isNaN(g)?1:Math.max(Math.min(-1*Math.floor(g),20),0),M={notation:s,minimumFractionDigits:w,maximumFractionDigits:w};return Object.assign(M,this.options.ticks.format),W0(c,r,M)},logarithmic(c,o,d){if(c===0)return"0";let r=d[o].significand||c/Math.pow(10,Math.floor(jm(c)));return[1,2,3,5,10,15].includes(r)||o>.8*d.length?AP.numeric.call(this,c,o,d):""}};function oN(c,o){let d=o.length>3?o[2].value-o[1].value:o[1].value-o[0].value;return Math.abs(d)>=1&&c!==Math.floor(c)&&(d=c-Math.floor(c)),d}var iv={formatters:AP};function aN(c){c.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(o,d)=>d.lineWidth,tickColor:(o,d)=>d.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:iv.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),c.route("scale.ticks","color","","color"),c.route("scale.grid","color","","borderColor"),c.route("scale.border","color","","borderColor"),c.route("scale.title","color","","color"),c.describe("scale",{_fallback:!1,_scriptable:o=>!o.startsWith("before")&&!o.startsWith("after")&&o!=="callback"&&o!=="parser",_indexable:o=>o!=="borderDash"&&o!=="tickBorderDash"&&o!=="dash"}),c.describe("scales",{_fallback:"scale"}),c.describe("scale.ticks",{_scriptable:o=>o!=="backdropPadding"&&o!=="callback",_indexable:o=>o!=="backdropPadding"})}var lf=Object.create(null),Sw=Object.create(null);function Jy(c,o){if(!o)return c;let d=o.split(".");for(let r=0,s=d.length;r<s;++r){let t=d[r];c=c[t]||(c[t]=Object.create(null))}return c}function aT(c,o,d){return typeof o=="string"?z0(Jy(c,o),d):z0(Jy(c,""),o)}var sT=class{constructor(o,d){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,s)=>oT(s.backgroundColor),this.hoverBorderColor=(r,s)=>oT(s.borderColor),this.hoverColor=(r,s)=>oT(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(o),this.apply(d)}set(o,d){return aT(this,o,d)}get(o){return Jy(this,o)}describe(o,d){return aT(Sw,o,d)}override(o,d){return aT(lf,o,d)}route(o,d,r,s){let t=Jy(this,o),g=Jy(this,r),w="_"+d;Object.defineProperties(t,{[w]:{value:t[d],writable:!0},[d]:{enumerable:!0,get(){let M=this[w],F=g[s];return Jn(M)?Object.assign({},F,M):An(M,F)},set(M){this[w]=M}}})}apply(o){o.forEach(d=>d(this))}},Lo=new sT({_scriptable:c=>!c.startsWith("on"),_indexable:c=>c!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[iN,nN,aN]);function sN(c){return!c||pr(c.size)||pr(c.family)?null:(c.style?c.style+" ":"")+(c.weight?c.weight+" ":"")+c.size+"px "+c.family}function ev(c,o,d,r,s){let t=o[s];return t||(t=o[s]=c.measureText(s).width,d.push(s)),t>r&&(r=t),r}function PP(c,o,d,r){r=r||{};let s=r.data=r.data||{},t=r.garbageCollect=r.garbageCollect||[];r.font!==o&&(s=r.data={},t=r.garbageCollect=[],r.font=o),c.save(),c.font=o;let g=0,w=d.length,M,F,N,Q,ae;for(M=0;M<w;M++)if(Q=d[M],Q!=null&&!uo(Q))g=ev(c,s,t,g,Q);else if(uo(Q))for(F=0,N=Q.length;F<N;F++)ae=Q[F],ae!=null&&!uo(ae)&&(g=ev(c,s,t,g,ae));c.restore();let pe=t.length/2;if(pe>d.length){for(M=0;M<pe;M++)delete s[t[M]];t.splice(0,pe)}return g}function cf(c,o,d){let r=c.currentDevicePixelRatio,s=d!==0?Math.max(d/2,.5):0;return Math.round((o-s)*r)/r+s}function wT(c,o){!o&&!c||(o=o||c.getContext("2d"),o.save(),o.resetTransform(),o.clearRect(0,0,c.width,c.height),o.restore())}function Iw(c,o,d,r){CT(c,o,d,r,null)}function CT(c,o,d,r,s){let t,g,w,M,F,N,Q,ae,pe=o.pointStyle,Te=o.rotation,Pe=o.radius,Re=(Te||0)*KB;if(pe&&typeof pe=="object"&&(t=pe.toString(),t==="[object HTMLImageElement]"||t==="[object HTMLCanvasElement]")){c.save(),c.translate(d,r),c.rotate(Re),c.drawImage(pe,-pe.width/2,-pe.height/2,pe.width,pe.height),c.restore();return}if(!(isNaN(Pe)||Pe<=0)){switch(c.beginPath(),pe){default:s?c.ellipse(d,r,s/2,Pe,0,0,mo):c.arc(d,r,Pe,0,mo),c.closePath();break;case"triangle":N=s?s/2:Pe,c.moveTo(d+Math.sin(Re)*N,r-Math.cos(Re)*Pe),Re+=cP,c.lineTo(d+Math.sin(Re)*N,r-Math.cos(Re)*Pe),Re+=cP,c.lineTo(d+Math.sin(Re)*N,r-Math.cos(Re)*Pe),c.closePath();break;case"rectRounded":F=Pe*.516,M=Pe-F,g=Math.cos(Re+Ng)*M,Q=Math.cos(Re+Ng)*(s?s/2-F:M),w=Math.sin(Re+Ng)*M,ae=Math.sin(Re+Ng)*(s?s/2-F:M),c.arc(d-Q,r-w,F,Re-ho,Re-ia),c.arc(d+ae,r-g,F,Re-ia,Re),c.arc(d+Q,r+w,F,Re,Re+ia),c.arc(d-ae,r+g,F,Re+ia,Re+ho),c.closePath();break;case"rect":if(!Te){M=Math.SQRT1_2*Pe,N=s?s/2:M,c.rect(d-N,r-M,2*N,2*M);break}Re+=Ng;case"rectRot":Q=Math.cos(Re)*(s?s/2:Pe),g=Math.cos(Re)*Pe,w=Math.sin(Re)*Pe,ae=Math.sin(Re)*(s?s/2:Pe),c.moveTo(d-Q,r-w),c.lineTo(d+ae,r-g),c.lineTo(d+Q,r+w),c.lineTo(d-ae,r+g),c.closePath();break;case"crossRot":Re+=Ng;case"cross":Q=Math.cos(Re)*(s?s/2:Pe),g=Math.cos(Re)*Pe,w=Math.sin(Re)*Pe,ae=Math.sin(Re)*(s?s/2:Pe),c.moveTo(d-Q,r-w),c.lineTo(d+Q,r+w),c.moveTo(d+ae,r-g),c.lineTo(d-ae,r+g);break;case"star":Q=Math.cos(Re)*(s?s/2:Pe),g=Math.cos(Re)*Pe,w=Math.sin(Re)*Pe,ae=Math.sin(Re)*(s?s/2:Pe),c.moveTo(d-Q,r-w),c.lineTo(d+Q,r+w),c.moveTo(d+ae,r-g),c.lineTo(d-ae,r+g),Re+=Ng,Q=Math.cos(Re)*(s?s/2:Pe),g=Math.cos(Re)*Pe,w=Math.sin(Re)*Pe,ae=Math.sin(Re)*(s?s/2:Pe),c.moveTo(d-Q,r-w),c.lineTo(d+Q,r+w),c.moveTo(d+ae,r-g),c.lineTo(d-ae,r+g);break;case"line":g=s?s/2:Math.cos(Re)*Pe,w=Math.sin(Re)*Pe,c.moveTo(d-g,r-w),c.lineTo(d+g,r+w);break;case"dash":c.moveTo(d,r),c.lineTo(d+Math.cos(Re)*(s?s/2:Pe),r+Math.sin(Re)*Pe);break;case!1:c.closePath();break}c.fill(),o.borderWidth>0&&c.stroke()}}function hh(c,o,d){return d=d||.5,!o||c&&c.x>o.left-d&&c.x<o.right+d&&c.y>o.top-d&&c.y<o.bottom+d}function nv(c,o){c.save(),c.beginPath(),c.rect(o.left,o.top,o.right-o.left,o.bottom-o.top),c.clip()}function rv(c){c.restore()}function OP(c,o,d,r,s){if(!o)return c.lineTo(d.x,d.y);if(s==="middle"){let t=(o.x+d.x)/2;c.lineTo(t,o.y),c.lineTo(t,d.y)}else s==="after"!=!!r?c.lineTo(o.x,d.y):c.lineTo(d.x,o.y);c.lineTo(d.x,d.y)}function RP(c,o,d,r){if(!o)return c.lineTo(d.x,d.y);c.bezierCurveTo(r?o.cp1x:o.cp2x,r?o.cp1y:o.cp2y,r?d.cp2x:d.cp1x,r?d.cp2y:d.cp1y,d.x,d.y)}function lN(c,o){o.translation&&c.translate(o.translation[0],o.translation[1]),pr(o.rotation)||c.rotate(o.rotation),o.color&&(c.fillStyle=o.color),o.textAlign&&(c.textAlign=o.textAlign),o.textBaseline&&(c.textBaseline=o.textBaseline)}function cN(c,o,d,r,s){if(s.strikethrough||s.underline){let t=c.measureText(r),g=o-t.actualBoundingBoxLeft,w=o+t.actualBoundingBoxRight,M=d-t.actualBoundingBoxAscent,F=d+t.actualBoundingBoxDescent,N=s.strikethrough?(M+F)/2:F;c.strokeStyle=c.fillStyle,c.beginPath(),c.lineWidth=s.decorationWidth||2,c.moveTo(g,N),c.lineTo(w,N),c.stroke()}}function dN(c,o){let d=c.fillStyle;c.fillStyle=o.color,c.fillRect(o.left,o.top,o.width,o.height),c.fillStyle=d}function df(c,o,d,r,s,t={}){let g=uo(o)?o:[o],w=t.strokeWidth>0&&t.strokeColor!=="",M,F;for(c.save(),c.font=s.string,lN(c,t),M=0;M<g.length;++M)F=g[M],t.backdrop&&dN(c,t.backdrop),w&&(t.strokeColor&&(c.strokeStyle=t.strokeColor),pr(t.strokeWidth)||(c.lineWidth=t.strokeWidth),c.strokeText(F,d,r,t.maxWidth)),c.fillText(F,d,r,t.maxWidth),cN(c,d,r,F,t),r+=Number(s.lineHeight);c.restore()}function H0(c,o){let{x:d,y:r,w:s,h:t,radius:g}=o;c.arc(d+g.topLeft,r+g.topLeft,g.topLeft,1.5*ho,ho,!0),c.lineTo(d,r+t-g.bottomLeft),c.arc(d+g.bottomLeft,r+t-g.bottomLeft,g.bottomLeft,ho,ia,!0),c.lineTo(d+s-g.bottomRight,r+t),c.arc(d+s-g.bottomRight,r+t-g.bottomRight,g.bottomRight,ia,0,!0),c.lineTo(d+s,r+g.topRight),c.arc(d+s-g.topRight,r+g.topRight,g.topRight,0,-ia,!0),c.lineTo(d+g.topLeft,r)}var uN=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,hN=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function mN(c,o){let d=(""+c).match(uN);if(!d||d[1]==="normal")return o*1.2;switch(c=+d[2],d[3]){case"px":return c;case"%":c/=100;break}return o*c}var pN=c=>+c||0;function Tw(c,o){let d={},r=Jn(o),s=r?Object.keys(o):o,t=Jn(c)?r?g=>An(c[g],c[o[g]]):g=>c[g]:()=>c;for(let g of s)d[g]=pN(t(g));return d}function ST(c){return Tw(c,{top:"y",right:"x",bottom:"y",left:"x"})}function uf(c){return Tw(c,["topLeft","topRight","bottomLeft","bottomRight"])}function cs(c){let o=ST(c);return o.width=o.left+o.right,o.height=o.top+o.bottom,o}function xa(c,o){c=c||{},o=o||Lo.font;let d=An(c.size,o.size);typeof d=="string"&&(d=parseInt(d,10));let r=An(c.style,o.style);r&&!(""+r).match(hN)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);let s={family:An(c.family,o.family),lineHeight:mN(An(c.lineHeight,o.lineHeight),d),size:d,style:r,weight:An(c.weight,o.weight),string:""};return s.string=sN(s),s}function G0(c,o,d,r){let s=!0,t,g,w;for(t=0,g=c.length;t<g;++t)if(w=c[t],w!==void 0&&(o!==void 0&&typeof w=="function"&&(w=w(o),s=!1),d!==void 0&&uo(w)&&(w=w[d%w.length],s=!1),w!==void 0))return r&&!s&&(r.cacheable=!1),w}function FP(c,o,d){let{min:r,max:s}=c,t=lT(o,(s-r)/2),g=(w,M)=>d&&w===0?0:w+M;return{min:g(r,-Math.abs(t)),max:g(s,t)}}function Wm(c,o){return Object.assign(Object.create(c),o)}function Mw(c,o=[""],d,r,s=()=>c[0]){let t=d||c;typeof r>"u"&&(r=BP("_fallback",c));let g={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:c,_rootScopes:t,_fallback:r,_getTarget:s,override:w=>Mw([w,...c],o,t,r)};return new Proxy(g,{deleteProperty(w,M){return delete w[M],delete w._keys,delete c[0][M],!0},get(w,M){return LP(w,M,()=>wN(M,o,c,w))},getOwnPropertyDescriptor(w,M){return Reflect.getOwnPropertyDescriptor(w._scopes[0],M)},getPrototypeOf(){return Reflect.getPrototypeOf(c[0])},has(w,M){return pP(w).includes(M)},ownKeys(w){return pP(w)},set(w,M,F){let N=w._storage||(w._storage=s());return w[M]=N[M]=F,delete w._keys,!0}})}function jg(c,o,d,r){let s={_cacheable:!1,_proxy:c,_context:o,_subProxy:d,_stack:new Set,_descriptors:IT(c,r),setContext:t=>jg(c,t,d,r),override:t=>jg(c.override(t),o,d,r)};return new Proxy(s,{deleteProperty(t,g){return delete t[g],delete c[g],!0},get(t,g,w){return LP(t,g,()=>gN(t,g,w))},getOwnPropertyDescriptor(t,g){return t._descriptors.allKeys?Reflect.has(c,g)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(c,g)},getPrototypeOf(){return Reflect.getPrototypeOf(c)},has(t,g){return Reflect.has(c,g)},ownKeys(){return Reflect.ownKeys(c)},set(t,g,w){return c[g]=w,delete t[g],!0}})}function IT(c,o={scriptable:!0,indexable:!0}){let{_scriptable:d=o.scriptable,_indexable:r=o.indexable,_allKeys:s=o.allKeys}=c;return{allKeys:s,scriptable:d,indexable:r,isScriptable:Vm(d)?d:()=>d,isIndexable:Vm(r)?r:()=>r}}var fN=(c,o)=>c?c+vw(o):o,TT=(c,o)=>Jn(o)&&c!=="adapters"&&(Object.getPrototypeOf(o)===null||o.constructor===Object);function LP(c,o,d){if(Object.prototype.hasOwnProperty.call(c,o)||o==="constructor")return c[o];let r=d();return c[o]=r,r}function gN(c,o,d){let{_proxy:r,_context:s,_subProxy:t,_descriptors:g}=c,w=r[o];return Vm(w)&&g.isScriptable(o)&&(w=_N(o,w,c,d)),uo(w)&&w.length&&(w=bN(o,w,c,g.isIndexable)),TT(o,w)&&(w=jg(w,s,t&&t[o],g)),w}function _N(c,o,d,r){let{_proxy:s,_context:t,_subProxy:g,_stack:w}=d;if(w.has(c))throw new Error("Recursion detected: "+Array.from(w).join("->")+"->"+c);w.add(c);let M=o(t,g||r);return w.delete(c),TT(c,M)&&(M=MT(s._scopes,s,c,M)),M}function bN(c,o,d,r){let{_proxy:s,_context:t,_subProxy:g,_descriptors:w}=d;if(typeof t.index<"u"&&r(c))return o[t.index%o.length];if(Jn(o[0])){let M=o,F=s._scopes.filter(N=>N!==M);o=[];for(let N of M){let Q=MT(F,s,c,N);o.push(jg(Q,t,g&&g[c],w))}}return o}function zP(c,o,d){return Vm(c)?c(o,d):c}var yN=(c,o)=>c===!0?o:typeof c=="string"?Um(o,c):void 0;function vN(c,o,d,r,s){for(let t of o){let g=yN(d,t);if(g){c.add(g);let w=zP(g._fallback,d,s);if(typeof w<"u"&&w!==d&&w!==r)return w}else if(g===!1&&typeof r<"u"&&d!==r)return null}return!1}function MT(c,o,d,r){let s=o._rootScopes,t=zP(o._fallback,d,r),g=[...c,...s],w=new Set;w.add(r);let M=mP(w,g,d,t||d,r);return M===null||typeof t<"u"&&t!==d&&(M=mP(w,g,t,M,r),M===null)?!1:Mw(Array.from(w),[""],s,t,()=>xN(o,d,r))}function mP(c,o,d,r,s){for(;d;)d=vN(c,o,d,r,s);return d}function xN(c,o,d){let r=c._getTarget();o in r||(r[o]={});let s=r[o];return uo(s)&&Jn(d)?d:s||{}}function wN(c,o,d,r){let s;for(let t of o)if(s=BP(fN(t,c),d),typeof s<"u")return TT(c,s)?MT(d,r,c,s):s}function BP(c,o){for(let d of o){if(!d)continue;let r=d[c];if(typeof r<"u")return r}}function pP(c){let o=c._keys;return o||(o=c._keys=CN(c._scopes)),o}function CN(c){let o=new Set;for(let d of c)for(let r of Object.keys(d).filter(s=>!s.startsWith("_")))o.add(r);return Array.from(o)}function kT(c,o,d,r){let{iScale:s}=c,{key:t="r"}=this._parsing,g=new Array(r),w,M,F,N;for(w=0,M=r;w<M;++w)F=w+d,N=o[F],g[w]={r:s.parse(Um(N,t),F)};return g}var SN=Number.EPSILON||1e-14,B0=(c,o)=>o<c.length&&!c[o].skip&&c[o],NP=c=>c==="x"?"y":"x";function IN(c,o,d,r){let s=c.skip?o:c,t=o,g=d.skip?o:d,w=bw(t,s),M=bw(g,t),F=w/(w+M),N=M/(w+M);F=isNaN(F)?0:F,N=isNaN(N)?0:N;let Q=r*F,ae=r*N;return{previous:{x:t.x-Q*(g.x-s.x),y:t.y-Q*(g.y-s.y)},next:{x:t.x+ae*(g.x-s.x),y:t.y+ae*(g.y-s.y)}}}function TN(c,o,d){let r=c.length,s,t,g,w,M,F=B0(c,0);for(let N=0;N<r-1;++N)if(M=F,F=B0(c,N+1),!(!M||!F)){if(j0(o[N],0,SN)){d[N]=d[N+1]=0;continue}s=d[N]/o[N],t=d[N+1]/o[N],w=Math.pow(s,2)+Math.pow(t,2),!(w<=9)&&(g=3/Math.sqrt(w),d[N]=s*g*o[N],d[N+1]=t*g*o[N])}}function MN(c,o,d="x"){let r=NP(d),s=c.length,t,g,w,M=B0(c,0);for(let F=0;F<s;++F){if(g=w,w=M,M=B0(c,F+1),!w)continue;let N=w[d],Q=w[r];g&&(t=(N-g[d])/3,w[`cp1${d}`]=N-t,w[`cp1${r}`]=Q-t*o[F]),M&&(t=(M[d]-N)/3,w[`cp2${d}`]=N+t,w[`cp2${r}`]=Q+t*o[F])}}function kN(c,o="x"){let d=NP(o),r=c.length,s=Array(r).fill(0),t=Array(r),g,w,M,F=B0(c,0);for(g=0;g<r;++g)if(w=M,M=F,F=B0(c,g+1),!!M){if(F){let N=F[o]-M[o];s[g]=N!==0?(F[d]-M[d])/N:0}t[g]=w?F?Zd(s[g-1])!==Zd(s[g])?0:(s[g-1]+s[g])/2:s[g-1]:s[g]}TN(c,s,t),MN(c,t,o)}function pw(c,o,d){return Math.max(Math.min(c,d),o)}function EN(c,o){let d,r,s,t,g,w=hh(c[0],o);for(d=0,r=c.length;d<r;++d)g=t,t=w,w=d<r-1&&hh(c[d+1],o),t&&(s=c[d],g&&(s.cp1x=pw(s.cp1x,o.left,o.right),s.cp1y=pw(s.cp1y,o.top,o.bottom)),w&&(s.cp2x=pw(s.cp2x,o.left,o.right),s.cp2y=pw(s.cp2y,o.top,o.bottom)))}function VP(c,o,d,r,s){let t,g,w,M;if(o.spanGaps&&(c=c.filter(F=>!F.skip)),o.cubicInterpolationMode==="monotone")kN(c,s);else{let F=r?c[c.length-1]:c[0];for(t=0,g=c.length;t<g;++t)w=c[t],M=IN(F,w,c[Math.min(t+1,g-(r?0:1))%g],o.tension),w.cp1x=M.previous.x,w.cp1y=M.previous.y,w.cp2x=M.next.x,w.cp2y=M.next.y,F=w}o.capBezierPoints&&EN(c,d)}function kw(){return typeof window<"u"&&typeof document<"u"}function Ew(c){let o=c.parentNode;return o&&o.toString()==="[object ShadowRoot]"&&(o=o.host),o}function yw(c,o,d){let r;return typeof c=="string"?(r=parseInt(c,10),c.indexOf("%")!==-1&&(r=r/100*o.parentNode[d])):r=c,r}var Dw=c=>c.ownerDocument.defaultView.getComputedStyle(c,null);function DN(c,o){return Dw(c).getPropertyValue(o)}var AN=["top","right","bottom","left"];function Vg(c,o,d){let r={};d=d?"-"+d:"";for(let s=0;s<4;s++){let t=AN[s];r[t]=parseFloat(c[o+"-"+t+d])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}var PN=(c,o,d)=>(c>0||o>0)&&(!d||!d.shadowRoot);function ON(c,o){let d=c.touches,r=d&&d.length?d[0]:c,{offsetX:s,offsetY:t}=r,g=!1,w,M;if(PN(s,t,c.target))w=s,M=t;else{let F=o.getBoundingClientRect();w=r.clientX-F.left,M=r.clientY-F.top,g=!0}return{x:w,y:M,box:g}}function hf(c,o){if("native"in c)return c;let{canvas:d,currentDevicePixelRatio:r}=o,s=Dw(d),t=s.boxSizing==="border-box",g=Vg(s,"padding"),w=Vg(s,"border","width"),{x:M,y:F,box:N}=ON(c,d),Q=g.left+(N&&w.left),ae=g.top+(N&&w.top),{width:pe,height:Te}=o;return t&&(pe-=g.width+w.width,Te-=g.height+w.height),{x:Math.round((M-Q)/pe*d.width/r),y:Math.round((F-ae)/Te*d.height/r)}}function RN(c,o,d){let r,s;if(o===void 0||d===void 0){let t=c&&Ew(c);if(!t)o=c.clientWidth,d=c.clientHeight;else{let g=t.getBoundingClientRect(),w=Dw(t),M=Vg(w,"border","width"),F=Vg(w,"padding");o=g.width-F.width-M.width,d=g.height-F.height-M.height,r=yw(w.maxWidth,t,"clientWidth"),s=yw(w.maxHeight,t,"clientHeight")}}return{width:o,height:d,maxWidth:r||_w,maxHeight:s||_w}}var fw=c=>Math.round(c*10)/10;function jP(c,o,d,r){let s=Dw(c),t=Vg(s,"margin"),g=yw(s.maxWidth,c,"clientWidth")||_w,w=yw(s.maxHeight,c,"clientHeight")||_w,M=RN(c,o,d),{width:F,height:N}=M;if(s.boxSizing==="content-box"){let ae=Vg(s,"border","width"),pe=Vg(s,"padding");F-=pe.width+ae.width,N-=pe.height+ae.height}return F=Math.max(0,F-t.width),N=Math.max(0,r?F/r:N-t.height),F=fw(Math.min(F,g,M.maxWidth)),N=fw(Math.min(N,w,M.maxHeight)),F&&!N&&(N=fw(F/2)),(o!==void 0||d!==void 0)&&r&&M.height&&N>M.height&&(N=M.height,F=fw(Math.floor(N*r))),{width:F,height:N}}function ET(c,o,d){let r=o||1,s=Math.floor(c.height*r),t=Math.floor(c.width*r);c.height=Math.floor(c.height),c.width=Math.floor(c.width);let g=c.canvas;return g.style&&(d||!g.style.height&&!g.style.width)&&(g.style.height=`${c.height}px`,g.style.width=`${c.width}px`),c.currentDevicePixelRatio!==r||g.height!==s||g.width!==t?(c.currentDevicePixelRatio=r,g.height=s,g.width=t,c.ctx.setTransform(r,0,0,r,0,0),!0):!1}var UP=function(){let c=!1;try{let o={get passive(){return c=!0,!1}};kw()&&(window.addEventListener("test",null,o),window.removeEventListener("test",null,o))}catch{}return c}();function DT(c,o){let d=DN(c,o),r=d&&d.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function sf(c,o,d,r){return{x:c.x+d*(o.x-c.x),y:c.y+d*(o.y-c.y)}}function WP(c,o,d,r){return{x:c.x+d*(o.x-c.x),y:r==="middle"?d<.5?c.y:o.y:r==="after"?d<1?c.y:o.y:d>0?o.y:c.y}}function HP(c,o,d,r){let s={x:c.cp2x,y:c.cp2y},t={x:o.cp1x,y:o.cp1y},g=sf(c,s,d),w=sf(s,t,d),M=sf(t,o,d),F=sf(g,w,d),N=sf(w,M,d);return sf(F,N,d)}var FN=function(c,o){return{x(d){return c+c+o-d},setWidth(d){o=d},textAlign(d){return d==="center"?d:d==="right"?"left":"right"},xPlus(d,r){return d-r},leftForLtr(d,r){return d-r}}},LN=function(){return{x(c){return c},setWidth(c){},textAlign(c){return c},xPlus(c,o){return c+o},leftForLtr(c,o){return c}}};function Wg(c,o,d){return c?FN(o,d):LN()}function AT(c,o){let d,r;(o==="ltr"||o==="rtl")&&(d=c.canvas.style,r=[d.getPropertyValue("direction"),d.getPropertyPriority("direction")],d.setProperty("direction",o,"important"),c.prevTextDirection=r)}function PT(c,o){o!==void 0&&(delete c.prevTextDirection,c.canvas.style.setProperty("direction",o[0],o[1]))}function GP(c){return c==="angle"?{between:U0,compare:JB,normalize:El}:{between:ph,compare:(o,d)=>o-d,normalize:o=>o}}function fP({start:c,end:o,count:d,loop:r,style:s}){return{start:c%d,end:o%d,loop:r&&(o-c+1)%d===0,style:s}}function zN(c,o,d){let{property:r,start:s,end:t}=d,{between:g,normalize:w}=GP(r),M=o.length,{start:F,end:N,loop:Q}=c,ae,pe;if(Q){for(F+=M,N+=M,ae=0,pe=M;ae<pe&&g(w(o[F%M][r]),s,t);++ae)F--,N--;F%=M,N%=M}return N<F&&(N+=M),{start:F,end:N,loop:Q,style:c.style}}function OT(c,o,d){if(!d)return[c];let{property:r,start:s,end:t}=d,g=o.length,{compare:w,between:M,normalize:F}=GP(r),{start:N,end:Q,loop:ae,style:pe}=zN(c,o,d),Te=[],Pe=!1,Re=null,Ke,Je,_t,Nt=()=>M(s,_t,Ke)&&w(s,_t)!==0,kt=()=>w(t,Ke)===0||M(t,_t,Ke),Ut=()=>Pe||Nt(),ni=()=>!Pe||kt();for(let zt=N,pi=N;zt<=Q;++zt)Je=o[zt%g],!Je.skip&&(Ke=F(Je[r]),Ke!==_t&&(Pe=M(Ke,s,t),Re===null&&Ut()&&(Re=w(Ke,s)===0?zt:pi),Re!==null&&ni()&&(Te.push(fP({start:Re,end:zt,loop:ae,count:g,style:pe})),Re=null),pi=zt,_t=Ke));return Re!==null&&Te.push(fP({start:Re,end:Q,loop:ae,count:g,style:pe})),Te}function RT(c,o){let d=[],r=c.segments;for(let s=0;s<r.length;s++){let t=OT(r[s],c.points,o);t.length&&d.push(...t)}return d}function BN(c,o,d,r){let s=0,t=o-1;if(d&&!r)for(;s<o&&!c[s].skip;)s++;for(;s<o&&c[s].skip;)s++;for(s%=o,d&&(t+=s);t>s&&c[t%o].skip;)t--;return t%=o,{start:s,end:t}}function NN(c,o,d,r){let s=c.length,t=[],g=o,w=c[o],M;for(M=o+1;M<=d;++M){let F=c[M%s];F.skip||F.stop?w.skip||(r=!1,t.push({start:o%s,end:(M-1)%s,loop:r}),o=g=F.stop?M:null):(g=M,w.skip&&(o=M)),w=F}return g!==null&&t.push({start:o%s,end:g%s,loop:r}),t}function qP(c,o){let d=c.points,r=c.options.spanGaps,s=d.length;if(!s)return[];let t=!!c._loop,{start:g,end:w}=BN(d,s,t,r);if(r===!0)return gP(c,[{start:g,end:w,loop:t}],d,o);let M=w<g?w+s:w,F=!!c._fullLoop&&g===0&&w===s-1;return gP(c,NN(d,g,M,F),d,o)}function gP(c,o,d,r){return!r||!r.setContext||!d?o:VN(c,o,d,r)}function VN(c,o,d,r){let s=c._chart.getContext(),t=_P(c.options),{_datasetIndex:g,options:{spanGaps:w}}=c,M=d.length,F=[],N=t,Q=o[0].start,ae=Q;function pe(Te,Pe,Re,Ke){let Je=w?-1:1;if(Te!==Pe){for(Te+=M;d[Te%M].skip;)Te-=Je;for(;d[Pe%M].skip;)Pe+=Je;Te%M!==Pe%M&&(F.push({start:Te%M,end:Pe%M,loop:Re,style:Ke}),N=Ke,Q=Pe%M)}}for(let Te of o){Q=w?Q:Te.start;let Pe=d[Q%M],Re;for(ae=Q+1;ae<=Te.end;ae++){let Ke=d[ae%M];Re=_P(r.setContext(Wm(s,{type:"segment",p0:Pe,p1:Ke,p0DataIndex:(ae-1)%M,p1DataIndex:ae%M,datasetIndex:g}))),jN(Re,N)&&pe(Q,ae-1,Te.loop,N),Pe=Ke,N=Re}Q<ae-1&&pe(Q,ae-1,Te.loop,N)}return F}function _P(c){return{backgroundColor:c.backgroundColor,borderCapStyle:c.borderCapStyle,borderDash:c.borderDash,borderDashOffset:c.borderDashOffset,borderJoinStyle:c.borderJoinStyle,borderWidth:c.borderWidth,borderColor:c.borderColor}}function jN(c,o){if(!o)return!1;let d=[],r=function(s,t){return vT(t)?(d.includes(t)||d.push(t),d.indexOf(t)):t};return JSON.stringify(c,r)!==JSON.stringify(o,r)}var HT=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(o,d,r,s){let t=d.listeners[s],g=d.duration;t.forEach(w=>w({chart:o,initial:d.initial,numSteps:g,currentStep:Math.min(r-d.start,g)}))}_refresh(){this._request||(this._running=!0,this._request=gT.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(o=Date.now()){let d=0;this._charts.forEach((r,s)=>{if(!r.running||!r.items.length)return;let t=r.items,g=t.length-1,w=!1,M;for(;g>=0;--g)M=t[g],M._active?(M._total>r.duration&&(r.duration=M._total),M.tick(o),w=!0):(t[g]=t[t.length-1],t.pop());w&&(s.draw(),this._notify(s,r,o,"progress")),t.length||(r.running=!1,this._notify(s,r,o,"complete"),r.initial=!1),d+=t.length}),this._lastDate=o,d===0&&(this._running=!1)}_getAnims(o){let d=this._charts,r=d.get(o);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},d.set(o,r)),r}listen(o,d,r){this._getAnims(o).listeners[d].push(r)}add(o,d){!d||!d.length||this._getAnims(o).items.push(...d)}has(o){return this._getAnims(o).items.length>0}start(o){let d=this._charts.get(o);d&&(d.running=!0,d.start=Date.now(),d.duration=d.items.reduce((r,s)=>Math.max(r,s._duration),0),this._refresh())}running(o){if(!this._running)return!1;let d=this._charts.get(o);return!(!d||!d.running||!d.items.length)}stop(o){let d=this._charts.get(o);if(!d||!d.items.length)return;let r=d.items,s=r.length-1;for(;s>=0;--s)r[s].cancel();d.items=[],this._notify(o,d,Date.now(),"complete")}remove(o){return this._charts.delete(o)}},Hm=new HT,$P="transparent",UN={boolean(c,o,d){return d>.5?o:c},color(c,o,d){let r=xT(c||$P),s=r.valid&&xT(o||$P);return s&&s.valid?s.mix(r,d).hexString():o},number(c,o,d){return c+(o-c)*d}},GT=class{constructor(o,d,r,s){let t=d[r];s=G0([o.to,s,t,o.from]);let g=G0([o.from,t,s]);this._active=!0,this._fn=o.fn||UN[o.type||typeof g],this._easing=L0[o.easing]||L0.linear,this._start=Math.floor(Date.now()+(o.delay||0)),this._duration=this._total=Math.floor(o.duration),this._loop=!!o.loop,this._target=d,this._prop=r,this._from=g,this._to=s,this._promises=void 0}active(){return this._active}update(o,d,r){if(this._active){this._notify(!1);let s=this._target[this._prop],t=r-this._start,g=this._duration-t;this._start=r,this._duration=Math.floor(Math.max(g,o.duration)),this._total+=t,this._loop=!!o.loop,this._to=G0([o.to,d,s,o.from]),this._from=G0([o.from,s,d])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(o){let d=o-this._start,r=this._duration,s=this._prop,t=this._from,g=this._loop,w=this._to,M;if(this._active=t!==w&&(g||d<r),!this._active){this._target[s]=w,this._notify(!0);return}if(d<0){this._target[s]=t;return}M=d/r%2,M=g&&M>1?2-M:M,M=this._easing(Math.min(1,Math.max(0,M))),this._target[s]=this._fn(t,w,M)}wait(){let o=this._promises||(this._promises=[]);return new Promise((d,r)=>{o.push({res:d,rej:r})})}_notify(o){let d=o?"res":"rej",r=this._promises||[];for(let s=0;s<r.length;s++)r[s][d]()}},Vw=class{constructor(o,d){this._chart=o,this._properties=new Map,this.configure(d)}configure(o){if(!Jn(o))return;let d=Object.keys(Lo.animation),r=this._properties;Object.getOwnPropertyNames(o).forEach(s=>{let t=o[s];if(!Jn(t))return;let g={};for(let w of d)g[w]=t[w];(uo(t.properties)&&t.properties||[s]).forEach(w=>{(w===s||!r.has(w))&&r.set(w,g)})})}_animateOptions(o,d){let r=d.options,s=HN(o,r);if(!s)return[];let t=this._createAnimations(s,r);return r.$shared&&WN(o.options.$animations,r).then(()=>{o.options=r},()=>{}),t}_createAnimations(o,d){let r=this._properties,s=[],t=o.$animations||(o.$animations={}),g=Object.keys(d),w=Date.now(),M;for(M=g.length-1;M>=0;--M){let F=g[M];if(F.charAt(0)==="$")continue;if(F==="options"){s.push(...this._animateOptions(o,d));continue}let N=d[F],Q=t[F],ae=r.get(F);if(Q)if(ae&&Q.active()){Q.update(ae,N,w);continue}else Q.cancel();if(!ae||!ae.duration){o[F]=N;continue}t[F]=Q=new GT(ae,o,F,N),s.push(Q)}return s}update(o,d){if(this._properties.size===0){Object.assign(o,d);return}let r=this._createAnimations(o,d);if(r.length)return Hm.add(this._chart,r),!0}};function WN(c,o){let d=[],r=Object.keys(o);for(let s=0;s<r.length;s++){let t=c[r[s]];t&&t.active()&&d.push(t.wait())}return Promise.all(d)}function HN(c,o){if(!o)return;let d=c.options;if(!d){c.options=o;return}return d.$shared&&(c.options=d=Object.assign({},d,{$shared:!1,$animations:{}})),d}function YP(c,o){let d=c&&c.options||{},r=d.reverse,s=d.min===void 0?o:0,t=d.max===void 0?o:0;return{start:r?t:s,end:r?s:t}}function GN(c,o,d){if(d===!1)return!1;let r=YP(c,d),s=YP(o,d);return{top:s.end,right:r.end,bottom:s.start,left:r.start}}function qN(c){let o,d,r,s;return Jn(c)?(o=c.top,d=c.right,r=c.bottom,s=c.left):o=d=r=s=c,{top:o,right:d,bottom:r,left:s,disabled:c===!1}}function YO(c,o){let d=[],r=c._getSortedDatasetMetas(o),s,t;for(s=0,t=r.length;s<t;++s)d.push(r[s].index);return d}function ZP(c,o,d,r={}){let s=c.keys,t=r.mode==="single",g,w,M,F;if(o!==null){for(g=0,w=s.length;g<w;++g){if(M=+s[g],M===d){if(r.all)continue;break}F=c.values[M],Fo(F)&&(t||o===0||Zd(o)===Zd(F))&&(o+=F)}return o}}function $N(c,o){let{iScale:d,vScale:r}=o,s=d.axis==="x"?"x":"y",t=r.axis==="x"?"x":"y",g=Object.keys(c),w=new Array(g.length),M,F,N;for(M=0,F=g.length;M<F;++M)N=g[M],w[M]={[s]:N,[t]:c[N]};return w}function XP(c,o){let d=c&&c.options.stacked;return d||d===void 0&&o.stack!==void 0}function YN(c,o,d){return`${c.id}.${o.id}.${d.stack||d.type}`}function ZN(c){let{min:o,max:d,minDefined:r,maxDefined:s}=c.getUserBounds();return{min:r?o:Number.NEGATIVE_INFINITY,max:s?d:Number.POSITIVE_INFINITY}}function XN(c,o,d){let r=c[o]||(c[o]={});return r[d]||(r[d]={})}function QP(c,o,d,r){for(let s of o.getMatchingVisibleMetas(r).reverse()){let t=c[s.index];if(d&&t>0||!d&&t<0)return s.index}return null}function KP(c,o){let{chart:d,_cachedMeta:r}=c,s=d._stacks||(d._stacks={}),{iScale:t,vScale:g,index:w}=r,M=t.axis,F=g.axis,N=YN(t,g,r),Q=o.length,ae;for(let pe=0;pe<Q;++pe){let Te=o[pe],{[M]:Pe,[F]:Re}=Te,Ke=Te._stacks||(Te._stacks={});ae=Ke[F]=XN(s,N,Pe),ae[w]=Re,ae._top=QP(ae,g,!0,r.type),ae._bottom=QP(ae,g,!1,r.type);let Je=ae._visualValues||(ae._visualValues={});Je[w]=Re}}function FT(c,o){let d=c.scales;return Object.keys(d).filter(r=>d[r].axis===o).shift()}function QN(c,o){return Wm(c,{active:!1,dataset:void 0,datasetIndex:o,index:o,mode:"default",type:"dataset"})}function KN(c,o,d){return Wm(c,{active:!1,dataIndex:o,parsed:void 0,raw:void 0,element:d,index:o,mode:"default",type:"data"})}function ov(c,o){let d=c.controller.index,r=c.vScale&&c.vScale.axis;if(r){o=o||c._parsed;for(let s of o){let t=s._stacks;if(!t||t[r]===void 0||t[r][d]===void 0)return;delete t[r][d],t[r]._visualValues!==void 0&&t[r]._visualValues[d]!==void 0&&delete t[r]._visualValues[d]}}}var LT=c=>c==="reset"||c==="none",JP=(c,o)=>o?c:Object.assign({},c),JN=(c,o,d)=>c&&!o.hidden&&o._stacked&&{keys:YO(d,!0),values:null},pf=(()=>{class c{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(d,r){this.chart=d,this._ctx=d.ctx,this.index=r,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){let d=this._cachedMeta;this.configure(),this.linkScales(),d._stacked=XP(d.vScale,d),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(d){this.index!==d&&ov(this._cachedMeta),this.index=d}linkScales(){let d=this.chart,r=this._cachedMeta,s=this.getDataset(),t=(ae,pe,Te,Pe)=>ae==="x"?pe:ae==="r"?Pe:Te,g=r.xAxisID=An(s.xAxisID,FT(d,"x")),w=r.yAxisID=An(s.yAxisID,FT(d,"y")),M=r.rAxisID=An(s.rAxisID,FT(d,"r")),F=r.indexAxis,N=r.iAxisID=t(F,g,w,M),Q=r.vAxisID=t(F,w,g,M);r.xScale=this.getScaleForId(g),r.yScale=this.getScaleForId(w),r.rScale=this.getScaleForId(M),r.iScale=this.getScaleForId(N),r.vScale=this.getScaleForId(Q)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(d){return this.chart.scales[d]}_getOtherScale(d){let r=this._cachedMeta;return d===r.iScale?r.vScale:r.iScale}reset(){this._update("reset")}_destroy(){let d=this._cachedMeta;this._data&&pT(this._data,this),d._stacked&&ov(d)}_dataCheck(){let d=this.getDataset(),r=d.data||(d.data=[]),s=this._data;if(Jn(r)){let t=this._cachedMeta;this._data=$N(r,t)}else if(s!==r){if(s){pT(s,this);let t=this._cachedMeta;ov(t),t._parsed=[]}r&&Object.isExtensible(r)&&kP(r,this),this._syncList=[],this._data=r}}addElements(){let d=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(d.dataset=new this.datasetElementType)}buildOrUpdateElements(d){let r=this._cachedMeta,s=this.getDataset(),t=!1;this._dataCheck();let g=r._stacked;r._stacked=XP(r.vScale,r),r.stack!==s.stack&&(t=!0,ov(r),r.stack=s.stack),this._resyncElements(d),(t||g!==r._stacked)&&KP(this,r._parsed)}configure(){let d=this.chart.config,r=d.datasetScopeKeys(this._type),s=d.getOptionScopes(this.getDataset(),r,!0);this.options=d.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(d,r){let{_cachedMeta:s,_data:t}=this,{iScale:g,_stacked:w}=s,M=g.axis,F=d===0&&r===t.length?!0:s._sorted,N=d>0&&s._parsed[d-1],Q,ae,pe;if(this._parsing===!1)s._parsed=t,s._sorted=!0,pe=t;else{uo(t[d])?pe=this.parseArrayData(s,t,d,r):Jn(t[d])?pe=this.parseObjectData(s,t,d,r):pe=this.parsePrimitiveData(s,t,d,r);let Te=()=>ae[M]===null||N&&ae[M]<N[M];for(Q=0;Q<r;++Q)s._parsed[Q+d]=ae=pe[Q],F&&(Te()&&(F=!1),N=ae);s._sorted=F}w&&KP(this,pe)}parsePrimitiveData(d,r,s,t){let{iScale:g,vScale:w}=d,M=g.axis,F=w.axis,N=g.getLabels(),Q=g===w,ae=new Array(t),pe,Te,Pe;for(pe=0,Te=t;pe<Te;++pe)Pe=pe+s,ae[pe]={[M]:Q||g.parse(N[Pe],Pe),[F]:w.parse(r[Pe],Pe)};return ae}parseArrayData(d,r,s,t){let{xScale:g,yScale:w}=d,M=new Array(t),F,N,Q,ae;for(F=0,N=t;F<N;++F)Q=F+s,ae=r[Q],M[F]={x:g.parse(ae[0],Q),y:w.parse(ae[1],Q)};return M}parseObjectData(d,r,s,t){let{xScale:g,yScale:w}=d,{xAxisKey:M="x",yAxisKey:F="y"}=this._parsing,N=new Array(t),Q,ae,pe,Te;for(Q=0,ae=t;Q<ae;++Q)pe=Q+s,Te=r[pe],N[Q]={x:g.parse(Um(Te,M),pe),y:w.parse(Um(Te,F),pe)};return N}getParsed(d){return this._cachedMeta._parsed[d]}getDataElement(d){return this._cachedMeta.data[d]}applyStack(d,r,s){let t=this.chart,g=this._cachedMeta,w=r[d.axis],M={keys:YO(t,!0),values:r._stacks[d.axis]._visualValues};return ZP(M,w,g.index,{mode:s})}updateRangeFromParsed(d,r,s,t){let g=s[r.axis],w=g===null?NaN:g,M=t&&s._stacks[r.axis];t&&M&&(t.values=M,w=ZP(t,g,this._cachedMeta.index)),d.min=Math.min(d.min,w),d.max=Math.max(d.max,w)}getMinMax(d,r){let s=this._cachedMeta,t=s._parsed,g=s._sorted&&d===s.iScale,w=t.length,M=this._getOtherScale(d),F=JN(r,s,this.chart),N={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:Q,max:ae}=ZN(M),pe,Te;function Pe(){Te=t[pe];let Re=Te[M.axis];return!Fo(Te[d.axis])||Q>Re||ae<Re}for(pe=0;pe<w&&!(!Pe()&&(this.updateRangeFromParsed(N,d,Te,F),g));++pe);if(g){for(pe=w-1;pe>=0;--pe)if(!Pe()){this.updateRangeFromParsed(N,d,Te,F);break}}return N}getAllParsedValues(d){let r=this._cachedMeta._parsed,s=[],t,g,w;for(t=0,g=r.length;t<g;++t)w=r[t][d.axis],Fo(w)&&s.push(w);return s}getMaxOverflow(){return!1}getLabelAndValue(d){let r=this._cachedMeta,s=r.iScale,t=r.vScale,g=this.getParsed(d);return{label:s?""+s.getLabelForValue(g[s.axis]):"",value:t?""+t.getLabelForValue(g[t.axis]):""}}_update(d){let r=this._cachedMeta;this.update(d||"default"),r._clip=qN(An(this.options.clip,GN(r.xScale,r.yScale,this.getMaxOverflow())))}update(d){}draw(){let d=this._ctx,r=this.chart,s=this._cachedMeta,t=s.data||[],g=r.chartArea,w=[],M=this._drawStart||0,F=this._drawCount||t.length-M,N=this.options.drawActiveElementsOnTop,Q;for(s.dataset&&s.dataset.draw(d,g,M,F),Q=M;Q<M+F;++Q){let ae=t[Q];ae.hidden||(ae.active&&N?w.push(ae):ae.draw(d,g))}for(Q=0;Q<w.length;++Q)w[Q].draw(d,g)}getStyle(d,r){let s=r?"active":"default";return d===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(d||0,s)}getContext(d,r,s){let t=this.getDataset(),g;if(d>=0&&d<this._cachedMeta.data.length){let w=this._cachedMeta.data[d];g=w.$context||(w.$context=KN(this.getContext(),d,w)),g.parsed=this.getParsed(d),g.raw=t.data[d],g.index=g.dataIndex=d}else g=this.$context||(this.$context=QN(this.chart.getContext(),this.index)),g.dataset=t,g.index=g.datasetIndex=this.index;return g.active=!!r,g.mode=s,g}resolveDatasetElementOptions(d){return this._resolveElementOptions(this.datasetElementType.id,d)}resolveDataElementOptions(d,r){return this._resolveElementOptions(this.dataElementType.id,r,d)}_resolveElementOptions(d,r="default",s){let t=r==="active",g=this._cachedDataOpts,w=d+"-"+r,M=g[w],F=this.enableOptionSharing&&V0(s);if(M)return JP(M,F);let N=this.chart.config,Q=N.datasetElementScopeKeys(this._type,d),ae=t?[`${d}Hover`,"hover",d,""]:[d,""],pe=N.getOptionScopes(this.getDataset(),Q),Te=Object.keys(Lo.elements[d]),Pe=()=>this.getContext(s,t,r),Re=N.resolveNamedOptions(pe,Te,Pe,ae);return Re.$shared&&(Re.$shared=F,g[w]=Object.freeze(JP(Re,F))),Re}_resolveAnimations(d,r,s){let t=this.chart,g=this._cachedDataOpts,w=`animation-${r}`,M=g[w];if(M)return M;let F;if(t.options.animation!==!1){let Q=this.chart.config,ae=Q.datasetAnimationScopeKeys(this._type,r),pe=Q.getOptionScopes(this.getDataset(),ae);F=Q.createResolver(pe,this.getContext(d,s,r))}let N=new Vw(t,F&&F.animations);return F&&F._cacheable&&(g[w]=Object.freeze(N)),N}getSharedOptions(d){if(d.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},d))}includeOptions(d,r){return!r||LT(d)||this.chart._animationsDisabled}_getSharedOptions(d,r){let s=this.resolveDataElementOptions(d,r),t=this._sharedOptions,g=this.getSharedOptions(s),w=this.includeOptions(r,g)||g!==t;return this.updateSharedOptions(g,r,s),{sharedOptions:g,includeOptions:w}}updateElement(d,r,s,t){LT(t)?Object.assign(d,s):this._resolveAnimations(r,t).update(d,s)}updateSharedOptions(d,r,s){d&&!LT(r)&&this._resolveAnimations(void 0,r).update(d,s)}_setStyle(d,r,s,t){d.active=t;let g=this.getStyle(r,t);this._resolveAnimations(r,s,t).update(d,{options:!t&&this.getSharedOptions(g)||g})}removeHoverStyle(d,r,s){this._setStyle(d,s,"active",!1)}setHoverStyle(d,r,s){this._setStyle(d,s,"active",!0)}_removeDatasetHoverStyle(){let d=this._cachedMeta.dataset;d&&this._setStyle(d,void 0,"active",!1)}_setDatasetHoverStyle(){let d=this._cachedMeta.dataset;d&&this._setStyle(d,void 0,"active",!0)}_resyncElements(d){let r=this._data,s=this._cachedMeta.data;for(let[M,F,N]of this._syncList)this[M](F,N);this._syncList=[];let t=s.length,g=r.length,w=Math.min(g,t);w&&this.parse(0,w),g>t?this._insertElements(t,g-t,d):g<t&&this._removeElements(g,t-g)}_insertElements(d,r,s=!0){let t=this._cachedMeta,g=t.data,w=d+r,M,F=N=>{for(N.length+=r,M=N.length-1;M>=w;M--)N[M]=N[M-r]};for(F(g),M=d;M<w;++M)g[M]=new this.dataElementType;this._parsing&&F(t._parsed),this.parse(d,r),s&&this.updateElements(g,d,r,"reset")}updateElements(d,r,s,t){}_removeElements(d,r){let s=this._cachedMeta;if(this._parsing){let t=s._parsed.splice(d,r);s._stacked&&ov(s,t)}s.data.splice(d,r)}_sync(d){if(this._parsing)this._syncList.push(d);else{let[r,s,t]=d;this[r](s,t)}this.chart._dataChanges.push([this.index,...d])}_onDataPush(){let d=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-d,d])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(d,r){r&&this._sync(["_removeElements",d,r]);let s=arguments.length-2;s&&this._sync(["_insertElements",d,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return c})();function eV(c,o){if(!c._cache.$bar){let d=c.getMatchingVisibleMetas(o),r=[];for(let s=0,t=d.length;s<t;s++)r=r.concat(d[s].controller.getAllParsedValues(c));c._cache.$bar=fT(r.sort((s,t)=>s-t))}return c._cache.$bar}function tV(c){let o=c.iScale,d=eV(o,c.type),r=o._length,s,t,g,w,M=()=>{g===32767||g===-32768||(V0(w)&&(r=Math.min(r,Math.abs(g-w)||r)),w=g)};for(s=0,t=d.length;s<t;++s)g=o.getPixelForValue(d[s]),M();for(w=void 0,s=0,t=o.ticks.length;s<t;++s)g=o.getPixelForTick(s),M();return r}function iV(c,o,d,r){let s=d.barThickness,t,g;return pr(s)?(t=o.min*d.categoryPercentage,g=d.barPercentage):(t=s*r,g=1),{chunk:t/r,ratio:g,start:o.pixels[c]-t/2}}function nV(c,o,d,r){let s=o.pixels,t=s[c],g=c>0?s[c-1]:null,w=c<s.length-1?s[c+1]:null,M=d.categoryPercentage;g===null&&(g=t-(w===null?o.end-o.start:w-t)),w===null&&(w=t+t-g);let F=t-(t-Math.min(g,w))/2*M;return{chunk:Math.abs(w-g)/2*M/r,ratio:d.barPercentage,start:F}}function rV(c,o,d,r){let s=d.parse(c[0],r),t=d.parse(c[1],r),g=Math.min(s,t),w=Math.max(s,t),M=g,F=w;Math.abs(g)>Math.abs(w)&&(M=w,F=g),o[d.axis]=F,o._custom={barStart:M,barEnd:F,start:s,end:t,min:g,max:w}}function ZO(c,o,d,r){return uo(c)?rV(c,o,d,r):o[d.axis]=d.parse(c,r),o}function eO(c,o,d,r){let s=c.iScale,t=c.vScale,g=s.getLabels(),w=s===t,M=[],F,N,Q,ae;for(F=d,N=d+r;F<N;++F)ae=o[F],Q={},Q[s.axis]=w||s.parse(g[F],F),M.push(ZO(ae,Q,t,F));return M}function zT(c){return c&&c.barStart!==void 0&&c.barEnd!==void 0}function oV(c,o,d){return c!==0?Zd(c):(o.isHorizontal()?1:-1)*(o.min>=d?1:-1)}function aV(c){let o,d,r,s,t;return c.horizontal?(o=c.base>c.x,d="left",r="right"):(o=c.base<c.y,d="bottom",r="top"),o?(s="end",t="start"):(s="start",t="end"),{start:d,end:r,reverse:o,top:s,bottom:t}}function sV(c,o,d,r){let s=o.borderSkipped,t={};if(!s){c.borderSkipped=t;return}if(s===!0){c.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}let{start:g,end:w,reverse:M,top:F,bottom:N}=aV(c);s==="middle"&&d&&(c.enableBorderRadius=!0,(d._top||0)===r?s=F:(d._bottom||0)===r?s=N:(t[tO(N,g,w,M)]=!0,s=F)),t[tO(s,g,w,M)]=!0,c.borderSkipped=t}function tO(c,o,d,r){return r?(c=lV(c,o,d),c=iO(c,d,o)):c=iO(c,o,d),c}function lV(c,o,d){return c===o?d:c===d?o:c}function iO(c,o,d){return c==="start"?o:c==="end"?d:c}function cV(c,{inflateAmount:o},d){c.inflateAmount=o==="auto"?d===1?.33:0:o}var dV=(()=>{class c extends pf{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(d,r,s,t){return eO(d,r,s,t)}parseArrayData(d,r,s,t){return eO(d,r,s,t)}parseObjectData(d,r,s,t){let{iScale:g,vScale:w}=d,{xAxisKey:M="x",yAxisKey:F="y"}=this._parsing,N=g.axis==="x"?M:F,Q=w.axis==="x"?M:F,ae=[],pe,Te,Pe,Re;for(pe=s,Te=s+t;pe<Te;++pe)Re=r[pe],Pe={},Pe[g.axis]=g.parse(Um(Re,N),pe),ae.push(ZO(Um(Re,Q),Pe,w,pe));return ae}updateRangeFromParsed(d,r,s,t){super.updateRangeFromParsed(d,r,s,t);let g=s._custom;g&&r===this._cachedMeta.vScale&&(d.min=Math.min(d.min,g.min),d.max=Math.max(d.max,g.max))}getMaxOverflow(){return 0}getLabelAndValue(d){let r=this._cachedMeta,{iScale:s,vScale:t}=r,g=this.getParsed(d),w=g._custom,M=zT(w)?"["+w.start+", "+w.end+"]":""+t.getLabelForValue(g[t.axis]);return{label:""+s.getLabelForValue(g[s.axis]),value:M}}initialize(){this.enableOptionSharing=!0,super.initialize();let d=this._cachedMeta;d.stack=this.getDataset().stack}update(d){let r=this._cachedMeta;this.updateElements(r.data,0,r.data.length,d)}updateElements(d,r,s,t){let g=t==="reset",{index:w,_cachedMeta:{vScale:M}}=this,F=M.getBasePixel(),N=M.isHorizontal(),Q=this._getRuler(),{sharedOptions:ae,includeOptions:pe}=this._getSharedOptions(r,t);for(let Te=r;Te<r+s;Te++){let Pe=this.getParsed(Te),Re=g||pr(Pe[M.axis])?{base:F,head:F}:this._calculateBarValuePixels(Te),Ke=this._calculateBarIndexPixels(Te,Q),Je=(Pe._stacks||{})[M.axis],_t={horizontal:N,base:Re.base,enableBorderRadius:!Je||zT(Pe._custom)||w===Je._top||w===Je._bottom,x:N?Re.head:Ke.center,y:N?Ke.center:Re.head,height:N?Ke.size:Math.abs(Re.size),width:N?Math.abs(Re.size):Ke.size};pe&&(_t.options=ae||this.resolveDataElementOptions(Te,d[Te].active?"active":t));let Nt=_t.options||d[Te].options;sV(_t,Nt,Je,w),cV(_t,Nt,Q.ratio),this.updateElement(d[Te],Te,_t,t)}}_getStacks(d,r){let{iScale:s}=this._cachedMeta,t=s.getMatchingVisibleMetas(this._type).filter(F=>F.controller.options.grouped),g=s.options.stacked,w=[],M=F=>{let N=F.controller.getParsed(r),Q=N&&N[F.vScale.axis];if(pr(Q)||isNaN(Q))return!0};for(let F of t)if(!(r!==void 0&&M(F))&&((g===!1||w.indexOf(F.stack)===-1||g===void 0&&F.stack===void 0)&&w.push(F.stack),F.index===d))break;return w.length||w.push(void 0),w}_getStackCount(d){return this._getStacks(void 0,d).length}_getStackIndex(d,r,s){let t=this._getStacks(d,s),g=r!==void 0?t.indexOf(r):-1;return g===-1?t.length-1:g}_getRuler(){let d=this.options,r=this._cachedMeta,s=r.iScale,t=[],g,w;for(g=0,w=r.data.length;g<w;++g)t.push(s.getPixelForValue(this.getParsed(g)[s.axis],g));let M=d.barThickness;return{min:M||tV(r),pixels:t,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:d.grouped,ratio:M?1:d.categoryPercentage*d.barPercentage}}_calculateBarValuePixels(d){let{_cachedMeta:{vScale:r,_stacked:s,index:t},options:{base:g,minBarLength:w}}=this,M=g||0,F=this.getParsed(d),N=F._custom,Q=zT(N),ae=F[r.axis],pe=0,Te=s?this.applyStack(r,F,s):ae,Pe,Re;Te!==ae&&(pe=Te-ae,Te=ae),Q&&(ae=N.barStart,Te=N.barEnd-N.barStart,ae!==0&&Zd(ae)!==Zd(N.barEnd)&&(pe=0),pe+=ae);let Ke=!pr(g)&&!Q?g:pe,Je=r.getPixelForValue(Ke);if(this.chart.getDataVisibility(d)?Pe=r.getPixelForValue(pe+Te):Pe=Je,Re=Pe-Je,Math.abs(Re)<w){Re=oV(Re,r,M)*w,ae===M&&(Je-=Re/2);let _t=r.getPixelForDecimal(0),Nt=r.getPixelForDecimal(1),kt=Math.min(_t,Nt),Ut=Math.max(_t,Nt);Je=Math.max(Math.min(Je,Ut),kt),Pe=Je+Re,s&&!Q&&(F._stacks[r.axis]._visualValues[t]=r.getValueForPixel(Pe)-r.getValueForPixel(Je))}if(Je===r.getPixelForValue(M)){let _t=Zd(Re)*r.getLineWidthForValue(M)/2;Je+=_t,Re-=_t}return{size:Re,base:Je,head:Pe,center:Pe+Re/2}}_calculateBarIndexPixels(d,r){let s=r.scale,t=this.options,g=t.skipNull,w=An(t.maxBarThickness,1/0),M,F;if(r.grouped){let N=g?this._getStackCount(d):r.stackCount,Q=t.barThickness==="flex"?nV(d,r,t,N):iV(d,r,t,N),ae=this._getStackIndex(this.index,this._cachedMeta.stack,g?d:void 0);M=Q.start+Q.chunk*ae+Q.chunk/2,F=Math.min(w,Q.chunk*Q.ratio)}else M=s.getPixelForValue(this.getParsed(d)[s.axis],d),F=Math.min(w,r.min*r.ratio);return{base:M-F/2,head:M+F/2,center:M,size:F}}draw(){let d=this._cachedMeta,r=d.vScale,s=d.data,t=s.length,g=0;for(;g<t;++g)this.getParsed(g)[r.axis]!==null&&!s[g].hidden&&s[g].draw(this._ctx)}}return c})(),uV=(()=>{class c extends pf{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(d,r,s,t){let g=super.parsePrimitiveData(d,r,s,t);for(let w=0;w<g.length;w++)g[w]._custom=this.resolveDataElementOptions(w+s).radius;return g}parseArrayData(d,r,s,t){let g=super.parseArrayData(d,r,s,t);for(let w=0;w<g.length;w++){let M=r[s+w];g[w]._custom=An(M[2],this.resolveDataElementOptions(w+s).radius)}return g}parseObjectData(d,r,s,t){let g=super.parseObjectData(d,r,s,t);for(let w=0;w<g.length;w++){let M=r[s+w];g[w]._custom=An(M&&M.r&&+M.r,this.resolveDataElementOptions(w+s).radius)}return g}getMaxOverflow(){let d=this._cachedMeta.data,r=0;for(let s=d.length-1;s>=0;--s)r=Math.max(r,d[s].size(this.resolveDataElementOptions(s))/2);return r>0&&r}getLabelAndValue(d){let r=this._cachedMeta,s=this.chart.data.labels||[],{xScale:t,yScale:g}=r,w=this.getParsed(d),M=t.getLabelForValue(w.x),F=g.getLabelForValue(w.y),N=w._custom;return{label:s[d]||"",value:"("+M+", "+F+(N?", "+N:"")+")"}}update(d){let r=this._cachedMeta.data;this.updateElements(r,0,r.length,d)}updateElements(d,r,s,t){let g=t==="reset",{iScale:w,vScale:M}=this._cachedMeta,{sharedOptions:F,includeOptions:N}=this._getSharedOptions(r,t),Q=w.axis,ae=M.axis;for(let pe=r;pe<r+s;pe++){let Te=d[pe],Pe=!g&&this.getParsed(pe),Re={},Ke=Re[Q]=g?w.getPixelForDecimal(.5):w.getPixelForValue(Pe[Q]),Je=Re[ae]=g?M.getBasePixel():M.getPixelForValue(Pe[ae]);Re.skip=isNaN(Ke)||isNaN(Je),N&&(Re.options=F||this.resolveDataElementOptions(pe,Te.active?"active":t),g&&(Re.options.radius=0)),this.updateElement(Te,pe,Re,t)}}resolveDataElementOptions(d,r){let s=this.getParsed(d),t=super.resolveDataElementOptions(d,r);t.$shared&&(t=Object.assign({},t,{$shared:!1}));let g=t.radius;return r!=="active"&&(t.radius=0),t.radius+=An(s&&s._custom,g),t}}return c})();function hV(c,o,d){let r=1,s=1,t=0,g=0;if(o<mo){let w=c,M=w+o,F=Math.cos(w),N=Math.sin(w),Q=Math.cos(M),ae=Math.sin(M),pe=(_t,Nt,kt)=>U0(_t,w,M,!0)?1:Math.max(Nt,Nt*d,kt,kt*d),Te=(_t,Nt,kt)=>U0(_t,w,M,!0)?-1:Math.min(Nt,Nt*d,kt,kt*d),Pe=pe(0,F,Q),Re=pe(ia,N,ae),Ke=Te(ho,F,Q),Je=Te(ho+ia,N,ae);r=(Pe-Ke)/2,s=(Re-Je)/2,t=-(Pe+Ke)/2,g=-(Re+Je)/2}return{ratioX:r,ratioY:s,offsetX:t,offsetY:g}}var uM=(()=>{class c extends pf{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:d=>d!=="spacing",_indexable:d=>d!=="spacing"&&!d.startsWith("borderDash")&&!d.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(d){let r=d.data;if(r.labels.length&&r.datasets.length){let{labels:{pointStyle:s,color:t}}=d.legend.options;return r.labels.map((g,w)=>{let F=d.getDatasetMeta(0).controller.getStyle(w);return{text:g,fillStyle:F.backgroundColor,strokeStyle:F.borderColor,fontColor:t,lineWidth:F.borderWidth,pointStyle:s,hidden:!d.getDataVisibility(w),index:w}})}return[]}},onClick(d,r,s){s.chart.toggleDataVisibility(r.index),s.chart.update()}}}};constructor(d,r){super(d,r),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(d,r){let s=this.getDataset().data,t=this._cachedMeta;if(this._parsing===!1)t._parsed=s;else{let g=F=>+s[F];if(Jn(s[d])){let{key:F="value"}=this._parsing;g=N=>+Um(s[N],F)}let w,M;for(w=d,M=d+r;w<M;++w)t._parsed[w]=g(w)}}_getRotation(){return Qc(this.options.rotation-90)}_getCircumference(){return Qc(this.options.circumference)}_getRotationExtents(){let d=mo,r=-mo;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){let t=this.chart.getDatasetMeta(s).controller,g=t._getRotation(),w=t._getCircumference();d=Math.min(d,g),r=Math.max(r,g+w)}return{rotation:d,circumference:r-d}}update(d){let r=this.chart,{chartArea:s}=r,t=this._cachedMeta,g=t.data,w=this.getMaxBorderWidth()+this.getMaxOffset(g)+this.options.spacing,M=Math.max((Math.min(s.width,s.height)-w)/2,0),F=Math.min(yP(this.options.cutout,M),1),N=this._getRingWeight(this.index),{circumference:Q,rotation:ae}=this._getRotationExtents(),{ratioX:pe,ratioY:Te,offsetX:Pe,offsetY:Re}=hV(ae,Q,F),Ke=(s.width-w)/pe,Je=(s.height-w)/Te,_t=Math.max(Math.min(Ke,Je)/2,0),Nt=lT(this.options.radius,_t),kt=Math.max(Nt*F,0),Ut=(Nt-kt)/this._getVisibleDatasetWeightTotal();this.offsetX=Pe*Nt,this.offsetY=Re*Nt,t.total=this.calculateTotal(),this.outerRadius=Nt-Ut*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Ut*N,0),this.updateElements(g,0,g.length,d)}_circumference(d,r){let s=this.options,t=this._cachedMeta,g=this._getCircumference();return r&&s.animation.animateRotate||!this.chart.getDataVisibility(d)||t._parsed[d]===null||t.data[d].hidden?0:this.calculateCircumference(t._parsed[d]*g/mo)}updateElements(d,r,s,t){let g=t==="reset",w=this.chart,M=w.chartArea,N=w.options.animation,Q=(M.left+M.right)/2,ae=(M.top+M.bottom)/2,pe=g&&N.animateScale,Te=pe?0:this.innerRadius,Pe=pe?0:this.outerRadius,{sharedOptions:Re,includeOptions:Ke}=this._getSharedOptions(r,t),Je=this._getRotation(),_t;for(_t=0;_t<r;++_t)Je+=this._circumference(_t,g);for(_t=r;_t<r+s;++_t){let Nt=this._circumference(_t,g),kt=d[_t],Ut={x:Q+this.offsetX,y:ae+this.offsetY,startAngle:Je,endAngle:Je+Nt,circumference:Nt,outerRadius:Pe,innerRadius:Te};Ke&&(Ut.options=Re||this.resolveDataElementOptions(_t,kt.active?"active":t)),Je+=Nt,this.updateElement(kt,_t,Ut,t)}}calculateTotal(){let d=this._cachedMeta,r=d.data,s=0,t;for(t=0;t<r.length;t++){let g=d._parsed[t];g!==null&&!isNaN(g)&&this.chart.getDataVisibility(t)&&!r[t].hidden&&(s+=Math.abs(g))}return s}calculateCircumference(d){let r=this._cachedMeta.total;return r>0&&!isNaN(d)?mo*(Math.abs(d)/r):0}getLabelAndValue(d){let r=this._cachedMeta,s=this.chart,t=s.data.labels||[],g=W0(r._parsed[d],s.options.locale);return{label:t[d]||"",value:g}}getMaxBorderWidth(d){let r=0,s=this.chart,t,g,w,M,F;if(!d){for(t=0,g=s.data.datasets.length;t<g;++t)if(s.isDatasetVisible(t)){w=s.getDatasetMeta(t),d=w.data,M=w.controller;break}}if(!d)return 0;for(t=0,g=d.length;t<g;++t)F=M.resolveDataElementOptions(t),F.borderAlign!=="inner"&&(r=Math.max(r,F.borderWidth||0,F.hoverBorderWidth||0));return r}getMaxOffset(d){let r=0;for(let s=0,t=d.length;s<t;++s){let g=this.resolveDataElementOptions(s);r=Math.max(r,g.offset||0,g.hoverOffset||0)}return r}_getRingWeightOffset(d){let r=0;for(let s=0;s<d;++s)this.chart.isDatasetVisible(s)&&(r+=this._getRingWeight(s));return r}_getRingWeight(d){return Math.max(An(this.chart.data.datasets[d].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return c})(),mV=(()=>{class c extends pf{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(d){let r=this._cachedMeta,{dataset:s,data:t=[],_dataset:g}=r,w=this.chart._animationsDisabled,{start:M,count:F}=bT(r,t,w);this._drawStart=M,this._drawCount=F,yT(r)&&(M=0,F=t.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!g._decimated,s.points=t;let N=this.resolveDatasetElementOptions(d);this.options.showLine||(N.borderWidth=0),N.segment=this.options.segment,this.updateElement(s,void 0,{animated:!w,options:N},d),this.updateElements(t,M,F,d)}updateElements(d,r,s,t){let g=t==="reset",{iScale:w,vScale:M,_stacked:F,_dataset:N}=this._cachedMeta,{sharedOptions:Q,includeOptions:ae}=this._getSharedOptions(r,t),pe=w.axis,Te=M.axis,{spanGaps:Pe,segment:Re}=this.options,Ke=Ug(Pe)?Pe:Number.POSITIVE_INFINITY,Je=this.chart._animationsDisabled||g||t==="none",_t=r+s,Nt=d.length,kt=r>0&&this.getParsed(r-1);for(let Ut=0;Ut<Nt;++Ut){let ni=d[Ut],zt=Je?ni:{};if(Ut<r||Ut>=_t){zt.skip=!0;continue}let pi=this.getParsed(Ut),ei=pr(pi[Te]),Ji=zt[pe]=w.getPixelForValue(pi[pe],Ut),bn=zt[Te]=g||ei?M.getBasePixel():M.getPixelForValue(F?this.applyStack(M,pi,F):pi[Te],Ut);zt.skip=isNaN(Ji)||isNaN(bn)||ei,zt.stop=Ut>0&&Math.abs(pi[pe]-kt[pe])>Ke,Re&&(zt.parsed=pi,zt.raw=N.data[Ut]),ae&&(zt.options=Q||this.resolveDataElementOptions(Ut,ni.active?"active":t)),Je||this.updateElement(ni,Ut,zt,t),kt=pi}}getMaxOverflow(){let d=this._cachedMeta,r=d.dataset,s=r.options&&r.options.borderWidth||0,t=d.data||[];if(!t.length)return s;let g=t[0].size(this.resolveDataElementOptions(0)),w=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(s,g,w)/2}draw(){let d=this._cachedMeta;d.dataset.updateControlPoints(this.chart.chartArea,d.iScale.axis),super.draw()}}return c})(),XO=(()=>{class c extends pf{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(d){let r=d.data;if(r.labels.length&&r.datasets.length){let{labels:{pointStyle:s,color:t}}=d.legend.options;return r.labels.map((g,w)=>{let F=d.getDatasetMeta(0).controller.getStyle(w);return{text:g,fillStyle:F.backgroundColor,strokeStyle:F.borderColor,fontColor:t,lineWidth:F.borderWidth,pointStyle:s,hidden:!d.getDataVisibility(w),index:w}})}return[]}},onClick(d,r,s){s.chart.toggleDataVisibility(r.index),s.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(d,r){super(d,r),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(d){let r=this._cachedMeta,s=this.chart,t=s.data.labels||[],g=W0(r._parsed[d].r,s.options.locale);return{label:t[d]||"",value:g}}parseObjectData(d,r,s,t){return kT.bind(this)(d,r,s,t)}update(d){let r=this._cachedMeta.data;this._updateRadius(),this.updateElements(r,0,r.length,d)}getMinMax(){let d=this._cachedMeta,r={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return d.data.forEach((s,t)=>{let g=this.getParsed(t).r;!isNaN(g)&&this.chart.getDataVisibility(t)&&(g<r.min&&(r.min=g),g>r.max&&(r.max=g))}),r}_updateRadius(){let d=this.chart,r=d.chartArea,s=d.options,t=Math.min(r.right-r.left,r.bottom-r.top),g=Math.max(t/2,0),w=Math.max(s.cutoutPercentage?g/100*s.cutoutPercentage:1,0),M=(g-w)/d.getVisibleDatasetCount();this.outerRadius=g-M*this.index,this.innerRadius=this.outerRadius-M}updateElements(d,r,s,t){let g=t==="reset",w=this.chart,F=w.options.animation,N=this._cachedMeta.rScale,Q=N.xCenter,ae=N.yCenter,pe=N.getIndexAngle(0)-.5*ho,Te=pe,Pe,Re=360/this.countVisibleElements();for(Pe=0;Pe<r;++Pe)Te+=this._computeAngle(Pe,t,Re);for(Pe=r;Pe<r+s;Pe++){let Ke=d[Pe],Je=Te,_t=Te+this._computeAngle(Pe,t,Re),Nt=w.getDataVisibility(Pe)?N.getDistanceFromCenterForValue(this.getParsed(Pe).r):0;Te=_t,g&&(F.animateScale&&(Nt=0),F.animateRotate&&(Je=_t=pe));let kt={x:Q,y:ae,innerRadius:0,outerRadius:Nt,startAngle:Je,endAngle:_t,options:this.resolveDataElementOptions(Pe,Ke.active?"active":t)};this.updateElement(Ke,Pe,kt,t)}}countVisibleElements(){let d=this._cachedMeta,r=0;return d.data.forEach((s,t)=>{!isNaN(this.getParsed(t).r)&&this.chart.getDataVisibility(t)&&r++}),r}_computeAngle(d,r,s){return this.chart.getDataVisibility(d)?Qc(this.resolveDataElementOptions(d,r).angle||s):0}}return c})(),pV=(()=>{class c extends uM{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}return c})(),fV=(()=>{class c extends pf{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(d){let r=this._cachedMeta.vScale,s=this.getParsed(d);return{label:r.getLabels()[d],value:""+r.getLabelForValue(s[r.axis])}}parseObjectData(d,r,s,t){return kT.bind(this)(d,r,s,t)}update(d){let r=this._cachedMeta,s=r.dataset,t=r.data||[],g=r.iScale.getLabels();if(s.points=t,d!=="resize"){let w=this.resolveDatasetElementOptions(d);this.options.showLine||(w.borderWidth=0);let M={_loop:!0,_fullLoop:g.length===t.length,options:w};this.updateElement(s,void 0,M,d)}this.updateElements(t,0,t.length,d)}updateElements(d,r,s,t){let g=this._cachedMeta.rScale,w=t==="reset";for(let M=r;M<r+s;M++){let F=d[M],N=this.resolveDataElementOptions(M,F.active?"active":t),Q=g.getPointPositionForValue(M,this.getParsed(M).r),ae=w?g.xCenter:Q.x,pe=w?g.yCenter:Q.y,Te={x:ae,y:pe,angle:Q.angle,skip:isNaN(ae)||isNaN(pe),options:N};this.updateElement(F,M,Te,t)}}}return c})(),gV=(()=>{class c extends pf{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(d){let r=this._cachedMeta,s=this.chart.data.labels||[],{xScale:t,yScale:g}=r,w=this.getParsed(d),M=t.getLabelForValue(w.x),F=g.getLabelForValue(w.y);return{label:s[d]||"",value:"("+M+", "+F+")"}}update(d){let r=this._cachedMeta,{data:s=[]}=r,t=this.chart._animationsDisabled,{start:g,count:w}=bT(r,s,t);if(this._drawStart=g,this._drawCount=w,yT(r)&&(g=0,w=s.length),this.options.showLine){this.datasetElementType||this.addElements();let{dataset:M,_dataset:F}=r;M._chart=this.chart,M._datasetIndex=this.index,M._decimated=!!F._decimated,M.points=s;let N=this.resolveDatasetElementOptions(d);N.segment=this.options.segment,this.updateElement(M,void 0,{animated:!t,options:N},d)}else this.datasetElementType&&(delete r.dataset,this.datasetElementType=!1);this.updateElements(s,g,w,d)}addElements(){let{showLine:d}=this.options;!this.datasetElementType&&d&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(d,r,s,t){let g=t==="reset",{iScale:w,vScale:M,_stacked:F,_dataset:N}=this._cachedMeta,Q=this.resolveDataElementOptions(r,t),ae=this.getSharedOptions(Q),pe=this.includeOptions(t,ae),Te=w.axis,Pe=M.axis,{spanGaps:Re,segment:Ke}=this.options,Je=Ug(Re)?Re:Number.POSITIVE_INFINITY,_t=this.chart._animationsDisabled||g||t==="none",Nt=r>0&&this.getParsed(r-1);for(let kt=r;kt<r+s;++kt){let Ut=d[kt],ni=this.getParsed(kt),zt=_t?Ut:{},pi=pr(ni[Pe]),ei=zt[Te]=w.getPixelForValue(ni[Te],kt),Ji=zt[Pe]=g||pi?M.getBasePixel():M.getPixelForValue(F?this.applyStack(M,ni,F):ni[Pe],kt);zt.skip=isNaN(ei)||isNaN(Ji)||pi,zt.stop=kt>0&&Math.abs(ni[Te]-Nt[Te])>Je,Ke&&(zt.parsed=ni,zt.raw=N.data[kt]),pe&&(zt.options=ae||this.resolveDataElementOptions(kt,Ut.active?"active":t)),_t||this.updateElement(Ut,kt,zt,t),Nt=ni}this.updateSharedOptions(ae,t,Q)}getMaxOverflow(){let d=this._cachedMeta,r=d.data||[];if(!this.options.showLine){let M=0;for(let F=r.length-1;F>=0;--F)M=Math.max(M,r[F].size(this.resolveDataElementOptions(F))/2);return M>0&&M}let s=d.dataset,t=s.options&&s.options.borderWidth||0;if(!r.length)return t;let g=r[0].size(this.resolveDataElementOptions(0)),w=r[r.length-1].size(this.resolveDataElementOptions(r.length-1));return Math.max(t,g,w)/2}}return c})(),_V=Object.freeze({__proto__:null,BarController:dV,BubbleController:uV,DoughnutController:uM,LineController:mV,PieController:pV,PolarAreaController:XO,RadarController:fV,ScatterController:gV});function Hg(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var qT=class c{static override(o){Object.assign(c.prototype,o)}options;constructor(o){this.options=o||{}}init(){}formats(){return Hg()}parse(){return Hg()}format(){return Hg()}add(){return Hg()}diff(){return Hg()}startOf(){return Hg()}endOf(){return Hg()}},bV={_date:qT};function yV(c,o,d,r){let{controller:s,data:t,_sorted:g}=c,w=s._cachedMeta.iScale;if(w&&o===w.axis&&o!=="r"&&g&&t.length){let M=w._reversePixels?IP:uh;if(r){if(s._sharedOptions){let F=t[0],N=typeof F.getRange=="function"&&F.getRange(o);if(N){let Q=M(t,o,d-N),ae=M(t,o,d+N);return{lo:Q.lo,hi:ae.hi}}}}else return M(t,o,d)}return{lo:0,hi:t.length-1}}function fv(c,o,d,r,s){let t=c.getSortedVisibleDatasetMetas(),g=d[o];for(let w=0,M=t.length;w<M;++w){let{index:F,data:N}=t[w],{lo:Q,hi:ae}=yV(t[w],o,g,s);for(let pe=Q;pe<=ae;++pe){let Te=N[pe];Te.skip||r(Te,F,pe)}}}function vV(c){let o=c.indexOf("x")!==-1,d=c.indexOf("y")!==-1;return function(r,s){let t=o?Math.abs(r.x-s.x):0,g=d?Math.abs(r.y-s.y):0;return Math.sqrt(Math.pow(t,2)+Math.pow(g,2))}}function BT(c,o,d,r,s){let t=[];return!s&&!c.isPointInArea(o)||fv(c,d,o,function(w,M,F){!s&&!hh(w,c.chartArea,0)||w.inRange(o.x,o.y,r)&&t.push({element:w,datasetIndex:M,index:F})},!0),t}function xV(c,o,d,r){let s=[];function t(g,w,M){let{startAngle:F,endAngle:N}=g.getProps(["startAngle","endAngle"],r),{angle:Q}=mT(g,{x:o.x,y:o.y});U0(Q,F,N)&&s.push({element:g,datasetIndex:w,index:M})}return fv(c,d,o,t),s}function wV(c,o,d,r,s,t){let g=[],w=vV(d),M=Number.POSITIVE_INFINITY;function F(N,Q,ae){let pe=N.inRange(o.x,o.y,s);if(r&&!pe)return;let Te=N.getCenterPoint(s);if(!(!!t||c.isPointInArea(Te))&&!pe)return;let Re=w(o,Te);Re<M?(g=[{element:N,datasetIndex:Q,index:ae}],M=Re):Re===M&&g.push({element:N,datasetIndex:Q,index:ae})}return fv(c,d,o,F),g}function NT(c,o,d,r,s,t){return!t&&!c.isPointInArea(o)?[]:d==="r"&&!r?xV(c,o,d,s):wV(c,o,d,r,s,t)}function nO(c,o,d,r,s){let t=[],g=d==="x"?"inXRange":"inYRange",w=!1;return fv(c,d,o,(M,F,N)=>{M[g](o[d],s)&&(t.push({element:M,datasetIndex:F,index:N}),w=w||M.inRange(o.x,o.y,s))}),r&&!w?[]:t}var CV={evaluateInteractionItems:fv,modes:{index(c,o,d,r){let s=hf(o,c),t=d.axis||"x",g=d.includeInvisible||!1,w=d.intersect?BT(c,s,t,r,g):NT(c,s,t,!1,r,g),M=[];return w.length?(c.getSortedVisibleDatasetMetas().forEach(F=>{let N=w[0].index,Q=F.data[N];Q&&!Q.skip&&M.push({element:Q,datasetIndex:F.index,index:N})}),M):[]},dataset(c,o,d,r){let s=hf(o,c),t=d.axis||"xy",g=d.includeInvisible||!1,w=d.intersect?BT(c,s,t,r,g):NT(c,s,t,!1,r,g);if(w.length>0){let M=w[0].datasetIndex,F=c.getDatasetMeta(M).data;w=[];for(let N=0;N<F.length;++N)w.push({element:F[N],datasetIndex:M,index:N})}return w},point(c,o,d,r){let s=hf(o,c),t=d.axis||"xy",g=d.includeInvisible||!1;return BT(c,s,t,r,g)},nearest(c,o,d,r){let s=hf(o,c),t=d.axis||"xy",g=d.includeInvisible||!1;return NT(c,s,t,d.intersect,r,g)},x(c,o,d,r){let s=hf(o,c);return nO(c,s,"x",d.intersect,r)},y(c,o,d,r){let s=hf(o,c);return nO(c,s,"y",d.intersect,r)}}},QO=["left","top","right","bottom"];function av(c,o){return c.filter(d=>d.pos===o)}function rO(c,o){return c.filter(d=>QO.indexOf(d.pos)===-1&&d.box.axis===o)}function sv(c,o){return c.sort((d,r)=>{let s=o?r:d,t=o?d:r;return s.weight===t.weight?s.index-t.index:s.weight-t.weight})}function SV(c){let o=[],d,r,s,t,g,w;for(d=0,r=(c||[]).length;d<r;++d)s=c[d],{position:t,options:{stack:g,stackWeight:w=1}}=s,o.push({index:d,box:s,pos:t,horizontal:s.isHorizontal(),weight:s.weight,stack:g&&t+g,stackWeight:w});return o}function IV(c){let o={};for(let d of c){let{stack:r,pos:s,stackWeight:t}=d;if(!r||!QO.includes(s))continue;let g=o[r]||(o[r]={count:0,placed:0,weight:0,size:0});g.count++,g.weight+=t}return o}function TV(c,o){let d=IV(c),{vBoxMaxWidth:r,hBoxMaxHeight:s}=o,t,g,w;for(t=0,g=c.length;t<g;++t){w=c[t];let{fullSize:M}=w.box,F=d[w.stack],N=F&&w.stackWeight/F.weight;w.horizontal?(w.width=N?N*r:M&&o.availableWidth,w.height=s):(w.width=r,w.height=N?N*s:M&&o.availableHeight)}return d}function MV(c){let o=SV(c),d=sv(o.filter(F=>F.box.fullSize),!0),r=sv(av(o,"left"),!0),s=sv(av(o,"right")),t=sv(av(o,"top"),!0),g=sv(av(o,"bottom")),w=rO(o,"x"),M=rO(o,"y");return{fullSize:d,leftAndTop:r.concat(t),rightAndBottom:s.concat(M).concat(g).concat(w),chartArea:av(o,"chartArea"),vertical:r.concat(s).concat(M),horizontal:t.concat(g).concat(w)}}function oO(c,o,d,r){return Math.max(c[d],o[d])+Math.max(c[r],o[r])}function KO(c,o){c.top=Math.max(c.top,o.top),c.left=Math.max(c.left,o.left),c.bottom=Math.max(c.bottom,o.bottom),c.right=Math.max(c.right,o.right)}function kV(c,o,d,r){let{pos:s,box:t}=d,g=c.maxPadding;if(!Jn(s)){d.size&&(c[s]-=d.size);let Q=r[d.stack]||{size:0,count:1};Q.size=Math.max(Q.size,d.horizontal?t.height:t.width),d.size=Q.size/Q.count,c[s]+=d.size}t.getPadding&&KO(g,t.getPadding());let w=Math.max(0,o.outerWidth-oO(g,c,"left","right")),M=Math.max(0,o.outerHeight-oO(g,c,"top","bottom")),F=w!==c.w,N=M!==c.h;return c.w=w,c.h=M,d.horizontal?{same:F,other:N}:{same:N,other:F}}function EV(c){let o=c.maxPadding;function d(r){let s=Math.max(o[r]-c[r],0);return c[r]+=s,s}c.y+=d("top"),c.x+=d("left"),d("right"),d("bottom")}function DV(c,o){let d=o.maxPadding;function r(s){let t={left:0,top:0,right:0,bottom:0};return s.forEach(g=>{t[g]=Math.max(o[g],d[g])}),t}return r(c?["left","right"]:["top","bottom"])}function dv(c,o,d,r){let s=[],t,g,w,M,F,N;for(t=0,g=c.length,F=0;t<g;++t){w=c[t],M=w.box,M.update(w.width||o.w,w.height||o.h,DV(w.horizontal,o));let{same:Q,other:ae}=kV(o,d,w,r);F|=Q&&s.length,N=N||ae,M.fullSize||s.push(w)}return F&&dv(s,o,d,r)||N}function Aw(c,o,d,r,s){c.top=d,c.left=o,c.right=o+r,c.bottom=d+s,c.width=r,c.height=s}function aO(c,o,d,r){let s=d.padding,{x:t,y:g}=o;for(let w of c){let M=w.box,F=r[w.stack]||{count:1,placed:0,weight:1},N=w.stackWeight/F.weight||1;if(w.horizontal){let Q=o.w*N,ae=F.size||M.height;V0(F.start)&&(g=F.start),M.fullSize?Aw(M,s.left,g,d.outerWidth-s.right-s.left,ae):Aw(M,o.left+F.placed,g,Q,ae),F.start=g,F.placed+=Q,g=M.bottom}else{let Q=o.h*N,ae=F.size||M.width;V0(F.start)&&(t=F.start),M.fullSize?Aw(M,t,s.top,ae,d.outerHeight-s.bottom-s.top):Aw(M,t,o.top+F.placed,ae,Q),F.start=t,F.placed+=Q,t=M.right}}o.x=t,o.y=g}var Es={addBox(c,o){c.boxes||(c.boxes=[]),o.fullSize=o.fullSize||!1,o.position=o.position||"top",o.weight=o.weight||0,o._layers=o._layers||function(){return[{z:0,draw(d){o.draw(d)}}]},c.boxes.push(o)},removeBox(c,o){let d=c.boxes?c.boxes.indexOf(o):-1;d!==-1&&c.boxes.splice(d,1)},configure(c,o,d){o.fullSize=d.fullSize,o.position=d.position,o.weight=d.weight},update(c,o,d,r){if(!c)return;let s=cs(c.options.layout.padding),t=Math.max(o-s.width,0),g=Math.max(d-s.height,0),w=MV(c.boxes),M=w.vertical,F=w.horizontal;Nr(c.boxes,Pe=>{typeof Pe.beforeLayout=="function"&&Pe.beforeLayout()});let N=M.reduce((Pe,Re)=>Re.box.options&&Re.box.options.display===!1?Pe:Pe+1,0)||1,Q=Object.freeze({outerWidth:o,outerHeight:d,padding:s,availableWidth:t,availableHeight:g,vBoxMaxWidth:t/2/N,hBoxMaxHeight:g/2}),ae=Object.assign({},s);KO(ae,cs(r));let pe=Object.assign({maxPadding:ae,w:t,h:g,x:s.left,y:s.top},s),Te=TV(M.concat(F),Q);dv(w.fullSize,pe,Q,Te),dv(M,pe,Q,Te),dv(F,pe,Q,Te)&&dv(M,pe,Q,Te),EV(pe),aO(w.leftAndTop,pe,Q,Te),pe.x+=pe.w,pe.y+=pe.h,aO(w.rightAndBottom,pe,Q,Te),c.chartArea={left:pe.left,top:pe.top,right:pe.left+pe.w,bottom:pe.top+pe.h,height:pe.h,width:pe.w},Nr(w.chartArea,Pe=>{let Re=Pe.box;Object.assign(Re,c.chartArea),Re.update(pe.w,pe.h,{left:0,top:0,right:0,bottom:0})})}},jw=class{acquireContext(o,d){}releaseContext(o){return!1}addEventListener(o,d,r){}removeEventListener(o,d,r){}getDevicePixelRatio(){return 1}getMaximumSize(o,d,r,s){return d=Math.max(0,d||o.width),r=r||o.height,{width:d,height:Math.max(0,s?Math.floor(d/s):r)}}isAttached(o){return!0}updateConfig(o){}},$T=class extends jw{acquireContext(o){return o&&o.getContext&&o.getContext("2d")||null}updateConfig(o){o.options.animation=!1}},Bw="$chartjs",AV={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},sO=c=>c===null||c==="";function PV(c,o){let d=c.style,r=c.getAttribute("height"),s=c.getAttribute("width");if(c[Bw]={initial:{height:r,width:s,style:{display:d.display,height:d.height,width:d.width}}},d.display=d.display||"block",d.boxSizing=d.boxSizing||"border-box",sO(s)){let t=DT(c,"width");t!==void 0&&(c.width=t)}if(sO(r))if(c.style.height==="")c.height=c.width/(o||2);else{let t=DT(c,"height");t!==void 0&&(c.height=t)}return c}var JO=UP?{passive:!0}:!1;function OV(c,o,d){c&&c.addEventListener(o,d,JO)}function RV(c,o,d){c&&c.canvas&&c.canvas.removeEventListener(o,d,JO)}function FV(c,o){let d=AV[c.type]||c.type,{x:r,y:s}=hf(c,o);return{type:d,chart:o,native:c,x:r!==void 0?r:null,y:s!==void 0?s:null}}function Uw(c,o){for(let d of c)if(d===o||d.contains(o))return!0}function LV(c,o,d){let r=c.canvas,s=new MutationObserver(t=>{let g=!1;for(let w of t)g=g||Uw(w.addedNodes,r),g=g&&!Uw(w.removedNodes,r);g&&d()});return s.observe(document,{childList:!0,subtree:!0}),s}function zV(c,o,d){let r=c.canvas,s=new MutationObserver(t=>{let g=!1;for(let w of t)g=g||Uw(w.removedNodes,r),g=g&&!Uw(w.addedNodes,r);g&&d()});return s.observe(document,{childList:!0,subtree:!0}),s}var hv=new Map,lO=0;function e3(){let c=window.devicePixelRatio;c!==lO&&(lO=c,hv.forEach((o,d)=>{d.currentDevicePixelRatio!==c&&o()}))}function BV(c,o){hv.size||window.addEventListener("resize",e3),hv.set(c,o)}function NV(c){hv.delete(c),hv.size||window.removeEventListener("resize",e3)}function VV(c,o,d){let r=c.canvas,s=r&&Ew(r);if(!s)return;let t=_T((w,M)=>{let F=s.clientWidth;d(w,M),F<s.clientWidth&&d()},window),g=new ResizeObserver(w=>{let M=w[0],F=M.contentRect.width,N=M.contentRect.height;F===0&&N===0||t(F,N)});return g.observe(s),BV(c,t),g}function VT(c,o,d){d&&d.disconnect(),o==="resize"&&NV(c)}function jV(c,o,d){let r=c.canvas,s=_T(t=>{c.ctx!==null&&d(FV(t,c))},c);return OV(r,o,s),s}var YT=class extends jw{acquireContext(o,d){let r=o&&o.getContext&&o.getContext("2d");return r&&r.canvas===o?(PV(o,d),r):null}releaseContext(o){let d=o.canvas;if(!d[Bw])return!1;let r=d[Bw].initial;["height","width"].forEach(t=>{let g=r[t];pr(g)?d.removeAttribute(t):d.setAttribute(t,g)});let s=r.style||{};return Object.keys(s).forEach(t=>{d.style[t]=s[t]}),d.width=d.width,delete d[Bw],!0}addEventListener(o,d,r){this.removeEventListener(o,d);let s=o.$proxies||(o.$proxies={}),g={attach:LV,detach:zV,resize:VV}[d]||jV;s[d]=g(o,d,r)}removeEventListener(o,d){let r=o.$proxies||(o.$proxies={}),s=r[d];if(!s)return;({attach:VT,detach:VT,resize:VT}[d]||RV)(o,d,s),r[d]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(o,d,r,s){return jP(o,d,r,s)}isAttached(o){let d=o&&Ew(o);return!!(d&&d.isConnected)}};function UV(c){return!kw()||typeof OffscreenCanvas<"u"&&c instanceof OffscreenCanvas?$T:YT}var Xd=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(o){let{x:d,y:r}=this.getProps(["x","y"],o);return{x:d,y:r}}hasValue(){return Ug(this.x)&&Ug(this.y)}getProps(o,d){let r=this.$animations;if(!d||!r)return this;let s={};return o.forEach(t=>{s[t]=r[t]&&r[t].active()?r[t]._to:this[t]}),s}};function WV(c,o){let d=c.options.ticks,r=HV(c),s=Math.min(d.maxTicksLimit||r,r),t=d.major.enabled?qV(o):[],g=t.length,w=t[0],M=t[g-1],F=[];if(g>s)return $V(o,F,t,g/s),F;let N=GV(t,o,s);if(g>0){let Q,ae,pe=g>1?Math.round((M-w)/(g-1)):null;for(Pw(o,F,N,pr(pe)?0:w-pe,w),Q=0,ae=g-1;Q<ae;Q++)Pw(o,F,N,t[Q],t[Q+1]);return Pw(o,F,N,M,pr(pe)?o.length:M+pe),F}return Pw(o,F,N),F}function HV(c){let o=c.options.offset,d=c._tickSize(),r=c._length/d+(o?0:1),s=c._maxLength/d;return Math.floor(Math.min(r,s))}function GV(c,o,d){let r=YV(c),s=o.length/d;if(!r)return Math.max(s,1);let t=wP(r);for(let g=0,w=t.length-1;g<w;g++){let M=t[g];if(M>s)return M}return Math.max(s,1)}function qV(c){let o=[],d,r;for(d=0,r=c.length;d<r;d++)c[d].major&&o.push(d);return o}function $V(c,o,d,r){let s=0,t=d[0],g;for(r=Math.ceil(r),g=0;g<c.length;g++)g===t&&(o.push(c[g]),s++,t=d[s*r])}function Pw(c,o,d,r,s){let t=An(r,0),g=Math.min(An(s,c.length),c.length),w=0,M,F,N;for(d=Math.ceil(d),s&&(M=s-r,d=M/Math.floor(M/d)),N=t;N<0;)w++,N=Math.round(t+w*d);for(F=Math.max(t,0);F<g;F++)F===N&&(o.push(c[F]),w++,N=Math.round(t+w*d))}function YV(c){let o=c.length,d,r;if(o<2)return!1;for(r=c[0],d=1;d<o;++d)if(c[d]-c[d-1]!==r)return!1;return r}var ZV=c=>c==="left"?"right":c==="right"?"left":c,cO=(c,o,d)=>o==="top"||o==="left"?c[o]+d:c[o]-d,dO=(c,o)=>Math.min(o||c,c);function uO(c,o){let d=[],r=c.length/o,s=c.length,t=0;for(;t<s;t+=r)d.push(c[Math.floor(t)]);return d}function XV(c,o,d){let r=c.ticks.length,s=Math.min(o,r-1),t=c._startPixel,g=c._endPixel,w=1e-6,M=c.getPixelForTick(s),F;if(!(d&&(r===1?F=Math.max(M-t,g-M):o===0?F=(c.getPixelForTick(1)-M)/2:F=(M-c.getPixelForTick(s-1))/2,M+=s<o?F:-F,M<t-w||M>g+w)))return M}function QV(c,o){Nr(c,d=>{let r=d.gc,s=r.length/2,t;if(s>o){for(t=0;t<s;++t)delete d.data[r[t]];r.splice(0,s)}})}function lv(c){return c.drawTicks?c.tickLength:0}function hO(c,o){if(!c.display)return 0;let d=xa(c.font,o),r=cs(c.padding);return(uo(c.text)?c.text.length:1)*d.lineHeight+r.height}function KV(c,o){return Wm(c,{scale:o,type:"scale"})}function JV(c,o,d){return Wm(c,{tick:d,index:o,type:"tick"})}function e6(c,o,d){let r=Cw(c);return(d&&o!=="right"||!d&&o==="right")&&(r=ZV(r)),r}function t6(c,o,d,r){let{top:s,left:t,bottom:g,right:w,chart:M}=c,{chartArea:F,scales:N}=M,Q=0,ae,pe,Te,Pe=g-s,Re=w-t;if(c.isHorizontal()){if(pe=ls(r,t,w),Jn(d)){let Ke=Object.keys(d)[0],Je=d[Ke];Te=N[Ke].getPixelForValue(Je)+Pe-o}else d==="center"?Te=(F.bottom+F.top)/2+Pe-o:Te=cO(c,d,o);ae=w-t}else{if(Jn(d)){let Ke=Object.keys(d)[0],Je=d[Ke];pe=N[Ke].getPixelForValue(Je)-Re+o}else d==="center"?pe=(F.left+F.right)/2-Re+o:pe=cO(c,d,o);Te=ls(r,g,s),Q=d==="left"?-ia:ia}return{titleX:pe,titleY:Te,maxWidth:ae,rotation:Q}}var qg=class c extends Xd{constructor(o){super(),this.id=o.id,this.type=o.type,this.options=void 0,this.ctx=o.ctx,this.chart=o.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(o){this.options=o.setContext(this.getContext()),this.axis=o.axis,this._userMin=this.parse(o.min),this._userMax=this.parse(o.max),this._suggestedMin=this.parse(o.suggestedMin),this._suggestedMax=this.parse(o.suggestedMax)}parse(o,d){return o}getUserBounds(){let{_userMin:o,_userMax:d,_suggestedMin:r,_suggestedMax:s}=this;return o=Dl(o,Number.POSITIVE_INFINITY),d=Dl(d,Number.NEGATIVE_INFINITY),r=Dl(r,Number.POSITIVE_INFINITY),s=Dl(s,Number.NEGATIVE_INFINITY),{min:Dl(o,r),max:Dl(d,s),minDefined:Fo(o),maxDefined:Fo(d)}}getMinMax(o){let{min:d,max:r,minDefined:s,maxDefined:t}=this.getUserBounds(),g;if(s&&t)return{min:d,max:r};let w=this.getMatchingVisibleMetas();for(let M=0,F=w.length;M<F;++M)g=w[M].controller.getMinMax(this,o),s||(d=Math.min(d,g.min)),t||(r=Math.max(r,g.max));return d=t&&d>r?r:d,r=s&&d>r?d:r,{min:Dl(d,Dl(r,d)),max:Dl(r,Dl(d,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let o=this.chart.data;return this.options.labels||(this.isHorizontal()?o.xLabels:o.yLabels)||o.labels||[]}getLabelItems(o=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(o))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){so(this.options.beforeUpdate,[this])}update(o,d,r){let{beginAtZero:s,grace:t,ticks:g}=this.options,w=g.sampleSize;this.beforeUpdate(),this.maxWidth=o,this.maxHeight=d,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=FP(this,t,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let M=w<this.ticks.length;this._convertTicksToLabels(M?uO(this.ticks,w):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),g.display&&(g.autoSkip||g.source==="auto")&&(this.ticks=WV(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),M&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let o=this.options.reverse,d,r;this.isHorizontal()?(d=this.left,r=this.right):(d=this.top,r=this.bottom,o=!o),this._startPixel=d,this._endPixel=r,this._reversePixels=o,this._length=r-d,this._alignToPixels=this.options.alignToPixels}afterUpdate(){so(this.options.afterUpdate,[this])}beforeSetDimensions(){so(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){so(this.options.afterSetDimensions,[this])}_callHooks(o){this.chart.notifyPlugins(o,this.getContext()),so(this.options[o],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){so(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(o){let d=this.options.ticks,r,s,t;for(r=0,s=o.length;r<s;r++)t=o[r],t.label=so(d.callback,[t.value,r,o],this)}afterTickToLabelConversion(){so(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){so(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let o=this.options,d=o.ticks,r=dO(this.ticks.length,o.ticks.maxTicksLimit),s=d.minRotation||0,t=d.maxRotation,g=s,w,M,F;if(!this._isVisible()||!d.display||s>=t||r<=1||!this.isHorizontal()){this.labelRotation=s;return}let N=this._getLabelSizes(),Q=N.widest.width,ae=N.highest.height,pe=Ra(this.chart.width-Q,0,this.maxWidth);w=o.offset?this.maxWidth/r:pe/(r-1),Q+6>w&&(w=pe/(r-(o.offset?.5:1)),M=this.maxHeight-lv(o.grid)-d.padding-hO(o.title,this.chart.options.font),F=Math.sqrt(Q*Q+ae*ae),g=xw(Math.min(Math.asin(Ra((N.highest.height+6)/w,-1,1)),Math.asin(Ra(M/F,-1,1))-Math.asin(Ra(ae/F,-1,1)))),g=Math.max(s,Math.min(t,g))),this.labelRotation=g}afterCalculateLabelRotation(){so(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){so(this.options.beforeFit,[this])}fit(){let o={width:0,height:0},{chart:d,options:{ticks:r,title:s,grid:t}}=this,g=this._isVisible(),w=this.isHorizontal();if(g){let M=hO(s,d.options.font);if(w?(o.width=this.maxWidth,o.height=lv(t)+M):(o.height=this.maxHeight,o.width=lv(t)+M),r.display&&this.ticks.length){let{first:F,last:N,widest:Q,highest:ae}=this._getLabelSizes(),pe=r.padding*2,Te=Qc(this.labelRotation),Pe=Math.cos(Te),Re=Math.sin(Te);if(w){let Ke=r.mirror?0:Re*Q.width+Pe*ae.height;o.height=Math.min(this.maxHeight,o.height+Ke+pe)}else{let Ke=r.mirror?0:Pe*Q.width+Re*ae.height;o.width=Math.min(this.maxWidth,o.width+Ke+pe)}this._calculatePadding(F,N,Re,Pe)}}this._handleMargins(),w?(this.width=this._length=d.width-this._margins.left-this._margins.right,this.height=o.height):(this.width=o.width,this.height=this._length=d.height-this._margins.top-this._margins.bottom)}_calculatePadding(o,d,r,s){let{ticks:{align:t,padding:g},position:w}=this.options,M=this.labelRotation!==0,F=w!=="top"&&this.axis==="x";if(this.isHorizontal()){let N=this.getPixelForTick(0)-this.left,Q=this.right-this.getPixelForTick(this.ticks.length-1),ae=0,pe=0;M?F?(ae=s*o.width,pe=r*d.height):(ae=r*o.height,pe=s*d.width):t==="start"?pe=d.width:t==="end"?ae=o.width:t!=="inner"&&(ae=o.width/2,pe=d.width/2),this.paddingLeft=Math.max((ae-N+g)*this.width/(this.width-N),0),this.paddingRight=Math.max((pe-Q+g)*this.width/(this.width-Q),0)}else{let N=d.height/2,Q=o.height/2;t==="start"?(N=0,Q=o.height):t==="end"&&(N=d.height,Q=0),this.paddingTop=N+g,this.paddingBottom=Q+g}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){so(this.options.afterFit,[this])}isHorizontal(){let{axis:o,position:d}=this.options;return d==="top"||d==="bottom"||o==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(o){this.beforeTickToLabelConversion(),this.generateTickLabels(o);let d,r;for(d=0,r=o.length;d<r;d++)pr(o[d].label)&&(o.splice(d,1),r--,d--);this.afterTickToLabelConversion()}_getLabelSizes(){let o=this._labelSizes;if(!o){let d=this.options.ticks.sampleSize,r=this.ticks;d<r.length&&(r=uO(r,d)),this._labelSizes=o=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return o}_computeLabelSizes(o,d,r){let{ctx:s,_longestTextCache:t}=this,g=[],w=[],M=Math.floor(d/dO(d,r)),F=0,N=0,Q,ae,pe,Te,Pe,Re,Ke,Je,_t,Nt,kt;for(Q=0;Q<d;Q+=M){if(Te=o[Q].label,Pe=this._resolveTickFontOptions(Q),s.font=Re=Pe.string,Ke=t[Re]=t[Re]||{data:{},gc:[]},Je=Pe.lineHeight,_t=Nt=0,!pr(Te)&&!uo(Te))_t=ev(s,Ke.data,Ke.gc,_t,Te),Nt=Je;else if(uo(Te))for(ae=0,pe=Te.length;ae<pe;++ae)kt=Te[ae],!pr(kt)&&!uo(kt)&&(_t=ev(s,Ke.data,Ke.gc,_t,kt),Nt+=Je);g.push(_t),w.push(Nt),F=Math.max(_t,F),N=Math.max(Nt,N)}QV(t,d);let Ut=g.indexOf(F),ni=w.indexOf(N),zt=pi=>({width:g[pi]||0,height:w[pi]||0});return{first:zt(0),last:zt(d-1),widest:zt(Ut),highest:zt(ni),widths:g,heights:w}}getLabelForValue(o){return o}getPixelForValue(o,d){return NaN}getValueForPixel(o){}getPixelForTick(o){let d=this.ticks;return o<0||o>d.length-1?null:this.getPixelForValue(d[o].value)}getPixelForDecimal(o){this._reversePixels&&(o=1-o);let d=this._startPixel+o*this._length;return SP(this._alignToPixels?cf(this.chart,d,0):d)}getDecimalForPixel(o){let d=(o-this._startPixel)/this._length;return this._reversePixels?1-d:d}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:o,max:d}=this;return o<0&&d<0?d:o>0&&d>0?o:0}getContext(o){let d=this.ticks||[];if(o>=0&&o<d.length){let r=d[o];return r.$context||(r.$context=JV(this.getContext(),o,r))}return this.$context||(this.$context=KV(this.chart.getContext(),this))}_tickSize(){let o=this.options.ticks,d=Qc(this.labelRotation),r=Math.abs(Math.cos(d)),s=Math.abs(Math.sin(d)),t=this._getLabelSizes(),g=o.autoSkipPadding||0,w=t?t.widest.width+g:0,M=t?t.highest.height+g:0;return this.isHorizontal()?M*r>w*s?w/r:M/s:M*s<w*r?M/r:w/s}_isVisible(){let o=this.options.display;return o!=="auto"?!!o:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(o){let d=this.axis,r=this.chart,s=this.options,{grid:t,position:g,border:w}=s,M=t.offset,F=this.isHorizontal(),Q=this.ticks.length+(M?1:0),ae=lv(t),pe=[],Te=w.setContext(this.getContext()),Pe=Te.display?Te.width:0,Re=Pe/2,Ke=function(hn){return cf(r,hn,Pe)},Je,_t,Nt,kt,Ut,ni,zt,pi,ei,Ji,bn,lo;if(g==="top")Je=Ke(this.bottom),ni=this.bottom-ae,pi=Je-Re,Ji=Ke(o.top)+Re,lo=o.bottom;else if(g==="bottom")Je=Ke(this.top),Ji=o.top,lo=Ke(o.bottom)-Re,ni=Je+Re,pi=this.top+ae;else if(g==="left")Je=Ke(this.right),Ut=this.right-ae,zt=Je-Re,ei=Ke(o.left)+Re,bn=o.right;else if(g==="right")Je=Ke(this.left),ei=o.left,bn=Ke(o.right)-Re,Ut=Je+Re,zt=this.left+ae;else if(d==="x"){if(g==="center")Je=Ke((o.top+o.bottom)/2+.5);else if(Jn(g)){let hn=Object.keys(g)[0],Fr=g[hn];Je=Ke(this.chart.scales[hn].getPixelForValue(Fr))}Ji=o.top,lo=o.bottom,ni=Je+Re,pi=ni+ae}else if(d==="y"){if(g==="center")Je=Ke((o.left+o.right)/2);else if(Jn(g)){let hn=Object.keys(g)[0],Fr=g[hn];Je=Ke(this.chart.scales[hn].getPixelForValue(Fr))}Ut=Je-Re,zt=Ut-ae,ei=o.left,bn=o.right}let Hi=An(s.ticks.maxTicksLimit,Q),Mn=Math.max(1,Math.ceil(Q/Hi));for(_t=0;_t<Q;_t+=Mn){let hn=this.getContext(_t),Fr=t.setContext(hn),yo=w.setContext(hn),Zn=Fr.lineWidth,en=Fr.color,As=yo.dash||[],Gr=yo.dashOffset,wa=Fr.tickWidth,Ca=Fr.tickColor,Ys=Fr.tickBorderDash||[],si=Fr.tickBorderDashOffset;Nt=XV(this,_t,M),Nt!==void 0&&(kt=cf(r,Nt,Zn),F?Ut=zt=ei=bn=kt:ni=pi=Ji=lo=kt,pe.push({tx1:Ut,ty1:ni,tx2:zt,ty2:pi,x1:ei,y1:Ji,x2:bn,y2:lo,width:Zn,color:en,borderDash:As,borderDashOffset:Gr,tickWidth:wa,tickColor:Ca,tickBorderDash:Ys,tickBorderDashOffset:si}))}return this._ticksLength=Q,this._borderValue=Je,pe}_computeLabelItems(o){let d=this.axis,r=this.options,{position:s,ticks:t}=r,g=this.isHorizontal(),w=this.ticks,{align:M,crossAlign:F,padding:N,mirror:Q}=t,ae=lv(r.grid),pe=ae+N,Te=Q?-N:pe,Pe=-Qc(this.labelRotation),Re=[],Ke,Je,_t,Nt,kt,Ut,ni,zt,pi,ei,Ji,bn,lo="middle";if(s==="top")Ut=this.bottom-Te,ni=this._getXAxisLabelAlignment();else if(s==="bottom")Ut=this.top+Te,ni=this._getXAxisLabelAlignment();else if(s==="left"){let Mn=this._getYAxisLabelAlignment(ae);ni=Mn.textAlign,kt=Mn.x}else if(s==="right"){let Mn=this._getYAxisLabelAlignment(ae);ni=Mn.textAlign,kt=Mn.x}else if(d==="x"){if(s==="center")Ut=(o.top+o.bottom)/2+pe;else if(Jn(s)){let Mn=Object.keys(s)[0],hn=s[Mn];Ut=this.chart.scales[Mn].getPixelForValue(hn)+pe}ni=this._getXAxisLabelAlignment()}else if(d==="y"){if(s==="center")kt=(o.left+o.right)/2-pe;else if(Jn(s)){let Mn=Object.keys(s)[0],hn=s[Mn];kt=this.chart.scales[Mn].getPixelForValue(hn)}ni=this._getYAxisLabelAlignment(ae).textAlign}d==="y"&&(M==="start"?lo="top":M==="end"&&(lo="bottom"));let Hi=this._getLabelSizes();for(Ke=0,Je=w.length;Ke<Je;++Ke){_t=w[Ke],Nt=_t.label;let Mn=t.setContext(this.getContext(Ke));zt=this.getPixelForTick(Ke)+t.labelOffset,pi=this._resolveTickFontOptions(Ke),ei=pi.lineHeight,Ji=uo(Nt)?Nt.length:1;let hn=Ji/2,Fr=Mn.color,yo=Mn.textStrokeColor,Zn=Mn.textStrokeWidth,en=ni;g?(kt=zt,ni==="inner"&&(Ke===Je-1?en=this.options.reverse?"left":"right":Ke===0?en=this.options.reverse?"right":"left":en="center"),s==="top"?F==="near"||Pe!==0?bn=-Ji*ei+ei/2:F==="center"?bn=-Hi.highest.height/2-hn*ei+ei:bn=-Hi.highest.height+ei/2:F==="near"||Pe!==0?bn=ei/2:F==="center"?bn=Hi.highest.height/2-hn*ei:bn=Hi.highest.height-Ji*ei,Q&&(bn*=-1),Pe!==0&&!Mn.showLabelBackdrop&&(kt+=ei/2*Math.sin(Pe))):(Ut=zt,bn=(1-Ji)*ei/2);let As;if(Mn.showLabelBackdrop){let Gr=cs(Mn.backdropPadding),wa=Hi.heights[Ke],Ca=Hi.widths[Ke],Ys=bn-Gr.top,si=0-Gr.left;switch(lo){case"middle":Ys-=wa/2;break;case"bottom":Ys-=wa;break}switch(ni){case"center":si-=Ca/2;break;case"right":si-=Ca;break;case"inner":Ke===Je-1?si-=Ca:Ke>0&&(si-=Ca/2);break}As={left:si,top:Ys,width:Ca+Gr.width,height:wa+Gr.height,color:Mn.backdropColor}}Re.push({label:Nt,font:pi,textOffset:bn,options:{rotation:Pe,color:Fr,strokeColor:yo,strokeWidth:Zn,textAlign:en,textBaseline:lo,translation:[kt,Ut],backdrop:As}})}return Re}_getXAxisLabelAlignment(){let{position:o,ticks:d}=this.options;if(-Qc(this.labelRotation))return o==="top"?"left":"right";let s="center";return d.align==="start"?s="left":d.align==="end"?s="right":d.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(o){let{position:d,ticks:{crossAlign:r,mirror:s,padding:t}}=this.options,g=this._getLabelSizes(),w=o+t,M=g.widest.width,F,N;return d==="left"?s?(N=this.right+t,r==="near"?F="left":r==="center"?(F="center",N+=M/2):(F="right",N+=M)):(N=this.right-w,r==="near"?F="right":r==="center"?(F="center",N-=M/2):(F="left",N=this.left)):d==="right"?s?(N=this.left+t,r==="near"?F="right":r==="center"?(F="center",N-=M/2):(F="left",N-=M)):(N=this.left+w,r==="near"?F="left":r==="center"?(F="center",N+=M/2):(F="right",N=this.right)):F="right",{textAlign:F,x:N}}_computeLabelArea(){if(this.options.ticks.mirror)return;let o=this.chart,d=this.options.position;if(d==="left"||d==="right")return{top:0,left:this.left,bottom:o.height,right:this.right};if(d==="top"||d==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:o.width}}drawBackground(){let{ctx:o,options:{backgroundColor:d},left:r,top:s,width:t,height:g}=this;d&&(o.save(),o.fillStyle=d,o.fillRect(r,s,t,g),o.restore())}getLineWidthForValue(o){let d=this.options.grid;if(!this._isVisible()||!d.display)return 0;let s=this.ticks.findIndex(t=>t.value===o);return s>=0?d.setContext(this.getContext(s)).lineWidth:0}drawGrid(o){let d=this.options.grid,r=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(o)),t,g,w=(M,F,N)=>{!N.width||!N.color||(r.save(),r.lineWidth=N.width,r.strokeStyle=N.color,r.setLineDash(N.borderDash||[]),r.lineDashOffset=N.borderDashOffset,r.beginPath(),r.moveTo(M.x,M.y),r.lineTo(F.x,F.y),r.stroke(),r.restore())};if(d.display)for(t=0,g=s.length;t<g;++t){let M=s[t];d.drawOnChartArea&&w({x:M.x1,y:M.y1},{x:M.x2,y:M.y2},M),d.drawTicks&&w({x:M.tx1,y:M.ty1},{x:M.tx2,y:M.ty2},{color:M.tickColor,width:M.tickWidth,borderDash:M.tickBorderDash,borderDashOffset:M.tickBorderDashOffset})}}drawBorder(){let{chart:o,ctx:d,options:{border:r,grid:s}}=this,t=r.setContext(this.getContext()),g=r.display?t.width:0;if(!g)return;let w=s.setContext(this.getContext(0)).lineWidth,M=this._borderValue,F,N,Q,ae;this.isHorizontal()?(F=cf(o,this.left,g)-g/2,N=cf(o,this.right,w)+w/2,Q=ae=M):(Q=cf(o,this.top,g)-g/2,ae=cf(o,this.bottom,w)+w/2,F=N=M),d.save(),d.lineWidth=t.width,d.strokeStyle=t.color,d.beginPath(),d.moveTo(F,Q),d.lineTo(N,ae),d.stroke(),d.restore()}drawLabels(o){if(!this.options.ticks.display)return;let r=this.ctx,s=this._computeLabelArea();s&&nv(r,s);let t=this.getLabelItems(o);for(let g of t){let w=g.options,M=g.font,F=g.label,N=g.textOffset;df(r,F,0,N,M,w)}s&&rv(r)}drawTitle(){let{ctx:o,options:{position:d,title:r,reverse:s}}=this;if(!r.display)return;let t=xa(r.font),g=cs(r.padding),w=r.align,M=t.lineHeight/2;d==="bottom"||d==="center"||Jn(d)?(M+=g.bottom,uo(r.text)&&(M+=t.lineHeight*(r.text.length-1))):M+=g.top;let{titleX:F,titleY:N,maxWidth:Q,rotation:ae}=t6(this,M,d,w);df(o,r.text,0,0,t,{color:r.color,maxWidth:Q,rotation:ae,textAlign:e6(w,d,s),textBaseline:"middle",translation:[F,N]})}draw(o){this._isVisible()&&(this.drawBackground(),this.drawGrid(o),this.drawBorder(),this.drawTitle(),this.drawLabels(o))}_layers(){let o=this.options,d=o.ticks&&o.ticks.z||0,r=An(o.grid&&o.grid.z,-1),s=An(o.border&&o.border.z,0);return!this._isVisible()||this.draw!==c.prototype.draw?[{z:d,draw:t=>{this.draw(t)}}]:[{z:r,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:d,draw:t=>{this.drawLabels(t)}}]}getMatchingVisibleMetas(o){let d=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",s=[],t,g;for(t=0,g=d.length;t<g;++t){let w=d[t];w[r]===this.id&&(!o||w.type===o)&&s.push(w)}return s}_resolveTickFontOptions(o){let d=this.options.ticks.setContext(this.getContext(o));return xa(d.font)}_maxDigits(){let o=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/o}},$0=class{constructor(o,d,r){this.type=o,this.scope=d,this.override=r,this.items=Object.create(null)}isForType(o){return Object.prototype.isPrototypeOf.call(this.type.prototype,o.prototype)}register(o){let d=Object.getPrototypeOf(o),r;r6(d)&&(r=this.register(d));let s=this.items,t=o.id,g=this.scope+"."+t;if(!t)throw new Error("class does not have id: "+o);return t in s||(s[t]=o,i6(o,g,r),this.override&&Lo.override(o.id,o.overrides)),g}get(o){return this.items[o]}unregister(o){let d=this.items,r=o.id,s=this.scope;r in d&&delete d[r],s&&r in Lo[s]&&(delete Lo[s][r],this.override&&delete lf[r])}};function i6(c,o,d){let r=z0(Object.create(null),[d?Lo.get(d):{},Lo.get(o),c.defaults]);Lo.set(o,r),c.defaultRoutes&&n6(o,c.defaultRoutes),c.descriptors&&Lo.describe(o,c.descriptors)}function n6(c,o){Object.keys(o).forEach(d=>{let r=d.split("."),s=r.pop(),t=[c].concat(r).join("."),g=o[d].split("."),w=g.pop(),M=g.join(".");Lo.route(t,s,M,w)})}function r6(c){return"id"in c&&"defaults"in c}var ZT=class{constructor(){this.controllers=new $0(pf,"datasets",!0),this.elements=new $0(Xd,"elements"),this.plugins=new $0(Object,"plugins"),this.scales=new $0(qg,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...o){this._each("register",o)}remove(...o){this._each("unregister",o)}addControllers(...o){this._each("register",o,this.controllers)}addElements(...o){this._each("register",o,this.elements)}addPlugins(...o){this._each("register",o,this.plugins)}addScales(...o){this._each("register",o,this.scales)}getController(o){return this._get(o,this.controllers,"controller")}getElement(o){return this._get(o,this.elements,"element")}getPlugin(o){return this._get(o,this.plugins,"plugin")}getScale(o){return this._get(o,this.scales,"scale")}removeControllers(...o){this._each("unregister",o,this.controllers)}removeElements(...o){this._each("unregister",o,this.elements)}removePlugins(...o){this._each("unregister",o,this.plugins)}removeScales(...o){this._each("unregister",o,this.scales)}_each(o,d,r){[...d].forEach(s=>{let t=r||this._getRegistryForType(s);r||t.isForType(s)||t===this.plugins&&s.id?this._exec(o,t,s):Nr(s,g=>{let w=r||this._getRegistryForType(g);this._exec(o,w,g)})})}_exec(o,d,r){let s=vw(o);so(r["before"+s],[],r),d[o](r),so(r["after"+s],[],r)}_getRegistryForType(o){for(let d=0;d<this._typedRegistries.length;d++){let r=this._typedRegistries[d];if(r.isForType(o))return r}return this.plugins}_get(o,d,r){let s=d.get(o);if(s===void 0)throw new Error('"'+o+'" is not a registered '+r+".");return s}},gh=new ZT,XT=class{constructor(){this._init=[]}notify(o,d,r,s){d==="beforeInit"&&(this._init=this._createDescriptors(o,!0),this._notify(this._init,o,"install"));let t=s?this._descriptors(o).filter(s):this._descriptors(o),g=this._notify(t,o,d,r);return d==="afterDestroy"&&(this._notify(t,o,"stop"),this._notify(this._init,o,"uninstall")),g}_notify(o,d,r,s){s=s||{};for(let t of o){let g=t.plugin,w=g[r],M=[d,s,t.options];if(so(w,M,g)===!1&&s.cancelable)return!1}return!0}invalidate(){pr(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(o){if(this._cache)return this._cache;let d=this._cache=this._createDescriptors(o);return this._notifyStateChanges(o),d}_createDescriptors(o,d){let r=o&&o.config,s=An(r.options&&r.options.plugins,{}),t=o6(r);return s===!1&&!d?[]:s6(o,t,s,d)}_notifyStateChanges(o){let d=this._oldCache||[],r=this._cache,s=(t,g)=>t.filter(w=>!g.some(M=>w.plugin.id===M.plugin.id));this._notify(s(d,r),o,"stop"),this._notify(s(r,d),o,"start")}};function o6(c){let o={},d=[],r=Object.keys(gh.plugins.items);for(let t=0;t<r.length;t++)d.push(gh.getPlugin(r[t]));let s=c.plugins||[];for(let t=0;t<s.length;t++){let g=s[t];d.indexOf(g)===-1&&(d.push(g),o[g.id]=!0)}return{plugins:d,localIds:o}}function a6(c,o){return!o&&c===!1?null:c===!0?{}:c}function s6(c,{plugins:o,localIds:d},r,s){let t=[],g=c.getContext();for(let w of o){let M=w.id,F=a6(r[M],s);F!==null&&t.push({plugin:w,options:l6(c.config,{plugin:w,local:d[M]},F,g)})}return t}function l6(c,{plugin:o,local:d},r,s){let t=c.pluginScopeKeys(o),g=c.getOptionScopes(r,t);return d&&o.defaults&&g.push(o.defaults),c.createResolver(g,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function QT(c,o){let d=Lo.datasets[c]||{};return((o.datasets||{})[c]||{}).indexAxis||o.indexAxis||d.indexAxis||"x"}function c6(c,o){let d=c;return c==="_index_"?d=o:c==="_value_"&&(d=o==="x"?"y":"x"),d}function d6(c,o){return c===o?"_index_":"_value_"}function mO(c){if(c==="x"||c==="y"||c==="r")return c}function u6(c){if(c==="top"||c==="bottom")return"x";if(c==="left"||c==="right")return"y"}function KT(c,...o){if(mO(c))return c;for(let d of o){let r=d.axis||u6(d.position)||c.length>1&&mO(c[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${c}' axis. Please provide 'axis' or 'position' option.`)}function pO(c,o,d){if(d[o+"AxisID"]===c)return{axis:o}}function h6(c,o){if(o.data&&o.data.datasets){let d=o.data.datasets.filter(r=>r.xAxisID===c||r.yAxisID===c);if(d.length)return pO(c,"x",d[0])||pO(c,"y",d[0])}return{}}function m6(c,o){let d=lf[c.type]||{scales:{}},r=o.scales||{},s=QT(c.type,o),t=Object.create(null);return Object.keys(r).forEach(g=>{let w=r[g];if(!Jn(w))return console.error(`Invalid scale configuration for scale: ${g}`);if(w._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${g}`);let M=KT(g,w,h6(g,c),Lo.scales[w.type]),F=d6(M,s),N=d.scales||{};t[g]=N0(Object.create(null),[{axis:M},w,N[M],N[F]])}),c.data.datasets.forEach(g=>{let w=g.type||c.type,M=g.indexAxis||QT(w,o),N=(lf[w]||{}).scales||{};Object.keys(N).forEach(Q=>{let ae=c6(Q,M),pe=g[ae+"AxisID"]||ae;t[pe]=t[pe]||Object.create(null),N0(t[pe],[{axis:ae},r[pe],N[Q]])})}),Object.keys(t).forEach(g=>{let w=t[g];N0(w,[Lo.scales[w.type],Lo.scale])}),t}function t3(c){let o=c.options||(c.options={});o.plugins=An(o.plugins,{}),o.scales=m6(c,o)}function i3(c){return c=c||{},c.datasets=c.datasets||[],c.labels=c.labels||[],c}function p6(c){return c=c||{},c.data=i3(c.data),t3(c),c}var fO=new Map,n3=new Set;function Ow(c,o){let d=fO.get(c);return d||(d=o(),fO.set(c,d),n3.add(d)),d}var cv=(c,o,d)=>{let r=Um(o,d);r!==void 0&&c.add(r)},JT=class{constructor(o){this._config=p6(o),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(o){this._config.type=o}get data(){return this._config.data}set data(o){this._config.data=i3(o)}get options(){return this._config.options}set options(o){this._config.options=o}get plugins(){return this._config.plugins}update(){let o=this._config;this.clearCache(),t3(o)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(o){return Ow(o,()=>[[`datasets.${o}`,""]])}datasetAnimationScopeKeys(o,d){return Ow(`${o}.transition.${d}`,()=>[[`datasets.${o}.transitions.${d}`,`transitions.${d}`],[`datasets.${o}`,""]])}datasetElementScopeKeys(o,d){return Ow(`${o}-${d}`,()=>[[`datasets.${o}.elements.${d}`,`datasets.${o}`,`elements.${d}`,""]])}pluginScopeKeys(o){let d=o.id,r=this.type;return Ow(`${r}-plugin-${d}`,()=>[[`plugins.${d}`,...o.additionalOptionScopes||[]]])}_cachedScopes(o,d){let r=this._scopeCache,s=r.get(o);return(!s||d)&&(s=new Map,r.set(o,s)),s}getOptionScopes(o,d,r){let{options:s,type:t}=this,g=this._cachedScopes(o,r),w=g.get(d);if(w)return w;let M=new Set;d.forEach(N=>{o&&(M.add(o),N.forEach(Q=>cv(M,o,Q))),N.forEach(Q=>cv(M,s,Q)),N.forEach(Q=>cv(M,lf[t]||{},Q)),N.forEach(Q=>cv(M,Lo,Q)),N.forEach(Q=>cv(M,Sw,Q))});let F=Array.from(M);return F.length===0&&F.push(Object.create(null)),n3.has(d)&&g.set(d,F),F}chartOptionScopes(){let{options:o,type:d}=this;return[o,lf[d]||{},Lo.datasets[d]||{},{type:d},Lo,Sw]}resolveNamedOptions(o,d,r,s=[""]){let t={$shared:!0},{resolver:g,subPrefixes:w}=gO(this._resolverCache,o,s),M=g;if(g6(g,d)){t.$shared=!1,r=Vm(r)?r():r;let F=this.createResolver(o,r,w);M=jg(g,r,F)}for(let F of d)t[F]=M[F];return t}createResolver(o,d,r=[""],s){let{resolver:t}=gO(this._resolverCache,o,r);return Jn(d)?jg(t,d,void 0,s):t}};function gO(c,o,d){let r=c.get(o);r||(r=new Map,c.set(o,r));let s=d.join(),t=r.get(s);return t||(t={resolver:Mw(o,d),subPrefixes:d.filter(w=>!w.toLowerCase().includes("hover"))},r.set(s,t)),t}var f6=c=>Jn(c)&&Object.getOwnPropertyNames(c).some(o=>Vm(c[o]));function g6(c,o){let{isScriptable:d,isIndexable:r}=IT(c);for(let s of o){let t=d(s),g=r(s),w=(g||t)&&c[s];if(t&&(Vm(w)||f6(w))||g&&uo(w))return!0}return!1}var _6="4.4.3",b6=["top","bottom","left","right","chartArea"];function _O(c,o){return c==="top"||c==="bottom"||b6.indexOf(c)===-1&&o==="x"}function bO(c,o){return function(d,r){return d[c]===r[c]?d[o]-r[o]:d[c]-r[c]}}function yO(c){let o=c.chart,d=o.options.animation;o.notifyPlugins("afterRender"),so(d&&d.onComplete,[c],o)}function y6(c){let o=c.chart,d=o.options.animation;so(d&&d.onProgress,[c],o)}function r3(c){return kw()&&typeof c=="string"?c=document.getElementById(c):c&&c.length&&(c=c[0]),c&&c.canvas&&(c=c.canvas),c}var Nw={},vO=c=>{let o=r3(c);return Object.values(Nw).filter(d=>d.canvas===o).pop()};function v6(c,o,d){let r=Object.keys(c);for(let s of r){let t=+s;if(t>=o){let g=c[s];delete c[s],(d>0||t>o)&&(c[t+d]=g)}}}function x6(c,o,d,r){return!d||c.type==="mouseout"?null:r?o:c}function Rw(c,o,d){return c.options.clip?c[d]:o[d]}function w6(c,o){let{xScale:d,yScale:r}=c;return d&&r?{left:Rw(d,o,"left"),right:Rw(d,o,"right"),top:Rw(r,o,"top"),bottom:Rw(r,o,"bottom")}:o}var Z0=(()=>{class c{static defaults=Lo;static instances=Nw;static overrides=lf;static registry=gh;static version=_6;static getChart=vO;static register(...d){gh.add(...d),xO()}static unregister(...d){gh.remove(...d),xO()}constructor(d,r){let s=this.config=new JT(r),t=r3(d),g=vO(t);if(g)throw new Error("Canvas is already in use. Chart with ID '"+g.id+"' must be destroyed before the canvas with ID '"+g.canvas.id+"' can be reused.");let w=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||UV(t)),this.platform.updateConfig(s);let M=this.platform.acquireContext(t,w.aspectRatio),F=M&&M.canvas,N=F&&F.height,Q=F&&F.width;if(this.id=bP(),this.ctx=M,this.canvas=F,this.width=Q,this.height=N,this._options=w,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new XT,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=EP(ae=>this.update(ae),w.resizeDelay||0),this._dataChanges=[],Nw[this.id]=this,!M||!F){console.error("Failed to create chart: can't acquire context from the given item");return}Hm.listen(this,"complete",yO),Hm.listen(this,"progress",y6),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:d,maintainAspectRatio:r},width:s,height:t,_aspectRatio:g}=this;return pr(d)?r&&g?g:t?s/t:null:d}get data(){return this.config.data}set data(d){this.config.data=d}get options(){return this._options}set options(d){this.config.options=d}get registry(){return gh}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():ET(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return wT(this.canvas,this.ctx),this}stop(){return Hm.stop(this),this}resize(d,r){Hm.running(this)?this._resizeBeforeDraw={width:d,height:r}:this._resize(d,r)}_resize(d,r){let s=this.options,t=this.canvas,g=s.maintainAspectRatio&&this.aspectRatio,w=this.platform.getMaximumSize(t,d,r,g),M=s.devicePixelRatio||this.platform.getDevicePixelRatio(),F=this.width?"resize":"attach";this.width=w.width,this.height=w.height,this._aspectRatio=this.aspectRatio,ET(this,M,!0)&&(this.notifyPlugins("resize",{size:w}),so(s.onResize,[this,w],this),this.attached&&this._doResize(F)&&this.render())}ensureScalesHaveIDs(){let r=this.options.scales||{};Nr(r,(s,t)=>{s.id=t})}buildOrUpdateScales(){let d=this.options,r=d.scales,s=this.scales,t=Object.keys(s).reduce((w,M)=>(w[M]=!1,w),{}),g=[];r&&(g=g.concat(Object.keys(r).map(w=>{let M=r[w],F=KT(w,M),N=F==="r",Q=F==="x";return{options:M,dposition:N?"chartArea":Q?"bottom":"left",dtype:N?"radialLinear":Q?"category":"linear"}}))),Nr(g,w=>{let M=w.options,F=M.id,N=KT(F,M),Q=An(M.type,w.dtype);(M.position===void 0||_O(M.position,N)!==_O(w.dposition))&&(M.position=w.dposition),t[F]=!0;let ae=null;if(F in s&&s[F].type===Q)ae=s[F];else{let pe=gh.getScale(Q);ae=new pe({id:F,type:Q,ctx:this.ctx,chart:this}),s[ae.id]=ae}ae.init(M,d)}),Nr(t,(w,M)=>{w||delete s[M]}),Nr(s,w=>{Es.configure(this,w,w.options),Es.addBox(this,w)})}_updateMetasets(){let d=this._metasets,r=this.data.datasets.length,s=d.length;if(d.sort((t,g)=>t.index-g.index),s>r){for(let t=r;t<s;++t)this._destroyDatasetMeta(t);d.splice(r,s-r)}this._sortedMetasets=d.slice(0).sort(bO("order","index"))}_removeUnreferencedMetasets(){let{_metasets:d,data:{datasets:r}}=this;d.length>r.length&&delete this._stacks,d.forEach((s,t)=>{r.filter(g=>g===s._dataset).length===0&&this._destroyDatasetMeta(t)})}buildOrUpdateControllers(){let d=[],r=this.data.datasets,s,t;for(this._removeUnreferencedMetasets(),s=0,t=r.length;s<t;s++){let g=r[s],w=this.getDatasetMeta(s),M=g.type||this.config.type;if(w.type&&w.type!==M&&(this._destroyDatasetMeta(s),w=this.getDatasetMeta(s)),w.type=M,w.indexAxis=g.indexAxis||QT(M,this.options),w.order=g.order||0,w.index=s,w.label=""+g.label,w.visible=this.isDatasetVisible(s),w.controller)w.controller.updateIndex(s),w.controller.linkScales();else{let F=gh.getController(M),{datasetElementType:N,dataElementType:Q}=Lo.datasets[M];Object.assign(F,{dataElementType:gh.getElement(Q),datasetElementType:N&&gh.getElement(N)}),w.controller=new F(this,s),d.push(w.controller)}}return this._updateMetasets(),d}_resetElements(){Nr(this.data.datasets,(d,r)=>{this.getDatasetMeta(r).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(d){let r=this.config;r.update();let s=this._options=r.createResolver(r.chartOptionScopes(),this.getContext()),t=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:d,cancelable:!0})===!1)return;let g=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let w=0;for(let N=0,Q=this.data.datasets.length;N<Q;N++){let{controller:ae}=this.getDatasetMeta(N),pe=!t&&g.indexOf(ae)===-1;ae.buildOrUpdateElements(pe),w=Math.max(+ae.getMaxOverflow(),w)}w=this._minPadding=s.layout.autoPadding?w:0,this._updateLayout(w),t||Nr(g,N=>{N.reset()}),this._updateDatasets(d),this.notifyPlugins("afterUpdate",{mode:d}),this._layers.sort(bO("z","_idx"));let{_active:M,_lastEvent:F}=this;F?this._eventHandler(F,!0):M.length&&this._updateHoverStyles(M,M,!0),this.render()}_updateScales(){Nr(this.scales,d=>{Es.removeBox(this,d)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let d=this.options,r=new Set(Object.keys(this._listeners)),s=new Set(d.events);(!cT(r,s)||!!this._responsiveListeners!==d.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:d}=this,r=this._getUniformDataChanges()||[];for(let{method:s,start:t,count:g}of r){let w=s==="_removeElements"?-g:g;v6(d,t,w)}}_getUniformDataChanges(){let d=this._dataChanges;if(!d||!d.length)return;this._dataChanges=[];let r=this.data.datasets.length,s=g=>new Set(d.filter(w=>w[0]===g).map((w,M)=>M+","+w.splice(1).join(","))),t=s(0);for(let g=1;g<r;g++)if(!cT(t,s(g)))return;return Array.from(t).map(g=>g.split(",")).map(g=>({method:g[1],start:+g[2],count:+g[3]}))}_updateLayout(d){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Es.update(this,this.width,this.height,d);let r=this.chartArea,s=r.width<=0||r.height<=0;this._layers=[],Nr(this.boxes,t=>{s&&t.position==="chartArea"||(t.configure&&t.configure(),this._layers.push(...t._layers()))},this),this._layers.forEach((t,g)=>{t._idx=g}),this.notifyPlugins("afterLayout")}_updateDatasets(d){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:d,cancelable:!0})!==!1){for(let r=0,s=this.data.datasets.length;r<s;++r)this.getDatasetMeta(r).controller.configure();for(let r=0,s=this.data.datasets.length;r<s;++r)this._updateDataset(r,Vm(d)?d({datasetIndex:r}):d);this.notifyPlugins("afterDatasetsUpdate",{mode:d})}}_updateDataset(d,r){let s=this.getDatasetMeta(d),t={meta:s,index:d,mode:r,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",t)!==!1&&(s.controller._update(r),t.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",t))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Hm.has(this)?this.attached&&!Hm.running(this)&&Hm.start(this):(this.draw(),yO({chart:this})))}draw(){let d;if(this._resizeBeforeDraw){let{width:s,height:t}=this._resizeBeforeDraw;this._resize(s,t),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let r=this._layers;for(d=0;d<r.length&&r[d].z<=0;++d)r[d].draw(this.chartArea);for(this._drawDatasets();d<r.length;++d)r[d].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(d){let r=this._sortedMetasets,s=[],t,g;for(t=0,g=r.length;t<g;++t){let w=r[t];(!d||w.visible)&&s.push(w)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let d=this.getSortedVisibleDatasetMetas();for(let r=d.length-1;r>=0;--r)this._drawDataset(d[r]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(d){let r=this.ctx,s=d._clip,t=!s.disabled,g=w6(d,this.chartArea),w={meta:d,index:d.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",w)!==!1&&(t&&nv(r,{left:s.left===!1?0:g.left-s.left,right:s.right===!1?this.width:g.right+s.right,top:s.top===!1?0:g.top-s.top,bottom:s.bottom===!1?this.height:g.bottom+s.bottom}),d.controller.draw(),t&&rv(r),w.cancelable=!1,this.notifyPlugins("afterDatasetDraw",w))}isPointInArea(d){return hh(d,this.chartArea,this._minPadding)}getElementsAtEventForMode(d,r,s,t){let g=CV.modes[r];return typeof g=="function"?g(this,d,s,t):[]}getDatasetMeta(d){let r=this.data.datasets[d],s=this._metasets,t=s.filter(g=>g&&g._dataset===r).pop();return t||(t={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:r&&r.order||0,index:d,_dataset:r,_parsed:[],_sorted:!1},s.push(t)),t}getContext(){return this.$context||(this.$context=Wm(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(d){let r=this.data.datasets[d];if(!r)return!1;let s=this.getDatasetMeta(d);return typeof s.hidden=="boolean"?!s.hidden:!r.hidden}setDatasetVisibility(d,r){let s=this.getDatasetMeta(d);s.hidden=!r}toggleDataVisibility(d){this._hiddenIndices[d]=!this._hiddenIndices[d]}getDataVisibility(d){return!this._hiddenIndices[d]}_updateVisibility(d,r,s){let t=s?"show":"hide",g=this.getDatasetMeta(d),w=g.controller._resolveAnimations(void 0,t);V0(r)?(g.data[r].hidden=!s,this.update()):(this.setDatasetVisibility(d,s),w.update(g,{visible:s}),this.update(M=>M.datasetIndex===d?t:void 0))}hide(d,r){this._updateVisibility(d,r,!1)}show(d,r){this._updateVisibility(d,r,!0)}_destroyDatasetMeta(d){let r=this._metasets[d];r&&r.controller&&r.controller._destroy(),delete this._metasets[d]}_stop(){let d,r;for(this.stop(),Hm.remove(this),d=0,r=this.data.datasets.length;d<r;++d)this._destroyDatasetMeta(d)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:d,ctx:r}=this;this._stop(),this.config.clearCache(),d&&(this.unbindEvents(),wT(d,r),this.platform.releaseContext(r),this.canvas=null,this.ctx=null),delete Nw[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...d){return this.canvas.toDataURL(...d)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let d=this._listeners,r=this.platform,s=(g,w)=>{r.addEventListener(this,g,w),d[g]=w},t=(g,w,M)=>{g.offsetX=w,g.offsetY=M,this._eventHandler(g)};Nr(this.options.events,g=>s(g,t))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let d=this._responsiveListeners,r=this.platform,s=(F,N)=>{r.addEventListener(this,F,N),d[F]=N},t=(F,N)=>{d[F]&&(r.removeEventListener(this,F,N),delete d[F])},g=(F,N)=>{this.canvas&&this.resize(F,N)},w,M=()=>{t("attach",M),this.attached=!0,this.resize(),s("resize",g),s("detach",w)};w=()=>{this.attached=!1,t("resize",g),this._stop(),this._resize(0,0),s("attach",M)},r.isAttached(this.canvas)?M():w()}unbindEvents(){Nr(this._listeners,(d,r)=>{this.platform.removeEventListener(this,r,d)}),this._listeners={},Nr(this._responsiveListeners,(d,r)=>{this.platform.removeEventListener(this,r,d)}),this._responsiveListeners=void 0}updateHoverStyle(d,r,s){let t=s?"set":"remove",g,w,M,F;for(r==="dataset"&&(g=this.getDatasetMeta(d[0].datasetIndex),g.controller["_"+t+"DatasetHoverStyle"]()),M=0,F=d.length;M<F;++M){w=d[M];let N=w&&this.getDatasetMeta(w.datasetIndex).controller;N&&N[t+"HoverStyle"](w.element,w.datasetIndex,w.index)}}getActiveElements(){return this._active||[]}setActiveElements(d){let r=this._active||[],s=d.map(({datasetIndex:g,index:w})=>{let M=this.getDatasetMeta(g);if(!M)throw new Error("No dataset found at index "+g);return{datasetIndex:g,element:M.data[w],index:w}});!tv(s,r)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,r))}notifyPlugins(d,r,s){return this._plugins.notify(this,d,r,s)}isPluginEnabled(d){return this._plugins._cache.filter(r=>r.plugin.id===d).length===1}_updateHoverStyles(d,r,s){let t=this.options.hover,g=(F,N)=>F.filter(Q=>!N.some(ae=>Q.datasetIndex===ae.datasetIndex&&Q.index===ae.index)),w=g(r,d),M=s?d:g(d,r);w.length&&this.updateHoverStyle(w,t.mode,!1),M.length&&t.mode&&this.updateHoverStyle(M,t.mode,!0)}_eventHandler(d,r){let s={event:d,replay:r,cancelable:!0,inChartArea:this.isPointInArea(d)},t=w=>(w.options.events||this.options.events).includes(d.native.type);if(this.notifyPlugins("beforeEvent",s,t)===!1)return;let g=this._handleEvent(d,r,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,t),(g||s.changed)&&this.render(),this}_handleEvent(d,r,s){let{_active:t=[],options:g}=this,w=r,M=this._getActiveElements(d,t,s,w),F=xP(d),N=x6(d,this._lastEvent,s,F);s&&(this._lastEvent=null,so(g.onHover,[d,M,this],this),F&&so(g.onClick,[d,M,this],this));let Q=!tv(M,t);return(Q||r)&&(this._active=M,this._updateHoverStyles(M,t,r)),this._lastEvent=N,Q}_getActiveElements(d,r,s,t){if(d.type==="mouseout")return[];if(!s)return r;let g=this.options.hover;return this.getElementsAtEventForMode(d,g.mode,g,t)}}return c})();function xO(){return Nr(Z0.instances,c=>c._plugins.invalidate())}function C6(c,o,d){let{startAngle:r,pixelMargin:s,x:t,y:g,outerRadius:w,innerRadius:M}=o,F=s/w;c.beginPath(),c.arc(t,g,w,r-F,d+F),M>s?(F=s/M,c.arc(t,g,M,d+F,r-F,!0)):c.arc(t,g,s,d+ia,r-ia),c.closePath(),c.clip()}function S6(c){return Tw(c,["outerStart","outerEnd","innerStart","innerEnd"])}function I6(c,o,d,r){let s=S6(c.options.borderRadius),t=(d-o)/2,g=Math.min(t,r*o/2),w=M=>{let F=(d-Math.min(t,M))*r/2;return Ra(M,0,Math.min(t,F))};return{outerStart:w(s.outerStart),outerEnd:w(s.outerEnd),innerStart:Ra(s.innerStart,0,g),innerEnd:Ra(s.innerEnd,0,g)}}function q0(c,o,d,r){return{x:d+c*Math.cos(o),y:r+c*Math.sin(o)}}function Ww(c,o,d,r,s,t){let{x:g,y:w,startAngle:M,pixelMargin:F,innerRadius:N}=o,Q=Math.max(o.outerRadius+r+d-F,0),ae=N>0?N+r+d+F:0,pe=0,Te=s-M;if(r){let Mn=N>0?N-r:0,hn=Q>0?Q-r:0,Fr=(Mn+hn)/2,yo=Fr!==0?Te*Fr/(Fr+r):Te;pe=(Te-yo)/2}let Pe=Math.max(.001,Te*Q-d/ho)/Q,Re=(Te-Pe)/2,Ke=M+Re+pe,Je=s-Re-pe,{outerStart:_t,outerEnd:Nt,innerStart:kt,innerEnd:Ut}=I6(o,ae,Q,Je-Ke),ni=Q-_t,zt=Q-Nt,pi=Ke+_t/ni,ei=Je-Nt/zt,Ji=ae+kt,bn=ae+Ut,lo=Ke+kt/Ji,Hi=Je-Ut/bn;if(c.beginPath(),t){let Mn=(pi+ei)/2;if(c.arc(g,w,Q,pi,Mn),c.arc(g,w,Q,Mn,ei),Nt>0){let Zn=q0(zt,ei,g,w);c.arc(Zn.x,Zn.y,Nt,ei,Je+ia)}let hn=q0(bn,Je,g,w);if(c.lineTo(hn.x,hn.y),Ut>0){let Zn=q0(bn,Hi,g,w);c.arc(Zn.x,Zn.y,Ut,Je+ia,Hi+Math.PI)}let Fr=(Je-Ut/ae+(Ke+kt/ae))/2;if(c.arc(g,w,ae,Je-Ut/ae,Fr,!0),c.arc(g,w,ae,Fr,Ke+kt/ae,!0),kt>0){let Zn=q0(Ji,lo,g,w);c.arc(Zn.x,Zn.y,kt,lo+Math.PI,Ke-ia)}let yo=q0(ni,Ke,g,w);if(c.lineTo(yo.x,yo.y),_t>0){let Zn=q0(ni,pi,g,w);c.arc(Zn.x,Zn.y,_t,Ke-ia,pi)}}else{c.moveTo(g,w);let Mn=Math.cos(pi)*Q+g,hn=Math.sin(pi)*Q+w;c.lineTo(Mn,hn);let Fr=Math.cos(ei)*Q+g,yo=Math.sin(ei)*Q+w;c.lineTo(Fr,yo)}c.closePath()}function T6(c,o,d,r,s){let{fullCircles:t,startAngle:g,circumference:w}=o,M=o.endAngle;if(t){Ww(c,o,d,r,M,s);for(let F=0;F<t;++F)c.fill();isNaN(w)||(M=g+(w%mo||mo))}return Ww(c,o,d,r,M,s),c.fill(),M}function M6(c,o,d,r,s){let{fullCircles:t,startAngle:g,circumference:w,options:M}=o,{borderWidth:F,borderJoinStyle:N,borderDash:Q,borderDashOffset:ae}=M,pe=M.borderAlign==="inner";if(!F)return;c.setLineDash(Q||[]),c.lineDashOffset=ae,pe?(c.lineWidth=F*2,c.lineJoin=N||"round"):(c.lineWidth=F,c.lineJoin=N||"bevel");let Te=o.endAngle;if(t){Ww(c,o,d,r,Te,s);for(let Pe=0;Pe<t;++Pe)c.stroke();isNaN(w)||(Te=g+(w%mo||mo))}pe&&C6(c,o,Te),t||(Ww(c,o,d,r,Te,s),c.stroke())}var eM=class extends Xd{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:o=>o!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(o){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,o&&Object.assign(this,o)}inRange(o,d,r){let s=this.getProps(["x","y"],r),{angle:t,distance:g}=mT(s,{x:o,y:d}),{startAngle:w,endAngle:M,innerRadius:F,outerRadius:N,circumference:Q}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],r),ae=(this.options.spacing+this.options.borderWidth)/2,Te=An(Q,M-w)>=mo||U0(t,w,M),Pe=ph(g,F+ae,N+ae);return Te&&Pe}getCenterPoint(o){let{x:d,y:r,startAngle:s,endAngle:t,innerRadius:g,outerRadius:w}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],o),{offset:M,spacing:F}=this.options,N=(s+t)/2,Q=(g+w+F+M)/2;return{x:d+Math.cos(N)*Q,y:r+Math.sin(N)*Q}}tooltipPosition(o){return this.getCenterPoint(o)}draw(o){let{options:d,circumference:r}=this,s=(d.offset||0)/4,t=(d.spacing||0)/2,g=d.circular;if(this.pixelMargin=d.borderAlign==="inner"?.33:0,this.fullCircles=r>mo?Math.floor(r/mo):0,r===0||this.innerRadius<0||this.outerRadius<0)return;o.save();let w=(this.startAngle+this.endAngle)/2;o.translate(Math.cos(w)*s,Math.sin(w)*s);let M=1-Math.sin(Math.min(ho,r||0)),F=s*M;o.fillStyle=d.backgroundColor,o.strokeStyle=d.borderColor,T6(o,this,F,t,g),M6(o,this,F,t,g),o.restore()}};function o3(c,o,d=o){c.lineCap=An(d.borderCapStyle,o.borderCapStyle),c.setLineDash(An(d.borderDash,o.borderDash)),c.lineDashOffset=An(d.borderDashOffset,o.borderDashOffset),c.lineJoin=An(d.borderJoinStyle,o.borderJoinStyle),c.lineWidth=An(d.borderWidth,o.borderWidth),c.strokeStyle=An(d.borderColor,o.borderColor)}function k6(c,o,d){c.lineTo(d.x,d.y)}function E6(c){return c.stepped?OP:c.tension||c.cubicInterpolationMode==="monotone"?RP:k6}function a3(c,o,d={}){let r=c.length,{start:s=0,end:t=r-1}=d,{start:g,end:w}=o,M=Math.max(s,g),F=Math.min(t,w),N=s<g&&t<g||s>w&&t>w;return{count:r,start:M,loop:o.loop,ilen:F<M&&!N?r+F-M:F-M}}function D6(c,o,d,r){let{points:s,options:t}=o,{count:g,start:w,loop:M,ilen:F}=a3(s,d,r),N=E6(t),{move:Q=!0,reverse:ae}=r||{},pe,Te,Pe;for(pe=0;pe<=F;++pe)Te=s[(w+(ae?F-pe:pe))%g],!Te.skip&&(Q?(c.moveTo(Te.x,Te.y),Q=!1):N(c,Pe,Te,ae,t.stepped),Pe=Te);return M&&(Te=s[(w+(ae?F:0))%g],N(c,Pe,Te,ae,t.stepped)),!!M}function A6(c,o,d,r){let s=o.points,{count:t,start:g,ilen:w}=a3(s,d,r),{move:M=!0,reverse:F}=r||{},N=0,Q=0,ae,pe,Te,Pe,Re,Ke,Je=Nt=>(g+(F?w-Nt:Nt))%t,_t=()=>{Pe!==Re&&(c.lineTo(N,Re),c.lineTo(N,Pe),c.lineTo(N,Ke))};for(M&&(pe=s[Je(0)],c.moveTo(pe.x,pe.y)),ae=0;ae<=w;++ae){if(pe=s[Je(ae)],pe.skip)continue;let Nt=pe.x,kt=pe.y,Ut=Nt|0;Ut===Te?(kt<Pe?Pe=kt:kt>Re&&(Re=kt),N=(Q*N+Nt)/++Q):(_t(),c.lineTo(Nt,kt),Te=Ut,Q=0,Pe=Re=kt),Ke=kt}_t()}function tM(c){let o=c.options,d=o.borderDash&&o.borderDash.length;return!c._decimated&&!c._loop&&!o.tension&&o.cubicInterpolationMode!=="monotone"&&!o.stepped&&!d?A6:D6}function P6(c){return c.stepped?WP:c.tension||c.cubicInterpolationMode==="monotone"?HP:sf}function O6(c,o,d,r){let s=o._path;s||(s=o._path=new Path2D,o.path(s,d,r)&&s.closePath()),o3(c,o.options),c.stroke(s)}function R6(c,o,d,r){let{segments:s,options:t}=o,g=tM(o);for(let w of s)o3(c,t,w.style),c.beginPath(),g(c,o,w,{start:d,end:d+r-1})&&c.closePath(),c.stroke()}var F6=typeof Path2D=="function";function L6(c,o,d,r){F6&&!o.options.segment?O6(c,o,d,r):R6(c,o,d,r)}var qw=(()=>{class c extends Xd{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:d=>d!=="borderDash"&&d!=="fill"};constructor(d){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,d&&Object.assign(this,d)}updateControlPoints(d,r){let s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){let t=s.spanGaps?this._loop:this._fullLoop;VP(this._points,s,d,t,r),this._pointsUpdated=!0}}set points(d){this._points=d,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=qP(this,this.options.segment))}first(){let d=this.segments,r=this.points;return d.length&&r[d[0].start]}last(){let d=this.segments,r=this.points,s=d.length;return s&&r[d[s-1].end]}interpolate(d,r){let s=this.options,t=d[r],g=this.points,w=RT(this,{property:r,start:t,end:t});if(!w.length)return;let M=[],F=P6(s),N,Q;for(N=0,Q=w.length;N<Q;++N){let{start:ae,end:pe}=w[N],Te=g[ae],Pe=g[pe];if(Te===Pe){M.push(Te);continue}let Re=Math.abs((t-Te[r])/(Pe[r]-Te[r])),Ke=F(Te,Pe,Re,s.stepped);Ke[r]=d[r],M.push(Ke)}return M.length===1?M[0]:M}pathSegment(d,r,s){return tM(this)(d,this,r,s)}path(d,r,s){let t=this.segments,g=tM(this),w=this._loop;r=r||0,s=s||this.points.length-r;for(let M of t)w&=g(d,this,M,{start:r,end:r+s-1});return!!w}draw(d,r,s,t){let g=this.options||{};(this.points||[]).length&&g.borderWidth&&(d.save(),L6(d,this,s,t),d.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return c})();function wO(c,o,d,r){let s=c.options,{[d]:t}=c.getProps([d],r);return Math.abs(o-t)<s.radius+s.hitRadius}var z6=(()=>{class c extends Xd{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(d){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,d&&Object.assign(this,d)}inRange(d,r,s){let t=this.options,{x:g,y:w}=this.getProps(["x","y"],s);return Math.pow(d-g,2)+Math.pow(r-w,2)<Math.pow(t.hitRadius+t.radius,2)}inXRange(d,r){return wO(this,d,"x",r)}inYRange(d,r){return wO(this,d,"y",r)}getCenterPoint(d){let{x:r,y:s}=this.getProps(["x","y"],d);return{x:r,y:s}}size(d){d=d||this.options||{};let r=d.radius||0;r=Math.max(r,r&&d.hoverRadius||0);let s=r&&d.borderWidth||0;return(r+s)*2}draw(d,r){let s=this.options;this.skip||s.radius<.1||!hh(this,r,this.size(s)/2)||(d.strokeStyle=s.borderColor,d.lineWidth=s.borderWidth,d.fillStyle=s.backgroundColor,Iw(d,s,this.x,this.y))}getRange(){let d=this.options||{};return d.radius+d.hitRadius}}return c})();function s3(c,o){let{x:d,y:r,base:s,width:t,height:g}=c.getProps(["x","y","base","width","height"],o),w,M,F,N,Q;return c.horizontal?(Q=g/2,w=Math.min(d,s),M=Math.max(d,s),F=r-Q,N=r+Q):(Q=t/2,w=d-Q,M=d+Q,F=Math.min(r,s),N=Math.max(r,s)),{left:w,top:F,right:M,bottom:N}}function mf(c,o,d,r){return c?0:Ra(o,d,r)}function B6(c,o,d){let r=c.options.borderWidth,s=c.borderSkipped,t=ST(r);return{t:mf(s.top,t.top,0,d),r:mf(s.right,t.right,0,o),b:mf(s.bottom,t.bottom,0,d),l:mf(s.left,t.left,0,o)}}function N6(c,o,d){let{enableBorderRadius:r}=c.getProps(["enableBorderRadius"]),s=c.options.borderRadius,t=uf(s),g=Math.min(o,d),w=c.borderSkipped,M=r||Jn(s);return{topLeft:mf(!M||w.top||w.left,t.topLeft,0,g),topRight:mf(!M||w.top||w.right,t.topRight,0,g),bottomLeft:mf(!M||w.bottom||w.left,t.bottomLeft,0,g),bottomRight:mf(!M||w.bottom||w.right,t.bottomRight,0,g)}}function V6(c){let o=s3(c),d=o.right-o.left,r=o.bottom-o.top,s=B6(c,d/2,r/2),t=N6(c,d/2,r/2);return{outer:{x:o.left,y:o.top,w:d,h:r,radius:t},inner:{x:o.left+s.l,y:o.top+s.t,w:d-s.l-s.r,h:r-s.t-s.b,radius:{topLeft:Math.max(0,t.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,t.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,t.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,t.bottomRight-Math.max(s.b,s.r))}}}}function jT(c,o,d,r){let s=o===null,t=d===null,w=c&&!(s&&t)&&s3(c,r);return w&&(s||ph(o,w.left,w.right))&&(t||ph(d,w.top,w.bottom))}function j6(c){return c.topLeft||c.topRight||c.bottomLeft||c.bottomRight}function U6(c,o){c.rect(o.x,o.y,o.w,o.h)}function UT(c,o,d={}){let r=c.x!==d.x?-o:0,s=c.y!==d.y?-o:0,t=(c.x+c.w!==d.x+d.w?o:0)-r,g=(c.y+c.h!==d.y+d.h?o:0)-s;return{x:c.x+r,y:c.y+s,w:c.w+t,h:c.h+g,radius:c.radius}}var iM=class extends Xd{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(o){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,o&&Object.assign(this,o)}draw(o){let{inflateAmount:d,options:{borderColor:r,backgroundColor:s}}=this,{inner:t,outer:g}=V6(this),w=j6(g.radius)?H0:U6;o.save(),(g.w!==t.w||g.h!==t.h)&&(o.beginPath(),w(o,UT(g,d,t)),o.clip(),w(o,UT(t,-d,g)),o.fillStyle=r,o.fill("evenodd")),o.beginPath(),w(o,UT(t,d)),o.fillStyle=s,o.fill(),o.restore()}inRange(o,d,r){return jT(this,o,d,r)}inXRange(o,d){return jT(this,o,null,d)}inYRange(o,d){return jT(this,null,o,d)}getCenterPoint(o){let{x:d,y:r,base:s,horizontal:t}=this.getProps(["x","y","base","horizontal"],o);return{x:t?(d+s)/2:d,y:t?r:(r+s)/2}}getRange(o){return o==="x"?this.width/2:this.height/2}},W6=Object.freeze({__proto__:null,ArcElement:eM,BarElement:iM,LineElement:qw,PointElement:z6}),nM=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],CO=nM.map(c=>c.replace("rgb(","rgba(").replace(")",", 0.5)"));function l3(c){return nM[c%nM.length]}function c3(c){return CO[c%CO.length]}function H6(c,o){return c.borderColor=l3(o),c.backgroundColor=c3(o),++o}function G6(c,o){return c.backgroundColor=c.data.map(()=>l3(o++)),o}function q6(c,o){return c.backgroundColor=c.data.map(()=>c3(o++)),o}function $6(c){let o=0;return(d,r)=>{let s=c.getDatasetMeta(r).controller;s instanceof uM?o=G6(d,o):s instanceof XO?o=q6(d,o):s&&(o=H6(d,o))}}function SO(c){let o;for(o in c)if(c[o].borderColor||c[o].backgroundColor)return!0;return!1}function Y6(c){return c&&(c.borderColor||c.backgroundColor)}var Z6={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(c,o,d){if(!d.enabled)return;let{data:{datasets:r},options:s}=c.config,{elements:t}=s;if(!d.forceOverride&&(SO(r)||Y6(s)||t&&SO(t)))return;let g=$6(c);r.forEach(g)}};function X6(c,o,d,r,s){let t=s.samples||r;if(t>=d)return c.slice(o,o+d);let g=[],w=(d-2)/(t-2),M=0,F=o+d-1,N=o,Q,ae,pe,Te,Pe;for(g[M++]=c[N],Q=0;Q<t-2;Q++){let Re=0,Ke=0,Je,_t=Math.floor((Q+1)*w)+1+o,Nt=Math.min(Math.floor((Q+2)*w)+1,d)+o,kt=Nt-_t;for(Je=_t;Je<Nt;Je++)Re+=c[Je].x,Ke+=c[Je].y;Re/=kt,Ke/=kt;let Ut=Math.floor(Q*w)+1+o,ni=Math.min(Math.floor((Q+1)*w)+1,d)+o,{x:zt,y:pi}=c[N];for(pe=Te=-1,Je=Ut;Je<ni;Je++)Te=.5*Math.abs((zt-Re)*(c[Je].y-pi)-(zt-c[Je].x)*(Ke-pi)),Te>pe&&(pe=Te,ae=c[Je],Pe=Je);g[M++]=ae,N=Pe}return g[M++]=c[F],g}function Q6(c,o,d,r){let s=0,t=0,g,w,M,F,N,Q,ae,pe,Te,Pe,Re=[],Ke=o+d-1,Je=c[o].x,Nt=c[Ke].x-Je;for(g=o;g<o+d;++g){w=c[g],M=(w.x-Je)/Nt*r,F=w.y;let kt=M|0;if(kt===N)F<Te?(Te=F,Q=g):F>Pe&&(Pe=F,ae=g),s=(t*s+w.x)/++t;else{let Ut=g-1;if(!pr(Q)&&!pr(ae)){let ni=Math.min(Q,ae),zt=Math.max(Q,ae);ni!==pe&&ni!==Ut&&Re.push(yl(Dn({},c[ni]),{x:s})),zt!==pe&&zt!==Ut&&Re.push(yl(Dn({},c[zt]),{x:s}))}g>0&&Ut!==pe&&Re.push(c[Ut]),Re.push(w),N=kt,t=0,Te=Pe=F,Q=ae=pe=g}}return Re}function d3(c){if(c._decimated){let o=c._data;delete c._decimated,delete c._data,Object.defineProperty(c,"data",{configurable:!0,enumerable:!0,writable:!0,value:o})}}function IO(c){c.data.datasets.forEach(o=>{d3(o)})}function K6(c,o){let d=o.length,r=0,s,{iScale:t}=c,{min:g,max:w,minDefined:M,maxDefined:F}=t.getUserBounds();return M&&(r=Ra(uh(o,t.axis,g).lo,0,d-1)),F?s=Ra(uh(o,t.axis,w).hi+1,r,d)-r:s=d-r,{start:r,count:s}}var J6={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(c,o,d)=>{if(!d.enabled){IO(c);return}let r=c.width;c.data.datasets.forEach((s,t)=>{let{_data:g,indexAxis:w}=s,M=c.getDatasetMeta(t),F=g||s.data;if(G0([w,c.options.indexAxis])==="y"||!M.controller.supportsDecimation)return;let N=c.scales[M.xAxisID];if(N.type!=="linear"&&N.type!=="time"||c.options.parsing)return;let{start:Q,count:ae}=K6(M,F),pe=d.threshold||4*r;if(ae<=pe){d3(s);return}pr(g)&&(s._data=F,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(Pe){this._data=Pe}}));let Te;switch(d.algorithm){case"lttb":Te=X6(F,Q,ae,r,d);break;case"min-max":Te=Q6(F,Q,ae,r);break;default:throw new Error(`Unsupported decimation algorithm '${d.algorithm}'`)}s._decimated=Te})},destroy(c){IO(c)}};function ej(c,o,d){let r=c.segments,s=c.points,t=o.points,g=[];for(let w of r){let{start:M,end:F}=w;F=hM(M,F,s);let N=rM(d,s[M],s[F],w.loop);if(!o.segments){g.push({source:w,target:N,start:s[M],end:s[F]});continue}let Q=RT(o,N);for(let ae of Q){let pe=rM(d,t[ae.start],t[ae.end],ae.loop),Te=OT(w,s,pe);for(let Pe of Te)g.push({source:Pe,target:ae,start:{[d]:TO(N,pe,"start",Math.max)},end:{[d]:TO(N,pe,"end",Math.min)}})}}return g}function rM(c,o,d,r){if(r)return;let s=o[c],t=d[c];return c==="angle"&&(s=El(s),t=El(t)),{property:c,start:s,end:t}}function tj(c,o){let{x:d=null,y:r=null}=c||{},s=o.points,t=[];return o.segments.forEach(({start:g,end:w})=>{w=hM(g,w,s);let M=s[g],F=s[w];r!==null?(t.push({x:M.x,y:r}),t.push({x:F.x,y:r})):d!==null&&(t.push({x:d,y:M.y}),t.push({x:d,y:F.y}))}),t}function hM(c,o,d){for(;o>c;o--){let r=d[o];if(!isNaN(r.x)&&!isNaN(r.y))break}return o}function TO(c,o,d,r){return c&&o?r(c[d],o[d]):c?c[d]:o?o[d]:0}function u3(c,o){let d=[],r=!1;return uo(c)?(r=!0,d=c):d=tj(c,o),d.length?new qw({points:d,options:{tension:0},_loop:r,_fullLoop:r}):null}function MO(c){return c&&c.fill!==!1}function ij(c,o,d){let s=c[o].fill,t=[o],g;if(!d)return s;for(;s!==!1&&t.indexOf(s)===-1;){if(!Fo(s))return s;if(g=c[s],!g)return!1;if(g.visible)return s;t.push(s),s=g.fill}return!1}function nj(c,o,d){let r=sj(c);if(Jn(r))return isNaN(r.value)?!1:r;let s=parseFloat(r);return Fo(s)&&Math.floor(s)===s?rj(r[0],o,s,d):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function rj(c,o,d,r){return(c==="-"||c==="+")&&(d=o+d),d===o||d<0||d>=r?!1:d}function oj(c,o){let d=null;return c==="start"?d=o.bottom:c==="end"?d=o.top:Jn(c)?d=o.getPixelForValue(c.value):o.getBasePixel&&(d=o.getBasePixel()),d}function aj(c,o,d){let r;return c==="start"?r=d:c==="end"?r=o.options.reverse?o.min:o.max:Jn(c)?r=c.value:r=o.getBaseValue(),r}function sj(c){let o=c.options,d=o.fill,r=An(d&&d.target,d);return r===void 0&&(r=!!o.backgroundColor),r===!1||r===null?!1:r===!0?"origin":r}function lj(c){let{scale:o,index:d,line:r}=c,s=[],t=r.segments,g=r.points,w=cj(o,d);w.push(u3({x:null,y:o.bottom},r));for(let M=0;M<t.length;M++){let F=t[M];for(let N=F.start;N<=F.end;N++)dj(s,g[N],w)}return new qw({points:s,options:{}})}function cj(c,o){let d=[],r=c.getMatchingVisibleMetas("line");for(let s=0;s<r.length;s++){let t=r[s];if(t.index===o)break;t.hidden||d.unshift(t.dataset)}return d}function dj(c,o,d){let r=[];for(let s=0;s<d.length;s++){let t=d[s],{first:g,last:w,point:M}=uj(t,o,"x");if(!(!M||g&&w)){if(g)r.unshift(M);else if(c.push(M),!w)break}}c.push(...r)}function uj(c,o,d){let r=c.interpolate(o,d);if(!r)return{};let s=r[d],t=c.segments,g=c.points,w=!1,M=!1;for(let F=0;F<t.length;F++){let N=t[F],Q=g[N.start][d],ae=g[N.end][d];if(ph(s,Q,ae)){w=s===Q,M=s===ae;break}}return{first:w,last:M,point:r}}var Hw=class{constructor(o){this.x=o.x,this.y=o.y,this.radius=o.radius}pathSegment(o,d,r){let{x:s,y:t,radius:g}=this;return d=d||{start:0,end:mo},o.arc(s,t,g,d.end,d.start,!0),!r.bounds}interpolate(o){let{x:d,y:r,radius:s}=this,t=o.angle;return{x:d+Math.cos(t)*s,y:r+Math.sin(t)*s,angle:t}}};function hj(c){let{chart:o,fill:d,line:r}=c;if(Fo(d))return mj(o,d);if(d==="stack")return lj(c);if(d==="shape")return!0;let s=pj(c);return s instanceof Hw?s:u3(s,r)}function mj(c,o){let d=c.getDatasetMeta(o);return d&&c.isDatasetVisible(o)?d.dataset:null}function pj(c){return(c.scale||{}).getPointPositionForValue?gj(c):fj(c)}function fj(c){let{scale:o={},fill:d}=c,r=oj(d,o);if(Fo(r)){let s=o.isHorizontal();return{x:s?r:null,y:s?null:r}}return null}function gj(c){let{scale:o,fill:d}=c,r=o.options,s=o.getLabels().length,t=r.reverse?o.max:o.min,g=aj(d,o,t),w=[];if(r.grid.circular){let M=o.getPointPositionForValue(0,t);return new Hw({x:M.x,y:M.y,radius:o.getDistanceFromCenterForValue(g)})}for(let M=0;M<s;++M)w.push(o.getPointPositionForValue(M,g));return w}function WT(c,o,d){let r=hj(o),{line:s,scale:t,axis:g}=o,w=s.options,M=w.fill,F=w.backgroundColor,{above:N=F,below:Q=F}=M||{};r&&s.points.length&&(nv(c,d),_j(c,{line:s,target:r,above:N,below:Q,area:d,scale:t,axis:g}),rv(c))}function _j(c,o){let{line:d,target:r,above:s,below:t,area:g,scale:w}=o,M=d._loop?"angle":o.axis;c.save(),M==="x"&&t!==s&&(kO(c,r,g.top),EO(c,{line:d,target:r,color:s,scale:w,property:M}),c.restore(),c.save(),kO(c,r,g.bottom)),EO(c,{line:d,target:r,color:t,scale:w,property:M}),c.restore()}function kO(c,o,d){let{segments:r,points:s}=o,t=!0,g=!1;c.beginPath();for(let w of r){let{start:M,end:F}=w,N=s[M],Q=s[hM(M,F,s)];t?(c.moveTo(N.x,N.y),t=!1):(c.lineTo(N.x,d),c.lineTo(N.x,N.y)),g=!!o.pathSegment(c,w,{move:g}),g?c.closePath():c.lineTo(Q.x,d)}c.lineTo(o.first().x,d),c.closePath(),c.clip()}function EO(c,o){let{line:d,target:r,property:s,color:t,scale:g}=o,w=ej(d,r,s);for(let{source:M,target:F,start:N,end:Q}of w){let{style:{backgroundColor:ae=t}={}}=M,pe=r!==!0;c.save(),c.fillStyle=ae,bj(c,g,pe&&rM(s,N,Q)),c.beginPath();let Te=!!d.pathSegment(c,M),Pe;if(pe){Te?c.closePath():DO(c,r,Q,s);let Re=!!r.pathSegment(c,F,{move:Te,reverse:!0});Pe=Te&&Re,Pe||DO(c,r,N,s)}c.closePath(),c.fill(Pe?"evenodd":"nonzero"),c.restore()}}function bj(c,o,d){let{top:r,bottom:s}=o.chart.chartArea,{property:t,start:g,end:w}=d||{};t==="x"&&(c.beginPath(),c.rect(g,r,w-g,s-r),c.clip())}function DO(c,o,d,r){let s=o.interpolate(d,r);s&&c.lineTo(s.x,s.y)}var yj={id:"filler",afterDatasetsUpdate(c,o,d){let r=(c.data.datasets||[]).length,s=[],t,g,w,M;for(g=0;g<r;++g)t=c.getDatasetMeta(g),w=t.dataset,M=null,w&&w.options&&w instanceof qw&&(M={visible:c.isDatasetVisible(g),index:g,fill:nj(w,g,r),chart:c,axis:t.controller.options.indexAxis,scale:t.vScale,line:w}),t.$filler=M,s.push(M);for(g=0;g<r;++g)M=s[g],!(!M||M.fill===!1)&&(M.fill=ij(s,g,d.propagate))},beforeDraw(c,o,d){let r=d.drawTime==="beforeDraw",s=c.getSortedVisibleDatasetMetas(),t=c.chartArea;for(let g=s.length-1;g>=0;--g){let w=s[g].$filler;w&&(w.line.updateControlPoints(t,w.axis),r&&w.fill&&WT(c.ctx,w,t))}},beforeDatasetsDraw(c,o,d){if(d.drawTime!=="beforeDatasetsDraw")return;let r=c.getSortedVisibleDatasetMetas();for(let s=r.length-1;s>=0;--s){let t=r[s].$filler;MO(t)&&WT(c.ctx,t,c.chartArea)}},beforeDatasetDraw(c,o,d){let r=o.meta.$filler;!MO(r)||d.drawTime!=="beforeDatasetDraw"||WT(c.ctx,r,c.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}},AO=(c,o)=>{let{boxHeight:d=o,boxWidth:r=o}=c;return c.usePointStyle&&(d=Math.min(d,o),r=c.pointStyleWidth||Math.min(r,o)),{boxWidth:r,boxHeight:d,itemHeight:Math.max(o,d)}},vj=(c,o)=>c!==null&&o!==null&&c.datasetIndex===o.datasetIndex&&c.index===o.index,Gw=class extends Xd{constructor(o){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=o.chart,this.options=o.options,this.ctx=o.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(o,d,r){this.maxWidth=o,this.maxHeight=d,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let o=this.options.labels||{},d=so(o.generateLabels,[this.chart],this)||[];o.filter&&(d=d.filter(r=>o.filter(r,this.chart.data))),o.sort&&(d=d.sort((r,s)=>o.sort(r,s,this.chart.data))),this.options.reverse&&d.reverse(),this.legendItems=d}fit(){let{options:o,ctx:d}=this;if(!o.display){this.width=this.height=0;return}let r=o.labels,s=xa(r.font),t=s.size,g=this._computeTitleHeight(),{boxWidth:w,itemHeight:M}=AO(r,t),F,N;d.font=s.string,this.isHorizontal()?(F=this.maxWidth,N=this._fitRows(g,t,w,M)+10):(N=this.maxHeight,F=this._fitCols(g,s,w,M)+10),this.width=Math.min(F,o.maxWidth||this.maxWidth),this.height=Math.min(N,o.maxHeight||this.maxHeight)}_fitRows(o,d,r,s){let{ctx:t,maxWidth:g,options:{labels:{padding:w}}}=this,M=this.legendHitBoxes=[],F=this.lineWidths=[0],N=s+w,Q=o;t.textAlign="left",t.textBaseline="middle";let ae=-1,pe=-N;return this.legendItems.forEach((Te,Pe)=>{let Re=r+d/2+t.measureText(Te.text).width;(Pe===0||F[F.length-1]+Re+2*w>g)&&(Q+=N,F[F.length-(Pe>0?0:1)]=0,pe+=N,ae++),M[Pe]={left:0,top:pe,row:ae,width:Re,height:s},F[F.length-1]+=Re+w}),Q}_fitCols(o,d,r,s){let{ctx:t,maxHeight:g,options:{labels:{padding:w}}}=this,M=this.legendHitBoxes=[],F=this.columnSizes=[],N=g-o,Q=w,ae=0,pe=0,Te=0,Pe=0;return this.legendItems.forEach((Re,Ke)=>{let{itemWidth:Je,itemHeight:_t}=xj(r,d,t,Re,s);Ke>0&&pe+_t+2*w>N&&(Q+=ae+w,F.push({width:ae,height:pe}),Te+=ae+w,Pe++,ae=pe=0),M[Ke]={left:Te,top:pe,col:Pe,width:Je,height:_t},ae=Math.max(ae,Je),pe+=_t+w}),Q+=ae,F.push({width:ae,height:pe}),Q}adjustHitBoxes(){if(!this.options.display)return;let o=this._computeTitleHeight(),{legendHitBoxes:d,options:{align:r,labels:{padding:s},rtl:t}}=this,g=Wg(t,this.left,this.width);if(this.isHorizontal()){let w=0,M=ls(r,this.left+s,this.right-this.lineWidths[w]);for(let F of d)w!==F.row&&(w=F.row,M=ls(r,this.left+s,this.right-this.lineWidths[w])),F.top+=this.top+o+s,F.left=g.leftForLtr(g.x(M),F.width),M+=F.width+s}else{let w=0,M=ls(r,this.top+o+s,this.bottom-this.columnSizes[w].height);for(let F of d)F.col!==w&&(w=F.col,M=ls(r,this.top+o+s,this.bottom-this.columnSizes[w].height)),F.top=M,F.left+=this.left+s,F.left=g.leftForLtr(g.x(F.left),F.width),M+=F.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){let o=this.ctx;nv(o,this),this._draw(),rv(o)}}_draw(){let{options:o,columnSizes:d,lineWidths:r,ctx:s}=this,{align:t,labels:g}=o,w=Lo.color,M=Wg(o.rtl,this.left,this.width),F=xa(g.font),{padding:N}=g,Q=F.size,ae=Q/2,pe;this.drawTitle(),s.textAlign=M.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=F.string;let{boxWidth:Te,boxHeight:Pe,itemHeight:Re}=AO(g,Q),Ke=function(Ut,ni,zt){if(isNaN(Te)||Te<=0||isNaN(Pe)||Pe<0)return;s.save();let pi=An(zt.lineWidth,1);if(s.fillStyle=An(zt.fillStyle,w),s.lineCap=An(zt.lineCap,"butt"),s.lineDashOffset=An(zt.lineDashOffset,0),s.lineJoin=An(zt.lineJoin,"miter"),s.lineWidth=pi,s.strokeStyle=An(zt.strokeStyle,w),s.setLineDash(An(zt.lineDash,[])),g.usePointStyle){let ei={radius:Pe*Math.SQRT2/2,pointStyle:zt.pointStyle,rotation:zt.rotation,borderWidth:pi},Ji=M.xPlus(Ut,Te/2),bn=ni+ae;CT(s,ei,Ji,bn,g.pointStyleWidth&&Te)}else{let ei=ni+Math.max((Q-Pe)/2,0),Ji=M.leftForLtr(Ut,Te),bn=uf(zt.borderRadius);s.beginPath(),Object.values(bn).some(lo=>lo!==0)?H0(s,{x:Ji,y:ei,w:Te,h:Pe,radius:bn}):s.rect(Ji,ei,Te,Pe),s.fill(),pi!==0&&s.stroke()}s.restore()},Je=function(Ut,ni,zt){df(s,zt.text,Ut,ni+Re/2,F,{strikethrough:zt.hidden,textAlign:M.textAlign(zt.textAlign)})},_t=this.isHorizontal(),Nt=this._computeTitleHeight();_t?pe={x:ls(t,this.left+N,this.right-r[0]),y:this.top+N+Nt,line:0}:pe={x:this.left+N,y:ls(t,this.top+Nt+N,this.bottom-d[0].height),line:0},AT(this.ctx,o.textDirection);let kt=Re+N;this.legendItems.forEach((Ut,ni)=>{s.strokeStyle=Ut.fontColor,s.fillStyle=Ut.fontColor;let zt=s.measureText(Ut.text).width,pi=M.textAlign(Ut.textAlign||(Ut.textAlign=g.textAlign)),ei=Te+ae+zt,Ji=pe.x,bn=pe.y;M.setWidth(this.width),_t?ni>0&&Ji+ei+N>this.right&&(bn=pe.y+=kt,pe.line++,Ji=pe.x=ls(t,this.left+N,this.right-r[pe.line])):ni>0&&bn+kt>this.bottom&&(Ji=pe.x=Ji+d[pe.line].width+N,pe.line++,bn=pe.y=ls(t,this.top+Nt+N,this.bottom-d[pe.line].height));let lo=M.x(Ji);if(Ke(lo,bn,Ut),Ji=DP(pi,Ji+Te+ae,_t?Ji+ei:this.right,o.rtl),Je(M.x(Ji),bn,Ut),_t)pe.x+=ei+N;else if(typeof Ut.text!="string"){let Hi=F.lineHeight;pe.y+=h3(Ut,Hi)+N}else pe.y+=kt}),PT(this.ctx,o.textDirection)}drawTitle(){let o=this.options,d=o.title,r=xa(d.font),s=cs(d.padding);if(!d.display)return;let t=Wg(o.rtl,this.left,this.width),g=this.ctx,w=d.position,M=r.size/2,F=s.top+M,N,Q=this.left,ae=this.width;if(this.isHorizontal())ae=Math.max(...this.lineWidths),N=this.top+F,Q=ls(o.align,Q,this.right-ae);else{let Te=this.columnSizes.reduce((Pe,Re)=>Math.max(Pe,Re.height),0);N=F+ls(o.align,this.top,this.bottom-Te-o.labels.padding-this._computeTitleHeight())}let pe=ls(w,Q,Q+ae);g.textAlign=t.textAlign(Cw(w)),g.textBaseline="middle",g.strokeStyle=d.color,g.fillStyle=d.color,g.font=r.string,df(g,d.text,pe,N,r)}_computeTitleHeight(){let o=this.options.title,d=xa(o.font),r=cs(o.padding);return o.display?d.lineHeight+r.height:0}_getLegendItemAt(o,d){let r,s,t;if(ph(o,this.left,this.right)&&ph(d,this.top,this.bottom)){for(t=this.legendHitBoxes,r=0;r<t.length;++r)if(s=t[r],ph(o,s.left,s.left+s.width)&&ph(d,s.top,s.top+s.height))return this.legendItems[r]}return null}handleEvent(o){let d=this.options;if(!Sj(o.type,d))return;let r=this._getLegendItemAt(o.x,o.y);if(o.type==="mousemove"||o.type==="mouseout"){let s=this._hoveredItem,t=vj(s,r);s&&!t&&so(d.onLeave,[o,s,this],this),this._hoveredItem=r,r&&!t&&so(d.onHover,[o,r,this],this)}else r&&so(d.onClick,[o,r,this],this)}};function xj(c,o,d,r,s){let t=wj(r,c,o,d),g=Cj(s,r,o.lineHeight);return{itemWidth:t,itemHeight:g}}function wj(c,o,d,r){let s=c.text;return s&&typeof s!="string"&&(s=s.reduce((t,g)=>t.length>g.length?t:g)),o+d.size/2+r.measureText(s).width}function Cj(c,o,d){let r=c;return typeof o.text!="string"&&(r=h3(o,d)),r}function h3(c,o){let d=c.text?c.text.length:0;return o*d}function Sj(c,o){return!!((c==="mousemove"||c==="mouseout")&&(o.onHover||o.onLeave)||o.onClick&&(c==="click"||c==="mouseup"))}var Ij={id:"legend",_element:Gw,start(c,o,d){let r=c.legend=new Gw({ctx:c.ctx,options:d,chart:c});Es.configure(c,r,d),Es.addBox(c,r)},stop(c){Es.removeBox(c,c.legend),delete c.legend},beforeUpdate(c,o,d){let r=c.legend;Es.configure(c,r,d),r.options=d},afterUpdate(c){let o=c.legend;o.buildLabels(),o.adjustHitBoxes()},afterEvent(c,o){o.replay||c.legend.handleEvent(o.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(c,o,d){let r=o.datasetIndex,s=d.chart;s.isDatasetVisible(r)?(s.hide(r),o.hidden=!0):(s.show(r),o.hidden=!1)},onHover:null,onLeave:null,labels:{color:c=>c.chart.options.color,boxWidth:40,padding:10,generateLabels(c){let o=c.data.datasets,{labels:{usePointStyle:d,pointStyle:r,textAlign:s,color:t,useBorderRadius:g,borderRadius:w}}=c.legend.options;return c._getSortedDatasetMetas().map(M=>{let F=M.controller.getStyle(d?0:void 0),N=cs(F.borderWidth);return{text:o[M.index].label,fillStyle:F.backgroundColor,fontColor:t,hidden:!M.visible,lineCap:F.borderCapStyle,lineDash:F.borderDash,lineDashOffset:F.borderDashOffset,lineJoin:F.borderJoinStyle,lineWidth:(N.width+N.height)/4,strokeStyle:F.borderColor,pointStyle:r||F.pointStyle,rotation:F.rotation,textAlign:s||F.textAlign,borderRadius:g&&(w||F.borderRadius),datasetIndex:M.index}},this)}},title:{color:c=>c.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:c=>!c.startsWith("on"),labels:{_scriptable:c=>!["generateLabels","filter","sort"].includes(c)}}},mv=class extends Xd{constructor(o){super(),this.chart=o.chart,this.options=o.options,this.ctx=o.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(o,d){let r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=o,this.height=this.bottom=d;let s=uo(r.text)?r.text.length:1;this._padding=cs(r.padding);let t=s*xa(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=t:this.width=t}isHorizontal(){let o=this.options.position;return o==="top"||o==="bottom"}_drawArgs(o){let{top:d,left:r,bottom:s,right:t,options:g}=this,w=g.align,M=0,F,N,Q;return this.isHorizontal()?(N=ls(w,r,t),Q=d+o,F=t-r):(g.position==="left"?(N=r+o,Q=ls(w,s,d),M=ho*-.5):(N=t-o,Q=ls(w,d,s),M=ho*.5),F=s-d),{titleX:N,titleY:Q,maxWidth:F,rotation:M}}draw(){let o=this.ctx,d=this.options;if(!d.display)return;let r=xa(d.font),t=r.lineHeight/2+this._padding.top,{titleX:g,titleY:w,maxWidth:M,rotation:F}=this._drawArgs(t);df(o,d.text,0,0,r,{color:d.color,maxWidth:M,rotation:F,textAlign:Cw(d.align),textBaseline:"middle",translation:[g,w]})}};function Tj(c,o){let d=new mv({ctx:c.ctx,options:o,chart:c});Es.configure(c,d,o),Es.addBox(c,d),c.titleBlock=d}var Mj={id:"title",_element:mv,start(c,o,d){Tj(c,d)},stop(c){let o=c.titleBlock;Es.removeBox(c,o),delete c.titleBlock},beforeUpdate(c,o,d){let r=c.titleBlock;Es.configure(c,r,d),r.options=d},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},Fw=new WeakMap,kj={id:"subtitle",start(c,o,d){let r=new mv({ctx:c.ctx,options:d,chart:c});Es.configure(c,r,d),Es.addBox(c,r),Fw.set(c,r)},stop(c){Es.removeBox(c,Fw.get(c)),Fw.delete(c)},beforeUpdate(c,o,d){let r=Fw.get(c);Es.configure(c,r,d),r.options=d},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},uv={average(c){if(!c.length)return!1;let o,d,r=new Set,s=0,t=0;for(o=0,d=c.length;o<d;++o){let w=c[o].element;if(w&&w.hasValue()){let M=w.tooltipPosition();r.add(M.x),s+=M.y,++t}}return{x:[...r].reduce((w,M)=>w+M)/r.size,y:s/t}},nearest(c,o){if(!c.length)return!1;let d=o.x,r=o.y,s=Number.POSITIVE_INFINITY,t,g,w;for(t=0,g=c.length;t<g;++t){let M=c[t].element;if(M&&M.hasValue()){let F=M.getCenterPoint(),N=bw(o,F);N<s&&(s=N,w=M)}}if(w){let M=w.tooltipPosition();d=M.x,r=M.y}return{x:d,y:r}}};function fh(c,o){return o&&(uo(o)?Array.prototype.push.apply(c,o):c.push(o)),c}function Gm(c){return(typeof c=="string"||c instanceof String)&&c.indexOf(`
`)>-1?c.split(`
`):c}function Ej(c,o){let{element:d,datasetIndex:r,index:s}=o,t=c.getDatasetMeta(r).controller,{label:g,value:w}=t.getLabelAndValue(s);return{chart:c,label:g,parsed:t.getParsed(s),raw:c.data.datasets[r].data[s],formattedValue:w,dataset:t.getDataset(),dataIndex:s,datasetIndex:r,element:d}}function PO(c,o){let d=c.chart.ctx,{body:r,footer:s,title:t}=c,{boxWidth:g,boxHeight:w}=o,M=xa(o.bodyFont),F=xa(o.titleFont),N=xa(o.footerFont),Q=t.length,ae=s.length,pe=r.length,Te=cs(o.padding),Pe=Te.height,Re=0,Ke=r.reduce((Nt,kt)=>Nt+kt.before.length+kt.lines.length+kt.after.length,0);if(Ke+=c.beforeBody.length+c.afterBody.length,Q&&(Pe+=Q*F.lineHeight+(Q-1)*o.titleSpacing+o.titleMarginBottom),Ke){let Nt=o.displayColors?Math.max(w,M.lineHeight):M.lineHeight;Pe+=pe*Nt+(Ke-pe)*M.lineHeight+(Ke-1)*o.bodySpacing}ae&&(Pe+=o.footerMarginTop+ae*N.lineHeight+(ae-1)*o.footerSpacing);let Je=0,_t=function(Nt){Re=Math.max(Re,d.measureText(Nt).width+Je)};return d.save(),d.font=F.string,Nr(c.title,_t),d.font=M.string,Nr(c.beforeBody.concat(c.afterBody),_t),Je=o.displayColors?g+2+o.boxPadding:0,Nr(r,Nt=>{Nr(Nt.before,_t),Nr(Nt.lines,_t),Nr(Nt.after,_t)}),Je=0,d.font=N.string,Nr(c.footer,_t),d.restore(),Re+=Te.width,{width:Re,height:Pe}}function Dj(c,o){let{y:d,height:r}=o;return d<r/2?"top":d>c.height-r/2?"bottom":"center"}function Aj(c,o,d,r){let{x:s,width:t}=r,g=d.caretSize+d.caretPadding;if(c==="left"&&s+t+g>o.width||c==="right"&&s-t-g<0)return!0}function Pj(c,o,d,r){let{x:s,width:t}=d,{width:g,chartArea:{left:w,right:M}}=c,F="center";return r==="center"?F=s<=(w+M)/2?"left":"right":s<=t/2?F="left":s>=g-t/2&&(F="right"),Aj(F,c,o,d)&&(F="center"),F}function OO(c,o,d){let r=d.yAlign||o.yAlign||Dj(c,d);return{xAlign:d.xAlign||o.xAlign||Pj(c,o,d,r),yAlign:r}}function Oj(c,o){let{x:d,width:r}=c;return o==="right"?d-=r:o==="center"&&(d-=r/2),d}function Rj(c,o,d){let{y:r,height:s}=c;return o==="top"?r+=d:o==="bottom"?r-=s+d:r-=s/2,r}function RO(c,o,d,r){let{caretSize:s,caretPadding:t,cornerRadius:g}=c,{xAlign:w,yAlign:M}=d,F=s+t,{topLeft:N,topRight:Q,bottomLeft:ae,bottomRight:pe}=uf(g),Te=Oj(o,w),Pe=Rj(o,M,F);return M==="center"?w==="left"?Te+=F:w==="right"&&(Te-=F):w==="left"?Te-=Math.max(N,ae)+s:w==="right"&&(Te+=Math.max(Q,pe)+s),{x:Ra(Te,0,r.width-o.width),y:Ra(Pe,0,r.height-o.height)}}function Lw(c,o,d){let r=cs(d.padding);return o==="center"?c.x+c.width/2:o==="right"?c.x+c.width-r.right:c.x+r.left}function FO(c){return fh([],Gm(c))}function Fj(c,o,d){return Wm(c,{tooltip:o,tooltipItems:d,type:"tooltip"})}function LO(c,o){let d=o&&o.dataset&&o.dataset.tooltip&&o.dataset.tooltip.callbacks;return d?c.override(d):c}var m3={beforeTitle:mh,title(c){if(c.length>0){let o=c[0],d=o.chart.data.labels,r=d?d.length:0;if(this&&this.options&&this.options.mode==="dataset")return o.dataset.label||"";if(o.label)return o.label;if(r>0&&o.dataIndex<r)return d[o.dataIndex]}return""},afterTitle:mh,beforeBody:mh,beforeLabel:mh,label(c){if(this&&this.options&&this.options.mode==="dataset")return c.label+": "+c.formattedValue||c.formattedValue;let o=c.dataset.label||"";o&&(o+=": ");let d=c.formattedValue;return pr(d)||(o+=d),o},labelColor(c){let d=c.chart.getDatasetMeta(c.datasetIndex).controller.getStyle(c.dataIndex);return{borderColor:d.borderColor,backgroundColor:d.backgroundColor,borderWidth:d.borderWidth,borderDash:d.borderDash,borderDashOffset:d.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(c){let d=c.chart.getDatasetMeta(c.datasetIndex).controller.getStyle(c.dataIndex);return{pointStyle:d.pointStyle,rotation:d.rotation}},afterLabel:mh,afterBody:mh,beforeFooter:mh,footer:mh,afterFooter:mh};function Al(c,o,d,r){let s=c[o].call(d,r);return typeof s>"u"?m3[o].call(d,r):s}var zO=(()=>{class c extends Xd{static positioners=uv;constructor(d){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=d.chart,this.options=d.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(d){this.options=d,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let d=this._cachedAnimations;if(d)return d;let r=this.chart,s=this.options.setContext(this.getContext()),t=s.enabled&&r.options.animation&&s.animations,g=new Vw(this.chart,t);return t._cacheable&&(this._cachedAnimations=Object.freeze(g)),g}getContext(){return this.$context||(this.$context=Fj(this.chart.getContext(),this,this._tooltipItems))}getTitle(d,r){let{callbacks:s}=r,t=Al(s,"beforeTitle",this,d),g=Al(s,"title",this,d),w=Al(s,"afterTitle",this,d),M=[];return M=fh(M,Gm(t)),M=fh(M,Gm(g)),M=fh(M,Gm(w)),M}getBeforeBody(d,r){return FO(Al(r.callbacks,"beforeBody",this,d))}getBody(d,r){let{callbacks:s}=r,t=[];return Nr(d,g=>{let w={before:[],lines:[],after:[]},M=LO(s,g);fh(w.before,Gm(Al(M,"beforeLabel",this,g))),fh(w.lines,Al(M,"label",this,g)),fh(w.after,Gm(Al(M,"afterLabel",this,g))),t.push(w)}),t}getAfterBody(d,r){return FO(Al(r.callbacks,"afterBody",this,d))}getFooter(d,r){let{callbacks:s}=r,t=Al(s,"beforeFooter",this,d),g=Al(s,"footer",this,d),w=Al(s,"afterFooter",this,d),M=[];return M=fh(M,Gm(t)),M=fh(M,Gm(g)),M=fh(M,Gm(w)),M}_createItems(d){let r=this._active,s=this.chart.data,t=[],g=[],w=[],M=[],F,N;for(F=0,N=r.length;F<N;++F)M.push(Ej(this.chart,r[F]));return d.filter&&(M=M.filter((Q,ae,pe)=>d.filter(Q,ae,pe,s))),d.itemSort&&(M=M.sort((Q,ae)=>d.itemSort(Q,ae,s))),Nr(M,Q=>{let ae=LO(d.callbacks,Q);t.push(Al(ae,"labelColor",this,Q)),g.push(Al(ae,"labelPointStyle",this,Q)),w.push(Al(ae,"labelTextColor",this,Q))}),this.labelColors=t,this.labelPointStyles=g,this.labelTextColors=w,this.dataPoints=M,M}update(d,r){let s=this.options.setContext(this.getContext()),t=this._active,g,w=[];if(!t.length)this.opacity!==0&&(g={opacity:0});else{let M=uv[s.position].call(this,t,this._eventPosition);w=this._createItems(s),this.title=this.getTitle(w,s),this.beforeBody=this.getBeforeBody(w,s),this.body=this.getBody(w,s),this.afterBody=this.getAfterBody(w,s),this.footer=this.getFooter(w,s);let F=this._size=PO(this,s),N=Object.assign({},M,F),Q=OO(this.chart,s,N),ae=RO(s,N,Q,this.chart);this.xAlign=Q.xAlign,this.yAlign=Q.yAlign,g={opacity:1,x:ae.x,y:ae.y,width:F.width,height:F.height,caretX:M.x,caretY:M.y}}this._tooltipItems=w,this.$context=void 0,g&&this._resolveAnimations().update(this,g),d&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:r})}drawCaret(d,r,s,t){let g=this.getCaretPosition(d,s,t);r.lineTo(g.x1,g.y1),r.lineTo(g.x2,g.y2),r.lineTo(g.x3,g.y3)}getCaretPosition(d,r,s){let{xAlign:t,yAlign:g}=this,{caretSize:w,cornerRadius:M}=s,{topLeft:F,topRight:N,bottomLeft:Q,bottomRight:ae}=uf(M),{x:pe,y:Te}=d,{width:Pe,height:Re}=r,Ke,Je,_t,Nt,kt,Ut;return g==="center"?(kt=Te+Re/2,t==="left"?(Ke=pe,Je=Ke-w,Nt=kt+w,Ut=kt-w):(Ke=pe+Pe,Je=Ke+w,Nt=kt-w,Ut=kt+w),_t=Ke):(t==="left"?Je=pe+Math.max(F,Q)+w:t==="right"?Je=pe+Pe-Math.max(N,ae)-w:Je=this.caretX,g==="top"?(Nt=Te,kt=Nt-w,Ke=Je-w,_t=Je+w):(Nt=Te+Re,kt=Nt+w,Ke=Je+w,_t=Je-w),Ut=Nt),{x1:Ke,x2:Je,x3:_t,y1:Nt,y2:kt,y3:Ut}}drawTitle(d,r,s){let t=this.title,g=t.length,w,M,F;if(g){let N=Wg(s.rtl,this.x,this.width);for(d.x=Lw(this,s.titleAlign,s),r.textAlign=N.textAlign(s.titleAlign),r.textBaseline="middle",w=xa(s.titleFont),M=s.titleSpacing,r.fillStyle=s.titleColor,r.font=w.string,F=0;F<g;++F)r.fillText(t[F],N.x(d.x),d.y+w.lineHeight/2),d.y+=w.lineHeight+M,F+1===g&&(d.y+=s.titleMarginBottom-M)}}_drawColorBox(d,r,s,t,g){let w=this.labelColors[s],M=this.labelPointStyles[s],{boxHeight:F,boxWidth:N}=g,Q=xa(g.bodyFont),ae=Lw(this,"left",g),pe=t.x(ae),Te=F<Q.lineHeight?(Q.lineHeight-F)/2:0,Pe=r.y+Te;if(g.usePointStyle){let Re={radius:Math.min(N,F)/2,pointStyle:M.pointStyle,rotation:M.rotation,borderWidth:1},Ke=t.leftForLtr(pe,N)+N/2,Je=Pe+F/2;d.strokeStyle=g.multiKeyBackground,d.fillStyle=g.multiKeyBackground,Iw(d,Re,Ke,Je),d.strokeStyle=w.borderColor,d.fillStyle=w.backgroundColor,Iw(d,Re,Ke,Je)}else{d.lineWidth=Jn(w.borderWidth)?Math.max(...Object.values(w.borderWidth)):w.borderWidth||1,d.strokeStyle=w.borderColor,d.setLineDash(w.borderDash||[]),d.lineDashOffset=w.borderDashOffset||0;let Re=t.leftForLtr(pe,N),Ke=t.leftForLtr(t.xPlus(pe,1),N-2),Je=uf(w.borderRadius);Object.values(Je).some(_t=>_t!==0)?(d.beginPath(),d.fillStyle=g.multiKeyBackground,H0(d,{x:Re,y:Pe,w:N,h:F,radius:Je}),d.fill(),d.stroke(),d.fillStyle=w.backgroundColor,d.beginPath(),H0(d,{x:Ke,y:Pe+1,w:N-2,h:F-2,radius:Je}),d.fill()):(d.fillStyle=g.multiKeyBackground,d.fillRect(Re,Pe,N,F),d.strokeRect(Re,Pe,N,F),d.fillStyle=w.backgroundColor,d.fillRect(Ke,Pe+1,N-2,F-2))}d.fillStyle=this.labelTextColors[s]}drawBody(d,r,s){let{body:t}=this,{bodySpacing:g,bodyAlign:w,displayColors:M,boxHeight:F,boxWidth:N,boxPadding:Q}=s,ae=xa(s.bodyFont),pe=ae.lineHeight,Te=0,Pe=Wg(s.rtl,this.x,this.width),Re=function(pi){r.fillText(pi,Pe.x(d.x+Te),d.y+pe/2),d.y+=pe+g},Ke=Pe.textAlign(w),Je,_t,Nt,kt,Ut,ni,zt;for(r.textAlign=w,r.textBaseline="middle",r.font=ae.string,d.x=Lw(this,Ke,s),r.fillStyle=s.bodyColor,Nr(this.beforeBody,Re),Te=M&&Ke!=="right"?w==="center"?N/2+Q:N+2+Q:0,kt=0,ni=t.length;kt<ni;++kt){for(Je=t[kt],_t=this.labelTextColors[kt],r.fillStyle=_t,Nr(Je.before,Re),Nt=Je.lines,M&&Nt.length&&(this._drawColorBox(r,d,kt,Pe,s),pe=Math.max(ae.lineHeight,F)),Ut=0,zt=Nt.length;Ut<zt;++Ut)Re(Nt[Ut]),pe=ae.lineHeight;Nr(Je.after,Re)}Te=0,pe=ae.lineHeight,Nr(this.afterBody,Re),d.y-=g}drawFooter(d,r,s){let t=this.footer,g=t.length,w,M;if(g){let F=Wg(s.rtl,this.x,this.width);for(d.x=Lw(this,s.footerAlign,s),d.y+=s.footerMarginTop,r.textAlign=F.textAlign(s.footerAlign),r.textBaseline="middle",w=xa(s.footerFont),r.fillStyle=s.footerColor,r.font=w.string,M=0;M<g;++M)r.fillText(t[M],F.x(d.x),d.y+w.lineHeight/2),d.y+=w.lineHeight+s.footerSpacing}}drawBackground(d,r,s,t){let{xAlign:g,yAlign:w}=this,{x:M,y:F}=d,{width:N,height:Q}=s,{topLeft:ae,topRight:pe,bottomLeft:Te,bottomRight:Pe}=uf(t.cornerRadius);r.fillStyle=t.backgroundColor,r.strokeStyle=t.borderColor,r.lineWidth=t.borderWidth,r.beginPath(),r.moveTo(M+ae,F),w==="top"&&this.drawCaret(d,r,s,t),r.lineTo(M+N-pe,F),r.quadraticCurveTo(M+N,F,M+N,F+pe),w==="center"&&g==="right"&&this.drawCaret(d,r,s,t),r.lineTo(M+N,F+Q-Pe),r.quadraticCurveTo(M+N,F+Q,M+N-Pe,F+Q),w==="bottom"&&this.drawCaret(d,r,s,t),r.lineTo(M+Te,F+Q),r.quadraticCurveTo(M,F+Q,M,F+Q-Te),w==="center"&&g==="left"&&this.drawCaret(d,r,s,t),r.lineTo(M,F+ae),r.quadraticCurveTo(M,F,M+ae,F),r.closePath(),r.fill(),t.borderWidth>0&&r.stroke()}_updateAnimationTarget(d){let r=this.chart,s=this.$animations,t=s&&s.x,g=s&&s.y;if(t||g){let w=uv[d.position].call(this,this._active,this._eventPosition);if(!w)return;let M=this._size=PO(this,d),F=Object.assign({},w,this._size),N=OO(r,d,F),Q=RO(d,F,N,r);(t._to!==Q.x||g._to!==Q.y)&&(this.xAlign=N.xAlign,this.yAlign=N.yAlign,this.width=M.width,this.height=M.height,this.caretX=w.x,this.caretY=w.y,this._resolveAnimations().update(this,Q))}}_willRender(){return!!this.opacity}draw(d){let r=this.options.setContext(this.getContext()),s=this.opacity;if(!s)return;this._updateAnimationTarget(r);let t={width:this.width,height:this.height},g={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;let w=cs(r.padding),M=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;r.enabled&&M&&(d.save(),d.globalAlpha=s,this.drawBackground(g,d,t,r),AT(d,r.textDirection),g.y+=w.top,this.drawTitle(g,d,r),this.drawBody(g,d,r),this.drawFooter(g,d,r),PT(d,r.textDirection),d.restore())}getActiveElements(){return this._active||[]}setActiveElements(d,r){let s=this._active,t=d.map(({datasetIndex:M,index:F})=>{let N=this.chart.getDatasetMeta(M);if(!N)throw new Error("Cannot find a dataset at index "+M);return{datasetIndex:M,element:N.data[F],index:F}}),g=!tv(s,t),w=this._positionChanged(t,r);(g||w)&&(this._active=t,this._eventPosition=r,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(d,r,s=!0){if(r&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let t=this.options,g=this._active||[],w=this._getActiveElements(d,g,r,s),M=this._positionChanged(w,d),F=r||!tv(w,g)||M;return F&&(this._active=w,(t.enabled||t.external)&&(this._eventPosition={x:d.x,y:d.y},this.update(!0,r))),F}_getActiveElements(d,r,s,t){let g=this.options;if(d.type==="mouseout")return[];if(!t)return r.filter(M=>this.chart.data.datasets[M.datasetIndex]&&this.chart.getDatasetMeta(M.datasetIndex).controller.getParsed(M.index)!==void 0);let w=this.chart.getElementsAtEventForMode(d,g.mode,g,s);return g.reverse&&w.reverse(),w}_positionChanged(d,r){let{caretX:s,caretY:t,options:g}=this,w=uv[g.position].call(this,d,r);return w!==!1&&(s!==w.x||t!==w.y)}}return c})(),Lj={id:"tooltip",_element:zO,positioners:uv,afterInit(c,o,d){d&&(c.tooltip=new zO({chart:c,options:d}))},beforeUpdate(c,o,d){c.tooltip&&c.tooltip.initialize(d)},reset(c,o,d){c.tooltip&&c.tooltip.initialize(d)},afterDraw(c){let o=c.tooltip;if(o&&o._willRender()){let d={tooltip:o};if(c.notifyPlugins("beforeTooltipDraw",yl(Dn({},d),{cancelable:!0}))===!1)return;o.draw(c.ctx),c.notifyPlugins("afterTooltipDraw",d)}},afterEvent(c,o){if(c.tooltip){let d=o.replay;c.tooltip.handleEvent(o.event,d,o.inChartArea)&&(o.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(c,o)=>o.bodyFont.size,boxWidth:(c,o)=>o.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:m3},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:c=>c!=="filter"&&c!=="itemSort"&&c!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},zj=Object.freeze({__proto__:null,Colors:Z6,Decimation:J6,Filler:yj,Legend:Ij,SubTitle:kj,Title:Mj,Tooltip:Lj}),Bj=(c,o,d,r)=>(typeof o=="string"?(d=c.push(o)-1,r.unshift({index:d,label:o})):isNaN(o)&&(d=null),d);function Nj(c,o,d,r){let s=c.indexOf(o);if(s===-1)return Bj(c,o,d,r);let t=c.lastIndexOf(o);return s!==t?d:s}var Vj=(c,o)=>c===null?null:Ra(Math.round(c),0,o);function BO(c){let o=this.getLabels();return c>=0&&c<o.length?o[c]:c}var jj=(()=>{class c extends qg{static id="category";static defaults={ticks:{callback:BO}};constructor(d){super(d),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(d){let r=this._addedLabels;if(r.length){let s=this.getLabels();for(let{index:t,label:g}of r)s[t]===g&&s.splice(t,1);this._addedLabels=[]}super.init(d)}parse(d,r){if(pr(d))return null;let s=this.getLabels();return r=isFinite(r)&&s[r]===d?r:Nj(s,d,An(r,d),this._addedLabels),Vj(r,s.length-1)}determineDataLimits(){let{minDefined:d,maxDefined:r}=this.getUserBounds(),{min:s,max:t}=this.getMinMax(!0);this.options.bounds==="ticks"&&(d||(s=0),r||(t=this.getLabels().length-1)),this.min=s,this.max=t}buildTicks(){let d=this.min,r=this.max,s=this.options.offset,t=[],g=this.getLabels();g=d===0&&r===g.length-1?g:g.slice(d,r+1),this._valueRange=Math.max(g.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let w=d;w<=r;w++)t.push({value:w});return t}getLabelForValue(d){return BO.call(this,d)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(d){return typeof d!="number"&&(d=this.parse(d)),d===null?NaN:this.getPixelForDecimal((d-this._startValue)/this._valueRange)}getPixelForTick(d){let r=this.ticks;return d<0||d>r.length-1?null:this.getPixelForValue(r[d].value)}getValueForPixel(d){return Math.round(this._startValue+this.getDecimalForPixel(d)*this._valueRange)}getBasePixel(){return this.bottom}}return c})();function Uj(c,o){let d=[],{bounds:s,step:t,min:g,max:w,precision:M,count:F,maxTicks:N,maxDigits:Q,includeBounds:ae}=c,pe=t||1,Te=N-1,{min:Pe,max:Re}=o,Ke=!pr(g),Je=!pr(w),_t=!pr(F),Nt=(Re-Pe)/(Q+1),kt=dT((Re-Pe)/Te/pe)*pe,Ut,ni,zt,pi;if(kt<1e-14&&!Ke&&!Je)return[{value:Pe},{value:Re}];pi=Math.ceil(Re/kt)-Math.floor(Pe/kt),pi>Te&&(kt=dT(pi*kt/Te/pe)*pe),pr(M)||(Ut=Math.pow(10,M),kt=Math.ceil(kt*Ut)/Ut),s==="ticks"?(ni=Math.floor(Pe/kt)*kt,zt=Math.ceil(Re/kt)*kt):(ni=Pe,zt=Re),Ke&&Je&&t&&CP((w-g)/t,kt/1e3)?(pi=Math.round(Math.min((w-g)/kt,N)),kt=(w-g)/pi,ni=g,zt=w):_t?(ni=Ke?g:ni,zt=Je?w:zt,pi=F-1,kt=(zt-ni)/pi):(pi=(zt-ni)/kt,j0(pi,Math.round(pi),kt/1e3)?pi=Math.round(pi):pi=Math.ceil(pi));let ei=Math.max(hT(kt),hT(ni));Ut=Math.pow(10,pr(M)?ei:M),ni=Math.round(ni*Ut)/Ut,zt=Math.round(zt*Ut)/Ut;let Ji=0;for(Ke&&(ae&&ni!==g?(d.push({value:g}),ni<g&&Ji++,j0(Math.round((ni+Ji*kt)*Ut)/Ut,g,NO(g,Nt,c))&&Ji++):ni<g&&Ji++);Ji<pi;++Ji){let bn=Math.round((ni+Ji*kt)*Ut)/Ut;if(Je&&bn>w)break;d.push({value:bn})}return Je&&ae&&zt!==w?d.length&&j0(d[d.length-1].value,w,NO(w,Nt,c))?d[d.length-1].value=w:d.push({value:w}):(!Je||zt===w)&&d.push({value:zt}),d}function NO(c,o,{horizontal:d,minRotation:r}){let s=Qc(r),t=(d?Math.sin(s):Math.cos(s))||.001,g=.75*o*(""+c).length;return Math.min(o/t,g)}var Y0=class extends qg{constructor(o){super(o),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(o,d){return pr(o)||(typeof o=="number"||o instanceof Number)&&!isFinite(+o)?null:+o}handleTickRangeOptions(){let{beginAtZero:o}=this.options,{minDefined:d,maxDefined:r}=this.getUserBounds(),{min:s,max:t}=this,g=M=>s=d?s:M,w=M=>t=r?t:M;if(o){let M=Zd(s),F=Zd(t);M<0&&F<0?w(0):M>0&&F>0&&g(0)}if(s===t){let M=t===0?1:Math.abs(t*.05);w(t+M),o||g(s-M)}this.min=s,this.max=t}getTickLimit(){let o=this.options.ticks,{maxTicksLimit:d,stepSize:r}=o,s;return r?(s=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),d=d||11),d&&(s=Math.min(d,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let o=this.options,d=o.ticks,r=this.getTickLimit();r=Math.max(2,r);let s={maxTicks:r,bounds:o.bounds,min:o.min,max:o.max,precision:d.precision,step:d.stepSize,count:d.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:d.minRotation||0,includeBounds:d.includeBounds!==!1},t=this._range||this,g=Uj(s,t);return o.bounds==="ticks"&&uT(g,this,"value"),o.reverse?(g.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),g}configure(){let o=this.ticks,d=this.min,r=this.max;if(super.configure(),this.options.offset&&o.length){let s=(r-d)/Math.max(o.length-1,1)/2;d-=s,r+=s}this._startValue=d,this._endValue=r,this._valueRange=r-d}getLabelForValue(o){return W0(o,this.chart.options.locale,this.options.ticks.format)}},oM=class extends Y0{static id="linear";static defaults={ticks:{callback:iv.formatters.numeric}};determineDataLimits(){let{min:o,max:d}=this.getMinMax(!0);this.min=Fo(o)?o:0,this.max=Fo(d)?d:1,this.handleTickRangeOptions()}computeTickLimit(){let o=this.isHorizontal(),d=o?this.width:this.height,r=Qc(this.options.ticks.minRotation),s=(o?Math.sin(r):Math.cos(r))||.001,t=this._resolveTickFontOptions(0);return Math.ceil(d/Math.min(40,t.lineHeight/s))}getPixelForValue(o){return o===null?NaN:this.getPixelForDecimal((o-this._startValue)/this._valueRange)}getValueForPixel(o){return this._startValue+this.getDecimalForPixel(o)*this._valueRange}},pv=c=>Math.floor(jm(c)),Gg=(c,o)=>Math.pow(10,pv(c)+o);function VO(c){return c/Math.pow(10,pv(c))===1}function jO(c,o,d){let r=Math.pow(10,d),s=Math.floor(c/r);return Math.ceil(o/r)-s}function Wj(c,o){let d=o-c,r=pv(d);for(;jO(c,o,r)>10;)r++;for(;jO(c,o,r)<10;)r--;return Math.min(r,pv(c))}function Hj(c,{min:o,max:d}){o=Dl(c.min,o);let r=[],s=pv(o),t=Wj(o,d),g=t<0?Math.pow(10,Math.abs(t)):1,w=Math.pow(10,t),M=s>t?Math.pow(10,s):0,F=Math.round((o-M)*g)/g,N=Math.floor((o-M)/w/10)*w*10,Q=Math.floor((F-N)/Math.pow(10,t)),ae=Dl(c.min,Math.round((M+N+Q*Math.pow(10,t))*g)/g);for(;ae<d;)r.push({value:ae,major:VO(ae),significand:Q}),Q>=10?Q=Q<15?15:20:Q++,Q>=20&&(t++,Q=2,g=t>=0?1:g),ae=Math.round((M+N+Q*Math.pow(10,t))*g)/g;let pe=Dl(c.max,ae);return r.push({value:pe,major:VO(pe),significand:Q}),r}var aM=class extends qg{static id="logarithmic";static defaults={ticks:{callback:iv.formatters.logarithmic,major:{enabled:!0}}};constructor(o){super(o),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(o,d){let r=Y0.prototype.parse.apply(this,[o,d]);if(r===0){this._zero=!0;return}return Fo(r)&&r>0?r:null}determineDataLimits(){let{min:o,max:d}=this.getMinMax(!0);this.min=Fo(o)?Math.max(0,o):null,this.max=Fo(d)?Math.max(0,d):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Fo(this._userMin)&&(this.min=o===Gg(this.min,0)?Gg(this.min,-1):Gg(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:o,maxDefined:d}=this.getUserBounds(),r=this.min,s=this.max,t=w=>r=o?r:w,g=w=>s=d?s:w;r===s&&(r<=0?(t(1),g(10)):(t(Gg(r,-1)),g(Gg(s,1)))),r<=0&&t(Gg(s,-1)),s<=0&&g(Gg(r,1)),this.min=r,this.max=s}buildTicks(){let o=this.options,d={min:this._userMin,max:this._userMax},r=Hj(d,this);return o.bounds==="ticks"&&uT(r,this,"value"),o.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}getLabelForValue(o){return o===void 0?"0":W0(o,this.chart.options.locale,this.options.ticks.format)}configure(){let o=this.min;super.configure(),this._startValue=jm(o),this._valueRange=jm(this.max)-jm(o)}getPixelForValue(o){return(o===void 0||o===0)&&(o=this.min),o===null||isNaN(o)?NaN:this.getPixelForDecimal(o===this.min?0:(jm(o)-this._startValue)/this._valueRange)}getValueForPixel(o){let d=this.getDecimalForPixel(o);return Math.pow(10,this._startValue+d*this._valueRange)}};function sM(c){let o=c.ticks;if(o.display&&c.display){let d=cs(o.backdropPadding);return An(o.font&&o.font.size,Lo.font.size)+d.height}return 0}function Gj(c,o,d){return d=uo(d)?d:[d],{w:PP(c,o.string,d),h:d.length*o.lineHeight}}function UO(c,o,d,r,s){return c===r||c===s?{start:o-d/2,end:o+d/2}:c<r||c>s?{start:o-d,end:o}:{start:o,end:o+d}}function qj(c){let o={l:c.left+c._padding.left,r:c.right-c._padding.right,t:c.top+c._padding.top,b:c.bottom-c._padding.bottom},d=Object.assign({},o),r=[],s=[],t=c._pointLabels.length,g=c.options.pointLabels,w=g.centerPointLabels?ho/t:0;for(let M=0;M<t;M++){let F=g.setContext(c.getPointLabelContext(M));s[M]=F.padding;let N=c.getPointPosition(M,c.drawingArea+s[M],w),Q=xa(F.font),ae=Gj(c.ctx,Q,c._pointLabels[M]);r[M]=ae;let pe=El(c.getIndexAngle(M)+w),Te=Math.round(xw(pe)),Pe=UO(Te,N.x,ae.w,0,180),Re=UO(Te,N.y,ae.h,90,270);$j(d,o,pe,Pe,Re)}c.setCenterPoint(o.l-d.l,d.r-o.r,o.t-d.t,d.b-o.b),c._pointLabelItems=Xj(c,r,s)}function $j(c,o,d,r,s){let t=Math.abs(Math.sin(d)),g=Math.abs(Math.cos(d)),w=0,M=0;r.start<o.l?(w=(o.l-r.start)/t,c.l=Math.min(c.l,o.l-w)):r.end>o.r&&(w=(r.end-o.r)/t,c.r=Math.max(c.r,o.r+w)),s.start<o.t?(M=(o.t-s.start)/g,c.t=Math.min(c.t,o.t-M)):s.end>o.b&&(M=(s.end-o.b)/g,c.b=Math.max(c.b,o.b+M))}function Yj(c,o,d){let r=c.drawingArea,{extra:s,additionalAngle:t,padding:g,size:w}=d,M=c.getPointPosition(o,r+s+g,t),F=Math.round(xw(El(M.angle+ia))),N=Jj(M.y,w.h,F),Q=Qj(F),ae=Kj(M.x,w.w,Q);return{visible:!0,x:M.x,y:N,textAlign:Q,left:ae,top:N,right:ae+w.w,bottom:N+w.h}}function Zj(c,o){if(!o)return!0;let{left:d,top:r,right:s,bottom:t}=c;return!(hh({x:d,y:r},o)||hh({x:d,y:t},o)||hh({x:s,y:r},o)||hh({x:s,y:t},o))}function Xj(c,o,d){let r=[],s=c._pointLabels.length,t=c.options,{centerPointLabels:g,display:w}=t.pointLabels,M={extra:sM(t)/2,additionalAngle:g?ho/s:0},F;for(let N=0;N<s;N++){M.padding=d[N],M.size=o[N];let Q=Yj(c,N,M);r.push(Q),w==="auto"&&(Q.visible=Zj(Q,F),Q.visible&&(F=Q))}return r}function Qj(c){return c===0||c===180?"center":c<180?"left":"right"}function Kj(c,o,d){return d==="right"?c-=o:d==="center"&&(c-=o/2),c}function Jj(c,o,d){return d===90||d===270?c-=o/2:(d>270||d<90)&&(c-=o),c}function e8(c,o,d){let{left:r,top:s,right:t,bottom:g}=d,{backdropColor:w}=o;if(!pr(w)){let M=uf(o.borderRadius),F=cs(o.backdropPadding);c.fillStyle=w;let N=r-F.left,Q=s-F.top,ae=t-r+F.width,pe=g-s+F.height;Object.values(M).some(Te=>Te!==0)?(c.beginPath(),H0(c,{x:N,y:Q,w:ae,h:pe,radius:M}),c.fill()):c.fillRect(N,Q,ae,pe)}}function t8(c,o){let{ctx:d,options:{pointLabels:r}}=c;for(let s=o-1;s>=0;s--){let t=c._pointLabelItems[s];if(!t.visible)continue;let g=r.setContext(c.getPointLabelContext(s));e8(d,g,t);let w=xa(g.font),{x:M,y:F,textAlign:N}=t;df(d,c._pointLabels[s],M,F+w.lineHeight/2,w,{color:g.color,textAlign:N,textBaseline:"middle"})}}function p3(c,o,d,r){let{ctx:s}=c;if(d)s.arc(c.xCenter,c.yCenter,o,0,mo);else{let t=c.getPointPosition(0,o);s.moveTo(t.x,t.y);for(let g=1;g<r;g++)t=c.getPointPosition(g,o),s.lineTo(t.x,t.y)}}function i8(c,o,d,r,s){let t=c.ctx,g=o.circular,{color:w,lineWidth:M}=o;!g&&!r||!w||!M||d<0||(t.save(),t.strokeStyle=w,t.lineWidth=M,t.setLineDash(s.dash),t.lineDashOffset=s.dashOffset,t.beginPath(),p3(c,d,g,r),t.closePath(),t.stroke(),t.restore())}function n8(c,o,d){return Wm(c,{label:d,index:o,type:"pointLabel"})}var lM=class extends Y0{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:iv.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(o){return o},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(o){super(o),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let o=this._padding=cs(sM(this.options)/2),d=this.width=this.maxWidth-o.width,r=this.height=this.maxHeight-o.height;this.xCenter=Math.floor(this.left+d/2+o.left),this.yCenter=Math.floor(this.top+r/2+o.top),this.drawingArea=Math.floor(Math.min(d,r)/2)}determineDataLimits(){let{min:o,max:d}=this.getMinMax(!1);this.min=Fo(o)&&!isNaN(o)?o:0,this.max=Fo(d)&&!isNaN(d)?d:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/sM(this.options))}generateTickLabels(o){Y0.prototype.generateTickLabels.call(this,o),this._pointLabels=this.getLabels().map((d,r)=>{let s=so(this.options.pointLabels.callback,[d,r],this);return s||s===0?s:""}).filter((d,r)=>this.chart.getDataVisibility(r))}fit(){let o=this.options;o.display&&o.pointLabels.display?qj(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(o,d,r,s){this.xCenter+=Math.floor((o-d)/2),this.yCenter+=Math.floor((r-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(o,d,r,s))}getIndexAngle(o){let d=mo/(this._pointLabels.length||1),r=this.options.startAngle||0;return El(o*d+Qc(r))}getDistanceFromCenterForValue(o){if(pr(o))return NaN;let d=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-o)*d:(o-this.min)*d}getValueForDistanceFromCenter(o){if(pr(o))return NaN;let d=o/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-d:this.min+d}getPointLabelContext(o){let d=this._pointLabels||[];if(o>=0&&o<d.length){let r=d[o];return n8(this.getContext(),o,r)}}getPointPosition(o,d,r=0){let s=this.getIndexAngle(o)-ia+r;return{x:Math.cos(s)*d+this.xCenter,y:Math.sin(s)*d+this.yCenter,angle:s}}getPointPositionForValue(o,d){return this.getPointPosition(o,this.getDistanceFromCenterForValue(d))}getBasePosition(o){return this.getPointPositionForValue(o||0,this.getBaseValue())}getPointLabelPosition(o){let{left:d,top:r,right:s,bottom:t}=this._pointLabelItems[o];return{left:d,top:r,right:s,bottom:t}}drawBackground(){let{backgroundColor:o,grid:{circular:d}}=this.options;if(o){let r=this.ctx;r.save(),r.beginPath(),p3(this,this.getDistanceFromCenterForValue(this._endValue),d,this._pointLabels.length),r.closePath(),r.fillStyle=o,r.fill(),r.restore()}}drawGrid(){let o=this.ctx,d=this.options,{angleLines:r,grid:s,border:t}=d,g=this._pointLabels.length,w,M,F;if(d.pointLabels.display&&t8(this,g),s.display&&this.ticks.forEach((N,Q)=>{if(Q!==0||Q===0&&this.min<0){M=this.getDistanceFromCenterForValue(N.value);let ae=this.getContext(Q),pe=s.setContext(ae),Te=t.setContext(ae);i8(this,pe,M,g,Te)}}),r.display){for(o.save(),w=g-1;w>=0;w--){let N=r.setContext(this.getPointLabelContext(w)),{color:Q,lineWidth:ae}=N;!ae||!Q||(o.lineWidth=ae,o.strokeStyle=Q,o.setLineDash(N.borderDash),o.lineDashOffset=N.borderDashOffset,M=this.getDistanceFromCenterForValue(d.ticks.reverse?this.min:this.max),F=this.getPointPosition(w,M),o.beginPath(),o.moveTo(this.xCenter,this.yCenter),o.lineTo(F.x,F.y),o.stroke())}o.restore()}}drawBorder(){}drawLabels(){let o=this.ctx,d=this.options,r=d.ticks;if(!r.display)return;let s=this.getIndexAngle(0),t,g;o.save(),o.translate(this.xCenter,this.yCenter),o.rotate(s),o.textAlign="center",o.textBaseline="middle",this.ticks.forEach((w,M)=>{if(M===0&&this.min>=0&&!d.reverse)return;let F=r.setContext(this.getContext(M)),N=xa(F.font);if(t=this.getDistanceFromCenterForValue(this.ticks[M].value),F.showLabelBackdrop){o.font=N.string,g=o.measureText(w.label).width,o.fillStyle=F.backdropColor;let Q=cs(F.backdropPadding);o.fillRect(-g/2-Q.left,-t-N.size/2-Q.top,g+Q.width,N.size+Q.height)}df(o,w.label,0,-t,N,{color:F.color,strokeColor:F.textStrokeColor,strokeWidth:F.textStrokeWidth})}),o.restore()}drawTitle(){}},$w={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Pl=Object.keys($w);function WO(c,o){return c-o}function HO(c,o){if(pr(o))return null;let d=c._adapter,{parser:r,round:s,isoWeekday:t}=c._parseOpts,g=o;return typeof r=="function"&&(g=r(g)),Fo(g)||(g=typeof r=="string"?d.parse(g,r):d.parse(g)),g===null?null:(s&&(g=s==="week"&&(Ug(t)||t===!0)?d.startOf(g,"isoWeek",t):d.startOf(g,s)),+g)}function GO(c,o,d,r){let s=Pl.length;for(let t=Pl.indexOf(c);t<s-1;++t){let g=$w[Pl[t]],w=g.steps?g.steps:Number.MAX_SAFE_INTEGER;if(g.common&&Math.ceil((d-o)/(w*g.size))<=r)return Pl[t]}return Pl[s-1]}function r8(c,o,d,r,s){for(let t=Pl.length-1;t>=Pl.indexOf(d);t--){let g=Pl[t];if($w[g].common&&c._adapter.diff(s,r,g)>=o-1)return g}return Pl[d?Pl.indexOf(d):0]}function o8(c){for(let o=Pl.indexOf(c)+1,d=Pl.length;o<d;++o)if($w[Pl[o]].common)return Pl[o]}function qO(c,o,d){if(!d)c[o]=!0;else if(d.length){let{lo:r,hi:s}=ww(d,o),t=d[r]>=o?d[r]:d[s];c[t]=!0}}function a8(c,o,d,r){let s=c._adapter,t=+s.startOf(o[0].value,r),g=o[o.length-1].value,w,M;for(w=t;w<=g;w=+s.add(w,1,r))M=d[w],M>=0&&(o[M].major=!0);return o}function $O(c,o,d){let r=[],s={},t=o.length,g,w;for(g=0;g<t;++g)w=o[g],s[w]=g,r.push({value:w,major:!1});return t===0||!d?r:a8(c,r,s,d)}var cM=(()=>{class c extends qg{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(d){super(d),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(d,r={}){let s=d.time||(d.time={}),t=this._adapter=new bV._date(d.adapters.date);t.init(r),N0(s.displayFormats,t.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(d),this._normalized=r.normalized}parse(d,r){return d===void 0?null:HO(this,d)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let d=this.options,r=this._adapter,s=d.time.unit||"day",{min:t,max:g,minDefined:w,maxDefined:M}=this.getUserBounds();function F(N){!w&&!isNaN(N.min)&&(t=Math.min(t,N.min)),!M&&!isNaN(N.max)&&(g=Math.max(g,N.max))}(!w||!M)&&(F(this._getLabelBounds()),(d.bounds!=="ticks"||d.ticks.source!=="labels")&&F(this.getMinMax(!1))),t=Fo(t)&&!isNaN(t)?t:+r.startOf(Date.now(),s),g=Fo(g)&&!isNaN(g)?g:+r.endOf(Date.now(),s)+1,this.min=Math.min(t,g-1),this.max=Math.max(t+1,g)}_getLabelBounds(){let d=this.getLabelTimestamps(),r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return d.length&&(r=d[0],s=d[d.length-1]),{min:r,max:s}}buildTicks(){let d=this.options,r=d.time,s=d.ticks,t=s.source==="labels"?this.getLabelTimestamps():this._generate();d.bounds==="ticks"&&t.length&&(this.min=this._userMin||t[0],this.max=this._userMax||t[t.length-1]);let g=this.min,w=this.max,M=TP(t,g,w);return this._unit=r.unit||(s.autoSkip?GO(r.minUnit,this.min,this.max,this._getLabelCapacity(g)):r8(this,M.length,r.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:o8(this._unit),this.initOffsets(t),d.reverse&&M.reverse(),$O(this,M,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(d=>+d.value))}initOffsets(d=[]){let r=0,s=0,t,g;this.options.offset&&d.length&&(t=this.getDecimalForValue(d[0]),d.length===1?r=1-t:r=(this.getDecimalForValue(d[1])-t)/2,g=this.getDecimalForValue(d[d.length-1]),d.length===1?s=g:s=(g-this.getDecimalForValue(d[d.length-2]))/2);let w=d.length<3?.5:.25;r=Ra(r,0,w),s=Ra(s,0,w),this._offsets={start:r,end:s,factor:1/(r+1+s)}}_generate(){let d=this._adapter,r=this.min,s=this.max,t=this.options,g=t.time,w=g.unit||GO(g.minUnit,r,s,this._getLabelCapacity(r)),M=An(t.ticks.stepSize,1),F=w==="week"?g.isoWeekday:!1,N=Ug(F)||F===!0,Q={},ae=r,pe,Te;if(N&&(ae=+d.startOf(ae,"isoWeek",F)),ae=+d.startOf(ae,N?"day":w),d.diff(s,r,w)>1e5*M)throw new Error(r+" and "+s+" are too far apart with stepSize of "+M+" "+w);let Pe=t.ticks.source==="data"&&this.getDataTimestamps();for(pe=ae,Te=0;pe<s;pe=+d.add(pe,M,w),Te++)qO(Q,pe,Pe);return(pe===s||t.bounds==="ticks"||Te===1)&&qO(Q,pe,Pe),Object.keys(Q).sort(WO).map(Re=>+Re)}getLabelForValue(d){let r=this._adapter,s=this.options.time;return s.tooltipFormat?r.format(d,s.tooltipFormat):r.format(d,s.displayFormats.datetime)}format(d,r){let t=this.options.time.displayFormats,g=this._unit,w=r||t[g];return this._adapter.format(d,w)}_tickFormatFunction(d,r,s,t){let g=this.options,w=g.ticks.callback;if(w)return so(w,[d,r,s],this);let M=g.time.displayFormats,F=this._unit,N=this._majorUnit,Q=F&&M[F],ae=N&&M[N],pe=s[r],Te=N&&ae&&pe&&pe.major;return this._adapter.format(d,t||(Te?ae:Q))}generateTickLabels(d){let r,s,t;for(r=0,s=d.length;r<s;++r)t=d[r],t.label=this._tickFormatFunction(t.value,r,d)}getDecimalForValue(d){return d===null?NaN:(d-this.min)/(this.max-this.min)}getPixelForValue(d){let r=this._offsets,s=this.getDecimalForValue(d);return this.getPixelForDecimal((r.start+s)*r.factor)}getValueForPixel(d){let r=this._offsets,s=this.getDecimalForPixel(d)/r.factor-r.end;return this.min+s*(this.max-this.min)}_getLabelSize(d){let r=this.options.ticks,s=this.ctx.measureText(d).width,t=Qc(this.isHorizontal()?r.maxRotation:r.minRotation),g=Math.cos(t),w=Math.sin(t),M=this._resolveTickFontOptions(0).size;return{w:s*g+M*w,h:s*w+M*g}}_getLabelCapacity(d){let r=this.options.time,s=r.displayFormats,t=s[r.unit]||s.millisecond,g=this._tickFormatFunction(d,0,$O(this,[d],this._majorUnit),t),w=this._getLabelSize(g),M=Math.floor(this.isHorizontal()?this.width/w.w:this.height/w.h)-1;return M>0?M:1}getDataTimestamps(){let d=this._cache.data||[],r,s;if(d.length)return d;let t=this.getMatchingVisibleMetas();if(this._normalized&&t.length)return this._cache.data=t[0].controller.getAllParsedValues(this);for(r=0,s=t.length;r<s;++r)d=d.concat(t[r].controller.getAllParsedValues(this));return this._cache.data=this.normalize(d)}getLabelTimestamps(){let d=this._cache.labels||[],r,s;if(d.length)return d;let t=this.getLabels();for(r=0,s=t.length;r<s;++r)d.push(HO(this,t[r]));return this._cache.labels=this._normalized?d:this.normalize(d)}normalize(d){return fT(d.sort(WO))}}return c})();function zw(c,o,d){let r=0,s=c.length-1,t,g,w,M;d?(o>=c[r].pos&&o<=c[s].pos&&({lo:r,hi:s}=uh(c,"pos",o)),{pos:t,time:w}=c[r],{pos:g,time:M}=c[s]):(o>=c[r].time&&o<=c[s].time&&({lo:r,hi:s}=uh(c,"time",o)),{time:t,pos:w}=c[r],{time:g,pos:M}=c[s]);let F=g-t;return F?w+(M-w)*(o-t)/F:w}var dM=class extends cM{static id="timeseries";static defaults=cM.defaults;constructor(o){super(o),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let o=this._getTimestampsForTable(),d=this._table=this.buildLookupTable(o);this._minPos=zw(d,this.min),this._tableRange=zw(d,this.max)-this._minPos,super.initOffsets(o)}buildLookupTable(o){let{min:d,max:r}=this,s=[],t=[],g,w,M,F,N;for(g=0,w=o.length;g<w;++g)F=o[g],F>=d&&F<=r&&s.push(F);if(s.length<2)return[{time:d,pos:0},{time:r,pos:1}];for(g=0,w=s.length;g<w;++g)N=s[g+1],M=s[g-1],F=s[g],Math.round((N+M)/2)!==F&&t.push({time:F,pos:g/(w-1)});return t}_generate(){let o=this.min,d=this.max,r=super.getDataTimestamps();return(!r.includes(o)||!r.length)&&r.splice(0,0,o),(!r.includes(d)||r.length===1)&&r.push(d),r.sort((s,t)=>s-t)}_getTimestampsForTable(){let o=this._cache.all||[];if(o.length)return o;let d=this.getDataTimestamps(),r=this.getLabelTimestamps();return d.length&&r.length?o=this.normalize(d.concat(r)):o=d.length?d:r,o=this._cache.all=o,o}getDecimalForValue(o){return(zw(this._table,o)-this._minPos)/this._tableRange}getValueForPixel(o){let d=this._offsets,r=this.getDecimalForPixel(o)/d.factor-d.end;return zw(this._table,r*this._tableRange+this._minPos,!0)}},s8=Object.freeze({__proto__:null,CategoryScale:jj,LinearScale:oM,LogarithmicScale:aM,RadialLinearScale:lM,TimeScale:cM,TimeSeriesScale:dM}),Yw=[_V,W6,zj,s8];Z0.register(...Yw);var l8=["chartContainer"];function c8(c,o){if(c&1&&(U(0,"span",31),X(1,"\u20B9 \xA0"),U(2,"span"),X(3),W()()),c&2){let d=it();le(3),Xt(d.earn)}}Z0.register(...Yw);var f3=(()=>{let o=class o{constructor(r,s,t,g){this.http=r,this.router=s,this.userDetailsService=t,this.razorpayService=g,this.apiUrl=_n,this.earn=null,this.years=[],this.selectedYear=0,this.selectedMonth=0,this.months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.currentWeek=0,this.totalWeeks=0,this.allChartData=[],this.allLabelsData=[],this.dateRange="",this.packageImage="",this.packageName="";for(let w=2022;w<=2030;w++)this.years.push(w)}ngOnInit(){this.initializeChart(),this.loadDefaultEarnings(),this.getCredits(),this.getPackageDetails()}getCredits(){this.razorpayService.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits},error:r=>{console.log(r)}})}initializeChart(){let r=document.getElementById("MyChart");this.chart=new Z0(r,{type:"bar",data:{labels:[],datasets:[{data:[],backgroundColor:"limegreen",barPercentage:.8,categoryPercentage:.8}]},options:{aspectRatio:1.8,plugins:{tooltip:{enabled:!1}},scales:{y:{display:!1},x:{display:!0,grid:{display:!1}}}}}),this.chart.canvas.addEventListener("click",s=>{let t=this.chart.getElementsAtEventForMode(s,"nearest",{intersect:!0},!1);if(t.length>0){let g=t[0],w=this.chart.data.labels[g.index],M=this.chart.data.datasets[g.datasetIndex].data[g.index];this.earn=M}})}loadDefaultEarnings(){let r=new Date;this.selectedYear=r.getFullYear(),this.selectedMonth=r.getMonth(),this.updateChartData(this.selectedYear,this.selectedMonth)}onYearMonthChange(){this.selectedYear!==0&&this.selectedMonth!==0&&this.updateChartData(this.selectedYear,this.selectedMonth)}updateChartData(r,s){let t=localStorage.getItem("providerId"),g=`${this.apiUrl}providers/provider-earnings/get-earnings/${t}`;this.http.get(g).subscribe(w=>{console.log("API Response:",w);let F=w.sort((Q,ae)=>{let pe=new Date(Q.date),Te=new Date(ae.date);return pe.getTime()-Te.getTime()}).filter(Q=>{let ae=new Date(Q.date);return ae.getFullYear()===r&&ae.getMonth()===s});console.log("Filtered Data:",F);let N=this.transformData(F,r,s);this.allChartData=N.data,this.allLabelsData=N.labels,this.totalWeeks=Math.ceil(this.allChartData.length/7),this.currentWeek=0,this.displayCurrentWeek()},w=>{console.error(w)})}transformData(r,s,t){let g=new Date(s,t+1,0).getDate(),w=Array.from({length:g},(F,N)=>(N+1).toString()),M=new Array(g).fill(0);return r.forEach(F=>{let Q=new Date(F.date).getDate();M[Q-1]+=F.amount}),console.log("Transformed Data:",{labels:w,amounts:M}),{labels:w,data:M}}displayCurrentWeek(){let r=this.currentWeek*7,s=r+7,t=this.allLabelsData.slice(r,s),g=this.allChartData.slice(r,s);console.log("Week Labels:",t),console.log("Week Data:",g),this.chart.data.labels=t,this.chart.data.datasets[0].data=g,this.chart.update(),this.updateDateRange(t)}updateDateRange(r){if(r.length>0){let s=this.selectedYear,t=this.selectedMonth,g=new Date(s,t,parseInt(r[0])),w=new Date(s,t,parseInt(r[r.length-1]));this.dateRange=`${g.toDateString()} - ${w.toDateString()}`}else this.dateRange=""}getPackageDetails(){this.userDetailsService.getBuyedPackage().subscribe({next:r=>{console.log(r),this.packageImage=r[0].image,this.packageName=r[0].packageName},error:r=>{console.log(r)}})}previousWeek(){this.earn=null,this.currentWeek>0?this.currentWeek--:this.navigateMonth("previous"),this.displayCurrentWeek()}nextWeek(){this.earn=null,this.currentWeek<this.totalWeeks-1?this.currentWeek++:this.navigateMonth("next"),this.displayCurrentWeek()}navigateMonth(r){r==="previous"?this.selectedMonth===0?Number(this.selectedYear)>this.years[0]&&(this.selectedYear--,this.selectedMonth=11):this.selectedMonth--:this.selectedMonth===11?this.selectedYear<this.years[this.years.length-1]&&(this.selectedYear++,this.selectedMonth=0):this.selectedMonth++,this.updateChartData(this.selectedYear,this.selectedMonth)}navToCredit(){this.router.navigate(["credits"])}navToMenu(){this.router.navigate(["menu"])}navToPackage(){this.router.navigate(["packages"])}};o.\u0275fac=function(s){return new(s||o)(_e(ji),_e(ii),_e(nr),_e(ks))},o.\u0275cmp=Et({type:o,selectors:[["app-earnings"]],viewQuery:function(s,t){if(s&1&&Vi(l8,5),s&2){let g;zi(g=Bi())&&(t.chartContainer=g.first)}},decls:75,vars:13,consts:[["chartContainer",""],[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell"],[1,"material-symbols-outlined","notranslate"],[1,"sub-container"],[1,"chart-container"],[1,"chart-navigation"],[2,"font-size","36px",3,"click"],[1,"date-range"],[1,"scroll-container"],["class","icon2",4,"ngIf"],["id","MyChart"],[1,"bank-transfer"],[1,"middle-text"],[1,"withdraw-div"],[1,"big-text"],[1,"credit-div"],[1,"icon-credit"],[1,"icon"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],[1,"credit1"],[1,"title"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"credit-div",3,"click"],[1,"package"],[1,"package-img",3,"src"],[2,"height","5rem"],[1,"icon2"]],template:function(s,t){if(s&1){let g=ai();U(0,"div",1)(1,"div",2),Ne("click",function(){return St(g),It(t.navToMenu())}),X(2,"\u2630"),W(),U(3,"div",3)(4,"div",4),Ne("click",function(){return St(g),It(t.navToCredit())}),Oe(5,"img",5),U(6,"pre"),X(7),wl(8,"number"),W()(),U(9,"div",6)(10,"span",7),X(11,"notifications"),W()()(),U(12,"div",8)(13,"div",9)(14,"div",10)(15,"span",11),Ne("click",function(){return St(g),It(t.previousWeek())}),X(16,"	<"),W(),U(17,"p",12),X(18),W(),U(19,"span",11),Ne("click",function(){return St(g),It(t.nextWeek())}),X(20,">"),W()(),U(21,"div",13,0),qt(23,c8,4,1,"span",14),Oe(24,"br")(25,"br"),U(26,"canvas",15),X(27),W()()(),U(28,"div")(29,"div",16)(30,"span",17),X(31,"Bank transfer"),W(),U(32,"span",7),X(33,"chevron_right"),W()(),Oe(34,"br"),U(35,"div",18)(36,"div")(37,"span",19),X(38,"\u20B9 1897"),W(),U(39,"span",17),X(40,"28-29 Mar"),W(),U(41,"span",17),X(42,"Upcoming"),W()(),U(43,"div")(44,"span",19),X(45,"\u20B9 176"),W(),U(46,"span",17),X(47,"26-27 Mar"),W(),U(48,"span",17),X(49,"Success"),W()()()(),U(50,"div",20)(51,"div",21)(52,"div",22)(53,"span",23),X(54,"poker_chip"),W()(),X(55," \xA0 \xA0 "),U(56,"div",24)(57,"span",25),X(58,"Credits"),W(),U(59,"span",25),X(60),wl(61,"number"),W()()(),U(62,"span",26),Ne("click",function(){return St(g),It(t.navToCredit())}),X(63,"chevron_right"),W()(),U(64,"div",27),Ne("click",function(){return St(g),It(t.navToPackage())}),U(65,"div",21)(66,"span",28),Oe(67,"img",29),X(68,"\xA0 "),U(69,"pre"),X(70),W()()(),U(71,"span",26),Ne("click",function(){return St(g),It(t.navToPackage())}),X(72,"chevron_right"),W()()()(),Oe(73,"div",30)(74,"app-fotter")}s&2&&(le(7),Xt(t.credits%1===0?t.credits:Cl(8,7,t.credits,"1.2-2")),le(11),Xt(t.dateRange),le(5),ze("ngIf",t.earn!=null),le(4),Xt(t.chart),le(33),Xt(t.credits%1===0?t.credits:Cl(61,10,t.credits,"1.2-2")),le(7),ze("src",t.packageImage,vr),le(3),Xt(t.packageName))},dependencies:[$n,dh,Gc],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100%;height:100%}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#d16611;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:8rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:5rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border-radius:.4rem;border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh;display:grid;row-gap:2rem}.chart-container[_ngcontent-%COMP%]{width:100%;height:fit-content;display:grid;row-gap:1rem;box-shadow:0 5px 5px #00000080;border-radius:.5rem}.scroll-container[_ngcontent-%COMP%]{position:relative;width:100%;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}#MyChart[_ngcontent-%COMP%]{background-color:#d6ffdf3b;width:100%;display:inline-block;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none;min-width:100%}.chart-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .chart-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{float:left;text-align:left}.icon2[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.8rem;font-weight:500;line-height:24.2px;color:#49a010;float:left;text-align:left;display:flex;margin-left:1rem}.earning-tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:24.2px;float:left;text-align:left}.bank-transfer[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.withdraw-div[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:49% 49%;column-gap:2%}.withdraw-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:grid;padding:1rem;row-gap:0;height:120px;border:.25px solid black;border-radius:.5rem}.credit-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;height:2rem}.icon[_ngcontent-%COMP%]{width:2rem;height:2rem;border-radius:.4rem;border:.25px solid black}.icon-credit[_ngcontent-%COMP%]{display:flex;width:30%;height:2rem}.credit1[_ngcontent-%COMP%]{display:grid;border:none;justify-content:space-around}.rank[_ngcontent-%COMP%]{display:grid;float:left;text-align:left}.title[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:22.94px}.middle-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px}.big-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:20px;font-weight:600;line-height:19.36px}.date-div[_ngcontent-%COMP%]{width:100%;display:flex;column-gap:.5rem}.date-div[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:10rem;height:2rem;border:.25px solid black}.chart-navigation[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.date-range[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"inter" sans-serif;font-weight:500}.package[_ngcontent-%COMP%]{width:max-content;height:2rem;padding:0 .3rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.package-img[_ngcontent-%COMP%]{width:1.3rem;height:1.3rem}.package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1rem;line-height:1.7rem}']});let c=o;return c})();var g3=(()=>{let o=class o{constructor(r){this.router=r}navToHome(){this.router.navigate(["home"])}};o.\u0275fac=function(s){return new(s||o)(_e(ii))},o.\u0275cmp=Et({type:o,selectors:[["app-waiting-page"]],decls:10,vars:0,consts:[[1,"container"],[1,"sub-container"],["src","assets/new/Man playing Basketball.gif"],[3,"click"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"div"),Oe(3,"img",2)(4,"br")(5,"br"),U(6,"p"),X(7,"Thanks for uploading your documents, your documents are under review. We will let you once you ready to work."),W()()(),U(8,"button",3),Ne("click",function(){return t.navToHome()}),X(9,"Next"),W()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:3rem}.sub-container[_ngcontent-%COMP%]{width:80%;margin-top:-5rem;height:max-content;display:grid;align-items:center}.sub-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column}.sub-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60%;height:60%}p[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:16.94px;text-align:center;color:#00000080}button[_ngcontent-%COMP%]{width:90%;height:2.5rem;background:#d16611;color:#f0f8ff;font-size:1.1rem;font-weight:400;line-height:16.94px;border:none;border-radius:.5rem}']});let c=o;return c})();var _3=(()=>{let o=class o{constructor(r){this.router=r}};o.\u0275fac=function(s){return new(s||o)(_e(ii))},o.\u0275cmp=Et({type:o,selectors:[["app-notification"]],decls:2,vars:0,template:function(s,t){s&1&&(U(0,"p"),X(1,"notification works!"),W())}});let c=o;return c})();var d8=Math.pow(10,8)*24*60*60*1e3,fZ=-d8,Zw=6048e5,b3=864e5,y3=6e4,v3=36e5,x3=1e3;var u8=3600;var w3=u8*24,gZ=w3*7,h8=w3*365.2425,m8=h8/12,_Z=m8*3,mM=Symbol.for("constructDateFrom");function xr(c,o){return typeof c=="function"?c(o):c&&typeof c=="object"&&mM in c?c[mM](o):c instanceof Date?new c.constructor(o):new Date(o)}function Yn(c,o){return xr(o||c,c)}function Xw(c,o,d){let r=Yn(c,d?.in);return isNaN(o)?xr(d?.in||c,NaN):(o&&r.setDate(r.getDate()+o),r)}var p8={};function Kc(){return p8}function Ol(c,o){let d=Kc(),r=o?.weekStartsOn??o?.locale?.options?.weekStartsOn??d.weekStartsOn??d.locale?.options?.weekStartsOn??0,s=Yn(c,o?.in),t=s.getDay(),g=(t<r?7:0)+t-r;return s.setDate(s.getDate()-g),s.setHours(0,0,0,0),s}function Qd(c,o){return Ol(c,yl(Dn({},o),{weekStartsOn:1}))}function Qw(c,o){let d=Yn(c,o?.in),r=d.getFullYear(),s=xr(d,0);s.setFullYear(r+1,0,4),s.setHours(0,0,0,0);let t=Qd(s),g=xr(d,0);g.setFullYear(r,0,4),g.setHours(0,0,0,0);let w=Qd(g);return d.getTime()>=t.getTime()?r+1:d.getTime()>=w.getTime()?r:r-1}function $g(c){let o=Yn(c),d=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds()));return d.setUTCFullYear(o.getFullYear()),+c-+d}function C3(c,...o){let d=xr.bind(null,c||o.find(r=>typeof r=="object"));return o.map(d)}function pM(c,o){let d=Yn(c,o?.in);return d.setHours(0,0,0,0),d}function S3(c,o,d){let[r,s]=C3(d?.in,c,o),t=pM(r),g=pM(s),w=+t-$g(t),M=+g-$g(g);return Math.round((w-M)/b3)}function I3(c,o){let d=Qw(c,o),r=xr(o?.in||c,0);return r.setFullYear(d,0,4),r.setHours(0,0,0,0),Qd(r)}function T3(c){return c instanceof Date||typeof c=="object"&&Object.prototype.toString.call(c)==="[object Date]"}function M3(c){return!(!T3(c)&&typeof c!="number"||isNaN(+Yn(c)))}function k3(c,o){let d=Yn(c,o?.in);return d.setFullYear(d.getFullYear(),0,1),d.setHours(0,0,0,0),d}var f8={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},E3=(c,o,d)=>{let r,s=f8[c];return typeof s=="string"?r=s:o===1?r=s.one:r=s.other.replace("{{count}}",o.toString()),d?.addSuffix?d.comparison&&d.comparison>0?"in "+r:r+" ago":r};function Kw(c){return(o={})=>{let d=o.width?String(o.width):c.defaultWidth;return c.formats[d]||c.formats[c.defaultWidth]}}var g8={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},_8={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},b8={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},D3={date:Kw({formats:g8,defaultWidth:"full"}),time:Kw({formats:_8,defaultWidth:"full"}),dateTime:Kw({formats:b8,defaultWidth:"full"})};var y8={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},A3=(c,o,d,r)=>y8[c];function X0(c){return(o,d)=>{let r=d?.context?String(d.context):"standalone",s;if(r==="formatting"&&c.formattingValues){let g=c.defaultFormattingWidth||c.defaultWidth,w=d?.width?String(d.width):g;s=c.formattingValues[w]||c.formattingValues[g]}else{let g=c.defaultWidth,w=d?.width?String(d.width):c.defaultWidth;s=c.values[w]||c.values[g]}let t=c.argumentCallback?c.argumentCallback(o):o;return s[t]}}var v8={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},x8={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},w8={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},C8={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},S8={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},I8={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},T8=(c,o)=>{let d=Number(c),r=d%100;if(r>20||r<10)switch(r%10){case 1:return d+"st";case 2:return d+"nd";case 3:return d+"rd"}return d+"th"},P3={ordinalNumber:T8,era:X0({values:v8,defaultWidth:"wide"}),quarter:X0({values:x8,defaultWidth:"wide",argumentCallback:c=>c-1}),month:X0({values:w8,defaultWidth:"wide"}),day:X0({values:C8,defaultWidth:"wide"}),dayPeriod:X0({values:S8,defaultWidth:"wide",formattingValues:I8,defaultFormattingWidth:"wide"})};function Q0(c){return(o,d={})=>{let r=d.width,s=r&&c.matchPatterns[r]||c.matchPatterns[c.defaultMatchWidth],t=o.match(s);if(!t)return null;let g=t[0],w=r&&c.parsePatterns[r]||c.parsePatterns[c.defaultParseWidth],M=Array.isArray(w)?k8(w,Q=>Q.test(g)):M8(w,Q=>Q.test(g)),F;F=c.valueCallback?c.valueCallback(M):M,F=d.valueCallback?d.valueCallback(F):F;let N=o.slice(g.length);return{value:F,rest:N}}}function M8(c,o){for(let d in c)if(Object.prototype.hasOwnProperty.call(c,d)&&o(c[d]))return d}function k8(c,o){for(let d=0;d<c.length;d++)if(o(c[d]))return d}function O3(c){return(o,d={})=>{let r=o.match(c.matchPattern);if(!r)return null;let s=r[0],t=o.match(c.parsePattern);if(!t)return null;let g=c.valueCallback?c.valueCallback(t[0]):t[0];g=d.valueCallback?d.valueCallback(g):g;let w=o.slice(s.length);return{value:g,rest:w}}}var E8=/^(\d+)(th|st|nd|rd)?/i,D8=/\d+/i,A8={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},P8={any:[/^b/i,/^(a|c)/i]},O8={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},R8={any:[/1/i,/2/i,/3/i,/4/i]},F8={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},L8={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},z8={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},B8={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},N8={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},V8={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},R3={ordinalNumber:O3({matchPattern:E8,parsePattern:D8,valueCallback:c=>parseInt(c,10)}),era:Q0({matchPatterns:A8,defaultMatchWidth:"wide",parsePatterns:P8,defaultParseWidth:"any"}),quarter:Q0({matchPatterns:O8,defaultMatchWidth:"wide",parsePatterns:R8,defaultParseWidth:"any",valueCallback:c=>c+1}),month:Q0({matchPatterns:F8,defaultMatchWidth:"wide",parsePatterns:L8,defaultParseWidth:"any"}),day:Q0({matchPatterns:z8,defaultMatchWidth:"wide",parsePatterns:B8,defaultParseWidth:"any"}),dayPeriod:Q0({matchPatterns:N8,defaultMatchWidth:"any",parsePatterns:V8,defaultParseWidth:"any"})};var gv={code:"en-US",formatDistance:E3,formatLong:D3,formatRelative:A3,localize:P3,match:R3,options:{weekStartsOn:0,firstWeekContainsDate:1}};function F3(c,o){let d=Yn(c,o?.in);return S3(d,k3(d))+1}function Jw(c,o){let d=Yn(c,o?.in),r=+Qd(d)-+I3(d);return Math.round(r/Zw)+1}function K0(c,o){let d=Yn(c,o?.in),r=d.getFullYear(),s=Kc(),t=o?.firstWeekContainsDate??o?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,g=xr(o?.in||c,0);g.setFullYear(r+1,0,t),g.setHours(0,0,0,0);let w=Ol(g,o),M=xr(o?.in||c,0);M.setFullYear(r,0,t),M.setHours(0,0,0,0);let F=Ol(M,o);return+d>=+w?r+1:+d>=+F?r:r-1}function L3(c,o){let d=Kc(),r=o?.firstWeekContainsDate??o?.locale?.options?.firstWeekContainsDate??d.firstWeekContainsDate??d.locale?.options?.firstWeekContainsDate??1,s=K0(c,o),t=xr(o?.in||c,0);return t.setFullYear(s,0,r),t.setHours(0,0,0,0),Ol(t,o)}function eC(c,o){let d=Yn(c,o?.in),r=+Ol(d,o)-+L3(d,o);return Math.round(r/Zw)+1}function Rr(c,o){let d=c<0?"-":"",r=Math.abs(c).toString().padStart(o,"0");return d+r}var qm={y(c,o){let d=c.getFullYear(),r=d>0?d:1-d;return Rr(o==="yy"?r%100:r,o.length)},M(c,o){let d=c.getMonth();return o==="M"?String(d+1):Rr(d+1,2)},d(c,o){return Rr(c.getDate(),o.length)},a(c,o){let d=c.getHours()/12>=1?"pm":"am";switch(o){case"a":case"aa":return d.toUpperCase();case"aaa":return d;case"aaaaa":return d[0];case"aaaa":default:return d==="am"?"a.m.":"p.m."}},h(c,o){return Rr(c.getHours()%12||12,o.length)},H(c,o){return Rr(c.getHours(),o.length)},m(c,o){return Rr(c.getMinutes(),o.length)},s(c,o){return Rr(c.getSeconds(),o.length)},S(c,o){let d=o.length,r=c.getMilliseconds(),s=Math.trunc(r*Math.pow(10,d-3));return Rr(s,o.length)}};var J0={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},fM={G:function(c,o,d){let r=c.getFullYear()>0?1:0;switch(o){case"G":case"GG":case"GGG":return d.era(r,{width:"abbreviated"});case"GGGGG":return d.era(r,{width:"narrow"});case"GGGG":default:return d.era(r,{width:"wide"})}},y:function(c,o,d){if(o==="yo"){let r=c.getFullYear(),s=r>0?r:1-r;return d.ordinalNumber(s,{unit:"year"})}return qm.y(c,o)},Y:function(c,o,d,r){let s=K0(c,r),t=s>0?s:1-s;if(o==="YY"){let g=t%100;return Rr(g,2)}return o==="Yo"?d.ordinalNumber(t,{unit:"year"}):Rr(t,o.length)},R:function(c,o){let d=Qw(c);return Rr(d,o.length)},u:function(c,o){let d=c.getFullYear();return Rr(d,o.length)},Q:function(c,o,d){let r=Math.ceil((c.getMonth()+1)/3);switch(o){case"Q":return String(r);case"QQ":return Rr(r,2);case"Qo":return d.ordinalNumber(r,{unit:"quarter"});case"QQQ":return d.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return d.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return d.quarter(r,{width:"wide",context:"formatting"})}},q:function(c,o,d){let r=Math.ceil((c.getMonth()+1)/3);switch(o){case"q":return String(r);case"qq":return Rr(r,2);case"qo":return d.ordinalNumber(r,{unit:"quarter"});case"qqq":return d.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return d.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return d.quarter(r,{width:"wide",context:"standalone"})}},M:function(c,o,d){let r=c.getMonth();switch(o){case"M":case"MM":return qm.M(c,o);case"Mo":return d.ordinalNumber(r+1,{unit:"month"});case"MMM":return d.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return d.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return d.month(r,{width:"wide",context:"formatting"})}},L:function(c,o,d){let r=c.getMonth();switch(o){case"L":return String(r+1);case"LL":return Rr(r+1,2);case"Lo":return d.ordinalNumber(r+1,{unit:"month"});case"LLL":return d.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return d.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return d.month(r,{width:"wide",context:"standalone"})}},w:function(c,o,d,r){let s=eC(c,r);return o==="wo"?d.ordinalNumber(s,{unit:"week"}):Rr(s,o.length)},I:function(c,o,d){let r=Jw(c);return o==="Io"?d.ordinalNumber(r,{unit:"week"}):Rr(r,o.length)},d:function(c,o,d){return o==="do"?d.ordinalNumber(c.getDate(),{unit:"date"}):qm.d(c,o)},D:function(c,o,d){let r=F3(c);return o==="Do"?d.ordinalNumber(r,{unit:"dayOfYear"}):Rr(r,o.length)},E:function(c,o,d){let r=c.getDay();switch(o){case"E":case"EE":case"EEE":return d.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return d.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return d.day(r,{width:"short",context:"formatting"});case"EEEE":default:return d.day(r,{width:"wide",context:"formatting"})}},e:function(c,o,d,r){let s=c.getDay(),t=(s-r.weekStartsOn+8)%7||7;switch(o){case"e":return String(t);case"ee":return Rr(t,2);case"eo":return d.ordinalNumber(t,{unit:"day"});case"eee":return d.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return d.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return d.day(s,{width:"short",context:"formatting"});case"eeee":default:return d.day(s,{width:"wide",context:"formatting"})}},c:function(c,o,d,r){let s=c.getDay(),t=(s-r.weekStartsOn+8)%7||7;switch(o){case"c":return String(t);case"cc":return Rr(t,o.length);case"co":return d.ordinalNumber(t,{unit:"day"});case"ccc":return d.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return d.day(s,{width:"narrow",context:"standalone"});case"cccccc":return d.day(s,{width:"short",context:"standalone"});case"cccc":default:return d.day(s,{width:"wide",context:"standalone"})}},i:function(c,o,d){let r=c.getDay(),s=r===0?7:r;switch(o){case"i":return String(s);case"ii":return Rr(s,o.length);case"io":return d.ordinalNumber(s,{unit:"day"});case"iii":return d.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return d.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return d.day(r,{width:"short",context:"formatting"});case"iiii":default:return d.day(r,{width:"wide",context:"formatting"})}},a:function(c,o,d){let s=c.getHours()/12>=1?"pm":"am";switch(o){case"a":case"aa":return d.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return d.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return d.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return d.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(c,o,d){let r=c.getHours(),s;switch(r===12?s=J0.noon:r===0?s=J0.midnight:s=r/12>=1?"pm":"am",o){case"b":case"bb":return d.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return d.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return d.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return d.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(c,o,d){let r=c.getHours(),s;switch(r>=17?s=J0.evening:r>=12?s=J0.afternoon:r>=4?s=J0.morning:s=J0.night,o){case"B":case"BB":case"BBB":return d.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return d.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return d.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(c,o,d){if(o==="ho"){let r=c.getHours()%12;return r===0&&(r=12),d.ordinalNumber(r,{unit:"hour"})}return qm.h(c,o)},H:function(c,o,d){return o==="Ho"?d.ordinalNumber(c.getHours(),{unit:"hour"}):qm.H(c,o)},K:function(c,o,d){let r=c.getHours()%12;return o==="Ko"?d.ordinalNumber(r,{unit:"hour"}):Rr(r,o.length)},k:function(c,o,d){let r=c.getHours();return r===0&&(r=24),o==="ko"?d.ordinalNumber(r,{unit:"hour"}):Rr(r,o.length)},m:function(c,o,d){return o==="mo"?d.ordinalNumber(c.getMinutes(),{unit:"minute"}):qm.m(c,o)},s:function(c,o,d){return o==="so"?d.ordinalNumber(c.getSeconds(),{unit:"second"}):qm.s(c,o)},S:function(c,o){return qm.S(c,o)},X:function(c,o,d){let r=c.getTimezoneOffset();if(r===0)return"Z";switch(o){case"X":return B3(r);case"XXXX":case"XX":return Yg(r);case"XXXXX":case"XXX":default:return Yg(r,":")}},x:function(c,o,d){let r=c.getTimezoneOffset();switch(o){case"x":return B3(r);case"xxxx":case"xx":return Yg(r);case"xxxxx":case"xxx":default:return Yg(r,":")}},O:function(c,o,d){let r=c.getTimezoneOffset();switch(o){case"O":case"OO":case"OOO":return"GMT"+z3(r,":");case"OOOO":default:return"GMT"+Yg(r,":")}},z:function(c,o,d){let r=c.getTimezoneOffset();switch(o){case"z":case"zz":case"zzz":return"GMT"+z3(r,":");case"zzzz":default:return"GMT"+Yg(r,":")}},t:function(c,o,d){let r=Math.trunc(+c/1e3);return Rr(r,o.length)},T:function(c,o,d){return Rr(+c,o.length)}};function z3(c,o=""){let d=c>0?"-":"+",r=Math.abs(c),s=Math.trunc(r/60),t=r%60;return t===0?d+String(s):d+String(s)+o+Rr(t,2)}function B3(c,o){return c%60===0?(c>0?"-":"+")+Rr(Math.abs(c)/60,2):Yg(c,o)}function Yg(c,o=""){let d=c>0?"-":"+",r=Math.abs(c),s=Rr(Math.trunc(r/60),2),t=Rr(r%60,2);return d+s+o+t}var N3=(c,o)=>{switch(c){case"P":return o.date({width:"short"});case"PP":return o.date({width:"medium"});case"PPP":return o.date({width:"long"});case"PPPP":default:return o.date({width:"full"})}},V3=(c,o)=>{switch(c){case"p":return o.time({width:"short"});case"pp":return o.time({width:"medium"});case"ppp":return o.time({width:"long"});case"pppp":default:return o.time({width:"full"})}},j8=(c,o)=>{let d=c.match(/(P+)(p+)?/)||[],r=d[1],s=d[2];if(!s)return N3(c,o);let t;switch(r){case"P":t=o.dateTime({width:"short"});break;case"PP":t=o.dateTime({width:"medium"});break;case"PPP":t=o.dateTime({width:"long"});break;case"PPPP":default:t=o.dateTime({width:"full"});break}return t.replace("{{date}}",N3(r,o)).replace("{{time}}",V3(s,o))},_v={p:V3,P:j8};var U8=/^D+$/,W8=/^Y+$/,H8=["D","DD","YY","YYYY"];function tC(c){return U8.test(c)}function iC(c){return W8.test(c)}function bv(c,o,d){let r=G8(c,o,d);if(console.warn(r),H8.includes(c))throw new RangeError(r)}function G8(c,o,d){let r=c[0]==="Y"?"years":"days of the month";return`Use \`${c.toLowerCase()}\` instead of \`${c}\` (in \`${o}\`) for formatting ${r} to the input \`${d}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}var q8=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,$8=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Y8=/^'([^]*?)'?$/,Z8=/''/g,X8=/[a-zA-Z]/;function nC(c,o,d){let r=Kc(),s=d?.locale??r.locale??gv,t=d?.firstWeekContainsDate??d?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,g=d?.weekStartsOn??d?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,w=Yn(c,d?.in);if(!M3(w))throw new RangeError("Invalid time value");let M=o.match($8).map(N=>{let Q=N[0];if(Q==="p"||Q==="P"){let ae=_v[Q];return ae(N,s.formatLong)}return N}).join("").match(q8).map(N=>{if(N==="''")return{isToken:!1,value:"'"};let Q=N[0];if(Q==="'")return{isToken:!1,value:Q8(N)};if(fM[Q])return{isToken:!0,value:N};if(Q.match(X8))throw new RangeError("Format string contains an unescaped latin alphabet character `"+Q+"`");return{isToken:!1,value:N}});s.localize.preprocessor&&(M=s.localize.preprocessor(w,M));let F={firstWeekContainsDate:t,weekStartsOn:g,locale:s};return M.map(N=>{if(!N.isToken)return N.value;let Q=N.value;(!d?.useAdditionalWeekYearTokens&&iC(Q)||!d?.useAdditionalDayOfYearTokens&&tC(Q))&&bv(Q,o,String(c));let ae=fM[Q[0]];return ae(w,Q,s.localize,F)}).join("")}function Q8(c){let o=c.match(Y8);return o?o[1].replace(Z8,"'"):c}function j3(){return Object.assign({},Kc())}function U3(c,o){let d=Yn(c,o?.in).getDay();return d===0?7:d}function W3(c,o){let d=K8(o)?new o(0):xr(o,0);return d.setFullYear(c.getFullYear(),c.getMonth(),c.getDate()),d.setHours(c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds()),d}function K8(c){return typeof c=="function"&&c.prototype?.constructor===c}var J8=10,rC=class{subPriority=0;validate(o,d){return!0}},oC=class extends rC{constructor(o,d,r,s,t){super(),this.value=o,this.validateValue=d,this.setValue=r,this.priority=s,t&&(this.subPriority=t)}validate(o,d){return this.validateValue(o,this.value,d)}set(o,d,r){return this.setValue(o,d,this.value,r)}},aC=class extends rC{priority=J8;subPriority=-1;constructor(o,d){super(),this.context=o||(r=>xr(d,r))}set(o,d){return d.timestampIsSet?o:xr(o,W3(o,this.context))}};var Ci=class{run(o,d,r,s){let t=this.parse(o,d,r,s);return t?{setter:new oC(t.value,this.validate,this.set,this.priority,this.subPriority),rest:t.rest}:null}validate(o,d,r){return!0}};var sC=class extends Ci{priority=140;parse(o,d,r){switch(d){case"G":case"GG":case"GGG":return r.era(o,{width:"abbreviated"})||r.era(o,{width:"narrow"});case"GGGGG":return r.era(o,{width:"narrow"});case"GGGG":default:return r.era(o,{width:"wide"})||r.era(o,{width:"abbreviated"})||r.era(o,{width:"narrow"})}}set(o,d,r){return d.era=r,o.setFullYear(r,0,1),o.setHours(0,0,0,0),o}incompatibleTokens=["R","u","t","T"]};var fr={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Jc={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function Hr(c,o){return c&&{value:o(c.value),rest:c.rest}}function sr(c,o){let d=o.match(c);return d?{value:parseInt(d[0],10),rest:o.slice(d[0].length)}:null}function ed(c,o){let d=o.match(c);if(!d)return null;if(d[0]==="Z")return{value:0,rest:o.slice(1)};let r=d[1]==="+"?1:-1,s=d[2]?parseInt(d[2],10):0,t=d[3]?parseInt(d[3],10):0,g=d[5]?parseInt(d[5],10):0;return{value:r*(s*v3+t*y3+g*x3),rest:o.slice(d[0].length)}}function lC(c){return sr(fr.anyDigitsSigned,c)}function Rn(c,o){switch(c){case 1:return sr(fr.singleDigit,o);case 2:return sr(fr.twoDigits,o);case 3:return sr(fr.threeDigits,o);case 4:return sr(fr.fourDigits,o);default:return sr(new RegExp("^\\d{1,"+c+"}"),o)}}function eb(c,o){switch(c){case 1:return sr(fr.singleDigitSigned,o);case 2:return sr(fr.twoDigitsSigned,o);case 3:return sr(fr.threeDigitsSigned,o);case 4:return sr(fr.fourDigitsSigned,o);default:return sr(new RegExp("^-?\\d{1,"+c+"}"),o)}}function tb(c){switch(c){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function cC(c,o){let d=o>0,r=d?o:1-o,s;if(r<=50)s=c||100;else{let t=r+50,g=Math.trunc(t/100)*100,w=c>=t%100;s=c+g-(w?100:0)}return d?s:1-s}function dC(c){return c%400===0||c%4===0&&c%100!==0}var uC=class extends Ci{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(o,d,r){let s=t=>({year:t,isTwoDigitYear:d==="yy"});switch(d){case"y":return Hr(Rn(4,o),s);case"yo":return Hr(r.ordinalNumber(o,{unit:"year"}),s);default:return Hr(Rn(d.length,o),s)}}validate(o,d){return d.isTwoDigitYear||d.year>0}set(o,d,r){let s=o.getFullYear();if(r.isTwoDigitYear){let g=cC(r.year,s);return o.setFullYear(g,0,1),o.setHours(0,0,0,0),o}let t=!("era"in d)||d.era===1?r.year:1-r.year;return o.setFullYear(t,0,1),o.setHours(0,0,0,0),o}};var hC=class extends Ci{priority=130;parse(o,d,r){let s=t=>({year:t,isTwoDigitYear:d==="YY"});switch(d){case"Y":return Hr(Rn(4,o),s);case"Yo":return Hr(r.ordinalNumber(o,{unit:"year"}),s);default:return Hr(Rn(d.length,o),s)}}validate(o,d){return d.isTwoDigitYear||d.year>0}set(o,d,r,s){let t=K0(o,s);if(r.isTwoDigitYear){let w=cC(r.year,t);return o.setFullYear(w,0,s.firstWeekContainsDate),o.setHours(0,0,0,0),Ol(o,s)}let g=!("era"in d)||d.era===1?r.year:1-r.year;return o.setFullYear(g,0,s.firstWeekContainsDate),o.setHours(0,0,0,0),Ol(o,s)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]};var mC=class extends Ci{priority=130;parse(o,d){return d==="R"?eb(4,o):eb(d.length,o)}set(o,d,r){let s=xr(o,0);return s.setFullYear(r,0,4),s.setHours(0,0,0,0),Qd(s)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]};var pC=class extends Ci{priority=130;parse(o,d){return d==="u"?eb(4,o):eb(d.length,o)}set(o,d,r){return o.setFullYear(r,0,1),o.setHours(0,0,0,0),o}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]};var fC=class extends Ci{priority=120;parse(o,d,r){switch(d){case"Q":case"QQ":return Rn(d.length,o);case"Qo":return r.ordinalNumber(o,{unit:"quarter"});case"QQQ":return r.quarter(o,{width:"abbreviated",context:"formatting"})||r.quarter(o,{width:"narrow",context:"formatting"});case"QQQQQ":return r.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(o,{width:"wide",context:"formatting"})||r.quarter(o,{width:"abbreviated",context:"formatting"})||r.quarter(o,{width:"narrow",context:"formatting"})}}validate(o,d){return d>=1&&d<=4}set(o,d,r){return o.setMonth((r-1)*3,1),o.setHours(0,0,0,0),o}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]};var gC=class extends Ci{priority=120;parse(o,d,r){switch(d){case"q":case"qq":return Rn(d.length,o);case"qo":return r.ordinalNumber(o,{unit:"quarter"});case"qqq":return r.quarter(o,{width:"abbreviated",context:"standalone"})||r.quarter(o,{width:"narrow",context:"standalone"});case"qqqqq":return r.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(o,{width:"wide",context:"standalone"})||r.quarter(o,{width:"abbreviated",context:"standalone"})||r.quarter(o,{width:"narrow",context:"standalone"})}}validate(o,d){return d>=1&&d<=4}set(o,d,r){return o.setMonth((r-1)*3,1),o.setHours(0,0,0,0),o}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]};var _C=class extends Ci{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(o,d,r){let s=t=>t-1;switch(d){case"M":return Hr(sr(fr.month,o),s);case"MM":return Hr(Rn(2,o),s);case"Mo":return Hr(r.ordinalNumber(o,{unit:"month"}),s);case"MMM":return r.month(o,{width:"abbreviated",context:"formatting"})||r.month(o,{width:"narrow",context:"formatting"});case"MMMMM":return r.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(o,{width:"wide",context:"formatting"})||r.month(o,{width:"abbreviated",context:"formatting"})||r.month(o,{width:"narrow",context:"formatting"})}}validate(o,d){return d>=0&&d<=11}set(o,d,r){return o.setMonth(r,1),o.setHours(0,0,0,0),o}};var bC=class extends Ci{priority=110;parse(o,d,r){let s=t=>t-1;switch(d){case"L":return Hr(sr(fr.month,o),s);case"LL":return Hr(Rn(2,o),s);case"Lo":return Hr(r.ordinalNumber(o,{unit:"month"}),s);case"LLL":return r.month(o,{width:"abbreviated",context:"standalone"})||r.month(o,{width:"narrow",context:"standalone"});case"LLLLL":return r.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(o,{width:"wide",context:"standalone"})||r.month(o,{width:"abbreviated",context:"standalone"})||r.month(o,{width:"narrow",context:"standalone"})}}validate(o,d){return d>=0&&d<=11}set(o,d,r){return o.setMonth(r,1),o.setHours(0,0,0,0),o}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]};function H3(c,o,d){let r=Yn(c,d?.in),s=eC(r,d)-o;return r.setDate(r.getDate()-s*7),Yn(r,d?.in)}var yC=class extends Ci{priority=100;parse(o,d,r){switch(d){case"w":return sr(fr.week,o);case"wo":return r.ordinalNumber(o,{unit:"week"});default:return Rn(d.length,o)}}validate(o,d){return d>=1&&d<=53}set(o,d,r,s){return Ol(H3(o,r,s),s)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]};function G3(c,o,d){let r=Yn(c,d?.in),s=Jw(r,d)-o;return r.setDate(r.getDate()-s*7),r}var vC=class extends Ci{priority=100;parse(o,d,r){switch(d){case"I":return sr(fr.week,o);case"Io":return r.ordinalNumber(o,{unit:"week"});default:return Rn(d.length,o)}}validate(o,d){return d>=1&&d<=53}set(o,d,r){return Qd(G3(o,r))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]};var eU=[31,28,31,30,31,30,31,31,30,31,30,31],tU=[31,29,31,30,31,30,31,31,30,31,30,31],xC=class extends Ci{priority=90;subPriority=1;parse(o,d,r){switch(d){case"d":return sr(fr.date,o);case"do":return r.ordinalNumber(o,{unit:"date"});default:return Rn(d.length,o)}}validate(o,d){let r=o.getFullYear(),s=dC(r),t=o.getMonth();return s?d>=1&&d<=tU[t]:d>=1&&d<=eU[t]}set(o,d,r){return o.setDate(r),o.setHours(0,0,0,0),o}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]};var wC=class extends Ci{priority=90;subpriority=1;parse(o,d,r){switch(d){case"D":case"DD":return sr(fr.dayOfYear,o);case"Do":return r.ordinalNumber(o,{unit:"date"});default:return Rn(d.length,o)}}validate(o,d){let r=o.getFullYear();return dC(r)?d>=1&&d<=366:d>=1&&d<=365}set(o,d,r){return o.setMonth(0,r),o.setHours(0,0,0,0),o}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]};function ib(c,o,d){let r=Kc(),s=d?.weekStartsOn??d?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,t=Yn(c,d?.in),g=t.getDay(),M=(o%7+7)%7,F=7-s,N=o<0||o>6?o-(g+F)%7:(M+F)%7-(g+F)%7;return Xw(t,N,d)}var CC=class extends Ci{priority=90;parse(o,d,r){switch(d){case"E":case"EE":case"EEE":return r.day(o,{width:"abbreviated",context:"formatting"})||r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"});case"EEEEE":return r.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"});case"EEEE":default:return r.day(o,{width:"wide",context:"formatting"})||r.day(o,{width:"abbreviated",context:"formatting"})||r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"})}}validate(o,d){return d>=0&&d<=6}set(o,d,r,s){return o=ib(o,r,s),o.setHours(0,0,0,0),o}incompatibleTokens=["D","i","e","c","t","T"]};var SC=class extends Ci{priority=90;parse(o,d,r,s){let t=g=>{let w=Math.floor((g-1)/7)*7;return(g+s.weekStartsOn+6)%7+w};switch(d){case"e":case"ee":return Hr(Rn(d.length,o),t);case"eo":return Hr(r.ordinalNumber(o,{unit:"day"}),t);case"eee":return r.day(o,{width:"abbreviated",context:"formatting"})||r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"});case"eeeee":return r.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"});case"eeee":default:return r.day(o,{width:"wide",context:"formatting"})||r.day(o,{width:"abbreviated",context:"formatting"})||r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"})}}validate(o,d){return d>=0&&d<=6}set(o,d,r,s){return o=ib(o,r,s),o.setHours(0,0,0,0),o}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]};var IC=class extends Ci{priority=90;parse(o,d,r,s){let t=g=>{let w=Math.floor((g-1)/7)*7;return(g+s.weekStartsOn+6)%7+w};switch(d){case"c":case"cc":return Hr(Rn(d.length,o),t);case"co":return Hr(r.ordinalNumber(o,{unit:"day"}),t);case"ccc":return r.day(o,{width:"abbreviated",context:"standalone"})||r.day(o,{width:"short",context:"standalone"})||r.day(o,{width:"narrow",context:"standalone"});case"ccccc":return r.day(o,{width:"narrow",context:"standalone"});case"cccccc":return r.day(o,{width:"short",context:"standalone"})||r.day(o,{width:"narrow",context:"standalone"});case"cccc":default:return r.day(o,{width:"wide",context:"standalone"})||r.day(o,{width:"abbreviated",context:"standalone"})||r.day(o,{width:"short",context:"standalone"})||r.day(o,{width:"narrow",context:"standalone"})}}validate(o,d){return d>=0&&d<=6}set(o,d,r,s){return o=ib(o,r,s),o.setHours(0,0,0,0),o}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]};function q3(c,o,d){let r=Yn(c,d?.in),s=U3(r,d),t=o-s;return Xw(r,t,d)}var TC=class extends Ci{priority=90;parse(o,d,r){let s=t=>t===0?7:t;switch(d){case"i":case"ii":return Rn(d.length,o);case"io":return r.ordinalNumber(o,{unit:"day"});case"iii":return Hr(r.day(o,{width:"abbreviated",context:"formatting"})||r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"}),s);case"iiiii":return Hr(r.day(o,{width:"narrow",context:"formatting"}),s);case"iiiiii":return Hr(r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"}),s);case"iiii":default:return Hr(r.day(o,{width:"wide",context:"formatting"})||r.day(o,{width:"abbreviated",context:"formatting"})||r.day(o,{width:"short",context:"formatting"})||r.day(o,{width:"narrow",context:"formatting"}),s)}}validate(o,d){return d>=1&&d<=7}set(o,d,r){return o=q3(o,r),o.setHours(0,0,0,0),o}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]};var MC=class extends Ci{priority=80;parse(o,d,r){switch(d){case"a":case"aa":case"aaa":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"})||r.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaaa":return r.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(o,{width:"wide",context:"formatting"})||r.dayPeriod(o,{width:"abbreviated",context:"formatting"})||r.dayPeriod(o,{width:"narrow",context:"formatting"})}}set(o,d,r){return o.setHours(tb(r),0,0,0),o}incompatibleTokens=["b","B","H","k","t","T"]};var kC=class extends Ci{priority=80;parse(o,d,r){switch(d){case"b":case"bb":case"bbb":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"})||r.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbbb":return r.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(o,{width:"wide",context:"formatting"})||r.dayPeriod(o,{width:"abbreviated",context:"formatting"})||r.dayPeriod(o,{width:"narrow",context:"formatting"})}}set(o,d,r){return o.setHours(tb(r),0,0,0),o}incompatibleTokens=["a","B","H","k","t","T"]};var EC=class extends Ci{priority=80;parse(o,d,r){switch(d){case"B":case"BB":case"BBB":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"})||r.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBBB":return r.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(o,{width:"wide",context:"formatting"})||r.dayPeriod(o,{width:"abbreviated",context:"formatting"})||r.dayPeriod(o,{width:"narrow",context:"formatting"})}}set(o,d,r){return o.setHours(tb(r),0,0,0),o}incompatibleTokens=["a","b","t","T"]};var DC=class extends Ci{priority=70;parse(o,d,r){switch(d){case"h":return sr(fr.hour12h,o);case"ho":return r.ordinalNumber(o,{unit:"hour"});default:return Rn(d.length,o)}}validate(o,d){return d>=1&&d<=12}set(o,d,r){let s=o.getHours()>=12;return s&&r<12?o.setHours(r+12,0,0,0):!s&&r===12?o.setHours(0,0,0,0):o.setHours(r,0,0,0),o}incompatibleTokens=["H","K","k","t","T"]};var AC=class extends Ci{priority=70;parse(o,d,r){switch(d){case"H":return sr(fr.hour23h,o);case"Ho":return r.ordinalNumber(o,{unit:"hour"});default:return Rn(d.length,o)}}validate(o,d){return d>=0&&d<=23}set(o,d,r){return o.setHours(r,0,0,0),o}incompatibleTokens=["a","b","h","K","k","t","T"]};var PC=class extends Ci{priority=70;parse(o,d,r){switch(d){case"K":return sr(fr.hour11h,o);case"Ko":return r.ordinalNumber(o,{unit:"hour"});default:return Rn(d.length,o)}}validate(o,d){return d>=0&&d<=11}set(o,d,r){return o.getHours()>=12&&r<12?o.setHours(r+12,0,0,0):o.setHours(r,0,0,0),o}incompatibleTokens=["h","H","k","t","T"]};var OC=class extends Ci{priority=70;parse(o,d,r){switch(d){case"k":return sr(fr.hour24h,o);case"ko":return r.ordinalNumber(o,{unit:"hour"});default:return Rn(d.length,o)}}validate(o,d){return d>=1&&d<=24}set(o,d,r){let s=r<=24?r%24:r;return o.setHours(s,0,0,0),o}incompatibleTokens=["a","b","h","H","K","t","T"]};var RC=class extends Ci{priority=60;parse(o,d,r){switch(d){case"m":return sr(fr.minute,o);case"mo":return r.ordinalNumber(o,{unit:"minute"});default:return Rn(d.length,o)}}validate(o,d){return d>=0&&d<=59}set(o,d,r){return o.setMinutes(r,0,0),o}incompatibleTokens=["t","T"]};var FC=class extends Ci{priority=50;parse(o,d,r){switch(d){case"s":return sr(fr.second,o);case"so":return r.ordinalNumber(o,{unit:"second"});default:return Rn(d.length,o)}}validate(o,d){return d>=0&&d<=59}set(o,d,r){return o.setSeconds(r,0),o}incompatibleTokens=["t","T"]};var LC=class extends Ci{priority=30;parse(o,d){let r=s=>Math.trunc(s*Math.pow(10,-d.length+3));return Hr(Rn(d.length,o),r)}set(o,d,r){return o.setMilliseconds(r),o}incompatibleTokens=["t","T"]};var zC=class extends Ci{priority=10;parse(o,d){switch(d){case"X":return ed(Jc.basicOptionalMinutes,o);case"XX":return ed(Jc.basic,o);case"XXXX":return ed(Jc.basicOptionalSeconds,o);case"XXXXX":return ed(Jc.extendedOptionalSeconds,o);case"XXX":default:return ed(Jc.extended,o)}}set(o,d,r){return d.timestampIsSet?o:xr(o,o.getTime()-$g(o)-r)}incompatibleTokens=["t","T","x"]};var BC=class extends Ci{priority=10;parse(o,d){switch(d){case"x":return ed(Jc.basicOptionalMinutes,o);case"xx":return ed(Jc.basic,o);case"xxxx":return ed(Jc.basicOptionalSeconds,o);case"xxxxx":return ed(Jc.extendedOptionalSeconds,o);case"xxx":default:return ed(Jc.extended,o)}}set(o,d,r){return d.timestampIsSet?o:xr(o,o.getTime()-$g(o)-r)}incompatibleTokens=["t","T","X"]};var NC=class extends Ci{priority=40;parse(o){return lC(o)}set(o,d,r){return[xr(o,r*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"};var VC=class extends Ci{priority=20;parse(o){return lC(o)}set(o,d,r){return[xr(o,r),{timestampIsSet:!0}]}incompatibleTokens="*"};var $3={G:new sC,y:new uC,Y:new hC,R:new mC,u:new pC,Q:new fC,q:new gC,M:new _C,L:new bC,w:new yC,I:new vC,d:new xC,D:new wC,E:new CC,e:new SC,c:new IC,i:new TC,a:new MC,b:new kC,B:new EC,h:new DC,H:new AC,K:new PC,k:new OC,m:new RC,s:new FC,S:new LC,X:new zC,x:new BC,t:new NC,T:new VC};var iU=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,nU=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,rU=/^'([^]*?)'?$/,oU=/''/g,aU=/\S/,sU=/[a-zA-Z]/;function Y3(c,o,d,r){let s=()=>xr(r?.in||d,NaN),t=j3(),g=r?.locale??t.locale??gv,w=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??t.firstWeekContainsDate??t.locale?.options?.firstWeekContainsDate??1,M=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0;if(!o)return c?s():Yn(d,r?.in);let F={firstWeekContainsDate:w,weekStartsOn:M,locale:g},N=[new aC(r?.in,d)],Q=o.match(nU).map(Re=>{let Ke=Re[0];if(Ke in _v){let Je=_v[Ke];return Je(Re,g.formatLong)}return Re}).join("").match(iU),ae=[];for(let Re of Q){!r?.useAdditionalWeekYearTokens&&iC(Re)&&bv(Re,o,c),!r?.useAdditionalDayOfYearTokens&&tC(Re)&&bv(Re,o,c);let Ke=Re[0],Je=$3[Ke];if(Je){let{incompatibleTokens:_t}=Je;if(Array.isArray(_t)){let kt=ae.find(Ut=>_t.includes(Ut.token)||Ut.token===Ke);if(kt)throw new RangeError(`The format string mustn't contain \`${kt.fullToken}\` and \`${Re}\` at the same time`)}else if(Je.incompatibleTokens==="*"&&ae.length>0)throw new RangeError(`The format string mustn't contain \`${Re}\` and any other token at the same time`);ae.push({token:Ke,fullToken:Re});let Nt=Je.run(c,Re,g.match,F);if(!Nt)return s();N.push(Nt.setter),c=Nt.rest}else{if(Ke.match(sU))throw new RangeError("Format string contains an unescaped latin alphabet character `"+Ke+"`");if(Re==="''"?Re="'":Ke==="'"&&(Re=lU(Re)),c.indexOf(Re)===0)c=c.slice(Re.length);else return s()}}if(c.length>0&&aU.test(c))return s();let pe=N.map(Re=>Re.priority).sort((Re,Ke)=>Ke-Re).filter((Re,Ke,Je)=>Je.indexOf(Re)===Ke).map(Re=>N.filter(Ke=>Ke.priority===Re).sort((Ke,Je)=>Je.subPriority-Ke.subPriority)).map(Re=>Re[0]),Te=Yn(d,r?.in);if(isNaN(+Te))return s();let Pe={};for(let Re of pe){if(!Re.validate(Te,F))return s();let Ke=Re.set(Te,Pe,F);Array.isArray(Ke)?(Te=Ke[0],Object.assign(Pe,Ke[1])):Te=Ke}return Te}function lU(c){return c.match(rU)[1].replace(oU,"'")}var cU=["dialogTemplate"],dU=c=>({selected:c});function uU(c,o){if(c&1){let d=ai();Dm(0),U(1,"div")(2,"p",3),Ne("click",function(){St(d);let s=it();return It(s.extend())}),X(3,"expand_circle_right"),W()(),Am()}}function hU(c,o){if(c&1){let d=ai();Dm(0),U(1,"span",17)(2,"input",18),Ne("change",function(){St(d);let s=it().$implicit,t=it();return It(t.availabilityService(s.name))}),W(),X(3,"\xA0 "),U(4,"span",19),X(5),W()(),Am()}if(c&2){let d=it().$implicit,r=it();le(2),ze("checked",r.selectedService===d.name),le(3),Xt(d.name)}}function mU(c,o){if(c&1){let d=ai();Dm(0),U(1,"span",3),Ne("click",function(){St(d);let s=it(2);return It(s.openServiceDialog())}),X(2,"expand_circle_down"),W(),Am()}}function pU(c,o){if(c&1){let d=ai();U(0,"div",20)(1,"span",21)(2,"input",18),Ne("change",function(){St(d);let s=it().$implicit,t=it();return It(t.availabilityService(s.item.categoryId.name))}),W(),U(3,"span",19),X(4),W()()()}if(c&2){let d=it().$implicit,r=it();le(2),ze("checked",r.selectedService===d.item.categoryId.name),le(2),Xt(d.item.categoryId.name)}}function fU(c,o){if(c&1&&(Dm(0),qt(1,hU,6,2,"ng-container",4)(2,mU,3,0,"ng-container",4)(3,pU,5,2,"div",16),Am()),c&2){let d=o.index,r=it();le(),ze("ngIf",d<=1&&!r.extendServices),le(),ze("ngIf",d===2&&!r.extendServices),le(),ze("ngIf",r.extendServices)}}function gU(c,o){if(c&1){let d=ai();Dm(0),U(1,"div",22),Ne("click",function(){let s=St(d),t=s.$implicit,g=s.index,w=it();return It(w.selected(t,g))}),U(2,"p"),X(3),W(),U(4,"p"),X(5),W(),U(6,"span",23),X(7),W()(),Am()}if(c&2){let d=o.$implicit,r=o.index,s=it();le(),ze("ngClass",wi(4,dU,s.selectedIndex===r)),le(2),Xt(d.day.substring(0,3).toUpperCase()),le(2),Xt(d.date.split("-")[0]),le(2),Xt(d.workingStaus?"check":"close")}}function _U(c,o){if(c&1&&(U(0,"div",24)(1,"span"),X(2),W()()),c&2){let d=it();le(2),I1("",d.daySelected,",",d.monthSelected," ",d.dateSelected,"")}}function bU(c,o){if(c&1){let d=ai();U(0,"div",30)(1,"input",31),Qo("ngModelChange",function(s){let t=St(d).$implicit;return Xo(t.isSelected,s)||(t.isSelected=s),It(s)}),Ne("change",function(s){let t=St(d).$implicit,g=it(2);return It(g.onToggleChange(s,t))}),W(),U(2,"span",19),X(3),W()()}if(c&2){let d=o.$implicit;le(),Zo("ngModel",d.isSelected),le(2),Xt(d.time)}}function yU(c,o){if(c&1&&(U(0,"div",25)(1,"div",26)(2,"span",12),X(3,"check"),W(),U(4,"p"),X(5,"confirmation your working hours"),W(),U(6,"span",12),X(7,"expand_circle_up"),W()(),Oe(8,"br")(9,"div",27),U(10,"section",28),qt(11,bU,4,2,"div",29),W()()),c&2){let d=it();le(11),ze("ngForOf",d.nextDaysOfIndex.timming)}}function vU(c,o){if(c&1){let d=ai();U(0,"div")(1,"div",36)(2,"input",18),Ne("change",function(){let s=St(d).$implicit,t=it(2);return It(t.availabilityService(s.name))}),W(),X(3," \xA0"),U(4,"span",37),X(5),W()()()}if(c&2){let d=o.$implicit,r=it(2);le(2),ze("checked",r.selectedService===d.name),le(3),Xt(d.name)}}function xU(c,o){if(c&1){let d=ai();U(0,"h1",32),X(1,"Select Services"),W(),U(2,"div",33)(3,"form"),qt(4,vU,6,2,"div",5),W()(),U(5,"div",34)(6,"button",35),Ne("click",function(){St(d);let s=it();return It(s.onCancel())}),X(7,"Cancel"),W(),U(8,"button",35),Ne("click",function(){St(d);let s=it();return It(s.onSubmit())}),X(9,"Submit"),W()()}if(c&2){let d=it();le(4),ze("ngForOf",d.services)}}var Z3=(()=>{let o=class o{constructor(r,s,t,g,w,M,F,N){this.location=r,this.renderer=s,this.el=t,this.http=g,this.dialog=w,this.jobDetailsService=M,this.userService=F,this.dailogeBoxService=N,this.date=new Date,this.userId=localStorage.getItem("providerId"),this.apiUrl=_n,this.defaultMonth=this.date.toLocaleDateString("default",{month:"long"}),this.daySelected=String(this.date.getDate()).padStart(2,"0"),this.monthSelected=this.defaultMonth.substring(0,3),this.dateSelected=this.date.getDate(),this.isChecked=!1,this.working=!1,this.extendServices=!1,this.services=[],this.nextFourDays=[],this.nextDaysOfIndex=[],this.selectedService="",this.timing=[{time:"07AM-10AM",isSelected:!1},{time:"10AM-01PM",isSelected:!1},{time:"01PM-04Pm",isSelected:!1},{time:"04PM-07Pm",isSelected:!1},{time:"07PM-10Pm",isSelected:!1}],this.showDate=!1,this.api="",this.availabilityResponse=[]}extend(){this.extendServices=!this.extendServices}openServiceDialog(){this.dialogRef=this.dialog.open(this.dialogTemplate),this.dialogRef.afterClosed().subscribe(r=>{r&&(this.services=r)})}onCancel(){this.dialogRef.close()}onSubmit(){this.dialogRef.close(this.services)}ngOnInit(){this.getSelectedService(),this.getDetails(),this.getNextFourDays();let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];this.daySelected=r[this.date.getDay()]}getSelectedService(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r);let s=new Set,t=r.works.reduce((g,w)=>(w.categoryId.forEach(M=>{s.has(M._id)||(s.add(M._id),g.push(M))}),g),[]);this.services=t,console.log(this.services)},r=>{console.error(r)})}availabilityService(r){this.selectedService=r,this.showAvailabilityForService(r)}getNextFourDays(){let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s=new Date;for(let t=0;t<10;t++){let g=new Date(s);g.setDate(s.getDate()+t);let w=this.formatDate(g),M=t===0?this.getFutureTimings():[...this.timing];this.nextFourDays.push({date:w,day:r[g.getDay()],workingStaus:!1,timming:M})}this.nextDaysOfIndex=this.nextFourDays[this.selectedIndex]}getFutureTimings(){let r=this.date.getHours(),s=this.date.getMinutes();return this.timing.filter(t=>{let g=t.time,w=parseInt(g.slice(0,-2)),M=g.includes("AM");return!M&&w<12&&(w+=12),M&&w===12&&(w=0),w>r})}formatDate(r){let s=String(r.getDate()).padStart(2,"0"),t=r.getFullYear(),g=r.toLocaleDateString("default",{month:"long"});return`${s}-${g}-${t}`}selected(r,s){if(this.showDate=!0,!this.selectedService){this.dailogeBoxService.openDialog("select the service from the above");return}this.getDetails(),console.log(r),this.isChecked=!1,r.workingStaus?this.working=!0:(this.working=!1,this.timing.forEach(t=>t.isSelected=!1)),this.selectedIndex=s,this.dateSelected=r.date.toString().split("-")[0],this.daySelected=r.day,this.monthSelected=r.date.toString().split("-")[1],this.yearSelected=r.date.toString().split("-")[2],this.nextDaysOfIndex=this.nextFourDays[this.selectedIndex],this.timing.forEach(t=>t.isSelected=!1),console.log(this.nextDaysOfIndex)}workingChange(){if(!this.monthSelected||!this.dateSelected||!this.yearSelected){this.isChecked=!this.isChecked,this.working=!1,this.dailogeBoxService.openDialog("please select or confirm the date");return}this.timing.forEach(r=>r.isSelected=!1),console.log(this.nextFourDays)}onToggleChange(r,s){let g=r.target?.checked??!1;console.log(g),this.nextFourDays[this.selectedIndex].workingStaus=!this.nextFourDays[this.selectedIndex].workingStaus,this.nextDaysOfIndex.timming.forEach(pe=>{pe.time===s.time&&(pe.isSelected=g)}),this.timeSelected=g?s.time:"",console.log(this.dateSelected);let w=new Date(`${this.monthSelected} ${this.dateSelected} ${this.yearSelected}`);w.setDate(this.dateSelected);let M=w.getDate(),F=w.getMonth()+1,N=M<10?`0${M}`:M,Q=F<10?`0${F}`:F,ae=this.yearSelected;this.fullDate=`${ae}-${Q}-${N}`,console.log(Q)}submitAllData(){console.log(this.checkDuplicate(this.fullDate,this.timeSelected,this.selectedService)),this.checkDuplicate(this.fullDate,this.timeSelected,this.selectedService)?this.dailogeBoxService.openDialog("The same time slot on the selected date for the selected service is already taken."):this.sendingData()}sendingData(){this.timeSelected!=""?this.api=`${this.apiUrl}providers/provider-date`:this.api=`${this.apiUrl}providers/provider-date/delete`;let r=Y3(this.fullDate,"yyyy-MM-dd",new Date);if(isNaN(r.getTime())){console.error("Invalid date:",this.fullDate);return}let s=nC(r,"yyyy-MM-dd");console.log(s);let t={providerId:this.userId,service:this.selectedService,slotTime:{date:this.fullDate,time:this.timeSelected},availability:this.working,jobStartTime:null,jobEndTime:null};console.log(t),console.log(this.api),this.http.post(this.api,t).subscribe(g=>{console.log(g),this.dailogeBoxService.openDialog("Availability added successfully"),this.timing.forEach(w=>w.isSelected=!1),console.log(this.timing),this.getDetails()},g=>{console.log(g),this.dailogeBoxService.openDialog(g.error.message)})}getDetails(){let r=`${this.apiUrl}providers/provider-date/${this.userId}`;this.http.get(r).subscribe(s=>{console.log(s),this.availabilityResponse=s,this.showAvailability(this.availabilityResponse)},s=>{console.log(s)})}deleteData(){}showAvailability(r){console.log(this.services),r.forEach(s=>{let t=s.slotTime.date,g=new Date(t),w=g.getDate(),M=g.toLocaleDateString("default",{month:"long"}),F=`${String(w).padStart(2,"0")}-${M}-${g.getFullYear()}`;this.nextFourDays.forEach(N=>{N.date===F&&(N.workingStaus=s.availability,N.timming.forEach(Q=>{Q.time===s.slotTime.time&&(Q.isSelected=!0)}))})}),console.log(this.nextFourDays)}checkDuplicate(r,s,t){return console.log(r,s),this.availabilityResponse.some(g=>(console.log(g.slotTime.date.split("T")[0],g.slotTime.time),g.slotTime.date.split("T")[0]==r&&g.slotTime.time==s))}navToBack(){this.location.back()}showAvailabilityForService(r){console.log("new called"),this.nextFourDays.forEach(s=>{s.workingStaus=!1,s.timming.forEach(t=>{t.isSelected=!1})}),console.log(this.availabilityResponse),this.availabilityResponse.forEach(s=>{if(s.service===r){let t=s.slotTime.date,g=new Date(t),w=g.getDate(),M=g.toLocaleDateString("default",{month:"long"}),F=`${String(w).padStart(2,"0")}-${M}-${g.getFullYear()}`;this.nextFourDays.forEach(N=>{F===N.date&&(N.workingStaus=!0,N.timming.forEach(Q=>{Q.time===s.slotTime.time&&(Q.isSelected=!0)}))})}})}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(WS),_e(Vn),_e(ji),_e(A0),_e(ea),_e(nr),_e(mr))},o.\u0275cmp=Et({type:o,selectors:[["app-calender"]],viewQuery:function(s,t){if(s&1&&Vi(cU,5),s&2){let g;zi(g=Bi())&&(t.dialogTemplate=g.first)}},decls:25,vars:10,consts:[["dialogTemplate",""],[1,"container"],[1,"headers"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"sub-container"],[1,"working-dates"],["class","selected-date",4,"ngIf"],[1,"update"],[1,"custom-checkbox"],["type","checkbox",3,"change","ngModelChange","checked","ngModel"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],["class","confirmation-div",4,"ngIf"],[3,"click"],[2,"width","300px"],["class","extended",4,"ngIf"],[2,"display","flex","align-items","center","justify-content","center"],["type","checkbox",3,"change","checked"],[1,"service-tittle"],[1,"extended"],[1,"service"],[1,"datess",3,"click","ngClass"],[1,"material-symbols-outlined","notranslate"],[1,"selected-date"],[1,"confirmation-div"],[1,"conformation"],[1,"line"],[1,"time-section"],["class","time-confirm",4,"ngFor","ngForOf"],[1,"time-confirm"],["type","checkbox","color","accent",3,"ngModelChange","change","ngModel"],["mat-dialog-title",""],["mat-dialog-content","",2,"width","300px"],["mat-dialog-actions","",2,"display","flex","justify-content","space-evenly"],["mat-button","",2,"width","30%","height","2rem",3,"click"],[2,"display","flex","align-items","center","width","100%","height","3rem"],[2,"color","black"]],template:function(s,t){if(s&1){let g=ai();U(0,"div",1)(1,"div",2)(2,"span",3),Ne("click",function(){return St(g),It(t.navToBack())}),X(3,"arrow_back"),W(),qt(4,uU,4,0,"ng-container",4)(5,fU,4,3,"ng-container",5),W(),Oe(6,"br")(7,"br"),U(8,"div",6)(9,"div",7),qt(10,gU,8,6,"ng-container",5),W(),qt(11,_U,3,3,"div",8),U(12,"div",9)(13,"div")(14,"label",10)(15,"input",11),Ne("change",function(){return St(g),It(t.workingChange())}),Qo("ngModelChange",function(M){return St(g),Xo(t.working,M)||(t.working=M),It(M)}),W()(),U(16,"span"),X(17,"Working"),W()(),U(18,"span",12),X(19),W()(),qt(20,yU,12,1,"div",13),U(21,"button",14),Ne("click",function(){return St(g),It(t.submitAllData())}),X(22,"submit"),W()()(),qt(23,xU,10,1,"ng-template",15,0,Ag)}s&2&&(le(4),ze("ngIf",t.extendServices),le(),ze("ngForOf",t.services),le(5),ze("ngForOf",t.nextFourDays),le(),ze("ngIf",t.showDate),le(3),Ki("checked",t.isChecked),le(),ze("checked",t.isChecked),Zo("ngModel",t.working),le(4),Xt(t.working?"expand_circle_right":"expand_circle_down"),le(),ze("ngIf",t.working))},dependencies:[Ko,Io,$n,va,sh,Kr,ya,Sl,WE,_A,yA,bA],styles:['.container[_ngcontent-%COMP%]{width:90%;height:100vh;padding:1rem}.headers[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.service[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.service-tittle[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1rem;font-weight:500;line-height:16.94px;text-align:left}.extended[_ngcontent-%COMP%]{border:1px solid red}.sub-container[_ngcontent-%COMP%]{width:95%;position:relative;left:2.5%;display:grid;row-gap:3rem}.working-dates[_ngcontent-%COMP%]{width:100%;display:flex;column-gap:2rem;justify-content:space-between;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;flex-direction:row;-ms-overflow-style:none;scrollbar-width:none}.datess[_ngcontent-%COMP%]{width:5rem;height:5rem;display:flex;text-align:center;flex-direction:column;border:1px solid black;border-radius:.5rem;flex:0 0 20%;padding-top:1rem;padding-bottom:1rem}.datess.selected[_ngcontent-%COMP%]{background-color:#72d388;border:none;color:#fff}.selected-date[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;letter-spacing:.07em}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:#72d388;border:0}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}.btn[_ngcontent-%COMP%]{width:100%;align-items:center}button[_ngcontent-%COMP%]{width:100%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}.update[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-around;border:.25px solid black;border-radius:.4rem;align-items:center}.update[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%;display:flex;justify-content:space-around;text-align:center;align-items:center}.update[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px;letter-spacing:.07em;text-align:center;align-items:center}.confirmation-div[_ngcontent-%COMP%]{background:#fcf5fc;border:.25px solid rgba(0,0,0,1);border-radius:.4rem;padding:1rem}.conformation[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.line[_ngcontent-%COMP%]{height:1rem;border-bottom:.2px solid transparent;border-top:.25px dashed black}.time-confirm[_ngcontent-%COMP%]{height:2rem;display:flex;align-items:center;justify-content:center;text-align:center;gap:.5rem}.time-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:45% 45%;column-gap:5%;row-gap:1rem}']});let c=o;return c})();function wU(c,o){if(c&1){let d=ai();U(0,"div",5),Ne("click",function(){let s=St(d).$implicit,t=it();return It(t.selectedJob(s))}),U(1,"div")(2,"p")(3,"span",6),X(4),W()(),U(5,"p")(6,"span",7),Ne("click",function(){St(d);let s=it();return It(s.navToBack())}),X(7,"account_balance_wallet"),W(),X(8,"\xA0 "),U(9,"span",8),X(10),W()(),U(11,"p")(12,"span",7),Ne("click",function(){St(d);let s=it();return It(s.navToBack())}),X(13,"description"),W(),X(14,"\xA0 "),U(15,"span",8),X(16),W()()(),U(17,"div")(18,"p",6),X(19),W(),U(20,"p",8),X(21),W()()(),Oe(22,"br")}if(c&2){let d=o.$implicit;le(4),Xt(d.orderId==null||d.orderId.items[0]==null?null:d.orderId.items[0].serviceId.name),le(6),Ni("Job value:",d.orderId==null?null:d.orderId.totalAmount,""),le(6),Ni("Online Payments:",d.orderId==null?null:d.orderId.totalAmount,""),le(3),Xt(d.orderId==null||d.orderId.items[0]==null?null:d.orderId.items[0].selectedTime),le(2),ss("",d.orderId==null||d.orderId.items[0]==null?null:d.orderId.items[0].selectedDate," - ",d.orderId==null||d.orderId.items[0]==null?null:d.orderId.items[0].selectedMonth,"")}}var X3=(()=>{let o=class o{navToBack(){this.location.back()}constructor(r,s,t,g){this.location=r,this.jobDetailsService=s,this.router=t,this.orderService=g,this.jobs=[{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"},{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"},{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"}]}ngOnInit(){this.getOrderDetails()}getOrderDetails(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r),this.jobs=r.data,this.filterOrder()},error:r=>{console.log(r)}})}filterOrder(){this.filteredJobs=this.jobs.filter(r=>r.status&&r.status.toLowerCase()==="completed"),console.log(this.filteredJobs),this.jobs=this.filteredJobs}selectedJob(r){console.log(r),this.jobDetailsService.selectedJobDetails(r),this.router.navigate(["jobDetails"])}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(ea),_e(ii),_e(ta))},o.\u0275cmp=Et({type:o,selectors:[["app-job-history"]],decls:11,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","24px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"section",3,"click"],[1,"main-text"],[1,"material-symbols-outlined","notranslate",2,"font-size","1rem",3,"click"],[1,"text"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),Ne("click",function(){return t.navToBack()}),X(3,"arrow_back"),W(),X(4,"\xA0"),U(5,"span",3),X(6,"Job History"),W()(),U(7,"div",4)(8,"div"),no(9,wU,23,6,null,null,Yo),W()()()),s&2&&(le(9),ro(t.jobs))},styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%}.section[_ngcontent-%COMP%]{width:100%;height:7rem;border:.25px solid black;border-radius:.5rem;display:flex;justify-content:space-between;align-items:center;text-align:center}.section[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:.5rem;display:flexbox;text-align:left}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:19.36px}.main-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:19.36px}.text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:14.52px}']});let c=o;return c})();function CU(c,o){if(c&1&&(U(0,"span"),X(1),wl(2,"number"),W()),c&2){let d=it();le(),ss("For \u20B9\xA0 ",d.AmountToPay," you will get ",d.creditsVlGet%1===0?d.creditsVlGet:Cl(2,2,d.creditsVlGet,"1.2-2"),"")}}function SU(c,o){if(c&1){let d=ai();U(0,"div",18),Ne("click",function(){let s=St(d).$implicit,t=it();return It(t.selected(s))}),X(1),W()}if(c&2){let d=o.$implicit;le(),Xt(d)}}var Q3=(()=>{let o=class o{navToBack(){this.location.back()}constructor(r,s,t){this.location=r,this.http=s,this.razorPayService=t,this.credits=[20,50,100,250],this.selectedValue=0,this.AmountToPay=0,this.creditsVlGet=0,this.payOnline=!1,this.deductNextPayout=!1}entredAmount(){this.AmountToPay=this.selectedValue,this.creditsVlGet=Math.floor(this.AmountToPay/10),console.log(this.AmountToPay)}selected(r){this.selectedValue=r,this.AmountToPay=this.selectedValue,this.creditsVlGet=Math.floor(this.AmountToPay/10)}togglePayOnline(r){this.payOnline=!this.payOnline,this.payOnline&&(this.deductNextPayout=!1,this.makePayment())}toggleDeductNextPayout(){this.deductNextPayout=!this.deductNextPayout,this.deductNextPayout&&(this.payOnline=!1)}makePayment(){let r=this.AmountToPay,s="INR",t="order_id_from_backend";this.razorPayService.createOrder(r).subscribe({next:g=>{console.log("Order created:",g),this.razorPayService.payWithRazorpay(r,g.id,s)},error:g=>{console.error("Error creating order:",g)}})}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(ji),_e(ks))},o.\u0275cmp=Et({type:o,selectors:[["app-add-credit"]],decls:34,vars:7,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","32px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"input-credit"],[1,"credit-input"],["src","assets/logo/credit12.png"],["type","number","placeholder","Enter number of credits",3,"ngModelChange","input","value","ngModel"],[4,"ngIf"],[1,"quickSelect-div"],[1,"maintext"],[1,"selec-div"],["class","maintext",3,"click",4,"ngFor","ngForOf"],[1,"Amount-div"],[1,"selecPayment-div"],[1,"minText"],["type","checkbox",3,"change","checked"],[1,"maintext",3,"click"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),Ne("click",function(){return t.navToBack()}),X(3,"arrow_back"),W(),X(4,"\xA0 "),U(5,"span",3),X(6,"Add credits"),W()(),U(7,"div",4)(8,"div",5)(9,"div",6),Oe(10,"img",7),U(11,"input",8),Qo("ngModelChange",function(w){return Xo(t.selectedValue,w)||(t.selectedValue=w),w}),Ne("input",function(){return t.entredAmount()}),W()(),qt(12,CU,3,5,"span",9),W(),U(13,"div",10)(14,"span",11),X(15,"Quick select"),W(),U(16,"div",12),qt(17,SU,2,1,"div",13),W()(),U(18,"div",14)(19,"span",11),X(20,"Amount to pay"),W(),U(21,"p",11),X(22),W()(),U(23,"div",15)(24,"span",11),X(25,"Select payment method"),W(),Oe(26,"br")(27,"br"),U(28,"p",16)(29,"input",17),Ne("change",function(w){return t.togglePayOnline(w)}),W(),X(30,"\xA0Pay Online "),W(),U(31,"p",16)(32,"input",17),Ne("change",function(){return t.toggleDeductNextPayout()}),W(),X(33,"\xA0Deduct from next payout "),W()()()()),s&2&&(le(11),ze("value",t.selectedValue),Zo("ngModel",t.selectedValue),le(),ze("ngIf",t.AmountToPay),le(5),ze("ngForOf",t.credits),le(5),Ni("\u20B9\xA0 ",t.AmountToPay,""),le(7),ze("checked",t.payOnline),le(3),ze("checked",t.deductNextPayout))},dependencies:[Io,$n,ba,g0,Kr,Sl,Gc],styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.6rem;font-weight:500;line-height:19.36px}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%;display:grid;row-gap:2rem}.maintext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px}.minText[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:19.36px}.input-credit[_ngcontent-%COMP%]{display:grid;gap:.2rem}.input-credit[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:green}.credit-input[_ngcontent-%COMP%]{height:3rem;width:100%;border:.25px solid black;border-radius:.4rem;display:flex;align-items:center;justify-content:space-around}.credit-input[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1rem;height:1rem}.credit-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80%;height:2.5rem;outline:0;border-width:0;font-size:1.2rem}.quickSelect-div[_ngcontent-%COMP%]{width:100%;height:max-content;display:grid;row-gap:1.5rem}.selec-div[_ngcontent-%COMP%]{width:100%;height:max-content;display:flex;flex-wrap:wrap;column-gap:3rem;row-gap:1.5rem}.selec-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{border:.25px solid black;width:4.8rem;height:2.5rem;display:flex;border-radius:.5rem;align-items:center;justify-content:center}.Amount-div[_ngcontent-%COMP%]{width:90%;height:4rem;display:flex;align-items:center;text-align:center;padding-left:5%;padding-right:5%;justify-content:space-between;border:.25px solid black;border-radius:.5rem}.minText[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}']});let c=o;return c})();var K3=(()=>{let o=class o{navToBack(){this.location.back()}constructor(r,s){this.location=r,this.userDetails=s,this.bankDetails=[],this.getUserDetails(),this.bankDetails()}getUserDetails(){this.userDetails.getFinancialDetails().subscribe(r=>{console.log(r),this.bankDetails=r},r=>{console.log(r)})}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(nr))},o.\u0275cmp=Et({type:o,selectors:[["app-financial-details"]],decls:61,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"gst-div"],[1,"largetext"],[1,"panDetails"],[1,"edit"],[1,"bankdetails"],[1,"normaltext"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),Ne("click",function(){return t.navToBack()}),X(3,"arrow_back"),W(),X(4,"\xA0 "),U(5,"span",3),X(6,"Financial details"),W()(),U(7,"div",4)(8,"div",5)(9,"span",6),X(10,"GST Details"),W(),U(11,"span",6),X(12,"Add+"),W()(),U(13,"div",7)(14,"p")(15,"span",6),X(16,"Aadhar Card details"),W(),U(17,"span",8),X(18,"Edit"),W()(),U(19,"p")(20,"span",6),X(21,"Aadhar "),W(),U(22,"span",6),X(23),W()()(),U(24,"div",7)(25,"p")(26,"span",6),X(27,"PAN Card details"),W(),U(28,"span",8),X(29,"Edit"),W()(),U(30,"p")(31,"span",6),X(32,"PAN "),W(),U(33,"span",6),X(34),W()()(),U(35,"div",9)(36,"p")(37,"span",6),X(38,"Bank account details"),W(),U(39,"span",8),X(40,"Edit"),W()(),U(41,"p")(42,"span",10),X(43,"Account number"),W(),U(44,"span",6),X(45),W()(),U(46,"p")(47,"span",10),X(48,"Bank name"),W(),U(49,"span",6),X(50),W()(),U(51,"p")(52,"span",10),X(53,"IFSC code"),W(),U(54,"span",6),X(55),W()(),U(56,"p")(57,"span",10),X(58,"Name in account"),W(),U(59,"span",6),X(60),W()()()()()),s&2&&(le(23),Xt(t.bankDetails.aadhaarNumber),le(11),Xt(t.bankDetails.pan),le(11),Xt(t.bankDetails.accountNumber),le(5),Xt(t.bankDetails.bankName),le(5),Xt(t.bankDetails.ifscCode),le(5),Xt(t.bankDetails.accountName))},styles:['.container[_ngcontent-%COMP%]{width:93vw;height:100vh;padding:1rem .5rem 0 1rem}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.5rem;font-weight:500;line-height:19.36px}.sub-container[_ngcontent-%COMP%]{width:97%;position:relative;top:3.5%;display:grid;row-gap:2rem}.gst-div[_ngcontent-%COMP%]{width:90%;height:4rem;border:.25px solid black;display:flex;justify-content:space-between;align-items:center;text-align:center;padding:5%;border-radius:.5rem}.panDetails[_ngcontent-%COMP%]{width:90%;height:5rem;border:.25px solid black;display:flex;flex-direction:column;row-gap:1rem;padding:5%;border-radius:.5rem}p[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;text-align:center}.bankdetails[_ngcontent-%COMP%]{width:90%;height:13rem;border:.25px solid black;display:flex;flex-direction:column;row-gap:1rem;padding:5%;border-radius:.5rem}.largetext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px}.edit[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px;color:#00000080}.normaltext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px}']});let c=o;return c})();var J3=(()=>{let o=class o{navToBack(){this.location.back()}navToHelp(){this.router.navigate(["help"])}constructor(r,s,t){this.jobDetailsService=r,this.location=s,this.router=t,this.jobDetailsService.getSelectedJob(),console.log(this.jobDetailsService.getSelectedJob())}ngOnInit(){this.orderDetails=this.jobDetailsService.getSelectedJob()}};o.\u0275fac=function(s){return new(s||o)(_e(ea),_e(yi),_e(ii))},o.\u0275cmp=Et({type:o,selectors:[["app-job-details"]],decls:65,vars:12,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","24px",3,"click"],[1,"help",3,"click"],[1,"sub-container"],[1,"name"],[1,"tittle"],[1,"customer-details"],[1,"sub-tittle"],[1,"Details"],[1,"para-section"],[1,"highlight-text"],[1,"line"],[1,"time-div"],[1,"summary"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),Ne("click",function(){return t.navToBack()}),X(3,"arrow_back"),W(),U(4,"div",3),Ne("click",function(){return t.navToHelp()}),X(5,"Help?"),W()(),U(6,"div",4)(7,"div",5)(8,"span",6),X(9),W(),U(10,"span"),X(11),W()(),U(12,"div",7)(13,"span",8),X(14,"Customers Details"),W(),U(15,"div",9)(16,"p",10)(17,"span",11),X(18,"Location"),W(),U(19,"span"),X(20),W()(),Oe(21,"div",12)(22,"br"),U(23,"div",13)(24,"p",10)(25,"span",11),X(26,"Job start"),W(),U(27,"span"),X(28),W()(),U(29,"p",10)(30,"span",11),X(31,"Job End"),W(),U(32,"span"),X(33,"12 Apr 07:30 PM"),W()()()()(),U(34,"div",14)(35,"span",8),X(36,"Summary"),W(),U(37,"div",9)(38,"div",13)(39,"span",11),X(40),W(),U(41,"span",8),X(42),W()(),Oe(43,"div",12)(44,"br"),U(45,"div",13)(46,"p")(47,"span"),X(48,"Others"),W(),Oe(49,"br"),U(50,"span",11),X(51,"Convenience Fee"),W()(),U(52,"p",8),X(53,"69"),W()(),Oe(54,"div",12)(55,"br"),U(56,"div",13)(57,"p")(58,"span",11),X(59,"Total value"),W(),Oe(60,"br"),U(61,"span"),X(62,"commission 5 credits"),W()(),U(63,"p",8),X(64),W()()()()()()),s&2&&(le(9),Xt(t.orderDetails.orderId.addressId.username),le(2),Xt(t.orderDetails.orderId.items[0].scheduledDate),le(9),AE(" ",t.orderDetails.orderId.addressId.address,",",t.orderDetails.orderId.addressId.landmark,", ",t.orderDetails.orderId.addressId.city,", ",t.orderDetails.orderId.addressId.state,", ",t.orderDetails.orderId.addressId.pincode," "),le(8),Ni(" ",t.orderDetails.workStartTime," "),le(12),ss("",t.orderDetails.orderId.items[0].quantity," \xA0 X \xA0 ",t.orderDetails.orderId.categoryIds[0].name,""),le(2),Ni("\u20B9 \xA0",t.orderDetails.orderId.totalAmount,""),le(22),Xt(t.orderDetails.orderId.totalAmount))},styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;justify-content:space-between;align-items:center}.help[_ngcontent-%COMP%]{width:4rem;height:2.5rem;border:none;background:#20193f;border-radius:1.3rem;color:#fff;display:flex;justify-content:center;align-items:center}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:19.36px;margin-bottom:1rem}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%;display:grid;row-gap:1.5rem}.name[_ngcontent-%COMP%]{position:relative;left:5%;display:flex;flex-direction:column}.sub-tittle[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;padding:0 0 1rem 1rem;margin-bottom:.5rem}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:600;line-height:16.94px;margin-bottom:.5rem}.customer-details[_ngcontent-%COMP%]{padding-top:1rem;display:grid;row-gap:1rem}.time-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.Details[_ngcontent-%COMP%]{width:90%;padding:1rem;border:.25px solid black;border-radius:.5rem}.summary[_ngcontent-%COMP%]{padding-top:1rem;display:grid;row-gap:1rem}.line[_ngcontent-%COMP%]{border:0;border-bottom:1px dashed rgb(45,44,44)}.para-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}']});let c=o;return c})();function IU(c,o){if(c&1&&(U(0,"div")(1,"label",6),Oe(2,"input",7),W(),X(3," \xA0 "),U(4,"span",3),X(5),W()(),Oe(6,"br")),c&2){let d=o.$implicit;le(),Ki("checked",d.checked),le(),ze("checked",d.checked),le(3),Xt(d.name)}}var eR=(()=>{let o=class o{navToBack(){this.location.back()}constructor(r){this.location=r,this.items=[{name:"Contact Details",checked:!0},{name:"Aadhar card",checked:!0},{name:"Bank Details",checked:!0},{name:"Professional documents",checked:!1}]}toggleCheckbox(){}};o.\u0275fac=function(s){return new(s||o)(_e(yi))},o.\u0275cmp=Et({type:o,selectors:[["app-identity-verification"]],decls:13,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"para"],[1,"verify-div"],[1,"custom-checkbox"],["type","checkbox","disabled","",3,"checked"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),Ne("click",function(){return t.navToBack()}),X(3,"arrow_back"),W(),X(4,"\xA0 "),U(5,"span",3),X(6,"Identity Verification"),W()(),U(7,"div",4)(8,"p"),X(9,"We were to successfully verify your details . As a part of our quality process we will request you to re-verify the information every 5months "),W()(),U(10,"div",5),no(11,IU,7,4,null,null,Yo),W()()),s&2&&(le(11),ro(t.items))},styles:['.container[_ngcontent-%COMP%]{width:92vw;padding:1rem;display:grid;row-gap:2rem}.para[_ngcontent-%COMP%]{background-color:#ef8c534d;width:90%;padding:1rem;border-radius:.5rem;color:#ffa800}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:green}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}input[type=checkbox][disabled][_ngcontent-%COMP%]{cursor:not-allowed;background-color:#f0f0f0}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.5rem;font-weight:500;line-height:19.36px}']});let c=o;return c})();var TU=["footer"],MU=c=>({active:c});function kU(c,o){if(c&1){let d=ai();U(0,"button",13),Ne("click",function(){let s=St(d).$implicit,t=it();return It(t.setActiveButton(s))}),X(1),W()}if(c&2){let d=o.$implicit,r=it();ze("ngClass",wi(2,MU,r.activeButton===d)),le(),Ni(" ",d," ")}}function EU(c,o){if(c&1){let d=ai();U(0,"span",20)(1,"a",21)(2,"span",6),X(3," call "),W()(),U(4,"span",22),Ne("click",function(){St(d);let s=it().$implicit,t=it();return It(t.navToChat(s.userId))}),X(5," chat "),W(),U(6,"span",22),Ne("click",function(){St(d);let s=it().$implicit,t=it();return It(t.navToArrived(s))}),X(7," directions "),W()()}}function DU(c,o){if(c&1&&(U(0,"div",14)(1,"span",15)(2,"span",16),X(3),W(),qt(4,EU,8,0,"span",17),W(),U(5,"span",16),X(6),W(),U(7,"span",18),X(8),W(),U(9,"span",19)(10,"span",18),X(11),W(),U(12,"span",16),X(13),W()(),U(14,"span",18),X(15),W()()),c&2){let d=o.$implicit;le(3),Xt(d.orderId==null||d.orderId.addressId==null?null:d.orderId.addressId.username),le(),ze("ngIf",d.status==="Accepted"||d.status==="InProgress"),le(2),Xt(d.orderId==null||d.orderId.categoryIds[0]==null?null:d.orderId.categoryIds[0].name),le(2),Xt(d.orderId==null||d.orderId.subCategoryIds[0]==null?null:d.orderId.subCategoryIds[0].name),le(3),Xt(d.orderId==null||d.orderId.items[0]==null?null:d.orderId.items[0].scheduledDate),le(2),Ni(" \u20B9 ",d.orderId.totalAmount,""),le(2),DE("",d.orderId.addressId==null?null:d.orderId.addressId.address," ",d.orderId.addressId.city," ",d.orderId.addressId.state," ",d.orderId.addressId.pincode,"")}}var tR=(()=>{let o=class o{constructor(r,s,t,g){this.location=r,this.router=s,this.razorpayService=t,this.orderService=g,this.buttons=["Ongoing","Pending","Accepted","Completed","Cancelled"],this.activeButton="Ongoing",this.text=this.activeButton,this.filterStatus="InProgress",this.order=[],this.filteredOrder=[],this.getCredits(),this.getOrderDetails()}getCredits(){this.razorpayService.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits},error:r=>{console.log(r)}})}navBack(){this.location.back()}getOrderDetails(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r),this.order=r.data,this.filterOrder()},error:r=>{console.log(r)}})}setActiveButton(r){this.activeButton=r,this.text=r,this.assignOrder()}assignOrder(){switch(this.activeButton){case"Ongoing":this.filterStatus="InProgress";break;case"Pending":this.filterStatus="Workstart";break;case"Accepted":this.filterStatus="Accepted";break;case"Completed":this.filterStatus="Completed";break;case"Cancelled":this.filterStatus="Cancelled";break}this.filterOrder()}filterOrder(){console.log(this.order),this.filteredOrder=this.order.filter(r=>r.status&&r.status.toLowerCase()===this.filterStatus.toLowerCase()),console.log(this.filteredOrder)}navTo(r){switch(r){case"credit":this.router.navigate(["credits"]);break;case"notification":this.router.navigate(["notification"]);break;case"menu":this.router.navigate(["menu"]);break}}navToArrived(r){this.activeButton==="Ongoing"?this.router.navigate(["completeWork",r._id]):this.activeButton==="Pending"&&this.router.navigate(["arrived",r._id])}navToChat(r){let s={role:"user",id:r};this.router.navigate(["help/chatbot"],{queryParams:s})}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(ii),_e(ks),_e(ta))},o.\u0275cmp=Et({type:o,selectors:[["app-ongoing"]],viewQuery:function(s,t){if(s&1&&Vi(TU,5),s&2){let g;zi(g=Bi())&&(t.footer=g.first)}},decls:21,vars:6,consts:[[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined","notranslate"],[1,"sub-container"],[1,"cat"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"content-container"],["class","content",4,"ngFor","ngForOf"],[2,"height","5rem"],[3,"click","ngClass"],[1,"content"],[1,"icons-div"],[1,"highlight-text"],["class","iconsss",4,"ngIf"],[1,"normal-text"],[1,"service-div"],[1,"iconsss"],["href","'tel:'+ item.orderId.address.mobileNumber"],[1,"material-symbols-outlined","notranslate",3,"click"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1),Ne("click",function(){return t.navTo("menu")}),X(2,"\u2630"),W(),U(3,"div",2)(4,"div",3),Ne("click",function(){return t.navTo("credit")}),Oe(5,"img",4),U(6,"pre"),X(7),wl(8,"number"),W()(),U(9,"div",5),Ne("click",function(){return t.navTo("notification")}),U(10,"span",6),X(11,"notifications"),W()()(),U(12,"div",7)(13,"div",8),qt(14,kU,2,4,"button",9),W(),U(15,"div",10),Oe(16,"br"),qt(17,DU,16,10,"div",11),W(),Oe(18,"br"),W()(),Oe(19,"div",12)(20,"app-fotter")),s&2&&(le(7),Xt(t.credits%1===0?t.credits:Cl(8,3,t.credits,"1.2-2")),le(7),ze("ngForOf",t.buttons),le(3),ze("ngForOf",t.filteredOrder))},dependencies:[Ko,Io,$n,dh,Gc],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#d16611;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:8rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:5rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border-radius:.4rem;border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh}.cat[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-evenly;flex-wrap:wrap}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px;border-bottom:2px solid transparent;cursor:pointer}.cat[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-bottom:1px solid #D70D09}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:border-bottom .3s}.content-container[_ngcontent-%COMP%]{width:100%;height:92%;overflow-y:auto;scroll-snap-type:y;scrollbar-width:none;display:flex;flex-direction:column;gap:2rem}.content[_ngcontent-%COMP%]{width:85%;height:max-content;display:flex;flex-direction:column;gap:.8rem 5% 0 5%;padding:.8rem 1.2rem;border:.25px solid rgb(127,126,126);border-radius:.5rem}.icons-div[_ngcontent-%COMP%]{width:100%;display:flex;gap:1rem;justify-content:space-between}.iconsss[_ngcontent-%COMP%]{display:flex;gap:1rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:21.94px;text-align:left;color:#000}.normal-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:300;line-height:19.73px;text-align:left;color:#000}']});let c=o;return c})();var AU=["videoPlayer"],PU=["activeVideo"];function OU(c,o){if(c&1){let d=ai();U(0,"div",10),Ne("click",function(){let s=St(d).index,t=it();return It(t.getVideoUrl(s))}),U(1,"div",11),Ne("click",function(){let s=St(d).index,t=it();return It(t.getVideoUrl(s))}),Oe(2,"img",12),W(),Oe(3,"br"),W()}}function RU(c,o){if(c&1){let d=ai();U(0,"div",13),Ne("click",function(){St(d);let s=it();return It(s.stopVideo())}),U(1,"video",14,0),Ne("ended",function(){St(d);let s=it();return It(s.onVideoEnded())})("timeupdate",function(){St(d);let s=xl(2),t=it();return It(t.preventSeek(s))})("loadedmetadata",function(){St(d);let s=xl(2),t=it();return It(t.onVideoLoaded(s))}),W()()}if(c&2){let d=it();le(),ze("src",d.getVideoUrl(d.currentVideoIndex),vr)}}function FU(c,o){if(c&1){let d=ai();U(0,"div")(1,"button",15),Ne("click",function(){St(d);let s=it();return It(s.navigateWaiting())}),X(2,"Go to Home"),W()()}}var iR=(()=>{let o=class o{navBack(){}constructor(r,s,t,g){this.http=r,this.tranningService=s,this.router=t,this.userService=g,this.videos=[],this.pupUp=!1,this.bucketName="coolie1-dev",this.region="ap-south-1",this.currentVideoIndex=0,this.lastTime=0,this.isVideoPlaying=!1,this.showNavigationButton=!1}ngOnInit(){this.getWork()}gettingVideos(){this.tranningService.gettingInductionVeideos().subscribe(r=>{console.log(r)},r=>{console.log(r)})}getWork(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r);let s=r.works.map(t=>t.categoryId._id);this.getVideosForIds(["6701477d6cdbd8a62eb1bafa"])},r=>{console.log(r)})}getVideosForIds(r){console.log(r),this.tranningService.getInductionVideosByIds(r).subscribe(s=>{console.log(s.flat()),this.videos=s.flat().filter(t=>t!==null)},s=>{console.log(s)})}playVideo(r){this.pupUp=!0,this.currentVideoIndex=r,this.isVideoPlaying=!0,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())}stopVideo(){this.isVideoPlaying=!1,this.activeVideo&&this.activeVideo.nativeElement&&this.activeVideo.nativeElement.pause()}skipVideo(){this.playNextVideo()}onVideoEnded(){this.pupUp=!1,this.playNextVideo()}onVideoLoaded(r){r.play()}preventSeek(r){r.currentTime>this.lastTime+1?r.currentTime=this.lastTime:this.lastTime=r.currentTime}playNextVideo(){this.currentVideoIndex<this.videos.length-1?(this.currentVideoIndex++,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())):(this.isVideoPlaying=!1,this.updateVideoStatus(),this.showNavigationButton=!0)}updateVideoStatus(){let r={providerId:localStorage.getItem("providerId"),isWatched:!0};this.tranningService.updatingWatchedVideo(r).subscribe({next:s=>{console.log(s),alert("Congrats you have completed the traning"),this.navigateWaiting()},error:s=>{console.log(s)}})}getVideoUrl(r){return console.log(this.videos,r),this.pupUp=!0,this.videos[r].video}navigateWaiting(){this.router.navigate(["waiting"])}};o.\u0275fac=function(s){return new(s||o)(_e(ji),_e(O0),_e(ii),_e(nr))},o.\u0275cmp=Et({type:o,selectors:[["app-induction"]],viewQuery:function(s,t){if(s&1&&(Vi(AU,5),Vi(PU,5)),s&2){let g;zi(g=Bi())&&(t.videoPlayer=g.first),zi(g=Bi())&&(t.activeVideo=g.first)}},decls:15,vars:5,consts:[["activeVideo",""],[1,"tittle-div"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-tittle-div"],[1,"container"],[1,"sub-container"],["class","videoss",3,"click",4,"ngFor","ngForOf"],["class","overlay",3,"click",4,"ngIf"],[4,"ngIf"],[1,"videoss",3,"click"],[1,"dummy-video",3,"click"],["src","assets/demo/video.png"],[1,"overlay",3,"click"],["controls","","autoplay","","type","video/mp4",1,"active-video",3,"ended","timeupdate","loadedmetadata","src"],[3,"click"]],template:function(s,t){s&1&&(U(0,"div",1)(1,"span",2),Ne("click",function(){return t.navBack()}),X(2,"arrow_back"),W(),U(3,"span",3),X(4,"Induction videos"),W()(),U(5,"div",4)(6,"span"),X(7," Complete the Training session!! "),W(),U(8,"span"),X(9," You will be moved to next process "),W()(),U(10,"div",5)(11,"div",6),qt(12,OU,4,0,"div",7),W()(),qt(13,RU,3,1,"div",8)(14,FU,3,0,"div",9)),s&2&&(le(10),Ki("blur",t.isVideoPlaying),le(2),ze("ngForOf",t.videos),le(),ze("ngIf",t.pupUp),le(),ze("ngIf",t.showNavigationButton))},dependencies:[Io,$n],styles:['.tittle-div[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin:1rem 0 2rem 1rem}.tittle[_ngcontent-%COMP%]{font-size:1.3rem;font-family:"inter" sans-serif;font-weight:500}.sub-tittle-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem;justify-content:center;text-align:center;margin-bottom:1rem}.sub-tittle-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-size:1.1rem;font-family:"inter" sans-serif;font-weight:500;color:red}.sub-tittle-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.1rem;font-family:"inter" sans-serif;font-weight:400;color:#0009}#video[_ngcontent-%COMP%]{width:100%}video[_ngcontent-%COMP%]{width:90%;height:360px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin-top:10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:space-around;align-items:center;text-align:center}.blur[_ngcontent-%COMP%]{filter:blur(5px)}video[_ngcontent-%COMP%]{width:300px;height:200px;margin:10px;cursor:pointer}.videoss[_ngcontent-%COMP%]{width:90%;display:grid;row-gap:2rem}.dummy-video[_ngcontent-%COMP%]{width:100%}.dummy-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:fixed;top:0%;width:100%;height:100%;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}.overlay[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.active-video[_ngcontent-%COMP%]{width:640px;height:360px}button[_ngcontent-%COMP%]{margin-top:10px;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{cursor:pointer}']});let c=o;return c})();var LU=()=>({backdropBorderRadius:"3px",backdropBackgroundColour:"rgba(0, 0, 0, 0.5)"});function zU(c,o){if(c&1&&Oe(0,"ngx-loading",10),c&2){let d=it();ze("show",d.loading)("config",Zp(2,LU))}}var nR=(()=>{let o=class o{constructor(r,s,t){this.logInService=r,this.router=s,this.http=t,this.loading=!1,this.status=!1,this.loading=!0,this.checkinductionVideosStatus()}navTo(){console.log(localStorage.getItem("providerId")),localStorage.getItem("providerId")?this.status?this.router.navigate(["home"]):this.router.navigate(["induction"]):this.router.navigate(["selectAccount"])}checkinductionVideosStatus(){let r=localStorage.getItem("providerId"),s=`${_n}providers/provider-watched-video/${r}`;this.http.get(s).subscribe({next:t=>{console.log(t),this.loading=!1,this.status=t.isWatched},error:t=>{this.loading=!1,console.log(t),this.status=!0}})}};o.\u0275fac=function(s){return new(s||o)(_e(Br),_e(ii),_e(ji))},o.\u0275cmp=Et({type:o,selectors:[["app-start"]],decls:18,vars:1,consts:[["id","main"],[1,"container"],[1,"logo"],["src","assets/logo/logo png1.png","alt","Coolie No. 1"],[1,"check"],[1,"content"],["src","assets/location/login-home-services-image.png","alt","Worker",1,"worker-image"],[1,"text"],[1,"cta-button",3,"click"],["src","assets/new/arrow.png"],[3,"show","config"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"div",2),Oe(3,"img",3),W()(),U(4,"div",4)(5,"div",5),Oe(6,"img",6),U(7,"div",7)(8,"span"),X(9,"Home "),U(10,"span"),X(11,"SERVICES"),W()(),U(12,"span"),X(13,"at your Door Step"),W(),U(14,"button",8),Ne("click",function(){return t.navTo()}),X(15,"Let's Go \xA0 "),Oe(16,"img",9),W()()()()(),qt(17,zU,1,3,"ngx-loading",10)),s&2&&(le(17),hr(17,t.loading?17:-1))},dependencies:[nf],styles:["#main[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100vh;background:radial-gradient(circle at bottom right,#cd2e28 60%,#fff 40%)}.container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;flex:0 0 40%}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80%;max-width:300px;margin-bottom:20px}.content[_ngcontent-%COMP%]{width:100%;position:relative;display:flex;flex-direction:column;align-items:center}.worker-image[_ngcontent-%COMP%]{width:50%;height:50%}.check[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;flex:0 0 60%}.text[_ngcontent-%COMP%]{margin-top:5%;text-align:center;display:flex;flex-direction:column}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Roboto;font-size:1.5rem;color:#fff}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-weight:300;line-height:1.6rem}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1)   span[_ngcontent-%COMP%]{font-weight:500}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.1rem;font-weight:300;line-height:1.4rem}.cta-button[_ngcontent-%COMP%]{background-color:transparent;color:#ffffffde;border:none;padding:22px 30px;font-size:1.5rem;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;border-radius:5px}.cta-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:38px;height:28px}"]});let c=o;return c})();function BU(c,o){c&1&&(U(0,"span"),X(1,"\u2192"),W())}function NU(c,o){c&1&&(U(0,"span"),X(1,"\u2714"),W())}function VU(c,o){c&1&&(U(0,"span"),X(1,"\u2192"),W())}function jU(c,o){c&1&&(U(0,"span"),X(1,"\u2714"),W())}var rR=(()=>{let o=class o{constructor(r,s,t){this.loginService=r,this.router=s,this.jobDetailsService=t,this.isExistingActive=!1,this.isNewActive=!1,this.startX=0,this.currentX=0,this.sliderPosition=5,this.isDragging=!1;let g=localStorage.getItem("providerId");this.jobDetailsService.getUserDetails(g)}onTouchStart(r,s){this.startX=r.touches[0].clientX,this.isDragging=!0}onTouchMove(r,s){this.isDragging&&(this.currentX=r.touches[0].clientX-this.startX,this.updateSliderPosition(this.currentX,s))}onTouchEnd(r){this.isDragging=!1,this.checkFinalPosition(r)}onMouseDown(r,s){this.startX=r.clientX,this.isDragging=!0}onMouseMove(r,s){this.isDragging&&(this.currentX=r.clientX-this.startX,this.updateSliderPosition(this.currentX,s))}onMouseUp(r){this.isDragging=!1,this.checkFinalPosition(r)}updateSliderPosition(r,s){if(s==="existing"){let w=Math.min(Math.max(5,5+r),240);this.sliderPosition=w}else if(s==="new"){let w=Math.min(Math.max(5,5+r),240);this.sliderPosition=w}}checkFinalPosition(r){r==="existing"?this.sliderPosition>150&&!this.isExistingActive?(this.isExistingActive=!0,this.sliderPosition=240,this.onToggleChange("existing")):(this.sliderPosition=5,this.isExistingActive=!1):r==="new"&&(this.sliderPosition>150&&!this.isNewActive?(this.isNewActive=!0,this.sliderPosition=240,this.onToggleChange("new")):(this.sliderPosition=5,this.isNewActive=!1))}onToggleChange(r){r==="existing"?this.navigateBasedOnAccount():r==="new"&&setTimeout(()=>{this.router.navigate(["log-in"])},1e3)}navigateBasedOnAccount(){localStorage.getItem("providerId")?this.jobDetailsService.userDetails?setTimeout(()=>{this.router.navigate(["home"])},1e3):setTimeout(()=>{this.router.navigate(["aboutUser"])},1e3):setTimeout(()=>{this.router.navigate(["log-in"])},1e3)}};o.\u0275fac=function(s){return new(s||o)(_e(Br),_e(ii),_e(ea))},o.\u0275cmp=Et({type:o,selectors:[["app-select-account"]],decls:23,vars:8,consts:[[1,"container"],[1,"sub-container"],[1,"sp-div"],[1,"img-div"],["src","assets/logo/start2.png","alt","Logo"],[1,"slide-container",3,"touchstart","touchmove","touchend","mousedown","mousemove","mouseup"],[1,"placehlder"],[1,"slider"],[4,"ngIf"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),X(4,"Hey!"),W(),U(5,"span"),X(6,"Join now"),W()(),U(7,"div",3),Oe(8,"img",4),W(),U(9,"div",5),Ne("touchstart",function(w){return t.onTouchStart(w,"existing")})("touchmove",function(w){return t.onTouchMove(w,"existing")})("touchend",function(){return t.onTouchEnd("existing")})("mousedown",function(w){return t.onMouseDown(w,"existing")})("mousemove",function(w){return t.onMouseMove(w,"existing")})("mouseup",function(){return t.onMouseUp("existing")}),U(10,"div",6)(11,"span"),X(12,"Existing Provider"),W()(),U(13,"div",7),qt(14,BU,2,0,"span",8)(15,NU,2,0,"span",8),W()(),U(16,"div",5),Ne("touchstart",function(w){return t.onTouchStart(w,"new")})("touchmove",function(w){return t.onTouchMove(w,"new")})("touchend",function(){return t.onTouchEnd("new")})("mousedown",function(w){return t.onMouseDown(w,"new")})("mousemove",function(w){return t.onMouseMove(w,"new")})("mouseup",function(){return t.onMouseUp("new")}),U(17,"div",6)(18,"span"),X(19,"New Provider"),W()(),U(20,"div",7),qt(21,VU,2,0,"span",8)(22,jU,2,0,"span",8),W()()()()),s&2&&(le(13),Ki("active",t.isExistingActive),le(),ze("ngIf",!t.isExistingActive),le(),ze("ngIf",t.isExistingActive),le(5),Ki("active",t.isNewActive),le(),ze("ngIf",!t.isNewActive),le(),ze("ngIf",t.isNewActive))},dependencies:[$n],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;align-items:center;justify-content:center;background-color:#f5f5f5}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:400px;display:flex;flex-direction:column;align-items:center;row-gap:1rem}.sp-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:left}span[_ngcontent-%COMP%]{float:left;font-family:Poppins,sans-serif;font-size:24px;font-weight:600;line-height:36px;text-align:left}.img-div[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.img-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.slide-container[_ngcontent-%COMP%]{width:100%;height:50px;background-color:#d16611;border-radius:25px;position:relative;display:flex;align-items:center}.slider[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#000;font-size:14px;font-weight:200;position:absolute;left:calc(var(--sliderPosition, 5px));transition:left .3s}.slider.active[_ngcontent-%COMP%]{left:80%}.placehlder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:50px;font-family:"Poppins" sans-serif;font-size:16px;font-weight:400;color:#fff}']});let c=o;return c})();var oR=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275cmp=Et({type:o,selectors:[["app-congrats"]],decls:14,vars:0,consts:[[1,"main"],[1,"container"],["src","assets/new/congrats.png"],[1,"text"],[1,"arrow-container"],["src","assets/new/round arrow.png"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"div"),Oe(3,"img",2),W(),Oe(4,"br"),U(5,"div",3)(6,"p"),X(7,"congratulations"),W(),U(8,"p"),X(9,"You have completed induction videos"),W(),U(10,"p"),X(11,"you are now. Partner of Coolieno1! You are successfully on boarded."),W()()(),U(12,"div",4),Oe(13,"img",5),W()())},styles:['.main[_ngcontent-%COMP%]{width:100%;height:100vh}.container[_ngcontent-%COMP%]{width:100%;display:grid;row-gap:1rem;align-items:center;justify-content:center;text-align:center;position:relative;top:15%}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;height:max-content}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){width:100%;display:flex;align-items:center;justify-content:center}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:130px;height:130px}.arrow-container[_ngcontent-%COMP%]{position:fixed;bottom:10%;left:40%;display:flex;align-items:center;justify-content:center}.text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(1){font-family:"Archivo" sans-serif Black;font-size:1.2rem;font-weight:600;line-height:17.41px;letter-spacing:.04em}.text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(2){font-family:"inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;letter-spacing:.04em}']});let c=o;return c})();var UU=c=>({"first-package":c,package:!0});function WU(c,o){c&1&&(U(0,"span"),X(1," Activated Package "),W())}function HU(c,o){if(c&1){let d=ai();U(0,"p",7)(1,"span"),X(2,"UPGRADE TO"),W(),U(3,"button",14),Ne("click",function(){St(d);let s=it().$implicit,t=it();return It(t.buy(s))}),X(4,"Buy Now"),W()()}if(c&2){let d=it().$implicit,r=it();le(3),ze("disabled",r.isPackageActivated(d))}}function GU(c,o){c&1&&(U(0,"span"),X(1,"Amount Payable"),W())}function qU(c,o){if(c&1&&(U(0,"div",6),Oe(1,"br"),U(2,"div")(3,"p",7),qt(4,WU,2,0,"span",8)(5,HU,5,1,"ng-template",null,0,Ag),W(),U(7,"p",9),Oe(8,"img",10),X(9," \xA0"),U(10,"span"),X(11),W()(),U(12,"p",7)(13,"span")(14,"span",11),X(15,"Current"),W(),X(16," \xA0 "),U(17,"span",12),X(18,"lock_open"),W()(),U(19,"span"),X(20),W()(),U(21,"ul")(22,"li"),X(23),W(),U(24,"li"),X(25),W()(),U(26,"p",7),qt(27,GU,2,0,"span",13),U(28,"span"),X(29),W()()()()),c&2){let d=o.$implicit,r=xl(6),s=it();ze("ngClass",wi(11,UU,d.packageName==="silver")),le(4),ze("ngIf",s.isPackageActivated(d))("ngIfElse",r),le(4),ze("src",d.image,vr),le(3),Xt(d.packageName),le(9),ss(" ",s.isPackageActivated(d)?"Expiry":"Validity"," : ",s.isPackageActivated(d)?s.getExpiryDate(d.packageName):d.validity," "),le(3),Ni("",d.noOfJobOffers," jobs"),le(2),Ni("",d.discountPlatformCom," % discount on platform commission"),le(2),ze("ngIf",!s.isEnrolled),le(2),Ni("\u20B9 ",d.priceRs,"")}}var aR=(()=>{let o=class o{constructor(r,s,t,g){this.userDetails=r,this.location=s,this.razorPayService=t,this.dailougeBoxService=g,this.isEnrolled=!0,this.packages=[],this.purchasedPackages=[],this.getPackage(),this.getPurchasedPackages()}navToBack(){this.location.back()}getPackage(){this.userDetails.getPackages().subscribe(r=>{console.log(r),this.packages=r},r=>{console.log(r)})}getPurchasedPackages(){let r=localStorage.getItem("providerId");this.userDetails.getPurchasedPackages(r).subscribe(s=>{console.log("Purchased packages:",s),this.purchasedPackages=s,this.userDetails.buyedPackage=s,this.getExpiryDate(s.packageName)},s=>{console.error("Error fetching purchased packages:",s)})}getExpiryDate(r){let s=this.purchasedPackages.find(t=>t.packageName===r);return s?s.expiryDate.split("T")[0]:"N/A"}isPackageActivated(r){return this.purchasedPackages.some(s=>s.packageName===r.packageName)}buy(r){if(this.isAnyPackageActivated()){this.dailougeBoxService.openDialog("You already have an active package. Please wait until it expires.");return}if(!this.validatePackageData(r)){this.dailougeBoxService.openDialog("Package data is not valid. Please check the package details.");return}let s=r.priceRs,t="INR";this.razorPayService.createOrder(s).subscribe({next:g=>{console.log("Order created:",g),this.payWithRazorpay(s,g.id,t,r)},error:g=>{console.error("Error creating order:",g),this.dailougeBoxService.openDialog(g.error.message)}})}isAnyPackageActivated(){return this.purchasedPackages.length>0&&this.purchasedPackages.some(r=>new Date(r.expiryDate)>new Date)}validatePackageData(r){return r&&r.packageName&&r.priceRs&&r.discountPlatformCom!==void 0&&r.comments&&r.validity&&r.image}payWithRazorpay(r,s,t,g){let w={key:"rzp_test_b8XfUOQ4u8dlSq",amount:r*100,currency:t,name:"Coolie no.1",description:"Test Transaction",image:"assets/location/logo-v3 3.png",handler:F=>{console.log(F),this.addPackages(F.razorpay_payment_id,g)},prefill:{name:"Customer Name",email:"customer@example.com",contact:"9999999999"},theme:{color:"#3399cc"},modal:{ondismiss:function(){console.log("Checkout form closed")}}};new Razorpay(w).open()}addPackages(r,s){let g={providerId:localStorage.getItem("providerId"),packageName:s.packageName,priceRs:s.priceRs,discountPlatformCom:s.discountPlatformCom,validity:s.validity,paymentId:r,image:s.image};console.log("Request Body:",g),this.userDetails.buyingPackages(g).subscribe({next:w=>{console.log("Package added successfully:",w),this.getPurchasedPackages()},error:w=>{console.error("Error adding package:",w),this.dailougeBoxService.openDialog(w.error.message)}})}};o.\u0275fac=function(s){return new(s||o)(_e(nr),_e(yi),_e(ks),_e(mr))},o.\u0275cmp=Et({type:o,selectors:[["app-packages"]],decls:6,vars:1,consts:[["buyButton",""],[1,"container"],[1,"sub-container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"upgrade"],[4,"ngIf","ngIfElse"],[1,"package-name"],[3,"src"],[1,"Current"],[1,"material-symbols-outlined","notranslate",2,"font-size","1rem"],[4,"ngIf"],[3,"click","disabled"]],template:function(s,t){s&1&&(U(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),Ne("click",function(){return t.navToBack()}),X(4,"arrow_back"),W()(),qt(5,qU,30,13,"div",5),W()()),s&2&&(le(5),ze("ngForOf",t.packages))},dependencies:[Ko,Io,$n],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:670px;position:relative;top:2%;left:5%;display:flex;flex-direction:column;gap:2rem}.arrow[_ngcontent-%COMP%]{width:100%;display:flex;text-align:center}.tittle[_ngcontent-%COMP%]{width:80%;font-family:"Inter" sans-serif;font-size:22px;font-weight:500;line-height:26.63px;text-align:center}.package[_ngcontent-%COMP%]{border-radius:.6rem;background-color:#414141}.first-package[_ngcontent-%COMP%]{background:#605c5c}.package[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;width:90%;left:5%;top:5%;display:flex;flex-direction:column;gap:.5rem}.upgrade[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.upgrade[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px;text-align:left;color:#fff}.package-name[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center}.package-name[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem}.package-name[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], li[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px;text-align:left;color:#fff}.upgrade[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff}.Current[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:18px;font-weight:500;line-height:21.78px;text-align:left;color:#fff}.material-symbols-outlined[_ngcontent-%COMP%]{font-variation-settings:"FILL" 0,"wght" 400,"GRAD" 0,"opsz" 20}button[_ngcontent-%COMP%]{background-color:transparent;border:1px solid rgba(212,175,55,1);color:#d4af37;border-radius:.2rem}ul[_ngcontent-%COMP%]{float:left}']});let c=o;return c})();var $U=["videoPlayer"],YU=["activeVideo"];function ZU(c,o){if(c&1){let d=ai();U(0,"div",6),Ne("click",function(){let s=St(d).index,t=it();return It(t.getVideoUrl(s))}),U(1,"div",7),Ne("click",function(){let s=St(d).index,t=it();return It(t.getVideoUrl(s))}),Oe(2,"img",8),W(),Oe(3,"br"),W()}}function XU(c,o){if(c&1){let d=ai();U(0,"div",9),Ne("click",function(){St(d);let s=it();return It(s.stopVideo())}),U(1,"video",10,0),Ne("ended",function(){St(d);let s=it();return It(s.onVideoEnded())})("timeupdate",function(){St(d);let s=xl(2),t=it();return It(t.preventSeek(s))})("loadedmetadata",function(){St(d);let s=xl(2),t=it();return It(t.onVideoLoaded(s))}),W()()}if(c&2){let d=it();le(),ze("src",d.getVideoUrl(d.currentVideoIndex),vr)}}var sR=(()=>{let o=class o{navBack(){this.location.back()}constructor(r,s,t,g){this.http=r,this.tranningService=s,this.userService=t,this.location=g,this.videos=[],this.pupUp=!1,this.bucketName="coolie1-dev",this.region="ap-south-1",this.currentVideoIndex=0,this.lastTime=0,this.isVideoPlaying=!1}ngOnInit(){this.getWork()}getWork(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r);let s=r.works.map(t=>t.serviceId._id);this.getVideosForIds(["670ebee772f9da361fe4cdc4","670ebed072f9da361fe4cd1c"])},r=>{console.log(r)})}getVideosForIds(r){console.log(r),this.tranningService.getVideosByIds(r).subscribe(s=>{console.log(s.flat()),this.videos=s.flat().filter(t=>t!==null)},s=>{console.log(s)})}playVideo(r){this.pupUp=!0,console.log(this.pupUp),this.currentVideoIndex=r,this.isVideoPlaying=!0,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())}stopVideo(){this.isVideoPlaying=!1,this.activeVideo&&this.activeVideo.nativeElement&&this.activeVideo.nativeElement.pause()}skipVideo(){this.playNextVideo()}onVideoEnded(){console.log("ended"),this.pupUp=!1}onVideoLoaded(r){r.play()}preventSeek(r){r.currentTime>this.lastTime+1?r.currentTime=this.lastTime:this.lastTime=r.currentTime}playNextVideo(){this.currentVideoIndex<this.videos.length-1?(this.currentVideoIndex++,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())):this.isVideoPlaying=!1}getVideoUrl(r){return this.pupUp=!0,console.log(this.pupUp),this.videos[r].video}};o.\u0275fac=function(s){return new(s||o)(_e(ji),_e(O0),_e(nr),_e(yi))},o.\u0275cmp=Et({type:o,selectors:[["app-training"]],viewQuery:function(s,t){if(s&1&&(Vi($U,5),Vi(YU,5)),s&2){let g;zi(g=Bi())&&(t.videoPlayer=g.first),zi(g=Bi())&&(t.activeVideo=g.first)}},decls:11,vars:4,consts:[["activeVideo",""],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"container"],[1,"sub-container"],["class","videoss",3,"click",4,"ngFor","ngForOf"],["class","overlay",3,"click",4,"ngIf"],[1,"videoss",3,"click"],[1,"dummy-video",3,"click"],["src","assets/demo/video.png"],[1,"overlay",3,"click"],["controls","","autoplay","","type","video/mp4",1,"active-video",3,"ended","timeupdate","loadedmetadata","src"]],template:function(s,t){s&1&&(Oe(0,"br")(1,"br"),X(2,"\xA0\xA0 \xA0"),U(3,"span",1),Ne("click",function(){return t.navBack()}),X(4,"arrow_back"),W(),Oe(5,"br")(6,"br"),U(7,"div",2)(8,"div",3),qt(9,ZU,4,0,"div",4),W()(),qt(10,XU,3,1,"div",5)),s&2&&(le(7),Ki("blur",t.isVideoPlaying),le(2),ze("ngForOf",t.videos),le(),ze("ngIf",t.pupUp))},dependencies:[Io,$n],styles:["#video[_ngcontent-%COMP%]{width:100%}video[_ngcontent-%COMP%]{width:90%;height:360px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin-top:10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:space-around;align-items:center;text-align:center}.blur[_ngcontent-%COMP%]{filter:blur(5px)}video[_ngcontent-%COMP%]{width:300px;height:200px;margin:10px;cursor:pointer}.videoss[_ngcontent-%COMP%]{width:90%;display:grid;row-gap:2rem}.dummy-video[_ngcontent-%COMP%]{width:100%}.dummy-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:fixed;top:0%;width:100%;height:100%;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}.overlay[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.active-video[_ngcontent-%COMP%]{width:100%;height:100%}button[_ngcontent-%COMP%]{margin-top:10px;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{cursor:pointer}"]});let c=o;return c})();var Ds=(()=>{let o=class o{constructor(r){this.http=r,this.apiUrl=_n}getOrderDetails(r){let s=`${this.apiUrl}users/order/order/${r}`;return this.http.get(s)}getOrderHistoryId(r){let s=`${this.apiUrl}users/order-history/order/${r}`;return this.http.get(s)}getOrderFromOrderId(r){let s=`${this.apiUrl}users/order/order/${r}`;return this.http.get(s)}uploadBeforeWorkImage(r){let s=`${this.apiUrl}users/order-history/before-work-upload-image`;return this.http.post(s,r)}gettingStatus(r){let s=`${this.apiUrl}users/order-history/order/${r}`;return this.http.get(s)}uploadAfterWorkImage(r){let s=`${this.apiUrl}users/order-history/after-work-upload-image`;return this.http.post(s,r)}feedBack(r){let s=`${this.apiUrl}users/user-feedback`;return this.http.post(s,r)}};o.\u0275fac=function(s){return new(s||o)(wt(ji))},o.\u0275prov=ci({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var lR=(()=>{let o=class o{constructor(r,s,t,g,w,M,F,N,Q,ae){this.router=r,this.jobDetailsService=s,this.orderService=t,this.mapboxService=g,this.routerParam=w,this.location=M,this.http=F,this.afterOrderService=N,this.googleMapService=Q,this.getOrderService=ae,this.timeLeft=120,this.providerCurrentLocationPlace="",this.current=0,this.max=120,this.radius=100,this.color="rgba(255, 0, 0, 1)",this.background="rgba(253, 5, 0, 0.4)",this.cancelRate=0,this.workingHours=0,this.credits=0,this.userAddress="",this.userCoordinates=[0,0],this.orderIds=[],this.orderId="",this.extractedDetails=[],this.serviceName=[{name:"cleaning"},{name:"tank cleaning"},{name:"tankcleaning"}],this.availabilityResponse=[],this.availabilityId="",this.workSeleceted=this.jobDetailsService.workDetails}ngOnInit(){this.getProvderLocation(),this.startTimer(),this.getOrderId()}startTimer(){this.interval=setInterval(()=>{this.timeLeft>0?(this.timeLeft--,this.current=this.timeLeft):(clearInterval(this.interval),this.getOrderService.clearOrderId(),this.router.navigate(["home"]))},1e3)}ngOnDestroy(){clearInterval(this.interval)}get minutes(){return Math.floor(this.timeLeft/60)}get seconds(){return this.timeLeft%60}getCartId(r){let s=this.order._id,t=g=>{let w=setInterval(()=>{if(this.acceptStatus)if(clearInterval(w),this.acceptStatus){this.acceptStatus=!1,this.acceptedOrder(),console.log("User accepted, exiting the loop");return}else console.log("User declined, moving to the next item"),this.acceptStatus=!1,t(g+1)},1e3);setTimeout(()=>{this.acceptStatus===null&&(clearInterval(w),console.log("Automatically moving to the next item"),t(g+1))},12e4)};t(0)}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{console.log(r);let s=r.get("id");this.getOrderDetails(s)},error:r=>{console.log(r)}})}getOrderDetails(r){r&&(this.orderId=r,console.log(r),this.afterOrderService.getOrderFromOrderId(r).subscribe({next:s=>{console.log(s),this.order=s,this.getUserLocation(),this.getAvailability()},error:s=>{console.log(s)}}))}accepted(){this.acceptStatus=!0,this.acceptedOrder()}declined(){this.acceptStatus=!1,console.log("declined"),this.acceptStatus=!1,this.timeLeft=120,this.getOrderService.clearOrderId(),this.router.navigate(["home"])}acceptedOrder(){console.log("order accepted"),this.orderService.accept(this.orderId,this.order.totalAmount,this.order.userId._id).subscribe(r=>{console.log(r),this.upadtingStartAndJobEndTime(),setTimeout(()=>{this.router.navigate(["arrived",r.orderHistory.orderId])},2e3)},r=>{console.log(r)})}getProvderLocation(){this.googleMapService.getCoordinates().subscribe({next:r=>{console.log(r),this.providerCurrentLocation=r,this.getPlaceNameFromCorr(this.providerCurrentLocation,"provider")},error:r=>{console.log(r)}})}getUserLocation(){console.log("cing user");let r="user",s=this.order.addressId;console.log(this.order);let t={lat:s.latitude,lng:s.longitude};this.getPlaceNameFromCorr(t,r)}getPlaceNameFromCorr(r,s){this.googleMapService.getPlaceNameFromCoordinates(r.lat,r.lng).pipe(yE(1e4),CE(2),Ro(t=>(console.error("Failed to get place name:",t),Ln({results:[{formatted_address:"Unknown Location"}]})))).subscribe({next:t=>{let g=t.results[0].formatted_address||"Unknown Location";s==="provider"?(this.providerCurrentLocationPlace=g,console.log("Provider location:",g)):s==="user"&&(this.userAddress=g,console.log("User location:",g))},error:t=>{console.error("Error fetching place name:",t)}})}getAvailability(){let r=localStorage.getItem("providerId"),s=`${_n}providers/provider-date/${r}`;this.http.get(s).subscribe(t=>{console.log(t),this.availabilityResponse=t,this.availabilityId=this.getIdOfAvaibility()},t=>{console.log(t)})}getIdOfAvaibility(){let r=this.order.items[0].scheduledDate.split(" ")[0],s=this.order.items[0].scheduledDate.split(" ")[1];console.log(r,s,"date and time from order id");let t=this.formatDate(r),g=this.availabilityResponse.filter(w=>{let M=new Date(w.slotTime.date).toISOString().split("T")[0];if(console.log(M,t,"slotdate and inputdate"),M!==t)return!1;let[F,N]=w.slotTime.time.split("-"),[Q,ae]=s.match(/(\d+)(AM|PM)/)?.slice(1)||[];if(!Q||!ae)return!1;let pe=this.convertTo24HourFormat(F.slice(0,2),F.slice(2)),Te=this.convertTo24HourFormat(N.slice(0,2),N.slice(2)),Pe=this.convertTo24HourFormat(Q,ae);return Pe>=pe&&Pe<Te&&w.availability})[0];return console.log(g),g?g._id:null}formatDate(r){let s=r.split("-");return s[0].length===2?`${s[2]}-${s[1]}-${s[0]}`:r}convertTo24HourFormat(r,s){let t=parseInt(r);return s==="PM"&&t<12&&(t+=12),s==="AM"&&t===12&&(t=0),t}upadtingStartAndJobEndTime(){let r=`${_n}providers/provider-date/${this.availabilityId}`,s=this.order.items[0].scheduledDate.split(" ")[0],t=this.order.items[0].scheduledDate.split(" ")[1],g=this.add30Minutes(t),w={jobStartTime:this.order.items[0].scheduledDate,jobEndTime:`${s} ${g}`};console.log(w),this.http.patch(r,w).subscribe({next:M=>{console.log("updated the start and end time",M)},error:M=>{console.log(M)}})}add30Minutes(r){let[s,t]=r.match(/(\d+)(AM|PM)/)?.slice(1)||[];if(!s||!t)return r;let g=this.convertTo24HourFormat(s,t),w=30+this.order.items[0].serviceId.serviceTime,M=g*60+w,F=Math.floor(M/60)%24,N=M%60,Q=F>=12?"PM":"AM";return`${F%12||12}:${N.toString().padStart(2,"0")}${Q}`}};o.\u0275fac=function(s){return new(s||o)(_e(ii),_e(ea),_e(ta),_e(R0),_e(Ts),_e(yi),_e(ji),_e(Ds),_e(ch),_e(P0))},o.\u0275cmp=Et({type:o,selectors:[["app-get-order"]],decls:60,vars:16,consts:[[1,"container"],[1,"timer"],[3,"current","max","color","background","radius","rounded","stroke"],[1,"timer-container"],[1,"time"],[1,"location-container"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],[1,"line"],[1,"address"],[1,"location-txt"],[1,"location"],[1,"service-details"],[1,"main-Text"],[1,"value-Text"],[1,"acc-rej-btns"],[3,"click"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1),Oe(2,"round-progress",2),U(3,"div",3)(4,"p",4)(5,"span"),X(6),W(),U(7,"span"),X(8,"Time left"),W()()()(),U(9,"div",5)(10,"div")(11,"span",6),X(12," location_on "),W(),Oe(13,"div",7),U(14,"span",6),X(15," location_on "),W()(),U(16,"div",8)(17,"p")(18,"span",9),X(19,"My location"),W(),U(20,"span",10),X(21),W()(),Oe(22,"br")(23,"br"),U(24,"p")(25,"span",9),X(26,"User location"),W(),U(27,"span",10),X(28),W()()()(),U(29,"div",11)(30,"span")(31,"span",12),X(32,"Category Type :"),W(),U(33,"span",13),X(34),W()(),U(35,"span")(36,"span",12),X(37,"SubService Type :"),W(),U(38,"span",13),X(39),W()(),U(40,"span")(41,"span",12),X(42,"Service Name :"),W(),U(43,"span",13),X(44),W()(),U(45,"span")(46,"span",12),X(47,"Price :"),W(),U(48,"span",13),X(49),W()(),U(50,"span")(51,"span",12),X(52,"Schedule :"),W(),U(53,"span",13),X(54),W()()(),U(55,"div",14)(56,"button",15),Ne("click",function(){return t.declined()}),X(57,"Reject"),W(),U(58,"button",15),Ne("click",function(){return t.accepted()}),X(59,"Accept"),W()()()),s&2&&(le(2),ze("current",t.current)("max",t.max)("color",t.color)("background",t.background)("radius",t.radius)("rounded",!0)("stroke",10),le(4),ss("",t.minutes,":",t.seconds<10?"0"+t.seconds:t.seconds,""),le(15),Xt(t.providerCurrentLocationPlace),le(7),Xt(t.userAddress),le(6),Xt(t.order==null||t.order.items[0].categoryId==null?null:t.order.items[0].categoryId.name),le(5),Xt(t.order==null||t.order.items[0].subCategoryId==null?null:t.order.items[0].subCategoryId.name),le(5),Xt(t.order==null||t.order.items[0].serviceId==null?null:t.order.items[0].serviceId.name),le(5),Xt(t.order==null?null:t.order.totalAmount),le(5),Xt(t.order==null||t.order.items[0]==null?null:t.order.items[0].scheduledDate))},dependencies:[cw],styles:[".container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;top:5%;left:2.5%;display:flex;flex-direction:column;gap:2rem}.timer[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.timer-container[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center}.time[_ngcontent-%COMP%]{font-size:2em;text-align:center;display:flex;flex-direction:column;gap:.5rem}.time[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1rem}.location-container[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:10% 80%}.location-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){display:flex;flex-direction:column;align-items:center;justify-content:center}.line[_ngcontent-%COMP%]{width:1px;height:6rem;border-left:.25px dashed black}.address[_ngcontent-%COMP%], .address[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-align:left}.location-txt[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:500}.location[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:.9rem;font-weight:400;color:#b8b8b8}.service-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.main-Text[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:500;color:#5a5a5a80}.value-Text[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:400;color:#515151}.acc-rej-btns[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-around}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:150px;height:50px;border:none;border-radius:.4rem;font-family:Inter,sans-serif;font-size:1rem;font-weight:500;letter-spacing:1px;color:#fff;text-align:center}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#d70d09}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:#409000}"]});let c=o;return c})();var QU=["map"],cR=(()=>{let o=class o{constructor(r,s,t,g,w,M,F,N){this.router=r,this.routerParam=s,this.mapboxService=t,this.orderService=g,this.location=w,this.googleMapsService=M,this.dailogeBoxService=F,this.afterOrderService=N,this.toggleChecked=!1,this.distanceThreshold=200,this.orderHistoryId=""}ngOnInit(){this.userFullAddress=this.orderService.userFullAddress,this.getOrderId()}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:s=>{console.log(s),this.order=s,this.getUserLocation()},error:s=>{console.log(s)}}))}getUserLocation(){console.log("cing user");let r="user",s=this.order?.addressId;console.log(this.order);let t={lat:s?.latitude,lng:s?.longitude};this.userCoordinates=t,this.initializeMap()}initializeMap(){this.googleMapsService.getCoordinates().subscribe({next:r=>{if(!r){console.error("Provider coordinates are null");return}if(this.providerCoordinates=r,!this.userCoordinates){console.error("User coordinates are null");return}this.googleMapsService.initializeMap(this.providerCoordinates,this.mapElement.nativeElement),this.googleMapsService.addProviderMarker(this.providerCoordinates),this.googleMapsService.addUserMarker(this.userCoordinates),this.googleMapsService.showDirections(this.userCoordinates,this.providerCoordinates),this.trackProviderAndCheckArrival(),this.getUserFullAddress()},error:r=>{console.error("Error fetching provider coordinates:",r)}})}getUserFullAddress(){let r=this.userCoordinates.lat,s=this.userCoordinates.lng;this.googleMapsService.getPlaceNameFromCoordinates(r,s).subscribe({next:t=>{console.log("user full address",t),console.log(t.results[0].formatted_address),this.userFullAddress=t.results[0].formatted_address}})}trackProviderAndCheckArrival(){this.locationTrackingSubscription=this.googleMapsService.trackProviderLocation().subscribe(r=>{this.providerCoordinates=r,this.googleMapsService.updateProviderMarker(this.providerCoordinates);let s=this.googleMapsService.calculateDistance(this.userCoordinates.lat,this.userCoordinates.lng,this.providerCoordinates.lat,this.providerCoordinates.lng);console.log("Distance between user and provider:",s),this.googleMapsService.showDirections(this.userCoordinates,this.providerCoordinates),s<=this.distanceThreshold&&(this.toggleChecked=!0)})}navTOBack(){this.location.back()}toggleDisplay(r){this.toggleChecked&&(console.log("Arrived at user location"),this.router.navigate(["startWork",this.orderHistoryId])),console.log("Arrived at user location"),this.router.navigate(["startWork",this.orderHistoryId])}handleDisabledClick(){console.log("insideeeeeeee"),this.toggleChecked||this.dailogeBoxService.openDialog("You are not arrives at location.")}cancel(){console.log(this.orderHistoryId),this.orderService.cancelOrder(this.orderHistoryId).subscribe(r=>{console.log(r),this.router.navigate(["home"])},r=>{console.log(r)})}ngOnDestroy(){this.locationTrackingSubscription&&(this.locationTrackingSubscription.unsubscribe(),console.log("Stopped tracking provider\u2019s location."))}};o.\u0275fac=function(s){return new(s||o)(_e(ii),_e(Ts),_e(R0),_e(ta),_e(yi),_e(ch),_e(mr),_e(Ds))},o.\u0275cmp=Et({type:o,selectors:[["app-arvied"]],viewQuery:function(s,t){if(s&1&&Vi(QU,7),s&2){let g;zi(g=Bi())&&(t.mapElement=g.first)}},decls:18,vars:1,consts:[["map",""],[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"arival-status"],[3,"click"],["id","map",2,"height","500px","width","100%"],[1,"location"],[1,"material-symbols-outlined","notranslate"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"click","change"],["for","toggle",1,"already-label"]],template:function(s,t){if(s&1){let g=ai();U(0,"section",1)(1,"span",2),Ne("click",function(){return St(g),It(t.navTOBack())}),X(2," arrow_back "),W(),U(3,"div",3)(4,"span"),X(5,"On the way "),W(),U(6,"button",4),Ne("click",function(){return St(g),It(t.cancel())}),X(7,"Cancel"),W()(),Oe(8,"div",5,0),U(10,"div",6)(11,"span",7),X(12," near_me "),W(),U(13,"span"),X(14),W()(),U(15,"div",8)(16,"input",9),Ne("click",function(){return St(g),It(t.handleDisabledClick())})("change",function(M){return St(g),It(t.toggleDisplay(M))}),W(),Oe(17,"label",10),W()()}s&2&&(le(14),Ni(" ",t.userFullAddress," "))},styles:['.container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;left:2.5%;top:2.5%;display:flex;flex-direction:column;gap:2rem}.arival-status[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-between;border-radius:.5rem;align-items:center;background-color:#d70d09}.arival-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Poppins" sans-serif;margin-left:1.5rem;font-size:1.1rem;font-weight:500;line-height:24px;text-align:left;color:#fff}.arival-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:6rem;height:2.5rem;color:#fff;background-color:transparent;border:.25px solid #ffff;font-family:"Poppins" sans-serif;font-size:1.1rem;font-weight:500;border-radius:.4rem;margin-right:1rem}#map[_ngcontent-%COMP%]{width:100%;height:20rem}.location[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:20% 80%}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){display:flex;justify-content:center;align-items:center}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Poppins" sans-serif;font-size:14px;font-weight:400;line-height:25px;letter-spacing:.05em;text-align:left}.slide-toggle[_ngcontent-%COMP%]{position:fixed;width:95%;height:46px;left:2%;bottom:5%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Arrived";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#409000;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:2px;left:2px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;content:"Arrived";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;pointer-events:none}']});let c=o;return c})();var KU=["map"],dR=(()=>{let o=class o{constructor(r,s,t,g,w,M){this.router=r,this.routerParam=s,this.orderService=t,this.googleMapsService=g,this.location=w,this.afterOrderService=M,this.toggleChecked=!1,this.orderHistoryId=""}ngAfterViewInit(){this.getOrderId()}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:s=>{console.log(s),this.order=s,this.getUserLocationCoordinates()},error:s=>{console.log(s)}}))}initializeMap(r){return zr(this,null,function*(){let s=r;this.getUserFullAddress(s),this.locationTrackingSubscription=this.googleMapsService.getCoordinates().subscribe(t=>{if(!t){console.error("Provider coordinates are null");return}this.googleMapsService.initializeMap(t,this.mapElement.nativeElement),this.googleMapsService.addProviderMarker(t),this.googleMapsService.addUserMarker(s),this.googleMapsService.showDirections(t,s)})})}getUserLocationCoordinates(){return zr(this,null,function*(){console.log("inside user location");let r=this.order?.addressId;if(r){let s={lat:r.latitude,lng:r.longitude};return console.log("user coordinates",s),this.initializeMap(s),s}else{let s={lat:0,lng:0};return this.initializeMap(s),s}})}getUserFullAddress(r){let s=r.lat,t=r.lng;this.googleMapsService.getPlaceNameFromCoordinates(s,t).subscribe({next:g=>{console.log("user full address",g),console.log(g.results[0].formatted_address),this.userFullAddress=g.results[0].formatted_address}})}navTOBack(){this.location.back()}toggleDisplay(r){this.toggleChecked=!this.toggleChecked,this.router.navigate(["work/otp",this.orderHistoryId])}navToChat(){let r={role:"user",id:this.order.userId};this.router.navigate(["help/chatbot"],{queryParams:r})}ngOnDestroy(){this.locationTrackingSubscription&&(this.locationTrackingSubscription.unsubscribe(),console.log("Stopped tracking provider\u2019s location."))}};o.\u0275fac=function(s){return new(s||o)(_e(ii),_e(Ts),_e(ta),_e(ch),_e(yi),_e(Ds))},o.\u0275cmp=Et({type:o,selectors:[["app-start-work"]],viewQuery:function(s,t){if(s&1&&Vi(KU,5),s&2){let g;zi(g=Bi())&&(t.mapElement=g.first)}},decls:21,vars:1,consts:[["map",""],[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"arival-status"],[1,"material-symbols-outlined","notranslate",2,"font-size","24px","margin-right","1.5rem"],[1,"material-symbols-outlined","notranslate",2,"font-size","24px","margin-right","1.5rem",3,"click"],["id","map",2,"height","500px","width","100%"],[1,"location"],[1,"material-symbols-outlined","notranslate"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"change"],["for","toggle",1,"already-label"]],template:function(s,t){if(s&1){let g=ai();U(0,"section",1)(1,"span",2),Ne("click",function(){return St(g),It(t.navTOBack())}),X(2," arrow_back "),W(),U(3,"div",3)(4,"span"),X(5,"Reached customer location"),W(),U(6,"div")(7,"span",4),X(8,"call"),W(),U(9,"span",5),Ne("click",function(){return St(g),It(t.navToChat())}),X(10,"forum"),W()()(),Oe(11,"div",6,0),U(13,"div",7)(14,"span",8),X(15,"near_me"),W(),U(16,"span"),X(17),W()(),U(18,"div",9)(19,"input",10),Ne("change",function(M){return St(g),It(t.toggleDisplay(M))}),W(),Oe(20,"label",11),W()()}s&2&&(le(17),Xt(t.userFullAddress))},styles:['.container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;left:2.5%;display:flex;flex-direction:column;gap:2rem;margin-top:2.5%}.arival-status[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-between;border-radius:.5rem;align-items:center;background-color:#d70d09}.arival-status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.arival-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Poppins" sans-serif;margin-left:1.5rem;font-size:1.1rem;font-weight:500;line-height:24px;text-align:left;color:#fff}#map[_ngcontent-%COMP%]{width:100%;height:20rem}.map[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.location[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:20% 80%}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){display:flex;justify-content:center;align-items:center}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Poppins" sans-serif;font-size:14px;font-weight:400;line-height:25px;letter-spacing:.05em;text-align:left}.slide-toggle[_ngcontent-%COMP%]{position:fixed;width:95%;height:60px;left:2%;bottom:5%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Arrived";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#409000;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:10px;left:15px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;content:"Start working";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;pointer-events:none}']});let c=o;return c})();var JU=["input1"],e7=["input2"],t7=["input3"],i7=["input4"],uR=(()=>{let o=class o{navTOBack(){this.location.back()}constructor(r,s,t,g,w,M,F){this.form=r,this.orderService=s,this.routerParam=t,this.afterOrderService=g,this.router=w,this.dialougeBOxService=M,this.location=F,this.orderHistoryId="",this.orderId=""}ngOnInit(){this.getOrderId(),this.getOtp(),this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}onInput(r,s){if(r.target.value.length===1)switch(s){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:s=>{console.log(s),this.order=s,this.orderId=s._id,this.getOrderHistoryId(this.orderId)},error:s=>{console.log(s)}}))}getOrderHistoryId(r){this.afterOrderService.getOrderHistoryId(r).subscribe({next:s=>{console.log(s),this.orderHistoryId=s.data._id},error:s=>{console.log(s)}})}getOtp(){}verifyOtp(){let r=this.otp.value,s=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log(s);let t={orderHistoryId:this.orderHistoryId,uniqueNumber:s,userId:this.order.userId,orderId:this.orderId};console.log(t),this.orderService.verifyStartOrder(t).subscribe({next:g=>{console.log(g),this.dialougeBOxService.openDialog("OTP verified sucessfully"),this.router.navigate(["workImage",this.orderId])},error:g=>{console.log(g),this.dialougeBOxService.openDialog(g.error.message)}})}};o.\u0275fac=function(s){return new(s||o)(_e(qa),_e(ta),_e(Ts),_e(Ds),_e(ii),_e(mr),_e(yi))},o.\u0275cmp=Et({type:o,selectors:[["app-work-otp"]],viewQuery:function(s,t){if(s&1&&(Vi(JU,5),Vi(e7,5),Vi(t7,5),Vi(i7,5)),s&2){let g;zi(g=Bi())&&(t.input1=g.first),zi(g=Bi())&&(t.input2=g.first),zi(g=Bi())&&(t.input3=g.first),zi(g=Bi())&&(t.input4=g.first)}},decls:24,vars:1,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"image-div"],["src","assets/demo/Stylist doing haircut.png"],[1,"info-text"],[1,"numberss"],[3,"formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input"],["type","text","maxlength","1","formControlName","inputTwo",3,"input"],["type","text","maxlength","1","formControlName","inputThree",3,"input"],["type","text","maxlength","1","formControlName","inputFour",3,"input"],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){if(s&1){let g=ai();U(0,"div",4)(1,"span",5),Ne("click",function(){return St(g),It(t.navTOBack())}),X(2," arrow_back "),W(),U(3,"div",6)(4,"div",7),Oe(5,"img",8),W(),U(6,"span")(7,"span",9),X(8,"Before start the work"),W(),Oe(9,"br"),U(10,"span",10),X(11,"Enter OTP from user"),W()(),U(12,"form",11)(13,"div",12)(14,"input",13,0),Ne("input",function(M){return St(g),It(t.onInput(M,1))}),W(),U(16,"input",14,1),Ne("input",function(M){return St(g),It(t.onInput(M,2))}),W(),U(18,"input",15,2),Ne("input",function(M){return St(g),It(t.onInput(M,3))}),W(),U(20,"input",16,3),Ne("input",function(M){return St(g),It(t.onInput(M,4))}),W()(),U(22,"button",17),Ne("click",function(){return St(g),It(t.verifyOtp())}),X(23,"Confirm"),W()()()()}s&2&&(le(12),ze("formGroup",t.otp))},dependencies:[va,ba,Kr,ya,_0,Ga,Il],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;margin-top:2.5%}.material-symbols-outlined[_ngcontent-%COMP%]{width:max-content;margin-left:2.5%}.sub-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;text-align:center}.image-div[_ngcontent-%COMP%]{width:100%;height:25rem}.image-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px;color:#414141}.info-text[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0;color:#414141}.numberss[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:600;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;margin-left:5%}"]});let c=o;return c})();var hR=(()=>{let o=class o{constructor(r,s,t,g,w){this.orderService=r,this.router=s,this.location=t,this.routerParam=g,this.afterOrderService=w,this.total=0,this.orderHistoryId="",this.work={},this.alreadyHasAccount=!1}ngOnInit(){this.getOrderId()}navTOBack(){this.location.back()}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{let s=r.get("id");s&&(this.orderHistoryId=s,this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&this.afterOrderService.getOrderDetails(r).subscribe({next:s=>{console.log(s),this.order=s,this.work=this.order,console.log("work",this.work)},error:s=>{console.log(s)}})}toggleDisplay(){let r=this.work.userId;this.router.navigate(["workImage",this.orderHistoryId],{replaceUrl:!0})}};o.\u0275fac=function(s){return new(s||o)(_e(ta),_e(ii),_e(yi),_e(Ts),_e(Ds))},o.\u0275cmp=Et({type:o,selectors:[["app-work-complete"]],decls:36,vars:6,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"image"],["src","assets/new/Man washing hand.png"],[1,"details"],[1,"details-div"],[1,"about"],[1,"highlight-text"],[1,"sub-title"],[1,"line"],[1,"time-div"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"ngModelChange","change","ngModel"],["for","toggle",1,"already-label"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"span",1),Ne("click",function(){return t.navTOBack()}),X(2," arrow_back "),W(),U(3,"div",2),Oe(4,"img",3),W(),U(5,"section",4)(6,"div",5)(7,"span",6)(8,"span",7),X(9),W()(),U(10,"span",8),X(11),W(),Oe(12,"div",9),W(),U(13,"div",10)(14,"p")(15,"span"),X(16,"Others"),W(),Oe(17,"br"),U(18,"span",7),X(19,"Convenience Fee"),W()(),U(20,"p",7),X(21,"69"),W()(),Oe(22,"div",9)(23,"br"),U(24,"div",10)(25,"p")(26,"span",7),X(27,"Total value"),W(),Oe(28,"br"),U(29,"span"),X(30,"commission credits"),W()(),U(31,"p",7),X(32),W()()(),U(33,"div",11)(34,"input",12),Qo("ngModelChange",function(w){return Xo(t.alreadyHasAccount,w)||(t.alreadyHasAccount=w),w}),Ne("change",function(){return t.toggleDisplay()}),W(),Oe(35,"label",13),W()()),s&2&&(le(9),ss("",t.work==null||t.work.orderId==null||t.work.orderId.items[0]==null?null:t.work.orderId.items[0].quantity," X ",t.work==null||t.work.orderId==null||t.work.orderId.categoryIds[0]==null?null:t.work.orderId.categoryIds[0].name,""),le(2),ss("",t.work==null||t.work.orderId==null||t.work.orderId.items[0]==null?null:t.work.orderId.items[0].quantity," X ",t.work==null||t.work.orderId==null||t.work.orderId.subCategoryIds[0]==null?null:t.work.orderId.subCategoryIds[0].name,""),le(21),Xt(t.work==null||t.work.orderId==null?null:t.work.orderId.totalAmount),le(2),Zo("ngModel",t.alreadyHasAccount))},dependencies:[sh,Kr,Sl],styles:['.container[_ngcontent-%COMP%]{width:95vw;height:100%;display:flex;flex-direction:column;gap:1rem;position:relative;left:2.5%;right:2.5%;top:2.5%}.image[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.details[_ngcontent-%COMP%], .details-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem}.about[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.slide-toggle[_ngcontent-%COMP%]{position:relative;width:95%;height:46px;left:2%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Placeholder Text";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#bb0e0e;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:2px;left:2px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;color:#fff;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#000;font-size:14px;pointer-events:none}.slide-toggle[_ngcontent-%COMP%]   label.already-label[_ngcontent-%COMP%]:before{content:"Swipe to Complete";color:#fff;font-family:Poppins;font-size:1.1rem;font-weight:500;line-height:22.82px;text-align:left}.time-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.Details[_ngcontent-%COMP%]{width:90%;border:.25px solid black;border-radius:.5rem}.line[_ngcontent-%COMP%]{width:100%;height:0;border:0;border-bottom:1px dashed rgb(45,44,44)}.sub-tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:.9rem;font-weight:400;line-height:14.52px;text-align:left}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:600;line-height:16.94px;text-align:left}']});let c=o;return c})();var n7=["input1"],r7=["input2"],o7=["input3"],a7=["input4"],mR=(()=>{let o=class o{navTOBack(){this.location.back()}constructor(r,s,t,g,w,M,F){this.form=r,this.orderService=s,this.router=t,this.userDetailsService=g,this.afterOrderService=w,this.routerParam=M,this.location=F,this.orderHistoryId="",this.orderId="",this.getOrderId(),this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}onInput(r,s){if(r.target.value.length===1)switch(s){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{let s=r.get("id");s&&(this.orderId=s,this.getOrderDetails(s))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:s=>{console.log(s),this.order=s,this.getOrderHistoryId(this.orderId)},error:s=>{console.error(s)}}))}getOrderHistoryId(r){this.afterOrderService.getOrderHistoryId(r).subscribe({next:s=>{console.log(s),this.orderHistoryId=s.data._id},error:s=>{console.log(s)}})}login(){let r=this.otp.value,s=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log(s),this.orderService.verifyAfterComplete(s,this.orderHistoryId,this.orderId).subscribe(t=>{console.log(t),this.updatingEarnings()},t=>{console.log(t)})}updatingEarnings(){let s=nC(new Date,"yyyy-MM-dd"),t={providerId:localStorage.getItem("providerId"),date:s,amount:190};console.log(t),console.log(typeof s),this.userDetailsService.upDatingEarnings(t).subscribe({next:g=>{console.log(g);let w={userId:this.order.userId?._id,orderHistoryId:this.orderHistoryId};this.router.navigate(["feedback"],{queryParams:w})},error:g=>{console.log(g)}})}};o.\u0275fac=function(s){return new(s||o)(_e(qa),_e(ta),_e(ii),_e(nr),_e(Ds),_e(Ts),_e(yi))},o.\u0275cmp=Et({type:o,selectors:[["app-verify-after-work"]],viewQuery:function(s,t){if(s&1&&(Vi(n7,5),Vi(r7,5),Vi(o7,5),Vi(a7,5)),s&2){let g;zi(g=Bi())&&(t.input1=g.first),zi(g=Bi())&&(t.input2=g.first),zi(g=Bi())&&(t.input3=g.first),zi(g=Bi())&&(t.input4=g.first)}},decls:24,vars:1,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"image-div"],["src","assets/demo/Stylist doing haircut.png"],[1,"info-text"],[1,"numberss"],[3,"formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input"],["type","text","maxlength","1","formControlName","inputTwo",3,"input"],["type","text","maxlength","1","formControlName","inputThree",3,"input"],["type","text","maxlength","1","formControlName","inputFour",3,"input"],["type","submit",1,"login-btn",3,"click"]],template:function(s,t){if(s&1){let g=ai();U(0,"div",4)(1,"span",5),Ne("click",function(){return St(g),It(t.navTOBack())}),X(2," arrow_back "),W(),U(3,"div",6)(4,"div",7),Oe(5,"img",8),W(),U(6,"span")(7,"span",9),X(8,"Before start the work"),W(),Oe(9,"br"),U(10,"span",10),X(11,"Enter OTP from user"),W()(),U(12,"form",11)(13,"div",12)(14,"input",13,0),Ne("input",function(M){return St(g),It(t.onInput(M,1))}),W(),U(16,"input",14,1),Ne("input",function(M){return St(g),It(t.onInput(M,2))}),W(),U(18,"input",15,2),Ne("input",function(M){return St(g),It(t.onInput(M,3))}),W(),U(20,"input",16,3),Ne("input",function(M){return St(g),It(t.onInput(M,4))}),W()(),U(22,"button",17),Ne("click",function(){return St(g),It(t.login())}),X(23,"Confirm"),W()()()()}s&2&&(le(12),ze("formGroup",t.otp))},dependencies:[va,ba,Kr,ya,_0,Ga,Il],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;margin-top:2.5%;align-items:center}.material-symbols-outlined[_ngcontent-%COMP%]{width:max-content;margin-left:2.5%}.sub-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;text-align:center}.image-div[_ngcontent-%COMP%]{width:100%;height:25rem}.image-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px;color:#414141}.info-text[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0;color:#414141}.numberss[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:600;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#cd2e28;margin-left:5%}"]});let c=o;return c})();var fR=FS(pR());var s7=c=>({Uiselected:c});function l7(c,o){if(c&1){let d=ai();U(0,"div",13),Ne("click",function(){St(d);let s=it(),t=s.$implicit,g=s.$index,w=it(2).$implicit,M=it(2);return It(M.selectVariant(g,t,w._id))}),U(1,"p"),X(2),W()()}if(c&2){let d=it(),r=d.$implicit,s=d.$index,t=it(2).$implicit,g=it(2);ze("ngClass",wi(2,s7,g.selectedIndexMap[t._id]===s)),le(2),Xt(r)}}function c7(c,o){if(c&1&&qt(0,l7,3,4,"div",12),c&2){let d=o.$implicit;ze("ngIf",d!=="None")}}function d7(c,o){if(c&1){let d=ai();U(0,"span"),X(1),W(),U(2,"div")(3,"input",8),Ne("change",function(s){St(d);let t=it(2).$implicit,g=it();return It(g.selectAll(s,t))}),W(),X(4,"Select All "),W(),U(5,"div",9)(6,"div",10),no(7,c7,1,1,"div",11,Yo),W()()}if(c&2){let d=it().$implicit;le(),Xt(d.name),le(6),ro(d.uiVariant)}}function u7(c,o){if(c&1&&qt(0,d7,9,1),c&2){let d=o.$implicit,r=it().$implicit;hr(0,d._id===r[0].categoryId?0:-1)}}function h7(c,o){if(c&1){let d=ai();U(0,"div",7)(1,"div",15),Ne("click",function(){St(d);let s=it().$implicit,t=it(2);return It(t.slect(s))}),Oe(2,"img",16),X(3),W(),U(4,"div")(5,"input",17),Qo("ngModelChange",function(s){St(d);let t=it().$implicit;return Xo(t.checked,s)||(t.checked=s),It(s)}),Ne("change",function(s){St(d);let t=it().$implicit,g=it(2);return It(g.onChange(s,t))}),W()()()}if(c&2){let d=it().$implicit;le(2),ze("src",d.imageKey,vr),le(),Ni("",d.name," "),le(2),Zo("ngModel",d.checked)}}function m7(c,o){if(c&1&&qt(0,h7,6,3,"div",14),c&2){let d=o.$implicit,r=it().$implicit,s=it();ze("ngIf",d.variantName===s.selectedUiMap[r[0].categoryId])}}function p7(c,o){if(c&1&&(U(0,"div",5),no(1,u7,1,1,null,null,Yo),no(3,m7,1,1,"div",7,Yo),W()),c&2){let d=o.$implicit,r=it();le(),ro(r.allCatDetails),le(2),ro(d)}}var gR=(()=>{let o=class o{constructor(r,s,t,g,w,M,F){this.loginService=r,this.logInService=s,this.router=t,this.http=g,this.location=w,this.dailougeService=M,this.userDetailsService=F,this.workSeleceted=[],this.selectedIndex=0,this.allCatDetails=[],this.selectedUiMap={},this.selectedIndexMap={},this.items=[]}ngOnInit(){this.getSubServices()}getSubServices(){this.items=[];let r=this.loginService.workId;console.log(r),this.loginService.getSubCategories(r).subscribe({next:s=>{console.log(s),this.items=s.filter(t=>t!==null),this.items=this.items.map(t=>t.filter((g,w,M)=>w===M.findIndex(F=>fR.isEqual(F,g)))),console.log(this.items),this.getWork(),this.getDetailsOfCat()},error:s=>{console.log(s)}})}getDetailsOfCat(){let s=this.loginService.workId.map(t=>{let g=`${_n}core/categories/${t}`;return this.http.get(g).pipe(Ro(w=>(console.error(`Failed to fetch data for category ID ${t}:`,w),Ln(null))))});km(s).subscribe(t=>{console.log("All categories data:",t),this.allCatDetails=t.filter(g=>g!==null),this.initializeSelectedIndex()},t=>{console.error("Error fetching categories data:",t)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works,this.autoCheckServices()},r=>{console.log(r)})}autoCheckServices(){this.workSeleceted.forEach(r=>{let s=this.items.filter(t=>t.categoryId===r.categoryId._id);if(s.length>0){let t=r.subcategoryId;s.forEach(g=>{g._id===t._id&&(g.checked=!0,console.log(`Checked subcategory: ${g.name}`))})}})}selectAll(r,s){let t=r.target,g=[],w=[];t.checked&&s.map(M=>{this.logInService.setSubCat(M._id,M.categoryId),M.checked=!0}),t.checked||(this.logInService.selectedSubCategories=[],this.logInService.catIdForServices=[],s.map(M=>{M.checked=!1}))}initializeSelectedIndex(){for(let r of this.allCatDetails)this.selectedIndexMap[r._id]=0,r.uiVariant.length>0&&(this.selectedUiMap[r._id]=r.uiVariant[0])}selectVariant(r,s,t){this.selectedIndexMap[t]=r,this.selectedUiMap[t]=s}send(){this.logInService.selectedSubCategories.length>0?this.router.navigate(["services"]):this.dailougeService.openDialog("Please select atleat one sub-category ")}slect(r){let s=this.items.indexOf(r);console.log("categoryId",r._),this.logInService.setSubCat(r._id,r.categoryId),this.logInService.selectedSubCategories.length>0?this.router.navigate(["services"]):this.dailougeService.openDialog("Please select atleat one sub-category ")}onChange(r,s){let t=r.target;if(console.log(s),t){let g=t.checked;if(g){let w=this.items.indexOf(s);console.log("categoryId",s._),this.logInService.setSubCat(s._id,s.categoryId),this.logInService.selectedSubCategories.length>0||this.dailougeService.openDialog("Please select atleat one sub-category ")}g||(console.log(s.categoryId,s),this.logInService.selectedSubCategories=this.logInService.selectedSubCategories.filter(w=>w!==s._id),s.checked=!1,console.log(this.logInService.selectedSubCategories),console.log(this.logInService.catIdForServices))}}navToBack(){this.location.back()}};o.\u0275fac=function(s){return new(s||o)(_e(Br),_e(Br),_e(ii),_e(ji),_e(yi),_e(mr),_e(nr))},o.\u0275cmp=Et({type:o,selectors:[["app-sub-services"]],decls:12,vars:0,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"tittle"],[1,"service"],[1,"sub-cat-div"],["type","submit",1,"login-btn",3,"click"],[1,"service-div"],["type","checkbox",3,"change"],[1,"ui-varient"],[1,"ui-varient-div"],[3,"ngClass"],[3,"ngClass","click",4,"ngIf"],[3,"click","ngClass"],["class","service-div",4,"ngIf"],[1,"names",3,"click"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"span",1),Ne("click",function(){return t.navToBack()}),X(2," keyboard_backspace "),W(),U(3,"div",2)(4,"span",3),X(5,"Select Sub-Services"),W(),Oe(6,"br"),U(7,"div",4),no(8,p7,5,0,"div",5,Yo),W()(),U(10,"button",6),Ne("click",function(){return t.send()}),X(11,"Continue"),W()()),s&2&&(le(8),ro(t.items))},dependencies:[Ko,$n,sh,Kr,Sl],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;left:5%;align-items:center;display:grid;grid-gap:.5rem;text-align:center}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.serivce[_ngcontent-%COMP%]{height:78vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.5rem}.sub-cat-div[_ngcontent-%COMP%]{box-shadow:0 0 3px #000}.service-div[_ngcontent-%COMP%]{height:2rem;display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2rem;height:2rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}.ui-varient[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;flex-wrap:wrap}.ui-varient-div[_ngcontent-%COMP%]{width:max-content;display:flex;color:#000;flex-wrap:wrap;align-items:center;justify-content:center;border-radius:.8rem;background-color:#fff7e3;box-shadow:1px 2px 6px #000}.ui-varient-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:max-content;height:1rem;border-radius:.8rem;display:flex;align-items:center;justify-content:center;padding:10px;cursor:pointer;transition:background-color .3s ease}.ui-varient-div[_ngcontent-%COMP%]   div.Uiselected[_ngcontent-%COMP%]{box-shadow:3px 4px 4px 3px #00000040 inset;background-color:#fc8524;color:#fff;padding-left:1rem;padding-right:1rem}.ui-varient-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:not(.Uiselected){background-color:transparent}.ui-varient-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;outline:none!important}']});let c=o;return c})();var _R=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275cmp=Et({type:o,selectors:[["app-not-found"]],decls:11,vars:0,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"span",1),X(2," wifi_off "),W(),U(3,"span"),X(4,"You're offline"),W(),U(5,"span"),X(6,"Please connect to internet and try again"),W(),U(7,"button")(8,"span",1),X(9," refresh "),W(),X(10," Retry "),W()())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center}.material-symbols-outlined[_ngcontent-%COMP%]{font-weight:300}"]});let c=o;return c})();var bR=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275cmp=Et({type:o,selectors:[["app-location"]],decls:2,vars:0,template:function(s,t){s&1&&(U(0,"p"),X(1,"location works!"),W())}});let c=o;return c})();function f7(c,o){c&1&&(U(0,"p"),X(1,"No subcategories available"),W())}function g7(c,o){if(c&1){let d=ai();U(0,"div",7)(1,"h3"),X(2),W(),U(3,"section",8)(4,"h3"),X(5),W(),U(6,"span",9),Ne("click",function(){let s=St(d).$implicit,t=it();return It(t.removeWork(s._id))}),X(7," delete "),W()(),U(8,"div")(9,"h3"),X(10,"Services :"),W(),U(11,"ul")(12,"li"),X(13),W()()(),qt(14,f7,2,0,"p",10),U(15,"p"),X(16),W()()}if(c&2){let d=o.$implicit;le(2),Ni("Category : ",d.categoryId.name,""),le(3),Ni(" SubCategory : ",d.subcategoryId.name,""),le(8),Ni(" ",d.serviceId.name," "),le(),ze("ngIf",d.subcategoryId.length===0),le(2),Ni("Experience: ",d.experience,"")}}var yR=(()=>{let o=class o{constructor(r,s,t){this.location=r,this.userDetailsService=s,this.router=t,this.works=[]}ngOnInit(){this.getWork()}getWork(){this.works=[],this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r),this.works=r.works},error:r=>{console.log(r)}})}removeSubcategory(r,s){console.log(r,"subCat",s),this.userDetailsService.deleteServiceWork(r,s).subscribe({next:t=>{console.log(t),this.getWork()},error:t=>{console.log(t)}})}removeWork(r){let s={providerId:localStorage.getItem("providerId"),workId:r};this.userDetailsService.deleteWork(s).subscribe({next:t=>{console.log(t),this.getWork()},error:t=>{console.log(t)}})}navToSelectWork(){this.router.navigate(["selectWork"])}navToBack(){console.log("back"),this.location.back()}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(nr),_e(ii))},o.\u0275cmp=Et({type:o,selectors:[["app-manage-services"]],decls:15,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"new-address",3,"click"],[1,"material-symbols-outlined","notranslate"],[1,"work-div"],[1,"service-section"],[1,"material-icons",3,"click"],[4,"ngIf"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),Ne("click",function(){return t.navToBack()}),X(3,"arrow_back"),W(),U(4,"span",3),X(5,"Manage Services"),W()(),U(6,"div",4)(7,"div",5),Ne("click",function(){return t.navToSelectWork()}),U(8,"div")(9,"span",6),X(10," add "),W(),U(11,"span"),X(12,"Add new Services"),W()()(),no(13,g7,17,5,"div",7,Yo),W()()),s&2&&(le(13),ro(t.works))},dependencies:[$n],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:670px;position:relative;top:2%;left:5%;display:flex;flex-direction:column;gap:1rem}.new-address[_ngcontent-%COMP%]{width:100%;height:2.5rem;border-radius:.6rem;border:.25px solid black;display:flex;justify-content:space-between;align-items:center}.new-address[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:60%;display:flex;align-items:center;gap:.5rem;padding-left:.5rem}.new-address[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:16.94px;color:#f9a600}.arrow[_ngcontent-%COMP%]{width:100%;display:flex;text-align:center;margin:1rem 0 0 1rem}.tittle[_ngcontent-%COMP%]{width:80%;font-family:"Inter" sans-serif;font-size:22px;font-weight:500;line-height:26.63px;text-align:center}.work-div[_ngcontent-%COMP%]{margin-bottom:20px;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:2px 2px 10px #0000001a}h3[_ngcontent-%COMP%]{margin:0;color:#2c3e50}ul[_ngcontent-%COMP%]{list-style:none;padding:0}li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin:5px 0;padding:5px;border:1px solid #ddd;border-radius:4px;background-color:#f9f9f9}p[_ngcontent-%COMP%]{color:#7f8c8d;font-size:14px;margin:5px 0}.material-icons[_ngcontent-%COMP%]{cursor:pointer;color:#e74c3c;font-size:24px;transition:color .2s ease}.material-icons[_ngcontent-%COMP%]:hover{color:#c0392b}p[ngIf][_ngcontent-%COMP%]{color:#95a5a6;font-style:italic}.service-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem}']});let c=o;return c})();var vR=(()=>{let o=class o{constructor(r,s,t,g,w){this.location=r,this.routerParam=s,this.afterOrderService=t,this.dailougeBoxService=g,this.router=w,this.rating=0,this.userFeedback="",this.userId="",this.orderHistoryId="",this.getUser()}getUser(){this.routerParam.queryParams.subscribe({next:r=>{this.userId=r.userId,this.orderHistoryId=r.orderHistoryId}})}rate(r){this.rating=r}submitFeedback(){if(this.rating===0){alert("Please provide a rating before submitting.");return}if(this.userFeedback.trim()===""){alert("Please provide your feedback before submitting.");return}console.log("Rating:",this.rating),console.log("Feedback:",this.userFeedback),console.log(this.userId);let r={userId:this.userId,providerId:localStorage.getItem("providerId"),orderHistoryId:this.orderHistoryId,rating:this.rating,description:this.userFeedback};console.log(r),this.afterOrderService.feedBack(r).subscribe({next:s=>{console.log(s),this.dailougeBoxService.openDialog("feedback send sucessfully"),this.router.navigate(["home"])},error:s=>{console.log(s)}}),this.rating=0,this.userFeedback=""}navToBack(){this.location.back()}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(Ts),_e(Ds),_e(mr),_e(ii))},o.\u0275cmp=Et({type:o,selectors:[["app-feedback"]],decls:26,vars:11,consts:[[1,"feedback-container"],[1,"material-symbols-outlined","back-icon",3,"click"],[1,"success-icon"],["src","assets/demo/done.png"],[1,"star-div"],[1,"star-rating-section"],[1,"star-rating"],[1,"star",3,"click"],[1,"rating-text"],[1,"rating-subtext"],[1,"feedback-text"],["placeholder","Write your text","rows","4",3,"ngModelChange","ngModel"],[1,"submit-btn",3,"click"]],template:function(s,t){s&1&&(U(0,"section",0)(1,"span",1),Ne("click",function(){return t.navToBack()}),X(2,"arrow_back"),W(),U(3,"div",2),Oe(4,"img",3),W(),U(5,"div",4)(6,"div",5)(7,"div",6)(8,"span",7),Ne("click",function(){return t.rate(1)}),X(9,"\u2605"),W(),U(10,"span",7),Ne("click",function(){return t.rate(2)}),X(11,"\u2605"),W(),U(12,"span",7),Ne("click",function(){return t.rate(3)}),X(13,"\u2605"),W(),U(14,"span",7),Ne("click",function(){return t.rate(4)}),X(15,"\u2605"),W(),U(16,"span",7),Ne("click",function(){return t.rate(5)}),X(17,"\u2605"),W()(),U(18,"p",8),X(19,"Excellent"),W(),U(20,"p",9),X(21,"You rated Sergio Ramos 5 star"),W()(),U(22,"div",10)(23,"textarea",11),Qo("ngModelChange",function(w){return Xo(t.userFeedback,w)||(t.userFeedback=w),w}),W()(),U(24,"button",12),Ne("click",function(){return t.submitFeedback()}),X(25,"Submit"),W()()()),s&2&&(le(8),Ki("filled",t.rating>=1),le(2),Ki("filled",t.rating>=2),le(2),Ki("filled",t.rating>=3),le(2),Ki("filled",t.rating>=4),le(2),Ki("filled",t.rating>=5),le(7),Zo("ngModel",t.userFeedback))},dependencies:[ba,Kr,Sl],styles:[".feedback-container[_ngcontent-%COMP%]{width:90%;height:95%;max-width:400px;margin:auto;font-family:Arial,sans-serif;padding:20px;box-shadow:0 4px 8px #0000001a;position:relative;text-align:center}.back-icon[_ngcontent-%COMP%]{font-size:24px;color:#555;position:absolute;top:15px;left:15px;cursor:pointer}.success-icon[_ngcontent-%COMP%]{height:90%;display:flex;align-items:center;justify-content:center;font-size:80px;color:#4caf50}.star-div[_ngcontent-%COMP%]{position:fixed;bottom:5%;width:90%}.star-rating-section[_ngcontent-%COMP%]{margin-top:20px;display:flex;flex-direction:column;gap:1rem}.star-rating[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:5px}.star[_ngcontent-%COMP%]{font-size:50px;color:#ccc;cursor:pointer;transition:color .2s;margin:0 5px}.star.filled[_ngcontent-%COMP%]{color:#ffc107}.rating-text[_ngcontent-%COMP%]{font-size:18px;font-weight:700;margin:5px 0;color:#333}.rating-subtext[_ngcontent-%COMP%]{font-size:14px;color:#777;margin-bottom:20px}.feedback-text[_ngcontent-%COMP%]{width:90%;margin:0 7% 20px 2%}textarea[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:14px;border-radius:8px;border:1px solid #ddd;resize:none}.submit-btn[_ngcontent-%COMP%]{width:90%;padding:12px;font-size:16px;color:#fff;background-color:#ff6f00;border:none;border-radius:8px;cursor:pointer;transition:background-color .2s}.submit-btn[_ngcontent-%COMP%]:hover{background-color:#ff8c00}"]});let c=o;return c})();var gf=function(c){return c.Prompt="PROMPT",c.Camera="CAMERA",c.Photos="PHOTOS",c}(gf||{}),vv=function(c){return c.Rear="REAR",c.Front="FRONT",c}(vv||{}),gM=function(c){return c.Uri="uri",c.Base64="base64",c.DataUrl="dataUrl",c}(gM||{});var xv=class extends tD{getPhoto(o){return zr(this,null,function*(){return new Promise((d,r)=>zr(this,null,function*(){if(o.webUseInput||o.source===gf.Photos)this.fileInputExperience(o,d,r);else if(o.source===gf.Prompt){let s=document.querySelector("pwa-action-sheet");s||(s=document.createElement("pwa-action-sheet"),document.body.appendChild(s)),s.header=o.promptLabelHeader||"Photo",s.cancelable=!1,s.options=[{title:o.promptLabelPhoto||"From Photos"},{title:o.promptLabelPicture||"Take Picture"}],s.addEventListener("onSelection",t=>zr(this,null,function*(){t.detail===0?this.fileInputExperience(o,d,r):this.cameraExperience(o,d,r)}))}else this.cameraExperience(o,d,r)}))})}pickImages(o){return zr(this,null,function*(){return new Promise((d,r)=>zr(this,null,function*(){this.multipleFileInputExperience(d,r)}))})}cameraExperience(o,d,r){return zr(this,null,function*(){if(customElements.get("pwa-camera-modal")){let s=document.createElement("pwa-camera-modal");s.facingMode=o.direction===vv.Front?"user":"environment",document.body.appendChild(s);try{yield s.componentOnReady(),s.addEventListener("onPhoto",t=>zr(this,null,function*(){let g=t.detail;g===null?r(new B1("User cancelled photos app")):g instanceof Error?r(g):d(yield this._getCameraPhoto(g,o)),s.dismiss(),document.body.removeChild(s)})),s.present()}catch{this.fileInputExperience(o,d,r)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(o,d,r)})}fileInputExperience(o,d,r){let s=document.querySelector("#_capacitor-camera-input"),t=()=>{var g;(g=s.parentNode)===null||g===void 0||g.removeChild(s)};s||(s=document.createElement("input"),s.id="_capacitor-camera-input",s.type="file",s.hidden=!0,document.body.appendChild(s),s.addEventListener("change",g=>{let w=s.files[0],M="jpeg";if(w.type==="image/png"?M="png":w.type==="image/gif"&&(M="gif"),o.resultType==="dataUrl"||o.resultType==="base64"){let F=new FileReader;F.addEventListener("load",()=>{if(o.resultType==="dataUrl")d({dataUrl:F.result,format:M});else if(o.resultType==="base64"){let N=F.result.split(",")[1];d({base64String:N,format:M})}t()}),F.readAsDataURL(w)}else d({webPath:URL.createObjectURL(w),format:M}),t()}),s.addEventListener("cancel",g=>{r(new B1("User cancelled photos app")),t()})),s.accept="image/*",s.capture=!0,o.source===gf.Photos||o.source===gf.Prompt?s.removeAttribute("capture"):o.direction===vv.Front?s.capture="user":o.direction===vv.Rear&&(s.capture="environment"),s.click()}multipleFileInputExperience(o,d){let r=document.querySelector("#_capacitor-camera-input-multiple"),s=()=>{var t;(t=r.parentNode)===null||t===void 0||t.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input-multiple",r.type="file",r.hidden=!0,r.multiple=!0,document.body.appendChild(r),r.addEventListener("change",t=>{let g=[];for(let w=0;w<r.files.length;w++){let M=r.files[w],F="jpeg";M.type==="image/png"?F="png":M.type==="image/gif"&&(F="gif"),g.push({webPath:URL.createObjectURL(M),format:F})}o({photos:g}),s()}),r.addEventListener("cancel",t=>{d(new B1("User cancelled photos app")),s()})),r.accept="image/*",r.click()}_getCameraPhoto(o,d){return new Promise((r,s)=>{let t=new FileReader,g=o.type.split("/")[1];d.resultType==="uri"?r({webPath:URL.createObjectURL(o),format:g,saved:!1}):(t.readAsDataURL(o),t.onloadend=()=>{let w=t.result;d.resultType==="dataUrl"?r({dataUrl:w,format:g,saved:!1}):r({base64String:w.split(",")[1],format:g,saved:!1})},t.onerror=w=>{s(w)})})}checkPermissions(){return zr(this,null,function*(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}})}requestPermissions(){return zr(this,null,function*(){throw this.unimplemented("Not implemented on web.")})}pickLimitedLibraryPhotos(){return zr(this,null,function*(){throw this.unavailable("Not implemented on web.")})}getLimitedLibraryPhotos(){return zr(this,null,function*(){throw this.unavailable("Not implemented on web.")})}},Dte=new xv;var xR=Qp("Camera",{web:()=>new xv});var _7=["imageElement"];function b7(c,o){if(c&1){let d=ai();U(0,"div",3),Oe(1,"img",4),W(),U(2,"div",5)(3,"button",6),Ne("click",function(){St(d);let s=it();return It(s.submit())}),X(4,"Submit"),W()()}if(c&2){let d=it();le(),ze("src",d.imageUrl,vr)}}var wR=(()=>{let o=class o{constructor(r,s,t,g,w){this.location=r,this.routerParam=s,this.afterOrderService=t,this.router=g,this.orderService=w,this.orderHistoryId="",this.orderId="",this.status=""}ngOnInit(){this.takePicture(),this.getOrderId()}takePicture(){return zr(this,null,function*(){try{let r=yield xR.getPhoto({quality:100,allowEditing:!1,resultType:gM.Uri,source:gf.Camera});this.imageUrl=r.webPath}catch(r){console.error("Error capturing image:",r)}})}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{if(r.get("id")){let t=r.get("id");this.getOrderDetails(t)}}})}getOrderDetails(r){r&&this.afterOrderService.getOrderDetails(r).subscribe({next:s=>{console.log(s),this.order=s,this.orderId=s._id,this.getingStatus()},error:s=>{console.error(s)}})}getingStatus(){this.afterOrderService.gettingStatus(this.orderId).subscribe({next:r=>{console.log(r),this.status=r.data.status,this.orderHistoryId=r.data._id},error:r=>{console.log(r)}})}submit(){return zr(this,null,function*(){let r=localStorage.getItem("providerId");if(!r||!this.orderId||!this.imageUrl||!this.order?.userId._id){console.error("Required data is missing");return}try{let t=yield(yield fetch(this.imageUrl)).blob(),g=new FormData;g.append("providerId",r),g.append("orderId",this.orderId),g.append("userId",this.order.userId?._id),g.append("image",t,"work-image.jpg"),this.status==="Workstart"&&this.afterOrderService.uploadBeforeWorkImage(g).subscribe(w=>{console.log("Data submitted successfully:",w),this.navToCompleteWork()},w=>{console.error("Error submitting data:",w)}),this.status==="InProgress"&&(g.append("orderHistoryId",this.orderHistoryId||""),this.afterOrderService.uploadAfterWorkImage(g).subscribe({next:w=>{console.log(w),this.completeWork()},error:w=>{console.log(w)}}))}catch(s){console.error("Error fetching and submitting image:",s)}})}completeWork(){let r=this.order.userId?._id,s={orderHistoryId:this.orderHistoryId,providerId:localStorage.getItem("providerId"),userId:r,orderId:this.orderId};console.log(s),this.orderService.completeOrder(s).subscribe({next:t=>{console.log(t),this.router.navigate(["verifyAfterWork",this.orderId])},error:t=>{console.log(t)}})}navTOBack(){this.location.back()}navToCompleteWork(){this.router.navigate(["completeWork",this.orderId])}ngOnDestroy(){this.imageUrl=void 0,this.orderHistoryId="",this.orderId="",this.order=[]}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(Ts),_e(Ds),_e(ii),_e(ta))},o.\u0275cmp=Et({type:o,selectors:[["app-work-image"]],viewQuery:function(s,t){if(s&1&&Vi(_7,5),s&2){let g;zi(g=Bi())&&(t.imageElement=g.first)}},decls:5,vars:1,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"image"],["alt","Captured Image",3,"src"],[1,"button-div"],[3,"click"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"span",1),Ne("click",function(){return t.navTOBack()}),X(2," arrow_back "),W(),U(3,"div",2),qt(4,b7,5,1),W()()),s&2&&(le(4),hr(4,t.imageUrl?4:-1))},styles:[".container[_ngcontent-%COMP%]{width:90%;margin:1rem 5% 0}.sub-container[_ngcontent-%COMP%]{width:100%;height:80%;display:flex;flex-direction:column;gap:1rem;align-items:center;justify-content:center}.image[_ngcontent-%COMP%]{width:260px;height:500px}.image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.button-div[_ngcontent-%COMP%]{position:fixed;bottom:5%}button[_ngcontent-%COMP%]{background-color:#d16611;color:#fff;padding:1rem 2rem;border:none;border-radius:.4rem}"]});let c=o;return c})();function y7(c,o){if(c&1){let d=ai();U(0,"div",6)(1,"div",7),Oe(2,"img",8),X(3),W(),U(4,"div")(5,"input",9),Qo("ngModelChange",function(s){let t=St(d).$implicit;return Xo(t.checked,s)||(t.checked=s),It(s)}),Ne("change",function(s){let t=St(d).$implicit,g=it(2);return It(g.onChange(s,t))}),W()()()}if(c&2){let d=o.$implicit;le(2),ze("src",d.image,vr),le(),Xt(d.name),le(2),Zo("ngModel",d.checked)}}function v7(c,o){if(c&1&&(U(0,"div")(1,"span"),X(2),W()(),no(3,y7,6,3,"div",6,Yo)),c&2){let d=o.$implicit;le(2),ss("",d[0].categoryId.name," (",d[0].subCategoryId.variantName,")"),le(),ro(d)}}var CR=(()=>{let o=class o{constructor(r,s,t,g){this.location=r,this.logInService=s,this.router=t,this.userDetailsService=g,this.workSeleceted=[],this.selectedCatId=[],this.selectedSubCatId=[],this.selectedServicesId=[],this.catIds=[],this.subCatIds=[],this.serviceIds=[],this.items=[]}ngOnInit(){this.selectedCatId=this.logInService.catIdForServices,this.selectedSubCatId=this.logInService.selectedSubCategories,this.getServices()}getServices(){console.log(this.selectedCatId,this.selectedSubCatId," cat ans sub cat ids"),this.logInService.getServices(this.selectedCatId,this.selectedSubCatId).subscribe({next:r=>{console.log(r);let s=r.services.reduce((t,g)=>{let w=g.subCategoryId._id;return t[w]||(t[w]=[]),t[w].push(g),t},{});this.groupedServicesArray=Object.values(s),console.log(this.groupedServicesArray),this.items=r,this.getWork()},error:r=>{console.log(r)}})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works,this.autoCheckServices()},r=>{console.log(r)})}autoCheckServices(){this.workSeleceted.forEach(r=>{console.log(`Checking work category: ${r.categoryId.name}`);let s=this.items.filter(t=>t.categoryId._id===r.categoryId._id);s.length>0?(console.log(`Found matching items for category: ${r.categoryId.name}`),s.forEach(t=>{t._id===r.serviceId._id?(t.checked=!0,console.log(`Checked item: ${t.name} with service: ${r.serviceId.name}`)):console.log(`No match found for service: ${r.serviceId.name} in item: ${t.name}`)})):console.log(`No matching items found for categoryId: ${r.categoryId._id}`)})}send(){if(this.logInService.selectedSubCategories.length>0)this.logInService.setservices(this.selectedServicesId);else{alert("Please select atleat one sub-category ");return}let r=[{categoryId:this.catIds,subcategoryId:this.subCatIds,serviceId:this.serviceIds,variantName:"normal",experience:"2 years"}];this.logInService.sendWorkDetails(r).subscribe({next:s=>{console.log(s),this.logInService.workId=[],this.logInService.selectedSubCategories=[],this.logInService.selectedServiceId="",this.logInService.catIdForServices=[],this.router.navigate(["aadharVerify"])},error:s=>{console.log(s)}})}onChange(r,s){let t=r.target;console.log(s),t&&t.checked&&(console.log("Item checked:",s),this.catIds.push(s.categoryId._id),this.subCatIds.push(s.subCategoryId._id),this.serviceIds.push(s._id),this.logInService.selectedSubCategories.length>0?console.log("ready to"):alert("Please select atleat one sub-category "))}navToBack(){this.location.back()}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(Br),_e(ii),_e(nr))},o.\u0275cmp=Et({type:o,selectors:[["app-service"]],decls:12,vars:0,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"tittle"],[1,"serivce"],["type","submit",1,"login-btn",3,"click"],[1,"service-div"],[1,"names"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"span",1),Ne("click",function(){return t.navToBack()}),X(2," keyboard_backspace "),W(),U(3,"div",2)(4,"span",3),X(5,"Select Services"),W(),Oe(6,"br"),U(7,"div",4),no(8,v7,5,2,null,null,Yo),W()(),U(10,"button",5),Ne("click",function(){return t.send()}),X(11,"Continue"),W()()),s&2&&(le(8),ro(t.groupedServicesArray))},dependencies:[sh,Kr,Sl],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;left:5%;align-items:center;display:grid;grid-gap:.5rem;text-align:center}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.serivce[_ngcontent-%COMP%]{height:78vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.5rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2rem;height:2rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let c=o;return c})();function x7(c,o){if(c&1){let d=ai();U(0,"li",22),Ne("click",function(){let s=St(d).$implicit,t=it(2);return It(t.selectSuggestion(s))}),X(1),W()}if(c&2){let d=o.$implicit;le(),Ni(" ",d.description," ")}}function w7(c,o){if(c&1&&(U(0,"ul"),qt(1,x7,2,1,"li",21),W()),c&2){let d=it();le(),ze("ngForOf",d.suggestions)}}var SR=(()=>{let o=class o{constructor(r,s,t,g,w,M){this.fb=r,this.http=s,this.googleMapService=t,this.router=g,this.platformId=w,this.location=M,this.loading=!1,this.destinationInput="",this.suggestions=[],this.addressObject={},this.currentLocation=[0,0],this.positionWatchId=null,this.subscriptions=new rc,this.addressForm=this.fb.group({houseNo:["",Jo.required],address:["",Jo.required],providerId:localStorage.getItem("providerId"),landMark:[""],city:["",Jo.required],state:["",Jo.required],pincode:["",Jo.required]})}ngOnInit(){}getCoordinates(){let r=`${this.addressForm.value.houseNo} ${this.addressForm.value.landmark} ${this.addressForm.value.address} ${this.addressForm.value.city} ${this.addressForm.value.state} ${this.addressForm.value.pincode}`;console.log(r),this.googleMapService.getCoordinatesFromPlaceName(r).subscribe({next:s=>{console.log(s),this.googleMapService.sendCordinates(s.results[0].geometry).subscribe({next:t=>{console.log(t),alert("coordinates are updated")},error:t=>{console.log(t)}})},error:s=>{console.log(s)}})}onSubmit(){if(this.addressForm.valid){this.getCoordinates(),console.log(this.addressForm.value);let r=`${_n}providers/provider-address `;this.http.post(r,this.addressForm.value).subscribe({next:s=>{console.log("Address saved successfully",s),this.router.navigate(["selectWork"])},error:s=>{console.error("Error saving address",s)}})}}ngAfterViewInit(){this.initializeMap()}ngOnDestroy(){this.positionWatchId!==null&&navigator.geolocation.clearWatch(this.positionWatchId),this.subscriptions.unsubscribe(),this.map=null}initializeMap(){this.loading=!0,E1(this.platformId)&&navigator.geolocation.getCurrentPosition(r=>{this.currentLocation=[r.coords.longitude,r.coords.latitude],this.loading=!1,this.autocompleteService=new google.maps.places.AutocompleteService,this.geocoder=new google.maps.Geocoder,this.userMarker=new google.maps.Marker({position:{lat:this.currentLocation[1],lng:this.currentLocation[0]},map:this.map,title:"You are here",icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(`
                  <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="#0000FF" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z"/>
                  </svg>`),scaledSize:new google.maps.Size(40,40)}}),this.positionWatchId=navigator.geolocation.watchPosition(s=>{let t={lat:s.coords.latitude,lng:s.coords.longitude};this.currentLocation=[t.lng,t.lat],this.userMarker&&this.userMarker.setPosition(t)},s=>{this.loading=!1,console.error("Error watching position:",s)}),this.map.addListener("click",s=>{this.addDestinationMarker(s.latLng)})},r=>{this.loading=!1,console.error("Error getting current location:",r)})}fetchSuggestions(){if(!this.destinationInput){this.suggestions=[];return}this.autocompleteService.getPlacePredictions({input:this.destinationInput},(r,s)=>{s===google.maps.places.PlacesServiceStatus.OK?this.suggestions=r:console.error("Error fetching suggestions:",s)})}selectSuggestion(r){this.destinationInput=r.description,console.log(this.destinationInput),this.suggestions=[],this.geocoder.geocode({placeId:r.place_id},(s,t)=>{if(t===google.maps.GeocoderStatus.OK&&s[0]){let g=s[0].geometry.location;console.log(s[0]),this.formatAddressData(s[0],g.lat(),g.lng()),this.addDestinationMarker(g)}else console.error("Error geocoding place ID:",t)})}addDestinationMarker(r){this.destinationMarker&&this.destinationMarker.setMap(null),this.destinationMarker=new google.maps.Marker({position:r,map:this.map,title:this.destinationInput,draggable:!0}),this.destinationMarker.addListener("dragend",()=>{let s=this.destinationMarker.getPosition();this.reverseGeocode(s.lat(),s.lng())}),this.map.panTo(r)}reverseGeocode(r,s){this.geocoder.geocode({location:{lat:r,lng:s}},(t,g)=>{if(g===google.maps.GeocoderStatus.OK&&t[0]){this.destinationInput=t[0].formatted_address;let w=t[0].geometry.location;this.formatAddressData(t[0],w.lat(),w.lng()),console.log(t),console.log(`Full address: ${t[0].formatted_address}`)}else console.error("No address found or error in geocoding:",g)})}formatAddressData(r,s,t){let g={address:"",city:"",landmark:"",state:"",pincode:"",appartment:"",lat:s,lng:t,hno:""};for(let w=0;w<r.address_components.length;w++){let M=r.address_components[w];M.types.includes("sublocality_level_1")?g.landmark=M.long_name:M.types.includes("locality")?g.city=M.long_name:M.types.includes("administrative_area_level_1")?g.state=M.long_name:M.types.includes("postal_code")?g.pincode=M.long_name:M.types.includes("sublocality_level_2")||M.types.includes("administrative_area_level_3")?g.address+=M.long_name+", ":M.types.includes("sublocality_level_3")?g.appartment=M.long_name:M.types.includes("premise")&&(g.hno=M.long_name)}this.addressObject=g,console.log(g),this.assignValues(g)}assignValues(r){this.addressForm.patchValue({houseNo:r.hno,address:r.address,landMark:r.landmark,city:r.city,state:r.state,pincode:r.pincode}),console.log(this.addressForm.value)}confirmLocation(){console.log("Location confirmed:",this.destinationInput)}navTo(){this.location.back()}};o.\u0275fac=function(s){return new(s||o)(_e(qa),_e(ji),_e(ch),_e(ii),_e(ah),_e(yi))},o.\u0275cmp=Et({type:o,selectors:[["app-add-address"]],decls:37,vars:3,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"form-container"],[3,"ngSubmit","formGroup"],["for","houseNo"],["id","houseNo","formControlName","houseNo","placeholder","Enter your H.no"],["for","address"],["id","address","formControlName","address","placeholder","Enter your Address",3,"ngModelChange","input","ngModel"],[4,"ngIf"],["for","landMark"],["id","landMark","formControlName","landMark","placeholder","Enter landmark"],["for","city"],["id","city","formControlName","city","placeholder","Enter City"],["for","state"],["id","state","formControlName","state","placeholder","Enter state"],["for","pincode"],["id","pincode","formControlName","pincode","placeholder","Enter your Pincode"],["type","submit"],["id","map",2,"height","400px","width","100%"],[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(s,t){s&1&&(U(0,"div",0)(1,"div",1)(2,"span",2),Ne("click",function(){return t.navTo()}),X(3,"arrow_back"),W(),X(4,"\xA0 "),U(5,"span",3),X(6,"Address information"),W()(),U(7,"div",4)(8,"form",5),Ne("ngSubmit",function(){return t.onSubmit()}),U(9,"div")(10,"label",6),X(11,"H.no / Door.no / Flat.no"),W(),Oe(12,"input",7),W(),U(13,"div")(14,"label",8),X(15,"Address"),W(),U(16,"input",9),Qo("ngModelChange",function(w){return Xo(t.destinationInput,w)||(t.destinationInput=w),w}),Ne("input",function(){return t.fetchSuggestions()}),W()(),qt(17,w7,2,1,"ul",10),U(18,"div")(19,"label",11),X(20,"Landmark"),W(),Oe(21,"input",12),W(),U(22,"div")(23,"label",13),X(24,"City / Town / Village"),W(),Oe(25,"input",14),W(),U(26,"div")(27,"label",15),X(28,"State"),W(),Oe(29,"input",16),W(),U(30,"div")(31,"label",17),X(32,"Pincode"),W(),Oe(33,"input",18),W(),U(34,"button",19),X(35,"Save & Continue"),W()()()(),Oe(36,"div",20)),s&2&&(le(8),ze("formGroup",t.addressForm),le(8),Zo("ngModel",t.destinationInput),le(),ze("ngIf",t.suggestions.length>0))},dependencies:[Io,$n,va,ba,Kr,ya,Ga,Il],styles:[".container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:1rem}.form-container[_ngcontent-%COMP%]{width:90%;margin:auto auto auto 5%;border-radius:5px}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.tittle[_ngcontent-%COMP%]{float:left;font-family:Inter,sans-serif;font-size:1.4rem;font-weight:600;line-height:24px}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:15px}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px}input[_ngcontent-%COMP%]{width:100%;height:3rem;border:.25px solid black;padding:8px;box-sizing:border-box;border-radius:.4rem}button[_ngcontent-%COMP%]{width:60%;padding:10px;background-color:#f90;border:none;color:#fff;font-size:16px;cursor:pointer;border-radius:.4rem;margin-left:20%}button[_ngcontent-%COMP%]:hover{background-color:#e80}"]});let c=o;return c})();var C7=[{path:"",component:MA},{path:"language",component:kA},{path:"log-in",component:PA},{path:"location",component:bR},{path:"verify",component:OA},{path:"aboutUser",component:RA},{path:"addAddress",component:SR},{path:"selectWork",component:LA},{path:"aboutWork",component:zA},{path:"workExperiance",component:BA},{path:"aadharVerify",component:NA},{path:"pancard",component:VA},{path:"bankDetails",component:jA},{path:"waiting",component:g3},{path:"home",component:WA},{path:"fotter",component:dh},{path:"credits",component:HA},{path:"notification",component:_3},{path:"menu",component:GA},{path:"visitingCard",component:qA},{path:"referAndEarn",component:$A},{path:"awards",component:YA},{path:"help",loadChildren:()=>import("./chunk-PIXWQOOF.js").then(c=>c.HelpModule)},{path:"target",component:eP},{path:"earnings",component:f3},{path:"calender",component:Z3},{path:"jobHistory",component:X3},{path:"jobDetails",component:J3},{path:"addCredit",component:Q3},{path:"financialDetails",component:K3},{path:"identityVerification",component:eR},{path:"ongoing",component:tR},{path:"demo",component:ew},{path:"induction",component:iR},{path:"started",component:nR},{path:"selectAccount",component:rR},{path:"congrats",component:oR},{path:"packages",component:aR},{path:"training",component:sR},{path:"getOrder/:id",component:lR},{path:"arrived/:id",component:cR},{path:"startWork/:id",component:dR},{path:"work/otp/:id",component:uR},{path:"completeWork/:id",component:hR},{path:"verifyAfterWork/:id",component:mR},{path:"subServices",component:gR},{path:"notFound",component:_R},{path:"manageServices",component:yR},{path:"feedback",component:vR},{path:"workImage/:id",component:wR},{path:"services",component:CR}],IR=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({imports:[QS.forRoot(C7),QS]});let c=o;return c})();var jC=Qp("App",{web:()=>import("./chunk-EGBBIWLX.js").then(c=>new c.AppWeb)});var _M=Qp("Network",{web:()=>import("./chunk-YLNCHRU7.js").then(c=>new c.NetworkWeb)});var TR=(()=>{let o=class o{constructor(r,s,t){this.location=r,this.messagingService=s,this.router=t,this.title="CoolieNo.1_Provider",this.myObject={},this.initializePushNotifications(),this.checkForOrderNavigation(),this.gettingNotification()}ngOnInit(){this.monitorNetworkStatus(),this.registerBackButtonListener()}initializePushNotifications(){Bm.addListener("pushNotificationActionPerformed",r=>{let s=r.notification.data?.orderId;alert(s),s&&(this.messagingService.setOrderId(s),this.router.navigate(["getOrder",s]))})}checkForOrderNavigation(){let r=this.messagingService.getOrderId();r&&(this.router.navigate(["getOrder",r]),this.messagingService.clearOrderId())}gettingNotification(){jC.addListener("appStateChange",({isActive:r})=>{r&&Bm.getDeliveredNotifications().then(s=>{s.notifications.forEach(g=>{if(g.title==="New Order"){let w=g.data?.orderId;w&&this.router.navigate(["getOrder",w])}})}).catch(s=>{console.error("Error fetching delivered notifications:",s)})})}registerBackButtonListener(){jC.addListener("backButton",r=>{r.canGoBack?(this.location.back(),console.log("Back button pressed, navigating back")):(console.log("Back button pressed, exiting app"),jC.exitApp())})}monitorNetworkStatus(){return zr(this,null,function*(){(yield _M.getStatus()).connected||this.router.navigate(["not-found"]),_M.addListener("networkStatusChange",s=>{s.connected||this.router.navigate(["not-found"])})})}};o.\u0275fac=function(s){return new(s||o)(_e(yi),_e(P0),_e(ii))},o.\u0275cmp=Et({type:o,selectors:[["app-root"]],decls:1,vars:0,template:function(s,t){s&1&&Oe(0,"router-outlet")},dependencies:[F1],styles:[".loading-div[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000;overflow-y:auto}"]});let c=o;return c})();var S7="@",I7=(()=>{let o=class o{constructor(r,s,t,g,w){this.doc=r,this.delegate=s,this.zone=t,this.animationType=g,this.moduleImpl=w,this._rendererFactoryPromise=null,this.scheduler=yr(w1,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-4C2XSBWM.js")).catch(s=>{throw new SE(5300,!1)}).then(({\u0275createEngine:s,\u0275AnimationRendererFactory:t})=>{this._engine=s(this.animationType,this.doc,this.scheduler);let g=new t(this.delegate,this._engine,this.zone);return this.delegate=g,g})}createRenderer(r,s){let t=this.delegate.createRenderer(r,s);if(t.\u0275type===0)return t;typeof t.throwOnSyntheticProps=="boolean"&&(t.throwOnSyntheticProps=!1);let g=new bM(t);return s?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(w=>{let M=w.createRenderer(r,s);g.use(M)}).catch(w=>{g.use(t)}),g}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};o.\u0275fac=function(s){m0()},o.\u0275prov=ci({token:o,factory:o.\u0275fac});let c=o;return c})(),bM=class{constructor(o){this.delegate=o,this.replay=[],this.\u0275type=1}use(o){if(this.delegate=o,this.replay!==null){for(let d of this.replay)d(o);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(o,d){return this.delegate.createElement(o,d)}createComment(o){return this.delegate.createComment(o)}createText(o){return this.delegate.createText(o)}get destroyNode(){return this.delegate.destroyNode}appendChild(o,d){this.delegate.appendChild(o,d)}insertBefore(o,d,r,s){this.delegate.insertBefore(o,d,r,s)}removeChild(o,d,r){this.delegate.removeChild(o,d,r)}selectRootElement(o,d){return this.delegate.selectRootElement(o,d)}parentNode(o){return this.delegate.parentNode(o)}nextSibling(o){return this.delegate.nextSibling(o)}setAttribute(o,d,r,s){this.delegate.setAttribute(o,d,r,s)}removeAttribute(o,d,r){this.delegate.removeAttribute(o,d,r)}addClass(o,d){this.delegate.addClass(o,d)}removeClass(o,d){this.delegate.removeClass(o,d)}setStyle(o,d,r,s){this.delegate.setStyle(o,d,r,s)}removeStyle(o,d,r){this.delegate.removeStyle(o,d,r)}setProperty(o,d,r){this.shouldReplay(d)&&this.replay.push(s=>s.setProperty(o,d,r)),this.delegate.setProperty(o,d,r)}setValue(o,d){this.delegate.setValue(o,d)}listen(o,d,r){return this.shouldReplay(d)&&this.replay.push(s=>s.listen(o,d,r)),this.delegate.listen(o,d,r)}shouldReplay(o){return this.replay!==null&&o.startsWith(S7)}};function MR(c="animations"){return HS("NgAsyncAnimations"),TE([{provide:C1,useFactory:(o,d,r)=>new I7(o,d,r,c),deps:[Kn,D1,gn]},{provide:_a,useValue:c==="noop"?"NoopAnimations":"BrowserAnimations"}])}var T7=FS(KI());var UC={production:!1,firebase:{apiKey:"AIzaSyAcziwgDyx2SxCSeuGbgFDr9_94R2tpDfk",authDomain:"coolie-9cc38.firebaseapp.com",projectId:"coolie-9cc38",storageBucket:"coolie-9cc38.appspot.com",messagingSenderId:"425618348845",appId:"1:425618348845:android:dfb682ab264340b4f611a4",measurementId:"G-X6752VX6L5",vapidKey:"BFLySRIkI2i4ZrxUJjrsCDeG921cCUs-9zLhyulNlP7HUawhIVFefo8GFfxxgnpTWV9zgiKJ9m9Vx8C39MRgPYA"}};var M7=/[&<>"']/g,Rne=RegExp(M7.source);var k7=new Hn("ng-select-selection-model");function E7(){return new yM}var yM=class{constructor(){this._selected=[]}get value(){return this._selected}select(o,d,r){if(o.selected=!0,(!o.children||!d&&r)&&this._selected.push(o),d)if(o.parent){let s=o.parent.children.length,t=o.parent.children.filter(g=>g.selected).length;o.parent.selected=s===t}else o.children&&(this._setChildrenSelectedState(o.children,!0),this._removeChildren(o),r&&this._activeChildren(o)?this._selected=[...this._selected.filter(s=>s.parent!==o),o]:this._selected=[...this._selected,...o.children.filter(s=>!s.disabled)])}unselect(o,d){if(this._selected=this._selected.filter(r=>r!==o),o.selected=!1,d)if(o.parent&&o.parent.selected){let r=o.parent.children;this._removeParent(o.parent),this._removeChildren(o.parent),this._selected.push(...r.filter(s=>s!==o&&!s.disabled)),o.parent.selected=!1}else o.children&&(this._setChildrenSelectedState(o.children,!1),this._removeChildren(o))}clear(o){this._selected=o?this._selected.filter(d=>d.disabled):[]}_setChildrenSelectedState(o,d){for(let r of o)r.disabled||(r.selected=d)}_removeChildren(o){this._selected=[...this._selected.filter(d=>d.parent!==o),...o.children.filter(d=>d.parent===o&&d.disabled&&d.selected)]}_removeParent(o){this._selected=this._selected.filter(d=>d!==o)}_activeChildren(o){return o.children.every(d=>!d.disabled||d.selected)}},kR=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o}),o.\u0275inj=Ai({providers:[{provide:k7,useValue:E7}],imports:[qc]});let c=o;return c})();var ER=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=Pi({type:o,bootstrap:[TR]}),o.\u0275inj=Ai({providers:[MR(),mr],imports:[A1,IR,YE,ZE,NE,aD,FD,zD,BD,ND,jD,vA,WD,QA,dA,ED,SA.initializeApp(UC.firebase),TA,AA,kR]});let c=o;return c})();UC.production&&void 0;VE().bootstrapModule(ER).catch(c=>console.error(c));"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js").then(c=>{console.log("Service Worker registered with scope:",c.scope)}).catch(c=>{console.log("Service Worker registration failed:",c)});
